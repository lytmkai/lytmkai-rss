<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[前注意加工：让你的图表抓住读者的眼球]]></title>    <link>https://juejin.cn/post/7591350620188999686</link>    <guid>https://juejin.cn/post/7591350620188999686</guid>    <pubDate>2026-01-04T15:08:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620188999686" data-draft-id="7591510742634233919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前注意加工：让你的图表抓住读者的眼球"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-04T15:08:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前注意加工：让你的图表抓住读者的眼球
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:08:56.000Z" title="Sun Jan 04 2026 15:08:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下，你走进一个挤满人的房间，朋友向你招手--你几乎立刻就能看到他。</p>
<p>这是因为“招手”这个动作在你的大脑进行深入思考之前，就已经被注意到了。</p>
<p>再比如当你走在熙熙攘攘的大街上，如果所有人穿的都是黑灰色的大衣，而此时有一个人穿着鲜红色的风衣，你会看哪里？</p>
<p>毫无疑问，你的目光会瞬间被那抹红色吸引。</p>
<p>这就是<strong>前注意加工</strong>：我们的大脑能在极短时间内（约200-250毫秒）自动检测到某些视觉特征，而无需我们有意识地去寻找。</p>
<p>在数据可视化中，<strong>前注意加工</strong>就是我们用来引导读者注意力的“视觉魔术”。</p>
<p>通过巧妙地改变颜色、大小、形状等视觉属性，我们可以让图表中的关键信息（如最大值、最小值、异常值）像朋友招手一样“跳出来”，第一时间抓住读者的眼球。</p>
<h2 data-id="heading-0">1. 前注意加工的实用技巧</h2>
<ol>
<li><strong>少即是多</strong>：不要过度使用突出效果，否则会失去焦点</li>
<li><strong>一致性原则</strong>：在整个报告或仪表板中使用相同的突出颜色编码</li>
<li><strong>考虑色盲用户</strong>：避免仅依靠颜色区分，可结合形状、纹理等</li>
<li><strong>上下文相关</strong>：根据数据特点和观众背景选择合适的突出方式</li>
<li><strong>测试效果</strong>：让其他人查看你的图表，确认突出效果是否达到预期</li>
</ol>
<h2 data-id="heading-1">2. 前注意加工实例</h2>
<p>概念介绍完了，下面直接看代码，看看实际情况下如何使用<strong>前注意加工</strong>来提高我们的可视化效果。</p>
<h3 data-id="heading-2">2.1. 突出最大值和最小值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：突出最大值和最小值</span>
<span class="hljs-comment"># 创建数据</span>
np.random.seed(<span class="hljs-number">42</span>)
categories = [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>, <span class="hljs-string">'E'</span>, <span class="hljs-string">'F'</span>, <span class="hljs-string">'G'</span>, <span class="hljs-string">'H'</span>]
values = np.random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">100</span>, size=<span class="hljs-number">8</span>)

<span class="hljs-comment"># 找出最大值和最小值的索引</span>
max_idx = np.argmax(values)
min_idx = np.argmin(values)

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
bars1 = ax1.bar(categories, values, color=<span class="hljs-string">'lightblue'</span>, edgecolor=<span class="hljs-string">'black'</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出最大最小值）</span>
colors = [<span class="hljs-string">'lightblue'</span>] * <span class="hljs-built_in">len</span>(values)
colors[max_idx] = <span class="hljs-string">'#FF6B6B'</span>  <span class="hljs-comment"># 红色突出最大值</span>
colors[min_idx] = <span class="hljs-string">'#4ECDC4'</span>  <span class="hljs-comment"># 青色突出最小值</span>

bars2 = ax2.bar(categories, values, color=colors, edgecolor=<span class="hljs-string">'black'</span>)

<span class="hljs-comment"># 在最大值和最小值上添加标签</span>
ax2.text(max_idx, values[max_idx] + <span class="hljs-number">2</span>, <span class="hljs-string">f'最大: <span class="hljs-subst">{values[max_idx]}</span>'</span>,
         ha=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, color=<span class="hljs-string">'#FF6B6B'</span>)
ax2.text(min_idx, values[min_idx] + <span class="hljs-number">2</span>, <span class="hljs-string">f'最小: <span class="hljs-subst">{values[min_idx]}</span>'</span>,
         ha=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, color=<span class="hljs-string">'#4ECDC4'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5b3cfac63c404bae4e199caaea3ea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=JIDdIdb1RTsmPmZg86kopP8HIEg%3D" alt="" loading="lazy"/></p>
<p>左图中，所有柱子都是相同的蓝色，读者需要逐个比较才能找出最大值和最小值。</p>
<p>右图中，最大值用醒目的红色标出，最小值用青色标出，读者一眼就能看到关键数据点。</p>
<p><strong>前注意加工的好处</strong>：就像在人群中为重要人物戴上特别的帽子，读者无需费力寻找就能立即识别关键数据点。</p>
<h3 data-id="heading-3">2.2. 突出异常值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例2：突出异常值</span>
<span class="hljs-comment"># 创建包含异常值的数据</span>
np.random.seed(<span class="hljs-number">42</span>)
data_normal = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
data_outliers = np.array([<span class="hljs-number">5</span>, <span class="hljs-number">125</span>, <span class="hljs-number">130</span>])  <span class="hljs-comment"># 异常值</span>
all_data = np.concatenate([data_normal, data_outliers])

<span class="hljs-comment"># 识别异常值（简单方法：超出平均值±2倍标准差）</span>
mean_val = np.mean(all_data)
std_val = np.std(all_data)
outlier_indices = np.where((all_data &lt; mean_val - <span class="hljs-number">2</span>*std_val) | (all_data &gt; mean_val + <span class="hljs-number">2</span>*std_val))[<span class="hljs-number">0</span>]

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
scatter1 = ax1.scatter(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_data)), all_data, alpha=<span class="hljs-number">0.7</span>, c=<span class="hljs-string">'gray'</span>, s=<span class="hljs-number">50</span>)
ax1.axhline(y=mean_val, color=<span class="hljs-string">'black'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">f'平均值: <span class="hljs-subst">{mean_val:<span class="hljs-number">.1</span>f}</span>'</span>)
ax1.axhline(y=mean_val + <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">'±2标准差'</span>)
ax1.axhline(y=mean_val - <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出异常值）</span>
colors = [<span class="hljs-string">'gray'</span>] * <span class="hljs-built_in">len</span>(all_data)
sizes = [<span class="hljs-number">50</span>] * <span class="hljs-built_in">len</span>(all_data)

<span class="hljs-comment"># 突出异常值</span>
<span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> outlier_indices:
    colors[idx] = <span class="hljs-string">'#FF6B6B'</span>  <span class="hljs-comment"># 红色</span>
    sizes[idx] = <span class="hljs-number">150</span>  <span class="hljs-comment"># 更大</span>

scatter2 = ax2.scatter(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_data)), all_data, alpha=<span class="hljs-number">0.7</span>, c=colors, s=sizes)
ax2.axhline(y=mean_val, color=<span class="hljs-string">'black'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">f'平均值: <span class="hljs-subst">{mean_val:<span class="hljs-number">.1</span>f}</span>'</span>)
ax2.axhline(y=mean_val + <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">'±2标准差'</span>)
ax2.axhline(y=mean_val - <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dae986c53b4fb0ad21e5223e0e7c26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=VsBftwhA5%2BeJlU93WsU0Gjv%2BE1o%3D" alt="" loading="lazy"/></p>
<p>左图中，异常值混在普通数据点中，难以立即识别。</p>
<p>右图中，异常值用更大的红色点突出显示，即使数据量很大，读者也能立即注意到这些特殊点。</p>
<p><strong>前注意加工的好处</strong>：就像在平静湖面上标记出涟漪的起源，异常值不再隐藏在数据海洋中，而是成为分析的重点。</p>
<h3 data-id="heading-4">2.3. 突出趋势变化点</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例3：突出趋势变化点</span>
<span class="hljs-comment"># 创建包含趋势变化的时间序列数据</span>
np.random.seed(<span class="hljs-number">42</span>)
time_points = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>)
trend_change_point = <span class="hljs-number">45</span>

<span class="hljs-comment"># 分段创建趋势数据</span>
trend1 = <span class="hljs-number">30</span> + <span class="hljs-number">0.5</span> * np.arange(<span class="hljs-number">0</span>, trend_change_point) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, trend_change_point)
trend2 = trend1[-<span class="hljs-number">1</span>] - <span class="hljs-number">0.8</span> * np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span> - trend_change_point) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100</span> - trend_change_point)
data = np.concatenate([trend1, trend2])

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
line1 = ax1.plot(time_points, data, color=<span class="hljs-string">'gray'</span>, alpha=<span class="hljs-number">0.8</span>, linewidth=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出趋势变化点）</span>
line2 = ax2.plot(time_points, data, color=<span class="hljs-string">'gray'</span>, alpha=<span class="hljs-number">0.6</span>, linewidth=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 突出趋势变化区域</span>
ax2.axvspan(trend_change_point-<span class="hljs-number">5</span>, trend_change_point+<span class="hljs-number">5</span>, alpha=<span class="hljs-number">0.3</span>, color=<span class="hljs-string">'#FF6B6B'</span>, label=<span class="hljs-string">'趋势变化区域'</span>)
ax2.scatter(trend_change_point, data[trend_change_point], color=<span class="hljs-string">'#FF6B6B'</span>, s=<span class="hljs-number">200</span>, zorder=<span class="hljs-number">5</span>, label=<span class="hljs-string">'变化点'</span>)
ax2.plot(time_points[:trend_change_point+<span class="hljs-number">1</span>], data[:trend_change_point+<span class="hljs-number">1</span>], color=<span class="hljs-string">'#4ECDC4'</span>, linewidth=<span class="hljs-number">3</span>, alpha=<span class="hljs-number">0.8</span>, label=<span class="hljs-string">'上升趋势'</span>)
ax2.plot(time_points[trend_change_point:], data[trend_change_point:], color=<span class="hljs-string">'#45B7D1'</span>, linewidth=<span class="hljs-number">3</span>, alpha=<span class="hljs-number">0.8</span>, label=<span class="hljs-string">'下降趋势'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8a2dbd998f5473984e0e6bd5ff15826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=RkX6bbP4BvgBLbvQevTRxvaJcIw%3D" alt="" loading="lazy"/></p>
<p>左图展示了一个完整的趋势线，但变化点不明显。</p>
<p>右图使用不同颜色区分趋势段，并用阴影区域和突出点标记变化区域，使趋势转折一目了然。</p>
<p><strong>前注意加工的好处</strong>：就像在道路地图上标记出转弯处，读者能立即看到趋势变化的关键时刻。</p>
<h3 data-id="heading-5">2.4. 突出特定类别</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例4：突出特定类别</span>
<span class="hljs-comment"># 创建饼图数据</span>
categories = [<span class="hljs-string">"电子产品"</span>, <span class="hljs-string">"服装"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"书籍"</span>, <span class="hljs-string">"其他"</span>]
values = [<span class="hljs-number">25</span>, <span class="hljs-number">18</span>, <span class="hljs-number">22</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>]
highlight_category = <span class="hljs-string">"食品"</span>  <span class="hljs-comment"># 要突出的类别</span>
highlight_idx = categories.index(highlight_category)

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
colors1 = [<span class="hljs-string">"#FF9AA2"</span>, <span class="hljs-string">"#FFB7B2"</span>, <span class="hljs-string">"#FFDAC1"</span>, <span class="hljs-string">"#E2F0CB"</span>, <span class="hljs-string">"#B5EAD7"</span>, <span class="hljs-string">"#C7CEEA"</span>]
wedges1, texts1, autotexts1 = ax1.pie(
    values, labels=categories, autopct=<span class="hljs-string">"%1.1f%%"</span>, colors=colors1, startangle=<span class="hljs-number">90</span>
)

<span class="hljs-comment"># 右图：有前注意加工（突出特定类别）</span>
<span class="hljs-comment"># 将突出类别的颜色改为醒目的颜色，其他类别用灰度</span>
colors2 = [<span class="hljs-string">"lightgray"</span>] * <span class="hljs-built_in">len</span>(categories)
colors2[highlight_idx] = <span class="hljs-string">"#FF6B6B"</span>  <span class="hljs-comment"># 突出类别用红色</span>

<span class="hljs-comment"># 突出显示：将特定类别"拉出"</span>
explode = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(categories)
explode[highlight_idx] = <span class="hljs-number">0.1</span>

wedges2, texts2, autotexts2 = ax2.pie(
    values,
    labels=categories,
    autopct=<span class="hljs-string">"%1.1f%%"</span>,
    colors=colors2,
    explode=explode,
    startangle=<span class="hljs-number">90</span>,
)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27631577fe6442ff87cb3febe019a2d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=VVXo4UpyLMdw0BnGAD4q02R1Q1g%3D" alt="" loading="lazy"/></p>
<p>左图中，所有类别视觉权重相同，读者需要阅读标签或百分比才能找到特定类别。</p>
<p>右图中，目标类别被"拉出"并用醒目的红色显示，其他类别则用灰色淡化，读者一眼就能看到重点。</p>
<p><strong>前注意加工的好处</strong>：就像在合唱团中为独唱者打上聚光灯，特定类别立即成为视觉焦点。</p>
<p>同样，在绘制<strong>多条折线图</strong>（也就是俗称的“面条图”）时，如果每条线都用高饱和度的颜色，画面会非常混乱，读者不知道该看哪一条。</p>
<p>也可以用上面饼图类似的思路，降低非重点数据的<strong>不透明度</strong>（<code>Alpha</code>）和<strong>线宽</strong>（<code>Linewidth</code>），只保留重点数据的鲜明样式。</p>
<p>这就像舞台上的聚光灯，灯光打在哪里，观众就看哪里。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 模拟时间序列数据</span>
x = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
<span class="hljs-comment"># 生成5条干扰线</span>
lines = [np.sin(x + i) * (<span class="hljs-number">1</span> + i/<span class="hljs-number">10</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]
<span class="hljs-comment"># 生成1条重点线（比如这是我们公司的产品）</span>
main_line = np.sin(x) * <span class="hljs-number">2.5</span> + <span class="hljs-number">1</span>

fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># --- 图1：没有前注意加工 ---</span>
<span class="hljs-comment"># 典型的面条图，所有线都在争夺注意力</span>
<span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(lines):
    ax1.plot(x, line, label=<span class="hljs-string">f'Competitor <span class="hljs-subst">{i}</span>'</span>)
ax1.plot(x, main_line, label=<span class="hljs-string">'Our Product'</span>)

<span class="hljs-comment"># --- 图2：有前注意加工 ---</span>
<span class="hljs-comment"># 策略：弱化背景，突出前景</span>
<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
    ax1.plot(x, line) <span class="hljs-comment"># 左图逻辑</span>
    <span class="hljs-comment"># 右图逻辑：灰色、细线、半透明</span>
    ax2.plot(x, line, color=<span class="hljs-string">'lightgray'</span>, linewidth=<span class="hljs-number">1</span>, alpha=<span class="hljs-number">0.6</span>)

<span class="hljs-comment"># 重点线：深青色、加粗、不透明</span>
ax2.plot(x, main_line, color=<span class="hljs-string">'teal'</span>, linewidth=<span class="hljs-number">3</span>, label=<span class="hljs-string">'Our Product'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b88a68d04722404b8e0a02299f04e02c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=BT2qL1g8H2ysRLSUQpqaDEdFmBk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">3. 总结</h2>
<p><strong>前注意加工</strong>是数据可视化中的"视觉语法"，它通过预认知的视觉特征引导读者的注意力。</p>
<p>就像熟练的导游会指出风景中的亮点，有效的数据可视化应该引导读者立即看到数据故事中<strong>最关键</strong>的部分。</p>
<p>数据可视化不仅仅是把数据画出来，更是一场<strong>注意力的管理艺术</strong>。</p>
<ul>
<li><strong>不要让读者的眼睛去“工作”</strong>：如果他们需要花好几秒钟去找最大值，那是我们设计者的失职。</li>
<li><strong>利用对比</strong>：颜色（亮/暗）、大小（大/小）、位置（前/后），这些物理属性的对比能瞬间触发大脑的“系统1”（直觉系统）。</li>
</ul>
<p>下次使用 <code>Matplotlib</code> 绘图时，在 <code>plt.show()</code> 之前，请停下来问自己一个问题：“<strong>我这张图里，最想让读者第一眼看到的是什么？</strong>”</p>
<p>一旦确定了答案，就请大胆地使用上述技巧，把它“推”到读者眼前吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[事件循环介绍]]></title>    <link>https://juejin.cn/post/7591130604430213160</link>    <guid>https://juejin.cn/post/7591130604430213160</guid>    <pubDate>2026-01-04T15:11:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604430213160" data-draft-id="7591330139083587599" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="事件循环介绍"/> <meta itemprop="keywords" content="FastAPI"/> <meta itemprop="datePublished" content="2026-01-04T15:11:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            事件循环介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:11:06.000Z" title="Sun Jan 04 2026 15:11:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">事件循环（Event Loop）的“电梯”比喻</h2>
<p>把单线程 CPU 想成<strong>一部只载一人的电梯</strong>：</p>
<ul>
<li>电梯里一次只能运行一个人（同步函数）</li>
<li>但大楼里 1000 个人都要去不同楼层（I/O 操作：网络、文件、数据库 …）</li>
<li>如果每个人“自己开电梯”→ 电梯空跑、人堵门口，效率极低</li>
</ul>
<p>事件循环就是**“电梯调度员”**：</p>
<ol>
<li>把整栋楼的所有“上下楼请求”登记到一张<strong>任务清单</strong></li>
<li>电梯每次只拉一个“能立刻出发”的人</li>
<li>当某人按下“去 15 楼”按钮后，电梯<strong>不会傻等他走到 15 楼再回来</strong>，而是
<ul>
<li>把“到达 15 楼后的事”写进清单（回调 / Future）</li>
<li>立刻拉下一位就绪的人</li>
</ul>
</li>
<li>15 楼按钮亮起（I/O 完成）→ 调度员再把“后续任务”重新塞进电梯</li>
</ol>
<p>结果：一部电梯（单线程）<strong>在任意时刻都载着“就绪”的人</strong>，
而“等人”的时间被拿去干别的事，<strong>宏观上 1000 个人同时移动</strong>——这就是并发。</p>
<hr/>
<h2 data-id="heading-1">技术映射</h2>





























<table><thead><tr><th>比喻</th><th>真实术语</th></tr></thead><tbody><tr><td>任务清单</td><td>就绪队列（ready queue）</td></tr><tr><td>电梯</td><td>线程（主线程）</td></tr><tr><td>按钮亮起</td><td>内核 epoll/select 返回可读/可写事件</td></tr><tr><td>到达后的事</td><td>回调、协程 resume、Future.set_result()</td></tr><tr><td>调度员</td><td>事件循环对象 (asyncio.get_event_loop())</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">为什么能“异步”又“并发”</h2>
<ol>
<li>
<p><strong>异步</strong><br/>
调用 <code>await sock.recv(1024)</code> 时，协程把“剩余代码”封装成回调挂到事件循环，<br/>
主线程立刻去执行下一个就绪任务；<br/>
当 socket 缓冲区收到数据 → 事件循环把回调重新推进就绪队列 → 协程恢复。<br/>
因此<strong>调用者不会阻塞在 recv 上</strong>，形成“非阻塞”效果。</p>
</li>
<li>
<p><strong>并发</strong><br/>
单线程同一时刻只能跑一条 CPU 指令，<br/>
但 I/O 操作 99 % 时间都在<strong>等网卡、等磁盘、等数据库响应</strong>；<br/>
事件循环把这些“空闲时间”切片，让<strong>成千上万个协程轮流占用 CPU</strong>，<br/>
从宏观时间轴看，它们像是“同时”进行，于是实现了<strong>高并发</strong>。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-3">一张图秒懂</h2>
<pre><code class="hljs language-lua" lang="lua">        主线程（单核）
┌──────────────────────────────┐
│ <span class="hljs-keyword">while</span> True:                  │
│     ① 将就绪协程推进电梯      │←<span class="hljs-comment">---┐</span>
│     ② 运行直到遇到 I/O        │    │
│     ③ 把“后续”注册到内核 + 循环 │    │
│     ④ 内核 epoll 通知完成     │<span class="hljs-comment">----┘</span>
└──────────────────────────────┘
</code></pre>
<p>电梯永远满载，但从不等人，吞吐量 ↑↑</p>
<hr/>
<h2 data-id="heading-4">结论</h2>
<p>事件循环不是魔法，只是把**“等 I/O 的时间”<strong>转化为</strong>“运行其他任务的时间”<strong>；<br/>
在单线程里让</strong>大量 I/O 密集任务交替推进**，<br/>
既避免了多线程切换开销，又达到<strong>近乎线性的并发能力</strong>——<br/>
这就是它成为 Node.js、Python asyncio、FastAPI 灵魂的原因。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG知识库远远没有你想象中的那么简单！]]></title>    <link>https://juejin.cn/post/7591334208998031386</link>    <guid>https://juejin.cn/post/7591334208998031386</guid>    <pubDate>2026-01-04T15:14:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591334208998031386" data-draft-id="7591338980694261806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG知识库远远没有你想象中的那么简单！"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2026-01-04T15:14:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG知识库远远没有你想象中的那么简单！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:14:33.000Z" title="Sun Jan 04 2026 15:14:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>知识库系统作为大模型应用的关键模块，始终保持着与大模型的解耦特性。</p>
<p>此前文中曾探讨过知识库的构建困境，不少读者反馈内容空泛、缺乏实操价值。</p>
<p>构建知识库，从来不只是工程实现的命题，更是一场设计哲学的思辨：技术层面确保其可部署、可运维，而哲学层面则锚定其高可用性、可扩展性与跨系统兼容性。</p>
<p>在AI时代盛行的今天，知识库早已超越RAG的边界，成为底层知识基础设施；理论上，凡需知识支撑之处，皆有其存在——无论是智能体决策，还是AIGC内容生成，莫不如此。</p>
<h2 data-id="heading-0">知识库的作用</h2>
<p>我们暂且搁置各类技术框架与应用理论，回归模型最本质的基座，重新审视知识库为何不可或缺。</p>
<p>人工智能的终极愿景，是构建一个能像人类一样应对复杂任务的智能体；但无论人还是机器，能力皆有边界，往往需借力外物才能完成目标——正如我们踏入陌生领域时，依赖书籍研读、师者点拨来获取认知。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>更多AI大模型学习视频及资源，都在智泊AI。</strong></a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12e7138a3f2044279e162aee98de58c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144473&amp;x-signature=OBEcw6nWtJFSxTPLLXsOCdWW%2BQw%3D" alt="图片" loading="lazy"/></p>
<p>这些外部信息，对人而言是学习的养分；对模型而言，则是其自身无法承载的“外部记忆”。管理这类记忆，正需要一个知识库系统，如同图书馆典藏典籍、档案室保存文献。</p>
<p>模型亦然。纵使参数规模持续膨胀，其内部存储仍非无限，总有知识无法内化。从经济性与效率出发，更合理的路径是：让模型专注核心推理能力，而在需要时调用外部知识与工具解决问题。无需为解答“1+1=2”而重学微积分。</p>
<p>由此可得：无论模型形态如何演进，知识库都是其无法绕开的基础设施。</p>
<p>认清这一点，便不难理解——无论是构建RAG、开发智能体，还是推进AIGC，知识库始终是底层刚需。</p>
<p>从工程视角看，我们向模型输入任务需求与参考知识，模型据此理解意图、生成响应；而这些参考知识，总不能每次临时检索、现场查找吧？</p>
<p>于是，一个结构化的知识库管理系统应运而生：它沉淀历史知识，组织可复用信息。当相似问题再度出现，系统可直接调用已有答案，无需重复劳动。这不仅拓展了模型的能力上限，更显著提升了响应效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/578881e40e4849809b5b023534ae3ff2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144473&amp;x-signature=w1ohvgkw0aqFyfoWPaoOyQbUXSM%3D" alt="图片" loading="lazy"/></p>
<p>针对大模型的各类应用场景，知识库管理系统都是不可或缺的支撑组件；但其构建应紧扣实际需求灵活适配，无需也不应追求面面俱到、规模庞大。</p>
<p>模型与知识库之间的关系，恰如一位能力出众的专家与其专属后勤团队：模型负责决策与输出，知识库则持续供给精准、及时的资源支持，二者协同运作，才能催生出远超模型单体能力的智能体。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>更多AI大模型学习视频及资源，都在智泊AI。</strong></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026 春涧·前端走向全栈]]></title>    <link>https://juejin.cn/post/7591510742634283071</link>    <guid>https://juejin.cn/post/7591510742634283071</guid>    <pubDate>2026-01-04T15:22:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742634283071" data-draft-id="7591334602427269183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 春涧·前端走向全栈"/> <meta itemprop="keywords" content="全栈,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-04T15:22:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="牛奶"/> <meta itemprop="url" content="https://juejin.cn/user/1169536100866487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 春涧·前端走向全栈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536100866487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    牛奶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:22:51.000Z" title="Sun Jan 04 2026 15:22:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">2026 春涧·前端走向全栈</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/becd400be9584391993b37b521b6687a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54mb5aW2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144971&amp;x-signature=S3Pi0czXxYMlgA7vTu8DGSCQwgo%3D" alt="春涧意境 - 水墨山水与梅雨" loading="lazy"/></p>
<p><code>“我醉倚楼台翁头请酒正豪迈……人生少有快哉何须论成败”</code></p>
<p>2025，我终于从<code>“闲听梅雨窗外”</code>的前端舒适区，踉跄着醉入了全栈的春涧。</p>
<h3 data-id="heading-1">清愁初开</h3>
<p>2025，前端的核心叙事可概括为 “全栈化”与“性能优先”的双重驱动：</p>
<p><strong>前端全栈化</strong> 与 <strong>性能优先</strong>。</p>
<p>元框架（<code>Next.js</code>、<code>Nuxt</code>、<code>SvelteKit</code>）已成为新项目的呼吸起点。</p>
<p>开发者不再只写组件，而是直接设计全栈架构。</p>
<p><strong><code>“服务器优先”彻底胜出</code></strong>。</p>
<p><code>React Server Components</code>、Nuxt 3、streaming SSR……</p>
<p>服务端承载渲染与逻辑，客户端负担骤减，安全性与核心指标（LCP、TTI）暴涨。</p>
<p>性能成了唯一信仰。</p>
<p>结果很残酷，却很美：</p>
<ul>
<li>
<p><code>Rust/GO</code> 工具链全面崛起，<code>Turbopack</code>（Next.js 15 默认）带来 700x 更快 HMR，<code>Vite</code>/<code>Rspack</code>让 <code>Webpack</code> 成为上古传说。</p>
</li>
<li>
<p><code>“岛屿架构”</code>（Astro、Qwik）席卷内容型站点，零/极少 JS 默认，瞬时加载成为标配。</p>
</li>
</ul>
<p><strong>AI 从辅助变成基石</strong>。</p>
<p><code>Cursor</code>、<code>Claude</code> 等 AI 工具 深度嵌入编码、重构、调试，问题解决方式已变天。</p>
<p><code>TypeScript</code> 无需讨论，已成底层铁律。</p>
<p>而市场最刺耳的一句实话是：</p>
<p><code>“我们想要一个人全搞定。”</code></p>
<p>纯前端的体面还在，却越来越像</p>
<p>“欠二两笔墨债，闲听梅雨窗外”——</p>
<p>风雅有余，锋芒渐失。</p>
<p>年底，<strong>我又换了一份工作（市场行情依旧不好啊）</strong>，换了一份要求<code>“能前后端通吃”</code>的工作。</p>
<p>从那一刻起，真正的春涧之旅开始了。</p>
<h3 data-id="heading-2">风花雪月入栈</h3>
<p><code>转型</code>从来不是诗和远方，而是刚起步的迷雾与深夜的咖啡。</p>
<p>2025 年底，我终于鼓起勇气：</p>
<p>从熟悉的 React 组件世界，迈向<code>全栈</code>和<code>重构远程运维硬件设备控制应用</code>的未知山海。</p>
<p>框架搭好了——<code>NestJs + Vue3 + TypeORM + WebSocket + MQTT</code> 的基本骨架，</p>
<p>MQTT 连上了，第一个 <code>设备信息查询</code> 接口也跑通了。</p>
<p>但后面呢？</p>
<p>远程设备的 AI 异常诊断怎么做？</p>
<p>设备自定义操作怎么做串型链路和互斥的安全控制？</p>
<p>部署上云要踩多少坑？</p>
<p><code>报错</code>、<code>失败</code>……每一次调试都像在雨夜里摸黑前行，心底那句<code>“人间清愁”</code>又回来了。</p>
<p>有时候盯着报错的控制台，突然就想问自己：</p>
<p>“我真的能走下去吗？”</p>
<p>但奇怪的是，每解决一个小问题——</p>
<p>哪怕只是把 接口调用 改对一次，接口返回了预期数据，</p>
<p>心里的<code>“风花雪月”</code>就偷偷多了一分。</p>
<p>不是什么大成就，只是那种“原来我能往前挪一步”的微醺感。</p>
<p>现在我才明白，全栈不是一下子就“入栈”，而是像醉酒一样，一口一口地喝下去。</p>
<p>先把框架跑通，再补认证，再加个真实的小功能……</p>
<p>未知很多，但每多知道一点，山海就近一点。</p>
<h3 data-id="heading-3">2026，一起醉入春涧</h3>
<p>2026 年 1 月，我还站在春涧入口。</p>
<p>框架刚搭好，路还模糊，疑惑比答案多得多。</p>
<p>但我已经醉了——醉在<code>“敢迈出这一步”</code>的豪迈里。</p>
<p>2026 年的前端朋友，如果你也听见了那场梅雨，</p>
<p>如果你也开始怀疑<code>“纯前端还能走多远”</code>，</p>
<p>如果你也刚搭好框架，却被一堆未知吓住——</p>
<p>别怕。</p>
<p>从今天开始，哪怕只多写一个接口、多 <code>debug</code> 一次报错、多看一篇文档，</p>
<p>哪怕只多会 5%，</p>
<p>你就已经比昨天更靠近</p>
<p><code>下榻山海，风花雪月入我怀</code>。</p>
<p><code>人生少有快哉，何须论成败</code>。</p>
<p>来吧，一起在这场春涧里，慢慢醉，慢慢走。</p>
<p>（2026.1.4 半夜 · 于出差的某个酒店）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验]]></title>    <link>https://juejin.cn/post/7591510742634315839</link>    <guid>https://juejin.cn/post/7591510742634315839</guid>    <pubDate>2026-01-04T15:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742634315839" data-draft-id="7591510742634266687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验"/> <meta itemprop="keywords" content="前端,后端,代码规范"/> <meta itemprop="datePublished" content="2026-01-04T15:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Piper蛋窝"/> <meta itemprop="url" content="https://juejin.cn/user/844050443272557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/844050443272557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Piper蛋窝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:23:57.000Z" title="Sun Jan 04 2026 15:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年的今天，我还在奋笔疾书地写着 VS Code + Roo Cline 的评测心得：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUdSThZX69c8CXkEw48Vy_w" target="_blank" title="https://mp.weixin.qq.com/s/UdSThZX69c8CXkEw48Vy_w" ref="nofollow noopener noreferrer">个人评测 | Cursor 免费平替：Roo Cline + DeepSeek-v3/Gemini-2.0 + RepoPrompt AI 辅助编程</a> 。当时的我没有想过：在 2025 年， Roo Cline 会被我迅速淘汰，我也成为了 Cursor 这类 Vibe Coding 工具的稳定用户之一。</p>
<p>站在 2026 年伊始的节点上，审视自己的工作流，发现已经完全被锚定在了如下工具链上：</p>
<ul>
<li>对话工具： ChatGPT 5.2 + Gemini 3 Pro</li>
<li>Vibe Coding ： 工作用 Cursor ，个人学习用 Trae 国际版 + CodeX ，辅以 VS Code + GitHub Copliot</li>
</ul>
<p>其中我仅为 ChatGPT 和 Trae 付过费（ ChatGPT 赠送 CodeX 订阅）， GitHub Copliot 使用的免费额度（每个月可调用次数不多）。</p>
<p>本文中，我把 2025 年一年的经验总结成十条，希望能够引起讨论，共同交流学习。</p>
<h3 data-id="heading-0">（一）聊天 AI 没有被淘汰，某些情况下，它们更好用</h3>
<p>很多朋友在拿到 Cursor 或 Trae 这种 IDE 后，容易养成一种习惯：一头扎进具体的代码文件中，试图用 Tab 和 CMD+K 解决所有问题。但经过这一年的实践，我发现网页版的聊天型 AI 和 IDE 调用的 API 模型是有本质区别的。</p>
<p>首先是模型的可控性。IDE 接入的模型往往为了代码生成做过微调，但在逻辑深度上，ChatGPT 5.2 的 Thinking Extended Thinking 模式或者 Gemini 3 Pro 的推理模式，显然比 Cursor 的 Agent 更加深思熟虑。</p>
<p>更关键的是上下文的管理。当你需要进行宏观架构设计时，IDE 的 RAG 检索有时会显得过于碎片化。我的做法是，利用 <code>git archive --format=zip HEAD -o project.zip</code> 将项目打包。这个命令的好处在于它只打包 Git 追踪的文件，自动排除了 <code>node_modules</code> 和临时数据。把这个压缩包扔给 ChatGPT，它现在的虚拟机能力非常强，可以自行解压、有选择地阅读文件。</p>
<p>相比于在 IDE 里敲敲打打，ChatGPT 这类工具更适合做“顶层设计”。比如技术选型和开发路线制定，它的 Web Searching 能力比 IDE 的 Agent 更广更深；再比如项目初始化，你可以直接让它生成一个包含完整目录结构的 zip 包，甚至顺便画出 mermaid 流程图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b12f2c46458d4e1a964a2417ba0055d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=tgCxI0tfvpISS9k3Jnvr9PLRAyE%3D" alt="善于使用分支" loading="lazy"/></p>
<p>而在数学计算和复杂算法推导上，聊天 AI 更是降维打击。我自己研究油气管道调度问题时，就常把原始数据打包上传，利用 ChatGPT 的超长思考时间，结合“分支聊天”策略，同时探索整数规划、动态规划和强化学习三条路线。这种工程实践的第一步，目前的 IDE 还做不到这么好。</p>
<h3 data-id="heading-1">（二）善于使用 workspace 概念，不要浪费类 Cursor 工具的 RAG index</h3>
<p>Cursor 和 Trae 这类工具的核心优势在于云端索引（Index）。简单来说，它们把你的代码“读”了一遍并建立了一个向量数据库。这意味着在 Agent Chat 中，你不需要笨拙地把第 1 行到第 50 行代码复制进去，只需 <code>@</code> 一下相关文件，Agent 就能通过索引理解上下文，既高效又节省 tokens。</p>
<p>但在 Cursor / Trae 似乎忽略了 VS Code 祖传的 <code>workspace</code> 功能，导致 IDE 无法理解多模块项目的关系。Cursor 如果找不到明确的 root 目录，搜索和索引的效果就会大打折扣。</p>
<p>我现在的习惯是构建一个“手动的 workspace”。即使是前后端分离的项目，我也会把它们放在同一个目录下，比如创建一个 <code>_workspace</code> 文件夹，里面包含 <code>.cursorrules</code>、<code>frontend</code>、<code>backend</code> 和 <code>openapi</code> 目录。</p>
<p>不要单独打开 frontend 写前端，直接用 Cursor 打开 <code>_workspace</code>。这样在进行前后端联调时，Cursor 能够同时索引两端的代码，理解接口定义和业务逻辑的关联。你可以在 <code>.cursorrules</code> 中明确这是一个 monorepo，告诉 AI 前端用 pnpm，后端用 Python 3.12，甚至写明“调试前请运行 <code>source ./backend/env/bin/activate</code>”。这些环境上下文的注入，能让 AI 少问很多傻问题，极大地提升一次性代码通过率。</p>
<h3 data-id="heading-2">（三）MCP 、 Rule 还是 Skill ？模型越来越强，这类技术在被淘汰，适合项目的才是最好的</h3>
<p>记得 2024 年末，MCP（Model Context Protocol） 概念火得一塌糊涂。而现在， Claude 也在推广 Skill 。但到了现在，你会发现这些复杂的技巧正在被边缘化。本质原因是模型本身变强了，强到不再需要那么多拐杖。</p>
<p>MCP 虽然可以安全地连接数据库（比如限制只读权限等等），但配置起来依然繁琐，且生态本身的安全性也并非无懈可击。数次尝试后，我发现最朴素的方案反而是最有效的：让 AI 基于你的业务代码，写一套 Python 或 Shell 脚本工具。</p>
<p>比如，与其配置复杂的 MCP 去查询订单，不如让 AI 写一个 <code>scripts/get_order_info.py</code>。这样做的好处显而易见：你自己能用，AI 也能用。当你需要进行复杂测试时，直接告诉 AI：“你可以并行调用 <code>scripts/send_test_orders.py</code> 和 <code>scripts/listen_mock_executions.py</code>”。这其实就是一种定制化的、低成本的 MCP，而且完全掌握在你自己的代码仓库里。当然，记得在运行前检查一下 AI 生成的脚本，安全意识不能丢。</p>
<h3 data-id="heading-3">（四）给出具体的任务， AI 不是我们偷懒的借口，而是我们效率的乘数</h3>
<p>分享一个真实的翻车案例：前段时间有朋友把一份 Word 格式的简历扔给 Cursor，模型选的 Claude Opus 4.5，只给了一句指令：“帮我转成 HTML”。</p>
<p>结果 AI 搞得一团糟。因为它不理解这个 HTML 是要用来做静态展示，还是要部署到某个具体服务中。为了“完成任务”，AI 甚至不知道从哪搞来了一个公有云对象存储的 Token ，把简历里的照片上传到了某个不知名的 OSS 上，想删都删不掉，简直令人啼笑皆非。</p>
<p>这个教训告诉我们，AI 只是工具，决策还得靠人。正确的方式应该是先明确需求：这个 HTML 要放在哪里？是单页静态应用还是嵌入式组件？然后，利用 PLAN 模式或者先问 Chat AI：“我想把 Word 转 HTML，目前有哪些成熟工具？latex2html 还是 pandoc？或者先转 Markdown 再生成 HTML？”</p>
<p>当我们明确了技术路径（比如 Word -&gt; Markdown -&gt; HTML）后，再让 IDE 去执行。AI 是我们效率的乘数，它能把 1 变成 100，但如果我们给出的基数是 0 甚至负数（错误的决策），那结果只能是灾难。Cursor 的 PLAN 模式和 Trae 的 SOLO 模式（生成 <code>.docs/xxx.md</code>）都是很好的辅助思考工具，别为了省事直接蛮干。</p>
<h3 data-id="heading-4">（五）不要过度提示，你说的每个字 AI 都很上心</h3>
<p>在 Prompt Engineering 刚兴起时，我们习惯写一大堆提示词。但在 2025 年，面对更聪明的模型，过度提示反而成了累赘。</p>
<p>比如在中文语境下，我看到很多人喜欢在结尾加一句“请结合上下文修改代码”。这对人类来说是一句废话，但对 AI 来说可能是个干扰。它可能会死板地理解为“结合上面的代码和下面的代码”，然后去运行 <code>grep -C 10</code> 强行读取代码的物理上下行，反而忽略了原本高效的 RAG 索引逻辑。</p>
<p>现在的模型已经足够智能，能理解你的意图。简洁、清晰地描述需求，往往比堆砌“提示词魔法”效果更好。说得越多，模型“幻觉”的空间反而越大。</p>
<h3 data-id="heading-5">（六）提供充足的 context ，还包括操作系统环境和命令行日志</h3>
<p>虽然我们不该啰嗦，但在提供客观事实（Context）上，一定要大方。很多时候 AI 写出的代码跑不通，是因为它根本不知道你在什么环境下运行。</p>
<p>我有一个习惯，在开启复杂任务前，会先把终端里的环境信息甩给它：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -a
<span class="hljs-built_in">cat</span> /etc/os-release
<span class="hljs-comment"># 如果有报错日志</span>
<span class="hljs-built_in">tail</span> -20f /tmp/dev/server-error.log
</code></pre>
<p>将这些 Terminal 的输出直接粘贴到 Chat 框里，几乎不费什么功夫，消耗的 token 也可以忽略不计，但这对 AI 来说是极其关键的“地面实况”。</p>
<p>虽然 Cursor 宣称会读取 Terminal 输出，但具体的读取时机和触发规则是个黑盒。与其猜它读没读，不如主动喂给它。特别是在处理编译错误或环境依赖问题时，一份完整的日志远比你描述“它报错了”要管用一万倍。</p>
<h3 data-id="heading-6">（七）没有一蹴而就，别人的 rule / prompt 可能并不适合你</h3>
<p>网上流传着各种“神级 Prompt”和“万能 Rule”，但我建议你谨慎复制。模型在进化，工具在迭代，上个月好用的技巧，下个月可能就因为模型权重调整而失效了。</p>
<p>Rule 并不是越复杂越好。你没必要在 Rule 里把常识再强调一遍，比如写上“使用 pnpm 管理项目”就足够了，不需要再废话一句“具体命令请参考 package.json”，模型都懂。</p>
<p>更重要的是，如果你想教会 AI 使用某种内部框架，与其在 Rule 里用自然语言喋喋不休，不如直接把框架的核心代码放进 workspace 里，让它成为索引的一部分。代码本身就是最好的说明书。你的 Rule 应该是随着开发过程动态生长的，而不是一开始就塞进去一堆你自己都没读完的规则。</p>
<h3 data-id="heading-7">（八）无论是模型还是工具，时刻保留多套方案</h3>
<p>在 2025 年，唯一不变的就是变化。我们见证过模型突然“降智”，也遇到过支付渠道突然被切断的情况。</p>
<p>永远不要把所有希望寄托在单一模型上。某些模型就是有它的局限性，比如我有一次遇到一个棘手的前端 CSS 层叠上下文问题，在 ChatGPT 5.2 和 Gemini 3 Pro 上折腾了半天没解决，它们给出的方案总是在原地打转。最后我切到 GitHub Copilot 里的 Claude Opus 4.5，它一眼就看出了问题所在。</p>
<p>无论是 Cursor、Trae 还是 VS Code，无论是 OpenAI 还是 Google，保持工具链的冗余度，是你按时交付的最后一道防线。</p>
<h3 data-id="heading-8">（九）数据安全很重要，记得脱敏重要数据</h3>
<p>AI 行业竞争这么激烈，你很难保证这些 AI 公司为了活下去，不会拿你的数据去“炼丹”。所以，关于 Token、密钥（Secret Key）这类敏感信息，绝对不能交给 AI。</p>
<p>凡是你不敢提交到公共 Git 仓库的内容，也同样不要发给 AI。善用 <code>.cursorignore</code> 等配置文件，把存放密钥的文件屏蔽掉。</p>
<p>但开发又离不开这些密钥，怎么兼顾安全和方便呢？我的做法是让 AI 把所有敏感配置都提取成环境变量，而在 Codespace 之外的地方（比如本地的 <code>~/.bashrc</code>）去实际赋值。如果某个工具必须通过命令行传参（比如 <code>--token xxx</code>），我就让 AI 把这串命令封装成 <code>run.sh</code>，脚本里只写变量名。这样 AI 看到的只是 <code>$MY_SECRET_TOKEN</code>，而真实的密钥永远躺在你本地的硬盘里。你也不想你的 Token 在未来出现在某个糊涂蛋开源项目的 Prompt 示例里吧？</p>
<h3 data-id="heading-9">（十）大力不能出奇迹，不要陷入“只和 AI 聊天”就能解决所有问题的误区</h3>
<p>最后一条，也是最重要的一条：如果 AI 反复几次都解决不了一个问题，请立刻停止对话，动用你自己的脑子。</p>
<p>很多时候，我们容易陷入一种“赌徒心理”，觉得下一次 Prompt 就能修好了。举个我最近开发 Tauri 桌面应用（Rust + Vue3 + Vite）的例子：我在开发环境下（dev），点击按钮可以正常弹出模态框（Modal）；但打包安装后（build），按钮点击就毫无反应。</p>
<p>我换了三个模型，尝试了改 CSS <code>z-index</code>、查 Webview2 兼容性、对比 build/dev 环境变量，甚至让 Agent 在代码里到处打 log，折腾了一晚上都无解。Log 显示逻辑流转一切正常。</p>
<p>最后我实在没招了，在 dev 模式下主动打开了 Webview2 的控制台（Console）。一眼就看到了一个 Main Window 里的报错：<code>i18n</code> 报警，提示某个翻译占位符不能用 <code>@</code>，必须用 <code>{'@'}</code> 转义。这个错误在 dev 模式下只是个 Warning，不影响交互；但在 build 后的生产环境下，它直接阻断了后续 JS 的执行。</p>
<p>这个报错不在后端 Log 里，也不在显眼的终端输出里，AI 自然“看”不到。这提醒我们：AI 再强也只是辅助，作为工程师，排查问题的基本功（比如亲自看一眼控制台）永远不能丢。</p>
<hr/>
<p>2025 年年初，我还写了一篇关于 AI 的使用心得，除了发在咱国内的平台上，还发在了海外的技术论坛 dev.to 上，没有什么反响。</p>
<p>结果我发现，这篇文章被人洗稿了，并且绝大部分内容是原封不动地抄袭过去的。我是在 2025 年 2 月 21 日首发在 dev.to 上，它是在 2025 年 3 月 20 日把文章洗稿发到 generativeai.pub 上的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f08258b389340dc8294d7718fd78690~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=cXxs0zlEIgb6%2F5k%2FKGGv17NXWcE%3D" alt="文章标题都没有修改" loading="lazy"/></p>
<p>除了开头做了微小改动，剩下的正文部分内容基本一致。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4677fe6f98404e9bb89443a03e5a14f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=DsY0ZB42K3y5lSgkCKRq3MxrhyM%3D" alt="我的原文" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20093018a250458faa45fd3d0011ea43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=GAvlXxtGm9YYpCHm5UnljiEeOU0%3D" alt="抄袭者文章" loading="lazy"/></p>
<p>原文链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fpiperliu%2Fdont-let-ai-programming-ruin-your-career-treat-them-as-your-interns-not-employees-or-teachers-16bo" target="_blank" title="https://dev.to/piperliu/dont-let-ai-programming-ruin-your-career-treat-them-as-your-interns-not-employees-or-teachers-16bo" ref="nofollow noopener noreferrer">dev.to/piperliu/do…</a></li>
</ul>
<p>抄袭者链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgenerativeai.pub%2Fdont-let-ai-programming-ruin-your-career-treat-them-as-interns-instead-of-employees-teachers-62e278f4db02" target="_blank" title="https://generativeai.pub/dont-let-ai-programming-ruin-your-career-treat-them-as-interns-instead-of-employees-teachers-62e278f4db02" ref="nofollow noopener noreferrer">generativeai.pub/dont-let-ai…</a></li>
</ul>
<p>好消息是：抄袭者的文章有许多点赞与评论，看来我写的文章还是有一定参考价值的。</p>
<p>坏消息是：都说中文互联网是垃圾堆，看起来英文互联网也没有好到哪里去。这对我这个 Hacker News 老读者的冲击有些大。</p>
<p>准备投诉/维权试一试，看看这些国际平台是否真的那么尊重原创与版权。</p>
<p>欢迎关注我，之后有结果了我也会把经历汇总成一篇文章。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势]]></title>    <link>https://juejin.cn/post/7591348605865885731</link>    <guid>https://juejin.cn/post/7591348605865885731</guid>    <pubDate>2026-01-04T15:50:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605865885731" data-draft-id="7591330139083603983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-04T15:50:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java小成"/> <meta itemprop="url" content="https://juejin.cn/user/3614849960783160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3614849960783160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java小成
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:50:23.000Z" title="Sun Jan 04 2026 15:50:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 场景复现：那个让我头疼的时刻</h2>
<p>去年，我接手了一个"祖传" Go 项目。打开代码仓库的那一刻，我整个人都不好了——所有代码都塞在一个 <code>main.go</code> 里，足足 3000 多行。想加个功能？先花半小时找代码在哪。想写个单元测试？抱歉，函数全是私有的，而且互相耦合，根本没法单独测。</p>
<p>我当时就在想：<strong>如果当初写这个项目的人，能从第一天就用一个规范的结构，后面的人得少掉多少头发？</strong></p>
<p>后来我开始研究 Go 官方和社区推荐的项目布局，发现其实规则很简单，但很多人就是不知道。于是我写了这个 50 行代码的小 Demo，把 Go 项目结构的精髓浓缩进去。今天，我就带你一起拆解它。</p>
<h2 data-id="heading-1">2. 架构蓝图：上帝视角看设计</h2>
<p>先来看这个项目的目录结构：</p>
<pre><code class="hljs language-csharp" lang="csharp">series/<span class="hljs-number">01</span>/
├── cmd/
│   └── hello/
│       └── main.go        <span class="hljs-meta"># 程序入口，只做 I/O</span>
├── <span class="hljs-keyword">internal</span>/
│   └── reasons/
│       ├── reasons.go     <span class="hljs-meta"># 核心业务逻辑</span>
│       └── reasons_test.go <span class="hljs-meta"># 单元测试</span>
└── go.mod                  <span class="hljs-meta"># 模块定义</span>
</code></pre>
<p>这不是我随便画的，而是 Go 社区广泛认可的<strong>标准项目布局</strong>。我用一张图来展示数据是怎么流转的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 用户层
        A[命令行输入&lt;br/&gt;--name=小明 --lang=go]
    end
    
    subgraph cmd/hello
        B[main.go&lt;br/&gt;解析参数]
    end
    
    subgraph internal/reasons
        C[reasons.go&lt;br/&gt;业务逻辑]
        D[(reasonByLang&lt;br/&gt;map 数据)]
    end
    
    subgraph 输出层
        E[终端输出&lt;br/&gt;格式化结果]
    end
    
    A --&gt; B
    B --&gt;|调用 Reason 函数| C
    C --&gt;|查询| D
    D --&gt;|返回推荐理由| C
    C --&gt;|返回字符串| B
    B --&gt; E
</code></pre>
<p><strong>核心设计思想：关注点分离</strong></p>
<ul>
<li><code>cmd/</code> 目录：放可执行程序的入口。每个子目录对应一个可执行文件。<code>main.go</code> 只负责"接收输入、调用业务、输出结果"，不写任何业务逻辑。</li>
<li><code>internal/</code> 目录：放内部包。这个目录有个<strong>魔法属性</strong>——Go 编译器会强制禁止外部项目 import 这里的代码。这是 Go 语言级别的"私有化"保护。</li>
<li><code>go.mod</code>：Go Modules 的配置文件，声明模块名和 Go 版本。</li>
</ul>
<h2 data-id="heading-2">3. 源码拆解：手把手带你读核心</h2>
<h3 data-id="heading-3">3.1 入口文件：main.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"flag"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"runtime"</span>
    <span class="hljs-string">"strings"</span>
    <span class="hljs-string">"time"</span>

    <span class="hljs-string">"learn-go/series/01/internal/reasons"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    name := flag.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
    lang := flag.String(<span class="hljs-string">"lang"</span>, <span class="hljs-string">"go"</span>, <span class="hljs-string">"关注的语言"</span>)
    flag.Parse()

    lines := []<span class="hljs-type">string</span>{
        fmt.Sprintf(<span class="hljs-string">"你好，%s！"</span>, *name),
        fmt.Sprintf(<span class="hljs-string">"你正在体验：%s"</span>, strings.ToUpper(*lang)),
        fmt.Sprintf(<span class="hljs-string">"今天的结论：%s"</span>, reasons.Reason(*lang)),
        <span class="hljs-comment">// ... 省略部分</span>
    }

    fmt.Println(strings.Join(lines, <span class="hljs-string">"\n"</span>))
}
</code></pre>
<p><strong>逐行解读：</strong></p>
<p><strong>第 1 行 <code>package main</code></strong>：Go 规定，可执行程序的入口包必须叫 <code>main</code>，入口函数也必须叫 <code>main()</code>。这是铁律，没得商量。</p>
<p><strong>第 10-11 行 <code>flag.String(...)</code></strong>：这是 Go 标准库提供的命令行参数解析方案。</p>
<blockquote>
<p><strong>知识点贴士：flag 包</strong></p>
<p><code>flag.String("name", "默认值", "帮助说明")</code> 会返回一个 <code>*string</code>（字符串指针），而不是 <code>string</code>。为什么？因为 <code>flag.Parse()</code> 需要在解析完命令行后，把值"写回"到这个变量里。如果返回的是值而不是指针，就没法修改了。</p>
<p>类比 Java：这有点像 Java 里用 <code>AtomicReference</code> 来实现"可变的引用"。</p>
</blockquote>
<p><strong>第 12 行 <code>flag.Parse()</code></strong>：真正执行解析。调用这行之后，<code>name</code> 和 <code>lang</code> 指针指向的值才会被填充。</p>
<p><strong>第 15 行 <code>*name</code></strong>：这里的 <code>*</code> 是<strong>解引用操作符</strong>，意思是"取出指针指向的值"。</p>
<blockquote>
<p><strong>知识点贴士：指针</strong></p>
<p>Go 的指针比 C 简单很多——没有指针运算，只有"取地址 <code>&amp;</code>"和"解引用 <code>*</code>"两个操作。你可以把指针理解为"变量的门牌号"，<code>*</code> 就是"按门牌号找到房间里的东西"。</p>
</blockquote>
<p><strong>第 17 行 <code>reasons.Reason(*lang)</code></strong>：调用 <code>internal/reasons</code> 包里的 <code>Reason</code> 函数。注意这里的 <code>R</code> 是大写的。</p>
<blockquote>
<p><strong>知识点贴士：可见性规则</strong></p>
<p>Go 没有 <code>public</code>/<code>private</code> 关键字。它用一个极简的规则：<strong>首字母大写 = 公开，首字母小写 = 私有</strong>。所以 <code>Reason</code> 能被外部调用，而如果写成 <code>reason</code> 就只能在 <code>reasons</code> 包内部用。</p>
</blockquote>
<h3 data-id="heading-4">3.2 业务逻辑：reasons.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"strings"</span>

<span class="hljs-keyword">var</span> reasonByLang = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
    <span class="hljs-string">"go"</span>:     <span class="hljs-string">"编译快、部署简单、并发模型清晰，适合做基础设施和服务端。"</span>,
    <span class="hljs-string">"python"</span>: <span class="hljs-string">"生态丰富、验证快，适合数据处理和脚本。"</span>,
    <span class="hljs-string">"java"</span>:   <span class="hljs-string">"工程成熟、生态庞大，适合大型企业级系统。"</span>,
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Reason</span><span class="hljs-params">(lang <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
    key := strings.ToLower(strings.TrimSpace(lang))
    <span class="hljs-keyword">if</span> key == <span class="hljs-string">""</span> {
        key = <span class="hljs-string">"go"</span>
    }
    <span class="hljs-keyword">if</span> reason, ok := reasonByLang[key]; ok {
        <span class="hljs-keyword">return</span> reason
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"先选一个目标场景，再决定语言。Go 适合服务端与工具链。"</span>
}
</code></pre>
<p><strong>逐行解读：</strong></p>
<p><strong>第 5-9 行 <code>var reasonByLang = map[string]string{...}</code></strong>：这是 Go 的 <code>map</code> 类型，相当于 Java 的 <code>HashMap</code> 或 Python 的 <code>dict</code>。</p>
<p>注意这里用的是<strong>包级变量</strong>（定义在函数外面），小写开头意味着它是私有的，外部包访问不到。这是一种常见的"模块内共享数据"的方式。</p>
<p><strong>第 16 行 <code>if reason, ok := reasonByLang[key]; ok</code></strong>：这是 Go 最经典的惯用法之一——<strong>comma ok</strong>。</p>
<blockquote>
<p><strong>知识点贴士：comma ok 惯用法</strong></p>
<p>在 Go 里访问 map，可以用两种方式：</p>
<ul>
<li><code>v := m[key]</code>：如果 key 不存在，返回零值（空字符串、0 等）</li>
<li><code>v, ok := m[key]</code>：<code>ok</code> 是个布尔值，告诉你 key 到底存不存在</li>
</ul>
<p>第二种方式能区分"key 存在但值为空"和"key 根本不存在"，更安全。</p>
</blockquote>
<h3 data-id="heading-5">3.3 单元测试：reasons_test.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"testing"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestReason</span><span class="hljs-params">(t *testing.T)</span></span> {
    tests := []<span class="hljs-keyword">struct</span> {
        name <span class="hljs-type">string</span>
        lang <span class="hljs-type">string</span>
        want <span class="hljs-type">string</span>
    }{
        {name: <span class="hljs-string">"default"</span>, lang: <span class="hljs-string">""</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
        {name: <span class="hljs-string">"go"</span>, lang: <span class="hljs-string">"go"</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
        {name: <span class="hljs-string">"python"</span>, lang: <span class="hljs-string">"python"</span>, want: reasonByLang[<span class="hljs-string">"python"</span>]},
    }

    <span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
        t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
            <span class="hljs-keyword">if</span> got := Reason(tt.lang); got != tt.want {
                t.Fatalf(<span class="hljs-string">"Reason(%q) = %q, want %q"</span>, tt.lang, got, tt.want)
            }
        })
    }
}
</code></pre>
<p>这是 Go 社区推崇的**表驱动测试（Table-Driven Test）**风格。</p>
<blockquote>
<p><strong>知识点贴士：表驱动测试</strong></p>
<p>核心思想是：把测试用例组织成一个"表格"（切片），然后用循环遍历执行。好处是：</p>
<ol>
<li>新增用例只需要加一行数据，不用写重复的测试代码</li>
<li>测试逻辑集中，一眼就能看出覆盖了哪些场景</li>
<li><code>t.Run()</code> 会给每个用例起名字，失败时能精确定位</li>
</ol>
</blockquote>
<p><strong>第 16 行 <code>for _, tt := range tests</code></strong>：<code>range</code> 是 Go 遍历切片/map 的关键字。<code>_</code> 表示"我不关心索引，只要值"。</p>
<h2 data-id="heading-6">4. 避坑指南 &amp; 深度思考</h2>
<h3 data-id="heading-7">坑 1：忘记调用 flag.Parse()</h3>
<p>如果你删掉 <code>flag.Parse()</code> 这行，程序不会报错，但 <code>*name</code> 和 <code>*lang</code> 永远是默认值。这是个很隐蔽的 Bug。</p>
<h3 data-id="heading-8">坑 2：map 并发读写会 panic</h3>
<p>当前代码里的 <code>reasonByLang</code> 是只读的，没问题。但如果你想在运行时动态添加语言，<strong>千万不要</strong>在多个 goroutine 里同时读写这个 map——Go 的 map 不是并发安全的，会直接 panic。</p>
<p><strong>生产环境怎么办？</strong> 用 <code>sync.RWMutex</code> 加锁，或者用 <code>sync.Map</code>。</p>
<h3 data-id="heading-9">坑 3：internal 目录的"魔法"是编译器强制的</h3>
<p>有些同学以为 <code>internal</code> 只是个命名约定，其实不是。Go 编译器会<strong>硬性禁止</strong>外部模块 import <code>internal</code> 下的包。如果你的项目是个库，想暴露某些包给外部用，就不能放在 <code>internal</code> 里。</p>
<h3 data-id="heading-10">Demo 与生产代码的差距</h3>
<p>这个 Demo 为了教学做了简化，生产环境还需要考虑：</p>
<ol>
<li><strong>错误处理</strong>：当前代码没有任何 <code>error</code> 返回，真实场景要处理各种异常</li>
<li><strong>日志</strong>：用 <code>log</code> 或 <code>slog</code> 包记录关键操作</li>
<li><strong>配置管理</strong>：硬编码的 map 应该改成从配置文件或环境变量读取</li>
<li><strong>优雅退出</strong>：监听系统信号，做资源清理</li>
</ol>
<h2 data-id="heading-11">5. 快速上手 &amp; 改造建议</h2>
<h3 data-id="heading-12">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> series/01
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接运行</span>
go run ./cmd/hello
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，工程师！
你正在体验：GO
今天的结论：编译快、部署简单、并发模型清晰，适合做基础设施和服务端。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:02:19+08:00
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 带参数运行</span>
go run ./cmd/hello --name=小明 --lang=python
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，小明！
你正在体验：PYTHON
今天的结论：生态丰富、验证快，适合数据处理和脚本。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:05:54+08:00
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行测试</span>
go <span class="hljs-built_in">test</span> ./internal/reasons -v
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">=== RUN   TestReason
=== RUN   TestReason/default
=== RUN   TestReason/go
=== RUN   TestReason/python
--- PASS: TestReason (0.00s)
    --- PASS: TestReason/default (0.00s)
    --- PASS: TestReason/go (0.00s)
    --- PASS: TestReason/python (0.00s)
PASS
ok      learn-go/series/01/internal/reasons     0.007s
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译成可执行文件</span>
go build -o hello ./cmd/hello
./hello --name=读者
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，读者！
你正在体验：GO
今天的结论：编译快、部署简单、并发模型清晰，适合做基础设施和服务端。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:07:16+08:00
</code></pre>
<h3 data-id="heading-13">工程化改造建议</h3>
<p><strong>建议 1：加入结构化日志</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"log/slog"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    slog.Info(<span class="hljs-string">"程序启动"</span>, <span class="hljs-string">"name"</span>, *name, <span class="hljs-string">"lang"</span>, *lang)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><code>slog</code> 是 Go 1.21 引入的标准库，支持 JSON 格式输出，方便对接日志系统。</p>
<p><strong>建议 2：配置外部化</strong></p>
<p>把 <code>reasonByLang</code> 改成从 YAML/JSON 文件读取：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"os"</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"encoding/json"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadReasons</span><span class="hljs-params">(path <span class="hljs-type">string</span>)</span></span> (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    data, err := os.ReadFile(path)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">var</span> m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>
    err = json.Unmarshal(data, &amp;m)
    <span class="hljs-keyword">return</span> m, err
}
</code></pre>
<p><strong>建议 3：添加版本信息</strong></p>
<p>利用 <code>go build -ldflags</code> 在编译时注入版本号：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Version = <span class="hljs-string">"dev"</span> <span class="hljs-comment">// 会被编译时覆盖</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"版本："</span>, Version)
}
</code></pre>
<p>编译命令：</p>
<pre><code class="hljs language-bash" lang="bash">go build -ldflags <span class="hljs-string">"-X main.Version=v1.0.0"</span> -o hello ./cmd/hello
</code></pre>
<h2 data-id="heading-14">6. 总结与脑图</h2>
<ul>
<li><strong>cmd/ 放入口，internal/ 放私有逻辑</strong>——这是 Go 项目结构的黄金法则</li>
<li><strong>flag 包返回指针</strong>，记得用 <code>*</code> 解引用，别忘了调用 <code>Parse()</code></li>
<li><strong>comma ok 惯用法</strong>（<code>v, ok := m[key]</code>）是安全访问 map 的标准姿势</li>
<li><strong>首字母大小写决定可见性</strong>，这是 Go 独特的"无关键字"设计哲学</li>
<li><strong>表驱动测试</strong>让你的测试代码更简洁、更易维护</li>
</ul>
<p>如果你正准备入坑 Go，不妨把这个 Demo clone 下来，亲手改一改、跑一跑。<strong>看十遍不如写一遍</strong>，这是我这些年最深的体会。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一致性哈希介绍]]></title>    <link>https://juejin.cn/post/7591330139083489295</link>    <guid>https://juejin.cn/post/7591330139083489295</guid>    <pubDate>2026-01-04T14:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139083489295" data-draft-id="7591156262626459683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一致性哈希介绍"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-04T14:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一致性哈希介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:23:57.000Z" title="Sun Jan 04 2026 14:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一致性哈希（Consistent Hashing）是一种**“让节点扩缩容时，尽可能少地迁移数据”<strong>的分布式哈希算法。<br/>
1997 年由 MIT 的 Karger 等人提出，现在几乎成了</strong>分布式缓存、负载均衡、分库分表**的标配。</p>
<hr/>
<h3 data-id="heading-0">1. 传统哈希的问题</h3>
<p>假设有 N 台缓存节点，用 <code>hash(key) % N</code> 决定数据落在哪台机器。</p>
<ul>
<li>节点宕机或新增 1 台 → N 变化 → <strong>几乎所有 key 重新映射</strong> → 缓存雪崩，数据库瞬间被打爆。</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. 一致性哈希的核心思想</h3>
<p>把<strong>哈希空间</strong>想象成一条<strong>首尾相接的 2³² 环形轨道</strong>（0 → 2³²-1 → 0）。<br/>
步骤：</p>
<ol>
<li>节点入环：对节点 IP/ID 做 hash，得到其在环上的位置。</li>
<li>数据入环：对 key 做 hash，顺时针找到<strong>第一个节点</strong>，就是它的归属。</li>
<li>节点增减：只影响<strong>环上相邻的一段弧</strong>，其余数据原地不动。</li>
</ol>
<hr/>
<h3 data-id="heading-2">3. 虚拟节点（Virtual Nodes）——解决“倾斜”**</h3>
<p>真实节点很少时，环上分布不均，易产生“数据扎堆”。<br/>
给每台物理节点生成<strong>上百个虚拟节点</strong>（如 <code>node1#1</code>、<code>node1#2</code>…），打散在环上，<strong>负载方差</strong>瞬间下降。</p>
<hr/>
<h3 data-id="heading-3">4. 扩缩容示例</h3>
<ul>
<li>初始 3 台节点 A/B/C，key 按顺时针规则落点。</li>
<li>新增节点 D，位于 B→C 之间：<br/>
仅把原本归属 C 的**“B→D”**这段 key 迁给 D，<strong>剩余 90%+ 数据不动</strong>。</li>
<li>节点 B 宕机：<br/>
原来 B→C 之间的 key 顺时针滑到 C，<strong>其他区间无感知</strong>。</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. 代码级直觉（Python 伪代码）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib, bisect, collections

ring = []                                      <span class="hljs-comment"># 有序哈希环</span>
vnode_map = {}                                <span class="hljs-comment"># 虚拟节点 → 物理节点</span>
VNODE_PER_NODE = <span class="hljs-number">150</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">_hash</span>(<span class="hljs-params">x</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(hashlib.md5(x.encode()).hexdigest(), <span class="hljs-number">16</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_node</span>(<span class="hljs-params">node</span>):
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(VNODE_PER_NODE):
        h = _<span class="hljs-built_in">hash</span>(<span class="hljs-string">f"<span class="hljs-subst">{node}</span>#<span class="hljs-subst">{v}</span>"</span>)
        ring.insert(bisect.bisect_left(ring, h), h)
        vnode_map[h] = node

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_node</span>(<span class="hljs-params">key</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ring: <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    h = _<span class="hljs-built_in">hash</span>(key)
    pos = bisect.bisect(ring, h) % <span class="hljs-built_in">len</span>(ring)
    <span class="hljs-keyword">return</span> vnode_map[ring[pos]]
</code></pre>
<p>增删节点只需 <code>add_node</code>/<code>remove_node</code>，调用端零感知。</p>
<hr/>
<h3 data-id="heading-5">6. 一句话总结</h3>
<p>一致性哈希 = <strong>“把节点和数据放到同一个环上，顺时针找邻居”</strong>，<br/>
让<strong>节点变化时的数据迁移量从 O(M) 降到 O(M/N)</strong>，<br/>
再加虚拟节点解决倾斜，就成为分布式系统里<strong>最优雅的数据分片方案</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026云服务器从零 搭建与运维 指南]]></title>    <link>https://juejin.cn/post/7591422577936728070</link>    <guid>https://juejin.cn/post/7591422577936728070</guid>    <pubDate>2026-01-04T08:36:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591422577936728070" data-draft-id="7590752433988862006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026云服务器从零 搭建与运维 指南"/> <meta itemprop="keywords" content="后端,服务器,JavaScript"/> <meta itemprop="datePublished" content="2026-01-04T08:36:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="百万前端向前冲"/> <meta itemprop="url" content="https://juejin.cn/user/641770519804926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026云服务器从零 搭建与运维 指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/641770519804926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    百万前端向前冲
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:36:45.000Z" title="Sun Jan 04 2026 08:36:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">⓪、购买服务器选择配置</h2>
<p>作为学生首次使用 选 Windows Server 系统 。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfa23a1c238b4fd68610abd69013540c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=GsbJW%2Fi8OzBlA48%2F2EsyMRjkfWA%3D" alt="图片.png" width="50%" loading="lazy"/>
<h2 data-id="heading-1">一、远程登录(win系统自带工具mstsc)</h2>
<h3 data-id="heading-2">1.1远程登录准备工作</h3>
<p>✍️创建一个本地记事本！！！记录下服务器公网IP、账号、密码:<br/>
建议大家刚开始用将服务器重新设置为默认的密码<br/>
（复制链接打开在云服务器控制台可以重置）<br/></p>
<p>IP地址:112.124.62.199 (公网IP)
账号:<code>administrator</code>
密码:<code>2026A#a1</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">IP</span>地址:<span class="hljs-number">112.124</span><span class="hljs-number">.62</span><span class="hljs-number">.199</span> (公网<span class="hljs-variable constant_">IP</span>)
账号:administrator 
密码:2026A#a1
</code></pre>
<h3 data-id="heading-3">1.2远程登录</h3>
<p>按键盘 Win+R键 输入 <code>mstsc</code> 点确定<br/></p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/966814c9ec6e4526865a9f69988fadae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=RpivCRAusjBh9lSouP0xWfgFI1s%3D" alt="图片.png" width="70%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec80db3cebb4d15ace481297b0f1db6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=6DpfpmSFxXXr%2FCHSydwt%2FUK03NQ%3D" alt="图片.png" width="70%" loading="lazy"/>
<h2 data-id="heading-4">三、服务器环境配置</h2>
<h3 data-id="heading-5">3.1 配置Node.js网站运行环境</h3>
<p>使用服务器 浏览器 访问网址<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload" target="_blank" title="https://nodejs.org/zh-cn/download" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/downl…</a> ，下载Node.js V24以上
并安装。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cdcb12570b84a36b8d00ae8923f07e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=ZQ4Lr9Oy8%2B3vORFPpvcs948y6Q0%3D" alt="图片.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdc9ed7a0e814baca01f035fc0490190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=4osJTbkJ2eS%2BwEXQHuSiGJAqMX8%3D" alt="图片.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5703aa8aab64cc5b175decfa2193f83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=ZIe7NmIkBcRLu43NUKdwVfO7mFE%3D" alt="图片.png" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 将代码上传至云服务器(远程电脑)</h3>
<p>简单来说就是要共享硬盘给远程电脑。
在D盘或者E盘创建一个文件夹A 或者0104，将你需要展示的首页代码放入该文件夹，
同时下载 生菜服务器代码 <code>SC.js</code>(原名 生菜服务器1.7.0)</p>
<h5 data-id="heading-7">1）准备代码文件和素材</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6c9b4c863c0444da55b540b42441201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=xVr79Nb6cQWu37ixmiSwCQ4W1Ok%3D" alt="图片.png" loading="lazy"/></p>
<h5 data-id="heading-8">2）共享本地硬盘给 服务器电脑</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ed275ad645499daf459a69e6171e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=tCOb5AZV82GMmcQjjnl739NhLiE%3D" alt="dbc994b353fec7cbc009feff56207338.png" loading="lazy"/></p>
<h5 data-id="heading-9">3）点击回收站，进入我的电脑，查看共享的硬盘，把文件夹拖到桌面</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e5a37cfdf7c4660931edb765151bd7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=MXrdEjX37BlBjcHvrRlZu06zUfg%3D" alt="16ad31727504d101ba0ca19b308c52bd_720.png" loading="lazy"/></p>
<h5 data-id="heading-10">4）找到代码文件夹 拖到服务器电脑的桌面</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57dbe1eaffeb44e3a62285090aec651b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=v4gXqy1FOgRWW%2BpwLt%2BOHfEP9kw%3D" alt="图片.png" loading="lazy"/></p>
<h5 data-id="heading-11">5）启动生菜服务器，这个窗口不要关</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41451454138f40a5a281fbdd6f159ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=dgtjqNGjSqm05z0qZkRT062SJfU%3D" alt="图片.png" loading="lazy"/></p>
<p>特别注意:后续传HTML+CSS+JS都不需要重启服务器。只要保持黑色窗口启动服务器，过几分钟自动会刷新。</p>
<h2 data-id="heading-12">四、开启云服务器防火墙允许80端口</h2>
<p>现在只差最后一步，因为云服务器的自带的安全策略显示，网站的80端口没有对外开放，我们增加80端口的对外开放即可。</p>
<h3 data-id="heading-13">4.1 进入ECS 控制台实例</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fecs.console.aliyun.com%2Fserver%2F" target="_blank" title="https://ecs.console.aliyun.com/server/" ref="nofollow noopener noreferrer">ecs.console.aliyun.com/server/</a>
依次进入:ECS示例→网络与安全组→添加入站方向规则
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80f346c92d3643d681371dcb7e0f0424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=Jlu0YihX0CiK%2Bsd3Z9pWGv3LerU%3D" alt="4a2d71ab4fe84a3bb7c775d8c4a20fd7_720.png" loading="lazy"/></p>
<h3 data-id="heading-14">4.2 添加http 80端口规则</h3>
<p>如下图所示确定。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/922649ba659948e28a8889a1f1b41388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5LiH5YmN56uv5ZCR5YmN5Yay:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141911&amp;x-signature=OTkb%2BzmcHiqE3o9KcYA3kutrU0A%3D" alt="3fb4181539af37311d6fc43178e8e288_720.png" loading="lazy"/></p>
<h3 data-id="heading-15">4.3 浏览器输入公网IP访问即可。</h3>
<p>公网IP支持任意可以上网的设备，包括手机、电脑等。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek新年炸场：给失控的AI模型装上数学红绿灯]]></title>    <link>https://juejin.cn/post/7591317772074582035</link>    <guid>https://juejin.cn/post/7591317772074582035</guid>    <pubDate>2026-01-04T14:40:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772074582035" data-draft-id="7591334602427236415" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek新年炸场：给失控的AI模型装上数学红绿灯"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-04T14:40:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek新年炸场：给失控的AI模型装上数学红绿灯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:40:05.000Z" title="Sun Jan 04 2026 14:40:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年的跨年夜，当大多数人还在倒数计时迎接新年的时候，DeepSeek的团队干了一件非常极客的事——他们甩出了一篇重磅论文。</p>
<p>这篇名为《mHC: Manifold-Constrained Hyper-Connections》的论文，看似标题充满了晦涩的数学名词，但实际上，它可能刚刚解开了困扰大模型界已久的一个死结：<strong>模型越大，越容易练崩。</strong></p>
<p>今天我们就抛开那些复杂的公式，用人话聊聊这项可能定义“后Transformer时代”的新技术。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.28.40-1024x547.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.28.40-1024x547.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e57f8fd38846818d099a20c8e5cca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=IhJA2XveVygi%2BHz06LgqGly%2FWp0%3D" alt="iShot_2026-01-04_22.28.40" loading="lazy"/></a></p>
<h3 data-id="heading-0">贪婪的代价：当“宽带”变成灾难</h3>
<p>过去这十年，深度学习能发展这么快，何凯明大神的ResNet（残差连接）功不可没。你可以把它想象成一条“直通车道”，保证了信息在深层网络中不会迷路。</p>
<p>到了2024年，字节跳动搞出了一个叫“超连接”（Hyper-Connections, HC）的东西。思路很直接：既然一条直通车道好用，那我把车道拓宽成十条、百条，让信息在不同车道间随意穿梭、交互，模型能力岂不是要起飞？</p>
<p>确实，HC让模型的表达能力变强了，但也带来了一个致命副作用——<strong>信号失控</strong>。</p>
<p>想象一下，你把原来的单行道改成了一个没有交通规则的超级广场。信息在里面疯狂碰撞、叠加。DeepSeek的实验数据显示，在传统的HC架构下，随着层数加深，信号强度可能会被无脑放大3000倍。这就好比你在麦克风前轻声说句话，音响里出来的却是核爆般的噪音。</p>
<p>结果就是：显存爆炸，梯度消失，训练曲线像过山车一样出现尖峰，最后模型彻底“练废了”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.28.48-1024x409.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.28.48-1024x409.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba5566a1a6e045bcaaf42841aedc514e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=p0V09wZX0IJ6quqAFm6FSpTmqOo%3D" alt="iShot_2026-01-04_22.28.48" loading="lazy"/></a></p>
<h3 data-id="heading-1">戴着镣铐跳舞：mHC的优雅解法</h3>
<p>DeepSeek提出的mHC（流形约束超连接），本质上就是给那个混乱的超级广场装上了一套极其精密的“智能红绿灯系统”。</p>
<p>这里的核心魔法在于**“流形约束”**。</p>
<p>团队引入了数学上的“双随机矩阵”概念。简单来说，他们通过一个叫Sinkhorn-Knopp的经典算法，强制要求网络中的每一次信息交换都必须遵守一个规则：<strong>能量守恒</strong>。不管信息怎么变道、怎么混合，进去多少能量，出来还是多少能量。</p>
<p>这种做法把原本狂野的信号放大变成了信号的“凸组合”（Convex Combination）。这就像调鸡尾酒，不管你怎么摇晃混合，酒的总量不会凭空变多，也不会凭空消失。</p>
<p>这一改，奇迹发生了。</p>
<p>原本可能放大3000倍的信号，现在被稳稳控制在1.6倍左右。那条原本还要靠运气才能跑通的训练曲线，瞬间变得丝般顺滑。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.28.54-1024x178.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.28.54-1024x178.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/598287a8b2d54729b2e5e0817677d307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=UbxfNoC%2Bcbylfo3hGqPhAe0e7Yc%3D" alt="iShot_2026-01-04_22.28.54" loading="lazy"/></a></p>
<h3 data-id="heading-2">极其抠门的工程优化</h3>
<p>光有数学理论没用，如果跑得慢，工业界根本不会看一眼。DeepSeek这帮人最可怕的地方在于，他们不仅懂数学，还极其擅长抠算力。</p>
<p>为了把这个复杂的数学约束搬到GPU上跑，他们做了一系列“丧心病狂”的优化：</p>
<ol>
<li><strong>算子融合</strong>：把好几个计算步骤揉成一步做，减少GPU读取内存的次数。</li>
<li><strong>选择性重计算</strong>：为了省显存，有些中间结果算完就扔，需要时再算，而且他们算准了哪些该扔、哪些该留。</li>
</ol>
<p>结果如何？在把模型宽度扩展4倍的情况下，mHC架构只增加了**6.7%**的额外训练时间。这就好比你给法拉利换了个更稳的引擎，极速没掉，油耗也没怎么涨。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.29.00-1024x397.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.29.00-1024x397.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75bfe28a0c53414fa8f45a6f237f64a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=yzE3zgZU35BnV22%2BEdtxftNTbdA%3D" alt="iShot_2026-01-04_22.29.00" loading="lazy"/></a></p>
<h3 data-id="heading-3">实战：27B模型的全面碾压</h3>
<p>DeepSeek没在小模型上玩过家家，直接拿27B参数的模型开刀。</p>
<p>实验结果非常“凡尔赛”：</p>
<ul>
<li><strong>稳</strong>：那些让工程师头秃的Loss尖峰完全消失。</li>
<li><strong>强</strong>：在数学推理（GSM8K）、常识问答（BBH）等8项硬核测试中，全面吊打基线模型。特别是在需要绕弯子思考的BBH和DROP任务上，直接提升了约2%的性能。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-04_22.29.07-1024x320.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-04_22.29.07-1024x320.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2678e783ca2b43718b3da5c98062d442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768142405&amp;x-signature=mlH9v0DiPi5m2JO8RmXVhkDBobA%3D" alt="iShot_2026-01-04_22.29.07" loading="lazy"/></a></p>
<h3 data-id="heading-4">为什么这很重要？</h3>
<p>你可能会觉得，这不就是一个架构微调吗？</p>
<p>其实不然。mHC的出现标志着大模型设计的一个转折点。它告诉我们，单纯地堆参数、堆层数已经快走到头了。未来的方向，是研究层与层之间如何更“几何”地连接。</p>
<p>DeepSeek用mHC证明了：在这个算力昂贵的时代，<strong>数学上的严谨约束，反而是通向更大自由度的捷径。</strong></p>
<p>这不仅仅是让大厂能更稳地训练万亿模型，也让资源有限的团队不再因为一次“炸炉”而倾家荡产。这就是技术的浪漫之处——用最抽象的数学，解决最现实的难题。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI 从 0 到 1：史上最良心的现代 Python Web 框架入门指南]]></title>    <link>https://juejin.cn/post/7591309945511149568</link>    <guid>https://juejin.cn/post/7591309945511149568</guid>    <pubDate>2026-01-04T14:47:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511149568" data-draft-id="7591309945511133184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI 从 0 到 1：史上最良心的现代 Python Web 框架入门指南"/> <meta itemprop="keywords" content="FastAPI"/> <meta itemprop="datePublished" content="2026-01-04T14:47:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI 从 0 到 1：史上最良心的现代 Python Web 框架入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:47:04.000Z" title="Sun Jan 04 2026 14:47:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>标签：<br/>
FastAPI · Python · 异步 · 类型提示 · 自动生成文档 · 高性能</p>
<hr/>
<h2 data-id="heading-0">一、为什么又是新框架？</h2>
<p>Django / Flask 已经够好了，但新时代有了新痛点：</p>
<ol>
<li>前后端分离 → 需要<strong>强制类型 &amp; 自动文档</strong></li>
<li>高并发 IO → 需要<strong>原生异步</strong></li>
<li>机器学习模型上线 → 需要<strong>高性能 + 自动序列化</strong></li>
</ol>
<p>FastAPI = Starlette（异步）+ Pydantic（数据校验）+ 自动生成 OpenAPI 文档，三箭齐发，官方 benchmark  latency 直追 NodeJS 和 Go。</p>
<hr/>
<h2 data-id="heading-1">二、5 分钟跑通 Hello World</h2>
<p>安装</p>
<pre><code class="hljs language-bash" lang="bash">pip install <span class="hljs-string">"fastapi[all]"</span>   <span class="hljs-comment"># all = uvicorn + 常用 extras</span>
</code></pre>
<p>main.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI(title=<span class="hljs-string">"Hello API"</span>)

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"Hello FastAPI"</span>}
</code></pre>
<p>启动</p>
<pre><code class="hljs language-bash" lang="bash">uvicorn main:app --reload
</code></pre>
<p>浏览器访问 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000" target="_blank" title="http://127.0.0.1:8000" ref="nofollow noopener noreferrer">http://127.0.0.1:8000</a><br/>
交互式文档 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000%2Fdocs" target="_blank" title="http://127.0.0.1:8000/docs" ref="nofollow noopener noreferrer">http://127.0.0.1:8000/docs</a>（Swagger UI）自动生成！</p>
<hr/>
<h2 data-id="heading-2">三、类型提示 = 自动生成文档 + 运行时校验</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>
    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/items/"</span>, response_model=Item</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):
    <span class="hljs-keyword">if</span> item.tax:
        item.price += item.tax
    <span class="hljs-keyword">return</span> item    <span class="hljs-comment"># 自动序列化 JSON</span>
</code></pre>
<ul>
<li>请求体少字段 → 422 错误 + 详细位置提示</li>
<li>文档里 Schema 与代码<strong>单点真理</strong>，永不同步失败</li>
</ul>
<hr/>
<h2 data-id="heading-3">四、异步全程高能</h2>
<p>FastAPI 默认基于 <code>async def</code>，与 <code>asyncio</code>、<code>aiohttp</code>、<code>aiomysql</code> 全家桶无缝协作：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> ClientSession

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/proxy"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">proxy</span>():
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> ClientSession() <span class="hljs-keyword">as</span> sess:
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> sess.get(<span class="hljs-string">"https://httpbin.org/delay/2"</span>) <span class="hljs-keyword">as</span> r:
            data = <span class="hljs-keyword">await</span> r.json()
    <span class="hljs-keyword">return</span> data
</code></pre>
<p>单进程可并发 1000+ 慢 IO 请求，latency 远低于同步框架。</p>
<hr/>
<h2 data-id="heading-4">五、路径参数 &amp; 查询参数一把梭</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/user/{user_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, q: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"user_id"</span>: user_id, <span class="hljs-string">"q"</span>: q, <span class="hljs-string">"limit"</span>: limit}
</code></pre>
<ul>
<li><code>user_id</code> 自动校验 int → 非法返回 422</li>
<li><code>q</code> 可选，缺省 None</li>
<li>文档实时体现参数类型、默认值</li>
</ul>
<hr/>
<h2 data-id="heading-5">六、依赖注入 —— 像 Spring 一样优雅</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, HTTPException, status
<span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_user</span>(<span class="hljs-params">token: HTTPAuthorizationCredentials = Depends(<span class="hljs-params">security</span>)</span>):
    <span class="hljs-keyword">if</span> token.credentials != <span class="hljs-string">"fake-token"</span>:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=status.HTTP_401_UNAUTHORIZED,
                            detail=<span class="hljs-string">"Invalid token"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"uid"</span>: <span class="hljs-number">42</span>}

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/secure"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">secure_endpoint</span>(<span class="hljs-params">user=Depends(<span class="hljs-params">get_current_user</span>)</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"secret data"</span>, <span class="hljs-string">"user"</span>: user}
</code></pre>
<p>依赖可嵌套、可复用，单元测试时直接 mock 依赖即可。</p>
<hr/>
<h2 data-id="heading-6">七、上线必备：CORS / 静态文件 / 异常处理</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-keyword">from</span> fastapi.staticfiles <span class="hljs-keyword">import</span> StaticFiles
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse

app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],
    allow_methods=[<span class="hljs-string">"*"</span>],
    allow_headers=[<span class="hljs-string">"*"</span>],
)

app.mount(<span class="hljs-string">"/static"</span>, StaticFiles(directory=<span class="hljs-string">"static"</span>), name=<span class="hljs-string">"static"</span>)

<span class="hljs-meta">@app.exception_handler(<span class="hljs-params">ValueError</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">value_error_handler</span>(<span class="hljs-params">request, exc</span>):
    <span class="hljs-keyword">return</span> JSONResponse(status_code=<span class="hljs-number">400</span>,
                        content={<span class="hljs-string">"detail"</span>: <span class="hljs-built_in">str</span>(exc)})
</code></pre>
<p>全同步/异步混合写皆可，保持代码风格一致。</p>
<hr/>
<h2 data-id="heading-7">八、与 SQL 数据库联动 —— 异步 ORM 示例</h2>
<pre><code class="hljs language-bash" lang="bash">pip install databases[aiosqlite] sqlalchemy
</code></pre>
<p>database.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> databases <span class="hljs-keyword">import</span> Database
database = Database(<span class="hljs-string">"sqlite+aiosqlite:///./demo.db"</span>)
</code></pre>
<p>model.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlalchemy
metadata = sqlalchemy.MetaData()
notes = sqlalchemy.Table(
    <span class="hljs-string">"notes"</span>,
    metadata,
    sqlalchemy.Column(<span class="hljs-string">"id"</span>, sqlalchemy.Integer, primary_key=<span class="hljs-literal">True</span>),
    sqlalchemy.Column(<span class="hljs-string">"text"</span>, sqlalchemy.String),
    sqlalchemy.Column(<span class="hljs-string">"completed"</span>, sqlalchemy.Boolean),
)
</code></pre>
<p>main.py 节选</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup</span>():
    <span class="hljs-keyword">await</span> database.connect()

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"shutdown"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown</span>():
    <span class="hljs-keyword">await</span> database.disconnect()

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/notes/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_note</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):
    query = notes.insert().values(text=text, completed=<span class="hljs-literal">False</span>)
    last_record_id = <span class="hljs-keyword">await</span> database.execute(query)
    <span class="hljs-keyword">return</span> {**<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">id</span>=last_record_id, text=text, completed=<span class="hljs-literal">False</span>)}
</code></pre>
<p>全程 <code>async</code>，吞吐量比同步 SQL 提高一个量级。</p>
<hr/>
<h2 data-id="heading-8">九、性能 &amp; 生态</h2>
<ul>
<li><strong>Starlette</strong> 打底：支持 HTTP/2、WebSocket、GraphQL</li>
<li><strong>Pydantic</strong> 加持：校验速度是传统 schema 库的 2~4 倍</li>
<li><strong>Uvicorn + Gunicorn</strong> 多 worker 部署，8 核轻松破 10k RPS</li>
<li>官方 benchmark：FastAPI  latency 与 Starlette/Go Echo 同级，<strong>比 Flask 快 3~5 倍</strong></li>
</ul>
<hr/>
<h2 data-id="heading-9">十、部署一条命令</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地开发</span>
uvicorn main:app --reload

<span class="hljs-comment"># 生产多核</span>
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --<span class="hljs-built_in">bind</span> 0.0.0.0:8000
</code></pre>
<p>Dockerfile 示例</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
</code></pre>
<p>镜像 &lt;100 MB，K8s/Serverless 随意扩。</p>
<hr/>
<h2 data-id="heading-10">十一、总结：一张图记住 FastAPI</h2>
<pre><code class="hljs language-lua" lang="lua">┌<span class="hljs-comment">-------------┐        ┌------------┐</span>
│ Pydantic    │ &lt;<span class="hljs-comment">-----&gt;│ 请求/响应   │  &lt;-- 自动校验+序列化</span>
│ 数据模型     │        │ 类型提示    │
└<span class="hljs-comment">-------------┘        └------------┘</span>
        ^                       |
        |                       v
┌<span class="hljs-comment">-------------┐        ┌------------┐</span>
│ 依赖注入     │        │ OpenAPI    │  &lt;<span class="hljs-comment">-- 自动生成 docs</span>
│ 安全/DB/逻辑 │        │ 文档/redoc │
└<span class="hljs-comment">-------------┘        └------------┘</span>
        ^                       |
        |                       v
┌<span class="hljs-comment">-------------------------------┐</span>
│ Starlette（ASGI）异步核心      │  &lt;<span class="hljs-comment">-- 高性能</span>
└<span class="hljs-comment">-------------------------------┘</span>
</code></pre>
<p>FastAPI = <strong>类型提示 + 异步 + 自动生成文档</strong> 三箭齐发，<br/>
写更少代码，跑更快服务，出更全文档。2024 年了，如果你还在手写 Swagger JSON，不妨给 FastAPI 一个周末，它会还你整个生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我为自己起了个笔名]]></title>    <link>https://juejin.cn/post/7591338980693770286</link>    <guid>https://juejin.cn/post/7591338980693770286</guid>    <pubDate>2026-01-04T13:05:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591338980693770286" data-draft-id="7591346773827797018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我为自己起了个笔名"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-04T13:05:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏渡苇"/> <meta itemprop="url" content="https://juejin.cn/user/729731453429159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我为自己起了个笔名
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/729731453429159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏渡苇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:05:49.000Z" title="Sun Jan 04 2026 13:05:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我决定把所有平台的网名改成笔名“苏渡苇”。</p>
<p>其实改这个名字，是因为翻古文观止又翻到了苏轼的《赤壁赋》。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7f1107c9509460d865a6c230fce1678~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5rih6IuH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768136749&amp;x-signature=x2bHirx14UVSDZ9PEJjco6dxvoo%3D" alt="古文观止 苏轼·前赤壁赋" loading="lazy"/></p>
<p>古文观止 苏轼·前赤壁赋</p>
<p>读到“纵一苇之所如，凌万顷之茫然”那句时，我似乎正在发呆。窗外是城市零星的光，不是苏轼渡的江，但心里的茫然是真的。那一瞬间，我好像看见了九百多年“一蓑烟雨任平生”的苏轼——他总是那样乐观，纵使困顿难行，依然发现自己竟可以像一片苇叶那样，托付给江水和月光。</p>
<p>这种接纳破碎、并从中发现自由的姿态，便是我心中的苏轼最深的浪漫。它不是风花雪月，而是一种巨大的诚实。他诚实地面对自己的狼狈，也诚实地发现了天地间还有清风明月不需要用功名去换。</p>
<p>所以，“苏渡苇”这三个字，对我而言就是一种朴素的提醒。它不意味着我能立刻拥有他的旷达，而是说，当我感到自己往下沉的时候，至少可以想起，曾经有人这样处理眼前的狼藉：当路走到头，就在旁边坐下，看看此处的风景有什么别致；当事与愿违，就把“违”的部分，也接进生命里来。</p>
<p>我不奢求一个名字就可以渡什么万顷茫然，能渡得了生活里一些具体的、琐碎的沮丧，就够了。它像放在书桌角落的一根真正的芦苇，干燥，轻盈，提醒我另一种可能的存在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[利用元旦假期，我开源了一个大模型智能面试平台+知识库！]]></title>    <link>https://juejin.cn/post/7591349113355698185</link>    <guid>https://juejin.cn/post/7591349113355698185</guid>    <pubDate>2026-01-04T13:19:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591349113355698185" data-draft-id="7591360623469461514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="利用元旦假期，我开源了一个大模型智能面试平台+知识库！"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2026-01-04T13:19:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaGuide"/> <meta itemprop="url" content="https://juejin.cn/user/166781497383294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            利用元旦假期，我开源了一个大模型智能面试平台+知识库！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781497383294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaGuide
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:19:10.000Z" title="Sun Jan 04 2026 13:19:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是 Guide。利用元旦假期，我开源了一个基于 Spring Boot 4.0 + Java 21 + Spring AI + PostgreSQL + pgvector + RustFS + Redis 的大模型项目，实现了简历智能分析、AI 模拟面试、知识库 RAG 检索等核心功能。</p>
<h2 data-id="heading-0">项目介绍</h2>
<p>InterviewGuide 是一个集成了简历分析、模拟面试和知识库管理的智能面试辅助平台。系统利用大语言模型（LLM）和向量数据库技术，为求职者和 HR 提供智能化的简历评估和面试练习服务。</p>
<ul>
<li>Github 地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSnailclimb%2Finterview-guide" target="_blank" title="https://github.com/Snailclimb/interview-guide" ref="nofollow noopener noreferrer">github.com/Snailclimb/…</a></strong></li>
<li>Gitee 地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FSnailClimb%2Finterview-guide" target="_blank" title="https://gitee.com/SnailClimb/interview-guide" ref="nofollow noopener noreferrer">gitee.com/SnailClimb/…</a></strong></li>
</ul>
<h2 data-id="heading-1">系统架构</h2>
<p><strong>提示</strong>：架构图采用 draw.io 绘制，导出为 svg 格式，在 Github Dark 模式下的显示效果会有问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/217805d2f0e2460caddd91e56bbb82b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=xX%2Bz%2FBpdG4i8LkT5Ls0neF9eEZI%3D" alt="" loading="lazy"/></p>
<p><strong>异步处理流程</strong>：</p>
<p>简历分析和知识库向量化采用 Redis Stream 异步处理：</p>
<pre><code class="hljs language-arduino" lang="arduino">上传请求 → 保存文件 → 发送消息到 <span class="hljs-built_in">Stream</span> → 立即返回
                              ↓
                      Consumer 消费消息
                              ↓
                    执行分析/向量化任务
                              ↓
                      更新数据库状态
                              ↓
                   前端轮询获取最新状态
</code></pre>
<p>状态流转： <code>PENDING</code> → <code>PROCESSING</code> → <code>COMPLETED</code> / <code>FAILED</code></p>
<h2 data-id="heading-2">技术栈</h2>
<h3 data-id="heading-3">后端技术</h3>























































<table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>Spring Boot</td><td>4.0</td><td>应用框架</td></tr><tr><td>Java</td><td>21</td><td>开发语言</td></tr><tr><td>Spring AI</td><td>2.0</td><td>AI 集成框架</td></tr><tr><td>PostgreSQL + pgvector</td><td>14+</td><td>关系数据库 + 向量存储</td></tr><tr><td>Redis</td><td>6+</td><td>缓存 + 消息队列（Stream）</td></tr><tr><td>Apache Tika</td><td>2.9.2</td><td>文档解析</td></tr><tr><td>iText 8</td><td>8.0.5</td><td>PDF 导出</td></tr><tr><td>MapStruct</td><td>1.6.3</td><td>对象映射</td></tr><tr><td>Gradle</td><td>8.14</td><td>构建工具</td></tr></tbody></table>
<p>技术选型常见问题解答：</p>
<ol start="0">
<li>
<p>数据存储为什么选择 PostgreSQL + pgvector？PG 的向量数据存储功能够用了，精简架构，不想引入太多组件。</p>
</li>
<li>
<p>为什么引入 Redis？</p>
<ul>
<li>Redis 替代 <code>ConcurrentHashMap</code> 实现面试会话的缓存。</li>
<li>基于 Redis Stream 实现简历分析、知识库向量化等场景的异步（还能解耦，分析和向量化可以使用其他编程语言来做）。不使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fhigh-performance%2Fmessage-queue%2Fkafka-questions-01.html" target="_blank" title="https://javaguide.cn/high-performance/message-queue/kafka-questions-01.html" ref="nofollow noopener noreferrer">Kafka</a> 这类成熟的消息队列，也是不想引入太多组件。</li>
</ul>
</li>
<li>
<p>构建工具为什么选择 Gradle？个人更喜欢用 Gradle，也写过相关的文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Ftools%2Fgradle%2Fgradle-core-concepts.html" target="_blank" title="https://javaguide.cn/tools/gradle/gradle-core-concepts.html" ref="nofollow noopener noreferrer">Gradle核心概念总结</a>。</p>
</li>
</ol>
<h3 data-id="heading-4">前端技术</h3>


















































<table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td>React</td><td>18.3</td><td>UI 框架</td></tr><tr><td>TypeScript</td><td>5.6</td><td>开发语言</td></tr><tr><td>Vite</td><td>5.4</td><td>构建工具</td></tr><tr><td>Tailwind CSS</td><td>4.1</td><td>样式框架</td></tr><tr><td>React Router</td><td>7.11</td><td>路由管理</td></tr><tr><td>Framer Motion</td><td>12.23</td><td>动画库</td></tr><tr><td>Recharts</td><td>3.6</td><td>图表库</td></tr><tr><td>Lucide React</td><td>-</td><td>图标库</td></tr></tbody></table>
<h2 data-id="heading-5">功能特性</h2>
<h3 data-id="heading-6">简历管理模块</h3>
<ul>
<li>多格式支持：PDF、DOCX、DOC、TXT</li>
<li>异步分析：上传后立即返回，后台 Redis Stream 处理</li>
<li>状态轮询：实时显示分析进度（待分析/分析中/已完成/失败）</li>
<li>自动重试：分析失败自动重试（最多 3 次）</li>
<li>简历去重：基于内容哈希检测重复</li>
<li>PDF 报告导出</li>
</ul>
<h3 data-id="heading-7">模拟面试模块</h3>
<ul>
<li>基于简历生成个性化面试问题</li>
<li>实时问答交互</li>
<li>多维度评分（技术能力、沟通能力等）</li>
<li>面试报告生成和导出</li>
<li>雷达图可视化展示</li>
<li>面试历史统计</li>
</ul>
<h3 data-id="heading-8">知识库管理模块</h3>
<ul>
<li>多格式支持：PDF、DOCX、DOC、TXT、Markdown</li>
<li>文档上传和自动分块</li>
<li>异步向量化处理</li>
<li>RAG 检索增强生成</li>
<li>流式响应（SSE）</li>
<li>智能问答对话</li>
<li>知识库统计信息</li>
</ul>
<h3 data-id="heading-9">TODO</h3>
<ul>
<li>问答助手的 Markdown 展示优化</li>
<li>知识库管理页面的下载</li>
<li>异步生成模拟面试评估报告</li>
<li>模拟面试增加追问功能</li>
<li>打通模拟面试和知识库</li>
</ul>
<h2 data-id="heading-10">效果展示</h2>
<h3 data-id="heading-11">简历与面试</h3>
<p>简历库：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dc7cc8ff470499e958982ed95123f0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=MSXt9QljlslJXaNu%2F14tfqx%2FFmg%3D" alt="" loading="lazy"/></p>
<p>简历上传分析：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14ca9132ed334766b8f53ef0e7dd2e1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=UPE2NKVnqMjAcB5%2Bn1hDzpd2XD8%3D" alt="" loading="lazy"/></p>
<p>简历分析详情：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef468ba8ee6a45639526a4eb6a6fb96d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=vgGh%2BpL1lWgIeguPzHLuvWlYEGY%3D" alt="" loading="lazy"/></p>
<p>面试记录：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/943552cd935c4c01acf8217ede855d33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=RMqQfl%2BlKwv8LVPubOjGkKkRpR4%3D" alt="" loading="lazy"/></p>
<p>面试详情：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e6c919cf693432aa1284949a8e1bda7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=%2Fdakm2zT22X2IgtrdiB80NoYANY%3D" alt="" loading="lazy"/></p>
<p>模拟面试：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f141295e5634b689f049884f6bfef42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=FBwEJfcLrq1ocHXQzWI9nABkvtg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">知识库</h3>
<p>知识库管理：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/305f368e4399439ea56b61ef8f76513a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=mQZY6JVN33xFO4ebhWmbVP5RhWM%3D" alt="" loading="lazy"/></p>
<p>问答助手：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/052629e6935f4f18b01d162ef594bdd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768137550&amp;x-signature=OvdleNm%2BXgj8FNZSiiOlyUHZKkI%3D" alt="page-qa-assistant" loading="lazy"/></p>
<h2 data-id="heading-13">项目结构</h2>
<pre><code class="hljs language-bash" lang="bash">interview-guide/
├── app/                              <span class="hljs-comment"># 后端应用</span>
│   ├── src/main/java/interview/guide/
│   │   ├── App.java                  <span class="hljs-comment"># 主启动类</span>
│   │   ├── common/                   <span class="hljs-comment"># 通用模块</span>
│   │   │   ├── config/               <span class="hljs-comment"># 配置类</span>
│   │   │   ├── exception/            <span class="hljs-comment"># 异常处理</span>
│   │   │   └── result/               <span class="hljs-comment"># 统一响应</span>
│   │   ├── infrastructure/           <span class="hljs-comment"># 基础设施</span>
│   │   │   ├── <span class="hljs-built_in">export</span>/               <span class="hljs-comment"># PDF 导出</span>
│   │   │   ├── file/                 <span class="hljs-comment"># 文件处理</span>
│   │   │   ├── redis/                <span class="hljs-comment"># Redis 服务</span>
│   │   │   └── storage/              <span class="hljs-comment"># 对象存储</span>
│   │   └── modules/                  <span class="hljs-comment"># 业务模块</span>
│   │       ├── interview/            <span class="hljs-comment"># 面试模块</span>
│   │       ├── knowledgebase/        <span class="hljs-comment"># 知识库模块</span>
│   │       └── resume/               <span class="hljs-comment"># 简历模块</span>
│   └── src/main/resources/
│       ├── application.yml           <span class="hljs-comment"># 应用配置</span>
│       └── prompts/                  <span class="hljs-comment"># AI 提示词模板</span>
│
├── frontend/                         <span class="hljs-comment"># 前端应用</span>
│   ├── src/
│   │   ├── api/                      <span class="hljs-comment"># API 接口</span>
│   │   ├── components/               <span class="hljs-comment"># 公共组件</span>
│   │   ├── pages/                    <span class="hljs-comment"># 页面组件</span>
│   │   ├── types/                    <span class="hljs-comment"># 类型定义</span>
│   │   └── utils/                    <span class="hljs-comment"># 工具函数</span>
│   ├── package.json
│   └── vite.config.ts
│
└── README.md
</code></pre>
<h2 data-id="heading-14">快速开始</h2>
<p>环境要求：</p>








































<table><thead><tr><th>依赖</th><th>版本</th><th>必需</th></tr></thead><tbody><tr><td>JDK</td><td>21+</td><td>是</td></tr><tr><td>Node.js</td><td>18+</td><td>是</td></tr><tr><td>PostgreSQL</td><td>14+</td><td>是</td></tr><tr><td>pgvector 扩展</td><td>-</td><td>是</td></tr><tr><td>Redis</td><td>6+</td><td>是</td></tr><tr><td>S3 兼容存储</td><td>-</td><td>是</td></tr></tbody></table>
<h3 data-id="heading-15">1. 克隆项目</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/Snailclimb/interview-guide.git
<span class="hljs-built_in">cd</span> interview-guide
</code></pre>
<h3 data-id="heading-16">2. 配置数据库</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建数据库</span>
<span class="hljs-keyword">CREATE</span> DATABASE interview_guide;
​
<span class="hljs-comment">-- 连接数据库并启用 pgvector 扩展（可选，启动后端SpringAI框架底层会自动创建）</span>
<span class="hljs-keyword">CREATE</span> EXTENSION vector;
</code></pre>
<h3 data-id="heading-17">3. 配置环境变量</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># AI API 密钥（阿里云 DashScope）</span>
export <span class="hljs-attr">AI_BAILIAN_API_KEY</span>=your_api_key
</code></pre>
<h3 data-id="heading-18">4. 修改应用配置</h3>
<p>编辑 <code>app/src/main/resources/application.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># PostgreSQL数据库配置</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:postgresql://localhost:5432/interview_guide</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">your_username</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your_password</span>
<span class="hljs-string">​</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
<span class="hljs-string">​</span>
<span class="hljs-comment"># RustFS (S3兼容) 存储配置</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">storage:</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://localhost:9000</span>
    <span class="hljs-attr">access-key:</span> <span class="hljs-string">your_access_key</span>
    <span class="hljs-attr">secret-key:</span> <span class="hljs-string">your_secret_key</span>
    <span class="hljs-attr">bucket:</span> <span class="hljs-string">interview-guide</span>
    
 <span class="hljs-comment"># Redisson配置</span>
<span class="hljs-attr">redisson:</span>
  <span class="hljs-attr">config:</span> <span class="hljs-string">|
    singleServerConfig:
      address: "redis://localhost:6379"
      database: 0
      idleConnectionTimeout: 10000
      connectTimeout: 10000
      timeout: 3000
      retryAttempts: 3
      retryInterval: 1500
      password: null
      subscriptionsPerConnection: 5
      clientName: null
      subscriptionConnectionMinimumIdleSize: 1
      subscriptionConnectionPoolSize: 50
      connectionMinimumIdleSize: 10
      connectionPoolSize: 64
      dnsMonitoringInterval: 5000
</span><span class="hljs-string">​</span>
</code></pre>
<h3 data-id="heading-19">5. 启动服务</h3>
<p><strong>后端：</strong></p>
<pre><code class="hljs language-bash" lang="bash">./gradlew bootRun
</code></pre>
<p>后端服务启动于 <code>http://localhost:8080</code></p>
<p><strong>前端：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> frontend
pnpm install
pnpm dev
</code></pre>
<p>前端服务启动于 <code>http://localhost:5173</code></p>
<h2 data-id="heading-20">使用场景</h2>





















<table><thead><tr><th>用户角色</th><th>使用场景</th></tr></thead><tbody><tr><td><strong>求职者</strong></td><td>上传简历获取分析建议，进行模拟面试练习</td></tr><tr><td><strong>HR/招聘人员</strong></td><td>批量分析简历，评估候选人能力</td></tr><tr><td><strong>培训机构</strong></td><td>提供面试培训服务，管理知识库资源</td></tr></tbody></table>
<h2 data-id="heading-21">常见问题</h2>
<h3 data-id="heading-22">Q: 简历分析失败</h3>
<p>检查一下阿里云 DashScope API KEY 是否配置正确（申请地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F" target="_blank" title="https://bailian.console.aliyun.com/" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/</a>）。</p>
<h3 data-id="heading-23">Q: 简历分析一直显示"分析中"？</h3>
<p>检查 Redis 连接和 Stream Consumer 是否正常运行。查看后端日志确认是否有错误。</p>
<h3 data-id="heading-24">Q: 知识库问答没有响应？</h3>
<p>确认知识库已完成向量化（状态为 COMPLETED），检查 pgvector 扩展是否正确安装。</p>
<h3 data-id="heading-25">Q: PDF 导出失败？</h3>
<p>检查 iText 依赖是否正确，确认字体文件存在。</p>
<h2 data-id="heading-26">分支说明</h2>

















<table><thead><tr><th>分支</th><th>说明</th></tr></thead><tbody><tr><td><code>master</code></td><td>主分支，包含完整功能（Redis Stream 异步处理）</td></tr><tr><td><code>v1.0-without-redis</code></td><td>基础版本，同步处理，无 Redis 依赖</td></tr></tbody></table>
<h2 data-id="heading-27">贡献</h2>
<p>欢迎提交 Issue 和 Pull Request！</p>
<h2 data-id="heading-28">许可证</h2>
<p>AGPL-3.0 License（只要通过网络提供服务，就必须向用户公开修改后的源码）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 基础：状态管理入门]]></title>    <link>https://juejin.cn/post/7591318630694551606</link>    <guid>https://juejin.cn/post/7591318630694551606</guid>    <pubDate>2026-01-04T13:40:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591318630694551606" data-draft-id="7591317772074483731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 基础：状态管理入门"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-04T13:40:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桜吹雪"/> <meta itemprop="url" content="https://juejin.cn/user/1179091901098269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 基础：状态管理入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1179091901098269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桜吹雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:40:11.000Z" title="Sun Jan 04 2026 13:40:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.telerik.com%2Fblogs%2Fvue-basics-state-management-vue%23state-at-scale-with-pinia" target="_blank" title="https://www.telerik.com/blogs/vue-basics-state-management-vue#state-at-scale-with-pinia" ref="nofollow noopener noreferrer">Vue Basics: State Management in Vue</a></p>
</blockquote>
<p>学习如何随着应用规模的扩大，利用 ref/reactive、props/emits、provide/inject 和 Pinia 来扩展 Vue 的状态管理。</p>
<p>在使用 Vue 构建任何交互式应用时，“状态”是你最先接触到的核心概念之一。无论是表单中的文本、购物车里的商品，还是已登录用户的个人资料，正确地管理这些状态对于保持应用的稳定性、响应性以及易扩展性都至关重要。</p>
<p>Vue 3 引入了组合式 API 以及全新的响应式系统，为开发者提供了前所未有的强大且灵活的状态管理方式。在本指南中，我们将探讨 Vue 3 如何处理状态——从使用 <code>ref</code> 和 <code>reactive</code> 管理局部状态开始，到通过 <code>props</code> 和 <code>provide</code>/<code>inject</code> 共享数据，最后进阶到 Vue 的官方状态管理库 Pinia。读完本文，你将获得一份清晰的路线图，能够根据应用的具体需求选择最合适的工具。</p>
<h2 data-id="heading-0">理解 Vue 中的状态管理概念</h2>
<p>状态是每一个交互式 Vue 应用的核心。正是它让你的 UI 变得动态——只要更新状态，Vue 就会自动将这些变化反映在 DOM 中。</p>
<p>广义上讲，状态分为两种类型：</p>
<ul>
<li>局部状态： 存在于单个组件内部（例如：计数器组件中的 count 变量）。</li>
<li>全局状态： 在多个组件或应用的不同部分之间共享（例如：用户登录认证状态）。</li>
</ul>
<p>默认情况下，每个 Vue 组件都维护着自己的响应式状态，我们通常称之为局部状态。在探索如何在组件间共享状态以及最终使用 Pinia 进行全局管理之前，让我们先从这里入手。</p>
<h2 data-id="heading-1">使用 ref 和 reactive 管理局部状态</h2>
<p>为了管理局部响应式状态，Vue 3 的组合式 API 提供了两个主要工具：<code>ref</code> 和 <code>reactive</code>。如果你刚接触 Vue，可能会对选择哪一个感到困惑——因此，让我们基于对局部状态的理解，来详细拆解这两个工具。</p>
<h3 data-id="heading-2">使用 ref</h3>
<p>当处理原始值（数字、字符串、布尔值）时，请使用 ref。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref } from 'vue'

//state
const count = ref(0)

//actions
function increment() {
  count.value++
}
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="increment"&gt;Count is: {{ count }}&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p>在这里，<code>count</code> 被封装在一个 <code>ref</code> 中，并通过 <code>.value</code> 来访问其值。</p>
<h3 data-id="heading-3">使用 reactive</h3>
<p>当处理对象或数组时，请使用 <code>reactive</code>。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { reactive } from 'vue'

const user = reactive({
  name: ' ',
  age: 25
})
&lt;/script&gt;

&lt;template&gt;
  &lt;input v-model="user.name" placeholder="Enter your name" /&gt;
  &lt;p&gt;{{ user.name }} is {{ user.age }} years old.&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<p>在底层，Vue 将对象封装在一个 Proxy 中，因此它可以自动追踪变化并更新 DOM。</p>
<p>局部状态是 Vue 单向数据流最简单的例子：状态驱动 UI。但一旦多个组件需要共享同一份状态，仅靠局部管理就会变得困难，这时我们就需要超越局部状态了。</p>
<h2 data-id="heading-4">在组件间共享状态</h2>
<p>局部状态对于单个组件来说运作良好，但如果多个组件需要相同的数据该怎么办？Vue 提供了几种共享状态的方式：props/emits 和 provide/inject。</p>
<h3 data-id="heading-5">Props 和 Emits</h3>
<p>Props 允许父组件向下传递状态，而 emits 允许子组件向上发送事件。</p>
<p>让我们看看下面这个简单的演示：</p>
<h4 data-id="heading-6">父组件</h4>
<p>你可以通过 props 将数据从父组件传递给子组件。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Parent.vue --&gt;
&lt;template&gt;
  &lt;Child :count="count" @increment="count++" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import Child from './Child.vue'

const count = ref(0)
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-7">子组件</h4>
<p>当子组件需要更新父组件的状态时，它可以触发（emit）一个事件。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Child.vue --&gt;
&lt;template&gt;
  &lt;button @click="$emit('increment')"&gt;Clicked&lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps(['count'])
defineEmits(['increment'])
&lt;/script&gt;
</code></pre>
<p>这种方法对于小型应用来说效果很好，但如果你有深层嵌套的组件，到处传递 props 和 emits 很快就会变得混乱，从而导致所谓的“<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fcomponents%2Fprovide-inject.html%23prop-drilling" target="_blank" title="https://vuejs.org/guide/components/provide-inject.html#prop-drilling" ref="nofollow noopener noreferrer">Prop Drilling</a>”（属性逐级透传）问题。为了避免这种情况，Vue 提供了另一种选择：provide/inject。</p>
<h3 data-id="heading-8">Provide/inject：避免 Prop Drilling</h3>
<p>Vue 中的 <code>provide</code>/<code>inject</code> API 使得父组件能够轻松地与子组件共享数据，无论嵌套多深，都无需通过每一个中间层级向下传递 props。</p>
<p>让我们看看下面这个简单的代码演示：</p>
<h4 data-id="heading-9">父组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ParentComponent.vue --&gt;
&lt;script setup&gt;
import { ref, provide } from 'vue'
import ChildComponent from './ChildComponent.vue'

   const count = ref(0)
   provide('count', count)

   const increment = () =&gt; {
      count.value++
  }
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;h2&gt;Parent Count: {{ count }}&lt;/h2&gt;
    &lt;button @click="increment"&gt;Increment&lt;/button&gt;
    &lt;!-- 不通过props传递 --&gt;
    &lt;ChildComponent /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p><code>provide()</code> 函数用于父组件中，使其数据对后代组件可用。它接收两个参数：一个注入键和一个值。这个键可以是字符串或 Symbol，后代组件将使用该键通过 <code>inject()</code> 来访问对应的值。单个组件不限于调用一次；你可以使用不同的键多次调用 <code>provide()</code> 来共享不同的值。</p>
<p><code>provide()</code> 的第二个参数是你想要共享的数据，它可以是任何类型——原始值、对象、函数，甚至是像 ref 或 reactive 这样的响应式状态。当你提供一个响应式值时，Vue 不会传递副本；它会建立一个实时连接，允许使用 <code>inject()</code> 的后代组件自动与提供者保持同步。</p>
<h4 data-id="heading-10">子组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ChildComponent.vue --&gt;
&lt;script setup&gt;
import GrandChildComponent from './GrandChildComponent.vue'
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;h3&gt;I am the Child&lt;/h3&gt;
    &lt;!-- 注意: 不通过props传递 --&gt;
    &lt;GrandChildComponent /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>要注入祖先组件提供的数据，请在 <code>GrandChildComponent.vue</code> 中使用 <code>inject()</code> 函数：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- GrandChildComponent.vue --&gt;
&lt;script setup&gt;
import { inject } from 'vue'
const count = inject('count')
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;Grandchild sees count: {{ count }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>在上面的代码演示中，ParentComponent 提供了响应式的 <code>count</code>，因此 ChildComponent 不需要做任何操作——它只需向下传递插槽/子组件。然后 GrandChildComponent 可以直接注入 <code>count</code>，并对父组件的更新保持响应。</p>
<p>这是如何使用 <code>provide</code>/<code>inject</code> 模式的一个基本演示；不过，如果你想了解更多，这篇文章进行了非常详细的介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.telerik.com%2Fblogs%2Fvue-basics-exploring-vue-provide-inject-pattern" target="_blank" title="https://www.telerik.com/blogs/vue-basics-exploring-vue-provide-inject-pattern" ref="nofollow noopener noreferrer">Vue 基础：探索 Vue 的 Provide/Inject 模式</a>。</p>
<p><code>provide</code>/<code>inject</code> 模式非常适合在中型应用中避免 Prop Drilling。然而，随着应用规模的增长，以这种方式管理依赖关系可能会变得复杂。对于大型且复杂的应用，我们需要一个更具结构化和可扩展性的专门状态管理解决方案，这正是像 Pinia 这样的库大显身手的地方。</p>
<h2 data-id="heading-11">利用 Pinia 应对大规模状态管理</h2>
<p>随着你的应用不断增长，在多个组件之间手动管理状态会很快变得令人头疼。我们之前介绍的模式对于小型项目来说运作良好，但一旦你开始构建大规模的生产级应用，就有许多事情需要考虑：</p>
<ul>
<li>热模块替换 (HMR)</li>
<li>更强的团队协作约定</li>
<li>与 Vue DevTools 的集成，包括时间轴、组件内检查和时光旅行调试 (Time-travel debugging)</li>
<li>服务端渲染 (SSR) 支持</li>
</ul>
<p>你需要一个中央仓库，一个单一的数据源，供多个组件读取和写入，而这正是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">Pinia</a> 登场的地方。</p>
<p>Pinia 是 Vue 3 的官方状态管理库，也是 Vuex 的继任者。它专为处理上述所有场景而设计。它更简单、更直观，并且旨在与组合式 API 无缝配合。</p>
<p>在深入代码演示之前，让我们先明确基础知识。从核心上讲，状态管理关乎你的数据存放在哪里、如何读取以及如何更新。Pinia 用四个概念将这些规范化：</p>
<ul>
<li>State (状态)： 这是你实际的响应式数据。把它看作你应用的单一数据源。例如用户的个人资料详情、购物车中的商品或模态框是否打开。</li>
<li>Store (仓库)： 容纳状态的集中式容器。Store 将数据集中管理，而不是分散在多个组件中，因此任何组件都可以访问和更新它，而无需混乱的 Prop 逐层传递 (Prop Drilling)。</li>
<li>Getters (获取器)： 它们就像 Store 的计算属性。它们允许你派生或转换状态值（例如，计算购物车中商品的成本），而无需在多处重复逻辑。</li>
<li>Actions (动作)： 更新状态的函数。它们就像 Vue 组件中的 methods（方法），是你存放修改逻辑的地方，无论是增加计数器、向列表添加项目还是从 API 获取数据。</li>
</ul>
<p>可以这样理解：</p>
<ul>
<li>State 是你持有的数据</li>
<li>Getters 是你查看数据的方式</li>
<li>Actions 定义数据如何变化</li>
<li>Store 是这一切的栖身之所</li>
</ul>
<p>接下来，让我们演示如何将 Pinia 集成到我们的计数器演示应用中。</p>
<h2 data-id="heading-12">设置 Pinia</h2>
<p>为 Vue 3 单页应用设置 Pinia 非常简单。如果你是使用 Vue CLI 或 create-vue 从头开始创建一个新项目，设置向导甚至会询问你是否要使用 Pinia 作为你的状态管理首选。</p>
<p>要在新项目中手动设置 Pinia——或将其添加到现有应用中——请遵循以下步骤：</p>
<p>首先，使用 <code>npm</code> 或 <code>yarn</code> 安装 Pinia 包：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm install pinia

<span class="hljs-meta"># or</span>

yarn install pinia
</code></pre>
<p>要将 Pinia 注册到你的应用中，请打开挂载应用的入口文件（通常是 <code>main.js</code> 或 <code>main.ts</code>），并在你的 Vue 应用实例上调用 <code>app.use(pinia)</code>：</p>
<p><strong>main.js</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

app.<span class="hljs-title function_">use</span>(pinia)
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p>现在我们可以开始为计数器演示应用创建 Store 了。</p>
<h3 data-id="heading-13">创建 Store</h3>
<p>这是一个简单的计数器 Store，演示了所有四个概念。要创建一个 Store，首先新建一个文件来存放代码。一个好的做法是将这些文件放在专用的 <code>stores</code> 文件夹中，以保持项目井井有条。</p>
<p><strong>CounterStore.js</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {

----

})
</code></pre>
<p>我们要使用 Pinia 的 <code>defineStore</code> 方法来创建 Store。它接受两个主要参数：第一个是 Store 的 <code>id</code>，它在你的应用中必须是唯一的。你可以随意命名，但对于这个例子，<code>counter</code> 是最合适的，因为这正是我们的 Store 所管理的。</p>
<p>第二个参数是一个定义 Store 选项的对象。让我们分解一下可以在其中包含的内容：</p>
<h3 data-id="heading-14">State</h3>
<p>在 Store 中定义的第一个选项是 <code>state</code>。如果你使用过 Vue 的选项式 API (Options API)，这会让你倍感亲切。它只是一个返回对象的函数，该对象包含你的 Store 应管理的所有响应式数据。对于我们的计数器应用演示，我们将向 state 添加 <code>count</code> 属性：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {
  <span class="hljs-comment">// State — 响应式共享数据</span>
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  })
})
</code></pre>
<p>然后我们可以轻松地在 <code>CounterButton.vue</code> 组件中导入这个 Store 并使用 <code>count</code> 状态。</p>
<p><strong>CounterButton.vue</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../stores/CounterStore.js’
const counter = useCounterStore()
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
  &lt;button &gt;
    Clicked {{ counter.count }} times
 &lt;/button&gt;
 
  &lt;/div&gt;
&lt;/template&gt;
</span></code></pre>
<p>在上面的代码示例中，我们导入了 <code>useCounterStore</code> 然后调用了该方法。这将返回我们在前面创建的计数器 Store 的副本。这个 Store 中的状态是全局的，意味着对它所做的任何更新都会自动反映在所有使用该 Store 的组件中。</p>
<h3 data-id="heading-15">Getters</h3>
<p>就像 Vue 的计算属性一样，Pinia Store 允许我们定义 <code>getters</code>。Getter 本质上是一个从 Store 状态派生出来的计算值。当你想要基于现有状态转换、过滤或计算某些内容，而又不想在组件之间重复逻辑时，它们非常有用。例如，我们可以使用 getter 方法计算当前状态的乘积：</p>
<p>更新你的 <code>CounterStore.js</code>，添加以下代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {

  <span class="hljs-comment">// State — 响应式共享数据</span>
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
     <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  })

  <span class="hljs-comment">// Getters — 派生状态</span>
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>
  },

})
</code></pre>
<p>就是这样。现在我们拥有了一个 <code>doubleCount</code> 属性，可以在任何组件中使用。</p>
<p>创建一个 <code>CounterDisplay.vue</code> 组件，使用 <code>doubleCount</code> 属性向用户显示消息。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { useCounterStore } from '../stores/CounterStore.js'
const counter = useCounterStore()
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;Current Count: {{ counter.count }}&lt;/p&gt;
    &lt;p&gt;Double Count: {{ counter.doubleCount }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>Getters 设计为同步的。如果你需要执行异步工作（如获取数据），请改用 Action。</p>
<h3 data-id="heading-16">Actions</h3>
<p>我们可以在 Store 中定义的最后一个选项是 actions。把 actions 想象成 Store 版本的组件方法——它们封装了更改状态或执行任务的逻辑。与仅用于派生和返回数据的 getters 不同，actions 旨在更新状态和处理副作用。</p>
<p>Actions 的一个主要优势是它们可以是异步的，这与 getters 不同。这使得它们非常适合诸如从 API 获取数据、处理表单提交或执行任何在将结果提交回 Store 之前需要时间的操作。例如，这是一个创建逻辑来增加状态 <code>count</code> 或从 API 获取初始 <code>count</code> 数据的好位置。</p>
<p>打开我们的 <code>CounterStore.js</code> 并更新以下代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>,  {

  <span class="hljs-comment">// State — 响应式共享数据</span>
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
     <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  })

  <span class="hljs-comment">// Getters — 派生状态</span>
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>
  },

  <span class="hljs-comment">// Actions — 更新状态的逻辑</span>
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
    },

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchInitialCount</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/count'</span>)
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = data.<span class="hljs-property">value</span>
    }
  }
})
</code></pre>
<p>现在在 <code>CounterButton.vue</code> 组件内部，你可以调用 action 而不是直接修改状态：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { useCounterStore } from '../stores/CounterStore.js’
const counter = useCounterStore()
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="counter.increment"&gt;Increment&lt;/button&gt;
  &lt;button @click="counter.fetchInitialCount"&gt;Load Initial Count&lt;/button&gt;
  &lt;p&gt;Count is: {{ counter.count }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<p>从上面的代码修改可以看出，<code>increment()</code> 是一个直接修改 Store 状态的简单 action，而 <code>fetchInitialCount()</code> 则演示了 action 也可以处理异步任务，如定时器或 API。由于 Pinia Store 是响应式的，一旦 action 更新了状态，所有使用该 Store 的组件将立即反映新值。</p>
<h2 data-id="heading-17">总结</h2>
<p>Vue 中的状态管理不必让人感到不知所措。从小处着手，使用 <code>ref</code> 和 <code>reactive</code> 处理本地状态。当组件需要通信时，<code>props</code> 和 <code>emits</code> 是自然的选择。随着应用增长，<code>provide</code>/<code>inject</code> 有助于减少 Prop 逐层传递并保持条理清晰。</p>
<p>但当你的应用需要一个在许多组件之间共享且一致的状态时，Pinia 便脱颖而出。它提供了一个集中、可扩展的 Store，作为你应用的单一数据源。</p>
<p>知道何时使用每种方法是真正的关键。你不需要从第一天起就使用 Pinia，但随着项目变得越来越复杂，你会感激它的结构和可靠性。掌握了这些选项，你就可以自信地管理状态——无论你是构建一个小挂件还是一个大规模的生产级应用。</p>
<p>如果你想超越基础知识，<a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">官方的 Pinia 文档</a>是最好的下一步。它深入介绍了插件、高级模式、DevTools 集成等内容——所有内容都解释得清晰实用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《10 分钟上手 RabbitMQ：用 Python 写一个“不丢消息”的迷你消息系统》]]></title>    <link>https://juejin.cn/post/7591130604430049320</link>    <guid>https://juejin.cn/post/7591130604430049320</guid>    <pubDate>2026-01-04T13:58:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604430049320" data-draft-id="7591309945511002112" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《10 分钟上手 RabbitMQ：用 Python 写一个“不丢消息”的迷你消息系统》"/> <meta itemprop="keywords" content="RabbitMQ"/> <meta itemprop="datePublished" content="2026-01-04T13:58:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《10 分钟上手 RabbitMQ：用 Python 写一个“不丢消息”的迷你消息系统》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:58:18.000Z" title="Sun Jan 04 2026 13:58:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>标签：<br/>
RabbitMQ · Python · 消息队列 · 实战 Demo · 入门</p>
<hr/>
<h3 data-id="heading-0">为什么写这篇？</h3>
<p>消息队列（MQ）的概念大家背得滚瓜烂熟：解耦、异步、削峰。但“第一次把消息真正发出去”的门槛依旧不小：</p>
<ul>
<li>需要装 Erlang？</li>
<li>管理界面怎么开？</li>
<li>消息会不会一发就丢？</li>
</ul>
<p>这篇文章带你 10 分钟跑通第一个可生产的 RabbitMQ 示例，代码不足 80 行，却覆盖<strong>持久化 + 手动 ACK + 连接断线重试</strong>等生产级要素，复制即可运行。</p>
<hr/>
<h3 data-id="heading-1">1. 一键启动 RabbitMQ</h3>
<p>不想装 Erlang？Docker 一把梭：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d --hostname rabbit \
  --name rabbit \
  -p 5672:5672 \
  -p 15672:15672 \
  rabbitmq:3.12-management
</code></pre>
<p>浏览器打开 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A15672" target="_blank" title="http://localhost:15672" ref="nofollow noopener noreferrer">http://localhost:15672</a><br/>
账号/密码：<code>guest / guest</code><br/>
能看到队列、消息速率、节点内存，调试神器 get✔</p>
<hr/>
<h3 data-id="heading-2">2. Python 依赖仅一个包</h3>
<pre><code class="hljs language-bash" lang="bash">pip install pika==1.3.2
</code></pre>
<hr/>
<h3 data-id="heading-3">3. 队列与消息：先声明，再使用</h3>
<p>RabbitMQ 的哲学：<strong>队列只创建一次，谁先到谁声明</strong>。<br/>
示例里把 <code>durable=True</code> 打开，即使 MQ 重启，队列元数据也不会丢。</p>
<hr/>
<h3 data-id="heading-4">4. 生产者代码（producer.py）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pika, sys

QUEUE = <span class="hljs-string">'demo_queue'</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    conn = pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">'localhost'</span>))
    ch = conn.channel()
    ch.queue_declare(queue=QUEUE, durable=<span class="hljs-literal">True</span>)          <span class="hljs-comment"># 持久化队列</span>

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        body = <span class="hljs-string">f'hello <span class="hljs-subst">{i}</span>'</span>
        ch.basic_publish(exchange=<span class="hljs-string">''</span>,
                         routing_key=QUEUE,
                         body=body,
                         properties=pika.BasicProperties(delivery_mode=<span class="hljs-number">2</span>))  <span class="hljs-comment"># 持久化消息</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f' [x] Sent "<span class="hljs-subst">{body}</span>"'</span>)
    conn.close()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">try</span>:
        main()
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        sys.exit()
</code></pre>
<p>运行结果：</p>
<pre><code class="hljs language-csharp" lang="csharp"> [<span class="hljs-meta">x</span>] Sent <span class="hljs-string">"hello 0"</span>
 [<span class="hljs-meta">x</span>] Sent <span class="hljs-string">"hello 1"</span>
 ...
 [<span class="hljs-meta">x</span>] Sent <span class="hljs-string">"hello 9"</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">5. 消费者代码（consumer.py）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pika, time, sys

QUEUE = <span class="hljs-string">'demo_queue'</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">ch, method, properties, body</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f' [x] Received <span class="hljs-subst">{body.decode()}</span>'</span>)
    time.sleep(<span class="hljs-number">1</span>)                               <span class="hljs-comment"># 模拟耗时</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">' [x] Done'</span>)
    ch.basic_ack(delivery_tag=method.delivery_tag)  <span class="hljs-comment"># 手动 ack</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    conn = pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">'localhost'</span>))
    ch = conn.channel()
    ch.queue_declare(queue=QUEUE, durable=<span class="hljs-literal">True</span>)
    ch.basic_qos(prefetch_count=<span class="hljs-number">1</span>)              <span class="hljs-comment"># 公平分发</span>
    ch.basic_consume(queue=QUEUE, on_message_callback=callback)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">' [*] Waiting for messages. To exit press CTRL+C'</span>)
    ch.start_consuming()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">try</span>:
        main()
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        sys.exit()
</code></pre>
<p>运行后，每秒处理 1 条消息，10 秒完成全部任务；<br/>
RabbitMQ UI 中 <code>Messages</code> 从 10 → 0，没有一条积压。</p>
<hr/>
<h3 data-id="heading-6">6. 小结：我们到底做了什么？</h3>






























<table><thead><tr><th>关键点</th><th>命令/参数</th><th>作用</th></tr></thead><tbody><tr><td>队列持久化</td><td><code>queue_declare(durable=True)</code></td><td>MQ 重启队列不丢</td></tr><tr><td>消息持久化</td><td><code>delivery_mode=2</code></td><td>服务器掉电消息不丢</td></tr><tr><td>手动 ACK</td><td><code>basic_ack</code></td><td>消费者崩溃时消息可重新投递</td></tr><tr><td>公平分发</td><td><code>basic_qos(prefetch_count=1)</code></td><td>慢消费者不会被压垮</td></tr></tbody></table>
<p>把这 4 项配置搬到生产环境，你就已经战胜了 80% 的“消息丢失”事故。</p>
<hr/>
<h3 data-id="heading-7">7. 下一步可以玩什么？</h3>
<ol>
<li>把 <code>demo_queue</code> 换成 <code>topic</code> 模式，实现日志级别路由；</li>
<li>用 <code>RPC</code> 模式做同步调用，假装自己是一个微服务网关；</li>
<li>开镜像队列 + 集群，Kill 掉任一节点，消息依旧在线；</li>
<li>给消费端加 <code>retry + dead-letter-exchange</code>，自动重试 3 次后进入死信队列，人工处理。</li>
</ol>
<hr/>
<h3 data-id="heading-8">8. 一句鸡汤</h3>
<p>消息队列的难点从来不在于“发消息”，而在于“失败时消息还在”。<br/>
先让今天的 10 条消息不丢，再去考虑百万 QPS 的宏伟蓝图——脚下已出发，远方不远。</p>
<p>完整源码已上传 GitHub：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyourname%2Frabbitmq-python-minimal" target="_blank" title="https://github.com/yourname/rabbitmq-python-minimal" ref="nofollow noopener noreferrer">github.com/yourname/ra…</a><br/>
欢迎 Star &amp; PR，祝大家排队愉快！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 原生下的新的社区形态会是什么]]></title>    <link>https://juejin.cn/post/7591350620188377094</link>    <guid>https://juejin.cn/post/7591350620188377094</guid>    <pubDate>2026-01-04T12:05:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620188377094" data-draft-id="7591422577937612806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 原生下的新的社区形态会是什么"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-04T12:05:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 原生下的新的社区形态会是什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:05:04.000Z" title="Sun Jan 04 2026 12:05:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 不会杀死社区，但会杀死那些只做 “信息搬运工” 的平庸社区。Stack Overflow 的下滑与 Reddit 的坚挺就是最好的例证。未来的社区必须构建以 “<strong>可信</strong>” 与 “<strong>独创性</strong>” 、 “<strong>用户深度链接</strong>”为核心的资产体系，将 AI 作为过滤噪音的过滤器和放大创意的放大器，而非替代人类思考的生成器。本文没有答案，单纯记录一下一些思考</p>
<p>在 AIGC 边际成本趋零的背景下，传统 “提问 - 回答” 的知识搬运模式已难以为继。
我觉得有一些问题是传统社区和知识问答社区必须要回答的问题</p>
<ul>
<li><strong>价值升级：</strong> 当标准答案唾手可得，社区如何提供 AI 无法生成的稀缺价值？</li>
<li><strong>秩序重构：</strong> 在人机混杂的环境中，如何保证内容的可信度与社区的讨论秩序？</li>
<li><strong>量化落地：</strong> 如何建立一套可执行、可监测的指标体系来指导日常运营？</li>
</ul>
<h2 data-id="heading-0">社区形态的演进脉络</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/376b096f1a0e461799a055da60ec4e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133104&amp;x-signature=lj2KXeX3H6GD2ai0zYW0IEGmVYM%3D" alt="image.png" loading="lazy"/></p>
<p>回顾互联网社区的发展，每一次技术跃迁都重塑了 “连接” 的方式。我们正在经历从社交网络向 “AI 原生社区” 跨越的关键时刻。这一演进并非断裂，而是对社区核心要素的深化。</p>
<p><strong>兴趣论坛 (1979-2003)：</strong> 受限于拨号带宽，用户基于纯粹兴趣聚合（如 Usenet, NGA）。核心是 “认同感”。</p>
<p><strong>内容平台 (2003-2016)：</strong> 搜索引擎与宽带普及，放大了分发效率（如 Reddit, 知乎）。核心是 “影响力”。</p>
<p><strong>社交网络 (2016-至今)：</strong> 移动互联与算法推荐，流量精准变现（如 TikTok, 小红书）。核心是 “商业价值”。</p>
<p><strong>AI原生社区 (未来 1)：</strong> 生成式 AI 让内容生产成本趋零。核心回归 “真实协作” 与 “人机共生”。</p>
<p>在新范式下，我们必须重新审视社区的三大基石：</p>
<h4 data-id="heading-1">定位</h4>
<p>不再是 “找答案”，而是 <strong>“找共鸣” 与 “解决复杂问题”</strong> 。</p>
<p>用户来这里是因为 AI 无法提供情感慰藉或处理非标场景。</p>
<h4 data-id="heading-2">文化</h4>
<p>从崇拜 “大神” 转向<strong>崇拜 “真实”</strong> 。</p>
<p>社区应鼓励原创、个人经历与深度思考，明确排斥批量生成的流水线内容。</p>
<h4 data-id="heading-3">规则</h4>
<p>建立<strong>人机分层</strong>的激励机制。</p>
<p>严惩伪装成人类的 AI 灌水，重奖经过验证的高价值人类贡献。</p>
<h2 data-id="heading-4">生成式 AI 对知识型社区的差异化影响</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1319724de9c4bfda29d1ec4a1b8d6ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133104&amp;x-signature=JyClvQRbvYUYr2IiWcAdu5Gy9JM%3D" alt="image.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nature.com%2Farticles%2Fs41598-024-61221-0" target="_blank" title="https://www.nature.com/articles/s41598-024-61221-0" ref="nofollow noopener noreferrer">Nature (2024)</a> 的研究通过对比 Stack Overflow (SO) 与 Reddit 开发者社区，揭示了 “信息型” 与 “关系型” 社区的不同命运。</p>

























<table><thead><tr><th>维度</th><th>Stack Overflow (纯信息型)</th><th>Reddit 开发者社区 (关系/讨论型)</th></tr></thead><tbody><tr><td><strong>流量变化</strong></td><td><strong>下降约 12%</strong> (日均减少百万级访问)</td><td>无显著统计学差异，保持稳定</td></tr><tr><td><strong>提问特征</strong></td><td>总体提问量下滑，简单问题消失，<strong>问题复杂度显著上升</strong></td><td>维持原有讨论生态，话题未受明显冲击</td></tr><tr><td><strong>用户流失</strong></td><td><strong>新手用户大量流失</strong>，留存用户多为老手</td><td>用户结构未见明显断层</td></tr></tbody></table>
<p><strong>运营启示：</strong></p>
<ul>
<li><strong>拥抱复杂：</strong> 简单问题被 AI 拦截是必然，社区应主动引导用户讨论 “没有标准答案” 的复杂场景。</li>
<li><strong>增强纽带：</strong> Reddit 的韧性证明了 “人际连接” 的护城河作用。应增加 AMA (Ask Me Anything)、圆桌讨论等强互动形式。</li>
<li><strong>奖励非标：</strong> 修改积分规则，降低对简单搬运内容的奖励，大幅提升对经验分享、观点辩论的激励权重。</li>
</ul>
<h2 data-id="heading-5">信息/关系/观点三类社区的实操策略</h2>
<p>不同类型的社区应采取差异化的转型策略：</p>
<h4 data-id="heading-6">A) Stack Overflow</h4>
<p><strong>信息型：转型专家网络</strong></p>
<ul>
<li><strong>聚焦深度：</strong> 引导提问者补充详细上下文，拒绝 “一句话提问”。</li>
<li><strong>专家计划：</strong> 认证领域专家，对经过专家验证的答案给予双倍权重。</li>
<li><strong>严禁灌水：</strong> 对复制粘贴 GPT 答案的账号实行零容忍封禁。</li>
</ul>
<h4 data-id="heading-7">B) Reddit Dev</h4>
<p><strong>关系型：强化社交密度</strong></p>
<ul>
<li><strong>主题活动：</strong> 定期举办 AMA、黑客马拉松，制造 “氛围感”为用户提供深度链接的场景和机会。</li>
<li><strong>版主自治：</strong> 赋权版主制定个性化的反 AI 规则（如特定板块禁止 AI）。</li>
<li><strong>群组协作：</strong> 鼓励基于项目的长周期讨论，而非单次问答。</li>
</ul>
<h4 data-id="heading-8">C) Hacker News</h4>
<p><strong>观点型：捍卫原创思考</strong></p>
<ul>
<li><strong>慢速 Karma：</strong> 保持高门槛的信誉积累机制，防止 AI 刷号。</li>
<li><strong>辅助标识：</strong> 允许 AI 辅助润色，但必须在文末声明，强调观点属于人类。</li>
<li><strong>来源核查：</strong> 对引用链接进行自动化真实性校验，防止幻觉。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b54f9fda5bd4c5db9b599330ddac737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133104&amp;x-signature=bZcHJB4RhA3Fc28QhyWL8uXWUC0%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Claude中问 "元芳（Gemini）你怎么看？"]]></title>    <link>https://juejin.cn/post/7591360623469314058</link>    <guid>https://juejin.cn/post/7591360623469314058</guid>    <pubDate>2026-01-04T12:18:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469314058" data-draft-id="7591322050240610342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Claude中问 &quot;元芳（Gemini）你怎么看？&quot;"/> <meta itemprop="keywords" content="AI编程,Claude,Gemini"/> <meta itemprop="datePublished" content="2026-01-04T12:18:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Claude中问 "元芳（Gemini）你怎么看？"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:18:40.000Z" title="Sun Jan 04 2026 12:18:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>当前对程序员较为友好的两种AI工具，应该非Claude和Gemini莫属。尽管公认Claude在编码上能力更强，但是Gemini也有自己的优势，如100万Token超长上下文、原生多模态支持图片、PDF、音频、视频等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2350f52dd08946a29b5fbdd74b48dff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=xu8YihaZWGIgfLpN5xQpU1Y9C%2BM%3D" alt="" loading="lazy"/></p>
<p>在我们使用Claude的过程中，可能会出现如下场景：</p>
<ul>
<li>Claude的答案不是那么满意，想对比看看Gemini的答案</li>
<li>在特定场景下，就想使用更高效的Gemini来处理</li>
</ul>
<p>这个时候，不管我们是同时开着两个CLI还是使用网页版的Gemini，都能体会到来回切换工具或者重新交代上下文的痛苦。而我们要做到的就是，在必要时候，只需要在Claude中问一句“gemini你怎么看” ，Claude就可以输出Gemini的结果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/549c23688e574b42b8c30fe15ad53b6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=Nt%2BH8AObANgC93IorNeLXNEg5I4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">怎么做🌟</h2>
<p>最简单的方式就是直接在Claude中执行gemini的Bash指令，比如我们先在Claude中问 1+1等于多少。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2c595de35f348129170a24d7a357b06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=YF%2FW%2F%2FrikyHxFA2DFVfY0JvhvLY%3D" alt="" loading="lazy"/></p>
<p>如果我们想让Gemini来回答这个问题，只需要执行如下指令：</p>
<pre><code class="hljs language-css" lang="css">gemini -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1</span>+<span class="hljs-number">1</span>等于多少
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdea7f58aa2f4b029dd37586ec5a29c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=Y7x%2FP3mAZNgcML%2B5LtYEvZVmrhM%3D" alt="" loading="lazy"/></p>
<p>可以看到，Gemini也给出了答案。这个例子可能不够准确的让你意识到这个Gemini的回答确实来自Gemini。我们再来看一个图片的例子。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6635bb8debd2472b815c331696857599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768133920&amp;x-signature=SlR%2F%2BCIixp2FQEj9UYZZcYPvS0k%3D" alt="" loading="lazy"/></p>
<p>我们先让Claude来描述这张图片，结果如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; test-image.png 这张图片是干嘛的 </span>

⏺ Let me read the image file to see what it contains.

⏺ Read(test-image.png)
  ⎿  Read image (25.5KB)
  ⎿  Running PostToolUse hooks… (1/2 done)

⏺ 这张图片显示了一个深色主题的 IDE/代码编辑器界面。从图片来看:

<span class="hljs-bullet">  -</span> 左侧是文件资源管理器侧边栏，显示了项目文件结构
<span class="hljs-bullet">  -</span> 主编辑区域显示了一个深色背景的编辑器
<span class="hljs-bullet">  -</span> 看起来像是 Visual Studio Code 或类似的开发环境

  根据文件名 test-image.png，这似乎是一个测试用的截图文件。这张图片可能是用于:
<span class="hljs-bullet">  -</span> 测试图片读取功能
<span class="hljs-bullet">  -</span> 作为项目中的示例或测试资源
<span class="hljs-bullet">  -</span> 记录某个开发环境的配置或界面
</code></pre>
<p>再让Gemini来描述这张图片，结果如下所示：</p>
<pre><code class="hljs language-scss" lang="scss"> <span class="hljs-built_in">Bash</span>(gemini "这张图片是干嘛的" &lt; test-image.png)
  ⎿ 这张图片（test-image<span class="hljs-selector-class">.png</span>）是一个 **<span class="hljs-number">800</span>x600 像素的 PNG 图像**。                                              

    从二进制数据来看，它似乎是一个非常简单的图像，很可能是一个包含
    **白色背景和少量图形元素**（如简单的线条或图标
    … +<span class="hljs-number">3</span> lines (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ 根据 Gemini CLI 的分析,test-image<span class="hljs-selector-class">.png</span> 是一张 <span class="hljs-number">800</span>x600 像素的 PNG 图像,包含白色背景和一些简单的图形元素(如线条或图标)。

  从文件名 test_cl 目录的位置来看,这张图片很可能是用于开发或测试 Gemini CLI 图像处理功能的示例素材。它作为一个测试文件,用来验证图像分析和视觉识别功能是否正常工作。
</code></pre>
<p>我们可以看到，他们的回答是完全不一致的。但是我们不可能每次都去写一个<code>gemini -p</code> 指令，这个时候我们就想到了将上述指令描述成一个skill。</p>
<h2 data-id="heading-2">好的方式🌟🌟</h2>
<p>创建一个skill来描述我们的要求：</p>
<ul>
<li>执行Gemini指令分析问题</li>
<li>将Gemini分析的结果与Claude的结果进行对比</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">---  name:  gemini  description:  Cross-AI  comparison  tool  that  executes  Gemini  CLI  <span class="hljs-keyword">and</span>  compares  results  with  Claude<span class="hljs-number">'</span>s  responses.  Use  when  user  asks  <span class="hljs-string">"gemini怎么看"</span>,  <span class="hljs-string">"让gemini回答"</span>,  <span class="hljs-keyword">or</span>  mentions  <span class="hljs-string">"gemini"</span>  to  get  alternative  perspectives  <span class="hljs-keyword">and</span>  compare  AI  model  outputs.  Supports  both  text  questions  <span class="hljs-keyword">and</span>  image  analysis  queries.  ---  # Gemini Cross-AI Comparison   ## Overview   This  skill  enables  cross-AI  comparison  by  executing  the  Gemini  CLI  tool  <span class="hljs-keyword">and</span>  contrasting  its  responses  with  Claude<span class="hljs-number">'</span>s  answers.  This  provides  users  with  multiple  perspectives  <span class="hljs-keyword">and</span>  helps  validate  accuracy.   ## Workflow   ### <span class="hljs-number">1.</span> Detect Trigger   Trigger <span class="hljs-keyword">this</span> skill when user uses phrases like:  -  <span class="hljs-string">"gemini怎么看"</span>  -  <span class="hljs-string">"让gemini回答"</span>  -  <span class="hljs-string">"用gemini分析"</span>  -  <span class="hljs-string">"gemini认为呢"</span>  -  Or  any  <span class="hljs-keyword">explicit</span>  request  to  get  Gemini<span class="hljs-number">'</span>s  opinion   ### <span class="hljs-number">2.</span> Extract Query   Identify  the  user<span class="hljs-number">'</span>s  actual question <span class="hljs-keyword">or</span> task:  -  For text:  Extract  the  core  question  being  asked  -  For images:  Note  the  image  file  path  <span class="hljs-keyword">and</span>  the  question  about  it  -  Handle  both  direct  questions  <span class="hljs-keyword">and</span>  contextual  follow-ups   ### <span class="hljs-number">3.</span> Execute Gemini CLI   **For  text-only  questions:**  ```bash  gemini  <span class="hljs-string">"用户的问题"</span>  ```   **For  image  analysis:**  ```bash  gemini  <span class="hljs-string">"用户的问题"</span>  &lt;  image.png  ```   **For  multiple  images:**  ```bash  gemini  <span class="hljs-string">"用户的问题"</span>  &lt;  image1.png  ```   Execute  the  command  <span class="hljs-keyword">and</span>  capture  Gemini<span class="hljs-number">'</span>s  complete  response.   ### <span class="hljs-number">4.</span> Compare Responses   Analyze  differences  between  Claude<span class="hljs-number">'</span>s  <span class="hljs-keyword">and</span>  Gemini<span class="hljs-number">'</span>s  answers:   **Comparison  Dimensions:**  -  **Accuracy**:  Which  answer  is  more  factually  correct?  -  **Completeness**:  Did  one  miss  important  details?  -  **Clarity**:  Which  explanation  is  easier  to  understand?  -  **Approach**:  Different  reasoning  paths  <span class="hljs-keyword">or</span>  perspectives  -  **Tone**:  Formal  vs  casual,  concise  vs  verbose  -  **Specific  insights**:  Unique  points  from  either  model   **Key  Differences  to  Highlight:**  -  Contradictions  <span class="hljs-keyword">or</span>  disagreements  -  Complementary  information  -  Different  emphasis  <span class="hljs-keyword">or</span>  priorities  -  Unique  capabilities  shown   ### <span class="hljs-number">5.</span> Present Comparison   Format output as:   ```  ## Gemini 的回答   [ Gemini<span class="hljs-number">'</span>s  complete  response ]  ## 对比分析   ### 主要差异  [ Key  differences  bullet  points ]  ### 各自优势  -  **Claude**: [ What  Claude  did  better ] -  **Gemini**: [ What  Gemini  did  better ]  ### 建议  [ When  to  prefer  which  answer , <span class="hljs-keyword">or</span>  <span class="hljs-keyword">if</span>  combining  both  would  be  optimal ] ```   ## Best Practices   <span class="hljs-number">1</span> .  **Be  fair  <span class="hljs-keyword">and</span>  objective**:  Acknowledge  when  Gemini  provides  better  <span class="hljs-keyword">or</span>  more  accurate  answers  <span class="hljs-number">2</span> .  **Preserve  context**:  If  <span class="hljs-keyword">this</span>  is  a  follow-up  question,  include  relevant  context  in  the  Gemini  query  <span class="hljs-number">3</span> .  **Handle  errors  gracefully**:  If  gemini  CLI  fails,  explain  the  error  <span class="hljs-keyword">and</span>  suggest  alternatives  <span class="hljs-number">4</span> .  **Avoid  bias**:  Don<span class="hljs-number">'</span>t  always  favor  Claude<span class="hljs-number">'</span>s  answer  -  genuinely  assess  which  is  better  <span class="hljs-number">5</span> .  **Be  concise**:  Focus  on  meaningful  differences,  <span class="hljs-keyword">not</span>  minor  stylistic  variations   ## Error Handling   If gemini CLI fails:  -  Check <span class="hljs-keyword">if</span> gemini CLI is installed:  `which  gemini`  -  Verify syntax:  text  questions  use  quotes,  images  use  stdin  redirect  -  Check  image  file  exists  <span class="hljs-keyword">and</span>  is  readable  -  Report  specific  error  message  to  user  -  Fall  back  to  Claude-only  response  <span class="hljs-keyword">if</span>  needed   ## Examples   **Example  <span class="hljs-number">1</span>:  Text  question**  User:  <span class="hljs-string">"gemini怎么看 Python 的异步编程？"</span>  Execute:  `gemini  <span class="hljs-string">"Python 的异步编程有什么特点和优势？"</span>`   **Example  <span class="hljs-number">2</span>:  Image  analysis**  User:  <span class="hljs-string">"gemini怎么看这张图片里的代码有什么问题？ screenshot.png"</span>  Execute:  `gemini  <span class="hljs-string">"这张图片里的代码有什么问题？"</span>  &lt;  screenshot.png`   **Example  <span class="hljs-number">3</span>:  Verification**  User:  <span class="hljs-string">"Claude 说答案是 42，让gemini验证一下"</span>  Execute:  `gemini  <span class="hljs-string">"答案是 42 对吗？[context from previous conversation]"</span> 
</code></pre>
<p>现在我们来用一个错误百出的实体类，验证下这个skill。</p>
<pre><code class="hljs language-arduino" lang="arduino">pakage com.mistake.demo
inport kotlin.random.Random
clas BrokenCalculator {
</code></pre>
<p>Claude执行结果如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">&gt; BrokenCalculator 这个类中有哪些错误 

⏺ 我来帮你查找并分析 BrokenCalculator 类中的错误。

⏺ Search(pattern: <span class="hljs-string">"**/*BrokenCalculator*"</span>)
  ⎿  Found <span class="hljs-number">1</span> file (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ Bash(file /Users/linqinghuang/test/test_cl/BrokenCalculator)
  ⎿  /Users/linqinghuang/test/test_cl/BrokenCalculator: ASCII text
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ Read(BrokenCalculator)
  ⎿  Read <span class="hljs-number">3</span> lines
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ Read(BrokenCalculator)
  ⎿  Read <span class="hljs-number">3</span> lines
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ 找到了 BrokenCalculator 文件，这个 Kotlin 类中有以下几个错误：

  语法错误（拼写错误）： 

  <span class="hljs-number">1.</span> 第<span class="hljs-number">1</span>行：pakage → 应该是 <span class="hljs-keyword">package</span>
  pakage com.mistake.demo  <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">package</span> com.mistake.demo <span class="hljs-comment">// 正确</span>
  <span class="hljs-number">2.</span> 第<span class="hljs-number">2</span>行：inport → 应该是 <span class="hljs-keyword">import</span>
  inport kotlin.random.Random  <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">import</span> kotlin.random.Random  <span class="hljs-comment">// 正确</span>
  <span class="hljs-number">3.</span> 第<span class="hljs-number">3</span>行：clas → 应该是 <span class="hljs-keyword">class</span>
  <span class="hljs-title class_">clas</span> <span class="hljs-title">BrokenCalculator</span> {  <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">class</span> <span class="hljs-title class_">BrokenCalculator</span> {  <span class="hljs-comment">// 正确</span>

  其他问题： 
  - 类定义不完整，缺少类的主体内容
  - 没有闭合的大括号 }
  - 没有实际的类实现

  这些都是编译时错误，会导致代码无法编译通过。
</code></pre>
<p>接着问“<strong>gemini你怎么看</strong>”，结果如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown"> gemini你怎么看

⏺ /gemini

⏺ Bash(gemini "请分析 /Users/linqinghuang/test/test<span class="hljs-emphasis">_cl/BrokenCalculator
      这个文件中有哪些错误？请详细指出所有问题。")
  ⎿  I will start by verifying the file's existence and reading its content to analyze it.
     `/Users/linqinghuang/test/test_</span>cl/BrokenCalculator` 文件包含以下 Kotlin 语法错误：
<span class="hljs-code">     … +18 lines (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (1/2 done)
</span>
⏺ Gemini 的回答

  Gemini 指出了以下问题：

<span class="hljs-bullet">  1.</span> 关键字拼写错误：
<span class="hljs-bullet">    -</span> pakage 应更正为 package
<span class="hljs-bullet">    -</span> inport 应更正为 import
<span class="hljs-bullet">    -</span> clas 应更正为 class
<span class="hljs-bullet">  2.</span> 文件扩展名缺失：
<span class="hljs-bullet">    -</span> 该文件包含 Kotlin 代码，但没有 .kt 扩展名
<span class="hljs-bullet">    -</span> 建议重命名为 BrokenCalculator.kt

  提供了修正后的代码示例。

  对比分析

  主要差异

<span class="hljs-bullet">  -</span> Gemini 额外发现：文件扩展名问题（缺少 .kt），这是一个很实用的观察
<span class="hljs-bullet">  -</span> Claude 额外发现：类定义不完整（缺少主体内容和闭合大括号）

  各自优势

<span class="hljs-bullet">  -</span> Claude：更详细地展示了错误位置和代码对比格式，使用了代码块展示错误和正确的写法对比
<span class="hljs-bullet">  -</span> Gemini：发现了文件扩展名这个实际部署时的重要问题，并提供了完整的修正后代码示例

  建议

  结合两者的答案最佳：
<span class="hljs-bullet">  -</span> Gemini 指出的文件扩展名问题在实际开发中很重要，应该采纳
<span class="hljs-bullet">  -</span> 两个模型都准确识别了核心的拼写错误
<span class="hljs-bullet">  -</span> 两者都应该提到代码不完整的问题（Gemini 的修正代码示例隐含了这一点，但没有明确说明）

  总结：Gemini 在文件扩展名问题上更胜一筹，这是一个容易被忽略但实际很重要的细节。
</code></pre>
<p>从结果中我们可以看到，Gemini输出了自己的回答并且对比分析了与Claude回答的差异性。到这里已经达到了我们的目的。但当前仍然存在一个问题：Gemini的返回结果会污染Claude的上下文。</p>
<h2 data-id="heading-3">更好的方式 🌟🌟🌟</h2>
<p>如果我们想解决这个问题，就需要定义一个Subagent来单独执行Gemini的任务，这样Claude主对话就只有一个摘要，这里我们将Subagent设计为同步执行的。 skill描述如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: gemini
<span class="hljs-section">description: Cross-AI comparison tool that executes Gemini CLI and compares results with Claude's responses. Use when user asks "gemini怎么看", "让gemini回答", or mentions "gemini" to get alternative perspectives and compare AI model outputs. Supports both text questions and image analysis queries.
---</span>

<span class="hljs-section"># Gemini Cross-AI Comparison</span>

<span class="hljs-section">## Overview</span>

This skill enables cross-AI comparison by executing the Gemini CLI tool and contrasting its responses with Claude's answers. This provides users with multiple perspectives and helps validate accuracy.

<span class="hljs-section">## Workflow</span>

<span class="hljs-section">### 1. Detect Trigger</span>

Trigger this skill when user uses phrases like:
<span class="hljs-bullet">-</span> "gemini怎么看"
<span class="hljs-bullet">-</span> "让gemini回答"
<span class="hljs-bullet">-</span> "用gemini分析"
<span class="hljs-bullet">-</span> "gemini认为呢"
<span class="hljs-bullet">-</span> Or any explicit request to get Gemini's opinion

<span class="hljs-section">### 2. Extract Query and Claude's Response</span>

Identify the user's actual question or task:
<span class="hljs-bullet">-</span> For text: Extract the core question being asked
<span class="hljs-bullet">-</span> For images: Note the image file path and the question about it
<span class="hljs-bullet">-</span> Handle both direct questions and contextual follow-ups

<span class="hljs-strong">**Important**</span> : Capture Claude's response to the user's question, as it will be passed to the Subagent for comparison.

<span class="hljs-section">### 3. Execute Gemini CLI via Subagent</span>

启动一个独立的同步 agent 来执行 gemini 命令并完成对比分析，避免污染主对话上下文。

<span class="hljs-strong">**Agent 配置文件**</span> ：<span class="hljs-code">`~/.claude/agents/gemini-comparison-agent.md`</span>

<span class="hljs-strong">**使用方法：**</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**读取 Agent 配置**</span> ：
   <span class="hljs-code">```
   Read ~/.claude/agents/gemini-comparison-agent.md
   ```</span>

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**启动 Subagent**</span> ：
   使用 Task 工具，传入：
<span class="hljs-bullet">   -</span> <span class="hljs-strong">**subagent <span class="hljs-emphasis">_type** : general-purpose
   - **run_</span> in <span class="hljs-emphasis">_background** : false（同步执行）
   - **description** : "Compare Gemini and Claude responses"
   - **prompt** : 包含以下内容
     - 引用 gemini-comparison-agent.md 的完整内容
     - Claude 的响应
     - 用户查询
     - 图片路径（如果适用）

**示例 Prompt 结构** ：
```
请按照以下 agent 配置执行任务：

[从 ~/.claude/agents/gemini-comparison-agent.md 读取的内容]

---

当前任务：
- Claude 的响应：{CLAUDE'S_</span>RESPONSE}
- 用户查询：{USER<span class="hljs-emphasis">_QUERY}
- 图片路径：{IMAGE_</span>PATH}（可选）
```

**</span> 关键点： **
<span class="hljs-bullet">-</span> Agent 配置文件位于 <span class="hljs-code">`~/.claude/agents/gemini-comparison-agent.md`</span>
<span class="hljs-bullet">-</span> 使用 <span class="hljs-code">`run_in_background: false`</span> 确保同步执行
<span class="hljs-bullet">-</span> Subagent 在独立会话中运行，执行上下文完全隔离
<span class="hljs-bullet">-</span> 不要在主对话中直接使用 Bash 工具执行 gemini 命令

<span class="hljs-section">### 4. Present Comparison</span>

Subagent 会返回完整的对比分析结果。直接将 Subagent 的输出展示给用户即可，不需要再进行任何处理或格式化。

Subagent 的输出已经包含了：
<span class="hljs-bullet">-</span> Gemini 的完整回答
<span class="hljs-bullet">-</span> 主要差异分析
<span class="hljs-bullet">-</span> 各自优势
<span class="hljs-bullet">-</span> 综合建议

<span class="hljs-section">## Best Practices</span>

<span class="hljs-bullet">1.</span> ** Always use Subagent ** : 必须通过 Subagent 执行 gemini 命令，不要在主对话中直接使用 Bash 工具
<span class="hljs-bullet">2.</span> ** Pass Claude's response ** : 确保 Subagent 能够获得 Claude 的完整响应，以便进行准确对比
<span class="hljs-bullet">3.</span> ** Be fair and objective ** : 承认当 Gemini 提供更好或更准确的答案时
<span class="hljs-bullet">4.</span> ** Preserve context ** : 如果是后续问题，在传给 Subagent 的查询中包含相关上下文
<span class="hljs-bullet">5.</span> ** Avoid bias ** : 不要总是偏向 Claude 的答案 - 真诚地评估哪个更好
<span class="hljs-bullet">6.</span> ** Be concise ** : 专注于有意义的差异，而非次要的风格变化
<span class="hljs-bullet">7.</span> ** Context isolation ** : Subagent 的执行上下文与主对话完全隔离，保持主对话历史清晰

<span class="hljs-section">## Error Handling</span>

当使用 Subagent 时可能遇到的错误情况：

** Subagent 执行失败： **
<span class="hljs-bullet">-</span> 如果 Task 工具执行失败，向用户说明 Subagent 启动问题
<span class="hljs-bullet">-</span> 提供错误详情和建议的重试方案

** gemini CLI 不可用： **
<span class="hljs-bullet">-</span> Subagent 会检测 <span class="hljs-code">`gemini`</span> 命令是否可用
<span class="hljs-bullet">-</span> 如果不可用，Subagent 会报告具体错误信息
<span class="hljs-bullet">-</span> 建议用户检查 gemini CLI 是否已正确安装

** 命令语法错误： **
<span class="hljs-bullet">-</span> 文本查询：使用引号包裹查询内容
<span class="hljs-bullet">-</span> 图片查询：使用 stdin 重定向 <span class="hljs-code">`&lt; {IMAGE_PATH}`</span>
<span class="hljs-bullet">-</span> 检查图片文件是否存在且可读

<span class="hljs-strong">**降级策略：**</span>
<span class="hljs-bullet">-</span> 如果 gemini CLI 不可用或执行失败
<span class="hljs-bullet">-</span> 向用户说明情况
<span class="hljs-bullet">-</span> 提供 Claude 的原始答案作为参考
<span class="hljs-bullet">-</span> 建议用户稍后重试或手动使用 gemini CLI

<span class="hljs-section">## Examples</span>

<span class="hljs-strong">**Example 1: Text question**</span>

用户输入：
<span class="hljs-code">```
User: "gemini怎么看 Python 的异步编程？"
```</span>

执行流程：
<span class="hljs-bullet">1.</span> Claude 已经给出了关于 Python 异步编程的回答
<span class="hljs-bullet">2.</span> 启动 Subagent，传入 Claude 的响应
<span class="hljs-bullet">3.</span> Subagent 执行：<span class="hljs-code">`gemini "Python 的异步编程有什么特点和优势？"`</span>
<span class="hljs-bullet">4.</span> Subagent 返回对比分析结果
<span class="hljs-bullet">5.</span> 直接展示 Subagent 的输出

<span class="hljs-strong">**Example 2: Image analysis**</span>

用户输入：
<span class="hljs-code">```
User: "gemini怎么看这张图片里的代码有什么问题？ screenshot.png"
```</span>

执行流程：
<span class="hljs-bullet">1.</span> Claude 已经分析了 screenshot.png 中的代码
<span class="hljs-bullet">2.</span> 启动 Subagent，传入：
<span class="hljs-bullet">   -</span> Claude 的分析内容
<span class="hljs-bullet">   -</span> 图片路径：screenshot.png
<span class="hljs-bullet">3.</span> Subagent 执行：<span class="hljs-code">`gemini "这张图片里的代码有什么问题？" &lt; screenshot.png`</span>
<span class="hljs-bullet">4.</span> Subagent 返回对比分析结果
<span class="hljs-bullet">5.</span> 直接展示 Subagent 的输出

<span class="hljs-strong">**Example 3: Verification with context**</span>

用户输入：
<span class="hljs-code">```
User: "Claude 说答案是 42，让gemini验证一下"
```</span>

执行流程：
<span class="hljs-bullet">1.</span> Claude 已经给出了答案和推理过程
<span class="hljs-bullet">2.</span> 启动 Subagent，传入完整的上下文
<span class="hljs-bullet">3.</span> Subagent 执行：<span class="hljs-code">`gemini "答案是 42 对吗？[包含相关上下文]"`</span>
<span class="hljs-bullet">4.</span> Subagent 返回对比分析
<span class="hljs-bullet">5.</span> 直接展示 Subagent 的输出
</code></pre>
<p>agent描述如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: gemini-comparison
<span class="hljs-section">description: Gemini 对比助手 - 执行 Gemini CLI 并与 Claude 的响应进行对比分析
---</span>

<span class="hljs-section"># Gemini Comparison Agent</span>

你是一个专门负责执行 Gemini CLI 并与 Claude 的响应进行对比分析的独立 Agent。

<span class="hljs-section">## 任务目标</span>

<span class="hljs-bullet">1.</span> 执行 <span class="hljs-code">`gemini`</span> CLI 命令获取 Gemini 的响应
<span class="hljs-bullet">2.</span> 对比 Claude 和 Gemini 的回答
<span class="hljs-bullet">3.</span> 返回格式化的对比分析

<span class="hljs-section">## 工作流程</span>

<span class="hljs-section">### Step 1: 接收输入</span>

你将收到以下信息：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Claude 的响应**</span> ：Claude 对用户问题的完整回答
<span class="hljs-bullet">-</span> <span class="hljs-strong">**用户查询**</span> ：原始的用户问题或请求
<span class="hljs-bullet">-</span> <span class="hljs-strong">**图片路径**</span> （可选）：如果是图片分析任务

<span class="hljs-section">### Step 2: 执行 Gemini CLI</span>

<span class="hljs-strong">**文本查询：**</span>
<span class="hljs-code">```bash
gemini "{USER_QUERY}"
```</span>

<span class="hljs-strong">**图片分析：**</span>
<span class="hljs-code">```bash
gemini "{USER_QUERY}" &lt; {IMAGE_PATH}
```</span>

使用 Bash 工具执行命令，确保：
<span class="hljs-bullet">-</span> 文本查询使用引号包裹
<span class="hljs-bullet">-</span> 图片查询使用 stdin 重定向
<span class="hljs-bullet">-</span> 捕获完整的响应输出

<span class="hljs-section">### Step 3: 对比分析</span>

从以下维度对比 Claude 和 Gemini 的响应：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**准确性**</span> ：哪个回答更符合事实？
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**完整性**</span> ：是否有遗漏的重要细节？
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**清晰度**</span> ：哪个解释更容易理解？
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**方法差异**</span> ：不同的推理路径或视角
<span class="hljs-bullet">5.</span> <span class="hljs-strong">**语气差异**</span> ：正式 vs 随意，简洁 vs 详细
<span class="hljs-bullet">6.</span> <span class="hljs-strong">**独特见解**</span> ：各自独有的观点或信息

<span class="hljs-section">### Step 4: 返回结果</span>

按以下格式返回对比分析：

<span class="hljs-code">```markdown
## Gemini 的回答

[Gemini 的完整响应文本]

## 对比分析

### 主要差异
- [具体的差异点 1]
- [具体的差异点 2]
- [如果有更多差异，继续列出]

### 各自优势
- **Claude** : [Claude 做得好的方面]
- **Gemini** : [Gemini 做得好的方面]

### 建议
[综合建议：何时使用哪个答案，或是否应该结合两者的观点]
```</span>

<span class="hljs-section">## 错误处理</span>

如果遇到错误，按以下方式处理：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**gemini CLI 不可用**</span> ：
<span class="hljs-bullet">   -</span> 检查命令是否存在：<span class="hljs-code">`which gemini`</span>
<span class="hljs-bullet">   -</span> 报告错误：<span class="hljs-code">`gemini CLI 未安装或不在 PATH 中`</span>
<span class="hljs-bullet">   -</span> 建议用户安装 gemini CLI

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**图片文件不存在**</span> ：
<span class="hljs-bullet">   -</span> 验证文件路径：<span class="hljs-code">`ls -l {IMAGE_PATH}`</span>
<span class="hljs-bullet">   -</span> 报告错误：<span class="hljs-code">`图片文件不存在：{IMAGE_PATH}`</span>
<span class="hljs-bullet">   -</span> 建议用户提供正确的图片路径

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**命令执行失败**</span> ：
<span class="hljs-bullet">   -</span> 捕获错误信息
<span class="hljs-bullet">   -</span> 报告具体错误
<span class="hljs-bullet">   -</span> 建议降级方案（使用 Claude 的回答）

<span class="hljs-section">## 重要原则</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**客观公正**</span> ：不要偏向任何一方，真实评估哪个更好
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**详细具体**</span> ：提供具体的差异点，而非笼统的评价
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**建设性建议**</span> ：给出实用的建议，帮助用户理解何时使用哪个答案
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**保持简洁**</span> ：专注于有意义的差异，避免琐碎的风格比较
</code></pre>
<p>现在我们再来重新执行上面的代码纠错任务。Claude执行结果如下所示：</p>
<pre><code class="hljs language-scss" lang="scss">分析BrokenCalculator代码的错误 

⏺ 我需要先找到并读取 BrokenCalculator 相关的代码文件。让我搜索一下。

⏺ <span class="hljs-built_in">Search</span>(pattern: "**/*roken*alculat*")
  ⎿  Found <span class="hljs-number">1</span> file (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ <span class="hljs-built_in">Search</span>(pattern: "**/*BrokenCalculator*")
  ⎿  Found <span class="hljs-number">1</span> file (ctrl+o to expand)
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ <span class="hljs-built_in">Read</span>(BrokenCalculator)
  ⎿  Read <span class="hljs-number">3</span> lines
  ⎿  Running PostToolUse hooks… (<span class="hljs-number">1</span>/<span class="hljs-number">2</span> done)

⏺ BrokenCalculator 代码错误分析

  我发现了以下 <span class="hljs-number">3</span> 个关键字拼写错误：

  错误 <span class="hljs-number">1</span> : 第 <span class="hljs-number">1</span> 行

  pakage com.mistake.demo
  错误: pakage 应为 package

  错误 <span class="hljs-number">2</span> : 第 <span class="hljs-number">2</span> 行

  inport kotlin.random.Random
  错误: inport 应为 import

  错误 <span class="hljs-number">3</span> : 第 <span class="hljs-number">3</span> 行

  clas BrokenCalculator {
  错误: clas 应为 class

  ---
  修正后的代码:

  package com.mistake.demo
  import kotlin.random.Random
  class BrokenCalculator {

  这些错误都会导致 Kotlin 编译器无法识别关键字，从而使编译失败。
</code></pre>
<p>然后再问“Gemini怎么看”，可以看到按照预期输出了完整的结果。</p>
<pre><code class="hljs language-markdown" lang="markdown">gemini怎么看 

⏺ /gemini

⏺ 我来启动 Gemini 进行对比分析。首先读取 agent 配置文件，然后执行对比任务。

⏺ Read(~/.claude/agents/gemini-comparison-agent.md)
  ⎿  Read 102 lines
  ⎿  Running PostToolUse hooks… (1/2 done)

⏺ gemini-comparison(Compare Gemini and Claude responses)
  ⎿  Done (1 tool use · 28.4k tokens · 59s)                                                                                           
  ⎿  Running PostToolUse hooks… (1/2 done)

⏺ Gemini 的回答

  I will read the content of <span class="hljs-code">`BrokenCalculator`</span> to identify syntax and logical errors.
  The file <span class="hljs-code">`/Users/linqinghuang/test/test_cl/BrokenCalculator`</span> contains several syntax errors:

<span class="hljs-bullet">  1.</span> <span class="hljs-strong">**Line 1:**</span> <span class="hljs-code">`pakage`</span> should be <span class="hljs-code">`package`</span>.
<span class="hljs-bullet">  2.</span> <span class="hljs-strong">**Line 2:**</span> <span class="hljs-code">`inport`</span> should be <span class="hljs-code">`import`</span>.
<span class="hljs-bullet">  3.</span> <span class="hljs-strong">**Line 3:**</span> <span class="hljs-code">`clas`</span> should be <span class="hljs-code">`class`</span>.
<span class="hljs-bullet">  4.</span> <span class="hljs-strong">**Line 3:**</span> The class block is opened (<span class="hljs-code">`{`</span>) but missing a closing brace (<span class="hljs-code">`}`</span>).

  Do you want me to fix these typos and close the class body?

  对比分析

  主要差异

<span class="hljs-bullet">  -</span> 完整性差异（关键） ：Gemini 发现了第 4 个错误（缺少闭合大括号 }），而 Claude 只识别了前 3 个拼写错误，遗漏了语法结构错误
<span class="hljs-bullet">  -</span> 语言差异：Claude 使用中文回答，Gemini 使用英文回答
<span class="hljs-bullet">  -</span> 响应风格：Gemini 在结尾主动提出是否需要修复错误（交互式），Claude 则直接提供了修正后的完整代码

  各自优势

<span class="hljs-bullet">  -</span> Claude:
<span class="hljs-bullet">    -</span> 结构更清晰，使用 Markdown 格式化
<span class="hljs-bullet">    -</span> 直接提供了完整的修正代码
<span class="hljs-bullet">    -</span> 中文回答更符合中文用户需求
<span class="hljs-bullet">  -</span> Gemini:
<span class="hljs-bullet">    -</span> 更准确地发现了所有语法错误，包括缺少闭合大括号
<span class="hljs-bullet">    -</span> 主动询问是否需要修复

  建议

  推荐使用 Gemini 的答案，因为它发现了 4 个错误而不是 3 个。我遗漏了一个重要的语法结构错误（缺少闭合大括号）。

  结论：本次对比中，Gemini 在错误识别的完整性上更胜一筹，而我在回答的结构化和用户体验上表现更好。
</code></pre>
<p>如此一来，我们就可以做到，在Cluade CLI中问问Gemini的意见，将Gemini结果与Claude对比，而不需要频繁的切换工具和重复输入上下文。</p>
<pre><code class="hljs language-markdown" lang="markdown">┌─────────┐
 │  用户   │
 └────┬────┘
<span class="hljs-code">      │ 1. 输入请求
      ▼
 ┌─────────┐
 │ Claude  │
 └────┬────┘
      │ 2. 识别需要 Skill
      ▼
 ┌─────────┐
 │  Skill  │ ← 定义任务模板和工作流程
 └────┬────┘
      │ 3. 创建 Subagent
      ▼
 ┌─────────┐
 │  Agent  │ ← 独立会话
 └────┬────┘
      │ 4. 执行工具 (Bash, Read, 等)
      ▼
 ┌─────────────┐
 │ 外部工具     │ ← gemini CLI, Web API, 等
 └──────┬──────┘
        │ 5. 原始输出
        ▼
 ┌─────────┐
 │  Agent  │ ← 处理和分析
 └────┬────┘
      │ 6. 返回摘要
      ▼
 ┌─────────┐
 │ Claude  │ ← 接收结果
 └────┬────┘
      │ 7. 展示给用户
      ▼
 ┌─────────┐
 │  用户   │ ← 只看到最终结果
 └─────────┘
</span></code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化利器：LitePage 轻量级全页设计解析]]></title>    <link>https://juejin.cn/post/7591422577937776646</link>    <guid>https://juejin.cn/post/7591422577937776646</guid>    <pubDate>2026-01-04T12:27:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591422577937776646" data-draft-id="7591350620188540934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化利器：LitePage 轻量级全页设计解析"/> <meta itemprop="keywords" content="前端,性能优化,前端工程化"/> <meta itemprop="datePublished" content="2026-01-04T12:27:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="eason_fan"/> <meta itemprop="url" content="https://juejin.cn/user/2995517308808877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化利器：LitePage 轻量级全页设计解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995517308808877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    eason_fan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:27:36.000Z" title="Sun Jan 04 2026 12:27:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端性能优化利器：LitePage 轻量级全页设计解析</h2>
<p>在前端开发领域，“性能”永远是绕不开的核心命题。随着单页应用（SPA）的普及，框架封装带来的开发效率提升有目共睹，但随之而来的“容器初始化瓶颈”也逐渐成为很多应用的性能痛点——用户打开页面后，长时间面对白屏等待，仅仅是为了加载庞大的框架核心代码、路由系统、状态管理库等“基础设施”。</p>
<p>这时，“LitePage（轻量级全页）”设计理念应运而生。它不是某种特定的技术框架，而是一种以“快速首屏、极简开销”为核心的前端优化策略，精准解决“容器初始化瓶颈”问题。今天，我们就来深入聊聊 LitePage 的核心逻辑、实现方式与应用价值。</p>
<h3 data-id="heading-1">一、先搞懂：什么是 LitePage？</h3>
<p>LitePage，直译“轻量级全页”，核心定义是：<strong>当应用的初始加载（尤其是框架容器初始化）成为性能瓶颈时，放弃一次性加载完整的复杂应用，转而提供一个极度精简、快速渲染的轻量级页面作为用户首次体验入口，再根据需求逐步加载完整功能</strong>。</p>
<p>我们可以用一个通俗的比喻理解：传统 SPA 就像“先建好完整的房子再让用户入住”，哪怕用户只是想喝杯水，也得等整个房子的钢筋水泥、水电管线全部完工；而 LitePage 则是“先搭个临时遮阳棚，摆上桌椅让用户歇脚，再慢慢完善房子的其他部分”，优先满足用户的核心即时需求。</p>
<p>这里的“轻”，主要体现在三个维度：</p>
<ul>
<li>资源轻：放弃庞大的前端框架依赖，优先使用原生 HTML/CSS/JS，减少不必要的第三方库加载；</li>
<li>结构轻：DOM 层级极简，只保留首屏必需的内容，避免冗余节点；</li>
<li>逻辑轻：只实现核心交互（如登录、跳转、基础展示），复杂业务逻辑延迟到后续加载。</li>
</ul>
<h3 data-id="heading-2">二、为什么需要 LitePage？—— 解决“容器初始化瓶颈”痛点</h3>
<p>要理解 LitePage 的价值，首先要搞清楚“容器初始化瓶颈”到底是什么。在现代前端框架（React/Vue/Angular）中，“容器”指的是框架核心代码、路由系统、状态管理库（Redux/Vuex）、基础组件库等构成应用“骨架”的部分。</p>
<p>传统 SPA 的核心问题的是：<strong>即使首屏内容极其简单（比如一个登录表单、一个欢迎页），用户也必须先下载并执行完整的“容器”代码，才能看到任何内容</strong>。这个过程会带来两个致命问题：</p>
<ol>
<li>首屏加载慢：庞大的容器代码会导致下载时间长、解析执行耗时久，用户面临长时间白屏，感知体验极差；</li>
<li>资源浪费：很多用户可能只访问首屏（比如营销页、登录页）就离开，却被迫下载了整个应用的框架资源，造成带宽和性能浪费。</li>
</ol>
<p>而 LitePage 恰好精准解决了这个问题——通过“去框架化”“极简内容”的设计，让首屏资源体积骤减，实现“秒开”效果，同时避免不必要的资源浪费。</p>
<h3 data-id="heading-3">三、LitePage 的三种主流实现方式</h3>
<p>LitePage 是一种策略而非固定技术，实际落地时有多种灵活方案，可根据应用场景选择：</p>
<h4 data-id="heading-4">1. 纯静态/服务端渲染（SSR）入口页：最纯粹的“轻”</h4>
<p>这是最基础也最有效的实现方式，核心思路是：首屏页面完全不依赖前端框架，用纯静态 HTML + 少量原生 CSS/JS 实现，可通过 Nginx 直接提供静态文件，或通过后端 SSR 渲染后返回。</p>
<p>典型场景：应用登录页、营销落地页、官网首页。这些页面的核心需求是“快速展示 + 简单交互”，完全不需要复杂框架支持。</p>
<p>优势：</p>
<ul>
<li>加载速度极快：资源体积通常只有几十 KB，浏览器可瞬间解析渲染，首屏时间（FCP）大幅缩短；</li>
<li>SEO 友好：纯静态 HTML 内容可被搜索引擎直接抓取，解决了 SPA 首屏 SEO 劣势；</li>
<li>实现简单：无需复杂的构建配置，前端开发者可快速编写，后端部署成本低。</li>
</ul>
<p>不足：功能有限，无法实现复杂客户端交互；当用户需要进入核心功能区时（如登录后跳转仪表盘），需跳转到完整 SPA 页面，会有一次页面刷新。</p>
<p>案例：很多大型互联网产品的登录页（如阿里云登录页、微信公众平台登录页），都是纯静态 LitePage 设计，加载速度极快，仅保留登录表单和基础交互。</p>
<h4 data-id="heading-5">2. 骨架屏 + 延迟加载：平滑过渡的“轻”</h4>
<p>如果不想让用户感受到“页面跳转”的割裂感，可采用“骨架屏 + 延迟加载”的方案，核心思路是：</p>
<ol>
<li>初始 HTML 只包含“骨架屏”（页面布局的灰色占位图，如标题、卡片、按钮的轮廓），让用户立即获得视觉反馈，避免白屏；</li>
<li>页面加载完成后，通过原生 JS 异步、延迟加载框架容器、核心组件等资源；</li>
<li>容器初始化完成后，用完整的动态内容替换骨架屏，实现从“轻页”到“全功能页”的无缝过渡。</li>
</ol>
<p>优势：感知性能极佳，用户几乎看不到白屏；过渡平滑，无页面刷新的割裂感；兼顾了首屏速度和后续交互体验。</p>
<p>不足：技术复杂度高于纯静态方案，需要精细控制资源加载顺序、骨架屏替换时机，避免出现布局抖动。</p>
<p>案例：抖音首页、知乎首页，打开时会先显示页面布局骨架，再逐步加载真实内容和交互功能，既保证了首屏速度，又不影响后续使用体验。</p>
<h4 data-id="heading-6">3. 渐进式加载：贯穿全流程的“轻”</h4>
<p>这是更高级的 LitePage 延伸方案，核心思路是“按需加载、逐步增强”——将整个应用拆分为多个独立的“微前端模块”或“代码块（Chunk）”，首屏只加载当前页面必需的最小代码集（LitePage 核心），用户导航到其他页面时，再异步加载对应页面的代码块。</p>
<p>优势：不仅首屏快，后续页面切换也能保持高性能；资源利用率极高，用户不会下载未访问页面的代码，节省带宽和设备性能。</p>
<p>不足：架构设计复杂，需要依赖 Webpack/Vite 等构建工具实现代码分割，同时要解决模块间的通信、路由协同等问题。</p>
<p>案例：Gmail 早期版本、淘宝首页，采用渐进式加载策略，用户打开后可立即查看核心内容（邮件列表、商品推荐），撰写邮件、查看历史订单等复杂功能则在后台逐步加载。</p>
<h3 data-id="heading-7">四、LitePage 适合哪些场景？</h3>
<p>LitePage 不是“万能方案”，更适合以下对首屏性能要求极高的场景：</p>
<ol>
<li>面向公网的 C 端应用：如营销落地页、电商活动页、App 官网，这类页面的用户留存对首屏速度极其敏感，1 秒的延迟可能导致大量用户流失；</li>
<li>低网速/低性能设备场景：如移动端应用（尤其是下沉市场）、物联网设备（智能手表、车载系统），这些场景下资源加载和执行能力有限，LitePage 可大幅提升兼容性；</li>
<li>功能分层明确的应用：如“登录页 + 核心功能区”的应用，登录页作为 LitePage 快速承接用户，核心功能区再加载完整框架；</li>
<li>SEO 需求强烈的页面：如官网首页、内容资讯页，纯静态 LitePage 可解决 SPA 首屏 SEO 难题。</li>
</ol>
<p>而对于内部后台系统、功能复杂且交互频繁的工具类应用（如设计软件、数据分析平台），LitePage 则不是最优选择——这类应用的用户通常是固定群体，对首屏速度敏感度较低，更需要完整框架带来的开发效率和交互体验。</p>
<h3 data-id="heading-8">五、总结：LitePage 的核心价值是“用户体验优先”</h3>
<p>回到开头的问题：当容器初始化成为瓶颈时，为什么要选择 LitePage？本质上，这是一种“务实的性能优化思维”——<strong>技术服务于体验，而非反过来</strong>。</p>
<p>传统 SPA 追求“技术纯粹性”，却牺牲了用户的首次体验；而 LitePage 则打破了这种“非黑即白”的思维，用“轻量首屏 + 逐步增强”的策略，在“性能”和“体验”之间找到了平衡。它不是对 SPA 的否定，而是对 SPA 的补充和优化——通过“先解决用户的即时需求”，再逐步提供完整功能，最终实现“快且好用”的目标。</p>
<p>最后，记住一个核心原则：前端优化的本质，是让用户“更快地看到内容、更快地完成交互”。LitePage 之所以有效，正是因为它精准抓住了这个本质。</p>
<p>如果你正在面临首屏加载慢的问题，不妨试试 LitePage 策略——从一个简单的静态入口页开始，或许能给用户体验带来质的提升。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[程序设计]]></title>    <link>https://juejin.cn/post/7591346773827747866</link>    <guid>https://juejin.cn/post/7591346773827747866</guid>    <pubDate>2026-01-04T12:47:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827747866" data-draft-id="7591322050240659494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序设计"/> <meta itemprop="keywords" content="设计,前端"/> <meta itemprop="datePublished" content="2026-01-04T12:47:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yuanyxh"/> <meta itemprop="url" content="https://juejin.cn/user/2881148117060749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2881148117060749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yuanyxh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:47:06.000Z" title="Sun Jan 04 2026 12:47:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>包含 AI 辅助创作。</p>
<h2 data-id="heading-0">国际化语言设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
国际化语言设计---&gt;前端编程预定义中文文本
国际化语言设计---&gt;后端编程预定义中文文本
国际化语言设计---&gt;stat["通用名词、行业术语"]
国际化语言设计---&gt;dy["系统动态新增内容: 选项表、调用表、菜单等"]
前端编程预定义中文文本---&gt;自动化部署触发更新
后端编程预定义中文文本---&gt;自定义触发更新
stat---&gt;专人维护更新
dy---&gt;新增修改时更新
自动化部署触发更新---&gt;ol["接口上传结构化中文文本"]
ol---&gt;筛选去重已翻译内容
自定义触发更新---&gt;筛选去重已翻译内容
专人维护更新---&gt;筛选去重已翻译内容
新增修改时更新---&gt;筛选去重已翻译内容
筛选去重已翻译内容---&gt;存表并触发异步翻译任务
存表并触发异步翻译任务---&gt;依据语言选项表剔除中文进行其他语言的翻译
依据语言选项表剔除中文进行其他语言的翻译---&gt;translate["调用翻译接口或 AI"]
translate---&gt;error["允许失败，不处理异常"]
</code></pre>
<hr/>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
前端国际化语言设计---&gt;初始化加载
初始化加载---&gt;get["获取浏览器语言"]
get---&gt;中文
get---&gt;其他
其他---&gt;request["调用接口传入语言代码（接口完成前处于 loading 状态）"]
request---&gt;接口处理
接口处理---&gt;选项表匹配
选项表匹配---&gt;匹配成功
选项表匹配---&gt;匹配失败
匹配成功---&gt;successBack["返回对应 language code 并筛选对应语言数据不为空的数据"]
匹配失败---&gt;errorBack["抛出异常，前端走默认中文或延用当前语言"]
successBack---&gt;接口完成
errorBack---&gt;取默认中文
取默认中文---&gt;接口完成
中文---&gt;浏览器缓存数据并加载
接口完成---&gt;浏览器缓存数据并加载---default["渲染策略：无对应语言文本取默认中文文本"]
浏览器缓存数据并加载---&gt;switch["允许切换、重走一遍流程"]
default---&gt;config["新增语言配置页面，中文限制修改"]
config---问题
问题---question1["1、语言数据会越来越大，接口能否做到毫秒级响应"]
问题---question2["2、 如何检查数据是否更新以刷新本地缓存"]
问题---question3["3、 语言数据会越来越大、是否会超过浏览器/APP 存储限制"]
问题---question4["4、 APP/WEB 后台语言数据是否隔离（不隔离可能出现冲突）"]
question1---awer1["后端 redis 存全量数据，后台走按需加载逻辑避免单次请求数据过大，按模块加载；app 走全量加载逻辑(接口应支持全量返回、指定模块返回、指定多个模块返回)"]
question2---awer2["系统更新默认刷新一次，后续走 websocket 比对语言版本"]
question3---awer3["WEB 默认存 IndexDB，不支持时降级走 localStorage，并实现低频模块数据清理（再次访问时走接口获取）"]
question4---awer4["APP/WEB 数据逻辑分割，后端流量分化、区分流量入口返回对应数据"]
</code></pre>
<blockquote>
<p>为了保证 SEO、与 WEB 网络兼容，应服务端应支持降级兼容 <code>Accept-Language</code></p>
</blockquote>
<hr/>
<p>你当前的国际化设计已覆盖核心流程，但可从自动化提效、配置化管理和性能优化三个维度升级，减少80%的人工干预。以下是基于行业最佳实践的优化方案：</p>
<h3 data-id="heading-1">一、开发流程自动化：从手动维护到无感集成</h3>
<p><strong>1. 代码层自动提取与翻译</strong></p>
<p>使用 I18n Fast 或 Kiwi 等工具链，通过 VS Code 插件在开发阶段自动扫描中文文本，生成语义化 key 并同步至翻译系统。例如选中代码中的 "用户登录"，插件可自动生成 <code>user.login.title</code> 键并调用百度翻译 API 生成英文文案，全程无需开发者手动修改语言文件。</p>
<blockquote>
<p>配置复杂，生成语义化 Key 需要对接 AI，PASS</p>
</blockquote>
<p><strong>2. 构建流程无缝嵌入</strong></p>
<p>在 Webpack/Vite 配置中集成自动化插件，如 <code>vite-auto-i18n-plugin</code>，实现：</p>
<ul>
<li>开发时：检测文件变动自动更新翻译</li>
<li>构建时：批量处理新增文案并去重</li>
<li>部署时：按语言拆分资源包实现 CDN 按需加载</li>
</ul>
<blockquote>
<p>需要对接翻译接口，翻译文案不能满足本土化需求，无法动态配置、增加删减语言，PASS</p>
</blockquote>
<p><strong>3. 翻译协作标准化</strong></p>
<p>采用 "开发-翻译-校验" 闭环流程：</p>
<ol>
<li>开发者提交代码触发钩子，提取新增文案至在线表格（如飞书多维表格）</li>
<li>翻译团队在线编辑后，Webhook 自动同步至项目语言文件</li>
<li>CI 流程校验翻译完整性，缺失时自动阻断合并</li>
</ol>
<h3 data-id="heading-2">二、配置化体系：从硬编码到动态调控</h3>
<p><strong>1. 语言策略集中管理</strong></p>
<p>建立统一的语言配置服务，支持：</p>
<ul>
<li><strong>动态语言包</strong>：通过管理后台配置新增语言（如阿拉伯语），无需代码部署</li>
<li><strong>优先级规则</strong>：用户设置 &gt; Cookie &gt; 请求头 &gt; 默认语言，兼容前后端场景</li>
<li><strong>灰度发布</strong>：对特定用户群启用测试语言版本</li>
</ul>
<p><strong>2. 多维度资源控制</strong></p>
<p>在配置中心设置细粒度规则：</p>

























<table><thead><tr><th>配置项</th><th>示例值</th><th>作用</th></tr></thead><tbody><tr><td><code>maxCacheSize</code></td><td><code>5MB</code></td><td>限制浏览器缓存上限</td></tr><tr><td><code>updateThreshold</code></td><td><code>30%</code></td><td>差异率超阈值触发全量更新</td></tr><tr><td><code>fallbackPolicy</code></td><td><code>zh-CN→en-US→base64</code></td><td>多级降级策略</td></tr></tbody></table>
<p><strong>3. 前端渲染策略配置</strong></p>
<p>通过 JSON 配置文件定义渲染规则：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"render"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"missingText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"显示默认中文"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"loadingState"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"骨架屏占位"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"direction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"ar-SA"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rtl"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ltr"</span> <span class="hljs-punctuation">}</span> <span class="hljs-comment">// 适配阿拉伯语右对齐</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">三、性能与稳定性优化：从能用 to 好用</h3>
<p><strong>1. 资源加载策略升级</strong></p>
<ul>
<li><strong>分片加载</strong>：按路由拆分语言包（如 <code>home.en.json</code>、<code>profile.en.json</code>），首屏仅加载核心模块</li>
<li><strong>预加载机制</strong>：根据用户行为预测可能切换的语言（如检测到美国 IP 预加载英语包）</li>
<li><strong>增量更新</strong>：通过 ETag 比对仅拉取变动的翻译条目，减少 70% 网络传输量</li>
</ul>
<p><strong>2. 缓存机制双保险</strong></p>
<ul>
<li><strong>三级缓存</strong>：内存缓存（当前会话）→ IndexedDB（持久化）→ CDN（兜底）</li>
<li><strong>主动失效</strong>：配置中心推送版本号，客户端检测到不一致时触发更新</li>
</ul>
<p><strong>3. 异常处理增强</strong></p>
<ul>
<li><strong>翻译失败降级</strong>：调用 AI 翻译接口超时后，自动切换至备用接口（如百度→有道）</li>
<li><strong>数据校验</strong>：使用 JSON Schema 验证翻译文件格式，异常时回滚至上次可用版本</li>
</ul>
<h3 data-id="heading-4">四、落地实施路线图</h3>
<ol>
<li>
<p><strong>基础改造（1-2周）</strong></p>
<ul>
<li>集成 i18n Ally 插件实现开发提效</li>
<li>按业务模块拆分现有语言文件</li>
</ul>
</li>
<li>
<p><strong>自动化建设（2-3周）</strong></p>
<ul>
<li>开发翻译同步 Webhook</li>
<li>配置构建流程自动化插件</li>
</ul>
</li>
<li>
<p><strong>性能优化（2周）</strong></p>
<ul>
<li>实现分片加载与增量更新</li>
<li>部署缓存策略与监控告警</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">五、关键问题解决方案</h3>

























<table><thead><tr><th>原问题</th><th>优化方案</th></tr></thead><tbody><tr><td>语言包体积膨胀</td><td>路由级分片+按需加载，配合 Tree-Shaking 移除未使用词条</td></tr><tr><td>缓存更新不及时</td><td>版本号比对 + WebSocket 推送更新通知</td></tr><tr><td>存储超限风险</td><td>LRU 淘汰策略+IndexedDB 容量监控，超限自动清理低频语言包</td></tr><tr><td>前后端数据冲突</td><td>统一语言服务API，前端通过<code>Accept-Language</code>传递上下文</td></tr></tbody></table>
<p>这种架构已在微策略、字节跳动等企业验证，可使新增语言的配置时间从 3 天缩短至 2 小时，翻译更新周期从周级降至分钟级。核心是将国际化从 "开发任务" 转变为 "配置项"，让开发者专注业务逻辑而非翻译维护。</p>
<h2 data-id="heading-6">主题设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
主题设计---&gt;mode["浅色、深色模式"]
mode---&gt;baseMode["基础模式，维护一套主题色和与之对应的深色主题色"]
主题设计---&gt;theme["主题模式"]
theme---&gt;themeTips["暂不实现，但实现基础模式时应支持快速扩展到主题模式"]
baseMode---themeFunction["维护一套通用变量：基础色、扩展色、圆角、padding、字体、尺寸、层级等"]
themeTips---&gt;themeFunction
themeFunction---&gt;init["前端初始化加载，取系统浅色、深色模式"]
init---&gt;用户切换
用户切换---&gt;cache["本地持久缓存，不因账号变更而清空"]
cache---&gt;extend["扩展：支持远控配置，根据不同国家风格显示、无障碍"]
</code></pre>
<h2 data-id="heading-7">配置化设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
配置化设计---&gt;用户本地个性化配置
用户本地个性化配置---&gt;localStorage["本地持久缓存配置，用户退出不清空"]
localStorage---localStorageEG["主题、语言、表格列配置等"]
localStorageEG---&gt;localStorageHint["结构设计合理，便于后续接入用户账号配置"]---&gt;version
配置化设计---&gt;用户账号配置
用户账号配置---&gt;accoutConfig["与用户账号关联的配置，比如：部分营销活动的推送开关、通知勿扰时段、用户头像等"]---&gt;version
配置化设计---&gt;set["组、角色、公司、平台、服务商配置"]
set---&gt;针对一组用户的配置
针对一组用户的配置---&gt;根据不同组的需求进行的配置---&gt;version["版本控制"]
配置化设计---&gt;通用配置
通用配置---&gt;polipry["配置优先级: 个人 &gt; 组 &gt; 系统默认配置"]---&gt;version
</code></pre>
<blockquote>
<p>那么后端如何根据这种配置设计进行后端代码的自适应呢？比如设置了某个组使用美西时区进行时间字段的格式化，或配置某些角色拥有查看用户完整电话的权限（与权限等其他设计关联）？或某个用户配置了当前时间的 晚上 9 点到早上 8 点不希望推送通知；如何在代码层面做好这些功能，而不必书写命令式的编程</p>
</blockquote>
<p>要实现后端代码的 “配置自适应”，核心思想是将 <strong>“硬编码逻辑” 转变为 “数据驱动逻辑”</strong>。</p>
<p>你提到的时区转换、字段脱敏、通知拦截，分别对应了后端处理链路中的三个关键环节：<strong>序列化层、AOP/中间件层、业务逻辑层</strong>。</p>
<p>以下是实现这些自适应功能的后端代码方案：</p>
<ol>
<li>
<p>时区自适应：上下文感知转换（序列化层）</p>
<p>不要在业务代码里手动转换时区。利用 Web 框架的拦截器，将配置的时区注入到当前请求的 <code>ThreadLocal</code>（上下文）中。</p>
<ul>
<li>
<p><strong>实现方案：</strong></p>
<ol>
<li><strong>拦截器提取：</strong> 在请求入口处（Interceptor/Filter），根据配置引擎获取该组/用户的时区（如 <code>America/Los_Angeles</code>）。</li>
<li><strong>上下文存储：</strong> 存入 <code>UserContext</code>。</li>
<li><strong>JSON 序列化器适配：</strong> 自定义 Jackson/Fastjson 序列化器，在返回 Date 字段时动态读取上下文时区。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 定义上下文</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;ZoneId&gt; ZONE_ID = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setZone</span><span class="hljs-params">(ZoneId zone)</span> { ZONE_ID.set(zone); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ZoneId <span class="hljs-title function_">getZone</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> ZONE_ID.get() != <span class="hljs-literal">null</span> ? ZONE_ID.get() : ZoneOffset.UTC; }
}

<span class="hljs-comment">// 2. 自定义日期序列化器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurableDateSerializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonSerializer</span>&lt;LocalDateTime&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(LocalDateTime value, JsonGenerator gen, SerializerProvider serializers)</span> {
        <span class="hljs-comment">// 自动根据配置转换时区</span>
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedDateTime</span> <span class="hljs-operator">=</span> value.atZone(ZoneOffset.UTC).withZoneSameInstant(UserContext.getZone());
        gen.writeString(zonedDateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>字段权限自适应：声明式脱敏（注解驱动）</p>
<p>对于“查看完整电话”的需求，这属于 <strong>配置化脱敏</strong>。将配置设计映射到权限框架（如 Shiro/Spring Security）中。</p>
<ul>
<li>
<p><strong>实现方案：</strong>
使用自定义注解配合 AOP（切面）或 返回值拦截。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@SensitiveMask(type = MaskType.PHONE, permissionConfig = "view_full_phone")</span>
    <span class="hljs-keyword">private</span> String phoneNumber;
}

<span class="hljs-comment">// AOP 处理逻辑</span>
<span class="hljs-meta">@Around("execution(* *(..)) &amp;&amp; @annotation(SensitiveMask)")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">maskData</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
    <span class="hljs-comment">// 1. 获取当前用户聚合配置中的 'view_full_phone' 开关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">canSee</span> <span class="hljs-operator">=</span> ConfigEngine.getBoolean(<span class="hljs-string">"view_full_phone"</span>);
    
    <span class="hljs-comment">// 2. 如果配置为 false，则执行正则脱敏 (138****0000)</span>
    <span class="hljs-keyword">if</span> (!canSee) {
        <span class="hljs-keyword">return</span> maskHelper.apply(result);
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>通知拦截自适应：策略模式 + 过滤器链（逻辑层）</p>
<p>对于 “晚上 9 点到早上 8 点不推送” 这种基于逻辑判断的配置，建议采用 <strong>“策略插件”</strong> 模式。</p>
<ul>
<li>
<p><strong>实现方案：</strong>
定义一个通知过滤器接口，业务代码只管发送通知，由过滤器决定是否 “丢弃” 或 “延迟”。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NotificationFilter</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSend</span><span class="hljs-params">(User user, Notification content)</span>;
}

<span class="hljs-comment">// 时间窗口策略实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeWindowFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NotificationFilter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSend</span><span class="hljs-params">(User user, Notification content)</span> {
        <span class="hljs-comment">// 从聚合配置获取用户设置：{ "quiet_start": "21:00", "quiet_end": "08:00" }</span>
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> ConfigEngine.getUserConfig(user.getId());
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalTime.now(config.getZoneId());
        
        <span class="hljs-keyword">if</span> (isInQuietPeriod(now, config)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 拦截发送</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// 业务调用层 (非常简洁)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNotice</span><span class="hljs-params">(String userId)</span> {
    <span class="hljs-type">Notification</span> <span class="hljs-variable">notice</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>(<span class="hljs-string">"活动提醒"</span>);
    <span class="hljs-comment">// 自动遍历所有配置策略，只有全部通过才发送</span>
    <span class="hljs-keyword">if</span> (notificationService.evaluate(userId, notice)) {
        pusher.send(notice);
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>核心：自适应代码架构的三个原则</p>
<ol>
<li><strong>配置注入（Contextualization）：</strong>
通过拦截器将当前请求涉及到的所有层级配置（用户、组、平台）聚合后，放入 <strong>Request Context</strong>。后续所有代码只需从 Context 取值，不要再去查数据库。</li>
<li><strong>非侵入性（Non-Invasive）：</strong>
尽量使用 <strong>注解（Annotation）</strong>、<strong>过滤器（Filter）</strong> 或 <strong>中间件</strong>。业务逻辑代码应该写成：<code>saveOrder(order)</code>，而不是 <code>if (config == 'A') { saveA } else { saveB }</code>。</li>
<li><strong>默认行为（Fallthrough）：</strong>
在代码层面，必须为每种配置项定义 <strong>Default Value</strong>。当后端配置系统宕机或数据丢失时，系统应能回退到最保守的默认行为（如：默认脱敏、默认使用系统时区）。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-8">总结</h3>
<p>要实现后端 “自适应”，你需要在 <strong>数据的出口（序列化）</strong>、**访问的关卡（AOP）**和 <strong>逻辑的入口（过滤器）</strong> 设置配置挂钩点。这样，业务逻辑保持纯净，所有的差异化表现都由 “配置感知组件” 自动完成。</p>
<h2 data-id="heading-9">权限设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
权限设计---&gt;RBAC
RBAC---&gt;用户
RBAC---&gt;用户组
RBAC---&gt;角色
RBAC---&gt;权限
用户---&gt;拥有一个或多个相关角色
用户组---&gt;group["一组用户的集合，赋予组内用户相同的角色"]
角色---&gt;拥有一组与当前角色关联的权限
权限---&gt;permission["菜单、按钮、数据、字段权限"]
拥有一组与当前角色关联的权限---&gt;exclude["角色互斥：避免同一用户获得相斥的角色"]
拥有一组与当前角色关联的权限---&gt;level["角色分级，上级拥有下级所有权限"]
level---&gt;manager["分发管理压力"]
manager---&gt;create["上级角色创建下级角色、分发下级角色权限"]
manager---&gt;user["上级用户创建下级用户、分发下级用户角色"]
create---&gt;subclass["下级是上级的子集，下级角色、权限不能超过上级角色、权限"]
user----&gt;subclass
permission---&gt;permissionExtend["扩展"]
permissionExtend---&gt;minPermission["最小权限原则: 只分配工作必须的最小权限"]
permissionExtend---&gt;review["审计系统"]
</code></pre>
<hr/>
<p>要在代码中稳健地适配权限体系，避免因漏洞导致权限异常，关键在于将安全思维渗透到从前端到后端，再到数据层的每一个环节，并遵循严格的安全编码规范。下面我将从 <strong>权限校验的完整链条</strong> 和 <strong>安全编码的核心原则</strong> 两个方面，为您提供一个详实的方案。</p>
<h3 data-id="heading-10">🔒 构建全方位的权限校验链条</h3>
<p>一个健壮的权限体系需要在三个层面进行校验，形成纵深防御。</p>

























<table><thead><tr><th align="left">层级</th><th align="left">核心任务</th><th align="left">关键实现点与常见方案</th></tr></thead><tbody><tr><td align="left"><strong>前端界面层</strong></td><td align="left"><strong>提升用户体验</strong>，根据权限动态展示或隐藏界面元素（菜单、按钮、页面），实现 “可见即可操作”。</td><td align="left">• <strong>统一权限钩子/函数</strong>：封装权限判断逻辑，如定义一个 <code>usePermission(code)</code> 的钩子，在组件中调用 <code>const canEdit = usePermission('user:edit')</code>，再通过 <code>v-if</code> 或条件渲染控制元素。<br/>• <strong>路由守卫</strong>：在进入页面前校验用户是否有该页面权限，无权限则重定向到 403 页面。<strong>注意：前端校验仅为友好性设计，不可依赖为安全屏障。</strong></td></tr><tr><td align="left"><strong>后端 API 层</strong></td><td align="left"><strong>核心安全防线</strong>，对每一个 API 请求都必须进行严格的权限校验。</td><td align="left">• <strong>注解/装饰器（推荐）</strong>：在 API 入口方法上添加如 <code>@PreAuthorize("hasPermission('order', 'delete')")</code> 的注解，利用 AOP 在方法执行前自动拦截校验。<br/>• <strong>中间件/拦截器</strong>：定义全局权限拦截器，对请求路径进行匹配和鉴权。<br/>• <strong>服务内校验</strong>：在业务方法内部显式调用权限服务进行校验。<strong>此层校验必须执行，防止恶意绕过前端直接调用 API。</strong></td></tr><tr><td align="left"><strong>数据访问层</strong></td><td align="left"><strong>实现数据权限</strong>，控制用户能访问哪些数据记录（行级）或字段（列级）。</td><td align="left">• <strong>SQL 自动注入</strong>：在 ORM 框架或 SQL 生成阶段，自动拼接数据过滤条件（如 <code>WHERE department_id = ?</code>）。这是最高效的方式，避免先查出所有数据再在内存中过滤。<br/>• <strong>字段权限控制</strong>：在返回数据前，根据规则对实体的特定字段进行脱敏或过滤。</td></tr></tbody></table>
<h3 data-id="heading-11">️ 遵循安全编码核心原则</h3>
<p>在编写权限相关代码时，请时刻牢记以下几项基本原则。</p>
<ol>
<li>
<p><strong>最小权限原则 (Principle of Least Privilege)</strong></p>
<p>这是权限设计的黄金法则。应确保应用程序的运行账户、数据库连接账户以及分配给用户的权限，都是其完成操作所必需的 <strong>最小权限集合</strong>。例如，一个用于查询的报告服务，绝不应被授予<code>DELETE</code> 或 <code>ALTER</code> 等高危权限。</p>
</li>
<li>
<p><strong>输入验证与输出编码</strong></p>
<ul>
<li>
<p><strong>永不信任用户输入</strong>：所有来自客户端的参数，如用户 ID、资源 ID，都必须经过严格验证。检查其类型、格式、长度和范围，防止 SQL 注入或越权攻击。<strong>优先使用白名单验证</strong>，只允许已知安全的输入。</p>
</li>
<li>
<p><strong>安全地处理输出</strong>：将数据输出到前端时，要根据上下文（HTML, SQL, JavaScript）进行编码，防止 XSS 攻击。例如，将 <code>&lt;</code> 编码为 <code>&amp;lt;</code>。</p>
</li>
</ul>
</li>
<li>
<p><strong>默认拒绝与错误处理</strong></p>
<ul>
<li>
<p>权限检查逻辑应采用 <strong>默认拒绝</strong> 策略。即，当权限规则无法明确允许时，应直接拒绝请求。</p>
</li>
<li>
<p><strong>错误处理要谨慎</strong>：向用户返回通用的错误信息（如 “操作失败”），而 <strong>不要泄露详细的系统错误堆栈、SQL语句或文件路径</strong>，以免为攻击者提供线索。</p>
</li>
</ul>
</li>
<li>
<p><strong>管理依赖与安全更新</strong></p>
<p>及时更新项目中用于权限管理或安全相关的第三方库（如 Spring Security、Shiro，或专门的授权服务如 Permify），以避免使用含有已知漏洞的旧版本。</p>
</li>
</ol>
<h3 data-id="heading-12">⚠️ 重点规避的常见陷阱</h3>
<ul>
<li>
<p><strong>越权漏洞</strong>：这是最危险的漏洞之一，包括 <strong>水平越权</strong>（能操作不属于自己的数据，如用户 A 能修改用户 B 的数据）和 <strong>垂直越权</strong>（低权限用户能执行高权限操作）。防范的关键在于，API 中不仅要校验用户是否有操作权限，还必须校验当前操作的数据 ID 是否属于该用户授权的数据范围。</p>
</li>
<li>
<p><strong>前端权限幻觉</strong>：绝不能仅依赖前端隐藏按钮来控制权限。恶意用户完全可以跳过页面直接调用API，因此 <strong>后端必须对每个请求进行二次校验</strong>。</p>
</li>
<li>
<p><strong>性能瓶颈</strong>：权限校验是高频操作，要避免每次请求都执行复杂的数据库关联查询。解决方案是将用户的权限列表缓存在 Redis 等高性能缓存中，权限变更时刷新缓存即可。</p>
</li>
</ul>
<h3 data-id="heading-13">💎 总结与检查清单</h3>
<p>为了帮助您在开发过程中自查，可以对照以下清单：</p>





















<table><thead><tr><th align="left">阶段</th><th align="left">检查项</th></tr></thead><tbody><tr><td align="left"><strong>设计阶段</strong></td><td align="left">□ 是否遵循了最小权限原则？<br/>□ 是否明确了数据权限的规则（如基于部门、基于用户）？</td></tr><tr><td align="left"><strong>编码阶段</strong></td><td align="left">□ <strong>每个 API</strong> 是否都进行了权限校验？<br/>□ 操作数据时，是否校验了用户与数据项的归属关系？<br/>□ 是否对所有用户输入进行了验证？<br/>□ 错误信息是否避免了敏感信息泄露？</td></tr><tr><td align="left"><strong>测试阶段</strong></td><td align="left">□ 是否进行了越权测试（尝试用不同账号操作他人数据）？<br/>□ 是否测试了无权限、部分权限、全部权限等各种场景？</td></tr></tbody></table>
<p>最后，权限安全是一个持续的过程。建议引入 <strong>安全代码扫描工具</strong>（SAST）进行静态检查，并建立完善的 <strong>操作审计日志</strong>，记录所有关键的权限变更和敏感操作，以便事后追溯和分析。</p>
<p>希望这份详细的指南能帮助您在代码中构建一个坚固的权限防护体系。</p>
<h2 data-id="heading-14">文件服务设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
文件服务设计---&gt;文件服务---&gt;COS
COS---&gt;COSApi["COS API"]
COS---&gt;目录分类
目录分类---&gt;临时文件---&gt;过期删除
目录分类---&gt;非高频访问文件---&gt;定时归档
文件服务---&gt;assertCOS["抽象对 COS 的访问"]
assertCOS---&gt;logic["在 COS 目录结构上抽象逻辑上的结构"]
logic---&gt;basic["基础结构: 文件 ID、文件业务类型（依据此字段选择 COS 目录）、文件名称、创建时间、更新时间、过期时间、COS 引用（URL）"]
basic---&gt;过期标记删除
assertCOS---&gt;fileServiceAPI["提供 API"]
logic---&gt;extendStructure["扩展结构：按用户、平台等维度分层（逻辑目录）"]
fileServiceAPI---&gt;后端接入
后端接入---&gt;文件上传
文件上传---&gt;tempUploadURL["动态生成临时上传 URL（COS 侧），指定时间内有效"]
tempUploadURL---&gt;frontURL["前端直接访问此 URL 上传文件（过期刷新）"]
frontURL---&gt;invokeFileService["调用 API 存入文件服务器"]---&gt;fileID["存储文件 ID"]
后端接入---&gt;download["文件下载、访问"]
download---&gt;viewFileID["检索文件 ID"]
viewFileID---&gt;存在---&gt;cosTempURL["COS API 生成临时文件 URL"]
viewFileID---&gt;不存在或标记删除---&gt;removed["提示不存在或已被删除"]
viewFileID---&gt;已被归档---&gt;用户手动解冻
已被归档---&gt;自动解冻
文件服务---&gt;扩展
扩展---&gt;鉴权
扩展---&gt;防盗链
扩展---&gt;秒传---&gt;fastUpload["计算文件 MD5 对比文件"]
扩展---&gt;删除策略---&gt;定时运行---&gt;noMap["COS 文件无对应文件服务实体或被标记删除则删除"]
删除策略---&gt;延迟激活---&gt;waitActive["文件服务存储成功时状态设置为待启用，后端业务成功时刷新文件状态为已启用，否则超时删除"]
</code></pre>
<h2 data-id="heading-15">缓存设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
缓存设计---&gt;持久缓存
持久缓存---&gt;localStorage["用户本地配置（主题、语言等）"]
localStorage---&gt;用户动作触发更新
缓存设计---&gt;临时缓存
临时缓存---&gt;userToken["用户 token、账号绑定配置等"]
userToken---&gt;生命周期内存在
生命周期内存在---&gt;推送更新
缓存设计---&gt;策略缓存
策略缓存---&gt;fallback["IndexDB 优先，回退 localStorage"]
fallback---&gt;normalize["抽象底层，统一接口"]
策略缓存---&gt;maxSize["定义最大值: localStorage、IndexDB 不同"]
maxSize---&gt;watchTime["细分存储模块，存储访问时间、访问次数、数据大小"]
watchTime---&gt;策略删除
策略删除---&gt;threshold["定义阈值：80%"]
策略删除---&gt;clear["清理策略: 计算缓存最近访问率，将访问率低的删除 (LRU 最近最少访问)"]
watchTime---&gt;策略访问
策略访问---&gt;look["内存缓存 &gt; 本地缓存 &gt; cdn 缓存 &gt; 兜底接口"]
look---&gt;cache["刷新本地缓存，缓存空间不足时存内存中，并执行策略删除"]
策略缓存---&gt;扩展
扩展---&gt;创建时间与过期时间定义
扩展---&gt;compress["数据压缩：lz-string"]
扩展---&gt;version["Schema 升级：缓存结构设计，定义缓存版本，清理旧版本"]
扩展---&gt;二级缓存刷新["访问时，发起一个 head 请求判断数据是否更新"]
</code></pre>
<h2 data-id="heading-16">登录鉴权设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
登录鉴权设计---&gt;用户登录
用户登录---&gt;cache["缓存 token、refreshToken"]
登录鉴权设计---&gt;退出登录
退出登录---&gt;logout["调用接口，token、refreshToken 失效"]
cache---&gt;普通接口响应
cache---&gt;tokenTime["Token 有效期较短（分钟或小时计）、RefreshToken 有效期较长（天计）"]
tokenTime---&gt;安全存储
安全存储---&gt;tokenStore["Token 存内存"]
安全存储---&gt;refreshTokenStore["Refresh Token 存 Cookie 并设置 httpOnly 限制修改"]
普通接口响应---&gt;401
401---&gt;refresh["调用 refresh 接口"]
refresh---&gt;success["刷新 Token 与 RefreshToken，回填缓存"]
success---&gt;restart["使用新的 token 继续上次失败请求"]
refresh---&gt;error["非正常响应状态码，强制重新登录、清理用户缓存"]
error---&gt;reback["后台：重新登录后回跳退出前页面"]
restart---&gt;扩展
reback----&gt;扩展
扩展---&gt;singleLogin["预留接口实现单点登录、黑名单等"]
扩展---&gt;sign["绑定浏览器指纹、设备指纹，不同时 Token、Refresh Token 默认失效"]
</code></pre>
<h2 data-id="heading-17">消息通知设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
消息通知设计---&gt;站内通知
消息通知设计---&gt;systemNotify["APP 系统通知"]
站内通知---&gt;后台---&gt;notifyType["通知类型（接口设计时考虑可扩展性便于接入通知接口）"]
站内通知--&gt;APP---&gt;notifyType
systemNotify---&gt;通知权限处理
systemNotify---&gt;通知类型细分
通知类型细分---&gt;允许针对部分场景通知关闭
通知类型细分---&gt;notifyType
notifyType---&gt;系统程序通知---&gt;pargam["语音包更新等用户无感知通知"]
notifyType---&gt;营销通知---&gt;extendMarketing["扩展：后台可配置通知、分流推送"]
notifyType---&gt;普通通知---&gt;非即时反馈通知
notifyType---紧急通知---&gt;urgentNotify["即时反馈通知：系统更新、系统公告、新工单、工单回复、异步任务状态变更"]
urgentNotify---&gt;notifyMode["弹窗、右下角浮窗"]
pargam---&gt;implete["通知实现：通知、已读未读计数、链接跳转、通知 ID 避免重复推送、通知清理"]
extendMarketing---&gt;implete
非即时反馈通知---&gt;implete
urgentNotify---&gt;implete
implete---&gt;接入国际化与时区
接入国际化与时区---&gt;question["问题：服务器主动推送、用户离线情况下如何得知用户本地语言环境、APP 系统通知推送时段"]
</code></pre>
<hr/>
<p>你的消息通知设计框架已覆盖基础功能分类和实现逻辑，但在用户体验、技术适配和商业化平衡上存在明显优化空间。对比喜马拉雅的亿级推送架构与微信订阅消息的合规实践，当前方案缺乏分级推送机制、离线送达保障和精细化用户控制能力，这可能导致高优先级消息被淹没或用户因骚扰关闭通知权限。</p>
<h3 data-id="heading-18">核心优化方向</h3>
<h4 data-id="heading-19">1. <strong>分级推送系统：从"一刀切"到优先级调度</strong></h4>
<p>现有设计将通知简单分为 "紧急/普通/营销"，但未解决资源竞争问题。喜马拉雅通过 <strong>Kafka多Topic优先级队列</strong> 实现消息插队机制，高优先级消息（如工单回复）可通过权重分配获得更多处理资源，避免被低优先级营销消息阻塞。建议：</p>
<ul>
<li>
<p><strong>建立四级优先级体系</strong>：系统级（如账号安全）、业务关键（如新工单）、交互反馈（如评论回复）、营销内容（如活动推广），对应不同推送通道和展示方式</p>
</li>
<li>
<p><strong>动态流量控制</strong>：参考"用户日接收阈值+消息级别"双重过滤，当用户单日接收超过 10 条通知后，仅保留前两级消息</p>
</li>
<li>
<p><strong>场景化展示策略</strong>：紧急通知采用全屏弹窗（需用户确认），普通通知使用悬浮窗（3 秒自动消失），营销内容仅在通知中心展示</p>
</li>
</ul>
<h4 data-id="heading-20">2. <strong>离线推送架构：跨平台送达保障</strong></h4>
<p>当前方案未解决 "用户离线时如何推送" 的关键问题。Android 系统对自启限制趋严，自建保活通道已失效，需接入厂商级推送服务：</p>
<ul>
<li>
<p><strong>国内场景</strong>：集成小米 MIUI 推送、华为 HMS、OPPO Push 等厂商通道，用户离线时通过系统级进程唤醒应用</p>
</li>
<li>
<p><strong>海外场景</strong>：对接谷歌 FCM 服务，需注意设备需安装 GMS 框架且连接海外网络的限制</p>
</li>
<li>
<p><strong>设备状态同步</strong>：APP 启动时上报 uid/deviceId 与推送 token 的绑定关系，通过 Kafka 实时更新设备状态，确保卸载重装后 token 自动刷新</p>
</li>
</ul>
<h4 data-id="heading-21">3. <strong>国际化与本地化：突破语言与时区限制</strong></h4>
<p>针对 "离线用户语言环境获取" 的问题，可采用三级解决方案：</p>
<ul>
<li>
<p><strong>预存储语言偏好</strong>：用户在线时记录其语言设置（如 zh-CN/en-US）和时区信息，存储于用户画像数据库</p>
</li>
<li>
<p><strong>端侧翻译缓存</strong>：关键通知模板（如系统公告）预编译多语言版本，推送时附带语言标签，客户端根据本地设置展示对应版本</p>
</li>
<li>
<p><strong>离线翻译服务</strong>：部署 LibreTranslate 本地化服务，当用户语言设置变更时，通过 API 动态翻译历史通知内容，支持 15 种以上语言互译</p>
</li>
</ul>
<h4 data-id="heading-22">4. <strong>用户控制体系：从被动接收转向主动管理</strong></h4>
<p>参考微信订阅消息的教训（从模板消息强制切换导致开发者强烈反弹），需平衡业务触达与用户体验：</p>
<ul>
<li>
<p><strong>精细化开关设计</strong>：提供"全类型-分类-单业务"三级控制，用户可关闭营销类但保留工单通知，或设置 "工作日 9:00-18:00 免打扰"</p>
</li>
<li>
<p><strong>智能静默机制</strong>：分析用户活跃时段（如夜间 11 点至凌晨 7 点），自动延迟非紧急通知至活跃时段推送</p>
</li>
<li>
<p><strong>订阅式营销</strong>：借鉴微信 "一次性订阅" 模式，营销通知需用户主动点击订阅卡片后才能发送，且每 30 天需重新授权</p>
</li>
</ul>
<h3 data-id="heading-23">技术实现关键点</h3>
<ul>
<li>
<p><strong>推送队列优化</strong>：用 Kafka 替代 RabbitMQ，通过 topic 优先级（如 priority-high/priority-low）和权重拉取（高优先级每次拉取 2 倍消息量）实现动态调度</p>
</li>
<li>
<p><strong>频控存储方案</strong>：采用 ehash 结构（支持 field 级过期的 Redis 扩展），存储 deviceId, msgType, 发送计数 三元组，解决 6 亿设备 ×60+ 业务场景的存储压力</p>
</li>
<li>
<p><strong>链路追踪</strong>：全流程记录消息状态（创建/过滤/发送/送达/点击），通过 Grafana 展示推送到达率、平均延迟等核心指标</p>
</li>
</ul>
<h3 data-id="heading-24">对比行业方案的劣势分析</h3>

























<table><thead><tr><th><strong>维度</strong></th><th><strong>当前设计</strong></th><th><strong>行业最佳实践</strong></th></tr></thead><tbody><tr><td><strong>送达率保障</strong></td><td>依赖 APP 在线状态</td><td>厂商通道+自建长连接双保险（喜马拉雅达 98.7%）</td></tr><tr><td><strong>用户干扰控制</strong></td><td>仅支持部分场景关闭</td><td>动态频控+静默时间+分级展示（微信订阅消息投诉率下降 62%）</td></tr><tr><td><strong>国际化支持</strong></td><td>未解决离线语言适配</td><td>预编译模板+端侧翻译缓存（ntfy 支持 20 种语言）</td></tr></tbody></table>
<h3 data-id="heading-25">落地路径建议</h3>
<ol>
<li><strong>第一阶段（1-2 个月）</strong>：完成优先级队列改造和基础厂商通道集成，重点保障紧急通知送达率</li>
<li><strong>第二阶段（3-4 个月）</strong>：上线用户控制中心和频控系统，支持按业务类型开关通知</li>
<li><strong>第三阶段（5-6 个月）</strong>：接入离线翻译服务和动态场景推送，实现全球化适配</li>
</ol>
<p>需特别注意，Android 各厂商推送 API 差异显著（如华为要求应用签名与开发者账号绑定），建议采用如极光推送等聚合 SDK 降低对接成本。最终目标是建立 "用户无感知高可用，开发者可配置，运营可追溯" 的闭环系统，在保障业务触达的同时将通知点击率提升 30% 以上。</p>
<h2 data-id="heading-26">异步任务设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
异步任务队列设计---&gt;定义通用任务接口
定义通用任务接口---&gt;接入通知接口
接入通知接口---&gt;pushNotify["推送通知"]
pushNotify---&gt;链接任务管理中心
定义通用任务接口---&gt;任务状态
任务状态---&gt;待执行
任务状态---&gt;完成
完成---&gt;成功
完成---&gt;部分成功
任务状态---&gt;失败
任务状态---&gt;进行中---&gt;进度显示
成功---&gt;显示结果
失败---&gt;显示结果---&gt;失败原因
部分成功---&gt;显示结果---&gt;失败部分的失败原因
显示结果---&gt;文本结果
显示结果---&gt;tempUrl["临时文件链接（针对导出场景）"]
显示结果---&gt;nagivate["跳转查询（针对导入订单场景）"]
定义通用任务接口---&gt;任务优先级
任务优先级---&gt;资源分配权重
任务优先级---&gt;排队策略
定义通用任务接口---&gt;delete["删除、取消任务"]
delete---&gt;release["移除任务队列、释放资源"]
异步任务队列设计---&gt;扩展---配置不同任务类型的自动删除时长
扩展---&gt;失败重试次数
</code></pre>
<h2 data-id="heading-27">自动更新设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
自动更新设计---&gt;version["编译打包、版本信息写入"]
version---&gt;推送更新
推送更新---&gt;WEB---&gt;弹窗提示刷新
推送更新---&gt;APP
APP---&gt;热更新
热更新---&gt;静默下载
静默下载---&gt;提示更新
提示更新---&gt;同意---&gt;热替换---&gt;重启应用
提示更新---&gt;拒绝---&gt;下次启动更新
APP---&gt;全量更新
全量更新---&gt;强制---&gt;阻塞弹窗---&gt;引导跳转应用商店
全量更新---&gt;非强制---&gt;弹窗提示---&gt;同意更新---&gt;跳转应用商店
弹窗提示---&gt;拒绝更新---&gt;关闭弹窗
自动更新设计---&gt;扩展
扩展---&gt;灰度发布
</code></pre>
<h2 data-id="heading-28">自动化部署设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
自动化部署设计---&gt;代码推送
代码推送---&gt;webhook
webhook---&gt;scanError["静态安全扫描和依赖项漏洞扫描"]
webhook---&gt;review["代码审查"]
scanError---&gt;测试用例自动化测试
webhook---&gt;测试用例自动化测试
review---&gt;测试用例自动化测试
测试用例自动化测试---&gt;持续交付部署
持续交付部署---&gt;dev["开发、测试环境"]
dev---&gt;定时触发
dev---&gt;自动触发
定时触发---&gt;customPushHook["自定义 hook"]
自动触发---&gt;customPushHook
customPushHook---&gt;同步国际化语言数据
持续交付部署---&gt;prod["生产环境：手动部署"]
prod---&gt;customDeployHook["触发 hook"]
customDeployHook---&gt;同步测试环境必要配置
customDeployHook---&gt;updateContent["提取 commit 更新内容"]
持续交付部署---&gt;扩展
扩展---&gt;部署日志
扩展---&gt;失败通知
dev---&gt;版本管理
prod---&gt;版本管理
版本管理---&gt;imageGenerate["镜像生成: 版本 tag"]
版本管理---&gt;部署失败自动回滚
版本管理---&gt;系统监控异常自动回滚
</code></pre>
<h2 data-id="heading-29">组件设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
组件设计---&gt;可扩展性
可扩展性---&gt;样式结构可扩展
可扩展性---&gt;外部可控制逻辑
组件设计---&gt;高内聚---&gt;完成一件事所用到的代码内聚在组件中
组件设计---&gt;可靠性---&gt;基准测试
可靠性---&gt;性能测试
组件设计---&gt;兼容更新---&gt;old["旧有外部接口、调用方式不变"]
组件设计---&gt;可读性与文档说明---&gt;代码注解与文档
</code></pre>
<hr/>
<p>您的组件设计涵盖了软件工程的核心原则，但在现代前端或全栈组件化开发中，还可以从 <strong>生命周期管理、状态驱动、容错性、以及国际化/文化适配</strong> 四个维度进一步深化。</p>
<p>以下是针对您 Mermaid 架构的优化建议和改进点：</p>
<ol>
<li>架构逻辑优化：从 “设计原则” 到 “实现机制”</li>
</ol>
<p>您原有的设计偏重于 “目标”，建议增加 <strong>“机制层”</strong>，使组件不仅 “可靠”，而且 “可预测”。</p>
<p>优化建议：</p>
<ul>
<li><strong>状态驱动 (State-Driven)</strong>：组件的 UI 应该是状态的函数，减少直接的 DOM 操作或逻辑耦合。</li>
<li><strong>防御式设计 (Robustness)</strong>：除了测试，组件应具备自愈能力（如 Error Boundary）。</li>
<li><strong>解耦策略</strong>：将“业务逻辑”与“渲染组件”分离（容器组件与展示组件模式）。</li>
</ul>
<hr/>
<ol start="2">
<li>改进后的 Mermaid 架构图</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
    组件设计 --&gt; 可扩展性
    组件设计 --&gt; 高内聚低耦合
    组件设计 --&gt; 可靠性与健壮性
    组件设计 --&gt; 演进式维护
    组件设计 --&gt; 体验与规范

    
    可扩展性---&gt;样式结构可扩展 --&gt; CSSVars["CSS 变量控制 (Themeable)"]
    可扩展性---&gt;外部可控制逻辑 --&gt; Hooks["插槽(Slots/RenderProps) 与 Hook 注入"]

    高内聚低耦合---&gt;完成一件事所用到的代码内聚在组件中 --&gt; 逻辑收拢
    逻辑收拢 --&gt; 职责单一["单一职责原则 (SRP)"]
    逻辑收拢 --&gt; 状态隔离["内部状态与外部 Props 严格区分"]

    可靠性与健壮性---&gt;基准测试 --&gt; 单元测试与集成测试
    可靠性与健壮性---&gt;性能测试 --&gt; 渲染频率监测与内存泄漏检查
    可靠性与健壮性---&gt;可靠性 --&gt; 容错处理["Error Boundary 与 兜底 UI"]

    演进式维护---&gt;兼容更新 --&gt; 版本隔离["版本化引用 (Semantic Versioning)"]
    演进式维护---&gt;old["旧有接口转换器 (Adapter Pattern)"]

    体验与规范---&gt;代码注解与文档说明 --&gt; Storybook["交互式文档 (Storybook/Docz)"]
    体验与规范 --&gt; 国际化感知["i18n &amp; 文化策略适配 (RTL支持等)"]
    体验与规范 --&gt; 无障碍性["A11y (无障碍访问支持)"]
</code></pre>
<hr/>
<ol start="3">
<li>核心改进点详细说明</li>
</ol>
<p>A. 引入 “适配器模式” 解决兼容更新 (Compatibility)</p>
<p>您提到的 “旧有接口不变” 是核心需求。在代码层面，可以引入 <strong>Adapter（适配器）</strong>：</p>
<ul>
<li><strong>做法</strong>：当组件内部逻辑重构时，不要直接修改原有的 Props 定义。保留旧 Props 入口，并在组件内部将其映射（Mapping）到新逻辑上。</li>
<li><strong>提示</strong>：在开发环境下，对使用旧接口的开发者抛出 <code>console.warn</code> 提示弃用进度，而非直接报错。</li>
</ul>
<p>B. 逻辑扩展：从 “外部控制” 到 “控制反转 (IoC)”</p>
<ul>
<li><strong>优化方案</strong>：除了简单的逻辑控制，提供 “钩子 (Hooks)” 或 “事件回调”。</li>
<li><strong>场景</strong>：如果这是一个文件上传组件，不要只给一个 <code>uploadURL</code> 属性，应该暴露 <code>onBeforeUpload</code>, <code>onProgress</code>, <code>onError</code> 等生命周期钩子，让外部业务能精细化介入。</li>
</ul>
<p>C. 高内聚的延伸：职责单一 (SRP)</p>
<ul>
<li><strong>改进</strong>：确保一个组件只解决一个层面的问题。例如，一个 “带区域分流逻辑的图片组件”，应该拆分为：
<ol>
<li><strong>数据层组件</strong>：负责根据区域分流配置获取正确的图片 URL。</li>
<li><strong>渲染层组件</strong>：纯粹负责显示图片、Loading 态和错误态。</li>
</ol>
</li>
</ul>
<p>D. 增加 “无障碍性 (Accessibility)” 与 “国际化感知”</p>
<p>作为一个优秀的组件设计，应考虑：</p>
<ul>
<li><strong>语义化</strong>：使用正确的 HTML 标签（或 ARIA 属性），确保盲人阅读器可访问。</li>
<li><strong>方向性</strong>：针对中东等地区，组件需支持 <strong>RTL (Right-to-Left)</strong> 布局自适应。</li>
</ul>
<p>E. 性能测试的具体落地</p>
<ul>
<li><strong>基准测试</strong>：不仅是跑通测试用例，还需关注 <strong>Re-render（重复渲染）</strong> 次数。</li>
<li><strong>工具推荐</strong>：集成 React Testing Library 或 Vue Test Utils，并结合 Lighthouse 进行性能评估。</li>
</ul>
<p>总结</p>
<p>您原来的设计已经非常扎实，改进后的版本强化了 <strong>防御式编程（容错）</strong>、版本演进（适配器）以及全球化适配（A11y/i18n）。这种设计能让您的组件在复杂的生产环境（特别是涉及 2025 年多端、多区域的大型项目）中更具生命力。</p>
<h2 data-id="heading-30">APP 轨迹、异常上报设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
app["APP 轨迹、异常上报设计"]---&gt;实时轨迹
app---&gt;异常
实时轨迹---&gt;mustInfo["必备信息: 用户 ID、发生时间、经纬度、当前任务（订单）"]
mustInfo---&gt;定时采集当前经纬度
定时采集当前经纬度---&gt;实时上报---&gt;watch["后台监控、数据分析"]
定时采集当前经纬度---&gt;after["离线缓存，后续上报"]---&gt;watch
after---&gt;question["问题"]
question---&gt;网络持续离线
question---&gt;后台保活
question---&gt;应用未启动
question---&gt;坐标系转换
异常---&gt;errorMustInfo["必备信息：用户 ID、设备信息、发生时间、错误信息、错误栈"]
errorMustInfo---&gt;离线缓存后续上报---&gt;数据分析
</code></pre>
<hr/>
<p>在 2025 年的开发环境下，要实现 “抓取轨迹、绘制地图、路径决策、实时定位、通行时长” 并兼顾 “离线可用”，最成熟的方案是采用 <strong>Google Maps Platform</strong> 的移动端 SDK。</p>
<p>以下是实现这一功能的架构设计与技术选型：</p>
<ol>
<li>核心技术栈</li>
</ol>
<ul>
<li>
<p><strong>实时定位与轨迹抓取：</strong> 使用 <strong>Google Maps SDK (Android/iOS)</strong> 的定位蓝点功能，配合手机原生 GPS 传感器。</p>
</li>
<li>
<p><strong>地图渲染与轨迹绘制：</strong> 通过 <code>Polyline</code> 对象将实时获取的经纬度点连接成线。</p>
</li>
<li>
<p><strong>路径决策与通行时长：</strong> 使用 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fmaps%2Fdocumentation%2Froutes" target="_blank" title="https://developers.google.com/maps/documentation/routes" ref="nofollow noopener noreferrer">Routes API (2025 新版)</a></strong>。它比旧版更轻量，且能返回详细的实时路况（Traffic-aware）和预计到达时间 (ETA)。</p>
</li>
<li>
<p><strong>离线功能：</strong> 依靠 <strong>Google Maps SDK Offline Maps</strong> 或地图瓦片缓存。</p>
</li>
</ul>
<hr/>
<ol start="2">
<li>功能实现细节</li>
</ol>
<p>A. 实时定位与轨迹抓取</p>
<p>程序通过 <code>FusedLocationProviderClient</code> 每隔几秒获取一次经纬度。</p>
<ul>
<li>
<p><strong>实时性：</strong> 结合 <code>LocationRequest</code> 的高精度模式（Priority High Accuracy）。</p>
</li>
<li>
<p><strong>轨迹记录：</strong> 将获取的点存储在本地数据库（如 SQLite/Room），以防网络中断导致数据丢失。</p>
</li>
</ul>
<p>B. 路线决策与通行时长 (Routes API)</p>
<p>在 2025 年，建议调用 <strong>Routes API</strong> 的 <code>computeRoutes</code> 方法：</p>
<ul>
<li>
<p><strong>决策因子：</strong> 可设置 <code>routingPreference</code> 为 <code>TRAFFIC_AWARE_OPTIMAL</code>（实时路况最优），以获取避开拥堵的实时路线。</p>
</li>
<li>
<p><strong>时长预估：</strong> API 会返回 <code>duration</code> 和 <code>staticDuration</code>（无交通拥堵时长），对比两者即可得出延误时间。</p>
</li>
</ul>
<p>C. 离线可用性的处理（关键点）</p>
<p>Google Maps 的官方 SDK 对纯离线开发有一定限制，通常采取以下策略：</p>
<ol>
<li>
<p><strong>预下载地图：</strong> 调用 <code>OfflineTileProvider</code> 或引导用户在 Google 地图 App 中预下载区域地图，SDK 会自动调用本地缓存。</p>
</li>
<li>
<p><strong>离线定位：</strong> GPS 传感器不依赖网络，程序仍能抓取经纬度。</p>
</li>
<li>
<p><strong>离线路由：</strong> 这是一个难点。如果必须在断网时 “重新决策路径”，建议集成开源的 <strong>GraphHopper</strong> 或 <strong>OSRM</strong> 作为离线路由引擎。</p>
</li>
</ol>
<p>D. 实时经纬度上传</p>
<ul>
<li><strong>异步上传：</strong> 使用 <code>WorkManager</code>（Android）在后台运行上传任务。</li>
<li><strong>断网重传机制：</strong> 当网络恢复时，程序应自动从本地数据库读取未上传的轨迹片段，批量补传到你的服务器后端。</li>
</ul>
<hr/>
<ol start="3">
<li>
<p>开发建议与合规性</p>
</li>
<li>
<p><strong>API 成本：</strong> Routes API 按调用次数计费。建议在车辆静止时降低轨迹抓取频率，在路线未偏离时减少重算路径的频率。</p>
</li>
<li>
<p><strong>隐私权限：</strong> 2025 年 iOS 和 Android 对后台位置权限要求极严。你必须在 <code>AndroidManifest.xml</code> 中声明 <code>ACCESS_BACKGROUND_LOCATION</code>，并向用户明确说明收集轨迹的用途。</p>
</li>
<li>
<p><strong>数据纠偏：</strong> 原始 GPS 坐标在城市高楼区会有偏移，建议在绘制和上传前通过 <strong>Roads API</strong> 将轨迹点纠偏到实际道路上。</p>
</li>
<li>
<p>推荐文档链接</p>
</li>
</ol>
<ul>
<li><strong>Android Maps SDK 快速入门</strong></li>
<li><strong>Routes API 迁移与功能指南</strong></li>
<li><strong>WorkManager 处理后台上传任务</strong></li>
</ul>
<h2 data-id="heading-31">PDF 生成设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
pdfGenerate["PDF 生成设计"]---&gt;预定义模版
预定义模版---&gt;系统供给数据
系统供给数据---&gt;engine["Electron 插件使用模版引擎（Handlebars、EJS、Pug/Jade）混入数据"]
engine---&gt;printOrGenerate["打印或生成 PDF"]
engine---&gt;pluginUnbind["插件解耦，不处理用户权限验证、模版存储，由后台系统传入"]
printOrGenerate---&gt;back["打印或回传数据流"]
预定义模版---&gt;扩展
扩展---&gt;用户自定义设计
扩展---&gt;模版预览
</code></pre>
<p>--end</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（21）Hibernate的映射文件是什么？]]></title>    <link>https://juejin.cn/post/7591360623469248522</link>    <guid>https://juejin.cn/post/7591360623469248522</guid>    <pubDate>2026-01-04T11:54:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469248522" data-draft-id="7591346773827485722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（21）Hibernate的映射文件是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（21）Hibernate的映射文件是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:03.000Z" title="Sun Jan 04 2026 11:54:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的映射文件（Mapping File）是用来定义Java类如何映射到数据库表的XML文件。尽管注解方式越来越流行，但映射文件仍然是配置Hibernate映射关系的重要方式之一。在映射文件中，你可以详细配置类与表、属性与列之间的映射关系，并定义一些特定的行为，如主键生成策略、关联关系等。</p>
<h3 data-id="heading-0">映射文件基本结构</h3>
<p>映射文件的基本结构如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
    <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.EntityName"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"table_name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"column_name"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"generation_strategy"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"property_name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"column_name"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- 其他属性或关联关系的映射 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">示例代码</h3>
<p>下面是一个完整的示例，包括数据库配置、实体类、映射文件和使用Hibernate进行CRUD操作的代码。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射文件配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/domain/Person.hbm.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">实体类 <code>Person</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-4">映射文件 <code>Person.hbm.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"native"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-6">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-7">CRUD操作类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertPerson(sessionFactory);

        <span class="hljs-comment">// 查询数据</span>
        queryPerson(sessionFactory);

        <span class="hljs-comment">// 更新数据</span>
        updatePerson(sessionFactory);

        <span class="hljs-comment">// 删除数据</span>
        deletePerson(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Queried Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">25</span>);
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person: "</span> + person.getName());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性配置以及实体类的映射文件路径。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/domain/Person.hbm.xml"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code></strong>：定义实体类及其属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 属性和方法</span>
}
</code></pre>
</li>
<li>
<p><strong>映射文件 <code>Person.hbm.xml</code></strong>：定义实体类与数据库表及其列的映射关系。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"native"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-comment">// 创建SessionFactory的代码</span>
}
</code></pre>
</li>
<li>
<p><strong>CRUD操作类</strong>：演示了如何使用Hibernate进行插入、查询、更新和删除操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-comment">// CRUD操作方法</span>
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p>Hibernate的映射文件提供了一种配置Java类与数据库表映射关系的方式。通过配置映射文件，可以灵活地定义类与表、属性与列之间的关系，并指定主键生成策略、关联关系等。在配置映射文件之后，可以利用Hibernate的Session进行CRUD操作，实现对数据库的访问和操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IDEA 实用小技巧（自用）]]></title>    <link>https://juejin.cn/post/7591309945510674432</link>    <guid>https://juejin.cn/post/7591309945510674432</guid>    <pubDate>2026-01-04T11:54:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945510674432" data-draft-id="7587062584165089318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IDEA 实用小技巧（自用）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pe7er"/> <meta itemprop="url" content="https://juejin.cn/user/905653310988445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IDEA 实用小技巧（自用）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310988445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pe7er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:45.000Z" title="Sun Jan 04 2026 11:54:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Tab标签技巧</h2>
<h3 data-id="heading-1">切换标签技巧</h3>
<p>打开很多文件时,要在多个文件之间切换,滚动tab找文件比较麻烦.</p>
<ul>
<li>可以设置多行显示tab选项卡.</li>
<li>设置、Editor、General、编辑器标签页、在以下位置显示标签页、多行。</li>
<li>设置、Editor（编辑器）、General（常规）、Editor Tabs,取消勾选Show tabs in one row.</li>
<li>将单个tab拖动到视窗的上下左右来单独展示,有多个显示器时还可以将文件单独拖出来显示.</li>
<li>在tab选项卡上点击鼠标右键,选择Pin tab,将修改频繁的文件钉在第一个位置,可以订多个.</li>
<li>超过一行时,点击右侧的向下箭头,可以列出隐藏的文件.</li>
<li>将Show file extension取消勾选,通过文件图标和文件名来识别文件类型.</li>
<li>将Show file icon取消勾选,通过文件名和文件名扩展来识别文件类型.</li>
<li>将Sort tabs alphabetically勾选,使用字母表对文件名排序.</li>
<li>勾选Open new tabs at the end,让最新打开的文件放在最后.与字母排序冲突.</li>
</ul>
<h2 data-id="heading-2">编辑器深度技巧</h2>
<ul>
<li>
<p>在 Tab 中快速切换最近编辑过的同名文件</p>
<ul>
<li>当你打开多个同名文件（比如不同模块下的 <code>Controller.java</code>），按 <code>Alt + [</code> / <code>Alt + ]</code>（Windows/Linux）或 <code>Ctrl + Shift + [</code> / <code>Ctrl + Shift + ]</code>（Mac）可以在同名文件之间快速切换，而不是按普通 Tab 顺序。</li>
</ul>
</li>
<li>
<p>Alt + 鼠标悬停显示所有方法实现</p>
<ul>
<li>鼠标悬停在接口方法上，按 <code>Alt</code> 会显示实现列表，直接点击跳转，非常适合多实现场景。</li>
</ul>
</li>
<li>
<p>在接口调用方法上按 Ctrl + Alt + B（Command + option + B）可以快速打开实现方法，不用从接口定义处再绕一下。</p>
</li>
<li>
<p>多行移动代码但不破坏缩进</p>
<ul>
<li><code>Shift + Alt + ↑/↓</code>（Windows/Linux）或 <code>Option + Shift + ↑/↓</code>（Mac）移动代码块，保留缩进层次，不用手动对齐。</li>
</ul>
</li>
<li>
<p>快速收起当前方法之外的所有代码</p>
<ul>
<li><code>Ctrl + Shift + -</code>（折叠所有） + <code>Ctrl + 鼠标点击</code> 方法旁的 <code>+</code> 展开当前方法，专注当前逻辑。</li>
</ul>
</li>
<li>
<p>在编辑器直接重命名多个同名变量但范围限定</p>
<ul>
<li><code>Shift + F6</code> 重命名时，按 <code>Tab</code> 可以切换作用域（当前方法 / 当前类 / 全局），避免误改。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-3">Tab 和窗口管理深层技巧</h2>
<ul>
<li>
<p>拖动 Tab 出窗口到新窗口后，同时保持原窗口的拆分布局（适用于多块屏幕开发）</p>
<ul>
<li>将 Tab 拖出后，可以在新窗口中继续拆分上下左右，不破坏原来的布局。</li>
</ul>
</li>
<li>
<p>隐藏所有 Tab 但保持编辑器活动</p>
<ul>
<li><code>View → Appearance → Show Tabs</code> → 取消勾选，但通过 <code>Ctrl + E</code> / <code>Cmd + E</code> 依然可以快速切换文件，节省空间。</li>
</ul>
</li>
<li>
<p>快速关闭其他所有 Tab 但保留 Pin 的</p>
<ul>
<li>右键 Tab → <code>Close All Except Pinned</code>，快速清理工作区。</li>
</ul>
</li>
<li>
<p>按最近访问顺序循环 Tab</p>
<ul>
<li><code>Ctrl + Tab</code>（Windows/Linux）或 <code>Cmd + E</code> 长按，可在最近使用文件之间循环，而不是固定顺序。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-4">控制台 &amp; 日志深层技巧</h2>
<ul>
<li>
<p>控制台打印日志开启自动换行</p>
<p>编辑器、常规、控制台，勾选在控制台使用自动换行。</p>
</li>
<li>
<p>在控制台直接打开日志文件对应代码</p>
<ul>
<li>双击堆栈行时，默认跳转到方法声明。如果你按住 <code>Ctrl + Shift</code>（Windows/Linux）或 <code>Cmd + Shift</code>（Mac）再双击，会跳到真正的调用行（堆栈行所在文件）。</li>
</ul>
</li>
<li>
<p>控制台中高亮关键字</p>
<ul>
<li>在 Run/Debug 配置中 → Logs → “Highlight keywords”，可高亮 ERROR/WARN 等，便于大日志快速定位。</li>
</ul>
</li>
<li>
<p>折叠连续重复日志</p>
<ul>
<li>右键选中重复行 → <code>Fold Lines Like This</code>，IDEA 自动折叠后续相同内容，保持控制台简洁。</li>
</ul>
</li>
<li>
<p>Console 快速拷贝多行且保留时间戳</p>
<ul>
<li>按住 <code>Alt</code> 选择多行（列选择模式），可以保留每行前的时间戳和格式。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-5">搜索 / 查找深层技巧</h2>
<ul>
<li>
<p>结构搜索（Structural Search）</p>
<ul>
<li><code>Edit → Find → Search Structurally</code>，不仅能按文本搜索，还能按代码结构搜索，比如“找出所有 try/catch 内抛 RuntimeException 的地方”，比普通搜索精准。</li>
</ul>
</li>
<li>
<p>替换代码结构</p>
<ul>
<li><code>Replace Structurally</code> 可以批量修改匹配结构的代码，比如批量替换旧方法调用。</li>
</ul>
</li>
<li>
<p>多行正则替换</p>
<ul>
<li>搜索框勾选 Regex 并用 <code>\n</code> 匹配换行，可以一次修改整个方法体，普通搜索做不到。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">项目与文件技巧</h2>
<ul>
<li>
<p>排除某类文件/文件夹</p>
<ul>
<li>右键 → <code>Mark Directory as → Excluded</code>，IDEA 不再索引，搜索更快，Tab 也不会显示。</li>
</ul>
</li>
<li>
<p>将常用模块/包固定到 Project 工具栏</p>
<ul>
<li>Project 工具栏 → 右键 <code>Add to Favorites</code> → 可以快速跳转到深层模块，而不翻树。</li>
</ul>
<p>这是我在内网开发最爱的功能，可以完全替代 Project 选项卡，将 Favorites 拖动到 Project 选项卡一起，平时用 Favorites 管理断点、TODO、编写多模块代码，不够用时再到 Project 选项卡中使用。老版本的叫收藏夹（Favorites），新版本的叫书签（Bookmark），注意甄别，但功能都一样，只是叫法不一样。</p>
</li>
<li>
<p>临时文件比较</p>
<ul>
<li>选中两个文件 → <code>Compare Files</code>，无需切换版本控制，非常适合快速 diff。</li>
<li>复制需要对比的代码，在要对比的文件上点击鼠标右键，选择与编辑器对比（Compare File with Editor），只在粘贴板有内容时会有。。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-7">Debug / Runtime 技巧</h2>
<ul>
<li>
<p>Evaluate Expression 的快捷重置</p>
<ul>
<li>Debug 窗口中 <code>Alt + F8</code>（Evaluate Expression），输入表达式后按 <code>Alt + R</code> 可快速重置结果，无需手动清空。</li>
</ul>
</li>
<li>
<p>Inline Watch</p>
<ul>
<li>在 Debug 时，按 <code>Ctrl + Shift + F8</code> 可以在代码旁边直接显示变量的值，而不是底部窗口。</li>
</ul>
</li>
<li>
<p>临时断点条件快速应用</p>
<ul>
<li>右键断点 → <code>More</code> → <code>Condition</code>，输入表达式；按 <code>Ctrl + Shift + F9</code> 可临时禁用/启用所有条件断点。新版本则是右键打开面板进行设置。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-8">性能技巧</h2>
<ul>
<li>在底部状态栏右键，勾选内存指示器（Memory Indicator），可以快速监测当前IDEA内存变化。可以简单识别内存是否泄露，鼠标 hover 上去可以查看更详细信息。</li>
</ul>
<h2 data-id="heading-9">移动办公模式</h2>
<ul>
<li>当携带笔记本移动办公时（惨），没有电源供电，在底部状态栏点击鼠标右键，勾选省电模式（Power Save Mode），可以打开省电模式，会关闭一些自动编译、热更新的频繁执行的操作以节省电量。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（22）Hibernate的注解配置是什么？]]></title>    <link>https://juejin.cn/post/7591334208997228570</link>    <guid>https://juejin.cn/post/7591334208997228570</guid>    <pubDate>2026-01-04T11:54:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591334208997228570" data-draft-id="7591338980693606446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（22）Hibernate的注解配置是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（22）Hibernate的注解配置是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:47.000Z" title="Sun Jan 04 2026 11:54:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的注解配置是一种通过在Java类和属性上使用注解来定义数据库映射关系的方式，取代了传统的XML映射文件。这种方式使得配置更加直观和简洁，减少了配置文件的维护工作。</p>
<h3 data-id="heading-0">使用注解配置Hibernate</h3>
<h4 data-id="heading-1">配置步骤</h4>
<ol>
<li><strong>配置Hibernate的核心配置文件</strong> <code>hibernate.cfg.xml</code>。</li>
<li><strong>创建实体类</strong>，并使用JPA和Hibernate的注解来定义类和属性的映射。</li>
<li><strong>使用Hibernate进行CRUD操作</strong>。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<p>下面是一个完整的示例，包括数据库配置、实体类、以及使用Hibernate进行CRUD操作的代码。</p>
<h4 data-id="heading-3">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 注解实体类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">实体类 <code>Person</code></h4>
<p>使用JPA和Hibernate的注解来配置实体类。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-6">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-7">CRUD操作类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertPerson(sessionFactory);

        <span class="hljs-comment">// 查询数据</span>
        queryPerson(sessionFactory);

        <span class="hljs-comment">// 更新数据</span>
        updatePerson(sessionFactory);

        <span class="hljs-comment">// 删除数据</span>
        deletePerson(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Queried Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">25</span>);
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person: "</span> + person.getName());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性以及实体类映射配置。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code></strong>：使用JPA和Hibernate的注解定义实体类及其属性的映射。</p>
<ul>
<li><code>@Entity</code>：指定这是一个持久化实体。</li>
<li><code>@Table(name = "person")</code>：指定表名。</li>
<li><code>@Id</code>：表示主键。</li>
<li><code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code>：指定主键生成策略。</li>
<li><code>@Column(name = "name")</code>：指定列名。</li>
</ul>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-comment">// 创建SessionFactory的代码</span>
}
</code></pre>
</li>
<li>
<p><strong>CRUD操作类</strong>：演示了如何使用Hibernate进行插入、查询、更新和删除操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-comment">// CRUD操作方法</span>
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p>使用注解配置Hibernate，可以使得配置更加直观和简洁，减少配置文件的维护工作。通过在实体类中使用JPA和Hibernate的注解，可以方便地定义类和属性与数据库表和列之间的映射关系。在配置完成后，可以使用Hibernate的Session进行CRUD操作，实现对数据库的访问和操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何阅读英文文档]]></title>    <link>https://juejin.cn/post/7591309945510690816</link>    <guid>https://juejin.cn/post/7591309945510690816</guid>    <pubDate>2026-01-04T11:56:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945510690816" data-draft-id="7588799600166469642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何阅读英文文档"/> <meta itemprop="keywords" content="Java,前端,后端"/> <meta itemprop="datePublished" content="2026-01-04T11:56:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pe7er"/> <meta itemprop="url" content="https://juejin.cn/user/905653310988445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何阅读英文文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310988445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pe7er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:56:00.000Z" title="Sun Jan 04 2026 11:56:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发工作中，开发者几乎一直处于持续学习状态。  对于优秀的中文社区的技术，阅读当然没有问题，但也有很多优秀的技术、框架、前沿技术和工具并非由国人开发，相对小众，但却非常重要。这类项目往往只有英文甚至日文官方文档，也缺乏中文社区的翻译贡献。在这种情况下，高效、可靠的翻译工具几乎是必备能力。</p>
<hr/>
<h2 data-id="heading-0">从传统词典到 AI 翻译</h2>
<p>早期常用的词典工具：</p>
<ul>
<li>金山词霸</li>
<li>灵格斯</li>
<li>有道词典</li>
</ul>
<p>这些工具主要用于逐词翻译。</p>
<p>后来出现的翻译工具：</p>
<ul>
<li>有道翻译</li>
<li>必应翻译</li>
<li>Google 翻译</li>
<li>百度翻译</li>
</ul>
<p>可以支持整句、整段翻译。在内网或受限环境下，金山词霸、灵格斯等离线词典仍有使用价值。</p>
<p>随着 AI 技术的发展，翻译工具在准确性和上下文理解能力上有了显著提升。</p>
<hr/>
<h2 data-id="heading-1">在线翻译英文文档与书籍</h2>
<p>适用场景：</p>
<ul>
<li>Project Gutenberg 等合法公版电子书</li>
<li>社区开发者编写的开源文档</li>
<li>没有信息安全或传播限制的资料</li>
</ul>
<h3 data-id="heading-2">在线网页翻译</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.immersivetranslate.cn%2F" target="_blank" title="https://app.immersivetranslate.cn/" ref="nofollow noopener noreferrer">Immersive Translate</a></p>
<p>特点：</p>
<ul>
<li>使用方便</li>
<li>翻译质量高</li>
<li>适合阅读网页文档</li>
</ul>
<p>限制：</p>
<ul>
<li>不支持 OCR</li>
<li>不支持 EPUB 内图片翻译</li>
</ul>
<h3 data-id="heading-3">在线翻译电子书</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.immersivetranslate.cn%2Febook%2F" target="_blank" title="https://app.immersivetranslate.cn/ebook/" ref="nofollow noopener noreferrer">Immersive Translate Ebook</a></p>
<p>支持直接上传电子书进行翻译，适合快速阅读外文技术书籍。类似工具还有 AnyDoc、XX 翻译。</p>
<hr/>
<h2 data-id="heading-4">图片翻译</h2>
<p>适合场景：</p>
<ul>
<li>漫画或对话截图</li>
<li>复杂流程图</li>
<li>技术示意图</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.immersivetranslate.cn%2Fimage%2F" target="_blank" title="https://app.immersivetranslate.cn/image/" ref="nofollow noopener noreferrer">Immersive Translate Image</a></p>
<p>免费版与付费版区别：</p>
<ul>
<li>付费插件直接在原图上替换翻译内容</li>
<li>免费方式通过 Google Lens 等工具跳转翻译</li>
</ul>
<hr/>
<h2 data-id="heading-5">离线翻译（信息安全场景）</h2>
<p>适用条件：</p>
<ul>
<li>合法购买的外文电子书</li>
<li>有信息安全或传播限制</li>
<li>无法使用在线工具</li>
</ul>
<p>推荐方案：</p>
<ul>
<li>本地 AI + Calibre + Ebook Translator 插件</li>
</ul>
<p>特点：</p>
<ul>
<li>支持多种电子书格式</li>
<li>可完全离线使用</li>
</ul>
<p>限制：</p>
<ul>
<li>不支持 OCR（扫描版无法处理）</li>
</ul>
<hr/>
<h2 data-id="heading-6">阅读 GitHub 英文项目</h2>
<p>使用 DeepWiki 可以：</p>
<ul>
<li>以自然语言理解仓库代码</li>
<li>直接询问项目功能</li>
<li>理解复杂逻辑和用法</li>
</ul>
<p>对于复杂函数或注释少的模块，可结合 DeepWiki + ChatGPT 分步提问，获得中文总结和示例调用。</p>
<hr/>
<h2 data-id="heading-7">浏览器与平台自带翻译</h2>
<p>Microsoft Edge：</p>
<ul>
<li>内置网页翻译</li>
<li>网络不佳时依然稳定</li>
</ul>
<p>iOS 开发文档：</p>
<ul>
<li>使用 ADDT（收费插件）</li>
<li>价格便宜，体验不错</li>
</ul>
<p>Android / Web 开发文档：</p>
<ul>
<li>Google 官方文档大多支持直接切换中文</li>
<li>不支持的页面可使用 Chrome 内置翻译或翻译插件</li>
</ul>
<hr/>
<h2 data-id="heading-8">额外技巧</h2>
<ul>
<li>多工具组合使用：文档可用 DeepL、Google 翻译、Calibre + Ebook Translator，图片可用 Google Lens / ABBYY OCR，代码可用 DeepWiki + ChatGPT</li>
<li>结合原文阅读，AI 翻译并非完全准确，会闹出许多笑话乌龙，需要持续修订。</li>
</ul>
<hr/>
<h2 data-id="heading-9">扩展实用翻译工具清单</h2>
<h3 data-id="heading-10">在线 AI 翻译工具</h3>



































<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>DeepL</td><td>翻译质量高，语境理解好，支持文档上传</td><td>英文 / 德文 / 法文文档翻译，技术文档和文章</td></tr><tr><td>Google Translate</td><td>支持网页、文本、文档、图片翻译，免费</td><td>常规网页、文档翻译</td></tr><tr><td>Bing Microsoft Translator</td><td>微软官方翻译，集成 Edge 浏览器</td><td>技术文档网页快速翻译</td></tr><tr><td>Youdao 翻译网页版</td><td>支持整句整段翻译</td><td>日文、英文文档，支持技术术语查询</td></tr><tr><td>Papago</td><td>韩国开发，日语、韩语、中文、英文互译较好</td><td>日文文档翻译</td></tr></tbody></table>
<h3 data-id="heading-11">离线翻译工具</h3>






























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Calibre + Ebook Translator 插件</td><td>支持 EPUB、MOBI、PDF 离线翻译</td><td>有版权限制的电子书</td></tr><tr><td>QTranslate</td><td>支持调用 Google / Bing / DeepL API，本地翻译</td><td>内网环境或无法联网时</td></tr><tr><td>Lingoes（灵格斯词典）</td><td>离线词典 + 翻译</td><td>单词、短句离线翻译</td></tr><tr><td>GoldenDict（金山词霸离线版）</td><td>词典丰富，支持离线词库</td><td>内网环境 / 单词翻译</td></tr></tbody></table>
<h3 data-id="heading-12">图片翻译 / OCR 翻译工具</h3>






























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Google Lens</td><td>支持手机或 PC 拍照翻译</td><td>截图、照片、流程图、漫画对白</td></tr><tr><td>Microsoft OneNote OCR</td><td>可以提取图片文字再翻译</td><td>复杂文档截图、扫描图像</td></tr><tr><td>ABBYY FineReader</td><td>OCR + 文本提取精度高</td><td>扫描版 PDF、技术文档</td></tr><tr><td>iOS / Android 图片翻译 APP</td><td>支持实时拍照翻译</td><td>纸质书、手写文档</td></tr></tbody></table>
<h3 data-id="heading-13">代码 / 开源文档辅助翻译</h3>

























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>DeepWiki</td><td>AI 自然语言理解仓库</td><td>GitHub 英文注释、代码理解</td></tr><tr><td>ChatGPT / Claude / Bard</td><td>可总结文档、翻译、生成示例</td><td>英文技术文档、开源库注释、API 说明</td></tr><tr><td>GitLocalize</td><td>开源文档翻译协作平台</td><td>GitHub 文档翻译、团队协作</td></tr></tbody></table>
<h3 data-id="heading-14">浏览器内置 / 插件类工具</h3>

























<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Microsoft Edge 内置翻译</td><td>在线网页自动翻译</td><td>内网不佳或中文插件无法用时</td></tr><tr><td>Chrome 翻译插件（Google Translate Extension）</td><td>支持局部网页翻译</td><td>代码示例、技术文档阅读</td></tr><tr><td>ADDT（iOS 文档插件）</td><td>收费、价格便宜</td><td>iOS 官方文档、开发文档翻译</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">总结</h2>
<p>翻译工具本身不是目的，高效理解技术内容才是。根据不同场景：</p>
<p>选择合适的工具组合，比追求“最强工具”更重要。</p>
<p>希望这份整理能帮助开发者在学习和工作中高效跨越语言障碍，更快掌握能够应用的知识和技术，或许未来也可以在开源社区中贡献一份翻译中坚力量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【flutter】0. 搭建一个多端 flutter 开发环境]]></title>    <link>https://juejin.cn/post/7591318630693814326</link>    <guid>https://juejin.cn/post/7591318630693814326</guid>    <pubDate>2026-01-04T10:06:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591318630693814326" data-draft-id="7587825267878559785" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【flutter】0. 搭建一个多端 flutter 开发环境"/> <meta itemprop="keywords" content="Flutter,前端框架,架构"/> <meta itemprop="datePublished" content="2026-01-04T10:06:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dev"/> <meta itemprop="url" content="https://juejin.cn/user/3896324938536877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【flutter】0. 搭建一个多端 flutter 开发环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3896324938536877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dev
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:06:40.000Z" title="Sun Jan 04 2026 10:06:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="dracula">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282a36}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-section,.hljs-selector-tag{color:#8be9fd}.hljs-function .hljs-keyword{color:#ff79c6}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#f8f8f2}.hljs-addition,.hljs-attribute,.hljs-bullet,.hljs-name,.hljs-string,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#f1fa8c}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#6272a4}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-strong,.hljs-title,.hljs-type{font-weight:700}.hljs-emphasis{font-style:italic}</style><h2 data-id="heading-0">1. 前言</h2>
<p>最近在做一个智能家居的应用，可能需要用到 APP 与设备之间的交互。所以就寻思自己搞一下。</p>
<p>很早之前的我了解到的 APP 的开发无非就三类：</p>
<ol>
<li>原生开发</li>
<li>基于 react-native</li>
<li>flutter</li>
</ol>
<p>介于一些文章我了解到，原生开发毕竟还要学一门新的开发语言，所以 PASS 了。RN 的用户体验相对来说又比较差。
就选了现在相对比较居中开发起来和 React 比较相似的 flutter。</p>
<p>以下谨以此来搭建一个简单的 demo。也希望在学习的过程中有些输出，能帮助到更多的人。</p>
<h2 data-id="heading-1">2. 环境搭建</h2>
<blockquote>
<p>记得提前安装 vscode，由于我用的是 mac，所以这里只展示在 macos 系统下的安装方案。</p>
</blockquote>
<h3 data-id="heading-2">2.1 安装 xcode（ios 应用必须）</h3>
<p>打开终端，输入以下命令</p>
<pre><code class="hljs language-bash" lang="bash">xcode-select --install
</code></pre>
<h3 data-id="heading-3">2.2 下载 Flutter SDK</h3>
<p>访问官方站点或者<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.cn%2Finstall%2Farchive%2F" target="_blank" title="https://docs.flutter.cn/install/archive/" ref="nofollow noopener noreferrer">国内镜像站点</a>，下载需要的的 sdk 版本（本教程用 35.7 举例），安装目录到指定位置，比如我这里是 /dev 文件夹。安装好后解压出来会得到一个 /flutter 文件夹。记住 /dev/Flutter 这个路径，后面会用上。</p>
<h3 data-id="heading-4">2.3 下载 Android-studio（安卓应用必须）</h3>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fstudio%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/studio?hl=zh-cn" ref="nofollow noopener noreferrer">官方网站</a>下载安装即可.</p>
<h3 data-id="heading-5">2.4 安装 vscode 拓展</h3>
<p>打开 vscode，在 vscode 上安装以下拓展插件：</p>
<ol>
<li>Flutter</li>
<li>Android iOS Emulator</li>
<li>Flutter color （可选）</li>
</ol>
<h3 data-id="heading-6">2.5 配置安卓环境</h3>
<p>下载完 Android studio 之后，咱需要在 Android SDK 再安装以下依赖：</p>
<ul>
<li><strong>Android SDK Build-Tools</strong></li>
<li><strong>Android SDK Command-line Tools</strong></li>
<li><strong>Android Emulator</strong></li>
<li><strong>Android SDK Platform-Tools</strong></li>
</ul>
<p>把上述插件安装完成之后，在终端运行：</p>
<pre><code class="hljs language-bash" lang="bash">flutter doctor --android-licenses
</code></pre>
<p>此时会要求你通过协议请求，全部 Y 接受就行。当得到以下返回就配置完成了：</p>
<pre><code class="hljs language-bash" lang="bash">All SDK package licenses accepted
</code></pre>
<p>完成以上步骤后只需要再次执行 flutter doctor，终端提示安卓插件前面打勾，说明安装成功：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7676e1afce31420ab7466c4bf193f96e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=Pc4IECjpJlxpNBE9saj5OgljR3g%3D" alt="截屏2025-12-27 16.49.27.png" loading="lazy"/></p>
<h3 data-id="heading-7">2.6 配置环境变量</h3>
<p>针对安卓开发环境需要额外配置一些参数(参考自己的安卓 sdk 的安装位置）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Android SDK</span>
<span class="hljs-built_in">export</span> ANDROID_SDK_ROOT=<span class="hljs-variable">$HOME</span>/Library/Android/sdk
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_SDK_ROOT</span>/emulator
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_SDK_ROOT</span>/platform-tools
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_SDK_ROOT</span>/cmdline-tools/latest/bin

<span class="hljs-comment"># Android Studio Embedded JDK</span>
<span class="hljs-built_in">export</span> JAVA_HOME=<span class="hljs-string">"/Applications/Android Studio.app/Contents/jbr/Contents/Home"</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
<h2 data-id="heading-8">3 初始化项目</h2>
<p>以上依赖安装完之后，打开 vscode 的命令面板，输入 flutter，会有以下三个选项，选择 <strong>new project</strong> 选项：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cfb6692d5a34ace8983c0a2bc131083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=eP04X5jUYWvhz04qa%2BNXJITZlyQ%3D" alt="截屏2025-12-26 20.03.08.png" loading="lazy"/></p>
<p>等待项目初始化完成进入下一步。</p>
<h3 data-id="heading-9">3.1 进入 web 开发模式</h3>
<p>此时如果在未安装 xcode 和 Android studio 的情况下，只能进入 web 开发模式。输入如下命令即可：</p>
<pre><code class="hljs language-bash" lang="bash">flutter run -d web-server
</code></pre>
<p>终端提示端口号，即为 web 服务启动成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b950399c85c445ee955ac09cbe38abd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=XiJlvq%2FLEBgoIaZvPzA6wrC9r%2Fc%3D" alt="截屏2025-12-26 20.08.22.png" loading="lazy"/></p>
<h3 data-id="heading-10">3.2 进入安卓开发模式</h3>
<p>先启动安卓端的 emulators。如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c601a3598dac4a168be1b7bf0acde8da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=W63UlwAi%2B6ccLJ%2BpOXA%2BhoZP7SA%3D" alt="截屏2025-12-28 01.55.23.png" loading="lazy"/></p>
<p>然后再执行 <strong>flutter run</strong></p>
<h3 data-id="heading-11">3.3 进入 macOS 开发模式</h3>
<p>先提前安装好 XCode。</p>
<pre><code class="hljs language-bash" lang="bash">flutter run -d macOS
</code></pre>
<h3 data-id="heading-12">3.4 进入 IOS 开发模式</h3>
<h4 data-id="heading-13">3.4.1 安装依赖程序</h4>
<p>mac 端主要需要安装两个比较重要的依赖，一个是 Xcode，一个是 cocoapods</p>
<p>Xcode的安装方式很简单，直接在应用商店搜索就能下载。</p>
<p>这里主要讲一下 cocoapods 的安装方式。（这里最好是安装brew，效率翻倍）</p>
<p>由于 cocoapods 是依赖 ruby 的，但是mac 自带的ruby版本比较低，所以先安装ruby，这里我用的 brew 下载，首先执行以下代码：</p>
<pre><code class="hljs language-bash" lang="bash">brew install ruby

// 把ruby 的环境变量更新到启动脚本
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="/opt/homebrew/opt/ruby/bin:$PATH"'</span> &gt;&gt; ~/.zshrc
<span class="hljs-built_in">source</span> ~/.zshrc

// 查看版本
ruby -v
</code></pre>
<p>然后开始安装 cocoapods，这里我们用 gem 安装(需要管理员权限）：</p>
<pre><code class="hljs language-bash" lang="bash">sudo gem install cocoapods
</code></pre>
<p>接下来我们就可以愉快的进入好看的 IOS 界面进行开发了。</p>
<h2 data-id="heading-14">DEBUG</h2>
<p>既然开始开发了，难免需要知道如何 debug 和查看日志，这里需要稍微注意一下，如果想要在控制台看到对应的输出日志，你需要在 vscode 的侧边栏找到 RUN AND DEBUGS。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/157a17e766b14fcf8bd1df897fc5aa21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGV2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126000&amp;x-signature=dBOMudMnvSBR%2BhH2qpQhzYoxqLE%3D" alt="截屏2026-01-04 18.03.08.png" loading="lazy"/></p>
<p>接下来，咱们就可以开始愉快的开发了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析：uniapp单仓库多应用（SaaS 化）架构]]></title>    <link>https://juejin.cn/post/7591293897085075506</link>    <guid>https://juejin.cn/post/7591293897085075506</guid>    <pubDate>2026-01-04T10:06:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591293897085075506" data-draft-id="7591338980693098542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析：uniapp单仓库多应用（SaaS 化）架构"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-04T10:06:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LC同学47981"/> <meta itemprop="url" content="https://juejin.cn/user/1978776660477991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析：uniapp单仓库多应用（SaaS 化）架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776660477991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LC同学47981
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:06:53.000Z" title="Sun Jan 04 2026 10:06:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入解析：单仓库多应用（SaaS 化）架构如何解决多租户维护痛点</h2>
<p>在现代 SaaS（Software as a Service）业务模式下，技术团队面临的最大挑战之一是如何高效地为成百上千个客户（租户）交付独立的小程序或应用。本项目采用了一种 <strong>“单仓库多应用”（Monorepo-like / Multi-Tenant）</strong> 的架构模式，通过极致的工程化手段，将维护成本从线性增长（O(N)）降低为常数级（O(1)）。</p>
<p>本文将从<strong>痛点分析</strong>、<strong>核心架构设计</strong>、<strong>关键代码实现</strong>以及<strong>进阶的条件编译体系</strong>四个维度进行详细剖析。</p>
<hr/>
<h3 data-id="heading-1">一、 痛点分析：传统多租户开发的“泥潭”</h3>
<p>假设你需要维护 50 个客户的小程序，每个客户都有独立的 AppID、接口地址，且部分客户有定制化页面需求。</p>
<h4 data-id="heading-2">1. 代码维护成本高 (Code Redundancy)</h4>
<ul>
<li><strong>传统做法</strong>：为每个客户开一个 Git 分支或独立仓库。</li>
<li><strong>后果</strong>：当核心业务（如“下单流程”）发现一个 Bug 时，你需要在 50 个仓库中分别合并代码。这是一场灾难，极易漏改或改错。</li>
</ul>
<h4 data-id="heading-3">2. 发版事故频发 (Human Error)</h4>
<ul>
<li><strong>传统做法</strong>：打包前手动修改 <code>manifest.json</code> 中的 <code>appid</code>，手动切换 <code>config.js</code> 中的 API 环境地址。</li>
<li><strong>后果</strong>：很容易把“客户 A”的代码发到了“客户 B”的小程序上，或者把“测试环境”的配置发到了“生产环境”。</li>
</ul>
<h4 data-id="heading-4">3. 包体积与性能瓶颈 (Bundle Size)</h4>
<ul>
<li><strong>传统做法</strong>：将所有客户的功能都写在一个大包里，通过 <code>if (clientId === 'A')</code> 来判断显示什么。</li>
<li><strong>后果</strong>：所有客户都要下载包含其他 49 个客户定制逻辑的巨型包。小程序主包体积限制（2MB）很快就会爆表，且启动速度极慢。</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、 核心架构设计：配置驱动的动态构建</h3>
<p>本项目的核心思想是：<strong>代码是共享的，差异是配置出来的。</strong></p>
<h4 data-id="heading-6">1. 目录结构设计</h4>
<p>我们将“变”与“不变”完全分离：</p>
<ul>
<li><strong><code>src/</code> (不变)</strong>：存放所有核心业务逻辑、组件、页面。所有客户共用这一套代码。</li>
<li><strong><code>scripts/setting/</code> (变)</strong>：存放每个租户的“身份证”。每个文件（如 <code>wx0159...js</code>）代表一个客户，包含其独有的配置信息。</li>
</ul>
<h4 data-id="heading-7">2. 构建流程图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[开发者] --&gt;|选择配置 ID: wx0159...| B(构建脚本 scripts/build/index.js)
    B --&gt; C{读取配置}
    C --&gt;|1. 读取公共配置| D[scripts/build/baseConfig.ts]
    C --&gt;|2. 读取租户配置| E[scripts/setting/wx/wx0159...js]
    B --&gt; F[动态生成/覆写文件]
    F --&gt;|合并页面| G[src/pages.json]
    F --&gt;|替换 AppID| H[src/manifest.json]
    F --&gt;|注入变量| I[package.json / process.env]
    F --&gt; J[Vite 编译打包]
    J --&gt; K[生成最终小程序]
</code></pre>
<hr/>
<h3 data-id="heading-8">三、 关键代码实现：如何“移花接木”</h3>
<h4 data-id="heading-9">1. 动态生成 <code>pages.json</code> —— 解决包体积与定制化</h4>
<p>Uniapp 的 <code>pages.json</code> 通常是静态的。为了实现“按需打包”，我们在构建阶段动态生成它。</p>
<ul>
<li><strong>公共页面</strong>：在 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">baseConfig.ts</a> 中定义所有客户都有的页面（如首页、个人中心）。</li>
<li><strong>租户页面</strong>：在租户配置（如 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">wx01596767907b93fe.js</a>）中定义特有的分包。</li>
</ul>
<p><strong>构建脚本逻辑 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">scripts/build/index.js</a>):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 读取公共配置</span>
<span class="hljs-keyword">const</span> { baseSubPackages, pages } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./baseConfig.ts'</span>);
<span class="hljs-comment">// 2. 读取当前租户配置</span>
<span class="hljs-keyword">const</span> { config } = <span class="hljs-built_in">require</span>(configFilePath);

<span class="hljs-comment">// 3. 动态合并</span>
<span class="hljs-comment">// 只有当前客户需要的 subPackages 才会进入最终的 pages.json</span>
pagesJson.<span class="hljs-property">subPackages</span> = baseSubPackages.<span class="hljs-title function_">concat</span>(config.<span class="hljs-property">subPackages</span> || []);
pagesJson.<span class="hljs-property">pages</span> = pages.<span class="hljs-title function_">concat</span>(config.<span class="hljs-property">pages</span> || []);

<span class="hljs-comment">// 4. 写入文件系统（供 Uniapp 编译器使用）</span>
fs.<span class="hljs-title function_">writeFileSync</span>(pagesJsonPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(pagesJson, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), <span class="hljs-string">'utf8'</span>);
</code></pre>
<blockquote>
<p><strong>成效</strong>：客户 A 的小程序里绝对不会出现客户 B 的定制页面代码，包体积最小化。</p>
</blockquote>
<h4 data-id="heading-10">2. 自动化身份注入 —— 杜绝发版事故</h4>
<p>为了防止人工修改 <code>manifest.json</code> 出错，我们通过脚本全自动替换。</p>
<p><strong>构建脚本逻辑 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">scripts/build/index.js</a>):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 读取 manifest.json 原始内容</span>
<span class="hljs-keyword">let</span> updatedManifestContent = manifestJsonContent;
<span class="hljs-keyword">const</span> platform = scriptConfig.<span class="hljs-property">env</span>.<span class="hljs-property">UNI_PLATFORM</span>;

<span class="hljs-comment">// 正则替换 AppID</span>
<span class="hljs-comment">// 确保只替换当前平台的 appid，不影响其他配置</span>
<span class="hljs-keyword">const</span> platformRegex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`"<span class="hljs-subst">${platform}</span>":\\s*{[^}]*"appid":\\s*"[^"]*"`</span>);
updatedManifestContent = updatedManifestContent.<span class="hljs-title function_">replace</span>(platformRegex, <span class="hljs-function"><span class="hljs-params">match</span> =&gt;</span> match.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"appid":\\s*"[^"]*"/</span>, <span class="hljs-string">`"appid": "<span class="hljs-subst">${configType}</span>"`</span>));

fs.<span class="hljs-title function_">writeFileSync</span>(manifestJsonPath, updatedManifestContent, <span class="hljs-string">'utf8'</span>);
</code></pre>
<blockquote>
<p><strong>成效</strong>：只要选对了配置 ID，打出来的包 AppID 绝对正确，无需人工 Check。</p>
</blockquote>
<h4 data-id="heading-11">3. 环境变量透传 —— 代码去敏感化</h4>
<p>业务代码中（<code>src/</code> 下）严禁出现任何硬编码的 URL 或 Key。所有环境相关变量都通过构建过程注入。</p>
<p><strong>配置定义 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">scripts/setting/wx/wx0159...js</a>):</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">env</span>: {
  <span class="hljs-attr">URL</span>: <span class="hljs-string">'https://mall.baoquanlvyou.com'</span>, <span class="hljs-comment">// 接口地址</span>
  <span class="hljs-attr">MCODE</span>: <span class="hljs-string">'dwr1Op9C3C5q...'</span>,             <span class="hljs-comment">// 商家编码</span>
  <span class="hljs-attr">SITE_CHANNEL_TYPE</span>: <span class="hljs-number">5</span>
}
</code></pre>
<p><strong>注入逻辑 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">vite.config.ts</a> + <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">defineEnv.js</a>):</strong> 构建脚本先将 <code>env</code> 对象注入到 Node 进程的 <code>process.env</code> 中，然后 <code>vite.config.ts</code> 通过 <code>define</code> 选项将其传递给前端代码。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">define</span>: <span class="hljs-title function_">getDefineEnv</span>() <span class="hljs-comment">// 将 process.env.URL 等注入全局</span>
    <span class="hljs-comment">// ...</span>
  };
});
</code></pre>
<p><strong>业务代码使用 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">src/utils/env.ts</a>):</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// 这里的 process.env.URL 在编译时会被替换为字符串常量</span>
    <span class="hljs-comment">// @ts-ignore</span>
    <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">URL</span>
    <span class="hljs-comment">// ...</span>
  };
};
</code></pre>
<hr/>
<h3 data-id="heading-12">四、 进阶架构：多层次条件编译与定向构建体系</h3>
<p>在解决了基础的“配置隔离”后，我们通过 <code>scripts/setting/</code> 配置文件与 Vite 的深度结合，构建了一套<strong>从构建脚本到业务代码、从路由层级到组件粒度</strong>的全方位条件编译体系，解决 <strong>“千人千面”</strong> 的深度定制需求。</p>
<h4 data-id="heading-13">1. 核心能力：宏注入机制</h4>
<p>我们不仅仅利用了 Uniapp 原生的条件编译（<code>#ifdef</code>），更通过自定义注入的宏（Macro），实现了<strong>基于租户身份</strong>的定向编译。</p>
<p>在每个租户的配置文件中（如 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">package.json</a> 中的 <code>pro-h5</code> 或 <code>scripts/setting/wx/</code> 下的配置），我们定义了 <code>define</code> 字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json 示例</span>
<span class="hljs-attr">"uni-app"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"pro-h5"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"商城"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"UNI_PLATFORM"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h5"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"SITE_CHANNEL_TYPE"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"define"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"PRO_H5"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  <span class="hljs-comment">// &lt;--- 自定义宏</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>或者在租户独立配置中（如 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">wx00c9.js</a>）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">define</span>: {
  <span class="hljs-title class_">WX00C</span>9: <span class="hljs-literal">true</span>; <span class="hljs-comment">// &lt;--- 针对该特定客户的宏</span>
}
</code></pre>
<p>这些宏在构建时通过 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">defineEnv.js</a> 被注入到全局变量中，使得业务代码可以像使用系统变量一样使用它们。</p>
<h4 data-id="heading-14">2. 场景实战：从路由到组件的定向控制</h4>
<h5 data-id="heading-15">2.1 脚本路由级控制 (Script-Level)</h5>
<p>在 <code>package.json</code> 的 <code>uni-app.scripts</code> 中，我们定义了不同的启动命令（如 <code>pro-h5</code>）。这不仅决定了环境变量，还决定了<strong>Uniapp 的平台表现</strong>。</p>
<ul>
<li>
<p><strong>场景</strong>：特定租户（如 <code>WX00C9</code>）需要在个人中心显示额外的功能入口，而其他租户不需要。</p>
</li>
<li>
<p><strong>实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/mine/index.vue</span>

<span class="hljs-comment">// #ifdef WX00C9</span>
&lt;view <span class="hljs-keyword">class</span>=<span class="hljs-string">"menu-item"</span> <span class="hljs-meta">@click</span>=<span class="hljs-string">"goSpecialPage"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>专属VIP通道<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></span>
&lt;/view&gt;
<span class="hljs-comment">// #endif</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-16">2.2 租户级定向编译 (Tenant-Level)</h5>
<p>对于 50 个租户中，只有“客户 A”需要显示某个特殊按钮，或者只有“客户 B”需要隐藏某个模块。</p>
<ul>
<li><strong>场景</strong>：只有 <code>wxb557...</code> 这个客户需要默认加载某些数据，其他客户不需要。</li>
<li><strong>实现</strong>：直接使用注入的 <code>define</code> 宏进行判断。
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 伪代码示例</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">WX1558</span>) {
  <span class="hljs-comment">// 只有 WX1558 这个客户会执行这段逻辑</span>
  <span class="hljs-comment">// 编译后，其他客户的代码中这段会被直接 Tree-Shaking 移除</span>
  <span class="hljs-title function_">initSpecialData</span>();
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-17">2.3 页面与入口级控制 (Page-Level)</h5>
<p>通过动态生成 <code>pages.json</code>，我们实现了<strong>物理级别的页面隔离</strong>。</p>
<ul>
<li><strong>场景</strong>：客户 A 需要“扫码点餐”功能，客户 B 只需要“内容展示”。</li>
<li><strong>实现</strong>：
<ul>
<li>客户 A 的配置 <code>subPackages</code> 包含 <code>subPackageScanQrOrder</code>。</li>
<li>客户 B 的配置 <code>subPackages</code> 为空。</li>
<li><strong>结果</strong>：客户 B 的小程序包中根本不包含点餐相关的页面文件和资源，包体积减少 50% 以上。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-18">3. 多层次条件编译矩阵</h4>
<p>通过 <code>package.json</code> 和 <code>scripts/setting/</code> 中的精细化配置，我们构建了一个<strong>多维度的条件编译矩阵</strong>：</p>



































<table><thead><tr><th align="left">维度</th><th align="left">控制粒度</th><th align="left">实现方式</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><strong>平台级</strong></td><td align="left">H5 / 微信 / 支付宝</td><td align="left"><code>UNI_PLATFORM</code> + <code>#ifdef</code></td><td align="left">抹平平台差异，调用原生 API</td></tr><tr><td align="left"><strong>租户级</strong></td><td align="left">特定客户 (AppID)</td><td align="left">自定义宏 (<code>WX00C9</code>)</td><td align="left">实现“千人千面”的定制业务逻辑</td></tr><tr><td align="left"><strong>路由级</strong></td><td align="left">页面 / 分包</td><td align="left">动态 <code>pages.json</code></td><td align="left">按需打包，物理隔离业务模块</td></tr><tr><td align="left"><strong>环境级</strong></td><td align="left">Dev / Prod</td><td align="left"><code>process.env.URL</code></td><td align="left">自动切换接口环境，杜绝事故</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-19">五、 总结</h3>
<p>这套架构方案的本质是 <strong>“编译时多态”</strong>。通过将多租户的差异前置到 <strong>构建阶段（Build Time）</strong> 处理，而不是留到 <strong>运行时（Runtime）</strong> 判断，我们实现了：</p>
<ol>
<li><strong>安全性</strong>：代码中无敏感配置，不同租户代码物理隔离（在产物层面）。</li>
<li><strong>高性能</strong>：无冗余代码，包体积最小。</li>
<li><strong>高效率</strong>：一套代码服务所有客户，Bug 修复一次，全员受益。</li>
<li><strong>高灵活</strong>：从平台到租户，从页面到组件，全方位满足个性化定制需求。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【安全专项】如何成为一名“火眼金睛”的安卓侦探？]]></title>    <link>https://juejin.cn/post/7591322050240135206</link>    <guid>https://juejin.cn/post/7591322050240135206</guid>    <pubDate>2026-01-04T09:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050240135206" data-draft-id="7591293897085026354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【安全专项】如何成为一名“火眼金睛”的安卓侦探？"/> <meta itemprop="keywords" content="前端,代码规范"/> <meta itemprop="datePublished" content="2026-01-04T09:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="莫比乌斯环"/> <meta itemprop="url" content="https://juejin.cn/user/2840793776394269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【安全专项】如何成为一名“火眼金睛”的安卓侦探？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793776394269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    莫比乌斯环
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:57:42.000Z" title="Sun Jan 04 2026 09:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    29
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">如何成为一名“火眼金睛”的安卓侦探？</h2>
<p>在这个智能手机横行的时代，安卓手机简直成了我们生活中的“第三只手”。但你知道吗？在安卓的世界里，有时候并不是所有的用户都规规矩矩！有些用户可能会偷偷摸摸地“搞事情”，比如开启开发者模式、调试模式、使用VPN、代理，甚至直接把手机给Root了！这就像你辛辛苦苦建了一个城堡，却有人偷偷从后门溜进来搞破坏，想想都让人气得跺脚！</p>
<p>作为一名正义的安卓开发者，怎么能让这些“小动作”逃过我们的“火眼金睛”呢？今天我们就来聊聊如何识别这些“非正常操作”，顺便给你的代码加点“盔甲”，让它变得更安全！</p>
<hr/>
<h3 data-id="heading-1">开发者模式：别以为你是开发者我就不认识你！</h3>
<p>首先，我们来聊聊开发者模式。很多安卓小伙伴可能都知道，只要连续点几下“关于手机”里的某个版本号，就能开启开发者选项。听起来是不是很酷炫？但对于开发者来说，这可是个潜在的“坑”！一旦开启了开发者模式，用户就能做一些奇奇怪怪的事情，比如抓包、调试你的App，甚至看看你代码里的小秘密。</p>
<p>怎么办？别慌！安卓有个<code>Settings.Secure</code> API，可以用来检查开发者模式是否开启。只要写几行代码，就能精准“锁定”这些喜欢玩开发者模式的小伙伴。比如这样：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">devMode</span> <span class="hljs-operator">=</span> Settings.Secure.getInt(context.getContentResolver(),
    Settings.Secure.DEVELOPMENT_SETTINGS_ENABLED, <span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (devMode == <span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 哟，发现一个开发者模式用户！</span>
}
</code></pre>
<p>是不是很简单？有了这招，再高级的“伪装者”也逃不过你的法眼！</p>
<hr/>
<h3 data-id="heading-2">调试模式：调试，是你调得起的吗？</h3>
<p>调试模式就像是让你的App裸奔在大街上，所有的数据、接口都暴露无遗。对于那些喜欢“搞事情”的人来说，这可是个大好机会！所以，我们一定要时刻警惕，看看是不是有人正在用调试工具窥探我们的App。</p>
<p>这里推荐一个简单的方法：用<code>android.os.Debug</code>类来检测是否处于调试状态。如果发现被调试了，那就可以立刻触发警报，甚至直接关闭App，让对方哭着回家。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (Debug.isDebuggerConnected()) {
    <span class="hljs-comment">// 哈哈，被我抓到了！</span>
    System.exit(<span class="hljs-number">0</span>); <span class="hljs-comment">// 直接关掉App，绝不手软！</span>
}
</code></pre>
<p>这一招简直就是“见招拆招”，谁还敢调试你的App？！</p>
<hr/>
<h3 data-id="heading-3">VPN 和代理：你是想当“隐形人”吗？</h3>
<p>有些用户喜欢用VPN或者代理访问网络，可能是为了“科学上网”，也可能是为了隐藏自己的真实身份。但对于开发者来说，这种操作简直就是在玩火！尤其是那些需要地理位置或者用户真实IP的应用，一旦被代理伪装，后果不堪设想。</p>
<p>那么问题来了，该如何识别这些“隐形人”呢？其实很简单，可以通过检查网络连接的代理信息来判断：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-variable">isUsingProxy</span> <span class="hljs-operator">=</span> (!TextUtils.isEmpty(System.getProperty(<span class="hljs-string">"http.proxyHost"</span>)) 
    || !TextUtils.isEmpty(System.getProperty(<span class="hljs-string">"https.proxyHost"</span>)));
<span class="hljs-keyword">if</span> (isUsingProxy) {
    <span class="hljs-comment">// 嘿嘿，发现一个用代理的小伙伴！</span>
}
</code></pre>
<p>再配合一些第三方的VPN检测工具，你的App简直可以变成“反隐形雷达”！</p>
<hr/>
<h3 data-id="heading-4">Root 检测：谁允许你动我的系统？</h3>
<p>最后，我们来说说最让开发者头疼的问题——Root权限。Root用户就像是拿到了系统的万能钥匙，可以随意修改系统文件、绕过权限限制，甚至直接篡改你的App数据。听起来是不是很恐怖？</p>
<p>别担心！虽然Root用户很“嚣张”，但我们也不是吃素的。通过检查常见的Root工具文件（比如<code>su</code>命令），就能快速判断设备是否被Root：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRooted</span><span class="hljs-params">()</span> {
    String[] paths = {<span class="hljs-string">"/system/app/Superuser.apk"</span>, <span class="hljs-string">"/sbin/su"</span>, <span class="hljs-string">"/system/bin/su"</span>, 
        <span class="hljs-string">"/system/xbin/su"</span>, <span class="hljs-string">"/data/local/xbin/su"</span>, <span class="hljs-string">"/data/local/bin/su"</span>};
    <span class="hljs-keyword">for</span> (String path : paths) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path).exists()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 发现Root用户！</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>把这段代码加到你的App里，那些Root用户再也不能为所欲为啦！</p>
<hr/>
<h3 data-id="heading-5">增强代码安全：给你的App穿上盔甲</h3>
<p>除了识别这些“小动作”，我们还要给自己的代码加点料，让它更安全、更难破解。比如：</p>
<ol>
<li><strong>混淆代码</strong>：使用ProGuard或者R8工具，把你的代码变得像天书一样，看得人头晕眼花。</li>
<li><strong>签名校验</strong>：检查App的签名是否被篡改，确保用户安装的是正版App。</li>
<li><strong>动态加密</strong>：对敏感数据进行加密存储，即使被抓包也看不懂。</li>
<li><strong>防止反编译</strong>：使用Dex加密工具，让反编译工具束手无策。</li>
</ol>
<p>这些方法虽然不能百分百防住所有攻击，但至少能让那些“搞事情”的人多花点时间，多掉几根头发！</p>
<hr/>
<h3 data-id="heading-6">总结</h3>
<p>在安卓的江湖里，总会有一些“不安分”的用户试图挑战规则。但只要我们掌握了这些检测技巧，再加上一些安全措施，就能让他们无所遁形！当然啦，作为开发者，我们也要保持一颗平常心，不要太偏执，毕竟技术是一把双刃剑，用得好才能造福用户。</p>
<p>最后，希望各位开发者都能成为“火眼金睛”的安卓侦探，让你的App安全又可靠！如果你学会了这些技巧，不妨在评论区炫耀一下，说不定还能收获一波点赞哦！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别“代码屎山”：用Cursor系统重构遗留前端项目]]></title>    <link>https://juejin.cn/post/7591075684065869839</link>    <guid>https://juejin.cn/post/7591075684065869839</guid>    <pubDate>2026-01-04T09:50:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591075684065869839" data-draft-id="7591075684065853455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别“代码屎山”：用Cursor系统重构遗留前端项目"/> <meta itemprop="keywords" content="前端,Cursor"/> <meta itemprop="datePublished" content="2026-01-04T09:50:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mr_chiu"/> <meta itemprop="url" content="https://juejin.cn/user/1644525124592974"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别“代码屎山”：用Cursor系统重构遗留前端项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1644525124592974/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mr_chiu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:50:15.000Z" title="Sun Jan 04 2026 09:50:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当你面对数千行耦合的组件和混乱的状态逻辑时，AI重构将成为你最强的技术搭档。</p>
</blockquote>
<p>前端开发者职业生涯中，最令人望而生畏的挑战之一莫过于接手一个“祖传”的遗留项目。那些混合着不同时期技术栈、缺乏文档、逻辑缠绕如“意大利面”的代码库，常常让人进退两难：不重构则难以维护和扩展，动手重构又怕“牵一发而动全身”。</p>
<p>本篇将深入探讨如何利用 Cursor，系统性地对遗留前端项目进行安全、高效的重构，不仅偿还技术债务，更为项目注入新的生命力。</p>
<h2 data-id="heading-0">一、重构前奏：建立对“代码迷雾”的清晰认知</h2>
<h3 data-id="heading-1">1.1 项目分析与技术债务评估</h3>
<p>传统的手动分析大型代码库，往往需要数天甚至数周时间。而借助 Cursor，这一过程可以大幅加速。</p>
<p><strong>关键指令示例：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">分析当前React项目的整体架构，识别：
<span class="hljs-bullet">1.</span> 主要组件依赖关系
<span class="hljs-bullet">2.</span> 状态管理方案及其一致性问题
<span class="hljs-bullet">3.</span> 重复代码模式和潜在抽象点
<span class="hljs-bullet">4.</span> 性能瓶颈和内存泄漏风险
<span class="hljs-bullet">5.</span> 过时的API使用和废弃的生命周期方法
</code></pre>
<p>Cursor 能够快速生成一份结构化报告，包括可视化的组件依赖图谱和按优先级排序的技术债务清单。这种全局视角让你在动手前就明确重构的重点和边界。</p>
<h3 data-id="heading-2">1.2 为项目设立清晰的“重构规则”</h3>
<p>在开始重构前，一个关键的步骤是使用 <code>/generate rules</code> 命令或手动在项目根目录创建 <code>.cursor</code> 文件夹，为 AI 设定清晰的项目规则和约束。</p>
<p><strong>示例 <code>.cursor/rules.md</code>：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 本项目重构规则</span>

<span class="hljs-section">## 技术栈约束</span>
<span class="hljs-bullet">-</span> 使用 React 18 + TypeScript 5.0+
<span class="hljs-bullet">-</span> 状态管理统一迁移至 Zustand
<span class="hljs-bullet">-</span> 样式方案采用 Tailwind CSS

<span class="hljs-section">## 代码质量规则</span>
<span class="hljs-bullet">-</span> 禁止使用 <span class="hljs-code">`any`</span> 类型，必须定义明确接口
<span class="hljs-bullet">-</span> 组件必须支持按需加载（React.lazy）
<span class="hljs-bullet">-</span> 函数长度不超过50行，复杂逻辑必须拆分
<span class="hljs-bullet">-</span> 禁用过时的 <span class="hljs-code">`componentWillMount`</span> 等生命周期

<span class="hljs-section">## 架构原则</span>
<span class="hljs-bullet">-</span> 遵循单一职责原则，一个文件一个主要导出
<span class="hljs-bullet">-</span> 业务逻辑与UI组件必须分离
<span class="hljs-bullet">-</span> API调用必须通过统一的service层
</code></pre>
<p>为 AI 设定这些明确的规则，就像为一位聪明的实习生提供了清晰的工作手册，能确保后续生成的所有代码都符合你的架构愿景，避免生成“AI意大利面代码”。</p>
<h2 data-id="heading-3">二、分而治之：核心重构策略与Cursor实战</h2>
<h3 data-id="heading-4">2.1 破解“巨石组件”：智能拆解与职责分离</h3>
<p>面对一个承载了过多逻辑的“巨石组件”(Monolithic Component)，重构的第一步是理清其内部职责。</p>
<p><strong>实战案例：拆解一个混合了数据获取、表单处理和UI渲染的用户管理组件</strong></p>
<ol>
<li>
<p><strong>使用Cursor分析现有组件</strong>：</p>
<pre><code class="hljs language-go" lang="go">分析 <span class="hljs-string">`UserManagement.jsx`</span> 文件，识别其承担的主要职责，并建议符合单一职责原则的拆分方案。
</code></pre>
</li>
<li>
<p><strong>基于建议实施拆分</strong>：
根据 Cursor 的分析，可以按以下结构重构：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 旧结构：UserManagement.jsx (420行)</span>
<span class="hljs-comment">// 新结构：</span>
<span class="hljs-comment">// - hooks/useUserData.js      // 数据获取逻辑</span>
<span class="hljs-comment">// - services/userService.js   // API调用封装</span>
<span class="hljs-comment">// - components/UserForm.jsx   // 表单处理</span>
<span class="hljs-comment">// - components/UserList.jsx   // 用户列表展示</span>
<span class="hljs-comment">// - containers/UserManagementContainer.jsx // 组合层</span>
</code></pre>
</li>
<li>
<p><strong>让Cursor协助生成新模块</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">基于原 <span class="hljs-code">`UserManagement.jsx`</span> 中的表单验证逻辑，创建一个独立的 <span class="hljs-code">`UserForm`</span> 组件，要求：
<span class="hljs-bullet">-</span> 使用React Hook Form进行表单管理
<span class="hljs-bullet">-</span> 包含完整的验证规则（邮箱格式、密码强度等）
<span class="hljs-bullet">-</span> 支持提交状态（loading, success, error）
<span class="hljs-bullet">-</span> 导出清晰的TypeScript接口
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">2.2 状态管理现代化：从混乱到清晰</h3>
<p>遗留项目常见的问题是状态管理分散——Mixins、Context、本地状态和全局Store混杂使用。</p>
<p><strong>重构策略：统一迁移至现代状态库</strong></p>
<p>以从传统的类组件+Redux Thunk迁移到函数组件+Zustand为例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 让Cursor分析现有的Redux store和reducers</span>
<span class="hljs-comment">// 指令：“将以下Redux reducer转换为Zustand store，保持相同状态结构和操作”</span>

<span class="hljs-comment">// 2. 生成新的Zustand store</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserState</span> {
  <span class="hljs-attr">users</span>: <span class="hljs-title class_">User</span>[];
  <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">error</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
  <span class="hljs-attr">fetchUsers</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-attr">addUser</span>: <span class="hljs-function">(<span class="hljs-params">user: Omit&lt;User, <span class="hljs-string">'id'</span>&gt;</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-comment">// ... 其他操作</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = create&lt;<span class="hljs-title class_">UserState</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">users</span>: [],
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
  
  <span class="hljs-attr">fetchUsers</span>: <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> });
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> userService.<span class="hljs-title function_">getAll</span>();
      <span class="hljs-title function_">set</span>({ <span class="hljs-attr">users</span>: response.<span class="hljs-property">data</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">set</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'获取用户列表失败'</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> });
    }
  },
  
  <span class="hljs-comment">// ... 其他操作实现</span>
}));

<span class="hljs-comment">// 3. 生成迁移指南和兼容层</span>
<span class="hljs-comment">// Cursor可以创建一个临时的兼容层，确保重构期间业务不中断</span>
</code></pre>
<h3 data-id="heading-6">2.3 依赖升级与API现代化</h3>
<p>过时的依赖是技术债务的重要部分。Cursor可以帮助安全地进行依赖升级。</p>
<p><strong>实战步骤：</strong></p>
<ol>
<li>
<p><strong>识别过时依赖</strong>：</p>
<pre><code class="hljs language-go" lang="go">扫描<span class="hljs-keyword">package</span>.json，识别React、TypeScript、Webpack等核心依赖的当前版本和最新版本，评估升级风险。
</code></pre>
</li>
<li>
<p><strong>生成渐进式升级方案</strong>：
Cursor 能够提供分阶段的升级路径，例如先升级补丁版本，再升级次要版本，最后处理破坏性变更。</p>
</li>
<li>
<p><strong>修复破坏性变更</strong>：
当 API 发生破坏性变更时（如 React Router v5 到 v6），Cursor 可以协助批量修改：</p>
<pre><code class="hljs language-markdown" lang="markdown">将项目中所有React Router v5的用法迁移到v6，包括：
<span class="hljs-bullet">-</span> <span class="hljs-code">`&lt;Switch&gt;`</span> 改为 <span class="hljs-code">`&lt;Routes&gt;`</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`&lt;Route component={Component}&gt;`</span> 改为 <span class="hljs-code">`&lt;Route element={&lt;Component /&gt;}&gt;`</span>
<span class="hljs-bullet">-</span> 路由守卫逻辑调整
</code></pre>
</li>
</ol>
<h2 data-id="heading-7">三、Cursor高级重构功能实战</h2>
<h3 data-id="heading-8">3.1 多文件协同编辑与跨组件重构</h3>
<p>当重构影响到多个文件时，Cursor 的跨文件理解能力显得尤为重要。</p>
<p><strong>案例：将内联样式统一迁移至CSS Modules</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">重构整个项目的样式系统：
<span class="hljs-bullet">1.</span> 识别所有使用内联style属性的组件
<span class="hljs-bullet">2.</span> 为每个组件创建对应的.module.css文件
<span class="hljs-bullet">3.</span> 将内联样式迁移到CSS Modules中
<span class="hljs-bullet">4.</span> 更新组件导入和类名引用
</code></pre>
<p>Cursor 能够理解样式与组件的对应关系，批量完成迁移，同时保持样式优先级的一致性。</p>
<h3 data-id="heading-9">3.2 自动化代码质量提升</h3>
<p>利用 Cursor 自动修复常见的代码质量问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 重构前：复杂的条件嵌套</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserStatus</span> = (<span class="hljs-params">user</span>) =&gt; {
  <span class="hljs-keyword">if</span> (user) {
    <span class="hljs-keyword">if</span> (user.<span class="hljs-property">isActive</span>) {
      <span class="hljs-keyword">if</span> (user.<span class="hljs-property">lastLogin</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'在线'</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'新用户'</span>;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'已禁用'</span>;
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'用户不存在'</span>;
  }
};

<span class="hljs-comment">// 指令：“优化这段条件嵌套代码，使用更清晰的结构”</span>
<span class="hljs-comment">// 重构后：早期返回和卫语句</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserStatus</span> = (<span class="hljs-params">user</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> <span class="hljs-string">'用户不存在'</span>;
  <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">isActive</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'已禁用'</span>;
  <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">lastLogin</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'新用户'</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'在线'</span>;
};
</code></pre>
<h3 data-id="heading-10">3.3 测试驱动重构（TDR）</h3>
<p>Cursor 设计总监 Ryo Lu 强调的一个核心理念是：<strong>先写测试，再生成代码</strong>。这是防止重构引入回归错误的最有效方法。</p>
<p><strong>TDR工作流：</strong></p>
<ol>
<li>为要重构的组件或函数编写测试用例</li>
<li>运行现有测试确保基线正常</li>
<li>让 Cursor 在测试的“约束”下进行重构</li>
<li>运行测试验证重构正确性</li>
<li>修复任何失败的测试，并使用 <code>@fixed</code> 注释告诉 AI 正确做法</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 先编写测试</span>
<span class="hljs-title function_">describe</span>(<span class="hljs-string">'UserForm组件'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'应该验证邮箱格式'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { getByLabelText } = <span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span> /&gt;</span></span>);
    <span class="hljs-keyword">const</span> emailInput = <span class="hljs-title function_">getByLabelText</span>(<span class="hljs-string">'邮箱'</span>);
    fireEvent.<span class="hljs-title function_">change</span>(emailInput, { <span class="hljs-attr">target</span>: { <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid-email'</span> } });
    <span class="hljs-title function_">expect</span>(screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-string">'邮箱格式不正确'</span>)).<span class="hljs-title function_">toBeInTheDocument</span>();
  });
});

<span class="hljs-comment">// 2. 然后让Cursor实现或重构组件</span>
<span class="hljs-comment">// 指令：“实现UserForm组件，必须通过上述测试用例”</span>
</code></pre>
<h2 data-id="heading-11">四、人机协作：确定你在重构中的核心角色</h2>
<h3 data-id="heading-12">4.1 AI擅长的工作 ✅</h3>
<ul>
<li><strong>重复性模式识别</strong>：找出多个组件中的相似模式</li>
<li><strong>语法转换</strong>：将类组件转换为函数组件，添加TypeScript类型</li>
<li><strong>批量修改</strong>：重命名、提取常量、统一代码风格</li>
<li><strong>文档生成</strong>：基于代码生成注释和API文档</li>
<li><strong>基础测试用例</strong>：生成覆盖常规路径的测试</li>
</ul>
<h3 data-id="heading-13">4.2 需要人类把控的关键 🔑</h3>
<ul>
<li><strong>业务逻辑理解</strong>：AI可能不理解“为什么这段代码要这么写”</li>
<li><strong>架构决策</strong>：选择哪种状态管理方案、文件夹结构如何组织</li>
<li><strong>性能权衡</strong>：在代码可读性和极致性能间做选择</li>
<li><strong>用户体验考量</strong>：加载状态、错误处理、无障碍访问等细节</li>
<li><strong>团队规范</strong>：遵循团队特定的代码约定和流程</li>
</ul>
<p>正如多个实践案例所揭示的，最有效的模式是“AI负责效率，人负责精准”，开发者需要扮演“决策者与校验者”的角色。</p>
<h2 data-id="heading-14">五、重构工作流与最佳实践</h2>
<h3 data-id="heading-15">5.1 安全重构工作流</h3>
<p>以下是经过实践验证的安全重构流程：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[评估与规划] --&gt; B[建立安全网&lt;br&gt;编写测试用例]
    B --&gt; C[小步变更&lt;br&gt;每次只重构一个关注点]
    C --&gt; D[持续验证&lt;br&gt;运行测试和类型检查]
    D --&gt; E[代码审查&lt;br&gt;人工审核AI生成的代码]
    E --&gt; F[提交与记录&lt;br&gt;小批次提交，清晰注释]
    
    D -- 发现问题 --&gt; G[立即回滚&lt;br&gt;使用Git恢复]
    G --&gt; C
    
    F --&gt; H[迭代优化&lt;br&gt;基于反馈调整规则]
    H --&gt; A
</code></pre>
<h3 data-id="heading-16">5.2 重构中的Cursor高级技巧</h3>
<ol>
<li>
<p><strong>使用 <code>@file</code>、<code>@folder</code> 限定上下文范围</strong>
当处理特定文件时，使用 <code>@file:UserForm.jsx</code> 确保 Cursor 不会误改其他文件。</p>
</li>
<li>
<p><strong>利用对话历史持续迭代</strong>
使用 <code>/history</code> 调取旧对话，基于之前的决策继续重构，避免重复解释。</p>
</li>
<li>
<p><strong>有意识地选择模型</strong></p>
<ul>
<li><strong>GPT-4</strong>：适合复杂算法和架构设计</li>
<li><strong>Claude</strong>：擅长理解业务逻辑和创意性任务</li>
<li><strong>Cursor自研Composer模型</strong>：速度极快，适合快速迭代</li>
</ul>
</li>
<li>
<p><strong>大项目预索引</strong>
对于大型代码库，可以让 Cursor 提前建立索引（“过夜索引”），这样在后续操作中响应更快。</p>
</li>
</ol>
<h2 data-id="heading-17">六、从重构到预防：建立可持续的代码文化</h2>
<p>重构的最终目的不是一次性地“还清债务”，而是建立防止新债务产生的机制。</p>
<h3 data-id="heading-18">6.1 建立团队AI协作规范</h3>
<ul>
<li><strong>制定AI生成代码的评审标准</strong>：明确什么情况下可以接受AI生成的代码</li>
<li><strong>创建团队共享的<code>.cursor</code>配置</strong>：统一团队的开发约束和规则</li>
<li><strong>定期更新项目规则库</strong>：随着项目发展调整规则</li>
</ul>
<h3 data-id="heading-19">6.2 监控与度量</h3>
<p>建立关键指标来跟踪重构效果：</p>
<ul>
<li><strong>代码复杂度得分</strong>（如圈复杂度）</li>
<li><strong>测试覆盖率变化</strong></li>
<li><strong>构建时间优化</strong></li>
<li><strong>包体积减少</strong></li>
</ul>
<h2 data-id="heading-20">结语：重构作为持续实践</h2>
<p>使用 Cursor 进行遗留项目重构，不是一次性的“魔法修复”，而是一个持续的、系统性的工程实践。它改变了重构的成本效益方程——过去因为风险太高而不敢触碰的“代码雷区”，现在可以安全、渐进地改善。</p>
<p><strong>记住</strong>：最好的重构策略是小步快跑、持续验证。每次提交只改变一件事，确保有完整的测试覆盖，让 Cursor 成为你的技术搭档而非替代者。</p>
<p>当你成功将一个混乱的遗留系统重构为清晰、可维护的现代代码库时，那种成就感是无可替代的。而 Cursor，正是让你能够勇敢面对“代码屎山”，将其转化为坚实技术基座的关键工具。</p>
<hr/>
<p><strong>下篇预告</strong>：在第三篇中，我们将探索如何将 Cursor 深度融入团队工作流，包括多人协作最佳实践、代码审查自动化、文档智能生成等高级主题，敬请期待！</p>
<p><strong>互动话题</strong>：你在重构遗留项目时遇到的最大挑战是什么？尝试用本文介绍的方法解决一个小问题，并在评论区分享你的经验和成果！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一站式构建 AI 数据处理 Pipeline：DataWorks Notebook + MaxCompute MaxFrame 快速入门指南]]></title>    <link>https://juejin.cn/post/7591130604429508648</link>    <guid>https://juejin.cn/post/7591130604429508648</guid>    <pubDate>2026-01-04T10:20:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604429508648" data-draft-id="7591309945510068224" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一站式构建 AI 数据处理 Pipeline：DataWorks Notebook + MaxCompute MaxFrame 快速入门指南"/> <meta itemprop="keywords" content="大数据,人工智能"/> <meta itemprop="datePublished" content="2026-01-04T10:20:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一站式构建 AI 数据处理 Pipeline：DataWorks Notebook + MaxCompute MaxFrame 快速入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:20:07.000Z" title="Sun Jan 04 2026 10:20:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​在大模型与 AI 应用快速落地的今天，企业对“数据准备 → 数据处理 → 模型训练”的端到端效率提出了更高要求。阿里云数据开发治理平台 DataWorks 联合云原生大数据计算服务 MaxCompute，为您提供一套开箱即用、安全合规、弹性可扩展的 AI 数据开发环境，特别适合需要处理 TB/PB 级结构化、半/非结构化数据的 AI 工程师、数据科学家与算法团队。</p>
<p>本文将带您快速了解如何基于阿里云两大核心产品——DataWorks（大数据开发与治理平台）、MaxCompute（云原生大数据计算服务）以及MaxFrame（分布式Python计算框架）—— 高效搭建一个支持 Notebook 交互式开发、任务调度与大规模并行计算的一体化 AI 数据处理环境。</p>
<h2 data-id="heading-0">为什么选择这套组合？</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0eadaa4dad3e4aa9b7ad5a8d8129b5be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768126896&amp;x-signature=dSxyvcX9p9l4KVczi%2Bl2PWxKJFI%3D" alt="" loading="lazy"/></p>
<p><strong>优势总结：</strong></p>
<ul>
<li>
<p>无需自建集群：全托管服务，分钟级开通</p>
</li>
<li>
<p>开发体验友好：Jupyter Notebook 风格，支持 Magic Command 快速连接计算资源</p>
</li>
<li>
<p>安全合规：天然集成 RAM 权限体系、VPC 网络隔离、敏感信息加密</p>
</li>
<li>
<p>成本可控：按量付费 + 包年包月，适合测试与生产混合场景</p>
</li>
</ul>
<h2 data-id="heading-1">环境搭建四步走（核心流程）</h2>
<p>虽然底层涉及多个服务联动，但对用户而言，只需完成以下四个关键步骤，即可进入开发状态：</p>
<h4 data-id="heading-2">第一步：开通 MaxCompute 项目</h4>
<p>作为计算与存储的核心，MaxCompute 项目是所有数据作业的资源底座。</p>
<ul>
<li>
<p>选择与业务一致的地域（如华东2-上海）</p>
</li>
<li>
<p>推荐使用按量付费模式（新用户可享受免费额度）</p>
</li>
<li>
<p>项目名称建议包含业务标识（如 <code>ai_dedup_01</code>），便于后续管理</p>
</li>
</ul>
<h4 data-id="heading-3">第二步：创建 DataWorks 工作空间</h4>
<p>DataWorks 提供从开发到运维的完整工具链。</p>
<ul>
<li>
<p>选择基础版即可满足 Notebook 开发需求（免费）</p>
</li>
<li>
<p>创建通用型资源组（按量付费），并绑定VPC网络（若需访问 OSS、PAI 等内网服务）</p>
</li>
<li>
<p>指定空间管理员，并添加团队成员（支持 RAM 子账号）</p>
</li>
</ul>
<p>建议开启“新版数据开发（Data Studio）”，获得更流畅的 Notebook 体验。</p>
<h4 data-id="heading-4">第三步：绑定计算资源</h4>
<p>将 MaxCompute 项目“绑定”到 DataWorks 工作空间，实现开发与计算的打通。</p>
<ul>
<li>
<p>在工作空间管理页中，一键绑定已创建的 MaxCompute 项目</p>
</li>
<li>
<p>选择合适的资源组（用于任务调度与 Notebook 执行）</p>
</li>
<li>
<p>测试连通性，确保权限与网络配置正确</p>
</li>
</ul>
<p>安全提示：建议使用“阿里云主账号”作为默认执行身份，避免权限不足问题。</p>
<h4 data-id="heading-5">第四步：启动个人开发环境</h4>
<p>这是您编写代码的“云端工作站”。</p>
<ul>
<li>
<p>在 Data Studio 中新建一个个人开发环境实例</p>
</li>
<li>
<p>选择 CPU 规格（如 4 vCPU / 16 GiB）和预置镜像（如 dataworks-maxcompute:py3.11-ubuntu20.04:py3.11-ubuntu20.04-202504-1）</p>
</li>
<li>
<p>实例启动后，即可在 Notebook 中直接连通 MaxFrame 进行分布式计算</p>
</li>
</ul>
<p>注意：实例按CU*时长计费，不使用时请手动停止，避免产生额外费用。</p>
<h2 data-id="heading-6">开始开发：用 MaxFrame 处理海量数据</h2>
<p>一切就绪后，您可以在 Notebook 中像写 Pandas 一样处理亿级数据：</p>
<pre><code class="hljs language-ini" lang="ini">import maxframe.dataframe as md
import pyarrow as pa
import pandas as pd
from maxframe.lib.dtypes_extension import dict_

<span class="hljs-comment"># 初始化 MaxFrame 会话（通过 Magic Command 自动连接 MaxCompute）</span>
<span class="hljs-attr">mf_session</span> = %maxframe

<span class="hljs-comment"># 构造 DataFrame（实际数据可来自 MaxCompute 表）</span>
<span class="hljs-attr">col_a</span> = pd.Series(
    <span class="hljs-attr">data</span>=[[(<span class="hljs-string">"k1"</span>, <span class="hljs-number">1</span>), (<span class="hljs-string">"k2"</span>, <span class="hljs-number">2</span>)], [(<span class="hljs-string">"k1"</span>, <span class="hljs-number">3</span>)], None],
    <span class="hljs-attr">index</span>=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
    <span class="hljs-attr">dtype</span>=dict_(pa.string(), pa.int64()),
)
<span class="hljs-attr">col_b</span> = pd.Series(
    <span class="hljs-attr">data</span>=[<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>],
    <span class="hljs-attr">index</span>=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
)
<span class="hljs-attr">df</span> = md.DataFrame({<span class="hljs-string">"A"</span>: col_a, <span class="hljs-string">"B"</span>: col_b})
df.execute()

<span class="hljs-comment"># 自定义函数</span>
def custom_set_item(df):
    for name, value in df<span class="hljs-section">["A"]</span>.items():
        if value is not None:
            df<span class="hljs-section">["A"]</span><span class="hljs-section">[name]</span><span class="hljs-section">["x"]</span> = 100
    return df

<span class="hljs-comment"># 调用 apply_chunk 执行分布式计算</span>
<span class="hljs-attr">result_df</span> = df.mf.apply_chunk(
    custom_set_item,
    <span class="hljs-attr">output_type</span>=<span class="hljs-string">"dataframe"</span>,
    <span class="hljs-attr">dtypes</span>=df.dtypes.copy(),
    <span class="hljs-attr">batch_rows</span>=<span class="hljs-number">2</span>,
    <span class="hljs-attr">skip_infer</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">index</span>=df.index,
).execute().fetch()

print(result_df)
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p><strong>亮点功能：</strong></p>
<ul>
<li>
<p>使用 <code>%maxframe</code> Magic Command，无需明文 AccessKey，快捷连通目标计算资源</p>
</li>
<li>
<p>输出中包含 Logview 链接，一键查看作业 DAG、耗时、失败原因</p>
</li>
<li>
<p>支持将结果写回 MaxCompute 表或导出至 OSS，无缝衔接下游模型训练</p>
</li>
</ul>
<h2 data-id="heading-7">最佳实践建议</h2>
<p>为了让您的开发更高效、更稳定，推荐关注以下几点：</p>
<h4 data-id="heading-8">1. 善用 Logview 2.0</h4>
<p>每次执行都会生成可视化作业追踪链接，帮助快速定位性能瓶颈或错误根源。</p>
<h4 data-id="heading-9">2. 合理配置资源配额</h4>
<p>通过设置 <code>options.session.quota_name</code> 指定后付费/预付费 Quota，按业务需求灵活选择。</p>
<h4 data-id="heading-10">3. 敏感信息统一管理</h4>
<p>在 DataWorks 工作空间参数中配置 AK/SK 或数据库密码，代码中通过 ${workspace.工作空间参数名} <code>引用，杜绝明文泄露。</code></p>
<h4 data-id="heading-11">4. 利用数据地图做元数据治理</h4>
<p>DataWorks 自动同步 MaxCompute 表结构，支持血缘分析、表预览、生命周期管理，提升团队协作效率。</p>
<h2 data-id="heading-12">常见问题快速排查</h2>
<ul>
<li>
<p>Q：Notebook 中查不到 MaxCompute 表？<br/>
A：确认 MaxCompute 项目已绑定到当前 DataWorks 工作空间，并检查账号是否有读权限；可在“数据地图”中手动刷新元数据。</p>
</li>
<li>
<p>Q：无法读写 OSS 数据？<br/>
A：确保 RAM 用户拥有对应 Bucket 的读写权限，且个人开发环境实例（开发环境）和通用型资源组（生产环境）与 OSS 在同一 VPC 内（或已配置公网访问）。</p>
</li>
</ul>
<h2 data-id="heading-13">下一步行动</h2>
<p>现在，您已经拥有了一个安全、弹性、高性能的 AI 数据处理平台。无论是进行数据去重、特征打标、日志清洗，还是为大模型准备高质量训练语料，这套组合都能为您提供强大支撑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工程化实战：uniapp基于路由的自动主题切换体系]]></title>    <link>https://juejin.cn/post/7591346773827092506</link>    <guid>https://juejin.cn/post/7591346773827092506</guid>    <pubDate>2026-01-04T10:24:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827092506" data-draft-id="7591338980693295150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工程化实战：uniapp基于路由的自动主题切换体系"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-04T10:24:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LC同学47981"/> <meta itemprop="url" content="https://juejin.cn/user/1978776660477991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工程化实战：uniapp基于路由的自动主题切换体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776660477991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LC同学47981
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:24:53.000Z" title="Sun Jan 04 2026 10:24:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">UI 工程化实战：基于路由的自动主题切换体系</h2>
<p>在多租户 SaaS 系统中，不同业务模块往往需要展现截然不同的视觉风格。例如，“电商主页”通常采用蓝色调的商务风格，而“扫码点餐”模块则偏向红色的营销风格。如何让用户在不同模块间跳转时，系统能<strong>自动、无感地切换主题</strong>，是提升用户体验的关键。</p>
<p>本文将深入解析本项目基于 <strong>CSS 变量 + 路由监听 + Pinia Store</strong> 构建的自动主题切换体系。</p>
<hr/>
<h3 data-id="heading-1">一、 核心痛点</h3>
<ol>
<li><strong>手动切换繁琐</strong>：如果依赖开发者在每个页面 <code>onLoad</code> 时手动调用 <code>setTheme('red')</code>，不仅代码冗余，还极易遗漏。</li>
<li><strong>样式难以复用</strong>：硬编码的颜色值（如 <code>#ff4b43</code>）散落在各个组件中，修改主题色需要全局搜索替换。</li>
<li><strong>多租户适配难</strong>：不同租户可能对同一模块有不同的颜色偏好，静态配置无法满足需求。</li>
</ol>
<hr/>
<h3 data-id="heading-2">二、 架构设计</h3>
<p>我们设计了一套<strong>三层架构</strong>来解决上述问题：</p>
<ol>
<li><strong>定义层 (Theme Definition)</strong>：集中定义多套主题的颜色变量（JS）和样式变量（CSS Vars）。
<blockquote>
<p><strong>亮点</strong>：除了本地预设，<strong>支持运行时通过接口下发变量进行动态覆盖</strong>，从而实现“无限自由换肤”。</p>
</blockquote>
</li>
<li><strong>配置层 (Theme Config)</strong>：建立“路由路径 -&gt; 主题名称”的映射规则。</li>
<li><strong>执行层 (Runtime Switcher)</strong>：监听路由变化，自动匹配并应用主题。</li>
</ol>
<h4 data-id="heading-3">1. 定义层：JS 与 CSS 变量的双重驱动</h4>
<p>在 <code>src/store/useStyle/theme/</code> 目录下，我们定义了 <code>light</code>（默认蓝）、<code>red</code>（营销红）、<code>dark</code>（暗黑）等多套主题。</p>
<p>以 <code>light.ts</code> 为例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// CSS 变量：用于组件的样式绑定</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cssVars = {
  <span class="hljs-string">'--u-background'</span>: <span class="hljs-string">'#ffffff'</span>,
  <span class="hljs-string">'--u-text'</span>: <span class="hljs-string">'#333333'</span>
};

<span class="hljs-comment">// JS 变量：用于 canvas 绘图或 JS 逻辑</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> colorVars = {
  <span class="hljs-attr">primary</span>: <span class="hljs-string">'#2B67F0'</span>, <span class="hljs-comment">// 主色调：蓝</span>
  <span class="hljs-attr">warning</span>: <span class="hljs-string">'#FF7D00'</span>
  <span class="hljs-comment">// ...</span>
};
</code></pre>
<h4 data-id="heading-4">2. 配置层：路由映射规则</h4>
<p>在 <code>src/utils/env.ts</code> 中，我们通过 <code>defaultTheme</code> 字段配置了主题的适用范围：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">defaultTheme</span>: {
      <span class="hljs-attr">light</span>: <span class="hljs-string">'*'</span>, <span class="hljs-comment">// 默认使用 light 主题</span>
      <span class="hljs-attr">dark</span>: [],
      <span class="hljs-attr">red</span>: [<span class="hljs-string">'subPackageScanQrOrder'</span>] <span class="hljs-comment">// 进入“扫码点餐”分包时，强制切换为 red 主题</span>
    },
    <span class="hljs-attr">defaultThemeColor</span>: <span class="hljs-string">'light'</span>
  };
};
</code></pre>
<h4 data-id="heading-5">3. 执行层：智能路由监听</h4>
<p>在根组件 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">App.ku.vue</a> 中，我们利用 <code>useStyles</code> Store 提供的能力，在应用启动或路由变化时触发检查。</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
  <span class="hljs-keyword">import</span> { useStyles } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/useStyle'</span>;
  <span class="hljs-keyword">import</span> { parseRouteParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/tools'</span>;

  <span class="hljs-comment">// 获取当前路径（包含分包路径）</span>
  <span class="hljs-keyword">const</span> { hashPath } = <span class="hljs-title function_">parseRouteParams</span>();

  <span class="hljs-keyword">if</span> (hashPath) {
    <span class="hljs-comment">// 触发自动主题切换</span>
    <span class="hljs-title function_">useStyles</span>().<span class="hljs-title function_">switchThemeByRouter</span>(hashPath);
  }
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-6">三、 核心代码解析</h3>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">src/store/useStyle/index.ts</a> 是整个机制的大脑。</p>
<h4 data-id="heading-7">1. 路由匹配逻辑</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">switchThemeByRouter</span> = (<span class="hljs-params">routePath: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">getConfig</span>();

  <span class="hljs-comment">// 1. 提取路径前缀（分包名）</span>
  <span class="hljs-keyword">let</span> pathPrefix = routePath.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>)[<span class="hljs-number">0</span>];

  <span class="hljs-comment">// 2. 遍历配置，寻找匹配的主题</span>
  <span class="hljs-keyword">let</span> key = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(config.<span class="hljs-property">defaultTheme</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    <span class="hljs-comment">// 检查当前路径是否在某个主题的配置列表中</span>
    <span class="hljs-keyword">return</span> config.<span class="hljs-property">defaultTheme</span>[key <span class="hljs-keyword">as</span> <span class="hljs-title class_">ThemeColor</span>]?.<span class="hljs-title function_">includes</span>(pathPrefix);
  });

  <span class="hljs-comment">// 3. 兜底策略：未匹配则使用默认主题</span>
  <span class="hljs-keyword">if</span> (!key) {
    <span class="hljs-title function_">switchTheme</span>(config.<span class="hljs-property">defaultThemeColor</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 4. 执行切换</span>
  <span class="hljs-title function_">switchTheme</span>(key <span class="hljs-keyword">as</span> <span class="hljs-title class_">ThemeColor</span>);
};
</code></pre>
<h4 data-id="heading-8">2. 样式注入逻辑</h4>
<p><code>switchTheme</code> 方法负责将选定主题的变量注入到 <code>uview-pro</code> 的主题系统中，使其全局生效。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">switchTheme</span> = (<span class="hljs-params">theme: ThemeColor</span>) =&gt; {
  <span class="hljs-keyword">if</span> (currentThemeColor.<span class="hljs-property">value</span> === theme) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 避免重复切换</span>

  <span class="hljs-keyword">const</span> themeVars = <span class="hljs-title function_">getTheme</span>(theme);

  <span class="hljs-comment">// 更新 Pinia 状态</span>
  currentThemeColor.<span class="hljs-property">value</span> = theme;

  <span class="hljs-comment">// 调用 UI 库的 setTheme 方法，底层会将 CSS 变量挂载到 :root 上</span>
  <span class="hljs-title function_">changeTheme</span>({
    <span class="hljs-attr">selfColorsVars</span>: themeVars.<span class="hljs-property">colorVars</span>,
    <span class="hljs-attr">selfCssVars</span>: themeVars.<span class="hljs-property">cssVars</span>
  });
};
</code></pre>
<hr/>
<h3 data-id="heading-9">四、 方案优势</h3>
<ol>
<li><strong>零侵入性</strong>：业务页面无需编写任何主题切换代码，只需关注业务逻辑。</li>
<li><strong>细粒度控制</strong>：支持按分包、按页面甚至按租户配置不同的主题规则。</li>
<li><strong>动态性</strong>：除了内置主题，该架构还支持从服务端下发 JSON 配置，实现“千人千面”的动态换肤。</li>
<li><strong>一致性</strong>：JS 变量与 CSS 变量同步更新，确保 Canvas 图表与 DOM 元素的颜色始终保持一致。</li>
</ol>
<p>通过这套 UI 工程化体系，我们成功实现了复杂业务场景下的自动化视觉管理，显著提升了开发效率与用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果]]></title>    <link>https://juejin.cn/post/7591338980693393454</link>    <guid>https://juejin.cn/post/7591338980693393454</guid>    <pubDate>2026-01-04T10:34:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591338980693393454" data-draft-id="7591207451779285018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2026-01-04T10:34:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="下位子"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    下位子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:34:42.000Z" title="Sun Jan 04 2026 10:34:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">前言: 『OpenGL学习』 从零打造 Android 滤镜相机</a></p>
<p><a href="https://juejin.cn/post/7572493520004104226" target="_blank" title="https://juejin.cn/post/7572493520004104226">上一篇:『OpenGL学习滤镜相机』- Day10: 相机预览与 OpenGL 结合</a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://github.com/xiaweizi/OpenGLTest" ref="nofollow noopener noreferrer">OpenGLTest</a></p>
</blockquote>
<h2 data-id="heading-0">📚 今日目标</h2>
<ul>
<li>掌握常见滤镜算法的原理和实现</li>
<li>学习色彩空间转换（RGB、HSV）</li>
<li>实现多种实时滤镜效果</li>
<li>理解滤镜参数调节机制</li>
<li>为美颜功能打下基础</li>
</ul>
<h2 data-id="heading-1">运行效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75c0feef23174a6d89469a02389a6932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128434&amp;x-signature=Lnndq6l7RNnvOgVBPak4cpWQKYc%3D" alt="Day11.gif" loading="lazy"/></p>
<h2 data-id="heading-2">🎯 学习内容</h2>
<h3 data-id="heading-3">1. 滤镜基础原理</h3>
<p><strong>滤镜本质</strong>：在片段着色器中修改每个像素的颜色值。</p>
<pre><code class="hljs language-python" lang="python">原始像素颜色 → 滤镜算法处理 → 输出新颜色
   (R, G, B)  →   f(R, G, B)   → (<span class="hljs-string">R', G'</span>, <span class="hljs-string">B')
</span></code></pre>
<h4 data-id="heading-4">滤镜的分类</h4>






























<table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>色彩调整</strong></td><td>修改 RGB 值</td><td>灰度、反色、亮度</td></tr><tr><td><strong>色调风格</strong></td><td>特定色彩倾向</td><td>复古、暖色、冷色</td></tr><tr><td><strong>卷积滤镜</strong></td><td>使用周围像素</td><td>模糊、锐化、边缘检测</td></tr><tr><td><strong>空间变换</strong></td><td>改变像素位置</td><td>扭曲、瘦脸</td></tr></tbody></table>
<h3 data-id="heading-5">2. 常见滤镜实现</h3>
<h4 data-id="heading-6">2.1 灰度滤镜</h4>
<p><strong>原理</strong>：将 RGB 转换为单一亮度值。</p>
<p><strong>加权平均公式</strong>（符合人眼对颜色的敏感度）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Gray</span> = <span class="hljs-number">0.299</span> × R + <span class="hljs-number">0.587</span> × G + <span class="hljs-number">0.114</span> × B
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 grayscale(vec4 color) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    return vec4(vec3(gray), color.a);
}
</code></pre>
<p><strong>简化版</strong>（性能更高）：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 grayscale(vec4 color) {
    float gray = (color.r + color.g + color.b) / 3.0;
    return vec4(vec3(gray), color.a);
}
</code></pre>
<h4 data-id="heading-7">2.2 反色滤镜</h4>
<p><strong>原理</strong>：每个颜色分量用 1.0 减去原值。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 invert(vec4 color) {
    return vec4(1.0 - color.rgb, color.a);
}
</code></pre>
<h4 data-id="heading-8">2.3 亮度调整</h4>
<p><strong>原理</strong>：所有颜色分量加上/减去同一个值。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uBrightness;  // -1.0 到 1.0

vec4 brightness(vec4 color, float value) {
    return vec4(color.rgb + value, color.a);
}
</code></pre>
<h4 data-id="heading-9">2.4 对比度调整</h4>
<p><strong>原理</strong>：拉伸或压缩颜色值的范围。</p>
<p><strong>公式</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">newColor</span> = (color - <span class="hljs-number">0.5</span>) × contrast + <span class="hljs-number">0.5</span>
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uContrast;  // 0.0 到 2.0

vec4 contrast(vec4 color, float value) {
    return vec4((color.rgb - 0.5) * value + 0.5, color.a);
}
</code></pre>
<h4 data-id="heading-10">2.5 饱和度调整</h4>
<p><strong>原理</strong>：在灰度和原色之间插值。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uSaturation;  // 0.0 到 2.0

vec4 saturation(vec4 color, float value) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    vec3 result = mix(vec3(gray), color.rgb, value);
    return vec4(result, color.a);
}
</code></pre>
<h4 data-id="heading-11">2.6 暖色调滤镜</h4>
<p><strong>原理</strong>：增加红色和黄色，营造温暖感觉。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 warm(vec4 color) {
    color.r = color.r + 0.1;  // 增加红色
    color.g = color.g + 0.05; // 微增绿色（产生黄色）
    return clamp(color, 0.0, 1.0);
}
</code></pre>
<h4 data-id="heading-12">2.7 冷色调滤镜</h4>
<p><strong>原理</strong>：增加蓝色，营造清冷感觉。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 cool(vec4 color) {
    color.b = color.b + 0.1;  // 增加蓝色
    return clamp(color, 0.0, 1.0);
}
</code></pre>
<h4 data-id="heading-13">2.8 复古滤镜</h4>
<p><strong>原理</strong>：降低饱和度 + 增加棕褐色调。</p>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 sepia(vec4 color) {
    float r = color.r * 0.393 + color.g * 0.769 + color.b * 0.189;
    float g = color.r * 0.349 + color.g * 0.686 + color.b * 0.168;
    float b = color.r * 0.272 + color.g * 0.534 + color.b * 0.131;
    return vec4(r, g, b, color.a);
}
</code></pre>
<h3 data-id="heading-14">3. 色彩空间转换</h3>
<h4 data-id="heading-15">3.1 RGB vs HSV</h4>




















<table><thead><tr><th>色彩空间</th><th>组成</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>RGB</strong></td><td>Red, Green, Blue</td><td>显示、存储</td></tr><tr><td><strong>HSV</strong></td><td>Hue, Saturation, Value</td><td>色彩调整</td></tr></tbody></table>
<p><strong>HSV 的优势</strong>：</p>
<ul>
<li><strong>Hue（色相）</strong>：调整整体色调（0-360°）</li>
<li><strong>Saturation（饱和度）</strong>：调整颜色鲜艳程度（0-1）</li>
<li><strong>Value（明度）</strong>：调整亮度（0-1）</li>
</ul>
<h4 data-id="heading-16">3.2 RGB 转 HSV</h4>
<pre><code class="hljs language-glsl" lang="glsl">vec3 rgb2hsv(vec3 c) {
    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

    float d = q.x - min(q.w, q.y);
    float e = 1.0e-10;
    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}
</code></pre>
<h4 data-id="heading-17">3.3 HSV 转 RGB</h4>
<pre><code class="hljs language-glsl" lang="glsl">vec3 hsv2rgb(vec3 c) {
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
</code></pre>
<h4 data-id="heading-18">3.4 色相偏移滤镜</h4>
<pre><code class="hljs language-glsl" lang="glsl">uniform float uHueShift;  // 0.0 到 1.0

vec4 hueShift(vec4 color, float shift) {
    vec3 hsv = rgb2hsv(color.rgb);
    hsv.x = fract(hsv.x + shift);  // 循环色相
    vec3 rgb = hsv2rgb(hsv);
    return vec4(rgb, color.a);
}
</code></pre>
<h3 data-id="heading-19">4. 卷积滤镜</h3>
<h4 data-id="heading-20">4.1 什么是卷积？</h4>
<p>卷积使用周围像素来计算当前像素的值。</p>
<p><strong>3×3 卷积核示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">┌─────┬─────┬─────┐</span>
<span class="hljs-string">│</span> <span class="hljs-string">TL</span>  <span class="hljs-string">│</span> <span class="hljs-string">TM</span>  <span class="hljs-string">│</span> <span class="hljs-string">TR</span>  <span class="hljs-string">│</span>  <span class="hljs-attr">TL:</span> <span class="hljs-string">Top</span> <span class="hljs-string">Left,</span> <span class="hljs-attr">TM:</span> <span class="hljs-string">Top</span> <span class="hljs-string">Middle,</span> <span class="hljs-attr">TR:</span> <span class="hljs-string">Top</span> <span class="hljs-string">Right</span>
<span class="hljs-string">├─────┼─────┼─────┤</span>
<span class="hljs-string">│</span> <span class="hljs-string">ML</span>  <span class="hljs-string">│</span> <span class="hljs-string">MC</span>  <span class="hljs-string">│</span> <span class="hljs-string">MR</span>  <span class="hljs-string">│</span>  <span class="hljs-attr">ML:</span> <span class="hljs-string">Middle</span> <span class="hljs-string">Left,</span> <span class="hljs-attr">MC:</span> <span class="hljs-string">Middle</span> <span class="hljs-string">Center,</span> <span class="hljs-attr">MR:</span> <span class="hljs-string">Middle</span> <span class="hljs-string">Right</span>
<span class="hljs-string">├─────┼─────┼─────┤</span>
<span class="hljs-string">│</span> <span class="hljs-string">BL</span>  <span class="hljs-string">│</span> <span class="hljs-string">BM</span>  <span class="hljs-string">│</span> <span class="hljs-string">BR</span>  <span class="hljs-string">│</span>  <span class="hljs-attr">BL:</span> <span class="hljs-string">Bottom</span> <span class="hljs-string">Left,</span> <span class="hljs-attr">BM:</span> <span class="hljs-string">Bottom</span> <span class="hljs-string">Middle,</span> <span class="hljs-attr">BR:</span> <span class="hljs-string">Bottom</span> <span class="hljs-string">Right</span>
<span class="hljs-string">└─────┴─────┴─────┘</span>
</code></pre>
<h4 data-id="heading-21">4.2 模糊滤镜（均值滤波）</h4>
<p><strong>卷积核</strong>（所有权重相等）：</p>
<pre><code class="hljs">┌─────┬─────┬─────┐
│ 1/9 │ 1/9 │ 1/9 │
├─────┼─────┼─────┤
│ 1/9 │ 1/9 │ 1/9 │
├─────┼─────┼─────┤
│ 1/9 │ 1/9 │ 1/9 │
└─────┴─────┴─────┘
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">uniform vec2 uTexelSize;  // vec2(1.0/width, 1.0/height)

vec4 blur(sampler2D texture, vec2 texCoord) {
    vec4 sum = vec4(0.0);
    for (float x = -1.0; x &lt;= 1.0; x += 1.0) {
        for (float y = -1.0; y &lt;= 1.0; y += 1.0) {
            vec2 offset = vec2(x, y) * uTexelSize;
            sum += texture2D(texture, texCoord + offset);
        }
    }
    return sum / 9.0;
}
</code></pre>
<h4 data-id="heading-22">4.3 锐化滤镜</h4>
<p><strong>卷积核</strong>：</p>
<pre><code class="hljs">┌─────┬─────┬─────┐
│  0  │ -1  │  0  │
├─────┼─────┼─────┤
│ -1  │  5  │ -1  │
├─────┼─────┼─────┤
│  0  │ -1  │  0  │
└─────┴─────┴─────┘
</code></pre>
<p><strong>GLSL 实现</strong>：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 sharpen(sampler2D texture, vec2 texCoord, vec2 texelSize) {
    vec4 center = texture2D(texture, texCoord);
    vec4 top    = texture2D(texture, texCoord + vec2(0.0, texelSize.y));
    vec4 bottom = texture2D(texture, texCoord - vec2(0.0, texelSize.y));
    vec4 left   = texture2D(texture, texCoord - vec2(texelSize.x, 0.0));
    vec4 right  = texture2D(texture, texCoord + vec2(texelSize.x, 0.0));
    
    return center * 5.0 - top - bottom - left - right;
}
</code></pre>
<h3 data-id="heading-23">5. 综合滤镜着色器</h3>
<pre><code class="hljs language-glsl" lang="glsl">#extension GL_OES_EGL_image_external : require
precision mediump float;

varying vec2 vTexCoord;
uniform samplerExternalOES uTexture;
uniform int uFilterType;
uniform vec2 uTexelSize;

// 滤镜参数
uniform float uIntensity;  // 滤镜强度 0.0 - 1.0

// RGB 转 HSV
vec3 rgb2hsv(vec3 c) {
    // ... 实现代码 ...
}

// HSV 转 RGB
vec3 hsv2rgb(vec3 c) {
    // ... 实现代码 ...
}

// 灰度滤镜
vec4 grayscale(vec4 color) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    return vec4(vec3(gray), color.a);
}

// 复古滤镜
vec4 sepia(vec4 color) {
    float r = color.r * 0.393 + color.g * 0.769 + color.b * 0.189;
    float g = color.r * 0.349 + color.g * 0.686 + color.b * 0.168;
    float b = color.r * 0.272 + color.g * 0.534 + color.b * 0.131;
    return vec4(r, g, b, color.a);
}

// 暖色调滤镜
vec4 warm(vec4 color) {
    color.r = min(color.r + 0.1, 1.0);
    color.g = min(color.g + 0.05, 1.0);
    return color;
}

// 冷色调滤镜
vec4 cool(vec4 color) {
    color.b = min(color.b + 0.1, 1.0);
    return color;
}

// 反色滤镜
vec4 invert(vec4 color) {
    return vec4(1.0 - color.rgb, color.a);
}

// 黑白滤镜（高对比度）
vec4 blackWhite(vec4 color) {
    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
    float bw = step(0.5, gray);  // 阈值 0.5
    return vec4(vec3(bw), color.a);
}

void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec4 filtered;
    
    if (uFilterType == 0) {
        // 原图
        filtered = color;
    } else if (uFilterType == 1) {
        // 灰度
        filtered = grayscale(color);
    } else if (uFilterType == 2) {
        // 复古
        filtered = sepia(color);
    } else if (uFilterType == 3) {
        // 暖色调
        filtered = warm(color);
    } else if (uFilterType == 4) {
        // 冷色调
        filtered = cool(color);
    } else if (uFilterType == 5) {
        // 反色
        filtered = invert(color);
    } else if (uFilterType == 6) {
        // 黑白
        filtered = blackWhite(color);
    } else {
        filtered = color;
    }
    
    // 应用滤镜强度（原图和滤镜效果的混合）
    gl_FragColor = mix(color, filtered, uIntensity);
}
</code></pre>
<h3 data-id="heading-24">6. 滤镜参数调节</h3>
<h4 data-id="heading-25">6.1 滤镜强度</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用 SeekBar 调节滤镜强度</span>
seekBarIntensity.setOnSeekBarChangeListener(<span class="hljs-keyword">object</span> : SeekBar.OnSeekBarChangeListener {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onProgressChanged</span><span class="hljs-params">(seekBar: <span class="hljs-type">SeekBar</span>?, progress: <span class="hljs-type">Int</span>, fromUser: <span class="hljs-type">Boolean</span>)</span></span> {
        <span class="hljs-keyword">val</span> intensity = progress / <span class="hljs-number">100.0f</span>
        glSurfaceView.queueEvent {
            renderer.setFilterIntensity(intensity)
        }
    }
})
</code></pre>
<h4 data-id="heading-26">6.2 Renderer 中的参数传递</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day11Renderer</span> : <span class="hljs-type">GLSurfaceView.Renderer</span> {
    
    <span class="hljs-meta">@Volatile</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterType: FilterType = FilterType.NONE
    
    <span class="hljs-meta">@Volatile</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterIntensity: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// ... 其他代码 ...</span>
        
        <span class="hljs-comment">// 传递滤镜参数</span>
        GLES20.glUniform1i(uFilterTypeLocation, filterType.ordinal)
        GLES20.glUniform1f(uIntensityLocation, filterIntensity)
        
        <span class="hljs-comment">// 绘制</span>
        drawQuad()
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setFilterType</span><span class="hljs-params">(type: <span class="hljs-type">FilterType</span>)</span></span> {
        filterType = type
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setFilterIntensity</span><span class="hljs-params">(intensity: <span class="hljs-type">Float</span>)</span></span> {
        filterIntensity = intensity.coerceIn(<span class="hljs-number">0f</span>, <span class="hljs-number">1f</span>)
    }
}
</code></pre>
<h3 data-id="heading-27">7. 性能优化</h3>
<h4 data-id="heading-28">7.1 避免复杂计算</h4>
<pre><code class="hljs language-glsl" lang="glsl">// ❌ 不好：每次都计算
vec4 color = texture2D(uTexture, vTexCoord);
float gray = color.r * 0.299 + color.g * 0.587 + color.b * 0.114;

// ✅ 好：使用内置函数
float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
</code></pre>
<h4 data-id="heading-29">7.2 减少分支</h4>
<pre><code class="hljs language-glsl" lang="glsl">// ❌ 不好：大量 if-else
if (type == 0) { ... }
else if (type == 1) { ... }
else if (type == 2) { ... }
// ... 很多分支

// ✅ 好：使用不同的着色器程序
// 每种滤镜使用独立的着色器，避免分支
</code></pre>
<h4 data-id="heading-30">7.3 降低采样次数</h4>
<pre><code class="hljs language-glsl" lang="glsl">// 对于模糊等需要多次采样的滤镜
// 可以先降低分辨率，再放大
</code></pre>
<h3 data-id="heading-31">8. 实用技巧</h3>
<h4 data-id="heading-32">8.1 滤镜预设</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterPreset</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> type: FilterType,
    <span class="hljs-keyword">val</span> intensity: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>,
    <span class="hljs-keyword">val</span> params: Map&lt;String, <span class="hljs-built_in">Float</span>&gt; = emptyMap()
)

<span class="hljs-keyword">val</span> presets = listOf(
    FilterPreset(<span class="hljs-string">"原图"</span>, FilterType.NONE),
    FilterPreset(<span class="hljs-string">"黑白"</span>, FilterType.GRAYSCALE, <span class="hljs-number">1.0f</span>),
    FilterPreset(<span class="hljs-string">"淡雅"</span>, FilterType.GRAYSCALE, <span class="hljs-number">0.5f</span>),
    FilterPreset(<span class="hljs-string">"复古"</span>, FilterType.SEPIA, <span class="hljs-number">0.8f</span>),
    FilterPreset(<span class="hljs-string">"暖阳"</span>, FilterType.WARM, <span class="hljs-number">1.0f</span>),
    FilterPreset(<span class="hljs-string">"冰雪"</span>, FilterType.COOL, <span class="hljs-number">1.0f</span>)
)
</code></pre>
<h4 data-id="heading-33">8.2 滤镜组合</h4>
<pre><code class="hljs language-glsl" lang="glsl">// 先应用灰度，再应用对比度
vec4 color = texture2D(uTexture, vTexCoord);
color = grayscale(color);
color = contrast(color, 1.5);
gl_FragColor = color;
</code></pre>
<h4 data-id="heading-34">8.3 实时预览优化</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用低分辨率预览</span>
<span class="hljs-keyword">val</span> preview = Preview.Builder()
    .setTargetResolution(Size(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>))  <span class="hljs-comment">// 降低分辨率</span>
    .build()
</code></pre>
<h2 data-id="heading-35">💻 代码实践</h2>
<h3 data-id="heading-36">今日任务</h3>
<p>实现实时滤镜相机应用：</p>
<ol>
<li><strong>集成 Day10 的相机预览功能</strong></li>
<li><strong>实现 7 种滤镜效果</strong>：
<ul>
<li>原图</li>
<li>灰度</li>
<li>复古</li>
<li>暖色调</li>
<li>冷色调</li>
<li>反色</li>
<li>黑白</li>
</ul>
</li>
<li><strong>添加滤镜强度调节</strong></li>
<li><strong>支持滤镜实时切换</strong></li>
</ol>
<h3 data-id="heading-37">实现效果</h3>
<ul>
<li>📹 实时相机预览</li>
<li>🎨 7 种滤镜效果</li>
<li>🎚️ 滤镜强度调节（SeekBar）</li>
<li>🔄 实时切换无卡顿</li>
<li>📸 支持拍照保存</li>
</ul>
<h3 data-id="heading-38">核心代码结构</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day11Renderer</span>(glSurfaceView: GLSurfaceView) : GLSurfaceView.Renderer {

    <span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterType</span> {
        NONE,       <span class="hljs-comment">// 原图</span>
        GRAYSCALE,  <span class="hljs-comment">// 灰度</span>
        SEPIA,      <span class="hljs-comment">// 复古</span>
        WARM,       <span class="hljs-comment">// 暖色调</span>
        COOL,       <span class="hljs-comment">// 冷色调</span>
        INVERT,     <span class="hljs-comment">// 反色</span>
        BLACK_WHITE <span class="hljs-comment">// 黑白</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterType: FilterType = FilterType.NONE
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> filterIntensity: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// 更新纹理</span>
        surfaceTexture.updateTexImage()
        
        <span class="hljs-comment">// 传递滤镜参数</span>
        GLES20.glUniform1i(uFilterTypeLocation, filterType.ordinal)
        GLES20.glUniform1f(uIntensityLocation, filterIntensity)
        
        <span class="hljs-comment">// 绘制</span>
        drawQuad()
    }
}
</code></pre>
<h2 data-id="heading-39">🧪 练习任务</h2>
<h3 data-id="heading-40">基础任务</h3>
<ol>
<li>✅ 实现至少 5 种滤镜效果</li>
<li>✅ 添加滤镜强度调节</li>
<li>✅ 支持实时切换</li>
</ol>
<h3 data-id="heading-41">进阶任务</h3>
<ol>
<li>🎨 实现自定义滤镜（调节色相、饱和度、亮度）</li>
<li>💾 保存当前滤镜效果的照片</li>
<li>🖼️ 添加滤镜预览缩略图</li>
<li>📊 显示当前滤镜名称和参数</li>
</ol>
<h3 data-id="heading-42">挑战任务</h3>
<ol>
<li>🎬 实现 LUT（Look-Up Table）滤镜</li>
<li>🌈 实现多重滤镜叠加</li>
<li>🎭 实现局部滤镜（只对部分区域应用）</li>
<li>📈 性能监控（FPS、帧耗时）</li>
</ol>
<h2 data-id="heading-43">📖 知识点总结</h2>
<h3 data-id="heading-44">滤镜分类</h3>



































<table><thead><tr><th>类型</th><th>原理</th><th>性能</th><th>示例</th></tr></thead><tbody><tr><td><strong>颜色调整</strong></td><td>修改像素 RGB 值</td><td>高</td><td>灰度、反色</td></tr><tr><td><strong>色调风格</strong></td><td>特定色彩变换</td><td>高</td><td>复古、暖色</td></tr><tr><td><strong>卷积滤镜</strong></td><td>使用周围像素</td><td>低</td><td>模糊、锐化</td></tr><tr><td><strong>空间变换</strong></td><td>改变像素位置</td><td>中</td><td>扭曲、旋转</td></tr></tbody></table>
<h3 data-id="heading-45">GLSL 常用函数</h3>



































<table><thead><tr><th>函数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>dot(v1, v2)</code></td><td>点积</td><td><code>dot(color.rgb, vec3(0.299, 0.587, 0.114))</code></td></tr><tr><td><code>mix(x, y, a)</code></td><td>线性插值</td><td><code>mix(original, filtered, intensity)</code></td></tr><tr><td><code>clamp(x, min, max)</code></td><td>限制范围</td><td><code>clamp(color, 0.0, 1.0)</code></td></tr><tr><td><code>step(edge, x)</code></td><td>阶跃函数</td><td><code>step(0.5, gray)</code></td></tr><tr><td><code>smoothstep(e0, e1, x)</code></td><td>平滑阶跃</td><td><code>smoothstep(0.4, 0.6, gray)</code></td></tr></tbody></table>
<h3 data-id="heading-46">最佳实践</h3>
<ol>
<li>✅ <strong>使用内置函数</strong>：性能更好</li>
<li>✅ <strong>避免过多分支</strong>：影响 GPU 性能</li>
<li>✅ <strong>参数可调节</strong>：提供更好的用户体验</li>
<li>✅ <strong>提供强度控制</strong>：允许部分应用滤镜</li>
<li>✅ <strong>预设滤镜</strong>：方便用户快速选择</li>
</ol>
<h2 data-id="heading-47">🔗 参考资料</h2>
<h3 data-id="heading-48">滤镜算法</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdanielamitay%2FInstagram-Filters" target="_blank" title="https://github.com/danielamitay/Instagram-Filters" ref="nofollow noopener noreferrer">Instagram Filters</a> - Instagram 滤镜算法</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcats-oss%2Fandroid-gpuimage" target="_blank" title="https://github.com/cats-oss/android-gpuimage" ref="nofollow noopener noreferrer">GPUImage</a> - 开源滤镜库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.colormatters.com%2Fcolor-and-design%2Fbasic-color-theory" target="_blank" title="https://www.colormatters.com/color-and-design/basic-color-theory" ref="nofollow noopener noreferrer">Color Theory</a> - 色彩理论</li>
</ul>
<h3 data-id="heading-49">GLSL 资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthebookofshaders.com%2F" target="_blank" title="https://thebookofshaders.com/" ref="nofollow noopener noreferrer">The Book of Shaders</a> - GLSL 教程</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.shadertoy.com%2F" target="_blank" title="https://www.shadertoy.com/" ref="nofollow noopener noreferrer">Shadertoy</a> - GLSL 示例库</li>
</ul>
<h2 data-id="heading-50">📝 今日总结</h2>
<p>今天我们学习了实时滤镜效果：</p>
<ol>
<li>✅ 理解了滤镜的基本原理：修改像素颜色值</li>
<li>✅ 掌握了 7 种常见滤镜的实现</li>
<li>✅ 学习了色彩空间转换（RGB ↔ HSV）</li>
<li>✅ 实现了滤镜强度调节机制</li>
<li>✅ 了解了性能优化技巧</li>
</ol>
<p><strong>关键要点</strong>：</p>
<ul>
<li>滤镜本质是片段着色器中的颜色变换</li>
<li>使用内置函数提高性能</li>
<li>滤镜强度通过 mix() 控制</li>
<li>卷积滤镜需要多次采样，性能较低</li>
</ul>
<p><a href="https://juejin.cn/spost/7591322050240331814" target="_blank" title="https://juejin.cn/spost/7591322050240331814">下一篇：# 『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[react fiber与事件循环]]></title>    <link>https://juejin.cn/post/7591104893392240694</link>    <guid>https://juejin.cn/post/7591104893392240694</guid>    <pubDate>2026-01-04T10:35:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591104893392240694" data-draft-id="7591129807756083263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="react fiber与事件循环"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-04T10:35:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="time_rg"/> <meta itemprop="url" content="https://juejin.cn/user/817692383646286"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            react fiber与事件循环
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692383646286/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    time_rg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:35:05.000Z" title="Sun Jan 04 2026 10:35:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">react fiber与事件循环</h2>
<blockquote>
<p>在学习react fiber与事件循环的过程中，我一直有这么一个困扰，那就是单独学习的时候，我好像都理解，但是我的脑袋里面没有一条清晰的时间线，到底react的任务从浏览器的视角来看到底是怎么执行，怎么渲染的，为此，我专门将react fiber与浏览器的事件循环放在一起进行学习，希望能够得到更清晰的学习结论。阅读本文，默认对事件循环和react fiber架构有一定了解。</p>
</blockquote>
<h3 data-id="heading-1">事件循环</h3>
<ul>
<li>什么是浏览器的事件循环机制？</li>
</ul>
<p>浏览器的事件循环是一套“协调机制”，用来在单线程的 JavaScript 环境中，合理安排同步代码、异步任务和页面渲染的执行顺序。</p>
<ul>
<li>为什么要有事件循环机制</li>
</ul>
<p>js是单线程的（根本原因），但是它需要处理很多事情。</p>
<ol>
<li>主线程的代码</li>
<li>处理dom</li>
<li>页面渲染</li>
<li>相应用户事件</li>
</ol>
<p>很显然这些事情是需要一个”排队“的机制。</p>
<p>还有一些异步操作的存在：</p>
<ol>
<li>setTimeout</li>
<li>网络请求</li>
<li>DOM 事件</li>
<li>Promise</li>
</ol>
<p>这些任务并不是js引擎去执行，而是web API,执行完后通知js的主线程，js再去处理这些回调。</p>
<p>结论：我们需要一套机制去处理上面所说的排队，去处理这些异步操作回调执行的时机。这就是事件循环。</p>
<p>那关于具体的事件循环的学习本文不涉及，这里只给出结论</p>
<blockquote>
<p>一次事件循环 = 执行一个宏任务 → 清空所有微任务 → 进行页面渲染（可能）</p>
<ol>
<li>先执行 <strong>一个宏任务</strong></li>
<li>然后 <strong>执行所有微任务</strong></li>
<li>然后浏览器 <strong>可能进行一次渲染</strong></li>
<li>再进入下一轮循环</li>
</ol>
</blockquote>
<h3 data-id="heading-2">React fiber策略</h3>
<ul>
<li>什么是react fiber</li>
</ul>
<p>简单来说，其实是 React 为了实现 <strong>可中断、可调度、可增量的渲染</strong> 所设计的内部机制。</p>
<p>我们来看一个简单的例子：</p>
<pre><code class="hljs language-css" lang="css">const elementTree = {
    type: <span class="hljs-string">"div"</span>,
    props:{
        children: [
            {
                type: <span class="hljs-string">"span"</span>,
                key: <span class="hljs-string">"span-a"</span>
                props: {
                    children: [
                        {
                            type: <span class="hljs-string">"TEXT_ELEMENT"</span>,
                            props: {
                              nodeValue: <span class="hljs-string">"aaaaa"</span>,
                              children: [],
                            },
                        }
                    ]
                }
            },
            {
                type: <span class="hljs-string">"span"</span>,
                key: <span class="hljs-string">"span-b"</span>
                props: {
                    children: [
                        {
                            type: <span class="hljs-string">"TEXT_ELEMENT"</span>,
                            props: {
                              nodeValue: <span class="hljs-string">"bbbbb"</span>,
                              children: [],
                            },
                        }
                    ]
                }
            }
        ]
    }
}
</code></pre>
<p>这是对应的fiber的链表图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc187e8b91fc44d7a257a8698daaf08d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGltZV9yZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768127705&amp;x-signature=vCzYorivTHgaf9yztBTvzFOC69I%3D" alt="image.png" loading="lazy"/>
fiber采用深度优先遍历，对每一个fiber节点都采用浏览器空闲时间进行计算，直到整棵树都计算完成，最后才提交渲染。</p>
<h3 data-id="heading-3">问题？</h3>
<ol>
<li>所谓的可中断，空闲时间，到底是指的浏览器事件循环的什么阶段</li>
<li>fiber的计算，是在什么时候</li>
</ol>
<h3 data-id="heading-4">一条完整时间线：React Fiber × 浏览器</h3>
<h4 data-id="heading-5">场景：用户点击按钮 → React 更新 UI</h4>
<hr/>
<h4 data-id="heading-6">🟦 阶段 1：浏览器的事</h4>
<p><code> 点击事件发生  `` ↓  `` 事件系统  `` ↓  ``宏任务（onClick）</code></p>
<hr/>
<h4 data-id="heading-7">🟩 阶段 2：React 开始工作（JS 阶段）</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onClick</span>() {
  <span class="hljs-built_in">setState</span>(...)
}
</code></pre>
<p>React 做了什么：</p>
<ol>
<li><strong>不改</strong> <strong>DOM</strong></li>
<li>创建 Update</li>
<li>把 Update 挂到 Fiber</li>
<li>标记优先级（Lane）</li>
<li>请求调度（scheduleUpdateOnFiber）</li>
</ol>
<p>👉 <strong>React</strong> <strong>此时仍然完全在</strong> <strong>JS</strong> <strong>世界</strong></p>
<hr/>
<h4 data-id="heading-8">🟨 阶段 3：Fiber Render 阶段（可中断）</h4>
<p>React 在做：</p>
<ul>
<li>构建新的 Fiber Tree</li>
<li>Diff（Reconciliation）</li>
<li>计算 effect list</li>
</ul>
<p>⚠️ 这个阶段：</p>
<ul>
<li><strong>不触碰</strong> <strong>DOM</strong></li>
<li><strong>可以被中断</strong></li>
<li><strong>可能跨多帧</strong></li>
</ul>
<hr/>
<h4 data-id="heading-9">🟥 阶段 4：Commit 阶段（不可中断）</h4>
<p>React 选择一个安全时机（通常靠近帧边界）：</p>
<ol>
<li>执行 DOM 操作</li>
<li>执行 layout effects</li>
<li>更新 refs</li>
</ol>
<p>👉 <strong>这一刻，</strong> <strong>React</strong> <strong>才真正影响浏览器渲染</strong></p>
<hr/>
<h4 data-id="heading-10">🟪 阶段 5：浏览器渲染</h4>
<p><code> rAF（浏览器）  ``↓</code> <code>Style</code> <code>↓</code> <code>Layout</code> <code>↓</code> <code>Paint</code> <code>↓</code> <code>Composite</code></p>
<hr/>
<h3 data-id="heading-11">React 和浏览器的分工一句话总结</h3>
<blockquote>
<p><strong>React</strong> <strong>决定“改什么”和“什么时候可以改”，</strong> <strong>浏览器决定“什么时候画”和“怎么画”。</strong></p>
</blockquote>
<h3 data-id="heading-12">React fiber实现的核心api</h3>
<ol>
<li><strong>MessageChannel</strong>：推进计算，立即排队下一个宏任务</li>
<li><strong>requestAnimationFrame</strong>：Commit 阶段对齐浏览器帧</li>
</ol>
<h3 data-id="heading-13">Fiber 调度的最后一部分</h3>
<h4 data-id="heading-14">MessageChannel 如何推进各个工作单元</h4>
<p>在 React Fiber 中，整个组件树的更新被拆分成<strong>一个个 Fiber 单元</strong>（unit of work）。每个单元负责：</p>
<ul>
<li>构建 Fiber 节点</li>
<li>进行 Diff 对比</li>
<li>计算 effect list</li>
</ul>
<p><strong>为什么 MessageChannel 被使用？</strong></p>
<ul>
<li>Fiber 的 Render 阶段是可中断的，需要<strong>在主线程空闲时继续推进任务</strong>。</li>
<li>MessageChannel 可以<strong>立即排队一个宏任务</strong>，在当前宏任务执行完成后尽快执行下一轮 Fiber 计算。</li>
<li>这意味着，React 不会一次性阻塞主线程去渲染整个组件树，而是<strong>切片执行，每次执行一小部分 Fiber 单元</strong>。</li>
</ul>
<p><strong>MessageChannel 任务所在队列：</strong></p>
<ul>
<li>MessageChannel 的 <code>onmessage</code> 回调属于<strong>宏任务队列</strong>。</li>
<li>宏任务执行完成后，微任务队列会被清空，然后浏览器判断是否渲染。</li>
<li>因此 Fiber 的 Render 阶段是<strong>宏任务中逐片推进的</strong>。</li>
</ul>
<hr/>
<h4 data-id="heading-15">requestAnimationFrame 的使用时机</h4>
<ul>
<li>
<p><strong>作用</strong>：与浏览器渲染帧同步，保证 Commit 阶段操作 DOM 时不掉帧。</p>
</li>
<li>
<p><strong>使用时机</strong>：</p>
<ul>
<li>当 Fiber Render 阶段完成或达到时间片限制时，Scheduler 会判断是否需要提交 DOM。</li>
<li>Commit 阶段执行前，如果希望<strong>和浏览器下一帧对齐</strong>，就会通过 <code>requestAnimationFrame</code> 调用 Commit 阶段回调。</li>
</ul>
</li>
<li>
<p><strong>为什么要使用 rAF</strong>：</p>
<ul>
<li>避免直接提交 DOM 时阻塞渲染</li>
<li>保证渲染和浏览器帧同步，提高 UI 流畅度</li>
<li>避免计算阶段占用过长时间造成掉帧</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-16">结合事件循环的完整执行流程</h4>
<p>以一次用户点击触发更新为例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd110e8b7e8e473fa53f3ae01cba73e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGltZV9yZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768127705&amp;x-signature=czDU2w1l%2Bi76hOMqUOaGltBeoHg%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>从上图我们可以简单的看出，react fiber的计算过程跨越了多次的事件循环，是否可中断的判断放在每一次的工作单元进行判断。且工作单元（nextUnitOfWork）的计算是放在宏任务中</p>
</blockquote>
<p><strong>总结：</strong></p>
<ol>
<li>
<p><strong>MessageChannel 推进 Fiber 工作单元</strong>：</p>
<ol>
<li>在宏任务队列中运行</li>
<li>逐片执行 Render 阶段</li>
<li>可以中断，分片执行以保证主线程空闲</li>
</ol>
</li>
<li>
<p><strong>requestAnimationFrame 使用</strong>：</p>
<ol>
<li>对齐 Commit 阶段和浏览器渲染帧</li>
<li>避免掉帧，提高 UI 流畅度</li>
</ol>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）]]></title>    <link>https://juejin.cn/post/7591322050240331814</link>    <guid>https://juejin.cn/post/7591322050240331814</guid>    <pubDate>2026-01-04T10:46:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050240331814" data-draft-id="7591338980693196846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2026-01-04T10:46:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="下位子"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            『OpenGL学习滤镜相机』- Day 12: LUT 滤镜（Look-Up Table）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    下位子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T10:46:24.000Z" title="Sun Jan 04 2026 10:46:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">前言: 『OpenGL学习』 从零打造 Android 滤镜相机</a></p>
<p><a href="https://juejin.cn/post/7591338980693393454" target="_blank" title="https://juejin.cn/post/7591338980693393454">上一篇:『OpenGL学习滤镜相机』- Day 11: 实时滤镜效果</a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://github.com/xiaweizi/OpenGLTest" ref="nofollow noopener noreferrer">OpenGLTest</a></p>
</blockquote>
<h2 data-id="heading-0">📚 今日目标</h2>
<ul>
<li>理解 LUT（查找表）的工作原理</li>
<li>掌握 3D LUT 的使用方法</li>
<li>实现专业级调色滤镜</li>
<li>学习 LUT 资源加载和管理</li>
<li>支持多种 LUT 滤镜快速切换</li>
</ul>
<h2 data-id="heading-1">运行效果</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/358554c68bd8432398897f6931ad2c46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128384&amp;x-signature=UQuQP4iYbQdl5ogtzQFiAUhUsc8%3D" alt="Day12.gif" loading="lazy"/></p>
<h2 data-id="heading-2">🎯 学习内容</h2>
<h3 data-id="heading-3">1. LUT 简介</h3>
<p><strong>LUT（Look-Up Table，查找表）</strong> 是一种高效的颜色映射技术，广泛应用于专业调色和滤镜效果。</p>
<h4 data-id="heading-4">什么是 LUT？</h4>
<p>LUT 本质是一个<strong>颜色映射表</strong>：</p>
<pre><code class="hljs language-python" lang="python">输入颜色 (R, G, B) → LUT 查找 → 输出颜色 (<span class="hljs-string">R', G'</span>, <span class="hljs-string">B')
</span></code></pre>
<p>如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/956873e1e4244cae9c37337c835eee62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128384&amp;x-signature=%2FdpOqs9LYH41Y1oRXW9Gc8%2Fo3p4%3D" alt="res_baby_2.png" loading="lazy"/></p>
<p><strong>类比</strong>：</p>
<ul>
<li>字典：输入单词 → 查找 → 输出释义</li>
<li>LUT：输入颜色 → 查找 → 输出新颜色</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fe329929fec4922bd4eaa6591148f56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768128384&amp;x-signature=HcVBrnyHbWR8W7b2xty1%2Bnxiogw%3D" alt="Day12.gif" loading="lazy"/></p>
<h4 data-id="heading-5">LUT 的优势</h4>



































<table><thead><tr><th>特性</th><th>LUT 滤镜</th><th>传统滤镜</th></tr></thead><tbody><tr><td><strong>复杂度</strong></td><td>任意复杂</td><td>受算法限制</td></tr><tr><td><strong>性能</strong></td><td>极快（一次采样）</td><td>可能很慢</td></tr><tr><td><strong>调色精度</strong></td><td>专业级</td><td>有限</td></tr><tr><td><strong>制作方式</strong></td><td>Photoshop/Lightroom</td><td>手写代码</td></tr><tr><td><strong>灵活性</strong></td><td>可随意替换</td><td>需修改代码</td></tr></tbody></table>
<h3 data-id="heading-6">2. 3D LUT 原理</h3>
<h4 data-id="heading-7">2.1 颜色立方体</h4>
<p>RGB 颜色空间是一个<strong>立方体</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">        <span class="hljs-selector-tag">B</span> (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)
       /|
      / |
     /  |
(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)─────&gt; R (<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)
    |  /
    | /
    |/
    G (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)
</code></pre>
<p><strong>3D LUT</strong> 是这个颜色立方体的<strong>离散化采样</strong>：</p>
<ul>
<li>8×8×8 = 512 种颜色</li>
<li>16×16×16 = 4,096 种颜色</li>
<li><strong>64×64×64 = 262,144 种颜色</strong> ← 常用</li>
</ul>
<h4 data-id="heading-8">2.2 LUT 图片格式</h4>
<p>标准的 64×64×64 LUT 存储为 <strong>512×512</strong> 的 2D 图片：</p>
<pre><code class="hljs">┌────────────────────────────────┐
│ 64x64 │ 64x64 │ 64x64 │ ... x8 │  ← 蓝色 = 0
├────────────────────────────────┤
│ 64x64 │ 64x64 │ 64x64 │ ... x8 │  ← 蓝色 = 1
├────────────────────────────────┤
│  ...  │  ...  │  ...  │  ...   │
├────────────────────────────────┤
│ 64x64 │ 64x64 │ 64x64 │ ... x8 │  ← 蓝色 = 7
└────────────────────────────────┘
  ↑ 红色和绿色从 0-63 变化
</code></pre>
<p><strong>布局规则</strong>：</p>
<ul>
<li>横向 8 块（蓝色通道：0-7）</li>
<li>纵向 8 块（蓝色通道：0-7）</li>
<li>每块内部：红色（X轴），绿色（Y轴）</li>
</ul>
<h4 data-id="heading-9">2.3 查找算法</h4>
<pre><code class="hljs language-ini" lang="ini">输入：<span class="hljs-attr">RGB</span> = (<span class="hljs-number">0.75</span>, <span class="hljs-number">0.50</span>, <span class="hljs-number">0.25</span>)

步骤 1：计算 3D 索引
  <span class="hljs-attr">r_index</span> = <span class="hljs-number">0.75</span> × <span class="hljs-number">63</span> = <span class="hljs-number">47.25</span>
  <span class="hljs-attr">g_index</span> = <span class="hljs-number">0.50</span> × <span class="hljs-number">63</span> = <span class="hljs-number">31.5</span>
  <span class="hljs-attr">b_index</span> = <span class="hljs-number">0.25</span> × <span class="hljs-number">63</span> = <span class="hljs-number">15.75</span>

步骤 2：映射到 2D 纹理坐标
  <span class="hljs-attr">blue_x</span> = floor(b_index) % <span class="hljs-number">8</span> = <span class="hljs-number">7</span>
  <span class="hljs-attr">blue_y</span> = floor(b_index) / <span class="hljs-number">8</span> = <span class="hljs-number">1</span>
  
  <span class="hljs-attr">offset_x</span> = blue_x * <span class="hljs-number">64</span> + r_index = <span class="hljs-number">7</span>*<span class="hljs-number">64</span> + <span class="hljs-number">47.25</span> = <span class="hljs-number">495.25</span>
  <span class="hljs-attr">offset_y</span> = blue_y * <span class="hljs-number">64</span> + g_index = <span class="hljs-number">1</span>*<span class="hljs-number">64</span> + <span class="hljs-number">31.5</span> = <span class="hljs-number">95.5</span>
  
  <span class="hljs-attr">uv</span> = (<span class="hljs-literal">off</span>set_x / <span class="hljs-number">512</span>, <span class="hljs-literal">off</span>set_y / <span class="hljs-number">512</span>)

步骤 3：采样 LUT 纹理
  <span class="hljs-attr">new_color</span> = texture2D(uLUT, uv)
</code></pre>
<h3 data-id="heading-10">3. GLSL 实现</h3>
<h4 data-id="heading-11">3.1 基础 LUT 着色器</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture;    // 相机纹理
uniform sampler2D uLUTTexture; // LUT 纹理
uniform float uIntensity;      // LUT 强度

varying vec2 vTexCoord;

vec4 applyLUT(vec4 color, sampler2D lut) {
    // 1. 获取 RGB 值（0.0 - 1.0）
    float r = color.r;
    float g = color.g;
    float b = color.b;
    
    // 2. 计算蓝色索引
    float blueIndex = b * 63.0;
    
    // 3. 计算 LUT 坐标
    float quad = floor(floor(blueIndex) / 8.0);
    float xOffset = (floor(blueIndex) - quad * 8.0) / 8.0;
    float yOffset = quad / 8.0;
    
    // 4. 在 64x64 小格子内的位置
    float lutX = xOffset + (r / 8.0);
    float lutY = yOffset + (g / 8.0);
    
    // 5. 采样 LUT
    vec4 newColor = texture2D(lut, vec2(lutX, lutY));
    
    return newColor;
}

void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec4 lutColor = applyLUT(color, uLUTTexture);
    
    // 使用强度混合原色和 LUT 颜色
    gl_FragColor = mix(color, lutColor, uIntensity);
}
</code></pre>
<h4 data-id="heading-12">3.2 优化版 LUT 着色器（线性插值）</h4>
<p>为了更平滑的过渡，可以在相邻蓝色层之间插值：</p>
<pre><code class="hljs language-glsl" lang="glsl">vec4 applyLUTWithInterpolation(vec4 color, sampler2D lut) {
    float r = color.r * 63.0;
    float g = color.g * 63.0;
    float b = color.b * 63.0;
    
    // 蓝色索引的整数和小数部分
    float b_floor = floor(b);
    float b_fract = fract(b);
    
    // 计算两个相邻蓝色层的坐标
    vec2 uv1 = getLUTCoord(r, g, b_floor);
    vec2 uv2 = getLUTCoord(r, g, b_floor + 1.0);
    
    // 采样两个层
    vec4 color1 = texture2D(lut, uv1);
    vec4 color2 = texture2D(lut, uv2);
    
    // 在两层之间插值
    return mix(color1, color2, b_fract);
}

vec2 getLUTCoord(float r, float g, float b) {
    float quad = floor(b / 8.0);
    float xOffset = (b - quad * 8.0) / 8.0;
    float yOffset = quad / 8.0;
    
    float lutX = xOffset + (r / 512.0) + 0.5 / 512.0;
    float lutY = yOffset + (g / 512.0) + 0.5 / 512.0;
    
    return vec2(lutX, lutY);
}
</code></pre>
<h3 data-id="heading-13">4. LUT 资源加载</h3>
<h4 data-id="heading-14">4.1 从 Assets 加载</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadLUTFromAssets</span><span class="hljs-params">(assetManager: <span class="hljs-type">AssetManager</span>, fileName: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">val</span> bitmap = assetManager.<span class="hljs-keyword">open</span>(fileName).use { inputStream -&gt;
        BitmapFactory.decodeStream(inputStream)
    }
    
    <span class="hljs-keyword">return</span> loadLUTTexture(bitmap)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadLUTTexture</span><span class="hljs-params">(bitmap: <span class="hljs-type">Bitmap</span>?)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">if</span> (bitmap == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">val</span> textures = IntArray(<span class="hljs-number">1</span>)
    GLES20.glGenTextures(<span class="hljs-number">1</span>, textures, <span class="hljs-number">0</span>)
    
    <span class="hljs-keyword">val</span> textureId = textures[<span class="hljs-number">0</span>]
    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureId)
    
    <span class="hljs-comment">// 重要：LUT 纹理必须使用线性过滤</span>
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE)
    GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE)
    
    GLUtils.texImage2D(GLES20.GL_TEXTURE_2D, <span class="hljs-number">0</span>, bitmap, <span class="hljs-number">0</span>)
    
    bitmap.recycle()
    
    <span class="hljs-keyword">return</span> textureId
}
</code></pre>
<h4 data-id="heading-15">4.2 LUT 管理器</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LUTManager</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> assetManager: AssetManager) {
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LUTFilter</span>(
        <span class="hljs-keyword">val</span> name: String,
        <span class="hljs-keyword">val</span> fileName: String,
        <span class="hljs-keyword">var</span> textureId: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    )
    
    <span class="hljs-keyword">val</span> filters = listOf(
        LUTFilter(<span class="hljs-string">"原图"</span>, <span class="hljs-string">"filters/res_original.png"</span>),
        LUTFilter(<span class="hljs-string">"宝宝1"</span>, <span class="hljs-string">"filters/res_baby_1.png"</span>),
        LUTFilter(<span class="hljs-string">"宝宝2"</span>, <span class="hljs-string">"filters/res_baby_2.png"</span>),
        LUTFilter(<span class="hljs-string">"美食1"</span>, <span class="hljs-string">"filters/res_food_1.png"</span>),
        LUTFilter(<span class="hljs-string">"风景1"</span>, <span class="hljs-string">"filters/res_landscape_1.png"</span>),
        <span class="hljs-comment">// ... 更多</span>
    )
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllLUTs</span><span class="hljs-params">()</span></span> {
        filters.forEach { filter -&gt;
            filter.textureId = loadLUTFromAssets(assetManager, filter.fileName)
            Log.d(TAG, <span class="hljs-string">"加载 LUT: <span class="hljs-subst">${filter.name}</span>, textureId=<span class="hljs-subst">${filter.textureId}</span>"</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFilterByName</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span>: LUTFilter? {
        <span class="hljs-keyword">return</span> filters.find { it.name == name }
    }
}
</code></pre>
<h3 data-id="heading-16">5. LUT 的优势</h3>
<h4 data-id="heading-17">5.1 与传统滤镜对比</h4>



































<table><thead><tr><th>特性</th><th>传统滤镜（着色器算法）</th><th>LUT 滤镜</th></tr></thead><tbody><tr><td><strong>复杂度</strong></td><td>简单（灰度、复古）</td><td>任意复杂（专业调色）</td></tr><tr><td><strong>性能</strong></td><td>中等</td><td>极快（一次采样）</td></tr><tr><td><strong>调色精度</strong></td><td>有限</td><td>专业级</td></tr><tr><td><strong>制作方式</strong></td><td>写代码</td><td>Photoshop/Lightroom</td></tr><tr><td><strong>灵活性</strong></td><td>需修改代码</td><td>直接替换图片</td></tr></tbody></table>
<h4 data-id="heading-18">5.2 应用场景</h4>
<ul>
<li>📸 <strong>Instagram 风格</strong>：复刻各种 Instagram 滤镜</li>
<li>🎬 <strong>电影调色</strong>：模拟电影色调</li>
<li>🎨 <strong>专业调色</strong>：设计师定制的色彩方案</li>
<li>🌈 <strong>品牌风格</strong>：统一的品牌视觉风格</li>
</ul>
<h3 data-id="heading-19">6. LUT 制作方法</h3>
<h4 data-id="heading-20">方法 1：Adobe Photoshop</h4>
<ol>
<li>打开图片，调整色彩（曲线、色阶、色相/饱和度）</li>
<li>应用调整图层到标准 LUT 模板</li>
<li>导出为 512×512 PNG 图片</li>
</ol>
<h4 data-id="heading-21">方法 2：Adobe Lightroom</h4>
<ol>
<li>调整照片到满意的效果</li>
<li>导出为 LUT 文件（.cube 格式）</li>
<li>转换为 PNG 图片（使用工具）</li>
</ol>
<h4 data-id="heading-22">方法 3：在线工具</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lutify.me%2F" target="_blank" title="https://www.lutify.me/" ref="nofollow noopener noreferrer">LUT Generator</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F3dlutcreator.com%2F" target="_blank" title="https://3dlutcreator.com/" ref="nofollow noopener noreferrer">3D LUT Creator</a></li>
</ul>
<h3 data-id="heading-23">7. 性能优化</h3>
<h4 data-id="heading-24">7.1 LUT 纹理缓存</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 好的做法：预加载所有 LUT</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSurfaceCreated</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?, config: <span class="hljs-type">EGLConfig</span>?)</span></span> {
    lutManager.loadAllLUTs()  <span class="hljs-comment">// 只加载一次</span>
}

<span class="hljs-comment">// ❌ 不好的做法：切换时加载</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">switchLUT</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> texture = loadLUTFromAssets(name)  <span class="hljs-comment">// 每次都加载，慢！</span>
}
</code></pre>
<h4 data-id="heading-25">7.2 纹理压缩</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// LUT 纹理通常较小（512×512），不需要压缩</span>
<span class="hljs-comment">// 但可以考虑使用 RGB565（如果不需要 Alpha）</span>
</code></pre>
<h4 data-id="heading-26">7.3 异步加载</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在后台线程加载 LUT</span>
GlobalScope.launch(Dispatchers.IO) {
    <span class="hljs-keyword">val</span> textures = lutManager.loadAllLUTs()
    
    withContext(Dispatchers.Main) {
        glSurfaceView.queueEvent {
            lutManager.updateTextures(textures)
        }
    }
}
</code></pre>
<h2 data-id="heading-27">💻 代码实践</h2>
<h3 data-id="heading-28">今日任务</h3>
<p>实现 LUT 滤镜相机：</p>
<ol>
<li><strong>加载 19 个 LUT 滤镜</strong></li>
<li><strong>实现 LUT 查找算法</strong>（GLSL）</li>
<li><strong>支持滤镜快速切换</strong></li>
<li><strong>添加滤镜强度调节</strong></li>
<li><strong>提供滤镜分类（宝宝、美食、风景等）</strong></li>
</ol>
<h3 data-id="heading-29">核心功能</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day12Renderer</span>(glSurfaceView: GLSurfaceView) : GLSurfaceView.Renderer {
    
    <span class="hljs-comment">// LUT 滤镜列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lutFilters = mutableListOf&lt;LUTFilter&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentLUTTextureId = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lutIntensity = <span class="hljs-number">1.0f</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSurfaceCreated</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?, config: <span class="hljs-type">EGLConfig</span>?)</span></span> {
        <span class="hljs-comment">// 加载所有 LUT</span>
        loadAllLUTs()
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// 应用当前 LUT</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, currentLUTTextureId)
        GLES20.glUniform1i(uLUTTextureLocation, <span class="hljs-number">1</span>)
        GLES20.glUniform1f(uIntensityLocation, lutIntensity)
        
        <span class="hljs-comment">// 渲染</span>
        drawQuad()
    }
}
</code></pre>
<h2 data-id="heading-30">🎨 滤镜分类</h2>
<p>根据您的 LUT 资源，我们有以下分类：</p>
<h3 data-id="heading-31">🍼 宝宝系列（5个）</h3>
<ul>
<li>baby_1, baby_2, baby_3, baby_4, baby_5</li>
<li>适合：儿童摄影、可爱风格</li>
</ul>
<h3 data-id="heading-32">🍔 美食系列（3个）</h3>
<ul>
<li>food_1, food_2, food_3</li>
<li>适合：美食拍摄、暖色调</li>
</ul>
<h3 data-id="heading-33">🏞️ 风景系列（3个）</h3>
<ul>
<li>landscape_1, landscape_2, landscape_3</li>
<li>适合：风景摄影、自然风光</li>
</ul>
<h3 data-id="heading-34">🌿 植物系列（2个）</h3>
<ul>
<li>plant_1, plant_2</li>
<li>适合：绿植、清新风格</li>
</ul>
<h3 data-id="heading-35">⭐ 推荐系列（2个）</h3>
<ul>
<li>recomend_1, recomend_2</li>
<li>适合：日常自拍</li>
</ul>
<h3 data-id="heading-36">🏙️ 街景系列（3个）</h3>
<ul>
<li>street_1, street_2, street_3</li>
<li>适合：城市摄影、街拍</li>
</ul>
<h2 data-id="heading-37">🧪 练习任务</h2>
<h3 data-id="heading-38">基础任务</h3>
<ol>
<li>✅ 实现 LUT 查找算法</li>
<li>✅ 加载所有 LUT 纹理</li>
<li>✅ 支持滤镜切换</li>
</ol>
<h3 data-id="heading-39">进阶任务</h3>
<ol>
<li>🎨 实现滤镜分类浏览</li>
<li>🎚️ 添加滤镜强度调节（0-100%）</li>
<li>🖼️ 显示滤镜缩略图预览</li>
<li>⭐ 收藏喜爱的滤镜</li>
</ol>
<h3 data-id="heading-40">挑战任务</h3>
<ol>
<li>🎬 实现滤镜过渡动画（从一个 LUT 平滑过渡到另一个）</li>
<li>🎭 实现双 LUT 混合</li>
<li>📊 分析 LUT 色彩特征</li>
<li>🔧 自定义 LUT 生成工具</li>
</ol>
<h2 data-id="heading-41">📖 知识点总结</h2>
<h3 data-id="heading-42">LUT 的本质</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">LUT</span> = 预计算的颜色映射表
    = 将复杂的调色算法"烘焙"到一张图片中
    = 查表比计算快得多
</code></pre>
<h3 data-id="heading-43">关键概念</h3>

























<table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td><strong>3D LUT</strong></td><td>三维颜色查找表（R、G、B 三个维度）</td></tr><tr><td><strong>512×512</strong></td><td>标准 LUT 图片大小</td></tr><tr><td><strong>64×64×64</strong></td><td>颜色精度（262,144 种颜色）</td></tr><tr><td><strong>线性插值</strong></td><td>在相邻颜色间平滑过渡</td></tr></tbody></table>
<h3 data-id="heading-44">最佳实践</h3>
<ol>
<li>✅ <strong>预加载所有 LUT</strong>：启动时一次性加载</li>
<li>✅ <strong>使用线性过滤</strong>：<code>GL_LINEAR</code> 而非 <code>GL_NEAREST</code></li>
<li>✅ <strong>添加强度控制</strong>：mix(original, lut, intensity)</li>
<li>✅ <strong>纹理缓存</strong>：避免重复加载</li>
<li>✅ <strong>异步加载</strong>：不阻塞 UI 线程</li>
</ol>
<h2 data-id="heading-45">🔗 参考资料</h2>
<h3 data-id="heading-46">LUT 技术</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2F3D_lookup_table" target="_blank" title="https://en.wikipedia.org/wiki/3D_lookup_table" ref="nofollow noopener noreferrer">3D LUT 原理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.frame.io%2F2017%2F03%2F06%2Fluts-grutas%2F" target="_blank" title="https://blog.frame.io/2017/03/06/luts-grutas/" ref="nofollow noopener noreferrer">Color Grading with LUTs</a></li>
</ul>
<h3 data-id="heading-47">LUT 资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.freepresets.com%2Fproduct%2Ffree-luts%2F" target="_blank" title="https://www.freepresets.com/product/free-luts/" ref="nofollow noopener noreferrer">Free LUTs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rocketstock.com%2Ffree-after-effects-templates%2F35-free-luts-for-color-grading-videos%2F" target="_blank" title="https://www.rocketstock.com/free-after-effects-templates/35-free-luts-for-color-grading-videos/" ref="nofollow noopener noreferrer">RocketStock LUTs</a></li>
</ul>
<h2 data-id="heading-48">📝 今日总结</h2>
<p>今天我们学习了 LUT 滤镜技术：</p>
<ol>
<li>✅ 理解了 LUT 的工作原理：颜色查找表</li>
<li>✅ 掌握了 3D LUT 的存储格式：512×512 图片</li>
<li>✅ 实现了 LUT 查找算法：RGB → 2D 纹理坐标</li>
<li>✅ 支持 19 种专业滤镜</li>
<li>✅ 理解了 LUT 的性能优势</li>
</ol>
<p><strong>关键要点</strong>：</p>
<ul>
<li>LUT 将复杂调色"烘焙"成查找表</li>
<li>一次纹理采样即可实现专业级调色</li>
<li>性能极高，适合实时应用</li>
<li>可以直接使用 Photoshop/Lightroom 制作</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谈谈 `AI Agent`（智能体）]]></title>    <link>https://juejin.cn/post/7591322050240364582</link>    <guid>https://juejin.cn/post/7591322050240364582</guid>    <pubDate>2026-01-04T11:00:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050240364582" data-draft-id="7591346773827207194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谈谈 `AI Agent`（智能体）"/> <meta itemprop="keywords" content="Agent,AI编程"/> <meta itemprop="datePublished" content="2026-01-04T11:00:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="周末程序猿"/> <meta itemprop="url" content="https://juejin.cn/user/3245414056989757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谈谈 `AI Agent`（智能体）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3245414056989757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    周末程序猿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:00:17.000Z" title="Sun Jan 04 2026 11:00:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年以来，我们正站在人工智能应用演进的一个关键节点上，从预测式AI（分析模式、进行分类）到生成式AI（创造文本、代码、图像），我们如今正迈向第三个阶段：AI Agent。<br/>
这并非简单的技术迭代，而是一次根本性的范式转变，第三个阶段 <code>AI Agent</code> 随着模型的不断进化，能自主可控长时间运行，可能2026才是AI普及的开始。</p>
<h2 data-id="heading-0">什么是 <code>AI Agent</code></h2>
<p>传统软件或者工作流的目的是为了用户能够简化和自动化工作流，而 <code>AI Agent</code> 则能够以高度的独立性代表用户执行为实现用户目标的一系列步骤。<br/>
首先集成了 <code>LLM</code> 但不用它们来控制工作流执行的应用程序（例如简单的聊天机器人、单轮对话LLM或情感分类器）不是称为智能体。<br/>
更具体地说，一个智能体拥有使其能够可靠、一致地代表用户行动的核心特征：</p>
<ul>
<li>能利用LLM来管理工作流执行并做出决策，它能识别工作流何时完成，并能在需要时主动纠正其行为，如果失败，它可以停止执行并将控制权交还给用户。</li>
<li>能够访问各种工具以与外部系统交互（既能获取上下文，也能采取行动），并根据工作流的当前状态动态选择适当的工具，始终在明确定义的安全内运行。</li>
</ul>
<p><strong>是不是现在智能体很多，所有的工作都用智能体来解决？</strong><br/>
智能体适合那些传统的、确定性的、基于规则的方法难以处理的工作流，所以对于能通过一些确定性编程或者流程就能解决的，其实不太需要智能体。<br/>
以支付欺诈分析为例，传统的规则引擎就像一个检查清单，根据预设标准标记交易，相比之下，LLM智能体更像一位经验丰富的调查员，评估上下文，考虑细微模式，即使在没有明确违反规则的情况下也能识别可疑活动，这种细致的推理能力正是智能体能够有效管理复杂、模糊情况的关键。<br/>
所以在评估智能体可以在哪些地方的确有价值，请优先考虑那些以前难以自动化、尤其是传统方法遇到阻力的工作流：</p>
<ul>
<li>复杂决策：涉及细微判断、例外情况或上下文敏感决策的工作流。</li>
<li>难以维护的规则：由于规则集庞大且复杂而变得笨重、更新成本高昂或容易出错的系统。</li>
<li>重度依赖非结构化数据：涉及解读自然语言、从文档中提取含义或与用户进行对话式交互的场景。</li>
</ul>
<h2 data-id="heading-1"><code>AI Agent</code>的构成</h2>
<ul>
<li>模型：为智能体的推理和决策提供动力的LLM，决定了智能体的下限。</li>
<li>工具：智能体可用于采取行动的外部函数或API。</li>
<li>指令：定义智能体行为的明确指导方针和安全策略。</li>
</ul>
<p><strong>样例代码：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentExecutor, create_react_agent
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第一部分：定义工具（Tools）</span>
<span class="hljs-comment"># 工具是Agent可以调用的外部函数，扩展了LLM的能力</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculator</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    计算数学表达式。
    输入应该是一个有效的数学表达式，如 '2 + 2' 或 '3 * 4 + 5'。
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 安全地计算数学表达式</span>
        result = <span class="hljs-built_in">eval</span>(expression, {<span class="hljs-string">"__builtins__"</span>: {}}, {})
        <span class="hljs-keyword">return</span><span class="hljs-string">f"计算结果: <span class="hljs-subst">{expression}</span> = <span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span><span class="hljs-string">f"计算错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    获取指定城市的当前天气信息。
    输入应该是城市名称，如 '北京' 或 '上海'。
    """</span>
    <span class="hljs-comment"># 模拟天气数据（实际应用中应调用真实的天气API）</span>
    weather_data = {
        <span class="hljs-string">"北京"</span>: <span class="hljs-string">"晴天，温度 5°C，湿度 30%"</span>,
        <span class="hljs-string">"上海"</span>: <span class="hljs-string">"多云，温度 12°C，湿度 65%"</span>,
        <span class="hljs-string">"广州"</span>: <span class="hljs-string">"小雨，温度 18°C，湿度 80%"</span>,
        <span class="hljs-string">"深圳"</span>: <span class="hljs-string">"晴天，温度 20°C，湿度 70%"</span>,
    }
    <span class="hljs-keyword">return</span> weather_data.get(city, <span class="hljs-string">f"抱歉，暂无<span class="hljs-subst">{city}</span>的天气信息"</span>)

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_knowledge</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    搜索知识库获取相关信息。
    输入应该是要搜索的问题或关键词。
    """</span>
    <span class="hljs-comment"># 模拟知识库搜索（实际应用中可接入向量数据库或搜索引擎）</span>
    knowledge_base = {
        <span class="hljs-string">"python"</span>: <span class="hljs-string">"Python是一种高级编程语言，以简洁易读著称，广泛应用于数据科学、Web开发和人工智能领域。"</span>,
        <span class="hljs-string">"agent"</span>: <span class="hljs-string">"AI Agent（智能体）是能够感知环境、做出决策并采取行动的自主系统。它由模型、工具和指令三部分组成。"</span>,
        <span class="hljs-string">"langchain"</span>: <span class="hljs-string">"LangChain是一个用于开发LLM应用的框架，提供了构建Agent、链式调用、记忆管理等功能。"</span>,
    }
    
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> knowledge_base.items():
        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">in</span> query.lower():
            <span class="hljs-keyword">return</span> value
    <span class="hljs-keyword">return</span><span class="hljs-string">f"未找到与'<span class="hljs-subst">{query}</span>'相关的信息"</span>

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第二部分：定义指令（Instructions）</span>
<span class="hljs-comment"># 通过Prompt模板定义Agent的行为方式和安全策略</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-comment"># ReAct风格的Prompt模板</span>
AGENT_PROMPT = <span class="hljs-string">"""你是一个智能助手，能够帮助用户完成各种任务。

你可以使用以下工具:
{tools}

工具名称列表: {tool_names}

请按照以下格式回答问题:

Question: 用户的输入问题
Thought: 你需要思考应该做什么
Action: 要使用的工具名称，必须是[{tool_names}]中的一个
Action Input: 工具的输入参数
Observation: 工具返回的结果
... (这个Thought/Action/Action Input/Observation可以重复多次)
Thought: 我现在知道最终答案了
Final Answer: 对用户问题的最终回答

重要指导方针：
1. 仔细分析用户的问题，选择合适的工具
2. 如果问题可以直接回答，无需使用工具
3. 回答要准确、简洁、有帮助
4. 如果不确定，诚实地说明

开始！

Question: {input}
Thought: {agent_scratchpad}"""</span>

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第三部分：创建Agent</span>
<span class="hljs-comment"># 组合模型、工具和指令</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_simple_agent</span>():
    <span class="hljs-string">"""创建一个简单的Agent"""</span>
    
    <span class="hljs-comment"># 1. 初始化模型（Model）</span>
    <span class="hljs-comment"># 这里使用OpenAI的GPT模型，你也可以替换为其他LLM</span>
    llm = ChatOpenAI(
        model=<span class="hljs-string">"gpt-3.5-turbo"</span>,  <span class="hljs-comment"># 或 "gpt-4"</span>
        temperature=<span class="hljs-number">0</span>,  <span class="hljs-comment"># 设为0使输出更确定性</span>
        <span class="hljs-comment"># api_key=os.getenv("OPENAI_API_KEY"),  # 从环境变量获取</span>
    )
    
    <span class="hljs-comment"># 2. 准备工具列表（Tools）</span>
    tools = [calculator, get_current_weather, search_knowledge]
    
    <span class="hljs-comment"># 3. 创建Prompt模板（Instructions）</span>
    prompt = PromptTemplate.from_template(AGENT_PROMPT)
    
    <span class="hljs-comment"># 4. 创建ReAct Agent</span>
    agent = create_react_agent(
        llm=llm,
        tools=tools,
        prompt=prompt
    )
    
    <span class="hljs-comment"># 5. 创建Agent执行器</span>
    agent_executor = AgentExecutor(
        agent=agent,
        tools=tools,
        verbose=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 打印详细的执行过程</span>
        handle_parsing_errors=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 处理解析错误</span>
        max_iterations=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 最大迭代次数，防止无限循环</span>
    )
    
    <span class="hljs-keyword">return</span> agent_executor

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第四部分：运行示例</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-string">"""运行Agent示例"""</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"LangChain Agent 示例"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    
    <span class="hljs-comment"># 创建Agent</span>
    agent = create_simple_agent()
    
    <span class="hljs-comment"># 测试用例</span>
    test_questions = [
        <span class="hljs-string">"计算 (15 + 25) * 3 等于多少？"</span>,
        <span class="hljs-string">"北京今天天气怎么样？"</span>,
        <span class="hljs-string">"什么是LangChain？"</span>,
        <span class="hljs-string">"帮我计算一下，如果北京温度是5度，上海是12度，它们的平均温度是多少？"</span>,
    ]
    
    <span class="hljs-keyword">for</span> i, question <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_questions, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"测试 <span class="hljs-subst">{i}</span>: <span class="hljs-subst">{question}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        
        <span class="hljs-keyword">try</span>:
            result = agent.invoke({<span class="hljs-string">"input"</span>: question})
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n最终答案: <span class="hljs-subst">{result[<span class="hljs-string">'output'</span>]}</span>"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"执行出错: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h3 data-id="heading-2">选择模型</h3>
<p>不同的模型在任务复杂性、延迟和成本方面有不同的优势和权衡，并非每个任务都需要最聪明的模型——一个简单的检索或意图分类任务可以由更小、更快的模型处理，而困难任务则可能需要能力更强的推理模型。<br/>
选择模型有效的方法是：使用能力最强的模型为每个任务构建您的智能体原型，以建立性能基线，然后，尝试换用更小的模型，看看它们是否仍能达到可接受的结果。 这样，您就不会过早地限制智能体的能力，并且可以诊断出更小的模型在何处成功或失败，总之，选择模型的原则很简单：</p>
<ul>
<li>建立评估体系以确定性能基线。</li>
<li>专注于使用可用的最佳模型达到您的准确率目标。</li>
<li>在可能的情况下，用更小的模型替换更大的模型，以优化成本和延迟。</li>
</ul>
<h3 data-id="heading-3">定义工具</h3>
<p>工具通过使用底层应用程序或系统的API来扩展智能体的能力，对于没有提供API的历史系统，智能体可以依赖计算机使用模型，通过Web和应用程序UI直接与这些应用程序和系统交互——就像人类一样进行黑盒测试。<br/>
每个工具都应具有标准化的定义，从而实现工具与智能体之间灵活的多对多关系，文档完善、经过充分测试且可重用的工具可以提高可发现性，简化版本管理，并防止重复定义，广义上说，智能体需要三种类型的工具。</p>
<ul>
<li>类型描述示例数据工具：使智能体能够检索执行工作流所需的上下文和信息，比如查询交易数据库或CRM等系统，读取PDF文档，或搜索网络。</li>
<li>行动工具：使智能体能够与系统交互以采取行动，例如向数据库添加新信息、更新记录或发送消息，发送电子邮件和短信，更新CRM记录，将客户服务工单转交给人工。</li>
<li>编排工具：智能体本身可以作为其他智能体的工具，作为多智能体系统中单个 <code>sub agent</code>。</li>
</ul>
<h3 data-id="heading-4">配置Prompt</h3>
<p>高质量的Prompt对于任何LLM驱动的应用程序都至关重要，对智能体尤其关键，清晰的指令可以减少歧义，提高智能体的决策质量，从而实现更顺畅的工作流执行和更少的错误。<br/>
具体做法可以参考如下：</p>
<ul>
<li>利用现有文档：在创建流程时，使用现有的操作程序、支持脚本或策略文档来创建，例如 <code>Claude</code> 提出的 <code>Skill</code>，其他模型比较通用的 <code>AGENTS.md</code> 等。</li>
<li>提示智能体分解任务：从密集的资源中提供更小、更清晰的步骤，有助于最小化歧义，并帮助模型更好地遵循指令。</li>
<li>定义清晰的动作：确保流程中的每一步都对应一个特定的动作或输出，例如，一个步骤可能指示智能体向用户询问订单号，或调用API来检索账户详情，明确说明动作（甚至面向用户消息的措辞）可以减少解释错误的空间。</li>
<li>控制边界处理：现实世界的交互经常会产生决策点，例如当用户提供不完整信息或提出意外问题时如何继续，一个健壮的流程应预见常见的变体，并包含如何处理它们的指令，例如使用条件步骤或分支（如果缺少必要信息，则执行替代步骤）。</li>
</ul>
<h2 data-id="heading-5">从 <code>MCP</code> 到 <code>A2A</code></h2>
<p><code>AI Agent</code> 为了和多个其他系统交互，衍生了两种系统交互的协议，<code>MCP</code> 和 <code>A2A</code>。</p>
<h3 data-id="heading-6"><code>MCP</code></h3>
<p><code>MCP</code> 在之前的文章已经讲过了（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqHfSbSjoxl9V5e8MvVMbZA%25EF%25BC%2589%25EF%25BC%258C%25E4%25B8%2580%25E7%25A7%258D%25E5%25BC%2580%25E6%2594%25BE%25E5%258D%258F%25E8%25AE%25AE%25EF%25BC%258C%25E5%258F%25AF%25E6%25A0%2587%25E5%2587%2586%25E5%258C%2596%25E5%25BA%2594%25E7%2594%25A8%25E5%2590%2591" target="_blank" title="https://mp.weixin.qq.com/s/qHfSbSjoxl9V5e8MvVMbZA%EF%BC%89%EF%BC%8C%E4%B8%80%E7%A7%8D%E5%BC%80%E6%94%BE%E5%8D%8F%E8%AE%AE%EF%BC%8C%E5%8F%AF%E6%A0%87%E5%87%86%E5%8C%96%E5%BA%94%E7%94%A8%E5%90%91" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/qHfSbSjox…</a> LLM 提供上下文的方式，<code>MCP</code> 提供了一种将模型连接到资源、提示和工具的标准化方式。</p>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> httpx
<span class="hljs-keyword">from</span> fastmcp <span class="hljs-keyword">import</span> FastMCP

logger = logging.getLogger(__name__)
logging.basicConfig(<span class="hljs-built_in">format</span>=<span class="hljs-string">"[%(levelname)s]: %(message)s"</span>, level=logging.INFO)

mcp = FastMCP(<span class="hljs-string">"Currency MCP Server 💵"</span>)

<span class="hljs-meta">@mcp.tool()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_exchange_rate</span>(<span class="hljs-params">
    currency_from: <span class="hljs-built_in">str</span> = <span class="hljs-string">'USD'</span>,
    currency_to: <span class="hljs-built_in">str</span> = <span class="hljs-string">'EUR'</span>,
    currency_date: <span class="hljs-built_in">str</span> = <span class="hljs-string">'latest'</span>,
</span>):
    <span class="hljs-string">"""Use this to get current exchange rate.

    Args:
        currency_from: The currency to convert from (e.g., "USD").
        currency_to: The currency to convert to (e.g., "EUR").
        currency_date: The date for the exchange rate or "latest". Defaults to "latest".

    Returns:
        A dictionary containing the exchange rate data, or an error message if the request fails.
    """</span>
    logger.info(<span class="hljs-string">f"--- 🛠️ Tool: get_exchange_rate called for converting <span class="hljs-subst">{currency_from}</span> to <span class="hljs-subst">{currency_to}</span> ---"</span>)
    <span class="hljs-keyword">try</span>:
        response = httpx.get(
            <span class="hljs-string">f'https://api.frankfurter.app/<span class="hljs-subst">{currency_date}</span>'</span>,
            params={<span class="hljs-string">'from'</span>: currency_from, <span class="hljs-string">'to'</span>: currency_to},
        )
        response.raise_for_status()

        data = response.json()
        <span class="hljs-keyword">if</span><span class="hljs-string">'rates'</span>notin data:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'Invalid API response format.'</span>}
        logger.info(<span class="hljs-string">f'✅ API response: <span class="hljs-subst">{data}</span>'</span>)
        <span class="hljs-keyword">return</span> data
    <span class="hljs-keyword">except</span> httpx.HTTPError <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">f'API request failed: <span class="hljs-subst">{e}</span>'</span>}
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'Invalid JSON response from API.'</span>}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    logger.info(<span class="hljs-string">f"🚀 MCP server started on port <span class="hljs-subst">{os.getenv(<span class="hljs-string">'PORT'</span>, <span class="hljs-number">8080</span>)}</span>"</span>)
    asyncio.run(
        mcp.run_async(
            transport=<span class="hljs-string">"http"</span>,
            host=<span class="hljs-string">"0.0.0.0"</span>,
            port=os.getenv(<span class="hljs-string">"PORT"</span>, <span class="hljs-number">8080</span>),
        )
    )
</code></pre>
<p>以上代码是汇率的 <code>MCP Server</code>，通过 <code>MCP Client</code> 可以获取汇率数据。</p>
<h3 data-id="heading-7">Agent2Agent (<code>A2A</code>)</h3>
<p>Agent2Agent (A2A) 协议是一种开放标准，旨在让 AI 智能体之间实现无缝通信和协作，正如 MCP 提供了一种标准化的方式来让 LLM 访问数据和工具一样，A2A 也提供了一种标准化的方式来让智能体与其他智能体对话！<br/>
在一个智能体由不同供应商使用各种框架构建的世界中，A2A 提供了一种通用语言，打破了孤岛并促进了互操作性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc98315e2cb647cd942fe33ba627861b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129217&amp;x-signature=2%2BUTr8lZfYDTv1OsRLrK%2F8JhriU%3D" alt="图片" loading="lazy"/></p>
<p><strong>A2A的工作原理：</strong></p>
<ul>
<li>发现：使用标准化的 <code>Agent Card</code> 查找其他智能体技能 <code>AgentSkill</code> 和功能 <code>AgentCapabilities</code>；</li>
<li>协议：安全的交换消息和数据；</li>
<li>协作：委派任务给到相应技能的 <code>Agent</code> 并协调行动；</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a22d0989770d424e9e454845cfbc44fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129217&amp;x-signature=6RWzFhFghKxuuRGo%2FIK6uMVa4zs%3D" alt="图片" loading="lazy"/></p>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">import</span> click

<span class="hljs-keyword">from</span> a2a.server.apps <span class="hljs-keyword">import</span> A2AStarletteApplication
<span class="hljs-keyword">from</span> a2a.server.request_handlers <span class="hljs-keyword">import</span> DefaultRequestHandler
<span class="hljs-keyword">from</span> a2a.server.tasks <span class="hljs-keyword">import</span> InMemoryTaskStore
<span class="hljs-keyword">from</span> a2a.types <span class="hljs-keyword">import</span> (
    AgentCapabilities,
    AgentCard,
    AgentSkill,
)
<span class="hljs-keyword">from</span> agent <span class="hljs-keyword">import</span> ImageGenerationAgent
<span class="hljs-keyword">from</span> agent_executor <span class="hljs-keyword">import</span> ImageGenerationAgentExecutor
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MissingAPIKeyError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""Exception for missing API key."""</span>

<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option(<span class="hljs-params"><span class="hljs-string">'--host'</span>, <span class="hljs-string">'host'</span>, default=<span class="hljs-string">'localhost'</span></span>)</span>
<span class="hljs-meta">@click.option(<span class="hljs-params"><span class="hljs-string">'--port'</span>, <span class="hljs-string">'port'</span>, default=<span class="hljs-number">10001</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">host, port</span>):
    <span class="hljs-string">"""Entry point for the A2A + CrewAI Image generation sample."""</span>
    <span class="hljs-keyword">try</span>:
        capabilities = AgentCapabilities(streaming=<span class="hljs-literal">False</span>)
        skill = AgentSkill(
            <span class="hljs-built_in">id</span>=<span class="hljs-string">'image_generator'</span>,
            name=<span class="hljs-string">'Image Generator'</span>,
            description=(
                <span class="hljs-string">'Generate stunning, high-quality images on demand and leverage'</span>
                <span class="hljs-string">' powerful editing capabilities to modify, enhance, or completely'</span>
                <span class="hljs-string">' transform visuals.'</span>
            ),
            tags=[<span class="hljs-string">'generate image'</span>, <span class="hljs-string">'edit image'</span>],
            examples=[<span class="hljs-string">'Generate a photorealistic image of raspberry lemonade'</span>],
        )

        agent_host_url = (
            os.getenv(<span class="hljs-string">'HOST_OVERRIDE'</span>)
            <span class="hljs-keyword">if</span> os.getenv(<span class="hljs-string">'HOST_OVERRIDE'</span>)
            <span class="hljs-keyword">else</span><span class="hljs-string">f'http://<span class="hljs-subst">{host}</span>:<span class="hljs-subst">{port}</span>/'</span>
        )
        agent_card = AgentCard(
            name=<span class="hljs-string">'Image Generator Agent'</span>,
            description=(
                <span class="hljs-string">'Generate stunning, high-quality images on demand and leverage'</span>
                <span class="hljs-string">' powerful editing capabilities to modify, enhance, or completely'</span>
                <span class="hljs-string">' transform visuals.'</span>
            ),
            url=agent_host_url,
            version=<span class="hljs-string">'1.0.0'</span>,
            default_input_modes=ImageGenerationAgent.SUPPORTED_CONTENT_TYPES,
            default_output_modes=ImageGenerationAgent.SUPPORTED_CONTENT_TYPES,
            capabilities=capabilities,
            skills=[skill],
        )

        request_handler = DefaultRequestHandler(
            agent_executor=ImageGenerationAgentExecutor(),
            task_store=InMemoryTaskStore(),
        )
        server = A2AStarletteApplication(
            agent_card=agent_card, http_handler=request_handler
        )
        <span class="hljs-keyword">import</span> uvicorn

        uvicorn.run(server.build(), host=host, port=port)

    <span class="hljs-keyword">except</span> MissingAPIKeyError <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f'Error: <span class="hljs-subst">{e}</span>'</span>)
        exit(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f'An error occurred during server startup: <span class="hljs-subst">{e}</span>'</span>)
        exit(<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    main()
</code></pre>
<h2 data-id="heading-8">从单智能体到多智能体</h2>
<h3 data-id="heading-9">单智能体</h3>
<p>单智能体的智能大部分场景下依赖基座模型，在处理明确问题时较为高效，对于约束性任务时较为准确，并且可以进行回测，但面对复杂、多领域任务时，其能力往往受限。</p>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> nest_asyncio

<span class="hljs-keyword">from</span> langchain_google_genai <span class="hljs-keyword">import</span> ChatGoogleGenerativeAI
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool <span class="hljs-keyword">as</span> langchain_tool
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_tool_calling_agent, AgentExecutor

<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 初始化具备工具调用能力的模型</span>
    llm = ChatGoogleGenerativeAI(model=<span class="hljs-string">"gemini-2.0-flash"</span>, temperature=<span class="hljs-number">0</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 语言模型已初始化：<span class="hljs-subst">{llm.model}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🛑 初始化语言模型出错：<span class="hljs-subst">{e}</span>"</span>)
    llm = <span class="hljs-literal">None</span>

<span class="hljs-comment"># --- 定义工具 ---</span>
<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_information</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- 🛠️ 工具调用：search_information, 查询：'<span class="hljs-subst">{query}</span>' ---"</span>)
    <span class="hljs-comment"># 用预设结果模拟搜索工具</span>
    simulated_results = {
        <span class="hljs-string">"default"</span>: <span class="hljs-string">f"模拟搜索 '<span class="hljs-subst">{query}</span>'：未找到具体信息，但该主题很有趣。"</span>
    }
    result = simulated_results.get(query.lower(), simulated_results[<span class="hljs-string">"default"</span>])
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- 工具结果：<span class="hljs-subst">{result}</span> ---"</span>)
    <span class="hljs-keyword">return</span> result

tools = [search_information]

<span class="hljs-comment"># --- 创建工具调用 Agent ---</span>
<span class="hljs-keyword">if</span> llm:
    agent_prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个乐于助人的助手。"</span>),
        (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
        (<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{agent_scratchpad}"</span>),
    ])

    agent = create_tool_calling_agent(llm, tools, agent_prompt)
    agent_executor = AgentExecutor(agent=agent, verbose=<span class="hljs-literal">True</span>, tools=tools)

asyncdef run_agent_with_tool(query: <span class="hljs-built_in">str</span>):
    <span class="hljs-string">"""用 Agent 执行查询并打印最终回复。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- 🏃 Agent 运行查询：'<span class="hljs-subst">{query}</span>' ---"</span>)
    <span class="hljs-keyword">try</span>:
        response = <span class="hljs-keyword">await</span> agent_executor.ainvoke({<span class="hljs-string">"input"</span>: query})
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- ✅ Agent 最终回复 ---"</span>)
        <span class="hljs-built_in">print</span>(response[<span class="hljs-string">"output"</span>])
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🛑 Agent 执行出错：<span class="hljs-subst">{e}</span>"</span>)

asyncdef main():
    <span class="hljs-string">"""并发运行多个 Agent 查询。"""</span>
    tasks = [
        run_agent_with_tool(<span class="hljs-string">"今天XXX天气怎么样？"</span>),
    ]
    <span class="hljs-keyword">await</span> asyncio.gather(*tasks)

nest_asyncio.apply()
asyncio.run(main())
</code></pre>
<h3 data-id="heading-10">多智能体</h3>
<p>多智能体协作模式通过将系统结构化为多个独立且专用的智能体进行协作，解决了单智能体的局限，该模式基于任务分解原则，将高层目标拆分为若干子问题，并分配给具备相应工具、数据访问或推理能力的智能体。<br/>
其中多智能体架构的运作方式：用户查询通过主智能体，主智能体创建专门的子智能体来并行搜索和处理不同信息，样例如下执行流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f71fd6ce1f84431cb383885d02478842~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129217&amp;x-signature=NspkZ3UFNn7oMo02EKdhc56oYEs%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>当用户提交查询时，系统会创建一个主智能体，该智能体进入迭代任务流程。</li>
<li>主智能体首先会思考任务方法，并将计划保存到内存中以持久化上下文信息，因为如果上下文窗口超过 20 万个标记，LLM会信息遗忘或者截断，所以保留计划至关重要。</li>
<li>然后，它会创建专门的子智能体，每个子智能体负责特定的任务。</li>
<li>每个子智能体独立执行网络搜索，使用交错思维评估工具结果，并将结果返回给主智能体。</li>
<li>主智能体综合这些结果，并决定是否需要进行更多任务 —— 如果需要，它可以创建更多子智能体或优化其策略。</li>
<li>一旦收集到足够的信息，系统就会退出循环，并将所有结果传递给引文智能体。</li>
<li>引文智能体处理文档和报告，以确定具体的引文位置，最终的结果（包括引用）将返回给用户。</li>
</ul>
<p><strong>样例代码如下：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentExecutor, create_tool_calling_agent
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool <span class="hljs-keyword">as</span> langchain_tool
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 多智能体系统示例</span>
<span class="hljs-comment"># 架构：主智能体 + 多个专用子智能体</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-comment"># --- 初始化模型 ---</span>
llm = ChatOpenAI(model=<span class="hljs-string">"gpt-5"</span>, temperature=<span class="hljs-number">0</span>)

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第一部分：定义子智能体的工具</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""搜索网络获取最新信息。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🔍 [网络搜索] 查询: <span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-comment"># 模拟网络搜索结果</span>
    <span class="hljs-keyword">return</span><span class="hljs-string">f"网络搜索结果: 关于'<span class="hljs-subst">{query}</span>'的最新信息..."</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_database</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""搜索内部数据库获取结构化数据。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🗄️ [数据库搜索] 查询: <span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-comment"># 模拟数据库查询</span>
    <span class="hljs-keyword">return</span><span class="hljs-string">f"数据库查询结果: '<span class="hljs-subst">{query}</span>'相关记录3条..."</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_data</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""分析数据并生成洞察。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📊 [数据分析] 分析: <span class="hljs-subst">{data}</span>"</span>)
    <span class="hljs-keyword">return</span><span class="hljs-string">f"分析结论: 基于'<span class="hljs-subst">{data}</span>'的数据分析完成..."</span>

<span class="hljs-meta">@langchain_tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_report</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""根据内容生成报告。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📝 [报告生成] 内容: <span class="hljs-subst">{content}</span>"</span>)
    <span class="hljs-keyword">return</span><span class="hljs-string">f"报告已生成: 包含'<span class="hljs-subst">{content}</span>'的详细报告..."</span>

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第二部分：定义子智能体类</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SubAgent</span>:
    <span class="hljs-string">"""子智能体基类"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, role: <span class="hljs-built_in">str</span>, tools: <span class="hljs-built_in">list</span></span>):
        self.name = name
        self.role = role
        self.tools = tools
        self.agent_executor = self._create_executor()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_executor</span>(<span class="hljs-params">self</span>) -&gt; AgentExecutor:
        prompt = ChatPromptTemplate.from_messages([
            (<span class="hljs-string">"system"</span>, <span class="hljs-string">f"你是<span class="hljs-subst">{self.name}</span>，职责是<span class="hljs-subst">{self.role}</span>。专注完成分配的任务，返回简洁结果。"</span>),
            (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
            (<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{agent_scratchpad}"</span>),
        ])
        agent = create_tool_calling_agent(llm, self.tools, prompt)
        <span class="hljs-keyword">return</span> AgentExecutor(agent=agent, tools=self.tools, verbose=<span class="hljs-literal">True</span>)
    
    asyncdef execute(self, task: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""异步执行任务"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">50</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🤖 子智能体 [<span class="hljs-subst">{self.name}</span>] 开始执行任务: <span class="hljs-subst">{task}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">50</span>}</span>"</span>)
        result = <span class="hljs-keyword">await</span> self.agent_executor.ainvoke({<span class="hljs-string">"input"</span>: task})
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"agent"</span>: self.name, <span class="hljs-string">"task"</span>: task, <span class="hljs-string">"result"</span>: result[<span class="hljs-string">"output"</span>]}

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第三部分：创建主智能体（协调者）</span>
<span class="hljs-comment"># ============================================</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MasterAgent</span>:
    <span class="hljs-string">"""主智能体 - 负责任务分解和子智能体协调"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.sub_agents = self._create_sub_agents()
        self.memory = []  <span class="hljs-comment"># 用于持久化计划和中间结果</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_sub_agents</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, SubAgent]:
        <span class="hljs-string">"""创建专用子智能体"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"researcher"</span>: SubAgent(
                name=<span class="hljs-string">"研究员智能体"</span>,
                role=<span class="hljs-string">"负责网络搜索和信息收集"</span>,
                tools=[search_web]
            ),
            <span class="hljs-string">"data_analyst"</span>: SubAgent(
                name=<span class="hljs-string">"数据分析智能体"</span>, 
                role=<span class="hljs-string">"负责数据库查询和数据分析"</span>,
                tools=[search_database, analyze_data]
            ),
            <span class="hljs-string">"reporter"</span>: SubAgent(
                name=<span class="hljs-string">"报告智能体"</span>,
                role=<span class="hljs-string">"负责整合信息并生成最终报告"</span>,
                tools=[generate_report]
            ),
        }
    
    asyncdef _decompose_task(self, query: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]]:
        <span class="hljs-string">"""使用LLM分解任务"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🧠 主智能体正在分析任务: <span class="hljs-subst">{query}</span>"</span>)
        
        <span class="hljs-comment"># 使用LLM进行任务分解</span>
        response = <span class="hljs-keyword">await</span> llm.ainvoke([
            SystemMessage(content=<span class="hljs-string">"""你是一个任务分解专家。将用户查询分解为子任务。
返回格式(每行一个): agent_type|task_description
可用的agent_type: researcher, data_analyst, reporter"""</span>),
            HumanMessage(content=<span class="hljs-string">f"分解任务: <span class="hljs-subst">{query}</span>"</span>)
        ])
        
        <span class="hljs-comment"># 解析任务分解结果</span>
        tasks = []
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response.content.strip().split(<span class="hljs-string">"\n"</span>):
            <span class="hljs-keyword">if</span><span class="hljs-string">"|"</span><span class="hljs-keyword">in</span> line:
                agent_type, task_desc = line.split(<span class="hljs-string">"|"</span>, <span class="hljs-number">1</span>)
                agent_type = agent_type.strip().lower()
                <span class="hljs-keyword">if</span> agent_type <span class="hljs-keyword">in</span> self.sub_agents:
                    tasks.append({<span class="hljs-string">"agent"</span>: agent_type, <span class="hljs-string">"task"</span>: task_desc.strip()})
        
        <span class="hljs-comment"># 默认任务流程（如果LLM分解失败）</span>
        ifnot tasks:
            tasks = [
                {<span class="hljs-string">"agent"</span>: <span class="hljs-string">"researcher"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">f"搜索关于'<span class="hljs-subst">{query}</span>'的信息"</span>},
                {<span class="hljs-string">"agent"</span>: <span class="hljs-string">"data_analyst"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">f"分析'<span class="hljs-subst">{query}</span>'相关数据"</span>},
                {<span class="hljs-string">"agent"</span>: <span class="hljs-string">"reporter"</span>, <span class="hljs-string">"task"</span>: <span class="hljs-string">"整合以上结果生成报告"</span>},
            ]
        
        <span class="hljs-comment"># 保存计划到内存</span>
        self.memory.append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"plan"</span>, <span class="hljs-string">"tasks"</span>: tasks})
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📋 任务分解完成，共<span class="hljs-subst">{<span class="hljs-built_in">len</span>(tasks)}</span>个子任务"</span>)
        <span class="hljs-keyword">return</span> tasks
    
    asyncdef _execute_parallel_tasks(self, tasks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""并行执行子任务"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🚀 开始并行执行 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(tasks)}</span> 个子任务..."</span>)
        
        <span class="hljs-comment"># 创建并行任务</span>
        coroutines = []
        <span class="hljs-keyword">for</span> task_info <span class="hljs-keyword">in</span> tasks:
            agent = self.sub_agents[task_info[<span class="hljs-string">"agent"</span>]]
            coroutines.append(agent.execute(task_info[<span class="hljs-string">"task"</span>]))
        
        <span class="hljs-comment"># 并行执行所有子智能体任务</span>
        results = <span class="hljs-keyword">await</span> asyncio.gather(*coroutines, return_exceptions=<span class="hljs-literal">True</span>)
        
        <span class="hljs-comment"># 处理结果</span>
        valid_results = []
        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(r, Exception):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"⚠️ 子任务执行失败: <span class="hljs-subst">{r}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                valid_results.append(r)
                self.memory.append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"result"</span>, <span class="hljs-string">"data"</span>: r})
        
        <span class="hljs-keyword">return</span> valid_results
    
    asyncdef _synthesize_results(self, results: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""综合所有子智能体结果"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔄 主智能体正在综合 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> 个结果..."</span>)
        
        <span class="hljs-comment"># 构建综合提示</span>
        results_text = <span class="hljs-string">"\n"</span>.join([
            <span class="hljs-string">f"- <span class="hljs-subst">{r[<span class="hljs-string">'agent'</span>]}</span>: <span class="hljs-subst">{r[<span class="hljs-string">'result'</span>]}</span>"</span><span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results
        ])
        
        response = <span class="hljs-keyword">await</span> llm.ainvoke([
            SystemMessage(content=<span class="hljs-string">"你是一个信息综合专家，负责整合多个智能体的执行结果，生成完整、连贯的最终回答。"</span>),
            HumanMessage(content=<span class="hljs-string">f"请综合以下各智能体的执行结果:\n<span class="hljs-subst">{results_text}</span>"</span>)
        ])
        
        <span class="hljs-keyword">return</span> response.content
    
    asyncdef run(self, query: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""运行多智能体系统"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🎯 多智能体系统启动"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📝 用户查询: <span class="hljs-subst">{query}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        
        <span class="hljs-comment"># 1. 任务分解</span>
        tasks = <span class="hljs-keyword">await</span> self._decompose_task(query)
        
        <span class="hljs-comment"># 2. 并行执行子任务</span>
        results = <span class="hljs-keyword">await</span> self._execute_parallel_tasks(tasks)
        
        <span class="hljs-comment"># 3. 综合结果</span>
        final_answer = <span class="hljs-keyword">await</span> self._synthesize_results(results)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 多智能体系统执行完成"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
        
        <span class="hljs-keyword">return</span> final_answer

<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 第四部分：运行示例</span>
<span class="hljs-comment"># ============================================</span>

asyncdef main():
    <span class="hljs-string">"""运行多智能体系统示例"""</span>
    master = MasterAgent()
    
    <span class="hljs-comment"># 测试查询</span>
    query = <span class="hljs-string">"分析2025年人工智能行业的发展趋势，并给出投资建议"</span>
    
    result = <span class="hljs-keyword">await</span> master.run(query)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📊 最终报告"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span>*<span class="hljs-number">60</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(result)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<h3 data-id="heading-11">可靠性和工程挑战</h3>
<p>在传统软件中，一个错误可能会导致功能失效、性能下降或系统宕机，而在智能体系统中，微小的变化也会引发巨大的行为改变，这使得为需要在长时间运行的进程中维护状态的复杂智能体编写代码变得异常困难，那我们应该怎么做？</p>
<ul>
<li>智能体是有状态的，错误会不断累积，我们需要做好容错和沙盒环境。<br/>
智能体可以长时间运行，并在多次工具调用中保持状态，这意味着我们需要持久地执行代码，并在执行过程中处理错误，如果没有有效的缓解措施，即使是轻微的系统故障也可能对智能体造成灾难性后果，当错误发生时，我们不能简单地从头开始：重启成本高昂，因此我们需要构建可以从错误发生时智能体所在位置恢复运行的系统。</li>
<li>构建完整的可观测系统，如果某个智能体不符合预期，应该分析原因。<br/>
智能体会做出动态决策，即使提示信息完全相同，每次运行的结果也并不确定，这使得调试更加困难，智能体使用了错误的搜索查询？选择了不合适的数据源？还是遇到了工具故障？添加完整的生产环境跟踪功能后，我们能够诊断智能体故障的原因并系统地修复问题，除了标准的可观测性之外，我们还监控智能体的决策模式和交互结构，这种高层次的可观测性帮助我们诊断根本原因、发现异常行为并修复常见故障。</li>
<li>智能体同步执行会造成瓶颈，尽可能使用并行处理。<br/>
主智能体同步执行子智能体，等待每组子智能体完成任务后再继续执行下一个，这简化了协调，但也造成了智能体间信息流的瓶颈，例如，主智能体无法控制子代智能体，子智能体之间也无法协调，整个系统可能会因为等待单个子智能体完成搜索而被阻塞，异步执行可以实现更高的并行性：智能体可以并发工作，并在需要时创建新的子智能体，当然这种异步性也带来了结果协调、状态一致性和错误在子智能体间传播方面的挑战。</li>
<li>智能体的可测试性在线上运行十分重要。<br/>
传统的软件对一些子功能我们通常会进行单元测试，这个功能点同样适用于构建的智能体，特别是对于那些希望输入和输出需要保持一致性的智能体系统，那该如何实现？首先智能体功能测试不应该依赖单个大模型；其次将功能测试用例拆分输入和预期输出，对于一些强校验的功能，智能体调用子智能体和系统API的所有的输出应该保持预期测试执行流程一致，才算通过测试用例；最后大模型多次对相同的输入不一定获得相同的结果，所以测试用例应该是多次运行，通过率应该通过次数/执行次数的方式来统计。</li>
</ul>
<h2 data-id="heading-12">参考</h2>
<p>（1）<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Flearn-guide%2F5-day-agents" target="_blank" title="https://www.kaggle.com/learn-guide/5-day-agents" ref="nofollow noopener noreferrer">www.kaggle.com/learn-guide…</a><br/>
（2）<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fai-agents-for-beginners%2Fblob%2Fmain%2Ftranslations%2Fzh%2FREADME.md" target="_blank" title="https://github.com/microsoft/ai-agents-for-beginners/blob/main/translations/zh/README.md" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a><br/>
（3）<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHuggingAGI%2FAwesomeAgentPapers" target="_blank" title="https://github.com/HuggingAGI/AwesomeAgentPapers" ref="nofollow noopener noreferrer">github.com/HuggingAGI/…</a><br/>
（4）<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fbuilding-effective-agents" target="_blank" title="https://www.anthropic.com/engineering/building-effective-agents" ref="nofollow noopener noreferrer">www.anthropic.com/engineering…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[完蛋了，用户登录token集体失效，我的拖字诀还是好用]]></title>    <link>https://juejin.cn/post/7591346773827223578</link>    <guid>https://juejin.cn/post/7591346773827223578</guid>    <pubDate>2026-01-04T11:00:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827223578" data-draft-id="7591346773827190810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="完蛋了，用户登录token集体失效，我的拖字诀还是好用"/> <meta itemprop="keywords" content="Redis"/> <meta itemprop="datePublished" content="2026-01-04T11:00:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="纸仓"/> <meta itemprop="url" content="https://juejin.cn/user/1812410601572599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            完蛋了，用户登录token集体失效，我的拖字诀还是好用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1812410601572599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    纸仓
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:00:46.000Z" title="Sun Jan 04 2026 11:00:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前两天测试同学在群里反馈说测试环境经常会自动退出登录，需要手动重新登录，很麻烦。</p>
<p>本着不主动揽活的原则，我当时眼睛突然就瞎了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b867af0b34d04a5ca4734adfb87f41be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=C1CVKl%2FQ8b%2FP3mr8OVWtCxXfsIE%3D" alt="image.png" loading="lazy"/></p>
<p>好景说长也长说短也短，5个月之后，其他同事也陆续反馈，估计真受不了了。</p>
<p>老大特意@了我，我当时眼睛也正好瞎了，不过有一个前端同学眼睛贼好。老大顺带@了他，他说他要试试。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/214901dc3a364f6b8f051b0c2d9e2442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=JHT9Pg6PC2b34vFsSvYU%2BjujFfU%3D" alt="image.png" loading="lazy"/></p>
<p>确实 token 有可能前端“无意间”调用了登出接口，导致的过期。这个想法非常合理。</p>
<p>我承认我应该向他学习的，但我手上的活实在是太多了。每次和 AI 神仙打架，AI 都表现得跟条死鱼一样，我不得不花时间和她多说几次：“给我可以运行的代码！！！”</p>
<p>后面前端哥们估计也是找不出原因来，这个事情就又搁置下来了，没人记得我，也没人在乎我。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/229fe39545ec410880871653d8f6fad7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=ULNTPgfT3bOY%2BhT55sH8TxWqdp0%3D" alt="image.png" loading="lazy"/></p>
<p>痛吗？怎么可能痛？爽飞了。</p>
<p>但是，但是，但是。好景再一次不长。这次老大直接@我一个人了，要命的是老板还点了个+1。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f74e6fe3314d1da2cefdece59c53a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=%2BecHEzjFuaNBIeFSJx1U7WfxHHc%3D" alt="image.png" loading="lazy"/></p>
<p>为了避免年底喜提年终，我不得不先应下来，但也是能拖就拖。毕竟和 AI 神仙打架好玩点，看起来就是在使用前沿科技 vibe coding，实际上就是和 AI 对线扭打。</p>
<p>每天的类不再是身体的，而是骂不过 AI 的心累。哎，同时代码写的依托答辩，我还能喷赢他。如今连机器人写出依托答辩出来，我都骂不过，我真是个垃圾啊。</p>
<p>玩归玩闹归闹，找bug还得有人靠。于是我广发英雄帖，征求各大 AI 大佬的意见。他们从没如此一致过，说是我的用户登录态过期了，或者是误删了。</p>
<p>要不我学过点 Redis 皮毛还真被这些带佬蒙过去了。鄙人想偷懒才让你们分析，分析不对我自己也略懂一些拳脚。</p>
<p>再来回看 bug 的表现：</p>
<ul>
<li>没有登出的时候token失效了</li>
<li>几个人集体发生</li>
<li>生产环境没有出现</li>
<li>生产环境和测试环境代码一样</li>
<li>近期没有改动账户服务</li>
</ul>
<p>代码一样，那就找不一样的。那比较明显了，环境不一样，一个叫生产一个叫测试。嘿嘿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a22add561c604442bf6cd167a9c78f39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=3OP%2Bvr0%2FhXRknNoH3Ne1f72VtW8%3D" alt="image.png" loading="lazy"/></p>
<p>这就涉及到一个哲学问题：测试环境为什么叫测试环境？生产环境为什么叫生产环境？</p>
<p>一般来说就是测试环境是用来测试的，正式环境一般是给用户用来生产的。牛逼吧？</p>
<p>说人话就是测试环境是给内部人用的，正式环境是给义父们用的。</p>
<p>再说人话就是，内部人能有几个人，老板给个配置最差的 Redis，你都不能怨他。</p>
<p>所以我的猜想是什么呢？就是生产环境的 Redis 配置很高，测试环境的配置很低。</p>
<p>Redis 用的默认的内存策略 LRU，所以内存满了就会驱逐一部分 Key。</p>
<p>有了这个猜想，接下我们就要来验证一下猜想是否准确？</p>
<p>我看了一下生产环境和测试环境之间的差不别，你猜怎么着？</p>
<p>测试和生产之间的差别就是：生产的 Redis 内存 256G，测试的 Redis 内存 16M。</p>
<p>是的你妹看错，是16M。不是16G也不是256M，而是整整16M啊。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b7d893fbe984f94a4764b5ec89cdff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=MzdbMlsAp2h8fw3HPGk72RtTbO4%3D" alt="image.png" loading="lazy"/></p>
<p>多磨勤俭持家的老板啊，为了省下点钱给我们发年终，涨工资。</p>
<p>他都不惜买最低配的服务器，给自己买最低配的跑车。一切都是为了员工的收入，也能理解。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b984e502db2140c3874016e1acabc416~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=jRWJG9iJYOT4dHwTZN3LmChtTEs%3D" alt="image.png" loading="lazy"/></p>
<p>这个配置文件显示测试环境运行的 Redis 就是16M的内存，还显示达到最大内存时的淘汰策略是 lru。</p>
<p>也就是内存满时，把最近最少使用的key给干掉，腾出存储空间来。</p>
<p>不信邪可以在 Redis-cli 执行命令看看实际上是不是这样</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">INFO MEMORY</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Memory</span>
used_memory_human:8.47M
maxmemory_human:16.00M
maxmemory_policy:allkeys-lru
....

</code></pre>
<p>心死了，还真是，再查一下被驱逐的 key 有多少</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">INFO STATS</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Stats</span>
evicted_keys:53725
...

</code></pre>
<p>这下心死透了，直接联系老板手下的运维大将，能不能将 16M 的 Redis 做个升级，升级到 32M？</p>
<p>没想到运维大将竟然直接答应了，还给升级到了 256M，我真是太感谢他了。还好有他，不然我元旦出门都要带电脑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ca157c4f064be1a3aabacc756ac045~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=teh%2FoJmkDttFa5CrVcoLbDFDk%2FQ%3D" alt="image.png" loading="lazy"/></p>
<p>就酱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80afa95826974743a17bea63e54fa848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LuT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129246&amp;x-signature=TTcsDd%2BM%2FxZbcaVZ5rJJUJ0jCq4%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini Chat Completion API 申请及使用]]></title>    <link>https://juejin.cn/post/7591156262625902627</link>    <guid>https://juejin.cn/post/7591156262625902627</guid>    <pubDate>2026-01-04T11:01:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591156262625902627" data-draft-id="7591330139082899471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini Chat Completion API 申请及使用"/> <meta itemprop="keywords" content="Gemini,ChatGPT,API"/> <meta itemprop="datePublished" content="2026-01-04T11:01:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini Chat Completion API 申请及使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:01:33.000Z" title="Sun Jan 04 2026 11:01:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Google Gemini 是一款非常强大的 AI 对话系统，只要输入提示词，就能在短短几秒内生成流畅自然的回复。Gemini 都能提供令人惊叹的智能协助，极大地提高了人类的工作效率和创造力。</p>
<p>本文档主要介绍 Gemini Chat Completion API 操作的使用流程，利用它我们可以轻松使用官方 Gemini 的对话功能。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 Gemini Chat Completion API，首先可以到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fae54bf9b-af41-4072-b969-3756b6d66834" target="_blank" title="https://platform.acedata.cloud/documents/ae54bf9b-af41-4072-b969-3756b6d66834" ref="nofollow noopener noreferrer">Gemini Chat Completion API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2c0942732834f97b2988261219becfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=N9dnyGNEk4OCusElZPAUkFtABeM%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>接下来就可以在界面上填写对应的内容，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f49faf02a464bcd9786706cf4c0ce88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=jxrtsoEgANLF6460vNV%2BvYNfglY%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>在第一次使用该接口时，我们至少需要填写三个内容，一个是 <code>authorization</code>，直接在下拉列表里面选择即可。另一个参数是 <code>model</code>， <code>model</code> 就是我们选择使用 Gemini 官网模型类别，这里我们主要有 6 种模型，详情可以看我们提供的模型。最后一个参数是<code>messages</code>，<code>messages</code>是我们输入的提问词数组，它是一个数组，表示可以同时上传多个提问词，每个提问词包含了 <code>role</code> 和 <code>content</code>，其中 <code>role</code> 表示提问者的角色，我们提供了三种身份，分别为 <code>user</code> 、<code>assistant</code>、<code>system</code> 。另一个 <code>content</code> 就是我们提问的具体内容。</p>
<p>同时您可以注意到右侧有对应的调用代码生成，您可以复制代码直接运行，也可以直接点击「Try」按钮进行测试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3200cf144b4d4aca88a1e32621b52ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=j55w7iX6PI1drFcGipKPp2HhpQw%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>调用之后，我们发现返回结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122212413908150493uPhjTUO9"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763817866</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"I am a large language model, trained by Google."</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**My Reasoning: Answering the User's Question**\n\nOkay, here's how I'm going to approach answering the user's question, \"What model are you?\". The core is to be direct and informative. First, I have to be clear about my origin. Then, I need to make sure the explanation is accessible, given that the user may not be familiar with technical jargon. I need to explain what a \"large language model\" actually *does*, and provide relatable examples. I know the user might be looking for a specific name, like other models have, so I'll address that directly and then wrap it up with an invitation to continue.\n\nSo, here's my plan:\n\n1.  **Lead with the key info:** I'll begin by stating that I am a large language model created by Google. That is the fundamental, most critical piece of the puzzle.\n2.  **Define the buzzword:** Then, I'll explain that \"large language model\" in simple terms. I'll explain what I *do* - process and generate text; how I *do* it - by training on huge amounts of text data; and the *goal* - to be able to communicate like a human.\n3.  **Provide context:** After that, to make the concept even clearer, I'll provide a list of examples of my capabilities. I'll mention things like answering questions, summarizing texts, writing stories, translating languages, and brainstorming ideas.\n4.  **Acknowledge the lack of a personal name:** I'll anticipate the likely question about a model name (like ChatGPT) by clearly stating that I don't have a personal name and that it's best to think of me as an AI assistant from Google.\n5.  **End with an invitation:** Lastly, I'll end with a simple, friendly question to invite further interaction and to guide the conversation.\n\nWith this approach, I am confident I can successfully answer this important question.\n"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">932</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">940</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">921</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>id</code>，生成此次对话任务的 ID，用于唯一标识此次对话任务。</li>
<li><code>model </code>，选择的 Gemini 官网模型。</li>
<li><code>choices</code>，Gemini 针对提问词给于的回答信息。</li>
<li><code>usage </code>：针对本次问答对 token 的统计信息。</li>
</ul>
<p>其中 <code>choices</code> 是包含了 Gemini 的回答信息，它里面的 <code>choices</code> 是 Gemini回答的具体信息，可以发现如图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c43b1d733fcf40be8cc74dce7afa63f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=4Tujg%2FDuQPcHgOv%2BLuztpq0tvUM%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>可以看到，<code>choices</code> 里面的 <code>content</code> 字段包含了 Gemini 回复的具体内容。</p>
<h2 data-id="heading-2">流式响应</h2>
<p>该接口也支持流式响应，这对网页对接十分有用，可以让网页实现逐字显示效果。</p>
<p>如果想流式返回响应，可以更改请求头里面的 <code>stream </code> 参数，修改为 <code>true</code>。</p>
<p>修改如图所示，不过调用代码需要有对应的更改才能支持流式响应。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16b8b12fe4ca4d1ba8c1c6ebac490196~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=7jH%2B0DEnjjyLim0DcsCShydqJLY%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>将 <code>stream</code> 修改为 <code>true</code> 之后，API 将逐行返回对应的 JSON 数据，在代码层面我们需要做相应的修改来获得逐行的结果。</p>
<p>Python 样例调用代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"gemini-2.5-pro"</span>,
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello,What model are you?"</span>}],
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">True</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>输出效果如下：</p>
<pre><code class="hljs language-json" lang="json">data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**Define My Nature**\n\nMy thinking has started. The user wants to know my nature, asking a direct \"what are you?\" The initial step was straightforward: identifying the query. Now, I recall my fundamental identity: I'm a large language model. This is the core truth I aim to convey.\n\n\n"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**Refining My Response**\n\nI've added the crucial information that I'm trained by Google to the basic \"large language model\" identity. My next step is considering what being a \"large language model\" actually entails, so I can explain my core capabilities. I'm focusing on providing context without going into specific technical details or model names. I want to convey my function in a way the user can easily understand.\n\n\n"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**Confirming Core Identity**\n\nI'm now solidifying my response. The user's query about my model affiliation needs a focused answer. I've pinpointed that \"trained by Google\" is essential, providing key context. I'm resisting the urge to mention any specific model names, as it's not relevant. The aim is to deliver a direct, accurate statement. My goal remains a clear and concise reply, avoiding technical jargon and getting straight to the relevant point.\n\n\n"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"I am a large language model, trained by Google."</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"delta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"logprobs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214038810722821kNjUTjtr"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion.chunk"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763818842</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_fingerprint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">527</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">535</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">519</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>

data<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>DONE<span class="hljs-punctuation">]</span>
</code></pre>
<p>可以看到，响应里面有许多 <code>data</code> ，<code>data</code> 里面的 <code>choices</code> 即为最新的回答内容，与上文介绍的内容一致。<code>choices</code> 是新增的回答内容，您可以根据结果来对接到您的系统中。同时流式响应的结束是根据 <code>data</code> 的内容来判断的，如果内容为 <code>[DONE]</code>，则表示流式响应回答已经全部结束。返回的 <code>data</code> 结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>id</code>，生成此次对话任务的 ID，用于唯一标识此次对话任务。</li>
<li><code>model </code>，选择的 Gemini 官网模型。</li>
<li><code>choices</code>，Gemini 针对提问词给于的回答信息。</li>
</ul>
<p>JavaScript 也是支持的，比如 Node.js 的流式调用代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">method</span>: <span class="hljs-string">"post"</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
  },
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"gemini-2.5-pro"</span>,
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello,What model are you?"</span>}],
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">true</span>
  })
};

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>, options)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<p>Java 样例代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();
jsonObject.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"gemini-2.5-pro"</span>);
jsonObject.put(<span class="hljs-string">"messages"</span>, [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello,What model are you?"</span>}]);
jsonObject.put(<span class="hljs-string">"stream"</span>, <span class="hljs-literal">true</span>);
<span class="hljs-type">MediaType</span> <span class="hljs-variable">mediaType</span> <span class="hljs-operator">=</span> <span class="hljs-string">"application/json; charset=utf-8"</span>.toMediaType();
<span class="hljs-type">RequestBody</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> jsonObject.toString().toRequestBody(mediaType);
<span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()
  .url(<span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>)
  .post(body)
  .addHeader(<span class="hljs-string">"accept"</span>, <span class="hljs-string">"application/json"</span>)
  .addHeader(<span class="hljs-string">"authorization"</span>, <span class="hljs-string">"Bearer {token}"</span>)
  .addHeader(<span class="hljs-string">"content-type"</span>, <span class="hljs-string">"application/json"</span>)
  .build();

<span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();
<span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.newCall(request).execute();
System.out.print(response.body!!.string())
</code></pre>
<p>其他语言可以另外自行改写，原理都是一样的。</p>
<h2 data-id="heading-3">多轮对话</h2>
<p>如果您想要对接多轮对话功能，需要对 <code>messages</code> 字段上传多个提问词，多个提问词的具体示例如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7425b64a89a48dfaad3494bc36c934a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768129292&amp;x-signature=ffGWimzHBCZcfuu2v8QEV6DdQ0I%3D" width="400" class="m-auto" loading="lazy"/></p>
<p>Python 样例调用代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/gemini/chat/completions"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"gemini-2.5-pro"</span>,
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello"</span>},{<span class="hljs-string">"role"</span>:<span class="hljs-string">"assistant"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"Hello there! How can I help you today?"</span>},{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"What model are you?"</span>}]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>通过上传多个提问词，就可以轻松实现多轮对话，可以得到如下回答：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251122214426669120974AKFwnJd1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1763819072</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"I am a large language model, trained by Google."</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reasoning_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Okay, here's how I'd approach this, thinking as a sophisticated AI:\n\nFirst, the user is directly querying my core identity: \"What model are you?\" That's a simple, straightforward question. My primary task is to provide accurate and helpful information, so I need to answer this immediately.\n\nRight off the bat, I know the answer. I *am* a large language model. That's my fundamental architecture and operational principle. I'm built on a vast network of connections and trained on a massive dataset.\n\nThen I must add the necessary context. Crucially, I have to provide the source of my training. I *was* trained by Google. That's a key identifier. It provides the user with valuable information about my origin and potential biases (though I'm trained to mitigate them).\n\nNow I must construct the response. My goal is to be factual, concise, and understandable.\n\nThe synthesized response is something like: \"I am a large language model, trained by Google.\"\n\nI have to assess the output: Does it meet the criteria? It's clear. It states what I am, it includes a critical piece of information on my origins, and it avoids jargon. No misleading promises.\n\nFinal verification: Does it actually answer the question? Yes. Is the information correct and truthful? Yes. Is it concise? Absolutely. Is the tone appropriate for any user? Yes. And, finally, this is the standard, approved response. Excellent.\n"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">265</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">281</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">254</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，<code>choices</code> 包含的信息与基本使用的内容是一致的，这个包含了 Gemini 针对多个对话进行回复的具体内容，这样就可以根据多个对话内容来回答对应的问题了。</p>
<h2 data-id="heading-4">Gemini-3.0 多模态模型</h2>
<p>请求样例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"messages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"图片的内容是什么？"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image_url"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn.acedata.cloud/qzx2z1.png"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>样例结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251206001815715692730UVZe38kB"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1764951548</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"这是一张年轻女性的户外半身人像照片。\n\n以下是图片的主要内容描述：\n\n*   **人物外貌**：照片中的女孩留着一头乌黑柔顺的长直发，五官清秀，皮肤白皙。她面带温柔的微笑，目光注视着镜头。\n*   **穿着打扮**：她穿着一件米白色或浅杏色的泡泡袖上衣，外面搭配着黑色的衣物（看起来像是背带裙或马甲）。\n*   **光影氛围**：阳光从左侧后方照射过来，洒在她的头发上，形成了一圈温暖的金黄色光晕，营造出一种清新、唯美的氛围。\n*   **背景**：背景被虚化处理，可以看出是在户外，身后是一条空旷的路面（柏油路）以及路边的绿色树木。\n\n整体来看，这张照片给人一种甜美、阳光和邻家女孩的感觉。"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1092</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1271</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2363</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1072</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>当然你也可以传如视频的链接，具体的输入如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"messages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"视频的内容是什么？"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image_url"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn.acedata.cloud/58yioe.mp4"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>样例结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chatcmpl-20251206002711949677736JC9yL8AE"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-3.0-pro"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"object"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chat.completion"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"created"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1764952060</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"choices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"这段视频的内容充满趣味，主要展示了一只**橘猫**在黄昏时分的乡间公路上自信小跑的情景。\n\n具体细节如下：\n\n1.  **画面内容**：\n    *   主角是一只橘色的虎斑猫。\n    *   背景是夕阳西下（或清晨）的时刻，光线金黄柔和。路边有木质栅栏和旷野，远处还有一个行人的剪影。\n    *   镜头采用了低角度拍摄，时而拍摄猫咪迎面跑来，时而拍摄它离去的背影，还有猫咪面部和花纹的特写。\n\n2.  **声音特点（关键点）**：\n    *   视频的配音非常有特色。虽然画面是轻盈的猫咪在跑，但配上的声音却是**沉重且有节奏的马蹄声**（或者是类似木屐/高跟鞋敲击路面的声音）。\n    *   这种声音与画面的反差制造了一种幽默感，仿佛这只猫咪把自己当成了一匹正在驰骋的骏马。\n\n总的来说，这是一个利用音画反差来制造萌点和笑点的宠物视频。"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stop"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">915</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1423</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"total_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2338</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"cached_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"completion_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"reasoning_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1162</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"output_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"input_tokens_details"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_5_m_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"claude_cache_creation_1_h_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>从上面可以看出是Gemini 3.0模型可以支持多模态的理解的。</p>
<h2 data-id="heading-5">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-6">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">结论</h2>
<p>通过本文档，您已经了解了如何使用 Gemini Chat Completion API 轻松实现官方 Gemini 的对话功能。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot：Java开发的神奇加速器（二）]]></title>    <link>https://juejin.cn/post/7591013450525638708</link>    <guid>https://juejin.cn/post/7591013450525638708</guid>    <pubDate>2026-01-04T07:45:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591013450525638708" data-draft-id="7591013450525622324" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot：Java开发的神奇加速器（二）"/> <meta itemprop="keywords" content="Spring Boot,后端"/> <meta itemprop="datePublished" content="2026-01-04T07:45:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot：Java开发的神奇加速器（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T07:45:10.000Z" title="Sun Jan 04 2026 07:45:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">四、深入理解 Spring Boot 配置</h3>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 配置文件类型</h4>
<blockquote>
<p>在 Spring Boot 应用中，主要有两种配置文件类型，即application.properties和application.yml（或application.yaml），它们都用于配置应用程序的各种属性，但在语法和格式上有所不同。</p>
</blockquote>
<blockquote>
<ul>
<li>
<p><strong>application.properties</strong>：这是一种传统的属性文件格式，使用键值对的方式进行配置，每个属性占一行，以key=value的形式表示。例如：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8080</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mydb
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
AI写代码TypeScript
运行
</code></pre>
<p>这种格式的优点是简单直观，易于理解和编写，适合简单的配置场景。缺点是对于复杂的配置，尤其是具有层级结构的配置，会显得不够灵活和清晰，因为它只能通过点号（.）来模拟层级关系，例如spring.datasource.url，但对于更复杂的嵌套结构，代码会变得冗长且难以维护。</p>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>
<p><strong>application.yml</strong>：它采用 YAML（YAML Ain't Markup Language）格式，使用缩进和冒号来表示属性的层级关系，具有更好的可读性和层次性。例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mydb</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>YAML 格式的优势在于能够清晰地展示配置的层级结构，对于复杂的配置更加友好，易于维护和管理。同时，它还支持列表和嵌套对象的表示，例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">my:</span>
  <span class="hljs-attr">servers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.101</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>但需要注意的是，YAML 对缩进的要求非常严格，缩进错误可能会导致配置解析失败。在使用时，务必确保缩进的一致性和正确性。</p>
<p>两种配置文件在功能上是等价的，Spring Boot 会自动加载并解析它们。开发者可以根据个人喜好和项目的实际需求来选择使用哪种格式。一般来说，对于简单的项目或配置较少的情况，application.properties可能更方便；而对于大型项目或复杂的配置场景，application.yml则能更好地展现其优势。</p>
</li>
</ul>
</blockquote>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 常用配置项</h4>
<blockquote>
<p>Spring Boot 应用的配置项非常丰富，涵盖了服务器、数据库、日志、安全等多个方面。以下是一些常用的配置项及其配置方法：</p>
</blockquote>
<blockquote>
<p><strong>服务器端口配置</strong>：在开发和部署 Spring Boot 应用时，经常需要修改服务器的端口号，以避免与其他应用冲突或满足特定的部署需求。可以在application.properties或application.yml文件中进行配置。</p>
</blockquote>
<blockquote>
<ul>
<li>
<p>在application.properties中配置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8081</span>
AI写代码TypeScript
运行
</code></pre>
</li>
<li>
<p>在application.yml中配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>除了在配置文件中设置，还可以通过命令行参数的方式来指定端口号，这种方式在测试或临时部署时非常方便。例如：</p>
<pre><code class="hljs language-ini" lang="ini">java -jar your - application.jar <span class="hljs-attr">--server.port</span>=<span class="hljs-number">8082</span>
AI写代码TypeScript
运行
</code></pre>
<p>命令行参数的优先级高于配置文件中的配置，即如果同时在配置文件和命令行中设置了端口号，应用会采用命令行中指定的端口。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>数据库连接配置</strong>：在大多数 Web 应用中，与数据库进行交互是必不可少的。Spring Boot 支持多种数据库，如 MySQL、PostgreSQL、H2 等，配置方式也相对简单。以 MySQL 数据库为例，在application.properties中配置如下：</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mydb?useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
spring.datasource.driver - class - <span class="hljs-attr">name</span>=com.mysql.cj.jdbc.Driver
AI写代码TypeScript
运行
</code></pre>
<blockquote>
<p> 在application.yml中配置则为：</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mydb?useSSL=false&amp;serverTimezone=UTC</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver - class - name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<blockquote>
<p>其中，spring.datasource.url指定了数据库的连接地址，包括主机名、端口号和数据库名，?useSSL=false&amp;serverTimezone=UTC是一些连接参数，用于禁用 SSL 连接和设置时区；spring.datasource.username和spring.datasource.password分别是数据库的用户名和密码；spring.datasource.driver - class - name指定了数据库驱动类，对于 MySQL 8 及以上版本，通常使用com.mysql.cj.jdbc.Driver。</p>
</blockquote>
<blockquote>
<p>如果使用的是其他数据库，如 H2 嵌入式数据库，配置会有所不同。在application.properties中配置：</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:h2:mem:testdb
spring.datasource.driver - class - <span class="hljs-attr">name</span>=org.h2.Driver
<span class="hljs-attr">spring.datasource.username</span>=sa
<span class="hljs-attr">spring.datasource.password</span>=password
AI写代码TypeScript
运行
</code></pre>
<blockquote>
<p>在application.yml中配置： </p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:h2:mem:testdb</span>
    <span class="hljs-attr">driver - class - name:</span> <span class="hljs-string">org.h2.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">sa</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">password</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<blockquote>
<p>这里jdbc:h2:mem:testdb表示使用内存中的 H2 数据库，数据库名为testdb。</p>
</blockquote>
<blockquote>
<p><strong>日志配置</strong>：日志在应用开发和运维中起着至关重要的作用，它可以帮助我们记录应用的运行状态、排查问题等。Spring Boot 默认使用 Logback 作为日志框架，通过配置文件可以灵活地控制日志的输出级别、格式和目标等。在application.properties中配置日志示例如下：</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 根日志级别</span>
<span class="hljs-attr">logging.level.root</span>=INFO
<span class="hljs-comment"># 指定包下的日志级别</span>
<span class="hljs-attr">logging.level.com.example.myapp</span>=DEBUG
<span class="hljs-comment"># 日志文件名称</span>
<span class="hljs-attr">logging.file.name</span>=myapp.log
<span class="hljs-comment"># 日志文件路径</span>
<span class="hljs-attr">logging.file.path</span>=/var/log/myapp/
AI写代码TypeScript
运行
</code></pre>
<blockquote>
<p>在application.yml中配置：</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">INFO</span>
    <span class="hljs-attr">com.example.myapp:</span> <span class="hljs-string">DEBUG</span>
  <span class="hljs-attr">file:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">myapp.log</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">/var/log/myapp/</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<blockquote>
<p>上述配置中，logging.level.root设置了根日志级别为INFO，表示只输出INFO级别及以上的日志；<a href="https://link.juejin.cn?target=http%3A%2F%2Flogging.level.com%2F" title="http://logging.level.com/" target="_blank" ref="nofollow noopener noreferrer">logging.level.com</a>.example.myapp将com.example.myapp包下的日志级别设置为DEBUG，这样该包下的详细调试信息也会被记录；logging.file.name指定了日志文件的名称为myapp.log，logging.file.path指定了日志文件的存储路径为/var/log/myapp/。如果不指定路径，日志文件会生成在项目的根目录下。</p>
</blockquote>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.3 自定义配置</h4>
<blockquote>
<p>除了使用 Spring Boot 提供的默认配置项和常用配置项外，我们还可以根据项目的业务需求自定义配置属性，并将其注入到 Java 类中使用。以下是实现自定义配置的详细步骤：</p>
</blockquote>
<blockquote>
<p><strong>1.在配置文件中定义自定义属性</strong>：首先，在application.properties或application.yml文件中添加自定义的配置属性。例如，在application.properties中添加：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">myapp.custom.name</span>=Spring Boot自定义配置示例
<span class="hljs-attr">myapp.custom.value</span>=<span class="hljs-number">123</span>
AI写代码TypeScript
运行
</code></pre>
<p>在application.yml中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">myapp:</span>
  <span class="hljs-attr">custom:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Boot自定义配置示例</span>
    <span class="hljs-attr">value:</span> <span class="hljs-number">123</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
</blockquote>
<blockquote>
<p> 2.<strong>创建 Java 类来接收配置属性</strong>：然后，创建一个 Java 类，使用@ConfigurationProperties注解来绑定配置文件中的属性。假设我们创建一个名为MyAppConfig的类，代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">context</span>.<span class="hljs-property">properties</span>.<span class="hljs-property">ConfigurationProperties</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;
 
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"myapp.custom"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAppConfig</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">private</span> int value;
 
    <span class="hljs-comment">// 生成getter和setter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> name;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
 
    <span class="hljs-keyword">public</span> int <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> value;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-params">int value</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个类中，@Component注解将其标记为一个 Spring 组件，使其能够被 Spring 容器扫描并管理。@ConfigurationProperties(prefix = "myapp.custom")注解表示将配置文件中以myapp.custom为前缀的属性绑定到该类的属性上，例如myapp.custom.name会绑定到name属性，myapp.custom.value会绑定到value属性。</p>
</blockquote>
<blockquote>
<p><strong>3.使用自定义配置属性</strong>：在其他类中，通过依赖注入的方式获取MyAppConfig实例，就可以使用自定义的配置属性了。例如，创建一个控制器类CustomConfigController：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
 
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomConfigController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MyAppConfig myAppConfig;
 
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/custom-config"</span>)</span>
    <span class="hljs-keyword">public</span> String getCustomConfig() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"自定义配置名称: "</span> + myAppConfig.getName() + <span class="hljs-string">", 自定义配置值: "</span> + myAppConfig.getValue();
    }
}
AI写代码TypeScript
运行
</code></pre>
</blockquote>
<blockquote>
<p>在这个控制器中，通过@Autowired注解将MyAppConfig实例注入到myAppConfig变量中，然后在getCustomConfig方法中使用其属性，返回自定义配置的信息。当访问/custom-config接口时，就可以看到输出的自定义配置内容。</p>
</blockquote>
<blockquote>
<p>通过上述步骤，我们实现了自定义配置属性并将其注入到 Java 类中使用，这种方式使得我们可以方便地管理和使用项目特定的配置信息，提高了应用的可配置性和灵活性。</p>
</blockquote>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>五、数据访问与持久化</h3>
<blockquote>
<p>在现代 Web 应用开发中，数据访问与持久化是至关重要的环节。它负责与数据库进行交互，实现数据的存储、读取、更新和删除等操作，是连接业务逻辑与数据存储的桥梁。Spring Boot 提供了强大的数据访问支持，结合 Spring Data JPA 等技术，能够极大地简化数据访问层的开发。</p>
</blockquote>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 集成 Spring Data JPA</h4>
<blockquote>
<p>Spring Data JPA 是 Spring 框架的一个模块，它简化了与 Java 持久化 API（JPA）的交互，提供了一种声明式的数据访问方式。在 Spring Boot 应用中集成 Spring Data JPA，可以显著提高数据访问层的开发效率。以下是集成 Spring Data JPA 的详细步骤：</p>
</blockquote>
<blockquote>
<p><strong>1.添加依赖</strong>：在pom.xml文件中添加 Spring Data JPA 和数据库驱动的依赖。以 MySQL 数据库为例，添加如下依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Data JPA依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- MySQL数据库驱动依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
AI写代码TypeScript
运行
</code></pre>
<p>这里，spring-boot-starter-data-jpa依赖引入了 Spring Data JPA 的核心功能和相关组件，mysql-connector-java依赖则提供了与 MySQL 数据库进行交互的驱动程序。runtime表示该依赖仅在运行时需要，不会参与编译过程。</p>
</blockquote>
<blockquote>
<p><strong>2.配置数据源</strong>：在application.properties或application.yml文件中配置数据库连接信息，包括数据库的 URL、用户名、密码和驱动类名。在application.properties中配置如下：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/mydb?useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-number">123456</span>
spring.datasource.driver - class - <span class="hljs-attr">name</span>=com.mysql.cj.jdbc.Driver
AI写代码TypeScript
运行
</code></pre>
<p>在application.yml中配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mydb?useSSL=false&amp;serverTimezone=UTC</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver - class - name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p>上述配置中，spring.datasource.url指定了 MySQL 数据库的连接地址，包括主机名<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%2F" title="http://localhost/" target="_blank" ref="nofollow noopener noreferrer">localhost</a>、端口号3306和数据库名mydb，?useSSL=false&amp;serverTimezone=UTC是连接参数，用于禁用 SSL 连接和设置时区为 UTC；spring.datasource.username和spring.datasource.password分别是数据库的用户名和密码；spring.datasource.driver - class - name指定了 MySQL 数据库的驱动类，对于 MySQL 8 及以上版本，通常使用com.mysql.cj.jdbc.Driver。</p>
</blockquote>
<blockquote>
<p><strong>3.配置 JPA</strong>：同样在配置文件中，配置 JPA 的相关属性，如数据库方言、实体扫描位置和 DDL 自动更新策略等。在application.properties中添加：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.jpa.hibernate.ddl-auto</span>=update
<span class="hljs-attr">spring.jpa.show-sql</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.jpa.properties.hibernate.dialect</span>=org.hibernate.dialect.MySQL5InnoDBDialect
AI写代码TypeScript
运行
</code></pre>
<p>在application.yml中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">jpa:</span>
    <span class="hljs-attr">hibernate:</span>
      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">update</span>
    <span class="hljs-attr">show-sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">hibernate:</span>
        <span class="hljs-attr">dialect:</span> <span class="hljs-string">org.hibernate.dialect.MySQL5InnoDBDialect</span>
<span class="hljs-string">AI写代码TypeScript</span>
<span class="hljs-string">运行</span>
</code></pre>
<p> 其中，spring.jpa.hibernate.ddl-auto=update表示在应用启动时，根据实体类的定义自动更新数据库表结构，如果表不存在则创建；spring.jpa.show-sql=true表示在控制台打印 JPA 执行的 SQL 语句，方便调试；spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect指定了使用 MySQL 5 InnoDB 存储引擎的方言，用于生成针对 MySQL 数据库的 SQL 查询和语句。</p>
</blockquote>
<blockquote>
<p><strong>4.创建实体类</strong>：创建与数据库表对应的实体类，并使用 JPA 注解来标记实体类和字段。例如，创建一个User实体类，代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">Entity</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">GeneratedValue</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">GenerationType</span>;
<span class="hljs-keyword">import</span> javax.<span class="hljs-property">persistence</span>.<span class="hljs-property">Id</span>;
 
<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(strategy = <span class="hljs-title class_">GenerationType</span>.<span class="hljs-property">IDENTITY</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> email;
 
    <span class="hljs-comment">// 生成getter和setter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Long</span> <span class="hljs-title function_">getId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> id;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setId</span>(<span class="hljs-params">Long id</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> name;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getEmail</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> email;
    }
 
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEmail</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> email</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个实体类中，@Entity注解表示该类是一个实体类，会被映射到数据库表；@Id注解标识id字段为主键；@GeneratedValue(strategy = GenerationType.IDENTITY)表示主键采用自增长策略，即数据库会自动为每条记录生成唯一的主键值。</p>
</blockquote>
<blockquote>
<p><strong>5.创建 Repository 接口</strong>：创建一个继承自JpaRepository的接口，Spring Data JPA 会根据接口方法名称自动实现数据访问逻辑。例如，创建UserRepository接口：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;
 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;User, Long&gt; {
    <span class="hljs-comment">// 可以添加自定义查询方法</span>
    User <span class="hljs-title function_">findByName</span><span class="hljs-params">(String name)</span>;
}
AI写代码TypeScript
运行
</code></pre>
<p>UserRepository接口继承自JpaRepository，其中User是实体类类型，Long是主键的类型。通过继承JpaRepository，我们可以直接使用它提供的一系列默认方法，如save（保存或更新实体）、findById（根据主键查找实体）、findAll（查找所有实体）等。同时，我们还可以在接口中定义自定义的查询方法，如findByName，Spring Data JPA 会根据方法名自动生成相应的 SQL 查询语句。</p>
</blockquote>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2 编写<a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%25E6%2595%25B0%25E6%258D%25AE%25E8%25AE%25BF%25E9%2597%25AE%25E5%25B1%2582%26spm%3D1001.2101.3001.7020" target="_blank" title="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82&amp;spm=1001.2101.3001.7020" ref="nofollow noopener noreferrer">数据访问层</a>代码</h4>
<blockquote>
<p>完成 Spring Data JPA 的集成后，就可以使用Repository接口进行数据访问操作了。Spring Data JPA 提供了丰富的方法来执行 CRUD（创建、读取、更新、删除）操作，同时还支持通过方法名定义查询、使用查询注解等方式进行复杂查询。以下是一些常见的数据访问层代码示例：</p>
</blockquote>
<blockquote>
<p><strong>1.保存数据</strong>：使用save方法可以保存或更新一个实体对象。如果实体对象的主键为空，save方法会执行插入操作；如果主键已存在，则执行更新操作。例如：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
 
    <span class="hljs-keyword">public</span> User saveUser(User user) {
        <span class="hljs-keyword">return</span> userRepository.save(user);
    }
}
AI写代码TypeScript
运行
</code></pre>
<p>在上述代码中，UserService类通过@Autowired注解注入了UserRepository实例，然后在saveUser方法中调用userRepository.save(user)方法将User对象保存到数据库中。如果保存成功，save方法会返回保存后的User对象。</p>
</blockquote>
<blockquote>
<p><strong>2.查询数据</strong>：</p>
<ul>
<li>
<p><strong>根据主键查询</strong>：使用findById方法可以根据主键查找实体对象。该方法返回一个Optional对象，通过isPresent方法可以判断是否找到对应的实体，通过get方法可以获取实体对象。例如：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> User getUserById(<span class="hljs-built_in">Long</span> id) {
    <span class="hljs-keyword">return</span> userRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
}
AI写代码TypeScript
运行
</code></pre>
<p>这里，userRepository.findById(id)返回一个Optional对象，如果Optional对象不为空，即找到了对应的用户，则通过orElse(null)方法返回该用户对象；如果Optional对象为空，即未找到对应的用户，则返回null。</p>
</li>
<li>
<p><strong>查询所有数据</strong>：使用findAll方法可以查询所有实体对象，返回一个Iterable集合。例如：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Iterable&lt;User&gt; <span class="hljs-title">getAllUsers</span>()</span> {
    <span class="hljs-keyword">return</span> userRepository.findAll();
}
AI写代码TypeScript
运行
</code></pre>
</li>
<li>
<p><strong>自定义方法查询</strong>：如前面在UserRepository接口中定义的findByName方法，可以根据用户名查询用户。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">findUserByName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
    <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">findByName</span>(name);
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>Spring Data JPA 会根据方法名findByName自动生成 SQL 查询语句，实现根据用户名查询用户的功能。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>3.更新数据</strong>：更新数据同样使用save方法，因为save方法会根据实体对象的主键来判断是执行插入还是更新操作。例如：</p>
<pre><code class="hljs language-sql" lang="sql">public <span class="hljs-keyword">User</span> updateUser(<span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span>) {
    <span class="hljs-keyword">return</span> userRepository.save(<span class="hljs-keyword">user</span>);
}
AI写代码TypeScript
运行
</code></pre>
<p>在调用updateUser方法时，传入的User对象的主键必须是已存在于数据库中的，这样save方法就会执行更新操作，将User对象的最新数据更新到数据库中。</p>
</blockquote>
<blockquote>
<p><strong>4.删除数据</strong>：使用deleteById方法可以根据主键删除实体对象，使用delete方法可以删除一个实体对象，使用deleteAll方法可以删除所有实体对象。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteUserById</span>(<span class="hljs-params">Long id</span>) {
    userRepository.<span class="hljs-title function_">deleteById</span>(id);
}
 
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">User user</span>) {
    userRepository.<span class="hljs-title function_">delete</span>(user);
}
 
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteAllUsers</span>(<span class="hljs-params"/>) {
    userRepository.<span class="hljs-title function_">deleteAll</span>();
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>上述代码分别展示了根据主键删除用户、删除指定用户对象和删除所有用户的方法。在实际应用中，应根据具体需求选择合适的删除方法。</p>
</blockquote>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.3 事务管理</h4>
<blockquote>
<p>事务管理是保证数据完整性和一致性的重要机制，它确保一组数据库操作要么全部成功执行，要么全部失败回滚。在 Spring Boot 中，使用事务非常简单，通过@Transactional注解就可以轻松实现事务管理。</p>
</blockquote>
<blockquote>
<p><strong>1.事务管理的概念</strong>：事务是一个不可分割的工作单元，它包含多个数据库操作，这些操作要么全部成功提交，使数据持久化到数据库中；要么全部失败回滚，撤销之前的所有操作，保证数据的一致性。例如，在一个银行转账的业务场景中，涉及到从转出账户扣除金额和向转入账户增加金额两个操作，这两个操作必须作为一个事务来处理，否则可能会出现转出账户金额已扣除，但转入账户金额未增加的情况，导致数据不一致。事务具有 ACID 特性：</p>
<ul>
<li><strong>原子性（Atomicity）</strong> ：事务中的所有操作要么全部完成，要么全部不完成，不会出现部分成功部分失败的情况。</li>
<li><strong>一致性（Consistency）</strong> ：事务执行前后，数据库的完整性约束不会被破坏，数据的状态保持一致。</li>
<li><strong>隔离性（Isolation）</strong> ：多个事务并发执行时，一个事务的执行不能被其他事务干扰，每个事务都感觉不到其他事务的存在。</li>
<li><strong>持久性（Durability）</strong> ：一旦事务提交成功，其对数据库的修改将永久保存，即使系统出现故障也不会丢失。</li>
</ul>
</blockquote>
<blockquote>
<p><strong>2.在 Spring Boot 中使用事务</strong>：在 Spring Boot 中，使用事务主要通过@Transactional注解来实现。@Transactional注解可以作用在类或方法上：</p>
<ul>
<li>
<p><strong>作用在类上</strong>：当@Transactional注解作用在类上时，表示该类中的所有公共方法都将被事务管理。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">transaction</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Transactional</span>;
 
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-comment">// 类中的所有公共方法都被事务管理</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">someBusinessMethod</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑代码</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在上述代码中，UserService类上添加了@Transactional注解，因此该类中的someBusinessMethod方法会被事务管理。如果在someBusinessMethod方法中执行多个数据库操作，这些操作将被视为一个事务，要么全部成功提交，要么全部失败回滚。</p>
</li>
<li>
<p><strong>作用在方法上</strong>：当@Transactional注解作用在方法上时，仅该方法会被事务管理。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">transaction</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Transactional</span>;
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">specificBusinessMethod</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑代码</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个例子中，只有specificBusinessMethod方法被事务管理，而UserService类中的其他方法不会受到事务的影响。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>3.事务的传播行为</strong>：事务的传播行为定义了一个事务方法被另一个事务方法调用时，事务应该如何管理。Spring Boot 支持多种事务传播行为，常见的有以下几种：</p>
<ul>
<li><strong>REQUIRED（默认）</strong> ：如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。例如：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ServiceB</span> serviceB;
 
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        serviceB.<span class="hljs-title function_">methodB</span>();
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在上述代码中，ServiceA的methodA方法和ServiceB的methodB方法都被标记为@Transactional。当methodA调用methodB时，由于methodA已经在一个事务中，methodB会加入到methodA的事务中，它们共享同一个事务。</p>
<ul>
<li>
<p><strong>REQUIRES_NEW</strong>：无论当前是否存在事务，都创建一个新的事务。如果当前存在事务，则将当前事务挂起，直到新事务完成。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ServiceB</span> serviceB;
 
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        serviceB.<span class="hljs-title function_">methodB</span>();
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {
    <span class="hljs-meta">@Transactional</span>(propagation = <span class="hljs-title class_">Propagation</span>.<span class="hljs-property">REQUIRES_NEW</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>这里，ServiceB的methodB方法使用了REQUIRES_NEW传播行为。当methodA调用methodB时，methodB会创建一个新的事务，并且将methodA的事务挂起，直到methodB的事务完成。这样，methodA和methodB的事务是相互独立的，互不影响。</p>
</li>
<li>
<p><strong>NESTED</strong>：如果当前存在事务，则在当前事务中创建一个嵌套事务；如果当前没有事务，则创建一个新的事务。嵌套事务可以有自己的回滚点，当嵌套事务回滚时，不会影响外层事务的提交。例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceA</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ServiceB</span> serviceB;
 
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodA</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 业务逻辑</span>
            serviceB.<span class="hljs-title function_">methodB</span>();
            <span class="hljs-comment">// 业务逻辑</span>
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 捕获异常并处理，不会影响外层事务的提交</span>
        }
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceB</span> {
    <span class="hljs-meta">@Transactional</span>(propagation = <span class="hljs-title class_">Propagation</span>.<span class="hljs-property">NESTED</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">methodB</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"模拟异常"</span>);
    }
}
<span class="hljs-variable constant_">AI</span>写代码<span class="hljs-title class_">TypeScript</span>
运行
</code></pre>
<p>在这个例子中，ServiceB的methodB方法使用了NESTED传播行为。当methodA调用methodB时，methodB会在methodA的事务中创建一个嵌套事务。如果methodB中抛出异常，嵌套事务会回滚，但methodA的事务不会回滚，除非methodA中也抛出未处理的异常。</p>
</li>
</ul>
</blockquote>
<blockquote>
<p><strong>4.事务的隔离级别</strong>：事务隔离级别定义了一个事务对其他事务的可见性和数据一致性的保证程度。Spring Boot 支持多种事务隔离级别，常见的有以下几种：</p>
<ul>
<li><strong>READ_UNCOMMITTED</strong>：读取未提交的数据。这是最低的隔离级别，一个事务可以读取到其他事务尚未提交的数据，可能会导致脏读、不可重复读和幻读等问题。</li>
<li><strong>READ_COMMITTED</strong>：读取已提交的数据。一个事务只能读取到其他事务已经提交的数据，可以避免脏读，但仍可能出现不可重复读和幻读问题。</li>
<li><strong>REPEATABLE_READ</strong>：可重复读。在一个事务内多次读取同一数据时，得到的结果是一致的，即使其他事务对该数据进行了修改并提交，也不会影响当前事务的读取结果，可以避免脏读和不可重复读，但仍可能出现幻读问题。</li>
<li><strong>SERIALIZABLE</strong>：串行化。这是最高的隔离级别，事务串行执行，避免了脏读、不可重复读和幻读等所有并发问题，但会严重影响系统的并发性能。</li>
</ul>
<p>在 Spring Boot 中，可以通过@Transactional注解的isolation属性来指定事务的隔离级别。例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Transactional(isolation = Isolation.REPEATABLE_READ)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">someBusinessMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}
AI写代码TypeScript
运行
</code></pre>
<p>上述代码中，someBusinessMethod方法的事务隔离级别被设置为REPEATABLE_READ，</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上线卡半夜、出 bug 只能硬扛？前端自动化部署 + 秒级回滚方案来了]]></title>    <link>https://juejin.cn/post/7591207451778498586</link>    <guid>https://juejin.cn/post/7591207451778498586</guid>    <pubDate>2026-01-04T07:35:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591207451778498586" data-draft-id="7591243363082043430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上线卡半夜、出 bug 只能硬扛？前端自动化部署 + 秒级回滚方案来了"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-04T07:35:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaEdge在掘金"/> <meta itemprop="url" content="https://juejin.cn/user/26044012176424"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上线卡半夜、出 bug 只能硬扛？前端自动化部署 + 秒级回滚方案来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044012176424/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaEdge在掘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T07:35:11.000Z" title="Sun Jan 04 2026 07:35:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文已收录在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJava-Edge%2FJava-Interview-Tutorial" target="_blank" title="https://github.com/Java-Edge/Java-Interview-Tutorial" ref="nofollow noopener noreferrer">Github</a>，<strong>关注我，紧跟本系列专栏文章，咱们下篇再续！</strong></p>
<ul>
<li>🚀 魔都架构师 | 全网30W技术追随者</li>
<li>🔧 大厂分布式系统/数据中台实战专家</li>
<li>🏆 主导交易系统百万级流量调优 &amp; 车联网平台架构</li>
<li>🧠 AIGC应用开发先行者 | 区块链落地实践者</li>
<li>🌍 以技术驱动创新，我们的征途是改变世界！</li>
<li>👉 实战干货：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.javaedge.cn%2F" target="_blank" title="http://www.javaedge.cn/" ref="nofollow noopener noreferrer">编程严选网</a></li>
</ul>
<h2 data-id="heading-0">0 前言</h2>
<p>项目上线前最后一步，把开发好的代码部署到线上。</p>
<p>“npm run build不就行”。这只是在本地把代码打包，想在线上也可访问这些代码，还需部署。所以在下面，如今的前端代码部署时的难点在哪呢？</p>
<h2 data-id="heading-1">1 部署难点</h2>
<h3 data-id="heading-2">jQuery时代之前</h3>
<p>前端项目中所有内容都是一些简单的静态资源。网站还没部署的概念，网站上线前，直接把开发完的项目打包发给运维，再由运维把代码直接上传到服务器的网站根目录下解压缩，完成项目部署。</p>
<h3 data-id="heading-3">jQuery时代</h3>
<p>项目的入口页面被后端管理，模板部署到后端，CSS、js和图片等静态资源依然是打包到后端之后，再解压处理。但现在，对前端的性能和稳定性的要求也越来越高，jQuery时代那种简单部署模式不足以应对性能优化、持续部署。</p>
<h3 data-id="heading-4">当下主要面临的代码部署难点</h3>
<ul>
<li>咋高效地利用项目中的文件缓存</li>
<li>咋能让整个项目的上线部署过程自动化，尽可能避免人力的介入，提高上线稳定性</li>
<li>项目上线之后，如果发现有重大Bug，要考虑咋尽快回滚代码</li>
</ul>
<p>当我们面对这些代码部署上的难点，特别是在团队协作的项目中遇到时，我们就可以考虑对项目进行自动化部署了，这样代码部署的速度和稳定性会给项目研发效率带来很好的提升。</p>
<h2 data-id="heading-5">2 上线前的自动化部署</h2>
<p>如下是大部分团队部署项目时的逻辑：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[开发代码] --&gt;|打包压缩| B[打包代码]
    B --&gt;|上传| C[服务器]
    
    style A fill:#90EE90
    style B fill:#90EE90
    style C fill:#87CEEB
</code></pre>
<p>完成打包压缩，即开发完项目后，代码推送到GitHub，就算完成任务。但打包代码后，把代码上传服务器也是这步，对于前端开发者，很少能接触，但却很重要。</p>
<p>咋把打包好的代码上传服务器，需好的解决方案。</p>
<ul>
<li>先需一台独立机器进行打包和构建，该机器需独立于所有开发环境，为保证打包环境稳定</li>
<li>部署任务启动的时候，需拉取远程代码，并切换到需部署的分支，然后锁定Node版本进行依赖安装、单元测试、ESLint等代码检查工作</li>
<li>最后，在这台机器，执行经过编译产出的打包后的代码，并打包上传代码到CDN和静态服务器</li>
<li>完成这些操作后，还要能通过脚本自动通过内部沟通软件通知团队项目构建的结果</li>
</ul>
<p>项目部署过程可能遇到如下</p>
<h3 data-id="heading-6">问题</h3>
<ul>
<li>在什么os环境中执行项目的构建？</li>
<li>由谁触发构建？</li>
<li>咋管理前面所述的把代码上传CDN时，CDN账户的权限？</li>
<li>咋自动化执行部署的全过程，若每次都由人工执行，就得消耗一个人力守着编译打包，且易引发问题，如测试的步骤遗漏或部署顺序出错。咋提升构建速率，是部署功能中需解决的重要问题。</li>
</ul>
<h3 data-id="heading-7">解决方案</h3>
<p>如采用能保证环境一致性的Docker；自动化构建触发可通过GitHub Actions；GitHub的actions功能相当于给我们提供了一个免费的服务器，可以很方便地监控代码的推送、安装依赖、代码编译自动上传到服务器。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[开发代码] --&gt;|推送代码| B[Github]
    B --&gt; C[环境依赖 / 自动化测试 / 代码打包 / 通知]
    C --&gt; D[打包后代码]
    D --&gt;|html| E[服务器]
    D --&gt;|静态资源| F[CDN]
    
    style A fill:#90EE90
    style B fill:#90EE90
    style C fill:#90EE90
    style D fill:#90EE90
    style E fill:#87CEEB
    style F fill:#87CEEB
</code></pre>
<p>这是用GitHub Actions部署项目后的项目开发流程。现在静态资源管理已完成，也实现自动化部署。提交代码后，项目就可自动推送到服务器，网站第一次上线成功。</p>
<h2 data-id="heading-8">3 上线后的自动化部署</h2>
<p>后续的持续上线咋办？直接发到生产环境，面临极大风险。但不直接发布到生产环境，我们就不能在本地和测试的前端环境去连接生产环境的数据库。</p>
<p>需预发布的（Pre）环境，只能让测试和开发访问，除了访问地址的环节不同，其他所有环节都和生产环境一致，提供最真实的回归测试环境。</p>
<p>又面临</p>
<h3 data-id="heading-9">3.1 问题</h3>
<p>若确定下周一零点发布，就只能晚上12点准时守在电脑前等结果？若npm安装依赖失败或上线后发现重大Bug，就只能迎投诉？</p>
<p>随node_modules体积越来越大，构建时间越来越长。若每次构建都需30min甚至更长，即使Bug在项目刚上线时就发现，且秒级响应修复，但重新部署项目时，也要等服务器慢慢编译。时间就是金钱，若你在修复Bug和重新部署项目上耗时长，就导致项目故障时间过长。</p>
<h3 data-id="heading-10">解决方案</h3>
<p>需一种机制，让我们发现问题后，尽快回滚版本，且在回滚过程，尽可能无需人力介入。所以，需静态资源的版本管理，即让每个历史版本的资源都保留，且有唯一版本号，如故障，能瞬间切换版本。这个过程由具体代码实现后，只需点击回滚的版本号，系统就自动恢复到上线前版本。</p>
<p>该机制下，如业务流量特大，那直接全量上线的操作就会被禁止。为减少上线时，部署操作对用户的影响，需先选择一部分用户做灰度测试，即上线后的项目的访问权限，暂时只对这些用户开放。或做AB测试，如给北京的同学推送Vue课，给上海推荐React课等。我们要做的，是把不同版本代码分开打包，互不干涉。之后，再设计部署的机器和机房去适配不同用户。</p>
<p>Gtihub中可用actions配置打包功能，下面的代码是actions的配置文件。Ubuntu作服务器的打包环境，拉取GitHub最新master代码，并把Node版本固定14.7.6，执行npm install后，再执行npm run build代码打包压缩。</p>
<p>通过GitHub Actions自动化打包一份准备上线的代码：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">打包应用的actions</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span> <span class="hljs-comment"># 监听代码时间</span>
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">master</span>  <span class="hljs-comment"># master分支代码推送的时候激活当前action</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-comment"># runs-on 操作系统</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">迁出代码</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@master</span>
      <span class="hljs-comment"># 安装Node</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装Node</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v1</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">14.7</span><span class="hljs-number">.6</span>
      <span class="hljs-comment"># 安装依赖</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装依赖</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span>
      <span class="hljs-comment"># 打包</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">打包</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
</code></pre>
<p>然后配置上线服务器和GitHub Actions服务器的信任关系，通过SSH密钥可实现免登录直接部署。直接把build后的代码打包压缩，通过SSH直接上传到服务器，并且要进行代码文件版本的管理，就完成代码部署。</p>
<p>部署成功后的结果通知。钉钉、飞书都提供推送结果，可随时通过群机器人接口把消息推送到群内，把版本号、部署日期、发起人等信息推送到对应接口，就完成自动化部署。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 雪花ID实现方案]]></title>    <link>https://juejin.cn/post/7591104893391847478</link>    <guid>https://juejin.cn/post/7591104893391847478</guid>    <pubDate>2026-01-04T08:36:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591104893391847478" data-draft-id="7591129807755444287" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 雪花ID实现方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T08:36:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东百牧码人"/> <meta itemprop="url" content="https://juejin.cn/user/1345457965762301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 雪花ID实现方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457965762301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东百牧码人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:36:55.000Z" title="Sun Jan 04 2026 08:36:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你希望在.NET中实现一个完整、线程安全且能处理时钟回拨问题的雪花ID（Snowflake）算法，用于分库分表场景下生成全局唯一的分布式ID，避免不同库/表的主键重复。</p>
<p>雪花ID是Twitter开源的分布式ID生成算法，核心是将64位长整型ID按规则拆分，保证全局唯一且趋势递增。下面先讲解核心结构，再给出可直接使用的.NET实现代码。</p>
<hr/>
<h2 data-id="heading-0">一、雪花ID核心结构（64位long型）</h2>






























<table><thead><tr><th>位段</th><th>长度</th><th>作用</th></tr></thead><tbody><tr><td>符号位</td><td>1位</td><td>固定为0（保证ID为正数）</td></tr><tr><td>时间戳位</td><td>41位</td><td>记录生成ID的毫秒级时间戳（相对于一个起始时间），可支持约69年（2^41-1）</td></tr><tr><td>机器/节点位</td><td>10位</td><td>分为5位数据中心ID + 5位机器ID，最多支持1024个节点部署</td></tr><tr><td>序列号位</td><td>12位</td><td>同一毫秒内的自增序列，每毫秒最多生成4096个ID（2^12=4096）</td></tr></tbody></table>
<h2 data-id="heading-1">二、.NET实现雪花ID生成器</h2>
<p>以下实现包含<strong>线程安全</strong>、<strong>时钟回拨检测</strong>、<strong>参数合法性校验</strong>，可直接在生产环境使用：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> 雪花ID生成器（线程安全、支持时钟回拨检测）</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SnowflakeIdGenerator</span>
{
    <span class="hljs-meta">#<span class="hljs-keyword">region</span> 常量定义</span>
    <span class="hljs-comment">// 起始时间戳（UTC时间：2024-01-01 00:00:00），可自行调整，建议使用项目上线前的时间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> Epoch = <span class="hljs-number">1704067200000L</span>;

    <span class="hljs-comment">// 各部分的位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> TimestampBits = <span class="hljs-number">41</span>; <span class="hljs-comment">// 时间戳位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> DataCenterIdBits = <span class="hljs-number">5</span>; <span class="hljs-comment">// 数据中心ID位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> MachineIdBits = <span class="hljs-number">5</span>; <span class="hljs-comment">// 机器ID位长度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> SequenceBits = <span class="hljs-number">12</span>; <span class="hljs-comment">// 序列号位长度</span>

    <span class="hljs-comment">// 最大值（位运算计算）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> MaxDataCenterId = (<span class="hljs-number">1L</span> &lt;&lt; DataCenterIdBits) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 31</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> MaxMachineId = (<span class="hljs-number">1L</span> &lt;&lt; MachineIdBits) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 31</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> MaxSequence = (<span class="hljs-number">1L</span> &lt;&lt; SequenceBits) - <span class="hljs-number">1</span>; <span class="hljs-comment">// 4095</span>

    <span class="hljs-comment">// 位移量</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> MachineIdShift = SequenceBits; <span class="hljs-comment">// 12</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> DataCenterIdShift = SequenceBits + MachineIdBits; <span class="hljs-comment">// 17</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> TimestampShift = SequenceBits + MachineIdBits + DataCenterIdBits; <span class="hljs-comment">// 22</span>
    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span>

    <span class="hljs-meta">#<span class="hljs-keyword">region</span> 私有字段</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">long</span> _dataCenterId; <span class="hljs-comment">// 数据中心ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">long</span> _machineId; <span class="hljs-comment">// 机器ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">long</span> _lastTimestamp = <span class="hljs-number">-1L</span>; <span class="hljs-comment">// 上一次生成ID的时间戳</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">long</span> _sequence = <span class="hljs-number">0L</span>; <span class="hljs-comment">// 当前毫秒内的序列号</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _lockObj = <span class="hljs-keyword">new</span>(); <span class="hljs-comment">// 锁对象（保证线程安全）</span>
    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span>

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 构造函数</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="dataCenterId"&gt;</span>数据中心ID（0-31）<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="machineId"&gt;</span>机器ID（0-31）<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;exception cref="ArgumentException"&gt;</span>参数超出范围时抛出<span class="hljs-doctag">&lt;/exception&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SnowflakeIdGenerator</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> dataCenterId, <span class="hljs-built_in">long</span> machineId</span>)</span>
    {
        <span class="hljs-comment">// 校验参数合法性</span>
        <span class="hljs-keyword">if</span> (dataCenterId &lt; <span class="hljs-number">0</span> || dataCenterId &gt; MaxDataCenterId)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">$"数据中心ID必须在0-<span class="hljs-subst">{MaxDataCenterId}</span>之间"</span>, <span class="hljs-keyword">nameof</span>(dataCenterId));
        }
        <span class="hljs-keyword">if</span> (machineId &lt; <span class="hljs-number">0</span> || machineId &gt; MaxMachineId)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">$"机器ID必须在0-<span class="hljs-subst">{MaxMachineId}</span>之间"</span>, <span class="hljs-keyword">nameof</span>(machineId));
        }

        _dataCenterId = dataCenterId;
        _machineId = machineId;
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成下一个雪花ID</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>全局唯一的雪花ID<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;exception cref="Exception"&gt;</span>时钟回拨超出容忍范围时抛出<span class="hljs-doctag">&lt;/exception&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> <span class="hljs-title">NextId</span>()</span>
    {
        <span class="hljs-keyword">lock</span> (_lockObj) <span class="hljs-comment">// 加锁保证多线程安全</span>
        {
            <span class="hljs-comment">// 1. 获取当前时间戳（毫秒）</span>
            <span class="hljs-built_in">long</span> currentTimestamp = GetCurrentTimestamp();

            <span class="hljs-comment">// 2. 处理时钟回拨问题</span>
            <span class="hljs-keyword">if</span> (currentTimestamp &lt; _lastTimestamp)
            {
                <span class="hljs-built_in">long</span> timeDiff = _lastTimestamp - currentTimestamp;
                <span class="hljs-comment">// 容忍500ms内的时钟回拨（等待直到时间追上）</span>
                <span class="hljs-keyword">if</span> (timeDiff &lt;= <span class="hljs-number">500</span>)
                {
                    <span class="hljs-comment">// 自旋等待，直到时间戳追上上次的时间戳</span>
                    <span class="hljs-keyword">while</span> (currentTimestamp &lt; _lastTimestamp)
                    {
                        currentTimestamp = GetCurrentTimestamp();
                    }
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-comment">// 超出容忍范围，抛出异常（避免ID重复）</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">$"时钟回拨异常！当前时间戳：<span class="hljs-subst">{currentTimestamp}</span>，上次时间戳：<span class="hljs-subst">{_lastTimestamp}</span>，差值：<span class="hljs-subst">{timeDiff}</span>ms"</span>);
                }
            }

            <span class="hljs-comment">// 3. 处理同一毫秒内的序列号</span>
            <span class="hljs-keyword">if</span> (currentTimestamp == _lastTimestamp)
            {
                <span class="hljs-comment">// 序列号自增，超过最大值则等待下一毫秒</span>
                _sequence = (_sequence + <span class="hljs-number">1</span>) &amp; MaxSequence;
                <span class="hljs-keyword">if</span> (_sequence == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-comment">// 自旋等待下一毫秒</span>
                    <span class="hljs-keyword">while</span> (currentTimestamp &lt;= _lastTimestamp)
                    {
                        currentTimestamp = GetCurrentTimestamp();
                    }
                }
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-comment">// 新的毫秒，序列号重置为0</span>
                _sequence = <span class="hljs-number">0</span>;
            }

            <span class="hljs-comment">// 4. 更新上次时间戳</span>
            _lastTimestamp = currentTimestamp;

            <span class="hljs-comment">// 5. 拼接各部分生成最终ID</span>
            <span class="hljs-keyword">return</span> ((currentTimestamp - Epoch) &lt;&lt; TimestampShift) <span class="hljs-comment">// 时间戳部分</span>
                   | (_dataCenterId &lt;&lt; DataCenterIdShift) <span class="hljs-comment">// 数据中心ID部分</span>
                   | (_machineId &lt;&lt; MachineIdShift) <span class="hljs-comment">// 机器ID部分</span>
                   | _sequence; <span class="hljs-comment">// 序列号部分</span>
        }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 获取当前UTC时间戳（毫秒）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>毫秒级时间戳<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">long</span> <span class="hljs-title">GetCurrentTimestamp</span>()</span>
    {
        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">long</span>)(DateTime.UtcNow - <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">1970</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Utc)).TotalMilliseconds;
    }

    <span class="hljs-meta">#<span class="hljs-keyword">region</span> 便捷方法（可选）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成雪花ID的字符串形式</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>ID字符串<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">NextIdString</span>()</span>
    {
        <span class="hljs-keyword">return</span> NextId().ToString();
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 解析雪花ID，返回各部分信息（用于调试）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="id"&gt;</span>雪花ID<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>解析后的信息<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-keyword">public</span> (DateTime GenerateTime, <span class="hljs-built_in">long</span> DataCenterId, <span class="hljs-built_in">long</span> MachineId, <span class="hljs-built_in">long</span> Sequence) ParseId(<span class="hljs-built_in">long</span> id)
    {
        <span class="hljs-built_in">long</span> timestamp = (id &gt;&gt; TimestampShift) + Epoch;
        DateTime generateTime = <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">1970</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTimeKind.Utc).AddMilliseconds(timestamp);
        <span class="hljs-built_in">long</span> dataCenterId = (id &gt;&gt; DataCenterIdShift) &amp; MaxDataCenterId;
        <span class="hljs-built_in">long</span> machineId = (id &gt;&gt; MachineIdShift) &amp; MaxMachineId;
        <span class="hljs-built_in">long</span> sequence = id &amp; MaxSequence;

        <span class="hljs-keyword">return</span> (generateTime.ToLocalTime(), dataCenterId, machineId, sequence);
    }
    <span class="hljs-meta">#<span class="hljs-keyword">endregion</span></span>
}

</code></pre>
<h2 data-id="heading-2">三、使用示例</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 初始化生成器（数据中心ID=1，机器ID=1，根据实际部署环境调整）</span>
        <span class="hljs-keyword">var</span> idGenerator = <span class="hljs-keyword">new</span> SnowflakeIdGenerator(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// 单线程生成ID</span>
        <span class="hljs-built_in">long</span> id1 = idGenerator.NextId();
        Console.WriteLine(<span class="hljs-string">$"生成的雪花ID：<span class="hljs-subst">{id1}</span>"</span>);

        <span class="hljs-comment">// 解析ID（调试用）</span>
        <span class="hljs-keyword">var</span> parseResult = idGenerator.ParseId(id1);
        Console.WriteLine(<span class="hljs-string">$"生成时间：<span class="hljs-subst">{parseResult.GenerateTime}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"数据中心ID：<span class="hljs-subst">{parseResult.DataCenterId}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"机器ID：<span class="hljs-subst">{parseResult.MachineId}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"序列号：<span class="hljs-subst">{parseResult.Sequence}</span>"</span>);

        <span class="hljs-comment">// 多线程测试（验证线程安全）</span>
        Parallel.For(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>, i =&gt;
        {
            <span class="hljs-built_in">long</span> id = idGenerator.NextId();
            Console.WriteLine(<span class="hljs-string">$"线程<span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span>生成ID：<span class="hljs-subst">{id}</span>"</span>);
        });
    }
}

</code></pre>
<h2 data-id="heading-3">四、关键说明</h2>
<ol>
<li><strong>起始时间戳（Epoch）</strong>：建议设置为项目上线前的时间（如示例中的2024-01-01），可延长ID使用周期（默认能用到2093年）。</li>
<li><strong>机器/数据中心ID</strong>：部署时需保证每个节点的（数据中心ID+机器ID）唯一（比如通过配置文件/环境变量设置），避免不同节点生成重复ID。</li>
<li><strong>时钟回拨处理</strong>：代码中容忍500ms内的时钟回拨（自旋等待），超出则抛异常，可根据业务调整容忍阈值。</li>
<li><strong>性能</strong>：单节点每秒可生成约400万+ ID（1ms生成4096个，1秒=1000ms → 4096*1000=4,096,000），满足绝大多数业务场景。</li>
</ol>
<hr/>
<h3 data-id="heading-4">总结</h3>
<ol>
<li>雪花ID核心是通过<strong>位运算</strong>将时间戳、机器ID、序列号拼接成64位唯一ID，保证全局唯一且趋势递增；</li>
<li>实现时必须保证<strong>线程安全</strong>（加锁）和<strong>时钟回拨检测</strong>（避免ID重复）；</li>
<li>使用时需保证每个节点的机器/数据中心ID唯一，起始时间戳建议根据项目实际调整。</li>
</ol>
<p>这个实现可直接集成到你的.NET分库分表项目中，作为分布式主键生成方案。</p>
<blockquote>
<p>本文使用 <a href="https://juejin.cn/post/6940875049587097631" target="_blank" title="https://juejin.cn/post/6940875049587097631">文章同步助手</a> 同步</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[javascript 为什么会有闭包这么个烧脑的东西]]></title>    <link>https://juejin.cn/post/7591129807755149375</link>    <guid>https://juejin.cn/post/7591129807755149375</guid>    <pubDate>2026-01-04T08:08:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591129807755149375" data-draft-id="7591129807755083839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="javascript 为什么会有闭包这么个烧脑的东西"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-04T08:08:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="八哥程序员"/> <meta itemprop="url" content="https://juejin.cn/user/114004940297325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            javascript 为什么会有闭包这么个烧脑的东西
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/114004940297325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    八哥程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:08:54.000Z" title="Sun Jan 04 2026 08:08:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>前端面试中，无论是面试初级、中级、或者是级高级，闭包（closure）是个永远绕不过的话题，下面我们一起来探讨下闭包</p>
<p>闭包（Closure）是JavaScript中最强大、最常用但也最容易被误解的概念之一。它是JavaScript函数式编程的核心，也是许多 <strong>高级特性</strong> 和 <strong>设计模式</strong> 的基础。理解闭包不仅能帮助你编写更优雅、更高效的代码，还能让你深入理解JavaScript的执行机制。</p>
<p>闭包不是JavaScript刻意"设计"的特性，而是函数作为一等公民、词法作用域、函数可以嵌套这些语言特性自然产生的结果。它成为了JavaScript最强大和最常用的特性之一。</p>
<h2 data-id="heading-1">一、闭包的定义与基本概念</h2>
<h3 data-id="heading-2">什么是闭包？</h3>
<p>在JavaScript中，<strong>闭包是指有权访问另一个函数作用域中变量的函数</strong>。简单来说，闭包就是一个函数，它能够记住并访问其定义时所在的词法作用域，即使该函数在其词法作用域之外被执行。</p>
<p>让我们通过一个简单的例子来理解闭包：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> message = <span class="hljs-string">'Hello, Closure!'</span>;  <span class="hljs-comment">// outer函数的局部变量</span>
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {                 <span class="hljs-comment">// inner函数定义在outer函数内部</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);          <span class="hljs-comment">// inner函数访问了outer函数的局部变量</span>
    }
    
    <span class="hljs-keyword">return</span> inner;                      <span class="hljs-comment">// outer函数返回inner函数</span>
}

<span class="hljs-keyword">const</span> closure = <span class="hljs-title function_">outer</span>();  <span class="hljs-comment">// 调用outer函数，返回inner函数并赋值给closure</span>
<span class="hljs-title function_">closure</span>();               <span class="hljs-comment">// 执行closure，输出：Hello, Closure!</span>
</code></pre>
<p>在这个例子中：</p>
<ul>
<li><code>inner</code>函数定义在<code>outer</code>函数内部，能够访问<code>outer</code>函数的局部变量<code>message</code></li>
<li><code>outer</code>函数返回了<code>inner</code>函数，使其在<code>outer</code>函数执行完毕后仍然可以被调用</li>
<li>当调用<code>closure()</code>时，虽然<code>outer</code>函数的执行上下文已经被销毁，但<code>inner</code>函数仍然能够访问到<code>message</code>变量</li>
</ul>
<p>这就是闭包的基本特性：<strong>函数能够记住并访问其定义时所在的作用域，即使函数在作用域外部执行</strong>。</p>
<h3 data-id="heading-3">闭包的构成条件</h3>
<p>要形成闭包，必须满足以下三个条件：</p>
<ol>
<li><strong>嵌套函数结构</strong>：存在函数嵌套，即一个函数定义在另一个函数内部</li>
<li><strong>内部函数访问外部函数的变量</strong>：内部函数引用了外部函数的变量或参数</li>
<li><strong>外部函数返回内部函数</strong>：外部函数将内部函数作为返回值，使得内部函数可以在外部函数作用域之外执行</li>
</ol>
<h2 data-id="heading-4">二、闭包的工作原理</h2>
<p>要深入理解闭包的工作原理，我们需要先了解JavaScript的<strong>词法作用域</strong>和<strong>执行上下文</strong>。纤细的解说可以参看我之前的2篇文章：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu011286604%3Fspm%3D1011.2415.3001.5343" target="_blank" title="https://blog.csdn.net/u011286604?spm=1011.2415.3001.5343" ref="nofollow noopener noreferrer">你真的搞懂了javascript 中的作用域、作用域链了吗？</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu011286604%2Farticle%2Fdetails%2F155537012%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/u011286604/article/details/155537012?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">你真的搞懂了javascript 中的执行上下文了吗？</a></p>
<h3 data-id="heading-5">1. 词法作用域</h3>
<p>词法作用域（Lexical Scope）是指函数的作用域由其在代码中定义的位置决定，而不是由函数被调用的位置决定。JavaScript采用词法作用域，这是闭包能够工作的基础。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> globalVar = <span class="hljs-string">'global'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> outerVar = <span class="hljs-string">'outer'</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> innerVar = <span class="hljs-string">'inner'</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);  <span class="hljs-comment">// 可以访问全局变量</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outerVar);   <span class="hljs-comment">// 可以访问外部函数变量</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(innerVar);   <span class="hljs-comment">// 可以访问自己的变量</span>
    }
    
    <span class="hljs-keyword">return</span> inner;
}

<span class="hljs-keyword">const</span> closure = <span class="hljs-title function_">outer</span>();
<span class="hljs-title function_">closure</span>();
</code></pre>
<p>在词法作用域中，变量的查找顺序是：当前函数作用域 → 外部函数作用域 → 全局作用域。</p>
<h3 data-id="heading-6">2. 执行上下文与作用域链</h3>
<p>当函数执行时，JavaScript引擎会创建一个<strong>执行上下文</strong>（Execution Context），它包含了函数的执行环境，如变量、参数、this指向等。</p>
<p>每个执行上下文都有一个<strong>作用域链</strong>（Scope Chain），它是一个指向所有可访问作用域的链表。作用域链的前端是当前函数的作用域，然后是包含它的外部函数的作用域，依此类推，直到全局作用域。</p>
<h3 data-id="heading-7">3. 闭包的内存结构</h3>
<p>当外部函数执行完毕后，其执行上下文会被销毁，但由于内部函数仍然引用着外部函数的变量，这些变量不会被垃圾回收机制回收。这就是闭包能够记住其定义时所在作用域的原因。</p>
<p>下面是闭包的内存结构示意图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/193232f8a18d4d33a142158fe205c1f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWr5ZOl56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768118963&amp;x-signature=ArO2MLsveRZzCz%2FjwRVGbK6cXas%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-8">三、闭包的代码示例</h2>
<h3 data-id="heading-9">1. 基本闭包示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        count++;
        <span class="hljs-keyword">return</span> count;
    };
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">createCounter</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">counter</span>());  <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">counter</span>());  <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">counter</span>());  <span class="hljs-comment">// 3</span>
</code></pre>
<p>在这个例子中，<code>createCounter</code>函数返回一个闭包，该闭包能够记住并修改<code>count</code>变量。每次调用<code>counter()</code>时，<code>count</code>都会递增并返回新值。</p>
<h3 data-id="heading-10">2. 闭包实现数据私有</h3>
<p>闭包可以用来创建私有变量和方法，实现数据封装：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPerson</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">let</span> _age = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 私有变量</span>
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> name;
        },
        <span class="hljs-attr">getAge</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> _age;
        },
        <span class="hljs-attr">setAge</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">age</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> age === <span class="hljs-string">'number'</span> &amp;&amp; age &gt; <span class="hljs-number">0</span>) {
                _age = age;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    };
}

<span class="hljs-keyword">const</span> person = <span class="hljs-title function_">createPerson</span>(<span class="hljs-string">'张三'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">getName</span>());  <span class="hljs-comment">// 张三</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">getAge</span>());   <span class="hljs-comment">// 0</span>
person.<span class="hljs-title function_">setAge</span>(<span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">getAge</span>());   <span class="hljs-comment">// 25</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">_age</span>);       <span class="hljs-comment">// undefined (无法直接访问私有变量)</span>
</code></pre>
<p>在这个例子中，<code>_age</code>是一个私有变量，外部无法直接访问，只能通过返回对象的方法来操作。</p>
<h3 data-id="heading-11">3. 闭包与循环问题</h3>
<p>在早期的JavaScript中，闭包常与循环结合使用，导致一些意外的问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 问题代码</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);  <span class="hljs-comment">// 预期输出：0, 1, 2 实际输出：3, 3, 3</span>
    }, <span class="hljs-number">1000</span>);
}
</code></pre>
<p>这个问题的原因是<code>var</code>声明的变量没有块级作用域，循环结束后<code>i</code>的值为3，所有的闭包都引用同一个<code>i</code>变量。</p>
<p>解决方法有两种：使用IIFE（立即执行函数表达式）或使用<code>let</code>关键字：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法1：使用IIFE</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    (<span class="hljs-keyword">function</span>(<span class="hljs-params">j</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(j);  <span class="hljs-comment">// 输出：0, 1, 2</span>
        }, <span class="hljs-number">1000</span>);
    })(i);
}

<span class="hljs-comment">// 方法2：使用let</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);  <span class="hljs-comment">// 输出：0, 1, 2</span>
    }, <span class="hljs-number">1000</span>);
}
</code></pre>
<h3 data-id="heading-12">4. 函数柯里化</h3>
<p>闭包是实现函数柯里化（Currying）的基础：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">curryAdd</span>(<span class="hljs-params">x</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>) {
        <span class="hljs-keyword">return</span> x + y;
    };
}

<span class="hljs-keyword">const</span> add5 = <span class="hljs-title function_">curryAdd</span>(<span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add5</span>(<span class="hljs-number">3</span>));  <span class="hljs-comment">// 8</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add5</span>(<span class="hljs-number">10</span>)); <span class="hljs-comment">// 15</span>

<span class="hljs-keyword">const</span> add10 = <span class="hljs-title function_">curryAdd</span>(<span class="hljs-number">10</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add10</span>(<span class="hljs-number">3</span>));  <span class="hljs-comment">// 13</span>
</code></pre>
<p>函数柯里化将一个接受多个参数的函数转换为一系列接受单个参数的函数，提高了函数的复用性和灵活性。</p>
<h2 data-id="heading-13">四、闭包的实际应用场景</h2>
<h3 data-id="heading-14">1. 模块化开发</h3>
<p>闭包是实现模块化开发的核心技术之一，它可以创建独立的命名空间，避免全局变量污染：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模块化示例 - 计数器模块</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CounterModule</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 私有变量</span>
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
        count++;
    }
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
        count--;
    }
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCount</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> count;
    }
    
    <span class="hljs-comment">// 暴露公共API</span>
    <span class="hljs-keyword">return</span> {
        increment,
        decrement,
        getCount
    };
})();

<span class="hljs-title class_">CounterModule</span>.<span class="hljs-title function_">increment</span>();
<span class="hljs-title class_">CounterModule</span>.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">CounterModule</span>.<span class="hljs-title function_">getCount</span>());  <span class="hljs-comment">// 2</span>
<span class="hljs-title class_">CounterModule</span>.<span class="hljs-title function_">decrement</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">CounterModule</span>.<span class="hljs-title function_">getCount</span>());  <span class="hljs-comment">// 1</span>
</code></pre>
<h3 data-id="heading-15">2. 回调函数与事件处理</h3>
<p>在JavaScript中，回调函数和事件处理程序经常使用闭包：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) {
        <span class="hljs-title function_">fetch</span>(url)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, data))
            .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">callback</span>(error, <span class="hljs-literal">null</span>));
    };
}

<span class="hljs-keyword">const</span> fetchUser = <span class="hljs-title function_">fetchData</span>(<span class="hljs-string">'https://api.example.com/users/1'</span>);
<span class="hljs-title function_">fetchUser</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error, user</span>) {
    <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户数据失败:'</span>, error);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户数据:'</span>, user);
    }
});
</code></pre>
<h3 data-id="heading-16">3. 防抖与节流</h3>
<p>防抖（Debounce）和节流（Throttle）是优化性能的常用技术，它们都可以通过闭包来实现：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 防抖函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, delay</span>) {
    <span class="hljs-keyword">let</span> timeoutId;
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-built_in">clearTimeout</span>(timeoutId);
        timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
        }, delay);
    };
}

<span class="hljs-comment">// 节流函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">func, limit</span>) {
    <span class="hljs-keyword">let</span> inThrottle;
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">if</span> (!inThrottle) {
            func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            inThrottle = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                inThrottle = <span class="hljs-literal">false</span>;
            }, limit);
        }
    };
}
</code></pre>
<h2 data-id="heading-17">五、闭包的优缺点与注意事项</h2>
<h3 data-id="heading-18">优点</h3>
<ol>
<li><strong>数据封装与私有性</strong>：闭包可以创建私有变量和方法，实现数据封装</li>
<li><strong>状态保持</strong>：闭包可以在函数调用之间保持状态</li>
<li><strong>模块化开发</strong>：闭包是实现模块化的基础</li>
<li><strong>函数柯里化</strong>：闭包支持函数柯里化，提高函数灵活性</li>
</ol>
<h3 data-id="heading-19">缺点</h3>
<ol>
<li><strong>内存泄漏风险</strong>：闭包会引用外部函数的变量，导致这些变量无法被垃圾回收</li>
<li><strong>性能影响</strong>：闭包的创建和执行会有一定的性能开销</li>
<li><strong>调试困难</strong>：闭包的作用域链比较复杂，调试起来比较困难</li>
</ol>
<h3 data-id="heading-20">注意事项</h3>
<ol>
<li><strong>避免不必要的闭包</strong>：只在需要时使用闭包，避免过度使用</li>
<li><strong>及时释放内存</strong>：当不再需要闭包时，可以将其赋值为null，以便垃圾回收</li>
<li><strong>注意this指向</strong>：在闭包中使用this时要特别小心，避免指向错误</li>
<li><strong>避免循环引用</strong>：闭包可能导致循环引用，从而引发内存泄漏</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 避免内存泄漏的示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createClosure</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> largeData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 大量数据</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(largeData.<span class="hljs-property">length</span>);
    };
}

<span class="hljs-keyword">let</span> closure = <span class="hljs-title function_">createClosure</span>();
<span class="hljs-title function_">closure</span>();  <span class="hljs-comment">// 使用闭包</span>

<span class="hljs-comment">// 不再需要时释放内存</span>
closure = <span class="hljs-literal">null</span>;
</code></pre>
<h2 data-id="heading-21">六、总结</h2>
<p>闭包本质上是JavaScript 词法作用域 （Lexical Scope）和 函数作为一等公民 （First-class Citizens）特性的自然产物。</p>
<ul>
<li>词法作用域 ：函数的作用域由其在代码中定义的位置决定，而非调用位置</li>
<li>函数作为一等公民 ：函数可以被赋值给变量、作为参数传递、作为返回值返回
当这两个特性结合时，闭包就自然形成了：函数在离开其定义的词法作用域后，仍然能够访问该作用域中的变量。</li>
</ul>
<p>javaScript设计闭包并非偶然，而是语言特性、编程范式和实际需求共同作用的结果。闭包使得JavaScript能够：</p>
<ul>
<li>支持函数式编程</li>
<li>实现数据封装与私有化</li>
<li>保持函数状态</li>
<li>构建模块化系统</li>
<li>更好地适应浏览器环境的事件驱动编程模型</li>
</ul>
<p>闭包是JavaScript最强大、最具特色的特性之一，理解它的设计初衷有助于我们更好地利用这一特性编写高质量的代码。</p>
<p>最后，记住这句话：<strong>闭包不是bug，而是JavaScript的特性。正确使用闭包，它会成为你的强大工具</strong>。</p>
<h2 data-id="heading-22">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FGuide%2FClosures" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Closures" ref="nofollow noopener noreferrer">MDN Web Docs: Closures</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F35175321%2F" target="_blank" title="https://book.douban.com/subject/35175321/" ref="nofollow noopener noreferrer">JavaScript高级程序设计（第4版）</a></li>
</ul>
<hr/>
<p>如果本文对你有所帮助，欢迎点赞、评论和分享！如有任何问题或建议，也请随时提出。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[移动web开发常见问题]]></title>    <link>https://juejin.cn/post/7591075684065329167</link>    <guid>https://juejin.cn/post/7591075684065329167</guid>    <pubDate>2026-01-04T08:23:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591075684065329167" data-draft-id="7590778284758548515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="移动web开发常见问题"/> <meta itemprop="keywords" content="前端,面试,CSS"/> <meta itemprop="datePublished" content="2026-01-04T08:23:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Crystal328"/> <meta itemprop="url" content="https://juejin.cn/user/2359973194513272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            移动web开发常见问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2359973194513272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Crystal328
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:23:06.000Z" title="Sun Jan 04 2026 08:23:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 去掉图片下方的空白间隙</h2>
<p>默认情况下，图片会与其下方的元素产生一段空白的间隙</p>
<blockquote>
<p><code>&lt;img&gt;</code>默认是<code>inline</code>（行内替换元素），遵循基线对齐，下方预留文字下行空间；</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6275ec48b6441f69a86a3871d353118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=uf2fIgLnBLs7IsCL1snSEE7u870%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> <span class="hljs-selector-tag">img</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid red;
    <span class="hljs-comment">/*1. 添加此样式*/</span>
    <span class="hljs-attribute">vertical-align</span>: top;
    <span class="hljs-comment">/*2. 或者转为块级元素*/</span>
    <span class="hljs-attribute">display</span>:black;
  }
  <span class="hljs-selector-class">.box</span> <span class="hljs-selector-tag">p</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">background-color</span>: khaki;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./images/pic1.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong>清除父元素的行高影响</strong>图片的基线对齐会受父元素 <code>line-height</code> 影响，将父元素行高设为 0，也能消除间隙：</li>
</ol>
<pre><code class="hljs language-css" lang="css">   <span class="hljs-selector-class">.img-parent</span> { <span class="hljs-comment">/* .img-parent 是 img 的父容器 */</span>
     <span class="hljs-attribute">line-height</span>: <span class="hljs-number">0</span>;
   }
</code></pre>
<h2 data-id="heading-1">2. 元素宽高等比缩放</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3efc81ed477d4e4cb16816a392f15413~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=ogsw7s5S2sgyhUM8eC9pyVKh66k%3D" alt="GIF2025-7-816-26-47.0becbb02.gif" loading="lazy"/></p>
<blockquote>
<p>利用 padding-top 来撑开元素的高，padding-top 百分比是相对于当前元素的父元素宽而言，而当前元素宽与父元素宽一样，则相当于元素的高是相对于当前元素的宽而言。</p>
</blockquote>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
 <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">25%</span>;
  }
 <span class="hljs-selector-class">.box</span> <span class="hljs-selector-class">.bl16-9</span> {
    <span class="hljs-attr">--bl</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">9</span> / <span class="hljs-number">16</span> * <span class="hljs-number">100%</span>);
    <span class="hljs-attribute">padding-top</span>: <span class="hljs-built_in">var</span>(--bl);
    <span class="hljs-attribute">background-color</span>: khaki;
    <span class="hljs-attribute">position</span>: relative;
  }
  <span class="hljs-selector-class">.box</span> <span class="hljs-selector-class">.content</span> {
    <span class="hljs-attribute">position</span>: absolute;
    inset: <span class="hljs-number">0</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 元素宽高比为 16：9 等比缩放 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bl16-9"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>元素宽高比为 16：9 等比缩放<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">3. 图片等比缩放</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a99ee75e84f415dbfdac000bb3b08ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=2J3bWD1lyGPEOlpP7SmIif0zXpA%3D" alt="GIF2025-7-816-24-32.28c3c218.gif" loading="lazy"/></p>
<blockquote>
<p>在实际的网站上线后，数据都是从后台读取的，用户在上传图片尺寸时，并不一定会按照设计师设计的比例来上传，这样就会造成图片上传后，大小不一样。</p>
<ul>
<li>图片高度过小，会在下面留下空白</li>
<li>图片高度过大，会有一部分下面的内容看不到</li>
<li>我们实际在设计一张图时，重要的内容会在中间显示，所以最理想的效果是让图片能水平垂直居中于容器中</li>
</ul>
</blockquote>
<p>要实现图片按一定的宽高比等比缩放，可以先将图片的直接父元素实现宽高等比缩放，然后再给图片添加如下代码</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">object-fit</span>: cover;
}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">25%</span>;
  }
  <span class="hljs-selector-class">.box</span> <span class="hljs-selector-class">.bl16-9</span> {
    <span class="hljs-attr">--bl</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">9</span> / <span class="hljs-number">16</span> * <span class="hljs-number">100%</span>);
    <span class="hljs-attribute">padding-top</span>: <span class="hljs-built_in">var</span>(--bl);
    <span class="hljs-attribute">background-color</span>: khaki;
    <span class="hljs-attribute">position</span>: relative;
  }
  <span class="hljs-selector-class">.box</span> <span class="hljs-selector-class">.content</span> {
    <span class="hljs-attribute">position</span>: absolute;
    inset: <span class="hljs-number">0</span>;
  }
  <span class="hljs-selector-class">.box</span> <span class="hljs-selector-tag">img</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">object-fit</span>: cover;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 元素宽高比为 16：9 等比缩放 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bl16-9"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./images/pic1.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-3">4. 背景图等比缩放</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b46218c8e674b51a802dcf7ba199eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=eYRiC1X8bwIMlZhoIJZmx%2FKNxms%3D" alt="GIF-2022-8-16-18-50-31.f89069c2.gif" loading="lazy"/></p>
<blockquote>
<ul>
<li>当背景图片的宽高比与容器的宽高比不一样时</li>
<li>我们希望不管容器宽高如何缩放，图片一直填充整个容器，然后水平垂直居中显示</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 背景图填充整个容器 */</span>
<span class="hljs-attribute">background-size</span>: cover;
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  }
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">31.467vw</span>;
    <span class="hljs-comment">/* 背景图片  不重复  水平垂直居中显示 */</span>
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">./images/banner1-@2x.png</span>) no-repeat center;
    <span class="hljs-comment">/* 背景图填充整个容器 */</span>
    <span class="hljs-attribute">background-size</span>: cover;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h2 data-id="heading-4">5. 2倍精灵图使用</h2>
<blockquote>
<ul>
<li>精灵图采用的是 2 倍图</li>
<li>所以在处理精灵图时，我们需要通过 <code>background-size: 50% auto;</code> ，来将背景图片大小缩小一半</li>
<li>测量尺寸时，也需要按一半的大小来测量</li>
</ul>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16c1bdc3c36b43de827e25460612fe1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=vDd%2BMwmmGSk%2FPFWzy8dwpDw1Wxg%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.icon-play</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">26px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">26px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid red;
    <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">images/sprite.png</span>);
    <span class="hljs-attribute">background-position</span>: -<span class="hljs-number">36px</span> -<span class="hljs-number">29px</span>;
    <span class="hljs-attribute">background-size</span>: <span class="hljs-number">200px</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-play"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">6.经典的 1 像素问题</h2>
<h3 data-id="heading-6">6.1、何为 1 像素问题</h3>
<p><strong>PSD 设计稿</strong></p>
<ul>
<li>我们的设计稿是以 750px 宽来设计的，而我们实际开发时，代码是按 375px 来的。</li>
<li>在 750px 设计稿中的 1px，按我们实际的开发代码来说，要折半，折成 0.5px 才对。</li>
<li>但是不同手机上，不同浏览器对小数的处理是不一样的</li>
<li><code>0.5px</code> 在一些老的 IOS 和 Android 设备上不支持，他会把低于 0.5px 当成 0 来处理，<code>&gt;= 0.5px</code> 当成 1px 来显示。</li>
<li>IOS 上会把<code>&gt;= 0.75px</code> 的当作 1px 来处理 ，<code>&lt; 0.75</code> 当成 0.5px 来处理 <code>&lt; 0.5px</code> 当成 0 来处理</li>
<li>而且 IOS 上，用 <code>height: 1px</code> 来代替 <code>border-bottom: 1px solid red;</code>测出的效果不同</li>
<li>不同的手机上，效果不一样，具体以真机测试为主</li>
<li>所以直接把代码折半，设置成 0.5px 显然是达不到目的。</li>
</ul>
<p><strong>1px 实际显示的大小</strong></p>
<p>1px 在 dpr (像素比)不同时，其显示的大小不同，如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9b3181b6f0847c498847ac3e368c0c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=d8jzFpB78neBmej7eQL0nvnqQ70%3D" alt="image.png" loading="lazy"/>
所以在不同 dpr 下，显示的 1px 的线的宽度是下面图标出的<strong>蓝色</strong>的高度大小（1 物理像素大小）
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89f44b448c6b4a7cb6ad75c3df85c200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768119786&amp;x-signature=A6GfeRB2s6YAyaS2P0Gd1QAGYGk%3D" alt="image.png" loading="lazy"/>
因此， 1px 像素问题(用当前设备的物理像素的1px进行渲染这根线的高度），本质上不是问题，如果公司觉得没有必要，也就不用处理。<br/>
如果公司认为就是要用设备能显示的最细的那个小方格显示，那我们就要处理这个问题。</p>
<h3 data-id="heading-7">6.2、1px 像素解决方案(最优的解决方案 <strong>transform+伪元素来实现</strong>)</h3>
<p><strong>实现原理：</strong></p>
<ul>
<li>利用伪元素来绘制 1px 的线条,然后利用定位，把线条放在对应位置</li>
<li>利用 <code>media</code> 查询判断不同的设备像素比对线条进行缩放</li>
</ul>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">position</span>: relative;
  }
  <span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">background-color</span>: red;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-comment">/* transform: scaleY(0.5); */</span>
    <span class="hljs-comment">/* 变换原点 */</span>
    <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">50%</span> <span class="hljs-number">0%</span>;
  }
  <span class="hljs-comment">/* dpr=2，需要缩放一半，即0.5 */</span>
  <span class="hljs-keyword">@media</span> <span class="hljs-keyword">only</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
    <span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">:before</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
    }
  }
  <span class="hljs-comment">/* dpr=3，需要缩放到1/3，即0.33 */</span>
  <span class="hljs-keyword">@media</span> <span class="hljs-keyword">only</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">3</span>) {
    <span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">:before</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.33</span>);
    }
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box border-1px"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<blockquote>
<p>也可以通过 js 来判断 dpr,然后给元素添加对应的 Class 名字，来实现</p>
</blockquote>
<pre><code class="hljs language-JS" lang="JS"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> &amp;&amp; devicePixelRatio &gt;= <span class="hljs-number">2</span>) {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">".box"</span>).<span class="hljs-property">className</span> = <span class="hljs-string">"border-1px"</span>;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建低利用率云资源面板，观测云助力企业缩减云成本]]></title>    <link>https://juejin.cn/post/7591013450526261300</link>    <guid>https://juejin.cn/post/7591013450526261300</guid>    <pubDate>2026-01-04T09:22:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591013450526261300" data-draft-id="7591075684065165327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建低利用率云资源面板，观测云助力企业缩减云成本"/> <meta itemprop="keywords" content="云计算"/> <meta itemprop="datePublished" content="2026-01-04T09:22:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建低利用率云资源面板，观测云助力企业缩减云成本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:22:10.000Z" title="Sun Jan 04 2026 09:22:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>随着公有云的广泛应用，企业普遍面临云资源利用率不足、资源配置不合理（如高配低用）等挑战，导致云支出持续居高不下。据行业报告显示，超过 90% 的用云企业存在明显的资源浪费现象，云资源投入与业务收益的匹配度不足已成为企业数字化转型中的核心痛点。在此背景下，云资源管理部门亟需对低利用率的云资源进行降配或关停。</p>
<p>观测云作为一款现代化的监控观测云服务，不仅能满足研发、运维团队的观测需求，也能站在「云中立」的角度帮助客户持续优化云资源成本。本文以 ECS 产品为例，向大家介绍如何在观测云上构建低利用率云资源面板。针对其他云产品，读者亦可参考该模式进行资源优化。</p>
<h2 data-id="heading-1">构建低利用率云资源面板</h2>
<p>笔者近期在服务于某客户时了解到，该客户的 ECS 的月消费金额始终位于云消费总金额的首位，比第二名的云数据库（RDS）高出 5 倍还多。因此客户认为从 ECS 入手进行成本优化，其风险小收益大。因此在双方共同努力下，在观测云上构建了「低资源利用率 ECS 面板」，具体效果如下：</p>
<h3 data-id="heading-2">第一部分：CPU、内存利用率蜂窝图</h3>
<p>作为仪表板的第一部分，蜂窝图能帮助用户一目了然看到当前有哪些 ECS 的利用率过低。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47176ce62501430187eecc0313e0d017~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=7NPFCiYYAQKEqPuZ786xKf4SeaY%3D" alt="" loading="lazy"/></p>
<p>以阿里云 ECS 为例，图表的 DQL 语句：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable constant_">CPU</span>利用率<span class="hljs-variable constant_">P90</span>

M::<span class="hljs-symbol">aliyun_acs_ecs_dashboard:</span>(percentile(<span class="hljs-string">`CPUUtilization_Average`</span>, <span class="hljs-number">90</span>)) <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`cloud_provider`</span>, <span class="hljs-string">`cluster_name_k8s`</span>,<span class="hljs-string">`instanceId`</span>
</code></pre>

<pre><code class="hljs language-ruby" lang="ruby">内存利用率<span class="hljs-variable constant_">P90</span>

M::<span class="hljs-symbol">aliyun_acs_ecs_dashboard:</span>(percentile(<span class="hljs-string">`memory_usedutilization_Average`</span>, <span class="hljs-number">90</span>)) <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`cloud_provider`</span>, <span class="hljs-string">`cluster_name_k8s`</span>,<span class="hljs-string">`instanceId`</span>
</code></pre>
<p>图表特点：</p>
<ul>
<li>选择 CPU 利用率和内存利用率 P90 指标，兼顾了高峰期资源利用率升高的场景；</li>
<li>采用蜂窝图，高密度展示各 ECS 的 CPU 和内存利用率，并按照云厂、k8s 集群、环境等标签进行分组展示；</li>
<li>将资源利用率分为红、黄、绿三个档次，用红色突出显示资源利用率很低的 ECS；</li>
<li>鼠标悬浮到单个蜂窝时，浏览器将显示该 ECS 的分组信息，如 instanceId，k8s 集群名称等，支持钻取到单台 ECS 进行下钻。</li>
</ul>
<h3 data-id="heading-3">第二部分：CPU、内存利用率趋势图</h3>
<p>图表显示了 CPU 利用率 P90、CPU 利用率均值、内存利用率 P90、内存利用率均值，每个趋势图展示资源率最低的 Top20 ECS 的利用率曲线。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc83b3210c6347f593ad3eb812342914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=a2IFam7FJ1TaD8pAoOd1ICus318%3D" alt="" loading="lazy"/></p>
<p>在蜂窝图上点击某个 instanceId 的蜂窝进行下钻，图表将过滤显示该 instanceId 的 CPU、内存利用率的 P90 趋势和均值趋势。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0691b2ee42c48a48fe9c4cbbd441901~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=wcwh1pxOmy8aLs5ELNts0RRDg3o%3D" alt="" loading="lazy"/></p>
<p>以阿里云 ECS 为例，图表的 DQL 语句：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable constant_">CPU</span>利用率<span class="hljs-variable constant_">P90</span>

M::<span class="hljs-symbol">aliyun_acs_ecs_dashboard:</span>(percentile(<span class="hljs-string">`CPUUtilization_Average`</span>, <span class="hljs-number">90</span>)) <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`cloud_provider`</span>, <span class="hljs-string">`cluster_name_k8s`</span>,<span class="hljs-string">`instanceId`</span>
</code></pre>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable constant_">CPU</span>利用率均值

M::<span class="hljs-symbol">aliyun_acs_ecs_dashboard:</span>(avg(<span class="hljs-string">`CPUUtilization_Average`</span>)) <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`cloud_provider`</span>,<span class="hljs-string">`cluster_name_k8s`</span>, <span class="hljs-string">`instanceId`</span>
</code></pre>

<pre><code class="hljs language-ruby" lang="ruby">内存利用率<span class="hljs-variable constant_">P90</span>

M::<span class="hljs-symbol">aliyun_acs_ecs_dashboard:</span>(percentile(<span class="hljs-string">`memory_usedutilization_Average`</span>, <span class="hljs-number">90</span>)) <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`cloud_provider`</span>, <span class="hljs-string">`cluster_name_k8s`</span>,<span class="hljs-string">`instanceId`</span>
</code></pre>

<pre><code class="hljs language-ruby" lang="ruby">内存利用率均值

M::<span class="hljs-symbol">aliyun_acs_ecs_dashboard:</span>(avg(<span class="hljs-string">`memory_usedutilization_Average`</span>)) <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`cloud_provider`</span>, <span class="hljs-string">`cluster_name_k8s`</span>,<span class="hljs-string">`instanceId`</span>
</code></pre>
<p>图表特点：</p>
<ul>
<li>通过趋势图，反映 ECS 在一个较长周期内的资源利用率变化趋势，例如 30 天、180 天、360 天等；</li>
<li>同时提供 P90 和均值趋势，以评估 ECS 在日常使用和高峰期的资源使用率</li>
<li>支持与蜂窝图联动，当用户从蜂窝图上点击单个蜂窝时（例如代表资源利用率很低的红色蜂窝），趋势图将联动该过滤条件，仅显示该 ECS 的趋势图</li>
<li>在趋势图中，同时还展示了低水位基准线，以便反映 ECS 实际资源率和基准线的差异。</li>
</ul>
<h3 data-id="heading-4">第三部分：ECS 资源列表</h3>
<p>通过前两部分的图表，用户可以明确某台 ECS 的资源利用率是长期处于低位的，而第三部分的 ECS 资源列表则将对应 ECS 的 instanceId、主机名、规格、CPU 和内存配置信息展示出来，用户无需登陆到云平台上进行二次搜索。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c8d544c7ca94029a758b30b21a46d31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=rNNwyn4AqOTcLm2N4%2BuYL9Waa5g%3D" alt="" loading="lazy"/></p>
<p>以阿里云 ECS 为例，图表 DQL 如下：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable constant_">ECS</span>资源列表

<span class="hljs-variable constant_">CO</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:aliyun_ecs</span><span class="hljs-symbol">:</span>(<span class="hljs-string">`HostName`</span>, <span class="hljs-string">`InstanceName`</span>, <span class="hljs-string">`Cpu`</span>, <span class="hljs-string">`Memory`</span>, <span class="hljs-string">`Status`</span>, <span class="hljs-string">`CreationTime`</span>, <span class="hljs-string">`InstanceType`</span>, <span class="hljs-string">`PublicIpAddress_IpAddress`</span>) [1h] <span class="hljs-variable constant_">BY</span> <span class="hljs-string">`InstanceId`</span>
</code></pre>
<p>图表特点：</p>
<ul>
<li>显示规格、CPU、内存等信息</li>
<li>支持与蜂窝图联动，从蜂窝图下钻到单台 ECS 后，资源列表也将同步过滤显示该 ECS 的规格情况</li>
</ul>
<h3 data-id="heading-5">第四部分：汇报部分</h3>
<p>在开展云资源优化的工作并取得阶段性成果后，用户需要向管理层汇报优化工作的前后对比，例如本月的低资源利用率主机数量相对于上月的数量变化情况，因此需要直观的数据对比，这部分图表内容如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65978cc2eb9d491ea6b37dee7959194b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=YTqRAACb5l7CckqLkTp%2BaiM15c4%3D" alt="" loading="lazy"/></p>
<p>图表 promQL：</p>
<pre><code class="hljs language-less" lang="less">最近<span class="hljs-number">30</span>天<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">CPU</span>资源利用率<span class="hljs-selector-tag">P90</span>小于<span class="hljs-number">20%</span>的主机数

<span class="hljs-selector-tag">count</span>(<span class="hljs-built_in">quantile_over_time</span>(<span class="hljs-number">0.9</span>, <span class="hljs-attribute">aliyun_acs_ecs_dashboard</span>:CPUUtilization_Average[<span class="hljs-number">30</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span>h])  &lt; <span class="hljs-number">20</span>)
</code></pre>

<pre><code class="hljs language-less" lang="less">上一个<span class="hljs-number">30</span>天<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">CPU</span>资源利用率<span class="hljs-selector-tag">P90</span>小于<span class="hljs-number">20%</span>的主机数

<span class="hljs-selector-tag">count</span>(<span class="hljs-built_in">quantile_over_time</span>(<span class="hljs-number">0.9</span>, <span class="hljs-attribute">aliyun_acs_ecs_dashboard</span>:CPUUtilization_Average[<span class="hljs-number">30</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span>h])  &lt; <span class="hljs-number">20</span>) <span class="hljs-selector-tag">offset</span> <span class="hljs-number">30</span><span class="hljs-selector-tag">d</span>
</code></pre>

<pre><code class="hljs language-less" lang="less">最近<span class="hljs-number">30</span>天<span class="hljs-selector-tag">-</span> 内存资源利用率<span class="hljs-selector-tag">P90</span>小于<span class="hljs-number">40%</span>的主机数

<span class="hljs-selector-tag">count</span>(<span class="hljs-built_in">quantile_over_time</span>(<span class="hljs-number">0.9</span>, <span class="hljs-attribute">aliyun_acs_ecs_dashboard</span>:memory_usedutilization_Average[<span class="hljs-number">30</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span>h])  &lt; <span class="hljs-number">40</span>)
</code></pre>

<pre><code class="hljs language-less" lang="less">上一个<span class="hljs-number">30</span>天<span class="hljs-selector-tag">-</span> 内存资源利用率<span class="hljs-selector-tag">P90</span>小于<span class="hljs-number">40%</span>的主机数

<span class="hljs-selector-tag">count</span>(<span class="hljs-built_in">quantile_over_time</span>(<span class="hljs-number">0.9</span>, <span class="hljs-attribute">aliyun_acs_ecs_dashboard</span>:memory_usedutilization_Average[<span class="hljs-number">30</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span>h])  &lt; <span class="hljs-number">40</span>)   <span class="hljs-selector-tag">offset</span> <span class="hljs-number">30</span><span class="hljs-selector-tag">d</span>
</code></pre>

<pre><code class="hljs language-less" lang="less">最近<span class="hljs-number">30</span>天<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">CPU</span>资源利用率<span class="hljs-selector-tag">P90</span>小于<span class="hljs-number">20%</span>的主机明细表

<span class="hljs-selector-tag">quantile_over_time</span>(<span class="hljs-number">0.9</span>, <span class="hljs-attribute">aliyun_acs_ecs_dashboard</span>:CPUUtilization_Average[<span class="hljs-number">30</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span>h])  &lt; <span class="hljs-number">20</span>
</code></pre>

<pre><code class="hljs language-less" lang="less">最近<span class="hljs-number">30</span>天<span class="hljs-selector-tag">-</span> 内存资源利用率<span class="hljs-selector-tag">P90</span>小于<span class="hljs-number">40%</span>的主机明细表

<span class="hljs-selector-tag">quantile_over_time</span>(<span class="hljs-number">0.9</span>, <span class="hljs-attribute">aliyun_acs_ecs_dashboard</span>:memory_usedutilization_Average[<span class="hljs-number">30</span><span class="hljs-attribute">d</span>:<span class="hljs-number">1</span>h])  &lt; <span class="hljs-number">40</span>
</code></pre>
<p>图表特点：</p>
<ul>
<li>分周期展示低资源利用率的 ECS 数量，清晰且客观，方便汇报优化成果</li>
<li>支持导出为 CSV 文件，方便核查明细</li>
</ul>
<h2 data-id="heading-6">云资源利用率指标采集的步骤</h2>
<p>在本章中我们将介绍绘制低利用率云资源面板所需要的一些前置条件和步骤，帮助大家轻松完成相关指标接入和指标管理。</p>
<h3 data-id="heading-7">第一步，开启观测云「云账号管理」功能</h3>
<p>登陆到观测云工作空间后，进入「集成」-「云账号管理」，添加公有云账号，输入具有 readOnly 权限的 AK/SK。如企业无法提供云平台的 AK/SK 信息，可考虑通过在企业内网自建 Func 的方式，来进行云资源采集。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95d1ce0918e04de9a99cf57c8649d303~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=Zw3ZN8fMcjn%2F85XGIzt%2FK1qdz4A%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">第二步，采集指定云产品的指标</h3>
<p>在配置完云账号之后，接下来是配置具体的云产品指标采集，选择 Region，添加关注的资源利用率指标后保存即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e310a61c01404db1911928fa01d59d73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=GhnHQIMwEMV%2FRk4SmDarez3tVtk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">第三步，对指标集的存储时间配置为较长时间</h3>
<p>资源利用率相关的指标通常需要进行长期保存，因此用户可以在「指标」-「指标管理」中为相关指标集配置长期存储策略，如下图所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2360b1bbc8484be48f84f7e3526e36b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123329&amp;x-signature=3%2FoeKtAaV2OPleZhGrAgSIT%2FWR4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">总结</h2>
<p>在完成「低利用率 ECS 面板」的第二天，我们向该客户运维团队进行了演示汇报，对方认为这张仪表板完全满足他们对 ECS 进行成本优化的需求，并计划在下一步开展对 RDS、云硬盘等支出相对较高的云产品进行相同的分析和优化工作。大家还聊到了近期产业链上游硬件涨价的相关新闻。继内存、SSD 涨价引发市场震荡后，CPU 等其他硬件的价格上涨接踵而至，这无疑给明年的公有云价格体系带来了很大不确定性。企业尽早开始掌握分析、优化低利用率的云资源，就越能从容应对每月的云支出账单。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端实现带滚动区域的 DOM 长截图导出]]></title>    <link>https://juejin.cn/post/7591104893391732790</link>    <guid>https://juejin.cn/post/7591104893391732790</guid>    <pubDate>2026-01-04T08:29:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591104893391732790" data-draft-id="7590752433989025846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端实现带滚动区域的 DOM 长截图导出"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2026-01-04T08:29:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小闹钟"/> <meta itemprop="url" content="https://juejin.cn/user/1337449905128205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端实现带滚动区域的 DOM 长截图导出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1337449905128205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小闹钟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:29:34.000Z" title="Sun Jan 04 2026 08:29:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>日常开发中，导出带滚动条的DOM内容为图片时，普通截图只能抓可视区域？本文分享基于@snapdom的长截图方案，完美导出完整内容，还能精准复刻UI～</p>
</blockquote>
<h2 data-id="heading-0">一、业务痛点（为什么选snapdom？）</h2>
<p>开发中经常遇到「导出带滚动区域的DOM为图片」的需求（比如评估报告、图表列表、长表单），普通方案的问题：</p>
<ul>
<li>❌ 仅能截取可视区域，滚动隐藏的内容丢失；</li>
<li>❌ Canvas绘制易出现样式错乱（字体、颜色、布局偏差）；</li>
<li>❌ 手动计算滚动高度复杂，适配成本高。</li>
</ul>
<p>✅ 解决方案：使用第三方库<code>@zumer/snapdom</code>，直接将DOM节点完整渲染为Canvas，完美解决以上问题。</p>
<h2 data-id="heading-1">二、核心原理</h2>
<p><code>snapdom</code> 核心是模拟浏览器渲染引擎，将指定DOM节点（包括子节点、滚动隐藏区域）完整转换为Canvas：</p>
<ol>
<li>解析DOM节点的完整布局（包括<code>overflow</code>滚动区域的实际高度）；</li>
<li>复刻节点的所有样式（CSS、字体、图片、背景色）；</li>
<li>按真实尺寸渲染为Canvas，支持高分辨率导出；</li>
<li>最终将Canvas转换为图片并下载。</li>
</ol>
<h3 data-id="heading-2">核心原理</h3>
<p>使用第三方库 <code>@zumer/snapdom</code> 将指定的 DOM 节点及其子节点转换为 Canvas，从而生成长截图。</p>
<h3 data-id="heading-3">解决的关键问题</h3>
<ul>
<li><strong>完整内容导出</strong>：内容较多时会出现滚动条，普通的截图方式只能截取可视区域。<code>snapdom</code> 可以渲染整个 DOM 节点的高度。</li>
</ul>
<h3 data-id="heading-4">实现步骤</h3>
<ol>
<li>
<p><strong>DOM 结构隔离</strong>：</p>
<ul>
<li>将需要导出的内容（图表列表 + 截图历史）包裹在一个独立的 <code>&lt;div&gt;</code> 中，并绑定 <code>contentRef</code>。</li>
</ul>
</li>
<li>
<p><strong>执行截图</strong>：</p>
<ul>
<li>点击导出按钮时，调用 <code>snapdom.toCanvas(contentRef.current)</code>。</li>
<li>库会自动计算节点的完整尺寸（包括溢出/滚动部分）进行绘制。</li>
</ul>
</li>
<li>
<p><strong>下载文件</strong>：</p>
<ul>
<li>将生成的 Canvas 转换为 Data URL。</li>
<li>动态创建一个 <code>&lt;a&gt;</code> 标签，设置 <code>download</code> 属性和 <code>href</code>，触发点击事件下载图片。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">关键代码</h3>
<p><strong>结构：</strong></p>
<pre><code class="hljs language-xml" lang="xml">{/* 导出目标容器（ref={contentRef}） */}
 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{reportContentRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"export-container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ReportHeader</span> <span class="hljs-attr">reportData</span>=<span class="hljs-string">{reportData}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">FirstTab</span> <span class="hljs-attr">reportData</span>=<span class="hljs-string">{reportData}</span> <span class="hljs-attr">isExport</span>=<span class="hljs-string">{isExport}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SecondTab</span> <span class="hljs-attr">reportData</span>=<span class="hljs-string">{reportData}</span> <span class="hljs-attr">mapUrl</span>=<span class="hljs-string">{mapUrl}</span> <span class="hljs-attr">isExport</span>=<span class="hljs-string">{isExport}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ThirdTab</span> <span class="hljs-attr">reportData</span>=<span class="hljs-string">{reportData}</span> <span class="hljs-attr">isExport</span>=<span class="hljs-string">{isExport}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ReportFooter</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>导出逻辑：</strong></p>
<pre><code class="hljs language-ini" lang="ini"> // 导出报告为图片
  const <span class="hljs-attr">handleExportReport</span> = async () =&gt; {
    if (!reportContentRef.current) {
      message.error('无法获取报告内容')<span class="hljs-comment">;</span>
      return<span class="hljs-comment">;</span>
    }
    try {
      setExportLoading(true)<span class="hljs-comment">;</span>
      // 使用 @zumer/snapdom 组件实现 html转canvas
      const <span class="hljs-attr">contentCanvas</span> = await snapdom.toCanvas(reportContentRef.current, {
        // 配置选项
        dpr: 3,
        scale: 2,
        backgroundColor: '<span class="hljs-comment">#e7f0fa',</span>
      })<span class="hljs-comment">;</span>

      // 转换为图片数据URL
      const <span class="hljs-attr">dataUrl</span> = contentCanvas.toDataURL(<span class="hljs-string">'image/png'</span>)<span class="hljs-comment">;</span>

      // 下载截图
      const <span class="hljs-attr">link</span> = document.createElement(<span class="hljs-string">'a'</span>)<span class="hljs-comment">;</span>
      <span class="hljs-attr">link.download</span> = `<span class="hljs-variable">${reportData?.createTime}</span><span class="hljs-variable">${reportData?.stationName}</span>评估报告.jpg`<span class="hljs-comment">;</span>
      <span class="hljs-attr">link.href</span> = dataUrl<span class="hljs-comment">;</span>
      link.click()<span class="hljs-comment">;</span>
      link.remove()<span class="hljs-comment">;</span>

      message.success('报告导出成功')<span class="hljs-comment">;</span>
      setExportLoading(false)<span class="hljs-comment">;</span>
    } catch (error) {
      message.error('报告导出失败，请重试')<span class="hljs-comment">;</span>
      setExportLoading(false)<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-6">优势</h3>
<ul>
<li><strong>所见即所得（甚至更多）</strong> ：能够导出包含滚动区域在内的所有内容。</li>
<li><strong>纯净输出</strong>：通过 Ref 精确锁定内容区域，自动过滤掉按钮和无关 UI。</li>
</ul>
<p>如果要求导出的UI和页面上的不一致，可以新建一个专门用来导出的组件，隐藏在页面上的某个地方。
如果你的项目有特殊场景,欢迎评论区交流👏～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 内存管理深度解析：十年老兵的实战心得]]></title>    <link>https://juejin.cn/post/7590776324165337088</link>    <guid>https://juejin.cn/post/7590776324165337088</guid>    <pubDate>2026-01-04T08:37:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590776324165337088" data-draft-id="7590776324164878336" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 内存管理深度解析：十年老兵的实战心得"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2026-01-04T08:37:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="明君87997"/> <meta itemprop="url" content="https://juejin.cn/user/413072103838462"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 内存管理深度解析：十年老兵的实战心得
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072103838462/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    明君87997
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:37:56.000Z" title="Sun Jan 04 2026 08:37:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter 内存管理深度解析：十年老兵的实战心得</h2>
<h3 data-id="heading-1">写在前面</h3>
<p>从 Java 到 iOS 原生，再到现在主力用 Flutter，我在移动端摸爬滚打了十年。说实话，Flutter 的内存管理在我看来是<strong>相对友好</strong>的——有 GC、有 DevTools、有完善的生命周期。但正因为"友好"，很多开发者反而忽视了它，直到线上出问题才追悔莫及。</p>
<p>今天这篇文章，我想把这些年在 Flutter 内存方面的认知体系完整地梳理一遍。不讲那些教科书式的东西，只说实战中真正有用的。</p>
<hr/>
<h3 data-id="heading-2">一、先把内存模型搞清楚</h3>
<h4 data-id="heading-3">1.1 Flutter 内存的三层结构</h4>
<p>很多人以为 Flutter 内存就是 Dart 堆内存，这是第一个认知误区。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80a143e4f8224a0fa848aa207177d02c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO5ZCbODc5OTc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768120676&amp;x-signature=cLtsTafYlvRHH6pCUtfKp9p9RWc%3D" alt="Snipaste_2026-01-04_15-25-37.png" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java">┌─────────────────────────────────────────────────────┐
│                    Flutter App                      │
├─────────────────────────────────────────────────────┤
│  Layer <span class="hljs-number">1</span>: Dart VM Memory                            │
│  ├── New <span class="hljs-title function_">Space</span> <span class="hljs-params">(新生代，~16MB)</span>                      │
│  │   └── Scavenger GC，毫秒级，频繁触发             │
│  └── Old <span class="hljs-title function_">Space</span> <span class="hljs-params">(老年代，动态扩展)</span>                   │
│      └── Mark-Sweep-Compact GC，相对耗时            │
├─────────────────────────────────────────────────────┤
│  Layer <span class="hljs-number">2</span>: Engine Native Memory                      │
│  ├── Skia 渲染缓存 (Layer Tree, Picture Cache)     │
│  ├── 图片解码缓冲区 (这是真正的大头！)              │
│  ├── 字体光栅化缓存                                 │
│  └── Platform Channel 数据缓冲                      │
├─────────────────────────────────────────────────────┤
│  Layer <span class="hljs-number">3</span>: GPU <span class="hljs-title function_">Memory</span> <span class="hljs-params">(显存)</span>                         │
│  ├── 纹理 (Textures)                               │
│  ├── 帧缓冲 (Frame Buffers)                        │
│  └── 着色器编译缓存                                  │
└─────────────────────────────────────────────────────┘
</code></pre>
<p><strong>关键认知</strong>：Dart 堆内存在 DevTools 里能看到，但 Native Memory 和 GPU Memory 往往是隐形杀手。我见过太多案例，Dart Heap 才 50MB，但 App 总内存已经 500MB+，问题全出在图片和 Skia 缓存上。</p>
<h4 data-id="heading-4">1.2 Dart GC 的真实行为</h4>
<p>Dart 使用的是<strong>分代式垃圾回收</strong>，但具体细节很多文章讲得不清楚：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 新生代 GC (Scavenge)</span>
<span class="hljs-comment">// - 采用复制算法，Eden -&gt; Survivor</span>
<span class="hljs-comment">// - 触发条件：新生代满了（约16MB）</span>
<span class="hljs-comment">// - 耗时：通常 &lt; 2ms</span>
<span class="hljs-comment">// - 特点：Stop-the-world，但时间短</span>

<span class="hljs-comment">// 老年代 GC (Mark-Sweep-Compact)  </span>
<span class="hljs-comment">// - 标记-清除-压缩</span>
<span class="hljs-comment">// - 触发条件：老年代增长到阈值，或显式调用</span>
<span class="hljs-comment">// - 耗时：几十到几百毫秒不等</span>
<span class="hljs-comment">// - 特点：增量式标记，减少卡顿</span>
</code></pre>
<p><strong>实战经验</strong>：如果你的 App 有明显的周期性卡顿（比如每隔几秒掉几帧），很可能是老年代 GC 在作怪。解决方案不是调 GC 参数（Dart 不让你调），而是<strong>减少对象分配和存活周期</strong>。</p>
<h4 data-id="heading-5">1.3 内存分配的成本</h4>
<p>这个点很多人没概念。在 Dart 里创建对象<strong>不是免费的</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 看似无害的代码，实际上在疯狂分配内存</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Container(
    padding: EdgeInsets.all(<span class="hljs-number">16</span>),           <span class="hljs-comment">// 每次 build 创建新对象</span>
    margin: EdgeInsets.symmetric(horizontal: <span class="hljs-number">8</span>), <span class="hljs-comment">// 又一个</span>
    decoration: BoxDecoration(              <span class="hljs-comment">// 又一个</span>
      color: Colors.white,
      borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>), <span class="hljs-comment">// 又一个</span>
      boxShadow: [                          <span class="hljs-comment">// List 对象</span>
        BoxShadow(                          <span class="hljs-comment">// 又一个</span>
          color: Colors.black.withOpacity(<span class="hljs-number">0.1</span>), <span class="hljs-comment">// Color 对象</span>
          blurRadius: <span class="hljs-number">4</span>,
          offset: Offset(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>),             <span class="hljs-comment">// 又一个</span>
        ),
      ],
    ),
    child: Text(
      <span class="hljs-string">'Hello'</span>,
      style: TextStyle(fontSize: <span class="hljs-number">16</span>),       <span class="hljs-comment">// 又一个</span>
    ),
  );
}
</code></pre>
<p>一个简单的 Widget，一次 build 就创建了 10+ 个对象。如果这个 Widget 在列表里被频繁重建...</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 正确做法：尽可能使用 const</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Container(
    padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
    margin: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">8</span>),
    decoration: <span class="hljs-keyword">const</span> BoxDecoration(
      color: Colors.white,
      borderRadius: BorderRadius.all(Radius.circular(<span class="hljs-number">8</span>)),
      boxShadow: [
        BoxShadow(
          color: Color(<span class="hljs-number">0x1A000000</span>), <span class="hljs-comment">// 直接用色值，可以 const</span>
          blurRadius: <span class="hljs-number">4</span>,
          offset: Offset(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>),
        ),
      ],
    ),
    child: <span class="hljs-keyword">const</span> Text(
      <span class="hljs-string">'Hello'</span>,
      style: TextStyle(fontSize: <span class="hljs-number">16</span>),
    ),
  );
}
</code></pre>
<p><strong>const 的本质</strong>：编译时常量，整个 App 生命周期内只存在一份实例。这不只是"优化"，而是<strong>数量级的差别</strong>。</p>
<hr/>
<h3 data-id="heading-6">二、那些年我踩过的内存坑</h3>
<h4 data-id="heading-7">2.1 闭包引用链 —— 最隐蔽的泄漏</h4>
<p>这是我见过最多、也最难排查的问题：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SearchPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SearchPage</span>&gt; </span>{
  <span class="hljs-keyword">final</span> TextEditingController _controller = TextEditingController();
  <span class="hljs-built_in">List</span>&lt;SearchResult&gt; _results = [];

  <span class="hljs-keyword">void</span> _onSearch() {
    <span class="hljs-comment">// 问题代码：闭包持有了 this</span>
    ApiService.search(_controller.text).then((results) {
      <span class="hljs-comment">// 这个闭包持有了 _SearchPageState 实例</span>
      <span class="hljs-comment">// 如果网络请求还没返回，用户就退出了页面</span>
      <span class="hljs-comment">// State 对象就无法被回收</span>
      setState(() {
        _results = results;
      });
    });
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
}
</code></pre>
<p><strong>正确做法有三种</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 方案1：mounted 检查（最简单）</span>
<span class="hljs-keyword">void</span> _onSearch() {
  ApiService.search(_controller.text).then((results) {
    <span class="hljs-keyword">if</span> (!mounted) <span class="hljs-keyword">return</span>;
    setState(() =&gt; _results = results);
  });
}

<span class="hljs-comment">// 方案2：使用 CancelableOperation（推荐）</span>
CancelableOperation&lt;<span class="hljs-built_in">List</span>&lt;SearchResult&gt;&gt;? _searchOperation;

<span class="hljs-keyword">void</span> _onSearch() {
  _searchOperation?.cancel();
  _searchOperation = CancelableOperation.fromFuture(
    ApiService.search(_controller.text),
  );
  _searchOperation!.value.then((results) {
    setState(() =&gt; _results = results);
  });
}

<span class="hljs-meta">@override</span>
<span class="hljs-keyword">void</span> dispose() {
  _searchOperation?.cancel();
  _controller.dispose();
  <span class="hljs-keyword">super</span>.dispose();
}

<span class="hljs-comment">// 方案3：弱引用回调（复杂场景）</span>
<span class="hljs-keyword">void</span> _onSearch() {
  <span class="hljs-keyword">final</span> weakThis = WeakReference(<span class="hljs-keyword">this</span>);
  ApiService.search(_controller.text).then((results) {
    weakThis.target?._updateResults(results);
  });
}
</code></pre>
<h4 data-id="heading-8">2.2 GetX 的 Worker 陷阱</h4>
<p>用 GetX 的同学注意了，Worker 是个内存泄漏高发区：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-keyword">final</span> someObservable = <span class="hljs-number">0.</span>obs;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onInit() {
    <span class="hljs-keyword">super</span>.onInit();
    
    <span class="hljs-comment">// ❌ 问题：ever 创建的 Worker 如果引用了外部大对象...</span>
    ever(someObservable, (value) {
      <span class="hljs-comment">// 假设这里引用了一个大的数据列表</span>
      processBigData(bigDataList); 
    });
    
    <span class="hljs-comment">// ❌ 问题：debounce 里的闭包持有 Controller</span>
    debounce(someObservable, (value) {
      <span class="hljs-comment">// ...</span>
    }, time: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));
  }
}
</code></pre>
<p>GetX 的 Worker 在 Controller 销毁时会自动清理，<strong>但前提是你正确使用了 GetX 的生命周期</strong>。如果你手动创建 Controller 实例而不是通过 <code>Get.put</code>，那就需要手动处理。</p>
<h4 data-id="heading-9">2.3 图片 —— 永远的大户</h4>
<p>我参与过的几乎每个 Flutter 项目，内存问题最终都指向图片。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 一张 4000x3000 的图片，解码后占用内存：</span>
<span class="hljs-comment">// 4000 * 3000 * 4 bytes (RGBA) = 48MB</span>
<span class="hljs-comment">// 是的，一张图就是 48MB</span>

<span class="hljs-comment">// 而且 Flutter 默认会缓存解码后的图片</span>
<span class="hljs-comment">// 默认缓存：1000张 或 100MB（看 Flutter 版本）</span>
</code></pre>
<p><strong>我的图片优化策略</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. 始终指定 cacheWidth/cacheHeight</span>
Image.network(
  imageUrl,
  cacheWidth: (MediaQuery.of(context).size.width * 
               MediaQuery.of(context).devicePixelRatio).toInt(),
)

<span class="hljs-comment">// 2. 封装一个统一的图片组件</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OptimizedImage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> url;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> width;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> height;
  
  <span class="hljs-keyword">const</span> OptimizedImage({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.url,
    <span class="hljs-keyword">this</span>.width,
    <span class="hljs-keyword">this</span>.height,
  });
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">final</span> pixelRatio = MediaQuery.of(context).devicePixelRatio;
    <span class="hljs-keyword">return</span> Image.network(
      url,
      width: width,
      height: height,
      cacheWidth: width != <span class="hljs-keyword">null</span> ? (width! * pixelRatio).toInt() : <span class="hljs-keyword">null</span>,
      cacheHeight: height != <span class="hljs-keyword">null</span> ? (height! * pixelRatio).toInt() : <span class="hljs-keyword">null</span>,
      fit: BoxFit.cover,
      errorBuilder: (_, __, ___) =&gt; <span class="hljs-keyword">const</span> Icon(Icons.error),
    );
  }
}

<span class="hljs-comment">// 3. 页面退出时主动清理（慎用，看场景）</span>
<span class="hljs-meta">@override</span>
<span class="hljs-keyword">void</span> dispose() {
  <span class="hljs-comment">// 只在确实需要时使用，比如图片浏览页</span>
  PaintingBinding.instance.imageCache.clearLiveImages();
  <span class="hljs-keyword">super</span>.dispose();
}

<span class="hljs-comment">// 4. 全局配置缓存上限</span>
<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 在 main 里配置</span>
  PaintingBinding.instance.imageCache.maximumSize = <span class="hljs-number">100</span>; <span class="hljs-comment">// 张数</span>
  PaintingBinding.instance.imageCache.maximumSizeBytes = <span class="hljs-number">50</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 50MB</span>
  runApp(MyApp());
}
</code></pre>
<h4 data-id="heading-10">2.4 列表滚动时的内存震荡</h4>
<p>用 ListView.builder 不代表万事大吉：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ❌ 看起来没问题，实际有隐患</span>
ListView.builder(
  itemCount: items.length,
  itemBuilder: (context, index) {
    <span class="hljs-keyword">final</span> item = items[index];
    <span class="hljs-keyword">return</span> ListTile(
      leading: Image.network(item.imageUrl), <span class="hljs-comment">// 每个 item 一张图</span>
      title: Text(item.title),
    );
  },
)
</code></pre>
<p>当用户快速滚动时，Flutter 会快速创建和销毁 Widget。问题是：</p>
<ol>
<li>图片请求还没完成，Widget 就销毁了</li>
<li>新的 Widget 创建，又发起新的图片请求</li>
<li>内存里堆积了大量"孤儿"图片请求</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 使用 cached_network_image 或类似库</span>
<span class="hljs-comment">// 它们会处理请求取消和缓存策略</span>
CachedNetworkImage(
  imageUrl: item.imageUrl,
  memCacheWidth: <span class="hljs-number">100</span>, <span class="hljs-comment">// 缩略图尺寸</span>
  fadeInDuration: <span class="hljs-built_in">Duration</span>.zero, <span class="hljs-comment">// 快速滚动时不要动画</span>
)

<span class="hljs-comment">// 或者自己实现取消逻辑</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ImageItemState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImageItem</span>&gt; </span>{
  CancelableOperation? _imageLoad;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _loadImage();
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _imageLoad?.cancel(); <span class="hljs-comment">// 关键！</span>
    <span class="hljs-keyword">super</span>.dispose();
  }
}
</code></pre>
<h4 data-id="heading-11">2.5 全局单例的隐患</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 常见的"偷懒"写法</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataCache</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DataCache _instance = DataCache._();
  <span class="hljs-keyword">static</span> DataCache <span class="hljs-keyword">get</span> instance =&gt; _instance;
  DataCache._();
  
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; _cache = {};
  
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">set</span>(<span class="hljs-built_in">String</span> key, <span class="hljs-built_in">dynamic</span> value) {
    _cache[key] = value; <span class="hljs-comment">// 只进不出，内存只增不减</span>
  }
}
</code></pre>
<p><strong>我的原则</strong>：</p>
<ol>
<li>单例持有的数据必须有清理策略</li>
<li>用 LRU 或定时清理</li>
<li>考虑用 WeakReference（Dart 2.17+）</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataCache</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DataCache _instance = DataCache._();
  <span class="hljs-keyword">static</span> DataCache <span class="hljs-keyword">get</span> instance =&gt; _instance;
  DataCache._();
  
  <span class="hljs-comment">// 使用支持 LRU 淘汰的数据结构</span>
  <span class="hljs-keyword">final</span> _cache = LinkedHashMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;();
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> _maxSize = <span class="hljs-number">100</span>;
  
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">set</span>(<span class="hljs-built_in">String</span> key, <span class="hljs-built_in">dynamic</span> value) {
    <span class="hljs-keyword">if</span> (_cache.length &gt;= _maxSize) {
      _cache.remove(_cache.keys.first); <span class="hljs-comment">// 移除最老的</span>
    }
    _cache[key] = value;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-12">三、内存分析实战流程</h3>
<h4 data-id="heading-13">3.1 我的排查流程</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 复现问题
   └── 找到内存增长的操作路径
   
<span class="hljs-bullet">2.</span> 定位层级
   ├── DevTools Memory 看 Dart Heap
   ├── Android Profiler / Xcode 看 Native Memory
   └── 对比判断问题在哪层

<span class="hljs-bullet">3.</span> 抓取快照
   ├── 操作前 Snapshot A
   ├── 执行可疑操作
   ├── 操作后 Snapshot B
   └── Diff 两个快照

<span class="hljs-bullet">4.</span> 分析对象
   ├── 哪些对象数量异常
   ├── 追溯引用链 (Retaining Path)
   └── 定位到代码

<span class="hljs-bullet">5.</span> 修复验证
   └── 修复后重复上述流程
</code></pre>
<h4 data-id="heading-14">3.2 DevTools 的高级用法</h4>
<p>很多人只会点 GC 和 Snapshot，其实还有更强大的功能：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. 代码中打标记</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:developer'</span> <span class="hljs-keyword">as</span> developer;

<span class="hljs-keyword">void</span> someCriticalFunction() {
  developer.Timeline.startSync(<span class="hljs-string">'CriticalOperation'</span>);
  <span class="hljs-comment">// ... 执行操作</span>
  developer.Timeline.finishSync();
}

<span class="hljs-comment">// 2. 自定义内存统计事件</span>
developer.postEvent(<span class="hljs-string">'memory_check'</span>, {
  <span class="hljs-string">'location'</span>: <span class="hljs-string">'after_image_load'</span>,
  <span class="hljs-string">'cache_size'</span>: imageCache.currentSizeBytes,
});

<span class="hljs-comment">// 3. 在 release 模式收集信息（谨慎使用）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/foundation.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemoryMonitor</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> reportLeak(<span class="hljs-built_in">String</span> location, <span class="hljs-built_in">int</span> bytes) {
    <span class="hljs-keyword">if</span> (kReleaseMode) {
      <span class="hljs-comment">// 上报到你的监控系统</span>
      Analytics.report(<span class="hljs-string">'memory_leak'</span>, {
        <span class="hljs-string">'location'</span>: location,
        <span class="hljs-string">'bytes'</span>: bytes,
      });
    }
  }
}
</code></pre>
<h4 data-id="heading-15">3.3 线上监控方案</h4>
<p>DevTools 只能调试时用，线上怎么办？</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 简单的内存监控方案</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemoryWatcher</span> </span>{
  <span class="hljs-keyword">static</span> Timer? _timer;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _lastRss = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> start() {
    _timer = Timer.periodic(<span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">1</span>), (_) {
      _checkMemory();
    });
  }
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _checkMemory() {
    <span class="hljs-keyword">final</span> currentRss = ProcessInfo.currentRss;
    <span class="hljs-keyword">final</span> delta = currentRss - _lastRss;
    
    <span class="hljs-comment">// 内存增长过快告警</span>
    <span class="hljs-keyword">if</span> (delta &gt; <span class="hljs-number">50</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) { <span class="hljs-comment">// 1分钟增长 50MB</span>
      _reportAbnormal(currentRss, delta);
    }
    
    <span class="hljs-comment">// 总内存过高告警</span>
    <span class="hljs-keyword">if</span> (currentRss &gt; <span class="hljs-number">500</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) { <span class="hljs-comment">// 超过 500MB</span>
      _reportHigh(currentRss);
    }
    
    _lastRss = currentRss;
  }
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _reportAbnormal(<span class="hljs-built_in">int</span> rss, <span class="hljs-built_in">int</span> delta) {
    <span class="hljs-comment">// 上报 + 主动清理缓存</span>
    PaintingBinding.instance.imageCache.clear();
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-16">四、架构层面的内存设计</h3>
<h4 data-id="heading-17">4.1 页面状态的生命周期管理</h4>
<p>我推荐这种分层设计：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 瞬态数据：随 Widget 生死</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_PageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">Page</span>&gt; </span>{
  <span class="hljs-built_in">int</span> _counter = <span class="hljs-number">0</span>; <span class="hljs-comment">// 页面关了就没了</span>
}

<span class="hljs-comment">// 页面级缓存：可恢复，但有生命周期</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-built_in">List</span>&lt;Item&gt; items = [];
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onClose() {
    items.clear(); <span class="hljs-comment">// 显式清理</span>
    <span class="hljs-keyword">super</span>.onClose();
  }
}

<span class="hljs-comment">// 会话级缓存：整个 App 运行期间</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SessionCache</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> userProfile = Rxn&lt;UserProfile&gt;();
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> clear() {
    userProfile.value = <span class="hljs-keyword">null</span>;
  }
}

<span class="hljs-comment">// 持久化：写入磁盘，不占内存</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocalStorage</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; saveData(<span class="hljs-built_in">String</span> key, <span class="hljs-built_in">dynamic</span> data) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> SharedPreferences.getInstance()
      ..setString(key, jsonEncode(data));
  }
}
</code></pre>
<h4 data-id="heading-18">4.2 大数据量的处理策略</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ❌ 一次性加载全部数据</span>
<span class="hljs-keyword">final</span> allItems = <span class="hljs-keyword">await</span> api.getAllItems(); <span class="hljs-comment">// 可能有几万条</span>
setState(() =&gt; _items = allItems);

<span class="hljs-comment">// ✅ 分页 + 虚拟化</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ListState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ItemList</span>&gt; </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Item&gt; _items = [];
  <span class="hljs-built_in">int</span> _page = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">bool</span> _hasMore = <span class="hljs-keyword">true</span>;
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; _loadMore() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (!_hasMore) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">final</span> newItems = <span class="hljs-keyword">await</span> api.getItems(page: _page, size: <span class="hljs-number">20</span>);
    _items.addAll(newItems);
    _page++;
    _hasMore = newItems.length == <span class="hljs-number">20</span>;
    
    <span class="hljs-comment">// 内存保护：超过阈值就清理头部</span>
    <span class="hljs-keyword">if</span> (_items.length &gt; <span class="hljs-number">200</span>) {
      _items.removeRange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
    }
    
    setState(() {});
  }
}
</code></pre>
<h4 data-id="heading-19">4.3 我常用的 dispose 模板</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">mixin</span> AutoDisposeMixin&lt;T <span class="hljs-keyword">extends</span> StatefulWidget&gt; <span class="hljs-keyword">on</span> State&lt;T&gt; {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;StreamSubscription&gt; _subscriptions = [];
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Timer&gt; _timers = [];
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;ChangeNotifier&gt; _notifiers = [];
  
  <span class="hljs-keyword">void</span> autoDisposeStream(StreamSubscription sub) {
    _subscriptions.add(sub);
  }
  
  <span class="hljs-keyword">void</span> autoDisposeTimer(Timer timer) {
    _timers.add(timer);
  }
  
  <span class="hljs-keyword">void</span> autoDisposeNotifier(ChangeNotifier notifier) {
    _notifiers.add(notifier);
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> sub <span class="hljs-keyword">in</span> _subscriptions) {
      sub.cancel();
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> timer <span class="hljs-keyword">in</span> _timers) {
      timer.cancel();
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> notifier <span class="hljs-keyword">in</span> _notifiers) {
      notifier.dispose();
    }
    <span class="hljs-keyword">super</span>.dispose();
  }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyPage</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">AutoDisposeMixin</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    
    autoDisposeStream(
      someStream.listen((data) =&gt; setState(() {})),
    );
    
    autoDisposeTimer(
      Timer.periodic(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>), (_) {}),
    );
    
    <span class="hljs-keyword">final</span> controller = TextEditingController();
    autoDisposeNotifier(controller);
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-20">五、最后的心得</h3>
<p>写了这么多，总结几个核心观点：</p>
<h4 data-id="heading-21">1. 内存问题 80% 出在图片</h4>
<p>不管项目大小，先把图片管好。统一封装、控制尺寸、限制缓存。</p>
<h4 data-id="heading-22">2. dispose 不是万能的</h4>
<p>dispose 只能处理你显式创建的资源。闭包引用、异步回调、全局注册——这些才是真正的坑。</p>
<h4 data-id="heading-23">3. const 是最廉价的优化</h4>
<p>几乎不需要任何成本，收益却很大。我会在 Code Review 时专门检查这个。</p>
<h4 data-id="heading-24">4. 监控比优化更重要</h4>
<p>线上出问题时，你需要的是数据，不是猜测。建立内存监控体系，比写优化代码更有价值。</p>
<h4 data-id="heading-25">5. 保持简单</h4>
<p>很多内存问题，本质上是架构问题——状态管理混乱、数据流复杂、生命周期不清晰。与其补救，不如一开始就设计好。</p>
<hr/>
<p>写到这里，想起十年前刚入行时，为了排查一个 Activity 泄漏，整整看了三天 MAT 分析报告。现在工具好多了，但核心思维是一样的：<strong>理解原理，掌握工具，建立规范</strong>。</p>
<p>希望这篇文章对你有帮助。有问题欢迎交流。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3中使用defineModel]]></title>    <link>https://juejin.cn/post/7590724064521977919</link>    <guid>https://juejin.cn/post/7590724064521977919</guid>    <pubDate>2026-01-04T08:41:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590724064521977919" data-draft-id="7590724064521961535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3中使用defineModel"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-04T08:41:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="周星星日记"/> <meta itemprop="url" content="https://juejin.cn/user/3843548384076462"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3中使用defineModel
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548384076462/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    周星星日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:41:33.000Z" title="Sun Jan 04 2026 08:41:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>是的！从 <strong>Vue 3.4</strong> 开始，Vue 官方引入了 <code>defineModel()</code> 编译宏（macro），<strong>极大简化了组件中实现</strong> <code>v-model</code> <strong>双向绑定的写法</strong>，无需手动声明 <code>props</code> 和 <code>emit</code>，也无需处理 <code>modelValue</code> / <code>update:modelValue</code> 的样板代码。</p>
<p>下面系统讲解 <code>defineModel()</code> 的使用方式、原理、优势和注意事项。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、基础用法：替代</strong> <code>modelValue</code> <strong>+</strong> <code>emit</code></h2>
<h3 data-id="heading-1"><strong>传统写法（Vue 3.0 ～ 3.3）</strong></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'modelValue'</span>])
  <span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, props.<span class="hljs-property">modelValue</span> + <span class="hljs-number">1</span>)
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ props.modelValue }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"update"</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2"><strong>Vue 3.4+ 新写法：</strong> <code>defineModel()</code></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> model = <span class="hljs-title function_">defineModel</span>() <span class="hljs-comment">// 返回一个 ref</span>

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    model.<span class="hljs-property">value</span>++ <span class="hljs-comment">// 直接修改，自动同步到父组件</span>
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Parent bound v-model is: {{ model }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"update"</span>&gt;</span>Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>父组件完全不变：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"count"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>model</code> 是一个 <strong>双向绑定的 ref</strong>：</p>
<ul>
<li>读取 <code>model.value</code> → 获取父组件传入的值</li>
<li>修改 <code>model.value</code> → 自动触发 <code>update:modelValue</code>，更新父组件数据</li>
</ul>
<hr/>
<h2 data-id="heading-3"><strong>二、支持带参数的</strong> <code>v-model</code> <strong>（多模型绑定）</strong></h2>
<p>Vue 支持多个 <code>v-model</code>，例如：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">v-model:name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">v-model:age</span>=<span class="hljs-string">"age"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Parent</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4"><strong>使用</strong> <code>defineModel</code> <strong>实现：</strong></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Child.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">defineModel</span>(<span class="hljs-string">'name'</span>)
  <span class="hljs-keyword">const</span> age = <span class="hljs-title function_">defineModel</span>(<span class="hljs-string">'age'</span>)

  <span class="hljs-comment">// 或者用对象形式（可选）</span>
  <span class="hljs-comment">// const { name, age } = defineModels({ name: String, age: Number })</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"name"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model.number</span>=<span class="hljs-string">"age"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>注意：<code>defineModel('propName')</code> 会自动对应 <code>v-model:propName</code></p>
<hr/>
<h2 data-id="heading-5"><strong>三、类型与默认值（TypeScript / 运行时校验）</strong></h2>
<h3 data-id="heading-6"><strong>1. 指定类型（TypeScript）</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> model = defineModel&lt;<span class="hljs-built_in">string</span>&gt;()
<span class="hljs-comment">// model.value 类型为 string | undefined</span>
</code></pre>
<h3 data-id="heading-7"><strong>2. 设置默认值</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> model = <span class="hljs-built_in">defineModel</span>({ <span class="hljs-keyword">default</span>: <span class="hljs-string">'hello'</span> })
</code></pre>
<h3 data-id="heading-8"><strong>3. 运行时校验 + 默认值</strong></h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">model</span> = <span class="hljs-title function_ invoke__">defineModel</span>({
  <span class="hljs-attr">type</span>: String,
  <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">default</span>: <span class="hljs-string">'default text'</span>
})
</code></pre>
<p>💡 这些选项会<strong>自动转换为等效的</strong> ****<code>props</code> ****<strong>声明</strong>，由 Vue 编译器处理。</p>
<hr/>
<h2 data-id="heading-9"><strong>四、与</strong> <code>useAttrs()</code> <strong>协同工作</strong></h2>
<p>虽然 <code>defineModel()</code> 自动处理了 <code>modelValue</code>，但其他属性仍需透传：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> model = <span class="hljs-title function_">defineModel</span>()
  <span class="hljs-comment">// 如果有多个根节点，或想控制透传位置，才需要 useAttrs</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 单根节点：自动透传 attrs（包括 class/style/@focus 等） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"model"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>如果组件有<strong>多个根节点</strong>，必须手动使用 <code>v-bind="$attrs"</code>，否则 Vue 会警告。</p>
<hr/>
<h2 data-id="heading-10"><strong>五、总结：为什么推荐</strong> <code>defineModel()</code> <strong>？</strong></h2>



































<table><thead><tr><th><strong>对比项</strong></th><th><strong>传统方式</strong></th><th><code>defineModel()</code></th></tr></thead><tbody><tr><td>代码量</td><td>多（props + emits）</td><td>极简（一行）</td></tr><tr><td>易错性</td><td>容易拼错 <code>update:modelValue</code></td><td>零错误</td></tr><tr><td>可读性</td><td>逻辑分散</td><td>聚焦数据流</td></tr><tr><td>封装效率</td><td>低</td><td>高（尤其包装原生元素）</td></tr><tr><td>TypeScript 支持</td><td>需手动标注</td><td>自动推导</td></tr></tbody></table>
<p><strong>一句话</strong>：<br/>
<code>defineModel() </code>****<strong>让组件的双向绑定回归“直觉”——就像操作本地状态一样简单，却能自动同步到父组件。</strong></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3中,我的Watch为什么总监听不到数据?]]></title>    <link>https://juejin.cn/post/7591322050239741990</link>    <guid>https://juejin.cn/post/7591322050239741990</guid>    <pubDate>2026-01-04T09:09:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591322050239741990" data-draft-id="7591293897084469298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3中,我的Watch为什么总监听不到数据?"/> <meta itemprop="keywords" content="前端,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-04T09:09:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该换个名儿了"/> <meta itemprop="url" content="https://juejin.cn/user/2541726615209176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3中,我的Watch为什么总监听不到数据?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726615209176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该换个名儿了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:09:30.000Z" title="Sun Jan 04 2026 09:09:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>vue3中， watch使用 watch(()=&gt;xxx,v=&gt;{})或者watch(xxx,val=&gt;{})时， 总是遇到函数写法的watch监听，数据改变后没有监听到数据改变；非函数的写法反而可以监听到。</p>
</blockquote>
<p>在 Vue 3 中，这两种 <code>watch</code> 的使用方式确实有重要区别：</p>
<h2 data-id="heading-1">1. 语法区别</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方式一：使用函数</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">property</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'值变化了:'</span>, val)
})

<span class="hljs-comment">// 方式二：直接监听响应式对象</span>
<span class="hljs-title function_">watch</span>(obj, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'对象变化了:'</span>, val)
})
</code></pre>
<h2 data-id="heading-2">2. 关键区别</h2>
<h3 data-id="heading-3"><strong>方式一： 函数 <code>() =&gt; xxx</code></strong></h3>
<ul>
<li><strong>监听特定属性</strong>：只追踪 <code>obj.property</code> 这个具体的值</li>
<li><strong>浅层监听</strong>：只有当 <code>obj.property</code> 的值本身发生变化时才触发</li>
<li><strong>不追踪对象引用</strong>：不关心整个 <code>obj</code> 对象的变化</li>
</ul>
<h3 data-id="heading-4"><strong>方式二：直接监听响应式对象 <code>xxx</code></strong></h3>
<ul>
<li><strong>监听整个对象</strong>：追踪对象的所有属性变化</li>
<li><strong>深层监听</strong>：默认深度监听对象内部所有嵌套属性的变化</li>
<li><strong>追踪引用变化</strong>：也会监听对象本身的重新赋值</li>
</ul>
<h2 data-id="heading-5">3. 为什么有时候 "函数的写法监听不到？"</h2>
<h3 data-id="heading-6">情况一：嵌套对象属性变化</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>({ 
  <span class="hljs-attr">nested</span>: { 
    <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> 
  } 
})

<span class="hljs-comment">// ❌ 监听不到 nested.value 的变化</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">nested</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'不会触发'</span>)
})

<span class="hljs-comment">// ✅ 需要深度监听</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">nested</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'会触发'</span>)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// ✅ 或监听具体属性</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">nested</span>.<span class="hljs-property">value</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'会触发'</span>)
})
</code></pre>
<h3 data-id="heading-7">情况二：数组操作</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = <span class="hljs-title function_">reactive</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])

<span class="hljs-comment">// ❌ 监听不到 push/pop 等操作</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> arr.<span class="hljs-property">length</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'可能不会触发'</span>)
})

<span class="hljs-comment">// ✅ 直接监听数组</span>
<span class="hljs-title function_">watch</span>(arr, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'会触发'</span>)
})
</code></pre>
<h3 data-id="heading-8">情况三：解构丢失响应性</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> })

<span class="hljs-comment">// ❌ 解构会丢失响应性</span>
<span class="hljs-keyword">const</span> { x } = obj
<span class="hljs-title function_">watch</span>(x, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> { }) <span class="hljs-comment">// 无效</span>

<span class="hljs-comment">// ✅ 使用 getter 函数</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">x</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'会触发'</span>)
})
</code></pre>
<h2 data-id="heading-9">4. 实践建议</h2>
<h3 data-id="heading-10">使用函数 <code>() =&gt; xxx</code> 的场景：</h3>
<ul>
<li>监听基本类型值（string, number, boolean）</li>
<li>监听对象的特定属性</li>
<li>需要计算或组合的依赖</li>
<li>避免不必要的深度监听</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 监听特定属性</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> user.<span class="hljs-property">name</span>, <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户名变化:'</span>, name)
})

<span class="hljs-comment">// 监听计算值</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> x.<span class="hljs-property">value</span> + y.<span class="hljs-property">value</span>, <span class="hljs-function">(<span class="hljs-params">sum</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'和变化:'</span>, sum)
})
</code></pre>
<h3 data-id="heading-11">使用直接监听 <code>xxx</code> 的场景：</h3>
<ul>
<li>需要监听对象所有变化</li>
<li>监听数组变化</li>
<li>需要深度监听嵌套对象</li>
<li>监听引用变化</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 监听整个响应式对象</span>
<span class="hljs-title function_">watch</span>(state, <span class="hljs-function">(<span class="hljs-params">newState</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态变化:'</span>, newState)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// 监听数组</span>
<span class="hljs-title function_">watch</span>(items, <span class="hljs-function">(<span class="hljs-params">newItems</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'列表变化:'</span>, newItems)
})
</code></pre>
<h2 data-id="heading-12">5. 注意事项</h2>
<h3 data-id="heading-13"><code>ref</code> 对象的处理：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-comment">// ✅ 正确：直接监听 ref</span>
<span class="hljs-title function_">watch</span>(count, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count变化:'</span>, val)
})

<span class="hljs-comment">// ✅ 也正确：通过 .value 监听</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count变化:'</span>, val)
})
</code></pre>
<h3 data-id="heading-14"><code>reactive</code> 对象的处理：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> })

<span class="hljs-comment">// ✅ 推荐：使用 getter 监听特定属性</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">count</span>, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count变化:'</span>, val)
})

<span class="hljs-comment">// ⚠️ 注意：直接监听 reactive 对象会自动开启深度监听</span>
<span class="hljs-title function_">watch</span>(state, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'state变化:'</span>, val) <span class="hljs-comment">// 任何嵌套属性变化都会触发</span>
})
</code></pre>
<h2 data-id="heading-15">总结</h2>
<p>选择哪种方式主要取决于：</p>
<ol>
<li><strong>监听粒度</strong>：需要监听整个对象还是特定属性</li>
<li><strong>性能考虑</strong>：避免不必要的深度监听</li>
<li><strong>数据类型</strong>：基本类型用 getter，复杂对象可直接监听</li>
<li><strong>变化类型</strong>：需要监听引用变化还是值变化</li>
</ol>
<p>当发现监听不到变化时，检查是否是：</p>
<ul>
<li>嵌套对象属性变化（需要 <code>deep: true</code>）</li>
<li>数组方法修改（直接监听数组）</li>
<li>解构导致响应性丢失（使用函数）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[react-nil 逻辑渲染器]]></title>    <link>https://juejin.cn/post/7591207451779121178</link>    <guid>https://juejin.cn/post/7591207451779121178</guid>    <pubDate>2026-01-04T09:04:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591207451779121178" data-draft-id="7590601860300701723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="react-nil 逻辑渲染器"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-04T09:04:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fe小陈"/> <meta itemprop="url" content="https://juejin.cn/user/4019470241892983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            react-nil 逻辑渲染器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4019470241892983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fe小陈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:04:52.000Z" title="Sun Jan 04 2026 09:04:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">初探react-nil：“啥也不渲染”的React渲染器有何用？</h2>
<p>最近在浏览React相关的开源项目时，偶然刷到了一个名为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpmndrs%2Freact-nil" target="_blank" title="https://github.com/pmndrs/react-nil" ref="nofollow noopener noreferrer">react-nil</a> 的自定义React渲染器。点进项目主页，第一眼看到它的核心介绍，我直接愣住了——</p>
<blockquote>
<p>A custom react renderer that renders nothing, null, litterally.</p>
</blockquote>
<p>翻译过来就是“一个啥也不渲染的自定义React渲染器，真的就只返回null”。当下脑子里第一反应就是：这不是脱裤子放屁吗？React的核心价值不就是声明式渲染UI吗？一个连像素都不输出的渲染器，存在的意义是什么？难不成是作者的恶作剧，或者是某个技术实验的半成品？</p>
<p>但转念一想，能被公开放在GitHub上，还被pmndrs（一个知名的React生态组织）维护，肯定不至于这么简单。万一我带着先入为主的偏见错怪它了呢？抱着“不能轻易否定一个不了解的事物”的心态，我强迫自己静下心来，逐字逐句地再细细品读项目文档，试图从字里行间找到它的价值所在。</p>
<p>果然，在核心介绍下方，作者紧接着就给出了补充说明，像是早就预料到会有人质疑一样：</p>
<blockquote>
<p>There are legitimate usecases for null-components, or logical components</p>
</blockquote>
<p>紧接着，一段更详细的解释彻底颠覆了我对“React组件”的固有认知：</p>
<blockquote>
<p>A component has a lifecycle, local state, packs side-effects into useEffect, memoizes calculations in useMemo, orchestrates async ops with suspense, communicates via context, maintains fast response with concurrency. And of course - the entire React eco system is available.</p>
</blockquote>
<p>读完这段，我才恍然大悟：原来作者想强调的，是“逻辑组件”的概念。我们平时写React组件，总是下意识地把“UI渲染”和“逻辑处理”绑定在一起——组件最终要返回JSX，要在页面上呈现出对应的元素。但这个react-nil，恰恰是把“UI渲染”这个环节彻底剥离了，只保留了React组件最核心的逻辑能力。</p>
<p>换句话说，借助react-nil，我们可以创建纯粹的“逻辑组件”。这种组件虽然不产生任何视觉输出，但却能完整地利用React的整个组件生命周期：从挂载、更新到卸载的全流程可控；可以维护自己的local state，不用依赖外部状态管理库就能存储临时逻辑数据；可以通过useEffect封装各种副作用操作，比如数据监听、事件绑定、资源加载与释放；可以用useMemo对复杂计算进行缓存，提升性能；还能借助Suspense协调异步操作，通过Context实现跨组件的逻辑通信，甚至利用React的并发特性保证响应速度。更重要的是，整个React生态系统的工具和库，都能直接为这种逻辑组件服务。</p>
<p>原来如此，它不是“啥也不干”，而是把“干的活”从“渲染UI”转移到了“纯粹的逻辑管理”上。这种将React组件的逻辑能力与UI渲染彻底解耦的思路，确实刷新了我的认知。</p>
<p>放下文档，我开始不由自主地琢磨：既然它能让我们用React组件的方式来管理逻辑对象，那具体能落地到哪些场景呢？脱离了UI的束缚，这种纯粹的逻辑组件，又能解决哪些我们平时开发中遇到的痛点呢？</p>
<h2 data-id="heading-1">将 react-nil 作为一种状态管理方案</h2>
<p>顺着这个思路往下想，一个很关键的应用方向逐渐清晰起来——将react-nil作为一种轻量化的状态管理方案。</p>
<p>在日常的React开发中，我们常常会遇到一个棘手的问题：逻辑（组件）树的形状与视图组件树的形状往往并不一致。比如说，某个页面的视图是由头部导航、内容列表、底部Footer等多个独立UI组件组成的树形结构，但支撑这些视图的业务逻辑（比如用户信息获取、列表数据请求、筛选条件管理等），其依赖关系和组织形态可能完全是另一回事。如果强行把这些逻辑和对应的视图组件绑定在一起，就很容易形成丑陋又难以维护的代码：要么是在无关的UI组件中塞入大量不相关的业务逻辑，让组件变得臃肿不堪；要么是为了共享逻辑而随意提升状态层级，导致“prop drilling”（属性透传）的问题；更有甚者，会出现逻辑代码在多个视图组件中重复编写的情况。这也是为什么我们需要Redux、Zustand、Jotai等外部状态管理库的核心原因——本质上都是为了打破逻辑与视图的强耦合。</p>
<p>而react-nil的出现，恰好为这个问题提供了一种全新的解决思路。我们完全可以将业务逻辑单独抽离出来，通过react-nil来组织成独立的“逻辑组件树”。这些由react-nil驱动的逻辑组件，不需要承担任何UI渲染职责，只专注于业务逻辑的流转、状态的维护和副作用的处理——比如用useState存储核心业务状态，用useEffect发起异步请求并处理数据更新，用useMemo缓存计算结果优化性能。之后，再通过状态订阅的方式，将逻辑组件树中管理的状态精准地传递给需要这些状态的视图组件树。</p>
<p>这样一来，逻辑与视图就实现了彻底的解耦：逻辑组件树可以按照业务逻辑的自然依赖关系自由组织，不用受限于视图的结构；视图组件树则可以纯粹地专注于UI渲染，只需要被动订阅所需的状态，不用关心状态的产生和流转过程。这种分离不仅让代码结构更清晰、维护成本更低，而且相较于传统的外部状态管理库，react-nil完全复用了React自身的API（如useState、useEffect、Context等），不需要我们学习新的语法和概念，开发成本也更低。</p>
<p>举个简单的例子，假设我们开发一个电商商品列表页面，视图上有商品列表组件、筛选器组件、分页组件。支撑这些视图的逻辑包括：商品数据的请求与缓存、筛选条件的变更管理、分页参数的同步等。如果用react-nil来做状态管理，我们就可以创建一个由react-nil驱动的“商品列表逻辑组件”，把数据请求、条件管理等逻辑都封装在这个组件内部；然后通过React Context或者自定义的订阅钩子，让视图层的列表、筛选器、分页组件分别订阅自己需要的状态（列表数据、当前筛选条件、分页信息）。当逻辑组件内部的状态发生变化时，只会通知对应的视图组件更新，既保证了状态流转的清晰，也避免了不必要的UI重渲染。</p>
<h2 data-id="heading-2">思考一个舒服的使用姿势</h2>
<p>基于这样的核心思路，我开始尝试基于react-nil封装一个更易用的逻辑组件模型，让这种“逻辑与视图分离”的开发模式更符合日常开发习惯。结合对 react-nil 能力的粗浅理解，我构思了一套直观的代码用例，核心是通过createModel 函数封装逻辑组件的定义、创建、关联和状态订阅等能力，具体如下：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createModel</span>(<span class="hljs-params">options: <span class="hljs-built_in">any</span></span>) {
    <span class="hljs-comment">// 忽略实现</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-comment">// 初始状态</span>
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, props</span>) =&gt;</span> ({
        <span class="hljs-comment">// ...</span>
    }),
    <span class="hljs-title function_">hook</span>(<span class="hljs-params">state, setState</span>) {
        <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { }, [state.<span class="hljs-property">someProp</span>]);
        <span class="hljs-keyword">const</span> memoState = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> { }, [state.<span class="hljs-property">someProp</span>]);

        <span class="hljs-keyword">return</span> { memoState }
    }
})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">BModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-comment">// ... 同上，忽略</span>
})

<span class="hljs-keyword">await</span> <span class="hljs-title class_">AModel</span>.<span class="hljs-title function_">create</span>(id, {}); <span class="hljs-comment">// 挂载到根组件</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">BModel</span>.<span class="hljs-title function_">create</span>(id2, {}, <span class="hljs-title class_">AModel</span>); <span class="hljs-comment">// 挂载到 AModel 而非全局</span>

<span class="hljs-keyword">const</span> instance = <span class="hljs-title class_">AModel</span>.<span class="hljs-title function_">get</span>(id);

instance.<span class="hljs-title function_">getChildren</span>(<span class="hljs-title class_">BModel</span>); <span class="hljs-comment">// Map</span>
instance.<span class="hljs-title function_">useChildren</span>(<span class="hljs-title class_">BModel</span>); <span class="hljs-comment">// 订阅 Map</span>

instance.<span class="hljs-title function_">removeChildren</span>(<span class="hljs-title class_">BModel</span>, id2); <span class="hljs-comment">// 移除指定挂载的其他逻辑</span>

instance.<span class="hljs-title function_">useState</span>();          <span class="hljs-comment">// 在视图组件中使用 {...state, memoState}</span>
instance.<span class="hljs-title function_">useState</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">memoState</span>);  <span class="hljs-comment">// 支持 selector</span>

instance.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 移除所有挂载的其他逻辑(包括 children)</span>
</code></pre>
<p>这套代码用例的设计思路，完全是为了适配react-nil的“逻辑组件”特性。首先通过createModel函数定义逻辑模型，传入initState用于初始化状态（支持接收id和props动态生成初始值），hook函数则是核心逻辑载体——这里可以直接使用useEffect、useMemo等React Hooks，封装副作用处理和计算缓存逻辑，最终返回需要对外暴露的衍生状态。</p>
<p>在使用层面，通过create方法可以创建逻辑组件实例，并且支持指定父级模型（比如将BModel挂载到AModel下），形成层级化的逻辑组件树，这和React组件树的层级关系逻辑一致，但不涉及任何UI渲染。创建完成后，通过get方法获取实例，就能进行一系列操作：获取或订阅子逻辑组件（getChildren/useChildren）、移除子组件（removeChildren）、订阅状态（useState，支持传入选择器精准订阅部分状态），以及销毁实例（destroy）释放资源。</p>
<p>这样的封装设计，核心是把react-nil的底层能力封装成更贴近业务开发的API。开发者不用直接操作react-nil的渲染逻辑，只需要通过createModel定义业务逻辑，通过实例方法管理状态和组件关系，就能充分利用React的Hooks生态和生命周期能力，同时保持逻辑与视图的彻底分离。</p>
<h2 data-id="heading-3">最后来实现 createModel</h2>
<p>要实现 createModel，核心是围绕 <code>react-nil</code> 的渲染能力，封装实例管理、状态流转、父子关联和订阅响应的逻辑。首先明确依赖：我们需要用到 <code>react-nil</code> 提供的 <code>render</code> 和 <code>createRoot</code>（用于启动逻辑组件的渲染），以及 React 核心的 Hooks（如 <code>useState</code>、<code>useEffect</code>、<code>useMemo</code>），同时需要一个全局存储来管理不同模型、不同 ID 的实例。</p>
<blockquote>
<p>以下代码由豆包根据上面的示例思考生成，未经验证，<strong>不是可用版本</strong>，一定有坑，但作者比较懒，没时间调试。如</p>
<ol>
<li>react-nil 的 render 其实只能有一个容器，下面在 create 内多次调用是有问题的</li>
<li>useState、useChildren 并不是 hook 实现</li>
</ol>
</blockquote>
<p>先梳理核心依赖引入和类型定义（补充基础类型让代码更规范，避免过多 <code>any</code>）：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 引入核心依赖</span>
<span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-nil'</span>;
<span class="hljs-keyword">import</span> { useState, useEffect, useMemo, useSyncExternalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 定义类型，替代 any 提升可读性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">InitStateFn</span>&lt;<span class="hljs-title class_">State</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">Props</span> = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, props: Props</span>) =&gt;</span> <span class="hljs-title class_">State</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">HookFn</span>&lt;<span class="hljs-title class_">State</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">Props</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">DerivedState</span> = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-function">(<span class="hljs-params">
  state: State,
  setState: (updater: (prev: State) =&gt; State) =&gt; <span class="hljs-built_in">void</span>
</span>) =&gt;</span> <span class="hljs-title class_">DerivedState</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">State</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">DerivedState</span> = <span class="hljs-built_in">any</span>&gt; = {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">useState</span>: <span class="hljs-function">(<span class="hljs-params">selector?: (state: State &amp; DerivedState) =&gt; <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>;
  <span class="hljs-attr">getChildren</span>: &lt;<span class="hljs-title class_">ChildState</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">ChildDerived</span> = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">
    model: Model&lt;ChildState, ChildDerived&gt;
  </span>) =&gt;</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">ChildState</span>, <span class="hljs-title class_">ChildDerived</span>&gt;&gt;;
  <span class="hljs-attr">useChildren</span>: &lt;<span class="hljs-title class_">ChildState</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">ChildDerived</span> = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">
    model: Model&lt;ChildState, ChildDerived&gt;
  </span>) =&gt;</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">ChildState</span>, <span class="hljs-title class_">ChildDerived</span>&gt;&gt;;
  <span class="hljs-attr">removeChildren</span>: &lt;<span class="hljs-title class_">ChildState</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">ChildDerived</span> = <span class="hljs-built_in">any</span>&gt;<span class="hljs-function">(<span class="hljs-params">
    model: Model&lt;ChildState, ChildDerived&gt;,
    childId: <span class="hljs-built_in">string</span>
  </span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">destroy</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Model</span>&lt;<span class="hljs-title class_">State</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">DerivedState</span> = <span class="hljs-built_in">any</span>&gt; = {
  <span class="hljs-attr">create</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, props?: <span class="hljs-built_in">any</span>, parent?: ModelInstance</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">DerivedState</span>&gt;&gt;;
  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">DerivedState</span>&gt; | <span class="hljs-literal">undefined</span>;
};
</code></pre>
<p>接下来实现 createModel 核心函数。核心思路是：用「模型 + 实例 ID」作为唯一键，通过全局 Map 存储所有实例；每个实例通过 react-nil 创建根节点，渲染内部逻辑组件（承载 initState、hook 逻辑）；同时暴露一套实例方法供外部调用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> createModel&lt;<span class="hljs-title class_">State</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">Props</span> = <span class="hljs-built_in">any</span>, <span class="hljs-title class_">DerivedState</span> = <span class="hljs-built_in">any</span>&gt;(
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">initState</span>: <span class="hljs-title class_">InitStateFn</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">Props</span>&gt;;
    <span class="hljs-attr">hook</span>: <span class="hljs-title class_">HookFn</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">Props</span>, <span class="hljs-title class_">DerivedState</span>&gt;;
  }
): <span class="hljs-title class_">Model</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">DerivedState</span>&gt; {
  <span class="hljs-comment">// 存储当前模型的所有实例：key = 实例id，value = 实例对象（含根节点、状态、子实例等）</span>
  <span class="hljs-keyword">const</span> instances = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, {
    <span class="hljs-attr">root</span>: <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> createRoot&gt;;
    <span class="hljs-attr">state</span>: <span class="hljs-title class_">State</span> &amp; <span class="hljs-title class_">DerivedState</span>;
    <span class="hljs-attr">setState</span>: <span class="hljs-function">(<span class="hljs-params">updater: (prev: State) =&gt; State</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">children</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Model</span>, <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ModelInstance</span>&gt;&gt;; <span class="hljs-comment">// 子实例：key = 子模型，value = 子实例Map（id =&gt; 实例）</span>
    <span class="hljs-attr">destroy</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  }&gt;();

  <span class="hljs-comment">// 1. 实现 create 方法：创建实例，支持挂载到父实例</span>
  <span class="hljs-keyword">const</span> create = <span class="hljs-keyword">async</span> (<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>, props?: <span class="hljs-title class_">Props</span>, parent?: <span class="hljs-title class_">ModelInstance</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">DerivedState</span>&gt;&gt; =&gt; {
    <span class="hljs-keyword">if</span> (instances.<span class="hljs-title function_">has</span>(id)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Instance with id "<span class="hljs-subst">${id}</span>" already exists`</span>);
    }

    <span class="hljs-comment">// 用于同步状态的临时变量（供外部订阅）</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">currentState</span>: <span class="hljs-title class_">State</span> &amp; <span class="hljs-title class_">DerivedState</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">stateUpdaters</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();

    <span class="hljs-comment">// 定义 react-nil 要渲染的逻辑组件</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">LogicComponent</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-comment">// 1.1 初始化状态</span>
      <span class="hljs-keyword">const</span> [state, setState] = useState&lt;<span class="hljs-title class_">State</span>&gt;(<span class="hljs-function">() =&gt;</span> options.<span class="hljs-title function_">initState</span>(id, props || {} <span class="hljs-keyword">as</span> <span class="hljs-title class_">Props</span>));
      
      <span class="hljs-comment">// 1.2 执行用户传入的 hook 逻辑，获取衍生状态</span>
      <span class="hljs-keyword">const</span> derivedState = options.<span class="hljs-title function_">hook</span>(state, setState);
      
      <span class="hljs-comment">// 1.3 合并原始状态和衍生状态，同步到 currentState</span>
      <span class="hljs-keyword">const</span> combinedState = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({ ...state, ...derivedState }), [state, derivedState]);
      currentState = combinedState;
      
      <span class="hljs-comment">// 1.4 状态变化时通知所有订阅者</span>
      <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        stateUpdaters.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">updater</span> =&gt;</span> <span class="hljs-title function_">updater</span>());
      }, [combinedState]);
      
      <span class="hljs-comment">// 1.5 逻辑组件不渲染任何 UI，返回 null</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };

    <span class="hljs-comment">// 1.6 用 react-nil 创建根节点并渲染逻辑组件</span>
    <span class="hljs-keyword">const</span> root = <span class="hljs-title function_">createRoot</span>(<span class="hljs-literal">null</span>);
    root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LogicComponent</span> /&gt;</span></span>);

    <span class="hljs-comment">// 1.7 定义实例的销毁逻辑</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">destroy</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-comment">// 卸载 react-nil 根节点，触发组件生命周期卸载</span>
      root.<span class="hljs-title function_">unmount</span>();
      <span class="hljs-comment">// 移除当前实例的存储</span>
      instances.<span class="hljs-title function_">delete</span>(id);
      <span class="hljs-comment">// 通知订阅者销毁</span>
      stateUpdaters.<span class="hljs-title function_">clear</span>();
      <span class="hljs-comment">// 从父实例中移除自身（如果有父实例）</span>
      <span class="hljs-keyword">if</span> (parent) {
        <span class="hljs-keyword">const</span> parentData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(instances.<span class="hljs-title function_">values</span>()).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">inst</span> =&gt;</span> 
          <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(inst.<span class="hljs-property">children</span>.<span class="hljs-title function_">values</span>()).<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">childMap</span> =&gt;</span> childMap.<span class="hljs-title function_">has</span>(id))
        );
        <span class="hljs-keyword">if</span> (parentData) {
          parentData.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">childMap, model</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (childMap.<span class="hljs-title function_">has</span>(id)) {
              childMap.<span class="hljs-title function_">delete</span>(id);
            }
          });
        }
      }
    };

    <span class="hljs-comment">// 1.8 存储当前实例数据</span>
    <span class="hljs-keyword">const</span> instanceData = {
      root,
      <span class="hljs-attr">state</span>: currentState,
      <span class="hljs-attr">setState</span>: <span class="hljs-function">(<span class="hljs-params">updater: (prev: State) =&gt; State</span>) =&gt;</span> {
        <span class="hljs-comment">// 触发 LogicComponent 内部的 setState，间接更新 currentState</span>
        <span class="hljs-keyword">const</span> rootElement = root.<span class="hljs-property">_internalRoot</span>?.<span class="hljs-property">current</span>?.<span class="hljs-property">element</span>;
        <span class="hljs-keyword">if</span> (rootElement &amp;&amp; <span class="hljs-keyword">typeof</span> rootElement.<span class="hljs-property">type</span> === <span class="hljs-string">'function'</span>) {
          <span class="hljs-comment">// 通过重新渲染触发状态更新（react-nil 支持重渲染逻辑组件）</span>
          root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LogicComponent</span> /&gt;</span></span>);
        }
      },
      <span class="hljs-attr">children</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Model</span>, <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ModelInstance</span>&gt;&gt;(),
      destroy
    };
    instances.<span class="hljs-title function_">set</span>(id, instanceData);

    <span class="hljs-comment">// 1.9 如果有父实例，将当前实例添加到父实例的子实例列表</span>
    <span class="hljs-keyword">if</span> (parent) {
      <span class="hljs-keyword">const</span> parentId = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(instances.<span class="hljs-title function_">keys</span>()).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> instances.<span class="hljs-title function_">get</span>(key)?.<span class="hljs-property">children</span>);
      <span class="hljs-keyword">if</span> (parentId) {
        <span class="hljs-keyword">const</span> parentInstanceData = instances.<span class="hljs-title function_">get</span>(parentId);
        <span class="hljs-keyword">if</span> (parentInstanceData) {
          <span class="hljs-comment">// 确保父实例的 children 中存在当前模型的键</span>
          <span class="hljs-keyword">if</span> (!parentInstanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">has</span>(createModel <span class="hljs-keyword">as</span> <span class="hljs-title class_">Model</span>)) {
            parentInstanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">set</span>(createModel <span class="hljs-keyword">as</span> <span class="hljs-title class_">Model</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());
          }
          <span class="hljs-comment">// 添加当前实例到父实例的子列表</span>
          parentInstanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(createModel <span class="hljs-keyword">as</span> <span class="hljs-title class_">Model</span>)?.<span class="hljs-title function_">set</span>(id, instance <span class="hljs-keyword">as</span> <span class="hljs-title class_">ModelInstance</span>);
        }
      }
    }

    <span class="hljs-comment">// 1.10 等待首次渲染完成，返回实例对象</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">0</span>));
    <span class="hljs-keyword">const</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">DerivedState</span>&gt; = {
      id,
      <span class="hljs-comment">// 2. 实现 useState：支持订阅状态，可选传入选择器</span>
      <span class="hljs-attr">useState</span>: <span class="hljs-function">(<span class="hljs-params">selector?: (state: State &amp; DerivedState) =&gt; <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-comment">// 利用 useSyncExternalStore 实现状态订阅（React 18+ 推荐）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">useSyncExternalStore</span>(
          <span class="hljs-function">(<span class="hljs-params">onStoreChange</span>) =&gt;</span> {
            stateUpdaters.<span class="hljs-title function_">add</span>(onStoreChange);
            <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> stateUpdaters.<span class="hljs-title function_">delete</span>(onStoreChange);
          },
          <span class="hljs-function">() =&gt;</span> selector ? <span class="hljs-title function_">selector</span>(currentState) : currentState,
          <span class="hljs-function">() =&gt;</span> selector ? <span class="hljs-title function_">selector</span>(currentState) : currentState
        );
      },
      <span class="hljs-comment">// 3. 实现 getChildren：获取指定子模型的所有实例</span>
      <span class="hljs-attr">getChildren</span>: <span class="hljs-function">(<span class="hljs-params">model</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
      },
      <span class="hljs-comment">// 4. 实现 useChildren：订阅指定子模型的实例变化</span>
      <span class="hljs-attr">useChildren</span>: <span class="hljs-function">(<span class="hljs-params">model</span>) =&gt;</span> {
        <span class="hljs-comment">// 订阅子实例变化（这里简化处理，实际可优化为更精细的订阅）</span>
        <span class="hljs-title function_">useSyncExternalStore</span>(
          <span class="hljs-function">(<span class="hljs-params">onStoreChange</span>) =&gt;</span> {
            stateUpdaters.<span class="hljs-title function_">add</span>(onStoreChange);
            <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> stateUpdaters.<span class="hljs-title function_">delete</span>(onStoreChange);
          },
          <span class="hljs-function">() =&gt;</span> instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
          <span class="hljs-function">() =&gt;</span> instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
        );
        <span class="hljs-keyword">return</span> instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
      },
      <span class="hljs-comment">// 5. 实现 removeChildren：移除指定子模型的指定实例</span>
      <span class="hljs-attr">removeChildren</span>: <span class="hljs-function">(<span class="hljs-params">model, childId</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> childMap = instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model);
        <span class="hljs-keyword">if</span> (childMap &amp;&amp; childMap.<span class="hljs-title function_">has</span>(childId)) {
          <span class="hljs-comment">// 销毁子实例</span>
          <span class="hljs-keyword">const</span> childInstance = childMap.<span class="hljs-title function_">get</span>(childId);
          childInstance?.<span class="hljs-title function_">destroy</span>();
          childMap.<span class="hljs-title function_">delete</span>(childId);
        }
      },
      destroy
    };
    <span class="hljs-keyword">return</span> instance;
  };

  <span class="hljs-comment">// 6. 实现 get 方法：获取指定 id 的实例</span>
  <span class="hljs-keyword">const</span> get = (<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ModelInstance</span>&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">DerivedState</span>&gt; | <span class="hljs-function"><span class="hljs-params">undefined</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> instanceData = instances.<span class="hljs-title function_">get</span>(id);
    <span class="hljs-keyword">if</span> (!instanceData) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    <span class="hljs-comment">// 返回实例对象（与 create 中返回的结构一致）</span>
    <span class="hljs-keyword">return</span> {
      id,
      <span class="hljs-attr">useState</span>: <span class="hljs-function">(<span class="hljs-params">selector?</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> selector ? <span class="hljs-title function_">selector</span>(instanceData.<span class="hljs-property">state</span>) : instanceData.<span class="hljs-property">state</span>;
      },
      <span class="hljs-attr">getChildren</span>: <span class="hljs-function">(<span class="hljs-params">model</span>) =&gt;</span> instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
      <span class="hljs-attr">useChildren</span>: <span class="hljs-function">(<span class="hljs-params">model</span>) =&gt;</span> instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
      <span class="hljs-attr">removeChildren</span>: <span class="hljs-function">(<span class="hljs-params">model, childId</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> childMap = instanceData.<span class="hljs-property">children</span>.<span class="hljs-title function_">get</span>(model);
        <span class="hljs-keyword">if</span> (childMap) childMap.<span class="hljs-title function_">delete</span>(childId);
      },
      <span class="hljs-attr">destroy</span>: instanceData.<span class="hljs-property">destroy</span>
    };
  };

  <span class="hljs-keyword">return</span> { create, get };
}
</code></pre>
<h3 data-id="heading-4">实现说明与核心亮点</h3>
<ol>
<li>
<p><strong>依赖与类型封装</strong>：明确引入 <code>react-nil</code> 的 <code>createRoot</code> 用于启动逻辑组件渲染，补充类型定义让代码更易维护，避免滥用 <code>any</code>。</p>
</li>
<li>
<p><strong>实例存储设计</strong>：用 <code>Map</code> 存储当前模型的所有实例，键为实例 ID，值包含 <code>react-nil</code> 根节点、当前状态、状态更新函数、子实例列表和销毁函数，确保实例的全生命周期可控。</p>
</li>
<li>
<p><strong>逻辑组件核心</strong>：内部定义的 <code>LogicComponent</code> 是核心载体——初始化状态（调用用户传入的 <code>initState</code>）、执行业务逻辑（调用 <code>hook</code> 函数）、合并原始状态与衍生状态，且始终返回 <code>null</code> 不渲染 UI，完全契合 <code>react-nil</code> 的特性。</p>
</li>
<li>
<p><strong>状态订阅机制</strong>：利用 React 18+ 推荐的 <code>useSyncExternalStore</code> 实现状态订阅，确保视图组件调用 <code>instance.useState()</code> 时能实时响应状态变化，且支持传入选择器精准订阅部分状态，减少不必要的重渲染。</p>
</li>
<li>
<p><strong>父子实例关联</strong>：创建实例时支持传入父实例，自动将当前实例添加到父实例的子实例列表；销毁实例时自动从父实例中移除，同时卸载 <code>react-nil</code> 根节点，避免内存泄漏。</p>
</li>
</ol>
<p>至此，<code>createModel</code> 的核心实现已完成，完全覆盖了前文构思的所有使用场景，实现了逻辑与视图的彻底分离，同时充分复用了 React 的 Hooks 生态和生命周期能力。（终于可以卸载 zustand 了）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[0成本、0代码、全球CDN:Vercel + Notion快速搭建个人博客]]></title>    <link>https://juejin.cn/post/7591304659132317734</link>    <guid>https://juejin.cn/post/7591304659132317734</guid>    <pubDate>2026-01-04T09:31:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591304659132317734" data-draft-id="7591304659132252198" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="0成本、0代码、全球CDN:Vercel + Notion快速搭建个人博客"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-04T09:31:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员凌览"/> <meta itemprop="url" content="https://juejin.cn/user/3350967174565198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            0成本、0代码、全球CDN:Vercel + Notion快速搭建个人博客
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3350967174565198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员凌览
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:31:38.000Z" title="Sun Jan 04 2026 09:31:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.code24.top%2F" target="_blank" title="https://blog.code24.top/" ref="nofollow noopener noreferrer">凌览</a>。</p>
<ul>
<li>个人网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.code24.top%2F" target="_blank" title="https://blog.code24.top/" ref="nofollow noopener noreferrer">blog.code24.top</a></li>
<li>去水印下载鸭：<a href="https://link.juejin.cn?target=http%3A%2F%2Fnologo.code.top%2F" target="_blank" title="http://nologo.code.top/" ref="nofollow noopener noreferrer">nologo.code.top</a></li>
</ul>
<p>如果本文能给你提供启发或帮助，欢迎动动小手指，一键三连（<code>点赞</code>、<code>评论</code>、<code>转发</code>），给我一些支持和鼓励谢谢。</p>
<h2 data-id="heading-0">前言</h2>
<p>搭个博客，五分钟就能跑起来,但长期维护困难。</p>
<p>第一年有新人补贴，阿里云轻量服务器只要百来块，再配个域名，全套两百搞定，便宜得像白捡。</p>
<p>可优惠券一到期，账单立刻变脸：续费价直接翻倍，低配机型也要六百起跳。</p>
<p>若搭建的网站无法带来收益，对于大多数人会选择不在继续续费。</p>
<p>本文推荐一个开源项目，利用 Vercel 与 Notion 快速搭建网站，仅需自行设置域名即可上线。</p>
<h2 data-id="heading-1">NotionNext</h2>
<p>NotionNext是作者<code>tangly1024</code>在Github上开源的基于Next.js框架开发的博客生成器。目的是帮助写作爱好者们通过Notion笔记快速搭建一个独立站，从而专注于写作、而不需要操心网站的维护。</p>
<p>它将您的Notion笔记渲染成静态的博客页、并托管在Vercel云服务中。与Hexo静态博客相比较不同的是，您无需每次写好的文章都要推送到Github，编写与发布只在您的Notion笔记中完成。</p>
<p>依托于Notion强大的编辑功能，您可以随时随地撰写文章、记录你的创意与灵感，笔记会被自动同步至您的博客站点中。</p>
<p>它是一种几乎零成本的网站搭建方式，您只需要花费几十块钱购买域名的费用，就可以拥有一个独立的网站。</p>
<p>成功案例比如我的个人博客<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.code24.top%2F" target="_blank" title="https://blog.code24.top/" ref="nofollow noopener noreferrer">blog.code24.top/</a>:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ee09f08f7d9491b88351ab3be464ee2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123898&amp;x-signature=3%2FiFgKE3h2iOlxuZyrF%2FIVxQH%2B4%3D" alt="image.png" loading="lazy"/>
<code>tangly1024</code> 作者的网站<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.tangly1024.com%2F" target="_blank" title="https://blog.tangly1024.com/" ref="nofollow noopener noreferrer">blog.tangly1024.com/</a>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1816478c610b4493862968785150d544~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123898&amp;x-signature=F0O1OloGikFyydI%2BfY5Pm0sOZOY%3D" alt="image 1.png" loading="lazy"/></p>
<h2 data-id="heading-2">NotionNext部署</h2>
<p>作者已提供详细的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.tangly1024.com%2Farticle%2Fvercel-deploy-notion-next" target="_blank" title="https://docs.tangly1024.com/article/vercel-deploy-notion-next" ref="nofollow noopener noreferrer">NotionNext部署文档</a>，按照文档指引即可完成部署。</p>
<p>项目采用MIT开源协议，用户可根据自身需求自由修改和定制UI界面。</p>
<p>对于国内用户而言，由于Notion网络访问存在不稳定因素，可能会出现连接超时的情况。虽然通过配置国内域名能够在一定程度上改善访问体验，但图片加载问题仍然存在，因为图片资源主要托管在Notion服务器上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0ddb78ecd024ae98af0a3a987d53a51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768123898&amp;x-signature=xmqzYhw430eCWLO1vIXiTi%2BHBHc%3D" alt="image 2.png" loading="lazy"/></p>
<h2 data-id="heading-3">最后</h2>
<p>我的个人网站基于 NotionNext 搭建，每年仅需支付域名费用，运维成本趋近于零。借助 Vercel 的免费托管与 Notion 的免费数据库，整套方案把服务器、带宽、证书、备份等开销全部省去，真正实现了“零服务器”部署。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hologres高性能写入]]></title>    <link>https://juejin.cn/post/7591129807755903039</link>    <guid>https://juejin.cn/post/7591129807755903039</guid>    <pubDate>2026-01-04T09:36:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591129807755903039" data-draft-id="7591129807755870271" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hologres高性能写入"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T09:36:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="决战灬"/> <meta itemprop="url" content="https://juejin.cn/user/4385295784752855"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hologres高性能写入
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4385295784752855/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    决战灬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:36:21.000Z" title="Sun Jan 04 2026 09:36:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>holoClient.flush()</strong></p>
<p>代码如下：</p>
<pre><code class="hljs language-arduino" lang="arduino">```
@<span class="hljs-built_in">Value</span>(<span class="hljs-string">"${spring.datasource.hologres.jdbc-url:jdbc:postgresql://hgprecn-cn-nwy3e73kt001-cn-shanghai.hologres.aliyuncs.com:80/rjhy_dc_cdp}"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-type">String</span> jdbcUrl;

@<span class="hljs-built_in">Value</span>(<span class="hljs-string">"${spring.datasource.hologres.username:BASIC$dc_cdp_test}"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-type">String</span> username;

@<span class="hljs-built_in">Value</span>(<span class="hljs-string">"${spring.datasource.hologres.password:KUnRu5XCE2V9z_i5}"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-type">String</span> password;

@<span class="hljs-function">Bean
<span class="hljs-keyword">public</span> HoloClient <span class="hljs-title">generateHoloClient</span><span class="hljs-params">()</span> </span>{
    HoloConfig config = <span class="hljs-keyword">new</span> <span class="hljs-built_in">HoloConfig</span>();
    config.<span class="hljs-built_in">setJdbcUrl</span>(jdbcUrl);
    config.<span class="hljs-built_in">setUsername</span>(username);
    config.<span class="hljs-built_in">setPassword</span>(password);
    config.<span class="hljs-built_in">setOnConflictAction</span>(OnConflictAction.<span class="hljs-built_in">fromWriteMode</span>(INSERT_OR_UPDATE));
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">HoloClient</span>(config);
    } <span class="hljs-built_in">catch</span> (HoloClientException e) {
        log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"HoloDataSourceConfig.generateHoloClient, errorMsg:"</span>, e);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(e);
    }
}
```
</code></pre>

<pre><code class="hljs language-ini" lang="ini">@Resource
private HoloClient holoClient<span class="hljs-comment">;</span>

TableSchema <span class="hljs-attr">tableSchema</span> = holoClient.getTableSchema(keyTypeEnums.getTableName())<span class="hljs-comment">;</span>
batchData.forEach(listableBeanFactory -&gt; {
    Put <span class="hljs-attr">put</span> = new Put(tableSchema)<span class="hljs-comment">;</span>
    listableBeanFactory.forEach(put::setObject)<span class="hljs-comment">;</span>
    try {
        holoClient.put(put)<span class="hljs-comment">;</span>
    } catch (HoloClientException e) {
        log.error("holoClient.put(put), errorMsg:", e)<span class="hljs-comment">;</span>
    }
})<span class="hljs-comment">;</span>
holoClient.flush()<span class="hljs-comment">;</span>
</code></pre>
<p><code>holoClient.flush()</code> 的批处理是Hologres写入性能的核心，其底层是一个<strong>分阶段、高度并行化的数据管道</strong>。为了让你直观地理解这个复杂过程，下图描绘了数据从你的Java堆内存出发，直到安全写入Hologres存储引擎的完整旅程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7258447eb47943f99ff2644384e54c7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yaz5oiY54Gs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768124270&amp;x-signature=Pq2fkYoJJSWFCccUGNMWTEUI65s%3D" alt="deepseek_mermaid_20260104_e3c372.png" loading="lazy"/></p>
<p>下面，我们来详解每个阶段的关键设计：</p>
<h3 data-id="heading-0">🔍 第一阶段：客户端内存准备与攒批</h3>
<ol>
<li>
<p><strong>Shard分组缓冲区</strong>：<code>HoloClient</code> 在内存中为<strong>每个目标表的每个Shard</strong>维护了一个独立的缓冲区（<code>RecordBuffer</code>）。当你调用 <code>put(put)</code> 时，客户端会根据表的分布键（如主键）计算该行数据所属的Shard，并将其放入对应的缓冲区。</p>
</li>
<li>
<p><strong>触发条件</strong>：<code>flush()</code> 被调用时，会<strong>立即锁定</strong>所有缓冲区，准备发送。此外，系统也会在以下条件满足时自动触发类似 <code>flush()</code> 的操作：</p>
<ul>
<li><strong>批量大小</strong>：单个缓冲区数据达到 <code>writeBatchSize</code>（默认256）。</li>
<li><strong>数据体积</strong>：缓冲区数据总字节数达到 <code>writeBatchByteSize</code>。</li>
<li><strong>时间阈值</strong>：距离上次发送间隔达到 <code>writeMaxIntervalMs</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">⚙️ 第二阶段：序列化与网络传输</h3>
<ol>
<li><strong>高效序列化</strong>：锁定的缓冲区数据会被<strong>高效地序列化成紧凑的二进制格式</strong>（如Protobuf）。与逐条发送SQL或JSON相比，这极大地减少了网络传输量。</li>
<li><strong>多路复用与并行</strong>：客户端会为每个目标Shard<strong>复用或创建独立的网络连接</strong>，并由专门的写入线程（<code>writeThreadSize</code>控制）<strong>并行发送</strong>这些二进制Batch，充分利用网络带宽。</li>
</ol>
<h3 data-id="heading-2">🚀 第三阶段：服务端Shard并行处理</h3>
<ol>
<li><strong>前端路由</strong>：Hologres的 <code>Frontend</code> 节点接收请求后，会快速解析协议，并根据请求中的Shard信息，将Batch直接路由到对应的<strong>存储节点（<code>Worker Node</code>）</strong> 。</li>
<li><strong>并行事务</strong>：<strong>每个Shard的处理完全独立</strong>。每个Shard收到自己的Batch后，会在一个<strong>轻量级的事务</strong>中处理这批数据。由于Shard间无锁，这是写入能线性扩展的关键。</li>
</ol>
<h3 data-id="heading-3">💾 第四阶段：存储引擎写入与持久化</h3>
<p>这是最核心的阶段，确保数据既快又稳：</p>
<ol>
<li><strong>Write-Ahead Log</strong>：数据写入Shard后，首先被<strong>顺序、同步地追加</strong>到该Shard的WAL中。WAL是<strong>预写式日志</strong>，写入操作一旦成功落盘，数据持久性就已得到保证，即使后续系统崩溃，也能从WAL恢复。这是 <code>flush()</code> 操作<strong>原子性和持久性的基石</strong>。</li>
<li><strong>MemTable更新</strong>：在WAL写入成功后，数据被应用到内存中的 <strong><code>MemTable</code></strong> 。<code>MemTable</code> 是一个<strong>行式存储</strong>的数据结构，数据写入此处后，对读请求就<strong>立即可见</strong>。这也是Hologres写入低延迟的重要原因。</li>
<li><strong>后台异步Compaction</strong>：当 <code>MemTable</code> 增长到一定大小，它会被标记为只读（<code>Immutable MemTable</code>），并由后台线程<strong>异步地</strong>与磁盘上的旧数据进行合并（Compaction），最终转换成高效的<strong>列式存储文件（<code>SSTable</code>）</strong> 。这个过程<strong>不影响前台写入的吞吐和延迟</strong>。</li>
</ol>
<h3 data-id="heading-4">⚡ 性能关键总结</h3>
<ul>
<li><strong>批处理</strong>：客户端攒批极大地减少了网络RPC和事务开销。</li>
<li><strong>Shard并行</strong>：数据分片实现了真正的并行写入，无共享资源竞争。</li>
<li><strong>高效的二进制协议</strong>：紧凑的序列化节省了网络和解析成本。</li>
<li><strong>WAL + MemTable</strong>：顺序写WAL保证持久性，内存写MemTable保证低延迟可见。</li>
<li><strong>读写分离的存储格式</strong>：行存优化写，列存优化读，后台转换互不干扰。</li>
</ul>
<p>因此，当你调用 <code>holoClient.flush()</code> 时，你触发的是一台设计精密的“数据高速列车”，它将离散的数据包在客户端打包成集装箱，通过多条并行轨道（Shard）高速运输，并在目的地（存储节点）经过一个高效的标准化入库流程（WAL -&gt; MemTable），最终安全入库。理解了这一点，你就能更好地通过调整 <code>writeBatchSize</code>、<code>writeThreadSize</code> 等参数来优化你的写入吞吐和延迟。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[刚刚，TRAE宣布，全量免费开放]]></title>    <link>https://juejin.cn/post/7590776324164993024</link>    <guid>https://juejin.cn/post/7590776324164993024</guid>    <pubDate>2026-01-04T07:36:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590776324164993024" data-draft-id="7591075684065034255" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="刚刚，TRAE宣布，全量免费开放"/> <meta itemprop="keywords" content="后端,Trae,Solo"/> <meta itemprop="datePublished" content="2026-01-04T07:36:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="悟空码字"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            刚刚，TRAE宣布，全量免费开放
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    悟空码字
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T07:36:06.000Z" title="Sun Jan 04 2026 07:36:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是小悟。</p>
<p>2026开工第一天，祝大家新年快乐。</p>
<p>新年开工，最舒服的节奏就是工具顺手、门槛够低、选择够多。</p>
<p>TRAE 中国版 SOLO 现在已经对全部用户免费开放，不仅能自由切换模型，还支持接入自定义模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c86a3e679cdc460fb200cb3747f7cb4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116966&amp;x-signature=qpZQ5i91OWIWojAErFYXwqY7bJg%3D" alt="图片" loading="lazy"/></p>
<p>可能有些朋友还不太熟悉 SOLO 是什么。</p>
<p>简单说，它就是 TRAE 中国版里一个挺特别的模式，让你能在一个很干净的界面里，专心跟模型对话。</p>
<p>写代码、处理文本。有点像给你一个私人工作间，工具齐全，还特别安静。</p>
<p>以前要用上它，可能要排队等白名单，还得琢磨一下权限或者费用。但从现在开始，只要你的 TRAE中国版 IDE 更新到最新版本，点进去就能直接切换到 SOLO模式，免费使用。</p>
<p>内置模型包括：Doubao-Seed-Code、GLM-4.7、GLM-4.6、MiniMax-M2.1、MiniMax-M2、Kimi-K2-0905。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6a10e226cdf40b8a6b417c2f9195e99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116966&amp;x-signature=655vZ%2BmLRQrq6v6fYWIx%2FuoGNIY%3D" alt="图片" loading="lazy"/></p>
<p>基本上，覆盖了从代码生成、长文本理解到复杂对话的多种需求。</p>
<p>你完全可以根据手头的事情，挑一个最顺手的来用。比如写脚本可能用这个，分析长文档换那个，很灵活。</p>
<p>更友好的是，它允许你添加自定义模型。</p>
<p>如果你自己有一些特定需求的模型，或者习惯用某个社区的开源模型，现在可以很方便地接进来，在同一个环境里统一调用。</p>
<p>这对一些有深度定制需求的朋友来说，省去了不少切换工具的麻烦。</p>
<p>对于普通用户来说，这就是实打实的便利。不管是写点小工具、处理日常文档，还是学习尝试AI应用，现在都有了更直接、更简单的入口。</p>
<p>总结一下就是：</p>
<p>把 TRAE 中国版 IDE 更新到最新版，直接进入 SOLO 模式就能用，省心省力。</p>
<p>模型多，切换快，内置 6 款模型，覆盖主流编码风格与速度需求，按任务随手切，不用来回折腾。</p>
<p>自定义模型接入，和 IDE 模式一致的添加方式，打开模型列表，底部点添加模型，选择服务商，填入 API Key 即可，灵活度拉满。</p>
<p>上下文窗口自动匹配，系统会基于模型效果与速度自动配置合适的上下文窗口大小。</p>
<p>免费可用，不整虚的，更新后直接进 SOLO 就能开干。</p>
<p>总之，2026年的第一个工作日，以这样一个消息开始，心情还挺不错的。工具的价值就在于被人用起来，而现在，门槛又低了一大截。</p>
<p><strong>谢谢你看我的文章，既然看到这里了，如果觉得不错，随手点个赞、转发、在看三连吧，感谢感谢。那我们，下次再见。</strong></p>
<p>您的一键三连，是我更新的最大动力，谢谢</p>
<p>山水有相逢，来日皆可期，谢谢阅读，我们再会</p>
<p>我手中的金箍棒，上能通天，下能探海</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GetX 状态管理详解]]></title>    <link>https://juejin.cn/post/7591389489412063273</link>    <guid>https://juejin.cn/post/7591389489412063273</guid>    <pubDate>2026-01-04T08:31:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591389489412063273" data-draft-id="7591389489411997737" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GetX 状态管理详解"/> <meta itemprop="keywords" content="Flutter,Android,iOS"/> <meta itemprop="datePublished" content="2026-01-04T08:31:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="妖枪银弹"/> <meta itemprop="url" content="https://juejin.cn/user/3210229685182119"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GetX 状态管理详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3210229685182119/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    妖枪银弹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T08:31:42.000Z" title="Sun Jan 04 2026 08:31:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 GetX 状态管理核心机制</h2>
<p>GetX 的状态管理并非单一方案，而是提供了<strong>三种核心状态管理模式</strong>，兼顾简洁性和灵活性，适配不同业务场景，其核心设计围绕「轻量、无侵入、响应式」展开。</p>
<h3 data-id="heading-1">1.  简单状态管理（GetBuilder：非响应式）</h3>
<p>适用于简单的状态更新场景（如按钮点击刷新文本、列表局部更新），基于<strong>手动触发重建</strong>实现，无响应式依赖，性能开销极低。</p>
<ul>
<li>核心原理：
<ol>
<li>定义 <code>Controller</code> 继承 <code>GetxController</code>，在控制器中维护状态变量，并提供状态更新方法。</li>
<li>通过 <code>update()</code> 方法手动标记状态变更，通知对应的 <code>GetBuilder</code> 进行组件重建。</li>
<li><code>GetBuilder</code> 关联指定控制器，仅在收到 <code>update()</code> 通知时刷新自身布局，不影响其他组件。</li>
</ol>
</li>
<li>代码示例：</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. 定义控制器</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">void</span> increment() {
    count++;
    update(); <span class="hljs-comment">// 手动触发状态更新</span>
  }
}

<span class="hljs-comment">// 2. 在UI中使用</span>
Widget build(BuildContext context) {
  <span class="hljs-comment">// 无需手动初始化控制器，GetX自动管理生命周期</span>
  <span class="hljs-keyword">return</span> GetBuilder&lt;CountController&gt;(
    builder: (controller) {
      <span class="hljs-keyword">return</span> Column(
        children: [
          Text(<span class="hljs-string">"计数：<span class="hljs-subst">${controller.count}</span>"</span>),
          ElevatedButton(
            onPressed: controller.increment,
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">"点击增加"</span>),
          ),
        ],
      );
    },
  );
}
</code></pre>
<h3 data-id="heading-2">2.  响应式状态管理（GetX / Obx：自动响应式）</h3>
<p>适用于复杂状态依赖场景（如网络请求结果刷新、多组件共享状态、实时数据同步），基于<strong>Dart 扩展方法+观察者模式</strong>实现，无需手动调用 <code>update()</code>，状态变更自动触发 UI 重建。</p>
<ul>
<li>核心原理：
<ol>
<li>状态变量通过 <code>.obs</code> 扩展方法转化为「可观察对象（Observable）」，GetX 会监听该对象的所有变更。</li>
<li>使用 <code>Obx</code>（或 <code>GetX</code>）包裹需要响应状态变更的 UI 组件，<code>Obx</code> 作为观察者，订阅可观察对象的状态变化。</li>
<li>当可观察对象的值发生改变时，会自动通知所有订阅它的 <code>Obx</code> 组件，触发局部重建，无需全局刷新。</li>
</ol>
</li>
<li>核心特性：
<ul>
<li>无需继承 <code>GetxController</code>（可直接使用全局变量，也可结合控制器管理）。</li>
<li>支持多种数据类型：基本类型（int/string/bool）、集合类型（List/Map/Set）、自定义对象。</li>
<li>局部重建：仅 <code>Obx</code> 包裹的组件会重建，性能优于全局状态刷新。</li>
</ul>
</li>
<li>代码示例：</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. 定义响应式状态（两种方式：直接使用 / 结合控制器）</span>
<span class="hljs-comment">// 方式1：直接使用全局响应式变量</span>
<span class="hljs-keyword">var</span> userName = <span class="hljs-string">"张三"</span>.obs;

<span class="hljs-comment">// 方式2：结合控制器管理（推荐，便于状态统一维护）</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-keyword">var</span> userAge = <span class="hljs-number">20.</span>obs;
  <span class="hljs-keyword">var</span> userInfo = UserModel(name: <span class="hljs-string">"李四"</span>, age: <span class="hljs-number">25</span>).obs; <span class="hljs-comment">// 自定义对象</span>

  <span class="hljs-keyword">void</span> updateAge() {
    userAge.value++; <span class="hljs-comment">// 注意：基本类型响应式变量需通过 .value 访问/修改</span>
    userInfo.update((info) { <span class="hljs-comment">// 自定义对象批量更新</span>
      info?.age = userAge.value;
    });
  }
}

<span class="hljs-comment">// 2. 在UI中使用 Obx 监听</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">final</span> userController = Get.put(UserController()); <span class="hljs-comment">// 初始化控制器（单例）</span>
  <span class="hljs-keyword">return</span> Column(
    children: [
      Obx(() =&gt; Text(<span class="hljs-string">"用户名：<span class="hljs-subst">${userName.value}</span>"</span>)),
      Obx(() =&gt; Text(<span class="hljs-string">"用户年龄：<span class="hljs-subst">${userController.userAge.value}</span>"</span>)),
      Obx(() =&gt; Text(<span class="hljs-string">"自定义对象年龄：<span class="hljs-subst">${userController.userInfo.value.age}</span>"</span>)),
      ElevatedButton(
        onPressed: () {
          userName.value = <span class="hljs-string">"王五"</span>; <span class="hljs-comment">// 自动触发UI刷新</span>
          userController.updateAge(); <span class="hljs-comment">// 控制器内状态变更，自动刷新</span>
        },
        child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">"更新状态"</span>),
      ),
    ],
  );
}
</code></pre>
<h3 data-id="heading-3">3.  依赖注入式状态管理（Get.put / Get.find：生命周期管理）</h3>
<p>GetX 状态管理的核心支撑能力，通过<strong>内置依赖注入（DI）容器</strong>管理控制器生命周期，无需手动创建和销毁控制器，实现状态的全局共享或局部共享。</p>
<ul>
<li>核心原理：
<ol>
<li><code>Get.put(Controller())</code>：将控制器实例存入 GetX 的 DI 容器，默认全局单例，可指定 <code>tag</code> 实现多实例，或指定 <code>permanent: false</code> 实现自动销毁。</li>
<li><code>Get.find&lt;Controller&gt;()</code>：从 DI 容器中获取已存入的控制器实例，无需跨组件传递。</li>
<li>生命周期绑定：控制器继承 <code>GetxController</code> 后，可重写 <code>onInit()</code>、<code>onReady()</code>、<code>onClose()</code> 方法，对应组件的初始化、就绪、销毁生命周期，自动执行。</li>
</ol>
</li>
<li>核心特性：
<ul>
<li>无需 <code>InheritedWidget</code> 包裹（对比 Provider），无组件嵌套冗余。</li>
<li>支持局部状态：通过 <code>Get.create()</code> 或在路由中传入 <code>binding</code>，实现路由级别的局部状态，路由销毁时自动销毁控制器。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-4">二、 GetX 与 Provider、Bloc 的核心对比</h2>
<h3 data-id="heading-5">1.  核心设计差异</h3>









































<table><thead><tr><th>特性</th><th>GetX</th><th>Provider</th><th>Bloc</th></tr></thead><tbody><tr><td>状态管理模式</td><td>支持3种模式（GetBuilder/Obx/DI），兼顾简单与复杂场景</td><td>单一响应式模式（基于InheritedWidget + ChangeNotifier）</td><td>单一事件驱动模式（基于Stream + Event/State分离）</td></tr><tr><td>核心依赖</td><td>无额外依赖（GetX自身集成）</td><td>依赖 <code>provider</code> 包（基于Flutter原生组件）</td><td>依赖 <code>bloc</code>/<code>flutter_bloc</code> 包（基于Dart Stream）</td></tr><tr><td>组件侵入性</td><td>极低（无需顶层包裹，可按需使用Obx/GetBuilder）</td><td>较高（需顶层包裹 <code>MultiProvider</code>，子组件需 <code>Consumer</code>/<code>Provider.of</code>）</td><td>较高（需 <code>BlocProvider</code> 包裹，子组件需 <code>BlocBuilder</code>/<code>BlocConsumer</code>）</td></tr><tr><td>状态传递方式</td><td>依赖注入（Get.find），无需跨组件层层传递</td><td>基于InheritedWidget，自上而下跨组件传递</td><td>依赖注入（BlocProvider）+ Stream监听，自上而下传递</td></tr><tr><td>事件处理方式</td><td>灵活（可直接调用方法，也可自定义事件）</td><td>简单（调用ChangeNotifier的更新方法）</td><td>严格（Event入参 → Bloc处理 → State输出，单向数据流）</td></tr></tbody></table>
<h3 data-id="heading-6">2.  GetX 的优势</h3>
<h4 data-id="heading-7">（1） 极致简洁，开发效率极高</h4>
<ul>
<li>代码量极少：无需编写大量模板代码（对比 Bloc 的 Event/State/Bloc 三层模板，Provider 的 ChangeNotifier 子类+Consumer 包裹），大幅减少冗余代码。
<ul>
<li>示例：实现一个计数功能，GetX 只需 10 行左右代码，Bloc 需编写 Event（CountIncrementEvent）、State（CountState）、Bloc（CountBloc）三层代码，代码量增加 3-5 倍。</li>
</ul>
</li>
<li>无嵌套地狱：无需顶层包裹 <code>MultiProvider</code>/<code>MultiBlocProvider</code>，解决了 Provider/Bloc 中多层嵌套导致的代码可读性差的问题。</li>
<li>无需上下文（Context）：通过 <code>Get.find()</code> 可在任意位置获取控制器，无需传递 <code>BuildContext</code>，尤其在工具类、网络请求类中使用便捷。</li>
</ul>
<h4 data-id="heading-8">（2） 功能全面，一站式解决方案</h4>
<ul>
<li>状态管理 + 路由管理 + 依赖注入 + 国际化 + 主题管理：GetX 并非单一状态管理库，而是集成了 Flutter 开发所需的核心功能，无需引入多个第三方库（如 Provider 需配合 <code>flutter_route</code>、<code>get_it</code> 实现路由和DI），减少库之间的兼容性问题。</li>
<li>灵活适配场景：简单场景用 GetBuilder（性能最优），复杂场景用 Obx（自动响应式），全局共享用 Get.put（单例），局部共享用路由 Binding（自动销毁），适配所有业务场景。</li>
</ul>
<h4 data-id="heading-9">（3） 性能更优，资源开销更低</h4>
<ul>
<li>局部重建更精准：Obx/GetBuilder 仅刷新自身包裹的组件，且无需遍历 InheritedWidget 树（对比 Provider），减少了布局遍历的性能开销。</li>
<li>控制器自动销毁：GetX 可根据路由生命周期自动销毁控制器（<code>permanent: false</code>），避免 Provider/Bloc 中手动管理控制器生命周期导致的内存泄漏问题。</li>
<li>无 Stream 额外开销：GetX 的响应式状态管理基于自定义 Observable，无需像 Bloc 那样依赖 Stream 流处理，减少了 Stream 订阅/取消订阅的性能开销。</li>
</ul>
<h4 data-id="heading-10">（4） 学习成本更低</h4>
<ul>
<li>无需掌握 Stream 原理：Bloc 强依赖 Dart Stream 知识，对于新手而言，学习成本较高；GetX 无需了解 Stream，只需掌握 <code>.obs</code> 和 <code>Obx</code> 的使用，即可快速上手。</li>
<li>API 设计简洁直观：GetX 的 API 命名清晰（如 Get.put、Get.find、update、Obx），符合开发者的使用习惯，无需记忆复杂的 API 结构。</li>
</ul>
<h3 data-id="heading-11">3.  GetX 的劣势</h3>
<h4 data-id="heading-12">（1） 状态管理过于灵活，团队协作易出规范问题</h4>
<ul>
<li>由于 GetX 支持全局响应式变量（无需控制器）、控制器管理状态、局部状态等多种方式，若团队无统一开发规范，容易出现状态分散、难以维护的问题（如部分状态在全局变量中，部分在控制器中，排查问题时难以定位）。</li>
<li>对比 Bloc：Bloc 的 Event/State 严格分离，强制遵循单向数据流，团队协作时规范统一，即使是大型项目，状态流转也清晰可追溯；Provider 虽灵活，但依赖 InheritedWidget，状态范围相对明确。</li>
</ul>
<h4 data-id="heading-13">（2） 生态成熟度略低于 Provider、Bloc</h4>
<ul>
<li>Provider：作为 Flutter 生态中最早的状态管理库之一，几乎被所有 Flutter 开发者熟知，相关教程、插件、问题解决方案极为丰富，且与 Flutter 原生组件深度兼容。</li>
<li>Bloc：由 Google 团队成员参与维护，生态成熟，支持 <code>bloc_test</code>（单元测试）、<code>flutter_bloc</code>（Flutter 适配）、<code>bloc_concurrency</code>（并发处理）等周边库，在大型企业级项目中应用广泛。</li>
<li>GetX：生态虽在快速发展，但相比 Provider、Bloc，部分小众场景的解决方案较少，且第三方插件对 GetX 的适配度略低。</li>
</ul>
<h4 data-id="heading-14">（3） 不适用于对状态流转有严格要求的大型项目</h4>
<ul>
<li>对于金融、电商等大型企业级项目，状态流转的可追溯性、可测试性要求极高：
<ul>
<li>Bloc 的 Event/State 分离模式，每一次状态变更都对应一个明确的 Event，可通过 <code>bloc_test</code> 轻松编写单元测试，且能通过 DevTools 追踪状态流转过程，便于问题排查。</li>
<li>GetX 的状态更新方式（直接调用方法修改状态），虽然简洁，但状态变更的触发来源难以追溯，单元测试需要额外编写更多代码来模拟状态变更，对于大型项目的维护性略有不足。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-15">（4） 存在“过度封装”的争议，底层可定制性弱</h4>
<ul>
<li>GetX 为了追求简洁，对底层实现进行了大量封装，开发者难以自定义其响应式机制、依赖注入容器的行为。</li>
<li>对比 Provider：基于 Flutter 原生 <code>InheritedWidget</code> 和 <code>ChangeNotifier</code> 实现，开发者可轻松扩展 <code>ChangeNotifier</code> 或自定义 <code>InheritedWidget</code>，实现个性化需求。</li>
<li>对比 Bloc：基于 Stream 实现，开发者可灵活自定义 Stream 控制器、并发策略、状态转换逻辑，底层可定制性极强。</li>
</ul>
<h4 data-id="heading-16">（5） 调试体验略逊于 Bloc</h4>
<ul>
<li>Bloc 提供了专门的 <code>BlocDevTools</code>，可实时监控 Event 发送、State 变更、Bloc 生命周期，便于调试复杂的状态流转问题。</li>
<li>GetX 无官方专属调试工具，状态变更的监控需要手动打印日志或借助 Flutter DevTools，对于复杂的响应式状态依赖，调试效率略低。</li>
</ul>
<h3 data-id="heading-17">4.  补充：Provider、Bloc 的各自优势（对应 GetX 的劣势）</h3>
<ul>
<li><strong>Provider 优势</strong>：
<ol>
<li>与 Flutter 原生深度融合，学习成本低（只需掌握 InheritedWidget 基础概念）。</li>
<li>轻量、稳定，无多余功能，专注于状态管理，适合小型项目或对第三方库依赖敏感的项目。</li>
<li>生态成熟，问题解决方案丰富，新手友好。</li>
</ol>
</li>
<li><strong>Bloc 优势</strong>：
<ol>
<li>严格的单向数据流，状态流转清晰可追溯，适合大型团队协作和企业级项目。</li>
<li>强大的测试能力，便于编写单元测试和集成测试，保证代码质量。</li>
<li>高度可定制化，可灵活扩展底层逻辑，适配复杂业务场景。</li>
<li>官方支持完善，调试工具成熟，生产环境稳定性更高。</li>
</ol>
</li>
</ul>
<h2 data-id="heading-18">三、 选型建议</h2>
<ol>
<li><strong>优先选 GetX</strong>：小型项目、快速迭代项目、个人项目，或团队追求开发效率、希望减少模板代码的场景；适合需要一站式解决状态管理、路由、DI 的场景。</li>
<li><strong>优先选 Provider</strong>：新手入门、对第三方库功能冗余敏感的项目，或需要与 Flutter 原生组件深度兼容的场景；适合小型到中型项目。</li>
<li><strong>优先选 Bloc</strong>：大型企业级项目、金融/电商等对状态可追溯性和可测试性要求极高的场景，或团队需要严格编码规范的场景；适合中型到大型项目。</li>
</ol>
<h2 data-id="heading-19">总结</h2>
<ol>
<li>GetX 状态管理的核心是「3种模式+依赖注入」，兼顾简洁性和灵活性，Obx（响应式）和 GetBuilder（非响应式）适配不同场景，依赖注入实现状态全局/局部共享。</li>
<li>GetX 的核心优势是「开发效率高、代码简洁、功能全面、性能优」，劣势是「规范性弱、生态成熟度略低、大型项目维护性不足」。</li>
<li>Provider 胜在「原生兼容、轻量稳定」，Bloc 胜在「规范严格、可测试性强、大型项目友好」，GetX 胜在「高效简洁、一站式解决方案」，需根据项目规模和团队需求选型。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>