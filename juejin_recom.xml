<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Spring AI å®æˆ˜â€”â€”è¯„ä¼°ç”Ÿæˆç»“æœ]]></title>    <link>https://juejin.cn/post/7570901172526858275</link>    <guid>https://juejin.cn/post/7570901172526858275</guid>    <pubDate>2025-11-10T09:40:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526858275" data-draft-id="7570866247980187700" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AI å®æˆ˜â€”â€”è¯„ä¼°ç”Ÿæˆç»“æœ"/> <meta itemprop="keywords" content="Spring,AIç¼–ç¨‹,LLM"/> <meta itemprop="datePublished" content="2025-11-10T09:40:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•°æ®æ™ºèƒ½è€å¸æœº"/> <meta itemprop="url" content="https://juejin.cn/user/430664289626439"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AI å®æˆ˜â€”â€”è¯„ä¼°ç”Ÿæˆç»“æœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664289626439/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•°æ®æ™ºèƒ½è€å¸æœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:40:14.000Z" title="Mon Nov 10 2025 09:40:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æœ¬ç« å†…å®¹</h2>
<ul>
<li>åˆè¯† Spring AI çš„è¯„ä¼°å™¨ï¼ˆevaluatorsï¼‰</li>
<li>æ£€æŸ¥ç›¸å…³æ€§ï¼ˆrelevancyï¼‰</li>
<li>åˆ¤æ–­å›ç­”çš„æ­£ç¡®æ€§ï¼ˆcorrectnessï¼‰</li>
<li>åœ¨è¿è¡Œæ—¶åº”ç”¨è¯„ä¼°å™¨</li>
</ul>
<p>ä¸ºä½ çš„ä»£ç ç¼–å†™æµ‹è¯•æ˜¯ä¸€ç§é‡è¦å®è·µã€‚è‡ªåŠ¨åŒ–æµ‹è¯•ä¸ä»…èƒ½ç¡®ä¿åº”ç”¨æ²¡æœ‰è¢«ç ´åï¼Œè¿˜èƒ½æä¾›æœ‰åŠ©äºè®¾è®¡ä¸å®ç°çš„åé¦ˆã€‚å¯¹åº”ç”¨ä¸­çš„<strong>ç”Ÿæˆå¼ AI ç»„ä»¶</strong>è¿›è¡Œæµ‹è¯•ï¼Œä¸æ¯«ä¸æ¯”å…¶ä»–éƒ¨åˆ†çš„æµ‹è¯•ä¸é‡è¦ã€‚</p>
<p>åªæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä½ æŠŠç›¸åŒçš„æç¤ºå¤šæ¬¡å‘é€ç»™ä¸€ä¸ª LLMï¼Œä½ å¾ˆå¯èƒ½æ¯æ¬¡éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç­”æ¡ˆã€‚ç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>æ„å‘³ç€æµ‹è¯•ä¸­æ— æ³•é‡‡ç”¨â€œæ–­è¨€ç›¸ç­‰ï¼ˆassert equalsï¼‰â€çš„å¥—è·¯ã€‚</p>
<p>åœ¨ç¬¬ 1 ç« é‡Œï¼Œä½ çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ <strong>WireMock</strong> æ¥æ¨¡æ‹Ÿ API çš„å“åº”ï¼Œä»è€Œåœ¨æµ‹è¯•ä¸­è·å¾—<strong>ç¡®å®šæ€§çš„</strong>ç»“æœã€‚è¿™ç§æµ‹è¯•æ–¹å¼éå¸¸é€‚åˆæµ‹è¯•â€œå›´ç»•å‘ç”Ÿæˆå¼ AI API å‘èµ·è¯·æ±‚â€çš„ä»£ç ï¼Œä½†å®ƒå¹¶ä¸èƒ½æµ‹è¯•<strong>æç¤ºæœ¬èº«</strong>ä»¥åŠæ¨¡å‹å¦‚ä½•å¯¹è¯¥æç¤ºä½œå‡ºå“åº”ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring AI æä¾›äº†å¦ä¸€ç§åˆ¤æ–­â€œç”Ÿæˆå“åº”æ˜¯å¦å¯æ¥å—â€çš„æ–¹å¼ï¼š<strong>è¯„ä¼°å™¨ï¼ˆEvaluatorsï¼‰</strong> ã€‚</p>
<p>ä¸€ä¸ª<strong>è¯„ä¼°å™¨</strong>ä¼šæ‹¿åˆ°æäº¤ç»™ LLM çš„æç¤ºä¸­çš„ç”¨æˆ·æ–‡æœ¬ï¼Œä»¥åŠæ¨¡å‹è¿”å›çš„å†…å®¹ï¼Œç„¶åæ®æ­¤åˆ¤æ–­è¿™ä»½å“åº”å†…å®¹æ˜¯å¦é€šè¿‡æŸäº›å‡†åˆ™ã€‚ä»å†…éƒ¨æœºåˆ¶çœ‹ï¼Œè¯„ä¼°å™¨å¯ä»¥ç”¨ä»»ä½•é€‚åˆå…¶è¯„ä¼°ç±»å‹çš„æ–¹å¼å®ç°ã€‚ä½†å¦‚å›¾ 2.1 æ‰€ç¤ºï¼Œè¯„ä¼°å™¨é€šå¸¸ä¼š**å€ŸåŠ©ä¸€ä¸ª LLMï¼ˆé€šè¿‡ ChatClientï¼‰**æ¥åˆ¤æ–­ç”Ÿæˆçš„å“åº”ä¸æ‰€æäº¤æç¤ºä¹‹é—´çš„å¥‘åˆåº¦ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f81731ace774ceb9bf9b4be09adc02b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763372413&amp;x-signature=y30vXdbCZqbHl%2FEgAco4CH6BmiA%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 2.1</strong> Spring AI è¯„ä¼°å™¨æŠŠæç¤ºä¸ç”Ÿæˆçš„å“åº”ä¸€å¹¶å‘é€ç»™ LLMï¼Œä»¥è¯„ä¼°å“åº”è´¨é‡ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¯„ä¼°å™¨ï¼Œä¸º <strong>BoardGameService</strong>ï¼ˆBoard Game Buddy åº”ç”¨ä¸­ä½¿ç”¨ç”Ÿæˆå¼ AI çš„é‚£ä¸ªç»„ä»¶ï¼‰ç¼–å†™ä¸€ä»½<strong>é›†æˆæµ‹è¯•</strong>ã€‚</p>
<h2 data-id="heading-1">2.1 ç¡®ä¿ç­”æ¡ˆç›¸å…³ï¼ˆEnsuring relevant answersï¼‰</h2>
<p>æœ€åŸºç¡€çš„è¯„ä¼°å½¢å¼ï¼Œå°±æ˜¯åˆ¤æ–­ LLM æ˜¯å¦å›ç­”äº†<strong>æ‰€æçš„é—®é¢˜</strong>ã€‚ä¹Ÿå°±æ˜¯ï¼šç”Ÿæˆçš„å“åº”<strong>è‡³å°‘ä¸æç¤ºåŒä¸€è¯é¢˜</strong>å—ï¼Ÿ</p>
<p>ä¾‹å¦‚ï¼Œç”¨æˆ·é—® â€œWhy is the sky blue?â€ï¼ŒLLM å›ç­” â€œBecause of Rayleigh scatteringâ€ï¼ˆæˆ–ç±»ä¼¼å›ç­”ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªç­”æ¡ˆæ˜¯<strong>ç›¸å…³çš„</strong>ã€‚åä¹‹ï¼Œè‹¥ LLM å›ç­” â€œThe moon is approximately 239,900 miles from Earth.â€ï¼Œå°½ç®¡å®ƒå¯èƒ½æ˜¯æ­£ç¡®äº‹å®ï¼Œä½†<strong>ä¸å¤©ç©ºä¸ºä½•æ˜¯è“è‰²</strong>è¿™ä¸€é—®é¢˜<strong>ä¸ç›¸å…³</strong>ã€‚</p>
<p>åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦ä¸ç»™å®šé—®é¢˜ç›¸å…³ï¼Œæ­£æ˜¯ Spring AI çš„ <strong>RelevancyEvaluator</strong> è¦åšçš„äº‹ã€‚ä¸ºäº†ç†è§£å®ƒå¦‚ä½•å·¥ä½œï¼Œè®©æˆ‘ä»¬ç”¨å®ƒæ¥ä¸º <strong>BoardGameService</strong> å†™ä¸€ä¸ªæµ‹è¯•ã€‚ä¸‹é¢çš„æ¸…å•å±•ç¤ºäº†è¯¥æµ‹è¯•ç±»ã€‚</p>
<p><strong>æ¸…å• 2.1 æµ‹è¯• LLM çš„å“åº”æ˜¯å¦ä¸é—®é¢˜ç›¸å…³</strong></p>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">boardgamebuddy</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">assertj</span>.<span class="hljs-property">core</span>.<span class="hljs-property">api</span>.<span class="hljs-property">Assertions</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">junit</span>.<span class="hljs-property">jupiter</span>.<span class="hljs-property">api</span>.<span class="hljs-property">BeforeEach</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">junit</span>.<span class="hljs-property">jupiter</span>.<span class="hljs-property">api</span>.<span class="hljs-property">Test</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">client</span>.<span class="hljs-property">ChatClient</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">evaluation</span>.<span class="hljs-property">RelevancyEvaluator</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">evaluation</span>.<span class="hljs-property">EvaluationRequest</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">evaluation</span>.<span class="hljs-property">EvaluationResponse</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">test</span>.<span class="hljs-property">context</span>.<span class="hljs-property">SpringBootTest</span>;

<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameServiceTests</span> {

  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">BoardGameService</span> boardGameService;

  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">ChatClient</span>.<span class="hljs-property">Builder</span> chatClientBuilder;

  <span class="hljs-keyword">private</span> <span class="hljs-title class_">RelevancyEvaluator</span> relevancyEvaluator;

  <span class="hljs-meta">@BeforeEach</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">relevancyEvaluator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RelevancyEvaluator</span>(chatClientBuilder);
  }

  <span class="hljs-meta">@Test</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">evaluateRelevancy</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">String</span> userText = <span class="hljs-string">"Why is the sky blue?"</span>;
    <span class="hljs-title class_">Question</span> question = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Question</span>(userText);
    <span class="hljs-title class_">Answer</span> answer = boardGameService.<span class="hljs-title function_">askQuestion</span>(question);

    <span class="hljs-title class_">EvaluationRequest</span> evaluationRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EvaluationRequest</span>(
        userText, answer.<span class="hljs-title function_">answer</span>());

    <span class="hljs-title class_">EvaluationResponse</span> response = relevancyEvaluator
        .evaluate(evaluationRequest);

    <span class="hljs-title class_">Assertions</span>.<span class="hljs-title function_">assertThat</span>(response.<span class="hljs-title function_">isPass</span>())
        .<span class="hljs-title function_">withFailMessage</span>(<span class="hljs-string">""</span><span class="hljs-string">"
          ========================================
          The answer "</span>%s<span class="hljs-string">"
          is not considered relevant to the question
          "</span>%s<span class="hljs-string">".
          ========================================
          "</span><span class="hljs-string">""</span>, answer.<span class="hljs-title function_">answer</span>(), userText)
        .<span class="hljs-title function_">isTrue</span>();
  }

}
</code></pre>
<p>é˜…è¯» <code>SpringAiBoardGameServiceTests</code> å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•å‰å‡ è¡Œåœ¨åš<strong>è¯„ä¼°æ‰€éœ€çš„å‡†å¤‡</strong>ã€‚ç±»ä¸Šæ ‡æ³¨äº† <code>@SpringBootTest</code>ï¼Œè¡¨æ˜è¿™æ˜¯<strong>é›†æˆæµ‹è¯•</strong>ï¼šä¼šåˆ›å»ºä¸€ä¸ª Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«åº”ç”¨ä¸­çš„æ‰€æœ‰ beanï¼‰ã€‚ä»è¯¥ä¸Šä¸‹æ–‡ä¸­ï¼Œé€šè¿‡ <code>@Autowired</code> æ³¨å…¥äº† <code>BoardGameService</code> ä¸ <code>ChatClient.Builder</code>ã€‚éšååœ¨ <code>setup()</code> æ–¹æ³•é‡Œï¼Œç”¨ <code>ChatClient.Builder</code> åˆ›å»ºäº†ä¸€ä¸ª <code>RelevancyEvaluator</code>ï¼Œä»¥ä¾›æµ‹è¯•æ–¹æ³•ä½¿ç”¨ã€‚</p>
<p><code>evaluateRelevancy()</code> æµ‹è¯•æ–¹æ³•é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>Question</code>ï¼Œå¹¶å°†å…¶å‘é€ç»™æ³¨å…¥çš„ <code>BoardGameService#askQuestion()</code> æ¥è·å¾— <code>Answer</code>ã€‚æ¥ç€ç”¨åŸå§‹ç”¨æˆ·æ–‡æœ¬ä¸ç­”æ¡ˆåˆ›å»º <code>EvaluationRequest</code>ï¼Œä¼ ç»™ <code>RelevancyEvaluator#evaluate()</code>ã€‚å…¶å†…éƒ¨ä¼šå‘ LLM å‘é€ä¸€ä¸ªæç¤ºï¼Œè¦æ±‚å®ƒåˆ¤æ–­<strong>ç­”æ¡ˆä¸é—®é¢˜çš„ç›¸å…³æ€§</strong>ã€‚</p>
<p><code>evaluate()</code> è¿”å› <code>EvaluationResponse</code>ï¼Œéšåè°ƒç”¨ <code>isPass()</code> åˆ¤æ–­è¯„ä¼°æ˜¯å¦é€šè¿‡ã€‚è‹¥è¿”å› <code>true</code>ï¼Œè¯´æ˜ç­”æ¡ˆè¢«è®¤ä¸ºä¸é—®é¢˜ç›¸å…³ï¼›å¦åˆ™è¿”å› <code>false</code>ï¼Œè¡¨ç¤ºä¸ç›¸å…³ï¼Œæ–­è¨€å¤±è´¥ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæµ‹è¯•ï¼Œä½ å°±èƒ½<strong>å¿«é€Ÿã€è‡ªåŠ¨</strong>æ£€æŸ¥ï¼šé€šè¿‡ <code>SpringAiBoardGameService#askQuestion()</code> æå‡ºçš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦å¾—åˆ°<strong>å¥‘åˆè¯é¢˜</strong>çš„å›ç­”ã€‚å½“ç„¶ï¼Œ<strong>ç›¸å…³</strong>å¹¶ä¸ç­‰äº<strong>æ­£ç¡®</strong>ã€‚æˆ‘ä»¬å†æŠŠæµ‹è¯•æå‡ä¸€æ¡£ï¼Œæ£€æŸ¥ç­”æ¡ˆæ˜¯å¦<strong>æ­£ç¡®</strong>ã€‚</p>
<h2 data-id="heading-2">2.2 æµ‹è¯•äº‹å®æ­£ç¡®æ€§ï¼ˆTesting for factual accuracyï¼‰</h2>
<p>å‡è®¾å½“è¢«é—®åˆ°â€œå¤©ç©ºä¸ºä»€ä¹ˆæ˜¯è“è‰²â€æ—¶ï¼ŒLLM å›ç­”ï¼šâ€œThe sky is blue because there are a gazillion tiny bubbles filled with blueberry jam floating in the atmosphere.â€ï¼ˆå¤©ç©ºä¹‹æ‰€ä»¥è“ï¼Œæ˜¯å› ä¸ºå¤§æ°”ä¸­æ¼‚æµ®ç€æ— æ•°è£…æ»¡è“è“é…±çš„å°æ°”æ³¡ã€‚ï¼‰è¿™ä¸ªå›ç­”çœ‹èµ·æ¥<strong>ç›¸å…³</strong>ï¼Œä½†æ˜¾ç„¶<strong>ä¸æ­£ç¡®</strong>ã€‚å®ƒä¹Ÿè®¸èƒ½â€œèº²è¿‡â€ <code>RelevancyEvaluator</code> çš„æ³•çœ¼ï¼Œä½†å¹¶ä¸é€‚åˆç›´æ¥å±•ç¤ºç»™ä½ çš„ç”¨æˆ·ã€‚</p>
<p>Spring AI çš„ <strong>FactCheckingEvaluator</strong> ä¸ <code>RelevancyEvaluator</code> ç±»ä¼¼ï¼Œä½†å®ƒä¸æ˜¯è®© LLM åˆ¤æ–­<strong>ç›¸å…³æ€§</strong>ï¼Œè€Œæ˜¯è®© LLM åˆ¤æ–­è¿™ä¸ªå›ç­”æ˜¯å¦<strong>æ­£ç¡®åœ°å›ç­”</strong>äº†é—®é¢˜ã€‚</p>
<p>åœ¨æŠŠäº‹å®æ­£ç¡®æ€§æµ‹è¯•åŠ è¿› <code>SpringAiBoardGameServiceTests</code> ä¹‹å‰ï¼Œéœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹ <code>setup()</code> æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª <code>FactCheckingEvaluator</code> å¹¶èµ‹ç»™å®ä¾‹å˜é‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title class_">FactCheckingEvaluator</span> factCheckingEvaluator;

  <span class="hljs-meta">@BeforeEach</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">relevancyEvaluator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RelevancyEvaluator</span>(chatClientBuilder);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">factCheckingEvaluator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FactCheckingEvaluator</span>(
        chatClientBuilder);
  }
</code></pre>
<p>ç°åœ¨ç¼–å†™äº‹å®æ ¸æŸ¥æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@Test
  public void evaluateFactualAccuracy() {
    var <span class="hljs-attr">userText</span> = <span class="hljs-string">"Why is the sky blue?"</span><span class="hljs-comment">;</span>
    var <span class="hljs-attr">question</span> = new Question(userText)<span class="hljs-comment">;</span>
    var <span class="hljs-attr">answer</span> = boardGameService.askQuestion(question)<span class="hljs-comment">;</span>

    var <span class="hljs-attr">evaluationRequest</span> =
            new EvaluationRequest(userText, answer.answer())<span class="hljs-comment">;</span>

    var <span class="hljs-attr">response</span> =
            factCheckingEvaluator.evaluate(evaluationRequest)<span class="hljs-comment">;</span>

    Assertions.assertThat(response.isPass())
        .withFailMessage("<span class="hljs-attr">""</span>

          ========================================
          The answer "%s"
          is not considered correct for the question
          "%s".
          ========================================
          """, answer.answer(), userText)
        .isTrue()<span class="hljs-comment">;</span>
  }
</code></pre>
<p><code>evaluateFactualAccuracy()</code> ä¸ä¹‹å‰çš„ <code>evaluateRelevancy()</code> å¾ˆç›¸ä¼¼ã€‚ä¸ç›¸å…³æ€§æµ‹è¯•ä¸€æ ·ï¼Œä»ç„¶é€šè¿‡ <code>EvaluationResponse#isPass()</code> è¿›è¡Œæ–­è¨€ï¼šè‹¥ç”Ÿæˆçš„ç­”æ¡ˆè¢«åˆ¤å®šä¸º<strong>ä¸æ­£ç¡®</strong>ï¼Œæ–­è¨€å°±ä¼šå¤±è´¥ã€‚</p>
<p>å½“ <code>isPass()</code> è¿”å› <code>false</code> å¯¼è‡´æ–­è¨€å¤±è´¥æ—¶ï¼Œå¤±è´¥ä¿¡æ¯ä¼šè§£é‡ŠåŸå› ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç”Ÿæˆçš„ç­”æ¡ˆæ˜¯ â€œThere are tiny bubbles filled with blueberry jam high in the atmosphere.â€ï¼Œé‚£ä¹ˆ <code>FactCheckingEvaluator</code> ä¼šåˆ¤å®šè¯¥å›ç­”<strong>ä¸æ­£ç¡®</strong>ï¼Œæ–­è¨€å¤±è´¥ï¼Œè¾“å‡ºçš„å¤±è´¥ä¿¡æ¯å¯èƒ½å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">========================================
The answer <span class="hljs-string">"The sky is blue because there are a gazillion tiny bubbles filled
with blueberry jam floating in the atmosphere."</span>
<span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> considered correct <span class="hljs-keyword">for</span> the question
<span class="hljs-string">"Why is the sky blue?"</span>.
========================================
</code></pre>
<p>åœ¨é€šè¯»æœ¬ä¹¦çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå¯¹<strong>å‘é€ç»™ LLM çš„æç¤º</strong>åšå‡ºè®¸å¤šæ”¹åŠ¨ã€‚å€ŸåŠ© <code>evaluateRelevancy()</code> ä¸ <code>evaluateFactualAccuracy()</code> è¿™æ ·çš„æµ‹è¯•ï¼Œä½ å¯ä»¥ç¡®ä¿ï¼š<strong>æ— è®ºæç¤ºå¦‚ä½•è°ƒæ•´</strong>ï¼Œä¾ç„¶èƒ½è·å¾—<strong>æ°å½“ä¸”æ­£ç¡®</strong>çš„å›ç­”ã€‚</p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œè¿˜æœ‰ä¸€ç‚¹å¯èƒ½ä¸é‚£ä¹ˆæ˜¾è€Œæ˜“è§ï¼šä½ ä¹Ÿè®¸ä¼šå¸Œæœ›åœ¨<strong>æµ‹è¯•ä¹‹å¤–ï¼ˆè¿è¡Œæ—¶ï¼‰<strong>ä½¿ç”¨è¯„ä¼°å™¨ï¼Œä»¥ç¡®ä¿å®é™…è¿è¡Œä¸­è¿”å›ç»™ç”¨æˆ·çš„å›ç­”åŒæ ·</strong>ç›¸å…³</strong>ä¸”<strong>æ­£ç¡®</strong>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨åº”ç”¨ä»£ç ä¸­<strong>ç›´æ¥åº”ç”¨è¯„ä¼°å™¨</strong>ã€‚</p>
<h2 data-id="heading-3">2.3 åœ¨è¿è¡Œæ—¶åº”ç”¨è‡ªè¯„ä¼°ï¼ˆApplying self-evaluation at runtimeï¼‰</h2>
<p>å³ä½¿åœ¨æ„å»ºåº”ç”¨æ—¶åŸºäºè¯„ä¼°å™¨çš„æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œ<strong>è¿è¡Œæ—¶</strong>ä»å¯èƒ½å‡ºç°<strong>ä¸ç›¸å…³</strong>æˆ–<strong>ä¸æ­£ç¡®</strong>çš„å›ç­”ã€‚ç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>æ„å‘³ç€ï¼šæµ‹è¯•é˜¶æ®µä¹Ÿè®¸â€œè¿æ°”ä¸é”™â€æ‹¿åˆ°äº†å¥½å›ç­”ï¼Œä½†åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶æƒ…å†µå´å¯èƒ½â€œè·‘åâ€ã€‚åœ¨è¿è¡Œæ—¶åº”ç”¨è¯„ä¼°å™¨ï¼Œå¯ä»¥å¸®åŠ©é¿å…æŠŠç³Ÿç³•ç­”æ¡ˆè¿”å›ç»™åº”ç”¨ç”¨æˆ·ã€‚</p>
<p>äº‹å®è¯æ˜ï¼Œè¯„ä¼°å™¨å¹¶<strong>ä¸é™äº</strong>ç”¨äºé›†æˆæµ‹è¯•ã€‚ä¸‹é¢çš„æ¸…å•å±•ç¤ºäº†å¦‚ä½•æŠŠ <strong>RelevancyEvaluator</strong> ä¸ <strong>Spring Retry</strong> ç»“åˆï¼Œé¿å…è¿”å›ä¸ç”¨æˆ·é—®é¢˜<strong>ä¸ç›¸å…³</strong>çš„ç­”æ¡ˆã€‚</p>
<p><strong>æ¸…å• 2.2 åœ¨è¿è¡Œæ—¶ä»£ç ä¸­æ ¡éªŒç›¸å…³æ€§ï¼ˆVerifying relevancy in runtime codeï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.evaluation.RelevancyEvaluator;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.prompt.ChatOptions;
<span class="hljs-keyword">import</span> org.springframework.ai.evaluation.EvaluationRequest;
<span class="hljs-keyword">import</span> org.springframework.ai.evaluation.EvaluationResponse;
<span class="hljs-keyword">import</span> org.springframework.retry.annotation.Recover;
<span class="hljs-keyword">import</span> org.springframework.retry.annotation.Retryable;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelfEvaluatingBoardGameService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RelevancyEvaluator evaluator;

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">SelfEvaluatingBoardGameService</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">chatOptions</span> <span class="hljs-operator">=</span> ChatOptions.builder()
        .model(<span class="hljs-string">"gpt-4o-mini"</span>)
        .build();

    <span class="hljs-built_in">this</span>.chatClient = chatClientBuilder
        .defaultOptions(chatOptions)
        .build();

    <span class="hljs-built_in">this</span>.evaluator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RelevancyEvaluator</span>(chatClientBuilder);
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-meta">@Retryable(retryFor = AnswerNotRelevantException.class)</span>
  <span class="hljs-keyword">public</span> Answer <span class="hljs-title function_">askQuestion</span><span class="hljs-params">(Question question)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">answerText</span> <span class="hljs-operator">=</span> chatClient.prompt()
        .user(question.question())
        .call()
        .content();

    evaluateRelevancy(question, answerText);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(answerText);
  }

  <span class="hljs-meta">@Recover</span>
  <span class="hljs-keyword">public</span> Answer <span class="hljs-title function_">recover</span><span class="hljs-params">(AnswerNotRelevantException e)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(<span class="hljs-string">"I'm sorry, I wasn't able to answer the question."</span>);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">evaluateRelevancy</span><span class="hljs-params">(Question question, String answerText)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">evaluationRequest</span> <span class="hljs-operator">=</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">EvaluationRequest</span>(question.question(), answerText);
    <span class="hljs-type">var</span> <span class="hljs-variable">evaluationResponse</span> <span class="hljs-operator">=</span> evaluator.evaluate(evaluationRequest);
    <span class="hljs-keyword">if</span> (!evaluationResponse.isPass()) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnswerNotRelevantException</span>(question.question(), answerText);
    }
  }

}
</code></pre>
<p><code>SelfEvaluatingBoardGameService</code> ä¸ <code>SpringAiBoardGameService</code> å¾ˆç›¸ä¼¼ï¼Œåªæ˜¯ <code>askQuestion()</code> æ–¹æ³•ä¸Šæ·»åŠ äº† <code>@Retryable</code> æ³¨è§£ã€‚è¿™ä¸ªæ¥è‡ª <strong>Spring Retry</strong> çš„æ³¨è§£è¡¨ç¤ºï¼šå¦‚æœè¯¥æ–¹æ³•æŠ›å‡ºäº† <code>AnswerNotRelevantException</code>ï¼Œåˆ™<strong>é‡è¯•</strong>è¯¥æ–¹æ³•ã€‚</p>
<p>åœ¨ <code>askQuestion()</code> ä¸­ï¼Œä¼šè°ƒç”¨ <code>evaluateRelevancy()</code> æ¥è¿›è¡Œç›¸å…³æ€§è¯„ä¼°ã€‚<code>evaluateRelevancy()</code> ä½¿ç”¨æ„é€ å™¨é‡Œåˆ›å»ºçš„ <code>RelevancyEvaluator</code>ã€‚è‹¥ <code>isPass()</code> è¿”å› <code>false</code>ï¼Œ<code>evaluateRelevancy()</code> ä¼šæŠ›å‡º <code>AnswerNotRelevantException</code>ï¼Œè¯¥å¼‚å¸¸å‘å¤–ä¼ æ’­è‡³ <code>askQuestion()</code>ï¼Œä»è€Œè§¦å‘é‡è¯•ã€‚</p>
<p>è‡³äº <code>AnswerNotRelevantException</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„<strong>éå—æ£€</strong>å¼‚å¸¸ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnswerNotRelevantException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>{
    public <span class="hljs-type">AnswerNotRelevantException</span>(<span class="hljs-type">String</span> question, <span class="hljs-type">String</span> answer) {
        <span class="hljs-keyword">super</span>(<span class="hljs-string">"The answer '"</span> + answer + <span class="hljs-string">"' is not relevant to the question '"</span> + question + <span class="hljs-string">"'."</span>);
    }
}
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¸¦æœ‰ <code>@Retryable</code> çš„æ–¹æ³•ä¼š<strong>æœ€å¤šé‡è¯•ä¸‰æ¬¡</strong>ã€‚ä½ å¯ä»¥é€šè¿‡ <code>maxAttempts</code> å±æ€§è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå°†é‡è¯•ä¸Šé™è®¾ä¸º 5 æ¬¡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@Retryable(<span class="hljs-params">retryFor = AnswerNotRelevantException.<span class="hljs-keyword">class</span>, maxAttempts=<span class="hljs-number">5</span></span>)</span>
</code></pre>
<p>å°½ç®¡å¯ä»¥é€šè¿‡ <code>maxAttempts</code> å¢åŠ é‡è¯•æ¬¡æ•°ï¼Œä½†è¦æ³¨æ„ï¼šæ¯æ¬¡é‡è¯•éƒ½æ„å‘³ç€å¯¹ <strong>LLM</strong> å¤šå‘é€ä¸€æ¬¡æç¤ºï¼ŒåŒæ—¶è¯„ä¼°å™¨ä¹Ÿä¼šåå¤å‘ LLM å‘é€è¯„ä¼°æç¤ºã€‚è¿™ä¼š<strong>å¢åŠ è´¹ç”¨</strong>ï¼ˆå› ä¸ºåœ¨å¾—åˆ°ç›¸å…³ç­”æ¡ˆå‰å¯èƒ½å‘é€äº†æ›´å¤š tokenï¼‰ï¼Œå¹¶ä¸”å¦‚æœåœ¨çŸ­æ—¶é—´å†…è¿ç»­å‘é€åŒæ ·çš„æç¤ºï¼Œä¹Ÿå¯èƒ½è§¦å‘<strong>é™æµ</strong>ã€‚å› æ­¤æŠŠ <code>maxAttempts</code> è®¾å¾—è¾ƒä½å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p>
<p>å¦‚æœåœ¨ä¸‰æ¬¡ï¼ˆæˆ–ä½ é€šè¿‡ <code>maxAttempts</code> æŒ‡å®šçš„æ¬¡æ•°ï¼‰å°è¯•åä»æœªç”Ÿæˆç›¸å…³ç­”æ¡ˆï¼Œæ§åˆ¶æµç¨‹ä¼šè¿›å…¥ <code>recover()</code> æ–¹æ³•ã€‚<code>recover()</code> ç”¨ <code>@Recover</code> æ³¨è§£æ ‡æ³¨ï¼Œæ˜¯ Spring Retry æä¾›çš„<strong>å…œåº•</strong>æœºåˆ¶ï¼šå½“é‡è¯•æŒç»­å¤±è´¥æ—¶è°ƒç”¨ã€‚åœ¨ <code>SelfEvaluatingBoardGameService</code> ä¸­ï¼Œ<code>recover()</code> åªæ˜¯è¿”å›ä¸€ä¸ªè¡¨ç¤º<strong>æ— æ³•å›ç­”</strong>çš„ <code>Answer</code>ã€‚</p>
<p>å…³äº Spring AI çš„è¯„ä¼°å™¨ï¼Œè¿˜æœ‰æœ€åä¸€ç‚¹ï¼šè™½ç„¶å¼€ç®±å³ç”¨çš„åªæœ‰ <code>RelevancyEvaluator</code> ä¸ <code>FactCheckingEvaluator</code>ï¼Œä½†å®ƒä»¬éƒ½æ˜¯åŸºäº Spring AI çš„å¦‚ä¸‹ <strong>Evaluator</strong> æ¥å£æ„å»ºçš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> org.springframework.ai.evaluation;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-keyword">import</span> org.springframework.ai.document.Document;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;

<span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Evaluator</span> {

    EvaluationResponse <span class="hljs-title function_">evaluate</span><span class="hljs-params">(EvaluationRequest evaluationRequest)</span>;

    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">doGetSupportingData</span><span class="hljs-params">(EvaluationRequest evaluationRequest)</span> {
        List&lt;Document&gt; data = evaluationRequest.getDataList();
        <span class="hljs-keyword">return</span> data.stream()
            .map(Document::getText)
            .filter(StringUtils::hasText)
            .collect(Collectors.joining(System.lineSeparator()));
    }

}
</code></pre>
<p>è‹¥ <code>RelevancyEvaluator</code> æˆ– <code>FactCheckingEvaluator</code> <strong>ä¸èƒ½æ»¡è¶³</strong>ä½ çš„è¯„ä¼°éœ€æ±‚ï¼Œä½ å¯ä»¥å®ç° <code>Evaluator</code> æ¥å£<strong>è‡ªå®šä¹‰è¯„ä¼°å™¨</strong>ã€‚</p>
<h2 data-id="heading-4">å°ç»“ï¼ˆSummaryï¼‰</h2>
<ul>
<li>ç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>ä½¿æµ‹è¯•å˜å¾—æ£˜æ‰‹ã€‚</li>
<li>Spring AI æä¾›<strong>è¯„ä¼°å™¨</strong>ï¼Œå¯ç”¨äºå¯¹ç”Ÿæˆçš„å“åº”è¿›è¡Œ<strong>æ–­è¨€</strong>ã€‚</li>
<li>è¯„ä¼°å™¨é€šè¿‡å‘ LLM å‘é€æç¤ºï¼Œæ¥åˆ¤æ–­å“åº”çš„<strong>ç›¸å…³æ€§</strong>ä¸<strong>äº‹å®æ­£ç¡®æ€§</strong>ã€‚</li>
<li>è¯„ä¼°å™¨å¯åœ¨<strong>è¿è¡Œæ—¶</strong>åº”ç”¨ï¼›è‹¥è¿”å›ä¸æ»¡æ„çš„ç»“æœï¼Œå¯ä»¥<strong>é‡è¯•</strong>æç¤ºã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ä¸Špythoné—®é¢˜æ’æŸ¥æ€è·¯]]></title>    <link>https://juejin.cn/post/7570896170920951871</link>    <guid>https://juejin.cn/post/7570896170920951871</guid>    <pubDate>2025-11-10T10:02:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570896170920951871" data-draft-id="7570793903848407055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ä¸Špythoné—®é¢˜æ’æŸ¥æ€è·¯"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2025-11-10T10:02:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²™è™«ä¸€å·"/> <meta itemprop="url" content="https://juejin.cn/user/4427059249293504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ä¸Špythoné—®é¢˜æ’æŸ¥æ€è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4427059249293504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²™è™«ä¸€å·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:02:13.000Z" title="Mon Nov 10 2025 10:02:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹é¢æŠŠæ£€æŸ¥çº¿ç¨‹é˜»å¡å’Œæ’æŸ¥å†…å­˜å¢é•¿çš„å·¥å…·ä¸å…¸å‹ç”¨æ³•æŒ‰è¦ç‚¹åˆ—æ¸…æ¥šã€‚</p>
<h2 data-id="heading-0">çº¿ç¨‹é˜»å¡ä¸æ­»é”æ’æŸ¥</h2>
<ul>
<li>
<p>è§‚æµ‹ç‚¹ï¼šè¿›ç¨‹å“åº”å˜æ…¢æˆ–å®Œå…¨åœæ»ï¼ŒCPU/IO å¼‚å¸¸æˆ–æ—¥å¿—æ˜¾ç¤ºçº¿ç¨‹ç­‰å¾…ã€‚</p>
</li>
<li>
<p>æ—¥å¿—æ£€æŸ¥ï¼šæŠ“å–çº¿ç¨‹ç›¸å…³æ—¥å¿—ã€å¼‚å¸¸å †æ ˆã€é˜»å¡/ç­‰å¾…ä¿¡æ¯ã€‚å…ˆå®šä½æ—¶é—´çª—å£å’Œå¯ç–‘çº¿ç¨‹IDã€‚</p>
</li>
<li>
<p>gdbï¼ˆåŠ¨æ€é™„åŠ æŸ¥çœ‹çº¿ç¨‹æ ˆï¼‰</p>
</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š<code>gdb -p &lt;pid&gt;</code>ï¼Œç„¶å <code>thread apply all bt</code> æŸ¥çœ‹æ¯ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆï¼Œå®šä½äº’æ–¥é”/ç­‰å¾…ç‚¹ã€‚</p>
<p>å¿«é€Ÿæµç¨‹ï¼šé™„åŠ  â†’ åˆ—å‡ºçº¿ç¨‹ â†’ å¯¹å¯ç–‘çº¿ç¨‹æ‰“å° backtraceã€‚</p>
<ul>
<li>straceï¼ˆè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨/é˜»å¡åœ¨ syscallï¼‰</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š<code>strace -f -p &lt;pid&gt;</code> æˆ– <code>strace -ff -o out -p &lt;pid&gt;</code>ã€‚çœ‹æ˜¯å¦åœ¨ futexã€pollã€read/write ç­‰ç³»ç»Ÿè°ƒç”¨ä¸Šé•¿æ—¶é—´é˜»å¡ã€‚</p>
<ul>
<li>ç»¼åˆç­–ç•¥ï¼šå…ˆä»æ—¥å¿—ç¼©å°æ—¶é—´æ®µå’Œçº¿ç¨‹ï¼›ç”¨ gdb çœ‹ Python å±‚è°ƒç”¨æ ˆï¼ˆè‹¥æ˜¯ C æ‰©å±•æˆ–è§£é‡Šå™¨æ­»é”ä¹Ÿèƒ½çœ‹å‡ºï¼‰ï¼›ç”¨ strace åˆ¤æ–­æ˜¯ç”¨æˆ·æ€ç­‰å¾…è¿˜æ˜¯ç³»ç»Ÿè°ƒç”¨å±‚é¢é˜»å¡ã€‚</li>
</ul>
<h2 data-id="heading-1">å†…å­˜æ³„æ¼/å†…å­˜å¢é•¿æ’æŸ¥</h2>
<ul>
<li>
<p>è§‚æµ‹ç‚¹ï¼šé•¿æœŸè¿è¡Œè¿›ç¨‹å†…å­˜å ç”¨æŒç»­ä¸Šæ¶¨ï¼ŒGC åæœªå›è½ï¼Œæˆ– OOM é¢‘ç¹ã€‚</p>
</li>
<li>
<p>ç›‘æ§ï¼š<code>top</code>/<code>ps</code>/<code>smem</code>/<code>pmap</code> å®šæœŸé‡‡æ ·è®°å½• RSS/VSZã€‚ç»“åˆåº”ç”¨æ—¥å¿—æ ‡è®°æ—¶é—´ç‚¹ã€‚</p>
</li>
<li>
<p>tracemallocï¼ˆPython æ ‡å‡†åº“ï¼Œè·Ÿè¸ªå†…å­˜åˆ†é…åœ°ç‚¹ï¼‰</p>
</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">import</span> tracemalloc

tracemalloc.start()

<span class="hljs-comment"># åœ¨å…³é”®ç‚¹å–å¿«ç…§</span>

snap1 = tracemalloc.take_snapshot()

<span class="hljs-comment"># è¿è¡Œä¸€æ®µæ—¶é—´å</span>

snap2 = tracemalloc.take_snapshot()

stats = snap2.compare_to(snap1, <span class="hljs-string">'lineno'</span>)

<span class="hljs-keyword">for</span> stat <span class="hljs-keyword">in</span> stats[:<span class="hljs-number">20</span>]:

<span class="hljs-built_in">print</span>(stat)

</code></pre>
<p>èƒ½æ‰¾å‡ºæŒ‰æ–‡ä»¶è¡Œå·åˆ†é…å¢é•¿æœ€å¤šçš„åœ°æ–¹ã€‚</p>
<ul>
<li>objgraphï¼ˆåˆ†æå¯¹è±¡å¼•ç”¨å…³ç³»ï¼‰</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">import</span> objgraph

objgraph.show_most_common_types(limit=<span class="hljs-number">20</span>)

obj = objgraph.by_type(<span class="hljs-string">'YourTypeName'</span>)[:<span class="hljs-number">10</span>]

objgraph.show_backrefs(obj, max_depth=<span class="hljs-number">10</span>, filename=<span class="hljs-string">'leak.png'</span>)

</code></pre>
<p>ç”¨æ¥å‘ç°å“ªäº›å¯¹è±¡æ•°é‡å¼‚å¸¸å’Œå®ƒä»¬çš„å¼•ç”¨è·¯å¾„ï¼ˆå¯ç”Ÿæˆå›¾ç‰‡ï¼‰ã€‚</p>
<ul>
<li>pymplerï¼ˆè¿è¡Œæ—¶å†…å­˜æ¦‚è§ˆä¸åˆ†é…è¿½è¸ªï¼‰</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">from</span> pympler <span class="hljs-keyword">import</span> muppy, summary

all_objs = muppy.get_objects()

<span class="hljs-built_in">print</span>(summary.summarize(all_objs))

</code></pre>
<p>å¯ç»“åˆ <code>asizeof</code> æˆ– <code>tracker</code> åšæ›´ç»†ç²’åº¦çš„åˆ†é…è¿½è¸ªã€‚</p>
<ul>
<li>å®æˆ˜æµç¨‹å»ºè®®ï¼šå…ˆç”¨ç³»ç»Ÿå·¥å…·ç¡®è®¤å¢é•¿æ›²çº¿ â†’ ç”¨ tracemalloc æ‰¾åˆ°çƒ­ç‚¹åˆ†é…ä½ç½® â†’ ç”¨ objgraph å¯è§†åŒ–å¼•ç”¨é“¾ç¡®è®¤æ ¹å¯¹è±¡ â†’ ç”¨ä»£ç ä¿®å¤å¹¶éªŒè¯ï¼ˆé‡å¤é‡‡æ ·å¯¹æ¯”å¿«ç…§ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-2">å¿«é€Ÿæ£€æŸ¥æ¸…å•ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰</h2>
<ol>
<li>
<p>é‡‡é›†æ—¥å¿—ä¸è¿›ç¨‹å†…å­˜/çº¿ç¨‹å¿«ç…§ã€‚</p>
</li>
<li>
<p>è‹¥çº¿ç¨‹ç–‘ä¼¼é˜»å¡ï¼Œå…ˆ gdb æ‰“æ ˆï¼Œå†ç”¨ strace ç¡®è®¤æ˜¯ syscall å±‚é˜»å¡ã€‚</p>
</li>
<li>
<p>è‹¥å†…å­˜å¢é•¿ï¼Œå…ˆé‡‡æ · RSSï¼Œå†ç”¨ tracemalloc å®šä½åˆ†é…æºï¼Œæœ€åç”¨ objgraph éªŒè¯å¼•ç”¨é“¾ã€‚</p>
</li>
<li>
<p>ä¿®å¤ååšå›å½’é‡‡æ ·å¯¹æ¯”å¿«ç…§ã€‚</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ§­ ä½¿ç”¨å†å²è®°å½• API - SPAå¯¼èˆªä¸çŠ¶æ€ç®¡ç†çš„å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570598043298758719</link>    <guid>https://juejin.cn/post/7570598043298758719</guid>    <pubDate>2025-11-10T10:08:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298758719" data-draft-id="7570908785292951571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ§­ ä½¿ç”¨å†å²è®°å½• API - SPAå¯¼èˆªä¸çŠ¶æ€ç®¡ç†çš„å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T10:08:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bug_Constructer"/> <meta itemprop="url" content="https://juejin.cn/user/254742426830856"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ§­ ä½¿ç”¨å†å²è®°å½• API - SPAå¯¼èˆªä¸çŠ¶æ€ç®¡ç†çš„å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/254742426830856/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bug_Constructer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:08:35.000Z" title="Mon Nov 10 2025 10:08:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ğŸ¯ <strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šæŒæ¡ <code>pushState</code> / <code>replaceState</code> / <code>popstate</code> çš„æ ¸å¿ƒç”¨æ³•ï¼›åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹åŒæ­¥ URL ä¸ UI çŠ¶æ€ï¼›è®¾è®¡è½»é‡ã€å¯åºåˆ—åŒ–çš„ <code>state</code> å¯¹è±¡ï¼›ä¸ºç”¨æˆ·çš„å‰è¿›/åé€€æä¾›å¯æ§çš„å¯¼èˆªä½“éªŒã€‚</p>
<p>ğŸ“Š <strong>éš¾åº¦ç­‰çº§</strong>ï¼šåˆçº§-ä¸­çº§<br/>
ğŸ·ï¸ <strong>æŠ€æœ¯æ ‡ç­¾</strong>ï¼š<code>#WebAPI</code> <code>#HistoryAPI</code> <code>#SPA</code> <code>#è·¯ç”±</code><br/>
â±ï¸ <strong>é˜…è¯»æ—¶é—´</strong>ï¼šçº¦9åˆ†é’Ÿ</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ğŸŒŸ å¼•è¨€</h2>
<p>åœ¨æ—¥å¸¸ SPA å¼€å‘ä¸­ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡è¿™äº›å›°æ‰°ï¼š</p>
<ul>
<li>å†…å®¹æ›´æ–°å´ä¸æ”¹å˜ URLï¼Œåˆ·æ–°æˆ–åˆ†äº«åæ— æ³•åˆ°è¾¾å½“å‰è§†å›¾</li>
<li>ç”¨æˆ·ç‚¹å‡»åé€€/å‰è¿›å¯¼è‡´çŠ¶æ€ä¸¢å¤±ï¼Œä½“éªŒä¸ä¸€è‡´</li>
<li>é¡µé¢åˆ·æ–°åæ— æ³•æ¢å¤è§†å›¾ä¸æ•°æ®ï¼Œéœ€é‡æ–°æ“ä½œ</li>
<li>è·¯ç”±å®ç°å¤æ‚ï¼ŒçŠ¶æ€å¯¹è±¡éš¾ä»¥ç»´æŠ¤ä¸åºåˆ—åŒ–</li>
</ul>
<p>è¿™ç¯‡æ–‡ç« å›´ç»• History APIï¼Œè®²é€å¦‚ä½•æ— åˆ·æ–°åœ°åŒæ­¥ URL ä¸çŠ¶æ€ï¼Œå¹¶æä¾›ç»æµ‹è¯•çš„æœ€ä½³å®è·µã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ’¡ æ ¸å¿ƒæŠ€å·§è¯¦è§£</h2>
<h3 data-id="heading-2">1. æ— åˆ·æ–°å¯¼èˆªå°è£…ï¼šURL ä¸ UI åŒæ­¥</h3>
<h4 data-id="heading-3">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>èœå•åˆ‡æ¢ã€åˆ†é¡µ/ç­›é€‰ã€å¯åˆ†äº«çš„è§†å›¾å®šä½ã€‚</p>
<h4 data-id="heading-4">âŒ å¸¸è§é—®é¢˜</h4>
<p>åªæ›´æ–°å†…å®¹ä¸æ›´æ–° URLï¼›æœªæ ¡éªŒåŒæºå¯¼è‡´é”™è¯¯å¯¼èˆªã€‚</p>
<h4 data-id="heading-5">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ç»Ÿä¸€å°è£…å¯¼èˆªå‡½æ•°ï¼Œé›†ä¸­å¤„ç† <code>pushState</code> ä¸æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ä½¿ç”¨ History API è¿›è¡Œæ— åˆ·æ–°å¯¼èˆª
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">url</span> - ç›®æ ‡åŒæº URLï¼ˆå¯åŒ…å«æŸ¥è¯¢å‚æ•°ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{view:string, params?:Record&lt;string,string&gt;, scrollY?:number</span>}} state - è½»é‡é¡µé¢çŠ¶æ€
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">navigate</span> = (<span class="hljs-params">url, state</span>) =&gt; {
  <span class="hljs-keyword">const</span> target = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(url, <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span>);
  <span class="hljs-keyword">if</span> (target.<span class="hljs-property">origin</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// åŒæºæ ¡éªŒ</span>
  history.<span class="hljs-title function_">pushState</span>(state ?? {}, <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span>, target.<span class="hljs-property">href</span>);
  <span class="hljs-title function_">renderFromState</span>(state ?? {});
};

<span class="hljs-comment">/**
 * æ ¹æ® state æ¸²æŸ“é¡µé¢ï¼ˆè§†å›¾ä¸å‚æ•°ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{view?:string, params?:Record&lt;string,string&gt;, scrollY?:number</span>}} state
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">renderFromState</span> = (<span class="hljs-params">state = {}</span>) =&gt; {
  <span class="hljs-keyword">const</span> view = state.<span class="hljs-property">view</span> || <span class="hljs-string">'home'</span>;
  <span class="hljs-keyword">const</span> params = state.<span class="hljs-property">params</span> || {};
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>).<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-view'</span>, view);
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#params'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params);
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({ <span class="hljs-attr">top</span>: state.<span class="hljs-property">scrollY</span> ?? <span class="hljs-number">0</span>, <span class="hljs-attr">behavior</span>: <span class="hljs-string">'instant'</span> });
};
</code></pre>
<h4 data-id="heading-6">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>pushState</code> ä¸è§¦å‘ <code>popstate</code>ï¼Œéœ€ä¸»åŠ¨æ¸²æŸ“å½“å‰è§†å›¾</li>
<li>åŒæºæ ¡éªŒé¿å…è·¨æºå¯¼èˆªé”™è¯¯</li>
<li>ä»…ä¿å­˜å¿…è¦å‚æ•°ï¼Œä¿æŒçŠ¶æ€è½»é‡å¯åºåˆ—åŒ–</li>
</ul>
<h4 data-id="heading-7">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>åœ¨å¯¼èˆªç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨ <code>navigate</code>ï¼Œå®ç°æ— åˆ·æ–°è·¯ç”±ä¸çŠ¶æ€åŒæ­¥ã€‚</p>
<hr/>
<h3 data-id="heading-8">2. åˆå§‹åŒ–é¦–æ¡å†å²è®°å½•ï¼šé¿å…å›é€€ä¸¢å¤±</h3>
<h4 data-id="heading-9">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>åº”ç”¨å¯åŠ¨ã€ç›´è¾¾é“¾æ¥ã€é¦–æ¬¡åŠ è½½æŸ¥è¯¢å‚æ•°ã€‚</p>
<h4 data-id="heading-10">âŒ å¸¸è§é—®é¢˜</h4>
<p>æœªè®¾ç½®åˆå§‹æ¡ç›®ï¼Œå›é€€åæ— æ³•æ­£ç¡®æ¢å¤è§†å›¾ã€‚</p>
<h4 data-id="heading-11">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ç”¨ <code>replaceState</code> å†™å…¥é¦–æ¡å†å²è®°å½•å¹¶æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç”¨ replaceState åˆå§‹åŒ–é¦–æ¡å†å²è®°å½•
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initHistoryState</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> state = {
    <span class="hljs-attr">view</span>: <span class="hljs-string">'home'</span>,
    <span class="hljs-attr">params</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(location.<span class="hljs-property">search</span>)),
    <span class="hljs-attr">scrollY</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>
  };
  history.<span class="hljs-title function_">replaceState</span>(state, <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span>, location.<span class="hljs-property">href</span>);
  <span class="hljs-title function_">renderFromState</span>(state);
};
</code></pre>
<h4 data-id="heading-12">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>replaceState</code> æ›¿æ¢å½“å‰æ¡ç›®ï¼Œé¿å…ç”Ÿæˆå¤šä½™å†å²è®°å½•</li>
<li>åˆå§‹æ¸²æŸ“ä» URL æŸ¥è¯¢å‚æ•°æ¨å¯¼çŠ¶æ€</li>
</ul>
<h4 data-id="heading-13">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>åº”ç”¨å…¥å£å¤„è°ƒç”¨ <code>initHistoryState</code>ï¼Œä¿éšœåé€€/å‰è¿›è¡Œä¸ºä¸€è‡´ã€‚</p>
<hr/>
<h3 data-id="heading-14">3. ç›‘å¬ popstateï¼šæµè§ˆå™¨å¯¼èˆªçŠ¶æ€æ¢å¤</h3>
<h4 data-id="heading-15">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨åé€€/å‰è¿›æˆ– <code>history.go()</code>ã€‚</p>
<h4 data-id="heading-16">âŒ å¸¸è§é—®é¢˜</h4>
<p>æœªç›‘å¬ <code>popstate</code> å¯¼è‡´çŠ¶æ€æ— æ³•æ¢å¤ï¼Œé¡µé¢é—ªçƒæˆ–é‡è½½ã€‚</p>
<h4 data-id="heading-17">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ç»‘å®š <code>popstate</code>ï¼Œæ ¹æ®å†å²æ¡ç›®æ¢å¤ UIã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç»‘å®š popstate äº‹ä»¶ä»¥æ¢å¤ UI
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">bindPopState</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> state = e.<span class="hljs-property">state</span> || {};
    <span class="hljs-title function_">renderFromState</span>(state);
  });
};
</code></pre>
<h4 data-id="heading-18">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>popstate</code> ä»…åœ¨ç”¨æˆ·å¯¼èˆªæˆ– <code>history.go()</code> æ—¶è§¦å‘</li>
<li>å†å²æ¡ç›®ä¸­çš„ <code>state</code> åº”è¶³ä»¥æ¨å¯¼å¹¶æ¸²æŸ“ UI</li>
</ul>
<h4 data-id="heading-19">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>åº”ç”¨å¯åŠ¨åç«‹å³ç»‘å®šï¼Œä¿è¯å¯¼èˆªä¸€è‡´æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-20">4. è½»é‡çŠ¶æ€å¯¹è±¡ï¼šå¯åºåˆ—åŒ–ä¸”å¯æ¨å¯¼ UI</h3>
<h4 data-id="heading-21">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>åˆ†é¡µã€ç­›é€‰ã€è¯¦æƒ…è§†å›¾å®šä½ã€‚</p>
<h4 data-id="heading-22">âŒ å¸¸è§é—®é¢˜</h4>
<p>çŠ¶æ€è¿‡åº¦å¤æ‚ï¼Œæ— æ³•åºåˆ—åŒ–æˆ–è·¨ä¼šè¯æ¢å¤ã€‚</p>
<h4 data-id="heading-23">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ä»…ä¿å­˜è§†å›¾æ ‡è¯†ã€æŸ¥è¯¢å‚æ•°ä¸æ»šåŠ¨ä½ç½®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç”Ÿæˆå¯åºåˆ—åŒ–çš„è½»é‡çŠ¶æ€å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">view</span> - è§†å›¾æ ‡è¯†
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Record&lt;string,string&gt;</span>} <span class="hljs-variable">params</span> - æŸ¥è¯¢å‚æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">{view:string, params:Record&lt;string,string&gt;, scrollY:number</span>}}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">makeState</span> = (<span class="hljs-params">view, params = {}</span>) =&gt; ({
  view,
  params,
  <span class="hljs-attr">scrollY</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>
});
</code></pre>
<h4 data-id="heading-24">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li>å¤æ‚å¯¹è±¡è½¬ ID æˆ–å¯é‡å»ºçš„å¼•ç”¨</li>
<li>ä¿æŒçŠ¶æ€å°è€Œæ¸…æ™°ï¼Œæå‡å…¼å®¹ä¸ç»´æŠ¤æ€§</li>
</ul>
<h4 data-id="heading-25">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>ä¸è·¯ç”±æœåŠ¡ç»“åˆï¼Œç»Ÿä¸€ç”Ÿæˆå¹¶æŒä¹…åŒ–è½»é‡ <code>state</code>ã€‚</p>
<hr/>
<h2 data-id="heading-26">ğŸ“Š æŠ€å·§å¯¹æ¯”æ€»ç»“</h2>



































<table><thead><tr><th>æŠ€å·§</th><th>ä½¿ç”¨åœºæ™¯</th><th>ä¼˜åŠ¿</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td>æ— åˆ·æ–°å¯¼èˆªå°è£…</td><td>èœå•åˆ‡æ¢ã€åˆ†é¡µ/ç­›é€‰</td><td>URL ä¸ UI åŒæ­¥ã€æ— åˆ·æ–°</td><td>åŒæºæ ¡éªŒã€è½»é‡çŠ¶æ€</td></tr><tr><td>åˆå§‹åŒ–é¦–æ¡è®°å½•</td><td>åº”ç”¨å¯åŠ¨ã€ç›´è¾¾é“¾æ¥</td><td>å›é€€è¡Œä¸ºä¸€è‡´ã€å¯æ¢å¤</td><td>ä½¿ç”¨ replaceState</td></tr><tr><td>ç›‘å¬ popstate</td><td>åé€€/å‰è¿›å¯¼èˆª</td><td>çŠ¶æ€æ¢å¤ã€ä½“éªŒä¸€è‡´</td><td>ä»…ç”¨æˆ·å¯¼èˆªè§¦å‘</td></tr><tr><td>è½»é‡çŠ¶æ€å¯¹è±¡</td><td>åˆ†é¡µã€ç­›é€‰ã€è¯¦æƒ…</td><td>å¯åºåˆ—åŒ–ã€å¯æ¨å¯¼ UI</td><td>å¤æ‚å¯¹è±¡è½¬ ID</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-27">ğŸ¯ å®æˆ˜åº”ç”¨å»ºè®®</h2>
<h3 data-id="heading-28">æœ€ä½³å®è·µ</h3>
<ol>
<li>å°†å¯¼èˆªå°è£…ä¸ºæœåŠ¡æ¨¡å—ï¼Œç»Ÿä¸€åŒæºæ ¡éªŒä¸çŠ¶æ€æ„å»º</li>
<li>åˆ†äº«/æ”¶è—çš„åœºæ™¯æ›´æ–° URLï¼›å†…éƒ¨å¾®è°ƒå¯ä¸äº§ç”Ÿå†å²æ¡ç›®</li>
<li>å°†åˆ†é¡µ/ç­›é€‰å†™å…¥æŸ¥è¯¢ä¸²ï¼Œä¾¿äºç›´è¾¾åŒä¸€è§†å›¾</li>
<li>ç»“åˆæ»šåŠ¨ä½ç½®ä¸ç„¦ç‚¹ç®¡ç†ï¼Œæå‡è¿”å›ä½“éªŒè¿è´¯æ€§</li>
</ol>
<h3 data-id="heading-29">æ€§èƒ½è€ƒè™‘</h3>
<ul>
<li>é¿å…åœ¨ <code>popstate</code> ä¸­åšé‡è®¡ç®—ï¼Œä¼˜å…ˆä½¿ç”¨å·²ä¿å­˜çš„è½»é‡çŠ¶æ€</li>
<li>æ ¡éªŒ URL åŒæºåå†æ„å»ºçŠ¶æ€ï¼Œå‡å°‘å¼‚å¸¸ä¸é‡æ¸²æŸ“</li>
<li>å¿…è¦æ—¶æä¾› Hash é™çº§å…¼å®¹æ—§ç¯å¢ƒæˆ–è·¨æºè·¯å¾„</li>
</ul>
<hr/>
<h2 data-id="heading-30">ğŸ’¡ æ€»ç»“</h2>
<p>è¿™ 4 ä¸ª History API æŠ€å·§èƒ½è®© SPA åœ¨ä¸åˆ·æ–°é¡µé¢çš„å‰æä¸‹å®ç°â€œå¯å¯¼èˆªã€å¯æ¢å¤ã€å¯åˆ†äº«â€çš„èƒ½åŠ›ï¼š</p>
<ol>
<li>æ— åˆ·æ–°å¯¼èˆªå°è£…ï¼šç»Ÿä¸€ <code>pushState</code> ä¸æ¸²æŸ“</li>
<li>åˆå§‹åŒ–é¦–æ¡å†å²è®°å½•ï¼šç”¨ <code>replaceState</code> ä¿è¯å›é€€ä¸€è‡´</li>
<li>ç›‘å¬ <code>popstate</code>ï¼šç”¨æˆ·å¯¼èˆªæ—¶æ¢å¤ UI</li>
<li>è½»é‡çŠ¶æ€å¯¹è±¡ï¼šä»…ä¿å­˜å¿…è¦ä¿¡æ¯ï¼Œä¿æŒå¯åºåˆ—åŒ–ä¸å¯ç»´æŠ¤</li>
</ol>
<p>å¸Œæœ›è¿™äº›æŠ€å·§èƒ½å¸®åŠ©ä½ åœ¨ SPA è·¯ç”±ä¸çŠ¶æ€ç®¡ç†ä¸­å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼</p>
<hr/>
<h2 data-id="heading-31">ğŸ”— ç›¸å…³èµ„æº</h2>
<ul>
<li>MDNï¼ˆä¸­æ–‡ï¼‰ï¼šWorking with the History API<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHistory_API%2FWorking_with_the_History_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API/Working_with_the_History_API" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/â€¦</a></li>
</ul>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>ä»Šæ—¥æ”¶è·</strong>ï¼šæŒæ¡äº†History APIçš„å¤šä¸ªæ ¸å¿ƒæŠ€å·§ï¼Œè¿™äº›çŸ¥è¯†ç‚¹åœ¨å®é™…å¼€å‘ä¸­éå¸¸å®ç”¨ã€‚</p>
</blockquote>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—å’Œåˆ†äº«ï¼æœ‰ä»»ä½•é—®é¢˜ä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚</strong> ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼šä»æ”¯ä»˜åŸºç¡€è®¾æ–½åˆ° ACP åè®®ï¼Œæ‹†è§£ Stripe å¦‚ä½•æ­å»ºAIæ™ºèƒ½ä½“ç»æµçš„å•†ä¸šæ ‡å‡†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7570793903848521743</link>    <guid>https://juejin.cn/post/7570793903848521743</guid>    <pubDate>2025-11-10T10:02:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570793903848521743" data-draft-id="7570901172526956579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼šä»æ”¯ä»˜åŸºç¡€è®¾æ–½åˆ° ACP åè®®ï¼Œæ‹†è§£ Stripe å¦‚ä½•æ­å»ºAIæ™ºèƒ½ä½“ç»æµçš„å•†ä¸šæ ‡å‡†ï¼Ÿ"/> <meta itemprop="keywords" content="äº§å“ç»ç†"/> <meta itemprop="datePublished" content="2025-11-10T10:02:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è«å°”ç´¢"/> <meta itemprop="url" content="https://juejin.cn/user/518625218016504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼šä»æ”¯ä»˜åŸºç¡€è®¾æ–½åˆ° ACP åè®®ï¼Œæ‹†è§£ Stripe å¦‚ä½•æ­å»ºAIæ™ºèƒ½ä½“ç»æµçš„å•†ä¸šæ ‡å‡†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/518625218016504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è«å°”ç´¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:02:36.000Z" title="Mon Nov 10 2025 10:02:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨è¿™æœŸæ’­å®¢ä¸­ï¼ŒStripeï¼ˆå‡ ä¹æ‰€æœ‰å‡ºæµ·äº§å“éƒ½åœ¨ç”¨çš„å…¨çƒæ€§æ”¯ä»˜å¹³å°ï¼‰çš„æ•°æ®ä¸ AI è´Ÿè´£äºº Emily æ·±å…¥æ¢è®¨äº† AI å¦‚ä½•ä»æ ¹æœ¬ä¸Šé‡å¡‘ç»æµåŸºç¡€è®¾æ–½ã€‚AI ä¸ä»…åœ¨åˆ›é€ æ–°çš„å•†ä¸šæ¨¡å¼ï¼ˆå¦‚ Agent æœåŠ¡å•†ï¼‰ï¼Œä¹Ÿå¸¦æ¥å…¨æ–°çš„ç»æµæŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯é«˜æ˜‚çš„è¾¹é™…æˆæœ¬å’Œæ–°å‹æ¬ºè¯ˆã€‚Stripe æ­£åœ¨é€šè¿‡æ‰©å±•å…¶åæ¬ºè¯ˆç³»ç»Ÿ (Radar)ã€<strong>æ¨å‡º Token Billingï¼ˆæŒ‰æ¨ç†æ—¶ token è®¡è´¹ï¼‰</strong> ç­‰åˆ›æ–°æ”¯ä»˜å·¥å…·ï¼Œä»¥åŠä¸ OpenAI è”åˆå‘å¸ƒ <strong>ACP (Agentic Commerce Protocolï¼Œä»£ç†å¼ç”µå•†åè®®)</strong> æ¥åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œæ—¨åœ¨ä¸ºå³å°†åˆ°æ¥çš„ AI Agent ç»æµå»ºç«‹ä¸€ä¸ªå¼€æ”¾ã€é«˜æ•ˆä¸”å®‰å…¨çš„å•†ä¸šæ ‡å‡†ã€‚</p>
</blockquote>
<p>æ¬¢è¿è®¢é˜…åˆé›† <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI æ’­å®¢æ•æ‰‹</a>ï¼šä¸“é—¨é¢å‘æ–‡å­—å†…å®¹çˆ±å¥½è€…åˆ†äº« AI é¢†åŸŸä¼˜è´¨æ’­å®¢ï¼Œå…¶ä»–åˆé›†ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243230891033935893%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FZcMiAmfNkmYLDgAu0rlb1Q%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243230891033935893&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZcMiAmfNkmYLDgAu0rlb1Q&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI å†·æ€è€ƒ</a>ï¼šä¸ªäººåœ¨ AI ç‹‚æ¬¢ä¸‹çš„å†·æ€è€ƒï¼Œèšç„¦ AI å·¥ç¨‹åŒ–ã€Agent Infra äº§å“ã€æ•ˆç‡å‹ AI å·¥å…·å’Œäººæœºåä½œè¯é¢˜ï¼Œå¯»æ‰¾å¯æŒç»­çš„äº§ä¸šä»·å€¼ã€‚</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243205243418624006%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252F0Tdan3R8juUlj-Lh-QMmew%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243205243418624006&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Tdan3R8juUlj-Lh-QMmew&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI åšå®¢ç²¾é€‰</a>ï¼šç²¾å¿ƒç¼–è¯‘æµ·å¤–æŠ€æœ¯å‚å•†å‘å¸ƒçš„é«˜è´¨é‡ AI é¢†åŸŸåšå®¢æ–‡ç« ã€‚</li>
</ul>
<h2 data-id="heading-0">ç›®å½•</h2>
<ul>
<li>Stripe çš„ AI æ¼”è¿›ï¼šä»åæ¬ºè¯ˆåˆ°æ”¯ä»˜åŸºç¡€æ¨¡å‹</li>
<li>AI æ—¶ä»£çš„ç»æµæŒ‘æˆ˜ï¼šé«˜æ˜‚çš„è¾¹é™…æˆæœ¬ä¸æ–°å‹æ¬ºè¯ˆ</li>
<li>ä¸º AI ç»æµæ„å»ºåŸºç¡€è®¾æ–½ï¼šä» Radar æ‰©å±•åˆ°æ”¯ä»˜åˆ›æ–°</li>
<li>ACPï¼šå®šä¹‰ AI Agent çš„å•†ä¸šæœªæ¥</li>
<li>AI ç»æµåˆ†æï¼šæ³¡æ²«è¿˜æ˜¯ç¹è£ï¼Ÿ</li>
<li>ä¸ªäººæ€è€ƒ</li>
</ul>
<h2 data-id="heading-1">Stripe çš„ AI æ¼”è¿›ï¼šä»åæ¬ºè¯ˆåˆ°æ”¯ä»˜åŸºç¡€æ¨¡å‹</h2>
<p>Stripe çš„ä½¿å‘½æ˜¯æ„å»ºäº’è”ç½‘çš„é‡‘èåŸºç¡€è®¾æ–½ï¼Œä½œä¸ºæ•°æ®ä¸ AI è´Ÿè´£äººï¼ŒEmily çš„èŒè´£æ˜¯å¸®åŠ© Stripe æœ‰æ•ˆåˆ©ç”¨å…¶åºå¤§çš„æ•°æ®â€”â€”æ¯å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼ˆå å…¨çƒ GDP çº¦ 1.3%ï¼‰çš„äº¤æ˜“é‡ï¼Œè¿™äº›æ•°æ®ä¸ä»…ç”¨äºç†è§£ç»æµåŠ¨æ€ï¼Œæ›´è¢«åé¦ˆåˆ°äº§å“ä¸­ï¼Œä»¥ä¼˜åŒ–æ”¯ä»˜ä½“éªŒã€å‡å°‘æ¬ºè¯ˆã€æé«˜æˆæƒç‡ã€‚</p>
<p>Emily é¢†å¯¼çš„ç»„ç»‡æ¶µç›–äº†ä»æ•°æ®å¹³å°ã€æœºå™¨å­¦ä¹ åŸºç¡€è®¾æ–½åˆ°åº”ç”¨å±‚çš„æ•´ä¸ªæŠ€æœ¯æ ˆã€‚å…¶ä¸­ä¸€ä¸ªç‰¹è‰²æ˜¯å®éªŒé¡¹ç›®å›¢é˜Ÿï¼Œè¿™ä¸ªå°è€Œç²¾çš„å›¢é˜Ÿä¸“æ³¨äºæ¢ç´¢é‚£äº›è·¨è¶Šå•ä¸€äº§å“çº¿çš„ã€ç”±ç”¨æˆ·éœ€æ±‚æ‹‰åŠ¨çš„ä» 0 åˆ° 1 çš„æœºä¼šï¼Œè¿‘æœŸçš„ ACP å’Œ Token Billing é¡¹ç›®å‡æºäºæ­¤å›¢é˜Ÿã€‚ï¼ˆç¼–æ³¨ï¼šè¿™ä¸ªå°å›¢é˜Ÿçº¦ 20 å¤šäººï¼Œç”±æ•°æ®éƒ¨é—¨ä¸»å¯¼ï¼Œå…·å¤‡è·¨éƒ¨é—¨çš„æ•°æ®è·å–æƒé™ï¼Œé«˜æ•ˆæŒ–æ˜ä¸šåŠ¡æ•°æ®ä»·å€¼ï¼Œå°† AI æ·±åº¦èå…¥åˆ°ä¼ä¸šä¸šåŠ¡æ¨¡å¼å’Œå·¥ä½œæµç¨‹ä¸­ï¼Œå¤§ä¼ä¸šè¯•éªŒæ€§æ¢ç´¢ AI åŸç”Ÿç»„ç»‡æ¨¡å¼çš„æœ‰æ•ˆæ€è·¯ï¼‰</p>
<p>è°ˆåˆ° AI åœ¨ Stripe çš„æ¼”è¿›ï¼ŒEmily æŒ‡å‡ºï¼ŒStripe ä½¿ç”¨ ML çš„å†å²å·²è¶…è¿‡åå¹´ï¼Œè¿œæ—©äºå½“ä¸‹çš„ AI æµªæ½®ã€‚æœ€åˆï¼ŒML è¢«ç”¨äºæ ¸å¿ƒäº§å“ Radarï¼ˆStripe çš„æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿï¼‰ä»¥åŠå†…éƒ¨è¿è¥ã€‚Stripe æ¯å¤©éœ€è¦å®¡æ ¸æ•°åƒåæ–°ç”¨æˆ·ï¼Œç¡®ä¿ä»–ä»¬çš„å¯æ”¯æŒæ€§ã€ä¿¡ç”¨ä»·å€¼å’Œéæ¬ºè¯ˆæ€§ï¼Œè¿™ä»ä¸€å¼€å§‹å°±ç¦»ä¸å¼€ MLã€‚</p>
<p>çœŸæ­£çš„è½¬å˜å‘ç”Ÿåœ¨ GPT-3.5 å‡ºç°æ—¶ï¼ŒStripe æ„è¯†åˆ°éœ€è¦ä¸ºæ‰€æœ‰äººæä¾›é«˜è´¨é‡ã€å®‰å…¨ã€æ˜“ç”¨çš„ LLM è®¿é—®æƒé™ï¼Œä¸ä»…æ˜¯ä¸ºæ—¥å¸¸å·¥ä½œï¼Œæ›´æ˜¯ä¸ºäº†æ„å»ºç”Ÿäº§çº§çš„ AI ä½“éªŒã€‚åœ¨è¿‡å»ä¸€å¹´åŠä¸­ï¼ŒStripe çš„ç­–ç•¥ä»<strong>ä½¿ç”¨å¤šä¸ªå•ä»»åŠ¡ã€ç‚¹è§£å†³æ–¹æ¡ˆçš„ ML æ¨¡å‹ï¼Œè½¬å‘æ„å»ºè‡ªå·±ç‰¹å®šé¢†åŸŸçš„æ”¯ä»˜åŸºç¡€æ¨¡å‹ (Foundation Model, FM)</strong> ã€‚</p>
<p>è¿™ä¸ªåŸºç¡€æ¨¡å‹åœ¨ Stripe çš„æ”¯ä»˜å¤„ç†ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œæ¯åˆ†é’Ÿå¤„ç†é«˜è¾¾ 50,000 ç¬”äº¤æ˜“ï¼Œå¹¶ä¸”æ¯ä¸€ç¬”äº¤æ˜“éƒ½ä¼šæµç»è¿™ä¸ª FM è¿›è¡Œå®æ—¶è¯„ä¼°ï¼Œå»¶è¿Ÿå¿…é¡»æ§åˆ¶åœ¨ 100 æ¯«ç§’ä»¥å†…ã€‚FM çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒèƒ½å¤„ç†æ‰€æœ‰äº‹æƒ…â€”â€”å®ƒè¢«è¾“å…¥äº†æ•°ç™¾äº¿ç¬”äº¤æ˜“çš„å…¨éƒ¨ç»†èŠ‚ï¼Œè€Œä¸åƒä¼ ç»Ÿ ML æ¨¡å‹é‚£æ ·ä¾èµ–äººç±»å·¥ç¨‹å¸ˆçš„æ‰‹å·¥ç‰¹å¾å·¥ç¨‹ã€‚</p>
<p>æ›´å…³é”®çš„æ˜¯ï¼Œ<strong>FM å¼•å…¥äº†åºåˆ—çš„æ¦‚å¿µï¼Œå°†æ”¯ä»˜æ•°æ®ç±»æ¯”ä¸ºè¯­è¨€æ•°æ®ã€‚ä¸€ä¸ªæ”¯ä»˜è¡Œä¸ºå°±åƒä¸€ä¸ªè¯ï¼Œå…¶æ„ä¹‰å–å†³äºä¸Šä¸‹æ–‡ï¼ˆå³å‘¨å›´çš„è¯ï¼‰ã€‚FM èƒ½å¤Ÿæ•æ‰åˆ°å¤æ‚çš„åºåˆ—æ¨¡å¼ï¼Œä¾‹å¦‚æŸä¸ª IP åœ¨æŸä¸ªç‰¹å®šæ—¶é—´ã€ä½¿ç”¨æŸç§å¡åœ¨ç‰¹å®šå•†å®¶è¿›è¡Œäº¤æ˜“ã€‚</strong> è¿™å¥½æ¯”è§‚çœ‹ä¸€éƒ¨ç”µå½±ï¼ŒFM èƒ½å¤Ÿè¯†åˆ«å‡ºå“ªäº›åœºæ™¯ç»„åˆèµ·æ¥æ„æˆäº†å¼‚å¸¸ã€‚</p>
<p>è¿™ç§èƒ½åŠ›åœ¨ç›—åˆ·æµ‹è¯•ç›‘æµ‹ä¸Šå–å¾—äº†æ˜¾è‘—æˆæœã€‚ä¼ ç»Ÿçš„ç›—åˆ·è€…ä¼šéšè—åœ¨å¤§å‹ç”µå•†çš„å·¨å¤§æµé‡ä¸­ï¼Œè¿›è¡Œå¤§é‡ 1 ç¾åˆ†ã€2 ç¾åˆ†çš„å°é¢æµ‹è¯•ã€‚ä¼ ç»Ÿ ML å¾ˆéš¾æ•æ‰åˆ°è¿™ç§æ’’èƒ¡æ¤’é¢å¼çš„æ”»å‡»ã€‚è€Œ FM é€šè¿‡åˆ†æåµŒå…¥å‘é‡ï¼Œèƒ½å®æ—¶å‘ç°è¿™äº›å¼‚å¸¸ç°‡ï¼Œå¹¶å°†å¤§å‹ç”¨æˆ·çš„ç›—åˆ·æ£€æµ‹ç‡ä» 59% æå‡åˆ°äº† 97%ã€‚</p>
<p>FM çš„å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å¿«é€Ÿé€‚åº”æ€§ã€‚ä¸€äº› AI å…¬å¸å‘ Stripe åæ˜ ï¼Œä»–ä»¬é¢ä¸´å¤§é‡å¯ç–‘äº¤æ˜“ï¼Œè¿™äº›äº¤æ˜“è™½ç„¶æœ€ç»ˆæ²¡æœ‰å¯¼è‡´æ¬ºè¯ˆæ€§äº‰è®®ï¼ˆå•†å®¶èƒ½æ”¶åˆ°é’±ï¼‰ï¼Œä½†å®ƒä»¬æ¥è‡ªæœºå™¨äººï¼Œä¼šå¹²æ‰°æ•°æ®ï¼Œå±äºä¸è‰¯æµé‡ã€‚Stripe åˆ©ç”¨ FM å¿«é€Ÿè¯†åˆ«å¹¶èšç±»äº†è¿™äº›æ–°å‹å¯ç–‘è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œæšä¸¾ç™»å½•æµç¨‹ä¸­çš„æŸäº›ç»„ä»¶ï¼‰ï¼Œå¹¶åœ¨å‡ å¤©å†…å°±ä¸º AI å…¬å¸æä¾›äº†æ ‡è®°è¿™äº›æµé‡çš„èƒ½åŠ›ï¼Œå…è®¸å®ƒä»¬è‡ªè¡Œå†³å®šæ˜¯å¦é˜»æ­¢è¿™äº›äº¤æ˜“ã€‚</p>
<h2 data-id="heading-2">AI æ—¶ä»£çš„ç»æµæŒ‘æˆ˜ï¼šé«˜æ˜‚çš„è¾¹é™…æˆæœ¬ä¸æ–°å‹æ¬ºè¯ˆ</h2>
<p>åœ¨ AI æ—¶ä»£ï¼Œæ¬ºè¯ˆçš„å½¢æ€å‘ç”Ÿäº†æ ¹æœ¬æ€§çš„å˜åŒ–ã€‚Emily æŒ‡å‡ºï¼Œä¸€ç§è¢«ç§°ä¸ºå‹å¥½æ¬ºè¯ˆçš„é—®é¢˜æ­£å˜å¾—å°¤ä¸ºçªå‡ºã€‚è¿™å¹¶éæŒ‡ç›—ç”¨ä»–äººä¿¡ç”¨å¡ï¼Œè€Œæ˜¯ç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„å‡­è¯è¿›è¡Œâ€œéæ”¯ä»˜æ»¥ç”¨â€ï¼Œä¾‹å¦‚å…è´¹è¯•ç”¨æ»¥ç”¨ ã€é€€æ¬¾æ»¥ç”¨æˆ–â€œå…ˆç”¨åä¸ä»˜â€ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„ SaaS æ—¶ä»£ï¼Œè¿™ä¸ªé—®é¢˜å¹¶ä¸è‡´å‘½ã€‚å› ä¸º SaaS äº§å“çš„è¾¹é™…æˆæœ¬å‡ ä¹ä¸ºé›¶ã€‚å³ä½¿ç”¨æˆ·æ»¥ç”¨äº†å…è´¹è¯•ç”¨ï¼ŒSaaS å…¬å¸æŸå¤±çš„ä¹Ÿåªæ˜¯æ½œåœ¨çš„æ”¶å…¥ï¼Œè€Œæ²¡æœ‰äº§ç”Ÿå®é™…çš„ã€é«˜æ˜‚çš„äº¤ä»˜æˆæœ¬ã€‚</p>
<p>åœ¨ AI æ—¶ä»£ï¼Œæƒ…å†µå®Œå…¨ä¸åŒã€‚GPU éå¸¸æ˜‚è´µï¼Œæ¨ç†æˆæœ¬å¾ˆé«˜ã€‚å½“ä¸€ä¸ªç”¨æˆ·æ»¥ç”¨ AI äº§å“çš„å…è´¹è¯•ç”¨æ—¶ï¼Œä»–ä»¬æ˜¯åœ¨æ¶ˆè€—å®å®åœ¨åœ¨çš„ç®—åŠ›èµ„æºã€‚è¿™ç§é«˜æ˜‚çš„è¾¹é™…æˆæœ¬ä½¿å¾—æ¬ºè¯ˆå˜ä¸ºå¯¹ AI ä¼ä¸šç”Ÿæ­»å­˜äº¡çš„å¨èƒã€‚</p>
<p>Emily åˆ†äº«äº†ä¸€ä¸ªæ¡ˆä¾‹ï¼šå¥¹ä¸ä¸€ä½å°å‹ AI åˆ›å§‹äººäº¤æµï¼Œå¯¹æ–¹ç§°æ¬ºè¯ˆä¸æ˜¯é—®é¢˜ã€‚Emily è¿½é—®åå‘ç°ï¼Œè¿™ä½åˆ›å§‹äººä¸ºäº†è§£å†³æ¬ºè¯ˆé—®é¢˜ï¼Œä¸å¾—ä¸å®Œå…¨å…³é—­äº†å…è´¹è¯•ç”¨ï¼Œå¹¶ä¸”åœ¨æ–°ç”¨æˆ·è¯æ˜å…¶æ”¯ä»˜èƒ½åŠ›ä¹‹å‰ï¼Œæå¤§åœ°é™åˆ¶äº†ä»–ä»¬çš„ç§¯åˆ†æˆ–ä½¿ç”¨é¢åº¦ã€‚Emily çŠ€åˆ©åœ°æŒ‡å‡ºï¼šâ€œä½ ä¸æ˜¯è§£å†³äº†æ¬ºè¯ˆé—®é¢˜ï¼Œä½ æ˜¯åœ¨æ‰¼æ€ä½ è‡ªå·±çš„æ”¶å…¥ã€‚â€</p>
<p>è¿™ç§ç—›è‹¦æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå®ƒè¿«ä½¿ä¼ä¸šåœ¨å¢é•¿å’Œé£é™©ä¹‹é—´åšå‡ºè‰°éš¾çš„æƒè¡¡ã€‚è¿™ä¸ªé—®é¢˜ä¸ä»…é™äº AI å…¬å¸ï¼Œä¹Ÿå­˜åœ¨äºå¹¿å‘Šå¹³å°ï¼ˆå¹¿å‘Šå•†æŠ•æ”¾äº†å¹¿å‘Šå´ä¸ä»˜é’±ï¼Œå ç”¨äº†æœ¬å¯ä»¥ä»˜è´¹çš„å¹¿å‘Šä½ï¼‰ç­‰é¢†åŸŸã€‚</p>
<p>Emily ç”šè‡³æåˆ°ï¼Œå¥¹çš„æœ‹å‹æœ€è¿‘è·å¾—äº† Robin Hood ä¿¡ç”¨å¡ï¼Œè¯¥å¡ç”šè‡³åœ¨è¥é”€ä¸­æä¾›â€œå…è´¹è¯•ç”¨å¡â€â€”â€”è¿™ç§å¡ 24 å°æ—¶åå³è¿‡æœŸï¼Œä¸“é—¨ç”¨äºæ³¨å†Œå…è´¹è¯•ç”¨ã€‚è¿™å¯¹å–„æ„çš„æ¶ˆè´¹è€…æ¥è¯´å¾ˆæ–¹ä¾¿ï¼Œä½†å¯¹æ¬ºè¯ˆè€…è€Œè¨€ï¼Œè¿™æ˜¯å¯¹ AI ç»æµæå…·ç ´åæ€§çš„å·¥å…·ã€‚</p>
<p>Stripe æ­£åœ¨æ„å»ºä¸€å¥— Radar æ‰©å±•å¥—ä»¶ï¼Œä¸“é—¨é’ˆå¯¹è¿™äº›æ–°å‹æ¬ºè¯ˆã€‚ä¾‹å¦‚ï¼ŒStripe çš„å…è´¹è¯•ç”¨äº§å“å£°ç§°å¯ä»¥åœ¨æºå¤´æ•è·å¤§å¤šæ•°å…è´¹è¯•ç”¨æ»¥ç”¨ã€‚å¯¹äºé€€æ¬¾æ»¥ç”¨ï¼ŒStripe ä¹Ÿæ­£åœ¨å¼€å‘ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆã€‚é€€æ¬¾æ»¥ç”¨åœ¨ä¼ä¸šçº§å¥—é¤ï¼ˆå¦‚æ¯æœˆ 10,000 ç¾å…ƒè´­ä¹°æ•°åä¸‡ç§¯åˆ†ï¼‰ä¸­å°¤ä¸ºä¸¥é‡ã€‚Stripe çš„ç³»ç»Ÿå¯ä»¥çœ‹åˆ°è¿™äº›ç”¨æˆ·åœ¨ä½¿ç”¨æœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œåœ¨æçŸ­æ—¶é—´å†…ç”¨å®Œæ‰€æœ‰ç§¯åˆ†ï¼‰ï¼Œå¹¶èƒ½éªŒè¯ä½¿ç”¨è€…èº«ä»½ï¼Œä»è€Œå¸®åŠ©å•†å®¶è¯†åˆ«å¹¶é˜»æ­¢è¿™ç§æ»¥ç”¨ã€‚</p>
<p>.... æ›´å¤šå†…å®¹</p>
<p>æ¬¢è¿è®¢é˜…åˆé›† <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI æ’­å®¢æ•æ‰‹</a>ï¼šä¸“é—¨é¢å‘æ–‡å­—å†…å®¹çˆ±å¥½è€…åˆ†äº« AI é¢†åŸŸä¼˜è´¨æ’­å®¢ï¼Œå…¶ä»–åˆé›†ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243230891033935893%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FZcMiAmfNkmYLDgAu0rlb1Q%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243230891033935893&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZcMiAmfNkmYLDgAu0rlb1Q&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI å†·æ€è€ƒ</a>ï¼šä¸ªäººåœ¨ AI ç‹‚æ¬¢ä¸‹çš„å†·æ€è€ƒï¼Œèšç„¦ AI å·¥ç¨‹åŒ–ã€Agent Infra äº§å“ã€æ•ˆç‡å‹ AI å·¥å…·å’Œäººæœºåä½œè¯é¢˜ï¼Œå¯»æ‰¾å¯æŒç»­çš„äº§ä¸šä»·å€¼ã€‚</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243205243418624006%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252F0Tdan3R8juUlj-Lh-QMmew%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243205243418624006&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Tdan3R8juUlj-Lh-QMmew&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI åšå®¢ç²¾é€‰</a>ï¼šç²¾å¿ƒç¼–è¯‘æµ·å¤–æŠ€æœ¯å‚å•†å‘å¸ƒçš„é«˜è´¨é‡ AI é¢†åŸŸåšå®¢æ–‡ç« ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[setTimeout å’Œ setIntervalï¼šçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ ä¸çŸ¥é“çš„ä½¿ç”¨è¯¯åŒº]]></title>    <link>https://juejin.cn/post/7570902473432973312</link>    <guid>https://juejin.cn/post/7570902473432973312</guid>    <pubDate>2025-11-10T10:14:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473432973312" data-draft-id="7563194864416210979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="setTimeout å’Œ setIntervalï¼šçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ ä¸çŸ¥é“çš„ä½¿ç”¨è¯¯åŒº"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T10:14:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ¢å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/4441682709588525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            setTimeout å’Œ setIntervalï¼šçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ ä¸çŸ¥é“çš„ä½¿ç”¨è¯¯åŒº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682709588525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ¢å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:14:05.000Z" title="Mon Nov 10 2025 10:14:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">ä¸é‚£ä¹ˆå‡†æ—¶çš„setTimeoutå’ŒsetInterval</h2>
<h3 data-id="heading-1">setTimeoutå’ŒsetIntervalçš„æ‰§è¡Œæ—¶é—´è¯¯å·®</h3>
<p>åœ¨æˆ‘ä»¬å¸¸è§è§‚å¿µä¸­ï¼Œ<strong>setTimeout</strong> å’Œ <strong>setInterval</strong> éƒ½æ˜¯ç”¨æ¥åœ¨æŒ‡å®šæ—¶é—´å®šæ—¶æ‰§è¡Œä»£ç çš„å‡½æ•°ã€‚
setTimeoutç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´åæ‰§è¡Œä¸€æ¬¡ä»£ç ï¼Œè€ŒsetIntervalåˆ™ç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…é‡å¤æ‰§è¡Œä»£ç ã€‚</p>
<p>å¦‚é¢˜ï¼Œä¸‹é¢çš„ä»£ç ï¼Œå¾ˆå¤šäººä¼šä¸‹æ„è¯†çš„è®¤ä¸º setTimeout ä¼šåœ¨1ç§’åè¾“å‡ºï¼ŒsetInterval æ¯1ç§’è¾“å‡ºä¸€æ¬¡</p>
<p>ä½†æ˜¯å®é™…æƒ…å†µä¸­ï¼ŒsetTimeoutå’ŒsetIntervalçš„æ‰§è¡Œæ—¶é—´æ˜¯æœ‰ä¸€å®šè¯¯å·®çš„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>(); <span class="hljs-comment">// è®°å½•å¼€å§‹æ—¶é—´</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`setTimeoutå®é™…æ‰§è¡Œæ—¶é—´ï¼š<span class="hljs-subst">${end - start}</span>ms`</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>(); <span class="hljs-comment">// è®°å½•å¼€å§‹æ—¶é—´</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`setIntervalå®é™…æ‰§è¡Œæ—¶é—´ï¼š<span class="hljs-subst">${end - start}</span>ms`</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p><code>å®é™…ä¸Šæ‰§è¡Œæ—¶é—´ä¼šå¤§äºç­‰äºæŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87e579e21f4e4fc382585b162fe576a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-i5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763374445&amp;x-signature=FTjApNmeB08XiZXzFZeSTan5k6A%3D" alt="GIF2.gif" loading="lazy"/></p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå®šæ—¶å™¨å§‹ç»ˆå­˜åœ¨å®é™…æœ€å°æ‰§è¡Œé—´éš”ï¼Œå³ä½¿æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´ä¸º<strong>0ms</strong>ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚</p>
<h4 data-id="heading-2">1ã€JS å¼•æ“æœºåˆ¶</h4>
<p>è¿™æ˜¯å› ä¸ºJavaScriptæ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œè€Œ setTimeout å’Œ setInterval éƒ½æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œ
å½“JavaScriptå¼•æ“æ‰§è¡Œåˆ° setTimeout æˆ– setInterval æ—¶ï¼Œä¼šå°†å…¶æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°å¿…é¡»ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²æ—¶æ‰èƒ½æ‰§è¡Œã€‚è€Œä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œå–å†³äºå½“å‰æ‰§è¡Œçš„ä»£ç çš„è€—æ—¶ã€‚
å³ä½¿ä¸»çº¿ç¨‹ç©ºé—²ï¼Œæµè§ˆå™¨ä¹Ÿéœ€è¦ä¸€å®šæ—¶é—´è°ƒåº¦å›è°ƒå‡½æ•°ï¼ˆå±äºå¼•æ“å†…éƒ¨çš„ â€œè°ƒåº¦å¼€é”€â€ï¼‰ï¼Œè¿™ä¸ªå¼€é”€é€šå¸¸åœ¨ <strong>1ms~4ms</strong> ä¹‹é—´</p>
<h4 data-id="heading-3">2ã€HTML5 è§„èŒƒ</h4>
<ol>
<li>
<p>HTML5 è§„èŒƒæ˜ç¡®è§„å®šäº†<strong>å®šæ—¶å™¨çš„æœ€å°å»¶è¿Ÿé™åˆ¶ä¸º4ms</strong>ï¼ŒåµŒå¥—å±‚çº§è¾ƒæµ…æ—¶æœ€å°å»¶è¿Ÿå¯èƒ½ä½è‡³1msã€‚</p>
</li>
<li>
<p>å¯¹äºåµŒå¥—å±‚çº§ â‰¥ 5 çš„å®šæ—¶å™¨ï¼ˆå³å®šæ—¶å™¨å›è°ƒä¸­å†æ¬¡åˆ›å»ºå®šæ—¶å™¨ï¼Œå½¢æˆåµŒå¥—ï¼‰ï¼Œæµè§ˆå™¨ä¼šå¼ºåˆ¶å°†æœ€å°å»¶è¿Ÿé™åˆ¶ä¸º 4msã€‚</p>
</li>
<li>
<p>å¤„äºåå°æ ‡ç­¾é¡µä¸­çš„è®¡æ—¶å™¨ä¹Ÿå¯èƒ½ä¼šè¢«é™åˆ¶ä¸º1ç§’çš„æœ€å°å»¶è¿Ÿ</p>
</li>
</ol>
<p>å› æ­¤ï¼Œå¯¹äºå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ä¾èµ– setTimeout å’Œ setInterval çš„ç²¾ç¡®æ‰§è¡Œæ—¶é—´ï¼Œè€Œåº”è¯¥æ ¹æ®å®é™…éœ€æ±‚æ¥è°ƒæ•´å®šæ—¶å™¨çš„å»¶è¿Ÿæ—¶é—´ã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äºå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ä¾èµ– <code>0ms</code> å»¶è¿Ÿå®ç°é«˜ç²¾åº¦é€»è¾‘ï¼ˆæ¯”å¦‚åŠ¨ç”»å¸§ï¼‰</p>
<p>æ¨èä½¿ç”¨ <code>requestAnimationFrame</code>ï¼ˆä¸“é—¨ä¸ºåŠ¨ç”»è®¾è®¡ï¼Œä¸æµè§ˆå™¨åˆ·æ–°é¢‘ç‡åŒæ­¥ï¼‰</p>
<h3 data-id="heading-4">è§£å†³æ–¹æ³•</h3>
<p>1ã€è°ƒæ•´å»¶è¿Ÿæ—¶é—´
æ ¹æ®å®é™…éœ€æ±‚ï¼Œåˆç†è°ƒæ•´å®šæ—¶å™¨çš„å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœå¯¹æ‰§è¡Œæ—¶é—´æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œå»ºè®®ä½¿ç”¨ Date.now() æˆ–performance.now() æ¥è®¡ç®—å®é™…æ‰§è¡Œæ—¶é—´ï¼Œè€Œä¸æ˜¯ä¾èµ–å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>2ã€ä½¿ç”¨ requestAnimationFrame
requestAnimationFrame æ˜¯æµè§ˆå™¨æä¾›çš„ç”¨äºåŠ¨ç”»å¾ªç¯çš„å‡½æ•°ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚ä¸æµè§ˆå™¨åˆ·æ–°é¢‘ç‡åŒæ­¥ï¼Œä½¿ç”¨ requestAnimationFrame å¯ä»¥å®ç°æ›´ç²¾ç¡®çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<h2 data-id="heading-5">setIntervalå­˜åœ¨çš„é—®é¢˜</h2>
<p>é™¤äº†æœ€å°å»¶è¿Ÿæ—¶é—´å¤–ï¼ŒsetInterval è¿˜å­˜åœ¨ä¸€äº›é¢å¤–é—®é¢˜ï¼Œä¸»è¦è¡¨ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h3 data-id="heading-6">1ã€ä»»åŠ¡å †å ï¼ˆæ‰§è¡Œè€—æ—¶  &gt;  è®¾å®šé—´éš”ï¼‰</h3>
<p>å¦‚æœå›è°ƒä¸­çš„æ‰§è¡Œè€—æ—¶è¶…è¿‡é—´éš”æ—¶é—´ï¼ŒsetInterval å¯ä¸ä¼šç­‰ä½ ï¼Œè€Œæ˜¯ä¼šç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªå›è°ƒï¼Œå®ƒä¼šæ— è§†ä¸Šæ¬¡å›è°ƒæ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œå°†æ–°çš„å›è°ƒæ¨å…¥é˜Ÿåˆ—ï¼Œå¯¼è‡´ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å †ç§¯ï¼Œä¸»çº¿ç¨‹ç©ºé—²åï¼Œè¿™äº›å›è°ƒä¼šè¿ç»­åœ°æ‰§è¡Œï¼Œå¤±å»é—´éš”æ„ä¹‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  count++;
  <span class="hljs-comment">// æ¯ç§’å…ˆè¾“å‡ºå½“å‰æ‰§è¡Œä¿¡æ¯</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ‰§è¡Œç¬¬<span class="hljs-subst">${count}</span>æ¬¡ï¼Œç´¯è®¡è¿è¡Œ<span class="hljs-subst">${((<span class="hljs-built_in">Date</span>.now() - startTime) / <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">1</span>)}</span>s`</span>);
  <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼ˆé˜»å¡2sï¼‰</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">2000</span>) {} <span class="hljs-comment">// é˜»å¡2000ms</span>
  <span class="hljs-comment">// è¾“å‡ºä»»åŠ¡å®Œæˆä¿¡æ¯ï¼Œå¹¶æ ‡è®°æ—¶é—´ç‚¹</span>
  <span class="hljs-keyword">if</span> (count === <span class="hljs-number">1</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç¬¬ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ˆçº¦3ç§’åï¼‰"</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ˆé—´éš”çº¦2ç§’ï¼‰"</span>);
  }
}, <span class="hljs-number">1000</span>); <span class="hljs-comment">// é—´éš”1000ms</span>
<span class="hljs-comment">// å®é™…ä¸ºé™¤äº†ç¬¬ä¸€æ¬¡æ˜¯3såæ‰§è¡Œå®Œæˆï¼Œåç»­éƒ½æ˜¯2såæ‰§è¡Œå®Œæˆï¼Œä¸ä¼šæŒ‰ç…§é¢„è®¾çš„1sé—´éš”æ‰§è¡Œ</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c6101b8b3274d47ba40309ea75e3aa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-i5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763374445&amp;x-signature=WmNqYk7xjPs6fCFTbT%2Fv3aQVK88%3D" alt="GIF.gif" loading="lazy"/>
<code>å¦‚æœå›è°ƒä¸­çš„æ‰§è¡Œè€—æ—¶è¶…è¿‡é—´éš”æ—¶é—´ï¼Œå®é™…é—´éš”æ—¶é—´å°±æ˜¯æ‰§è¡Œä»»åŠ¡æ¶ˆè€—çš„æ—¶é—´ï¼Œè€Œä¸æ˜¯è®¾å®šçš„å€¼</code></p>
<h3 data-id="heading-7">2ã€è¯¯å·®ç´¯ç§¯ï¼ˆæ—¶é—´ä¸å‡†ï¼‰</h3>
<p>ä¸Šé¢è¯´è¿‡ï¼Œç”±äºjsçš„å•çº¿ç¨‹æœºåˆ¶ï¼ŒsetInterval æ— æ³•ä¿è¯ç²¾ç¡®é—´éš”â€‹ï¼Œå®é™…è¾“å‡ºæ—¶é—´é—´éš”å¯èƒ½å¤§äºè®¾å®šçš„æ—¶é—´ï¼Œå› ä¸ºjsæ˜¯å•çº¿ç¨‹çš„ï¼Œæ¸¸è§ˆå™¨æœ€å°é—´éš”é™åˆ¶ï¼šæµè§ˆå™¨é€šå¸¸æœ‰ â€‹4ms æœ€å°å»¶è¿Ÿâ€‹ï¼ˆå³ä½¿è®¾ 0msï¼‰ï¼Œæ²¡æœ‰0å»¶æ—¶å®šæ—¶å™¨ï¼ŒåŒ…æ‹¬setTimeoutã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ setInterval æ—¶ï¼Œéœ€è¦æ³¨æ„ä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶ï¼Œé¿å…è€—æ—¶è¿‡é•¿å¯¼è‡´è¯¯å·®ç´¯ç§¯ã€‚</p>
<h3 data-id="heading-8">3ã€å†…å­˜æ³„æ¼ï¼ˆå¿˜è®°æ¸…é™¤ï¼‰</h3>
<p>å¿˜è®°æ¸…ç† setTimeout åªä¼šå¯¼è‡´ä¸€ä¸ªå¤šä½™çš„å›è°ƒæ‰§è¡Œã€‚ä½†å¿˜è®° clearInterval ä¼šå¯¼è‡´å›è°ƒå‡½æ•°æ— é™æ‰§è¡Œï¼Œé€ æˆä¸¥é‡çš„å†…å­˜æ³„æ¼ï¼Œä¸”é¡µé¢è·³è½¬ä¹Ÿä¸ä¼šè‡ªåŠ¨åœæ­¢ï¼ˆåœ¨ SPA ä¸­æœ€ä¸ºæ˜æ˜¾ï¼‰</p>
<h3 data-id="heading-9">è§£å†³åŠæ³•</h3>
<p>æ‰‹åŠ¨å†™ä¸€ä¸ª <strong>setTimeout é€’å½’å°è£…çš„ã€Œå®‰å…¨ç‰ˆå®šæ—¶å™¨ã€</strong>ï¼Œè§£å†³ setInterval å¯èƒ½å‡ºç°çš„ä»»åŠ¡å †å ç­‰é—®é¢˜ï¼Œç¡®ä¿å‰ä¸€æ¬¡å›è°ƒå®Œå…¨æ‰§è¡Œå®Œæ¯•åï¼Œæ‰è§¦å‘ä¸‹ä¸€æ¬¡</p>
<p>ç®€å•ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myInterval</span>(<span class="hljs-params">fn, delay</span>) {
  <span class="hljs-comment">// é€’å½’æ‰§è¡Œå‡½æ•°</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">run</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
    <span class="hljs-built_in">setTimeout</span>(run, delay); <span class="hljs-comment">// ä»»åŠ¡å®Œæˆåï¼Œæ‰è§¦å‘ä¸‹ä¸€æ¬¡</span>
  };
  <span class="hljs-comment">// å¯åŠ¨é¦–æ¬¡æ‰§è¡Œ</span>
  <span class="hljs-built_in">setTimeout</span>(run, delay);
}
</code></pre>
<p>ä½¿ç”¨æ•ˆæœ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-title function_">myInterval</span>(<span class="hljs-function">() =&gt;</span> {
  count++;
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">1000</span>) {} <span class="hljs-comment">// é˜»å¡1000ms</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ‰§è¡Œç¬¬<span class="hljs-subst">${count}</span>æ¬¡ï¼Œç´¯è®¡è¿è¡Œ<span class="hljs-subst">${((<span class="hljs-built_in">Date</span>.now() - startTime) / <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">1</span>)}</span>s`</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d2d37d3144d4bba9c4b359bd8d8c7d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-i5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763374445&amp;x-signature=5697PMBvazkcfsfN2il0H%2F5ZsVM%3D" alt="GIF3.gif" loading="lazy"/>
æ¯<strong>2s</strong>é—´éš”æ‰§è¡Œï¼Œè¿™æ ·ç¡®ä¿äº†æ¯æ¬¡å›è°ƒæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šè§¦å‘ä¸‹ä¸€æ¬¡ï¼Œé¿å…äº†ä»»åŠ¡å †å é—®é¢˜ã€‚</p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>åœ¨å¼€å‘ä¸­ï¼Œåœ¨å¤§å¤šæ•°éœ€è¦è½®è¯¢å®šæ—¶å™¨çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨é€’å½’çš„ setTimeout ç›¸å¯¹æ›´å®‰å…¨ã€æ›´å¯æ§ï¼Œä½¿ç”¨ setInterval æ—¶è¦åšåˆ°å¿ƒä¸­æœ‰æ•°ï¼Œé¿å…äº§ç”Ÿbugã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æï¼ˆä¸€ä¸ªCrashå¼•å‘çš„æ€è€ƒï¼‰]]></title>    <link>https://juejin.cn/post/7570903763721453578</link>    <guid>https://juejin.cn/post/7570903763721453578</guid>    <pubDate>2025-11-10T10:11:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763721453578" data-draft-id="7570932873130557467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æï¼ˆä¸€ä¸ªCrashå¼•å‘çš„æ€è€ƒï¼‰"/> <meta itemprop="keywords" content="æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-11-10T10:11:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èŒƒç‰¹è›Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3773179636744205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æï¼ˆä¸€ä¸ªCrashå¼•å‘çš„æ€è€ƒï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179636744205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èŒƒç‰¹è›Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:11:12.000Z" title="Mon Nov 10 2025 10:11:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æ</h2>
<blockquote>
<p>èµ·å› ï¼šandroidx.recyclerview.widget.RecyclerView$Recycler.validateViewHolderForOffsetPosition</p>
</blockquote>
<blockquote>
<p>åŒ…å« RecyclerViewã€GapWorker å’Œ Choreographer çš„å®Œæ•´å·¥ä½œåŸç†</p>
</blockquote>
<h3 data-id="heading-1">ç›®å½•</h3>
<ul>
<li><a href="#%E4%B8%80recyclerview-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" title="#%E4%B8%80recyclerview-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">ä¸€ã€RecyclerView å·¥ä½œåŸç†</a></li>
<li><a href="#%E4%BA%8Cgapworker-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90" title="#%E4%BA%8Cgapworker-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">äºŒã€GapWorker æ·±åº¦è§£æ</a></li>
<li><a href="#%E4%B8%89choreographer-%E8%AF%A6%E8%A7%A3" title="#%E4%B8%89choreographer-%E8%AF%A6%E8%A7%A3">ä¸‰ã€Choreographer è¯¦è§£</a></li>
</ul>
<hr/>
<h2 data-id="heading-2">ä¸€ã€RecyclerView å·¥ä½œåŸç†</h2>
<p>RecyclerView æ˜¯ Android ä¸­ç”¨äºé«˜æ•ˆæ˜¾ç¤ºå¤§é‡æ•°æ®çš„ç»„ä»¶ã€‚</p>
<h3 data-id="heading-3">æ ¸å¿ƒè®¾è®¡ç†å¿µ</h3>
<p><strong>å¤ç”¨ï¼ˆRecycleï¼‰+ è§†å›¾æŒæœ‰è€…ï¼ˆViewHolderï¼‰= é«˜æ€§èƒ½åˆ—è¡¨</strong></p>
<p>ä¼ ç»Ÿçš„ ListView æ¯æ¬¡æ»šåŠ¨éƒ½è¦ <code>findViewById</code>ï¼Œéå¸¸è€—æ—¶ã€‚RecyclerView é€šè¿‡ç¼“å­˜å’Œå¤ç”¨æœºåˆ¶å¤§å¹…æå‡æ€§èƒ½ã€‚</p>
<h3 data-id="heading-4">æ ¸å¿ƒç»„ä»¶</h3>
<h4 data-id="heading-5">1. ViewHolderï¼ˆè§†å›¾æŒæœ‰è€…ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewHolder</span>(itemView: View) : RecyclerView.ViewHolder(itemView) {
    <span class="hljs-keyword">val</span> textView = itemView.findViewById&lt;TextView&gt;(R.id.text)
    <span class="hljs-comment">// ç¼“å­˜å­Viewçš„å¼•ç”¨ï¼Œé¿å…é‡å¤ findViewById</span>
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜ itemView ä¸­çš„å­ View å¼•ç”¨</li>
<li>æºå¸¦ positionã€itemId ç­‰å…ƒæ•°æ®</li>
<li>ä¸€ä¸ª ViewHolder å¯¹åº”ä¸€ä¸ªåˆ—è¡¨é¡¹</li>
</ul>
<h4 data-id="heading-6">2. Adapterï¼ˆé€‚é…å™¨ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> : <span class="hljs-type">RecyclerView.Adapter</span>&lt;<span class="hljs-type">MyViewHolder</span>&gt;() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> { ... }          <span class="hljs-comment">// æ•°æ®æ€»æ•°</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(...)</span></span>: MyViewHolder <span class="hljs-comment">// åˆ›å»ºViewHolder</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder, position)</span></span>    <span class="hljs-comment">// ç»‘å®šæ•°æ®</span>
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>ç®¡ç†æ•°æ®æº</li>
<li>åˆ›å»ºå’Œç»‘å®š ViewHolder</li>
<li>é€šçŸ¥ RecyclerView æ•°æ®å˜åŒ–</li>
</ul>
<h4 data-id="heading-7">3. LayoutManagerï¼ˆå¸ƒå±€ç®¡ç†å™¨ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">LinearLayoutManager    <span class="hljs-comment">// çº¿æ€§å¸ƒå±€</span>
GridLayoutManager      <span class="hljs-comment">// ç½‘æ ¼å¸ƒå±€</span>
StaggeredGridLayoutManager <span class="hljs-comment">// ç€‘å¸ƒæµ</span>
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å†³å®š item å¦‚ä½•æ‘†æ”¾ï¼ˆå‚ç›´ã€æ¨ªå‘ã€ç½‘æ ¼ç­‰ï¼‰</li>
<li>å¤„ç†æ»šåŠ¨é€»è¾‘</li>
<li>å†³å®šå“ªäº› item å¯è§</li>
</ul>
<h4 data-id="heading-8">4. Recyclerï¼ˆå›æ”¶å™¨ï¼‰</h4>
<p>æ ¸å¿ƒå¤ç”¨æœºåˆ¶çš„å®ç°è€…ï¼Œç®¡ç†å¤šçº§ç¼“å­˜ã€‚</p>
<h3 data-id="heading-9">å››çº§ç¼“å­˜æœºåˆ¶</h3>
<p>è¿™æ˜¯ RecyclerView æ€§èƒ½çš„æ ¸å¿ƒï¼</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          RecyclerView ç¼“å­˜æ±              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>. mAttachedScrap (å±å¹•å†…ç¼“å­˜)           â”‚  â† æœ€å¿«ï¼Œæ— éœ€ç»‘å®š
â”‚    - ä¿å­˜æ­£åœ¨æ˜¾ç¤ºçš„ ViewHolder            â”‚
â”‚    - ç”¨äºå¸ƒå±€æœŸé—´ä¸´æ—¶åˆ†ç¦»çš„ ViewHolder     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">2</span>. mCachedViews (ç¦»å±ç¼“å­˜)               â”‚  â† å¿«ï¼Œæ— éœ€ç»‘å®š
â”‚    - é»˜è®¤å¤§å°ï¼š<span class="hljs-number">2</span>                          â”‚
â”‚    - ä¿å­˜åˆšæ»šå‡ºå±å¹•çš„ ViewHolder           â”‚
â”‚    - <span class="hljs-attribute">position</span> å’Œæ•°æ®å®Œå…¨åŒ¹é…æ‰èƒ½å¤ç”¨       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">3</span>. ViewCacheExtension (è‡ªå®šä¹‰ç¼“å­˜)       â”‚  â† å¼€å‘è€…è‡ªå®šä¹‰
â”‚    - å‡ ä¹ä¸ç”¨                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">4</span>. RecycledViewPool (å›æ”¶æ± )            â”‚  â† éœ€è¦é‡æ–°ç»‘å®š
â”‚    - é»˜è®¤æ¯ç§ type ç¼“å­˜ <span class="hljs-number">5</span> ä¸ª               â”‚
â”‚    - æŒ‰ viewType åˆ†ç±»å­˜å‚¨                 â”‚
â”‚    - ViewHolder ä¼šæ¸…é™¤ <span class="hljs-attribute">position</span> ä¿¡æ¯      â”‚
â”‚    - éœ€è¦é‡æ–° <span class="hljs-built_in">onBindViewHolder</span>()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-10">ç¼“å­˜æŸ¥æ‰¾ä¼˜å…ˆçº§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¼ªä»£ç å±•ç¤ºç¼“å­˜æŸ¥æ‰¾æµç¨‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">tryGetViewHolderForPositionByDeadline</span><span class="hljs-params">(position: <span class="hljs-type">Int</span>)</span></span>: ViewHolder? {
    <span class="hljs-comment">// 1. å…ˆä» mAttachedScrap æ‰¾ï¼ˆç²¾ç¡®åŒ¹é… positionï¼‰</span>
    holder = mAttachedScrap.findByPosition(position)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> holder  <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ bind</span>

    <span class="hljs-comment">// 2. ä» mCachedViews æ‰¾ï¼ˆç²¾ç¡®åŒ¹é… positionï¼‰</span>
    holder = mCachedViews.findByPosition(position)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> holder  <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ bind</span>

    <span class="hljs-comment">// 3. ä»è‡ªå®šä¹‰ç¼“å­˜æ‰¾</span>
    holder = mViewCacheExtension?.getViewForPosition(position)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> holder

    <span class="hljs-comment">// 4. ä» RecycledViewPool æ‰¾ï¼ˆæŒ‰ viewType æŸ¥æ‰¾ï¼‰</span>
    holder = mRecyclerPool.getRecycledView(viewType)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
        holder.resetInternal()  <span class="hljs-comment">// æ¸…é™¤æ—§æ•°æ®</span>
        adapter.bindViewHolder(holder, position)  <span class="hljs-comment">// éœ€è¦é‡æ–°ç»‘å®š</span>
        <span class="hljs-keyword">return</span> holder
    }

    <span class="hljs-comment">// 5. æ‰€æœ‰ç¼“å­˜éƒ½æ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„</span>
    holder = adapter.createViewHolder(parent, viewType)
    adapter.bindViewHolder(holder, position)
    <span class="hljs-keyword">return</span> holder
}
</code></pre>
<h3 data-id="heading-11">å·¥ä½œæµç¨‹</h3>
<h4 data-id="heading-12">1. åˆå§‹åŒ–é˜¶æ®µ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">recyclerView.layoutManager = LinearLayoutManager(context)
recyclerView.adapter = myAdapter
</code></pre>
<p>RecyclerView ä¼šï¼š</p>
<ol>
<li>æµ‹é‡è‡ªå·±çš„å°ºå¯¸</li>
<li>è®© LayoutManager å¸ƒå±€å­ View</li>
<li>æ ¹æ®å¯è§åŒºåŸŸåˆ›å»ºè¶³å¤Ÿçš„ ViewHolder</li>
</ol>
<h4 data-id="heading-13">2. æ»šåŠ¨é˜¶æ®µ</h4>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·å‘ä¸Šæ»šåŠ¨ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ position <span class="hljs-number">0</span>       â”‚ â† æ»šå‡ºå±å¹•ï¼Œè¿›å…¥ mCachedViews
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">1</span>       â”‚ â† å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">2</span>       â”‚ â† å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">3</span>       â”‚ â† å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">4</span>       â”‚ â† å³å°†å¯è§ï¼Œä»ç¼“å­˜ä¸­å– ViewHolder
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æµç¨‹</strong>ï¼š</p>
<ol>
<li>position 0 æ»šå‡ºå±å¹• â†’ detach â†’ æ”¾å…¥ <code>mCachedViews</code></li>
<li>position 4 å³å°†è¿›å…¥å±å¹• â†’ ä»ç¼“å­˜æŸ¥æ‰¾ ViewHolder</li>
<li>å¦‚æœ <code>mCachedViews</code> æ»¡äº†ï¼ˆè¶…è¿‡2ä¸ªï¼‰â†’ æœ€æ—§çš„ç§»åˆ° <code>RecycledViewPool</code></li>
</ol>
<h4 data-id="heading-14">3. æ•°æ®æ›´æ–°é˜¶æ®µ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šnotifyDataSetChanged()</span>
adapter.notifyDataSetChanged()
<span class="hljs-comment">// æ‰€æœ‰ç¼“å­˜å¤±æ•ˆï¼Œå…¨éƒ¨é‡æ–° bindï¼Œæ€§èƒ½å·®</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šç²¾ç¡®é€šçŸ¥</span>
adapter.notifyItemRemoved(position)      <span class="hljs-comment">// åˆ é™¤</span>
adapter.notifyItemInserted(position)     <span class="hljs-comment">// æ’å…¥</span>
adapter.notifyItemChanged(position)      <span class="hljs-comment">// æ›´æ–°</span>
adapter.notifyItemMoved(from, to)        <span class="hljs-comment">// ç§»åŠ¨</span>
</code></pre>
<h3 data-id="heading-15">notify æ–¹æ³•å¯¹æ¯”</h3>








































<table><thead><tr><th>æ–¹æ³•</th><th>ç¼“å­˜å¤±æ•ˆèŒƒå›´</th><th>é‡æ–° bind</th><th>åŠ¨ç”»</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td><code>notifyDataSetChanged()</code></td><td>å…¨éƒ¨å¤±æ•ˆ</td><td>å…¨éƒ¨é‡æ–° bind</td><td>âŒ æ— </td><td>âš ï¸ å·®</td></tr><tr><td><code>notifyItemRemoved(pos)</code></td><td>ä»…ä¸€ä¸ª</td><td>ä»…ä¸€ä¸ª</td><td>âœ… æœ‰</td><td>âœ… å¥½</td></tr><tr><td><code>notifyItemChanged(pos)</code></td><td>ä»…ä¸€ä¸ª</td><td>ä»…ä¸€ä¸ª</td><td>âœ… æœ‰</td><td>âœ… å¥½</td></tr><tr><td><code>notifyItemInserted(pos)</code></td><td>åç»­ä½ç½® +1</td><td>ä»…æ–°çš„</td><td>âœ… æœ‰</td><td>âœ… å¥½</td></tr></tbody></table>
<h3 data-id="heading-16">ä½ç½®ä¿¡æ¯ç®¡ç†</h3>
<p>RecyclerView ç»´æŠ¤äº†å¤æ‚çš„ä½ç½®æ˜ å°„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewHolder</span> {
    <span class="hljs-keyword">var</span> mPosition: <span class="hljs-built_in">Int</span> = NO_POSITION        <span class="hljs-comment">// å½“å‰ä½ç½®</span>
    <span class="hljs-keyword">var</span> mOldPosition: <span class="hljs-built_in">Int</span> = NO_POSITION     <span class="hljs-comment">// æ—§ä½ç½®</span>
    <span class="hljs-keyword">var</span> mPreLayoutPosition: <span class="hljs-built_in">Int</span> = NO_POSITION <span class="hljs-comment">// å¸ƒå±€å‰ä½ç½®</span>
    <span class="hljs-comment">// ... å…¶ä»–ä½ç½®ä¿¡æ¯</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆå¤šä½ç½®</strong>ï¼š</p>
<ul>
<li>åŠ¨ç”»æœŸé—´ï¼Œitem çš„ä½ç½®ä¼šå˜åŒ–</li>
<li>éœ€è¦è®°å½•åŠ¨ç”»å‰åçš„ä½ç½®</li>
<li>é¢„å–æœºåˆ¶éœ€è¦é¢„æµ‹ä½ç½®</li>
</ul>
<h3 data-id="heading-17">å®Œæ•´çš„åˆ é™¤æµç¨‹å¯¹æ¯”</h3>
<h4 data-id="heading-18">âŒ é”™è¯¯æ–¹å¼</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">datas.remove(<span class="hljs-keyword">data</span>)
notifyDataSetChanged()

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. æ‰€æœ‰ ViewHolder çš„ position ä¿¡æ¯ç«‹å³å¤±æ•ˆ</span>
<span class="hljs-comment">// 2. GapWorker å¯èƒ½ä½¿ç”¨è¿‡æœŸçš„ position</span>
<span class="hljs-comment">// 3. æ‰€æœ‰å¯è§ item éƒ½è¦é‡æ–° bindï¼ˆæ€§èƒ½å·®ï¼‰</span>
<span class="hljs-comment">// 4. æ²¡æœ‰åˆ é™¤åŠ¨ç”»</span>
</code></pre>
<h4 data-id="heading-19">âœ… æ­£ç¡®æ–¹å¼</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> position = datas.indexOf(<span class="hljs-keyword">data</span>)
<span class="hljs-keyword">if</span> (position != -<span class="hljs-number">1</span>) {
    datas.remove(<span class="hljs-keyword">data</span>)
    notifyItemRemoved(position)
    notifyItemRangeChanged(position, datas.size - position)
}

<span class="hljs-comment">// ä¼˜ç‚¹ï¼š</span>
<span class="hljs-comment">// 1. RecyclerView ç«‹å³æ›´æ–°å†…éƒ¨ä½ç½®æ˜ å°„</span>
<span class="hljs-comment">// 2. GapWorker è·å¾—å‡†ç¡®çš„ position ä¿¡æ¯</span>
<span class="hljs-comment">// 3. åªæœ‰è¢«åˆ é™¤çš„ item éœ€è¦å¤„ç†</span>
<span class="hljs-comment">// 4. æœ‰æµç•…çš„åˆ é™¤åŠ¨ç”»</span>
<span class="hljs-comment">// 5. åç»­ item çš„ position è‡ªåŠ¨æ›´æ–°</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">äºŒã€GapWorker æ·±åº¦è§£æ</h2>
<p>GapWorker æ˜¯ RecyclerView åœ¨ Android Support Library 25.1.0 å¼•å…¥çš„é¢„å–ï¼ˆPrefetchï¼‰æœºåˆ¶ï¼Œç”¨äºåœ¨ UI ç©ºé—²æ—¶æå‰å‡†å¤‡å³å°†æ˜¾ç¤ºçš„ ViewHolderã€‚</p>
<h3 data-id="heading-21">ä¸ºä»€ä¹ˆéœ€è¦ GapWorkerï¼Ÿ</h3>
<h4 data-id="heading-22">ä¼ ç»Ÿæ»šåŠ¨çš„æ€§èƒ½é—®é¢˜</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ç”¨æˆ·æ»šåŠ¨æ—¶çš„å¸§æ—¶é—´åˆ†å¸ƒï¼ˆæ²¡æœ‰</span> <span class="hljs-string">GapWorkerï¼‰ï¼š</span>

<span class="hljs-attr">Frame 1:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">(16ms</span> <span class="hljs-bullet">-</span> <span class="hljs-string">æµç•…)</span>
         <span class="hljs-string">åªéœ€è¦æ¸²æŸ“å·²æœ‰çš„</span> <span class="hljs-string">ViewHolder</span>

<span class="hljs-attr">Frame 2:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">(28ms</span> <span class="hljs-bullet">-</span> <span class="hljs-string">å¡é¡¿ï¼âš ï¸)</span>
         <span class="hljs-string">éœ€è¦åˆ›å»ºæ–°çš„</span> <span class="hljs-string">ViewHolderï¼š</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">inflate</span> <span class="hljs-string">XML</span> <span class="hljs-string">(8ms)</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">onCreateViewHolder</span> <span class="hljs-string">(2ms)</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">onBindViewHolder</span> <span class="hljs-string">(5ms)</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">measure</span> <span class="hljs-string">+</span> <span class="hljs-string">layout</span> <span class="hljs-string">(3ms)</span>
         <span class="hljs-string">æ€»è®¡è¶…è¿‡</span> <span class="hljs-string">16ms</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ‰å¸§ï¼</span>

<span class="hljs-attr">Frame 3:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">(16ms</span> <span class="hljs-bullet">-</span> <span class="hljs-string">æµç•…)</span>
</code></pre>
<h4 data-id="heading-23">æœ‰äº† GapWorker ä¹‹å</h4>
<pre><code class="hljs language-markdown" lang="markdown">Frame 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (16ms - æµç•…)
<span class="hljs-code">         æ¸²æŸ“ + GapWorker åœ¨ç©ºé—²æ—¶é—´é¢„å–
</span>
Frame 2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (14ms - æµç•…ï¼âœ…)
<span class="hljs-code">         ç›´æ¥ä½¿ç”¨é¢„å–å¥½çš„ ViewHolder
</span>
ç©ºé—²æ—¶é—´: â–‘â–‘â–‘ (2ms)
<span class="hljs-code">         GapWorker ç»§ç»­é¢„å–ä¸‹ä¸€ä¸ª
</span></code></pre>
<h3 data-id="heading-24">GapWorker æ¶æ„</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              <span class="hljs-built_in">GapWorker</span> (å•ä¾‹)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç®¡ç†å¤šä¸ª RecyclerView çš„é¢„å–ä»»åŠ¡                 â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   RecyclerView A çš„é¢„å–ä»»åŠ¡           â”‚      â”‚
â”‚  â”‚   - é¢„å– position <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>            â”‚      â”‚
â”‚  â”‚   - ä¼˜å…ˆçº§: é«˜                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   RecyclerView B çš„é¢„å–ä»»åŠ¡           â”‚      â”‚
â”‚  â”‚   - é¢„å– position <span class="hljs-number">10</span>                 â”‚      â”‚
â”‚  â”‚   - ä¼˜å…ˆçº§: ä¸­                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â”‚  é€šè¿‡ Choreographer åœ¨æ¯ä¸€å¸§æ‰§è¡Œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-25">å·¥ä½œæ—¶æœº</h3>
<p>GapWorker é€šè¿‡ <code>Choreographer</code> åœ¨æ¯ä¸€å¸§çš„ç‰¹å®šæ—¶æœºå·¥ä½œï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Android æ¯ä¸€å¸§çš„æ—¶é—´åˆ†é…ï¼ˆ<span class="hljs-number">60</span>fps = <span class="hljs-number">16.67ms</span>ï¼‰ï¼š

<span class="hljs-number">0ms</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <span class="hljs-number">16.67ms</span>
â”‚                                    â”‚
â”œâ”€ <span class="hljs-selector-tag">Input</span> (è§¦æ‘¸äº‹ä»¶)                   â”‚
â”‚  çº¦ <span class="hljs-number">2ms</span>                             â”‚
â”‚                                    â”‚
â”œâ”€ <span class="hljs-attribute">Animation</span> (åŠ¨ç”»)                   â”‚
â”‚  çº¦ <span class="hljs-number">2ms</span>                             â”‚
â”‚                                    â”‚
â”œâ”€ Traversal (æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶)        â”‚
â”‚  çº¦ <span class="hljs-number">8ms</span>                             â”‚
â”‚                                    â”‚
â”œâ”€ ç©ºé—²æ—¶é—´ â–‘â–‘â–‘â–‘â–‘â–‘                    â”‚ â† GapWorker åœ¨è¿™é‡Œå·¥ä½œï¼
â”‚  çº¦ <span class="hljs-number">4ms</span>                             â”‚
â”‚                                    â”‚
â””â”€ VSync ä¸‹ä¸€å¸§å¼€å§‹                   â”‚
</code></pre>
<h3 data-id="heading-26">é¢„å–ç­–ç•¥</h3>
<h4 data-id="heading-27">1. é¢„æµ‹ä¸‹ä¸€ä¸ªå¯è§çš„ä½ç½®</h4>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·å‘ä¸‹æ»šåŠ¨ï¼Œdy &gt; <span class="hljs-number">0</span>ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">5</span>  âœ…   â”‚ â† å®Œå…¨å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>  âœ…   â”‚ â† å®Œå…¨å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">7</span>  âœ…   â”‚ â† å®Œå…¨å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">8</span>  âš ï¸   â”‚ â† éƒ¨åˆ†å¯è§ï¼Œç»§ç»­æ»šåŠ¨ä¼šå®Œå…¨æ˜¾ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">9</span>  ğŸ¯   â”‚ â† å³å°†å¯è§ï¼Œéœ€è¦é¢„å–ï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">10</span> ğŸ¯   â”‚ â† å¯èƒ½å¯è§ï¼Œä¹Ÿé¢„å–
  ï¼ˆå±å¹•å¤–ï¼‰

é¢„å–ä¼˜å…ˆçº§ï¼š
<span class="hljs-number">1</span>. <span class="hljs-attribute">position</span> <span class="hljs-number">9</span>  (ç´§æ€¥ï¼Œé©¬ä¸Šè¦æ˜¾ç¤º)
<span class="hljs-number">2</span>. <span class="hljs-attribute">position</span> <span class="hljs-number">10</span> (æ¬¡è¦ï¼Œå¯èƒ½è¦æ˜¾ç¤º)
</code></pre>
<h4 data-id="heading-28">2. LayoutManager çš„é¢„å–å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// LinearLayoutManager çš„é¢„å–é€»è¾‘</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectInitialPrefetchPositions</span><span class="hljs-params">(
    adapterItemCount: <span class="hljs-type">Int</span>,
    layoutPrefetchRegistry: <span class="hljs-type">LayoutPrefetchRegistry</span>
)</span></span> {
    <span class="hljs-comment">// åˆå§‹å¸ƒå±€æ—¶çš„é¢„å–</span>
    <span class="hljs-keyword">val</span> prefetchCount = Math.min(
        adapterItemCount,
        mInitialPrefetchItemCount <span class="hljs-comment">// é»˜è®¤ 2 ä¸ª</span>
    )

    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until prefetchCount) {
        layoutPrefetchRegistry.addPosition(i, <span class="hljs-number">0</span>)
    }
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectAdditionalPrefetchPositions</span><span class="hljs-params">(
    dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>,
    state: <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">State</span>,
    layoutPrefetchRegistry: <span class="hljs-type">LayoutPrefetchRegistry</span>
)</span></span> {
    <span class="hljs-comment">// æ»šåŠ¨æ—¶çš„é¢„å–</span>
    <span class="hljs-keyword">val</span> layoutDirection = <span class="hljs-keyword">if</span> (dy &gt; <span class="hljs-number">0</span>) <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span> <span class="hljs-comment">// æ»šåŠ¨æ–¹å‘</span>
    <span class="hljs-keyword">val</span> scrollingOffset = Math.abs(dy)

    <span class="hljs-comment">// è®¡ç®—éœ€è¦é¢„å–çš„ä½ç½®</span>
    <span class="hljs-keyword">val</span> prefetchPosition = getCurrentPosition() + layoutDirection

    <span class="hljs-comment">// æ³¨å†Œé¢„å–ä»»åŠ¡</span>
    layoutPrefetchRegistry.addPosition(prefetchPosition, scrollingOffset)
}
</code></pre>
<h4 data-id="heading-29">3. é¢„å–ä»»åŠ¡çš„æ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// GapWorker å†…éƒ¨ä»»åŠ¡é˜Ÿåˆ—</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapWorker</span> {

    <span class="hljs-comment">// ä»»åŠ¡ç±»</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
        <span class="hljs-keyword">var</span> view: RecyclerView? = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">var</span> position: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
        <span class="hljs-keyword">var</span> immediate: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>  <span class="hljs-comment">// æ˜¯å¦ç´§æ€¥</span>
        <span class="hljs-keyword">var</span> viewVelocity: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>       <span class="hljs-comment">// æ»šåŠ¨é€Ÿåº¦</span>
        <span class="hljs-keyword">var</span> distanceToItem: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>     <span class="hljs-comment">// è·ç¦»å½“å‰ä½ç½®çš„è·ç¦»</span>
    }

    <span class="hljs-comment">// ä»»åŠ¡ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆæŒ‰ç´§æ€¥ç¨‹åº¦æ’åºï¼‰</span>
    <span class="hljs-keyword">val</span> mTasks = ArrayList&lt;Task&gt;()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sortTasks</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ’åºï¼š</span>
        <span class="hljs-comment">// 1. immediate ä»»åŠ¡ä¼˜å…ˆ</span>
        <span class="hljs-comment">// 2. è·ç¦»è¿‘çš„ä¼˜å…ˆ</span>
        <span class="hljs-comment">// 3. æ»šåŠ¨é€Ÿåº¦å¿«çš„ä¼˜å…ˆ</span>
        mTasks.sortWith { task1, task2 -&gt;
            <span class="hljs-keyword">when</span> {
                task1.immediate &amp;&amp; !task2.immediate -&gt; -<span class="hljs-number">1</span>
                !task1.immediate &amp;&amp; task2.immediate -&gt; <span class="hljs-number">1</span>
                <span class="hljs-keyword">else</span> -&gt; task1.distanceToItem - task2.distanceToItem
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-30">é¢„å–æ‰§è¡Œæµç¨‹</h3>
<h4 data-id="heading-31">è¯¦ç»†çš„æ‰§è¡Œæ­¥éª¤</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç®€åŒ–çš„æºç é€»è¾‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapWorker</span> : <span class="hljs-type">Runnable</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 1. è·å–æˆªæ­¢æ—¶é—´ï¼ˆå½“å‰å¸§ç»“æŸæ—¶é—´ï¼‰</span>
        <span class="hljs-keyword">val</span> deadlineNs = TimeUtils.currentAnimationTimeMillis() * <span class="hljs-number">1_000_000</span> + <span class="hljs-number">4_000_000</span>
        <span class="hljs-comment">// ç•™ 4ms ç»™ GapWorkerï¼Œå…¶ä»–æ—¶é—´ç•™ç»™æ¸²æŸ“</span>

        <span class="hljs-comment">// 2. æ‰§è¡Œé¢„å–ä»»åŠ¡</span>
        prefetch(deadlineNs)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">prefetch</span><span class="hljs-params">(deadlineNs: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§å¤„ç†ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (task <span class="hljs-keyword">in</span> mTasks) {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ—¶é—´</span>
            <span class="hljs-keyword">if</span> (System.nanoTime() &gt;= deadlineNs) {
                <span class="hljs-keyword">break</span> <span class="hljs-comment">// æ—¶é—´ç”¨å®Œï¼Œåœæ­¢é¢„å–</span>
            }

            <span class="hljs-comment">// æ‰§è¡Œé¢„å–</span>
            prefetchPositionWithDeadline(
                task.view,
                task.position,
                deadlineNs
            )
        }

        <span class="hljs-comment">// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span>
        mTasks.clear()
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">prefetchPositionWithDeadline</span><span class="hljs-params">(
        view: <span class="hljs-type">RecyclerView</span>?,
        position: <span class="hljs-type">Int</span>,
        deadlineNs: <span class="hljs-type">Long</span>
    )</span></span>: ViewHolder? {
        <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯å´©æºƒå‘ç”Ÿçš„åœ°æ–¹ï¼âš ï¸</span>

        <span class="hljs-keyword">val</span> holder = view?.mRecycler?.tryGetViewHolderForPositionByDeadline(
            position,
            <span class="hljs-literal">false</span>,
            deadlineNs
        )

        <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (holder.isBound &amp;&amp; !holder.isInvalid) {
                <span class="hljs-comment">// æˆåŠŸé¢„å–ï¼Œæ”¾å…¥ç¼“å­˜</span>
                view.mRecycler.recycleView(holder.itemView)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// é¢„å–å¤±è´¥ï¼Œå›æ”¶</span>
                view.mRecycler.addViewHolderToRecycledViewPool(holder, <span class="hljs-literal">false</span>)
            }
        }

        <span class="hljs-keyword">return</span> holder
    }
}
</code></pre>
<h3 data-id="heading-32">ä¸ Recycler ç¼“å­˜çš„é…åˆ</h3>
<pre><code class="hljs language-bash" lang="bash">GapWorker é¢„å–çš„ ViewHolder æ”¾åœ¨å“ªé‡Œï¼Ÿ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Recycler ç¼“å­˜ç³»ç»Ÿ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  GapWorker é¢„å–                          â”‚
â”‚      â†“                                  â”‚
â”‚  åˆ›å»º/ç»‘å®š ViewHolder                     â”‚
â”‚      â†“                                  â”‚
â”‚  æ”¾å…¥ mCachedViews (ç¦»å±ç¼“å­˜)             â”‚  â† ä¼˜å…ˆæ”¾è¿™é‡Œ
â”‚      â”‚                                  â”‚
â”‚      â”œâ”€ å¦‚æœ mCachedViews æ»¡äº†           â”‚
â”‚      â””â”€â†’ æ”¾å…¥ RecycledViewPool           â”‚  â† æ¬¡é€‰
â”‚                                         â”‚
â”‚  å½“ item æ»šåŠ¨è¿›å±å¹•æ—¶ï¼š                   â”‚
â”‚      ä» mCachedViews ç›´æ¥å–å‡º âœ…          â”‚
â”‚      æ— éœ€é‡æ–° <span class="hljs-built_in">bind</span>ï¼                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-33">IndexOutOfBoundsException å´©æºƒåœºæ™¯è¯¦ç»†åˆ†æ</h3>
<h4 data-id="heading-34">å´©æºƒçš„æ—¶åºå›¾</h4>
<pre><code class="hljs language-scss" lang="scss">ä¸»çº¿ç¨‹ï¼ˆUI Threadï¼‰                   GapWorkerï¼ˆåå°ä»»åŠ¡ï¼‰
    â”‚                                      â”‚
    â”‚ ç”¨æˆ·æ»šåŠ¨åˆ° <span class="hljs-attribute">position</span> <span class="hljs-number">5</span>                â”‚
    â”‚ LayoutManager å¸ƒå±€å®Œæˆ                â”‚
    â”‚                                      â”‚
    â”œâ”€ <span class="hljs-built_in">collectPrefetchPositions</span>()          â”‚
    â”‚  å†³å®šé¢„å– <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>                 â”‚
    â”‚                                      â”‚
    â”‚ post GapWorker<span class="hljs-selector-class">.run</span>()                 â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
    â”‚                                      â”‚
    â”‚ ç»§ç»­æ¸²æŸ“ç•Œé¢                          â”‚  GapWorker<span class="hljs-selector-class">.run</span>() å¼€å§‹
    â”‚                                      â”‚  è¯»å–ä»»åŠ¡ï¼šé¢„å– <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>
    â”‚                                      â”‚
    â”‚ ç”¨æˆ·ç‚¹å‡»åˆ é™¤ <span class="hljs-attribute">position</span> <span class="hljs-number">2</span> âš ï¸            â”‚
    â”‚                                      â”‚
    â”œâ”€ <span class="hljs-built_in">onClick</span>() {                         â”‚
    â”‚    datas<span class="hljs-selector-class">.remove</span>(position <span class="hljs-number">2</span>)          â”‚  â† adapter ç°åœ¨åªæœ‰ <span class="hljs-number">9</span> æ¡æ•°æ®
    â”‚    <span class="hljs-built_in">notifyDataSetChanged</span>()            â”‚  â† åªæ˜¯æ ‡è®°ï¼Œæœªç«‹å³ç”Ÿæ•ˆï¼
    â”‚  }                                   â”‚
    â”‚                                      â”‚
    â”‚                                      â”œâ”€ <span class="hljs-built_in">prefetchPositionWithDeadline</span>(<span class="hljs-number">6</span>)
    â”‚                                      â”‚  è°ƒç”¨ adapter<span class="hljs-selector-class">.getItemCount</span>()
    â”‚                                      â”‚  è¿”å› <span class="hljs-number">9</span>ï¼ˆå·²ç»åˆ é™¤äº†ä¸€æ¡ï¼‰
    â”‚                                      â”‚
    â”‚                                      â”œâ”€ <span class="hljs-built_in">validateViewHolderForOffsetPosition</span>()
    â”‚                                      â”‚  æ£€æŸ¥ <span class="hljs-attribute">position</span> <span class="hljs-number">6</span> æ˜¯å¦æœ‰æ•ˆ
    â”‚                                      â”‚
    â”‚                                      â”‚  GapWorker è®¤ä¸ºï¼š
    â”‚                                      â”‚  - ä¹‹å‰è®¡åˆ’é¢„å– <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>
    â”‚                                      â”‚  - ä½†ç°åœ¨ adapter åªæœ‰ <span class="hljs-number">9</span> æ¡æ•°æ®
    â”‚                                      â”‚  - ViewHolder çš„ä½ç½®ä¿¡æ¯ä¸ä¸€è‡´
    â”‚                                      â”‚
    â”‚                                      â”‚  æŠ›å‡ºå¼‚å¸¸ï¼šâš ï¸
    â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  IndexOutOfBoundsException:
    â”‚                                      â”‚  Inconsistency detected!
    â”‚                                      â”‚
    â”‚ CRASH! â˜ ï¸                            â”‚
</code></pre>
<h4 data-id="heading-35">å…³é”®ä»£ç è·¯å¾„</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// RecyclerView.Recycler</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">tryGetViewHolderForPositionByDeadline</span><span class="hljs-params">(
    position: <span class="hljs-type">Int</span>,
    dryRun: <span class="hljs-type">Boolean</span>,
    deadlineNs: <span class="hljs-type">Long</span>
)</span></span>: ViewHolder? {

    <span class="hljs-comment">// ... çœç•¥ç¼“å­˜æŸ¥æ‰¾é€»è¾‘</span>

    <span class="hljs-comment">// å…³é”®æ£€æŸ¥ç‚¹ï¼šéªŒè¯ ViewHolder çš„ä½ç½®æ˜¯å¦æœ‰æ•ˆ</span>
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (!holder.isValid || holder.position != position) {
            <span class="hljs-comment">// è¿™é‡Œæ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼âš ï¸</span>
            <span class="hljs-keyword">throw</span> IndexOutOfBoundsException(
                <span class="hljs-string">"Inconsistency detected. Invalid view holder "</span> +
                <span class="hljs-string">"adapter position <span class="hljs-variable">$holder</span>"</span>
            )
        }
    }

    <span class="hljs-keyword">return</span> holder
}

<span class="hljs-comment">// ä¸ºä»€ä¹ˆä¼šä¸ä¸€è‡´ï¼Ÿ</span>
<span class="hljs-comment">// 1. GapWorker è®¡åˆ’é¢„å–æ—¶ï¼šadapter.getItemCount() = 10</span>
<span class="hljs-comment">// 2. ç”¨æˆ·åˆ é™¤åï¼šadapter.getItemCount() = 9</span>
<span class="hljs-comment">// 3. ä½† GapWorker è¿˜åœ¨ç”¨æ—§çš„ position 6</span>
<span class="hljs-comment">// 4. position 6 åœ¨æ–°çš„æ•°æ®é›†ä¸­å¯èƒ½è¶Šç•Œæˆ–æŒ‡å‘é”™è¯¯çš„æ•°æ®</span>
</code></pre>
<h3 data-id="heading-36">ä¸ºä»€ä¹ˆç²¾ç¡®é€šçŸ¥èƒ½è§£å†³ï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯æ–¹å¼</span>
datas.remove(<span class="hljs-keyword">data</span>)
notifyDataSetChanged()

<span class="hljs-comment">// notifyDataSetChanged() åšäº†ä»€ä¹ˆï¼Ÿ</span>
<span class="hljs-comment">// 1. æ ‡è®°æ‰€æœ‰ ViewHolder ä¸º FLAG_INVALID</span>
<span class="hljs-comment">// 2. æ ‡è®° adapter ä¸º hasStableIds = false</span>
<span class="hljs-comment">// 3. è§¦å‘ requestLayout()</span>
<span class="hljs-comment">// 4. ä½†è¿™äº›éƒ½æ˜¯å¼‚æ­¥çš„ï¼ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼</span>
<span class="hljs-comment">// 5. GapWorker è¿˜åœ¨ä½¿ç”¨æ—§çš„ä½ç½®ä¿¡æ¯ âš ï¸</span>
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®æ–¹å¼</span>
<span class="hljs-keyword">val</span> position = datas.indexOf(<span class="hljs-keyword">data</span>)
<span class="hljs-keyword">if</span> (position != -<span class="hljs-number">1</span>) {
    datas.remove(<span class="hljs-keyword">data</span>)
    notifyItemRemoved(position)
    notifyItemRangeChanged(position, datas.size - position)
}

<span class="hljs-comment">// notifyItemRemoved() åšäº†ä»€ä¹ˆï¼Ÿ</span>
<span class="hljs-comment">// 1. ç«‹å³æ›´æ–° RecyclerView çš„å†…éƒ¨ AdapterHelper</span>
<span class="hljs-comment">// 2. AdapterHelper ç»´æŠ¤ä½ç½®æ›´æ–°æ“ä½œé˜Ÿåˆ—</span>
<span class="hljs-comment">// 3. å‘Šè¯‰ RecyclerViewï¼šposition è¢«ç§»é™¤äº†</span>
<span class="hljs-comment">// 4. RecyclerView ç«‹å³æ›´æ–°æ‰€æœ‰ ViewHolder çš„ä½ç½®</span>
<span class="hljs-comment">// 5. GapWorker æŸ¥è¯¢ä½ç½®æ—¶ï¼Œè·å¾—çš„æ˜¯æ›´æ–°åçš„æ­£ç¡®ä½ç½® âœ…</span>
</code></pre>
<h4 data-id="heading-37">AdapterHelper çš„ä½œç”¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// RecyclerView å†…éƒ¨çš„ AdapterHelper</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdapterHelper</span> {

    <span class="hljs-comment">// ä¿å­˜æ‰€æœ‰çš„æ•°æ®å˜æ›´æ“ä½œ</span>
    <span class="hljs-keyword">val</span> mPendingUpdates = ArrayList&lt;UpdateOp&gt;()

    <span class="hljs-comment">// æ“ä½œç±»å‹</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> ADD = <span class="hljs-number">1</span>      <span class="hljs-comment">// æ’å…¥</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> REMOVE = <span class="hljs-number">2</span>   <span class="hljs-comment">// åˆ é™¤</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> UPDATE = <span class="hljs-number">3</span>   <span class="hljs-comment">// æ›´æ–°</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> MOVE = <span class="hljs-number">4</span>     <span class="hljs-comment">// ç§»åŠ¨</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onItemRangeRemoved</span><span class="hljs-params">(positionStart: <span class="hljs-type">Int</span>, itemCount: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// åˆ›å»ºåˆ é™¤æ“ä½œ</span>
        <span class="hljs-keyword">val</span> op = UpdateOp(REMOVE, positionStart, itemCount)
        mPendingUpdates.add(op)

        <span class="hljs-comment">// ç«‹å³åº”ç”¨åˆ°ä½ç½®æ˜ å°„</span>
        applyRemove(op)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">applyRemove</span><span class="hljs-params">(op: <span class="hljs-type">UpdateOp</span>)</span></span> {
        <span class="hljs-comment">// æ›´æ–°åç»­æ‰€æœ‰ ViewHolder çš„ä½ç½®</span>
        <span class="hljs-keyword">for</span> (holder <span class="hljs-keyword">in</span> mCachedViews) {
            <span class="hljs-keyword">if</span> (holder.position &gt;= op.positionStart) {
                holder.offsetPosition(-op.itemCount, <span class="hljs-literal">false</span>)
            }
        }

        <span class="hljs-comment">// GapWorker è¯»å–ä½ç½®æ—¶ï¼Œä¼šç»è¿‡è¿™ä¸ªæ˜ å°„ âœ…</span>
        <span class="hljs-comment">// æ‰€ä»¥è·å¾—çš„æ˜¯æ­£ç¡®çš„ä½ç½®</span>
    }
}
</code></pre>
<h3 data-id="heading-38">GapWorker çš„ä¼˜ç¼ºç‚¹</h3>
<h4 data-id="heading-39">ä¼˜ç‚¹ âœ…</h4>
<ol>
<li><strong>æ˜¾è‘—æå‡æ»šåŠ¨æµç•…åº¦</strong>ï¼šé¿å…æ»šåŠ¨æ—¶åˆ›å»º ViewHolder å¯¼è‡´çš„å¡é¡¿</li>
<li><strong>æ™ºèƒ½é¢„æµ‹</strong>ï¼šæ ¹æ®æ»šåŠ¨æ–¹å‘å’Œé€Ÿåº¦é¢„æµ‹</li>
<li><strong>æ—¶é—´æ§åˆ¶</strong>ï¼šä¸ä¼šå ç”¨å¤ªå¤šå¸§æ—¶é—´ï¼ˆé»˜è®¤ 4msï¼‰</li>
<li><strong>å¤š RecyclerView æ”¯æŒ</strong>ï¼šä¸€ä¸ª GapWorker ç®¡ç†å¤šä¸ªåˆ—è¡¨</li>
</ol>
<h4 data-id="heading-40">ç¼ºç‚¹å’Œé£é™© âš ï¸</h4>
<ol>
<li><strong>æ•°æ®ä¸ä¸€è‡´å´©æºƒ</strong>ï¼šå¦‚é‡åˆ°çš„ IndexOutOfBoundsException</li>
<li><strong>è¿‡åº¦é¢„å–</strong>ï¼šå¯èƒ½é¢„å–ç”¨ä¸åˆ°çš„ ViewHolderï¼Œæµªè´¹èµ„æº</li>
<li><strong>å¤æ‚æ€§å¢åŠ </strong>ï¼šå¢åŠ äº†è°ƒè¯•éš¾åº¦</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šé¢„å–çš„ ViewHolder ä¼šå ç”¨é¢å¤–å†…å­˜</li>
</ol>
<h3 data-id="heading-41">æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-42">1. å§‹ç»ˆä½¿ç”¨ç²¾ç¡®é€šçŸ¥</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®</span>
adapter.notifyItemRemoved(position)
adapter.notifyItemInserted(position)
adapter.notifyItemChanged(position)

<span class="hljs-comment">// âŒ é¿å…</span>
adapter.notifyDataSetChanged()
</code></pre>
<h4 data-id="heading-43">2. åœ¨ä¸»çº¿ç¨‹ä¿®æ”¹æ•°æ®</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®</span>
lifecycleScope.launch(Dispatchers.Main) {
    adapter.removeItem(position)
}

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šåå°çº¿ç¨‹ä¿®æ”¹</span>
lifecycleScope.launch(Dispatchers.IO) {
    adapter.removeItem(position) <span class="hljs-comment">// å¯èƒ½ä¸ GapWorker å†²çª</span>
}
</code></pre>
<h4 data-id="heading-44">3. ä½¿ç”¨ DiffUtil</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// DiffUtil ä¼šè‡ªåŠ¨è®¡ç®—å·®å¼‚å¹¶è°ƒç”¨ç²¾ç¡®çš„ notify æ–¹æ³•</span>
<span class="hljs-keyword">val</span> diffResult = DiffUtil.calculateDiff(MyDiffCallback(oldList, newList))
diffResult.dispatchUpdatesTo(adapter)
</code></pre>
<h4 data-id="heading-45">4. ä¼˜åŒ– onBindViewHolder</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// GapWorker ä¼šè°ƒç”¨ bindï¼Œæ‰€ä»¥è¦ä¿æŒé«˜æ•ˆ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder: <span class="hljs-type">ViewHolder</span>, position: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-comment">// âœ… å¿«é€Ÿç»‘å®š</span>
    holder.textView.text = <span class="hljs-keyword">data</span>[position].title

    <span class="hljs-comment">// âŒ é¿å…è€—æ—¶æ“ä½œ</span>
    <span class="hljs-comment">// loadImageFromNetwork()</span>
    <span class="hljs-comment">// complexCalculation()</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-46">ä¸‰ã€Choreographer è¯¦è§£</h2>
<p>Choreographer æ˜¯ Android 4.1ï¼ˆAPI 16ï¼‰å¼•å…¥çš„æ ¸å¿ƒç±»ï¼Œç”¨äºåè°ƒåŠ¨ç”»ã€è¾“å…¥å’Œç»˜åˆ¶çš„æ—¶é—´ã€‚å®ƒçš„åå­—æ¥è‡ªæ³•è¯­"ChorÃ©graphe"ï¼Œæ„ä¸º"ç¼–èˆè€…"ï¼Œè´Ÿè´£ç¼–æ’ UI çº¿ç¨‹çš„å„ç§æ“ä½œã€‚</p>
<h3 data-id="heading-47">ä¸ºä»€ä¹ˆéœ€è¦ Choreographerï¼Ÿ</h3>
<h4 data-id="heading-48">Android 4.1 ä¹‹å‰çš„é—®é¢˜</h4>
<pre><code class="hljs language-markdown" lang="markdown">æ²¡æœ‰ Choreographer çš„æ¸²æŸ“ï¼ˆæ··ä¹±ï¼‰ï¼š

æ—¶é—´è½´ï¼š
0ms     5ms     10ms    15ms    20ms
â”‚       â”‚       â”‚       â”‚       â”‚
â”œâ”€ åŠ¨ç”»æ›´æ–°
â”‚       â”œâ”€ ç»˜åˆ¶æ“ä½œ
â”‚               â”œâ”€ è§¦æ‘¸äº‹ä»¶
â”‚                       â”œâ”€ ç»˜åˆ¶æ“ä½œ
â”‚                               â””â”€ åŠ¨ç”»æ›´æ–°

é—®é¢˜ï¼š
<span class="hljs-bullet">1.</span> æ¸²æŸ“æ—¶æœºä¸ç»Ÿä¸€ï¼Œéšæœºè§¦å‘
<span class="hljs-bullet">2.</span> å¯èƒ½åœ¨å±å¹•åˆ·æ–°çš„ä»»ä½•æ—¶åˆ»ç»˜åˆ¶
<span class="hljs-bullet">3.</span> é€ æˆç”»é¢æ’•è£‚ï¼ˆTearingï¼‰
<span class="hljs-bullet">4.</span> æ— æ³•ä¿è¯ 60fps
</code></pre>
<h4 data-id="heading-49">æœ‰äº† Choreographer ä¹‹å</h4>
<pre><code class="hljs language-css" lang="css">VSync ä¿¡å·å¯¹é½ï¼ˆæ•´é½ï¼‰ï¼š

æ—¶é—´è½´ï¼ˆ<span class="hljs-number">60</span>fps = <span class="hljs-number">16.67ms</span>ä¸€å¸§ï¼‰ï¼š
<span class="hljs-number">0ms</span>           <span class="hljs-number">16.67ms</span>        <span class="hljs-number">33.34ms</span>
â”‚             â”‚              â”‚
VSync â”€â”€â”€â”€â”€â”€â”€â”€VSync â”€â”€â”€â”€â”€â”€â”€â”€ VSync
â”‚             â”‚              â”‚
â”œâ”€ <span class="hljs-selector-tag">Input</span>      â”œâ”€ <span class="hljs-selector-tag">Input</span>       â”œâ”€ <span class="hljs-selector-tag">Input</span>
â”œâ”€ <span class="hljs-attribute">Animation</span>  â”œâ”€ <span class="hljs-attribute">Animation</span>   â”œâ”€ <span class="hljs-attribute">Animation</span>
â”œâ”€ Traversal  â”œâ”€ Traversal   â”œâ”€ Traversal
â””â”€ Commit     â””â”€ Commit      â””â”€ Commit

ä¼˜ç‚¹ï¼š
<span class="hljs-number">1</span>. æ‰€æœ‰æ¸²æŸ“æ“ä½œå¯¹é½åˆ° VSync ä¿¡å·
<span class="hljs-number">2</span>. ç”»é¢æµç•…ï¼Œæ— æ’•è£‚
<span class="hljs-number">3</span>. å¯é¢„æµ‹çš„å¸§ç‡
</code></pre>
<h3 data-id="heading-50">VSyncï¼ˆå‚ç›´åŒæ­¥ï¼‰æœºåˆ¶</h3>
<h4 data-id="heading-51">ä»€ä¹ˆæ˜¯ VSyncï¼Ÿ</h4>
<pre><code class="hljs language-ini" lang="ini">å±å¹•åˆ·æ–°åŸç†ï¼š

LCD/OLED å±å¹•çš„ç”µå­æªä»ä¸Šåˆ°ä¸‹é€è¡Œæ‰«æï¼š

ç¬¬1è¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ç¬¬2è¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ç¬¬3è¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
...    ...
ç¬¬Nè¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ‰«æå®Œä¸€å±åï¼Œå›åˆ°é¡¶éƒ¨ï¼ˆå‚ç›´å›æ‰«ï¼‰
æ­¤æ—¶å‘å‡º VSync ä¿¡å· ğŸ“¡

<span class="hljs-attr">VSync</span> = Vertical Synchronizationï¼ˆå‚ç›´åŒæ­¥ï¼‰
</code></pre>
<h4 data-id="heading-52">å±å¹•æ’•è£‚ï¼ˆTearingï¼‰é—®é¢˜</h4>
<pre><code class="hljs">æ²¡æœ‰ VSync åŒæ­¥ï¼š

GPU æ­£åœ¨æ¸²æŸ“ Frame 2      å±å¹•æ­£åœ¨æ˜¾ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚           â”‚ Frame 1 ä¸ŠåŠâ”‚ â† æ˜¾ç¤ºæ—§å¸§
â”‚  Frame 2    â”‚ â”€â”€â”€â”€â†’     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† æ’•è£‚çº¿ï¼
â”‚             â”‚           â”‚ Frame 2 ä¸‹åŠâ”‚ â† æ˜¾ç¤ºæ–°å¸§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·çœ‹åˆ°çš„ç”»é¢ä¸è¿è´¯ âš ï¸
</code></pre>
<pre><code class="hljs language-scss" lang="scss">æœ‰äº† VSync åŒæ­¥ï¼š

ç­‰å¾… VSync ä¿¡å·æ‰æäº¤æ–°å¸§

GPU æ¸²æŸ“ Frame <span class="hljs-number">2</span>          VSync ä¿¡å·      å±å¹•æ˜¾ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚           â”‚              â”‚             â”‚
â”‚  Frame <span class="hljs-number">2</span>    â”‚ â”€â”€â”€â”€â”€ç­‰å¾…â”€â”¤ VSync ğŸ“¡ â”€â”€â”€â†’â”‚  Frame <span class="hljs-number">2</span>    â”‚
â”‚             â”‚           â”‚              â”‚  (å®Œæ•´)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”»é¢æµç•…æ— æ’•è£‚ âœ…
</code></pre>
<h4 data-id="heading-53">åŒç¼“å†²ï¼ˆDouble Bufferingï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">Android çš„åŒç¼“å†²æœºåˆ¶ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ˜¾ç¤º      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Front Buffer â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Screen  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">       â†‘
       â”‚ VSync æ—¶äº¤æ¢
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç»˜åˆ¶
â”‚ Back Buffer  â”‚ â†â”€â”€â”€â”€ GPU åœ¨è¿™é‡Œç»˜åˆ¶ä¸‹ä¸€å¸§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span>
å·¥ä½œæµç¨‹ï¼š
<span class="hljs-bullet">1.</span> GPU åœ¨ Back Buffer ç»˜åˆ¶
<span class="hljs-bullet">2.</span> VSync ä¿¡å·åˆ°æ¥
<span class="hljs-bullet">3.</span> äº¤æ¢ Front å’Œ Back Buffer
<span class="hljs-bullet">4.</span> å±å¹•æ˜¾ç¤º Front Buffer
<span class="hljs-bullet">5.</span> GPU ç»§ç»­åœ¨æ–°çš„ Back Buffer ç»˜åˆ¶
</code></pre>
<h3 data-id="heading-54">Choreographer æ¶æ„</h3>
<h4 data-id="heading-55">æ ¸å¿ƒç»„ä»¶</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Choreographer (ç¼–èˆè€…)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CallbackQueue (å›è°ƒé˜Ÿåˆ—)                â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚  CALLBACK_INPUT      (è§¦æ‘¸è¾“å…¥)         â”‚   â”‚
â”‚  â”‚  CALLBACK_ANIMATION  (åŠ¨ç”»)             â”‚   â”‚
â”‚  â”‚  CALLBACK_TRAVERSAL  (æµ‹é‡/å¸ƒå±€/ç»˜åˆ¶)    â”‚   â”‚
â”‚  â”‚  CALLBACK_COMMIT     (æäº¤)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FrameDisplayEventReceiver              â”‚   â”‚
â”‚  â”‚  (æ¥æ”¶ VSync ä¿¡å·)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FrameHandler                           â”‚   â”‚
â”‚  â”‚  (ä¸»çº¿ç¨‹ Handlerï¼Œå¤„ç†å›è°ƒ)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘
           â”‚ VSync ä¿¡å·
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SurfaceFlinger  â”‚ â† ç³»ç»ŸæœåŠ¡
    â”‚  (å±å¹•åˆæˆå™¨)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-56">Choreographer æ˜¯å•ä¾‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Choreographer æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªå®ä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Choreographer</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(looper: Looper) {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// ThreadLocal ä¿è¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sThreadInstance = ThreadLocal&lt;Choreographer&gt;()

        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: Choreographer {
            <span class="hljs-keyword">return</span> sThreadInstance.<span class="hljs-keyword">get</span>() ?: synchronized(Choreographer::<span class="hljs-keyword">class</span>.java) {
                Choreographer(Looper.myLooper()).also {
                    sThreadInstance.<span class="hljs-keyword">set</span>(it)
                }
            }
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-comment">// ä¸»çº¿ç¨‹çš„ Choreographer</span>
<span class="hljs-keyword">val</span> mainChoreographer = Choreographer.getInstance() <span class="hljs-comment">// UI çº¿ç¨‹</span>

<span class="hljs-comment">// å…¶ä»–çº¿ç¨‹éœ€è¦å…ˆåˆ›å»º Looper</span>
thread {
    Looper.prepare()
    <span class="hljs-keyword">val</span> threadChoreographer = Choreographer.getInstance() <span class="hljs-comment">// ç‹¬ç«‹å®ä¾‹</span>
    Looper.loop()
}
</code></pre>
<h3 data-id="heading-57">å››ç§å›è°ƒç±»å‹</h3>
<p>Choreographer å®šä¹‰äº†å››ç§å›è°ƒç±»å‹ï¼ŒæŒ‰æ‰§è¡Œé¡ºåºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Choreographer çš„å›è°ƒç±»å‹</span>
<span class="hljs-keyword">object</span> Choreographer {
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_INPUT = <span class="hljs-number">0</span>      <span class="hljs-comment">// è¾“å…¥äº‹ä»¶</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_ANIMATION = <span class="hljs-number">1</span>  <span class="hljs-comment">// åŠ¨ç”»</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_TRAVERSAL = <span class="hljs-number">2</span>  <span class="hljs-comment">// éå†ï¼ˆæµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ï¼‰</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_COMMIT = <span class="hljs-number">3</span>     <span class="hljs-comment">// æäº¤</span>
}
</code></pre>
<h4 data-id="heading-58">æ‰§è¡Œé¡ºåºå’Œæ—¶é—´åˆ†é…</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ä¸€å¸§çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ˆ16.67ms</span> <span class="hljs-string">@</span> <span class="hljs-string">60fpsï¼‰ï¼š</span>

<span class="hljs-string">VSync</span> <span class="hljs-string">ä¿¡å·åˆ°è¾¾</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">0-2ms:</span> <span class="hljs-string">CALLBACK_INPUT</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¤„ç†è§¦æ‘¸äº‹ä»¶</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åˆ†å‘ç‚¹å‡»äº‹ä»¶</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ›´æ–°è§¦æ‘¸çŠ¶æ€</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">2-4ms:</span> <span class="hljs-string">CALLBACK_ANIMATION</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ValueAnimator.animateValue()</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ObjectAnimator</span> <span class="hljs-string">æ›´æ–°å±æ€§</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">è§†å›¾åŠ¨ç”»æ›´æ–°</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">GapWorker.postFromTraversal()</span> <span class="hljs-string">â†</span> <span class="hljs-string">åœ¨è¿™é‡Œæ³¨å†Œé¢„å–</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">4-14ms:</span> <span class="hljs-string">CALLBACK_TRAVERSAL</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ViewRootImpl.performTraversals()</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">measure</span> <span class="hljs-string">(æµ‹é‡)</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">layout</span> <span class="hljs-string">(å¸ƒå±€)</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">draw</span> <span class="hljs-string">(ç»˜åˆ¶)</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">ç”Ÿæˆ</span> <span class="hljs-string">DisplayList</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">14-16ms:</span> <span class="hljs-string">CALLBACK_COMMIT</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æäº¤æ¸²æŸ“æ•°æ®åˆ°</span> <span class="hljs-string">RenderThread</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-attr">16ms:</span> <span class="hljs-string">ç©ºé—²æ—¶é—´</span>
   <span class="hljs-string">â””â”€</span> <span class="hljs-string">GapWorker.run()</span> <span class="hljs-string">â†</span> <span class="hljs-string">RecyclerView</span> <span class="hljs-string">é¢„å–åœ¨è¿™é‡Œæ‰§è¡Œï¼</span>
</code></pre>
<h4 data-id="heading-59">è¯¦ç»†è¯´æ˜æ¯ç§å›è°ƒ</h4>
<h5 data-id="heading-60">1. CALLBACK_INPUTï¼ˆè¾“å…¥ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è§¦æ‘¸äº‹ä»¶çš„åˆ†å‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRootImpl</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deliverInputEvent</span><span class="hljs-params">(event: <span class="hljs-type">InputEvent</span>)</span></span> {
        <span class="hljs-comment">// è§¦æ‘¸äº‹ä»¶ä¼šåœ¨ CALLBACK_INPUT é˜¶æ®µå¤„ç†</span>
        Choreographer.getInstance().postCallback(
            Choreographer.CALLBACK_INPUT,
            { processInputEvent(event) },
            <span class="hljs-literal">null</span>
        )
    }
}

<span class="hljs-comment">// ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯è§¦æ‘¸å“åº”å¿«é€Ÿ</span>
</code></pre>
<h5 data-id="heading-61">2. CALLBACK_ANIMATIONï¼ˆåŠ¨ç”»ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ValueAnimator çš„å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ValueAnimator</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// æ³¨å†ŒåŠ¨ç”»å›è°ƒ</span>
        AnimationHandler.getInstance().addAnimationFrameCallback(<span class="hljs-keyword">this</span>)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAnimationFrame</span><span class="hljs-params">(frameTime: <span class="hljs-type">Long</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-comment">// æ¯ä¸€å¸§æ›´æ–°åŠ¨ç”»å€¼</span>
        <span class="hljs-keyword">val</span> fraction = (frameTime - mStartTime) / mDuration
        <span class="hljs-keyword">val</span> animatedValue = mInterpolator.getInterpolation(fraction)

        <span class="hljs-comment">// æ›´æ–°å±æ€§</span>
        mUpdateListeners.forEach { it.onAnimationUpdate(<span class="hljs-keyword">this</span>) }

        <span class="hljs-keyword">return</span> fraction &lt; <span class="hljs-number">1.0</span> <span class="hljs-comment">// æ˜¯å¦ç»§ç»­åŠ¨ç”»</span>
    }
}

<span class="hljs-comment">// AnimationHandler å†…éƒ¨ä½¿ç”¨ CALLBACK_ANIMATION</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnimationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-comment">// æ‰§è¡Œæ‰€æœ‰åŠ¨ç”»</span>
            mAnimationCallbacks.forEach {
                it.doAnimationFrame(frameTimeNanos)
            }

            <span class="hljs-comment">// å¦‚æœè¿˜æœ‰åŠ¨ç”»ï¼Œæ³¨å†Œä¸‹ä¸€å¸§</span>
            <span class="hljs-keyword">if</span> (mAnimationCallbacks.isNotEmpty()) {
                Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addAnimationFrameCallback</span><span class="hljs-params">(callback: <span class="hljs-type">AnimationFrameCallback</span>)</span></span> {
        <span class="hljs-keyword">if</span> (mAnimationCallbacks.isEmpty()) {
            <span class="hljs-comment">// ç¬¬ä¸€ä¸ªåŠ¨ç”»ï¼Œå¼€å§‹ç›‘å¬å¸§å›è°ƒ</span>
            Choreographer.getInstance().postFrameCallback(mFrameCallback)
        }
        mAnimationCallbacks.add(callback)
    }
}
</code></pre>
<h5 data-id="heading-62">3. CALLBACK_TRAVERSALï¼ˆéå†ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewRootImpl çš„ç»˜åˆ¶æµç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRootImpl</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleTraversals</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> (!mTraversalScheduled) {
            mTraversalScheduled = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// æ³¨å†Œéå†å›è°ƒ</span>
            mChoreographer.postCallback(
                Choreographer.CALLBACK_TRAVERSAL,
                mTraversalRunnable,  <span class="hljs-comment">// æ‰§è¡Œ performTraversals</span>
                <span class="hljs-literal">null</span>
            )
        }
    }

    <span class="hljs-keyword">val</span> mTraversalRunnable = Runnable {
        doTraversal()
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doTraversal</span><span class="hljs-params">()</span></span> {
        performTraversals()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performTraversals</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 1. æµ‹é‡</span>
        performMeasure(childWidthMeasureSpec, childHeightMeasureSpec)

        <span class="hljs-comment">// 2. å¸ƒå±€</span>
        performLayout(lp, mWidth, mHeight)

        <span class="hljs-comment">// 3. ç»˜åˆ¶</span>
        performDraw()
    }
}
</code></pre>
<h5 data-id="heading-63">4. CALLBACK_COMMITï¼ˆæäº¤ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æäº¤æ¸²æŸ“æ•°æ®åˆ° RenderThread</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadedRenderer</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">draw</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_COMMIT é˜¶æ®µæäº¤</span>
        updateRootDisplayList(view, callbacks)

        <span class="hljs-comment">// æ³¨å†Œ commit å›è°ƒ</span>
        mChoreographer.postCallback(
            Choreographer.CALLBACK_COMMIT,
            {
                <span class="hljs-comment">// åŒæ­¥æ¸²æŸ“æ•°æ®</span>
                nSyncAndDrawFrame(mNativeProxy, frameInfo)
            },
            <span class="hljs-literal">null</span>
        )
    }
}
</code></pre>
<h3 data-id="heading-64">Choreographer å·¥ä½œæµç¨‹</h3>
<h4 data-id="heading-65">å®Œæ•´çš„æ‰§è¡Œæµç¨‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç®€åŒ–çš„ Choreographer æºç </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Choreographer</span> {

    <span class="hljs-comment">// 1. æ³¨å†Œå›è°ƒ</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">postCallback</span><span class="hljs-params">(callbackType: <span class="hljs-type">Int</span>, action: <span class="hljs-type">Runnable</span>, token: <span class="hljs-type">Any</span>?)</span></span> {
        postCallbackDelayed(callbackType, action, token, <span class="hljs-number">0</span>)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">postCallbackDelayed</span><span class="hljs-params">(
        callbackType: <span class="hljs-type">Int</span>,
        action: <span class="hljs-type">Runnable</span>,
        token: <span class="hljs-type">Any</span>?,
        delayMillis: <span class="hljs-type">Long</span>
    )</span></span> {
        <span class="hljs-comment">// æ·»åŠ åˆ°å¯¹åº”ç±»å‹çš„é˜Ÿåˆ—</span>
        mCallbackQueues[callbackType].addCallbackLocked(action, token)

        <span class="hljs-comment">// è¯·æ±‚ VSync ä¿¡å·</span>
        scheduleFrameLocked()
    }

    <span class="hljs-comment">// 2. è¯·æ±‚ VSync</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleFrameLocked</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> (!mFrameScheduled) {
            mFrameScheduled = <span class="hljs-literal">true</span>

            <span class="hljs-keyword">if</span> (USE_VSYNC) {
                <span class="hljs-comment">// è¯·æ±‚ä¸‹ä¸€ä¸ª VSync ä¿¡å·</span>
                scheduleVsyncLocked()
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// é™çº§ï¼šä½¿ç”¨æ™®é€šæ¶ˆæ¯</span>
                <span class="hljs-keyword">val</span> msg = mHandler.obtainMessage(MSG_DO_FRAME)
                mHandler.sendMessageAtTime(msg, nextFrameTime)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleVsyncLocked</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å‘ SurfaceFlinger è¯·æ±‚ VSync ä¿¡å·</span>
        mDisplayEventReceiver.scheduleVsync()
    }

    <span class="hljs-comment">// 3. æ¥æ”¶ VSync ä¿¡å·</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameDisplayEventReceiver</span> : <span class="hljs-type">DisplayEventReceiver</span>() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onVsync</span><span class="hljs-params">(
            timestampNanos: <span class="hljs-type">Long</span>,    <span class="hljs-comment">// VSync æ—¶é—´æˆ³</span>
            physicalDisplayId: <span class="hljs-type">Long</span>,  <span class="hljs-comment">// æ˜¾ç¤ºå™¨ ID</span>
            frame: <span class="hljs-type">Long</span>              <span class="hljs-comment">// å¸§å·</span>
        )</span></span> {
            <span class="hljs-comment">// VSync ä¿¡å·åˆ°äº†ï¼</span>
            mTimestampNanos = timestampNanos
            mFrame = frame

            <span class="hljs-comment">// å‘é€æ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹</span>
            <span class="hljs-keyword">val</span> msg = Message.obtain(mHandler, <span class="hljs-keyword">this</span>)
            msg.setAsynchronous(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// å¼‚æ­¥æ¶ˆæ¯ï¼Œä¼˜å…ˆå¤„ç†</span>
            mHandler.sendMessageAtTime(msg, timestampNanos / <span class="hljs-number">1_000_000</span>)
        }

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
            <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
            doFrame(mTimestampNanos, mFrame)
        }
    }

    <span class="hljs-comment">// 4. æ‰§è¡Œä¸€å¸§</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>, frame: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-keyword">val</span> startNanos = System.nanoTime()

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æŒ‰é¡ºåºæ‰§è¡Œå››ç§å›è°ƒ</span>
            doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos)
            doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos)
            doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos)
            doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos)
        } <span class="hljs-keyword">finally</span> {
            mFrameScheduled = <span class="hljs-literal">false</span>
        }

        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ‰å¸§</span>
        <span class="hljs-keyword">val</span> endNanos = System.nanoTime()
        <span class="hljs-keyword">val</span> durationMillis = (endNanos - startNanos) / <span class="hljs-number">1_000_000</span>

        <span class="hljs-keyword">if</span> (durationMillis &gt; mFrameIntervalNanos / <span class="hljs-number">1_000_000</span>) {
            <span class="hljs-comment">// è¶…è¿‡ä¸€å¸§æ—¶é—´ï¼Œæ‰å¸§äº†ï¼</span>
            <span class="hljs-keyword">val</span> skippedFrames = (durationMillis / (mFrameIntervalNanos / <span class="hljs-number">1_000_000</span>)).toInt()
            Log.w(TAG, <span class="hljs-string">"Skipped <span class="hljs-variable">$skippedFrames</span> frames! The application may be doing too much work on its main thread."</span>)
        }
    }

    <span class="hljs-comment">// 5. æ‰§è¡Œå›è°ƒé˜Ÿåˆ—</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doCallbacks</span><span class="hljs-params">(callbackType: <span class="hljs-type">Int</span>, frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-keyword">val</span> callbacks = mCallbackQueues[callbackType]

        <span class="hljs-comment">// æ‰§è¡Œè¯¥ç±»å‹çš„æ‰€æœ‰å›è°ƒ</span>
        <span class="hljs-keyword">while</span> (callbacks.hasNext()) {
            <span class="hljs-keyword">val</span> callback = callbacks.next()
            callback.run(frameTimeNanos)
        }
    }
}
</code></pre>
<h4 data-id="heading-66">æ—¶åºå›¾</h4>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è¿›ç¨‹                          SurfaceFlinger è¿›ç¨‹
    â”‚                                   â”‚
    â”‚ <span class="hljs-built_in">scheduleTraversals</span>()              â”‚
    â”œâ”€ <span class="hljs-built_in">postCallback</span>(TRAVERSAL)          â”‚
    â”‚                                   â”‚
    â”‚ <span class="hljs-built_in">scheduleVsyncLocked</span>()             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€ <span class="hljs-built_in">requestVsync</span>() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                                   â”‚
    â”‚ ç­‰å¾… VSync...                      â”‚ ä¸‹ä¸€ä¸ª VSync å‘¨æœŸåˆ°æ¥
    â”‚                                   â”‚
    â”‚ â†â”€â”€â”€â”€â”€â”€ <span class="hljs-built_in">onVsync</span>() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ ğŸ“¡ VSync ä¿¡å·
    â”‚                                   â”‚
    â”‚ <span class="hljs-built_in">doFrame</span>()                         â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(INPUT)               â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(ANIMATION)           â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(TRAVERSAL)           â”‚
    â”‚  â””â”€ <span class="hljs-built_in">performTraversals</span>()           â”‚
    â”‚     â”œâ”€ measure                    â”‚
    â”‚     â”œâ”€ layout                     â”‚
    â”‚     â””â”€ draw                       â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(COMMIT)              â”‚
    â”‚  â””â”€ <span class="hljs-built_in">nSyncAndDrawFrame</span>() â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ æäº¤æ¸²æŸ“æ•°æ®
    â”‚                                   â”‚
    â”‚                                   â”œâ”€ åˆæˆå›¾å±‚
    â”‚                                   â””â”€ æ˜¾ç¤ºåˆ°å±å¹•
</code></pre>
<h3 data-id="heading-67">æ‰å¸§ï¼ˆJankï¼‰åˆ†æ</h3>
<h4 data-id="heading-68">ä»€ä¹ˆæ˜¯æ‰å¸§ï¼Ÿ</h4>
<pre><code class="hljs">æ­£å¸¸æƒ…å†µï¼ˆ60fpsï¼‰ï¼š

Frame 1      Frame 2      Frame 3      Frame 4
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€
0ms         16.67ms      33.34ms      50ms

æ¯å¸§è€—æ—¶ &lt; 16.67ms âœ…
</code></pre>
<pre><code class="hljs">æ‰å¸§æƒ…å†µï¼š

Frame 1      Frame 2                    Frame 3
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€
0ms         16.67ms                   50ms

Frame 2 è€—æ—¶ 33.34msï¼ˆè·¨è¶Š 2 ä¸ª VSyncï¼‰âš ï¸
ç”¨æˆ·æ„Ÿè§‰å¡é¡¿
</code></pre>
<h4 data-id="heading-69">æ‰å¸§æ£€æµ‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Choreographer å†…éƒ¨çš„æ‰å¸§æ£€æµ‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>, frame: <span class="hljs-type">Long</span>)</span></span> {
    <span class="hljs-keyword">val</span> startNanos = System.nanoTime()

    <span class="hljs-comment">// è®¡ç®—åº”è¯¥æ‰§è¡Œçš„æ—¶é—´</span>
    <span class="hljs-keyword">val</span> intendedFrameTimeNanos = mLastFrameTimeNanos + mFrameIntervalNanos

    <span class="hljs-comment">// æ£€æŸ¥å»¶è¿Ÿ</span>
    <span class="hljs-keyword">val</span> jitterNanos = frameTimeNanos - intendedFrameTimeNanos
    <span class="hljs-keyword">if</span> (jitterNanos &gt;= mFrameIntervalNanos) {
        <span class="hljs-comment">// æ‰å¸§äº†ï¼</span>
        <span class="hljs-keyword">val</span> skippedFrames = jitterNanos / mFrameIntervalNanos

        <span class="hljs-keyword">if</span> (skippedFrames &gt;= SKIPPED_FRAME_WARNING_LIMIT) {  <span class="hljs-comment">// é»˜è®¤ 30 å¸§</span>
            Log.i(TAG, <span class="hljs-string">"Skipped <span class="hljs-variable">$skippedFrames</span> frames! "</span> +
                  <span class="hljs-string">"The application may be doing too much work on its main thread."</span>)
        }
    }

    <span class="hljs-comment">// æ‰§è¡Œå›è°ƒ...</span>

    <span class="hljs-keyword">val</span> endNanos = System.nanoTime()
    <span class="hljs-keyword">val</span> frameDuration = (endNanos - startNanos) / <span class="hljs-number">1_000_000</span>

    Log.d(<span class="hljs-string">"FrameTime"</span>, <span class="hljs-string">"Frame took <span class="hljs-subst">${frameDuration}</span>ms"</span>)
}
</code></pre>
<h4 data-id="heading-70">å¸¸è§æ‰å¸§åŸå› </h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ä¸»çº¿ç¨‹è€—æ—¶æ“ä½œ âŒ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
    <span class="hljs-comment">// ä¸è¦åœ¨ä¸»çº¿ç¨‹åšè¿™äº›ï¼š</span>
    <span class="hljs-keyword">val</span> bitmap = BitmapFactory.decodeFile(<span class="hljs-string">"/sdcard/large_image.jpg"</span>)  <span class="hljs-comment">// IO æ“ä½œ</span>
    <span class="hljs-keyword">val</span> result = complexCalculation()  <span class="hljs-comment">// å¤æ‚è®¡ç®—</span>
    Thread.sleep(<span class="hljs-number">100</span>)  <span class="hljs-comment">// é˜»å¡çº¿ç¨‹</span>

    <span class="hljs-comment">// å¿…ç„¶æ‰å¸§ï¼âš ï¸</span>
}

<span class="hljs-comment">// 2. å¸ƒå±€å±‚çº§è¿‡æ·± âŒ</span>
&lt;LinearLayout&gt;
  &lt;RelativeLayout&gt;
    &lt;FrameLayout&gt;
      &lt;LinearLayout&gt;
        &lt;RelativeLayout&gt;
          &lt;!-- <span class="hljs-number">5</span>å±‚åµŒå¥—ï¼Œmeasure å’Œ layout å¾ˆæ…¢ --&gt;
        &lt;/RelativeLayout&gt;
      &lt;/LinearLayout&gt;
    &lt;/FrameLayout&gt;
  &lt;/RelativeLayout&gt;
&lt;/LinearLayout&gt;

<span class="hljs-comment">// 3. è¿‡åº¦ç»˜åˆ¶ âŒ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> {
    <span class="hljs-comment">// å¤šæ¬¡ç»˜åˆ¶åŒä¸€åŒºåŸŸ</span>
    canvas.drawColor(Color.WHITE)   <span class="hljs-comment">// èƒŒæ™¯</span>
    canvas.drawBitmap(bitmap1, ...)  <span class="hljs-comment">// å›¾å±‚1</span>
    canvas.drawBitmap(bitmap2, ...)  <span class="hljs-comment">// å›¾å±‚2</span>
    canvas.drawBitmap(bitmap3, ...)  <span class="hljs-comment">// å›¾å±‚3ï¼ˆå®Œå…¨è¦†ç›–ï¼‰</span>
    <span class="hljs-comment">// å‰é¢çš„ç»˜åˆ¶éƒ½æµªè´¹äº†ï¼</span>
}

<span class="hljs-comment">// 4. RecyclerView åˆ›å»º ViewHolder âŒ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(...)</span></span>: ViewHolder {
    <span class="hljs-comment">// inflate å¾ˆæ…¢ï¼ˆ8-10msï¼‰</span>
    <span class="hljs-keyword">val</span> view = LayoutInflater.from(context).inflate(R.layout.complex_item, parent, <span class="hljs-literal">false</span>)
    <span class="hljs-comment">// æ»šåŠ¨æ—¶åˆ›å»ºä¼šæ‰å¸§ â† GapWorker å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼</span>
}
</code></pre>
<h3 data-id="heading-71">ä¸ RecyclerView çš„å…³ç³»</h3>
<p>RecyclerView å’Œ GapWorker å¦‚ä½•é…åˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// RecyclerView çš„æ¸²æŸ“æµç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RecyclerView</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLayout</span><span class="hljs-params">(changed: <span class="hljs-type">Boolean</span>, l: <span class="hljs-type">Int</span>, t: <span class="hljs-type">Int</span>, r: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// å¸ƒå±€å­ View</span>
        dispatchLayout()

        <span class="hljs-comment">// å¸ƒå±€å®Œæˆåï¼Œé€šçŸ¥ GapWorker å¯ä»¥é¢„å–äº†</span>
        <span class="hljs-keyword">if</span> (mPrefetchRegistry != <span class="hljs-literal">null</span>) {
            mPrefetchRegistry.collectPrefetchPositions(
                mLayout,
                mState,
                mGapWorker
            )
        }
    }
}

<span class="hljs-comment">// LayoutManager æ”¶é›†é¢„å–ä½ç½®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearLayoutManager</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectAdditionalPrefetchPositions</span><span class="hljs-params">(
        dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>,
        state: <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">State</span>,
        layoutPrefetchRegistry: <span class="hljs-type">LayoutPrefetchRegistry</span>
    )</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_ANIMATION é˜¶æ®µè¢«è°ƒç”¨</span>
        <span class="hljs-keyword">val</span> prefetchPosition = getCurrentPosition() + (<span class="hljs-keyword">if</span> (dy &gt; <span class="hljs-number">0</span>) <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span>)
        layoutPrefetchRegistry.addPosition(prefetchPosition, Math.abs(dy))
    }
}

<span class="hljs-comment">// GapWorker æ³¨å†Œå›è°ƒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapWorker</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">postFromTraversal</span><span class="hljs-params">(recyclerView: <span class="hljs-type">RecyclerView</span>, dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_TRAVERSAL å®Œæˆåè¢«è°ƒç”¨</span>

        <span class="hljs-comment">// æ³¨å†Œåˆ°ä¸‹ä¸€å¸§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸æ˜¯ Choreographer å›è°ƒï¼‰</span>
        recyclerView.post(<span class="hljs-keyword">this</span>)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_COMMIT ä¹‹åçš„ç©ºé—²æ—¶é—´æ‰§è¡Œ</span>
        <span class="hljs-comment">// æ­¤æ—¶ä¸€å¸§çš„ä¸»è¦å·¥ä½œå·²å®Œæˆï¼Œå¯ä»¥é¢„å–äº†</span>

        <span class="hljs-keyword">val</span> deadlineNs = System.nanoTime() + <span class="hljs-number">4_000_000</span> <span class="hljs-comment">// ç•™ 4ms</span>
        prefetch(deadlineNs)
    }
}
</code></pre>
<h4 data-id="heading-72">å®Œæ•´çš„ä¸€å¸§æ—¶é—´çº¿ï¼ˆåŒ…å« RecyclerViewï¼‰</h4>
<pre><code class="hljs language-css" lang="css">VSync ä¿¡å·
â”‚
â”œâ”€ <span class="hljs-number">0</span>-<span class="hljs-number">2ms</span>: CALLBACK_INPUT
â”‚  â””â”€ å¤„ç†è§¦æ‘¸æ»šåŠ¨äº‹ä»¶
â”‚
â”œâ”€ <span class="hljs-number">2</span>-<span class="hljs-number">4ms</span>: CALLBACK_ANIMATION
â”‚  â”œâ”€ åŠ¨ç”»æ›´æ–°
â”‚  â””â”€ LayoutManager.<span class="hljs-built_in">collectPrefetchPositions</span>() â† æ”¶é›†é¢„å–ä½ç½®
â”‚
â”œâ”€ <span class="hljs-number">4</span>-<span class="hljs-number">14ms</span>: CALLBACK_TRAVERSAL
â”‚  â”œâ”€ RecyclerView.<span class="hljs-built_in">onLayout</span>()
â”‚  â”œâ”€ å¸ƒå±€å¯è§çš„å­ View
â”‚  â””â”€ GapWorker.<span class="hljs-built_in">postFromTraversal</span>() â† æ³¨å†Œé¢„å–ä»»åŠ¡
â”‚
â”œâ”€ <span class="hljs-number">14</span>-<span class="hljs-number">16ms</span>: CALLBACK_COMMIT
â”‚  â””â”€ æäº¤æ¸²æŸ“æ•°æ®
â”‚
â””â”€ <span class="hljs-number">16ms</span>+: ç©ºé—²æ—¶é—´ï¼ˆä¸‹ä¸€å¸§ä¹‹å‰ï¼‰
   â””â”€ GapWorker.<span class="hljs-built_in">run</span>() â† æ‰§è¡Œé¢„å–ï¼âœ…
      â”œâ”€ åˆ›å»º ViewHolder (å¦‚éœ€è¦)
      â”œâ”€ ç»‘å®šæ•°æ®
      â””â”€ æ”¾å…¥ç¼“å­˜
</code></pre>
<h3 data-id="heading-73">å®é™…åº”ç”¨</h3>
<h4 data-id="heading-74">1. ç›‘æ§å¸§ç‡</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FpsMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mFrameCount = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mLastTime = <span class="hljs-number">0L</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            mFrameCount++

            <span class="hljs-keyword">val</span> currentTime = System.currentTimeMillis()
            <span class="hljs-keyword">if</span> (currentTime - mLastTime &gt;= <span class="hljs-number">1000</span>) {
                <span class="hljs-comment">// æ¯ç§’ç»Ÿè®¡ä¸€æ¬¡</span>
                <span class="hljs-keyword">val</span> fps = mFrameCount
                Log.d(<span class="hljs-string">"FPS"</span>, <span class="hljs-string">"å½“å‰å¸§ç‡: <span class="hljs-variable">$fps</span> fps"</span>)

                <span class="hljs-keyword">if</span> (fps &lt; <span class="hljs-number">55</span>) {
                    Log.w(<span class="hljs-string">"FPS"</span>, <span class="hljs-string">"å¸§ç‡è¿‡ä½ï¼Œå¯èƒ½å¡é¡¿ï¼"</span>)
                }

                mFrameCount = <span class="hljs-number">0</span>
                mLastTime = currentTime
            }

            <span class="hljs-comment">// æ³¨å†Œä¸‹ä¸€å¸§</span>
            Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> {
        mLastTime = System.currentTimeMillis()
        Choreographer.getInstance().postFrameCallback(mFrameCallback)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span></span> {
        Choreographer.getInstance().removeFrameCallback(mFrameCallback)
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> monitor = FpsMonitor()
monitor.start()
</code></pre>
<h4 data-id="heading-75">2. æ£€æµ‹æ‰å¸§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JankDetector</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mLastFrameTimeNanos = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameIntervalNanos = <span class="hljs-number">16_666_666L</span> <span class="hljs-comment">// 60fps</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-keyword">if</span> (mLastFrameTimeNanos != <span class="hljs-number">0L</span>) {
                <span class="hljs-keyword">val</span> frameDuration = frameTimeNanos - mLastFrameTimeNanos
                <span class="hljs-keyword">val</span> skippedFrames = (frameDuration / mFrameIntervalNanos) - <span class="hljs-number">1</span>

                <span class="hljs-keyword">if</span> (skippedFrames &gt; <span class="hljs-number">0</span>) {
                    Log.w(<span class="hljs-string">"Jank"</span>, <span class="hljs-string">"æ‰å¸§ <span class="hljs-variable">$skippedFrames</span> å¸§ï¼"</span> +
                          <span class="hljs-string">"è€—æ—¶: <span class="hljs-subst">${frameDuration / <span class="hljs-number">1</span>_000_000}</span>ms"</span>)

                    <span class="hljs-comment">// ä¸ŠæŠ¥åˆ°æ€§èƒ½ç›‘æ§å¹³å°</span>
                    reportJank(skippedFrames, frameDuration)
                }
            }

            mLastFrameTimeNanos = frameTimeNanos

            <span class="hljs-comment">// ç»§ç»­ç›‘å¬</span>
            Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> {
        Choreographer.getInstance().postFrameCallback(mFrameCallback)
    }
}
</code></pre>
<h4 data-id="heading-76">3. å»¶è¿Ÿæ‰§è¡Œï¼ˆç­‰å¾…ä¸‹ä¸€å¸§ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç­‰å¾…ä¸‹ä¸€å¸§å†æ‰§è¡Œ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doOnNextFrame</span><span class="hljs-params">(action: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    Choreographer.getInstance().postFrameCallback {
        action()
    }
}

<span class="hljs-comment">// ä½¿ç”¨åœºæ™¯ï¼šView åˆšåˆ›å»ºï¼Œç­‰å¸ƒå±€å®Œæˆå†æ“ä½œ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyView</span> : <span class="hljs-type">View</span> {
    <span class="hljs-keyword">init</span> {
        doOnNextFrame {
            <span class="hljs-comment">// æ­¤æ—¶ View å·²ç»æµ‹é‡å’Œå¸ƒå±€å®Œæˆ</span>
            <span class="hljs-keyword">val</span> width = measuredWidth
            <span class="hljs-keyword">val</span> height = measuredHeight
            <span class="hljs-comment">// å¯ä»¥å®‰å…¨ä½¿ç”¨å°ºå¯¸äº†</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-77">4. ä¼˜åŒ–åŠ¨ç”»</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmoothAnimator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mStartValue = <span class="hljs-number">0f</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mEndValue = <span class="hljs-number">0f</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mStartTime = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mDuration = <span class="hljs-number">0L</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-keyword">val</span> elapsed = (frameTimeNanos - mStartTime) / <span class="hljs-number">1_000_000</span>
            <span class="hljs-keyword">val</span> fraction = (elapsed.toFloat() / mDuration).coerceIn(<span class="hljs-number">0f</span>, <span class="hljs-number">1f</span>)

            <span class="hljs-comment">// è®¡ç®—å½“å‰å€¼</span>
            <span class="hljs-keyword">val</span> value = mStartValue + (mEndValue - mStartValue) * fraction

            <span class="hljs-comment">// æ›´æ–° UI</span>
            onAnimationUpdate(value)

            <span class="hljs-keyword">if</span> (fraction &lt; <span class="hljs-number">1f</span>) {
                <span class="hljs-comment">// ç»§ç»­ä¸‹ä¸€å¸§</span>
                Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">(from: <span class="hljs-type">Float</span>, to: <span class="hljs-type">Float</span>, duration: <span class="hljs-type">Long</span>)</span></span> {
        mStartValue = from
        mEndValue = to
        mDuration = duration
        mStartTime = System.nanoTime()

        Choreographer.getInstance().postFrameCallback(mFrameCallback)
    }

    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAnimationUpdate</span><span class="hljs-params">(value: <span class="hljs-type">Float</span>)</span></span> {
        <span class="hljs-comment">// å­ç±»å®ç°</span>
    }
}
</code></pre>
<h3 data-id="heading-78">é«˜åˆ·æ–°ç‡å±å¹•æ”¯æŒ</h3>
<h4 data-id="heading-79">90Hz / 120Hz / 144Hz å±å¹•</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Android 11+ å¯ä»¥è·å–å±å¹•åˆ·æ–°ç‡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefreshRateDetector</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getRefreshRate</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: <span class="hljs-built_in">Float</span> {
        <span class="hljs-keyword">val</span> display = <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {
            context.display
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">val</span> wm = context.getSystemService(Context.WINDOW_SERVICE) <span class="hljs-keyword">as</span> WindowManager
            wm.defaultDisplay
        }

        <span class="hljs-keyword">return</span> display?.refreshRate ?: <span class="hljs-number">60f</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFrameIntervalNanos</span><span class="hljs-params">(refreshRate: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">1_000_000_000</span> / refreshRate).toLong()
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> refreshRate = detector.getRefreshRate(context)
Log.d(<span class="hljs-string">"Display"</span>, <span class="hljs-string">"å±å¹•åˆ·æ–°ç‡: <span class="hljs-variable">$refreshRate</span> Hz"</span>)

<span class="hljs-keyword">when</span> {
    refreshRate &gt;= <span class="hljs-number">120f</span> -&gt; {
        <span class="hljs-comment">// 120Hz: æ¯å¸§ 8.33ms</span>
        <span class="hljs-comment">// éœ€è¦æ›´ä¸¥æ ¼çš„æ€§èƒ½ä¼˜åŒ–</span>
    }
    refreshRate &gt;= <span class="hljs-number">90f</span> -&gt; {
        <span class="hljs-comment">// 90Hz: æ¯å¸§ 11.11ms</span>
    }
    <span class="hljs-keyword">else</span> -&gt; {
        <span class="hljs-comment">// 60Hz: æ¯å¸§ 16.67ms</span>
    }
}
</code></pre>
<h3 data-id="heading-80">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-81">1. é¿å…åœ¨å›è°ƒä¸­åšè€—æ—¶æ“ä½œ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯</span>
Choreographer.getInstance().postFrameCallback {
    <span class="hljs-keyword">val</span> bitmap = loadLargeBitmap()  <span class="hljs-comment">// IO æ“ä½œï¼Œå¾ˆæ…¢</span>
    imageView.setImageBitmap(bitmap)
}

<span class="hljs-comment">// âœ… æ­£ç¡®</span>
lifecycleScope.launch {
    <span class="hljs-keyword">val</span> bitmap = withContext(Dispatchers.IO) {
        loadLargeBitmap()  <span class="hljs-comment">// åœ¨åå°çº¿ç¨‹</span>
    }
    imageView.setImageBitmap(bitmap)  <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹</span>
}
</code></pre>
<h4 data-id="heading-82">2. ä½¿ç”¨ Systrace åˆ†æ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŠ“å– Systrace</span>
python systrace.py -a com.your.package -t 10 -o trace.html \
  gfx view res dalvik <span class="hljs-built_in">sched</span> freq idle

<span class="hljs-comment"># åˆ†æè¦ç‚¹ï¼š</span>
<span class="hljs-comment"># 1. æŸ¥çœ‹æ¯ä¸€å¸§çš„è€—æ—¶</span>
<span class="hljs-comment"># 2. æ‰¾å‡ºè¶…è¿‡ 16.67ms çš„å¸§</span>
<span class="hljs-comment"># 3. åˆ†ææ˜¯å“ªä¸ªé˜¶æ®µæ…¢ï¼ˆinput/animation/traversal/commitï¼‰</span>
<span class="hljs-comment"># 4. å®šä½å…·ä½“çš„æ…¢æ–¹æ³•</span>
</code></pre>
<h4 data-id="heading-83">3. å‡å°‘å¸ƒå±€å±‚çº§</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- âŒ è¿‡æ·±çš„å±‚çº§ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">RelativeLayout</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">RelativeLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>

<span class="hljs-comment">&lt;!-- âœ… æ‰å¹³åŒ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ConstraintLayout</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ConstraintLayout</span>&gt;</span>
</code></pre>
<h4 data-id="heading-84">4. ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åœ¨ AndroidManifest.xml ä¸­å¯ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">application</span> <span class="hljs-attr">android:hardwareAccelerated</span>=<span class="hljs-string">"true"</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ºç‰¹å®š View å¯ç”¨</span>
view.setLayerType(View.LAYER_TYPE_HARDWARE, <span class="hljs-literal">null</span>)
</code></pre>
<hr/>
<h3 data-id="heading-85">æ€»ç»“</h3>
<h4 data-id="heading-86">RecyclerView æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>å››çº§ç¼“å­˜</strong>ï¼šæè‡´çš„å¤ç”¨æœºåˆ¶</li>
<li><strong>ViewHolder</strong>ï¼šé¿å…é‡å¤ findViewById</li>
<li><strong>ç²¾ç¡®é€šçŸ¥</strong>ï¼šå‘Šè¯‰ RecyclerView å…·ä½“å“ªé‡Œå˜äº†</li>
<li><strong>ä½ç½®ç®¡ç†</strong>ï¼šç»´æŠ¤å¤æ‚çš„ä½ç½®æ˜ å°„å…³ç³»</li>
</ol>
<h4 data-id="heading-87">GapWorker æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>é¢„å–æœºåˆ¶</strong>ï¼šåœ¨ç©ºé—²æ—¶é—´æå‰å‡†å¤‡ ViewHolder</li>
<li><strong>ä¼˜å…ˆçº§è°ƒåº¦</strong>ï¼šæŒ‰è·ç¦»å’Œç´§æ€¥ç¨‹åº¦æ’åº</li>
<li><strong>æ—¶é—´æ§åˆ¶</strong>ï¼šé»˜è®¤æœ€å¤šå ç”¨ 4ms</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šå¿…é¡»ä½¿ç”¨ç²¾ç¡®çš„ notify æ–¹æ³•</li>
</ol>
<h4 data-id="heading-88">Choreographer æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>ç¼–èˆè€…</strong>ï¼šåè°ƒè¾“å…¥ã€åŠ¨ç”»ã€ç»˜åˆ¶çš„æ—¶é—´</li>
<li><strong>VSync åŒæ­¥</strong>ï¼šæ‰€æœ‰æ¸²æŸ“æ“ä½œå¯¹é½åˆ° VSync ä¿¡å·</li>
<li><strong>å››ç§å›è°ƒ</strong>ï¼šINPUT â†’ ANIMATION â†’ TRAVERSAL â†’ COMMIT</li>
<li><strong>æ‰å¸§æ£€æµ‹</strong>ï¼šè¶…è¿‡ 16.67ms å°±ä¼šæ‰å¸§</li>
</ol>
<h4 data-id="heading-89">ä¸‰è€…å…³ç³»</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">Choreographer (ç¼–èˆè€…)
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_INPUT</span>: å¤„ç†è§¦æ‘¸æ»šåŠ¨
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_ANIMATION</span>: æ”¶é›†é¢„å–ä½ç½®
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_TRAVERSAL</span>: RecyclerView å¸ƒå±€
    â”‚   â””â”€ ä½¿ç”¨å››çº§ç¼“å­˜å¿«é€Ÿå¤ç”¨ ViewHolder
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_COMMIT</span>: æäº¤æ¸²æŸ“
    â”‚
    â””â”€ ç©ºé—²æ—¶é—´: GapWorker é¢„å–
        â””â”€ é¿å…ä¸‹ä¸€å¸§åˆ›å»º ViewHolder å¯¼è‡´æ‰å¸§
</code></pre>
<h4 data-id="heading-90">å´©æºƒæ ¹æœ¬åŸå› </h4>
<p><strong>æ•°æ®æ”¹å˜å’Œé€šçŸ¥ä¸åŒæ­¥ï¼Œå¯¼è‡´ä½ç½®ä¿¡æ¯ä¸ä¸€è‡´</strong></p>
<ul>
<li>GapWorker åœ¨ç©ºé—²æ—¶é—´é¢„å–</li>
<li>ä¸»çº¿ç¨‹åŒæ—¶åˆ é™¤æ•°æ®</li>
<li>ä½¿ç”¨ <code>notifyDataSetChanged()</code> å¼‚æ­¥é€šçŸ¥</li>
<li>GapWorker ä½¿ç”¨æ—§çš„ä½ç½®ä¿¡æ¯ â†’ å´©æºƒ</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <code>notifyItemRemoved()</code> åŒæ­¥æ›´æ–°ä½ç½®</p>
<hr/>
<blockquote>
<p>æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2025-11-10
æ–‡æ¡£ç‰ˆæœ¬ï¼š1.0
é€‚ç”¨äºï¼šAndroid å¼€å‘è€…æ·±å…¥ç†è§£æ¸²æŸ“æœºåˆ¶</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring AI å®æˆ˜â€”â€”æäº¤ç”¨äºç”Ÿæˆçš„æç¤ºè¯]]></title>    <link>https://juejin.cn/post/7570901172526940195</link>    <guid>https://juejin.cn/post/7570901172526940195</guid>    <pubDate>2025-11-10T09:57:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526940195" data-draft-id="7570909641682321448" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AI å®æˆ˜â€”â€”æäº¤ç”¨äºç”Ÿæˆçš„æç¤ºè¯"/> <meta itemprop="keywords" content="Spring,AIç¼–ç¨‹,LLM"/> <meta itemprop="datePublished" content="2025-11-10T09:57:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•°æ®æ™ºèƒ½è€å¸æœº"/> <meta itemprop="url" content="https://juejin.cn/user/430664289626439"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AI å®æˆ˜â€”â€”æäº¤ç”¨äºç”Ÿæˆçš„æç¤ºè¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664289626439/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•°æ®æ™ºèƒ½è€å¸æœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:57:05.000Z" title="Mon Nov 10 2025 09:57:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æœ¬ç« å†…å®¹</h2>
<ul>
<li>å®šä¹‰æç¤ºæ¨¡æ¿ï¼ˆprompt templatesï¼‰</li>
<li>æä¾›ä¸Šä¸‹æ–‡</li>
<li>æ ¼å¼åŒ–å“åº”è¾“å‡º</li>
<li>æµå¼ä¼ è¾“å“åº”</li>
<li>è®¿é—®å“åº”å…ƒæ•°æ®</li>
</ul>
<p>åœ¨ç¬¬ 1 ç« ä¸­ï¼Œä½ åˆ›å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„ Spring AI åº”ç”¨ï¼šå®ƒåœ¨ POST è¯·æ±‚é‡Œæ¥æ”¶ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶é€šè¿‡æ³¨å…¥çš„ <code>ChatClient</code> ç›´æ¥æäº¤ç»™ LLMã€‚å®ƒè¿è¡Œè‰¯å¥½ï¼Œä½†éšç€ä½ çš„ç”Ÿæˆå¼ AI éœ€æ±‚å˜å¾—æ›´é«˜çº§ï¼Œä½ å‘ç»™ LLM çš„æç¤ºä¹Ÿä¼šéšä¹‹å¤æ‚åŒ–ã€‚æ­¤æ—¶ï¼ŒåŸºäº <code>String</code> çš„æç¤ºå¯èƒ½å°±ä¸å¤Ÿç”¨äº†ã€‚</p>
<p>å¦å¤–ï¼Œç”Ÿæˆçš„å“åº”ä¹Ÿä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ã€‚ç»“æœä¸­å¯èƒ½åŒ…å«æœ‰ç”¨çš„<strong>å…ƒæ•°æ®</strong>ï¼Œä¾‹å¦‚<strong>ç”¨é‡æ•°æ®</strong>ï¼Œå¸®åŠ©ä½ è¯„ä¼°æ¯æ¬¡ç”Ÿæˆå¯¹è®¡è´¹çš„å½±å“ã€‚å“åº”è¿˜å¯ä»¥<strong>åˆ†ç‰‡æµå¼è¿”å›</strong>ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›å®Œæ•´ç»“æœã€‚</p>
<p>æœ¬ç« å°†æŠŠä½ çš„æç¤ºä¸å“åº”å¤„ç†æå‡åˆ°æ–°æ°´å¹³ã€‚å…ˆä»<strong>å¦‚ä½•å®šä¹‰æç¤ºæ¨¡æ¿</strong>å¼€å§‹ã€‚</p>
<h2 data-id="heading-1">3.1 ä½¿ç”¨æç¤ºæ¨¡æ¿ï¼ˆWorking with prompt templatesï¼‰</h2>
<p>Spring AI æ”¯æŒ<strong>ä»æ¨¡æ¿åˆ›å»ºæç¤º</strong>ã€‚æ¨¡æ¿ç”±å›ºå®šæ–‡æœ¬ä¸ä¸€ä¸ªæˆ–å¤šä¸ª<strong>å ä½ç¬¦</strong>ç»„æˆã€‚å¦‚å›¾ 3.1 æ‰€ç¤ºï¼Œè¿™äº›æ¨¡æ¿çš„å ä½ç¬¦å°†ç”±â€œæ¨¡å‹æ•°æ®â€åœ¨æ¯æ¬¡è°ƒç”¨æ—¶å¡«å……ï¼Œä»¥ç”Ÿæˆè¦å‘é€ç»™ LLM çš„æç¤ºã€‚æ¨¡å‹æ•°æ®è¢«å¡«å…¥å ä½ç¬¦ï¼Œå¤–å±‚ç”±æç¤ºæ–‡æœ¬åŒ…è£¹ï¼Œå¼•å¯¼ LLM åº”å½“å¦‚ä½•ä½œç­”ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe4e4863ad35460fa114d776132969b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=2FSRnk0GhyxxCAGTmkdzD7RccC8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.1</strong> ä½¿ç”¨æç¤ºæ¨¡æ¿ç”±æ¨¡å‹æ•°æ®ç”Ÿæˆæç¤º</p>
<p>ä¸ºäº†æ¼”ç¤ºæç¤ºæ¨¡æ¿å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬ä»ç¬¬ 1 ç« çš„ç¤ºä¾‹å‡ºå‘ï¼ŒæŠŠå®ƒæ‰©å±•ä¸ºèƒ½å›ç­”å„ç±»<strong>æ¡Œé¢æ¸¸æˆ</strong>ï¼ˆå¦‚è·³æ£‹ã€Monopolyï¼Œæˆ–æ›´ç°ä»£çš„æ¬§å¼æ¡Œæ¸¸å¦‚ Catanã€Wingspanï¼‰çš„é—®ç­”ã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦åœ¨ <code>Question</code> è®°å½•ç±»å‹ä¸­åŠ å…¥<strong>æ¸¸æˆæ ‡é¢˜</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.boardgamebuddy</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.constraints</span><span class="hljs-selector-class">.NotBlank</span>;

<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">record</span> <span class="hljs-selector-tag">Question</span>(
    <span class="hljs-variable">@NotBlank</span>(message = <span class="hljs-string">"Game title is required"</span>) String gameTitle,
    <span class="hljs-variable">@NotBlank</span>(message = <span class="hljs-string">"Question is required"</span>) String question) {
}
</code></pre>
<p>è¿™ä¸ªæ–°ç‰ˆ <code>Question</code> å¢åŠ äº† <code>gameTitle</code> å±æ€§ï¼Œç”¨äºæ‰¿è½½æ¸¸æˆåã€‚è¿™æ ·å³ä¾¿é—®é¢˜æœ¬èº«æœªæåˆ°æ¸¸æˆåï¼Œä¹Ÿèƒ½æä¾›è¶³å¤Ÿä¸Šä¸‹æ–‡æ¥å›ç­”å…³äºæŸæ¬¾æ¸¸æˆçš„æé—®ã€‚</p>
<p>ä½ ä¹Ÿä¼šæ³¨æ„åˆ°ä¸¤ä¸ªå±æ€§éƒ½æ ‡æ³¨äº† <code>@NotBlank</code>ã€‚è™½ç„¶<strong>æ ¡éªŒ</strong>ä¸æ˜¯ Spring AI çš„ç‰¹æ€§ï¼Œä½†å®ƒæ˜¯ Spring æœ¬èº«éå¸¸é‡è¦ä¸”æœ‰ç”¨çš„åŠŸèƒ½ã€‚ç”¨ <code>@NotBlank</code> å£°æ˜å®ƒä»¬éƒ½æ˜¯<strong>å¿…å¡«</strong>çš„ï¼Œä¸”ä¸èƒ½ä¸º <code>null</code> æˆ–å»ç©ºç™½åå˜æˆç©ºå­—ç¬¦ä¸²ã€‚</p>
<p>è¦å¯ç”¨ <code>@NotBlank</code> ä»¥åŠ Spring çš„æ ¡éªŒæ”¯æŒï¼Œéœ€è¦åœ¨æ„å»ºä¸­åŠ å…¥å¦‚ä¸‹ starter ä¾èµ–ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">'org.springframework.boot:spring-boot-starter-validation'</span>
</code></pre>
<p>åŒæ—¶ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨çš„ <code>ask()</code> æ–¹æ³•é‡Œç»™ <code>Question</code> å‚æ•°æ·»åŠ  <code>@Valid</code>ï¼Œä»¥ä¾¿ Spring åœ¨å¤„ç†è¯¥æ§åˆ¶å™¨çš„è¯·æ±‚æ—¶æ‰§è¡Œæ ¡éªŒï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(path=<span class="hljs-string">"/ask"</span>, produces=<span class="hljs-string">"application/json"</span>)
public Answer <span class="hljs-built_in">ask</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Valid</span> Question question) {
  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">boardGameService</span><span class="hljs-selector-class">.askQuestion</span>(question);
}
</code></pre>
<p>æœ€åï¼Œä¸ºäº†æŠŠæ ¡éªŒé”™è¯¯<strong>æ•´é½åœ°</strong>ä»¥ JSON å½¢å¼è¿”å›ï¼Œä¸‹é¢çš„æ§åˆ¶å™¨å¢å¼ºï¼ˆadviceï¼‰ç±»åˆ©ç”¨äº† Spring å¯¹ <strong>Problem Detailsï¼ˆRFC-7807ï¼‰</strong> çš„æ”¯æŒï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc7807" target="_blank" title="https://datatracker.ietf.org/doc/html/rfc7807" ref="nofollow noopener noreferrer">datatracker.ietf.org/doc/html/rfâ€¦</a>ï¼‰ã€‚</p>
<p><strong>æ¸…å• 3.1 ä½¿ç”¨ Problem Details ä¼˜é›…è¿”å›æ ¡éªŒé”™è¯¯</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.context.MessageSourceResolvable;
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.http.ProblemDetail;
<span class="hljs-keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestControllerAdvice;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionHandlerAdvice</span> {

  <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span>
  <span class="hljs-keyword">public</span> ProblemDetail handleValidationExceptions(
                              MethodArgumentNotValidException ex) {
    <span class="hljs-keyword">var</span> problemDetail =  ProblemDetail
        .forStatusAndDetail(HttpStatus.BAD_REQUEST, <span class="hljs-string">"Validation failed"</span>);

    <span class="hljs-keyword">var</span> validationMessages = ex.getBindingResult().getAllErrors()
        .stream()
        .map(MessageSourceResolvable::getDefaultMessage)
        .toList();

    problemDetail.setProperty(<span class="hljs-string">"validationErrors"</span>, validationMessages);
    <span class="hljs-keyword">return</span> problemDetail;
  }

}
</code></pre>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<strong>Problem Details</strong> æ˜¯ä¸€ç§å¯¹ HTTP API é”™è¯¯è¿›è¡Œ<strong>æ ‡å‡†åŒ–ç»“æ„åŒ–</strong>çš„è§„èŒƒã€‚è‡ª Spring 6.0 èµ·ï¼ŒSpring å°±æä¾›äº†ä¸€ç­‰çš„ Problem Details æ”¯æŒã€‚å½“åº”ç”¨äº† Problem Details ä¸”<strong>æ ¡éªŒå¤±è´¥</strong>ï¼ˆä¾‹å¦‚è¯·æ±‚æœªæä¾›æ¸¸æˆåï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ç±»ä¼¼è¿™æ ·çš„æ ‡å‡†å“åº”ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"detail"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Validation failed"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"instance"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/ask"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">400</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bad Request"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"about:blank"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"validationErrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"Game title is required"</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç°åœ¨æŠŠæ³¨æ„åŠ›è½¬å‘<strong>å“åº”</strong>ã€‚ä¸ <code>Question</code> ä¸€æ ·ï¼Œä½ è¿˜å¸Œæœ›åœ¨ <code>Answer</code> è®°å½•ç±»å‹ä¸­åŠ å…¥<strong>æ¸¸æˆæ ‡é¢˜</strong>ï¼Œè®© API å®¢æˆ·ç«¯çŸ¥é“è¿™æ¡ç­”æ¡ˆå¯¹åº”çš„æ˜¯å“ªæ¬¾æ¸¸æˆï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">package com.example.boardgamebuddy;

<span class="hljs-function"><span class="hljs-keyword">public</span> record <span class="hljs-title">Answer</span><span class="hljs-params">(<span class="hljs-type">String</span> gameTitle, <span class="hljs-type">String</span> answer)</span> </span>{
}
</code></pre>
<p>æ—¢ç„¶ <code>Question</code> ä¸ <code>Answer</code> éƒ½åŒ…å«äº†æ¸¸æˆåï¼Œä½ å¯ä»¥æŠŠ <code>SpringAiBoardGameService</code> ä¸­çš„ <code>askQuestion()</code> ç®€åŒ–ä¸º<strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>ç”Ÿæˆæç¤ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">Answer</span> <span class="hljs-title function_">askQuestion</span>(<span class="hljs-params">Question question</span>) {
  <span class="hljs-title class_">String</span> prompt =
      <span class="hljs-string">"Answer this question about "</span> + question.<span class="hljs-title function_">gameTitle</span>() +
      <span class="hljs-string">": "</span> + question.<span class="hljs-title function_">question</span>();

  <span class="hljs-title class_">String</span> answerText = chatClient.<span class="hljs-title function_">prompt</span>()
      .<span class="hljs-title function_">user</span>(prompt)
      .<span class="hljs-title function_">call</span>()
      .<span class="hljs-title function_">content</span>();
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(question.<span class="hljs-title function_">gameTitle</span>(), answerText);
}
</code></pre>
<p>ç°åœ¨å¯ä»¥åœ¨è¯·æ±‚ä¸­å¸¦ä¸Šæ¸¸æˆåæ¥æé—®äº†ã€‚æ¯”å¦‚ç”¨ HTTPie å‘ç»å…¸çš„ <strong>checkersï¼ˆè·³æ£‹ï¼‰</strong> æé—®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"checkers"</span> \
question=<span class="hljs-string">"How many pieces are there?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"In checkers, there are a total of 24 pieces-12 for each player."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"checkers"</span>
}
</code></pre>
<p>åº•å±‚ LLM èƒ½åŸºäºè‡ªèº«è®­ç»ƒå›ç­”å…³äºè·³æ£‹çš„é—®é¢˜ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äº<strong>çŸ¥åæ¸¸æˆ</strong>ï¼ˆå¦‚è·³æ£‹ã€å›½é™…è±¡æ£‹ï¼‰ï¼›ä½†å¯¹äº<strong>è¾ƒæ–°/ä¸é‚£ä¹ˆå‡ºå</strong>çš„æ¸¸æˆå¯èƒ½ä¼šåƒåŠ›ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä½•è®© LLM å›ç­”<strong>è¶…å‡ºå…¶è®­ç»ƒèŒƒå›´</strong>çš„é—®é¢˜ã€‚</p>
<p>è™½ç„¶èƒ½ç”¨ï¼Œä½†é€šè¿‡<strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>æ¥æ„å»ºæç¤ºå¾ˆç¬¨æ‹™ã€‚å³ä¾¿æ˜¯ <code>askQuestion()</code> ä¸­è¿™æ ·ç®€å•çš„æç¤ºï¼Œä¹Ÿä¼šè®©ä»£ç è¯»å†™ä¸ä¾¿ã€‚</p>
<h3 data-id="heading-2">3.1.1 å®šä¹‰æç¤ºæ¨¡æ¿ï¼ˆDefining a prompt templateï¼‰</h3>
<p>ä¸å…¶ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸å¦‚åˆ›å»ºä¸€ä¸ª<strong>æç¤ºæ¨¡æ¿</strong>ï¼ŒæŠŠâ€œåŸå§‹ã€æœªæ¸²æŸ“çš„æç¤ºâ€å†™æˆå¸¦å ä½ç¬¦çš„æ¨¡æ¿ã€‚ä¸‹é¢æ¸…å•å±•ç¤ºäº†ä¿®æ”¹åçš„ <code>SpringAiBoardGameService</code>ï¼Œå®ƒä½¿ç”¨äº†æ¨¡æ¿åŒ–æç¤ºã€‚</p>
<p><strong>æ¸…å• 3.2 ä½¿ç”¨æç¤ºæ¨¡æ¿ï¼Œé¿å…ç¬¨æ‹™çš„å­—ç¬¦ä¸²æ‹¼æ¥</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">SpringAiBoardGameService</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder)</span> {
    <span class="hljs-built_in">this</span>.chatClient = chatClientBuilder.build();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">questionPromptTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
      Answer this question about {game}: {question}
      """</span>;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Answer <span class="hljs-title function_">askQuestion</span><span class="hljs-params">(Question question)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">answerText</span> <span class="hljs-operator">=</span> chatClient.prompt()
        .user(userSpec -&gt; userSpec
            .text(questionPromptTemplate)
            .param(<span class="hljs-string">"gameTitle"</span>, question.gameTitle())
            .param(<span class="hljs-string">"question"</span>, question.question()))
        .call()
        .content();

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(question.gameTitle(), answerText);
  }

}
</code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œåä¸º <code>questionPromptTemplate</code> çš„æç¤ºæ¨¡æ¿çœ‹èµ·æ¥ä¸æ­¤å‰æ‹¼æ¥å‡ºæ¥çš„æç¤ºå¾ˆåƒï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯æ–‡æœ¬ã€‚å®ƒæ˜¯ä¸€ä¸ª <strong>StringTemplate</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.stringtemplate.org%2F" target="_blank" title="https://www.stringtemplate.org/" ref="nofollow noopener noreferrer">www.stringtemplate.org/</a>ï¼‰ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªå‚æ•°çš„å ä½ç¬¦<code>{game}</code> ä¸ <code>{question}</code>ã€‚</p>
<p>ç”±äºå­˜åœ¨å ä½ç¬¦ï¼Œè¿™ä¸ªæ¨¡æ¿<strong>ä¸èƒ½</strong>ç›´æ¥ä½œä¸ºæ™®é€šå­—ç¬¦ä¸²æäº¤ï¼›ä½ è¿˜å¿…é¡»<strong>æä¾›ç”¨äºå¡«å……å ä½ç¬¦çš„å€¼</strong>ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ <code>askQuestion()</code> ä¸­ï¼Œ<code>user()</code> ä¸æ˜¯æ¥æ”¶æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«ï¼Œè€Œæ˜¯æ¥æ”¶ä¸€ä¸ª<strong>lambda</strong>ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œè¿™ä¸ª lambda å®ç°äº† <code>Consumer&lt;UserSpec&gt;</code> æ¥å£ï¼Œè®©ä½ èƒ½<strong>å®šåˆ¶</strong>è¦å‘é€ç»™ LLM çš„æ¶ˆæ¯ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œé€šè¿‡åœ¨ <code>userSpec</code> ä¸Šè°ƒç”¨ <code>text()</code> æŒ‡å®šç”¨æˆ·æ¶ˆæ¯çš„æ­£æ–‡ï¼ˆä¹Ÿå°±æ˜¯æç¤ºæ¨¡æ¿ï¼‰ï¼Œå†é€šè¿‡å¤šæ¬¡è°ƒç”¨ <code>param()</code> ä¸ºæ¯ä¸ªå‚æ•°è®¾ç½®å€¼ã€‚åœ¨æç¤ºå‘é€ç»™ LLM ä¹‹å‰ï¼Œå ä½ç¬¦ä¼šè¢«è¿™äº›å‚æ•°å€¼<strong>å¡«å……</strong>ï¼Œä»è€Œå½¢æˆå®Œæ•´çš„æç¤ºæ¶ˆæ¯ã€‚å›¾ 3.2 æ¼”ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3796ed3650564abf8d3a03690500a0dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=y%2F72E1HNRGn4RHmbAwIYaQxATuQ%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.2</strong> æç¤ºæ¨¡æ¿æŠŠæ¨¡å‹æ•°æ®æ¸²æŸ“è¿›æç¤ºï¼Œå†æäº¤ç»™ LLM</p>
<p><code>askQuestion()</code> ä½™ä¸‹çš„ä»£ç ä¸ä¹‹å‰ç›¸åŒï¼š<code>call()</code> è¡¨ç¤ºæç¤ºå·²å‡†å¤‡å°±ç»ªå¹¶å‘é€ï¼›<code>content()</code> è¿”å›ç­”æ¡ˆæ–‡æœ¬ã€‚</p>
<p>é‡æ–°å¯åŠ¨åº”ç”¨ï¼Œå†æ¬¡æäº¤è¯·æ±‚ï¼Œå®ƒåº”å½“åƒä¹‹å‰ä¸€æ ·å·¥ä½œï¼ˆç”±äºç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>ï¼Œå›ç­”çš„æªè¾å¯èƒ½ç•¥æœ‰å˜åŒ–ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥è¯•ç€è¯¢é—®<strong>å…¶ä»–æ¡Œæ¸¸</strong>æ¥çœ‹çœ‹å›ç­”æƒ…å†µã€‚</p>
<p>ç°åœ¨ï¼Œæç¤ºçš„æ ¸å¿ƒé›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹â€”â€”é‚£ä¸ª<strong>é™æ€å­—ç¬¦ä¸²å¸¸é‡</strong>â€”â€”å¯è¯»ä¸”æ˜“ç»´æŠ¤ï¼Œå°½ç®¡åœ¨ <code>askQuestion()</code> é‡Œå¤šäº†å‡ è¡Œä»£ç ã€‚æ—¢ç„¶æ›´æ˜“ç»´æŠ¤äº†ï¼Œæˆ‘ä»¬å°±åšç‚¹<strong>æç¤ºå·¥ç¨‹ï¼ˆprompt engineeringï¼‰</strong> ï¼ŒæŠŠæ¨¡æ¿å†ä¼˜åŒ–ä¸€ä¸‹ã€‚ä¾‹å¦‚æ”¹ä¸ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">private static final String <span class="hljs-attr">questionPromptTemplate</span> = <span class="hljs-string">"""
    You are a helpful assistant, answering questions about tabletop games.
    If you don't know anything about the game or don't know the answer,
    say "I don't know".

    The game is {game}.

    The question is: {question}.
    """</span><span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸ªæ–°æ¨¡æ¿ä¸º LLM è®¾ç½®äº†æ›´å¤š<strong>è§’è‰²ä¸æœŸæœ›ä¸Šä¸‹æ–‡</strong>ï¼šå‘Šè¯‰å®ƒè‡ªå·±æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹ã€è¦å›ç­”<strong>æ¡Œé¢æ¸¸æˆ</strong>ç›¸å…³çš„é—®é¢˜ï¼›è¿˜è¦æ±‚å®ƒåœ¨ä¸çŸ¥é“ç­”æ¡ˆæˆ–ä¸äº†è§£è¯¥æ¸¸æˆæ—¶<strong>æ˜ç¡®æ‰¿è®¤ä¸çŸ¥é“</strong>ã€‚</p>
<p>åƒè¿™æ ·çš„å°å°æç¤ºå·¥ç¨‹æŠ€å·§ï¼Œèƒ½å¸®åŠ©ä½ ä»æç¤ºä¸­è·å¾—æ›´å¥½çš„ç»“æœã€‚æ›´å¤šæç¤ºå·¥ç¨‹å»ºè®®å¯å‚è€ƒ <strong>Prompt Engineering Guide</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.promptingguide.ai%2F" target="_blank" title="https://www.promptingguide.ai/" ref="nofollow noopener noreferrer">www.promptingguide.ai/</a>ï¼‰ã€‚</p>
<h3 data-id="heading-3">3.1.2 å°†æ¨¡æ¿ä½œä¸ºèµ„æºå¯¼å…¥ï¼ˆImporting the template as a resourceï¼‰</h3>
<p>æŠŠæç¤ºæ¨¡æ¿çš„å­—ç¬¦ä¸²æå–æˆå¸¸é‡ï¼Œæœ‰åŠ©äºæ•´ç† <code>askQuestion()</code> æ–¹æ³•ï¼Œè®©ä»£ç æ›´æ˜“è¯»ã€ä¹Ÿæ›´ä¾¿äºè°ƒæ•´æç¤ºã€‚ä½†ä½ è¿˜èƒ½å†è¿›ä¸€æ­¥ï¼šæŠŠæ¨¡æ¿<strong>æŠ½åˆ°å¤–éƒ¨æ–‡ä»¶</strong>ã€‚è¿™æ ·æ—¢èƒ½è®©æ¨¡æ¿ä¸ Java æºç åˆ†ç¦»ï¼Œåˆä»å¯å°†æ¨¡æ¿çº³å…¥ä»£ç ä»“åº“ç®¡ç†ã€‚</p>
<p>ä¸ºæ­¤ï¼Œå…ˆåœ¨é¡¹ç›®çš„ <code>src/main/resources</code> ç›®å½•ä¸‹åˆ›å»ºåä¸º <strong><code>promptTemplates</code></strong> çš„æ–°ç›®å½•ã€‚åœ¨æ–°ç›®å½•é‡Œåˆ›å»ºæ–‡ä»¶ <strong><code>questionPromptTemplate.st</code></strong>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">You are a helpful assistant, answering questions about tabletop games.
<span class="hljs-keyword">If</span> you don<span class="hljs-comment">'t know anything about the game or don't know the answer,</span>
say <span class="hljs-string">"I don't know"</span>.

Answer <span class="hljs-keyword">in</span> complete sentences.

The game <span class="hljs-built_in">is</span> {gameTitle}.

The question <span class="hljs-built_in">is</span>: {question}.
</code></pre>
<p><strong>NOTE</strong> ç›®å½•åä¸æ¨¡æ¿æ–‡ä»¶åå¯ä»¥éšæ„å–ï¼›åªè¦åœ¨æŠŠæ¨¡æ¿æ³¨å…¥åˆ° <code>SpringAiBoardGameService</code> æ—¶<strong>æ­£ç¡®å¼•ç”¨</strong>å³å¯ã€‚</p>
<p>ï¼ˆå°½ç®¡ä½ æŠŠä»£ç æäº¤åˆ° GitHub æ—¶å®ƒå¯èƒ½ä¼šæç¤ºåˆ«çš„ï¼‰ï¼Œæ‰©å±•å <strong><code>.st</code></strong> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <strong>StringTemplate</strong> æ–‡ä»¶ï¼ˆå¹¶ä¸æ˜¯ Smalltalk æ–‡ä»¶ï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª StringTemplate æ–‡ä»¶çš„æ–‡æœ¬ä¸ä¹‹å‰å®šä¹‰çš„é™æ€å­—ç¬¦ä¸²å¸¸é‡ç›¸åŒã€‚ä½†ç°åœ¨æ¨¡æ¿åœ¨ç‹¬ç«‹æ–‡ä»¶ä¸­ï¼Œæ¨¡æ¿çš„ç»†èŠ‚å¯ä¸â€œæäº¤æç¤ºçš„ä»£ç â€åˆ†å¼€ç»´æŠ¤ã€‚</p>
<p>åŸºäºæ­¤ï¼Œä½ éœ€è¦ä¿®æ”¹ <code>SpringAiBoardGameService</code> æ¥å¼•ç”¨è¯¥æ¨¡æ¿æ–‡ä»¶ã€‚åˆ é™¤é™æ€å­—ç¬¦ä¸²å¸¸é‡ï¼Œæ”¹ä¸ºå¦‚ä¸‹å­—æ®µï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/questionPromptTemplate.st"</span>)</span>
Resource questionPromptTemplate;
</code></pre>
<p><code>@Value</code> æ³¨è§£ä½¿ç”¨ <code>classpath:</code> å‰ç¼€æ¥å¼•ç”¨æ¨¡æ¿æ–‡ä»¶ï¼Œæœ¬è´¨ä¸Šæ˜¯æŠŠå®ƒæ³¨å…¥åˆ°ä¸€ä¸ª <code>Resource</code> å±æ€§ä¸­ã€‚æ³¨æ„ï¼Œè¿™ä¸ª <code>Resource</code> å±æ€§çš„åå­—ä¸åŸå…ˆçš„å­—ç¬¦ä¸²å¸¸é‡ç›¸åŒã€‚<code>user</code> è§„æ ¼çš„ <code>text()</code> æ–¹æ³•æ˜¯<strong>é‡è½½</strong>çš„ï¼Œæ—¢å¯æ¥å— <code>String</code>ï¼Œä¹Ÿå¯æ¥å— <code>Resource</code>ã€‚å› æ­¤æŠŠè¯¥ <code>Resource</code> å‘½åä¸º <code>questionPromptTemplate</code> åï¼Œä½ <strong>æ— éœ€ä¿®æ”¹</strong> <code>askQuestion()</code> æ–¹æ³•é‡Œå¯¹æ¨¡æ¿çš„ä½¿ç”¨ã€‚</p>
<p>é‡å¯åº”ç”¨ï¼Œç»§ç»­å°±æ¸¸æˆæé—®ï¼›è¡Œä¸ºä¾æ—§ä¸ä¹‹å‰ç›¸åŒã€‚å°½ç®¡åº”ç”¨å¤–åœ¨è¡Œä¸ºæ²¡å˜ï¼Œä½†å†…éƒ¨å®ç°æ›´æ•´æ´ï¼›å¯¹æ¨¡æ¿çš„ä»»ä½•è°ƒæ•´ï¼Œéƒ½å¯ä»¥ä¸ <code>SpringAiBoardGameService</code> ä»£ç <strong>è§£è€¦</strong>åœ°å®Œæˆã€‚</p>
<p>å¦‚æœä½ è¯¢é—® checkersã€chess æˆ–å…¶ä»–çŸ¥åæ¸¸æˆï¼Œå¾ˆå¯èƒ½ä¼šå¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚ä½†å‡è®¾ä½ é—®çš„æ˜¯æ¨¡å‹æœªè¢«è®­ç»ƒè¿‡çš„æ¸¸æˆã€‚ä¾‹å¦‚è¯•ç€è¯¢é—®çº¸ç‰Œæ¸¸æˆ <strong>Burger Battle</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.burgerbattlegame.com%2F" target="_blank" title="https://www.burgerbattlegame.com/" ref="nofollow noopener noreferrer">www.burgerbattlegame.com/</a>ï¼‰ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœå®ƒä¸çŸ¥é“ç­”æ¡ˆï¼Œå®ƒä¼šè¯´ â€œI don't knowâ€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
question=<span class="hljs-string">"What is the Grave Digger card?"</span> -b
{
    <span class="hljs-string">"answer"</span>: <span class="hljs-string">"I don't know."</span>,
    <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"Burger Battle"</span>
}
</code></pre>
<p>å°½ç®¡æ¨¡æ¿æ˜ç¡®è¦æ±‚â€œä¸ä¼šå°±è¯´ I don't knowâ€ï¼Œä½ ä»æœ‰ç›¸å½“æ¦‚ç‡å¾—åˆ°<strong>çç¼–</strong>çš„ç­”æ¡ˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
question=<span class="hljs-string">"What is the Destroy card?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"In Burger Battle, the Destroy card is a special card that allows
      players to eliminate one ingredient card from an opponent's burger."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"Burger Battle"</span>
}
</code></pre>
<p>å¦‚æœä½ ç©è¿‡â€”â€”æˆ–è¯»è¿‡â€”â€”Burger Battle çš„è§„åˆ™ï¼Œä½ ä¼šçŸ¥é“è¿™ç­”æ¡ˆæ˜¯<strong>é”™è¯¯çš„</strong>ã€‚è¿™å°±æ˜¯ä¸ LLM å…±äº‹æ—¶ä¸€ä¸ªä¸å¤ªå¦™ã€ä½†æœ‰æ—¶é¢‡å…·â€œå–œå‰§æ•ˆæœâ€çš„ç‰¹æ€§ï¼šå½“å®ƒå¯¹æŸè¯é¢˜è®­ç»ƒä¸è¶³æ—¶ï¼Œå¯èƒ½<strong>ç¼–é€ </strong>ä¸€ä¸ªå®Œå…¨ä¸çœŸå®çš„ç­”æ¡ˆâ€”â€”é€šå¸¸ç§°ä¸º<strong>å¹»è§‰ï¼ˆhallucinationsï¼‰</strong> ã€‚</p>
<p>é¿å…å¹»è§‰çš„å‡ ç§æ–¹å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li>è®­ç»ƒä½ è‡ªå·±çš„æ¨¡å‹</li>
<li>å¯¹ç°æœ‰æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼ˆfine-tuningï¼‰</li>
<li>åœ¨æç¤ºä¸­æä¾›<strong>é¢å¤–ä¸Šä¸‹æ–‡</strong></li>
</ul>
<p>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œè®­ç»ƒæˆ–å¾®è°ƒï¼ˆæ›´ä¸ç”¨è¯´èƒ½åŸºäºç§æœ‰æ•°æ®å®šåˆ¶æ¨¡å‹ï¼‰æ˜¯é¿å…å¹»è§‰çš„ä¸Šç­–ï¼Œä½†è¿™å¾ˆéš¾ï¼Œä¸”éœ€è¦<strong>æ•°æ®ç§‘å­¦</strong>é¢†åŸŸçš„æŠ€èƒ½è€Œéè½¯ä»¶å¼€å‘æŠ€èƒ½ã€‚æ­¤å¤–ï¼Œè®­ç»ƒ/å¾®è°ƒè¦æƒ³åšå¾—å¥½ï¼Œéœ€è¦<strong>å¤§é‡æ•°æ®</strong>ï¼Œä¹Ÿéå¸¸è€—æ—¶â€”â€”å¯èƒ½æ˜¯æ•°å°æ—¶ã€æ•°å¤©ï¼Œç”šè‡³æ•°å‘¨ã€‚ä»¥æˆ‘ä»¬æ„å»ºçš„æ¡Œæ¸¸ç¤ºä¾‹ä¸ºä¾‹ï¼Œå› åº”æ–°å“å‘å¸ƒ<strong>ç«‹å³</strong>ä¸ºå…¶â€œåŠ å…¥ä¸€ä¸ªæ¸¸æˆâ€çš„åšæ³•å°±ä¸å¯è¡Œã€‚</p>
<p>ç›¸è¾ƒä¹‹ä¸‹ï¼Œåœ¨æç¤ºä¸­æ·»åŠ <strong>ä¸€äº›ä¸Šä¸‹æ–‡</strong>å‡ ä¹å°±åƒæ·»åŠ é—®é¢˜æœ¬èº«é‚£æ ·ç®€å•â€”â€”åœ¨æäº¤æç¤ºçš„<strong>å³æ—¶</strong>é˜¶æ®µå®Œæˆã€‚å› æ­¤ï¼Œå®ƒæ¯”è®­ç»ƒ/å¾®è°ƒè¦<strong>ç®€å•å¾—å¤š</strong>ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹å¦‚ä½•åœ¨æç¤ºä¸­è¿åŒé—®é¢˜ä¸€èµ·æä¾›<strong>é¢å¤–ä¸Šä¸‹æ–‡</strong>ã€‚è¿™å°†ä¸ºä¸‹ä¸€ç« çš„ <strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> åšé“ºå«â€”â€”RAG æ˜¯ä¸€ç§æ›´é«˜çº§çš„æ–¹æ³•ï¼Œèƒ½åœ¨ä¸è¶…é™çš„æƒ…å†µä¸‹ä¸ºæç¤ºæ·»åŠ ç›¸å…³ä¸Šä¸‹æ–‡ã€‚</p>
<h2 data-id="heading-4">3.2 ç”¨ä¸Šä¸‹æ–‡â€œå¡«å……â€æç¤ºï¼ˆStuffing the prompt with contextï¼‰</h2>
<p>å›æƒ³ä½ ä¸Šå­¦æ—¶ï¼Œå¯èƒ½é‡åˆ°è¿‡<strong>å¼€å·è€ƒè¯•</strong>ã€‚è¿™æ—¶ï¼Œä½ ä¸å¿…æŠŠæ‰€æœ‰å†…å®¹<strong>æ­»è®°</strong>åœ¨è„‘å­é‡Œï¼šå³ä¾¿ä½ æ²¡å¤ä¹ ï¼Œä¹Ÿèƒ½ç¿»ä¹¦æ‰¾åˆ°è¿‡å…³æ‰€éœ€çš„ç­”æ¡ˆã€‚</p>
<p>åœ¨ç”Ÿæˆå¼ AI ä¸­ï¼Œå¸¸è¢«ç§°ä¸º <strong>â€œstuffing the promptï¼ˆå¡«å……æç¤ºï¼‰â€</strong> çš„æŠ€å·§ï¼Œå°±åƒç»™ LLM è¿›è¡Œä¸€æ¬¡â€œå¼€å·è€ƒè¯•â€ã€‚é™¤äº†æŠŠé—®é¢˜æäº¤ç»™ LLM ç”Ÿæˆå¤–ï¼Œä½ è¿˜æä¾›ä¸€æ®µ<strong>é¢å¤–æ–‡æœ¬</strong>ä¾›å®ƒå‚è€ƒã€‚è¿™æ ·ï¼ŒLLM å³ä¾¿æœªåœ¨è¯¥ä¸»é¢˜ä¸Šé¢„è®­ç»ƒï¼Œä¹Ÿèƒ½å›ç­”ç›¸å…³é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è®© <strong>Board Game Buddy</strong> èƒ½å‡†ç¡®å›ç­” <strong>Burger Battle</strong>ï¼ˆLLM æœªè®­ç»ƒè¿‡çš„æ¸¸æˆï¼‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»™å®ƒæ¥ä¸€åœºâ€œå¼€å·â€ï¼šæŠŠ<strong>æ¸¸æˆè§„åˆ™</strong>ä½œä¸ºä¸Šä¸‹æ–‡åŠ å…¥æç¤ºã€‚æœ€ç›´æ¥çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ª<strong>çº¯æ–‡æœ¬æ–‡ä»¶</strong>æ¥å­˜æ”¾è¯¥æ¸¸æˆè§„åˆ™ã€‚</p>
<p><strong>Burger Battle</strong> çš„è§„åˆ™ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fmng.bz%2FyNKo" target="_blank" title="https://mng.bz/yNKo" ref="nofollow noopener noreferrer">mng.bz/yNKo</a>ï¼‰ç›¸å¯¹è¾ƒçŸ­ï¼Œä½†ä»ç„¶å¤ªé•¿ï¼Œä¸é€‚åˆåŸæ–‡å°åœ¨ä¹¦é‡Œã€‚è‡³å°‘ï¼Œä¸ºäº†è®© LLM èƒ½å›ç­” Destroy å¡æˆ–å…¶ä»–æˆ˜æ–—å¡ç›¸å…³é—®é¢˜ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-python" lang="python">* Burger Bomb: Blow up another playe<span class="hljs-string">r's Burger by sending their ingredients
to the Graveyard.
* Burger Force Field: Your Burger is now protected from all Battle Cards
* Burgerpocalypse: Obliterate all players'</span> ingredients, including your own,
<span class="hljs-keyword">and</span> toss them <span class="hljs-keyword">in</span> the Graveyard.
* Destroy!: Destroy <span class="hljs-built_in">any</span> Battle Card of yours <span class="hljs-keyword">or</span> another playe<span class="hljs-string">r's and toss
it in the Graveyard.
* Gonna Eat That?: Steal another player'</span>s ingredient <span class="hljs-keyword">and</span> add it to your
Burger.
* Grave Digger: Dig through the Graveyard <span class="hljs-keyword">for</span> <span class="hljs-built_in">any</span> needed ingredient <span class="hljs-keyword">and</span> add
it to your Burger.
* I Got Nothin<span class="hljs-string">': Toss your hand in the Graveyard and draw 5 new cards
* More Meat!: Make another player'</span>s Burger a double-decker by adding an
extra Meat to their ingredients <span class="hljs-built_in">list</span>.
* Pickle Plague: Rain vengeance down upon another player by adding Pickles
to their ingredients <span class="hljs-built_in">list</span>.
* Picky Eater: Throw another playe<span class="hljs-string">r's Lettuce, Tomato, or Onion in the
Graveyard.
* The Old Switcheroo: Trade hands with another player.
* Yours Looks Good!: Trade your Burger and all of your ingredients with
another player, including added Battle Cards.
</span></code></pre>
<p>æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ° <code>src/main/resources</code> ä¸‹æ–°å»ºçš„ <strong><code>gameRules</code></strong> ç›®å½•ï¼Œå‘½åä¸º <strong><code>burger_battle.txt</code></strong>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹æ¨¡æ¿ï¼ŒåŠ å…¥ä¸€ä¸ª<strong>è§„åˆ™å ä½ç¬¦</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">You are a helpful assistant, answering questions about tabletop games.
<span class="hljs-keyword">If</span> available, use the rules <span class="hljs-keyword">in</span> the RULES section below.
<span class="hljs-keyword">If</span> you don<span class="hljs-comment">'t know anything about the game or don't know the answer,</span>
say <span class="hljs-string">"I don't know"</span>.

Answer <span class="hljs-keyword">in</span> complete sentences.

The game <span class="hljs-built_in">is</span> {gameTitle}.

The question <span class="hljs-built_in">is</span>: {question}.

<span class="hljs-symbol">RULES:</span>
{rules}
</code></pre>
<p>æ³¨æ„ï¼Œé™¤äº†æ–°å¢ <code>{rules}</code> å ä½ç¬¦ä¹‹å¤–ï¼Œæ–‡æœ¬ä¸­è¿˜åŠ å…¥äº†<strong>æŒ‡ä»¤</strong>ï¼Œå‘Šè¯‰ LLMï¼šå¦‚æœæœ‰è§„åˆ™å¯ç”¨ï¼Œè¯·ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>åœ¨æŠŠè§„åˆ™æ³¨å…¥æç¤ºä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠè§„åˆ™<strong>è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</strong>ã€‚ä¸ºæ­¤ï¼Œåˆ›å»ºä¸€ä¸ªç±»ä¼¼ä¸‹æ–¹æ¸…å•çš„æœåŠ¡ç±»ã€‚</p>
<p><strong>æ¸…å• 3.3 <code>GameRulesService</code> å°†æ¸¸æˆè§„åˆ™åŠ è½½ä¸ºå­—ç¬¦ä¸²</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.core.io.DefaultResourceLoader;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.charset.Charset;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GameRulesService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span>
      LoggerFactory.getLogger(GameRulesService.class);

  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRulesFor</span><span class="hljs-params">(String gameName)</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-type">var</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> String.format(
          <span class="hljs-string">"classpath:/gameRules/%s.txt"</span>,
          gameName.toLowerCase().replace(<span class="hljs-string">" "</span>, <span class="hljs-string">"_"</span>));

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>()
          .getResource(filename)
          .getContentAsString(Charset.defaultCharset()); \
           } <span class="hljs-keyword">catch</span> (IOException e) {
      LOG.info(<span class="hljs-string">"No rules found for game: "</span> + gameName);
      <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
  }

}
</code></pre>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>getRulesFor()</code> ä¼šé€šè¿‡ <code>Resource</code> æŠŠæŸä¸ªæ¸¸æˆçš„è§„åˆ™<strong>åŠ è½½ä¸ºå­—ç¬¦ä¸²</strong>ã€‚ç”±äºèµ„æºè·¯å¾„ä¼šéšæ¸¸æˆåå˜åŒ–ï¼Œæ— æ³•åƒæ¨¡æ¿é‚£æ ·ç”¨ <code>@Value</code> å›ºå®šæ³¨å…¥ï¼Œå› æ­¤ <code>getRulesFor()</code> å€ŸåŠ©äº†ä¸€äº› Spring çš„å·¥å…·ç±»æ¥æ„é€  <code>Resource</code>ã€‚</p>
<p>åœ¨æ„é€ è§„åˆ™è·¯å¾„æ—¶ï¼Œ<code>getRulesFor()</code> ä¼šæŠŠæ¸¸æˆæ ‡é¢˜<strong>è½¬ä¸ºå°å†™</strong>å¹¶æŠŠç©ºæ ¼æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œé¿å…å› å¤§å°å†™æˆ–ç©ºæ ¼å·®å¼‚å¯¼è‡´æ ‡é¢˜ä¸æ–‡ä»¶åä¸ä¸€è‡´ã€‚ä¾‹å¦‚å¦‚æœ <code>Question</code> ä¸­ä¼ å…¥çš„æ¸¸æˆåæ˜¯ â€œBurger battleâ€ï¼Œå®ƒä¼šè¢«è§„èŒƒåŒ–ä¸º <code>burger_battle</code>ã€‚</p>
<p>ç°åœ¨å¯ä»¥ä¿®æ”¹ <code>SpringAiBoardGameService</code>ï¼ŒæŠŠè§„åˆ™åŠ å…¥æç¤ºã€‚é¦–å…ˆæŠŠ <code>GameRulesService</code> æ³¨å…¥è¿›æ¥ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-title">implements</span> <span class="hljs-title">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GameRulesService gameRulesService;

  <span class="hljs-keyword">public</span> SpringAiBoardGameService(
      ChatClient.Builder chatClientBuilder,
      GameRulesService gameRulesService) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    <span class="hljs-keyword">this</span>.gameRulesService = gameRulesService;
  }

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>ç„¶åï¼Œä¿®æ”¹ <code>askQuestion()</code>ï¼Œè°ƒç”¨ <code>GameRulesService</code> è¯»å–è§„åˆ™ï¼Œå¹¶é€šè¿‡å†è°ƒç”¨ä¸€æ¬¡ <code>param()</code> æŠŠè§„åˆ™ä½œä¸ºå‚æ•°åŠ å…¥ç”¨æˆ·æ¶ˆæ¯è§„æ ¼ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public Answer <span class="hljs-built_in">askQuestion</span>(Question question) {
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">gameRules</span> = <span class="hljs-selector-tag">gameRulesService</span><span class="hljs-selector-class">.getRulesFor</span>(question.<span class="hljs-built_in">gameTitle</span>());

  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">answerText</span> = <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
      <span class="hljs-selector-class">.user</span>(userSpec -&gt; userSpec
          .<span class="hljs-built_in">text</span>(questionPromptTemplate)
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"gameTitle"</span>, question.<span class="hljs-built_in">gameTitle</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"question"</span>, question.<span class="hljs-built_in">question</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"rules"</span>, gameRules))
      <span class="hljs-selector-class">.call</span>()
      <span class="hljs-selector-class">.content</span>();

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Answer</span>(question.<span class="hljs-built_in">gameTitle</span>(), answerText);
}
</code></pre>
<p>ç°åœ¨å¯ä»¥è¯•ä¸€è¯•äº†ã€‚é‡å¯åº”ç”¨ï¼Œå†æ¬¡è¯¢é—® Burger Battle çš„ <strong>Destroy</strong> å¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
question=<span class="hljs-string">"What is the Destroy card?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"The Destroy card in Burger Battle allows you to destroy any
      Battle Card, whether it belongs to you or another player, and then
      place it in the Graveyard."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"Burger Battle"</span>
}
</code></pre>
<p>å¤ªæ£’äº†ï¼è¿™æ¬¡ç­”æ¡ˆ<strong>æ­£ç¡®</strong>ï¼Œè€Œä¸”æ˜¾ç„¶æ˜¯ä»æç¤ºä¸­ç»™å®šçš„<strong>ä¸Šä¸‹æ–‡</strong>æŠ½å–å‡ºæ¥çš„ã€‚</p>
<p>ä¸ºç¡®ä¿å…¶ä»–æ¸¸æˆä¹Ÿèƒ½æ­£å¸¸å›ç­”ï¼Œå†è¯•ä¸€æ¬¡ã€‚è¿™æ¬¡é—® <strong>chess</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"chess"</span> \
question=<span class="hljs-string">"How are knights allowed to move?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"In chess, knights move in an L-shape: two squares in one
      direction, and then one square perpendicular to that. Knights are the
      only pieces that can jump over other pieces on the board."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"chess"</span>
}
</code></pre>
<p>å³ä½¿åº”ç”¨<strong>æ²¡æœ‰</strong>ä»èµ„æºä¸­åŠ è½½å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œæ¨¡å‹ä¹Ÿèƒ½å›ç­”ï¼Œå› ä¸ºå®ƒå·²åœ¨è®­ç»ƒä¸­å­¦è¿‡å›½é™…è±¡æ£‹è§„åˆ™ã€‚</p>
<p>éœ€è¦ç†è§£çš„æ˜¯ï¼š<strong>æ›´å¤šä¸Šä¸‹æ–‡</strong>æ„å‘³ç€æç¤ºä¸­ä¼šæœ‰<strong>æ›´å¤šè¾“å…¥ token</strong>ã€‚ä¾‹å¦‚æé—®å›½é™…è±¡æ£‹æ—¶æ²¡æœ‰é¢å¤–ä¸Šä¸‹æ–‡ï¼Œæç¤ºåªæœ‰ <strong>75 ä¸ª token</strong>ï¼›è€Œ Burger Battle çš„é—®é¢˜ï¼ˆå³ä¾¿åªåŒ…å«ä¸€å°æ®µè§„åˆ™ï¼‰æç¤º token æ•°æ˜¯ <strong>315</strong> â€”â€” æ˜¯æ— ä¸Šä¸‹æ–‡æ—¶çš„ <strong>4 å€å¤š</strong>ã€‚</p>
<p>è‡³å°‘ï¼Œtoken æ•°ä¼šå½±å“<strong>æˆæœ¬</strong>ï¼šæç¤ºï¼ˆä»¥åŠå“åº”ï¼‰ä¸­çš„ token è¶Šå¤šï¼Œä»˜è´¹å°±è¶Šå¤šã€‚å¾ˆå¤š LLMï¼ˆå¦‚ GPT-4oï¼‰åœ¨æ¯ 1,000 token çš„ä»·æ ¼ä¸Šéå¸¸ä¾¿å®œï¼Œä½†éšç€ä½¿ç”¨æ—¶é—´å¢é•¿ï¼Œä¹Ÿä¼šç´¯ç§¯ã€‚</p>
<p>æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœæç¤ºé‡Œ token å¤ªå¤šï¼Œå¯èƒ½ä¼š<strong>è¶…å‡ºä¸Šä¸‹æ–‡çª—å£</strong>çš„é™åˆ¶ã€‚ä»¥ GPT-4o ä¸ºä¾‹ï¼Œçª—å£ä¸º <strong>128K</strong> tokenï¼Œè¿œè¶…æˆ‘ä»¬è¿™ä¸ªç®€å•ç¤ºä¾‹çš„éœ€æ±‚ã€‚å¤§å¤šæ•°æ¡Œæ¸¸çš„è§„åˆ™éƒ½èƒ½è½»æ¾è½åœ¨ 128K å†…ï¼Œä½†åœ¨å…¶ä»–é¢†åŸŸï¼ŒæŠŠå¤§ä½“é‡æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡å°±<strong>å¾ˆå¯èƒ½</strong>è¶…é™ã€‚</p>
<p>åœ¨ä¸‹ä¸€ç« é‡Œï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> ï¼Œåœ¨ä¸è¶…é™çš„æƒ…å†µä¸‹ï¼Œä¸ºæç¤ºæä¾›<strong>ç›¸å…³çš„ä¸Šä¸‹æ–‡</strong>ã€‚åœ¨å¼•å…¥ RAG ä¹‹å‰ï¼Œå…³äºæç¤ºæˆ‘ä»¬è¿˜æœ‰ä¸€äº›å†…å®¹è¦æ¢ç´¢ï¼Œæ¯”å¦‚<strong>æç¤ºè§’è‰²ï¼ˆprompt rolesï¼‰</strong> çš„ç”¨æ³•ã€‚</p>
<h2 data-id="heading-5">3.3 ä¸ºæç¤ºåˆ†é…è§’è‰²ï¼ˆAssigning prompt rolesï¼‰</h2>
<p>åŒ…æ‹¬ OpenAIã€MistralAIã€Anthropic åœ¨å†…çš„è®¸å¤š LLMï¼Œéƒ½æ”¯æŒæŠŠä¸€ä¸ªæç¤ºåˆ‡åˆ†ä¸ºå¤šæ¡<strong>æ¶ˆæ¯</strong>ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½å½’å±äºæŸä¸ª<strong>è§’è‰²</strong>ï¼Œæ¨¡å‹åº”æŒ‰è¯¥è§’è‰²æ¥ç†è§£è¿™æ®µå†…å®¹ã€‚å¸¸è§çš„è§’è‰²åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Userï¼ˆç”¨æˆ·ï¼‰</strong> â€”â€”æ¥è‡ªåº”ç”¨ç”¨æˆ·ï¼ˆæˆ–ä»£è¡¨ç”¨æˆ·ï¼‰çš„æé—®æˆ–é™ˆè¿°ã€‚</li>
<li><strong>Systemï¼ˆç³»ç»Ÿï¼‰</strong> â€”â€”åº”ç”¨æœ¬èº«ç»™ LLM çš„æŒ‡ä»¤ã€‚</li>
<li><strong>Assistantï¼ˆåŠ©æ‰‹ï¼‰</strong> â€”â€”LLM çš„å“åº”å†…å®¹ã€‚</li>
<li><strong>Toolï¼ˆå·¥å…·ï¼‰</strong> â€”â€”è°ƒç”¨å¤–éƒ¨å·¥å…·ä»¥æ‰§è¡ŒæŸäº›æ“ä½œæˆ–è·å–é¢å¤–ä¸Šä¸‹æ–‡çš„æŒ‡ä»¤ã€‚</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å…ˆèšç„¦ <strong>user</strong> ä¸ <strong>system</strong> æ¶ˆæ¯ã€‚<strong>assistant</strong> æ¶ˆæ¯åœ¨ä¸ LLM çš„<strong>å¤šè½®å¯¹è¯</strong>ä¸­æ‰ä¼šç”¨åˆ°ï¼Œç¬¬ 5 ç« ä¼šè¯¦ç»†è®¨è®ºã€‚ç¬¬ 6 ç« åˆ™ä¼šçœ‹åˆ° <strong>tool</strong> æ¶ˆæ¯å¦‚ä½•é€šè¿‡å¯¹æ¥ API è®© AI äº¤äº’æ›´å…·åŠ¨æ€æ€§ã€‚</p>
<blockquote>
<p><strong>NOTE</strong> å¹¶éæ‰€æœ‰ LLM API éƒ½æ”¯æŒç›¸åŒçš„æ¶ˆæ¯è§’è‰²é€‰æ‹©ã€‚å¦‚æœæŸä¸ª API ä¸æ”¯æŒ <strong>System</strong> è§’è‰²ï¼ŒSpring AI ä¼šæŠŠåŸæœ¬ç”¨äº System è§’è‰²çš„æ–‡æœ¬ç›´æ¥åˆå¹¶è¿› <strong>User</strong> æ¶ˆæ¯é‡Œã€‚</p>
</blockquote>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´é€šè¿‡ <code>user()</code> æ–¹æ³•æ¥æŒ‡å®šæç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æç¤ºåœ¨è¯­ä¹‰ä¸Šéƒ½å±äº<strong>ç”¨æˆ·æ¶ˆæ¯</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨å½“å‰ä»£ç åŸºç¡€ä¸Šè¯¢é—®â€œcheckersï¼ˆè·³æ£‹ï¼‰æœ‰å¤šå°‘æ£‹å­â€ï¼ŒSpring AI ä¼šå‘ OpenAI å‘é€å¦‚ä¸‹ JSONï¼ˆä½œä¸º POST è¯·æ±‚ä½“ï¼‰ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"messages"</span>: [
    {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"You are a helpful assistant, answering questions about
          tabletop games.<span class="hljs-subst">\n</span>If available, use the rules in the RULES section
          below.<span class="hljs-subst">\n</span>If you don't know anything about the game or don't know the
          answer,<span class="hljs-subst">\n</span>say "</span><span class="hljs-type">I</span> don't know<span class="hljs-string">".<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>The game is checkers.<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>The
          question is: How many pieces are there?.<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>RULES:<span class="hljs-subst">\n</span>"</span>,
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>
    }
  ],
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4o"</span>,
  <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œåªæœ‰ä¸€æ¡æ¶ˆæ¯ï¼Œå†…å®¹æ˜¯æ•´ä¸ªæç¤ºï¼Œè§’è‰²æ˜¯ <strong>user</strong>ã€‚è¿™èƒ½å·¥ä½œï¼Œä½†<strong>è¿˜èƒ½æ›´å¥½</strong>ã€‚</p>
<h4 data-id="heading-6">æ£€æŸ¥ Spring AI çš„è¯·æ±‚ä¸å“åº”</h4>
<p>å¦‚æœä½ æƒ³æŸ¥çœ‹ä½¿ç”¨ Spring AI æäº¤æç¤ºæ—¶çš„<strong>åŸå§‹è¯·æ±‚ä¸å“åº” JSON</strong>ï¼Œå¯ä»¥åœ¨é¡¹ç›®é‡ŒåŠ å…¥ Logbookï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzalando%2Flogbook" target="_blank" title="https://github.com/zalando/logbook" ref="nofollow noopener noreferrer">github.com/zalando/logâ€¦</a>ï¼‰ä¾èµ–ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">'org.zalando:logbook-spring-boot-starter:3.9.0'</span>
</code></pre>
<p>è¯¥ä¾èµ–ä¼šä¸º Spring è‡ªåŠ¨é…ç½®ä¸€äº›ç»„ä»¶ï¼Œç”¨æ¥æ‹¦æˆªå¹¶è®°å½•é€šè¿‡è¿™äº›ç»„ä»¶å‘èµ·çš„ HTTP è¯·æ±‚ä¸è¿”å›çš„å“åº”ã€‚</p>
<p>Spring AI çš„ <code>ChatClient</code> åº•å±‚ç”¨çš„æ˜¯ Spring çš„ <strong>RestClient</strong>ï¼Œå› æ­¤ä½ éœ€è¦å£°æ˜ä¸€ä¸ª <code>RestClientCustomizer</code> beanï¼ŒæŠŠ Logbook çš„ <code>LogbookClientHttpRequestInterceptor</code> åŠ ä¸ºè¯·æ±‚æ‹¦æˆªå™¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Bean</span>
<span class="hljs-title class_">RestClientCustomizer</span> <span class="hljs-title function_">logbookCustomizer</span>(<span class="hljs-params">
        LogbookClientHttpRequestInterceptor interceptor</span>) {
  <span class="hljs-keyword">return</span> restClient -&gt; restClient.<span class="hljs-title function_">requestInterceptor</span>(interceptor);
}
</code></pre>
<p>Logbook ä»¥ <strong>TRACE</strong> çº§åˆ«è®°å½•è¯·æ±‚ä¸å“åº”ç»†èŠ‚ï¼Œå› æ­¤éœ€è¦åœ¨ <code>application.properties</code> ä¸­è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">logging.level.org.zalando.logbook: TRACE</span>
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLogbook ä»¥ <strong>JSON</strong> æ ¼å¼è¾“å‡ºæ—¥å¿—ï¼Œå¯è¯»æ€§ä¸€èˆ¬ï¼›å¯é€‰åœ°ï¼Œä½ å¯ä»¥æŠŠ <code>logbook.format.style</code> è®¾ä¸º <code>http</code> æ¥æå‡å¯è¯»æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logbook.format.style</span>=http
</code></pre>
<p>é…ç½®å®Œæˆåï¼ŒSpring AI ä¸å„ AI API ä¹‹é—´çš„è¯·æ±‚ä¸å“åº”éƒ½ä¼šè¢«è®°å½•ï¼Œä¾¿äºæ£€æŸ¥ã€‚éœ€è¦æ³¨æ„ï¼šSpring AI çš„ <strong>Gemini</strong> æ¨¡å—ä½¿ç”¨ Google è‡ªæœ‰çš„ HTTP å®¢æˆ·ç«¯åº“è€Œé RestClientï¼Œå› æ­¤å¦‚æœé€‰æ‹© Google Gemini ä½œä¸º LLMï¼ŒLogbook å°†<strong>æ— æ³•</strong>æ‹¦æˆªå…¶è¯·æ±‚ã€‚</p>
<p>å¦‚å›¾ 3.3 æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯å†…å®¹æ‹†æˆä¸¤æ¡ï¼šå…¶ä¸­å¤§éƒ¨åˆ†æ–‡æœ¬å®é™…æ˜¯<strong>ç»™ LLM çš„æŒ‡ä»¤</strong>ï¼Œç”¨äºæŒ‡å¯¼å®ƒå¦‚ä½•å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå› æ­¤æ›´åˆé€‚åšæˆ <strong>system</strong> æ¶ˆæ¯ï¼›çœŸæ­£æ¥è‡ªç”¨æˆ·çš„åªæœ‰<strong>é‚£ä¸ªé—®é¢˜æœ¬èº«</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dd859ae2d244eb3aacee01c0b90cc0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=JCS2SqX8wZpL0QS%2FP%2BvHkWaPFcs%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.3</strong> å°†åŸå…ˆçš„ç”¨æˆ·æ¶ˆæ¯æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ system ä¸ user æ¶ˆæ¯</p>
<p>è¦æŠŠè¿™ä¸ªå˜æ›´åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œå…ˆåœ¨æ¨¡æ¿ç›®å½•æ–°å¢ä¸€ä¸ª <strong><code>systemPromptTemplate.st</code></strong> æ–‡ä»¶ï¼Œç”¨å®ƒæ›¿ä»£åŸå…ˆçš„ <code>questionPromptTemplate.st</code>ï¼ˆåè€…ä¸å†ä½¿ç”¨ï¼Œå¯ä»¥åˆ é™¤ï¼‰ã€‚æ–°çš„ system æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">You are a helpful assistant, answering questions about the tabletop
game named {gameTitle}. If available, use the rules in the RULES 
section below.

Answer in complete sentences.

<span class="hljs-section">RULES
-----</span>
{rules}
</code></pre>
<p>æ¥ä¸‹æ¥éœ€è¦è°ƒæ•´ <code>SpringAiBoardGameService</code>ï¼Œè®©å®ƒä½¿ç”¨è¿™ä¸ª<strong>æ–°æ¨¡æ¿</strong>è€Œéæ—§çš„ question æ¨¡æ¿ã€‚ç”¨ä¸‹é¢çš„å­—æ®µæ›¿æ¢æ‰ç±»ä¸­ç°æœ‰çš„æ¨¡æ¿ <code>Resource</code> å±æ€§ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/systemPromptTemplate.st"</span>)</span>
Resource promptTemplate;
</code></pre>
<p>æœ€åï¼Œå¯¹ <code>askQuestion()</code> æ–¹æ³•åšä¸€äº›å˜æ›´ä»¥ä½¿ç”¨æ–°æ¨¡æ¿ã€‚æ–°ç‰ˆæœ¬å¦‚ä¸‹ï¼ˆ<strong>æ¸…å• 3.4 å°†æç¤ºæ‹†åˆ†ä¸ºç‹¬ç«‹çš„ user ä¸ system æ¶ˆæ¯</strong>ï¼‰ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public Answer <span class="hljs-built_in">askQuestion</span>(Question question) {
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">gameRules</span> = <span class="hljs-selector-tag">gameRulesService</span><span class="hljs-selector-class">.getRulesFor</span>(question.<span class="hljs-built_in">gameTitle</span>());

  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">answerText</span> = <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
      <span class="hljs-selector-class">.system</span>(systemSpec -&gt; systemSpec      #<span class="hljs-number">1</span>
          .<span class="hljs-built_in">text</span>(promptTemplate)
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"gameTitle"</span>, question.<span class="hljs-built_in">gameTitle</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"rules"</span>, gameRules))
      <span class="hljs-selector-class">.user</span>(question.<span class="hljs-built_in">question</span>())             <span class="hljs-selector-id">#2</span>
      <span class="hljs-selector-class">.call</span>()
      <span class="hljs-selector-class">.content</span>();

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Answer</span>(question.<span class="hljs-built_in">gameTitle</span>(), answerText);
}
</code></pre>
<p>å…·ä½“è€Œè¨€ï¼šæ¨¡æ¿é€šè¿‡ <strong>system</strong> æ¶ˆæ¯è§„æ ¼çš„ <code>text()</code> æä¾›ï¼ˆè€Œä¸æ˜¯å…ˆå‰çš„ <strong>user</strong> è§„æ ¼ï¼‰ï¼Œç”¨äºå¡«å……å ä½ç¬¦çš„å‚æ•°ä¹ŸåŒç†ã€‚è‡³äº <strong>user</strong> æ¶ˆæ¯ï¼Œå†æ¬¡ä»…ä½¿ç”¨<strong>ç”¨æˆ·é—®é¢˜çš„æ–‡æœ¬</strong>æœ¬èº«ã€‚</p>
<p><strong>user ä¸ system æ¶ˆæ¯çš„å…ˆåé¡ºåºå¹¶ä¸é‡è¦</strong>ï¼›æ— è®ºé¡ºåºå¦‚ä½•ï¼Œå®ƒä»¬æœ€ç»ˆéƒ½ä¼šå‡ºç°åœ¨å‘ç»™ LLM çš„è¯·æ±‚ä¸­ã€‚</p>
<p>å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œé‡å¯åº”ç”¨å†è¯•ä¸€æ¬¡ã€‚è¡¨é¢ä¸Šä»ä¸ä¹‹å‰ä¸€è‡´ï¼Œä½†åº•å±‚å‘å¾€ OpenAI çš„è¯·æ±‚ç°åœ¨åŒ…å«ä¸¤æ¡æ˜ç¡®åˆ†ç¦»çš„æ¶ˆæ¯ï¼šä¸€æ¡æ˜¯ <strong>system æŒ‡ä»¤</strong>ï¼Œä¸€æ¡æ˜¯ <strong>user æé—®</strong>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"messages"</span>: [
    {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"How many pieces are there?"</span>,
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>
    },
    {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"You are a helpful assistant, answering questions about the
          tabletop<span class="hljs-subst">\n</span>game named checkers. If available, use the rules in the
          RULES section below.<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>RULES<span class="hljs-subst">\n</span>-----<span class="hljs-subst">\n</span>"</span>,
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>
    }
  ],
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4o"</span>,
  <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>
}
</code></pre>
<p>å°½ç®¡æˆ‘ä»¬ç›®å‰çš„ç¤ºä¾‹å¯èƒ½è¿‡äºç®€å•ï¼Œä¸è¶³ä»¥ä½“ç°â€œè§’è‰²â€å¸¦æ¥çš„æ˜æ˜¾å·®å¼‚ï¼Œä½†æ€»ä½“è€Œè¨€ï¼Œ<strong>åˆç†ä½¿ç”¨è§’è‰²æœ‰åŠ©äº LLM ç”Ÿæˆæ›´ä¼˜çš„å“åº”</strong>ã€‚éšç€æç¤ºå¤æ‚åº¦æé«˜ï¼Œè¿™ç§ç§¯æä½œç”¨ä¼šæ›´åŠ æ˜¾è‘—ã€‚</p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å¦‚ä½•<strong>åˆ›å»ºå¹¶å‘é€</strong>æç¤ºç»™ LLM è¿›è¡Œç”Ÿæˆã€‚æ¥ä¸‹æ¥æŠŠæ³¨æ„åŠ›è½¬åˆ°å¯¹è¯çš„å¦ä¸€ç«¯ï¼šå­¦ä¹ <strong>å¦‚ä½•å‘ŠçŸ¥ LLM æˆ‘ä»¬å¸Œæœ›ä»¥ä½•ç§å½¢å¼æ¥æ”¶ç”Ÿæˆçš„å“åº”</strong>ã€‚</p>
<h2 data-id="heading-7">3.4 å½±å“å“åº”ç”Ÿæˆï¼ˆInfluencing response generationï¼‰</h2>
<p>Spring AI æä¾›äº†å‡ é¡¹å¾ˆå®ç”¨çš„åŠŸèƒ½ï¼Œç”¨æ¥å½±å“å“åº”è¿”å›çš„æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>è®¾ç½®ç”Ÿæˆé€‰é¡¹</strong>ï¼šåœ¨ç”Ÿæˆå“åº”æ—¶ï¼Œå¯¹â€œä¸‹ä¸€æš token çš„é€‰æ‹©â€æ–½åŠ ä¸€å®šæ§åˆ¶ã€‚</li>
<li><strong>è¾“å‡ºè½¬æ¢ï¼ˆoutput conversionï¼‰</strong> ï¼šåœ¨æç¤ºä¸­åŠ å…¥æ ¼å¼åŒ–æŒ‡ä»¤ï¼Œå‘Šè¯‰ LLM æŒ‰ç‰¹å®šæ ¼å¼è¿”å›ï¼Œä»¥ä¾¿æŠŠæ–‡æœ¬å“åº”è½¬æ¢æˆ Java å¯¹è±¡ã€‚</li>
<li><strong>æµå¼ä¼ è¾“</strong>ï¼šè®©ç»“æœ<strong>ä¸€ç‚¹ç‚¹</strong>è¿”å›ï¼Œè€Œä¸æ˜¯ç­‰å¾…<strong>ä¸€æ¬¡æ€§</strong>è¿”å›å®Œæ•´å“åº”ã€‚</li>
</ul>
<p>ä¸‹é¢ä»æŠŠå“åº”ç»‘å®šä¸º Java å¯¹è±¡å¼€å§‹ï¼Œé€ä¸€ä»‹ç»è¿™äº›åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-8">3.4.1 æŒ‡å®šèŠå¤©é€‰é¡¹ï¼ˆSpecifying chat optionsï¼‰</h3>
<p>åœ¨ä½¿ç”¨ç”Ÿæˆå¼ AI æ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç° LLM çš„å›ç­”å¹¶ä¸æ€»å¦‚é¢„æœŸã€‚æ¨¡å‹å·¨å¤§çš„è®­ç»ƒè§„æ¨¡ï¼ŒåŠ ä¸Šç”Ÿæˆè¿‡ç¨‹çš„<strong>éç¡®å®šæ€§</strong>ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿä¸é‚£ä¹ˆç†æƒ³çš„ç»“æœã€‚</p>
<p>Spring AI æä¾›äº†è‹¥å¹²å±æ€§ï¼Œè®©ä½ â€œè°ƒå‚â€ä»¥å½±å“ LLM å¤„ç†æç¤ºçš„æ–¹å¼ã€‚ä½ å·²åœ¨ç¬¬ 1 ç« è§è¿‡ä¸€ä¸ªï¼šåœ¨ <code>application.properties</code> ä¸­è¦†ç›–é»˜è®¤æ¨¡å‹ä¸º <code>gpt-4.1-nano</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.openai.chat.options.model</span>=gpt-<span class="hljs-number">4.1</span>-na<span class="hljs-literal">no</span>
</code></pre>
<p>Spring AI æ”¯æŒçš„å„ç±» API éƒ½æœ‰ç±»ä¼¼å±æ€§æ¥æŒ‡å®šæ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Ollama æ—¶é€‰æ‹© <strong>Llama 3.2</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.options.model</span>=llama3.<span class="hljs-number">2</span>
</code></pre>
<p>è¿™ä¸¤è¡Œçš„å…³é”®åŒºåˆ«ï¼ˆé™¤æ¨¡å‹åå¤–ï¼‰åœ¨äºï¼šä¸€è¡Œå¯¹åº” <strong>OpenAI</strong> çš„ APIï¼Œå¦ä¸€è¡Œå¯¹åº” <strong>Ollama</strong> çš„ APIã€‚ä»¥è¿™ç§æ–¹å¼è®¾ç½®èŠå¤©é€‰é¡¹æ—¶ï¼Œè¯·ç¡®ä¿ä½¿ç”¨<strong>ä¸ä½ æ‰€ç”¨ API åŒ¹é…</strong>çš„å±æ€§å‰ç¼€ã€‚</p>
<p>å¤šæ•°èŠå¤©é€‰é¡¹éƒ½å¯ä»¥åœ¨ <code>application.properties</code> é‡Œè®¾ç½®ï¼›ä¹Ÿå¯ä»¥åœ¨åˆ›å»º <code>ChatClient</code> æ—¶é€šè¿‡ <code>defaultOptions()</code> è®¾ä¸ºé»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œåˆ›å»º <code>ChatClient</code> æ—¶æŒ‡å®š <code>gpt-4.1-nano</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .model("gpt-4.1-nano")
    .build()<span class="hljs-comment">;</span>

ChatClient <span class="hljs-attr">chatClient</span> = chatClientBuilder
    .defaultOptions(chatOptions)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p>é€šè¿‡ <code>defaultOptions()</code> è®¾ç½®çš„é€‰é¡¹ä¼š<strong>è¦†ç›–</strong>åœ¨ <code>application.properties</code> é‡ŒåŒåçš„é…ç½®ï¼›è€Œè¿™äº›é»˜è®¤é€‰é¡¹åˆå¯ä»¥åœ¨<strong>åˆ›å»ºæç¤º</strong>æ—¶é€šè¿‡ <code>options()</code> <strong>ç»§ç»­è¦†ç›–</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">String answerText = chatClient<span class="hljs-selector-class">.prompt</span>()
    <span class="hljs-selector-class">.user</span>(question.question())
    <span class="hljs-selector-class">.options</span>(chatOptions)
    <span class="hljs-selector-class">.call</span>()
    <span class="hljs-selector-class">.content</span>();
</code></pre>
<p>é€‰æ‹©æ¨¡å‹åªæ˜¯ä¼—å¤šèŠå¤©é€‰é¡¹ä¹‹ä¸€ã€‚ä¸åŒç”Ÿæˆå¼ API æ”¯æŒçš„é€‰é¡¹å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œä½†æœ‰è‹¥å¹²<strong>æ ¸å¿ƒé€‰é¡¹</strong>æ˜¯æ™®éå­˜åœ¨çš„ã€‚å…ˆçœ‹ä¸€ç»„ä¼šå½±å“â€œå¦‚ä½•é€ token é€‰å–â€çš„é€‰é¡¹ã€‚</p>
<h4 data-id="heading-9">è°ƒæ•´â€œå¤šæ ·æ€§/éšæœºæ€§â€ï¼ˆAdjusting variabilityï¼‰</h4>
<p>å“åº”ç”Ÿæˆæ˜¯<strong>é€ token</strong>è¿›è¡Œçš„ï¼šå…ˆè€ƒè™‘åŸå§‹æç¤ºï¼Œç„¶åç”± API åŸºäºæ¨¡å‹é€‰æ‹©<strong>ä¸‹ä¸€æš token</strong>ï¼›æ¥ç€å†é€‰ä¸‹ä¸€æšï¼Œç›´åˆ°å®Œæ•´å“åº”ç”Ÿæˆå®Œæ¯•ã€‚</p>
<p>é€‰æ‹©â€œä¸‹ä¸€æš tokenâ€çš„æ–¹æ³•å¯ç†è§£ä¸º<strong>ç»Ÿè®¡æ¦‚ç‡ + éšæœºé€‰æ‹©</strong>çš„ç»„åˆã€‚æ¨¡å‹ä¼šç»™å‡ºè‹¥å¹²å€™é€‰ tokenï¼Œæ¯ä¸ªéƒ½æœ‰æˆä¸ºä¸‹ä¸€æš token çš„æ¦‚ç‡ã€‚ä»¥æ¦‚ç‡ä¸ºæƒé‡åšä¸€æ¬¡éšæœºé€‰æ‹©ï¼šæ¦‚ç‡é«˜çš„æ›´å®¹æ˜“è¢«é€‰ä¸­ï¼Œä½†<strong>æ‰€æœ‰å€™é€‰</strong>éƒ½æœ‰è¢«é€‰ä¸­çš„å¯èƒ½ã€‚</p>
<p>ä¾‹å¦‚æç¤ºä¸ºï¼šâ€œFinish this sentence: I have a large collection of.â€ ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆç”¨<strong>è¯</strong>ä»£æ›¿ <strong>token</strong> æ¥æ€è€ƒã€‚å‡è®¾å€™é€‰è¯åŠå…¶æ¦‚ç‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>â€œbooksâ€ - 0.475</li>
<li>â€œcoinsâ€ - 0.236</li>
<li>â€œrecordsâ€ - 0.129</li>
<li>â€œartsâ€ - 0.096</li>
<li>â€œstampsâ€ - 0.064</li>
</ul>
<p>åŸºäºä»¥ä¸Šæƒé‡ï¼Œ<strong>books</strong> è¢«é€‰ä¸­çš„æ¦‚ç‡çº¦æ˜¯ <strong>coins</strong> çš„ä¸¤å€ã€æ˜¯ <strong>stamps</strong> çš„ä¸ƒå€å¤šã€‚å¤šæ¬¡æäº¤ç›¸åŒæç¤ºï¼Œå¤§å¤šæ•°ç»“æœä¼šä»¥ <strong>books</strong> å®Œæˆå¥å­ï¼Œ<strong>coins/records/arts/stamps</strong> å¶å°”å‡ºç°ï¼Œä¸”é¢‘ç‡é€æ­¥é™ä½ã€‚</p>
<p>é€šè¿‡ <strong>temperatureã€Top-pã€Top-k</strong> ç­‰é€‰é¡¹ï¼Œä½ å¯ä»¥å½±å“é€‰æ‹©çš„éšæœºæ€§ä»¥åŠä¸åŒ token è¢«é€‰ä¸­çš„ç›¸å¯¹å¯èƒ½æ€§ï¼š</p>
<ul>
<li><strong>temperatureï¼ˆæ¸©åº¦ï¼‰</strong> ï¼šèŒƒå›´ <strong>0â€“2</strong>ï¼Œå¯¹æ¦‚ç‡æ–½åŠ ç¼©æ”¾ã€‚ç›´è§‰ä¸Šï¼Œ<strong>æ¸©åº¦è¶Šé«˜</strong>ï¼Œç»“æœè¶Š<strong>éšæœº</strong>ï¼›<strong>æ¸©åº¦è¶Šä½</strong>ï¼Œç»“æœè¶Š<strong>ç¡®å®š</strong>ï¼ˆè§å›¾ 3.4ï¼‰ã€‚å½“æ¸©åº¦è¶‹è¿‘ 2ï¼Œå„ token æ¦‚ç‡è¶‹äºå¹³å‡ï¼›å½“æ¸©åº¦è¶‹è¿‘ 0ï¼Œæœ€é«˜æ¦‚ç‡ token çš„æ¦‚ç‡è¶‹è¿‘ 1ï¼Œå…¶ä»–è¶‹è¿‘ 0ï¼›æ¸©åº¦ä¸º 1 æ—¶æ¦‚ç‡ä¸å˜ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e8f90d1d94e44d8b5cc06fb315ebcc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=NGma5BUEeQGB5ddFaWaOFdGLSm8%3D" alt="image.png" loading="lazy"/></li>
</ul>
<p><strong>å›¾ 3.4</strong> æ¸©åº¦è¶Šé«˜ï¼Œæ¦‚ç‡è¶Šå‡åŒ€ï¼Œç»“æœæ›´éšæœºï¼›æ¸©åº¦è¶Šä½ï¼Œæ¦‚ç‡å·®å¼‚è¢«æ”¾å¤§ï¼Œç»“æœæ›´ç¡®å®šã€‚</p>
<p>åœ¨ <code>application.properties</code> ä¸­å¯æŒ‰æ‰€ç”¨ API è®¾ç½®æ¸©åº¦ã€‚ä¾‹å¦‚ OpenAI è®¾ä¸º 0.7ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.openai.chat.options.temperature</span>=<span class="hljs-number">0.7</span>
</code></pre>
<p>æˆ–åœ¨ä»£ç é‡Œé€šè¿‡ <code>ChatOptions</code> æŒ‡å®šï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .temperature(0.7)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>Top-Pï¼ˆæ ¸é‡‡æ ·ï¼‰</strong> ï¼šèŒƒå›´ <strong>0â€“1</strong>ï¼Œä¿ç•™<strong>ç´¯è®¡æ¦‚ç‡</strong>è¾¾åˆ°é˜ˆå€¼çš„<strong>æœ€å°å€™é€‰é›†åˆ</strong>ï¼Œå…¶ä½™å…¨éƒ¨å‰”é™¤ã€‚<br/>
ä¾‹å¦‚ Top-P=0.8ï¼Œå¦‚å›¾ 3.5ï¼Œ<code>books+coins+records</code> çš„ç´¯è®¡æ¦‚ç‡ä¸º 0.84ï¼Œè¾¾åˆ°é˜ˆå€¼ï¼Œäºæ˜¯ <strong>arts/stamps</strong> è¢«å‰”é™¤ï¼›éšåå¯¹ä¿ç•™é›†åˆçš„æ¦‚ç‡<strong>å½’ä¸€åŒ–</strong>å†åšåŠ æƒéšæœºé€‰æ‹©ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3c4e6ef45ee4464ae14ccbe0748fbeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=wbWngSrSb0rM2AmIlA22YsjCdC4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.5</strong> Top-P æ ¹æ®é«˜æ’å token çš„ç´¯è®¡æ¦‚ç‡é˜ˆå€¼ï¼Œå‰”é™¤å…¶ä½™å€™é€‰ã€‚</p>
<p>åœ¨ OpenAI ä¸‹ç”¨å±æ€§è®¾ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.openai.chat.options.top-p</span>=<span class="hljs-number">0.8</span>
</code></pre>
<p>æˆ–ä»£ç è®¾ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .topP(0.8)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p>é€šå¸¸å»ºè®®<strong>äºŒé€‰ä¸€</strong>ï¼šä½¿ç”¨ <strong>temperature</strong> æˆ– <strong>Top-P</strong>ã€‚ä¸¤è€…åŒæ—¶ä½¿ç”¨æ˜¯å…è®¸çš„ï¼Œä½†ä¸ä¸€å®šæ›´å¥½ã€‚</p>
<ul>
<li><strong>Top-K</strong>ï¼šä¸ Top-P ç±»ä¼¼ï¼Œä½†ç”¨<strong>è®¡æ•°</strong>è€Œéç´¯è®¡æ¦‚ç‡ï¼Œç›´æ¥ä¿ç•™<strong>å‰ K ä¸ª</strong>å€™é€‰ã€‚<strong>OpenAI ä¸æ”¯æŒ Top-K</strong>ï¼Œå› æ­¤æ— æ³•åœ¨ OpenAI ä¸Šè°ƒæ•´å®ƒï¼›<strong>Ollama æ”¯æŒ</strong>ï¼Œå¯åœ¨é…ç½®ä¸­è®¾ç½®ï¼š</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.options.top-k</span>=<span class="hljs-number">4</span>
</code></pre>
<p>æˆ–åœ¨ä»£ç ä¸­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .topK(4)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p>è‹¥ä½ åœ¨ <code>ChatOptions</code> é‡Œè®¾ç½®äº† Top-K å´æŠŠæç¤ºå‘ç»™ OpenAIï¼Œå°†ä¼šæ”¶åˆ°â€œä¸æ”¯æŒ Top-Kâ€çš„é”™è¯¯ã€‚</p>
<p>åº”ç”¨åˆ°å‰è¿°â€œæ”¶è—â€ç¤ºä¾‹ä¸Šï¼Œè‹¥ <code>top-k=4</code>ï¼Œåˆ™ <strong>books/coins/records/arts</strong> è¢«ä¿ç•™ï¼Œ<strong>stamps</strong> è¢«å‰”é™¤ï¼›éšååŒæ ·è¿›è¡Œæ¦‚ç‡å½’ä¸€åŒ–å¹¶éšæœºé€‰æ‹©ã€‚</p>
<p>åƒ <strong>temperatureã€Top-Pã€Top-K</strong> è¿™æ ·çš„é€‰é¡¹ï¼Œå¯ä»¥åœ¨ LLM ç”Ÿæˆå“åº”æ—¶å¯¹å…¶â€œé€‰æ‹©è¿‡ç¨‹â€æ–½åŠ ä¸€å®šæ§åˆ¶ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹<strong>è¾“å‡ºè½¬æ¢ï¼ˆoutput conversionï¼‰</strong> ï¼Œå¦‚ä½•è®©ç”Ÿæˆç»“æœç›´æ¥è½åœ°ä¸ºä¸€ä¸ª <strong>Java å¯¹è±¡</strong>ã€‚</p>
<h3 data-id="heading-10">3.4.2 æ ¼å¼åŒ–å“åº”è¾“å‡ºï¼ˆFormatting response outputï¼‰</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åº”ç”¨ä¼šæ˜¾å¼åœ°ä» LLM è¿”å›çš„å“åº”ä¸­æå–<strong>æ–‡æœ¬å†…å®¹</strong>ï¼Œå¹¶æ®æ­¤åˆ›å»ºä¸€ä¸ª <code>Answer</code> å¯¹è±¡ã€‚å°±ç›®å‰è¿™ä¸ªç®€å•çš„ <code>Answer</code> è®°å½•ç±»å‹è€Œè¨€ï¼Œè¿™å¹¶ä¸éš¾ã€‚ä½†å¯ä»¥æƒ³è§ï¼Œè‹¥å“åº”æ›´å¤æ‚ï¼Œâ€œå…ˆæå–å†å®ä¾‹åŒ–â€çš„ä»£ç ä¼šå˜å¾—è‡ƒè‚¿ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring AI æä¾›äº†**è¾“å‡ºè½¬æ¢ï¼ˆoutput conversionï¼‰**è¾…åŠ©ï¼Œç”¨äºæŠŠ LLM çš„å“åº”æ˜ å°„ä¸º Java å¯¹è±¡ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºè¾“å‡ºè½¬æ¢å¦‚ä½•å·¥ä½œï¼Œå…ˆçœ‹çœ‹å¦‚ä½•è®© <code>ChatClient</code> <strong>ç›´æ¥è¿”å› <code>Answer</code> å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚ä¸ºæ­¤ï¼Œéœ€è¦æŠŠ <code>askQuestion()</code> æ–¹æ³•æ”¹ä¸ºè¯·æ±‚å®ä½“å¯¹è±¡ã€‚</p>
<p><strong>æ¸…å• 3.5 å°† LLM ç»“æœç›´æ¥è·å–ä¸º <code>Answer</code> å¯¹è±¡</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-title">implements</span> <span class="hljs-title">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GameRulesService gameRulesService;

  <span class="hljs-keyword">public</span> SpringAiBoardGameService(
      ChatClient.Builder chatClientBuilder,
      GameRulesService gameRulesService) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    <span class="hljs-keyword">this</span>.gameRulesService = gameRulesService;
  }

  <span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/systemPromptTemplate.st"</span>)</span>
  Resource promptTemplate;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Answer askQuestion(Question question) {
    <span class="hljs-keyword">var</span> gameRules = gameRulesService.getRulesFor(question.gameTitle());

    <span class="hljs-keyword">return</span> chatClient.prompt()
        .system(systemSpec -&gt; systemSpec
            .text(promptTemplate)
            .param(<span class="hljs-string">"gameTitle"</span>, question.gameTitle())
            .param(<span class="hljs-string">"rules"</span>, gameRules))
        .user(question.question())
        .call()
        .entity(Answer.<span class="hljs-keyword">class</span>);
  }

}
</code></pre>
<p><code>askQuestion()</code> çš„å·¥ä½œæ–¹å¼å‡ ä¹ä¸ä¹‹å‰å®Œå…¨ç›¸åŒï¼Œåªæ˜¯æœ‰ä¸€ä¸ªä¸å¤ªæ˜¾çœ¼çš„å˜åŒ–ï¼šä¸å†è°ƒç”¨ <code>content()</code>ï¼Œè€Œæ˜¯è°ƒç”¨ <code>entity()</code>ï¼Œå¹¶ä¼ å…¥ <code>Answer.class</code> æŒ‡æ˜æœŸæœ›çš„å“åº”ç±»å‹ã€‚</p>
<p>è¿™ä¸ªå°æ”¹åŠ¨å¸¦æ¥ä¸¤ç‚¹å˜åŒ–ï¼š</p>
<ol>
<li><strong>æ ¼å¼åŒ–æŒ‡ä»¤</strong>ä¼šè¢«åŠ å…¥åˆ°æç¤ºä¸­ï¼›</li>
<li>è¿”å›çš„å“åº”ä¼šè¢«<strong>è§£æä¸ºå¯¹è±¡</strong>ã€‚</li>
</ol>
<p>åœ¨æç¤ºå‘é€ç»™ LLM ä¹‹å‰ï¼ŒSpring AI ä¼š<strong>è£…é¥°</strong>æç¤ºï¼ŒåŠ å…¥<strong>æ ¼å¼åŒ–æŒ‡ä»¤</strong>ï¼Œå‘Šè¯‰æ¨¡å‹å“åº”åº”é‡‡ç”¨ä½•ç§æ ¼å¼ã€‚è¯¥æ ¼å¼ç”± <code>Answer</code> è®°å½•åŠå…¶å±æ€§<strong>æ¨å¯¼</strong>è€Œæ¥ã€‚å¦‚æœä½ æ‹¦æˆªè¯·æ±‚å¹¶æŸ¥çœ‹ç»†èŠ‚ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„æ ¼å¼åŒ–æŒ‡ä»¤ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">Your <span class="hljs-built_in">response</span> should be <span class="hljs-keyword">in</span> JSON format.
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> include any explanations, only provide a RFC8259 compliant JSON
<span class="hljs-built_in">response</span> following this format without deviation.
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> include markdown code blocks <span class="hljs-keyword">in</span> your <span class="hljs-built_in">response</span>.
Here <span class="hljs-keyword">is</span> the JSON Schema instance your output must adhere <span class="hljs-keyword">to</span>:
```{
  <span class="hljs-string">"$schema"</span> : <span class="hljs-string">"https://json-schema.org/draft/2020-12/schema"</span>,
  <span class="hljs-string">"type"</span> : <span class="hljs-string">"object"</span>,
  <span class="hljs-string">"properties"</span> : {
    <span class="hljs-string">"answer"</span> : {
      <span class="hljs-string">"type"</span> : <span class="hljs-string">"string"</span>
    },
    <span class="hljs-string">"gameTitle"</span> : {
      <span class="hljs-string">"type"</span> : <span class="hljs-string">"string"</span>
    }
  }
}```
</code></pre>
<p>è¿™é‡Œçš„æ ¼å¼è¯´æ˜<strong>ç²¾ç¡®</strong>å‘ŠçŸ¥ LLMï¼šåº”æŒ‰ JSON å¯¹è±¡è¿”å›ï¼Œå¹¶é™„ä¸Šäº† JSON Schemaã€‚</p>
<p>å½“å“åº”è¿”å›æ—¶ï¼Œè¿™ä¸ª JSON å¯¹è±¡ä¼šè¢«<strong>è½¬æ¢</strong>æˆæ‰€éœ€ç±»å‹â€”â€”æ­¤å¤„ä¸º <code>Answer</code>ã€‚</p>
<blockquote>
<p><strong>NOTE</strong> å³ä½¿ Spring AI çš„è¾“å‡ºè½¬æ¢è´Ÿè´£ç”Ÿæˆäº†æ ¼å¼åŒ–æŒ‡ä»¤ï¼Œä¹Ÿ<strong>ä¸ä¿è¯</strong>ä¸€å®šæœ‰æ•ˆã€‚æœ‰äº› LLM å¹¶ä¸éµå¾ªæ ¼å¼è¦æ±‚ï¼Œä»ä¼šéšæ„è¿”å›ç­”æ¡ˆã€‚OpenAI çš„ GPT æ¨¡å‹é€šå¸¸æ‰§è¡Œå¾—ä¸é”™ï¼Œä½†å…¶ä»–æ¨¡å‹ï¼ˆå¦‚ <strong>Mistral 7B</strong>ï¼‰å¯èƒ½ä¸è¡Œã€‚å¦‚æœæ‰€ç”¨ LLM ä¸éµå®ˆæ ¼å¼ï¼Œç»“æœå°±<strong>æ— æ³•å¯é </strong>åœ°è½¬æ¢å¹¶ç»‘å®šåˆ°å¯¹è±¡ï¼›è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Spring AI å°è¯•æŠŠâ€œé JSON å“åº”â€ç»‘å®šåˆ°å¯¹è±¡æ—¶ï¼Œä¼šæŠ›å‡º <strong>JsonParseException</strong>ã€‚</p>
</blockquote>
<p>å°±æ˜¯è¿™æ ·ï¼ç°åœ¨ Spring AI çš„è¾“å‡ºè½¬æ¢ä¼šè´Ÿè´£åˆ›å»º <code>Answer</code> å¯¹è±¡â€”â€”å®ƒä¹‹æ‰€ä»¥èƒ½åšåˆ°ï¼Œæ˜¯å› ä¸ºå®ƒé¦–å…ˆç”Ÿæˆäº†<strong>æŒ‡ä»¤</strong>ï¼Œå‘Šè¯‰ LLM æŒ‰ JSON å¯¹è±¡æ ¼å¼è¿”å›ç»“æœã€‚</p>
<h4 data-id="heading-11">å°†è¾“å‡ºè§£æä¸ºåˆ—è¡¨ï¼ˆParsing output to a listï¼‰</h4>
<p>Spring AI ä¹Ÿèƒ½æŠŠå“åº”è§£æä¸º <code>List&lt;String&gt;</code>ã€‚å½“ä½ é¢„æœŸå“åº”æ˜¯ä¸€ä¸ªâ€œæ¡ç›®åˆ—è¡¨â€æ—¶ï¼Œè¿™å¾ˆé€‚åˆï¼Œæ¯”å¦‚æ¸¸ä¹å›­æ™¯ç‚¹æ¸…å•ã€è”èµ›çƒé˜Ÿåå•ã€æˆ– Billboard Hot 100 çš„å¹´åº¦åå¤§é‡‘æ›²ã€‚</p>
<p>ä¸ºæ¼”ç¤ºå¦‚ä½•æ‹¿åˆ°åˆ—è¡¨å“åº”ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨ï¼ˆå¦‚ä¸‹æ¸…å•ï¼‰ï¼ŒæŒ‰ç»™å®šå¹´ä»½è¿”å›å‰ 10 é¦–æ­Œæ›²ï¼š</p>
<p><strong>æ¸…å• 3.6 è¿”å›æŸå¹´ä»½çƒ­é—¨æ­Œæ›² Top 10 çš„æ§åˆ¶å™¨</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.topsongs;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.core.ParameterizedTypeReference;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopSongsController</span> {

  <span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/top-songs-prompt.st"</span>)</span>
  Resource topSongPromptTemplate;  #<span class="hljs-number">1</span>

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;

  <span class="hljs-keyword">public</span> TopSongsController(ChatClient.Builder chatClientBuilder) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
  }

  <span class="hljs-meta">@GetMapping(path = <span class="hljs-string">"/topSongs"</span>, produces = <span class="hljs-string">"application/json"</span>)</span>
  <span class="hljs-keyword">public</span> List&lt;String&gt; topSongs(<span class="hljs-meta">@RequestParam(<span class="hljs-string">"year"</span>)</span> String year) {
    <span class="hljs-keyword">return</span> chatClient.prompt()
        .user(userSpec -&gt; userSpec
            .text(topSongPromptTemplate)
            .param(<span class="hljs-string">"year"</span>, year))
        .call()
        .entity(new ParameterizedTypeReference&lt;List&lt;String&gt;&gt;() {});  #<span class="hljs-number">2</span>
  }

}
</code></pre>
<p>ä¸ºç®€å•èµ·è§ï¼Œè¿™é‡Œç›´æ¥åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨ <code>ChatClient</code>ï¼Œè€Œä¸æ˜¯åƒ <code>SpringAiBoardGameService</code> é‚£æ ·æŠ½åˆ°å•ç‹¬çš„æœåŠ¡ç±»ã€‚</p>
<p>æç¤ºæ¨¡æ¿å®šä¹‰åœ¨ <code>src/main/resources/top-songs-prompt.st</code>ï¼Œå¹¶ä½œä¸º <code>Resource</code> æ³¨å…¥æ§åˆ¶å™¨ã€‚æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">What were the top <span class="hljs-number">10</span> songs <span class="hljs-keyword">on</span> the Billboard Hot <span class="hljs-number">100</span> <span class="hljs-keyword">in</span> {<span class="hljs-keyword">year</span>}?

<span class="hljs-keyword">Each</span> item should <span class="hljs-keyword">only</span> include the song title.
</code></pre>
<p>è¯¥æ§åˆ¶å™¨ä¸ä¹‹å‰åœ¨ <code>SpringAiBoardGameService</code> ä¸­è§åˆ°çš„ä»£ç å¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šè°ƒç”¨ <code>entity()</code> æ—¶ä¼ å…¥äº† <code>new ParameterizedTypeReference&lt;List&lt;String&gt;&gt;() {}</code>ã€‚æˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯ <code>List&lt;String&gt;</code>ï¼Œä½†ä¸èƒ½ç›´æ¥æŠŠ <code>List</code> æˆ– <code>List&lt;String&gt;</code> ä¼ ç»™ <code>entity()</code>ã€‚<code>ParameterizedTypeReference</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹å¼•ç”¨ï¼Œèƒ½åœ¨ Java çš„<strong>ç±»å‹æ“¦é™¤</strong>ä¸‹ï¼Œä»æºå¸¦<strong>æ³›å‹å®å‚</strong>ä¼ ç»™æ–¹æ³•ï¼ˆå¦‚ <code>entity()</code>ï¼‰ã€‚</p>
<p>ç”±äºå‘ <code>entity()</code> ä¼ å…¥äº† <code>new ParameterizedTypeReference&lt;List&lt;String&gt;&gt;() {}</code>ï¼Œæç¤ºä¼šè¢«èµ‹äºˆå¦‚ä¸‹çš„<strong>æ ¼å¼åŒ–æŒ‡ä»¤</strong>ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">FORMAT: Your response should be a list of comma separated values</span>
<span class="hljs-section">eg: `foo, bar, baz`</span>
</code></pre>
<p>è¿è¡Œåº”ç”¨åï¼Œå¯ç”¨ HTTPie è¯•è¯•ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/topSongs?year=1981 -b
[
    <span class="hljs-string">"Bette Davis Eyes"</span>,
    <span class="hljs-string">"Endless Love"</span>,
    <span class="hljs-string">"Lady"</span>,
    <span class="hljs-string">"(Just Like) Starting Over"</span>,
    <span class="hljs-string">"Jessie's Girl"</span>,
    <span class="hljs-string">"Celebration"</span>,
    <span class="hljs-string">"Kiss On My List"</span>,
    <span class="hljs-string">"I Love A Rainy Night"</span>,
    <span class="hljs-string">"9 To 5"</span>,
    <span class="hljs-string">"Keep On Loving You"</span>
]
</code></pre>
<p>å¤ªå¥½äº†ï¼å¿«é€Ÿæœä¸€ä¸‹å¯ç¡®è®¤è¿™äº›ç¡®å®æ˜¯ 1981 å¹´çš„å‰åçƒ­å•ã€‚å½“ç„¶ï¼Œ<strong>å‡†ç¡®æ€§</strong>å–å†³äºä½ æ‰€é€‰ LLM çš„è®­ç»ƒè´¨é‡ï¼ˆä¸Šè¿°åˆ—å•ç”± OpenAI çš„ <code>gpt-4o</code> è¿”å›ï¼‰ã€‚ä½†æ›´é‡è¦çš„æ˜¯ï¼Œå¾—ç›Šäº<strong>åˆ—è¡¨è¾“å‡ºè½¬æ¢</strong>ï¼Œå“åº”è¢«æ ¼å¼åŒ–ä¸ºä¸€ä¸ªå€¼åˆ—è¡¨ã€‚</p>
<p>è™½ç„¶æŠŠå“åº”æ ¼å¼åŒ–ä¸º Java å¯¹è±¡æˆ–åˆ—è¡¨å¾ˆæœ‰ç”¨ï¼Œä½†æœ‰æ—¶å€™<strong>çº¯æ–‡æœ¬</strong>å°±å¤Ÿäº†ï¼Œåªæ˜¯ä½ å¸Œæœ›å®ƒåœ¨ç”Ÿæˆæ—¶<strong>é€æ­¥è¿”å›</strong>ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å¦ä¸€ç§ Spring AI èŠå¤©å®¢æˆ·ç«¯ï¼ŒæŠŠç»“æœ<strong>æµå¼</strong>è¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p>
<h3 data-id="heading-12">3.4.3 æµå¼è¿”å›å“åº”ï¼ˆStreaming the responseï¼‰</h3>
<p>å¦‚æœä½ ç”¨è¿‡ OpenAI çš„ ChatGPTã€å¾®è½¯ Copilot ç­‰èŠå¤©å®¢æˆ·ç«¯ï¼Œä½ å°±ä½“éªŒè¿‡â€œèŠå¤©å¼ç•Œé¢â€çš„ LLM äº¤äº’ã€‚ä½ ä¹Ÿä¼šæ³¨æ„åˆ°ï¼šLLM çš„å›ç­”åƒâ€œåœ¨æ‰“å­—â€ä¸€æ ·ï¼Œ<strong>é€æ­¥æµå…¥</strong>å¯¹è¯çª—å£ã€‚</p>
<p>æµå¼å“åº”çš„å…³é”®å¥½å¤„æ˜¯ï¼š<strong>æå‡èŠå¤©åº”ç”¨çš„ç”¨æˆ·ä½“éªŒ</strong>ã€‚ç®€å•å›ç­”å¯èƒ½å¾ˆå¿«è¿”å›ï¼Œä½†å¤æ‚å›ç­”éœ€è¦æ›´é•¿çš„ç”Ÿæˆæ—¶é—´ã€‚å¦‚æœèƒ½åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­<strong>é€æ­¥æ¸²æŸ“</strong>ï¼Œç”¨æˆ·å°±èƒ½ç¡®ä¿¡åº”ç”¨<strong>åœ¨å·¥ä½œ</strong>è€Œéâ€œå¡ä½â€ã€‚</p>
<p>Spring AI åœ¨ä½¿ç”¨ <code>ChatClient</code> æ—¶æ”¯æŒè¿™ç§<strong>æµå¼é£æ ¼</strong>ã€‚ä¸‹é¢çš„æ¸…å•å±•ç¤ºäº†ï¼šåªéœ€å¯¹ <code>askQuestion()</code> åšå°‘é‡ä¿®æ”¹ï¼Œå°±èƒ½ä»¥<strong>æµ</strong>çš„æ–¹å¼å–å›ç»“æœã€‚</p>
<p><strong>æ¸…å• 3.7 æµå¼è¿”å›çš„æ£‹ç›˜æ¸¸æˆæœåŠ¡</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public Flux&lt;String&gt; <span class="hljs-built_in">askQuestion</span>(Question question) {    <span class="hljs-selector-id">#1</span>
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">gameRules</span> = <span class="hljs-selector-tag">gameRulesService</span><span class="hljs-selector-class">.getRulesFor</span>(question.<span class="hljs-built_in">gameTitle</span>());

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
      <span class="hljs-selector-class">.system</span>(systemSpec -&gt; systemSpec
          .<span class="hljs-built_in">text</span>(promptTemplate)
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"gameTitle"</span>, question.<span class="hljs-built_in">gameTitle</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"rules"</span>, gameRules))
      <span class="hljs-selector-class">.user</span>(question.<span class="hljs-built_in">question</span>())
      <span class="hljs-selector-class">.stream</span>()         <span class="hljs-selector-id">#2</span>
      <span class="hljs-selector-class">.content</span>();
}
</code></pre>
<p>ä¸å…ˆå‰ç‰ˆæœ¬ç›¸æ¯”ï¼Œå…³é”®å·®å¼‚åœ¨äºï¼šè¯¥æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯ <code>Flux&lt;String&gt;</code>ï¼Œä¸”ä¸å†è°ƒç”¨ <code>call()</code>ï¼Œè€Œæ˜¯è°ƒç”¨ <code>stream()</code>ã€‚ç­‰ç­‰ï¼Œ<code>Flux</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><code>Flux</code> æ¥è‡ª <strong>Project Reactor</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fprojectreactor.io%2F" target="_blank" title="https://projectreactor.io/" ref="nofollow noopener noreferrer">projectreactor.io/</a>ï¼‰ï¼Œæ˜¯ Spring å“åº”å¼æ ˆçš„åŸºç¡€åº“ã€‚æ›´å¤šå†…å®¹å¯å‚è€ƒã€ŠSpring in Actionã€‹ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.manning.com%2Fbooks%2Fspring-in-action-sixth-edition" target="_blank" title="https://www.manning.com/books/spring-in-action-sixth-edition" ref="nofollow noopener noreferrer">www.manning.com/books/sprinâ€¦</a>ï¼‰ï¼Œä»ç¬¬ 5 ç‰ˆèµ·å…¶ä¸­å°±æœ‰ä¸“ç« è®²è§£ Reactor ä»¥åŠ <code>Flux</code> / <code>Mono</code>ã€‚</p>
<p>æ­¤å¤„åªéœ€ç†è§£ï¼š<code>Flux</code> æ˜¯ä¸€ç§<strong>å“åº”å¼ç±»å‹</strong>ï¼Œä¼šåœ¨æ•°æ®å¯ç”¨æ—¶<strong>æµå¼</strong>åœ°äº§ç”Ÿ 0 åˆ°å¤šæ¡æ•°æ®ã€‚å¯¹ LLM çš„ç”Ÿæˆå“åº”è€Œè¨€ï¼Œ<code>Flux</code> é€šå¸¸ä¼šæŒ‰<strong>è¯ç²’åº¦</strong>ï¼ˆæˆ–çŸ­ç‰‡æ®µï¼‰ä¸æ–­æ¨é€å†…å®¹ã€‚</p>
<p>ä½ è¿˜éœ€è¦ä¿®æ”¹ <code>AskController</code>ï¼Œè®©å®ƒè¿”å›æœåŠ¡æ–¹æ³•è¿”å›çš„ <code>Flux</code>ã€‚å¦‚ä¸‹ï¼š</p>
<p><strong>æ¸…å• 3.8 æµå¼çš„ <code>AskController</code></strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AskController</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BoardGameService boardGameService;

  <span class="hljs-keyword">public</span> AskController(BoardGameService boardGameService) {
    <span class="hljs-keyword">this</span>.boardGameService = boardGameService;
  }

  <span class="hljs-meta">@PostMapping(path=<span class="hljs-string">"/ask"</span>, produces=<span class="hljs-string">"application/json"</span>)</span>
  <span class="hljs-keyword">public</span> Flux&lt;String&gt; ask(<span class="hljs-meta">@RequestBody</span> Question question) {
    <span class="hljs-keyword">return</span> boardGameService.askQuestion(question);
  }

}
</code></pre>
<p><code>ask()</code> æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå°æ”¹åŠ¨ï¼š<code>@PostMapping</code> éœ€å£°æ˜è¿”å›<strong>æµå¼å“åº”</strong>ï¼Œå…¶ <strong>MIME</strong> ä¸€èˆ¬è®¾ä¸º <code>text/event-stream</code>ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼šå¦‚æœä»æ˜¯ <code>application/json</code>ï¼Œç»“æœä¼š<strong>ä¸€æ¬¡æ€§</strong>è¿”å›ï¼Œè€Œä¸æ˜¯æµå¼è¿”å›ã€‚</p>
<p>ä½ å¯ä»¥åƒä¹‹å‰ä¸€æ ·ç”¨ HTTPie è¯•è¯•ã€‚å› ä¸ºæµå¼å“åº”é€šå¸¸å¾ˆå¿«è¿”å›ï¼Œé™¤éç­”æ¡ˆè¾ƒé•¿ï¼Œå¦åˆ™ä½ å¯èƒ½ä¸æ˜æ˜¾åœ°æ„Ÿå—åˆ°â€œæµåŠ¨â€ã€‚æ¯”å¦‚è¯¢é—® Burger Battle çš„<strong>æˆ˜æ–—å¡</strong>åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">$ http :<span class="hljs-number">8080</span>/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
       question=<span class="hljs-string">"What battle cards are there?"</span> -b
       <span class="hljs-keyword">data</span>:

       <span class="hljs-keyword">data</span>:Here

       <span class="hljs-keyword">data</span>: <span class="hljs-keyword">is</span>

       <span class="hljs-keyword">data</span>: a

       <span class="hljs-keyword">data</span>: list

       <span class="hljs-keyword">data</span>: of

       <span class="hljs-keyword">data</span>: the

       <span class="hljs-keyword">data</span>: Battle

       <span class="hljs-keyword">data</span>: Cards
...
</code></pre>
<p>ä¸ºé¿å…ç¯‡å¹…è¿‡é•¿ï¼Œè¿™é‡Œåªå±•ç¤ºå‰å‡ é¡¹ã€‚æ˜¾ç„¶ï¼Œå“åº”æ˜¯<strong>é€è¯</strong>æµå›ï¼Œè€Œéä¸€æ¬¡æ€§è¿”å›ã€‚å°½ç®¡è¾“å‡ºä¸å®¹æ˜“çœ‹å‡ºï¼Œä½†æ¯ä¸ªè¯ä¹‹é—´æœ‰<strong>å°å»¶è¿Ÿ</strong>ï¼Œå°±åƒ LLM æ­£åœ¨â€œæ‰“å­—â€ã€‚</p>
<p><code>text/event-stream</code> çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼šæ¯ä¸ªè¯å‰ä¼šå¸¦ä¸Š <code>data:</code> å‰ç¼€ï¼Œå› æ­¤è°ƒç”¨æ–¹éœ€è¦èƒ½å¤Ÿ<strong>å‰¥ç¦»</strong>è¯¥å‰ç¼€ä»¥å–å‡ºçœŸæ­£çš„è¯ã€‚</p>
<p>ä¸ºäº†é¿å…å¯¹æ¯ä¸ªè¯åšç‰¹æ®Šå¤„ç†ï¼Œå¯ä»¥æŠŠ <code>@PostMapping</code> çš„ <code>produces</code> æ”¹ä¸º <code>application/ndjson</code>ï¼ˆæ¢è¡Œåˆ†éš” JSONï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@PostMapping(<span class="hljs-attr">path</span> = <span class="hljs-string">"/ask"</span>, produces = <span class="hljs-string">"application/ndjson"</span>)
</code></pre>
<p>æ­¤æ—¶ï¼ŒLLM ä»ä¼š<strong>é€è¯</strong>æµå›ï¼Œä½†ä¸å†å¸¦ <code>data:</code> å‰ç¼€ã€‚</p>
<p>å¦‚æœç”¨ HTTPie æµ‹è¯•è¿™ä¸ª MIMEï¼Œæ›´å¯èƒ½ä¼šä»¥ä¸ºâ€œæµå¼åäº†â€ã€‚å› ä¸º HTTPie é‡åˆ° <code>text/event-stream</code> æ—¶ä¼š<strong>é»˜è®¤</strong>æŒ‰æµå¤„ç†ï¼Œä½†å¯¹ <code>application/ndjson</code> å¹¶ä¸ä¼šã€‚è¦å¯ç”¨æµå¼æ˜¾ç¤ºï¼Œéœ€åŠ  <code>--stream</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">$ http :8080/ask <span class="hljs-attr">gameTitle</span>=<span class="hljs-string">"Burger Battle"</span> \
       <span class="hljs-attr">question</span>=<span class="hljs-string">"What battle cards are there?"</span> -b --stream --pretty none <span class="hljs-comment">#1</span>
</code></pre>
<p>è¾“å‡ºï¼ˆæ­¤å¤„ä¸ºèŠ‚é€‰ï¼‰ç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-python" lang="python">In Burger Battle there are several Battle Cards that players can use. Here 
<span class="hljs-keyword">is</span> a <span class="hljs-built_in">list</span> of the standard Battle Cards:

<span class="hljs-number">1.</span> **Burger Bomb**: Blow up another playe<span class="hljs-string">r's Burger by sending their
ingredients to the Graveyard.
2. **Burger Force Field**: Your Burger is now protected from all Battle 
Cards.
3. **Burgerpocalypse**: Obliterate all players'</span> ingredients, including your
own, <span class="hljs-keyword">and</span> toss them <span class="hljs-keyword">in</span> the Graveyard.
<span class="hljs-number">4.</span> **Destroy!**: Destroy <span class="hljs-built_in">any</span> Battle Card of yours <span class="hljs-keyword">or</span> another playe<span class="hljs-string">r's and 
toss it in the Graveyard.
5. **Gonna Eat That?**: Steal another player'</span>s ingredient <span class="hljs-keyword">and</span> add it to your
Burger.
...
</code></pre>
<p>å†æ¬¡å¼ºè°ƒï¼šä¹¦é¡µé™æ€å±•ç¤ºä¸æ˜æ˜¾ï¼Œä½†å®é™…ä½¿ç”¨ HTTPie æ—¶ï¼Œå“åº”æ˜¯<strong>å¸¦å°å»¶è¿Ÿ</strong>åœ°æµå›çš„ã€‚è™½ç„¶åº•å±‚ä»æ˜¯<strong>é€è¯</strong>æµå¼ï¼ŒHTTPie ä¼š<strong>ç¼“å†²</strong>è¿™äº›è¯ï¼Œç›´åˆ°å‡‘æˆä¸€æ•´è¡Œå†æ‰“å°ã€‚</p>
<p>ä½ ä¹Ÿè®¸ä¼šé—®ï¼šèƒ½å¦æŠŠ<strong>æµå¼å“åº”</strong>ä¸å‰é¢ç”¨åˆ°çš„<strong>è¾“å‡ºè½¬æ¢</strong>ç»“åˆèµ·æ¥ï¼Ÿç†è®ºä¸Šï¼Œæµå¼å®¢æˆ·ç«¯å¯ä»¥åƒå¤„ç†çº¯æ–‡æœ¬ä¸€æ ·æµå¼è¿”å›<strong>JSON æ–‡æœ¬</strong>ï¼›ä½†æµå›çš„ JSON ä¼šè¢«<strong>æ‹†æˆè¯æˆ–ç¬¦å·</strong>ï¼Œåœ¨<strong>å®Œæ•´</strong>å“åº”ç»“æŸå‰ï¼Œä½ å¹¶æ²¡æœ‰ä¸€ä¸ª<strong>å®Œå¤‡çš„ JSON æ–‡æ¡£</strong>å¯ä»¥è§£æã€‚</p>
<p>å› æ­¤ï¼Œä½ å¿…é¡»<strong>å…ˆæ”¶é›†</strong>å®Œæ•´çš„æµå¼ JSON å­—ç¬¦ä¸²ï¼Œå†äº¤ç»™è¾“å‡ºè½¬æ¢å»å¤„ç†â€”â€”è¿™ç­‰äº<strong>è¿èƒŒ</strong>äº†ä½¿ç”¨æµå¼çš„åˆè¡·ã€‚ç®€è¨€ä¹‹ï¼Œ<strong>ä¸è¦æ··ç”¨</strong>â€œæµå¼ + è¾“å‡ºè½¬æ¢â€ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œä½ å·²ç»çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring AI å°†æç¤ºæäº¤ç»™ LLM è¿›è¡Œç”Ÿæˆï¼›ä½¿ç”¨<strong>æç¤ºæ¨¡æ¿</strong>å®ç°â€œå¡«ç©ºå¼â€æç¤ºï¼›ç”¨<strong>ä¸Šä¸‹æ–‡å¡«å……</strong>æç¤ºï¼›åˆ©ç”¨<strong>æç¤ºè§’è‰²</strong>ï¼›ä»¥åŠ<strong>å½±å“å“åº”ç”Ÿæˆ</strong>çš„æ–¹å¼ã€‚æ”¶å°¾ä¹‹å‰ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•æ£€æŸ¥æ¨¡å‹å¯èƒ½éšå“åº”ä¸€å¹¶è¿”å›çš„<strong>å“åº”å…ƒæ•°æ®</strong>ã€‚</p>
<h2 data-id="heading-13">3.5 ä½¿ç”¨å“åº”å…ƒæ•°æ®ï¼ˆWorking with response metadataï¼‰</h2>
<p>é™¤äº†æ‹¿åˆ°ç”Ÿæˆç»“æœå¤–ï¼Œ<code>ChatClient</code> è¿˜å¯ä»¥æä¾›ä¸ LLM äº¤äº’çš„ä¸€äº›æœ‰ç”¨<strong>å…ƒæ•°æ®</strong>ã€‚å…¶ä¸­æœ€æœ‰ç”¨çš„æ˜¯<strong>ç”¨é‡ï¼ˆusageï¼‰ç»Ÿè®¡</strong>ã€‚æ¯ä¸ªæç¤ºå’Œæ¯æ®µç”Ÿæˆçš„å“åº”æœ€ç»ˆéƒ½ä¼šè¢«æ‹†åˆ†æˆè‹¥å¹² <strong>token</strong>ã€‚è¿™äº› tokenï¼ˆä»¥åŠå…¶ä»–å› ç´ ï¼‰ä¼šç”¨äºè®¡ç®—ä½ å‘ AI æœåŠ¡æ”¯ä»˜çš„è´¹ç”¨ã€‚å› æ­¤ï¼Œäº†è§£æ¯æ¬¡è¯·æ±‚æ¶ˆè€—äº†å¤šå°‘ tokenï¼Œæœ‰åŠ©äºä½ è¯„ä¼°ä¸ LLM çš„äº¤äº’æˆæœ¬ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨ token ç”¨é‡ä¿¡æ¯å–å†³äºä½ è‡ªå·±ã€‚æœ€åŸºæœ¬çš„åšæ³•æ˜¯æŠŠè¿™äº›ä¿¡æ¯ç®€å•åœ°<strong>å†™å…¥åº”ç”¨æ—¥å¿—</strong>ã€‚åœ¨ç¬¬ 9 ç« ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä½•å€ŸåŠ© Spring AI çš„<strong>å¯è§‚æµ‹æ€§</strong>åŠŸèƒ½ï¼Œå¯¹å¤–æš´éœ² token ç”¨é‡ä¸å…¶ä»–æŒ‡æ ‡ã€‚</p>
<p><strong>æ¸…å• 3.9 è®°å½• token ç”¨é‡åˆ°æ—¥å¿—</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.metadata.ChatResponseMetadata;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.metadata.Usage;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatResponse;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-title">implements</span> <span class="hljs-title">BoardGameService</span> {

  <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> Logger log =
      LoggerFactory.getLogger(SpringAiBoardGameService.<span class="hljs-keyword">class</span>);

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GameRulesService gameRulesService;

  <span class="hljs-keyword">public</span> SpringAiBoardGameService(
      ChatClient.Builder chatClientBuilder,
      GameRulesService gameRulesService) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    <span class="hljs-keyword">this</span>.gameRulesService = gameRulesService;
  }

  <span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/systemPromptTemplate.st"</span>)</span>
  Resource promptTemplate;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Answer askQuestion(Question question) {
    <span class="hljs-keyword">var</span> gameRules = gameRulesService.getRulesFor(question.gameTitle());

    <span class="hljs-keyword">var</span> responseEntity = chatClient.prompt()
        .system(systemSpec -&gt; systemSpec
            .text(promptTemplate)
            .param(<span class="hljs-string">"gameTitle"</span>, question.gameTitle())
            .param(<span class="hljs-string">"rules"</span>, gameRules))
        .user(question.question())
        .call()
        .responseEntity(Answer.<span class="hljs-keyword">class</span>);

    <span class="hljs-keyword">var</span> response = responseEntity.response();

    <span class="hljs-keyword">var</span> metadata = response.getMetadata();
    logUsage(metadata.getUsage());


    <span class="hljs-keyword">return</span> responseEntity.entity();
  }

  <span class="hljs-keyword">private</span> void logUsage(Usage usage) {
    log.info(<span class="hljs-string">"Token usage: prompt={}, generation={}, total={}"</span>,
        usage.getPromptTokens(),
        usage.getCompletionTokens(),
        usage.getTotalTokens());
  }

}
</code></pre>
<p><code>askQuestion()</code> æ–¹æ³•å’Œä¹‹å‰ç›¸æ¯”ç•¥æœ‰ä¸åŒã€‚å…³é”®å·®å¼‚åœ¨äºï¼šå®ƒä¸å†è°ƒç”¨ <code>content()</code> æˆ– <code>entity()</code> è·å–å“åº”ï¼Œè€Œæ˜¯è°ƒç”¨ <code>responseEntity()</code>ã€‚è¯¥æ–¹æ³•ä¸ <code>entity()</code> ç±»ä¼¼ï¼Œä¼šæŠŠå“åº”<strong>ç»‘å®š</strong>ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ <code>Answer</code>ï¼‰ï¼›ä½†ä¸åŒçš„æ˜¯ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª <code>ResponseEntity&lt;ChatResponse, Answer&gt;</code>ï¼Œå…¶ä¸­æ—¢åŒ…å« <code>Answer</code>ï¼Œä¹Ÿæºå¸¦ä¸€ä¸ª <code>ChatResponse</code> å¯¹è±¡ã€‚</p>
<p><code>ChatResponse</code> å¯¹è±¡ä¸­å¯ä»¥æ‰¾åˆ°<strong>å…ƒæ•°æ®</strong>ã€‚è°ƒç”¨ <code>getMetadata()</code> å¯è·å–ç”¨é‡ä¿¡æ¯ï¼Œä»è€Œåœ¨ <code>ask()</code> æ–¹æ³•ï¼ˆæ­¤å¤„ä¸º <code>askQuestion()</code>ï¼‰ä¸­æŠŠå®ƒä¼ ç»™ <code>logUsage()</code> è¿›è¡Œæ—¥å¿—è®°å½•ã€‚éšåï¼Œ<code>askQuestion()</code> è¿”å› <code>ResponseEntity</code> ä¸­æ‰¿è½½çš„ <code>Answer</code>ã€‚</p>
<p>å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œåƒä¹‹å‰ä¸€æ ·å¯åŠ¨åº”ç”¨å¹¶å‘ <code>/ask</code> å‘é€è¯·æ±‚ã€‚ä½ åº”è¯¥ä¼šåœ¨æ—¥å¿—é‡Œçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è®°å½•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Token usage: <span class="hljs-attr">prompt</span>=<span class="hljs-number">1618</span>, generation=<span class="hljs-number">35</span>, total=<span class="hljs-number">1653</span>
</code></pre>
<p>ä¸ºçªå‡ºé‡ç‚¹ï¼Œè¿™é‡Œåªå±•ç¤ºäº†æ—¥å¿—æ¶ˆæ¯æœ¬èº«ã€‚å®é™…çš„ token æ•°ä¼šå› æé—®ä¸å›ç­”è€Œå˜åŒ–ã€‚ä½†å¯ä»¥çœ‹åˆ°ï¼Œæ—¥å¿—ä¸ºä½ æä¾›äº†æœ‰ä»·å€¼çš„æ´å¯Ÿï¼šä½¿ç”¨äº†å¤šå°‘ tokenï¼ˆè¿›è€Œå¯ç”¨äº<strong>ä¼°ç®—è´¹ç”¨</strong>ï¼‰ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼šå¹¶éæ‰€æœ‰ AI æœåŠ¡éƒ½ä¼šè¿”å›ç”¨é‡æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œå‘é€ç»™æœ¬åœ° <strong>Ollama</strong> çš„ LLM æç¤ºä¸ä¼šæä¾›ç”¨é‡æ•°æ®ã€‚<strong>Mistral AI</strong> ä¹Ÿæ˜¯ä¸€ä¸ªä¼¼ä¹ä¸è¿”å›ç”¨é‡æ•°æ®çš„æœåŠ¡ã€‚ä½†ä½ é€šå¸¸å¯ä»¥ä» <strong>OpenAIã€Anthropicã€Google</strong>ï¼ˆä»¥åŠå¯èƒ½çš„å…¶ä»–æœåŠ¡ï¼‰æ‹¿åˆ°ç”¨é‡æ•°æ®ã€‚</p>
<h2 data-id="heading-14"><strong>æ€»ç»“</strong></h2>
<ul>
<li><strong>æç¤ºæ¨¡æ¿</strong>è®©ä½ å¯ä»¥å®šä¹‰å¹¶å¤–éƒ¨åŒ–é€šç”¨æç¤ºï¼Œåœ¨æäº¤ç”Ÿæˆå‰ç”¨å…·ä½“å†…å®¹å¡«å……ã€‚</li>
<li>æ¨¡æ¿ä¹Ÿæ”¯æŒå‘æç¤ºä¸­æä¾›<strong>é¢å¤–ä¸Šä¸‹æ–‡</strong>ï¼Œä»¥ä½¿ç”Ÿæˆæ›´èšç„¦ã€æ›´å‡†ç¡®ã€‚</li>
<li>ä¸Šä¸‹æ–‡å¯åŒ…å«<strong>è¾“å‡ºæ ¼å¼åŒ–æŒ‡ä»¤</strong>ï¼Œä¾‹å¦‚è¦æ±‚ä»¥ JSON è¿”å›ï¼Œä»¥ä¾¿ç»‘å®šåˆ° Java å¯¹è±¡ã€‚</li>
<li><strong>è¾“å‡ºè½¬æ¢</strong>å¯ä»¥æŠŠ LLM çš„ç”Ÿæˆç»“æœè§£æä¸º <strong>Java å¯¹è±¡</strong>æˆ–<strong>åˆ—è¡¨</strong>ã€‚</li>
<li>å“åº”å¯ä»¥<strong>æµå¼</strong>è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ¨¡æ‹Ÿâ€œæ€è€ƒä¸æ‰“å­—â€çš„ä½“éªŒã€‚</li>
<li>ç”Ÿæˆå“åº”ä¸­å¯èƒ½åŒ…å«<strong>æœ‰ç”¨çš„å…ƒæ•°æ®</strong>ï¼Œå¦‚ <strong>token ç”¨é‡</strong> ç­‰æŒ‡æ ‡ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MGPIC åˆèµ›æäº¤å€’è®¡æ—¶ 4 å¤©ï¼]]></title>    <link>https://juejin.cn/post/7570902473433071616</link>    <guid>https://juejin.cn/post/7570902473433071616</guid>    <pubDate>2025-11-10T10:41:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473433071616" data-draft-id="7570793903848718351" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" MGPIC åˆèµ›æäº¤å€’è®¡æ—¶ 4 å¤©ï¼"/> <meta itemprop="keywords" content="åç«¯,ç®—æ³•,ç¼–ç¨‹è¯­è¨€"/> <meta itemprop="datePublished" content="2025-11-10T10:41:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MoonBit"/> <meta itemprop="url" content="https://juejin.cn/user/3609050528885565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             MGPIC åˆèµ›æäº¤å€’è®¡æ—¶ 4 å¤©ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3609050528885565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MoonBit
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:41:52.000Z" title="Mon Nov 10 2025 10:41:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong/></p><p align="center"><strong>è·ç¦»ä½œå“æäº¤æˆªæ­¢</strong></p><p/>
<p><strong/></p><p align="center"><strong>å‰©ä½™4å¤©</strong></p><p/>
<p><strong/></p><p align="center"><strong>æˆªæ­¢æ—¥æœŸï¼š11æœˆ14æ—¥ 18:30</strong></p><p/>
<p>éšç€Â 2025 MoonBitÂ å…¨çƒç¼–ç¨‹åˆ›æ–°æŒ‘æˆ˜èµ›çš„ä¸´è¿‘å°¾å£°ï¼Œæˆ‘ä»¬è§è¯äº†ã€Œç¨‹åºè¯­è¨€è®¾è®¡ä¸å®ç°èµ›é“ã€å’Œã€Œæ¸¸æˆå¼€å‘ä¸è®¾è®¡ã€ä¸¤ä¸ªèµ›é“çš„æ¿€çƒˆç«äº‰ã€‚æˆªè‡³ç›®å‰ï¼Œã€Œç¨‹åºè¯­è¨€è®¾è®¡ä¸å®ç°èµ›é“ã€å·²æœ‰158æ”¯é˜Ÿä¼æŠ¥åã€ã€Œæ¸¸æˆå¼€å‘ä¸è®¾è®¡ã€èµ›é“ä¹Ÿå¸å¼•äº†163æ”¯é˜Ÿä¼çš„æŠ¥åã€‚<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/883cff72e1eb4ac987295ab76fae8380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9vbkJpdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763376112&amp;x-signature=%2B0AjPWAgQ8GIItQfiQ5S2FoKFbM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½œå“æäº¤å…¥å£ï¼š</p>
<ul>
<li>
<p>ç¼–è¯‘èµ›é“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftianchi.aliyun.com%2Fcompetition%2Fentrance%2F532402" target="_blank" title="https://tianchi.aliyun.com/competition/entrance/532402" ref="nofollow noopener noreferrer">tianchi.aliyun.com/competitionâ€¦</a></p>
</li>
<li>
<p>æ¸¸æˆèµ›é“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoonbitlang%2FMoonBit-Code-JAM-2025" target="_blank" title="https://github.com/moonbitlang/MoonBit-Code-JAM-2025" ref="nofollow noopener noreferrer">github.com/moonbitlangâ€¦</a></p>
</li>
</ul>
<p>èµ›ç¨‹å‡çº§ï¼Œå¥–åŠ±å¤šå¤š</p>
<ul>
<li>
<p>ç¼–è¯‘èµ›é“Â å¼€è®¾äº†10åè¡¨ç°ä¼˜å¼‚å¥–ï¼Œå¥–é‡‘ä¸º500å…ƒï¼ˆä¸€ä¸ªé˜Ÿä¼ï¼‰ï¼Œå³é™¤å»å…¥å›´å†³èµ›çš„é˜Ÿä¼å‰6åï¼Œæ’è¡Œæ¦œçš„ç¬¬7-16åé˜Ÿä¼éƒ½æœ‰æœºä¼šè·å¾—æ­¤ç°é‡‘å¥–åŠ±~</p>
<p>P.S.è¿›å…¥æ’è¡Œæ¦œä¸ç­‰äºç›´æ¥å…¥å›´å†³èµ›ï¼Œèµ›äº‹ç»„ä¼šæ ¹æ®è¯„æµ‹æœºå™¨ä»¥åŠä½œå“å®Œæˆåº¦å†³å®šæœ€åå…¥å›´å†³èµ›åå•ï¼æ‰€ä»¥æŠ“ç´§æ—¶é—´ä¼˜åŒ–ä½œå“å®Œæˆåº¦ï¼</p>
</li>
</ul>

<ul>
<li>æ¸¸æˆèµ›é“Â å¼€è®¾æœˆåº¦åŠ¨æ€è¯„æ¯”ä»¥åŠæ›´å¤šç‰¹åˆ«å•å…ƒå¥–ï¼Œç°åœ¨æäº¤æ¯ä¸ªé˜Ÿä¼è¿˜æœ‰æœºä¼šè·å¾—é˜³å…‰æ™®ç…§å¥–ï¼ˆ500å…ƒï¼‰ï¼</li>
</ul>
<p>ç›®å‰ï¼ŒåŒèµ›é“çš„ä½œå“æäº¤å·²è¿›å…¥æœ€åå†²åˆºé˜¶æ®µï¼Œ<strong>æäº¤ä½œå“ç«¯å£å°†äº11æœˆ14æ—¥18:30å…³é—­</strong>ï¼Œå°šæœªæäº¤åˆèµ›ä½œå“çš„é˜Ÿä¼è¯·æŠ“ç´§æ—¶é—´å“¦ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8930919711464598096e7247259c6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9vbkJpdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763376112&amp;x-signature=QZ86CTABch9z0bwUregJQrw7YQI%3D" alt="å›¾ç‰‡" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨é«˜é˜¶å‡½æ•°å®ç°é€’å½’ï¼šä»åŒ¿åå‡½æ•°åˆ°é€šç”¨é€’å½’ç”Ÿæˆå™¨]]></title>    <link>https://juejin.cn/post/7570940025580388392</link>    <guid>https://juejin.cn/post/7570940025580388392</guid>    <pubDate>2025-11-10T10:45:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570940025580388392" data-draft-id="7570793903848652815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨é«˜é˜¶å‡½æ•°å®ç°é€’å½’ï¼šä»åŒ¿åå‡½æ•°åˆ°é€šç”¨é€’å½’ç”Ÿæˆå™¨"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T10:45:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pe7er"/> <meta itemprop="url" content="https://juejin.cn/user/905653310988445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨é«˜é˜¶å‡½æ•°å®ç°é€’å½’ï¼šä»åŒ¿åå‡½æ•°åˆ°é€šç”¨é€’å½’ç”Ÿæˆå™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310988445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pe7er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:45:30.000Z" title="Mon Nov 10 2025 10:45:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>é˜…è¯»æ—¶é—´ï¼šçº¦ 10 åˆ†é’Ÿ</strong><br/>
<strong>é€‚åˆäººç¾¤ï¼š</strong> å…·å¤‡ JavaScript åŸºç¡€ã€æƒ³æ·±å…¥ç†è§£å‡½æ•°å¼ç¼–ç¨‹ä¸é«˜é˜¶å‡½æ•°å®æˆ˜çš„å‰ç«¯å·¥ç¨‹å¸ˆã€‚</p>
<p><strong>æœ¬æ–‡ç›®æ ‡ï¼š</strong></p>
<ul>
<li>äº†è§£å¦‚ä½•åœ¨æ²¡æœ‰å‡½æ•°åçš„æƒ…å†µä¸‹å®ç°é€’å½’</li>
<li>æŒæ¡æ„å»ºé€šç”¨é€’å½’ç”Ÿæˆå™¨çš„æ€è·¯</li>
<li>å­¦ä¼šåœ¨çœŸå®é¡¹ç›®ä¸­ä½¿ç”¨é«˜é˜¶å‡½æ•°é€’å½’å¤„ç†å¤æ‚é€»è¾‘</li>
</ul>
</blockquote>
<hr/>
<p>ä»åŒ¿åé€’å½’å¼€å§‹</p>
<p>å…ˆçœ‹ä¸€æ®µçœ‹ä¼¼éš¾ä»¥ç†è§£çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">(g =&gt; g(g))(f =&gt; n =&gt; n &lt; <span class="hljs-number">2</span> ? <span class="hljs-number">1</span> : n * f(f)(n - <span class="hljs-number">1</span>))(<span class="hljs-number">6</span>);
</code></pre>
<p>æ‰§è¡Œç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs">720
</code></pre>
<p>å³ <code>6!</code>(6 çš„é˜¶ä¹˜ï¼ˆfactorial of 6ï¼‰)ã€‚</p>
<p>åœ¨æ•°å­¦ä¸­ï¼Œ<strong>é˜¶ä¹˜ï¼ˆfactorialï¼‰</strong> æ˜¯æŒ‡ä¸€ä¸ªæ­£æ•´æ•°ä¸å®ƒæ‰€æœ‰æ¯”å®ƒå°çš„æ­£æ•´æ•°çš„ä¹˜ç§¯ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo stretchy="false">!</mo><mo>=</mo><mi>n</mi><mo>Ã—</mo><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>Ã—</mo><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>2</mn><mo stretchy="false">)</mo><mo>Ã—</mo><mo>â‹¯</mo><mo>Ã—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n! = n \times (n - 1) \times (n - 2) \times \cdots \times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">n</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></p>
<p>æ‹†è§£åŸç†ï¼š</p>
<ul>
<li><code>(f =&gt; n =&gt; n &lt; 2 ? 1 : n * f(f)(n - 1))</code>ï¼šå®šä¹‰é˜¶ä¹˜é€»è¾‘ï¼›</li>
<li><code>(g =&gt; g(g))</code>ï¼š<strong>è‡ªåº”ç”¨å‡½æ•°ï¼ˆSelf-Application Functionï¼‰</strong> ï¼›</li>
<li><code>(g =&gt; g(g))(f =&gt; ...)</code>ï¼šå°†å‡½æ•°ä¼ å…¥è‡ªèº«ï¼Œè®©åŒ¿åå‡½æ•°å†…éƒ¨å®ç°é€’å½’ã€‚</li>
</ul>
<p>è¿™ç§æ–¹å¼å®ç°äº†<strong>æ²¡æœ‰åå­—çš„é€’å½’å‡½æ•°</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">æå–ä¸ºå¯å¤ç”¨çš„å‡½æ•°</h2>
<p>ä¸ºäº†å¯è¯»æ€§æ›´é«˜ï¼Œæˆ‘ä»¬æå–ä¸€ä¸ªé€šç”¨çš„å°è£…å‡½æ•°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">fn</span> = (f) =&gt; {
  return (<span class="hljs-attr">g</span> =&gt; g(g))(f)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">fn1</span> = fn(f =&gt; (n, acc = <span class="hljs-number">1</span>) =&gt; n === <span class="hljs-number">0</span> ? acc : f(f)(n - <span class="hljs-number">1</span>, n * acc))<span class="hljs-comment">;</span>
console.log(fn1(6))<span class="hljs-comment">; // 720</span>
</code></pre>
<p><code>fn()</code> å°è£…äº†åŒ¿åé€’å½’ç»“æ„ï¼Œä¼ å…¥çš„å‡½æ•°åªéœ€è¦å…³å¿ƒé€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-1">æ„å»ºé€šç”¨çš„é€’å½’å‡½æ•°ç”Ÿæˆå™¨</h2>
<p>æˆ‘ä»¬è¿›ä¸€æ­¥å°è£…æˆæ›´é€šç”¨çš„å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createRecursiveFunction</span> = (<span class="hljs-params">f</span>) =&gt; {
  <span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> <span class="hljs-title function_">g</span>(g))(<span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">f</span>(<span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">h</span>(h)(...args)));
};
</code></pre>
<p>è§£é‡Šï¼š</p>
<ul>
<li><code>f</code> æ˜¯æ¥æ”¶ <code>self</code> å‚æ•°çš„å‡½æ•°ï¼›</li>
<li><code>self</code> è¡¨ç¤ºé€’å½’è‡ªèº«ï¼›</li>
<li><code>(g =&gt; g(g))</code> è®©å‡½æ•°å¯ä»¥å¼•ç”¨è‡ªèº«ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-2">ä¾‹ 1ï¼šé˜¶ä¹˜ï¼ˆfactorialï¼‰</h2>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">factorialLogic</span> = (self) =&gt; (n, acc = <span class="hljs-number">1</span>) =&gt; {
  return <span class="hljs-attr">n</span> === <span class="hljs-number">0</span> ? acc : self(n - <span class="hljs-number">1</span>, n * acc)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">factorial</span> = createRecursiveFunction(factorialLogic)<span class="hljs-comment">;</span>

console.log(factorial(6))<span class="hljs-comment">; // 720</span>
</code></pre>
<p>è¿™æ˜¯ä¸€ç§å°¾é€’å½’å†™æ³•ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¾‹ 2ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆfibonacciï¼‰</h2>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">fibonacciLogic</span> = (self) =&gt; (n) =&gt; {
  return n &lt;= 1 ? n : self(n - 1) + self(n - 2)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">fibonacci</span> = createRecursiveFunction(fibonacciLogic)<span class="hljs-comment">;</span>

console.log(fibonacci(6))<span class="hljs-comment">; // 8</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">ä¾‹ 3ï¼šçˆ¬æ¥¼æ¢¯é—®é¢˜ï¼ˆclimbStairsï¼‰</h2>
<blockquote>
<p>æ¯æ¬¡å¯ä»¥çˆ¬ 1 æˆ– 2 é˜¶ï¼Œé—®æ€»å…±æœ‰å¤šå°‘ç§çˆ¬æ³•ï¼Ÿ</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">climbStairsLogic</span> = (self) =&gt; n =&gt; {
  return n &lt;= 2 ? n : self(n - 1) + self(n - 2)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">climbStairs</span> = createRecursiveFunction(climbStairsLogic)<span class="hljs-comment">;</span>

console.log(climbStairs(6))<span class="hljs-comment">; // 13</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">ä¾‹ 4ï¼šæ£‹ç›˜éº¦ç²’é—®é¢˜ï¼ˆchessGrainsï¼‰</h2>
<blockquote>
<p>æ£‹ç›˜ç¬¬ä¸€ä¸ªæ ¼å­æ”¾ 1 é¢—éº¦å­ï¼Œæ¯ä¸‹ä¸€ä¸ªæ ¼å­æ˜¯å‰ä¸€ä¸ªçš„ 2 å€ã€‚é—®ç¬¬ 64 ä¸ªæ ¼å­ä¸Šæœ‰å¤šå°‘é¢—ï¼Ÿ</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">chessGrainsLogic</span> = (self) =&gt; (n, acc = <span class="hljs-number">1</span>) =&gt; {
  return <span class="hljs-attr">n</span> === <span class="hljs-number">0</span> ? acc : self(n - <span class="hljs-number">1</span>, acc * <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">chessGrains</span> = createRecursiveFunction(chessGrainsLogic)<span class="hljs-comment">;</span>

console.log(chessGrains(63))<span class="hljs-comment">; // 9223372036854775808</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">å®Œæ•´ä»£ç </h2>
<pre><code class="hljs language-scss" lang="scss">const createRecursiveFunction = (f) =&gt; {
  return (g =&gt; g(g))(h =&gt; f((...args) =&gt; <span class="hljs-built_in">h</span>(h)(...args)));
};

<span class="hljs-comment">// é˜¶ä¹˜</span>
const factorialLogic = (self) =&gt; (n, acc = <span class="hljs-number">1</span>) =&gt;
  n === <span class="hljs-number">0</span> ? acc : <span class="hljs-built_in">self</span>(n - <span class="hljs-number">1</span>, n * acc);
const factorial = <span class="hljs-built_in">createRecursiveFunction</span>(factorialLogic);
console<span class="hljs-selector-class">.log</span>('factorial(<span class="hljs-number">6</span>) =', <span class="hljs-built_in">factorial</span>(<span class="hljs-number">6</span>));

<span class="hljs-comment">// æ–æ³¢é‚£å¥‘</span>
const fibonacciLogic = (self) =&gt; (n) =&gt;
  n &lt;= <span class="hljs-number">1</span> ? n : <span class="hljs-built_in">self</span>(n - <span class="hljs-number">1</span>) + <span class="hljs-built_in">self</span>(n - <span class="hljs-number">2</span>);
const fibonacci = <span class="hljs-built_in">createRecursiveFunction</span>(fibonacciLogic);
console<span class="hljs-selector-class">.log</span>('fibonacci(<span class="hljs-number">6</span>) =', <span class="hljs-built_in">fibonacci</span>(<span class="hljs-number">6</span>));

<span class="hljs-comment">// çˆ¬æ¥¼æ¢¯</span>
const climbStairsLogic = (self) =&gt; n =&gt;
  n &lt;= <span class="hljs-number">2</span> ? n : <span class="hljs-built_in">self</span>(n - <span class="hljs-number">1</span>) + <span class="hljs-built_in">self</span>(n - <span class="hljs-number">2</span>);
const climbStairs = <span class="hljs-built_in">createRecursiveFunction</span>(climbStairsLogic);
console<span class="hljs-selector-class">.log</span>('climbStairs(<span class="hljs-number">6</span>) =', <span class="hljs-built_in">climbStairs</span>(<span class="hljs-number">6</span>));

<span class="hljs-comment">// æ£‹ç›˜éº¦ç²’</span>
const chessGrainsLogic = (self) =&gt; (n, acc = <span class="hljs-number">1</span>) =&gt;
  n === <span class="hljs-number">0</span> ? acc : <span class="hljs-built_in">self</span>(n - <span class="hljs-number">1</span>, acc * <span class="hljs-number">2</span>);
const chessGrains = <span class="hljs-built_in">createRecursiveFunction</span>(chessGrainsLogic);
console<span class="hljs-selector-class">.log</span>('chessGrains(<span class="hljs-number">63</span>) =', <span class="hljs-built_in">chessGrains</span>(<span class="hljs-number">63</span>));
</code></pre>
<hr/>
<h2 data-id="heading-7">æ€»ç»“ï¼šé«˜é˜¶å‡½æ•°çš„åŠ›é‡</h2>

























<table><thead><tr><th>æ¦‚å¿µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>é«˜é˜¶å‡½æ•°</td><td>æ¥æ”¶æˆ–è¿”å›å‡½æ•°çš„å‡½æ•°</td></tr><tr><td>åŒ¿åé€’å½’</td><td>æ— éœ€å‡½æ•°åå³å¯é€’å½’</td></tr><tr><td>è‡ªåº”ç”¨å‡½æ•° <code>(g =&gt; g(g))</code></td><td>å®ç°åŒ¿åè‡ªå¼•ç”¨çš„å…³é”®</td></tr><tr><td>é€šç”¨é€’å½’ç”Ÿæˆå™¨</td><td>å¯åŠ¨æ€ç”Ÿæˆä»»æ„é€’å½’é€»è¾‘</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">æ€è€ƒç»ƒä¹ </h2>
<p>å°è¯•ä½¿ç”¨ <code>createRecursiveFunction</code> å®ç°ä»¥ä¸‹å‡½æ•°ï¼š</p>
<ol>
<li>éå°¾é€’å½’ç‰ˆé˜¶ä¹˜</li>
<li>æ±‚æ•°ç»„å’Œ</li>
<li>äºŒåˆ†æŸ¥æ‰¾</li>
</ol>
<p>å¥½çš„ï¼Œæˆ‘å¸®ä½ æŠŠè¿™ä¸€èŠ‚æ•´ç†æˆ <strong>æ˜é‡‘æ–‡ç« çš„æ–°ä¸€ç« </strong>ï¼Œä¿æŒå’Œå‰æ–‡ä¸€è‡´çš„ Markdown é£æ ¼ï¼Œæ ‡é¢˜ã€ä»£ç ã€è¯´æ˜éƒ½å®Œæ•´ï¼Œæ–¹ä¾¿ç›´æ¥å‘å¸ƒã€‚</p>
<hr/>
<h2 data-id="heading-9">åã€é€’å½’ç»ƒä¹ ä¸æ€ç»´æ‰©å±•</h2>
<p>åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ç”¨é«˜é˜¶å‡½æ•°å’Œé€šç”¨é€’å½’ç”Ÿæˆå™¨ <code>createRecursiveFunction</code> æ„å»ºå„ç§é€’å½’å‡½æ•°ã€‚<br/>
ä¸ºäº†åŠ æ·±ç†è§£ï¼Œå¯ä»¥å°è¯•ä¸€äº›ç»ƒä¹ é¢˜ï¼Œå®è·µä¸åŒç±»å‹çš„é€’å½’é€»è¾‘ã€‚</p>
<p>æœ¬ç« ç»™å‡ºä¸‰ä¸ªç¤ºä¾‹ï¼š</p>
<ol>
<li>éå°¾é€’å½’ç‰ˆé˜¶ä¹˜</li>
<li>æ±‚æ•°ç»„å’Œ</li>
<li>äºŒåˆ†æŸ¥æ‰¾</li>
</ol>
<hr/>
<h3 data-id="heading-10">1. éå°¾é€’å½’ç‰ˆé˜¶ä¹˜</h3>
<p>éå°¾é€’å½’çš„ç‰¹ç‚¹æ˜¯<strong>é€’å½’è°ƒç”¨ä¸æ˜¯æœ€åä¸€æ­¥</strong>ï¼Œè¿”å›å€¼è¿˜è¦å‚ä¸è®¡ç®—ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">factorialLogic</span> = (self) =&gt; (n) =&gt; {
  if (<span class="hljs-attr">n</span> === <span class="hljs-number">0</span>) return <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  return n * self(n - 1)<span class="hljs-comment">; // éå°¾é€’å½’</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">factorial</span> = createRecursiveFunction(factorialLogic)<span class="hljs-comment">;</span>

console.log(factorial(6))<span class="hljs-comment">; // è¾“å‡º 720</span>
</code></pre>
<blockquote>
<p>è§£æï¼š</p>
<ul>
<li>æ¯æ¬¡é€’å½’è¿”å›ä¸€ä¸ªå€¼å‚ä¸ä¹˜æ³•è®¡ç®—ï¼›</li>
<li>è°ƒç”¨æ ˆä¼šéšç€ <code>n</code> å¢å¤§è€Œå¢åŠ ã€‚</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-11">2. æ±‚æ•°ç»„å’Œ</h3>
<p>åˆ©ç”¨é€’å½’æ±‚æ•°ç»„æ‰€æœ‰å…ƒç´ çš„å’Œã€‚</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">sumArrayLogic</span> = (self) =&gt; (arr) =&gt; {
  if (<span class="hljs-attr">arr.length</span> === <span class="hljs-number">0</span>) return <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  const <span class="hljs-section">[head, ...tail]</span> = arr<span class="hljs-comment">;</span>
  return head + self(tail)<span class="hljs-comment">; // éå°¾é€’å½’</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">sumArray</span> = createRecursiveFunction(sumArrayLogic)<span class="hljs-comment">;</span>

console.log(sumArray(<span class="hljs-section">[1, 2, 3, 4, 5]</span>))<span class="hljs-comment">; // è¾“å‡º 15</span>
</code></pre>
<blockquote>
<p>è§£æï¼š</p>
<ul>
<li>æ¯æ¬¡å–æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´  <code>head</code>ï¼Œé€’å½’è®¡ç®—å‰©ä½™å…ƒç´  <code>tail</code> çš„å’Œï¼›</li>
<li>é€’å½’è°ƒç”¨è¿”å›å€¼ä¸ <code>head</code> ç›¸åŠ å¾—åˆ°æœ€ç»ˆç»“æœã€‚</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-12">3. äºŒåˆ†æŸ¥æ‰¾</h3>
<p>åœ¨æœ‰åºæ•°ç»„ä¸­é«˜æ•ˆæŸ¥æ‰¾ç›®æ ‡å…ƒç´ ç´¢å¼•ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">binarySearchLogic</span> = (self) =&gt; (arr, target, left = <span class="hljs-number">0</span>, right = arr.length - <span class="hljs-number">1</span>) =&gt; {
  if (left &gt; right) return -1<span class="hljs-comment">; // æœªæ‰¾åˆ°</span>

  const <span class="hljs-attr">mid</span> = Math.floor((left + right) / <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">value</span> = arr[mid]<span class="hljs-comment">;</span>

  if (<span class="hljs-attr">value</span> === target) return mid<span class="hljs-comment">;</span>
  if (value &gt; target) return self(arr, target, left, mid - 1)<span class="hljs-comment">;</span>
  return self(arr, target, mid + 1, right)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">binarySearch</span> = createRecursiveFunction(binarySearchLogic)<span class="hljs-comment">;</span>

const <span class="hljs-attr">arr</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">13</span>]<span class="hljs-comment">;</span>
console.log(binarySearch(arr, 7))<span class="hljs-comment">;  // è¾“å‡º 3</span>
console.log(binarySearch(arr, 4))<span class="hljs-comment">;  // è¾“å‡º -1</span>
</code></pre>
<blockquote>
<p>è§£æï¼š</p>
<ul>
<li>æ¯æ¬¡é€’å½’ç¼©å°æŸ¥æ‰¾èŒƒå›´ï¼›</li>
<li>é€’å½’ç»“æŸæ¡ä»¶æ˜¯ <code>left &gt; right</code>ï¼›</li>
<li>è¿”å›ç›®æ ‡å…ƒç´ ç´¢å¼•æˆ– -1ã€‚</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-13">ç‰¹å¾</h3>

























<table><thead><tr><th>å‡½æ•°</th><th>ç±»å‹</th><th>é€’å½’ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>é˜¶ä¹˜</td><td>éå°¾é€’å½’</td><td>è°ƒç”¨åè¿˜æœ‰ä¹˜æ³•æ“ä½œ</td></tr><tr><td>æ•°ç»„æ±‚å’Œ</td><td>éå°¾é€’å½’</td><td>æ¯æ¬¡å–å¤´é€’å°¾</td></tr><tr><td>äºŒåˆ†æŸ¥æ‰¾</td><td>éå°¾é€’å½’</td><td>åˆ†æ²»æ€æƒ³ï¼Œé€’å½’ç¼©å°èŒƒå›´</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-14">æ ¸å¿ƒæ€è·¯</h3>
<ul>
<li>åªéœ€æä¾›é€’å½’é€»è¾‘ï¼Œ<code>createRecursiveFunction</code> è´Ÿè´£è‡ªå¼•ç”¨ï¼›</li>
<li>é€’å½’é€»è¾‘æ¨¡æ¿ç»Ÿä¸€ï¼š</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">logic</span> = (<span class="hljs-params">self</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
  <span class="hljs-comment">// ...é€’å½’é€»è¾‘</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">self</span>(...args); <span class="hljs-comment">// è°ƒç”¨è‡ªèº«</span>
};
<span class="hljs-keyword">const</span> fn = <span class="hljs-title function_">createRecursiveFunction</span>(logic);
</code></pre>
<p>é€šè¿‡ç»ƒä¹ ï¼Œå¯ä»¥æ›´å¥½ç†è§£<strong>é«˜é˜¶å‡½æ•° + é€’å½’</strong>çš„ç»„åˆæ€ç»´ï¼Œå¹¶èƒ½åº”ç”¨äºå®é™…é¡¹ç›®ä¸­çš„æ ‘ç»“æ„ã€å¼‚æ­¥ä»»åŠ¡ç­‰åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-15">é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨åœºæ™¯</h2>
<p>åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œé«˜é˜¶å‡½æ•°é€’å½’èƒ½è®©ä»£ç æ›´çµæ´»ã€æ›´æ¨¡å—åŒ–ã€‚<br/>
å¸¸è§çš„å®æˆ˜åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ ‘ç»“æ„éå†ï¼ˆèœå•ã€è¯„è®ºã€æƒé™ç­‰ï¼‰</li>
<li>å¼‚æ­¥é‡è¯•æœºåˆ¶ï¼ˆAPI è°ƒç”¨å¤±è´¥é‡è¯•ï¼‰</li>
<li>åŠ¨æ€è½®è¯¢ï¼ˆç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-16">éå†æ ‘å½¢èœå•</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">createRecursiveFunction</span> = (f) =&gt; {
  return (<span class="hljs-attr">g</span> =&gt; g(g))(h =&gt; f((...args) =&gt; h(h)(...args)))<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// æ‰å¹³åŒ–æ ‘
const <span class="hljs-attr">flattenTreeLogic</span> = (self) =&gt; (nodes, result = []) =&gt; {
  for (const node of nodes) {
    result.push({ id: node.id, name: node.name })<span class="hljs-comment">;</span>
    if (node.children?.length) self(node.children, result)<span class="hljs-comment">;</span>
  }
  return result<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">flattenTree</span> = createRecursiveFunction(flattenTreeLogic)<span class="hljs-comment">;</span>

const <span class="hljs-attr">menu</span> = [
  { id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'é¦–é¡µ'</span> },
  {
    id: <span class="hljs-number">2</span>,
    name: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span>,
    children: [
      { id: <span class="hljs-number">3</span>, name: <span class="hljs-string">'ç”¨æˆ·åˆ—è¡¨'</span> },
      { id: <span class="hljs-number">4</span>, name: <span class="hljs-string">'ç”¨æˆ·è¯¦æƒ…'</span> },
    ],
  },
]<span class="hljs-comment">;</span>

console.log(flattenTree(menu))<span class="hljs-comment">;</span>
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">[
  { <span class="hljs-built_in">id</span>: 1, name: <span class="hljs-string">'é¦–é¡µ'</span> },
  { <span class="hljs-built_in">id</span>: 2, name: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span> },
  { <span class="hljs-built_in">id</span>: 3, name: <span class="hljs-string">'ç”¨æˆ·åˆ—è¡¨'</span> },
  { <span class="hljs-built_in">id</span>: 4, name: <span class="hljs-string">'ç”¨æˆ·è¯¦æƒ…'</span> }
]
</code></pre>
<hr/>
<h3 data-id="heading-17">å¼‚æ­¥é‡è¯•æœºåˆ¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createRecursiveFunction</span> = (<span class="hljs-params">f</span>) =&gt; {
  <span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> <span class="hljs-title function_">g</span>(g))(<span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">f</span>(<span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">h</span>(h)(...args)));
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">retryLogic</span> = (<span class="hljs-params">self</span>) =&gt; <span class="hljs-keyword">async</span> (fn, retries = <span class="hljs-number">3</span>, delay = <span class="hljs-number">1000</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>();
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (retries &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> err;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`é‡è¯•ä¸­ï¼Œè¿˜å‰© <span class="hljs-subst">${retries}</span> æ¬¡...`</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r, delay));
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">self</span>(fn, retries - <span class="hljs-number">1</span>, delay);
  }
};

<span class="hljs-keyword">const</span> retry = <span class="hljs-title function_">createRecursiveFunction</span>(retryLogic);

<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">unstableApi</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  count++;
  <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'å¤±è´¥'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">'æˆåŠŸ'</span>;
};

<span class="hljs-title function_">retry</span>(unstableApi, <span class="hljs-number">5</span>, <span class="hljs-number">500</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»“æœï¼š'</span>, res))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æœ€ç»ˆå¤±è´¥:'</span>, err.<span class="hljs-property">message</span>));
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">é‡è¯•ä¸­ï¼Œè¿˜å‰© <span class="hljs-number">5</span> æ¬¡...
é‡è¯•ä¸­ï¼Œè¿˜å‰© <span class="hljs-number">4</span> æ¬¡...
ç»“æœï¼š æˆåŠŸ
</code></pre>
<hr/>
<h3 data-id="heading-18">åŠ¨æ€è½®è¯¢ä»»åŠ¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createRecursiveFunction</span> = (<span class="hljs-params">f</span>) =&gt; {
  <span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> <span class="hljs-title function_">g</span>(g))(<span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">f</span>(<span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">h</span>(h)(...args)));
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">pollingLogic</span> = (<span class="hljs-params">self</span>) =&gt; <span class="hljs-keyword">async</span> (checkFn, interval = <span class="hljs-number">1000</span>, maxTries = <span class="hljs-number">10</span>) =&gt; {
  <span class="hljs-keyword">const</span> done = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkFn</span>();
  <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (maxTries &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœªå®Œæˆï¼Œ<span class="hljs-subst">${interval}</span>ms åå†æ¬¡æ£€æŸ¥...`</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r, interval));
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">self</span>(checkFn, interval, maxTries - <span class="hljs-number">1</span>);
};

<span class="hljs-keyword">const</span> polling = <span class="hljs-title function_">createRecursiveFunction</span>(pollingLogic);

<span class="hljs-keyword">let</span> progress = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkTask</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  progress += <span class="hljs-number">30</span>;
  <span class="hljs-keyword">return</span> progress &gt;= <span class="hljs-number">100</span>;
};

<span class="hljs-title function_">polling</span>(checkTask, <span class="hljs-number">1000</span>, <span class="hljs-number">5</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(done ? <span class="hljs-string">'ä»»åŠ¡å®Œæˆï¼'</span> : <span class="hljs-string">'è¶…æ—¶æœªå®Œæˆ'</span>);
});
</code></pre>
<hr/>
<h2 data-id="heading-19">ä»æŠ½è±¡åˆ°å®ç”¨</h2>





















<table><thead><tr><th>åœºæ™¯</th><th>åº”ç”¨ä¼˜åŠ¿</th></tr></thead><tbody><tr><td>æ ‘ç»“æ„å¤„ç†</td><td>çµæ´»å®šä¹‰é€»è¾‘ï¼Œä¾¿äºå¤ç”¨</td></tr><tr><td>å¼‚æ­¥é‡è¯•</td><td>è‡ªåŠ¨åŒ–é”™è¯¯æ¢å¤</td></tr><tr><td>åŠ¨æ€è½®è¯¢</td><td>å¯é…ç½®ã€å¯æ‰©å±•</td></tr></tbody></table>
<p>é«˜é˜¶å‡½æ•°é€’å½’ä¸ä»…æ˜¯ç†è®ºæŠ€å·§ï¼Œæ›´æ˜¯å‡½æ•°å¼æ€ç»´åœ¨å·¥ç¨‹åŒ–ä¸­çš„ä½“ç°ã€‚<br/>
å½“é€»è¾‘å¤æ‚ã€å˜åŒ–é¢‘ç¹æ—¶ï¼Œç”¨å‡½æ•°ç»„åˆå–ä»£å‘½åå‡½æ•°ï¼Œå¯ä»¥æå¤§æå‡çµæ´»æ€§ã€‚</p>
<hr/>
<h2 data-id="heading-20">ç»“è¯­</h2>
<p>æœ¬æ–‡ä»åŒ¿åé€’å½’å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ„å»ºäº†ä¸€ä¸ªé€šç”¨çš„é€’å½’ç”Ÿæˆå™¨ï¼Œå¹¶ç»“åˆé¡¹ç›®å®æˆ˜å±•ç¤ºäº†é«˜é˜¶å‡½æ•°é€’å½’çš„å®ç”¨ä»·å€¼ã€‚</p>
<p>è¿™ç±»æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<br/>
<strong>å°†é€’å½’ç»“æ„ä¸é€»è¾‘è§£è€¦ï¼Œè®©å‡½æ•°æ›´é€šç”¨ã€æ›´å¯ç»„åˆã€‚</strong></p>
<p>å¦‚æœä½ è§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—æˆ–åˆ†äº«ï¼Œè®©æ›´å¤šäººäº†è§£é«˜é˜¶å‡½æ•°çš„å®é™…åº”ç”¨ã€‚<br/>
ä½ çš„ç‚¹èµï¼Œå°±æ˜¯æˆ‘ç»§ç»­å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIä¹Ÿèƒ½åƒäººä¸€æ ·æ‹¥æœ‰é•¿æ—¶è®°å¿†äº†ï¼è°·æ­Œæœ€æ–°ç ”ç©¶æ”»å…‹AIæ ¸å¿ƒéš¾é¢˜]]></title>    <link>https://juejin.cn/post/7570885801478111273</link>    <guid>https://juejin.cn/post/7570885801478111273</guid>    <pubDate>2025-11-10T10:44:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570885801478111273" data-draft-id="7570899512782078015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIä¹Ÿèƒ½åƒäººä¸€æ ·æ‹¥æœ‰é•¿æ—¶è®°å¿†äº†ï¼è°·æ­Œæœ€æ–°ç ”ç©¶æ”»å…‹AIæ ¸å¿ƒéš¾é¢˜"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,èµ„è®¯,æœºå™¨å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-11-10T10:44:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç®—å®¶è®¡ç®—"/> <meta itemprop="url" content="https://juejin.cn/user/1426490793396571"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIä¹Ÿèƒ½åƒäººä¸€æ ·æ‹¥æœ‰é•¿æ—¶è®°å¿†äº†ï¼è°·æ­Œæœ€æ–°ç ”ç©¶æ”»å…‹AIæ ¸å¿ƒéš¾é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1426490793396571/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç®—å®¶è®¡ç®—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:44:38.000Z" title="Mon Nov 10 2025 10:44:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è°·æ­Œçš„æ–°ç ”ç©¶ï¼Œè®©AIä¹Ÿèƒ½åƒäººç±»ä¸€æ ·æŒç»­å­¦ä¹ è€Œä¸é—å¿˜äº†ã€‚</p>
</blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å­¦ä¼šä¸€é¡¹æ–°æŠ€èƒ½åï¼Œå¹¶ä¸ä¼šå¿˜è®°å¦‚ä½•èµ°è·¯ã€è¯´è¯è¿™äº›åŸºæœ¬èƒ½åŠ›ã€‚ç„¶è€Œï¼Œè¿™æ­£æ˜¯äººå·¥æ™ºèƒ½é•¿æœŸé¢ä¸´çš„å›°å¢ƒã€‚å½“AIå­¦ä¹ æ–°çŸ¥è¯†æ—¶ï¼Œå¾€å¾€ä¼šåƒè¦†ç›–æ—§ç£å¸¦ä¸€æ ·ï¼Œ<strong>æŸå®³ç”šè‡³å®Œå…¨æŠ¹å»å·²ç»æŒæ¡çš„æ—§æŠ€èƒ½</strong>ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¸º <strong>â€œç¾éš¾æ€§é—å¿˜â€ã€‚</strong></p>
<p>ç°åœ¨ï¼Œè°·æ­Œç ”ç©¶é™¢å¸¦æ¥äº†ä¸€é¡¹çªç ´æ€§è§£å†³æ–¹æ¡ˆã€‚11æœˆ7æ—¥ï¼Œè°·æ­Œæ­£å¼å‘å¸ƒäº†å…¨æ–°çš„æœºå™¨å­¦ä¹ èŒƒå¼â€”â€”<strong>åµŒå¥—å­¦ä¹ ï¼ˆNested Learningï¼‰</strong> ï¼Œç›´æŒ‡è¿™ä¸ªå›°æ‰°AIé¢†åŸŸæ•°åå¹´çš„æ ¹æœ¬æ€§éš¾é¢˜ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2ada2ecf61d469b9df440ef6799f730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763376278&amp;x-signature=P63QdnOIfCp%2BduDQl0j6o5sGe0w%3D" alt="å›¾è¡¨æ¯”è¾ƒäº†ç”Ÿç‰©è„‘ç”µæ³¢å’Œç¥ç»å¯å¡‘æ€§ä¸åµŒå¥—å­¦ä¹ æ¨¡å‹ä¸­ä½¿ç”¨çš„å‡åŒ€ç»“æ„å’Œå¤šé¢‘æ›´æ–°ã€‚" loading="lazy"/></p>
<p>ç¾éš¾æ€§é—å¿˜å¹¶éæ–°é—®é¢˜ã€‚åœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ ä¸­ï¼Œæ¨¡å‹åœ¨å›ºå®šæ•°æ®é›†ä¸Šå®Œæˆè®­ç»ƒåä¾¿è¿›å…¥éƒ¨ç½²é˜¶æ®µã€‚ä¸€æ—¦éœ€è¦å­¦ä¹ æ–°ä»»åŠ¡ï¼Œæ¨¡å‹å¾€å¾€éœ€è¦é‡æ–°è®­ç»ƒæˆ–å¾®è°ƒï¼Œè€Œè¿™ææ˜“å¯¼è‡´æ—§çŸ¥è¯†è¢«è¦†ç›–ã€‚</p>
<p>è¿™å°±å¥½æ¯”ä¸€ä¸ªåŸæœ¬ç²¾é€šå›¾åƒåˆ†ç±»çš„AIç³»ç»Ÿï¼Œåœ¨å­¦ä¹ ç›®æ ‡æ£€æµ‹åå¯èƒ½å®Œå…¨ä¸§å¤±åŸæœ‰çš„è¯†åˆ«èƒ½åŠ›ï¼›æˆ–è€…ä¸€ä¸ªè¯­éŸ³åŠ©æ‰‹åœ¨å‡çº§æ–¹è¨€ç†è§£åŠŸèƒ½åï¼Œåè€Œå¿˜è®°äº†æ ‡å‡†æ™®é€šè¯çš„å¤„ç†é€»è¾‘ã€‚</p>
<p>ç ”ç©¶è¡¨æ˜ï¼Œåœ¨è¿ç»­å­¦ä¹ è¶…è¿‡äº”ä¸ªä»»åŠ¡åï¼Œä¼ ç»Ÿæ¨¡å‹çš„å¹³å‡æ€§èƒ½ä¸‹é™å¹…åº¦é«˜è¾¾<strong>60%ä»¥ä¸Š</strong>ã€‚è¿™ç§å±€é™æ€§ä¸¥é‡é˜»ç¢äº†AIåœ¨éœ€è¦é•¿æœŸç»éªŒç§¯ç´¯çš„é¢†åŸŸåº”ç”¨ï¼Œå¦‚åŒ»ç–—è¯Šæ–­ã€è‡ªåŠ¨é©¾é©¶ç­‰ã€‚</p>
<p><strong>åµŒå¥—å­¦ä¹ ï¼šç»Ÿä¸€æ¶æ„ä¸ç®—æ³•çš„å…¨æ–°èŒƒå¼</strong></p>
<p>è°·æ­Œæå‡ºçš„åµŒå¥—å­¦ä¹ èŒƒå¼å¸¦æ¥äº†æ ¹æœ¬æ€§çš„å˜é©ã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯å°†æ¨¡å‹æ¶æ„ä¸ä¼˜åŒ–ç®—æ³•ç»Ÿä¸€èµ·æ¥ï¼Œå°†å¤æ‚æ¨¡å‹è§†ä¸ºä¸€ç³»åˆ—ç›¸äº’åµŒå¥—æˆ–å¹¶è¡Œçš„ä¼˜åŒ–é—®é¢˜ã€‚</p>
<p>åœ¨åµŒå¥—å­¦ä¹ æ¡†æ¶ä¸‹ï¼Œæ¨¡å‹ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„â€œä¸Šä¸‹æ–‡æµâ€å’Œæ›´æ–°é€Ÿç‡ã€‚è¿™å°±åƒäººè„‘çš„å­¦ä¹ æœºåˆ¶â€”â€”æˆ‘ä»¬å¯¹çœ¼å‰äº‹ç‰©çš„ç¬æ—¶è®°å¿†æ›´æ–°æå¿«ï¼Œä¸ºè€ƒè¯•è€Œè¿›è¡Œçš„çŸ­æœŸè®°å¿†æ›´æ–°é€Ÿåº¦æ¬¡ä¹‹ï¼Œè€Œæ„æˆä¸–ç•Œè§‚ã€ä»·å€¼è§‚çš„é•¿æœŸçŸ¥è¯†åˆ™æ›´æ–°å¾—éå¸¸ç¼“æ…¢ã€‚</p>
<p>è°·æ­Œç ”ç©¶å›¢é˜ŸåŸºäºè¿™ä¸€èŒƒå¼å¼€å‘äº†åä¸ºHopeçš„æ¦‚å¿µéªŒè¯æ¨¡å‹ï¼Œå®ƒåŸºäºTitansæ¶æ„çš„è‡ªä¿®æ”¹å¾ªç¯ç½‘ç»œï¼Œæ·±åº¦é›†æˆäº†è¿ç»­ä½“å†…å­˜ç³»ç»Ÿï¼ˆCMSï¼‰ã€‚è¿™ç§è®¾è®¡ä½¿æ¨¡å‹èƒ½å¤Ÿé€šè¿‡è‡ªæˆ‘å‚ç…§æœºåˆ¶ä¼˜åŒ–è‡ªèº«å†…å­˜ç»“æ„ï¼Œæ”¯æŒè¿‘ä¹æ— é™å±‚çº§çš„ä¸Šä¸‹æ–‡å­¦ä¹ ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f41d1ff4fbbe4408a6f7d2ae57e1c700~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763376278&amp;x-signature=RYIj2arIptxlQWMCdzYlVVDQado%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æŠ€æœ¯çªç ´ï¼šä»æ·±åº¦ä¼˜åŒ–å™¨åˆ°è¿ç»­å†…å­˜ç³»ç»Ÿ</strong></p>
<p>åµŒå¥—å­¦ä¹ èŒƒå¼çš„åˆ›æ–°ä½“ç°åœ¨ä¸‰ä¸ªå…³é”®æŠ€æœ¯çªç ´ä¸Šã€‚</p>
<p>é¦–å…ˆï¼Œæ·±åº¦ä¼˜åŒ–å™¨å°†ä¼˜åŒ–å™¨æœ¬èº«ä½œä¸ºå¯å­¦ä¹ æ¨¡å—ï¼Œæ”¹è¿›äº†ç›®æ ‡å‡½æ•°ï¼Œæå‡äº†å¯¹ä¸å®Œç¾æ•°æ®çš„é²æ£’æ€§ã€‚ä¼ ç»Ÿä¼˜åŒ–å™¨å¦‚Adamä¸­çš„åŠ¨é‡é¡¹ï¼Œåœ¨åµŒå¥—å­¦ä¹ è§†è§’ä¸‹å¯è¢«çœ‹ä½œæ˜¯å¾®å‹çš„å…³è”è®°å¿†æ¨¡å—ã€‚</p>
<p>åŒæ—¶ï¼Œè¿ç»­ä½“å†…å­˜ç³»ç»Ÿï¼ˆCMSï¼‰æ„å»ºäº†ç”±ä¸åŒæ›´æ–°é¢‘ç‡æ¨¡å—ç»„æˆçš„å†…å­˜å…‰è°±ï¼Œå®ç°äº†ä»çŸ­æœŸåˆ°é•¿æœŸè®°å¿†çš„å¹³æ»‘è¿‡æ¸¡ã€‚CMSç”±ä¸€ç³»åˆ—ç¥ç»ç½‘ç»œå—è¿æ¥è€Œæˆï¼Œæ¯ä¸ªå—å…³è”ç€ç‰¹å®šçš„æ›´æ–°é¢‘ç‡ï¼Œå½»åº•æ”¹å˜äº†ä¼ ç»ŸAIæ¨¡å‹ä¸­çŸ­æœŸè®°å¿†å’Œé•¿æœŸè®°å¿†çš„äºŒå…ƒåˆ’åˆ†ã€‚</p>
<p>è‡ªä¿®æ”¹æ¶æ„åˆ™ä½¿æ¨¡å‹èƒ½å¤Ÿæ ¹æ®ä»»åŠ¡åŠ¨æ€è°ƒæ•´è‡ªèº«çš„å­¦ä¹ ç®—æ³•ï¼ŒåŒ…æ‹¬æ³¨æ„åŠ›æœºåˆ¶ä¸­çš„é”®ã€å€¼ã€æŸ¥è¯¢æŠ•å½±ç­‰å…³é”®éƒ¨åˆ†ã€‚è¿™è®©æ¨¡å‹æ‹¥æœ‰äº†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­ä¼˜åŒ–è‡ªå·±å­¦ä¹ ç­–ç•¥çš„èƒ½åŠ›ã€‚</p>
<p><strong>å®éªŒç»“æœ</strong></p>
<p>åœ¨å®éªŒè¯„ä¼°ä¸­ï¼ŒHopeæ¨¡å‹åœ¨è¯­è¨€å»ºæ¨¡ä¸å¸¸è¯†æ¨ç†ä»»åŠ¡ä¸­è¡¨ç°å‡º<strong>æ›´ä½çš„å›°æƒ‘åº¦å’Œæ›´é«˜çš„å‡†ç¡®æ€§</strong>ï¼Œä¼˜äºç°ä»£å¾ªç¯æ¨¡å‹å’Œæ ‡å‡†Transformeræ¶æ„ã€‚</p>
<p>ç‰¹åˆ«å¼•äººæ³¨ç›®çš„æ˜¯ï¼Œåœ¨â€œå¤§æµ·æé’ˆâ€æµ‹è¯•ä¸­ï¼ŒHopeå±•ç¤ºå‡ºäº†å“è¶Šçš„é•¿æ–‡æœ¬è®°å¿†ä¸æ£€ç´¢èƒ½åŠ›ï¼ŒéªŒè¯äº†CMSåœ¨å¤„ç†è¶…é•¿åºåˆ—ä¿¡æ¯ä¸­çš„æœ‰æ•ˆæ€§ã€‚è¿™ä¸€æµ‹è¯•ç»“æœè¯æ˜äº†åµŒå¥—å­¦ä¹ èŒƒå¼åœ¨è§£å†³ç¾éš¾æ€§é—å¿˜é—®é¢˜ä¸Šçš„æ½œåŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e51b47fd09a40c38d8de12a878a98fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763376278&amp;x-signature=ynKoPRwgsLVhsEfgTNTUw3T5nV4%3D" alt="æ¡å½¢å›¾æ˜¾ç¤º Hope å’Œ Titans æ¨¡å‹åœ¨ä¸‰ä¸ªéš¾åº¦çº§åˆ«çš„é•¿ä¸Šä¸‹æ–‡ä»»åŠ¡ä¸­å§‹ç»ˆä¼˜äº TTT å’Œ Mamba2ã€‚" loading="lazy"/></p>
<p>ç ”ç©¶å›¢é˜Ÿåœ¨340Mã€760Må’Œ1.3Bä¸‰ç§å‚æ•°è§„æ¨¡çš„Hopeæ¨¡å‹ä¸Šè¿›è¡Œäº†å…¨é¢æµ‹è¯•ï¼ŒHopeçš„å¹³å‡åˆ†è¶…è¶Šäº†æ‰€æœ‰å¯¹æ¯”æ¨¡å‹ã€‚è¿™è¡¨æ˜åµŒå¥—å­¦ä¹ èŒƒå¼åœ¨ä¸åŒè§„æ¨¡çš„æ¨¡å‹ä¸Šéƒ½èƒ½å‘æŒ¥ç§¯æä½œç”¨ã€‚</p>
<p>åµŒå¥—å­¦ä¹ çš„æ„ä¹‰è¿œä¸æ­¢äºæŠ€æœ¯å±‚é¢çš„çªç ´ã€‚å®ƒä¸ºå®ç°æŒç»­å­¦ä¹ çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿå¼€è¾Ÿäº†å…¨æ–°è·¯å¾„ã€‚</p>
<p>è¿™ä¸€æŠ€æœ¯å°†å¯èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šæ”¹å˜é‚£äº›éœ€è¦ç»ˆèº«å­¦ä¹ çš„åº”ç”¨é¢†åŸŸï¼Œæ¯”å¦‚æœºå™¨äººã€è‡ªåŠ¨é©¾é©¶ã€ä¸ªæ€§åŒ–AIåŠ©æ‰‹ç­‰ã€‚è¿™äº›ç³»ç»Ÿå°†ä¸å†éœ€è¦æ˜‚è´µçš„ã€ä»å¤´å¼€å§‹çš„å†è®­ç»ƒï¼Œè€Œæ˜¯èƒ½å¤Ÿåƒäººç±»ä¸€æ ·ï¼Œåœ¨ä¿ç•™å·²æœ‰çŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œä¸æ–­å­¦ä¹ å’Œæˆé•¿ã€‚</p>
<p>æ­£å¦‚è°·æ­Œç ”ç©¶äººå‘˜æ‰€è¨€ï¼šâ€œæˆ‘ä»¬ç›¸ä¿¡åµŒå¥—å­¦ä¹ èŒƒå¼ä¸ºå¼¥è¡¥å½“å‰å¤§è¯­è¨€æ¨¡å‹æœ‰é™ã€æ˜“é—å¿˜çš„ç‰¹æ€§ä¸äººè„‘å“è¶Šçš„æŒç»­å­¦ä¹ èƒ½åŠ›ä¹‹é—´çš„å·®è·å¥ å®šäº†åšå®åŸºç¡€ã€‚â€</p>
<p>å½“ç„¶ï¼Œè¿™é¡¹ç ”ç©¶ä»åœ¨å‘å±•ä¹‹ä¸­ã€‚ç ”ç©¶äººå‘˜æŒ‡å‡ºï¼Œç›®å‰çš„å·¥ä½œä¸»è¦èšç„¦äºè®°å¿†çš„åœ¨çº¿å·©å›ºè¿‡ç¨‹ï¼Œå¯¹ç±»ä¼¼äººè„‘ç¡çœ æ—¶çš„ç¦»çº¿é‡æ”¾å’Œæ•´ç†æœºåˆ¶æ¢ç´¢æœ‰é™ã€‚ä½†è¿™æ— ç–‘è®©æˆ‘ä»¬è·ç¦»é‚£ä¸ªèƒ½åƒäººç±»ä¸€æ ·æŒç»­å­¦ä¹ ã€ä¸æ–­è¿›åŒ–çš„é€šç”¨äººå·¥æ™ºèƒ½åˆè¿‘äº†ä¸€æ­¥ã€‚</p>
<p>å¤§å®¶æ€ä¹ˆçœ‹ï¼Ÿæ¬¢è¿äº¤æµè®¨è®º~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…±ç»©ç®—åŠ›èµ‹èƒ½å¤§æ¨¡å‹ï¼šQWEN-2.5-7Bäº‘éƒ¨ç½²å®æˆ˜è§£æ]]></title>    <link>https://juejin.cn/post/7570500819889258539</link>    <guid>https://juejin.cn/post/7570500819889258539</guid>    <pubDate>2025-11-10T07:42:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570500819889258539" data-draft-id="7570339961909936171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…±ç»©ç®—åŠ›èµ‹èƒ½å¤§æ¨¡å‹ï¼šQWEN-2.5-7Bäº‘éƒ¨ç½²å®æˆ˜è§£æ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-10T07:42:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_æ‘˜æ˜Ÿ_"/> <meta itemprop="url" content="https://juejin.cn/user/2228036358374227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…±ç»©ç®—åŠ›èµ‹èƒ½å¤§æ¨¡å‹ï¼šQWEN-2.5-7Bäº‘éƒ¨ç½²å®æˆ˜è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2228036358374227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _æ‘˜æ˜Ÿ_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T07:42:20.000Z" title="Mon Nov 10 2025 07:42:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbf8c323836144e0a235cdd139b387df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=NqRjTiwbrXaLr8NSHXVb96vu55g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">å…±ç»©ç®—åŠ›èµ‹èƒ½å¤§æ¨¡å‹ï¼šQWEN-2.5-7Bäº‘éƒ¨ç½²å®æˆ˜è§£æ</h2>
<h3 data-id="heading-1">æ‘˜è¦</h3>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åœ¨å…±ç»©ç®—åŠ›å¹³å°ä¸Šéƒ¨ç½²é€šä¹‰åƒé—®2.5-7B-Instructå¤§æ¨¡å‹çš„å…¨æµç¨‹å®è·µã€‚å…±ç»©ç®—åŠ›ä½œä¸ºæ¸…åèƒŒæ™¯åˆ›ä¸šå›¢é˜Ÿæ‰“é€ çš„åˆ›æ–°å¹³å°ï¼Œé€šè¿‡æ•´åˆå…¨å›½åˆ†æ•£çš„é—²ç½®ç®—åŠ›èµ„æºï¼ˆåŒ…æ‹¬ä¸ªäººç”µè„‘ã€ç½‘å§ç©ºé—²æœºæ—¶å’Œä¼ä¸šæœªå……åˆ†åˆ©ç”¨çš„ç®—åŠ›ï¼‰ï¼Œæ„å»ºäº†æå…·ä»·æ ¼ä¼˜åŠ¿çš„ç®—åŠ›ç½‘ç»œã€‚å¹³å°æä¾›ä¸¤ç§æ ¸å¿ƒæœåŠ¡ï¼šé€‚åˆé•¿æœŸå¼€å‘çš„Serveräº‘ä¸»æœºï¼ˆ4090å•å¡ä»…1.68å…ƒ/å°æ—¶ï¼Œå…³æœºç¯å¢ƒæŒä¹…ä¿å­˜ï¼‰å’Œé¢å‘ç”Ÿäº§çš„Serverlesså¼¹æ€§éƒ¨ç½²ï¼ˆç§’çº§å†·å¯åŠ¨ï¼Œé›¶è¿ç»´ï¼‰ã€‚æ–‡ç« è¯¦ç»†è®°å½•äº†ä»ç®—åŠ›é€‰æ‹©ã€é•œåƒé…ç½®åˆ°æ¨¡å‹ä¸‹è½½ã€åŸºå‡†æµ‹è¯•çš„å®Œæ•´è¿‡ç¨‹ï¼Œå®æµ‹è¯æ˜å•å¼ 4090æ˜¾å¡å³å¯é«˜æ•ˆè¿è¡Œ7Bçº§åˆ«å¤§æ¨¡å‹ï¼Œä¸ºAIå¼€å‘è€…æä¾›äº†é«˜æ€§ä»·æ¯”çš„äº‘éƒ¨ç½²æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-2">å…±ç»©ç®—åŠ›</h3>
<h4 data-id="heading-3">å¹³å°æ¦‚è¿°</h4>
<p>å…±ç»©ç§‘æŠ€ 2023 å¹´æˆç«‹äºæ¸…åï¼Œä¸“æ³¨äºæ„å»ºèåˆç®—åŠ›ä¸ç”µåŠ›çš„æ™ºèƒ½è°ƒåº¦ç½‘ç»œï¼Œæ—¨åœ¨æä¾›å¹³ä»·ã€å¯é ã€ç»¿è‰²çš„ç®—åŠ›æœåŠ¡ï¼Œä½¿ AI æŠ€æœ¯çœŸæ­£æ™®åŠè‡³æ¯ä¸ªäººã€‚é€šè¿‡ç²¾ç»†è°ƒåº¦ç®—æ³•ï¼Œå·²ä¸ºå¤šå®¶ AIGC é¢†å†›ä¼ä¸šåŠç§‘ç ”æœºæ„æä¾›é«˜æ•ˆç®—åŠ›ï¼Œç›®æ ‡æå‡èµ„æºåˆ©ç”¨ç‡ 60%ã€‚ä½œä¸ºä¸€ç¾¤æ¸…åèƒŒæ™¯çš„å¹´è½»åˆ›æ–°è€…ï¼Œæˆ‘ä»¬åœ¨ 2023 å¹´ç§‹å­£è·å¾—å¥‡ç»©åˆ›å›ç­‰æŠ•èµ„ï¼Œæ­£å¼•é¢†ç®—åŠ›é©å‘½ï¼Œå¼€å¯æ™®æƒ ç§‘æŠ€æ–°ç¯‡ç« ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d802b6b0c7845e4b528723d3c447f9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=l%2Bd5MxbBzx2rbGlWxVEfn0qtptk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">æ ¸å¿ƒåŠŸèƒ½</h4>
<p>å…±ç»©ç®—åŠ›å¹³å°ä¸ºå¼€å‘è€…å’Œä¼ä¸šæä¾›ä¸¤å¤§æ ¸å¿ƒæœåŠ¡æ¨¡å¼ï¼š<strong>Server äº‘ä¸»æœº</strong> å’Œ <strong>Serverless å¼¹æ€§éƒ¨ç½²</strong>ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„ç®—åŠ›éœ€æ±‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a77e2f330bf48239050207668482dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=j36Mru%2BXnwssw%2ByMAEHLX53IjMY%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-5">Server äº‘ä¸»æœº</h5>
<p>ä¸“ä¸ºéœ€è¦ç¨³å®šã€æŒä¹…å¼€å‘ç¯å¢ƒçš„ç”¨æˆ·è®¾è®¡ã€‚å¹³å°æ‹¥æœ‰ä¸Šä¸‡å—é«˜æ€§èƒ½4090æ˜¾å¡éšæ—¶å¾…å‘½ï¼Œè®©æ¯ä¸ªå¼€å‘è€…éƒ½èƒ½è½»æ¾æ‹¥æœ‰é¡¶çº§ç®—åŠ›ï¼Œæ— éœ€ä¸ºæ•°ä¸‡å…ƒçš„ç¡¬ä»¶æŠ•å…¥æœ›è€Œå´æ­¥ã€‚</p>
<p>æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å‘Šåˆ«ç¡¬ä»¶æŠ•èµ„</strong>ï¼šæ— éœ€è´­ä¹°æ˜‚è´µçš„GPUæœåŠ¡å™¨ï¼ŒæŒ‰éœ€ç§Ÿç”¨å³å¯ã€‚</li>
<li><strong>ç¯å¢ƒæ°¸ä¹…ä¿å­˜</strong>ï¼šå…³æœºåå¼€å‘ç¯å¢ƒä¸ä¼šä¸¢å¤±ï¼Œä¸‹æ¬¡å¼€æœºå³æ¢å¤ï¼Œçœå»é‡å¤æ­å»ºç¯å¢ƒçš„çƒ¦æ¼ã€‚</li>
<li><strong>ä¸“æ³¨ä»£ç å¼€å‘</strong>ï¼šå°†ç²¾åŠ›å®Œå…¨é›†ä¸­åœ¨ç®—æ³•å’Œä¸šåŠ¡é€»è¾‘ä¸Šï¼Œè€ŒéåŸºç¡€è®¾æ–½ç®¡ç†ã€‚</li>
</ul>
<p>å…³é”®å‚æ•°ï¼š</p>
<ul>
<li><strong>10ä¸‡+ æ˜¾å¡æ•°é‡</strong>ï¼šæµ·é‡èµ„æºæ± ï¼Œä¿éšœéšæ—¶å¯ç”¨ã€‚</li>
<li><strong>1.68å…ƒ/æ—¶ èµ·æ­¥ä»·</strong>ï¼šæå…·ç«äº‰åŠ›çš„ä»·æ ¼ï¼Œè®©é«˜æ€§èƒ½è®¡ç®—è§¦æ‰‹å¯åŠã€‚</li>
<li><strong>å…³æœºä¿å­˜ æŒä¹…åŒ–</strong>ï¼šæ”¯æŒå…³æœºçŠ¶æ€ä¸‹çš„ç¯å¢ƒæŒä¹…åŒ–ï¼Œä¿éšœå¼€å‘è¿ç»­æ€§ã€‚</li>
</ul>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å¼€å‘æµ‹è¯•</li>
<li>å­¦ä¹ è®­ç»ƒ</li>
<li>é•¿æœŸé¡¹ç›®ç ”å‘</li>
</ul>
<p><strong>é€‰æ‹© Server äº‘ä¸»æœºï¼Œå½“æ‚¨é¢ä¸´ä»¥ä¸‹å›°æ‰°æ—¶ï¼š</strong></p>
<ul>
<li>æ¯æ¬¡é‡æ–°æ­å»ºå¼€å‘ç¯å¢ƒå¤ªéº»çƒ¦</li>
<li>éœ€è¦ä¸€ä¸ªç¨³å®šçš„é•¿æœŸå¼€å‘ç¯å¢ƒ</li>
<li>ä¸éœ€è¦å¯¹å¤–æä¾›åœ¨çº¿æœåŠ¡</li>
</ul>
<hr/>
<h5 data-id="heading-6">Serverless å¼¹æ€§éƒ¨ç½²</h5>
<p>é¢å‘ç”Ÿäº§çº§åº”ç”¨å’Œæµé‡æ³¢åŠ¨åœºæ™¯ï¼Œæä¾›é›¶è¿ç»´ã€ç§’çº§å†·å¯åŠ¨çš„æè‡´ä½“éªŒã€‚å†™å®Œä»£ç ï¼Œ10ç§’å†…å³å¯ä¸Šçº¿ï¼ŒæŒ‰å®é™…ä½¿ç”¨é‡ä»˜è´¹ï¼ŒçœŸæ­£åšåˆ°â€œç”¨å¤šå°‘ä»˜å¤šå°‘â€ï¼Œå®ç°0è¿ç»´æˆæœ¬ã€‚</p>
<p>æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å‘Šåˆ«è¿ç»´çƒ¦æ¼</strong>ï¼šæ— éœ€å…³å¿ƒæœåŠ¡å™¨è¿ç»´ã€æ‰©å®¹ã€ç›‘æ§ç­‰åº•å±‚é—®é¢˜ã€‚</li>
<li><strong>å¼¹æ€§åº”å¯¹æµé‡</strong>ï¼šæ™ºèƒ½è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œä»å®¹åº”å¯¹çªå‘æµé‡é«˜å³°ã€‚</li>
<li><strong>ä¸“æ³¨äº§å“å¼€å‘</strong>ï¼šå¼€å‘è€…åªéœ€å…³æ³¨äº§å“æœ¬èº«ï¼ŒåŸºç¡€è®¾æ–½ç”±å¹³å°å…¨æƒæ‰˜ç®¡ã€‚</li>
</ul>
<p>å…³é”®æŒ‡æ ‡ï¼š</p>
<ul>
<li><strong>99.9% å¯ç”¨æ€§</strong>ï¼šé«˜å¯é æ€§ä¿éšœçº¿ä¸ŠæœåŠ¡ç¨³å®šè¿è¡Œã€‚</li>
<li><strong>ç§’çº§å†·å¯åŠ¨</strong>ï¼šä»ä»£ç æäº¤åˆ°æœåŠ¡ä¸Šçº¿ä»…éœ€10ç§’ï¼Œå“åº”è¿…é€Ÿã€‚</li>
<li><strong>0è¿ç»´ é›¶è´Ÿæ‹…</strong>ï¼šæ— æœåŠ¡å™¨ç®¡ç†è´Ÿæ‹…ï¼Œé‡Šæ”¾å›¢é˜Ÿç”Ÿäº§åŠ›ã€‚</li>
</ul>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ç”Ÿäº§æœåŠ¡éƒ¨ç½²</li>
<li>çªå‘æµé‡åº”å¯¹ï¼ˆå¦‚è¥é”€æ´»åŠ¨ã€çƒ­ç‚¹äº‹ä»¶ï¼‰</li>
<li>åœ¨çº¿ç”¨æˆ·è®¿é—®æœåŠ¡</li>
</ul>
<p><strong>é€‰æ‹© Serverless å¼¹æ€§éƒ¨ç½²ï¼Œå½“æ‚¨é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜æ—¶ï¼š</strong></p>
<ul>
<li>æ‹…å¿ƒçªå‘æµé‡å¯¼è‡´æœåŠ¡å®•æœº</li>
<li>ä¸æƒ³èŠ±æ—¶é—´åœ¨æœåŠ¡å™¨è¿ç»´ä¸Š</li>
<li>å¸Œæœ›ä¸¥æ ¼æ§åˆ¶äº‘æœåŠ¡æˆæœ¬</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bb5dddc68d8427a9965c18dbea91488~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=h3Ti9u3hbRR3MYJ1%2BDxn5j6LGjw%3D" alt="" loading="lazy"/></p>
<p>æ— è®ºæ˜¯è¿½æ±‚ç¯å¢ƒç¨³å®šã€é€‚åˆé•¿æœŸå¼€å‘çš„ <strong>Server äº‘ä¸»æœº</strong>ï¼Œè¿˜æ˜¯è¿½æ±‚æè‡´æ•ˆç‡ã€é›¶è¿ç»´è´Ÿæ‹…çš„ <strong>Serverless å¼¹æ€§éƒ¨ç½²</strong>ï¼Œå…±ç»©ç®—åŠ›å¹³å°éƒ½æä¾›äº†é’ˆå¯¹æ€§å¼ºã€æ€§ä»·æ¯”æé«˜çš„è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…å’Œä¼ä¸šæ‘†è„±åŸºç¡€è®¾æ–½æŸç¼šï¼Œä¸“æ³¨äºä»·å€¼åˆ›é€ ã€‚</p>
<h4 data-id="heading-7">æŠ€æœ¯æ¶æ„</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b8f2f05d8124544ab16b65434e3ac30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=4i1Du2UiYkO%2FaFw7w6R3VoCdkPg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">é™æœ¬å¢æ•ˆ</h4>
<p>å…±ç»©ç®—åŠ›å¹³å°çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€åœ¨äºå…¶æå…·ç«äº‰åŠ›çš„ä»·æ ¼ä½“ç³»ï¼ŒçœŸæ­£å®ç°äº†â€œé™æœ¬å¢æ•ˆâ€ï¼Œè®©æ¯ä¸€åˆ†é’±éƒ½èŠ±åœ¨åˆ€åˆƒä¸Šã€‚ä¸ä¼ ç»Ÿäº‘æœåŠ¡å•†åŠ¨è¾„æ•°åå…ƒç”šè‡³ä¸Šç™¾å…ƒæ¯å°æ—¶çš„GPUç®—åŠ›ç›¸æ¯”ï¼Œå…±ç»©å¹³å°æä¾›çš„4090æ˜¾å¡ç®—åŠ›ä»·æ ¼ä½è‡³<strong>1.68å…ƒ/å°æ—¶ï¼ˆå•å¡ï¼‰</strong> ï¼ŒåŒå¡é…ç½®ä»…éœ€<strong>3.36å…ƒ/å°æ—¶</strong>ï¼Œå››å¡é›†ç¾¤ä¹Ÿä»…ä¸º<strong>6.72å…ƒ/å°æ—¶</strong>ã€‚è¿™ç§æŒ‰ç§’è®¡è´¹çš„ç²¾ç»†åŒ–æ¨¡å¼ï¼Œæ„å‘³ç€ç”¨æˆ·åªéœ€ä¸ºå®é™…ä½¿ç”¨çš„æ¯ä¸€ç§’ä»˜è´¹ï¼Œé¿å…äº†ä¼ ç»ŸæŒ‰å°æ—¶è®¡è´¹å¸¦æ¥çš„èµ„æºæµªè´¹å’Œæˆæœ¬å†—ä½™ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œè¿™äº›ä»·æ ¼èƒŒåæ˜¯å¹³å°åˆ›æ–°çš„å•†ä¸šæ¨¡å¼â€”â€”é€šè¿‡æ•´åˆå…¨å›½èŒƒå›´å†…çš„ä¸ªäººé—²ç½®ç”µè„‘ã€ç½‘å§ç©ºé—²æœºæ—¶ä»¥åŠä¼ä¸šæœªå……åˆ†åˆ©ç”¨çš„ç®—åŠ›èµ„æºï¼Œæ„å»ºäº†ä¸€ä¸ªåºå¤§çš„åˆ†å¸ƒå¼ç®—åŠ›ç½‘ç»œã€‚è¿™ç§â€œå…±äº«ç»æµâ€æ¨¡å¼å¤§å¹…é™ä½äº†åŸºç¡€è®¾æ–½çš„è¾¹é™…æˆæœ¬ï¼Œä»è€Œå°†èŠ‚çœä¸‹æ¥çš„è´¹ç”¨ç›´æ¥å›é¦ˆç»™ç»ˆç«¯ç”¨æˆ·ã€‚æ— è®ºæ˜¯AIåˆåˆ›å›¢é˜Ÿè¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œè¿˜æ˜¯ä¸ªäººå¼€å‘è€…éƒ¨ç½²æ¨ç†æœåŠ¡ï¼Œéƒ½èƒ½ä»¥æä½çš„æˆæœ¬è·å¾—é«˜æ€§èƒ½çš„4090 GPUç®—åŠ›æ”¯æŒï¼Œå½»åº•å‘Šåˆ«â€œç®—åŠ›ç„¦è™‘â€ï¼ŒæŠŠå®è´µçš„é¢„ç®—é›†ä¸­æŠ•å…¥åˆ°æ ¸å¿ƒç®—æ³•ç ”å‘å’Œä¸šåŠ¡åˆ›æ–°ä¸Šï¼Œè€Œéæ˜‚è´µçš„ç¡¬ä»¶æŠ•å…¥æˆ–äº‘æœåŠ¡è´¦å•ä¸­ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6e01e0cc712464c85604d7598c94cb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=ibNJ0SSn9l8wUWGMS5%2BGYi0HagU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9">å¹³å°å¯¹æ¯”åˆ†æ</h4>



























































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>å…±ç»©ç®—åŠ›å¹³å°</th><th>ä¼ ç»Ÿäº‘æœåŠ¡å•†</th><th>è‡ªå»ºGPUé›†ç¾¤</th></tr></thead><tbody><tr><td><strong>æˆæœ¬æ¨¡å¼</strong></td><td>æŒ‰ç§’çº§ç²¾å‡†è®¡è´¹ï¼Œåªä¸ºä½¿ç”¨æ—¶é—´ä»˜è´¹</td><td>æŒ‰å°æ—¶/æœˆè®¡è´¹ï¼Œå­˜åœ¨èµ„æºæµªè´¹</td><td>é«˜é¢å‰æœŸæŠ•å…¥ï¼Œå›ºå®šæˆæœ¬é«˜</td></tr><tr><td><strong>èµ„æºå¼¹æ€§</strong></td><td>ç§’çº§æ‰©å®¹ç¼©å®¹ï¼ŒåŠ¨æ€é€‚åº”ä¸šåŠ¡éœ€æ±‚</td><td>åˆ†é’Ÿçº§æ‰©å®¹ï¼Œå­˜åœ¨ä¸€å®šå»¶è¿Ÿ</td><td>æ— æ³•å¼¹æ€§æ‰©å±•ï¼Œéœ€æå‰è§„åˆ’</td></tr><tr><td><strong>èµ„æºæ¥æº</strong></td><td>æ•´åˆå…¨å›½åˆ†æ•£é—²æ—¶ç®—åŠ›ï¼ŒåŒ…æ‹¬ä¸ªäºº/ç½‘å§/æ™ºç®—ä¸­å¿ƒ</td><td>è‡ªæœ‰æ•°æ®ä¸­å¿ƒï¼Œèµ„æºé›†ä¸­</td><td>ä¼ä¸šè‡ªè´­ç¡¬ä»¶ï¼Œèµ„æºå›ºå®š</td></tr><tr><td><strong>éƒ¨ç½²é€Ÿåº¦</strong></td><td>3åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²AIæœåŠ¡</td><td>10-30åˆ†é’Ÿåˆ›å»ºå®ä¾‹</td><td>æ•°å¤©åˆ°æ•°å‘¨çš„éƒ¨ç½²å‘¨æœŸ</td></tr><tr><td><strong>æŠ€æœ¯é—¨æ§›</strong></td><td>ä¸€ç«™å¼GPUå¼€å‘ç¯å¢ƒï¼Œé™ä½é…ç½®å¤æ‚åº¦</td><td>éœ€è¦ä¸€å®šäº‘æœåŠ¡ä½¿ç”¨ç»éªŒ</td><td>éœ€è¦ä¸“ä¸šè¿ç»´å›¢é˜Ÿæ”¯æŒ</td></tr><tr><td><strong>ç»¿è‰²èŠ‚èƒ½</strong></td><td>åˆ©ç”¨é—²ç½®ç®—åŠ›ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ï¼Œæ›´ç¯ä¿</td><td>æ•°æ®ä¸­å¿ƒèƒ½è€—è¾ƒé«˜</td><td>èƒ½æºåˆ©ç”¨ç‡ä½ï¼Œå­˜åœ¨æµªè´¹</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>AIæ¨ç†/è®­ç»ƒã€ç§‘ç ”è®¡ç®—ã€ä¸´æ—¶é«˜ç®—åŠ›éœ€æ±‚</td><td>é€šç”¨äº‘è®¡ç®—ã€ä¼ä¸šåº”ç”¨</td><td>é•¿æœŸç¨³å®šçš„å¤§è§„æ¨¡è®¡ç®—éœ€æ±‚</td></tr><tr><td><strong>ä»·æ ¼ä¼˜åŠ¿</strong></td><td>ä»·æ ¼æ›´ä½ï¼Œæ€§ä»·æ¯”é«˜</td><td>ä»·æ ¼ä¸­ç­‰ï¼ŒæŒ‰é‡ä»˜è´¹</td><td>é•¿æœŸä½¿ç”¨æˆæœ¬é«˜</td></tr></tbody></table>
<h3 data-id="heading-10">é­”æ­ç¤¾åŒºå’Œé€šä¹‰åƒé—®2.5-7B-Instruct</h3>
<h4 data-id="heading-11">æ¦‚è¿°</h4>
<p>é­”æ­ç¤¾åŒºï¼ˆModelScopeï¼‰æ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„<strong>æ¨¡å‹å¼€æ”¾å¹³å°</strong>ï¼Œè‡´åŠ›äºæ‰“é€ â€œ<strong>æ¨¡å‹å³æœåŠ¡</strong>ï¼ˆMaaSï¼‰â€çš„ç”Ÿæ€ä½“ç³»ã€‚è¯¥å¹³å°æä¾›æµ·é‡é«˜è´¨é‡æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œè¦†ç›–è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰ã€è¯­éŸ³è¯†åˆ«ã€å¤šæ¨¡æ€ç­‰å¤šä¸ªæŠ€æœ¯é¢†åŸŸã€‚</p>
<h4 data-id="heading-12">é­”æ­ç¤¾åŒºæ ¸å¿ƒç‰¹ç‚¹ï¼š</h4>
<ul>
<li><strong>æ¨¡å‹ä¸°å¯Œ</strong>ï¼šæ±‡èšæ•°åƒä¸ªå¼€æºæ¨¡å‹ï¼ŒåŒ…æ‹¬é˜¿é‡Œè‡ªç ”æ¨¡å‹åŠç¤¾åŒºè´¡çŒ®æ¨¡å‹</li>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šæä¾›ä¸€é”®æ¨ç†ã€åœ¨çº¿ä½“éªŒã€Notebookå®ä¾‹ç­‰åŠŸèƒ½ï¼Œé™ä½ä½¿ç”¨é—¨æ§›</li>
<li><strong>å…¨é“¾è·¯æ”¯æŒ</strong>ï¼šä»æ¨¡å‹æ¢ç´¢ã€è®­ç»ƒã€æ¨ç†åˆ°éƒ¨ç½²ï¼Œæä¾›å®Œæ•´å·¥å…·é“¾</li>
<li><strong>ç¤¾åŒºæ´»è·ƒ</strong>ï¼šæ”¯æŒæ¨¡å‹åˆ†äº«ã€è¯„æµ‹ã€è®¨è®ºï¼Œä¿ƒè¿›AIæŠ€æœ¯äº¤æµä¸åˆ›æ–°</li>
<li><strong>ä¼ä¸šçº§èƒ½åŠ›</strong>ï¼šæ”¯æŒç§æœ‰åŒ–éƒ¨ç½²ã€æ¨¡å‹å®šåˆ¶å’Œå•†ä¸šåŒ–æœåŠ¡</li>
</ul>
<p>é­”æ­ä¸ä»…æ˜¯æ¨¡å‹ä»“åº“ï¼Œæ›´æ˜¯è¿æ¥æ¨¡å‹å¼€å‘è€…ä¸ä½¿ç”¨è€…çš„æ¡¥æ¢ï¼Œæ¨åŠ¨AIæŠ€æœ¯çš„æ™®æƒ åŒ–å’Œäº§ä¸šåŒ–ã€‚</p>
<h4 data-id="heading-13">é€šä¹‰åƒé—®2.5-7B-Instructæ¨¡å‹ä¸‹è½½æŒ‡å—</h4>
<p>åœ¨é­”æ­ç¤¾åŒºæ¨¡å‹åº“ä¸­æ‰¾åˆ°é€šä¹‰åƒé—®2.5-7B-Instructå¹¶è¿›å…¥è¯¦æƒ…</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b8f05ac2bad48848afe62960ffaa508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=Sv6QfNlYdwG7P0pu5amKyuWrGqM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3172b3d49c6d49b1a613f0845d3d2f9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=VP4IRFBtateMToNutMJMeG9lLGk%3D" alt="" loading="lazy"/></p>
<p>æŒ‰ç…§å®˜æ–¹ç»™å‡ºçš„ä¸‹è½½æ¨¡å‹é…ç½®å¾…ä¼šåˆ°å…±ç»©ç®—åŠ›å¹³å°ä¸­è¿›è¡Œéƒ¨ç½²</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e703a892ad674e6dba3125822a71503f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=s2dA7VtXpU6XImque8IxWY8vfy0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">äº‘ä¸»æœºéƒ¨ç½²å®è·µ</h3>
<h4 data-id="heading-15">ç®—åŠ›é€‰æ‹©</h4>
<p>è¿›å…¥å…±ç»©ç®—åŠ›äº‘ä¸»æœºé¡µé¢ä¸­ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.suanli.cn%2Fserver" target="_blank" title="https://console.suanli.cn/server" ref="nofollow noopener noreferrer">console.suanli.cn/server</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c10156d327248e3820a85285f80009e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=W6y2Y2PGkWgp8acJwmYSsK7FbRk%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä»·æ ¼å’Œç®—åŠ›æ€§ä»·æ¯”çœŸçš„æ˜¯ååˆ†é«˜ï¼Œè¿™é‡Œåˆ†åˆ«å±•ç¤º1æ ¸ã€2æ ¸ã€4æ ¸ã€8æ ¸çš„ä»·æ ¼å¯¹æ¯”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87e253990f864fcd84491b31901bc1be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=RNYefLeymLnk6qVOxc8cpkKck20%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8448a7f942524b948bdcfe048c88aa3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=Vfhr7mH%2F7R479pBQR2gULKcblvQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2b7c30dc8ed4e4dbba7b47597cac949~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=SOvjaYzIaegW%2FwS7NMGVY9K21wI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3408630133fa4a74b19ab67eab1c10c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=NVOrKOOf1bULkW911fnSmGWALEA%3D" alt="" loading="lazy"/></p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¹‹ç±»é€‰æ‹©å•æ ¸å³å¯</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3a2fbb8eb46489d8ccbc460d8ab311e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=WLks5riAzzenWgyUOsWwejbnQRM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">é•œåƒé€‰æ‹©</h4>
<p>å…±ç»©ç®—åŠ›çš„åŸºç¡€é•œåƒä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸‰ç§æ¡†æ¶çš„é€‰æ‹©</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5beac96bc43c41ccb7cd063dfbea6566~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=Oy%2FO1gaOcvk%2FPiEfqGiZDMCtQFM%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬è¿™é‡Œçš„é…ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdcab40750f549f5b27f204d0941579b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=8A5LZdhflFjnGU9MtBvbQNpXq%2F0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/074b0e59c4464e38b393fd2613235454~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=UBChD193HNeOxEwDEUAcn6ZXqv4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae67f7624e2f471985318452ff926797~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=YdR6Kwjxo2DmxldzyY7uUZJMNzQ%3D" alt="" loading="lazy"/></p>
<p>ğŸ–¥ï¸ äº‘æœåŠ¡å™¨å®ä¾‹é…ç½®è¯¦æƒ…</p>

































<table><thead><tr><th>é…ç½®ç±»åˆ«</th><th>è¯¦ç»†å‚æ•°</th></tr></thead><tbody><tr><td><strong>è®¾å¤‡å‹å·</strong></td><td>NVIDIA GeForce RTX 4090 / 24GB æ˜¾å­˜</td></tr><tr><td><strong>æ‰€å±åŒºåŸŸ</strong></td><td>é‡åº†ä¸€åŒº</td></tr><tr><td><strong>CPU æ ¸å¿ƒæ•°</strong></td><td>20 æ ¸</td></tr><tr><td><strong>å†…å­˜å®¹é‡</strong></td><td>101 GB</td></tr><tr><td><strong>CUDA æ”¯æŒ</strong></td><td>11.3 ~ 12.8ï¼ˆé©±åŠ¨ç‰ˆæœ¬ï¼š470.82.01+ï¼‰</td></tr><tr><td><strong>ç³»ç»Ÿç¡¬ç›˜</strong></td><td>50 GB</td></tr></tbody></table>
<p>ğŸ ç³»ç»Ÿé•œåƒé…ç½®</p>





























<table><thead><tr><th>ç»„ä»¶ç±»å‹</th><th>ç‰ˆæœ¬/è§„æ ¼</th></tr></thead><tbody><tr><td>æ¡†æ¶åç§°</td><td>PyTorch</td></tr><tr><td>æ¡†æ¶ç‰ˆæœ¬</td><td>2.7.1</td></tr><tr><td>Python ç‰ˆæœ¬</td><td>3.12 (Ubuntu 22.04)</td></tr><tr><td>CUDA ç‰ˆæœ¬</td><td>12.8</td></tr><tr><td>é•œåƒç±»å‹</td><td>åŸºç¡€é•œåƒï¼ˆå«æ·±åº¦å­¦ä¹ æ¡†æ¶ã€Minicondaç­‰å¸¸ç”¨å·¥å…·ï¼‰</td></tr></tbody></table>
<p>åŒæ—¶å…±ç»©ç®—åŠ›ä¸­è¿˜æä¾›äº†ç¤¾åŒºç”¨æˆ·è‡ªå·±å¼€å‘çš„é•œåƒï¼Œæˆ‘ä¹Ÿä¼šåœ¨åç»­çš„æ–‡ç« ä¸­è¿›è¡Œè¯•ç”¨</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09585e47df4044f080d42df65465c080~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=Z8Qtp%2FDRqs3ManOcs%2BkFSFYgb8w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">åˆ›å»ºå®ä¾‹</h4>
<p>ç‚¹å‡»åˆ›å»ºå®ä¾‹ä¹‹åï¼Œå…±ç»©ç®—åŠ›å°±ä¼šåœ¨åå°è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºåˆšåˆšé€‰å¥½çš„äº‘ä¸»æœº</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3201969bfb5e4567931c1ca39cdd9096~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=8nGwcN4VvV0Lps2YgwB29mm1LoA%3D" alt="" loading="lazy"/></p>
<p>å¹¶ä¸”å…±ç»©ç®—åŠ›è¿™é‡Œæä¾›äº†ä¸‰ç§å¿«æ·æ“ä½œæ–¹å¼ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©Jupyter Lab</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd22f0a6068a4d018c50a3e011bcdb6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=sgE9Y3cQdBqpT0jWn3emxzU0uqE%3D" alt="" loading="lazy"/></p>
<p>è¿›å…¥Jupyter Labä¹‹åè¿›å…¥åˆ°ç»ˆç«¯</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3120ee067a7945a6b110060ea1ff474a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=sypDz00V78EViwbSg2Di%2BJEP%2BdE%3D" alt="" loading="lazy"/></p>
<p>æ‰§è¡Œä¸‹æ–¹å‘½ä»¤ä»é­”æ­ç¤¾åŒºä¸­ä¸‹è½½Qwen/Qwen2.5-7B-Instructæ¨¡å‹</p>
<pre><code class="hljs language-css" lang="css">pip install modelscope
modelscope download <span class="hljs-attr">--model</span> Qwen/Qwen2.<span class="hljs-number">5</span>-<span class="hljs-number">7</span>B-Instruct
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e9c2d95dc947a983c4c80e57e8402d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=bBl7e3dokCD80CPylBWrwHSbseg%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs">pip install transformers torch tqdm accelerate
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6535f72961114d409ba02c756cf7a9c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=%2BV6Je5FRRJxGsEHw1n%2BUWMVKzzQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">åŸºå‡†æµ‹è¯•</h4>
<p>å‡†å¤‡å¥½ä¸‹æ–¹çš„åŸºå‡†æµ‹è¯•è„šæœ¬</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM
<span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># ========== é…ç½®å‚æ•° ==========</span>
MODEL_NAME = <span class="hljs-string">"/root/.cache/modelscope/hub/models/Qwen/Qwen2.5-7B-Instruct"</span>
WARMUP_STEPS = <span class="hljs-number">1</span>
TEST_STEPS = <span class="hljs-number">3</span>
BATCH_SIZES = [<span class="hljs-number">1</span>]  <span class="hljs-comment"># ç®€åŒ–æµ‹è¯•</span>
MAX_NEW_TOKENS = <span class="hljs-number">128</span>

<span class="hljs-comment"># ğŸŒ äº”ç§æµ‹è¯•åœºæ™¯çš„æç¤ºè¯</span>
TEST_SCENARIOS = {
    <span class="hljs-string">"ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç”Ÿæˆ"</span>: <span class="hljs-string">"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘æƒ³å»"</span>,
    <span class="hljs-string">"ğŸ‡ºğŸ‡¸ è‹±æ–‡ç”Ÿæˆ"</span>: <span class="hljs-string">"The capital of France is"</span>,
    <span class="hljs-string">"ğŸ§  é€»è¾‘æ¨ç†"</span>: <span class="hljs-string">"å¦‚æœæ‰€æœ‰çš„Aéƒ½æ˜¯Bï¼Œè€Œæ‰€æœ‰çš„Béƒ½æ˜¯Cï¼Œé‚£ä¹ˆæ‰€æœ‰çš„Aæ˜¯Cå—ï¼Ÿè¯·è¯¦ç»†è§£é‡Šã€‚"</span>,
    <span class="hljs-string">"ğŸ’» ä»£ç ç”Ÿæˆ"</span>: <span class="hljs-string">"ç”¨Pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åºç®—æ³•"</span>,
    <span class="hljs-string">"ğŸ“– çŸ¥è¯†é—®ç­”"</span>: <span class="hljs-string">"é‡å­åŠ›å­¦ä¸­çš„è–›å®šè°”æ–¹ç¨‹æ˜¯ç”¨æ¥æè¿°ä»€ä¹ˆçš„ï¼Ÿ"</span>
}

<span class="hljs-comment"># ========== å·¥å…·å‡½æ•° ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_gpu_memory</span>():
    <span class="hljs-string">"""ğŸ“Š æ‰“å°å½“å‰GPUå†…å­˜ä½¿ç”¨æƒ…å†µ"""</span>
    allocated = torch.cuda.memory_allocated() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>
    reserved = torch.cuda.memory_reserved() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>
    max_allocated = torch.cuda.max_memory_allocated() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ’½ GPUå†…å­˜: å·²åˆ†é… <span class="hljs-subst">{allocated:<span class="hljs-number">.2</span>f}</span>GB | é¢„ç•™ <span class="hljs-subst">{reserved:<span class="hljs-number">.2</span>f}</span>GB | å³°å€¼ <span class="hljs-subst">{max_allocated:<span class="hljs-number">.2</span>f}</span>GB"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">format_time</span>(<span class="hljs-params">seconds</span>):
    <span class="hljs-string">"""â±ï¸ æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º"""</span>
    <span class="hljs-keyword">if</span> seconds &lt; <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{seconds*<span class="hljs-number">1000</span>:<span class="hljs-number">.2</span>f}</span> ms"</span>
    <span class="hljs-keyword">elif</span> seconds &lt; <span class="hljs-number">60</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{seconds:<span class="hljs-number">.2</span>f}</span> ç§’"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{seconds/<span class="hljs-number">60</span>:<span class="hljs-number">.2</span>f}</span> åˆ†é’Ÿ"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">display_banner</span>(<span class="hljs-params">title</span>):
    <span class="hljs-string">"""ğŸ‰ æ˜¾ç¤ºæ¼‚äº®çš„æ ‡é¢˜æ¨ªå¹…"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'='</span> * <span class="hljs-number">60</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ¨ <span class="hljs-subst">{title}</span> âœ¨"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'='</span> * <span class="hljs-number">60</span>}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_with_stats</span>(<span class="hljs-params">model, tokenizer, prompt, max_new_tokens=MAX_NEW_TOKENS</span>):
    <span class="hljs-string">"""âš¡ æ‰§è¡Œå•æ¬¡ç”Ÿæˆå¹¶æ”¶é›†ç»Ÿè®¡ä¿¡æ¯"""</span>
    <span class="hljs-comment"># å‡†å¤‡è¾“å…¥</span>
    inputs = tokenizer(prompt, return_tensors=<span class="hljs-string">"pt"</span>).to(model.device)
    input_length = inputs.input_ids.shape[<span class="hljs-number">1</span>]

    <span class="hljs-comment"># ç”Ÿæˆ</span>
    start_time = time.perf_counter()
    <span class="hljs-keyword">with</span> torch.no_grad():
        outputs = model.generate(
            **inputs,
            max_new_tokens=max_new_tokens,
            do_sample=<span class="hljs-literal">True</span>,
            temperature=<span class="hljs-number">0.7</span>,
            top_p=<span class="hljs-number">0.9</span>
        )
    end_time = time.perf_counter()

    <span class="hljs-comment"># è®¡ç®—æŒ‡æ ‡</span>
    generation_time = end_time - start_time
    generated_tokens = outputs[<span class="hljs-number">0</span>].shape[<span class="hljs-number">0</span>] - input_length
    tokens_per_second = generated_tokens / generation_time <span class="hljs-keyword">if</span> generation_time &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>

    <span class="hljs-comment"># è§£ç ç”Ÿæˆçš„æ–‡æœ¬</span>
    generated_text = tokenizer.decode(outputs[<span class="hljs-number">0</span>][input_length:], skip_special_tokens=<span class="hljs-literal">True</span>)

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"time"</span>: generation_time,
        <span class="hljs-string">"tokens_generated"</span>: generated_tokens,
        <span class="hljs-string">"tokens_per_second"</span>: tokens_per_second,
        <span class="hljs-string">"output_text"</span>: generated_text,
        <span class="hljs-string">"memory_used"</span>: torch.cuda.max_memory_allocated() / <span class="hljs-number">1024</span>**<span class="hljs-number">3</span>
    }

<span class="hljs-comment"># ========== ä¸»æµ‹è¯•å‡½æ•° ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">benchmark_model</span>():
    display_banner(<span class="hljs-string">"ğŸš€ æ¨¡å‹åŠ è½½ä¸­"</span>)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># åŠ è½½æ¨¡å‹å’Œtokenizer</span>
        tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME, trust_remote_code=<span class="hljs-literal">True</span>)
        model = AutoModelForCausalLM.from_pretrained(
            MODEL_NAME,
            device_map=<span class="hljs-string">"auto"</span>,
            torch_dtype=torch.bfloat16,
            trust_remote_code=<span class="hljs-literal">True</span>
        )
        model.<span class="hljs-built_in">eval</span>()

        <span class="hljs-comment"># æ‰“å°æ¨¡å‹ä¿¡æ¯</span>
        device = <span class="hljs-built_in">next</span>(model.parameters()).device
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æ¨¡å‹åŠ è½½æˆåŠŸï¼"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ§  æ¨¡å‹: <span class="hljs-subst">{MODEL_NAME}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ–¥ï¸  è®¾å¤‡: <span class="hljs-subst">{device}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ”§ æ•°æ®ç±»å‹: <span class="hljs-subst">{model.dtype}</span>"</span>)
        print_gpu_memory()
        
        <span class="hljs-comment"># ========== é¢„çƒ­ ==========</span>
        display_banner(<span class="hljs-string">"ğŸ”¥ é¢„çƒ­é˜¶æ®µ"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"é¢„çƒ­æ¨¡å‹ä¸­..."</span>)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(WARMUP_STEPS):
            _ = generate_with_stats(model, tokenizer, <span class="hljs-string">"ä½ å¥½"</span>, max_new_tokens=<span class="hljs-number">32</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é¢„çƒ­æ­¥éª¤ <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>/<span class="hljs-subst">{WARMUP_STEPS}</span> å®Œæˆ"</span>)
        
        <span class="hljs-comment"># ========== äº”ç§åœºæ™¯æµ‹è¯• ==========</span>
        all_results = {}
        
        <span class="hljs-keyword">for</span> scenario_name, prompt <span class="hljs-keyword">in</span> TEST_SCENARIOS.items():
            display_banner(<span class="hljs-string">f"ğŸ” <span class="hljs-subst">{scenario_name}</span> æµ‹è¯•"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“ æµ‹è¯•æç¤º: "</span>{prompt}<span class="hljs-string">""</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ”„ æ‰§è¡Œ <span class="hljs-subst">{TEST_STEPS}</span> æ¬¡è¿­ä»£..."</span>)
            
            scenario_results = []
            
            <span class="hljs-comment"># é¢„å…ˆæ¸…é™¤GPUç¼“å­˜</span>
            torch.cuda.empty_cache()
            torch.cuda.reset_peak_memory_stats()
            
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(TEST_STEPS), desc=<span class="hljs-string">f"â³ <span class="hljs-subst">{scenario_name}</span>"</span>):
                result = generate_with_stats(model, tokenizer, prompt)
                scenario_results.append(result)
                        
                <span class="hljs-comment"># æ‰“å°å•æ¬¡ç»“æœ</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{scenario_name}</span> - è¿­ä»£ <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>/<span class="hljs-subst">{TEST_STEPS}</span>:"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   â±ï¸  ç”Ÿæˆæ—¶é—´: <span class="hljs-subst">{format_time(result[<span class="hljs-string">'time'</span>])}</span>"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ“ ç”Ÿæˆé•¿åº¦: <span class="hljs-subst">{result[<span class="hljs-string">'tokens_generated'</span>]}</span> tokens"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸš€ ç”Ÿæˆé€Ÿåº¦: <span class="hljs-subst">{result[<span class="hljs-string">'tokens_per_second'</span>]:<span class="hljs-number">.2</span>f}</span> tokens/ç§’"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ’¾ å³°å€¼å†…å­˜: <span class="hljs-subst">{result[<span class="hljs-string">'memory_used'</span>]:<span class="hljs-number">.2</span>f}</span> GB"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ¯ ç”Ÿæˆå†…å®¹: <span class="hljs-subst">{result[<span class="hljs-string">'output_text'</span>][:<span class="hljs-number">50</span>]}</span>..."</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(result[<span class="hljs-string">'output_text'</span>]) &gt; <span class="hljs-number">50</span> <span class="hljs-keyword">else</span> <span class="hljs-string">f"   ğŸ¯ ç”Ÿæˆå†…å®¹: <span class="hljs-subst">{result[<span class="hljs-string">'output_text'</span>]}</span>"</span>)
            
            <span class="hljs-comment"># è®¡ç®—å¹³å‡å€¼</span>
            avg_time = <span class="hljs-built_in">sum</span>(r[<span class="hljs-string">"time"</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> scenario_results) / TEST_STEPS
            avg_tokens = <span class="hljs-built_in">sum</span>(r[<span class="hljs-string">"tokens_generated"</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> scenario_results) / TEST_STEPS
            avg_speed = <span class="hljs-built_in">sum</span>(r[<span class="hljs-string">"tokens_per_second"</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> scenario_results) / TEST_STEPS
            max_memory = <span class="hljs-built_in">max</span>(r[<span class="hljs-string">"memory_used"</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> scenario_results)
            
            all_results[scenario_name] = {
                <span class="hljs-string">"avg_time"</span>: avg_time,
                <span class="hljs-string">"avg_tokens"</span>: avg_tokens,
                <span class="hljs-string">"avg_speed"</span>: avg_speed,
                <span class="hljs-string">"max_memory"</span>: max_memory,
                <span class="hljs-string">"sample_output"</span>: scenario_results[-<span class="hljs-number">1</span>][<span class="hljs-string">"output_text"</span>],
                <span class="hljs-string">"prompt"</span>: prompt
            }
            
            <span class="hljs-comment"># æ˜¾ç¤ºè¯¥åœºæ™¯çš„å¹³å‡ç»“æœ</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{scenario_name}</span> - å¹³å‡æ€§èƒ½:"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   â±ï¸  å¹³å‡æ—¶é—´: <span class="hljs-subst">{format_time(avg_time)}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ“ å¹³å‡é•¿åº¦: <span class="hljs-subst">{avg_tokens:<span class="hljs-number">.1</span>f}</span> tokens"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸš€ å¹³å‡é€Ÿåº¦: <span class="hljs-subst">{avg_speed:<span class="hljs-number">.2</span>f}</span> tokens/ç§’"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ’¾ å³°å€¼å†…å­˜: <span class="hljs-subst">{max_memory:<span class="hljs-number">.2</span>f}</span> GB"</span>)
    
        <span class="hljs-keyword">return</span> all_results, model, tokenizer
    
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ åŸºå‡†æµ‹è¯•å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        <span class="hljs-keyword">import</span> traceback
        traceback.print_exc()
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>

<span class="hljs-comment"># ========== ç»“æœå¯è§†åŒ– ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">display_results</span>(<span class="hljs-params">all_results</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> all_results:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ— æµ‹è¯•ç»“æœ"</span>)
        <span class="hljs-keyword">return</span>
    
    display_banner(<span class="hljs-string">"ğŸ“ˆ åŸºå‡†æµ‹è¯•ç»“æœæ±‡æ€»"</span>)
    
    <span class="hljs-comment"># åˆ›å»ºç»“æœè¡¨æ ¼</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nğŸ“Š æ€§èƒ½å¯¹æ¯”:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">90</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"| <span class="hljs-subst">{<span class="hljs-string">'æµ‹è¯•åœºæ™¯'</span>:&lt;<span class="hljs-number">15</span>}</span> | <span class="hljs-subst">{<span class="hljs-string">'å¹³å‡æ—¶é—´'</span>:&lt;<span class="hljs-number">12</span>}</span> | <span class="hljs-subst">{<span class="hljs-string">'å¹³å‡é€Ÿåº¦'</span>:&lt;<span class="hljs-number">15</span>}</span> | <span class="hljs-subst">{<span class="hljs-string">'å¹³å‡é•¿åº¦'</span>:&lt;<span class="hljs-number">10</span>}</span> | <span class="hljs-subst">{<span class="hljs-string">'å³°å€¼å†…å­˜'</span>:&lt;<span class="hljs-number">10</span>}</span> |"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"|"</span> + <span class="hljs-string">"-"</span> * <span class="hljs-number">14</span> + <span class="hljs-string">"|"</span> + <span class="hljs-string">"-"</span> * <span class="hljs-number">13</span> + <span class="hljs-string">"|"</span> + <span class="hljs-string">"-"</span> * <span class="hljs-number">16</span> + <span class="hljs-string">"|"</span> + <span class="hljs-string">"-"</span> * <span class="hljs-number">11</span> + <span class="hljs-string">"|"</span> + <span class="hljs-string">"-"</span> * <span class="hljs-number">11</span> + <span class="hljs-string">"|"</span>)
    
    <span class="hljs-keyword">for</span> scenario, metrics <span class="hljs-keyword">in</span> all_results.items():
        time_str = format_time(metrics[<span class="hljs-string">"avg_time"</span>])
        speed_str = <span class="hljs-string">f"<span class="hljs-subst">{metrics[<span class="hljs-string">'avg_speed'</span>]:<span class="hljs-number">.2</span>f}</span> t/s"</span>
        tokens_str = <span class="hljs-string">f"<span class="hljs-subst">{metrics[<span class="hljs-string">'avg_tokens'</span>]:<span class="hljs-number">.1</span>f}</span>"</span>
        mem_str = <span class="hljs-string">f"<span class="hljs-subst">{metrics[<span class="hljs-string">'max_memory'</span>]:<span class="hljs-number">.2</span>f}</span> GB"</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"| <span class="hljs-subst">{scenario:&lt;<span class="hljs-number">15</span>}</span> | <span class="hljs-subst">{time_str:&lt;<span class="hljs-number">12</span>}</span> | <span class="hljs-subst">{speed_str:&lt;<span class="hljs-number">15</span>}</span> | <span class="hljs-subst">{tokens_str:&lt;<span class="hljs-number">10</span>}</span> | <span class="hljs-subst">{mem_str:&lt;<span class="hljs-number">10</span>}</span> |"</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">90</span>)
    
    <span class="hljs-comment"># æ˜¾ç¤ºè¯¦ç»†è¾“å‡ºæ ·æœ¬</span>
    display_banner(<span class="hljs-string">"ğŸ¨ ç”Ÿæˆç¤ºä¾‹"</span>)
    <span class="hljs-keyword">for</span> scenario, metrics <span class="hljs-keyword">in</span> all_results.items():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{scenario}</span> ç¤ºä¾‹:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“ æç¤º: "</span>{metrics[<span class="hljs-string">'prompt'</span>]}<span class="hljs-string">""</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœï¸  ç”Ÿæˆ: <span class="hljs-subst">{metrics[<span class="hljs-string">'sample_output'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">60</span>)

<span class="hljs-comment"># ========== ä¿å­˜ç»“æœ ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">save_results</span>(<span class="hljs-params">all_results</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> all_results:
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-comment"># ä¿å­˜è¯¦ç»†ç»“æœ</span>
    timestamp = time.strftime(<span class="hljs-string">"%Y%m%d_%H%M%S"</span>)
    filename = <span class="hljs-string">f"benchmark_results_<span class="hljs-subst">{timestamp}</span>.json"</span>
    
    serializable_results = {}
    <span class="hljs-keyword">for</span> scenario, metrics <span class="hljs-keyword">in</span> all_results.items():
        serializable_results[scenario] = {
            <span class="hljs-string">"avg_time"</span>: metrics[<span class="hljs-string">"avg_time"</span>],
            <span class="hljs-string">"avg_tokens"</span>: metrics[<span class="hljs-string">"avg_tokens"</span>],
            <span class="hljs-string">"avg_speed"</span>: metrics[<span class="hljs-string">"avg_speed"</span>],
            <span class="hljs-string">"max_memory"</span>: metrics[<span class="hljs-string">"max_memory"</span>],
            <span class="hljs-string">"sample_output"</span>: metrics[<span class="hljs-string">"sample_output"</span>],
            <span class="hljs-string">"prompt"</span>: metrics[<span class="hljs-string">"prompt"</span>]
        }
    
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        json.dump(serializable_results, f, indent=<span class="hljs-number">2</span>, ensure_ascii=<span class="hljs-literal">False</span>)
    
    <span class="hljs-comment"># ä¿å­˜ç®€åŒ–æŠ¥å‘Š</span>
    report_file = <span class="hljs-string">f"benchmark_report_<span class="hljs-subst">{timestamp}</span>.txt"</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(report_file, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">"é€šä¹‰åƒé—®2.5-7B-Instruct åŸºå‡†æµ‹è¯•æŠ¥å‘Š\n"</span>)
        f.write(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)
        f.write(<span class="hljs-string">f"æµ‹è¯•æ—¶é—´: <span class="hljs-subst">{time.ctime()}</span>\n"</span>)
        f.write(<span class="hljs-string">f"æ¨¡å‹è·¯å¾„: <span class="hljs-subst">{MODEL_NAME}</span>\n"</span>)
        f.write(<span class="hljs-string">f"æµ‹è¯•è¿­ä»£: <span class="hljs-subst">{TEST_STEPS}</span> æ¬¡\n"</span>)
        f.write(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n\n"</span>)
        
        <span class="hljs-keyword">for</span> scenario, metrics <span class="hljs-keyword">in</span> all_results.items():
            f.write(<span class="hljs-string">f"<span class="hljs-subst">{scenario}</span> æµ‹è¯•:\n"</span>)
            f.write(<span class="hljs-string">f"  - å¹³å‡ç”Ÿæˆæ—¶é—´: <span class="hljs-subst">{format_time(metrics[<span class="hljs-string">'avg_time'</span>])}</span>\n"</span>)
            f.write(<span class="hljs-string">f"  - å¹³å‡ç”Ÿæˆé€Ÿåº¦: <span class="hljs-subst">{metrics[<span class="hljs-string">'avg_speed'</span>]:<span class="hljs-number">.2</span>f}</span> tokens/ç§’\n"</span>)
            f.write(<span class="hljs-string">f"  - å¹³å‡ç”Ÿæˆé•¿åº¦: <span class="hljs-subst">{metrics[<span class="hljs-string">'avg_tokens'</span>]:<span class="hljs-number">.1</span>f}</span> tokens\n"</span>)
            f.write(<span class="hljs-string">f"  - å³°å€¼å†…å­˜ä½¿ç”¨: <span class="hljs-subst">{metrics[<span class="hljs-string">'max_memory'</span>]:<span class="hljs-number">.2</span>f}</span> GB\n"</span>)
            f.write(<span class="hljs-string">f"  - æµ‹è¯•æç¤º: "</span>{metrics[<span class="hljs-string">'prompt'</span>]}<span class="hljs-string">"\n"</span>)
            f.write(<span class="hljs-string">f"  - ç”Ÿæˆç¤ºä¾‹: <span class="hljs-subst">{metrics[<span class="hljs-string">'sample_output'</span>]}</span>\n"</span>)
            f.write(<span class="hljs-string">"-"</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n\n"</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nâœ… ç»“æœå·²ä¿å­˜è‡³:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ“ è¯¦ç»†æ•°æ®: <span class="hljs-subst">{filename}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ“ ç®€æ˜æŠ¥å‘Š: <span class="hljs-subst">{report_file}</span>"</span>)

<span class="hljs-comment"># ========== ä¸»ç¨‹åº ==========</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸŒŸ é€šä¹‰åƒé—®2.5-7B-Instruct åŸºå‡†æµ‹è¯•å·¥å…· ğŸŒŸ"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ”§ é…ç½®å‚æ•°:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ§ª æ¨¡å‹è·¯å¾„: <span class="hljs-subst">{MODEL_NAME}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ”¥ é¢„çƒ­æ¬¡æ•°: <span class="hljs-subst">{WARMUP_STEPS}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ“Š æµ‹è¯•è¿­ä»£: <span class="hljs-subst">{TEST_STEPS}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ğŸ“ ç”Ÿæˆé•¿åº¦: <span class="hljs-subst">{MAX_NEW_TOKENS}</span> tokens"</span>)
    
    <span class="hljs-comment"># æ‰§è¡ŒåŸºå‡†æµ‹è¯•</span>
    results, model, tokenizer = benchmark_model()
    
    <span class="hljs-comment"># æ˜¾ç¤ºå’Œä¿å­˜ç»“æœ</span>
    <span class="hljs-keyword">if</span> results:
        display_results(results)
        save_results(results)
        
        <span class="hljs-comment"># æ¸…ç†èµ„æº</span>
        <span class="hljs-keyword">if</span> model:
            <span class="hljs-keyword">del</span> model
        <span class="hljs-keyword">if</span> tokenizer:
            <span class="hljs-keyword">del</span> tokenizer
        torch.cuda.empty_cache()
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ‰ åŸºå‡†æµ‹è¯•å®Œæˆ! GPUå†…å­˜å·²æ¸…ç†."</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nâŒ åŸºå‡†æµ‹è¯•æœªèƒ½å®Œæˆï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯ã€‚"</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nğŸ’¡ æç¤º: è¦è·å¾—æ›´å‡†ç¡®çš„ç»“æœï¼Œå¯å¢åŠ TEST_STEPSçš„å€¼ã€‚"</span>)
</code></pre>
<p>æ‰§è¡ŒåŸºå‡†æµ‹è¯•è„šæœ¬</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c9a61d23ac54cbbb9430645b4d2f273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=nHNV0k8jayxdAUbiWFTEICXxvzk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/225e4d803a3e4919a20cf4dec5f85971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=EJEazrVPHB7KuONBZIbak9OCpaI%3D" alt="" loading="lazy"/></p>
<p>ç”Ÿæˆçš„åŸºå‡†æµ‹è¯•æŠ¥å‘Šï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b908b4676974ad6938954be98f7d16b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763369759&amp;x-signature=ejsMvMqU%2BWJCKPTT%2Fr16XL8pHKM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">åŸºå‡†æµ‹è¯•åˆ†ææŠ¥å‘Š</h4>
<h5 data-id="heading-20">ğŸ“Œ æ¦‚è§ˆæ‘˜è¦</h5>
<p><strong>æµ‹è¯•æ—¶é—´</strong>ï¼š2025å¹´11æœˆ10æ—¥ 06:58:01<br/>
<strong>æµ‹è¯•æ¨¡å‹</strong>ï¼šQwen2.5-7B-Instruct<br/>
<strong>ç¡¬ä»¶ç¯å¢ƒ</strong>ï¼šNVIDIA RTX 4090 (24GBæ˜¾å­˜)<br/>
<strong>æµ‹è¯•è½®æ¬¡</strong>ï¼š3æ¬¡è¿­ä»£/åœºæ™¯</p>
<p>ğŸ’¡ <strong>å…³é”®å‘ç°</strong>ï¼šè¯¥æ¨¡å‹åœ¨å„ç§ä»»åŠ¡ç±»å‹ä¸­è¡¨ç°å‡è¡¡ï¼Œå¹³å‡æ¨ç†é€Ÿåº¦è¾¾ <strong>55.72 tokens/ç§’</strong>ï¼Œå†…å­˜å ç”¨ç¨³å®šåœ¨ <strong>14.21GB</strong>ï¼Œä¸­æ–‡ä¸è‹±æ–‡å¤„ç†èƒ½åŠ›ç›¸å½“ï¼Œé€‚åˆå¤šåœºæ™¯éƒ¨ç½²ã€‚</p>
<hr/>
<h5 data-id="heading-21">ğŸ§ª æµ‹è¯•ç¯å¢ƒä¸æ–¹æ³•</h5>





























<table><thead><tr><th>é¡¹ç›®</th><th>é…ç½®</th></tr></thead><tbody><tr><td><strong>æ¨¡å‹è·¯å¾„</strong></td><td><code>/root/.cache/modelscope/hub/models/Qwen/Qwen2.5-7B-Instruct</code></td></tr><tr><td><strong>è®¡ç®—è®¾å¤‡</strong></td><td>NVIDIA GeForce RTX 4090 (24GB VRAM)</td></tr><tr><td><strong>æ•°æ®ç±»å‹</strong></td><td>bfloat16</td></tr><tr><td><strong>æœ€å¤§ç”Ÿæˆé•¿åº¦</strong></td><td>128 tokens</td></tr><tr><td><strong>é‡‡æ ·å‚æ•°</strong></td><td>temperature=0.7, top_p=0.9</td></tr></tbody></table>
<h5 data-id="heading-22">æµ‹è¯•æ–¹æ³•</h5>
<ul>
<li><strong>é¢„çƒ­æ­¥éª¤</strong>ï¼š1æ¬¡é¢„çƒ­è¿è¡Œï¼Œæ’é™¤é¦–æ¬¡åŠ è½½å¼€é”€</li>
<li><strong>æ­£å¼æµ‹è¯•</strong>ï¼š3æ¬¡è¿­ä»£ï¼Œå–å¹³å‡å€¼</li>
<li><strong>å†…å­˜ç›‘æ§</strong>ï¼šè®°å½•å³°å€¼GPUå†…å­˜å ç”¨</li>
<li><strong>å¤šåœºæ™¯è¦†ç›–</strong>ï¼š5ç§ä¸åŒä»»åŠ¡ç±»å‹ï¼Œå…¨é¢è¯„ä¼°æ¨¡å‹èƒ½åŠ›</li>
</ul>
<hr/>
<h5 data-id="heading-23">ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡æ±‡æ€»</h5>






















































<table><thead><tr><th>æµ‹è¯•åœºæ™¯</th><th>å¹³å‡æ—¶é—´</th><th>ç”Ÿæˆé€Ÿåº¦</th><th>ç”Ÿæˆé•¿åº¦</th><th>å†…å­˜å ç”¨</th></tr></thead><tbody><tr><td>ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç”Ÿæˆ</td><td>2.24ç§’</td><td>55.63 t/s</td><td>124.7 tokens</td><td>14.21 GB</td></tr><tr><td>ğŸ‡ºğŸ‡¸ è‹±æ–‡ç”Ÿæˆ</td><td>2.20ç§’</td><td>55.79 t/s</td><td>123.0 tokens</td><td>14.21 GB</td></tr><tr><td>ğŸ§  é€»è¾‘æ¨ç†</td><td>2.30ç§’</td><td>55.66 t/s</td><td>128.0 tokens</td><td>14.21 GB</td></tr><tr><td>ğŸ’» ä»£ç ç”Ÿæˆ</td><td>2.30ç§’</td><td>55.77 t/s</td><td>128.0 tokens</td><td>14.21 GB</td></tr><tr><td>ğŸ“– çŸ¥è¯†é—®ç­”</td><td>2.30ç§’</td><td>55.75 t/s</td><td>128.0 tokens</td><td>14.21 GB</td></tr><tr><td><strong>å¹³å‡å€¼</strong></td><td><strong>2.27ç§’</strong></td><td><strong>55.72 t/s</strong></td><td><strong>126.3 tokens</strong></td><td><strong>14.21 GB</strong></td></tr></tbody></table>
<h5 data-id="heading-24">ğŸ“Š æ€§èƒ½åˆ†æå›¾è¡¨</h5>
<pre><code class="hljs language-scss" lang="scss">ç”Ÿæˆé€Ÿåº¦å¯¹æ¯” (tokens/ç§’)
ğŸ‡ºğŸ‡¸ è‹±æ–‡ç”Ÿæˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ <span class="hljs-number">55.79</span>
ğŸ’» ä»£ç ç”Ÿæˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ <span class="hljs-number">55.77</span>
ğŸ“– çŸ¥è¯†é—®ç­”   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ <span class="hljs-number">55.75</span>
ğŸ§  é€»è¾‘æ¨ç†   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ <span class="hljs-number">55.66</span>
ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç”Ÿæˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ <span class="hljs-number">55.63</span>
</code></pre>
<hr/>
<h5 data-id="heading-25">ğŸ” è¯¦ç»†åœºæ™¯åˆ†æ</h5>
<ol>
<li>ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç”Ÿæˆèƒ½åŠ›</li>
</ol>
<p><strong>æµ‹è¯•æç¤º</strong>ï¼š"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘æƒ³å»"<br/>
<strong>è¡¨ç°äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆå†…å®¹è‡ªç„¶æµç•…ï¼Œç¬¦åˆä¸­æ–‡è¡¨è¾¾ä¹ æƒ¯</li>
<li>èƒ½è¿›è¡Œå¤šè½®å¯¹è¯å¼å›åº”ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§</li>
<li>ç”Ÿæˆé€Ÿåº¦ï¼š55.63 tokens/ç§’ï¼ˆæ¥è¿‘æ•´ä½“å¹³å‡å€¼ï¼‰</li>
</ul>
<p><strong>ç”Ÿæˆè´¨é‡è¯„ä¼°</strong>ï¼šâ˜…â˜…â˜…â˜…â˜†<br/>
å†…å®¹è¿è´¯ã€å®ç”¨ï¼Œå±•ç¤ºäº†è‰¯å¥½çš„ä¸­æ–‡å¯¹è¯èƒ½åŠ›ï¼Œä½†åœ¨ç»†èŠ‚ä¸Šï¼ˆå¦‚æˆ·å¤–æ´»åŠ¨å»ºè®®ï¼‰å¯æ›´å…·ä½“ã€‚</p>
<hr/>
<ol start="2">
<li>ğŸ‡ºğŸ‡¸ è‹±æ–‡ç”Ÿæˆèƒ½åŠ›</li>
</ol>
<p><strong>æµ‹è¯•æç¤º</strong>ï¼š"The capital of France is"<br/>
<strong>è¡¨ç°äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>5ç§åœºæ™¯ä¸­é€Ÿåº¦æœ€å¿«ï¼ˆ55.79 tokens/ç§’ï¼‰</li>
<li>èƒ½æä¾›å‡†ç¡®ä¿¡æ¯å¹¶è‡ªåŠ¨çº æ­£é”™è¯¯ï¼ˆæŒ‡å‡ºå·´é»åœ¨æ³•å›½åŒ—éƒ¨ä¸­åŒºè€Œéçº¯åŒ—éƒ¨ï¼‰</li>
<li>å±•ç¤ºäº†è‰¯å¥½çš„åœ°ç†çŸ¥è¯†</li>
</ul>
<p><strong>ç”Ÿæˆè´¨é‡è¯„ä¼°</strong>ï¼šâ˜…â˜…â˜…â˜…â˜…<br/>
å†…å®¹å‡†ç¡®ã€ä¿¡æ¯ä¸°å¯Œï¼Œè¡¨ç°å‡ºä¼˜ç§€çš„è‹±æ–‡çŸ¥è¯†å‹æ–‡æœ¬ç”Ÿæˆèƒ½åŠ›ã€‚</p>
<hr/>
<ol start="3">
<li>ğŸ§  é€»è¾‘æ¨ç†èƒ½åŠ›</li>
</ol>
<p><strong>æµ‹è¯•æç¤º</strong>ï¼š"å¦‚æœæ‰€æœ‰çš„Aéƒ½æ˜¯Bï¼Œè€Œæ‰€æœ‰çš„Béƒ½æ˜¯Cï¼Œé‚£ä¹ˆæ‰€æœ‰çš„Aæ˜¯Cå—ï¼Ÿè¯·è¯¦ç»†è§£é‡Šã€‚"<br/>
<strong>è¡¨ç°äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>èƒ½æ­£ç¡®è¯†åˆ«é€»è¾‘ä¼ é€’åŸåˆ™</li>
<li>æä¾›ç»“æ„åŒ–è§£é‡Šï¼ˆå‰ææ¡ä»¶ã€ä¼ é€’æ€§åˆ†æï¼‰</li>
<li>ç”Ÿæˆå†…å®¹æ¡ç†æ¸…æ™°ï¼Œå±•ç¤ºäº†è‰¯å¥½çš„é€»è¾‘æ€ç»´èƒ½åŠ›</li>
</ul>
<p><strong>ç”Ÿæˆè´¨é‡è¯„ä¼°</strong>ï¼šâ˜…â˜…â˜…â˜…â˜†<br/>
é€»è¾‘ä¸¥è°¨ï¼Œæ¡ç†åˆ†æ˜ï¼Œä½†è§£é‡Šå¯æ›´æ·±å…¥ï¼Œä¾‹å¦‚ä¸¾ä¾‹è¯´æ˜ã€‚</p>
<hr/>
<ol start="4">
<li>ğŸ’» ä»£ç ç”Ÿæˆèƒ½åŠ›</li>
</ol>
<p><strong>æµ‹è¯•æç¤º</strong>ï¼š"ç”¨Pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åºç®—æ³•"<br/>
<strong>è¡¨ç°äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>èƒ½æä¾›å®Œæ•´çš„ç®—æ³•æ¡†æ¶</li>
<li>åŒ…å«å¿…è¦çš„æ³¨é‡Šè¯´æ˜</li>
<li>éµå¾ªPythonæœ€ä½³å®è·µ</li>
</ul>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆåœ¨128 tokensé™åˆ¶å¤„è¢«æˆªæ–­ï¼Œæœªå±•ç¤ºå®Œæ•´ç®—æ³•</li>
<li>éœ€è¦æ›´å¤§ç”Ÿæˆé•¿åº¦ä»¥è¯„ä¼°å®Œæ•´ä»£ç èƒ½åŠ›</li>
</ul>
<p><strong>ç”Ÿæˆè´¨é‡è¯„ä¼°</strong>ï¼šâ˜…â˜…â˜…â˜†â˜†<br/>
ä»£ç ç»“æ„æ­£ç¡®ï¼Œä½†å—é•¿åº¦é™åˆ¶æœªèƒ½å±•ç¤ºå®Œæ•´å®ç°ã€‚</p>
<hr/>
<ol start="5">
<li>ğŸ“– çŸ¥è¯†é—®ç­”èƒ½åŠ›</li>
</ol>
<p><strong>æµ‹è¯•æç¤º</strong>ï¼š"é‡å­åŠ›å­¦ä¸­çš„è–›å®šè°”æ–¹ç¨‹æ˜¯ç”¨æ¥æè¿°ä»€ä¹ˆçš„ï¼Ÿ"<br/>
<strong>è¡¨ç°äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>èƒ½åŒºåˆ†éç›¸å¯¹è®ºæ€§ä¸ç›¸å¯¹è®ºæ€§è–›å®šè°”æ–¹ç¨‹</li>
<li>å°è¯•ä½¿ç”¨æ•°å­¦å…¬å¼è¡¨è¾¾ï¼ˆè™½ç„¶è¢«æˆªæ–­ï¼‰</li>
<li>å†…å®¹ä¸“ä¸šæ€§å¼ºï¼Œæ˜¾ç¤ºå‡ºè‰¯å¥½çš„ç§‘å­¦çŸ¥è¯†åŸºç¡€</li>
</ul>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>åŒæ ·å—128 tokensé•¿åº¦é™åˆ¶ï¼Œå…³é”®å…¬å¼æœªèƒ½å®Œæ•´å±•ç¤º</li>
</ul>
<p><strong>ç”Ÿæˆè´¨é‡è¯„ä¼°</strong>ï¼šâ˜…â˜…â˜…â˜…â˜†<br/>
ä¸“ä¸šå‡†ç¡®ï¼Œä½†éœ€è¦æ›´é•¿ç”Ÿæˆé•¿åº¦ä»¥å……åˆ†å±•ç¤ºçŸ¥è¯†æ·±åº¦ã€‚</p>
<hr/>
<h5 data-id="heading-26">ğŸ’ å…³é”®ç»“è®ºä¸å»ºè®®</h5>
<p>æ ¸å¿ƒä¼˜åŠ¿</p>
<ol>
<li><strong>æ€§èƒ½å‡è¡¡</strong>ï¼šæ‰€æœ‰æµ‹è¯•åœºæ™¯è¡¨ç°ç¨³å®šï¼Œæ— æ˜æ˜¾çŸ­æ¿</li>
<li><strong>å¤šè¯­è¨€èƒ½åŠ›</strong>ï¼šä¸­è‹±æ–‡å¤„ç†èƒ½åŠ›æ¥è¿‘ï¼Œå‡è¶…è¿‡55 tokens/ç§’</li>
<li><strong>å†…å­˜æ•ˆç‡é«˜</strong>ï¼šç¨³å®šä½¿ç”¨14.21GBæ˜¾å­˜ï¼Œé€‚åˆ24GBæ˜¾å­˜è®¾å¤‡éƒ¨ç½²</li>
<li><strong>ä»»åŠ¡é€‚åº”æ€§å¼º</strong>ï¼šä»å¯¹è¯åˆ°ä¸“ä¸šçŸ¥è¯†å‡æœ‰è‰¯å¥½è¡¨ç°</li>
</ol>
<p>ä¼˜åŒ–å»ºè®®</p>
<ol>
<li><strong>è°ƒæ•´ç”Ÿæˆé•¿åº¦</strong>ï¼šé’ˆå¯¹çŸ¥è¯†å‹å’Œä»£ç ç”Ÿæˆä»»åŠ¡ï¼Œå»ºè®®å¢åŠ æœ€å¤§ç”Ÿæˆé•¿åº¦è‡³256+ tokens</li>
<li><strong>æ‰¹å¤„ç†ä¼˜åŒ–</strong>ï¼šå½“å‰æµ‹è¯•ä¸ºbatch_size=1ï¼Œå¯æµ‹è¯•æ›´å¤§æ‰¹æ¬¡æå‡ååé‡</li>
<li><strong>é‡åŒ–éƒ¨ç½²</strong>ï¼šè€ƒè™‘INT8/INT4é‡åŒ–ï¼Œåœ¨ä¿æŒæ€§èƒ½çš„åŒæ—¶è¿›ä¸€æ­¥é™ä½å†…å­˜å ç”¨</li>
<li><strong>åœºæ™¯ç‰¹å®šå¾®è°ƒ</strong>ï¼šå¯¹ä»£ç ç”Ÿæˆå’Œä¸“ä¸šé—®ç­”åœºæ™¯å¯è¿›è¡Œé’ˆå¯¹æ€§å¾®è°ƒï¼Œæå‡ä¸“ä¸šèƒ½åŠ›</li>
</ol>
<p>éƒ¨ç½²æ¨è</p>
<ul>
<li><strong>å¼€å‘æµ‹è¯•ç¯å¢ƒ</strong>ï¼šå®Œå…¨é€‚ç”¨ï¼Œå“åº”é€Ÿåº¦å¿«</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼šé€‚åˆä¸­ç­‰æµé‡APIæœåŠ¡ï¼Œå•å®ä¾‹å¯æ”¯æ’‘çº¦20-30 QPSï¼ˆå–å†³äºè¯·æ±‚é•¿åº¦ï¼‰</li>
<li><strong>æœ€ä½³åº”ç”¨åœºæ™¯</strong>ï¼šèŠå¤©åŠ©æ‰‹ã€çŸ¥è¯†é—®ç­”ç³»ç»Ÿã€å†…å®¹åˆ›ä½œè¾…åŠ©ã€åŸºç¡€ä»£ç ç”Ÿæˆ</li>
</ul>
<p>âœ… <strong>æ€»ç»“</strong>ï¼šé€šä¹‰åƒé—®2.5-7B-Instructå±•ç°å‡ºäº†å¼ºå¤§çš„ç»¼åˆèƒ½åŠ›ï¼Œåœ¨ä¿æŒé«˜æ•ˆæ¨ç†é€Ÿåº¦çš„åŒæ—¶ï¼Œèƒ½å¤Ÿèƒœä»»å¤šç§ä»»åŠ¡ç±»å‹ï¼Œæ˜¯7Bçº§åˆ«æ¨¡å‹ä¸­çš„ä¼˜ç§€é€‰æ‹©ï¼Œç‰¹åˆ«é€‚åˆä¸­æ–‡åœºæ™¯çš„AIåº”ç”¨éƒ¨ç½²ã€‚</p>
<h3 data-id="heading-27">æ€»ç»“</h3>
<p>å…±ç»©ç®—åŠ›å¹³å°ä»£è¡¨äº†ç®—åŠ›èµ„æºåˆ†é…æ¨¡å¼çš„åˆ›æ–°çªç ´ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºé€šè¿‡"å…±äº«ç»æµ"æ¨¡å¼é‡æ„äº†AIç®—åŠ›å¸‚åœºæ ¼å±€ã€‚ä¸åŒäºä¼ ç»Ÿäº‘æœåŠ¡å•†çš„é«˜æˆæœ¬å’Œè‡ªå»ºé›†ç¾¤çš„é‡èµ„äº§æ¨¡å¼ï¼Œå…±ç»©ç®—åŠ›å®ç°äº†ä¸‰ä¸ªç»´åº¦çš„é©å‘½æ€§å˜é©ï¼šç»æµç»´åº¦ä¸Šï¼Œå°†é¡¶çº§GPUç®—åŠ›æˆæœ¬é™è‡³1.68å…ƒ/å°æ—¶ï¼ŒæŒ‰ç§’è®¡è´¹é¿å…èµ„æºæµªè´¹ï¼›æŠ€æœ¯ç»´åº¦ä¸Šï¼Œé€šè¿‡æ™ºèƒ½è°ƒåº¦ç®—æ³•æ•´åˆç¢ç‰‡åŒ–ç®—åŠ›ï¼Œè¾¾æˆ60%çš„èµ„æºåˆ©ç”¨ç‡æå‡ï¼›ç”Ÿæ€ç»´åº¦ä¸Šï¼Œå°†é—²ç½®ç®—åŠ›è½¬åŒ–ä¸ºæ™®æƒ AIåŸºç¡€è®¾æ–½ï¼Œè·µè¡Œ"ä½¿AIæŠ€æœ¯çœŸæ­£æ™®åŠè‡³æ¯ä¸ªäºº"çš„ä½¿å‘½ã€‚è¿™ç§æ¨¡å¼ä¸ä»…è§£å†³äº†ä¸­å°ä¼ä¸šå’Œä¸ªäººå¼€å‘è€…çš„"ç®—åŠ›ç„¦è™‘"ï¼Œæ›´ä¸ºä¸­å›½AIäº§ä¸šæ„å»ºäº†æ›´å…·éŸ§æ€§å’Œå¯æŒç»­æ€§çš„åº•å±‚åŸºç¡€è®¾æ–½ã€‚å½“ä¸€å°æ™®é€šç”µè„‘çš„é—²ç½®ç®—åŠ›ä¹Ÿèƒ½å‚ä¸å¤§æ¨¡å‹æ¨ç†ï¼Œç®—åŠ›æ°‘ä¸»åŒ–çš„æ–°æ—¶ä»£å·²ç„¶åˆ°æ¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒåä¸€å°†è‡³ï¼Œç”¨Rulesç©è½¬ç”µå•†åœºæ™¯ææ•ˆ]]></title>    <link>https://juejin.cn/post/7570901172526628899</link>    <guid>https://juejin.cn/post/7570901172526628899</guid>    <pubDate>2025-11-10T09:11:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526628899" data-draft-id="7570651893870968884" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒåä¸€å°†è‡³ï¼Œç”¨Rulesç©è½¬ç”µå•†åœºæ™¯ææ•ˆ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T09:11:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–‡å¿ƒå¿«ç BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒåä¸€å°†è‡³ï¼Œç”¨Rulesç©è½¬ç”µå•†åœºæ™¯ææ•ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–‡å¿ƒå¿«ç BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:11:24.000Z" title="Mon Nov 10 2025 09:11:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŒåä¸€å°†è‡³ï¼Œç»“åˆç”µå•†åœºæ™¯ï¼Œæ¥èŠèŠå¦‚ä½• <strong>â€œè®©AIå†™ä»£ç æ›´çœå¿ƒâ€</strong> â€”â€”<strong>ä½¿ç”¨Ruleså¸®åŠ©è§£å†³ â€œAIå†™ä»£ç æ€»è·‘åâ€</strong> çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-0">01 ä»€ä¹ˆæ˜¯Rules&amp;å¦‚ä½•ä½¿ç”¨Rules</h2>
<p><strong>Rulesæ˜¯ä»€ä¹ˆå‘¢â€”â€”</strong> æ˜¯â¼€ç»„è§„åˆ™/æŒ‡ä»¤ï¼Œâ½¤æ¥æ•™AIåœ¨ç‰¹å®šé¡¹â½¬æˆ–æ¡†æ¶ä¸­åº”è¯¥éµå®ˆçš„æ¨¡å¼ã€æœ€ä½³å®è·µå’Œçº¦æŸï¼Œåšå¥½è¿™ä¸ªè§„åˆ™â½‚ä»¶ï¼Œå¯ä»¥æ˜¾è‘—æå‡AIâ½£æˆä»£ç çš„è´¨é‡ã€â¼€è‡´æ€§ï¼Œå‡å°‘ä¹‹åâ¼ˆâ¼¯ä¿®æ­£çš„â¼¯ä½œã€‚</p>
<p>å¯ä»¥æŠŠRulesæƒ³è±¡æˆ <strong>â€œè¡Œä¸ºè¯´æ˜ä¹¦â€æˆ–è€…â€œå·¥ä½œå®ˆåˆ™â€ï¼š</strong></p>
<ul>
<li>å¯¹äººæ¥è¯´ï¼ŒRuleså°±åƒâ€œå…¬å¸å‘˜å·¥æ‰‹å†Œâ€ğŸ‘‰ è®©æ–°åŒäº‹çŸ¥é“è¦éµå®ˆä»€ä¹ˆæµç¨‹ã€ä¸èƒ½ä¹±æ”¹é…ç½®ï¼›</li>
<li><strong>å¯¹AIæ¥è¯´ï¼ŒRuleså°±æ˜¯â€œç¼–ç¨‹å¯¼èˆªå›¾â€</strong> ğŸ‘‰ è®© AI æ˜ç™½é¡¹ç›®ç»“æ„åœ¨å“ªã€è¯¥ç”¨ä»€ä¹ˆå‘½ä»¤å¯åŠ¨ã€è¦æ³¨æ„å“ªäº›ç»†èŠ‚ã€‚</li>
</ul>
<p>å®é™…å¼€å‘ä¸­ï¼ŒRuleså¯ä»¥ç†è§£ä¸ºä¸€å¥—<strong>é¡¹ç›®çº§çš„â€œå¼€å‘çº¦æŸä¸è§„èŒƒâ€</strong> ï¼Œå¸®åŠ©ç»Ÿä¸€AIçš„ç¼–ç è¡Œä¸ºï¼Œ<strong>è®©ç”Ÿæˆçš„ä»£ç æ›´ç¬¦åˆå›¢é˜Ÿä¹ æƒ¯ã€é¡¹ç›®æ¶æ„å’Œä¸šåŠ¡åœºæ™¯</strong>ã€‚æ¥çœ‹çœ‹ç”µå•†å›¢é˜Ÿåœ¨å®é™…å·¥ä½œä¸­æ˜¯å¦‚ä½•åº”ç”¨Rulesçš„ï¼š</p>
<p>1ã€åœ¨Rulesä¸­å®šä¹‰ç¯å¢ƒä¾èµ–ã€å¯åŠ¨å‘½ä»¤ã€ç›®å½•ç»“æ„ç­‰ï¼Œé¿å…AI â€œè‡ªç”±å‘æŒ¥â€ï¼›</p>
<p>2ã€é’ˆå¯¹ç”µå•†ä¸šåŠ¡ï¼Œ<strong>è®¾ç½®ä¸šåŠ¡è§„åˆ™</strong>ï¼Œæ¯”å¦‚æ‰€æœ‰çš„ä»·æ ¼å±•ç¤ºç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªç»„ä»¶ã€æ¶‰åŠåˆ°çš„è®¢å•çŠ¶æ€ç»Ÿä¸€ç»´æŠ¤ä¸€ä¸ªç»„ä»¶ç­‰ï¼›</p>
<p>3ã€<strong>åŠ å…¥å›¢é˜Ÿä»£ç è§„èŒƒå’Œå®‰å…¨è¦æ±‚</strong>ï¼Œä¾‹å¦‚åœ¨ä»£ç ä¸­ä¸èƒ½éšæ„å¼•ç”¨npmåŒ…ã€å†™æ³•é£æ ¼ç”Ÿæˆä¸€è‡´ç­‰ï¼›</p>
<p>4ã€å®šä¹‰<strong>é”™è¯¯å¤„ç†æœºåˆ¶</strong>ï¼Œæ¯”å¦‚æ‰€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œéƒ½ä½¿ç”¨ç»Ÿä¸€çš„æœºåˆ¶å¤„ç†ï¼ˆä¾‹å¦‚ç»Ÿä¸€å¼¹å‡ºé”™è¯¯ä¿¡æ¯ã€å¼‚å¸¸æ•è·ç­‰ï¼‰ã€‚</p>
<p><strong>Ruleså°±åƒæ˜¯å›¢é˜Ÿçš„â€œAIå¯¼å¸ˆâ€ï¼š</strong></p>
<p><strong>1ï¼‰å¯¹æ–°äººå‹å¥½ï¼š</strong> å³ä½¿æ˜¯ä¸ç†Ÿæ‚‰é¡¹ç›®çš„æ–°åŒå­¦ï¼Œä¹Ÿèƒ½é€šè¿‡ Rules å¿«é€Ÿäº†è§£é¡¹ç›®è§„èŒƒå’Œæœ€ä½³å®è·µã€‚</p>
<p><strong>2ï¼‰å¯¹AIå¯æ§ï¼š</strong> è®©AIç”Ÿæˆçš„ä»£ç â€œå¼€ç®±å³ç”¨â€ï¼Œå‡å°‘äººå·¥reviewå’Œä¿®æ”¹æˆæœ¬ã€‚</p>
<p><strong>3ï¼‰æ¶æ„ä¸€è‡´ï¼š</strong> ç¡®ä¿ä»£ç é£æ ¼ã€ç›®å½•ç»“æ„ã€æŠ€æœ¯æ ˆç»Ÿä¸€ï¼Œç»´æŠ¤æ€§æ›´å¼ºã€‚</p>
<h2 data-id="heading-1">02 ç”µå•†åœºæ™¯ä¸‹ï¼Œæœªé…ç½®Rulesçš„é—®é¢˜</h2>
<p>ç›¸ä¿¡å¤§å®¶å¹³æ—¶éƒ½æœ‰ç½‘è´­ç»éªŒï¼Œè‚¯å®šè¦å…³æ³¨æ‰€è´­ä¹°å•†å“çš„çŠ¶æ€ï¼Œä»¥è®¢å•è¯¦æƒ…é¡µä¸ºä¾‹ï¼šæ ¹æ®è®¾è®¡ç¨¿ï¼Œé€šè¿‡Figma to Codeæ¨¡å¼ç”Ÿæˆä¸€ä¸ªè®¢å•è¯¦æƒ…é¡µã€‚</p>
<blockquote>
<p>è¯´æ˜ï¼šFigma to Codeæ˜¯Zulué’ˆå¯¹å‰ç«¯åœºæ™¯å¼€å‘çš„åŠŸèƒ½ï¼Œåœ¨ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œè®¾è®¡å¸ˆå‡ºå›¾ã€å‰ç«¯å†æ‰‹å†™é¡µé¢çš„æµç¨‹è¢«å¤§å¤§ç®€åŒ–äº†ã€‚å¦‚â€œè®¢å•è¯¦æƒ…é¡µâ€è®¾è®¡ç¨¿ï¼Œé€šè¿‡Figma to Codeæ¨¡å¼ï¼Œåªéœ€è¦å°†è®¾è®¡ç¨¿å¯¼å…¥ç³»ç»Ÿï¼Œå°±èƒ½è‡ªåŠ¨ç”Ÿæˆå¯è¿è¡Œçš„é¡µé¢åŸå‹ã€‚</p>
</blockquote>
<p>ç”Ÿæˆè§†é¢‘ğŸ‘‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQaZL34zk094i-BYWT_l55g" target="_blank" title="https://mp.weixin.qq.com/s/QaZL34zk094i-BYWT_l55g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/QaZL34zk0â€¦</a></p>
<p>ä»¥ä¸Šçš„ç”Ÿæˆè¿‡ç¨‹ï¼Œ<strong>åœ¨æ²¡æœ‰Rulesçš„æƒ…å†µä¸‹æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<p>å½“å‰ï¼Œæ•°æ®æ˜¯æŒ‰ä¸€ä¸ªä¸€ä¸ªæ¸²æŸ“çš„ï¼Œè€Œä¸æ˜¯æ•°ç»„å½¢å¼æ¸²æŸ“ï¼›å­˜åœ¨CSSæ–‡ä»¶çš„styleæ²¡æœ‰ç”¨åˆ°lang="lessâ€,ç”Ÿæˆçš„æ–‡ä»¶é»˜è®¤ç”¨äº†â€œåŸå§‹pxâ€çš„å†™æ³•ï¼›å›¾æ ‡ç”¨çš„æ˜¯ç¬¦å·ï¼Œè€Œä¸æ˜¯ç»„ä»¶iconã€‚Comate<strong>ç”Ÿæˆçš„ä»£ç æ²¡æœ‰åˆç†ä½¿ç”¨å›¢é˜Ÿæ‰€å¼•ç”¨çš„ç»„ä»¶åº“ã€ä¹Ÿæ²¡æœ‰æ‹†æˆç‰¹åˆ«ç»†çš„ç»„ä»¶ï¼ŒCSSçš„å†™æ³•ä¹Ÿä¸æ˜¯ç ”å‘æ‰€è¦æ±‚çš„</strong>ã€‚æ­¤å¤–ï¼Œè¿˜ä¼šæœ‰ä¸€äº›é€šç”¨æ€§é—®é¢˜ï¼Œ<strong>ä¾‹å¦‚æ ·å¼æ²¡æœ‰æŒ‰è¦æ±‚çš„è§„èŒƒå»å†™ã€ç»„ä»¶çš„é¢—ç²’åº¦ä¸å¤Ÿç­‰ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1a72d8ec13401ba509c38e7ec31870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370683&amp;x-signature=i%2FSJ26B2jIxa3JIT9x8e31JJn0M%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>æœªé…ç½®Rulesï¼Œè®¢å•è¯¦æƒ…é¡µç”Ÿæˆçš„ç»“æœ</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿåˆ‡æ¢åˆ°å½“å‰çš„ä»£ç ç”Ÿæˆç•Œé¢ï¼Œè¾“å…¥å¯¹è¯å¹¶å¼•å¯¼æ”¹å–„ã€‚åœ¨æ²¡æœ‰Rulesçš„åœºæ™¯ä¸‹ï¼Œæ¨¡å‹å¹¶ä¸çŸ¥é“å…·ä½“çš„ä¸šåŠ¡è§„åˆ™ã€ä»£ç è§„èŒƒæˆ–è€…æ ·å¼è¦æ±‚ã€‚æƒ³è¦ä¿®æ”¹ä¸€äº›é—®é¢˜ï¼ˆæ¯”å¦‚ä»£ç æ ¼å¼ä¸å¯¹ã€CSSå†™æ³•ä¸è§„èŒƒã€å¸ƒå±€è·‘åç­‰ï¼‰ï¼Œåªèƒ½ä¾é å’Œæ¨¡å‹çš„å¯¹è¯äº¤äº’ï¼ˆPromptï¼‰æ¥ä¸€æ­¥æ­¥å¼•å¯¼å®ƒè°ƒæ•´ï¼Œ<strong>æ¯æ¬¡æ”¹åŠ¨éƒ½éœ€è¦é‡æ–°è¾“å…¥Promptï¼Œæ˜ç¡®å‘Šè¯‰æ¨¡å‹è¦æ”¹å“ªé‡Œã€æ€ä¹ˆæ”¹ã€‚</strong></p>
<p>ä¸€æ¬¡æ¬¡â€œäººå·¥æŒ‡å¯¼â€â€”â€”è™½ç„¶çµæ´»ï¼Œä½†æˆæœ¬ä¹Ÿæ¯”è¾ƒé«˜ã€‚éšç€ä¸Šä¸‹æ–‡è¶Šæ¥è¶Šå¤šï¼ŒPromptçš„é•¿åº¦ä¹Ÿä¼šå¢åŠ ï¼Œ<strong>tokenæ¶ˆè€—å˜é«˜ï¼Œæ¨¡å‹å“åº”é€Ÿåº¦ä¹Ÿä¼šå˜æ…¢</strong>ã€‚å¦‚æœé—®é¢˜è¿‡å¤šï¼Œä½¿ç”¨è‡ªç„¶è¯­è¨€äº¤äº’å°±ä¼šæ¯”è¾ƒå›°éš¾ã€‚</p>
<p>æœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼Œèƒ½è®©æ¨¡å‹â€œè®°ä½â€è¿™äº›é€šç”¨è§„èŒƒï¼Ÿ<strong>æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡é…ç½®Rulesçš„æ–¹å¼ï¼Œè®©è¿™äº›äº¤äº’è‡ªåŠ¨åŒ–ï¼Ÿ</strong> ä»è€Œå®ç°<strong>ä¸€æ¬¡é…ç½®ï¼Œé•¿æœŸç”Ÿæ•ˆ</strong>ã€‚</p>
<h2 data-id="heading-2">03 ç”µå•†åœºæ™¯ä¸‹ï¼Œé…ç½®Rulesçš„æ•ˆæœ</h2>
<p>åœ¨æ²¡æœ‰é…ç½®Rulesçš„æƒ…å†µä¸‹ï¼Œä¿®æ”¹é—®é¢˜å¾—é ä¸€è½®è½®å’Œæ¨¡å‹å¯¹è¯ã€‚<strong>å¦‚æœé…ç½®äº†Rulesï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„è´¨å˜å‘¢ï¼Ÿ</strong> å¯ä»¥<strong>æŠŠRulesæƒ³è±¡æˆæ˜¯ç»™å¤§æ¨¡å‹é…çš„ä¸€æœ¬ã€Œè¡Œä¸ºè§„èŒƒæ‰‹å†Œã€</strong>ï¼Œå®ƒçš„æ•ˆæœä¸»è¦åˆ†å‡ ä¸ªå±‚é¢ï¼š</p>
<p><strong>1.å‘½åçº¦å®š â€”â€” ä»£ç ç•Œçš„â€œèµ·åå¤§ä¼šâ€</strong></p>
<p>å‘½åçº¦å®šæ¨¡æ¿å°±åƒåœ¨ä»£ç ç•Œå¼€äº†ä¸€åœºâ€œèµ·åå¤§ä¼šâ€ã€‚å˜é‡ä¸èƒ½éšä¾¿å«â€œå¼ ä¸‰â€ï¼Œå‡½æ•°ä¹Ÿåˆ«æ•´æˆâ€œæå››â€ã€‚æœ‰äº†å‘½åè§„åˆ™ä¹‹åï¼Œæ¨¡å‹å°±èƒ½ç»Ÿä¸€é£æ ¼ã€ä¿è¯å¯è¯»æ€§ã€‚ä¸å†å‡ºç°ä¸€å †å¥‡æ€ªçš„åå­—ã€‚<strong>ä»æ­¤å›¢é˜Ÿåä½œæ›´é¡ºç•…ï¼Œè°ƒè¯•ä¹Ÿä¸å†åƒæ‹†ç›²ç›’ã€‚</strong></p>
<p><strong>2.ä»£ç ç»“æ„ â€”â€” ç»™æ¨¡å‹æˆ´ä¸Šâ€œç´§ç®å’’â€</strong></p>
<p>ä»£ç ç»“æ„çº¦æŸå°±åƒæ˜¯ç»™æ¨¡å‹æˆ´äº†ä¸ªâ€œç´§ç®å’’â€ã€‚ä¸å…è®¸æ¨¡å‹å†™â€œä¿„ç½—æ–¯å¥—å¨ƒâ€å¼çš„åµŒå¥—ç»“æ„ï¼Œä¹Ÿä¸å…è®¸å‡½æ•°å˜æˆä¸€å›¢â€œæ„å¤§åˆ©é¢æ¡å¼â€çš„ç¾éš¾ä»£ç ã€‚<strong>æœ‰äº†ç»“æ„çº¦æŸåï¼Œä»£ç å±‚æ¬¡æ¸…æ™°ã€é€»è¾‘æ˜äº†ï¼Œå°±åƒå†™ä½œæ–‡æœ‰å¤§çº²ï¼Œæ¨¡å‹ä¸ä¼šä¹±é£™è‡ªç”±å‘æŒ¥ã€‚</strong></p>
<p><strong>3.ä¸šåŠ¡é€»è¾‘å±‚ â€”â€” æ¨¡å‹çš„â€œé€»è¾‘äº¤è­¦â€</strong></p>
<p>ä¸šåŠ¡é€»è¾‘å±‚æ˜¯å¤§æ¨¡å‹çš„â€œè„‘å›è·¯â€ï¼Œè€ŒRulesåœ¨è¿™é‡Œæ‰®æ¼”çš„è§’è‰²ï¼Œå°±åƒä¸€ä¸ªâ€œé€»è¾‘äº¤è­¦â€ã€‚å®ƒè´Ÿè´£æŒ‡æŒ¥â€”â€”â€œè¿™ä¸ªæµç¨‹è¯¥å¾€å“ªè·‘â€ã€â€œé‚£ä¸ªåˆ¤æ–­åœ¨å“ªåœâ€ã€‚<strong>é˜²æ­¢æ¨¡å‹ä¹±å¼€è½¦ã€é€»è¾‘æ’è½¦ï¼Œè®©ä¸šåŠ¡æµè½¬æ›´é¡ºç•…ã€æ›´å¯æ§ã€‚</strong></p>
<p><strong>æœ‰äº†Rulesï¼Œæ¨¡å‹å°±åƒä»â€œè‡ªç”±åˆ›ä½œâ€å˜æˆäº†â€œè§„èŒƒç”Ÿäº§â€</strong> ï¼Œ<strong>æ—¢èƒ½ç†è§£è®¾è®¡æ„å›¾ï¼Œåˆèƒ½æŒ‰ç…§æ ‡å‡†ç¨³å®šè¾“å‡ºã€‚</strong></p>
<p>ç›®å‰æœ‰ä¸¤ç§é…ç½®Rulesçš„æ–¹å¼ï¼Œä¸€ç§æ˜¯é‡‡ç”¨ç¼–è¯‘å™¨ï¼Œæ ¹æ®æŸä¸ªæ ‡å‡†é¡µé¢ç”Ÿæˆï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ae56464f5464388bcc8f441700f16db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370683&amp;x-signature=9TTBlvUJ9zrrL5m0YT6d2g0qYHk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ç¬¬äºŒç§æ˜¯æ‰‹åŠ¨æ›´æ–°é¡¹ç›®Rulesï¼Œæ‰¾åˆ°å…¥å£ï¼Œç„¶åè¿›è¡Œæ›´æ–°ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3651a215734141bc92a6a016627dfe2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370683&amp;x-signature=W1wwm7COgFabwD1dItXbC8yUZlI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fa31e4c3bbf492fb47757ab271bd93b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370683&amp;x-signature=t020TB7xK4ilBhUj8p4nBehCpDg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8581a62337f40d7b29895f3c4e61d81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370683&amp;x-signature=6cDFqn%2Fubb6%2BswxegW5bvRHlWEk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>Ruleå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">---
description:
globs:
<span class="hljs-section">alwaysApply: true
---</span>
<span class="hljs-section">## é¡¹ç›®æ¦‚è¿°</span>
è‡ªåŠ¨è§£æé¡¹ç›®æ¡†æ¶ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ªç§»åŠ¨ç«¯çš„é¡¹ç›®ï¼Œæ‰€æœ‰çš„æ ·å¼éœ€è¦å‚è€ƒç§»åŠ¨ç«¯æ¥å®ç°ã€‚
<span class="hljs-section">## å¼€å‘æŒ‡å—</span>
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**class ç±»åå¤„ç†**</span>
<span class="hljs-bullet">    -</span> æ‰€æœ‰ class ååº”å¯è¯»ã€å¯çŒœæµ‹åŠŸèƒ½ ç»Ÿä¸€é‡‡ç”¨ - æ‹¼æ¥æ³•ï¼Œå¦‚ï¼šcontent-title
<span class="hljs-bullet">    -</span> å»é™¤å¤šä½™å¤æ‚çš„ class ç±»å
<span class="hljs-bullet">    -</span> ä¿æŒ class å±‚çº§æ‰å¹³ï¼Œå°½é‡æœ€å¤šåµŒå¥—ä¸‰å±‚
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**css å†™æ³•**</span>
<span class="hljs-bullet">    -</span> å°ºå¯¸å•ä½ä¼˜å…ˆæŠŠ PX æ”¹æˆ * @rex414 çš„å†™æ³•; ï¼ˆä¾‹å¦‚ 1px å˜æˆ 1* @rex414ï¼‰ï¼Œè¿™ä¸€ç‚¹ä¸€å®šè¦æ‰§è¡Œï¼Œä¸è¦ä½¿ç”¨ @rpx414ã€‚
<span class="hljs-bullet">    -</span> ç»„ä»¶æ ·å¼å¿…é¡»åŠ  lang="less"
<span class="hljs-bullet">    -</span> æ¯ä¸ªæ–°å†™çš„ style æ–‡ä»¶ å¿…é¡»å¼•å…¥ @import 'src/lib/style/common.less';ï¼Œè¿™ä¸ªåªéœ€è¦åœ¨<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>æ ‡ç­¾é‡Œé¢å¼•å…¥å°±è¡Œ
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**ç»„ä»¶å¼€å‘**</span>
<span class="hljs-bullet">    -</span> äº‹ä»¶å‘½åé‡‡ç”¨ handleXxx æ ¼å¼ã€‚
<span class="hljs-bullet">    -</span> ç»„ä»¶è¯·å¸®æˆ‘å†™åœ¨ src/routes/components ä¸‹ï¼Œä¸è¦ç”Ÿæˆç»„ä»¶ä½¿ç”¨ç¤ºä¾‹ï¼Œç›´æ¥ç”Ÿæˆç»„ä»¶ã€‚
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**é¡µé¢å¼€å‘**</span>
<span class="hljs-bullet">    -</span> æ ¹æ®è®¾è®¡ç¨¿ï¼Œå¹¶ä¸”æ ¹æ®é¡µé¢çš„æ¨¡å—ï¼Œè¯·åŠ¡å¿…åˆç†æ‹†åˆ†ç»„ä»¶ï¼å¸®æˆ‘æŠŠé¡µé¢å†™åœ¨ src/routes/ ä¸‹ã€‚
<span class="hljs-bullet">    -</span> é¡µé¢çš„ç»„ä»¶å†™åœ¨ src/routes/components ä¸‹ã€‚
<span class="hljs-bullet">5.</span> <span class="hljs-strong">**å›¾ç‰‡èµ„æºç®¡ç†**</span>
<span class="hljs-bullet">    -</span> æ‰€æœ‰çš„å›¾ç‰‡éƒ½é‡‡å–å ä½ç¬¦çš„æ–¹å¼å®ç°ã€‚
<span class="hljs-bullet">    -</span> å›¾ç‰‡çš„æ‰€æœ‰èµ„æºéƒ½è¦æ”¾åœ¨ assets ä¸‹ï¼Œä¾‹å¦‚ list-demo çš„å›¾ç‰‡éƒ½æ”¾åœ¨ src/routes/list-demo/assets ä¸‹ã€‚
<span class="hljs-bullet">    -</span> ä¾‹å¦‚ï¼Œç»„ä»¶åœ¨ src/routes/list-demo/components è·¯å¾„ä¸‹ ç»„ä»¶ä½¿ç”¨å›¾ç‰‡å¼•å…¥æ–¹å¼éƒ½éœ€è¦æŒ‰ç…§ /assets/list-demo/image<span class="hljs-emphasis">_1.png è¿™æ ·å®ç°ã€‚
</span></code></pre>
<p>é…ç½®å®ŒRulesï¼Œä¸‹ä¸€æ­¥ä¼šæ‰“å¼€è®¾è®¡ç¨¿ï¼Œæ ¹æ®çº¦æŸçš„æ–¹å¼è‡ªåŠ¨ç”Ÿæˆä»£ç ã€‚</p>
<p>æœ‰äº†Rulesçš„çº¦æŸåï¼Œä¼šæœ‰ä»€ä¹ˆæ ·çš„æ•ˆæœå‘¢? ä»¥ä¸Šæ–‡æåˆ°çš„è®¢å•è¯¦æƒ…é¡µä¸ºä¾‹ï¼Œ<strong>å¯ä»¥æ˜æ˜¾çœ‹å‡ºé…ç½®åé¡¹ç›®ä»£ç å±‚çº§çš„ä¼˜åŒ–ï¼ˆå¦‚CSSæ ¼å¼ç­‰ï¼‰ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5fe899166104da4b9ca5f3f1774d5d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370683&amp;x-signature=wM%2BQQSq64sqa4GbX1eK%2BJgp3Ffo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>é…ç½®Rulesåï¼Œè®¢å•è¯¦æƒ…é¡µä»£ç å±•ç¤º</p>
<p><strong>ç”µå•†åœºæ™¯ä¸‹ï¼Œé…ç½®Rulesçš„æ•ˆæœè§†é¢‘</strong>ğŸ‘‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQaZL34zk094i-BYWT_l55g" target="_blank" title="https://mp.weixin.qq.com/s/QaZL34zk094i-BYWT_l55g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/QaZL34zk0â€¦</a></p>
<h2 data-id="heading-3">04 Q&amp;A</h2>
<p><strong>Q1: åœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¦‚ä½•é…ç½®ç¬¦åˆé¡¹ç›®çš„Rulesï¼Ÿ</strong></p>
<p><strong>Aï¼š</strong> ä¸è¦æŠŠAIçœ‹ä½œä¸€ä¸ªèƒ½ç‹¬ç«‹å®Œæˆå·¥ä½œçš„ç¨‹åºå‘˜ï¼Œè€Œåº”è§†ä¸ºä¸€ä¸ª<strong>çŸ¥è¯†æ¸Šåšä½†ç¼ºå†³ç­–èƒ½åŠ›</strong>çš„ç¨‹åºå‘˜ã€‚Rulesï¼Œå°±æ˜¯ç»™è¿™ä½â€œé˜Ÿå‹â€çš„<strong>å·¥ä½œæŒ‡å¼•å’Œè¾¹ç•Œè¯´æ˜</strong>ã€‚é¦–å…ˆè¦æ˜ç¡®å‡ ç‚¹ï¼š</p>
<ul>
<li>æ˜ç¡®ä¸å¼•å…¥å¤–éƒ¨ä¾èµ–ç¡®ä¿ç”Ÿæˆä»£ç å®‰å…¨å¯æ§ï¼›</li>
<li>æ˜ç¡®å‘ŠçŸ¥AIé¡¹ç›®çš„æ¶æ„ä¸æ¨¡å¼ï¼Œç¡®ä¿æ•°æ®çš„æ­£ç¡®å¼•å…¥ä¸ä½¿ç”¨ï¼›</li>
<li>å‘ŠçŸ¥AIé¡¹ç›®ä½¿ç”¨çš„æŠ€æœ¯æ ˆè¯­æ³•ï¼Œä¿è¯ç”Ÿæˆä»£ç åœ¨é¡¹ç›®ä¸­å¯ç”¨ã€‚</li>
</ul>
<p>æœ€å¥½çš„æ–¹å¼ï¼Œå°±æ˜¯è®©AIå…ˆç”Ÿæˆä¸€æ®µä»£ç ï¼Œå‘ç°ä¸è¶³åï¼Œæ€»ç»“æˆä¸€ä¸ªé€šç”¨è§„èŒƒã€‚å¦‚æœé¡¹ç›®æœ‰å·²å­˜åœ¨æ–‡ä»¶ï¼ŒæŒ‰ç…§å·²æœ‰æ–‡ä»¶çš„ä»£ç é£æ ¼ï¼Œè‡ªå®šä¹‰Rulesçš„è§„åˆ™å¹¶é€æ­¥æ”¹å–„ï¼Œæœ€ç»ˆä½¿ç”Ÿæˆä»£ç ä¸åŸæœ‰ä»£ç é£æ ¼ä¿æŒä¸€è‡´ã€‚</p>
<p><strong>Q2ï¼šæ²¡æœ‰Rulesæ—¶ï¼ŒAIè¾“å‡ºçš„ä»£ç ä¼šå‡ºç°å“ªäº›é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>Aï¼š</strong> æ¯”å¦‚æ ¼å¼ä¸ç»Ÿä¸€ã€å‘½åä¸è§„èŒƒã€CSSæˆ–æ¥å£å†™æ³•ä¸ç¬¦åˆé¡¹ç›®æ ‡å‡†ç­‰ï¼ŒAIä¼šâ€œå‡­è‡ªå·±ç†è§£â€ç”Ÿæˆï¼Œå®¹æ˜“å‡ºç°<strong>è·‘åæˆ–ä½è´¨é‡ä»£ç </strong>ã€‚</p>
<p><strong>Q3ï¼šæ²¡æœ‰Rulesæ—¶ï¼Œæœ‰æ²¡æœ‰å¿«é€Ÿè®©AIè¾“å‡ºç¬¦åˆè§„èŒƒçš„æ–¹æ³•ï¼Ÿ</strong></p>
<p><strong>Aï¼š</strong> åœ¨æ²¡æœ‰é…ç½®Rulesçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›æ–¹å¼<strong>å°½é‡è®©AIè¾“å‡ºç¬¦åˆè§„èŒƒ</strong>ï¼Œä¸è¿‡æ¯ç§æ–¹æ³•éƒ½æœ‰ä¼˜åŠ£ã€‚æœ€ç›´æ¥çš„å°±æ˜¯<strong>å¤šè½®å¯¹è¯é€æ­¥å¼•å¯¼ï¼Œ</strong> æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨ä¸‹æŒ‡ä»¤ï¼Œå¯¹å†™æç¤ºè¯çš„èƒ½åŠ›è¦æ±‚æ¯”è¾ƒé«˜ã€æ•ˆç‡ä½ï¼Œä¸”å®¹æ˜“å‡ºé”™ã€‚é™¤äº†å¤šè½®å¯¹è¯ï¼Œè¿˜æœ‰ä¸€äº›è¾…åŠ©åŠæ³•ï¼š</p>
<p><strong>1ï¼‰Few-shot ç¤ºä¾‹ï¼š</strong> ç»™AIçœ‹å‡ ä¸ªæ ‡å‡†ç¤ºä¾‹ï¼Œè®©å®ƒæ¨¡ä»¿å¥½ä¾‹å­è¾“å‡ºï¼›</p>
<p><strong>2ï¼‰RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> ï¼šæŠŠå…¬å¸çš„è§„èŒƒæ–‡æ¡£æˆ–è€…å‚è€ƒä»£ç åº“æ£€ç´¢è¿›æ¥ï¼Œè®©æ¨¡å‹åœ¨ç”Ÿæˆæ—¶å‚è€ƒï¼Œè¿™æ ·å¯ä»¥å‡å°‘åç¦»è§„èŒƒçš„æƒ…å†µã€‚</p>
<p>ä½†è¯´åˆ°åº•ï¼Œè¿™äº›éƒ½æ˜¯<strong>æƒå®œä¹‹è®¡</strong>ï¼Œ<strong>æ•ˆç‡å’Œç¨³å®šæ€§éƒ½ä¸å¦‚ä¸€æ¬¡æ€§å»ºç«‹Rules</strong>ã€‚ä¸€æ—¦æŠŠè§„åˆ™é…ç½®å¥½ï¼Œæ¨¡å‹å°±åƒæœ‰äº†â€œè¡ŒåŠ¨æŒ‡å—â€ï¼Œä»¥åç”Ÿæˆçš„ä»£ç åŸºæœ¬èƒ½è‡ªåŠ¨ç¬¦åˆè§„èŒƒï¼Œè¿™æ‰æ˜¯çœŸæ­£<strong>ä¸€åŠ³æ°¸é€¸</strong>çš„åŠæ³•ã€‚</p>
<p><strong>Q4ï¼šRulesæ˜¯ä¸æ˜¯åªé’ˆå¯¹å‰ç«¯é¡¹ç›®æœ‰æ•ˆï¼Ÿ</strong></p>
<p><strong>Aï¼šRuleså¯ä»¥ç”¨åœ¨ä»»ä½•ç¼–ç¨‹åœºæ™¯ã€‚</strong> æœ¬è´¨ä¸Šï¼Œå®ƒå°±æ˜¯ç»™æ¨¡å‹å®šè§„èŒƒã€å®šè¾¹ç•Œï¼Œå‘Šè¯‰å®ƒâ€œè¯¥æ€ä¹ˆåšâ€ã€â€œä¸èƒ½ä¹±åšâ€ã€‚å‰ç«¯ç”¨å®ƒå¯ä»¥è§„èŒƒå‘½åã€ç»„ä»¶é£æ ¼ã€CSSå†™æ³•ï¼›åç«¯å¯ä»¥çº¦æŸå‡½æ•°å‘½åã€æ¥å£è®¾è®¡ã€æ•°æ®åº“æ“ä½œã€æ—¥å¿—æ ¼å¼ï¼›æ–‡æ¡£ã€æŠ¥å‘Šã€ç”šè‡³Markdownï¼Œä¹Ÿèƒ½è§„å®šæ¨¡æ¿ã€æ ¼å¼å’Œç”¨è¯ã€‚ç”šè‡³åœ¨å¤šæ¨¡å‹åä½œæˆ–è€…Agentåœºæ™¯ï¼ŒRulesä¹Ÿå¯ä»¥å¸®åŠ©æ˜ç¡®è¾“å…¥è¾“å‡ºã€è°ƒç”¨é¡ºåºã€ä»»åŠ¡è¾¹ç•Œã€‚<strong>åªè¦ä½ çš„ä»»åŠ¡æœ‰è§„èŒƒå¯éµå¾ªï¼ŒRuleså°±èƒ½å‘æŒ¥ä½œç”¨</strong>ï¼Œç»å¯¹ä¸å±€é™äºå‰ç«¯ã€‚é’ˆå¯¹ä¸åŒçš„åœºæ™¯ï¼Œå¯ä»¥å†™ä¸åŒçš„Ruleså»è§„èŒƒæ¨¡å‹çš„è¾“å‡ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºç”Ÿäº§è´Ÿè½½å›æ”¾çš„æ•°æ®åº“è¿ç§»éªŒè¯å®è·µï¼šä»æ¨¡æ‹Ÿæµ‹è¯•åˆ°çœŸå®é¢„æ¼”ã€é‡‘ä»“æ•°æ®åº“ã€‘]]></title>    <link>https://juejin.cn/post/7570902804450705418</link>    <guid>https://juejin.cn/post/7570902804450705418</guid>    <pubDate>2025-11-10T09:20:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804450705418" data-draft-id="7570903763721093130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºç”Ÿäº§è´Ÿè½½å›æ”¾çš„æ•°æ®åº“è¿ç§»éªŒè¯å®è·µï¼šä»æ¨¡æ‹Ÿæµ‹è¯•åˆ°çœŸå®é¢„æ¼”ã€é‡‘ä»“æ•°æ®åº“ã€‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T09:20:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeJourney"/> <meta itemprop="url" content="https://juejin.cn/user/3558441089502232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºç”Ÿäº§è´Ÿè½½å›æ”¾çš„æ•°æ®åº“è¿ç§»éªŒè¯å®è·µï¼šä»æ¨¡æ‹Ÿæµ‹è¯•åˆ°çœŸå®é¢„æ¼”ã€é‡‘ä»“æ•°æ®åº“ã€‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3558441089502232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeJourney
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:20:19.000Z" title="Mon Nov 10 2025 09:20:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºäºç”Ÿäº§è´Ÿè½½å›æ”¾çš„æ•°æ®åº“è¿ç§»éªŒè¯å®è·µï¼šä»æ¨¡æ‹Ÿæµ‹è¯•åˆ°çœŸå®é¢„æ¼”</h2>
<p>éšç€å›½äº§æ•°æ®åº“çš„ä¸æ–­æˆç†Ÿï¼Œè¶Šæ¥è¶Šå¤šä¼ä¸šå¼€å§‹å°†æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿä» Oracleã€SQL Server ç­‰ä¼ ç»Ÿå•†ä¸šæ•°æ®åº“è¿ç§»åˆ°å›½äº§æ•°æ®åº“ã€‚è€Œåœ¨è¿ç§»é¡¹ç›®ä¸­ï¼Œ<strong>æœ€ç»ˆèƒ½å¦å®‰å…¨ä¸Šçº¿</strong>ï¼Œå¾€å¾€ä¸å–å†³äºâ€œæ˜¯å¦æˆåŠŸå¯¼å…¥æ•°æ®â€ï¼Œè€Œæ˜¯å–å†³äº<strong>è¿ç§»åçš„ç³»ç»Ÿæ˜¯å¦èƒ½æ‰¿å—çœŸå®ä¸šåŠ¡åœºæ™¯ä¸‹çš„è´Ÿè½½å‹åŠ›</strong>ã€‚</p>
<p>è®¸å¤šå›¢é˜Ÿåœ¨è¿ç§»è¿‡ç¨‹ä¸­éƒ½ä¼šé‡åˆ°ç±»ä¼¼çš„å›°æƒ‘ï¼š</p>
<ul>
<li>æµ‹è¯•é˜¶æ®µä¸šåŠ¡çœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸</li>
<li>ä¸Šçº¿ååœ¨é«˜å³°æ—¶æ®µçªç„¶æ€§èƒ½å‘Šè­¦ã€TPSä¸‹é™ã€é”ç«äº‰é£™å‡</li>
<li>æœ€ç»ˆä¸å¾—ä¸ç´§æ€¥å›é€€æˆ–åŠ ç­è°ƒå‚æ•‘ç«</li>
</ul>
<p>é—®é¢˜å¾€å¾€ä¸æ˜¯æµ‹è¯•åšå¾—ä¸å¤Ÿï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>æµ‹è¯•ç¯å¢ƒçš„è¡Œä¸ºä¸ç­‰äºç”Ÿäº§ç¯å¢ƒçš„è¡Œä¸º</strong>ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†ä»‹ç»ä¸€ç§èƒ½å¤ŸçœŸå®è¿˜åŸç”Ÿäº§ä¸šåŠ¡è¿è¡ŒçŠ¶æ€çš„è¿ç§»éªŒè¯æ–¹æ³•ï¼š<strong>ç”Ÿäº§è´Ÿè½½å›æ”¾ï¼ˆWorkload Replayï¼‰</strong>ï¼Œå¹¶ç»“åˆå®é™…è½åœ°é¡¹ç›®åˆ†äº«å…¶æŠ€æœ¯æµç¨‹ä¸æ•ˆæœæå‡ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2adaa60338414266a36f75c8521032c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZUpvdXJuZXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371219&amp;x-signature=8Il9G6OHLjpJ%2Bk2llW6iKLzhF38%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆä¼ ç»Ÿè¿ç§»æµ‹è¯•éš¾ä»¥ä¿éšœä¸Šçº¿ç¨³å®šæ€§ï¼Ÿ</h3>
<p>è¿ç§»æµ‹è¯•é˜¶æ®µé€šå¸¸åŒ…å«ï¼šåŠŸèƒ½æµ‹è¯•ã€æ‰‹å·¥ç”¨ä¾‹éªŒè¯ã€å‹åŠ›æµ‹è¯•ã€å›å½’æµ‹è¯•ç­‰ç¯èŠ‚ï¼Œçœ‹ä¼¼è¦†ç›–å…¨é¢ï¼Œä½†ä»éš¾ä»¥é¿å…è¿ç§»åå‡ºç°æ€§èƒ½æˆ–å¹¶å‘é—®é¢˜ï¼Œå…¶æ ¹æœ¬åŸå› åœ¨äºï¼š</p>
<h4 data-id="heading-2">1. æ‰‹å·¥æµ‹è¯•ä¸çœŸå®ä¸šåŠ¡è¡Œä¸ºæœ‰â€œä¸å¯å¼¥åˆå·®è·â€</h4>
<p>äººå·¥æµ‹è¯•ç”¨ä¾‹å¾€å¾€èšç„¦åœ¨â€œåŠŸèƒ½æ­£ç¡®æ€§â€ï¼Œä½†çœŸå®ä¸šåŠ¡ä¸­å­˜åœ¨å¤§é‡â€œè¾¹ç¼˜è¡Œä¸ºâ€ï¼š</p>






























<table><thead><tr><th>ç±»å‹</th><th>ä¸¾ä¾‹</th><th>ç‰¹å¾</th></tr></thead><tbody><tr><td>é«˜å¹¶å‘äº‹åŠ¡</td><td>æ‰¹é‡è®¢å•ç”Ÿæˆã€è´¦åŠ¡ç»“ç®—</td><td>å¯¹é”ã€äº‹åŠ¡éš”ç¦»é«˜åº¦æ•æ„Ÿ</td></tr><tr><td>å¤æ‚é•¿æŸ¥è¯¢</td><td>å¤šè¡¨å…³è”çš„å†å²æŠ¥è¡¨ / æœˆåº¦ç»“ç®—</td><td>æ‰§è¡Œè®¡åˆ’å—ç´¢å¼•çŠ¶æ€å½±å“</td></tr><tr><td>çªå‘æ€§è®¿é—®å³°å€¼</td><td>èŠ‚å‡æ—¥ä¿ƒé”€æŠ•æ”¾</td><td>QPS å‘ˆæŒ‡æ•°æ³¢åŠ¨ï¼Œéš¾ä»¥é¢„æµ‹</td></tr><tr><td>å¼‚å¸¸è¡Œä¸ºé“¾è·¯</td><td>å›æ»šã€å¤šæ¬¡é‡è¯•ã€å±€éƒ¨å¤±è´¥</td><td>äººå·¥ç”¨ä¾‹å‡ ä¹æ— æ³•æ„é€ </td></tr></tbody></table>
<p>è¿™äº›è¡Œä¸ºå¾€å¾€ä¸æ˜¯â€œæ¯å¤©éƒ½å‘ç”Ÿâ€ï¼Œä½†<strong>ä¸€æ—¦å‘ç”Ÿå°±å¯èƒ½é€ æˆè‡´å‘½é—®é¢˜</strong>ã€‚</p>
<h4 data-id="heading-3">2. å‹æµ‹è„šæœ¬æ— æ³•çœŸå®åæ˜ ç”¨æˆ·è®¿é—®ç‰¹å¾</h4>
<p>å‹æµ‹å·¥å…·èƒ½é€ â€œå‹åŠ›â€ï¼Œä½†é€ ä¸å‡ºâ€œçœŸå®ç”¨æˆ·è¡Œä¸ºâ€ï¼š</p>
<ul>
<li>QPS æ˜¯å†™æ­»çš„ï¼Œè€ŒçœŸå®ç³»ç»Ÿä¸­æ˜¯æ³¢å³°æ³¢è°·äº¤æ›¿</li>
<li>SQL æ‰§è¡Œæ¯”ä¾‹é€šå¸¸ä¸å›ºå®šï¼Œè€Œæµ‹è¯•è„šæœ¬æ˜¯å›ºå®šçš„å‚æ•°æ¨¡æ¿</li>
<li>åŒä¸€ SQL åœ¨æ•°æ®é‡å˜åŒ–åä¼šè§¦å‘ä¸åŒæ‰§è¡Œè®¡åˆ’ï¼Œè¿™æ˜¯è®¸å¤šè¿ç§»ç¿»è½¦çš„æ ¹æº</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p><strong>å‹æµ‹å‘Šè¯‰ä½ ç³»ç»Ÿâ€œèƒ½è·‘â€ï¼Œä½†ä¸èƒ½å‘Šè¯‰ä½ ç³»ç»Ÿâ€œä¼šä¸ä¼šåœ¨çœŸå®ç¯å¢ƒä¸‹å¡ä½â€ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-4">3. åˆ¶åº¦æ€§ç—›ç‚¹ï¼šå›å½’æµ‹è¯•æˆæœ¬å·¨å¤§</h4>
<p>ä¸€æ—¦ï¼š</p>
<ul>
<li>æ•°æ®åº“å‚æ•°è°ƒäº†</li>
<li>ç´¢å¼•åŠ äº† / åˆ äº†</li>
<li>æ‰§è¡Œè®¡åˆ’å˜äº†</li>
</ul>
<p>ç†è®ºä¸Šéƒ½è¦é‡æ–°å›å½’æµ‹è¯•ã€‚</p>
<p>è¿™å¯¼è‡´æµ‹è¯•å›¢é˜Ÿåœ¨è¿ç§»ä¸­é•¿æœŸç–²äº<strong>é‡å¤åŠ³åŠ¨</strong>ï¼Œè€Œä¸æ˜¯ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<hr/>
<h3 data-id="heading-5">äºŒã€ç”Ÿäº§è´Ÿè½½å›æ”¾ï¼šè®©è¿ç§»æµ‹è¯•ä»â€œæ¨¡æ‹Ÿâ€å˜æˆâ€œé‡æ¼”â€</h3>
<p>ä¸ºäº†è§£å†³â€œæµ‹è¯•ä¸çœŸå®â€çš„æ ¸å¿ƒçŸ›ç›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†**ç”Ÿäº§è´Ÿè½½å›æ”¾ï¼ˆWorkload Replayï¼‰**æŠ€æœ¯ï¼Œå…¶æ€è·¯éå¸¸ç›´æ¥ï¼š</p>
<blockquote>
<p><strong>ä¸å†æ„é€ æµ‹è¯•åœºæ™¯ï¼Œè€Œæ˜¯ç›´æ¥æŠŠçœŸå®ç”Ÿäº§ç¯å¢ƒä¸­å‘ç”Ÿè¿‡çš„æ‰€æœ‰æ•°æ®åº“è¯·æ±‚ï¼Œå®Œæ•´å¤åˆ¶åˆ°è¿ç§»åçš„æ•°æ®åº“ä¸Šæ‰§è¡Œã€‚</strong></p>
</blockquote>
<p>è¿™æ ·ä¸€æ¥ï¼š</p>
<ul>
<li>æµ‹è¯•åœºæ™¯ä¸å†ä¾èµ–ç»éªŒ â†’ è€Œæ˜¯ç”±çœŸå®å†å²ä¸šåŠ¡é©±åŠ¨</li>
<li>æ€§èƒ½è¡Œä¸ºä¸å†ä¼°è®¡ â†’ è€Œæ˜¯å¯é‡åŒ–æ¯”å¯¹</li>
<li>å›å½’æµ‹è¯•ä¸å†é‡æ–°é€ æ•°æ® â†’ è€Œæ˜¯ç›´æ¥é‡å¤å›æ”¾</li>
</ul>
<h4 data-id="heading-6">æ ¸å¿ƒæµç¨‹</h4>
<pre><code class="hljs language-sql" lang="sql">Captureï¼ˆç”Ÿäº§æµé‡é‡‡é›†ï¼‰
â†’ <span class="hljs-keyword">Convert</span>ï¼ˆè¯­å¥ä¸ç±»å‹å…¼å®¹è½¬æ¢ï¼‰
â†’ Replayï¼ˆæŒ‰åŸå§‹æ—¶é—´åºåˆ—å›æ”¾ï¼‰
â†’ Validateï¼ˆç»“æœä¸æ•°æ®ä¸€è‡´æ€§æ¯”å¯¹ï¼‰
</code></pre>
<p>ä¸‹é¢é€æ­¥å±•å¼€ã€‚</p>
<hr/>
<h3 data-id="heading-7">ä¸‰ã€æŠ€æœ¯æµç¨‹è¯¦è§£</h3>
<h4 data-id="heading-8">1. Captureï¼šé‡‡é›†çœŸå®æ•°æ®åº“è¯·æ±‚æµ</h4>
<p>é‡‡é›†ç›®æ ‡æ˜¯æ•è·æŸä¸€æ—¶æ®µå†…çš„<strong>å®Œæ•´ä¸šåŠ¡è¡Œä¸ºé“¾è·¯</strong>ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>SQLè¯­å¥æœ¬ä½“</li>
<li>ç»‘å®šå˜é‡</li>
<li>äº‹åŠ¡å¼€å§‹ / æäº¤ / å›æ»šæ ‡è®°</li>
<li>ä¼šè¯æ¥æºï¼ˆIP / åº”ç”¨å / ç”¨æˆ·ä¼šè¯ï¼‰</li>
<li>æ¯æ¡è¯­å¥æ‰§è¡Œçš„æ—¶é—´æˆ³ï¼ˆç”¨äºè¿˜åŸå¹¶å‘èŠ‚å¥ï¼‰</li>
</ul>
<p>é‡‡é›†æ–¹å¼ä¸º<strong>ä½ä¾µå…¥è®¾è®¡</strong>ï¼Œä¸ä¼šé˜»å¡çº¿ä¸Šä¸šåŠ¡ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>
  DBMS_WORKLOAD_CAPTURE.START_CAPTURE(
    name <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'workload_24h_snapshot'</span>,
    dir <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'CAPTURE_DIR'</span>
  );
<span class="hljs-keyword">END</span>;
<span class="hljs-operator">/</span>
</code></pre>
<p>é‡‡é›†å‘¨æœŸå»ºè®®é€‰æ‹©<strong>ä¸€ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„ä¸šåŠ¡æ—¥</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>æœˆåº•è´¢åŠ¡å¯¹è´¦æ—¥</li>
<li>é«˜å®¢æµä¸šåŠ¡æ—¥</li>
<li>å¤§ä¿ƒæ´»åŠ¨æ—¥</li>
</ul>
<p>è¿™æ ·åç»­æµ‹è¯•çš„å¯é æ€§æ‰æœ‰æ„ä¹‰ã€‚</p>
<hr/>
<h4 data-id="heading-9">2. Convertï¼šè¯­å¥å…¼å®¹ã€æ‰§è¡Œè®¡åˆ’é€‚é…</h4>
<p>ç”±äºæ•°æ®åº“è¯­æ³•ã€å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹è¯­è¨€å­˜åœ¨å·®å¼‚ï¼Œéœ€è¦è‡ªåŠ¨åŒ–è¿›è¡Œè¯­ä¹‰è½¬æ¢ï¼š</p>









































<table><thead><tr><th>å†…å®¹</th><th>Oracle â†’ KingbaseES ç¤ºä¾‹</th><th/><th/></tr></thead><tbody><tr><td>åˆ†é¡µè¯­æ³•</td><td><code>ROWNUM</code> â†’ <code>LIMIT OFFSET</code></td><td/><td/></tr><tr><td>å‡½æ•°æ›¿æ¢</td><td><code>NVL()</code> â†’ <code>COALESCE()</code></td><td/><td/></tr><tr><td>å­—ç¬¦ä¸²æ‹¼æ¥</td><td>`</td><td/><td><code>â†’</code>concat()`</td></tr><tr><td>æ—¶é—´ç±»å‹ç²¾åº¦</td><td>DATE â†’ TIMESTAMP(6)</td><td/><td/></tr><tr><td>å­˜å‚¨è¿‡ç¨‹è°ƒç”¨</td><td>PL/SQL â†’ ä»¿çœŸåŒ…æ¥å£é€‚é…</td><td/><td/></tr></tbody></table>
<p>å…³é”®åœ¨äºï¼š</p>
<blockquote>
<p>è½¬æ¢ä¸ä»…æ˜¯â€œèƒ½æ‰§è¡Œâ€ï¼Œè€Œæ˜¯ä¿è¯<strong>è¯­ä¹‰ä¸€è‡´</strong>ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-10">3. Replayï¼šæŒ‰åŸå§‹å¹¶å‘èŠ‚å¥å›æ”¾</h4>
<p>ä¸åŒäºå‹æµ‹è„šæœ¬åˆ¶é€ çš„â€œå›ºå®šå‹åŠ›æ¨¡å‹â€ï¼Œå›æ”¾ç³»ç»Ÿä¼šï¼š</p>
<ul>
<li>ä¸¥æ ¼è¿˜åŸåŸå§‹æ‰§è¡Œé¡ºåºå’Œäº‹åŠ¡éš”ç¦»å…³ç³»</li>
<li>æ¢å¤çœŸå®å¹¶å‘å¼ºåº¦ä¸è®¿é—®æ‰‡å‡ºç‰¹å¾</li>
<li>æ”¯æŒåŸé€Ÿ / åŠ é€Ÿ / é™é€Ÿä¸‰ç§æ¨¡å¼åˆ‡æ¢</li>
</ul>
<p>ç‰¹åˆ«é€‚åˆï¼š</p>





















<table><thead><tr><th>åœºæ™¯</th><th>å›æ”¾æ–¹å¼</th></tr></thead><tbody><tr><td>ç¨³å®šæ€§éªŒè¯</td><td>åŸé€Ÿå›æ”¾</td></tr><tr><td>èƒ½åŠ›ä¸Šé™è¯„ä¼°</td><td>åŠ é€Ÿå›æ”¾ï¼ˆ2xã€5xï¼‰</td></tr><tr><td>æ€§èƒ½ç“¶é¢ˆå®šä½</td><td>é™é€Ÿå›æ”¾è§‚å¯Ÿé”é“¾å’Œè®¡åˆ’</td></tr></tbody></table>
<p>å›æ”¾æœŸé—´ä¼šç”Ÿæˆå®Œæ•´æ€§èƒ½ç”»åƒï¼š</p>
<ul>
<li>Top SQL æ’åº</li>
<li>è®¡åˆ’å˜æ›´æ£€æµ‹</li>
<li>CPU / IO çƒ­ç‚¹</li>
<li>è¡Œã€è¡¨ã€ç´¢å¼•çº§é”ç«äº‰åˆ†å¸ƒ</li>
</ul>
<p>è¿™æ˜¯è¿ç§»è°ƒä¼˜çš„æ ¸å¿ƒä¾æ®ã€‚</p>
<hr/>
<h4 data-id="heading-11">4. Validateï¼šè‡ªåŠ¨åŒ–ç»“æœä¸€è‡´æ€§æ¯”å¯¹</h4>
<p>æ¯”å¯¹èŒƒå›´åŒ…æ‹¬ï¼š</p>

























<table><thead><tr><th>æ¯”å¯¹å†…å®¹</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>è¡¨çº§ä¸€è‡´æ€§</td><td>è¡Œæ•°ä¸€è‡´ / æ— ç¼ºå¤±æˆ–å†—ä½™</td></tr><tr><td>å­—æ®µçº§ä¸€è‡´æ€§</td><td>æ”¯æŒ BLOB / CLOB äºŒè¿›åˆ¶å¯¹æ¯”</td></tr><tr><td>å…ƒæ•°æ®ä¸€è‡´æ€§</td><td>ç´¢å¼•ã€è§¦å‘å™¨ã€çº¦æŸä¸€è‡´æ€§</td></tr><tr><td>è¿”å›ç»“æœä¸€è‡´æ€§</td><td>ç›¸åŒè¯·æ±‚è¿”å›ç›¸åŒç»“æœ</td></tr></tbody></table>
<p>ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå·®å¼‚æŠ¥å‘Šï¼Œå®šä½åˆ°<strong>å…·ä½“è¡¨ã€è¡Œã€å­—æ®µã€å€¼å·®å¼‚ç±»å‹</strong>ï¼Œæ— éœ€ DBA æ‰‹å·¥æŸ¥è¡¨ã€‚</p>
<hr/>
<h3 data-id="heading-12">å››ã€å®é™…é¡¹ç›®æ•ˆæœï¼šè¿ç§»å‘¨æœŸå‡å°‘ä¸€åŠï¼Œé£é™©æ˜¾è‘—ä¸‹é™</h3>
<p>ä»¥æŸåˆ¶é€ é›†å›¢ ERP ç³»ç»Ÿè¿ç§»ä¸ºä¾‹ï¼š</p>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼ ç»Ÿæµ‹è¯•æ–¹å¼</th><th>åŸºäºè´Ÿè½½å›æ”¾æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æµ‹è¯•æ€»ä½“å‘¨æœŸ</td><td>6 å‘¨</td><td><strong>3 å‘¨</strong></td></tr><tr><td>è¦†ç›–ä¸šåŠ¡åœºæ™¯</td><td>ä¾èµ–æµ‹è¯•ç»éªŒ</td><td><strong>å®Œå…¨çœŸå®ä¸šåŠ¡åœºæ™¯</strong></td></tr><tr><td>æ•°æ®å›å½’æˆæœ¬</td><td>æ¯æ¬¡éƒ½è¦é‡æ„æµ‹è¯•åœºæ™¯</td><td><strong>ç›´æ¥å¤ç”¨å›æ”¾æ•°æ®</strong></td></tr><tr><td>æ€§èƒ½é£é™©</td><td>ä¸Šçº¿åæ‰èƒ½æš´éœ²</td><td><strong>ä¸Šçº¿å‰å‘ç°å¹¶ä¿®å¤</strong></td></tr><tr><td>ä¸Šçº¿ç¨³å®šæ€§</td><td>å–å†³äºâ€œè¿æ°”â€</td><td><strong>ä¸Šçº¿å³å¹³ç¨³è¿è¡Œ</strong></td></tr></tbody></table>
<p>è¿ç§»è´Ÿè´£äººæ€»ç»“å¾—å¾ˆç›´ç™½ï¼š</p>
<blockquote>
<p>â€œä»¥å‰æˆ‘ä»¬æ˜¯åœ¨çŒœæµ‹è¯•æ˜¯å¦è¶³å¤Ÿï¼Œç°åœ¨æˆ‘ä»¬æ˜¯åœ¨éªŒè¯ç³»ç»Ÿæ˜¯å¦çœŸå®å¯æ‰¿è½½ã€‚â€</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">äº”ã€ç»“è¯­</h3>
<p>æ•°æ®åº“è¿ç§»ä¸æ˜¯æŠŠåº“æ¬èµ°ï¼Œè€Œæ˜¯è¦è®©ä¸šåŠ¡æ— æ„Ÿå¹³æ»‘åˆ‡æ¢ã€‚</p>
<p>ä¼ ç»Ÿæµ‹è¯•æ–¹æ³•<strong>éªŒè¯çš„æ˜¯åŠŸèƒ½å¯ç”¨</strong>ï¼›
ç”Ÿäº§è´Ÿè½½å›æ”¾<strong>éªŒè¯çš„æ˜¯ç³»ç»Ÿèƒ½å¦åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­ç¨³å®šè¿è¡Œ</strong>ã€‚</p>
<p>å› æ­¤ï¼š</p>
<blockquote>
<p><strong>çœŸå®è´Ÿè½½å›æ”¾ï¼Œæ˜¯æ•°æ®åº“è¿ç§»ä»â€œå¯ç”¨â€èµ°å‘â€œå¯ä¿¡â€çš„å…³é”®ä¸€æ­¥ã€‚</strong></p>
</blockquote>
<p>æœªæ¥ï¼Œç»“åˆæœºå™¨å­¦ä¹ å¯¹æ‰§è¡Œè®¡åˆ’å·®å¼‚ã€é”å†²çªé“¾è·¯ã€è®¿é—®çƒ­ç‚¹è‡ªåŠ¨åˆ†æï¼Œè¿ç§»éªŒè¯å°†ä»â€œç»éªŒé©±åŠ¨â€èµ°å‘â€œæ™ºèƒ½ä¼˜åŒ–â€ã€‚</p>
<p>è¿ç§»ï¼Œä¸å†æ˜¯ä¸€æ¬¡å†’é™©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æœºå™¨äººâ€œä¼šç”¨æ‰‹â€äº†ï¼é“¶æ²³é€šç”¨é¦–ç ´æ‰‹æŒä»»æ„æœå‘æ—‹è½¬éš¾é¢˜ï¼Œæ‹§èºä¸ã€ç ¸é’‰å­æ ·æ ·ç²¾é€š]]></title>    <link>https://juejin.cn/post/7570866247980105780</link>    <guid>https://juejin.cn/post/7570866247980105780</guid>    <pubDate>2025-11-10T09:30:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570866247980105780" data-draft-id="7570909641682206760" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æœºå™¨äººâ€œä¼šç”¨æ‰‹â€äº†ï¼é“¶æ²³é€šç”¨é¦–ç ´æ‰‹æŒä»»æ„æœå‘æ—‹è½¬éš¾é¢˜ï¼Œæ‹§èºä¸ã€ç ¸é’‰å­æ ·æ ·ç²¾é€š"/> <meta itemprop="keywords" content="AIGC,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-10T09:30:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‡å­ä½"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æœºå™¨äººâ€œä¼šç”¨æ‰‹â€äº†ï¼é“¶æ²³é€šç”¨é¦–ç ´æ‰‹æŒä»»æ„æœå‘æ—‹è½¬éš¾é¢˜ï¼Œæ‹§èºä¸ã€ç ¸é’‰å­æ ·æ ·ç²¾é€š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‡å­ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:30:59.000Z" title="Mon Nov 10 2025 09:30:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åšçµå·§æ‰‹å¦‚æœä¸ä¼šç”¨å·¥å…·ï¼Œè·Ÿå’¸é±¼ï¼ˆå¤¹çˆªï¼‰æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>åˆ«æ€¥ï¼Œèƒ½æ‹§èºä¸ã€æŠ¡é”¤å­ï¼Œç© â€œè½¬â€ å„ç±»å·¥å…·çš„çµå·§æ‰‹ï¼Œè¿™å°±æ¥äº†ã€‚</p>
<p>è¿™ä½æ‹§èºä¸çš„ â€œè€å¸ˆå‚…â€ï¼Œå‡ºè‡ª<strong>é“¶æ²³é€šç”¨</strong>æœ€æ–°æ¨å‡ºçš„çµå·§æ‰‹ç¥ç»åŠ¨åŠ›å­¦æ¨¡å‹ <strong>DexNDM</strong>ã€‚</p>
<p>åœ¨ DexNDM çš„åŠ æŒä¸‹ï¼Œçµå·§æ‰‹å®ç°äº†ä»èƒ½åŠ¨åˆ°èƒ½ç”¨çš„é£è·ƒï¼Œé€šè¿‡åˆ†å¸ƒæœ‰åçš„çœŸå®æ•°æ®è®­ç»ƒï¼Œæ— éœ€æˆåŠŸç¤ºä¾‹ï¼Œå³å¯ç²¾å‡†å¼¥åˆ Sim2Real é¸¿æ²Ÿï¼Œé¦–æ¬¡è®©é€šç”¨çµå·§æ‰‹èƒ½å¤Ÿå¯¹å¤šç±»ç‰©ä½“å®ç°ç¨³å®šã€å¤šå§¿æ€ã€å¤šè½´å‘çš„æ—‹è½¬æ“ä½œã€‚</p>
<ul>
<li><strong>è·¨ç‰©ä½“ç²¾å‡†æ“æ§ï¼šä»å¾®å°é›¶ä»¶åˆ°å¤§ä¹¦æœ¬ã€é•¿æ£ã€å¤æ‚å‡ ä½•ä½“ï¼Œé¦–æ¬¡å®ç°è·¨ç±»åˆ«ã€è·¨å°ºå¯¸ã€è·¨å§¿æ€çš„ç¨³å®šæ—‹è½¬ã€‚</strong></li>
<li><strong>ä»»æ„å§¿æ€å¤šè½´æ—‹è½¬ï¼šæ— è®ºæ‰‹æŒæœä¸Šã€æœä¸‹æˆ–ä¾§å‘ï¼Œå‡èƒ½æ²¿ä»»æ„è½´å‘è¿›è¡Œç¨³å®šã€æŒç»­çš„æ—‹è½¬ã€‚</strong></li>
<li><strong>é«˜çµå·§é«˜é²æ£’é¥æ“ä½œï¼šå¯è‡ªå¦‚åœ°æŠ“ã€è½¬ã€æ‹§å„ç±»å·¥å…·ï¼Œèƒœä»»æ‹§èºä¸ã€å®¶å…·ç»„è£…ç­‰é•¿ç¨‹ã€å¤æ‚æ“ä½œä»»åŠ¡ã€‚</strong></li>
<li><strong>å¼¥åˆ Sim2Real çš„é¸¿æ²Ÿï¼šæ— éœ€æˆåŠŸæ“ä½œæ•°æ®ï¼Œä»…å‡­åˆ†å¸ƒæœ‰åçš„çœŸå®æ•°æ®å³å¯å®Œæˆé«˜ç²¾åº¦å­¦ä¹ ï¼Œå…‹æœçµå·§æ“ä½œ Sim2Real çš„å·®è·ï¼Œå®ç°äº† â€œä» 0 åˆ° 1â€ çš„çªç ´ã€‚</strong></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aadf8e1f9794b41af5665dd5d0e4e9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=1h5BbiCCctMG25%2Fmc9lS%2FQBIxjs%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸‹ï¼Œç¦»æµæ°´çº¿å’Œå¨æˆ¿é‡Œçš„çµå·§æœºå™¨äººï¼ŒçœŸä¸è¿œäº†ï¼</p>
<h2 data-id="heading-0">æ‰‹å†…æ“ä½œçš„é€šç”¨ç­–ç•¥</h2>
<p>å¦‚ä¸Šæ‰€è¿°ï¼ŒDexNDM çš„æ ¸å¿ƒçªç ´åœ¨äº<strong>é¦–æ¬¡åœ¨çœŸå®ä¸–ç•Œä¸­çªç ´äº†æ‰‹æŒä»»æ„æœå‘çš„ç‰©ä½“æ—‹è½¬é™åˆ¶</strong>ï¼Œå®ç°äº†è·¨ç‰©ä½“ã€è·¨å§¿æ€çš„ç¨³å®š<strong>æ‰‹å†…æ—‹è½¬ (In-Hand Rotation)</strong> ä¸<strong>å·¥å…·æ“ä½œ (Tool Use)</strong>ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒDexNDM èƒ½åœ¨æå…·æŒ‘æˆ˜çš„æ‰‹è…•å§¿æ€ä¸‹ï¼ˆå¦‚æ‰‹æŒæœä¸‹æˆ–ä¾§å‘ï¼‰ï¼Œå®ç°é•¿ç‰©ä½“æ²¿é•¿è¾¹çš„è¿ç»­æ—‹è½¬ï¼Œä»¥åŠå°ç‰©ä½“åœ¨å¤šç§è½¬è½´ä¸‹çš„ç¨³å®šæ—‹è½¬ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c43bad4c828441891ba20d6f0c78c90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=4TdbeXXKhHhsXrBGloyqWN6l4pA%3D" alt="" loading="lazy"/></p>
<p>åœ¨æ“ä½œå¯¹è±¡ä¸Šï¼ŒDexNDM èƒ½å¤„ç†ä»å°å‹åˆ°ç»†é•¿ã€ä»ç®€å•å‡ ä½•åˆ°å¤æ‚ç»“æ„çš„å¤šç§ç‰©ä½“ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a16dfc30b9674ecab9e79598829a3989~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=3Rp0keo%2Fqr6cyooR360rgYID7hc%3D" alt="" loading="lazy"/></p>
<p>é‚£ä¹ˆï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61b0a26a35954d55bf96a146c0df5395~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=25MuvWJ7HGBbMagimE5Rvav0RWQ%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œçš„å…³é”®åœ¨äº DexNDM çš„<strong>å…³èŠ‚çº§ç¥ç»åŠ¨åŠ›å­¦æ¨¡å‹ï¼ˆ JOINT-WISE NEURAL DYNAMICS MODELï¼‰</strong>ã€‚</p>
<p>ä¸åŒäºä»¥å¾€æ•´æ‰‹å»ºæ¨¡çš„æ–¹å¼ï¼ŒDexNDM å°†å¤æ‚çš„æ‰‹â€“ç‰©äº¤äº’æ‹†è§£åˆ°<strong>å…³èŠ‚çº§</strong>ï¼Œè®©æ¯ä¸ªå…³èŠ‚ç‹¬ç«‹é¢„æµ‹è‡ªèº«çš„ä¸‹ä¸€çŠ¶æ€ï¼Œå®Œæˆæ•´æ‰‹çš„è¿åŠ¨é¢„æµ‹ã€‚</p>
<p>è¿™ç§åˆ†è§£ä¸ä»…æ˜¾è‘—æå‡äº†æ•°æ®åˆ©ç”¨æ•ˆç‡ï¼Œè¿˜èƒ½å¢å¼ºæ¨¡å‹åœ¨ä¸åŒç‰©ä½“ã€å§¿æ€ä¸‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<p>ä¸ºäº†å­¦ä¹ åˆ°å…·æœ‰è‰¯å¥½æ³›åŒ–æ€§çš„åŠ¨åŠ›å­¦æ¨¡å‹ï¼Œå›¢é˜Ÿå¼€å‘äº†ä¸€å¥—<strong>å…¨è‡ªåŠ¨æ•°æ®æ”¶é›†ç­–ç•¥</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32664d1a145843939ddff1b97b7076b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=nen%2F33Fh3RYqFAUiR5wVqrFiT40%3D" alt="" loading="lazy"/></p>
<p>åœ¨ä»»åŠ¡æ— å…³çš„éšæœºæ‰°åŠ¨ä¸‹ï¼Œæœºå™¨äººèƒ½è‡ªä¸»ç”Ÿæˆä¸°å¯Œçš„æ¥è§¦æ•°æ®ï¼Œä¸ç”¨äººå·¥é‡ç½®ï¼Œä¹Ÿä¸ä¼šé¢‘ç¹ â€œç¿»è½¦â€ã€‚</p>
<p>è¿™æ ·ï¼Œæ¨¡å‹å¯ä»¥åœ¨å»‰ä»·ã€å¯æ‰©å±•çš„æ•°æ®ä¸Šå­¦ä¹ åˆ°è¶³å¤Ÿä¸°å¯Œçš„äº¤äº’åŠ¨åŠ›å­¦ã€‚</p>
<p>åŸºäºæ­¤ï¼Œç ”ç©¶è€…è¿›ä¸€æ­¥è®­ç»ƒäº†ä¸€ä¸ª<strong>æ®‹å·®ç­–ç•¥ç½‘ç»œ</strong>ï¼Œç”¨äºå¼¥åˆä»¿çœŸåˆ°ç°å®çš„å·®è·ï¼Œä½¿ä»¿çœŸä¸­å­¦åˆ°çš„åŸºç¡€ç­–ç•¥èƒ½å¤Ÿé¡ºåˆ©è¿ç§»åˆ°çœŸå®ä¸–ç•Œã€‚</p>
<p>åœ¨ç­–ç•¥å­¦ä¹ ä¸Šï¼ŒDexNDM é‡‡ç”¨äº† â€œä»ä¸“å®¶åˆ°é€šæ‰ï¼ˆexpert-to-generalistï¼‰â€ çš„è®­ç»ƒæµç¨‹ï¼š</p>
<blockquote>
<p>å…ˆé’ˆå¯¹ä¸åŒé•¿å®½æ¯”ä¸å‡ ä½•å¤æ‚åº¦çš„ç‰©ä½“è®­ç»ƒå¤šä¸ªä¸“å®¶ç­–ç•¥ï¼Œå†å°†å®ƒä»¬èåˆæç‚¼ä¸ºä¸€ä¸ªç»Ÿä¸€çš„é€šç”¨ç­–ç•¥ï¼Œä»è€Œå®ç°è·¨ä»»åŠ¡ã€è·¨å½¢æ€çš„ç¨³å®šæ“ä½œã€‚</p>
</blockquote>
<p>ä»¿çœŸä¸çœŸå®ç¯å¢ƒçš„æµ‹è¯•è¡¨æ˜ï¼ŒDexNDM çš„æ“ä½œçµæ´»æ€§ã€é²æ£’æ€§ä¸æ³›åŒ–èƒ½åŠ›éƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼š</p>
<blockquote>
<p>ä¸ä»…é¦–æ¬¡åœ¨æ‰‹æŒæœä¸‹çš„å§¿æ€ä¸‹ï¼Œå®ç°äº† 10â€“16cm é•¿ç‰©ä½“æ²¿é•¿è½´çš„ç©ºä¸­å®Œæ•´æ—‹è½¬ï¼Œè¿˜èƒ½å¤Ÿç¨³å®šæ³›åŒ–åˆ°æ›´å¤šã€æ›´å…·æŒ‘æˆ˜æ€§çš„ç‰©ä½“ç±»å‹ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ad5a6bcdb964227b7a5fe3072aa2dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=FNN2InBX7Sali3AzeOXA0cX%2BJ%2BQ%3D" alt="" loading="lazy"/></p>
<p>æ­¤å¤–ï¼Œç ”ç©¶è¿˜å°†è¿™å¥—<strong>é€šç”¨æ—‹è½¬ç­–ç•¥ä½œä¸ºåº•å±‚æŠ€èƒ½æ¥å…¥é¥æ“ä½œç³»ç»Ÿ</strong>ã€‚</p>
<p>æ“ä½œè€…åªéœ€é€šè¿‡ VR æ§åˆ¶å™¨ç»™å‡ºè‡‚ç«¯ä½å§¿æˆ–æ—‹è½¬è½´ç­‰é«˜å±‚æŒ‡ä»¤ï¼ŒDexNDM å³å¯è‡ªä¸»å®Œæˆæ‰‹æŒ‡å±‚é¢çš„ç²¾ç»†æ§åˆ¶ã€‚</p>
<p>è¿™ç§æ–¹å¼å…‹æœäº†ä¼ ç»Ÿé¥æ“ä½œåœ¨ç²¾ç»†æ“ä½œä¸­çš„æ ¹æœ¬éš¾é¢˜â€”â€”äººæ‰‹ä¸æœºæ¢°æ‰‹åœ¨è‡ªç”±åº¦ã€ä¼ æ„Ÿå’ŒåŠ¨åŠ›å­¦ä¸Šçš„ä¸åŒ¹é…ã€‚</p>
<p>å€ŸåŠ© DexNDMï¼Œæœºå™¨äººä¸ä»…èƒ½ â€œæŠ“å¾—ç¨³ã€æ”¾å¾—å‡†â€ï¼Œè¿˜èƒ½å®Œæˆå¤æ‚çš„ã€æ¶‰åŠæ—‹è½¬çš„<strong>æ‰‹â€”ç‰©â€”ç‰©äº¤äº’</strong>ï¼Œå®ç°å·¥å…·ä½¿ç”¨ä¸é•¿ç¨‹è£…é…ç­‰å¯¹ç³»ç»Ÿé²æ£’æ€§è¦æ±‚æé«˜çš„ä»»åŠ¡ï¼ŒçœŸæ­£è¿ˆå‘ â€œèƒ½è½¬èƒ½ç”¨â€ çš„çµå·§æ“ä½œã€‚</p>
<h2 data-id="heading-1">ä»ç®€å•æŠ“å–åˆ°ç²¾ç»†æ“ä½œ</h2>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒDexNDM è§£å†³çš„æ˜¯æœºå™¨äººç ”ç©¶ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„æ‰‹å†…æ“ä½œä¸­çš„å…³é”®é—®é¢˜â€”â€”æ‰‹å†…æ—‹è½¬ï¼ˆin-hand rotationï¼‰ã€‚</p>
<p>è¿™ä¸€çªç ´ä¹‹æ‰€ä»¥æ„ä¹‰é‡å¤§ï¼Œæ˜¯å› ä¸ºå®ƒç›´æ¥æ¨åŠ¨äº†æœºå™¨äººä»ç®€å•èƒ½åŠ›å‘ç²¾ç»†æ“ä½œèƒ½åŠ›çš„è·¨è¶Šã€‚</p>
<p>æ•´ä½“æ¥çœ‹ï¼Œæœºå™¨äººçš„èƒ½åŠ›å¤§è‡´å¯åˆ†ä¸º<strong>è¿åŠ¨èƒ½åŠ›</strong>ä¸<strong>æ“ä½œèƒ½åŠ›</strong>ä¸¤ç±»ã€‚</p>
<p>è¿åŠ¨èƒ½åŠ›ï¼Œæ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ â€œè·‘â€â€œè·³â€â€œç¿»â€â€”â€”ä»¥åŠä¿æŒå…¨èº«ç¨³å®šçš„ <strong>whole-body control</strong>ã€‚</p>
<p>å¦‚ä»Šï¼Œæœºå™¨äººä¸å†éœ€è¦è¢«ç»³å­åŠç€é˜²æ‘”ï¼Œç”šè‡³åœ¨äººä¸ºå¹²æ‰°ä¸‹ä»èƒ½ç¨³ä½èº«å½¢ï¼Œå„ç§ç¿»è·Ÿå¤´ã€è·³èˆçš„ demo å±•ç¤ºä¹Ÿæ˜¯å±‚å‡ºä¸ç©·ã€‚</p>
<p>è€Œç«™ç¨³ä¹‹åï¼Œæƒ³è®©æœºå™¨äººçœŸæ­£å…·å¤‡ç”Ÿäº§åŠ›ï¼Œå…³é”®è¿˜åœ¨äºâ€”â€”<strong>æ“ä½œï¼ˆmanipulationï¼‰</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fc7acca63fb42d68c0dbdccc8c1ed8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=yAVBIoVw3%2FUXmPHd0tq2FZ3AUDE%3D" alt="" loading="lazy"/></p>
<p>æ‰€è°“æ“ä½œï¼Œå°±æ˜¯æœºå™¨äººçœŸæ­£ â€œåŠ¨æ‰‹å¹²æ´»â€ çš„èƒ½åŠ›ï¼Œå®ƒåŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>æŠ“å–ï¼šæ”¹å˜ç‰©ä½“ç›¸å¯¹äºæœºå™¨äººæœ¬ä½“çš„ä½ç½®ï¼Œå¦‚æ‹¿èµ· / æ”¾ä¸‹ç‰©ä½“ã€‚</p>
</li>
<li>
<p>ç¯å¢ƒè¾…åŠ©æ“ä½œï¼šå€ŸåŠ©å¤–ç•Œå®Œæˆä»»åŠ¡ï¼Œå¦‚æ¡Œå­ï¼Œå¹³å°ç­‰ã€‚</p>
</li>
<li>
<p>æŸ”æ€§ç‰©ä½“æ“ä½œï¼šå¤„ç†è¡£ç‰©ã€ç»³ç´¢ã€æ¶²ä½“ç­‰ã€‚</p>
</li>
<li>
<p>æ‰‹å†…æ“ä½œï¼šåœ¨ä¸å€ŸåŠ©å¤–éƒ¨ç¯å¢ƒæˆ–æ”¯æ’‘çš„æƒ…å†µä¸‹ï¼Œä»…é€šè¿‡æœºæ¢°æ‰‹çš„æ‰‹æŒ‡è¿åŠ¨å’Œè°ƒæ•´æŠ“å–å§¿åŠ¿æ¥æ”¹å˜ç‰©ä½“åœ¨æ‰‹æŒä¸­çš„ä½ç½®å’Œå§¿æ€ï¼Œå¦‚ DexNDM å¯¹åº”çš„æ‰‹å†…æ—‹è½¬ã€‚</p>
</li>
<li>
<p>å·¥å…·æ“ä½œï¼šæ¶‰åŠä¸ç¯å¢ƒæˆ–å¦ä¸€ä¸ªç‰©ä½“æŒç»­ã€å¼ºçƒˆçš„ç‰©ç†æ¥è§¦ï¼Œé€šå¸¸ç”¨äºå®Œæˆç‰¹å®šçš„ç²¾ç»†ä»»åŠ¡ã€‚</p>
</li>
</ul>
<p>è™½ç„¶ç›®å‰å¤§éƒ¨åˆ†çš„æœ«ç«¯æ‰§è¡Œå™¨éƒ½èƒ½å¾ˆå¥½åœ°å®ŒæˆæŠ“å–ä»»åŠ¡ï¼Œä½†ç®€å•æŠ“å–çš„åº”ç”¨èŒƒå›´ååˆ†æœ‰é™ï¼Œä¸»è¦é›†ä¸­åœ¨ä¸Šä¸‹æ–™ã€åˆ†æ‹£ç­‰åœºæ™¯ï¼Œè¿œæœªè§¦åŠçœŸæ­£çš„å·¥ä¸šçº§ç”Ÿäº§åŠ›ã€‚</p>
<p>å› æ­¤ï¼Œçµå·§æ“ä½œå¿…é¡»ä» â€œèƒ½æŠ“èƒ½æ”¾â€ è¿ˆå‘â€œèƒ½è½¬èƒ½ç”¨â€ï¼Œä»¥å®ç°æ›´å¤æ‚ã€æ›´ç²¾ç»†çš„åŠ¨ä½œã€‚</p>
<p>ç„¶è€Œï¼Œè¿™æ°æ°æ˜¯æœºå™¨äººç ”ç©¶ä¸­æœ€éš¾å•ƒçš„éª¨å¤´ã€‚</p>
<p>æœºå™¨äººå…ˆé©± Rodney Brooks æ›¾è¯´ï¼š</p>
<blockquote>
<p>çµå·§æ“ä½œæ˜¯é€šç”¨æœºå™¨äººéƒ¨ç½²ä¸­æœ€è‰°éš¾çš„å‰æ²¿ã€‚</p>
</blockquote>
<p>åŸå› å¾ˆç®€å•ï¼Œçµå·§æ‰‹è™½å¸¦æ¥äº†æ¯”å¤¹çˆªæ›´é«˜çš„è‡ªç”±åº¦ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æˆå€çš„æ§åˆ¶éš¾åº¦ã€‚</p>
<p>é©¬æ–¯å…‹ä¹Ÿæ›¾æ„Ÿå¹ï¼š</p>
<blockquote>
<p>äººç±»çš„æ‰‹æå…¶ç²¾å¯†å¤æ‚â€¦â€¦ å®ƒå¯ä»¥æŒ¥æ£’ã€ç©¿é’ˆã€å¼¹ç´ï¼Œä¹Ÿèƒ½æ‹†è½¦è£…è½¦ã€‚è‹¥è¦é€ å‡ºçœŸæ­£é€šç”¨çš„äººå½¢æœºå™¨äººï¼Œå¿…é¡»å…ˆè§£å†³æ‰‹çš„é—®é¢˜ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a033b5ae31c4c969c3fb74c85364d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=hSy9CSHh%2Fs%2FSjtow69Vqo0JLf14%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥è¯´ï¼Œæƒ³å®ç°çœŸæ­£é€šç”¨çš„çµå·§æ“ä½œï¼Œå°±å¿…é¡»æ”»å…‹çµå·§æ‰‹çš„ç²¾ç»†æ“ä½œã€‚</p>
<p><strong>å…¶ä¸­ï¼Œæ‰‹å†…æ—‹è½¬å’Œå·¥å…·ä½¿ç”¨èƒ½åŠ›æ­£æˆä¸ºå­¦ç•Œç ”ç©¶çš„ç„¦ç‚¹ï¼Œä»£è¡¨äº†çµå·§æ“ä½œå‘æ›´é«˜ç»´åº¦å‘å±•çš„è¶‹åŠ¿ã€‚</strong></p>
<p>å‰è€…è®©æœºå™¨äººèƒ½çµæ´»è°ƒæ•´æŠ“å–å§¿æ€ï¼Œä½¿æ“ä½œæ›´é¡ºæ‰‹ï¼Œåè€…åˆ™è®©æœºå™¨äººçœŸæ­£èƒ½ â€œå¹²æ´»â€ï¼Œæ‹§èºä¸ã€ç ¸é’‰å­ã€åˆ‡å‰²ã€ç»„è£…ã€‚</p>
<p>ä½†è¿™ä¸¤é¡¹èƒ½åŠ›ï¼Œä¹Ÿæ­£æ˜¯éš¾åº¦çš„å·…å³°ã€‚å®ƒä»¬æ¶‰åŠå¤æ‚ä¸”å¿«é€Ÿå˜åŒ–çš„æ‰‹â€“ç‰©æ¥è§¦å’Œæ‰‹â€“ç‰©â€“ç‰©äº¤äº’ï¼Œæ˜¯çµå·§æ“ä½œçš‡å† ä¸Šçš„æ˜ç ã€‚</p>
<p>è€Œ DexNDM çš„çªç ´ï¼Œå°±åœ¨äºæ­¤ã€‚å®ƒåŒæ—¶æ”»å…‹äº† â€œæ—‹è½¬â€ å’Œâ€œä½¿ç”¨â€è¿™ä¸¤å¤§éš¾é¢˜ï¼šæ—¢èƒ½å®ç°é«˜ç²¾åº¦çš„æ‰‹å†…æ—‹è½¬ï¼Œä¹Ÿèƒ½çµæ´»å¤„ç†å¤šç§å·¥å…·çš„æ“ä½œä»»åŠ¡ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œåªæœ‰å½“æœºå™¨äººèƒ½å¯é åœ°å®Œæˆè¿™ç±»æ“ä½œï¼Œè¯­è¨€ã€è§†è§‰ç­‰é«˜å±‚æ™ºèƒ½è§„åˆ’ï¼Œæ‰èƒ½çœŸæ­£è½åœ°ä¸ºå…·ä½“çš„åŠ¨ä½œä¸æ‰§è¡Œã€‚</p>
<p>è¿™æ­£æ˜¯é€šç”¨æœºå™¨äººä¸å…·èº«æ™ºèƒ½è½åœ°çš„å…³é”®ç“¶é¢ˆã€‚</p>
<p>ä¸è¿‡ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸å®¹æ˜“ã€‚</p>
<h2 data-id="heading-2">é€šç”¨çš„æ‰‹å†…æ—‹è½¬ç­–ç•¥</h2>
<p>ç›´è§‚åœ°çœ‹ï¼Œåœ¨æ‹§èºä¸è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œçµå·§æ‰‹æ— æ³•åƒæ‰‹æŒæœä¸Šæ—¶é‚£æ ·ä¾èµ–é‡åŠ›æ¥ç¨³å®šç‰©ä½“ã€‚</p>
<p>ä¸ºäº†ä¸è®©èºä¸åˆ€æ»‘è½ï¼Œæ¨¡å‹å¿…é¡»ç²¾ç¡®æ§åˆ¶æ›´å¤šçš„è‡ªç”±åº¦ï¼Œå®ç°å¯¹å§¿æ€ã€åŠ›å’Œæ¥è§¦çš„åè°ƒæ§åˆ¶ã€‚</p>
<p>è¿‡å»çš„æ‰‹å†…æ“ä½œæ–¹æ³•å¤§å¤šåªèƒ½å¤„ç†ç‰¹å®šç‰©ä½“æˆ–å›ºå®šå§¿æ€ï¼Œä¾èµ–æ˜‚è´µæˆ–å®šåˆ¶åŒ–ç¡¬ä»¶ï¼Œéš¾ä»¥æ¨å¹¿åˆ°æ›´é€šç”¨çš„åœºæ™¯ã€‚</p>
<p>å…¶æ ¹æºåœ¨äºçµå·§æ‰‹æœ¬èº«çš„é«˜è‡ªç”±åº¦ï¼ˆäººæ‰‹æœ‰ 21 ä¸ªè‡ªç”±åº¦ï¼ŒåŠ ä¸Šæ‰‹è…•å°±æœ‰ 27 ä¸ªè‡ªç”±åº¦ï¼‰ä¸å¤æ‚è€¦åˆï¼šå…³èŠ‚å½¼æ­¤å½±å“ï¼Œæ‰‹ä¸ç‰©ä½“ä¹‹é—´çš„æ¥è§¦ä¸æ–­å˜åŒ–ï¼Œå»ºæ¨¡æå…¶å›°éš¾ã€‚</p>
<p>å†åŠ ä¸Šæ‰§è¡Œè¿‡ç¨‹ä¸­å­˜åœ¨è‡ªé®æŒ¡ã€ä¼ æ„Ÿä¸å®Œå…¨ç­‰é—®é¢˜ï¼Œæ¨¡å‹å¾€å¾€æ— æ³•å‡†ç¡®æ•æ‰è¿™äº›å¾®å¦™çš„åŠ¨åŠ›å­¦ç»†èŠ‚ã€‚</p>
<p>æ›´æ£˜æ‰‹çš„æ˜¯ï¼Œä»¿çœŸä¸ç°å®ä¹‹é—´çš„åŠ¨åŠ›å­¦å·®è·ä¾æ—§å·¨å¤§ã€‚è®¸å¤šç­–ç•¥åœ¨ä»¿çœŸç¯å¢ƒä¸‹è¡¨ç°å®Œç¾ï¼Œä¸€æ—¦è¿›å…¥ç°å®å°± â€œç¿»è½¦â€ã€‚è€Œæƒ³ä¾é çœŸå®æ•°æ®ä¿®æ­£ï¼Œåˆè¦æ‰¿æ‹…é«˜æ˜‚çš„é‡‡é›†æˆæœ¬å’Œå¤±è´¥é£é™©ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒCMU ä¸ Meta åœ¨ã€ŠScience Roboticsã€‹å°é¢è®ºæ–‡ â€œNeuralFeels with Neural Fieldsâ€ ä¸­å¼•å…¥è§†è§‰ - è§¦è§‰èåˆæ¨¡å‹ï¼Œä»¥å¼¥è¡¥çº¯è§†è§‰æ„ŸçŸ¥çš„ä¸è¶³ï¼Œä½†ä¾ç„¶éš¾ä»¥è·¨è¶Š Sim-to-Real çš„é¸¿æ²Ÿã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5baa62ad050640f8b03d0c227914bcc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=RiooOI10e0xudDHtknV0qqRXZfs%3D" alt="" loading="lazy"/></p>
<p>ICRA 2023 çš„ BACH (Belt-Augmented Compliant Hand) åˆ™é€šè¿‡çš®å¸¦å¢å¼ºçš„æŸ”æ€§æœºæ¢°æ‰‹å®ç°äº†æ‰‹è…•å‘ä¸‹çš„æ—‹è½¬æ“ä½œï¼Œä½†è¿™ç§ç‰¹æ®Šç»“æ„éš¾ä»¥è¿ç§»ï¼Œä¹Ÿå¸¦æ¥äº†é¢å¤–çš„ç¡¬ä»¶æˆæœ¬ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f9a7805f30749799564ff2fb2140323~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=cU%2FphEU75%2BHw3aPfatGrIWxr2Yg%3D" alt="" loading="lazy"/></p>
<p>ç±»ä¼¼åœ°ï¼ŒDexCtrl åœ¨æ—‹è½¬è½´é€šç”¨æ€§ä¸Šå–å¾—è¿›å±•ï¼Œå´ä»å—é™äºç‰©ä½“å¤æ‚åº¦ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9903ec7b34434e59b9d9ec4f6ce1ccba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=S9%2BHPhUsnAGSzRYql3Pwue5U%2B6o%3D" alt="" loading="lazy"/></p>
<p>è€Œ DexGen è™½èƒ½æ‰§è¡Œæ‹§èºä¸ä»»åŠ¡ï¼Œå´ç¼ºä¹å¯¹ç›®æ ‡ç‰©ä½“è¿åŠ¨çš„ç²¾ç¡®æ§åˆ¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7f5d797066c4f94bde8e5dd60178fbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371860&amp;x-signature=tO%2FyC0cqazsuoDfl%2FJrtehuQQzE%3D" alt="" loading="lazy"/></p>
<p>åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çª¥è§ï¼Œå½“å‰çš„æ‰‹å†…æ“ä½œæ–¹æ³•å¾€å¾€å±€é™äºç‰¹å®šåœºæ™¯ï¼ˆå¦‚å›ºå®šæ‰‹è…•æœå‘ï¼‰ã€åªèƒ½å¤„ç†æœ‰é™é›†åˆçš„å¸¸è§„ç‰©ä½“ï¼Œæˆ–ä¾èµ–æ˜‚è´µã€å®šåˆ¶åŒ–ç¡¬ä»¶ã€‚å³ä¾¿åœ¨å•ä¸€ç»´åº¦ï¼ˆå¦‚æ—‹è½¬è½´ï¼‰ä¸Šå®ç°äº†é€šç”¨æ€§ï¼Œä»éš¾ä»¥åœ¨å¤šç»´æ“ä½œä¸­ä¿æŒç¨³å®šè¡¨ç°ã€‚</p>
<p>åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒDexNDM å®ç°äº†å®è´¨æ€§é£è·ƒâ€”â€”é¦–æ¬¡æ„å»ºäº†èƒ½å¤Ÿè·¨ç‰©ä½“ç±»åˆ«ã€è·¨å§¿æ€ä»»åŠ¡çš„é€šç”¨æ‰‹å†…æ“ä½œç­–ç•¥ã€‚</p>
<p>å®ƒä¸ä»…ä¸ºé¥æ“ä½œç³»ç»Ÿçš„æ•°æ®ç”Ÿæˆä¸ç­–ç•¥è¿ç§»æä¾›äº†åšå®åŸºç¡€ï¼Œä¹Ÿä¸ºçµå·§æ“ä½œçš„å·¥ä¸šåŒ–è½åœ°å¥ å®šäº†æ¡ä»¶ï¼šæ ·æœ¬æ•ˆç‡æ›´é«˜ã€æ³›åŒ–æ€§æ›´å¼ºã€èƒ½åŠ›å¯å¤ç”¨ï¼Œä¸ºå…·èº«æ™ºèƒ½ç ”ç©¶æä¾›äº†æ–°çš„åº•å±‚åŸºç¡€è®¾æ–½ã€‚</p>
<p>åŒæ—¶ï¼Œé¥æ“åº”ç”¨ä¹Ÿå¯è¿›ä¸€æ­¥æ‰©å±•è‡³å¹¿æ³›çš„ä»»åŠ¡ç±»å‹ï¼ŒååŠ©è·å–å„ç±»ä»»åŠ¡æ‰€éœ€çš„æ“ä½œæ•°æ®ã€‚</p>
<h2 data-id="heading-3">ç”Ÿäº§åŠ›å³äº§å“</h2>
<p>DexNDM çš„æ„ä¹‰ä¸ä»…åœ¨äºä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼Œæ›´åœ¨äºå®ƒæ¨åŠ¨äº†çµå·§æ“ä½œè¿™ä¸€ â€œçš‡å† ä¸Šçš„æ˜ç â€ ä»å­¦æœ¯ç ”ç©¶èµ°å‘äº†å¯å¤ç”¨çš„ç”Ÿäº§åŠ›åŸºç¡€è®¾æ–½ã€‚</p>
<p>ä»æœ€åˆçš„æ¬ç®±ã€ä¸Šä¸‹æ–™ï¼Œåˆ°å¦‚ä»Šèƒ½æ‹§èºä¸ã€ç ¸é’‰å­ã€è£…é…å®¶å…·ã€ä½¿ç”¨å·¥å…·ï¼Œçµå·§æ“ä½œæ­£é€æ­¥ä»æœºæ¢°é‡å¤åŠ³åŠ¨è€…ï¼Œè¿›åŒ–ä¸ºçœŸæ­£å…·å¤‡æ“ä½œæ™ºæ…§çš„ â€œç”Ÿäº§åŠ›å•å…ƒâ€ã€‚</p>
<p>å€ŸåŠ©è¿™ä¸€åº•å±‚èƒ½åŠ›ï¼Œæœºå™¨äººä¸å†å±€é™äºæ¼”ç¤ºæ€§çš„ â€œæŠ“å–æ”¾ç½®â€ï¼Œè€Œèƒ½åœ¨å·¥ä¸šè£…é…ã€å®¶å…·ç»„è£…ã€å·¥å…·ä½¿ç”¨ç­‰å¤šåœºæ™¯ä¸­å®ç°å¯æ‰©å±•éƒ¨ç½²ï¼ŒæŒç»­æå‡å®é™…ç”Ÿäº§åŠ›ã€‚</p>
<p>åœ¨å…¸å‹çš„è£…é…ä»»åŠ¡ä¸­ï¼Œè¿™ä¸€ â€œèƒ½å¹²æ´»çš„æœºå™¨äººâ€ çš„é›å½¢å·²åˆç°ç«¯å€ªï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œçµå·§æ‰‹ä½¿ç”¨èºä¸åˆ€ï¼Œå°†ç”µè·¯æ¿æ ¸å¿ƒéƒ¨ä»¶å›ºå®šã€‚</p>
<p>å®ƒèƒ½åœ¨æ‰‹å†…å¾®è°ƒèºä¸åˆ€çš„å§¿æ€ï¼Œä½¿å…¶åœ¨æœ€é¡ºæ‰‹çš„è§’åº¦ä¸‹æ–½åŠ›ï¼›å¯¹å‡† M2 å¾®å°èºä¸å­”åï¼Œç²¾å‡†æ–½å‹æ—‹å…¥ï¼Œæ—¢ä¸æ‰“æ»‘ä¹Ÿä¸æŸæ¿ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œå®‰è£…éŸ³é‡æ—‹é’®ã€‚</p>
<p>äº”æŒ‡ååŒç¨³æ¡æœ¨è´¨æ—‹é’®ï¼Œè°ƒæ•´å†…èºçº¹ä¸è½´å¿ƒå¯¹ä½åï¼Œå®Œæˆå¤§è§’åº¦æ—‹è½¬â€”â€”å°±åƒæ‹§ç´§ç“¶ç›–é‚£æ ·æµç•…ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œå®‰è£…è£…é¥°æ€§éƒ¨ä»¶ã€‚</p>
<p>çµå·§æ‰‹å…ˆå¤¹æŒé“†é’‰å®šä½ï¼Œå†æ—‹è½¬è°ƒæ•´å°é”¤çš„æ¡å§¿ï¼Œè½»æ•²å…¥ä½ï¼ŒåŠ›é‡ç²¾å‡†ã€èŠ‚å¥åˆ†æ˜ã€‚</p>
<p>è¿™ä¸‰æ­¥å±•ç¤ºäº†ä»æ‰‹å†…æ—‹è½¬åˆ°å¤šæŒ‡åè°ƒã€ä»é™æ€æ“ä½œåˆ°åŠ¨æ€æ•²å‡»çš„å…¨é“¾è·¯çµå·§æ§åˆ¶ï¼Œä¹Ÿæ ‡å¿—ç€çµå·§æ“ä½œæ­£åœ¨ä» â€œæŠ“å–â€ èµ°å‘ â€œä½¿ç”¨å·¥å…·â€ï¼Œä»â€œé‡å¤åŠ¨ä½œâ€ è¿ˆå‘â€œä»»åŠ¡ç†è§£â€ï¼Œæˆä¸ºçœŸæ­£çš„ç”Ÿäº§åŠ›ã€‚</p>
<p>æ­£å¦‚é“¶æ²³é€šç”¨æœºå™¨äººåˆ›å§‹äººã€CTO ç‹é¹¤æ‰€è¯´ï¼š</p>
<blockquote>
<p>å¦‚æœå¤§æ¨¡å‹æå€¡çš„æ˜¯æ™ºèƒ½å³äº§å“ï¼Œé‚£ä¹ˆå…·èº«æ™ºèƒ½æå€¡çš„å°±æ˜¯ç”Ÿäº§åŠ›å³äº§å“ã€‚</p>
</blockquote>
<p>æœ€åï¼Œè®©æˆ‘ä»¬å›åˆ°å¼€å¤´çš„é—®é¢˜ï¼šçµå·§æ‰‹å’Œå¤¹çˆªçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>â€”â€”ç”Ÿäº§åŠ›ã€‚</p>
<p><em>è®ºæ–‡é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2510.08556" target="_blank" title="https://arxiv.org/abs/2510.08556" ref="nofollow noopener noreferrer">arxiv.org/abs/2510.08â€¦</a></em></p>
<p><em>é¡¹ç›®ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmeowuu7.github.io%2FDexNDM%2F" target="_blank" title="https://meowuu7.github.io/DexNDM/" ref="nofollow noopener noreferrer">meowuu7.github.io/DexNDM/</a></em></p>
<p><strong>æ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æƒ³æ³•ï¼</strong></p>
<p>â€”Â <strong>å®Œ</strong>Â â€”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[wordæ–‡æ¡£è½¬htmlï¼ˆmammoth ï¼‰]]></title>    <link>https://juejin.cn/post/7570912420567285770</link>    <guid>https://juejin.cn/post/7570912420567285770</guid>    <pubDate>2025-11-10T09:33:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570912420567285770" data-draft-id="7570902804450344970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="wordæ–‡æ¡£è½¬htmlï¼ˆmammoth ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-10T09:33:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è€€è€€åˆ‡å…‹é—¹ç¬"/> <meta itemprop="url" content="https://juejin.cn/user/1781681116679854"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            wordæ–‡æ¡£è½¬htmlï¼ˆmammoth ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1781681116679854/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è€€è€€åˆ‡å…‹é—¹ç¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:33:56.000Z" title="Mon Nov 10 2025 09:33:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>æœ€è¿‘è€æœ‰éœ€è¦æŠŠåè®®Wordè½¬åŒ–ä¸ºhtmlçº¯é¢„è§ˆå±•ç¤ºçš„éœ€æ±‚ï¼Œä¸ºäº†åé¢æ–¹ä¾¿æ‘¸é±¼ï¼Œç”¨å·¥å…·åŒ…è„šæœ¬ç›´æ¥è½¬åŒ–ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯Â mammoth ã€‚</p>
</blockquote>
<h2 data-id="heading-1">Word è½¬ HTML å·¥å…·</h2>
<p>ä½¿ç”¨Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmwilliamson%2Fmammoth.js" target="_blank" title="https://github.com/mwilliamson/mammoth.js" ref="nofollow noopener noreferrer">mammoth</a>Â å°† Word æ–‡æ¡£è½¬æ¢ä¸º HTMLï¼Œç‰¹åˆ«é€‚ç”¨äºåè®®æ–‡æ¡£çš„åœ¨çº¿é¢„è§ˆã€‚</p>
<h3 data-id="heading-2">å®‰è£…ä¾èµ–</h3>
<p>bash</p>
<pre><code class="hljs">npm install mammoth
</code></pre>
<h3 data-id="heading-3">å®Œæ•´ä»£ç </h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> mammoth = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mammoth'</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> inputDir = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'input'</span>);
  <span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(inputDir).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.docx'</span>));
  <span class="hljs-keyword">return</span> files.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">inputPath</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'input'</span>,f),
      <span class="hljs-attr">outputPath</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>, f.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.html'</span>))
    }
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">transformParagraph</span>(<span class="hljs-params">element</span>) {
  <span class="hljs-keyword">let</span> styleName = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">if</span> (element.<span class="hljs-property">alignment</span> === <span class="hljs-string">"center"</span>) {
    styleName = <span class="hljs-string">"text-center"</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">alignment</span> === <span class="hljs-string">"right"</span>) {
    styleName = <span class="hljs-string">"text-right"</span>;
  }
  
  <span class="hljs-keyword">return</span> {
      ...element,
      styleName
  };
}

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">styleMap</span>: [
    <span class="hljs-string">"p[style-name='text-center'] =&gt; p.text-center:fresh"</span>,
    <span class="hljs-string">"p[style-name='text-right'] =&gt; p.text-right:fresh"</span>,
     <span class="hljs-string">"u =&gt; span.text-underline:fresh"</span>
  ],
  <span class="hljs-attr">transformDocument</span>: mammoth.<span class="hljs-property">transforms</span>.<span class="hljs-title function_">paragraph</span>(transformParagraph)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">convertToHtml</span> = (<span class="hljs-params">config</span>) =&gt; {
  <span class="hljs-keyword">const</span> { inputPath, outputPath } = config;
  <span class="hljs-keyword">return</span> mammoth.<span class="hljs-title function_">convertToHtml</span>({ <span class="hljs-attr">path</span>: inputPath }, options).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>){
    <span class="hljs-keyword">const</span> html = result.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> templatePath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'template.html'</span>)
    <span class="hljs-keyword">const</span> tempHtml = fs.<span class="hljs-title function_">readFileSync</span>(templatePath, <span class="hljs-string">'utf8'</span>)
    <span class="hljs-keyword">const</span> insertTag = <span class="hljs-string">'&lt;div id="app"&gt;'</span>
    <span class="hljs-keyword">const</span> insertIndex = tempHtml.<span class="hljs-title function_">lastIndexOf</span>(insertTag) + insertTag.<span class="hljs-property">length</span>
    <span class="hljs-keyword">const</span> resHtml = tempHtml.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, insertIndex) + html + tempHtml.<span class="hljs-title function_">slice</span>(insertIndex)
    fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, resHtml, <span class="hljs-string">'utf8'</span>)
  }).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
  });
}

<span class="hljs-keyword">const</span> allFileConfig = <span class="hljs-title function_">getFileConfig</span>();
<span class="hljs-keyword">const</span> allFileConfigLength = allFileConfig.<span class="hljs-property">length</span>;
<span class="hljs-comment">// æ¸…ç©º output ç›®å½•</span>
<span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>))) {
  fs.<span class="hljs-title function_">rmdirSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>), { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> });
}
fs.<span class="hljs-title function_">mkdirSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'output'</span>));

<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å¼€å§‹è½¬æ¢ï¼Œå…± <span class="hljs-subst">${allFileConfigLength}</span> ä¸ªæ–‡ä»¶`</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">runNext</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (index &gt;= allFileConfigLength) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶è½¬æ¢å®Œæˆï¼Œè¯·æŸ¥çœ‹ output ç›®å½•'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-keyword">const</span> config = allFileConfig[index];
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>: <span class="hljs-subst">${path.basename(config.inputPath)}</span>`</span>);
  
  <span class="hljs-title function_">convertToHtml</span>(config).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    index++;
    <span class="hljs-title function_">runNext</span>();
  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error processing file <span class="hljs-subst">${path.basename(config.inputPath)}</span>:`</span>, err);
    index++;
    <span class="hljs-title function_">runNext</span>();
  });
}

<span class="hljs-title function_">runNext</span>();




</code></pre>
<h3 data-id="heading-4">ç›®å½•ç»“æ„</h3>
<p>text</p>
<pre><code class="hljs language-css" lang="css">word-<span class="hljs-selector-tag">to</span>-<span class="hljs-selector-tag">html</span>/
â”œâ”€â”€ <span class="hljs-selector-tag">input</span>/                 # å­˜æ”¾è¦è½¬æ¢çš„ <span class="hljs-selector-class">.docx</span> æ–‡ä»¶
â”‚   â”œâ”€â”€ åè®®<span class="hljs-number">1</span><span class="hljs-selector-class">.docx</span>
â”‚   â””â”€â”€ åè®®<span class="hljs-number">2</span><span class="hljs-selector-class">.docx</span>
â”œâ”€â”€ output/                # è½¬æ¢åçš„ <span class="hljs-selector-tag">HTML</span> æ–‡ä»¶è¾“å‡ºç›®å½•
â”œâ”€â”€ template<span class="hljs-selector-class">.html</span>          # <span class="hljs-selector-tag">HTML</span> æ¨¡æ¿æ–‡ä»¶   
â”œâ”€â”€index<span class="hljs-selector-class">.js</span>
</code></pre>
<h3 data-id="heading-5">åœ¨package.jsonçš„scriptsä¸­æ·»åŠ å‘½ä»¤è¡Œè„šæœ¬</h3>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-string">"convert-doc"</span>: <span class="hljs-string">"node ./bin/word-to-html/index.js"</span>,
</code></pre>
<h3 data-id="heading-6">ä½¿ç”¨æ–¹æ³•</h3>
<ol>
<li>å°† Word æ–‡æ¡£ (.docx) æ”¾å…¥Â <code>input</code>Â ç›®å½•</li>
<li>è¿è¡Œè„šæœ¬ï¼š</li>
<li>æŸ¥çœ‹Â <code>output</code>Â ç›®å½•è·å–è½¬æ¢åçš„ HTML æ–‡ä»¶</li>
</ol>
<h3 data-id="heading-7">æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹ (template.html)</h3>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åè®®æ–‡æ¡£é¢„è§ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">"Microsoft YaHei"</span>, sans-serif;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>;
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
        }
        <span class="hljs-selector-id">#app</span> {
            <span class="hljs-attribute">background</span>: white;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
        }
        <span class="hljs-selector-class">.text-center</span> { <span class="hljs-attribute">text-align</span>: center; }
        <span class="hljs-selector-class">.text-right</span> { <span class="hljs-attribute">text-align</span>: right; }
        <span class="hljs-selector-class">.text-underline</span> { <span class="hljs-attribute">text-decoration</span>: underline; }
        <span class="hljs-selector-tag">table</span> {
            <span class="hljs-attribute">border-collapse</span>: collapse;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">15px</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-tag">table</span>, <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
        }
        <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">text-align</span>: left;
        }
        <span class="hljs-selector-tag">th</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>ç¡®ä¿ Word æ–‡æ¡£ä¸º .docx æ ¼å¼</li>
<li>å¤æ‚è¡¨æ ¼æ ·å¼å¯èƒ½éœ€è¦é¢å¤–è°ƒæ•´</li>
<li>è„šæœ¬ä¼šè‡ªåŠ¨è¦†ç›– output ç›®å½•ä¸­çš„ç°æœ‰æ–‡ä»¶</li>
<li>å»ºè®®åœ¨è½¬æ¢å‰å¤‡ä»½é‡è¦çš„ Word æ–‡æ¡£</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[KuiklyUIçš„ViewRefè®¾è®¡]]></title>    <link>https://juejin.cn/post/7570902804450934794</link>    <guid>https://juejin.cn/post/7570902804450934794</guid>    <pubDate>2025-11-10T09:55:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804450934794" data-draft-id="7570902804450836490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="KuiklyUIçš„ViewRefè®¾è®¡"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-10T09:55:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å†·"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            KuiklyUIçš„ViewRefè®¾è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å†·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:55:33.000Z" title="Mon Nov 10 2025 09:55:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">nativeRefä¸ViewRefã€AbstractBaseViewã€Pagerä»¥åŠViewContainerçš„å…³ç³»åˆ†æ</h2>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æKuiklyUIæ¡†æ¶ä¸­nativeRefä¸ViewRefã€AbstractBaseViewã€Pagerä»¥åŠViewContainerä¸ViewRefä¹‹é—´çš„å…³ç³»ï¼Œå¸®åŠ©æ‚¨å…¨é¢ç†è§£è§†å›¾å¼•ç”¨ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€nativeRefçš„æœ¬è´¨ä¸å·¥ä½œæœºåˆ¶</h3>
<h4 data-id="heading-2">1.1 nativeRefçš„å®šä¹‰ä¸ç”Ÿæˆæœºåˆ¶</h4>
<p>nativeRefæ˜¯KuiklyUIä¸­æ¯ä¸ªè§†å›¾å®ä¾‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå®šä¹‰åœ¨AbstractBaseViewç±»ä¸­ï¼š</p>
<pre><code class="hljs language-kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt" lang="kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt">abstract class AbstractBaseView&lt;A : Attr, E : Event&gt; : BaseObject(), IViewPublicApi&lt;A, E&gt;, IModuleAccessor, IPagerId {
    val nativeRef: Int = ++nativeRefProducer
    // ...
    companion object {
        var nativeRefProducer = 0
    }
}
</code></pre>
<p>nativeRefé€šè¿‡ä¸€ä¸ªé™æ€è®¡æ•°å™¨<code>nativeRefProducer</code>è‡ªå¢ç”Ÿæˆï¼Œç¡®ä¿æ¯ä¸ªè§†å›¾å®ä¾‹æ‹¥æœ‰å…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ¡†æ¶å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…ç²¾ç¡®è¯†åˆ«æ¯ä¸€ä¸ªè§†å›¾ã€‚</p>
<h4 data-id="heading-3">1.2 nativeRefåœ¨è§†å›¾ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨</h4>
<p>nativeRefåœ¨KuiklyUIæ¡†æ¶ä¸­æ‰®æ¼”ç€å¤šé‡å…³é”®è§’è‰²ï¼š</p>
<ol>
<li><strong>è§†å›¾èº«ä»½æ ‡è¯†</strong>ï¼šä½œä¸ºè§†å›¾å®ä¾‹çš„å”¯ä¸€èº«ä»½æ ‡è¯†</li>
<li><strong>è§†å›¾å¼•ç”¨ä¼ é€’</strong>ï¼šåœ¨çˆ¶å­è§†å›¾ä¹‹é—´ä¼ é€’å¼•ç”¨å…³ç³»</li>
<li><strong>è·¨å±‚é€šä¿¡æ¡¥æ¢</strong>ï¼šè¿æ¥Kotlinå±‚ä¸åŸç”Ÿæ¸²æŸ“å±‚</li>
<li><strong>å±æ€§ä¸äº‹ä»¶ç»‘å®š</strong>ï¼šåœ¨åˆ›å»ºAttrå’ŒEventå¯¹è±¡æ—¶è¢«æ³¨å…¥ï¼Œç”¨äºåç»­å±æ€§æ›´æ–°å’Œäº‹ä»¶åˆ†å‘</li>
</ol>
<p>åœ¨AbstractBaseViewçš„å†…éƒ¨å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°nativeRefè¢«æ³¨å…¥åˆ°Attrå’ŒEventå¯¹è±¡ä¸­ï¼š</p>
<pre><code class="hljs language-kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt" lang="kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/AbstractBaseView.kt">private fun internalCreateEvent(): E {
    val event = createEvent()
    event.init(pagerId,nativeRef)  // å°†nativeRefæ³¨å…¥åˆ°Eventå¯¹è±¡
    return event
}

protected fun internalCreateAttr(): A {
    val attr = createAttr()
    attr.pagerId = pagerId
    attr.nativeRef = nativeRef  // å°†nativeRefæ³¨å…¥åˆ°Attrå¯¹è±¡
    attr.flexNode = flexNode
    return attr
}
</code></pre>
<h3 data-id="heading-4">äºŒã€ViewRefä¸nativeRefçš„å…³ç³»</h3>
<h4 data-id="heading-5">2.1 ViewRefçš„å®šä¹‰ä¸å®ç°</h4>
<p>ViewRefæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼•ç”¨å°è£…ç±»ï¼Œå®šä¹‰åœ¨DeclarativeBaseView.ktä¸­ï¼š</p>
<pre><code class="hljs language-kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/DeclarativeBaseView.kt" lang="kotlin:/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/DeclarativeBaseView.kt">class ViewRef&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt;(val pagerId: String, val nativeRef: Int) {
    val view: T?
        get() = PagerManager.getPager(pagerId)
            .getViewWithNativeRef(nativeRef) as? T
}
</code></pre>
<h4 data-id="heading-6">2.2 ViewRefä¸nativeRefçš„åä½œå…³ç³»</h4>
<p>ViewRefä¸nativeRefä¹‹é—´å­˜åœ¨ç€ç´§å¯†çš„åä½œå…³ç³»ï¼š</p>
<ol>
<li><strong>ç»„æˆå…³ç³»</strong>ï¼šViewRefå°è£…äº†pagerIdå’ŒnativeRefä¸¤ä¸ªæ ¸å¿ƒå±æ€§</li>
<li><strong>å®šä½æœºåˆ¶</strong>ï¼šViewRefé€šè¿‡pagerIdå’ŒnativeRefç»„åˆå®šä½åˆ°å…·ä½“çš„è§†å›¾å®ä¾‹</li>
<li><strong>å»¶è¿ŸæŸ¥æ‰¾</strong>ï¼šViewRefçš„<code>view</code>å±æ€§é‡‡ç”¨æ‡’åŠ è½½æ–¹å¼ï¼Œåªæœ‰åœ¨éœ€è¦æ—¶æ‰é€šè¿‡PagerManageræŸ¥æ‰¾è§†å›¾</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šViewRefä½¿ç”¨æ³›å‹ç¡®ä¿è¿”å›çš„è§†å›¾ç±»å‹æ­£ç¡®</li>
</ol>
<h3 data-id="heading-7">ä¸‰ã€ViewRefä¸AbstractBaseViewçš„å…³ç³»</h3>
<h4 data-id="heading-8">3.1 refæ‰©å±•å‡½æ•°çš„å®ç°</h4>
<p>åœ¨DeclarativeBaseViewä¸­ï¼Œå®ç°äº†<code>ref</code>æ‰©å±•å‡½æ•°ï¼Œä½œä¸ºåˆ›å»ºViewRefçš„å…¥å£ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    ref(ViewRef&lt;T&gt;(pagerId, nativeRef))
}
</code></pre>
<h4 data-id="heading-9">3.2 AbstractBaseViewä¸ViewRefçš„äº¤äº’æµç¨‹</h4>
<p>AbstractBaseViewä¸ViewRefçš„äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>AbstractBaseViewå®ä¾‹åˆ›å»ºæ—¶ç”Ÿæˆå”¯ä¸€çš„nativeRef</li>
<li>é€šè¿‡refæ‰©å±•å‡½æ•°ï¼Œå°†å½“å‰è§†å›¾çš„pagerIdå’ŒnativeRefä¼ é€’ç»™ViewRefæ„é€ å‡½æ•°</li>
<li>ViewRefæŒæœ‰è¿™äº›å¼•ç”¨ä¿¡æ¯ï¼Œä½†ä¸ç›´æ¥æŒæœ‰è§†å›¾å®ä¾‹</li>
<li>å½“éœ€è¦è®¿é—®è§†å›¾æ—¶ï¼Œé€šè¿‡ViewRefçš„<code>view</code>å±æ€§é—´æ¥è·å–</li>
</ol>
<p>è¿™ç§è®¾è®¡å®ç°äº†è§†å›¾å¼•ç”¨çš„è§£è€¦ï¼Œä½¿æ¡†æ¶èƒ½å¤Ÿæ›´çµæ´»åœ°ç®¡ç†è§†å›¾ç”Ÿå‘½å‘¨æœŸå’Œå†…å­˜ã€‚</p>
<h3 data-id="heading-10">å››ã€ViewRefä¸Pagerçš„åä½œæœºåˆ¶</h3>
<h4 data-id="heading-11">4.1 Pagerçš„è§†å›¾å¼•ç”¨ç®¡ç†</h4>
<p>Pagerç±»å®ç°äº†IPageræ¥å£ï¼Œè´Ÿè´£ç®¡ç†è§†å›¾å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Pagerä¸­ç®¡ç†è§†å›¾å¼•ç”¨çš„å…³é”®ä»£ç </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> nativeRefViewMap = mutableMapOf&lt;<span class="hljs-built_in">Int</span>, AbstractBaseView&lt;*, *&gt;&gt;()

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">putNativeViewRef</span><span class="hljs-params">(nativeRef: <span class="hljs-type">Int</span>, view: <span class="hljs-type">AbstractBaseView</span>&lt;*, *&gt;)</span></span> {
    nativeRefViewMap[nativeRef] = view
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeNativeViewRef</span><span class="hljs-params">(nativeRef: <span class="hljs-type">Int</span>)</span></span> {
    nativeRefViewMap.remove(nativeRef)
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getViewWithNativeRef</span><span class="hljs-params">(nativeRef: <span class="hljs-type">Int</span>)</span></span>: AbstractBaseView&lt;*, *&gt;? {
    <span class="hljs-keyword">return</span> nativeRefViewMap[nativeRef]
}
</code></pre>
<h4 data-id="heading-12">4.2 ViewRefä¸Pagerçš„åä½œæµç¨‹</h4>
<p>ViewRefä¸Pagerçš„åä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ViewRefæŒæœ‰pagerIdå’ŒnativeRefä¿¡æ¯</li>
<li>å½“è°ƒç”¨ViewRefçš„<code>view</code>å±æ€§æ—¶ï¼Œé€šè¿‡PagerManagerè·å–å¯¹åº”pagerIdçš„Pagerå®ä¾‹</li>
<li>è°ƒç”¨Pagerçš„<code>getViewWithNativeRef</code>æ–¹æ³•ï¼Œé€šè¿‡nativeRefæŸ¥æ‰¾è§†å›¾å®ä¾‹</li>
<li>å°†æ‰¾åˆ°çš„è§†å›¾å®ä¾‹è½¬æ¢ä¸ºæ³›å‹Tç±»å‹å¹¶è¿”å›</li>
</ol>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ViewRefå¯ä»¥å®‰å…¨åœ°åœ¨ä»»ä½•åœ°æ–¹è®¿é—®è§†å›¾ï¼Œè€Œä¸éœ€è¦ç›´æ¥æŒæœ‰è§†å›¾å®ä¾‹çš„å¼ºå¼•ç”¨ï¼Œæœ‰åˆ©äºå†…å­˜ç®¡ç†å’Œè§†å›¾ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ã€‚</p>
<h3 data-id="heading-13">äº”ã€ViewContainerä¸ViewRefçš„å…³ç³»</h3>
<h4 data-id="heading-14">5.1 ViewContainerçš„è§†å›¾å±‚æ¬¡ç®¡ç†</h4>
<p>ViewContaineræ˜¯æ‰€æœ‰å®¹å™¨è§†å›¾çš„åŸºç±»ï¼Œè´Ÿè´£ç®¡ç†å­è§†å›¾å±‚æ¬¡ç»“æ„ï¼š</p>
<pre><code class="hljs language-kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt" lang="kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt">abstract class ViewContainer&lt;A : ContainerAttr, E : Event&gt; : DeclarativeBaseView&lt;A, E&gt;() {
    protected val children = fastArrayListOf&lt;DeclarativeBaseView&lt;*, *&gt;&gt;()
    // ...
}
</code></pre>
<h4 data-id="heading-15">5.2 ViewContainerä¸­nativeRefçš„åº”ç”¨</h4>
<p>åœ¨ViewContainerä¸­ï¼ŒnativeRefä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>çˆ¶è§†å›¾å¼•ç”¨ä¼ é€’</strong>ï¼šåœ¨æ·»åŠ å­è§†å›¾æ—¶ï¼Œè®¾ç½®å­è§†å›¾çš„parentRefä¸ºå½“å‰å®¹å™¨çš„nativeRef</li>
</ol>
<pre><code class="hljs language-kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt" lang="kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt">private fun internalAddChild(child: DeclarativeBaseView&lt;*, *&gt;, index: Int) {
    child.pagerId = pagerId
    child.willMoveToParentComponent()
    if (index &lt; 0) { // append when index -1
        children.add(child)
    } else {
        children.add(index, child)
    }
    child.parentRef = nativeRef  // è®¾ç½®çˆ¶è§†å›¾å¼•ç”¨
    child.didMoveToParentView()
}
</code></pre>
<ol start="2">
<li><strong>æ¸²æŸ“è§†å›¾ç®¡ç†</strong>ï¼šåœ¨åˆ›å»ºå’Œç§»é™¤æ¸²æŸ“è§†å›¾æ—¶ï¼Œä½¿ç”¨nativeRefæ ‡è¯†è§†å›¾</li>
</ol>
<pre><code class="hljs language-kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt" lang="kotlin:/Users/hdh/Documents/codes/KuiklyUI/core/src/commonMain/kotlin/com/tencent/kuikly/core/base/ViewContainer.kt">override fun createRenderView() {
    createRenderViewing = true
    super.createRenderView()
    createRenderViewing = false
    var index = 0
    renderChildren().forEach { child -&gt;
        child.createRenderView()
        renderView?.insertSubRenderView(child.nativeRef, index++)  // ä½¿ç”¨nativeRefæ ‡è¯†å­è§†å›¾
        child.renderViewDidMoveToParentRenderView()
    }
}
</code></pre>
<ol start="3">
<li><strong>è§†å›¾å¼•ç”¨é“¾å»ºç«‹</strong>ï¼šé€šè¿‡nativeRefå’ŒparentRefå»ºç«‹å®Œæ•´çš„è§†å›¾å¼•ç”¨é“¾</li>
</ol>
<h4 data-id="heading-16">5.3 ViewContainerä¸­ViewRefçš„ä½¿ç”¨åœºæ™¯</h4>
<p>åœ¨ViewContainerä¸­ï¼ŒViewRefä¸»è¦ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li><strong>å­è§†å›¾å¼•ç”¨è·å–</strong>ï¼šé€šè¿‡ViewRefå®‰å…¨åœ°è·å–å­è§†å›¾å¼•ç”¨ï¼Œè¿›è¡Œæ“ä½œæˆ–é€šä¿¡</li>
<li><strong>è·¨å±‚çº§è§†å›¾è®¿é—®</strong>ï¼šåœ¨å¤æ‚å¸ƒå±€ä¸­ï¼Œé€šè¿‡ViewRefå®ç°è·¨å±‚çº§çš„è§†å›¾è®¿é—®</li>
<li><strong>è§†å›¾ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåœ¨è§†å›¾æ·»åŠ ã€ç§»é™¤ç­‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸­ï¼Œé€šè¿‡ViewRefä¼ é€’å¼•ç”¨ä¿¡æ¯</li>
</ol>
<h3 data-id="heading-17">å…­ã€æ•´ä½“æ¶æ„ä¸æ•°æ®æµ</h3>
<h4 data-id="heading-18">6.1 æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------+      +------------------+      +------------------+</span>
|                  |      |                  |      |                  |
|  AbstractBaseView|&lt;<span class="hljs-comment">-----&gt;|    ViewRef       |&lt;-----&gt;|     Pager        |</span>
|                  |      |                  |      |                  |
+<span class="hljs-comment">--------^---------+      +------------------+      +------------------+</span>
         |
         |
+<span class="hljs-comment">--------+---------+      +------------------+</span>
|                  |      |                  |
|  ViewContainer   |&lt;<span class="hljs-comment">-----&gt;|   Declarative   |</span>
|                  |      |     BaseView     |
+<span class="hljs-comment">------------------+      +------------------+</span>
</code></pre>
<h4 data-id="heading-19">6.2 æ•°æ®æµå‘ä¸äº¤äº’æ¨¡å¼</h4>
<p>åœ¨KuiklyUIçš„è§†å›¾å¼•ç”¨ç³»ç»Ÿä¸­ï¼Œæ•°æ®æµå‘å’Œäº¤äº’æ¨¡å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>åˆ›å»ºé˜¶æ®µ</strong>ï¼šè§†å›¾å®ä¾‹åˆ›å»ºæ—¶ç”ŸæˆnativeRefï¼ŒPageræ³¨å†Œè§†å›¾å¼•ç”¨</li>
<li><strong>å¼•ç”¨å°è£…</strong>ï¼šé€šè¿‡refæ‰©å±•å‡½æ•°åˆ›å»ºViewRefå¯¹è±¡ï¼Œå°è£…pagerIdå’ŒnativeRef</li>
<li><strong>å¼•ç”¨è®¿é—®</strong>ï¼šé€šè¿‡ViewRefçš„viewå±æ€§ï¼Œé—´æ¥è®¿é—®è§†å›¾å®ä¾‹</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåœ¨è§†å›¾æ·»åŠ åˆ°å®¹å™¨æˆ–ä»å®¹å™¨ç§»é™¤æ—¶ï¼Œæ›´æ–°parentRefå’Œè§†å›¾å¼•ç”¨æ³¨å†ŒçŠ¶æ€</li>
<li><strong>é”€æ¯é˜¶æ®µ</strong>ï¼šè§†å›¾é”€æ¯æ—¶ï¼Œä»Pagerä¸­ç§»é™¤è§†å›¾å¼•ç”¨</li>
</ol>
<h3 data-id="heading-20">ä¸ƒã€è®¾è®¡ä¼˜åŠ¿ä¸æŠ€æœ¯äº®ç‚¹</h3>
<h4 data-id="heading-21">7.1 è®¾è®¡ä¼˜åŠ¿</h4>
<ol>
<li><strong>è§£è€¦è§†å›¾å¼•ç”¨</strong>ï¼šViewRefé€šè¿‡é—´æ¥å¼•ç”¨æœºåˆ¶ï¼Œå®ç°äº†è§†å›¾å¼•ç”¨ä¸è§†å›¾å®ä¾‹çš„è§£è€¦</li>
<li><strong>å†…å­˜ä¼˜åŒ–</strong>ï¼šé¿å…äº†ä¸å¿…è¦çš„å¼ºå¼•ç”¨ï¼Œæœ‰åˆ©äºå†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ³›å‹è®¾è®¡ç¡®ä¿äº†ç±»å‹å®‰å…¨ï¼Œå‡å°‘äº†è¿è¡Œæ—¶ç±»å‹è½¬æ¢é”™è¯¯</li>
<li><strong>çµæ´»çš„è§†å›¾è®¿é—®</strong>ï¼šå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡ViewRefå®‰å…¨åœ°è®¿é—®è§†å›¾ï¼Œä¸å—ç”Ÿå‘½å‘¨æœŸé™åˆ¶</li>
</ol>
<h4 data-id="heading-22">7.2 æŠ€æœ¯äº®ç‚¹</h4>
<ol>
<li><strong>å”¯ä¸€æ ‡è¯†ç¬¦ç”Ÿæˆæœºåˆ¶</strong>ï¼šé€šè¿‡é™æ€è®¡æ•°å™¨ç”Ÿæˆå…¨å±€å”¯ä¸€çš„nativeRef</li>
<li><strong>å»¶è¿ŸæŸ¥æ‰¾ç­–ç•¥</strong>ï¼šViewRefçš„viewå±æ€§é‡‡ç”¨æ‡’åŠ è½½æ–¹å¼ï¼Œåªæœ‰åœ¨éœ€è¦æ—¶æ‰æŸ¥æ‰¾è§†å›¾</li>
<li><strong>å¼•ç”¨é“¾ç®¡ç†</strong>ï¼šé€šè¿‡nativeRefå’ŒparentRefå»ºç«‹å®Œæ•´çš„è§†å›¾å±‚æ¬¡å¼•ç”¨é“¾</li>
<li><strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼šè®¾è®¡è€ƒè™‘äº†è·¨å¹³å°éœ€æ±‚ï¼ŒnativeRefä½œä¸ºç»Ÿä¸€çš„è§†å›¾æ ‡è¯†ç¬¦</li>
</ol>
<h3 data-id="heading-23">å…«ã€ä»£ç ä¼˜åŒ–å»ºè®®</h3>
<p>åŸºäºå¯¹ViewRefå’ŒnativeRefç³»ç»Ÿçš„åˆ†æï¼Œæå‡ºä»¥ä¸‹ä¼˜åŒ–å»ºè®®ï¼š</p>
<ol>
<li>
<p><strong>å¼•ç”¨æœ‰æ•ˆæ€§æ£€æŸ¥å¢å¼º</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åœ¨ViewRefçš„viewå±æ€§ä¸­æ·»åŠ æ›´å®Œå–„çš„æœ‰æ•ˆæ€§æ£€æŸ¥</span>
<span class="hljs-keyword">val</span> view: T?
    <span class="hljs-keyword">get</span>() {
        <span class="hljs-keyword">val</span> pager = PagerManager.getPager(pagerId)
        <span class="hljs-keyword">if</span> (pager == <span class="hljs-literal">null</span> || !pager.isActive()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        }
        <span class="hljs-keyword">val</span> view = pager.getViewWithNativeRef(nativeRef) <span class="hljs-keyword">as</span>? T
        <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span> &amp;&amp; view.isDestroyed()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        }
        <span class="hljs-keyword">return</span> view
    }
</code></pre>
</li>
<li>
<p><strong>å¼±å¼•ç”¨ä¼˜åŒ–</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åœ¨Pagerä¸­è€ƒè™‘ä½¿ç”¨WeakReferenceå­˜å‚¨è§†å›¾å¼•ç”¨ï¼Œé¿å…å†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> nativeRefViewMap = mutableMapOf&lt;<span class="hljs-built_in">Int</span>, WeakReference&lt;AbstractBaseView&lt;*, *&gt;&gt;&gt;()
</code></pre>
</li>
<li>
<p><strong>å¼•ç”¨ç¼“å­˜æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ºé¢‘ç¹è®¿é—®çš„ViewRefæ·»åŠ ç¼“å­˜æœºåˆ¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt;(<span class="hljs-keyword">val</span> pagerId: String, <span class="hljs-keyword">val</span> nativeRef: <span class="hljs-built_in">Int</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cachedView: T? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastCacheTime: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">val</span> view: T?
        <span class="hljs-keyword">get</span>() {
            <span class="hljs-keyword">val</span> currentTime = System.currentTimeMillis()
            <span class="hljs-comment">// ç¼“å­˜æœ‰æ•ˆæœŸ100ms</span>
            <span class="hljs-keyword">if</span> (cachedView != <span class="hljs-literal">null</span> &amp;&amp; currentTime - lastCacheTime &lt; <span class="hljs-number">100</span>) {
                <span class="hljs-keyword">return</span> cachedView
            }
            cachedView = PagerManager.getPager(pagerId)
                .getViewWithNativeRef(nativeRef) <span class="hljs-keyword">as</span>? T
            lastCacheTime = currentTime
            <span class="hljs-keyword">return</span> cachedView
        }
}
</code></pre>
</li>
</ol>
<p>æ€»ç»“æ¥çœ‹ï¼ŒnativeRefä¸ViewRefã€AbstractBaseViewã€Pagerä»¥åŠViewContainerä¹‹é—´å½¢æˆäº†ä¸€å¥—å®Œæ•´ã€é«˜æ•ˆçš„è§†å›¾å¼•ç”¨ç®¡ç†ä½“ç³»ï¼Œä¸ºKuiklyUIæ¡†æ¶æä¾›äº†çµæ´»ã€å®‰å…¨çš„è§†å›¾è®¿é—®æœºåˆ¶ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæ¡†æ¶èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†è§†å›¾ç”Ÿå‘½å‘¨æœŸã€ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå¹¶æä¾›ä¸€è‡´çš„è·¨å¹³å°ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AutoHotkey åŠŸèƒ½é…ç½®ä¸ä½¿ç”¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570904968677851163</link>    <guid>https://juejin.cn/post/7570904968677851163</guid>    <pubDate>2025-11-10T09:12:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570904968677851163" data-draft-id="7570901172526579747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AutoHotkey åŠŸèƒ½é…ç½®ä¸ä½¿ç”¨æŒ‡å—"/> <meta itemprop="keywords" content="Windows"/> <meta itemprop="datePublished" content="2025-11-10T09:12:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NiShiKiFuNa"/> <meta itemprop="url" content="https://juejin.cn/user/3905924343795950"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AutoHotkey åŠŸèƒ½é…ç½®ä¸ä½¿ç”¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3905924343795950/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NiShiKiFuNa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:12:21.000Z" title="Mon Nov 10 2025 09:12:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡æ¡£æ€»ç»“äº†ä½¿ç”¨ AutoHotkey å®ç°å¤šç§åŠŸèƒ½çš„é…ç½®æ–¹æ³•ï¼ŒåŒ…æ‹¬å±è”½å¿«æ·é”®ã€é¼ æ ‡ä¾§é”®éŸ³é‡æ§åˆ¶ã€å¤šè„šæœ¬ç®¡ç†å’Œå¼€æœºè‡ªå¯åŠ¨è®¾ç½®ã€‚</p>
<h2 data-id="heading-0">1. ä½¿ç”¨ AutoHotkey å±è”½ Ctrl+Esc å¿«æ·é”®</h2>
<h3 data-id="heading-1">æ–¹æ³•ä¸€ï¼šåŸºç¡€å±è”½è„šæœ¬</h3>
<pre><code class="hljs language-autohotkey" lang="autohotkey">; ä¸å±•ç¤ºæ‰˜ç›˜å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
#NoTrayIcon
; å±è”½ Ctrl+Esc å¿«æ·é”®
^Esc::return
</code></pre>
<h3 data-id="heading-2">æ–¹æ³•äºŒï¼šé’ˆå¯¹ç‰¹å®šæ¸¸æˆçš„å±è”½</h3>
<pre><code class="hljs language-autohotkey" lang="autohotkey">; ä¸å±•ç¤ºæ‰˜ç›˜å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
#NoTrayIcon
; åªåœ¨ç‰¹å®šæ¸¸æˆçª—å£ä¸­å±è”½ Ctrl+Esc
#IfWinActive ahk_exe æ¸¸æˆè¿›ç¨‹å.exe
^Esc::return
#IfWinActive
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>è„šæœ¬éœ€è¦ä»¥<strong>ç®¡ç†å‘˜èº«ä»½è¿è¡Œ</strong>æ‰èƒ½åœ¨æ¸¸æˆä¸­ç”Ÿæ•ˆ</li>
<li>ä½¿ç”¨Â <code>#IfWinActive</code>Â å¯ä»¥é™åˆ¶çƒ­é”®åªåœ¨ç‰¹å®šç¨‹åºä¸­ç”Ÿæ•ˆ</li>
<li>å¦‚æœéœ€è¦å®Œå…¨é€€å‡ºè„šæœ¬ï¼Œå¯ä»¥æ·»åŠ é€€å‡ºçƒ­é”®ï¼š<code>^!q::ExitApp</code></li>
</ul>
<h2 data-id="heading-3">2. ä½¿ç”¨é¼ æ ‡ä¾§é”®è°ƒèŠ‚éŸ³é‡</h2>
<h3 data-id="heading-4">å¸¦åˆå§‹å»¶è¿Ÿçš„è¿ç»­è°ƒèŠ‚è„šæœ¬</h3>
<pre><code class="hljs language-autohotkey" lang="autohotkey">#NoTrayIcon

; --- å»¶è¿Ÿè®¾ç½® ---
InitialDelay := 300  ; é¦–æ¬¡æŒ‰ä¸‹åçš„å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

; --- é¼ æ ‡ä¾§é”®éŸ³é‡æ§åˆ¶ ---
; ä¾§é”®1ï¼ˆåé€€é”®ï¼‰ï¼šéŸ³é‡å‡å°
XButton1::
    Send {Volume_Down}
    Key1Pressed := true
    SetTimer, RapidVolumeDown, % -InitialDelay
return

XButton1 up::
    Key1Pressed := false
    SetTimer, RapidVolumeDown, Off
return

RapidVolumeDown:
    if Key1Pressed
    {
        Send {Volume_Down}
        SetTimer, RapidVolumeDown, 150
    }
return

; ä¾§é”®2ï¼ˆå‰è¿›é”®ï¼‰ï¼šéŸ³é‡å¢åŠ 
XButton2::
    Send {Volume_Up}
    Key2Pressed := true
    SetTimer, RapidVolumeUp, % -InitialDelay
return

XButton2 up::
    Key2Pressed := false
    SetTimer, RapidVolumeUp, Off
return

RapidVolumeUp:
    if Key2Pressed
    {
        Send {Volume_Up}
        SetTimer, RapidVolumeUp, 150
    }
return

; --- é€€å‡ºçƒ­é”® ---
^+q::ExitApp
</code></pre>
<p><strong>åŠŸèƒ½ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å•æ¬¡ç‚¹å‡»ï¼šç«‹å³è°ƒèŠ‚ä¸€æ¬¡éŸ³é‡</li>
<li>é•¿æŒ‰ï¼šå»¶è¿Ÿåå¼€å§‹è¿ç»­è°ƒèŠ‚ï¼ˆé»˜è®¤å»¶è¿Ÿ300æ¯«ç§’ï¼‰</li>
<li>ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„éŸ³é‡è°ƒèŠ‚æ–¹å¼</li>
</ul>
<p><strong>è‡ªå®šä¹‰å‚æ•°ï¼š</strong></p>
<ul>
<li>è°ƒæ•´Â <code>InitialDelay</code>Â å€¼å¯æ”¹å˜å¼€å§‹è¿ç»­è°ƒèŠ‚çš„å»¶è¿Ÿæ—¶é—´</li>
<li>è°ƒæ•´Â <code>150</code>Â å€¼å¯æ”¹å˜è¿ç»­è°ƒèŠ‚çš„é€Ÿåº¦</li>
</ul>
<h2 data-id="heading-5">3. ä½¿ç”¨ä¸€ä¸ªè„šæœ¬å¯åŠ¨å¤šä¸ªå…¶ä»–è„šæœ¬çš„æ–¹æ³•</h2>
<h3 data-id="heading-6">åˆ›å»ºä¸»å¯åŠ¨è„šæœ¬</h3>
<pre><code class="hljs language-autohotkey" lang="autohotkey">#NoTrayIcon
; ä¸»å¯åŠ¨è„šæœ¬ - åŒæ—¶è¿è¡Œå¤šä¸ªå­è„šæœ¬

; å¯åŠ¨å±è”½ Ctrl+Esc è„šæœ¬
Run, C:\è„šæœ¬è·¯å¾„\å±è”½CtrlEsc.ahk

; å¯åŠ¨é¼ æ ‡ä¾§é”®éŸ³é‡æ§åˆ¶è„šæœ¬
Run, C:\è„šæœ¬è·¯å¾„\é¼ æ ‡ä¾§é”®éŸ³é‡.ahk

; å¯é€‰ï¼šå¯åŠ¨å…¶ä»–è„šæœ¬
; Run, C:\è„šæœ¬è·¯å¾„\å…¶ä»–åŠŸèƒ½.ahk

; å¯é€‰ï¼šä¸»è„šæœ¬åœ¨å¯åŠ¨æ‰€æœ‰å­è„šæœ¬åè‡ªåŠ¨é€€å‡º
; ExitApp
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é›†ä¸­ç®¡ç†å¤šä¸ªè„šæœ¬</li>
<li>åªéœ€åœ¨ä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªè‡ªå¯åŠ¨ä»»åŠ¡</li>
<li>æ–¹ä¾¿æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹è¦å¯åŠ¨çš„è„šæœ¬</li>
</ul>
<p><strong>è·¯å¾„è¯´æ˜ï¼š</strong></p>
<ul>
<li>
<p>ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ˆå¦‚Â <code>C:\è„šæœ¬è·¯å¾„...</code>ï¼‰æœ€å¯é </p>
</li>
<li>
<p>å¦‚æœè„šæœ¬åœ¨åŒä¸€ç›®å½•ï¼Œå¯ä½¿ç”¨Â <code>A_ScriptDir</code>Â å˜é‡ï¼š</p>
<pre><code class="hljs language-autohotkey" lang="autohotkey">Run, %A_ScriptDir%\å±è”½CtrlEsc.ahk
</code></pre>
</li>
</ul>
<h2 data-id="heading-7">4. è®¾ç½®ä»»åŠ¡è®¡åˆ’ç¨‹åºå®ç°å¼€æœºè‡ªå¯ä¸”ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ</h2>
<h3 data-id="heading-8">è¯¦ç»†è®¾ç½®æ­¥éª¤</h3>
<ol>
<li>
<p><strong>æ‰“å¼€ä»»åŠ¡è®¡åˆ’ç¨‹åº</strong></p>
<ul>
<li>æŒ‰Â <code>Win + R</code>ï¼Œè¾“å…¥Â <code>taskschd.msc</code>ï¼Œå›è½¦</li>
</ul>
</li>
<li>
<p><strong>åˆ›å»ºæ–°ä»»åŠ¡</strong></p>
<ul>
<li>ç‚¹å‡»å³ä¾§"åˆ›å»ºä»»åŠ¡"ï¼ˆä¸è¦ä½¿ç”¨"åˆ›å»ºåŸºæœ¬ä»»åŠ¡"ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å¸¸è§„è®¾ç½®</strong></p>
<ul>
<li>
<p><strong>åç§°</strong>ï¼šè¾“å…¥æœ‰æ„ä¹‰çš„ä»»åŠ¡åç§°</p>
</li>
<li>
<p><strong>æè¿°</strong>ï¼šï¼ˆå¯é€‰ï¼‰æ·»åŠ ä»»åŠ¡æè¿°</p>
</li>
<li>
<p><strong>å®‰å…¨é€‰é¡¹</strong>ï¼š</p>
<ul>
<li>é€‰æ‹©"åªåœ¨ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œ"</li>
<li>âœ…Â <strong>å‹¾é€‰"ä½¿ç”¨æœ€é«˜æƒé™è¿è¡Œ"</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>è§¦å‘å™¨è®¾ç½®</strong></p>
<ul>
<li>ç‚¹å‡»"æ–°å»º"ï¼Œé€‰æ‹©"å½“ç”¨æˆ·ç™»å½•æ—¶"</li>
<li>å»ºè®®é€‰æ‹©"ç‰¹å®šç”¨æˆ·"è€Œä¸æ˜¯"ä»»ä½•ç”¨æˆ·"</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œè®¾ç½®</strong></p>
<ul>
<li>
<p>ç‚¹å‡»"æ–°å»º"</p>
</li>
<li>
<p><strong>æ“ä½œ</strong>ï¼šé€‰æ‹©"å¯åŠ¨ç¨‹åº"</p>
</li>
<li>
<p><strong>ç¨‹åºæˆ–è„šæœ¬</strong>ï¼šæµè§ˆé€‰æ‹© AutoHotkey.exe</p>
<ul>
<li>é€šå¸¸è·¯å¾„ï¼š<code>C:\Program Files\AutoHotkey\AutoHotkey.exe</code></li>
</ul>
</li>
<li>
<p><strong>å‚æ•°</strong>ï¼šè¾“å…¥ä½ çš„è„šæœ¬å®Œæ•´è·¯å¾„</p>
<ul>
<li>ä¾‹å¦‚ï¼š<code>"C:\AHK_Scripts\ä¸»å¯åŠ¨è„šæœ¬.ahk"</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>æ¡ä»¶è®¾ç½®ï¼ˆå¯é€‰ï¼‰</strong></p>
<ul>
<li>åœ¨"æ¡ä»¶"é€‰é¡¹å¡ä¸­ï¼Œå–æ¶ˆå‹¾é€‰"åªæœ‰åœ¨è®¡ç®—æœºä½¿ç”¨äº¤æµç”µæºæ—¶æ‰å¯åŠ¨æ­¤ä»»åŠ¡"ï¼ˆç¡®ä¿ç¬”è®°æœ¬ç”¨ç”µæ± æ—¶ä¹Ÿèƒ½è¿è¡Œï¼‰</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">é‡è¦æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>æƒé™è®¾ç½®</strong>ï¼šå¿…é¡»åœ¨"å¸¸è§„"é€‰é¡¹å¡ä¸­å‹¾é€‰"ä½¿ç”¨æœ€é«˜æƒé™è¿è¡Œ"</li>
<li><strong>è§¦å‘å™¨é€‰æ‹©</strong>ï¼šå¿…é¡»é€‰æ‹©"å½“ç”¨æˆ·ç™»å½•æ—¶"è€Œä¸æ˜¯"è®¡ç®—æœºå¯åŠ¨æ—¶"</li>
<li><strong>ç”¨æˆ·é€‰æ‹©</strong>ï¼šå»ºè®®é€‰æ‹©"ç‰¹å®šç”¨æˆ·"è€Œä¸æ˜¯"ä»»ä½•ç”¨æˆ·"ï¼Œä»¥ç¡®ä¿æ‰˜ç›˜å›¾æ ‡æ­£å¸¸æ˜¾ç¤º</li>
<li><strong>è·¯å¾„å¤„ç†</strong>ï¼šè„šæœ¬è·¯å¾„ä¸­åŒ…å«ç©ºæ ¼æ—¶ï¼Œéœ€è¦ç”¨è‹±æ–‡åŒå¼•å·åŒ…å›´</li>
</ul>
<h3 data-id="heading-10">éªŒè¯è®¾ç½®</h3>
<p>è®¾ç½®å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š</p>
<ol>
<li>å³é”®ç‚¹å‡»ä»»åŠ¡ï¼Œé€‰æ‹©"è¿è¡Œ"æµ‹è¯•</li>
<li>æ£€æŸ¥ä»»åŠ¡ç®¡ç†å™¨ä¸­çš„ AutoHotkey è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ</li>
<li>æµ‹è¯•å„é¡¹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</li>
</ol>
<h2 data-id="heading-11">å¸¸è§é—®é¢˜è§£å†³</h2>
<ol>
<li>
<p><strong>æ¸¸æˆä¸­çƒ­é”®ä¸ç”Ÿæ•ˆ</strong></p>
<ul>
<li>ç¡®ä¿è„šæœ¬ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ</li>
<li>æ£€æŸ¥æ¸¸æˆæ˜¯å¦åœ¨å…¨å±æ¨¡å¼ä¸‹è¿è¡Œ</li>
</ul>
</li>
<li>
<p><strong>å¼€æœºä¸è‡ªå¯</strong></p>
<ul>
<li>æ£€æŸ¥ä»»åŠ¡è®¡åˆ’ç¨‹åºä¸­çš„è§¦å‘å™¨è®¾ç½®</li>
<li>ç¡®è®¤è„šæœ¬è·¯å¾„æ­£ç¡®</li>
</ul>
</li>
<li>
<p><strong>æ‰˜ç›˜å›¾æ ‡ä¸æ˜¾ç¤º</strong></p>
<ul>
<li>æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†"ç‰¹å®šç”¨æˆ·"è€Œä¸æ˜¯"ä»»ä½•ç”¨æˆ·"</li>
<li>ç¡®è®¤ä»»åŠ¡å±æ€§ä¸­é€‰æ‹©äº†"åªåœ¨ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œ"</li>
</ul>
</li>
</ol>
<p>é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œä½ å¯ä»¥å®ç°åŠŸèƒ½çš„è‡ªåŠ¨åŒ–è¿è¡Œï¼Œæ— éœ€æ¯æ¬¡æ‰‹åŠ¨å¯åŠ¨è„šæœ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python FastAPI å‚æ•°ä¼ é€’ä¸å“åº”æ ¡éªŒ]]></title>    <link>https://juejin.cn/post/7570896170920706111</link>    <guid>https://juejin.cn/post/7570896170920706111</guid>    <pubDate>2025-11-10T09:32:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570896170920706111" data-draft-id="7570598043298578495" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python FastAPI å‚æ•°ä¼ é€’ä¸å“åº”æ ¡éªŒ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T09:32:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hacker_Future"/> <meta itemprop="url" content="https://juejin.cn/user/1978776659433063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python FastAPI å‚æ•°ä¼ é€’ä¸å“åº”æ ¡éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776659433063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hacker_Future
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:32:20.000Z" title="Mon Nov 10 2025 09:32:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">FastAPI è¿›é˜¶æ•™ç¨‹ï¼šå‚æ•°ä¼ é€’ä¸å“åº”æ ¡éªŒ</h2>
<p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å®ç°äº†åŸºç¡€çš„ HelloWorld APIï¼Œè¿™ä¸€èŠ‚å°†èšç„¦å®é™…å¼€å‘æ ¸å¿ƒéœ€æ±‚ â€”â€” å‚æ•°ä¼ é€’ï¼ˆè·¯å¾„ / æŸ¥è¯¢ / è¯·æ±‚ä½“ï¼‰ä¸å“åº”æ•°æ®æ ¡éªŒï¼Œç»“åˆ Pydantic æ¨¡å‹è®©æ¥å£æ›´è§„èŒƒã€æ›´å¥å£®ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒä¾èµ–ä¸å‰ç½®è¯´æ˜</h3>
<ul>
<li>ä¾èµ–å·¥å…·ï¼šPydanticï¼ˆFastAPI å†…ç½®ï¼Œç”¨äºæ•°æ®æ ¡éªŒå’Œæ¨¡å‹å®šä¹‰ï¼‰ã€‚</li>
</ul>

<ul>
<li>æ ¸å¿ƒç›®æ ‡ï¼šé€šè¿‡ç±»å‹æ³¨è§£å®šä¹‰å‚æ•° / å“åº”æ ¼å¼ï¼ŒFastAPI è‡ªåŠ¨å®Œæˆæ ¡éªŒã€è½¬æ¢å’Œæ–‡æ¡£ç”Ÿæˆã€‚</li>
</ul>

<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šæ¥å£éœ€è¦æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼ˆå¦‚æŸ¥è¯¢æ¡ä»¶ã€è¡¨å•æ•°æ®ï¼‰æˆ–è¿”å›ç»“æ„åŒ–ç»“æœæ—¶ã€‚</li>
</ul>
<h3 data-id="heading-2">äºŒã€å‚æ•°ä¼ é€’çš„ 3 ç§æ ¸å¿ƒæ–¹å¼</h3>
<h4 data-id="heading-3">2.1 è·¯å¾„å‚æ•°ï¼ˆPath Parametersï¼‰</h4>
<p>ç”¨äºæ ‡è¯†èµ„æºçš„å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ç”¨æˆ· IDã€å•†å“ç¼–å·ï¼‰ï¼Œç›´æ¥åµŒå…¥ URL è·¯å¾„ä¸­ã€‚</p>
<h5 data-id="heading-4">åŸºç¡€ç”¨æ³•ï¼ˆæ— æ ¡éªŒï¼‰</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
app = FastAPI()
<span class="hljs-comment"># è·¯å¾„å‚æ•° item_id åµŒå…¥ URLï¼Œç±»å‹æ³¨è§£ä¸º int</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items/{item_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"item_id"</span>: item_id, <span class="hljs-string">"message"</span>: <span class="hljs-string">"è·å–å•†å“æˆåŠŸ"</span>}
</code></pre>
<ul>
<li>è®¿é—®ç¤ºä¾‹ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000%2Fitems%2F10" target="_blank" title="http://127.0.0.1:8000/items/10" ref="nofollow noopener noreferrer">http://127.0.0.1:8000/items/10</a>ï¼Œè¿”å› {"item_id":10,"message":"è·å–å•†å“æˆåŠŸ"}ã€‚</li>
</ul>

<ul>
<li>è‡ªåŠ¨è½¬æ¢ï¼šè‹¥è®¿é—® items/abcï¼ŒFastAPI ä¼šè¿”å› 422 é”™è¯¯ï¼ˆç±»å‹ä¸åŒ¹é…ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ã€‚</li>
</ul>
<h5 data-id="heading-5">è¿›é˜¶ç”¨æ³•ï¼ˆè·¯å¾„å‚æ•°æ ¡éªŒï¼‰</h5>
<p>é€šè¿‡ Path ç±»æ·»åŠ æ ¡éªŒè§„åˆ™ï¼ˆå¦‚æ•°å€¼èŒƒå›´ã€æè¿°ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Path
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
app = FastAPI()
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items/{item_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">
    <span class="hljs-comment"># ge=1ï¼šå¤§äºç­‰äº 1ï¼Œle=100ï¼šå°äºç­‰äº 100ï¼Œdescription ç”¨äºæ¥å£æ–‡æ¡£</span>
    item_id: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">..., ge=<span class="hljs-number">1</span>, le=<span class="hljs-number">100</span>, description=<span class="hljs-string">"å•†å“ IDï¼ŒèŒƒå›´ 1-100"</span></span>),
    q: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># å¯é€‰æŸ¥è¯¢å‚æ•°ï¼Œä¸‹æ–‡è¯¦è§£</span>
</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"item_id"</span>: item_id, <span class="hljs-string">"q"</span>: q}
</code></pre>
<ul>
<li>è®¿é—®ç¤ºä¾‹ï¼š/items/50?q=æ‰‹æœº æ­£å¸¸å“åº”ï¼Œ/items/101 ä¼šè¿”å› 422 æ ¡éªŒé”™è¯¯ã€‚</li>
</ul>
<h4 data-id="heading-6">2.2 æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parametersï¼‰</h4>
<p>ç”¨äºè¿‡æ»¤ã€åˆ†é¡µç­‰éæ ¸å¿ƒå‚æ•°ï¼ˆå¦‚æœç´¢å…³é”®è¯ã€é¡µç ï¼‰ï¼Œä»¥ ?key=value å½¢å¼é™„åŠ åœ¨ URL åã€‚</p>
<h5 data-id="heading-7">åŸºç¡€ç”¨æ³•ï¼ˆå¯é€‰å‚æ•° + é»˜è®¤å€¼ï¼‰</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/users/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">
    page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,  <span class="hljs-comment"># å¿…é€‰æŸ¥è¯¢å‚æ•°ï¼Œé»˜è®¤å€¼ 1ï¼ˆä¸ä¼ é€’æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼‰</span>
    limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>,  <span class="hljs-comment"># æ¯é¡µæ¡æ•°ï¼Œé»˜è®¤ 10</span>
    keyword: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># å¯é€‰æŸ¥è¯¢å‚æ•°ï¼Œé»˜è®¤ None</span>
</span>):
    <span class="hljs-comment"># æ¨¡æ‹Ÿåˆ†é¡µæŸ¥è¯¢é€»è¾‘</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"page"</span>: page,
        <span class="hljs-string">"limit"</span>: limit,
        <span class="hljs-string">"keyword"</span>: keyword,
        <span class="hljs-string">"data"</span>: [{<span class="hljs-string">"user_id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>}, {<span class="hljs-string">"user_id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"æå››"</span>}]
    }
</code></pre>
<ul>
<li>è®¿é—®ç¤ºä¾‹ï¼š/users/?page=2&amp;limit=20&amp;keyword=å¼ ï¼Œè¿”å›å¯¹åº”åˆ†é¡µå’Œç­›é€‰ç»“æœã€‚</li>
</ul>

<ul>
<li>æ ¡éªŒç‰¹æ€§ï¼šè‹¥ä¼ é€’ page=abcï¼Œä¼šè‡ªåŠ¨è¿”å›ç±»å‹é”™è¯¯ã€‚</li>
</ul>
<h5 data-id="heading-8">è¿›é˜¶ç”¨æ³•ï¼ˆæŸ¥è¯¢å‚æ•°æ ¡éªŒï¼‰</h5>
<p>é€šè¿‡ Query ç±»æ·»åŠ æ ¡éªŒè§„åˆ™ï¼ˆå¦‚å­—ç¬¦ä¸²é•¿åº¦ã€æ­£åˆ™åŒ¹é…ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/users/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">
    page: <span class="hljs-built_in">int</span> = Query(<span class="hljs-params"><span class="hljs-number">1</span>, ge=<span class="hljs-number">1</span>, description=<span class="hljs-string">"é¡µç ï¼Œæœ€å° 1"</span></span>),
    limit: <span class="hljs-built_in">int</span> = Query(<span class="hljs-params"><span class="hljs-number">10</span>, ge=<span class="hljs-number">5</span>, le=<span class="hljs-number">50</span>, description=<span class="hljs-string">"æ¯é¡µæ¡æ•°ï¼Œ5-50 æ¡"</span></span>),
    <span class="hljs-comment"># min_length=2ï¼šæœ€å°é•¿åº¦ 2ï¼Œmax_length=10ï¼šæœ€å¤§é•¿åº¦ 10</span>
    keyword: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Query(<span class="hljs-params"><span class="hljs-literal">None</span>, min_length=<span class="hljs-number">2</span>, max_length=<span class="hljs-number">10</span></span>)
</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"page"</span>: page, <span class="hljs-string">"limit"</span>: limit, <span class="hljs-string">"keyword"</span>: keyword, <span class="hljs-string">"data"</span>: []}
</code></pre>
<h4 data-id="heading-9">2.3 è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰</h4>
<p>ç”¨äºä¼ é€’å¤æ‚æ•°æ®ï¼ˆå¦‚åˆ›å»ºç”¨æˆ·ã€æäº¤è¡¨å•ï¼‰ï¼Œä»¥ JSON æ ¼å¼å‘é€ï¼ˆFastAPI è‡ªåŠ¨è§£æï¼‰ã€‚</p>
<p>éœ€é€šè¿‡ Pydantic æ¨¡å‹å®šä¹‰è¯·æ±‚ä½“ç»“æ„ã€‚</p>
<h5 data-id="heading-10">æ­¥éª¤ 1ï¼šå®šä¹‰ Pydantic æ¨¡å‹</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
app = FastAPI()
<span class="hljs-comment"># å®šä¹‰è¯·æ±‚ä½“æ¨¡å‹ï¼Œç»§æ‰¿ BaseModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    name: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># å¿…é€‰å­—æ®µï¼Œå­—ç¬¦ä¸²ç±»å‹</span>
    age: <span class="hljs-built_in">int</span> = Field(..., ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">120</span>, description=<span class="hljs-string">"å¹´é¾„ï¼Œ0-120 å²"</span>)  <span class="hljs-comment"># å¸¦æ ¡éªŒçš„å¿…é€‰å­—æ®µ</span>
    email: <span class="hljs-built_in">str</span> = Field(..., pattern=<span class="hljs-string">r"^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+.[a-zA-Z0-9_-]+$"</span>)  <span class="hljs-comment"># é‚®ç®±æ­£åˆ™æ ¡éªŒ</span>
    address: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># å¯é€‰å­—æ®µï¼Œé»˜è®¤ None</span>
<span class="hljs-comment"># å®šä¹‰å“åº”ä½“æ¨¡å‹ï¼ˆå¯é€‰ï¼Œç”¨äºè§„èŒƒè¿”å›æ ¼å¼ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserResponse</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    name: <span class="hljs-built_in">str</span>
    age: <span class="hljs-built_in">int</span>
    email: <span class="hljs-built_in">str</span>
    address: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        orm_mode = <span class="hljs-literal">True</span>  <span class="hljs-comment"># æ”¯æŒä» ORM å¯¹è±¡ï¼ˆå¦‚ SQLAlchemy æ¨¡å‹ï¼‰è½¬æ¢ä¸º JSON</span>
</code></pre>
<h5 data-id="heading-11">æ­¥éª¤ 2ï¼šä½¿ç”¨æ¨¡å‹æ¥æ”¶è¯·æ±‚ä½“</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/users/"</span>, response_model=UserResponse</span>)  </span><span class="hljs-comment"># æŒ‡å®šå“åº”æ¨¡å‹ï¼Œè‡ªåŠ¨æ ¡éªŒè¿”å›æ•°æ®</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserCreate</span>):  <span class="hljs-comment"># user å‚æ•°è‡ªåŠ¨è§£æ JSON è¯·æ±‚ä½“</span>
    <span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®åº“æ’å…¥ï¼Œç”Ÿæˆç”¨æˆ· ID</span>
    user_id = <span class="hljs-number">1001</span>
    <span class="hljs-comment"># è¿”å›æ•°æ®ä¼šè¢« UserResponse æ ¡éªŒï¼Œç¡®ä¿æ ¼å¼ä¸€è‡´</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"id"</span>: user_id,
        <span class="hljs-string">"name"</span>: user.name,
        <span class="hljs-string">"age"</span>: user.age,
        <span class="hljs-string">"email"</span>: user.email,
        <span class="hljs-string">"address"</span>: user.address
    }
</code></pre>
<h5 data-id="heading-12">æµ‹è¯•è¯·æ±‚ä½“</h5>
<ul>
<li>å‘é€ POST è¯·æ±‚åˆ°Â <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000%2Fusers%2F" target="_blank" title="http://127.0.0.1:8000/users/" ref="nofollow noopener noreferrer">http://127.0.0.1:8000/users/</a>ï¼Œè¯·æ±‚ä½“ JSONï¼š</li>
</ul>
<pre><code class="hljs language-perl" lang="perl">{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç‹äº”"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"wangwu@example.com"</span>,
    <span class="hljs-string">"address"</span>: <span class="hljs-string">"åŒ—äº¬å¸‚æµ·æ·€åŒº"</span>
}
</code></pre>
<ul>
<li>å“åº”ç»“æœï¼šè‡ªåŠ¨æ ¡éªŒè¯·æ±‚ä½“ï¼ˆå¦‚ email æ ¼å¼é”™è¯¯ä¼šè¿”å› 422ï¼‰ï¼Œè¿”å›æ•°æ®ä¸¥æ ¼éµå¾ª UserResponse ç»“æ„ã€‚</li>
</ul>
<h3 data-id="heading-13">ä¸‰ã€å“åº”æ ¡éªŒçš„æ ¸å¿ƒä½œç”¨</h3>
<ol>
<li>ç¡®ä¿è¿”å›æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œé¿å…å‰ç«¯å¯¹æ¥æ··ä¹±ã€‚</li>
</ol>

<ol start="2">
<li>è‡ªåŠ¨è¿‡æ»¤å¤šä½™å­—æ®µï¼ˆå¦‚è¯·æ±‚ä½“ä¸­çš„é¢å¤–å‚æ•°ä¸ä¼šè¢«è¿”å›ï¼‰ã€‚</li>
</ol>

<ol start="3">
<li>æ–‡æ¡£è‡ªåŠ¨åŒæ­¥ï¼š/docs é¡µé¢ä¼šæ˜¾ç¤ºè¯·æ±‚ä½“å’Œå“åº”ä½“çš„ç»“æ„åŒ–ç¤ºä¾‹ã€‚</li>
</ol>
<h3 data-id="heading-14">å››ã€å®æˆ˜ï¼šç»„åˆå‚æ•°ç¤ºä¾‹ï¼ˆè·¯å¾„ + æŸ¥è¯¢ + è¯·æ±‚ä½“ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">"/items/{item_id}"</span>, response_model=UserResponse</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params">
    item_id: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">..., ge=<span class="hljs-number">1</span>, description=<span class="hljs-string">"å•†å“ ID"</span></span>),
    is_active: <span class="hljs-built_in">bool</span> = Query(<span class="hljs-params"><span class="hljs-literal">True</span>, description=<span class="hljs-string">"æ˜¯å¦å¯ç”¨å•†å“"</span></span>),
    user: UserCreate  <span class="hljs-comment"># è¯·æ±‚ä½“</span>
</span>):
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"id"</span>: item_id,
        <span class="hljs-string">"name"</span>: user.name,
        <span class="hljs-string">"age"</span>: user.age,
        <span class="hljs-string">"email"</span>: user.email,
        <span class="hljs-string">"address"</span>: user.address
    }
</code></pre>
<ul>
<li>è®¿é—®ç¤ºä¾‹ï¼šPUT è¯·æ±‚Â <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000%2Fitems%2F5%3Fis_active%3Dtrue" target="_blank" title="http://127.0.0.1:8000/items/5?is_active=true" ref="nofollow noopener noreferrer">http://127.0.0.1:8000/items/5?is_active=true</a>ï¼Œæºå¸¦ä¸Šè¿° JSON è¯·æ±‚ä½“ã€‚</li>
</ul>

<ul>
<li>æ ¡éªŒé€»è¾‘ï¼šè·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚ä½“åˆ†åˆ«æŒ‰è§„åˆ™æ ¡éªŒï¼Œä»»æ„ç¯èŠ‚å‡ºé”™è¿”å› 422 é”™è¯¯ã€‚</li>
</ul>
<h3 data-id="heading-15">äº”ã€å¸¸è§é”™è¯¯ä¸æ’æŸ¥</h3>
<ul>
<li>422 é”™è¯¯ï¼šæ•°æ®æ ¡éªŒå¤±è´¥ï¼ˆå¦‚ç±»å‹ä¸åŒ¹é…ã€æ•°å€¼è¶…å‡ºèŒƒå›´ã€æ­£åˆ™ä¸åŒ¹é…ï¼‰ï¼ŒæŸ¥çœ‹å“åº”ä½“çš„ detail å­—æ®µå¯è·å–å…·ä½“åŸå› ã€‚</li>
</ul>

<ul>
<li>è¯·æ±‚ä½“æ— æ³•è§£æï¼šæœªå®šä¹‰ Pydantic æ¨¡å‹ï¼Œæˆ–è¯·æ±‚å¤´ Content-Type ä¸æ˜¯ application/jsonã€‚</li>
</ul>

<ul>
<li>å¯é€‰å­—æ®µå¿…å¡«ï¼šæœªç»™ Optional å­—æ®µè®¾ç½®é»˜è®¤å€¼ï¼ˆå¦‚ keyword: Optional[str] éœ€æ”¹ä¸º keyword: Optional[str] = Noneï¼‰ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»å­—ç¬¦ä¸²æ»¡å¤©é£åˆ°ä¼˜é›…æšä¸¾ï¼šJavaScript å¸¸é‡ç®¡ç†çš„å‡ ç§å§¿åŠ¿]]></title>    <link>https://juejin.cn/post/7570598043298611263</link>    <guid>https://juejin.cn/post/7570598043298611263</guid>    <pubDate>2025-11-10T09:43:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298611263" data-draft-id="7570896170920837183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»å­—ç¬¦ä¸²æ»¡å¤©é£åˆ°ä¼˜é›…æšä¸¾ï¼šJavaScript å¸¸é‡ç®¡ç†çš„å‡ ç§å§¿åŠ¿"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T09:43:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»å­—ç¬¦ä¸²æ»¡å¤©é£åˆ°ä¼˜é›…æšä¸¾ï¼šJavaScript å¸¸é‡ç®¡ç†çš„å‡ ç§å§¿åŠ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:43:34.000Z" title="Mon Nov 10 2025 09:43:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é‡æ„è€é¡¹ç›®çš„æ—¶å€™ï¼Œçœ‹åˆ°ä»£ç é‡Œåˆ°å¤„éƒ½æ˜¯è¿™æ ·çš„åˆ¤æ–­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">if (<span class="hljs-attr">status</span> === <span class="hljs-string">'pending'</span>) { }
if (<span class="hljs-attr">status</span> === <span class="hljs-string">'processing'</span>) { }
if (<span class="hljs-attr">orderStatus</span> === <span class="hljs-string">'pending'</span>) { } Â // ç­‰ç­‰ï¼Œè¿™ä¸ª pending è·Ÿä¸Šé¢é‚£ä¸ªä¸€æ ·å—ï¼Ÿ
</code></pre>
<p>å­—ç¬¦ä¸²æ»¡å¤©é£ï¼Œæ¯æ¬¡éƒ½è¦å°å¿ƒç¿¼ç¿¼åœ°æ‰“å­—ï¼Œç”Ÿæ€•æ‰“é”™ä¸€ä¸ªå­—æ¯ã€‚æƒ³ç”¨æšä¸¾æ¥ç®¡ç†è¿™äº›å¸¸é‡ï¼Œä½† JavaScript åˆæ²¡æœ‰åŸç”Ÿçš„ <code>enum</code> å…³é”®å­—ã€‚</p>
<p>ç½‘ä¸Šæœäº†ä¸€åœˆï¼Œå‘ç°å¤§å®¶çš„åšæ³•äº”èŠ±å…«é—¨ï¼š</p>
<ul>
<li>æœ‰äººç”¨æ™®é€šå¯¹è±¡ï¼š<code>const Status = { PENDING: 'pending' }</code></li>
<li>æœ‰äººç”¨ <code>Object.freeze()</code>ï¼š<code>const Status = Object.freeze({ PENDING: 'pending' })</code></li>
<li>è¿˜æœ‰äººå¹²è„†ç›´æ¥ç”¨å­—ç¬¦ä¸²ï¼Œè¯´"å¤Ÿç”¨å°±è¡Œ"</li>
</ul>
<p>é‚£åˆ°åº•å“ªç§æ–¹å¼å¥½ï¼Ÿæœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„å†™æ³•ï¼Ÿ</p>
<p>æœ€è¿‘çœ‹åˆ° Dr. Axel Rauschmayer çš„ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»äº†ç”¨ Proxy å®ç°æšä¸¾çš„æŠ€å·§ã€‚è™½ç„¶ä»–æ˜ç¡®è¯´è¿™æ˜¯ä¸ªæ•™å­¦ç¤ºä¾‹ï¼Œä¸å»ºè®®ç›´æ¥ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œä½†è¿™ä¸ªæ€è·¯ç¡®å®æŒºå·§å¦™ï¼Œèƒ½å¸®æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ Proxy å’Œè§£æ„èµ‹å€¼çš„å·¥ä½œåŸç†ã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆ JavaScript éœ€è¦æšä¸¾ï¼Ÿ</h2>
<h3 data-id="heading-1">å­—ç¬¦ä¸²å¸¸é‡çš„é—®é¢˜</h3>
<p>ç›´æ¥ç”¨å­—ç¬¦ä¸²å½“å¸¸é‡ï¼Œé—®é¢˜ä¸å°‘ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">updateOrder</span>(status) {
 Â if (status === 'shiped') { Â <span class="hljs-comment">// æ‹¼é”™äº†ï¼åº”è¯¥æ˜¯ shipped</span>
 Â  Â <span class="hljs-comment">// ...</span>
  }
}
â€‹
<span class="hljs-built_in">updateOrder</span>('shipped'); Â <span class="hljs-comment">// è¿è¡Œæ—¶æ‰å‘ç°ä¸åŒ¹é…</span>
</code></pre>
<p>JavaScript æ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œæ‹¼é”™å­—ç¬¦ä¸²ç¼–è¾‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶æ‰å‘ç°é—®é¢˜ã€‚è€Œä¸”æ»¡å±çš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œç»´æŠ¤èµ·æ¥çœŸçš„å¤´ç–¼ã€‚</p>
<h3 data-id="heading-2">é­”æ³•æ•°å­—æ›´ç³Ÿç³•</h3>
<p>æœ‰äº›è€ä»£ç å–œæ¬¢ç”¨æ•°å­—ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">if (userLevel === <span class="hljs-number">3</span>) { Â <span class="hljs-comment">// 3 æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span>
 Â <span class="hljs-comment">// ...</span>
}
â€‹
if (priority === <span class="hljs-number">3</span>) { Â <span class="hljs-comment">// è¿™ä¸ª 3 åˆæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span>
 Â <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>åŠå¹´åå›å¤´çœ‹ä»£ç ï¼Œé¬¼çŸ¥é“è¿™ä¸ª <code>3</code> ä»£è¡¨ä»€ä¹ˆã€‚</p>
<p>é—®é¢˜çš„æ ¹æºåœ¨äºï¼š<strong>JavaScript ç¼ºå°‘ä¸€ç§åŸç”Ÿçš„ã€ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å®šä¹‰å¸¸é‡é›†åˆ</strong>ã€‚</p>
<h2 data-id="heading-3">å¸¸è§çš„æšä¸¾å®ç°æ–¹å¼</h2>
<h3 data-id="heading-4">æ–¹å¼ 1ï¼šæ™®é€šå¯¹è±¡</h3>
<p>æœ€ç®€å•çš„åšæ³•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> OrderStatus = {
 Â PENDING: <span class="hljs-string">'pending'</span>,
 Â PROCESSING: <span class="hljs-string">'processing'</span>,
 Â SHIPPED: <span class="hljs-string">'shipped'</span>,
 Â DELIVERED: <span class="hljs-string">'delivered'</span>
};
â€‹
<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">if</span> (order.status === OrderStatus.SHIPPED) {
 Â <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>è¿™ç§æ–¹å¼çš„é—®é¢˜æ˜¯ï¼Œå¯¹è±¡å±æ€§å¯ä»¥è¢«ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">OrderStatus.PENDING</span> = <span class="hljs-string">'xxx'</span><span class="hljs-comment">; Â // èƒ½æ”¹ï¼Œä½†ä¸åº”è¯¥æ”¹</span>
<span class="hljs-attr">OrderStatus.CANCELLED</span> = <span class="hljs-string">'cancelled'</span><span class="hljs-comment">; Â // èƒ½åŠ æ–°å±æ€§</span>
</code></pre>
<h3 data-id="heading-5">æ–¹å¼ 2ï¼šObject.freeze()</h3>
<p>å†»ç»“å¯¹è±¡ï¼Œé˜²æ­¢ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">OrderStatus</span> = Object.<span class="hljs-title function_ invoke__">freeze</span>({
 <span class="hljs-attr">Â PENDING</span>: <span class="hljs-string">'pending'</span>,
 <span class="hljs-attr">Â PROCESSING</span>: <span class="hljs-string">'processing'</span>,
 <span class="hljs-attr">Â SHIPPED</span>: <span class="hljs-string">'shipped'</span>,
 <span class="hljs-attr">Â DELIVERED</span>: <span class="hljs-string">'delivered'</span>
});
â€‹
OrderStatus.PENDING = <span class="hljs-string">'xxx'</span>; Â <span class="hljs-comment">// ä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™</span>
</code></pre>
<p>è¿™ä¸ªæ–¹å¼å¥½ä¸€äº›ï¼Œä½†æ¯æ¬¡éƒ½è¦å†™ <code>PENDING: 'pending'</code> è¿™ç§é‡å¤çš„é”®å€¼å¯¹ï¼Œæœ‰ç‚¹å•°å—¦ã€‚ç‰¹åˆ«æ˜¯å½“æšä¸¾å€¼å°±æ˜¯å­—æ®µåçš„å°å†™å½¢å¼æ—¶ï¼Œè¿™ç§é‡å¤æ›´æ˜æ˜¾ã€‚</p>
<h3 data-id="heading-6">æ–¹å¼ 3ï¼šTypeScript çš„ enum</h3>
<p>å¦‚æœç”¨ TypeScriptï¼Œæœ‰ä¸¤ç§æšä¸¾æ–¹å¼ï¼š</p>
<p><strong>æ•°å­—æšä¸¾</strong>ï¼ˆé»˜è®¤ï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">MyEnum</span> { 
 Â foo, Â  Â <span class="hljs-comment">// 0</span>
 Â bar, Â  Â <span class="hljs-comment">// 1</span>
 Â baz Â  Â  <span class="hljs-comment">// 2</span>
}
â€‹
console.<span class="hljs-built_in">log</span>(MyEnum.foo); Â <span class="hljs-comment">// 0</span>
console.<span class="hljs-built_in">log</span>(MyEnum.bar); Â <span class="hljs-comment">// 1</span>
</code></pre>
<p>è¿™ç§æ–¹å¼å’Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼ˆCã€Javaï¼‰çš„æšä¸¾ç±»ä¼¼ï¼Œä½†è°ƒè¯•èµ·æ¥ä¸å¤ªç›´è§‚â€”â€”çœ‹åˆ°æ•°å­— <code>0</code> ä½ å¾—æƒ³ä¸€ä¸‹å®ƒä»£è¡¨ä»€ä¹ˆã€‚</p>
<p><strong>å­—ç¬¦ä¸²æšä¸¾</strong>ï¼ˆæ¨èï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">enum OrderStatus {
 Â <span class="hljs-attr">PENDING</span> = <span class="hljs-string">'pending'</span>,
 Â <span class="hljs-attr">PROCESSING</span> = <span class="hljs-string">'processing'</span>,
 Â <span class="hljs-attr">SHIPPED</span> = <span class="hljs-string">'shipped'</span>,
 Â <span class="hljs-attr">DELIVERED</span> = <span class="hljs-string">'delivered'</span>
}
â€‹
console.log(OrderStatus.PENDING)<span class="hljs-comment">; Â // 'pending' - ä¸€çœ¼å°±èƒ½çœ‹æ‡‚</span>
</code></pre>
<p>å­—ç¬¦ä¸²æšä¸¾çš„å¥½å¤„æ˜¯è°ƒè¯•æ—¶èƒ½ç›´æ¥çœ‹åˆ°æœ‰æ„ä¹‰çš„å€¼ï¼Œä¸ç”¨å»æŸ¥æ•°å­—å¯¹åº”ä»€ä¹ˆã€‚ä½†è¿™éœ€è¦ TypeScript ç¯å¢ƒï¼Œçº¯ JavaScript é¡¹ç›®æ€ä¹ˆåŠï¼Ÿ</p>
<h2 data-id="heading-7">ç”¨ Proxy å®ç°çš„å·§å¦™æ–¹æ¡ˆ</h2>
<p>è¿™é‡Œæœ‰ä¸ªæŒºæœ‰æ„æ€çš„æŠ€å·§ï¼Œç”¨ Proxy å¯ä»¥è®©æšä¸¾å®šä¹‰å˜å¾—æ›´ç®€æ´ã€‚ç†è§£è¿™ä¸ªæŠ€å·§éœ€è¦å…ˆäº†è§£ä¸¤ä¸ªå…³é”®ç‚¹ã€‚</p>
<h3 data-id="heading-8">å…³é”®ç‚¹ 1ï¼šProxy æ‹¦æˆªå™¨</h3>
<p>æ ¸å¿ƒæ€è·¯æ˜¯ï¼šåˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œè¯»å–å®ƒçš„ä»»ä½•å±æ€§æ—¶ï¼Œéƒ½è¿”å›å±æ€§åæœ¬èº«ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> keyProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
 Â <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey, _receiver</span>) {
 Â  Â <span class="hljs-keyword">return</span> propKey;
  }
});
â€‹
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keyProxy.<span class="hljs-property">foo</span>); Â  Â <span class="hljs-comment">// 'foo'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keyProxy.<span class="hljs-property">bar</span>); Â  Â <span class="hljs-comment">// 'bar'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keyProxy.<span class="hljs-property">hello</span>); Â <span class="hljs-comment">// 'hello'</span>
</code></pre>
<p>çœ‹åˆ°äº†å—ï¼Ÿä¸ç®¡ä½ è®¿é—®ä»€ä¹ˆå±æ€§ï¼Œéƒ½èƒ½å¾—åˆ°å±æ€§åçš„å­—ç¬¦ä¸²ã€‚</p>
<h3 data-id="heading-9">å…³é”®ç‚¹ 2ï¼šè§£æ„èµ‹å€¼çš„å±æ€§ç®€å†™</h3>
<p>æ¥ä¸‹æ¥ï¼Œé…åˆ ES6 çš„è§£æ„èµ‹å€¼ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> { PENDING, PROCESSING, SHIPPED, DELIVERED } = keyProxy;
â€‹
console.<span class="hljs-built_in">log</span>(PENDING); Â  Â  <span class="hljs-comment">// 'PENDING'</span>
console.<span class="hljs-built_in">log</span>(PROCESSING); Â <span class="hljs-comment">// 'PROCESSING'</span>
console.<span class="hljs-built_in">log</span>(SHIPPED); Â  Â  <span class="hljs-comment">// 'SHIPPED'</span>
</code></pre>
<p>è¿™é‡Œåˆ©ç”¨äº†è§£æ„èµ‹å€¼çš„<strong>å±æ€§ç®€å†™</strong>ï¼ˆproperty value shorthandï¼‰ç‰¹æ€§ã€‚</p>
<p>å†™ <code>{ foo }</code> å…¶å®æ˜¯ <code>{ foo: foo }</code> çš„ç®€å†™ã€‚è¿™ä¸¤ç§å†™æ³•æ˜¯<strong>å®Œå…¨ç­‰ä»·çš„</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ç®€å†™å½¢å¼</span>
<span class="hljs-type">const</span> { foo, bar, baz } = keyProxy;
â€‹
<span class="hljs-comment">// å®Œæ•´å½¢å¼ï¼ˆç­‰ä»·ï¼‰</span>
<span class="hljs-type">const</span> { foo: foo, bar: bar, baz: baz } = keyProxy;
</code></pre>
<p>æ„æ€æ˜¯ï¼š</p>
<ul>
<li>ä» <code>keyProxy</code> å¯¹è±¡ä¸­è¯»å– <code>foo</code> å±æ€§</li>
<li>æŠŠè¯»åˆ°çš„å€¼èµ‹ç»™å˜é‡ <code>foo</code></li>
</ul>
<p>æ‰€ä»¥ä¸Šé¢çš„ä»£ç å®é™…æ‰§è¡Œçš„æ˜¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">PENDING</span> = keyProxy.PENDING<span class="hljs-comment">; Â  Â  Â // 'PENDING'</span>
const <span class="hljs-attr">PROCESSING</span> = keyProxy.PROCESSING<span class="hljs-comment">; // 'PROCESSING'</span>
const <span class="hljs-attr">SHIPPED</span> = keyProxy.SHIPPED<span class="hljs-comment">; Â  Â  Â // 'SHIPPED'</span>
</code></pre>
<p><strong>ä¸¤ä¸ªè¦ç´ ç»“åˆ</strong>å°±äº§ç”Ÿäº†è¿™ä¸ªæ•ˆæœï¼š</p>
<ol>
<li>Proxy è®©å±æ€§è®¿é—®è¿”å›å±æ€§å</li>
<li>è§£æ„èµ‹å€¼è®©æˆ‘ä»¬åŒæ—¶å®šä¹‰å¤šä¸ªå¸¸é‡</li>
</ol>
<p>ä¸€è¡Œä»£ç æå®šæ‰€æœ‰æšä¸¾å€¼çš„å®šä¹‰ã€‚</p>
<h3 data-id="heading-10">å®é™…ä½¿ç”¨</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å®šä¹‰æšä¸¾</span>
const { PENDING, PROCESSING, SHIPPED, DELIVERED } = keyProxy;
â€‹
<span class="hljs-comment">// ä½¿ç”¨</span>
function <span class="hljs-built_in">updateOrder</span>(status) {
 Â if (status === SHIPPED) {
 Â  Â console<span class="hljs-selector-class">.log</span>('è®¢å•å·²å‘è´§');
  }
}
â€‹
<span class="hljs-built_in">updateOrder</span>(SHIPPED);
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯ç®€æ´å¤šäº†ï¼Ÿä¸ç”¨é‡å¤å†™é”®å€¼å¯¹ï¼Œä¹Ÿä¸ç”¨æ¯æ¬¡éƒ½å†™ <code>Status.PENDING</code> è¿™æ ·çš„å‰ç¼€ã€‚</p>
<h2 data-id="heading-11">è¿›é˜¶ï¼šç”¨ Symbol æé«˜ç±»å‹å®‰å…¨</h2>
<p>å¦‚æœæƒ³è¦æ›´å¼ºçš„ç±»å‹å®‰å…¨æ€§ï¼Œå¯ä»¥æŠŠå­—ç¬¦ä¸²æ¢æˆ Symbolã€‚</p>
<p>åˆ‡æ¢åˆ° Symbol ç‰ˆæœ¬åªéœ€è¦æ”¹åŠ¨ä¸€è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> symbolProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
 Â <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey, _receiver</span>) {
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-title class_">Symbol</span>(propKey); Â <span class="hljs-comment">// åªæ”¹è¿™ä¸€è¡Œ</span>
  }
});
â€‹
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">PENDING</span>, <span class="hljs-variable constant_">PROCESSING</span>, <span class="hljs-variable constant_">SHIPPED</span> } = symbolProxy;
â€‹
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-variable constant_">PENDING</span>); Â <span class="hljs-comment">// 'symbol'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">String</span>(<span class="hljs-variable constant_">PENDING</span>)); <span class="hljs-comment">// 'Symbol(PENDING)'</span>
</code></pre>
<p>å…¶ä»–ä»£ç å®Œå…¨ä¸ç”¨åŠ¨ï¼Œåªæ˜¯æŠŠè¿”å›å€¼ä»å­—ç¬¦ä¸²æ”¹æˆ Symbolã€‚</p>
<h3 data-id="heading-12">Symbol çš„å¥½å¤„</h3>
<p><strong>é˜²æ­¢è¯¯ç”¨å­—ç¬¦ä¸²</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ç”¨å­—ç¬¦ä¸²çš„æƒ…å†µ</span>
const { PENDING } = keyProxy;
<span class="hljs-built_in">updateOrder</span>('PENDING'); Â <span class="hljs-comment">// èƒ½å·¥ä½œï¼Œä½†å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„</span>
<span class="hljs-built_in">updateOrder</span>(PENDING); Â  Â <span class="hljs-comment">// ä¹Ÿèƒ½å·¥ä½œ</span>
â€‹
<span class="hljs-comment">// ç”¨ Symbol çš„æƒ…å†µ</span>
const { PENDING } = symbolProxy;
<span class="hljs-built_in">updateOrder</span>('PENDING'); Â <span class="hljs-comment">// ä¸ä¼šåŒ¹é…ï¼Œå› ä¸ºç±»å‹ä¸å¯¹</span>
<span class="hljs-built_in">updateOrder</span>(PENDING); Â  Â <span class="hljs-comment">// åªæœ‰è¿™ä¸ªæ‰èƒ½åŒ¹é…</span>
</code></pre>
<p>Symbol æ˜¯å”¯ä¸€çš„ï¼Œå³ä½¿æè¿°ç›¸åŒï¼Œä¸¤ä¸ª Symbol ä¹Ÿä¸ç›¸ç­‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'foo'</span>) === <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'foo'</span>) Â <span class="hljs-comment">// false</span>
</code></pre>
<p>æ‰€ä»¥ç”¨ Symbol åšæšä¸¾å€¼ï¼ŒåŸºæœ¬ä¸å¯èƒ½å‡ºç°è¯¯åŒ¹é…çš„æƒ…å†µã€‚</p>
<p><strong>æ›´å¥½çš„è°ƒè¯•ä½“éªŒ</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">console.<span class="hljs-built_in">log</span>(PENDING); Â <span class="hljs-comment">// Symbol(PENDING) - ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ˜¯ä»€ä¹ˆ</span>
</code></pre>
<h2 data-id="heading-13">è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹</h2>
<h3 data-id="heading-14">ä¼˜åŠ¿</h3>
<p><strong>ç®€æ´</strong>ï¼š</p>
<ul>
<li>ä¸ç”¨é‡å¤å†™é”®å€¼å¯¹</li>
<li>ä¸€è¡Œä»£ç æå®šæ‰€æœ‰å¸¸é‡å®šä¹‰</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼</span>
<span class="hljs-type">const</span> Status = {
 Â PENDING: <span class="hljs-string">'PENDING'</span>,
 Â PROCESSING: <span class="hljs-string">'PROCESSING'</span>,
 Â SHIPPED: <span class="hljs-string">'SHIPPED'</span>,
 Â DELIVERED: <span class="hljs-string">'DELIVERED'</span>
};
â€‹
<span class="hljs-comment">// Proxy æ–¹å¼</span>
<span class="hljs-type">const</span> { PENDING, PROCESSING, SHIPPED, DELIVERED } = keyProxy;
</code></pre>
<p><strong>çµæ´»</strong>ï¼š</p>
<ul>
<li>æƒ³è¦å­—ç¬¦ä¸²å°±ç”¨å­—ç¬¦ä¸²ç‰ˆæœ¬çš„ Proxy</li>
<li>æƒ³è¦ Symbol å°±ç”¨ Symbol ç‰ˆæœ¬çš„ Proxy</li>
<li>éšç”¨éšå–ï¼Œä¸éœ€è¦é¢„å…ˆå®šä¹‰æ‰€æœ‰å¸¸é‡</li>
</ul>
<h3 data-id="heading-15">ç¼ºç‚¹</h3>
<p><strong>ç†è§£æˆæœ¬</strong>ï¼š</p>
<p>è¿™ä¸ªæŠ€å·§æœ¬è´¨ä¸Šæ˜¯ä¸ªæ•™å­¦ç¤ºä¾‹ï¼Œä¸»è¦ç”¨æ¥å±•ç¤º Proxy å’Œè§£æ„èµ‹å€¼çš„çµæ´»æ€§ã€‚å¯¹äºä¸ç†Ÿæ‚‰è¿™äº›ç‰¹æ€§çš„åŒäº‹æ¥è¯´ï¼Œä»£ç å¯èƒ½ä¸å¤Ÿç›´è§‚ã€‚</p>
<p><strong>æ²¡æœ‰å‘½åç©ºé—´</strong>ï¼š</p>
<p>ä¼ ç»Ÿæ–¹å¼çš„æšä¸¾æœ‰æ˜ç¡®çš„å‘½åç©ºé—´ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">OrderStatus</span> = { PENDING: <span class="hljs-string">'pending'</span> }<span class="hljs-comment">;</span>
const <span class="hljs-attr">UserStatus</span> = { PENDING: <span class="hljs-string">'pending'</span> }<span class="hljs-comment">;</span>
â€‹
// ä¸¤ä¸ª PENDING ä¸ä¼šæ··æ·†
</code></pre>
<p>ä½† Proxy æ–¹å¼å®šä¹‰çš„å¸¸é‡æ˜¯ç‹¬ç«‹çš„å˜é‡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> { PENDING: OrderPending } = keyProxy;
<span class="hljs-type">const</span> { PENDING: UserPending } = keyProxy;
â€‹
<span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨åŒºåˆ†å˜é‡å</span>
</code></pre>
<p><strong>IDE æ”¯æŒæœ‰é™</strong>ï¼š</p>
<p>ä¼ ç»Ÿå¯¹è±¡æ–¹å¼ï¼ŒIDE èƒ½æç¤ºä½ æœ‰å“ªäº›å¯ç”¨çš„æšä¸¾å€¼ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">OrderStatus. Â <span class="hljs-comment">// IDE ä¼šåˆ—å‡º PENDING, PROCESSING ç­‰</span>
</code></pre>
<p>ä½† Proxy æ–¹å¼å®šä¹‰çš„æ˜¯æ™®é€šå˜é‡ï¼ŒIDE ä¸çŸ¥é“ä½ å®šä¹‰äº†å“ªäº›å¸¸é‡ã€‚</p>
<h2 data-id="heading-16">å®é™…ä½¿ç”¨å»ºè®®</h2>
<p>è¿™ä¸ª Proxy æŠ€å·§çš„ä»·å€¼ä¸»è¦åœ¨äº<strong>å­¦ä¹ å’Œç†è§£</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚å°±åƒç®—æ³•é¢˜ä¸€æ ·ï¼Œé‡ç‚¹æ˜¯ç†è§£æ€è·¯ï¼Œè€Œä¸æ˜¯æŠŠå·§å¦™çš„è§£æ³•ç”¨åœ¨å·¥ä½œä»£ç é‡Œã€‚</p>
<h3 data-id="heading-17">é€‚åˆçš„åœºæ™¯</h3>
<p><strong>ä¸´æ—¶å¸¸é‡å’Œå¿«é€ŸåŸå‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å†™æµ‹è¯•ä»£ç æ—¶å¿«é€Ÿå®šä¹‰ä¸€äº›å¸¸é‡</span>
const { SUCCESS, FAILURE, PENDING } = keyProxy;
â€‹
<span class="hljs-built_in">test</span>('should handle all states', () =&gt; {
 Â <span class="hljs-built_in">expect</span>(handler(SUCCESS))<span class="hljs-selector-class">.toBe</span>(true);
 Â <span class="hljs-built_in">expect</span>(handler(FAILURE))<span class="hljs-selector-class">.toBe</span>(false);
 Â <span class="hljs-built_in">expect</span>(handler(PENDING))<span class="hljs-selector-class">.toBe</span>(null);
});
</code></pre>
<p>åœ¨å¿«é€Ÿå¼€å‘é˜¶æ®µï¼Œä¸æƒ³èŠ±æ—¶é—´å†™ç¹ççš„æšä¸¾å®šä¹‰ï¼Œè¿™ä¸ªæ–¹å¼å¾ˆæ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-18">ç”Ÿäº§ç¯å¢ƒçš„å»ºè®®</h3>
<p>å¯¹äºä¸šåŠ¡æ ¸å¿ƒçš„æšä¸¾ï¼ˆè®¢å•çŠ¶æ€ã€ç”¨æˆ·è§’è‰²ç­‰ï¼‰ï¼Œå»ºè®®è¿˜æ˜¯ç”¨ä¼ ç»Ÿæ–¹å¼ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// æ¸…æ™°ã€æœ‰å‘½åç©ºé—´ã€IDE å‹å¥½</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">OrderStatus</span> = Object.<span class="hljs-title function_ invoke__">freeze</span>({
 <span class="hljs-attr">Â PENDING</span>: <span class="hljs-string">'pending'</span>,
 <span class="hljs-attr">Â PROCESSING</span>: <span class="hljs-string">'processing'</span>,
 <span class="hljs-attr">Â SHIPPED</span>: <span class="hljs-string">'shipped'</span>,
 <span class="hljs-attr">Â DELIVERED</span>: <span class="hljs-string">'delivered'</span>
});
</code></pre>
<p>æˆ–è€…å¦‚æœé¡¹ç›®ä½¿ç”¨ TypeScriptï¼Œç›´æ¥ç”¨ <code>enum</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">enum OrderStatus {
 Â <span class="hljs-attr">PENDING</span> = <span class="hljs-string">'pending'</span>,
 Â <span class="hljs-attr">PROCESSING</span> = <span class="hljs-string">'processing'</span>,
 Â <span class="hljs-attr">SHIPPED</span> = <span class="hljs-string">'shipped'</span>,
 Â <span class="hljs-attr">DELIVERED</span> = <span class="hljs-string">'delivered'</span>
}
</code></pre>
<h3 data-id="heading-19">å¦‚æœçœŸè¦ç”¨ï¼Œå¯ä»¥å°è£…</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/enum.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> stringEnum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
 Â <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey</span>) {
 Â  Â <span class="hljs-keyword">return</span> propKey;
  }
});
â€‹
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> symbolEnum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, {
 Â <span class="hljs-title function_">get</span>(<span class="hljs-params">_target, propKey</span>) {
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-title class_">Symbol</span>(propKey);
  }
});
â€‹
<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { stringEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/enum'</span>;
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">PENDING</span>, <span class="hljs-variable constant_">PROCESSING</span> } = stringEnum;
</code></pre>
<p>è¿™æ ·è‡³å°‘è®©ä»£ç æ„å›¾æ›´æ˜ç¡®ä¸€äº›ã€‚</p>
<h2 data-id="heading-20">å†™åœ¨æœ€å</h2>
<p>è¿™ä¸ª Proxy æŠ€å·§ç¡®å®æŒºå·§å¦™çš„ï¼Œç†è§£å®ƒçš„åŸç†ä¹ŸæŒºæœ‰æ„æ€ã€‚ç”¨æ¥å­¦ä¹ å’Œç†è§£ JavaScript çš„é«˜çº§ç‰¹æ€§å¾ˆæœ‰ä»·å€¼ã€‚</p>
<p>å°±åƒå¥èº«æˆ¿é‡Œç»ƒå•æ‰‹ä¿¯å§æ’‘ï¼Œä¸æ˜¯ä¸ºäº†ä»¥åå¹²æ´»åªç”¨ä¸€åªæ‰‹ï¼Œè€Œæ˜¯ä¸ºäº†æå‡æ•´ä½“åŠ›é‡ã€‚è¿™ä¸ªæŠ€å·§ä¹Ÿä¸€æ ·ï¼š</p>
<ul>
<li>åŠ æ·±å¯¹ Proxy çš„ç†è§£</li>
<li>å­¦ä¼šè§£æ„èµ‹å€¼çš„æ›´å¤šç©æ³•</li>
<li>çŸ¥é“"ç®€å•ç‰¹æ€§ç»„åˆ"èƒ½äº§ç”Ÿçš„æ•ˆæœ</li>
</ul>
<p>å®é™…å†™æšä¸¾çš„æ—¶å€™ï¼Œè€è€å®å®ç”¨ <code>Object.freeze()</code> æˆ–è€… TypeScript çš„ <code>enum</code> æ¯”è¾ƒå¥½ã€‚ä½†å¦‚æœå“ªå¤©é¢è¯•è¢«é—®åˆ°"ä½ èƒ½ç”¨ Proxy åšç‚¹ä»€ä¹ˆæœ‰è¶£çš„äº‹"ï¼Œè¿™ä¸ªä¾‹å­æ­£å¥½èƒ½æ´¾ä¸Šç”¨åœºã€‚</p>
<p>ä»£ç ä¸æ˜¯è¶Šå·§å¦™è¶Šå¥½ï¼Œå¤Ÿæ¸…æ¥šã€å¥½ç»´æŠ¤æ‰æ˜¯ç‹é“ã€‚</p>
<hr/>
<h2 data-id="heading-21">ç›¸å…³æ–‡æ¡£</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2F2ality.com%2F2018%2F08%2Fenums-via-proxies.html" target="_blank" title="https://2ality.com/2018/08/enums-via-proxies.html" ref="nofollow noopener noreferrer">Enums via proxies (åŸæ–‡)</a></strong> - Dr. Axel Rauschmayer çš„åŸæ–‡</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" ref="nofollow noopener noreferrer">Proxy - MDN</a></strong> - Proxy çš„è¯¦ç»†ç”¨æ³•</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FSymbol" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol" ref="nofollow noopener noreferrer">Symbol - MDN</a></strong> - Symbol ç±»å‹è¯´æ˜</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FDestructuring_assignment" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" ref="nofollow noopener noreferrer">è§£æ„èµ‹å€¼ - MDN</a></strong> - è§£æ„èµ‹å€¼çš„è¯¦ç»†è¯´æ˜</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FObject%2Ffreeze" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" ref="nofollow noopener noreferrer">Object.freeze() - MDN</a></strong> - å†»ç»“å¯¹è±¡çš„æ–¹æ³•</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fdocs%2Fhandbook%2Fenums.html" target="_blank" title="https://www.typescriptlang.org/docs/handbook/enums.html" ref="nofollow noopener noreferrer">TypeScript Enums</a></strong> - TypeScript çš„æšä¸¾å®ç°</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python FastAPI æ•°æ®åº“é›†æˆï¼ˆSQLAlchemyï¼‰+ æ¥å£æƒé™æ ¡éªŒ]]></title>    <link>https://juejin.cn/post/7570885801477849129</link>    <guid>https://juejin.cn/post/7570885801477849129</guid>    <pubDate>2025-11-10T09:41:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570885801477849129" data-draft-id="7570500819889963051" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python FastAPI æ•°æ®åº“é›†æˆï¼ˆSQLAlchemyï¼‰+ æ¥å£æƒé™æ ¡éªŒ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T09:41:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hacker_Future"/> <meta itemprop="url" content="https://juejin.cn/user/1978776659433063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python FastAPI æ•°æ®åº“é›†æˆï¼ˆSQLAlchemyï¼‰+ æ¥å£æƒé™æ ¡éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776659433063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hacker_Future
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:41:36.000Z" title="Mon Nov 10 2025 09:41:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python FastAPI æ•™ç¨‹ï¼šæ•°æ®åº“é›†æˆï¼ˆSQLAlchemyï¼‰+ æ¥å£æƒé™æ ¡éªŒ</h2>
<p>å‰é¢æˆ‘ä»¬æŒæ¡äº†å‚æ•°ä¼ é€’ä¸å“åº”æ ¡éªŒï¼Œè¿™ä¸€èŠ‚å°†èšç„¦ç”Ÿäº§çº§ API æ ¸å¿ƒéœ€æ±‚ â€”â€” æ•°æ®åº“æŒä¹…åŒ–ï¼ˆåŸºäº SQLAlchemy ORMï¼‰å’Œæ¥å£æƒé™æ§åˆ¶ï¼ˆåŸºäº OAuth2 + JWTï¼‰ï¼Œè®© API å…·å¤‡æ•°æ®å­˜å‚¨ã€èº«ä»½è®¤è¯å’Œæƒé™éš”ç¦»èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å‰ç½®ä¾èµ–å®‰è£…</h3>
<p>éœ€é¢å¤–å®‰è£…æ•°æ®åº“ç›¸å…³å’Œæƒé™ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-css" lang="css">pip install sqlalchemy pymysql python-jose<span class="hljs-selector-attr">[cryptography]</span> passlib<span class="hljs-selector-attr">[bcrypt]</span> python-multipart
</code></pre>
<ul>
<li>ä¾èµ–è¯´æ˜ï¼š</li>
</ul>

<ul>
<li>
<ul>
<li>sqlalchemyï¼šPython ä¸»æµ ORM æ¡†æ¶ï¼Œå®ç°æ•°æ®åº“æ“ä½œæŠ½è±¡ã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>pymysqlï¼šMySQL æ•°æ®åº“é©±åŠ¨ï¼ˆè‹¥ç”¨ PostgreSQL å¯æ›¿æ¢ä¸º psycopg2-binaryï¼‰ã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>python-joseï¼šç”Ÿæˆå’ŒéªŒè¯ JWT ä»¤ç‰Œã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>passlibï¼šå¯†ç å“ˆå¸Œå¤„ç†ï¼ˆé¿å…æ˜æ–‡å­˜å‚¨ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">äºŒã€æ•°æ®åº“é›†æˆï¼ˆSQLAlchemyï¼‰</h3>
<p>ä»¥ MySQL ä¸ºä¾‹ï¼Œå®ç°æ•°æ®åº“è¿æ¥ã€æ¨¡å‹å®šä¹‰ã€CRUD æ“ä½œå°è£…ã€‚</p>
<h4 data-id="heading-3">2.1 é¡¹ç›®ç»“æ„è°ƒæ•´</h4>
<p>ä¸ºä¾¿äºç»´æŠ¤ï¼Œè°ƒæ•´é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">fastwebprojects/
â”œâ”€â”€ main.py          <span class="hljs-comment"># ä¸»ç¨‹åºå…¥å£ï¼ˆè·¯ç”±ã€APP åˆå§‹åŒ–ï¼‰</span>
â”œâ”€â”€ database.py      <span class="hljs-comment"># æ•°æ®åº“è¿æ¥é…ç½®</span>
â”œâ”€â”€ models.py        <span class="hljs-comment"># SQLAlchemy æ•°æ®æ¨¡å‹ï¼ˆå¯¹åº”æ•°æ®åº“è¡¨ï¼‰</span>
â”œâ”€â”€ schemas.py       <span class="hljs-comment"># Pydantic æ¨¡å‹ï¼ˆè¯·æ±‚/å“åº”æ ¡éªŒï¼‰</span>
â””â”€â”€ crud.py          <span class="hljs-comment"># æ•°æ®åº“ CRUD æ“ä½œå°è£…</span>
</code></pre>
<h4 data-id="heading-4">2.2 æ•°æ®åº“è¿æ¥é…ç½®ï¼ˆ<a href="https://link.juejin.cn?target=http%3A%2F%2Fdatabase.py%2F" target="_blank" title="http://database.py/" ref="nofollow noopener noreferrer">database.py</a>ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
<span class="hljs-comment"># MySQL è¿æ¥åœ°å€ï¼šmysql+pymysql://ç”¨æˆ·å:å¯†ç @ä¸»æœº:ç«¯å£/æ•°æ®åº“å</span>
<span class="hljs-attr">SQLALCHEMY_DATABASE_URL</span> = <span class="hljs-string">"mysql+pymysql://root:123456@localhost:3306/fastapi_db"</span>
<span class="hljs-comment"># åˆ›å»ºæ•°æ®åº“å¼•æ“</span>
<span class="hljs-attr">engine</span> = create_engine(
    SQLALCHEMY_DATABASE_URL,
    <span class="hljs-attr">pool_pre_ping</span>=<span class="hljs-literal">True</span>  <span class="hljs-comment"># è¿æ¥å‰æ ¡éªŒï¼Œé¿å…å¤±æ•ˆè¿æ¥</span>
)
<span class="hljs-comment"># åˆ›å»ºä¼šè¯æœ¬åœ°ç±»ï¼ˆæ¯æ¬¡è¯·æ±‚å¯¹åº”ä¸€ä¸ªä¼šè¯ï¼Œç‹¬ç«‹éš”ç¦»ï¼‰</span>
<span class="hljs-attr">SessionLocal</span> = sessionmaker(autocommit=<span class="hljs-literal">False</span>, autoflush=<span class="hljs-literal">False</span>, bind=engine)
<span class="hljs-comment"># åŸºç¡€æ¨¡å‹ç±»ï¼ˆæ‰€æœ‰æ•°æ®æ¨¡å‹ç»§æ‰¿æ­¤ç±»ï¼‰</span>
<span class="hljs-attr">Base</span> = declarative_base()
</code></pre>
<h4 data-id="heading-5">2.3 å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆ<a href="https://link.juejin.cn?target=http%3A%2F%2Fmodels.py%2F" target="_blank" title="http://models.py/" ref="nofollow noopener noreferrer">models.py</a>ï¼‰</h4>
<p>æ•°æ®æ¨¡å‹å¯¹åº”æ•°æ®åº“è¡¨ï¼ŒSQLAlchemy ä¼šè‡ªåŠ¨ç”Ÿæˆè¡¨ç»“æ„ï¼ˆéœ€æ‰‹åŠ¨æ‰§è¡Œè¿ç§»ï¼‰ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">from sqlalchemy import Column, Integer, String, Boolean
from database import Base
<span class="hljs-comment"># ç”¨æˆ·è¡¨æ¨¡å‹</span>
class User(Base):
    <span class="hljs-attr">__tablename__</span> = <span class="hljs-string">"users"</span>  <span class="hljs-comment"># æ•°æ®åº“è¡¨å</span>
    <span class="hljs-attr">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># ä¸»é”® IDï¼Œç´¢å¼•</span>
    <span class="hljs-attr">username</span> = Column(String(<span class="hljs-number">50</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, nullable=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># ç”¨æˆ·åï¼Œå”¯ä¸€</span>
    <span class="hljs-attr">email</span> = Column(String(<span class="hljs-number">100</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, nullable=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># é‚®ç®±ï¼Œå”¯ä¸€</span>
    <span class="hljs-attr">hashed_password</span> = Column(String(<span class="hljs-number">100</span>), nullable=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># å“ˆå¸Œåçš„å¯†ç </span>
    <span class="hljs-attr">is_active</span> = Column(Boolean, default=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># æ˜¯å¦æ¿€æ´»</span>
    <span class="hljs-attr">is_admin</span> = Column(Boolean, default=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼ˆç”¨äºæƒé™æ§åˆ¶ï¼‰</span>
</code></pre>
<h4 data-id="heading-6">2.4 åˆå§‹åŒ–æ•°æ®åº“è¡¨</h4>
<p>åœ¨ <a href="https://link.juejin.cn?target=http%3A%2F%2Fmain.py%2F" target="_blank" title="http://main.py/" ref="nofollow noopener noreferrer">main.py</a> ä¸­æ·»åŠ è¡¨åˆ›å»ºé€»è¾‘ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„è¡¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> engine, SessionLocal
<span class="hljs-keyword">import</span> models
<span class="hljs-comment"># åˆ›å»ºæ‰€æœ‰æ•°æ®æ¨¡å‹å¯¹åº”çš„æ•°æ®åº“è¡¨</span>
models.Base.metadata.create_all(bind=engine)
app = FastAPI()
<span class="hljs-comment"># ä¾èµ–å‡½æ•°ï¼šè·å–æ•°æ®åº“ä¼šè¯ï¼ˆæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹ä¼šè¯ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db</span>():
    db = SessionLocal()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> db  <span class="hljs-comment"># æä¾›ä¼šè¯ç»™è·¯ç”±å‡½æ•°</span>
    <span class="hljs-keyword">finally</span>:
        db.close()  <span class="hljs-comment"># è¯·æ±‚ç»“æŸåå…³é—­ä¼šè¯</span>
</code></pre>
<h4 data-id="heading-7">2.5 å°è£… CRUD æ“ä½œï¼ˆ<a href="https://link.juejin.cn?target=http%3A%2F%2Fcrud.py%2F" target="_blank" title="http://crud.py/" ref="nofollow noopener noreferrer">crud.py</a>ï¼‰</h4>
<p>åˆ†ç¦»æ•°æ®åº“æ“ä½œä¸è·¯ç”±é€»è¾‘ï¼Œé™ä½è€¦åˆï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session
<span class="hljs-keyword">import</span> models
<span class="hljs-keyword">import</span> schemas
<span class="hljs-keyword">from</span> passlib.context <span class="hljs-keyword">import</span> CryptContext
<span class="hljs-comment"># å¯†ç å“ˆå¸Œä¸Šä¸‹æ–‡ï¼ˆä½¿ç”¨ bcrypt ç®—æ³•ï¼‰</span>
pwd_context = CryptContext(schemes=[<span class="hljs-string">"bcrypt"</span>], deprecated=<span class="hljs-string">"auto"</span>)
<span class="hljs-comment"># å¯†ç å“ˆå¸Œå¤„ç†</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_password_hash</span>(<span class="hljs-params">password: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> pwd_context.<span class="hljs-built_in">hash</span>(password)
<span class="hljs-comment"># éªŒè¯å¯†ç </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_password</span>(<span class="hljs-params">plain_password: <span class="hljs-built_in">str</span>, hashed_password: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> pwd_context.verify(plain_password, hashed_password)
<span class="hljs-comment"># åˆ›å»ºç”¨æˆ·</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">db: Session, user: schemas.UserCreate</span>):
    hashed_password = get_password_hash(user.password)
    db_user = models.User(
        username=user.username,
        email=user.email,
        hashed_password=hashed_password
    )
    db.add(db_user)  <span class="hljs-comment"># æ·»åŠ åˆ°ä¼šè¯</span>
    db.commit()      <span class="hljs-comment"># æäº¤äº‹åŠ¡</span>
    db.refresh(db_user)  <span class="hljs-comment"># åˆ·æ–°æ•°æ®ï¼ˆè·å–è‡ªåŠ¨ç”Ÿæˆçš„ ID ç­‰ï¼‰</span>
    <span class="hljs-keyword">return</span> db_user
<span class="hljs-comment"># æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_username</span>(<span class="hljs-params">db: Session, username: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> db.query(models.User).<span class="hljs-built_in">filter</span>(models.User.username == username).first()
</code></pre>
<h4 data-id="heading-8">2.6 å®šä¹‰ Pydantic æ¨¡å‹ï¼ˆ<a href="https://link.juejin.cn?target=http%3A%2F%2Fschemas.py%2F" target="_blank" title="http://schemas.py/" ref="nofollow noopener noreferrer">schemas.py</a>ï¼‰</h4>
<p>åŒºåˆ†è¯·æ±‚ä½“ï¼ˆåˆ›å»ºç”¨æˆ·æ—¶ä¼ å…¥å¯†ç ï¼‰å’Œå“åº”ä½“ï¼ˆè¿”å›æ—¶éšè—å¯†ç ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, EmailStr, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
<span class="hljs-comment"># åˆ›å»ºç”¨æˆ·çš„è¯·æ±‚ä½“æ¨¡å‹ï¼ˆéœ€ä¼ å…¥å¯†ç ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    username: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">3</span>, max_length=<span class="hljs-number">50</span>, description=<span class="hljs-string">"ç”¨æˆ·å"</span>)
    email: EmailStr = Field(..., description=<span class="hljs-string">"é‚®ç®±"</span>)  <span class="hljs-comment"># EmailStr è‡ªåŠ¨æ ¡éªŒé‚®ç®±æ ¼å¼</span>
    password: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">6</span>, description=<span class="hljs-string">"å¯†ç ï¼Œè‡³å°‘ 6 ä½"</span>)
<span class="hljs-comment"># è¿”å›ç”¨æˆ·çš„å“åº”ä½“æ¨¡å‹ï¼ˆéšè—å¯†ç ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserResponse</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    username: <span class="hljs-built_in">str</span>
    email: EmailStr
    is_active: <span class="hljs-built_in">bool</span>
    is_admin: <span class="hljs-built_in">bool</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        orm_mode = <span class="hljs-literal">True</span>  <span class="hljs-comment"># æ”¯æŒä» SQLAlchemy æ¨¡å‹ç›´æ¥è½¬æ¢</span>
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€æ¥å£æƒé™æ ¡éªŒï¼ˆOAuth2 + JWTï¼‰</h3>
<p>å®ç°ã€Œç”¨æˆ·åå¯†ç ç™»å½•è·å–ä»¤ç‰Œã€â†’ã€Œæºå¸¦ä»¤ç‰Œè®¿é—®å—ä¿æŠ¤æ¥å£ã€çš„å®Œæ•´æµç¨‹ã€‚</p>
<h4 data-id="heading-10">3.1 é…ç½® JWT å¯†é’¥ä¸è¿‡æœŸæ—¶é—´</h4>
<p>åœ¨ <a href="https://link.juejin.cn?target=http%3A%2F%2Fmain.py%2F" target="_blank" title="http://main.py/" ref="nofollow noopener noreferrer">main.py</a> ä¸­æ·»åŠ é…ç½®ï¼ˆå®é™…é¡¹ç›®å»ºè®®ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">from</span> jose <span class="hljs-keyword">import</span> JWTError, jwt
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, HTTPException, status
<span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> OAuth2PasswordBearer, OAuth2PasswordRequestForm
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session
<span class="hljs-comment"># JWT é…ç½®</span>
SECRET_KEY = <span class="hljs-string">"your-secret-key-32bytes-long-keep-it-safe"</span>  <span class="hljs-comment"># å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€éšæœºç”Ÿæˆï¼‰</span>
ALGORITHM = <span class="hljs-string">"HS256"</span>  <span class="hljs-comment"># åŠ å¯†ç®—æ³•</span>
ACCESS_TOKEN_EXPIRE_MINUTES = <span class="hljs-number">30</span>  <span class="hljs-comment"># ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆ30 åˆ†é’Ÿï¼‰</span>
<span class="hljs-comment"># OAuth2 ä¾èµ–ï¼šä»è¯·æ±‚å¤´çš„ Authorization å­—æ®µè·å–ä»¤ç‰Œï¼ˆæ ¼å¼ï¼šBearer &lt;token&gt;ï¼‰</span>
oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="hljs-string">"token"</span>)
</code></pre>
<h4 data-id="heading-11">3.2 å®ç°ä»¤ç‰Œç”Ÿæˆä¸éªŒè¯é€»è¾‘</h4>
<p>åœ¨ <a href="https://link.juejin.cn?target=http%3A%2F%2Fmain.py%2F" target="_blank" title="http://main.py/" ref="nofollow noopener noreferrer">main.py</a> ä¸­æ·»åŠ æ ¸å¿ƒå‡½æ•°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ç”Ÿæˆè®¿é—®ä»¤ç‰Œ</span>
def create_access_token(data: dict):
    <span class="hljs-attr">to_encode</span> = data.copy()
    <span class="hljs-comment"># è®¾ç½®è¿‡æœŸæ—¶é—´</span>
    <span class="hljs-attr">expire</span> = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    <span class="hljs-comment"># ç”Ÿæˆ JWT ä»¤ç‰Œ</span>
    <span class="hljs-attr">encoded_jwt</span> = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt
<span class="hljs-comment"># ä¾èµ–å‡½æ•°ï¼šéªŒè¯ä»¤ç‰Œå¹¶è¿”å›å½“å‰ç”¨æˆ·</span>
def get_current_user(
    db: <span class="hljs-attr">Session</span> = Depends(get_db),
    token: <span class="hljs-attr">str</span> = Depends(oauth2_scheme)
):
    <span class="hljs-comment"># ä»¤ç‰ŒéªŒè¯å¤±è´¥å¼‚å¸¸</span>
    <span class="hljs-attr">credentials_exception</span> = HTTPException(
        <span class="hljs-attr">status_code</span>=status.HTTP_401_UNAUTHORIZED,
        <span class="hljs-attr">detail</span>=<span class="hljs-string">"ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ"</span>,
        <span class="hljs-attr">headers</span>={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
    )
    try:
        <span class="hljs-comment"># è§£ç ä»¤ç‰Œ</span>
        <span class="hljs-attr">payload</span> = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        username: <span class="hljs-attr">str</span> = payload.get(<span class="hljs-string">"sub"</span>)  <span class="hljs-comment"># ä»¤ç‰Œä¸­å­˜å‚¨çš„ç”¨æˆ·åï¼ˆsub ä¸ºæ ‡å‡†å­—æ®µï¼‰</span>
        if username is None:
            raise credentials_exception
    except JWTError:
        raise credentials_exception
    <span class="hljs-comment"># æŸ¥è¯¢ç”¨æˆ·</span>
    <span class="hljs-attr">user</span> = crud.get_user_by_username(db, username=username)
    if user is None:
        raise credentials_exception
    return user
<span class="hljs-comment"># ä¾èµ–å‡½æ•°ï¼šéªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼ˆæƒé™ç»†åŒ–ï¼‰</span>
def get_current_admin_user(current_user: <span class="hljs-attr">models.User</span> = Depends(get_current_user)):
    if not current_user.is_admin:
        raise HTTPException(
            <span class="hljs-attr">status_code</span>=status.HTTP_403_FORBIDDEN,
            <span class="hljs-attr">detail</span>=<span class="hljs-string">"æ— æƒé™è®¿é—®ï¼Œä»…ç®¡ç†å‘˜å¯æ“ä½œ"</span>
        )
    return current_user
</code></pre>
<h4 data-id="heading-12">3.3 å®ç°ç™»å½•æ¥å£ï¼ˆè·å–ä»¤ç‰Œï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">@app.post("/token", <span class="hljs-attr">response_model</span>=dict)
async def login_for_access_token(
    db: <span class="hljs-attr">Session</span> = Depends(get_db),
    form_data: <span class="hljs-attr">OAuth2PasswordRequestForm</span> = Depends()  <span class="hljs-comment"># æ¥æ”¶è¡¨å•æ ¼å¼çš„ç”¨æˆ·åå¯†ç </span>
):
    <span class="hljs-comment"># éªŒè¯ç”¨æˆ·åå’Œå¯†ç </span>
    <span class="hljs-attr">user</span> = crud.get_user_by_username(db, username=form_data.username)
    if not user or not crud.verify_password(form_data.password, user.hashed_password):
        raise HTTPException(
            <span class="hljs-attr">status_code</span>=status.HTTP_401_UNAUTHORIZED,
            <span class="hljs-attr">detail</span>=<span class="hljs-string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>,
            <span class="hljs-attr">headers</span>={<span class="hljs-string">"WWW-Authenticate"</span>: <span class="hljs-string">"Bearer"</span>},
        )
    <span class="hljs-comment"># ç”Ÿæˆä»¤ç‰Œï¼ˆsub å­—æ®µå­˜å‚¨ç”¨æˆ·åï¼‰</span>
    <span class="hljs-attr">access_token</span> = create_access_token(data={<span class="hljs-string">"sub"</span>: user.username})
    return {"access_token": access_token, "token_type": "bearer"}
</code></pre>
<h4 data-id="heading-13">3.4 å®ç°å—ä¿æŠ¤æ¥å£</h4>
<ul>
<li>æ™®é€šæ¥å£ï¼šéœ€ç™»å½•ï¼ˆæºå¸¦ä»¤ç‰Œï¼‰å³å¯è®¿é—®ã€‚</li>
</ul>

<ul>
<li>ç®¡ç†å‘˜æ¥å£ï¼šéœ€ç™»å½•ä¸”ä¸ºç®¡ç†å‘˜èº«ä»½æ‰èƒ½è®¿é—®ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ™®é€šå—ä¿æŠ¤æ¥å£ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/users/me/"</span>, response_model=schemas.UserResponse</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_users_me</span>(<span class="hljs-params">current_user: models.User = Depends(<span class="hljs-params">get_current_user</span>)</span>):
    <span class="hljs-keyword">return</span> current_user
<span class="hljs-comment"># ç®¡ç†å‘˜æ¥å£ï¼šåˆ›å»ºç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜å¯æ“ä½œï¼‰</span>
<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/users/"</span>, response_model=schemas.UserResponse</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_new_user</span>(<span class="hljs-params">
    user: schemas.UserCreate,
    db: Session = Depends(<span class="hljs-params">get_db</span>),
    current_user: models.User = Depends(<span class="hljs-params">get_current_admin_user</span>)  <span class="hljs-comment"># ç®¡ç†å‘˜æƒé™ä¾èµ–</span>
</span>):
    <span class="hljs-comment"># æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨</span>
    db_user = crud.get_user_by_username(db, username=user.username)
    <span class="hljs-keyword">if</span> db_user:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">400</span>, detail=<span class="hljs-string">"ç”¨æˆ·åå·²å­˜åœ¨"</span>)
    <span class="hljs-keyword">return</span> crud.create_user(db=db, user=user)
</code></pre>
<h3 data-id="heading-14">å››ã€æµ‹è¯•æµç¨‹ä¸éªŒè¯</h3>
<h4 data-id="heading-15">1. åˆå§‹åŒ–æ•°æ®åº“</h4>
<ol>
<li>ç¡®ä¿ MySQL å·²å¯åŠ¨ï¼Œåˆ›å»º fastapi_db æ•°æ®åº“ï¼ˆCREATE DATABASE fastapi_db;ï¼‰ã€‚</li>
</ol>

<ol start="2">
<li>å¯åŠ¨ FastAPI æœåŠ¡ï¼ˆuvicorn main:app --reloadï¼‰ï¼Œè‡ªåŠ¨åˆ›å»º users è¡¨ã€‚</li>
</ol>
<h4 data-id="heading-16">2. æµ‹è¯•æ¥å£ï¼ˆé€šè¿‡ /docs é¡µé¢ï¼‰</h4>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šè®¿é—®Â <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8000%2Fdocs" target="_blank" title="http://127.0.0.1:8000/docs" ref="nofollow noopener noreferrer">http://127.0.0.1:8000/docs</a>ï¼Œæ‰¾åˆ° /token æ¥å£ï¼Œç‚¹å‡»ã€ŒTry it outã€ã€‚</li>
</ul>

<ul>
<li>ç¬¬äºŒæ­¥ï¼šè¾“å…¥ç”¨æˆ·åï¼ˆå¦‚ adminï¼‰ã€å¯†ç ï¼ˆå¦‚ 123456ï¼‰ï¼Œå…ˆè°ƒç”¨ /users/ æ¥å£ï¼ˆéœ€ç®¡ç†å‘˜èº«ä»½ï¼Œå¯æ‰‹åŠ¨åœ¨æ•°æ®åº“å°† is_admin è®¾ä¸º 1ï¼‰åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ã€‚</li>
</ul>

<ul>
<li>ç¬¬ä¸‰æ­¥ï¼šç”¨ç®¡ç†å‘˜ç”¨æˆ·åå¯†ç è°ƒç”¨ /token æ¥å£ï¼Œè·å– access_tokenã€‚</li>
</ul>

<ul>
<li>ç¬¬å››æ­¥ï¼šè°ƒç”¨ /users/me/ æ¥å£ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æºå¸¦ä»¤ç‰Œï¼Œè¿”å›å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚</li>
</ul>

<ul>
<li>ç¬¬äº”æ­¥ï¼šéç®¡ç†å‘˜ç”¨æˆ·è°ƒç”¨ /users/ æ¥å£ï¼Œä¼šè¿”å› 403 æƒé™é”™è¯¯ã€‚</li>
</ul>
<h3 data-id="heading-17">äº”ã€ç”Ÿäº§çº§ä¼˜åŒ–å»ºè®®</h3>
<ol>
<li>å¯†é’¥ä¸æ•°æ®åº“é…ç½®ï¼šç”¨ python-dotenv è¯»å–ç¯å¢ƒå˜é‡ï¼Œé¿å…ç¡¬ç¼–ç ã€‚</li>
</ol>

<ol start="2">
<li>æ•°æ®åº“è¿ç§»ï¼šä½¿ç”¨ alembic ç®¡ç†è¡¨ç»“æ„å˜æ›´ï¼ˆé¿å…ç›´æ¥åˆ é™¤é‡å»ºè¡¨ï¼‰ã€‚</li>
</ol>

<ol start="3">
<li>ä»¤ç‰Œå®‰å…¨ï¼šå»¶é•¿è¿‡æœŸæ—¶é—´æ—¶ï¼Œå¯ç»“åˆåˆ·æ–°ä»¤ç‰Œæœºåˆ¶ã€‚</li>
</ol>

<ol start="4">
<li>æ—¥å¿—ä¸ç›‘æ§ï¼šæ·»åŠ æ¥å£è®¿é—®æ—¥å¿—ï¼Œç›‘æ§ä»¤ç‰Œè¿‡æœŸã€æ•°æ®åº“å¼‚å¸¸ç­‰æƒ…å†µã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ Mybatis çš„ç¼“å­˜æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7570901172526891043</link>    <guid>https://juejin.cn/post/7570901172526891043</guid>    <pubDate>2025-11-10T09:43:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526891043" data-draft-id="7570902473432875008" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ Mybatis çš„ç¼“å­˜æœºåˆ¶"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-11-10T09:43:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å‡"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ Mybatis çš„ç¼“å­˜æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:43:16.000Z" title="Mon Nov 10 2025 09:43:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">æ ¸å¿ƒæ¦‚è§ˆ</h3>
<ul>
<li><strong>ä¸€çº§ç¼“å­˜</strong>ï¼šé»˜è®¤å¼€å¯ï¼Œä½œç”¨èŒƒå›´åœ¨ <strong>åŒä¸€ä¸ª SqlSession</strong> å†…ã€‚</li>
<li><strong>äºŒçº§ç¼“å­˜</strong>ï¼šéœ€è¦æ‰‹åŠ¨é…ç½®å¼€å¯ï¼Œä½œç”¨èŒƒå›´åœ¨ <strong>åŒä¸€ä¸ª Mapper å‘½åç©ºé—´</strong>ï¼ˆå³åŒä¸€ä¸ª Mapper æ¥å£ï¼‰å†…ï¼Œå¯ä»¥è¢«å¤šä¸ª SqlSession å…±äº«ã€‚</li>
</ul>
<h3 data-id="heading-1">ä¸€çº§ç¼“å­˜</h3>
<h4 data-id="heading-2">1. ä½œç”¨åŸŸ</h4>
<ul>
<li><strong>SqlSession çº§åˆ«</strong>ï¼šå½“åŒä¸€ä¸ª SqlSession æ‰§è¡Œç›¸åŒçš„ SQL æŸ¥è¯¢æ—¶ï¼ŒMyBatis ä¼šä¼˜å…ˆä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚</li>
<li>å®ƒæ˜¯ <strong>é»˜è®¤å¼€å¯</strong> çš„ï¼Œæ— æ³•å…³é—­ï¼Œä½†å¯ä»¥é…ç½®å…¶ä½œç”¨èŒƒå›´ï¼ˆ<code>SESSION</code> æˆ– <code>STATEMENT</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-3">2. å·¥ä½œæœºåˆ¶</h4>
<ol>
<li>ç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥è¯¢åï¼ŒæŸ¥è¯¢ç»“æœä¼šè¢«å­˜å‚¨åˆ° SqlSession å…³è”çš„ä¸€çº§ç¼“å­˜ä¸­ã€‚</li>
<li>åœ¨åŒä¸€ä¸ª SqlSession ä¸­ï¼Œå†æ¬¡æ‰§è¡Œ <strong>å®Œå…¨ç›¸åŒçš„</strong> SQL æŸ¥è¯¢ï¼ˆåŒ…æ‹¬è¯­å¥å’Œå‚æ•°ï¼‰æ—¶ï¼Œä¼šç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œè€Œä¸ä¼šå»æ•°æ®åº“æŸ¥è¯¢ã€‚</li>
<li>å¦‚æœ SqlSession æ‰§è¡Œäº† <strong>å¢ï¼ˆINSERTï¼‰ã€åˆ ï¼ˆDELETEï¼‰ã€æ”¹ï¼ˆUPDATEï¼‰</strong> æ“ä½œï¼Œæˆ–è€…è°ƒç”¨äº† <code>commit()</code>ã€<code>close()</code>ã€<code>rollback()</code> æ–¹æ³•ï¼Œè¯¥ SqlSession çš„ä¸€çº§ç¼“å­˜ä¼šè¢«æ¸…ç©ºã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢è¯»å–åˆ°è„æ•°æ®ã€‚</li>
</ol>
<h4 data-id="heading-4">3. ç¤ºä¾‹è¯´æ˜</h4>
<pre><code class="hljs language-ini" lang="ini">// å‡è®¾è·å–çš„ SqlSession å’Œ UserMapper
try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession()) {
    UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>

    // ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œä¼šå‘é€ SQL åˆ°æ•°æ®åº“
    User <span class="hljs-attr">user1</span> = mapper.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
    System.out.println(user1)<span class="hljs-comment">;</span>

    // ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ŒSQL å’Œå‚æ•°å®Œå…¨ç›¸åŒï¼Œç›´æ¥ä»ä¸€çº§ç¼“å­˜è¿”å›ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“
    User <span class="hljs-attr">user2</span> = mapper.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
    System.out.println(user2)<span class="hljs-comment">;</span>

    // åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ï¼ˆæ˜¯ï¼Œå› ä¸ºä»ç¼“å­˜ä¸­è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼‰
    System.out.println(<span class="hljs-attr">user1</span> == user2)<span class="hljs-comment">; // è¾“å‡ºï¼štrue</span>

    // æ‰§è¡Œä¸€ä¸ªæ›´æ–°æ“ä½œ
    mapper.updateUser(user1)<span class="hljs-comment">;</span>
    // æ­¤æ—¶ï¼Œä¸€çº§ç¼“å­˜è¢«æ¸…ç©º

    // ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼Œå› ä¸ºç¼“å­˜è¢«æ¸…ç©ºï¼Œä¼šå†æ¬¡å‘é€ SQL åˆ°æ•°æ®åº“
    User <span class="hljs-attr">user3</span> = mapper.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
    System.out.println(<span class="hljs-attr">user3</span> == user1)<span class="hljs-comment">; // è¾“å‡ºï¼šfalse (è™½ç„¶æ˜¯åŒä¸€æ¡æ•°æ®ï¼Œä½†å·²æ˜¯æ–°å¯¹è±¡)</span>
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h4 data-id="heading-5">4. æ³¨æ„äº‹é¡¹</h4>
<ul>
<li><strong>å¯¹è±¡ç›¸åŒ</strong>ï¼šä¸€çº§ç¼“å­˜è¿”å›çš„æ˜¯ <strong>åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨</strong>ï¼Œå› æ­¤åœ¨åŒä¸€ä¸ª SqlSession å†…ï¼Œä½ æ“ä½œçš„éƒ½æ˜¯åŒä¸€ä¸ª Java å¯¹è±¡ã€‚</li>
<li><strong>åˆ†å¸ƒå¼ç¯å¢ƒ</strong>ï¼šä¸€çº§ç¼“å­˜æ— æ³•åœ¨å¤šä¸ªåº”ç”¨æœåŠ¡å™¨ä¹‹é—´å…±äº«ï¼Œå› ä¸ºå®ƒç»‘å®šåœ¨å•ä¸ªè¯·æ±‚çš„ SqlSession ä¸Šã€‚</li>
</ul>
<h3 data-id="heading-6">äºŒçº§ç¼“å­˜</h3>
<h4 data-id="heading-7">1. ä½œç”¨åŸŸ</h4>
<ul>
<li><strong>Mapper çº§åˆ« / Namespace çº§åˆ«</strong>ï¼šå¤šä¸ª SqlSession åœ¨è®¿é—®åŒä¸€ä¸ª Mapper çš„æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥å…±äº«å…¶ç¼“å­˜ã€‚</li>
<li>å®ƒæ˜¯ <strong>é»˜è®¤å…³é—­</strong> çš„ï¼Œéœ€è¦åœ¨å…¨å±€é…ç½®ä¸­å¼€å¯ï¼Œå¹¶åœ¨å…·ä½“çš„ Mapper XML ä¸­æ˜¾å¼é…ç½®ã€‚</li>
</ul>
<h4 data-id="heading-8">2. å¼€å¯ä¸é…ç½®</h4>
<p><strong>a. å…¨å±€é…ç½®æ–‡ä»¶ (</strong> <code>mybatis-config.xml</code> <strong>)</strong> ï¼š<br/>
å¿…é¡»æ˜¾å¼è®¾ç½®å¼€å¯äºŒçº§ç¼“å­˜ï¼ˆè™½ç„¶é»˜è®¤æ˜¯ <code>true</code>ï¼Œä½†æ˜¾å¼å£°æ˜æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼‰ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-comment">&lt;!-- å¼€å¯å…¨å±€äºŒçº§ç¼“å­˜ï¼Œé»˜è®¤å°±æ˜¯ trueï¼Œä½†å»ºè®®å†™æ˜ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cacheEnabled"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>b. Mapper XML æ–‡ä»¶</strong>ï¼š<br/>
åœ¨éœ€è¦å¼€å¯äºŒçº§ç¼“å­˜çš„ Mapper.xml ä¸­æ·»åŠ  <code>&lt;cache/&gt;</code> æ ‡ç­¾ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mapper.UserMapper"</span>&gt;</span>
<span class="hljs-comment">&lt;!-- å¼€å¯æœ¬ Mapper çš„äºŒçº§ç¼“å­˜ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">cache</span>
<span class="hljs-attr">eviction</span>=<span class="hljs-string">"FIFO"</span>
<span class="hljs-attr">flushInterval</span>=<span class="hljs-string">"60000"</span>
<span class="hljs-attr">size</span>=<span class="hljs-string">"512"</span>
<span class="hljs-attr">readOnly</span>=<span class="hljs-string">"true"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- å…¶ä»– SQL å®šä¹‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectUserById"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"long"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"User"</span> <span class="hljs-attr">useCache</span>=<span class="hljs-string">"true"</span>&gt;</span>
SELECT * FROM user WHERE id = #{id}
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>
<p><code>&lt;cache/&gt;</code>Â æ ‡ç­¾å±æ€§ï¼š</p>
<ul>
<li>
<p><code>eviction</code>ï¼šç¼“å­˜å›æ”¶ç­–ç•¥ã€‚</p>
<ul>
<li><code>LRU</code>ï¼ˆé»˜è®¤ï¼‰ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚</li>
<li><code>FIFO</code>ï¼šå…ˆè¿›å…ˆå‡ºã€‚</li>
<li><code>SOFT</code>ï¼šè½¯å¼•ç”¨ï¼ŒåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤ã€‚</li>
<li><code>WEAK</code>ï¼šå¼±å¼•ç”¨ï¼Œæ›´ç§¯æåœ°ç§»é™¤ã€‚</li>
</ul>
</li>
<li>
<p><code>flushInterval</code>ï¼šç¼“å­˜åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸æ¸…ç©ºã€‚</p>
</li>
<li>
<p><code>size</code>ï¼šç¼“å­˜å­˜æ”¾å¤šå°‘å…ƒç´ ã€‚</p>
</li>
<li>
<p><code>readOnly</code>ï¼šæ˜¯å¦ä¸ºåªè¯»ã€‚</p>
<ul>
<li><code>true</code>ï¼šè¿”å›ç›¸åŒçš„ç¼“å­˜å¯¹è±¡å®ä¾‹ï¼Œæ€§èƒ½å¥½ï¼Œä½†ä¸å…è®¸ä¿®æ”¹ã€‚</li>
<li><code>false</code>ï¼ˆé»˜è®¤ï¼‰ï¼šé€šè¿‡åºåˆ—åŒ–è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ï¼Œå®‰å…¨ï¼Œæ€§èƒ½ç¨å·®ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">3. å·¥ä½œæœºåˆ¶</h4>
<ol>
<li>å½“ä¸€ä¸ª SqlSession æ‰§è¡ŒæŸ¥è¯¢åï¼Œåœ¨å…³é—­æˆ–æäº¤æ—¶ï¼Œå…¶æŸ¥è¯¢ç»“æœä¼šè¢«å­˜å…¥äºŒçº§ç¼“å­˜ã€‚</li>
<li>å¦ä¸€ä¸ª SqlSession æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆä»äºŒçº§ç¼“å­˜ä¸­æŸ¥æ‰¾æ•°æ®ã€‚å¦‚æœæ‰¾åˆ°ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™å†å»æ•°æ®åº“æŸ¥è¯¢ã€‚</li>
<li>ä»»ä½•ä¸€ä¸ª SqlSession æ‰§è¡Œäº† <strong>å¢ã€åˆ ã€æ”¹</strong> æ“ä½œå¹¶ <code>commit()</code> åï¼Œä¼šæ¸…ç©º <strong>æ•´ä¸ªå¯¹åº” Mapper çš„äºŒçº§ç¼“å­˜</strong>ï¼Œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ol>
<h4 data-id="heading-10">4. ç¤ºä¾‹è¯´æ˜</h4>
<pre><code class="hljs language-ini" lang="ini">// ç¬¬ä¸€ä¸ª SqlSession
try (SqlSession <span class="hljs-attr">sqlSession1</span> = sqlSessionFactory.openSession()) {
    UserMapper <span class="hljs-attr">mapper1</span> = sqlSession1.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
    User <span class="hljs-attr">user1</span> = mapper1.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">; // æŸ¥è¯¢æ•°æ®åº“</span>
    sqlSession1.close()<span class="hljs-comment">; // å…³é—­æ—¶ï¼Œæ•°æ®å­˜å…¥äºŒçº§ç¼“å­˜</span>
}

// ç¬¬äºŒä¸ª SqlSessionï¼ˆä¸ç¬¬ä¸€ä¸ªä¸åŒï¼‰
try (SqlSession <span class="hljs-attr">sqlSession2</span> = sqlSessionFactory.openSession()) {
    UserMapper <span class="hljs-attr">mapper2</span> = sqlSession2.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
    // æŸ¥è¯¢ç›¸åŒçš„ SQLï¼Œç›´æ¥ä»äºŒçº§ç¼“å­˜è·å–ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“
    User <span class="hljs-attr">user2</span> = mapper2.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
}

// ç¬¬ä¸‰ä¸ª SqlSessionï¼Œæ‰§è¡Œäº†æ›´æ–°
try (SqlSession <span class="hljs-attr">sqlSession3</span> = sqlSessionFactory.openSession()) {
    UserMapper <span class="hljs-attr">mapper3</span> = sqlSession3.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
    User <span class="hljs-attr">user</span> = mapper3.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
    user.setName("New Name")<span class="hljs-comment">;</span>
    mapper3.updateUser(user)<span class="hljs-comment">; // æ‰§è¡Œæ›´æ–°</span>
    sqlSession3.commit()<span class="hljs-comment">; // æäº¤æ—¶ï¼Œæ¸…ç©º UserMapper çš„äºŒçº§ç¼“å­˜</span>
}

// ç¬¬å››ä¸ª SqlSession
try (SqlSession <span class="hljs-attr">sqlSession4</span> = sqlSessionFactory.openSession()) {
    UserMapper <span class="hljs-attr">mapper4</span> = sqlSession4.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
    // å› ä¸ºç¼“å­˜å·²è¢«æ¸…ç©ºï¼Œæ‰€ä»¥ä¼šå†æ¬¡æŸ¥è¯¢æ•°æ®åº“
    User <span class="hljs-attr">user4</span> = mapper4.selectUserById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h4 data-id="heading-11">5. æ³¨æ„äº‹é¡¹</h4>
<ul>
<li><strong>å®ä½“ç±»åºåˆ—åŒ–</strong>ï¼šå¦‚æœäºŒçº§ç¼“å­˜çš„ <code>readOnly="false"</code>ï¼Œé‚£ä¹ˆå¯¹åº”çš„å®ä½“ç±»å¿…é¡»å®ç° <code>Serializable</code> æ¥å£ã€‚</li>
<li><strong>äº‹åŠ¡æäº¤</strong>ï¼šåªæœ‰åœ¨ SqlSession æ‰§è¡Œ <code>commit()</code> æˆ– <code>close()</code> æ—¶ï¼Œæ•°æ®æ‰ä¼šä»ä¸€çº§ç¼“å­˜è½¬å­˜åˆ°äºŒçº§ç¼“å­˜ã€‚</li>
<li><strong>ç¼“å­˜ç²’åº¦</strong>ï¼šäºŒçº§ç¼“å­˜æ˜¯ Mapper çº§åˆ«çš„ï¼Œæœ‰æ—¶ä¼šæ˜¾å¾—æ¯”è¾ƒç²—ç²’åº¦ã€‚å¯ä»¥é€šè¿‡ <code>&lt;cache-ref&gt;</code> è®©å¤šä¸ª Mapper å…±äº«ä¸€ä¸ªç¼“å­˜ï¼Œä½†ä¸æ¨èï¼Œå®¹æ˜“å¼•èµ·æ•°æ®æ··ä¹±ã€‚</li>
</ul>
<h3 data-id="heading-12">ç¼“å­˜é¡ºåºä¸æ€»ç»“</h3>
<p>å½“å‘èµ·ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚æ—¶ï¼ŒMyBatis çš„ç¼“å­˜æŸ¥è¯¢é¡ºåºæ˜¯ï¼š</p>
<ol>
<li><strong>å…ˆæŸ¥äºŒçº§ç¼“å­˜</strong>ï¼šæŸ¥çœ‹å½“å‰ Mapper çš„äºŒçº§ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ã€‚</li>
<li><strong>å†æŸ¥ä¸€çº§ç¼“å­˜</strong>ï¼šå¦‚æœäºŒçº§ç¼“å­˜æ²¡æœ‰ï¼Œå†æŸ¥çœ‹å½“å‰ SqlSession çš„ä¸€çº§ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ã€‚</li>
<li><strong>æœ€åæŸ¥æ•°æ®åº“</strong>ï¼šå¦‚æœä¸¤çº§ç¼“å­˜éƒ½æ²¡æœ‰ï¼Œæ‰å‘é€ SQL è¯­å¥åˆ°æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢ã€‚</li>
</ol>
<p>æŸ¥è¯¢åˆ°çš„æ•°æ®ä¼š <strong>å…ˆå­˜å…¥ä¸€çº§ç¼“å­˜</strong>ï¼Œåœ¨ SqlSession å…³é—­æˆ–æäº¤æ—¶ï¼Œ<strong>å†è½¬å­˜åˆ°äºŒçº§ç¼“å­˜</strong>ã€‚</p>



































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>ç‰¹æ€§</td><td>ä¸€çº§ç¼“å­˜</td><td>äºŒçº§ç¼“å­˜</td></tr><tr><td><strong>ä½œç”¨åŸŸ</strong></td><td>SqlSession</td><td>Mapper (Namespace)</td></tr><tr><td><strong>é»˜è®¤çŠ¶æ€</strong></td><td>å¼€å¯</td><td>å…³é—­</td></tr><tr><td><strong>æ˜¯å¦å…±äº«</strong></td><td>å¦ï¼ŒSession ç‹¬äº«</td><td>æ˜¯ï¼Œè·¨ Session å…±äº«</td></tr><tr><td><strong>æ¸…ç©ºæ—¶æœº</strong></td><td>UPDATE/INSERT/DELETE, <code>commit()</code>, <code>close()</code></td><td>åŒ Mapper çš„ UPDATE/INSERT/DELETE + <code>commit()</code></td></tr></tbody></table>
<h3 data-id="heading-13">ä½¿ç”¨å»ºè®®</h3>
<ul>
<li><strong>æŸ¥è¯¢å¤šï¼Œä¿®æ”¹å°‘</strong>çš„æ•°æ®é€‚åˆä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œå¦‚å­—å…¸è¡¨ã€é…ç½®é¡¹ã€‚</li>
<li><strong>æ•°æ®å®æ—¶æ€§è¦æ±‚é«˜</strong>çš„åœºæ™¯ï¼ˆå¦‚äº¤æ˜“ã€è®¢å•ï¼‰åº”è°¨æ…ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œæˆ–è€…è®¾ç½®è¾ƒçŸ­çš„åˆ·æ–°é—´éš”ã€‚</li>
<li>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œé»˜è®¤çš„äºŒçº§ç¼“å­˜ï¼ˆåŸºäºå†…å­˜ï¼‰æ˜¯æ— æ³•å…±äº«çš„ï¼Œéœ€è¦é›†æˆ Redisã€Ehcache ç­‰ç¬¬ä¸‰æ–¹ç¼“å­˜ä¸­é—´ä»¶æ¥æ›¿ä»£ã€‚</li>
<li>ç†è§£ç¼“å­˜æœºåˆ¶æœ‰åŠ©äºè§£å†³ä¸€äº›â€œè¯¡å¼‚â€çš„é—®é¢˜ï¼Œæ¯”å¦‚åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå…ˆåæŸ¥è¯¢å’Œæ›´æ–°ï¼Œä½†ç”±äºä¸€çº§ç¼“å­˜çš„å­˜åœ¨ï¼Œåç»­æŸ¥è¯¢å¯èƒ½çœ‹ä¸åˆ°å…¶ä»–çº¿ç¨‹çš„æ›´æ–°ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Androidã€‘Androidå†…å­˜ç¼“å­˜LruCacheä¸DiskLruCacheçš„ä½¿ç”¨åŠå®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7570902473432645632</link>    <guid>https://juejin.cn/post/7570902473432645632</guid>    <pubDate>2025-11-10T09:18:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473432645632" data-draft-id="7570902473432612864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Androidã€‘Androidå†…å­˜ç¼“å­˜LruCacheä¸DiskLruCacheçš„ä½¿ç”¨åŠå®ç°åŸç†"/> <meta itemprop="keywords" content="Java,Android"/> <meta itemprop="datePublished" content="2025-11-10T09:18:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼¥å··"/> <meta itemprop="url" content="https://juejin.cn/user/1743186606454698"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Androidã€‘Androidå†…å­˜ç¼“å­˜LruCacheä¸DiskLruCacheçš„ä½¿ç”¨åŠå®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743186606454698/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼¥å··
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:18:11.000Z" title="Mon Nov 10 2025 09:18:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Androidã€‘Androidå†…å­˜ç¼“å­˜LruCacheä¸DiskLruCacheçš„ä½¿ç”¨åŠå®ç°åŸç†</h2>
<p>åœ¨Androidä¸­ï¼Œé€šå¸¸ä¼šé€šè¿‡ç¼“å­˜ç­–ç•¥æ¥ä¼˜åŒ–æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿä¼šå‡å°‘ä¸å¿…è¦çš„æµé‡æ¶ˆè€—ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨ç½‘ç»œåŠ è½½ä¸€å¼ å›¾ç‰‡åï¼Œä¸‹æ¬¡åŠ è½½è¿™å¼ å›¾ç‰‡çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä»ç½‘ç»œåŠ è½½ï¼Œè€Œæ˜¯ä¼šä»å†…å­˜æˆ–è€…ç£ç›˜åŠ è½½è¿™å¼ å›¾ç‰‡ã€‚</p>
<h3 data-id="heading-1">1.LRUç¼“å­˜æ·˜æ±°ç®—æ³•</h3>
<p>ç”±äºç¼“å­˜çš„å¤§å°å¹¶ä¸æ˜¯æ— é™åˆ¶çš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨ç¼“å­˜æ—¶æ€»æ˜¯è¦ä¸ºç¼“å­˜æŒ‡å®šä¸€ä¸ªæœ€å¤§çš„å®¹é‡ã€‚å¦‚æœå½“ç¼“å­˜å®¹é‡æ»¡äº†ï¼Œä½†æ˜¯ç¨‹åºè¿˜éœ€è¦å‘å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ï¼Œå¦‚ä½•å®šä¹‰ç¼“å­˜çš„æ–°æ—§å°±å¯¹åº”ç€ä¸åŒçš„ç¼“å­˜ç®—æ³•ã€‚æœ€å¸¸ç”¨çš„ä¸€ç§ç¼“å­˜ç®—æ³•æ˜¯<strong>LRU ï¼ˆLeast Recently Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•</strong>ï¼Œå®ƒçš„åŸºæœ¬ç†å¿µæ˜¯ï¼š<strong>å½“ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°æœ€ä¹…æœªè¢«è®¿é—®çš„æ•°æ®</strong>ã€‚å¸¸è§ç¼“å­˜æ·˜æ±°ç­–ç•¥è¿˜æœ‰ï¼š</p>
<p><strong>1ã€éšæœºç­–ç•¥ï¼š</strong> ä½¿ç”¨ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨éšæœºåœ°é€‰æ‹©è¦è¢«æ·˜æ±°çš„æ•°æ®å—ï¼›</p>
<p><strong>2ã€FIFO å…ˆè¿›å…ˆå‡ºç­–ç•¥ï¼š</strong> è®°å½•å„ä¸ªæ•°æ®å—çš„è®¿é—®æ—¶é—´ï¼Œæœ€æ—©è®¿é—®çš„æ•°æ®æœ€å…ˆè¢«æ·˜æ±°ï¼›</p>
<p><strong>3ã€LRU ï¼ˆLeast Recently Usedï¼‰æœ€è¿‘æœ€å°‘ç­–ç•¥ï¼š</strong> è®°å½•å„ä¸ªæ•°æ®å—çš„è®¿é—® <strong>â€œæ—¶é—´æˆ³â€</strong> ï¼Œæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®æœ€å…ˆè¢«æ·˜æ±°ã€‚ä¸å‰ 2 ç§ç­–ç•¥ç›¸æ¯”ï¼ŒLRU ç­–ç•¥å¹³å‡ç¼“å­˜å‘½ä¸­ç‡æ›´é«˜ï¼Œè¿™æ˜¯å› ä¸º LRU ç­–ç•¥åˆ©ç”¨äº† â€œå±€éƒ¨æ€§åŸç†â€ï¼šæœ€è¿‘è¢«è®¿é—®è¿‡çš„æ•°æ®ï¼Œå°†æ¥è¢«è®¿é—®çš„å‡ ç‡è¾ƒå¤§ï¼Œæœ€è¿‘å¾ˆä¹…æœªè®¿é—®çš„æ•°æ®ï¼Œå°†æ¥è®¿é—®çš„å‡ ç‡ä¹Ÿè¾ƒå°ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56deddf81e2e4c0c90a1d58db591cfff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371091&amp;x-signature=cl43IO1MJdhR%2FEX%2BRRbTdg%2Fd0Ko%3D" alt="1613c53defb9b5d4~tplv-t2oaga2asx-jj-mark_3024_0_0_0_q75.png" loading="lazy"/></p>
<p><strong>4ã€LFU ï¼ˆLeast Frequently Usedï¼‰æœ€ä¸ç»å¸¸ä½¿ç”¨ç­–ç•¥ï¼š</strong> ä¸ LRU ç›¸æ¯”ï¼ŒLFU æ›´åŠ æ³¨é‡ä½¿ç”¨çš„ <strong>â€œé¢‘ç‡â€</strong> ã€‚LFU ä¼šè®°å½•æ¯ä¸ªæ•°æ®å—çš„è®¿é—®æ¬¡æ•°ï¼Œæœ€å°‘è®¿é—®æ¬¡æ•°çš„æ•°æ®æœ€å…ˆè¢«æ·˜æ±°ã€‚ä½†æ˜¯æœ‰äº›æ•°æ®åœ¨å¼€å§‹æ—¶ä½¿ç”¨æ¬¡æ•°å¾ˆé«˜ï¼Œä»¥åä¸å†ä½¿ç”¨ï¼Œè¿™äº›æ•°æ®å°±ä¼šé•¿æ—¶é—´æ±¡æŸ“ç¼“å­˜ã€‚å¯ä»¥å®šæœŸå°†è®¡æ•°å™¨å³ç§»ä¸€ä½ï¼Œå½¢æˆæŒ‡æ•°è¡°å‡ã€‚</p>
<p>è€Œåœ¨Androidä¸­ï¼ŒLruå¯¹åº”LruCacheå’ŒDiskLruCacheä¸¤ç§ç¼“å­˜ç±»ã€‚</p>
<h3 data-id="heading-2">2. LruCacheçš„ä½¿ç”¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (Runtime.getRuntime().maxMemory() / <span class="hljs-number">1024</span>);
<span class="hljs-comment">//åˆå§‹åŒ–å¤§å°:å½“å‰è¿›ç¨‹çš„å¯ç”¨å†…å­˜çš„1/8</span>
<span class="hljs-type">int</span> <span class="hljs-variable">cacheSize</span> <span class="hljs-operator">=</span> maxMemory / <span class="hljs-number">8</span>;
memorySize = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;String, Bitmap&gt;(cacheSize) {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sizeOf</span><span class="hljs-params">(String key, Bitmap value)</span> {
        <span class="hljs-comment">//é‡å†™è¯¥æ–¹æ³•,å®Œæˆæ¯å¼ è¦ç¼“å­˜çš„å›¾ç‰‡å¤§å°çš„è®¡ç®—</span>
        <span class="hljs-keyword">return</span> bitmap.getRowBytes() * bitmap.getHeight() / <span class="hljs-number">1024</span>;
    }
};

</code></pre>
<p>ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦æä¾›ç¼“å­˜çš„æ€»å®¹é‡å¤§å°å¹¶é‡å†™sizeOfæ–¹æ³•å³å¯ã€‚æ€»å®¹é‡å¤§å°ä¸ºå½“å‰è¿›ç¨‹å¯ç”¨å†…å­˜çš„1/8ï¼ŒsizeOfæ–¹æ³•å®Œæˆå¯¹Bitmapå¯¹è±¡å¤§å°çš„è®¡ç®—ã€‚</p>
<p>é™¤äº†åˆ›å»ºç¼“å­˜ï¼Œè¿˜æœ‰ä¸‹é¢ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼š</p>

































<table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>get(K)</td><td>é€šè¿‡Kè·å–ç¼“å­˜</td></tr><tr><td>put(K,V)</td><td>è®¾ç½®Kçš„å€¼ä¸ºV</td></tr><tr><td>remove(K)</td><td>åˆ é™¤Kç¼“å­˜</td></tr><tr><td>evictAll()</td><td>æ¸…é™¤ç¼“å­˜</td></tr><tr><td>resize(int)</td><td>è®¾ç½®æœ€å¤§ç¼“å­˜å¤§å°</td></tr><tr><td>snapshot()</td><td>è·å–ç¼“å­˜å†…å®¹çš„é•œåƒ</td></tr></tbody></table>
<h3 data-id="heading-3">3.DiskLruCacheçš„ä½¿ç”¨</h3>
<p>DiskLruCacheä¸æ˜¯Android SDKçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”±Jake Whartonåœ¨JakeWharton/DiskLruCacheæä¾›çš„ä¸€ä¸ªå¼€æºå®ç°ã€‚æ‰€ä»¥ä½¿ç”¨ä¹‹å‰è¦å…ˆå¼•å…¥ä¾èµ–ï¼š</p>
<pre><code class="hljs language-groovy" lang="groovy">implementation 'com.jakewharton:disklrucache:2.0.2'
</code></pre>
<h4 data-id="heading-4">3.1 DiskLruCacheçš„åˆ›å»º</h4>
<p><code>DiskLruCache</code>å¹¶ä¸èƒ½é€šè¿‡æ„é€ æ–¹æ³•æ¥åˆ›å»ºï¼Œå®ƒæä¾›äº†openæ–¹æ³•ç”¨äºåˆ›å»ºè‡ªèº«ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.jakewharton.disklrucache.DiskLruCache;
<span class="hljs-keyword">import</span> java.io.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiskCacheHelper</span> {
    <span class="hljs-keyword">private</span> DiskLruCache diskLruCache;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DiskCacheHelper</span><span class="hljs-params">(File cacheDir)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// åˆ›å»ºç¼“å­˜ç›®å½•</span>
        <span class="hljs-keyword">if</span> (!cacheDir.exists()) {
            cacheDir.mkdirs();
        }
        
        <span class="hljs-comment">// åˆå§‹åŒ–DiskLruCache</span>
        <span class="hljs-comment">// å‚æ•°ï¼šç¼“å­˜ç›®å½•, ç‰ˆæœ¬å·, æ¯ä¸ªkeyå¯¹åº”çš„æ–‡ä»¶æ•°, æœ€å¤§ç¼“å­˜å¤§å°(å­—èŠ‚)</span>
        diskLruCache = DiskLruCache.open(cacheDir, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>); <span class="hljs-comment">// 10MB</span>
    }
}
</code></pre>
<p>openæ–¹æ³•æœ‰å››ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºç£ç›˜ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„å­˜å‚¨è·¯å¾„ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºåº”ç”¨çš„ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬è®¾ä¸º1å³å¯ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºå•ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„æ•°æ®çš„ä¸ªæ•°ï¼Œä¸€èˆ¬è®¾ä¸º1å³å¯ï¼›ç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºç¼“å­˜çš„æ€»å¤§å°ï¼Œæ¯”å¦‚10MBï¼Œå½“ç¼“å­˜å¤§å°è¶…å‡ºè¿™ä¸ªè®¾å®šå€¼åï¼ŒDiskLruCacheä¼šæ¸…é™¤ä¸€äº›ç¼“å­˜ä»è€Œä¿è¯æ€»å¤§å°ä¸å¤§äºè¿™ä¸ªè®¾å®šå€¼ã€‚</p>
<h4 data-id="heading-5">3.2 DiskLruCacheçš„ç¼“å­˜æ·»åŠ </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveToCache</span><span class="hljs-params">(String key, String data)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// è·å–ç¼–è¾‘å™¨</span>
    DiskLruCache.<span class="hljs-type">Editor</span> <span class="hljs-variable">editor</span> <span class="hljs-operator">=</span> diskLruCache.edit(key);
    <span class="hljs-keyword">if</span> (editor == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// å†™å…¥æ•°æ®</span>
    <span class="hljs-type">OutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> editor.newOutputStream(<span class="hljs-number">0</span>);
    outputStream.write(data.getBytes());
    outputStream.close();
    
    <span class="hljs-comment">// æäº¤ä¿å­˜</span>
    editor.commit();
}
</code></pre>
<p>è¦æ·»åŠ ç¼“å­˜ï¼Œé¦–å…ˆè¦é€šè¿‡keyè·å–ç¼“å­˜å¯¹è±¡çš„<code>Editor</code>ï¼ˆç¼–è¾‘å¯¹è±¡ï¼‰ï¼Œå¯¹äºè¿™ä¸ªkeyæ¥è¯´å¦‚æœå½“å‰ä¸å­˜åœ¨å…¶ä»–Editorå¯¹è±¡ã€‚é‚£ä¹ˆedit()å°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Editorå¯¹è±¡ï¼Œæ¥ç€é€šè¿‡è¿™ä¸ªEditorå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼Œæœ‰äº†æ–‡ä»¶è¾“å‡ºæµï¼Œæ•°æ®å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¾“å‡ºæµå†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚æœ€åè¦æ³¨æ„çš„æ˜¯ï¼Œå•å•é€šè¿‡<code>outputStream.write(data.getBytes());</code>ï¼Œæ•°æ®å…¶å®å¹¶æ²¡æœ‰çœŸæ­£åœ°å†™å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œè¿˜å¿…é¡»é€šè¿‡Editorçš„commit()æ¥æäº¤å†™å…¥æ“ä½œã€‚å¦‚æœæ•°æ®ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸è¿˜å¯ä»¥é€šè¿‡Editorçš„abort()æ¥å›é€€æ•´ä¸ªæ“ä½œ:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> editor.newOutputStream(<span class="hljs-number">0</span>)) {
            os.write(data.getBytes());
        }
        editor.commit();
    } <span class="hljs-keyword">catch</span> (IOException e) {
        editor.abort(); <span class="hljs-comment">// å›é€€</span>
        <span class="hljs-keyword">throw</span> e;
    }
</code></pre>
<p>è¿™æ ·æ•°æ®å°±æˆåŠŸå†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿäº†ï¼Œæ¥ä¸‹æ¥æ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰çš„è·å–å°±ä¸éœ€è¦ç½‘ç»œäº†ã€‚</p>
<h4 data-id="heading-6">3.3 DiskLruCacheçš„ç¼“å­˜æŸ¥æ‰¾</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">readFromCache</span><span class="hljs-params">(String key)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// è·å–å¿«ç…§</span>
    DiskLruCache.<span class="hljs-type">Snapshot</span> <span class="hljs-variable">snapshot</span> <span class="hljs-operator">=</span> diskLruCache.get(key);
    <span class="hljs-keyword">if</span> (snapshot == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// è¯»å–æ•°æ®</span>
    <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> snapshot.getInputStream(<span class="hljs-number">0</span>);
    <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream));
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">stringBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
    String line;
    
    <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
        stringBuilder.append(line);
    }
    
    reader.close();
    snapshot.close();
    <span class="hljs-keyword">return</span> stringBuilder.toString();
}
</code></pre>
<p>å’Œç¼“å­˜çš„æ·»åŠ ç±»ä¼¼ï¼ŒæŸ¥æ‰¾ç¼“å­˜é¦–å…ˆé€šè¿‡DiskLruCacheçš„getæ–¹æ³•ä¼ å…¥keyè·å–åˆ°Snapshotå¯¹è±¡ï¼Œæ¥ä¸‹é‡Œé€šè¿‡Snapshotå¯¹è±¡å°±èƒ½å¾—åˆ°ç¼“å­˜çš„æ–‡ä»¶è¾“å…¥æµï¼Œæ‹¿åˆ°æ–‡ä»¶è¾“å…¥æµï¼Œå°±èƒ½å¾ˆè½»æ¾çš„å¾—åˆ°åŸå§‹æ•°æ®ã€‚</p>
<h4 data-id="heading-7">3.4 DiskLruCacheçš„ç¼“å­˜åˆ é™¤</h4>
<p>åˆ é™¤å°±éå¸¸ç®€å•äº†ï¼ŒDiskLruCacheæä¾›äº†removeæ–¹æ³•å®ç°ç¼“å­˜çš„åˆ é™¤æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeFromCache</span><span class="hljs-params">(String key)</span> <span class="hljs-keyword">throws</span> IOException {
    diskLruCache.remove(key);
}
</code></pre>
<h3 data-id="heading-8">4. LruCacheçš„æºç å®ç°</h3>
<p>LruCahcheå…¶å®ä½¿ç”¨äº†LinkedHashMapåŒå‘é“¾è¡¨ç»“æ„ï¼Œä»¥ä¸‹æ˜¯LinkedHashMapçš„æ„é€ æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">LinkedHashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity,
                         <span class="hljs-type">float</span> loadFactor,
                         <span class="hljs-type">boolean</span> accessOrder)</span> {
        <span class="hljs-built_in">super</span>(initialCapacity, loadFactor);
        <span class="hljs-built_in">this</span>.accessOrder = accessOrder;
    }
</code></pre>
<p>å¸ƒå°”å˜é‡<code>accessOrder</code>ä¸ºtrueæ—¶ï¼ŒLinkedHashMapä¼šä»¥è®¿é—®é¡ºåºæ’åˆ—å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è®¿é—®äº†ä¹‹åå°±å°†è¿™ä¸ªå…ƒç´ æ”¾åˆ°é›†åˆçš„æœ€åé¢ï¼Œå¦åˆ™ä»¥æ’å…¥é¡ºåºæ’åˆ—å…ƒç´ ã€‚</p>
<p>å¯ä»¥å‘ç°ï¼Œåœ¨LiskHashMapä¸­ï¼Œå½“<code>accessOrder</code>ä¸ºtrueæ—¶ï¼Œæœ€åè¢«è®¿é—®çš„å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°è¡¨å°¾ï¼Œè€ŒLruCacheä¹Ÿæ˜¯ä»è¡¨å°¾è®¿é—®æ•°æ®ï¼Œåœ¨è¡¨å¤´åˆ é™¤å…ƒç´ ï¼Œè¿™æ­£æ˜¯ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹LruCacheæ˜¯å¦‚ä½•è¿›è¡Œç¼“å­˜çš„å†™å…¥ã€è·å–å’Œåˆ é™¤çš„ã€‚</p>
<h4 data-id="heading-9">4.1 LruCacheçš„put()æ–¹æ³•åˆ†æï¼š</h4>
<p>å†™å…¥ç¼“å­˜æ˜¯é€šè¿‡LruChcheçš„putæ–¹æ³•å®ç°çš„ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || value == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"key == null || value == null"</span>);
        }
		<span class="hljs-comment">// è¿™ä¸ªå˜é‡ç”¨äºä¿å­˜è¢«æ›¿æ¢çš„æ—§å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</span>
        V previous;
    	<span class="hljs-comment">// åŠ é”ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ </span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-comment">// ç¼“å­˜æ•°é‡è‡ªå¢</span>
            putCount++;
            <span class="hljs-comment">// è®¡ç®—ç¼“å­˜æ€»å¤§å°ï¼ŒsafeSizeOfæ–¹æ³•è®¡ç®—å½“å‰é”®å€¼å¯¹çš„å¤§å°</span>
            size += safeSizeOf(key, value);
            <span class="hljs-comment">// é€šè¿‡LinkedHashMapä¸­çš„putæ–¹æ³•å°†é”®å€¼å¯¹å­˜å…¥mapä¸­</span>
            <span class="hljs-comment">// å¦‚æœé”®å·²å­˜åœ¨ï¼Œmap.putä¼šè¿”å›è¢«æ›¿æ¢çš„æ—§å€¼ï¼Œå¦åˆ™è¿”å›null</span>
            previous = map.put(key, value);
            <span class="hljs-comment">// æ—§å€¼å­˜åœ¨ï¼ˆå°±æ˜¯æ›´æ–°é”®æ‰€å¯¹åº”çš„å€¼ï¼‰</span>
            <span class="hljs-keyword">if</span> (previous != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ä»æ€»å¤§å°ä¸­å‡å»æ—§å€¼çš„å¤§å°ï¼Œæ³¨æ„æ–°å€¼å¤§å°å·²ç»æ·»åŠ </span>
                size -= safeSizeOf(key, previous);
            }
        }

        <span class="hljs-keyword">if</span> (previous != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ç”¨äºèµ„æºå›æ”¶æ¸…ç†</span>
            entryRemoved(<span class="hljs-literal">false</span>, key, previous, value);
        }
    
		<span class="hljs-comment">// æ£€æŸ¥å¹¶è°ƒæ•´ç¼“å­˜å¤§å°ï¼Œä½¿ç”¨Lruç®—æ³•ç¡®ä¿å½“å‰ç¼“å­˜æ€»å¤§å°ä¸ä¼šè¶…å‡ºæœ€å¤§å®¹é‡é™åˆ¶</span>
        trimToSize(maxSize);
    	<span class="hljs-comment">// è¿”å›è¢«æ›¿æ¢çš„æ—§å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ </span>
        <span class="hljs-keyword">return</span> previous;
    }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trimToSize</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> {
    	<span class="hljs-comment">// æ— é™å¾ªç¯åˆ é™¤æœ€è€ç¼“å­˜ç›´åˆ°å¤§å°æ»¡è¶³è¦æ±‚ </span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// ç”¨äºä¿å­˜è¢«åˆ é™¤çš„é”®å€¼å¯¹</span>
            K key;
            V value;
            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
				<span class="hljs-comment">// å‚æ•°æ£€æŸ¥</span>
                <span class="hljs-keyword">if</span> (size &lt; <span class="hljs-number">0</span> || (map.isEmpty() &amp;&amp; size != <span class="hljs-number">0</span>)) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(getClass().getName()
                            + <span class="hljs-string">".sizeOf() is reporting inconsistent results!"</span>);
                }
				<span class="hljs-comment">// å¾ªç¯ç»ˆæ­¢æ¡ä»¶ï¼šå½“å‰å¤§å°å°äºç­‰äºæœ€å¤§å®¹é‡ï¼Œä¸éœ€è¦åˆ é™¤æœ€è€ç¼“å­˜</span>
                <span class="hljs-keyword">if</span> (size &lt;= maxSize) {
                    <span class="hljs-keyword">break</span>;
                }
				
                <span class="hljs-comment">// æ ¸å¿ƒï¼šeldest()æ–¹æ³•è¿”å›æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨çš„è¡¨å¤´å…ƒç´ </span>
                Map.Entry&lt;K, V&gt; toEvict = eldest();
                <span class="hljs-comment">// å¼‚å¸¸åˆ¤æ–­ï¼šæ²¡æœ‰å¯ç§»é™¤çš„ç¼“å­˜</span>
                <span class="hljs-keyword">if</span> (toEvict == <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">break</span>;
                }
				<span class="hljs-comment">// æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜çš„é”®å€¼å¯¹</span>
                key = toEvict.getKey();
                value = toEvict.getValue();
                <span class="hljs-comment">// ä½¿ç”¨LinkedHashMapçš„removeæ–¹æ³•ç§»é™¤è¯¥ç¼“å­˜</span>
                map.remove(key);
                <span class="hljs-comment">// ä»æ€»å¤§å°ä¸­å‡å»åˆ é™¤çš„ç¼“å­˜å¤§å°</span>
                size -= safeSizeOf(key, value);
                <span class="hljs-comment">// ç§»é™¤è®¡æ•°å™¨è‡ªå¢</span>
                evictionCount++;
            }
			
            <span class="hljs-comment">// èµ„æºå›æ”¶ï¼Œtrueè¡¨ç¤ºç”±äºç¼“å­˜ç©ºé—´ä¸è¶³è€Œè¢«åˆ é™¤ï¼Œnullè¡¨ç¤ºæ–°å€¼</span>
            entryRemoved(<span class="hljs-literal">true</span>, key, value, <span class="hljs-literal">null</span>);
        }
    }
</code></pre>
<p>putæ–¹æ³•ä¸»è¦æ˜¯æ·»åŠ ç¼“å­˜åï¼Œç„¶åè°ƒç”¨<code>trimToSize</code>æ–¹æ³•ä½¿ç”¨Lruç®—æ³•æ¥åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜ï¼Œä¿è¯ç¼“å­˜å¤§å°ã€‚åŒæ—¶ä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨äº†åŒæ­¥æ–¹æ³•å—ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œç®€è¦æ¦‚æ‹¬æ¥è®²å°±æ˜¯å…ˆæ’å…¥åæ£€æŸ¥ï¼Œä»¥ä¸‹å›¾ç¤ºå¾ˆæ¸…æ¥šåœ°å±•ç¤ºäº†putæ–¹æ³•çš„å·¥ä½œæµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5524aeb01b64351b07b06a810f255a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371091&amp;x-signature=dhYZreDzLeQqNTPaA1QCGlASu%2FI%3D" alt="38d656e051a548778c1bd5705ee44ed0~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp" loading="lazy"/></p>
<h4 data-id="heading-10">4.2 LruCacheçš„get()æ–¹æ³•åˆ†æï¼š</h4>
<p>get()æ–¹æ³•å®ç°äº†LruCacheçš„è¯»å–ç¼“å­˜æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> {
    	<span class="hljs-comment">// é”®çš„éç©ºåˆ¤æ–­ </span>
        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"key == null"</span>);
        }

        V mapValue;
    	<span class="hljs-comment">// å°è¯•ä»ç¼“å­˜ä¸­è·å–å€¼ </span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-comment">//è°ƒç”¨LinkedHashMapçš„get()æ–¹æ³•ï¼Œæ³¨æ„å¦‚æœè¯¥å…ƒç´ å­˜åœ¨ï¼Œä¸”accessOrderä¸ºtrueï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå°†è¯¥å…ƒç´ ç§»åŠ¨åˆ°è¡¨å°¾</span>
            mapValue = map.get(key);
            <span class="hljs-comment">// ç¼“å­˜å‘½ä¸­ï¼š</span>
            <span class="hljs-keyword">if</span> (mapValue != <span class="hljs-literal">null</span>) {
                hitCount++; <span class="hljs-comment">// å‘½ä¸­è®¡æ•°å™¨è‡ªå¢</span>
                <span class="hljs-keyword">return</span> mapValue; <span class="hljs-comment">// è¿”å›æ‰¾åˆ°çš„å€¼ï¼Œget()æ–¹æ³•ç»“æŸ </span>
            }
            <span class="hljs-comment">// ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼š</span>
            missCount++; <span class="hljs-comment">// æœªå‘½ä¸­è®¡æ•°å™¨è‡ªå¢</span>
        }
		
    	<span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­å¤„ç†ï¼šåˆ›å»ºå€¼ </span>
        <span class="hljs-type">V</span> <span class="hljs-variable">createdValue</span> <span class="hljs-operator">=</span> create(key);
    	<span class="hljs-comment">// creat()æ–¹æ³•è¿”å›nullï¼Œåˆ›å»ºå¤±è´¥ï¼Œget()ç›´æ¥è¿”å›null </span>
        <span class="hljs-keyword">if</span> (createdValue == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
		
    	<span class="hljs-comment">// å°†åˆ›å»ºçš„å€¼å­˜å…¥ç¼“å­˜ </span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            createCount++; <span class="hljs-comment">// åˆ›å»ºè®¡æ•°å™¨è‡ªå¢</span>
            
            <span class="hljs-comment">// å°è¯•å°†åˆ›å»ºçš„å€¼å­˜å…¥map</span>
            <span class="hljs-comment">// æ³¨ï¼šåœ¨é‡Šæ”¾é”å’Œé‡æ–°åŠ é”çš„é—´éš™ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»å­˜å…¥ç›¸åŒçš„é”®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨put()æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿”å›å·²ç»å­˜åœ¨çš„å€¼</span>
            mapValue = map.put(key, createdValue);

            <span class="hljs-comment">// å¦‚æœmapValueä¸ä¸ºç©ºï¼Œè¯´æ˜åˆ›å»ºè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å†²çªï¼Œä¹Ÿå°±æ˜¯å…¶ä»–çº¿ç¨‹åœ¨æˆ‘ä»¬åˆ›å»ºå€¼çš„åŒæ—¶ä¹Ÿæ’å…¥äº†ç›¸åŒçš„é”®</span>
            <span class="hljs-keyword">if</span> (mapValue != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// There was a conflict so undo that last put</span>
                <span class="hljs-comment">// æ’¤é”€åˆšæ‰çš„putæ“ä½œï¼Œå°±æ˜¯æŠŠå…¶ä»–çº¿ç¨‹æ’å…¥çš„å€¼æ¢å¤</span>
                map.put(key, mapValue);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// æ²¡æœ‰å†²çªï¼Œæ­£å¸¸æ›´æ–°ç¼“å­˜å¤§å°</span>
                size += safeSizeOf(key, createdValue);
            }
        }

        <span class="hljs-keyword">if</span> (mapValue != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å‘ç”Ÿå†²çªï¼Œé€šçŸ¥åˆ›å»ºçš„å€¼è¢«ä¸¢å¼ƒï¼Œå›è°ƒentryRemovedå®Œæ–¹æ³•æˆèµ„æºçš„å›æ”¶å·¥ä½œ</span>
            entryRemoved(<span class="hljs-literal">false</span>, key, createdValue, mapValue);
            <span class="hljs-keyword">return</span> mapValue; <span class="hljs-comment">// è¿”å›å…¶ä»–çº¿ç¨‹æ’å…¥çš„å€¼ï¼ˆå°±æ˜¯æœ€ç»ˆç¼“å­˜ä¸­çš„å€¼ï¼‰ </span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æ²¡æœ‰å†²çªï¼Œæ­£å¸¸è¿›è¡Œå®¹é‡æ£€æŸ¥</span>
            trimToSize(maxSize);
            <span class="hljs-comment">// è¿”å›åˆ›å»ºçš„å€¼</span>
            <span class="hljs-keyword">return</span> createdValue;
        }
    }
</code></pre>
<p>é€»è¾‘å¾ˆæ¸…æ¥šï¼Œé¦–å…ˆé€šè¿‡LinkedHashMapçš„getæ–¹æ³•é€šè¿‡é”®keyè·å–å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œå¹¶ä¸”<code>ä¸”accessOrder</code>ä¸ºtrueï¼Œæ•´ä¸ªæ–¹æ³•ä¼šå°†å…ƒç´ ç§»åŠ¨åˆ°è¡¨å°¾ï¼Œå®ç°Lruçš„ç¼“å­˜é€»è¾‘ã€‚</p>
<p>å¦‚æœgetæ–¹æ³•è·å–ä¸åˆ°å€¼ï¼Œé‚£ä¹ˆå°±åˆ›å»ºé”®å€¼å¯¹é€šè¿‡LinkedHashMapçš„putæ–¹æ³•å­˜å…¥mapï¼Œå’Œputæ–¹æ³•çš„é€»è¾‘ç±»ä¼¼ï¼Œä¸è¿‡ä¸­é—´ä¼šè¿›è¡Œçº¿ç¨‹å®‰å…¨çš„åˆ¤æ–­ï¼Œä¿è¯ä¸ä¼šé‡å¤æ’å…¥é”®ã€‚</p>
<p>getæ–¹æ³•å›¾ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba74e8e6b9194c1f8c87d364b340010b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371091&amp;x-signature=zYuRdFyBYcTrbDVZAllNq48KEOo%3D" alt="5aa6a6141c2f40c3886c7d6204732a97~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp" loading="lazy"/></p>
<h4 data-id="heading-11">4.3 LruCacheåˆ é™¤ç¼“å­˜æ–¹æ³•åˆ†æï¼š</h4>
<p>LruCacheä¸­åˆ é™¤ç¼“å­˜æ˜¯é€šè¿‡remove()æ–¹æ³•å®ç°çš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"key == null"</span>);
        }
		
    	<span class="hljs-comment">// ä¿å­˜è¢«ç§»é™¤çš„å€¼ </span>
        V previous;
    	<span class="hljs-comment">// ç¡®ä¿çº¿ç¨‹å®‰å…¨åœ°ç§»é™¤æ“ä½œ </span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-comment">// ä»mapä¸­ç§»é™¤ç¼“å­˜</span>
            <span class="hljs-comment">// å¦‚æœå­˜åœ¨keyæ‰€å¯¹åº”åœ°å€¼ï¼Œè¿”å›è¢«ç§»é™¤çš„å€¼</span>
            <span class="hljs-comment">// ä¸å­˜åœ¨å°±è¿”å›null</span>
            previous = map.remove(key);
            <span class="hljs-comment">// æˆåŠŸç§»é™¤äº†ç¼“å­˜</span>
            <span class="hljs-keyword">if</span> (previous != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// æ›´æ–°ç¼“å­˜æ€»å¤§å°</span>
                size -= safeSizeOf(key, previous);
            }
        }
		
    	<span class="hljs-comment">// æˆåŠŸç§»é™¤ç¼“å­˜ï¼Œå›è°ƒentryRemovedæ–¹æ³•è¿›è¡Œèµ„æºå›æ”¶å·¥ä½œ</span>
        <span class="hljs-keyword">if</span> (previous != <span class="hljs-literal">null</span>) {
            entryRemoved(<span class="hljs-literal">false</span>, key, previous, <span class="hljs-literal">null</span>);
        }
		
    	<span class="hljs-comment">// è¿”å›è¢«ç§»é™¤çš„å€¼ï¼Œå¦‚æœé”®ä¸å­˜åœ¨å°±è¿”å›null </span>
        <span class="hljs-keyword">return</span> previous;
    }
</code></pre>
<p>åŒæ ·éå¸¸ç®€å•ï¼Œè°ƒç”¨LinkedHashMapçš„removeæ–¹æ³•åˆ é™¤keyæ‰€å¯¹åº”çš„å€¼ï¼Œä¹Ÿæ˜¯ä½¿ç”¨äº†åŒæ­¥æ–¹æ³•å—æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨</p>
<p>å›¾ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8018cbb315b94a04ba934f57cc31b2ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371091&amp;x-signature=kPQKEqPAB1YpLf%2B8YuTZ18PpuZU%3D" alt="f7c6012cbe3546119f70c48bccded3d3~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.webp" loading="lazy"/></p>
<h3 data-id="heading-12">5. DiskLruCacheçš„æºç å®ç°</h3>
<h4 data-id="heading-13">5.1 DiskLruCacheçš„open()æ–¹æ³•åˆ†æ</h4>
<p>DiskLruCacheçš„ä½¿ç”¨ä»DiskLruCacheçš„åˆ›å»ºå¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ä»openæ–¹æ³•å¼€å§‹ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹openæ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ‰“å¼€æˆ–åˆ›å»ºç£ç›˜LRUç¼“å­˜å®ä¾‹
 * è¿™æ˜¯DiskLruCacheçš„ä¸»å…¥å£æ–¹æ³•ï¼Œè´Ÿè´£ç¼“å­˜çš„åˆå§‹åŒ–ã€æ¢å¤å’Œé‡å»º
 * 
 * <span class="hljs-doctag">@param</span> directory ç¼“å­˜ç›®å½•ï¼Œç¼“å­˜æ–‡ä»¶å°†å­˜å‚¨åœ¨æ­¤ç›®å½•ä¸‹
 * <span class="hljs-doctag">@param</span> appVersion åº”ç”¨ç‰ˆæœ¬å·ï¼Œç”¨äºç‰ˆæœ¬ç®¡ç†ï¼ˆç‰ˆæœ¬å˜æ›´æ—¶ä¼šæ¸…ç©ºç¼“å­˜ï¼‰
 * <span class="hljs-doctag">@param</span> valueCount æ¯ä¸ªç¼“å­˜æ¡ç›®å¯¹åº”çš„æ–‡ä»¶æ•°é‡ï¼ˆé€šå¸¸ä¸º1ï¼‰
 * <span class="hljs-doctag">@param</span> maxSize ç¼“å­˜çš„æœ€å¤§å®¹é‡ï¼ˆå­—èŠ‚ï¼‰
 * <span class="hljs-doctag">@return</span> åˆå§‹åŒ–å¥½çš„DiskLruCacheå®ä¾‹
 * <span class="hljs-doctag">@throws</span> IOException å¦‚æœå‘ç”ŸI/Oé”™è¯¯
 * <span class="hljs-doctag">@throws</span> IllegalArgumentException å¦‚æœå‚æ•°ä¸åˆæ³•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiskLruCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {
    
     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DiskLruCache <span class="hljs-title function_">open</span><span class="hljs-params">(File directory, <span class="hljs-type">int</span> appVersion, <span class="hljs-type">int</span> valueCount, <span class="hljs-type">long</span> maxSize)</span>
          <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (maxSize &lt;= <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"maxSize &lt;= 0"</span>);
        }
        <span class="hljs-keyword">if</span> (valueCount &lt;= <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"valueCount &lt;= 0"</span>);
        }
    
        <span class="hljs-type">File</span> <span class="hljs-variable">backupFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(directory, JOURNAL_FILE_BACKUP);
        <span class="hljs-comment">//å¦‚æœå¤‡ä»½æ–‡ä»¶å­˜åœ¨</span>
        <span class="hljs-keyword">if</span> (backupFile.exists()) {
          <span class="hljs-type">File</span> <span class="hljs-variable">journalFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(directory, JOURNAL_FILE);
          <span class="hljs-comment">// å¦‚æœjournalæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æŠŠå¤‡ä»½æ–‡ä»¶journal.bkpæ˜¯åˆ äº†</span>
          <span class="hljs-keyword">if</span> (journalFile.exists()) {
            backupFile.delete();
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//å¦‚æœjournalæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™å°†å¤‡ä»½æ–‡ä»¶å‘½åä¸ºjournal</span>
            renameTo(backupFile, journalFile, <span class="hljs-literal">false</span>);
          }
        }
    	<span class="hljs-comment">// å°è¯•ä»ç°æœ‰ç¼“å­˜æ¢å¤ï¼šä¼˜å…ˆå¤ç”¨å·²æœ‰çš„ç¼“å­˜æ•°æ®</span>
        <span class="hljs-type">DiskLruCache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiskLruCache</span>(directory, appVersion, valueCount, maxSize);
        
        <span class="hljs-comment">//åˆ¤æ–­journalæ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-keyword">if</span> (cache.journalFile.exists()) {
          <span class="hljs-comment">//å¦‚æœæ—¥å¿—æ–‡ä»¶ä»¥åŠå­˜åœ¨</span>
          <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ¢å¤ç°æœ‰ç¼“å­˜çš„ä¸‰æ­¥æµç¨‹ï¼š</span>
            <span class="hljs-comment">// 1. readJournal(): è¯»å–æ—¥å¿—æ–‡ä»¶å†…å®¹åˆ°å†…å­˜</span>
            cache.readJournal();
            <span class="hljs-comment">// 2. processJournal(): å¤„ç†æ—¥å¿—æ¡ç›®ï¼Œé‡å»ºç¼“å­˜çŠ¶æ€</span>
            cache.processJournal();
            <span class="hljs-comment">// 3. åˆ›å»ºè¿½åŠ æ¨¡å¼çš„æ—¥å¿—å†™å…¥å™¨ï¼Œç”¨äºåç»­æ“ä½œ</span>
            cache.journalWriter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedWriter</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(cache.journalFile, <span class="hljs-literal">true</span>), Util.US_ASCII));
            <span class="hljs-keyword">return</span> cache;
          } <span class="hljs-keyword">catch</span> (IOException journalIsCorrupt) {
            System.out
                .println(<span class="hljs-string">"DiskLruCache "</span>
                    + directory
                    + <span class="hljs-string">" is corrupt: "</span>
                    + journalIsCorrupt.getMessage()
                    + <span class="hljs-string">", removing"</span>);
            cache.delete();
          }
        }
    
        <span class="hljs-comment">// Create a new empty cache.</span>
        <span class="hljs-comment">//åˆ›å»ºæ–°çš„ç¼“å­˜ç›®å½•</span>
        directory.mkdirs();
        cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiskLruCache</span>(directory, appVersion, valueCount, maxSize);
        <span class="hljs-comment">//è°ƒç”¨æ–°çš„æ–¹æ³•å»ºç«‹æ–°çš„journalæ–‡ä»¶</span>
        cache.rebuildJournal();
        <span class="hljs-keyword">return</span> cache;
      }
}

</code></pre>
<p>DiskLruCacheçš„æ„é€ æ–¹æ³•å¹¶æ²¡æœ‰åšåˆ«çš„äº‹æƒ…ï¼Œåªæ˜¯ç®€å•çš„å°†å¯¹åº”æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œopen()æ–¹æ³•ä¸»è¦å›´ç»•ç€journalæ–‡ä»¶çš„åˆ›å»ºä¸è¯»å†™è€Œå±•å¼€çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>readJournal()ï¼šè¯»å–journalæ–‡ä»¶ï¼Œä¸»è¦æ˜¯è¯»å–æ–‡ä»¶å¤´é‡Œçš„ä¿¡æ¯è¿›è¡Œæ£€éªŒï¼Œç„¶åè°ƒç”¨readJournalLine()é€è¡Œå»è¯»å–ï¼Œæ ¹æ®è¯»å–çš„å†…å®¹ï¼Œæ‰§è¡Œç›¸åº”çš„ç¼“å­˜ æ·»åŠ ã€ç§»é™¤ç­‰æ“ä½œã€‚</li>
<li>rebuildJournal()ï¼šé‡å»ºjournalæ–‡ä»¶ï¼Œé‡å»ºjournalæ–‡ä»¶ä¸»è¦æ˜¯å†™å…¥æ–‡ä»¶å¤´ï¼ˆä¸Šé¢æåˆ°çš„journalæ–‡ä»¶éƒ½æœ‰çš„å‰é¢äº”è¡Œçš„å†…å®¹ï¼‰ã€‚</li>
<li>rocessJournal()ï¼šè®¡ç®—å½“å‰ç¼“å­˜å®¹é‡çš„å¤§å°ã€‚</li>
</ul>
<p>è‡³äºjournalæ–‡ä»¶ï¼Œåˆ™æ˜¯ä¸€ä¸ª<strong>æ—¥å¿—æ–‡ä»¶</strong>ï¼Œä¸»è¦ç”¨äºè®°å½•ç¼“å­˜çš„æ‰€æœ‰æ“ä½œå’ŒçŠ¶æ€ã€‚è¿™é‡Œå…³äºjournalæ–‡ä»¶çš„åˆ›å»ºå’Œè¯»å†™æµç¨‹å°±ä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹å®ƒçš„å…·ä½“åŸç†ã€‚æ¥ä¸‹æ¥ä¸»è¦å›´ç»•DiskLruCacheçš„å†™å…¥ï¼ŒæŸ¥æ‰¾ä»¥åŠåˆ é™¤ç¼“å­˜æ¥ä»‹ç»ã€‚</p>
<h4 data-id="heading-14">5.2 DiskLruCacheçš„edit()æ–¹æ³•åˆ†æï¼š</h4>
<p>DiskLruCacheç¼“å­˜çš„å†™å…¥æ˜¯é€šè¿‡edit()æ–¹æ³•æ¥å®Œæˆçš„ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">synchronized</span> Editor <span class="hljs-title function_">edit</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> expectedSequenceNumber)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// æ£€æŸ¥DiskLruCacheæ˜¯å¦å·²å…³é—­ï¼Œå…³é—­åˆ™æŠ›å‡ºå¼‚å¸¸</span>
    checkNotClosed();
    <span class="hljs-comment">// éªŒè¯é”®çš„æœ‰æ•ˆæ€§ï¼ˆé€šå¸¸æ£€æŸ¥æ˜¯å¦åŒ…å«ç©ºæ ¼ç­‰éæ³•å­—ç¬¦ï¼‰</span>
    validateKey(key);
    <span class="hljs-comment">// ä»ä¹‹å‰çš„ç¼“å­˜ä¸­è¯»å–å¯¹åº”çš„entry</span>
    <span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> lruEntries.get(key);
    <span class="hljs-comment">// æ— æ³•ä¿®æ”¹</span>
    <span class="hljs-keyword">if</span> (expectedSequenceNumber != ANY_SEQUENCE_NUMBER &amp;&amp; (entry == <span class="hljs-literal">null</span>
        || entry.sequenceNumber != expectedSequenceNumber)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// Snapshot is stale.</span>
    }
    <span class="hljs-comment">// keyæ‰€å¯¹åº”çš„ç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„é”®å€¼å¯¹å¹¶å­˜å…¥LinkedHashMapä¸­</span>
    <span class="hljs-keyword">if</span> (entry == <span class="hljs-literal">null</span>) {
      entry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(key);
      lruEntries.put(key, entry);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (entry.currentEditor != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// å¦‚æœå½“å‰ç¼“å­˜æ­£åœ¨è¢«å…¶ä»–Editorç¼–è¾‘ï¼Œæ‹’ç»å¹¶å‘ç¼–è¾‘</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// Another edit is in progress.</span>
    }
	
    <span class="hljs-comment">// åˆ›å»ºæ–°çš„Editorå®ä¾‹ï¼Œä¸ç¼“å­˜ç›¸å…³è”</span>
    <span class="hljs-type">Editor</span> <span class="hljs-variable">editor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Editor</span>(entry);
    entry.currentEditor = editor; <span class="hljs-comment">// å½“å‰ç¼“å­˜ä¸ºç¼–è¾‘çŠ¶æ€</span>

    <span class="hljs-comment">// Flush the journal before creating files to prevent file leaks.</span>
    <span class="hljs-comment">// å†™å…¥DIRTYè®°å½•è¡¨ç¤ºå¼€å§‹ç¼–è¾‘æ“ä½œ</span>
    journalWriter.write(DIRTY + <span class="hljs-string">' '</span> + key + <span class="hljs-string">'\n'</span>);
    journalWriter.flush(); <span class="hljs-comment">// å¼ºåˆ¶åˆ·æ–°åˆ°ç£ç›˜ï¼Œç¡®ä¿æ—¥å¿—æŒä¹…åŒ–</span>
    <span class="hljs-comment">// è¿”å›Editorå®ä¾‹ä»¥ä¾›åç»­ç¼–è¾‘ä½¿ç”¨</span>
    <span class="hljs-keyword">return</span> editor;
  }
</code></pre>
<p>è‡³äºDIRTYï¼ŒDIRTYæ˜¯DiskLruCacheçš„ä¸€ç§çŠ¶æ€æ ‡è®°ã€‚å‘æ—¥å¿—æ–‡ä»¶ä¸­å†™å…¥<strong>DIRTY</strong> ï¼Œåˆ™è¡¨ç¤ºå½“å‰ç¼“å­˜æ¡ç›®æ­£åœ¨è¢«ç¼–è¾‘ä½†å°šæœªå®Œæˆã€‚</p>
<p>ä¸€èˆ¬æ ¼å¼ä¸ºDIRTY + ç©ºæ ¼+keyï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">DIRTY key123  <span class="hljs-comment"># è¡¨ç¤º key123 è¿™ä¸ªæ¡ç›®æ­£åœ¨è¢«ä¿®æ”¹</span>
</code></pre>
<p>ä¸€èˆ¬æ¥è¯´DIRTY è®°å½•ä¸ CLEAN/REMOVE è®°å½•æˆå¯¹å‡ºç°ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„æ“ä½œå•å…ƒï¼š</p>
<p><strong>æ­£å¸¸å®Œæˆ</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">DIRTY key123    â† è¡¨ç¤ºç¼“å­˜æ¡ç›®å¼€å§‹ç¼–è¾‘
...ï¼ˆæ–‡ä»¶æ“ä½œï¼‰...
<span class="hljs-built_in">CLEAN</span> key123    â† è¡¨ç¤ºç¼“å­˜æ¡ç›®ç¼–è¾‘æˆåŠŸå®Œæˆ
</code></pre>
<p><strong>å¼‚å¸¸ç»ˆæ­¢</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">DIRTY key123    â† è¡¨ç¤ºç¼“å­˜æ¡ç›®å¼€å§‹ç¼–è¾‘
...ï¼ˆç¨‹åºå´©æºƒï¼‰...
<span class="hljs-code">                â† ç¼ºå°‘ CLEANï¼Œè¡¨ç¤ºæ“ä½œæœªå®Œæˆ
</span></code></pre>
<p>è€ŒlruEntriesåˆ™æ˜¯ä¸€ä¸ªLinkedHashMapå¯¹è±¡ï¼Œè¡¨ç¤ºå®é™…çš„ç¼“å­˜æ¡ç›®è¡¨ï¼Œè´Ÿè´£å®é™…çš„ç¼“å­˜å­˜å‚¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/225986e2b63c4004a945ec8f93ed2afd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763371091&amp;x-signature=%2BDYQfA3sNPymrns1ChjwKnHppWg%3D" alt="å±å¹•æˆªå›¾ 2025-11-10 161856.png" loading="lazy"/></p>
<p>edit()æ–¹æ³•ä¸»è¦å°±æ˜¯æ„å»ºäº†ä¸€ä¸ªEditorå¯¹è±¡ï¼Œå®ƒä¸»è¦å¹²äº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>ä»é›†åˆä¸­æ‰¾åˆ°å¯¹åº”çš„å®ä¾‹ï¼ˆå¦‚æœæ²¡æœ‰åˆ›å»ºä¸€ä¸ªæ”¾åˆ°é›†åˆä¸­ï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªeditorï¼Œå°†editorå’Œentryå…³è”èµ·æ¥ã€‚</li>
<li>å‘journalä¸­å†™å…¥ä¸€è¡Œæ“ä½œæ•°æ®ï¼ˆDITTY ç©ºæ ¼ å’Œkeyæ‹¼æ¥çš„æ–‡å­—ï¼‰ï¼Œè¡¨ç¤ºè¿™ä¸ªkeyå½“å‰æ­£å¤„äºç¼–è¾‘çŠ¶æ€ã€‚</li>
</ol>
<p>åœ¨å‰é¢ä½¿ç”¨DiskLruCacheçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†Editorçš„newOutputStream()æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªOutputStreamæ¥å†™å…¥ç¼“å­˜æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è·å–ç¼“å­˜æ¡ç›®æŒ‡å®šç´¢å¼•å€¼æ–‡ä»¶çš„è¾“å…¥æµ
 * ç”¨äºè¯»å–ç¼“å­˜æ•°æ®ï¼Œé€šå¸¸åœ¨Snapshotå¯¹è±¡ä¸­ä½¿ç”¨
 * 
 * <span class="hljs-doctag">@param</span> index å€¼æ–‡ä»¶çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼Œå°äºvalueCountï¼‰
 * <span class="hljs-doctag">@return</span> æ–‡ä»¶çš„è¾“å…¥æµï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¿”å›null
 * <span class="hljs-doctag">@throws</span> IOException å¦‚æœå‘ç”ŸI/Oé”™è¯¯
 * <span class="hljs-doctag">@throws</span> IllegalStateException å¦‚æœSnapshotå·²å…³é—­æˆ–æ— æ•ˆ
 */</span>
<span class="hljs-keyword">public</span> InputStream <span class="hljs-title function_">newInputStream</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> <span class="hljs-keyword">throws</span> IOException {
      <span class="hljs-keyword">synchronized</span> (DiskLruCache.<span class="hljs-built_in">this</span>) {
        <span class="hljs-comment">// ç¡®ä¿å½“å‰Editorä»ç„¶æœ‰æ•ˆ</span>
        <span class="hljs-keyword">if</span> (entry.currentEditor != <span class="hljs-built_in">this</span>) {
          <span class="hljs-comment">// ä¸¤ç§æƒ…å†µï¼š</span>
          <span class="hljs-comment">// 1. Snapshotå·²è¢«å…³é—­</span>
          <span class="hljs-comment">// 2. æˆ–è€…æ¡ç›®å·²è¢«æ–°çš„Editorå ç”¨</span>
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>();
        }
          
        <span class="hljs-comment">// æ£€æŸ¥æ¡ç›®æ˜¯å¦å¯è¯»ï¼šentry.readableä¸ºtrueè¡¨ç¤ºæ¡ç›®å¤„äºCLEANçŠ¶æ€</span>
        <span class="hljs-comment">// å¦‚æœä¸ºfalseï¼Œè¯´æ˜æ¡ç›®å¯èƒ½æ­£åœ¨ç¼–è¾‘æˆ–å·²è¢«ç§»é™¤</span>
        <span class="hljs-keyword">if</span> (!entry.readable) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// entry.getCleanFile(index) è·å–æŒ‡å®šç´¢å¼•çš„ç¼“å­˜æ•°æ®æ–‡ä»¶</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(entry.getCleanFile(index));
        } <span class="hljs-keyword">catch</span> (FileNotFoundException e) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
      }
    }
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•çš„å½¢å‚indexå°±æ˜¯æˆ‘ä»¬å¼€å§‹åœ¨open()æ–¹æ³•é‡Œä¼ å…¥çš„valueCountï¼Œè¿™ä¸ªvalueCountè¡¨ç¤ºäº†ä¸€ä¸ªkeyå¯¹åº”å‡ ä¸ªvalue,ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªkeyå¯¹åº”å‡ ä¸ªç¼“å­˜æ–‡ä»¶ã€‚é‚£ä¹ˆç°åœ¨ä¼ å…¥çš„è¿™ä¸ªindexå°±è¡¨ç¤º è¦ç¼“å­˜çš„æ–‡ä»¶æ—¶å¯¹åº”çš„ç¬¬å‡ ä¸ªvalueã€‚</p>
<p>æœ‰äº†è¾“å‡ºæµï¼Œæˆ‘ä»¬åœ¨æ¥ç€è°ƒç”¨Editorçš„commit()æ–¹æ³•å°±å¯ä»¥å®Œæˆç¼“å­˜æ–‡ä»¶çš„å†™å…¥äº†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
      <span class="hljs-keyword">if</span> (hasErrors) {
      	<span class="hljs-comment">// å¦‚æœå†™å…¥ç¼“å­˜å‡ºé”™å°±æŠŠé›†åˆä¸­çš„ç¼“å­˜æ¡ç›®ç§»é™¤æ‰</span>
        completeEdit(<span class="hljs-built_in">this</span>, <span class="hljs-literal">false</span>);
        remove(entry.key); <span class="hljs-comment">// The previous entry is stale.</span>
      } <span class="hljs-keyword">else</span> {
      	<span class="hljs-comment">// ç¼–è¾‘æˆåŠŸåˆ™æäº¤æ›´æ”¹</span>
        completeEdit(<span class="hljs-built_in">this</span>, <span class="hljs-literal">true</span>);
      }
      <span class="hljs-comment">// æ ‡è®°æœ¬æ¬¡ç¼–è¾‘å·²æäº¤ï¼Œé˜²æ­¢é‡å¤æäº¤</span>
      committed = <span class="hljs-literal">true</span>;
    }
</code></pre>
<p>é€šè¿‡completeEditæ–¹æ³•æ¥å®Œæˆæœ€ç»ˆçš„ç¼“å­˜å†™å…¥ï¼ŒcompleteEditæ–¹æ³•è´Ÿè´£å¤„ç†ç¼–è¾‘çš„æäº¤æˆ–ä¸­æ­¢ã€‚å½“ç¼–è¾‘æˆåŠŸæ—¶ï¼Œå®ƒå°†ç¼–è¾‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶å·¥ä½œæ–‡ä»¶è½¬æ¢ä¸ºæœ€ç»ˆçš„ç¼“å­˜æ•°æ®æ–‡ä»¶ï¼Œæ›´æ–°ç¼“å­˜å¤§å°ç»Ÿè®¡ï¼Œå¹¶åœ¨æ—¥å¿—ä¸­å†™å…¥ CLEAN è®°å½•ï¼›å½“ç¼–è¾‘å¤±è´¥æ—¶ï¼Œåˆ™åˆ é™¤ä¸´æ—¶æ–‡ä»¶è¿›è¡Œæ“ä½œæ’¤é”€ã€‚
è‡³æ­¤ï¼Œç¼“å­˜çš„æ’å…¥å°±å®Œæˆäº†ã€‚</p>
<h4 data-id="heading-15">3.3 è¯»å–ç¼“å­˜</h4>
<p>è¯»å–ç¼“å­˜æ˜¯ç”±DiskLruCacheçš„get()æ–¹æ³•æ¥å®Œæˆçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiskLruCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {
    
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Snapshot <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> <span class="hljs-keyword">throws</span> IOException {
        checkNotClosed();
        validateKey(key);
        <span class="hljs-comment">// è·å–keyå¯¹åº”çš„entry</span>
        <span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> lruEntries.get(key);
        <span class="hljs-keyword">if</span> (entry == <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    
        <span class="hljs-comment">// å¦‚æœentryä¸å¯è¯»ï¼Œè¯´æ˜å¯èƒ½åœ¨ç¼–è¾‘ï¼Œåˆ™è¿”å›ç©ºã€‚</span>
        <span class="hljs-keyword">if</span> (!entry.readable) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    
        <span class="hljs-comment">// æ‰“å¼€æ‰€æœ‰ç¼“å­˜æ–‡ä»¶çš„è¾“å…¥æµï¼Œç­‰å¾…è¢«è¯»å–ã€‚</span>
        InputStream[] ins = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStream</span>[valueCount];
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// ä¸ºæ¯ä¸ªå€¼æ–‡ä»¶åˆ›å»ºè¾“å…¥æµ</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; valueCount; i++) {
            <span class="hljs-comment">// è·å–æ­£å¼ç¼“å­˜æ–‡ä»¶ï¼ˆéä¸´æ—¶æ–‡ä»¶ï¼‰çš„è¾“å…¥æµ</span>
            ins[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(entry.getCleanFile(i));
          }
        } <span class="hljs-keyword">catch</span> (FileNotFoundException e) {
          <span class="hljs-comment">// A file must have been deleted manually!</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; valueCount; i++) {
            <span class="hljs-keyword">if</span> (ins[i] != <span class="hljs-literal">null</span>) {
              Util.closeQuietly(ins[i]);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">break</span>;
            }
          }
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    	<span class="hljs-comment">// å¢åŠ å†—ä½™æ“ä½œè®¡æ•°</span>
        redundantOpCount++;
        <span class="hljs-comment">// å‘journalå†™å…¥ä¸€è¡ŒREADå¼€å¤´çš„è®°å½•ï¼Œè¡¨ç¤ºæ‰§è¡Œäº†ä¸€æ¬¡è¯»å–æ“ä½œ</span>
        journalWriter.append(READ + <span class="hljs-string">' '</span> + key + <span class="hljs-string">'\n'</span>);
        
         
        <span class="hljs-comment">// å¦‚æœç¼“å­˜æ€»å¤§å°å·²ç»è¶…è¿‡äº†è®¾å®šçš„æœ€å¤§ç¼“å­˜å¤§å°æˆ–è€…æ“ä½œæ¬¡æ•°è¶…è¿‡äº†2000æ¬¡ï¼Œå°±å¼€ä¸€ä¸ªçº¿ç¨‹å°†é›†åˆä¸­çš„æ•°æ®åˆ é™¤åˆ°å°äºæœ€å¤§ç¼“å­˜å¤§å°ä¸ºæ­¢å¹¶é‡æ–°å†™journalæ–‡ä»¶</span>
        <span class="hljs-keyword">if</span> (journalRebuildRequired()) {
          executorService.submit(cleanupCallable);
        }
        
        <span class="hljs-comment">// è¿”å›ä¸€ä¸ªç¼“å­˜æ–‡ä»¶å¿«ç…§ï¼ŒåŒ…å«ç¼“å­˜æ–‡ä»¶å¤§å°ï¼Œè¾“å…¥æµç­‰ä¿¡æ¯ã€‚</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Snapshot</span>(key, entry.sequenceNumber, ins, entry.lengths);
      }
}
</code></pre>
<p>è¯»å–æ“ä½œä¸»è¦å®Œæˆäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>è·å–å¯¹åº”çš„entryã€‚</li>
<li>æ‰“å¼€æ‰€æœ‰ç¼“å­˜æ–‡ä»¶çš„è¾“å…¥æµï¼Œç­‰å¾…è¢«è¯»å–ã€‚</li>
<li>å‘journalå†™å…¥ä¸€è¡ŒREADå¼€å¤´çš„è®°å½•ï¼Œè¡¨ç¤ºæ‰§è¡Œäº†ä¸€æ¬¡è¯»å–æ“ä½œã€‚</li>
<li>å¦‚æœç¼“å­˜æ€»å¤§å°å·²ç»è¶…è¿‡äº†è®¾å®šçš„æœ€å¤§ç¼“å­˜å¤§å°æˆ–è€…æ“ä½œæ¬¡æ•°è¶…è¿‡äº†2000æ¬¡ï¼Œå°±å¼€ä¸€ä¸ªçº¿ç¨‹å°†é›†åˆä¸­çš„æ•°æ®åˆ é™¤åˆ°å°äºæœ€å¤§ç¼“å­˜å¤§å°ä¸ºæ­¢å¹¶é‡æ–°å†™journalæ–‡ä»¶ã€‚</li>
<li>è¿”å›ä¸€ä¸ªç¼“å­˜æ–‡ä»¶å¿«ç…§ï¼ŒåŒ…å«ç¼“å­˜æ–‡ä»¶å¤§å°ï¼Œè¾“å…¥æµç­‰ä¿¡æ¯ã€‚</li>
</ol>
<p>è¯¥æ–¹æ³•æœ€ç»ˆè¿”å›ä¸€ä¸ªç¼“å­˜æ–‡ä»¶å¿«ç…§ï¼ŒåŒ…å«ç¼“å­˜æ–‡ä»¶å¤§å°ï¼Œè¾“å…¥æµç­‰ä¿¡æ¯ã€‚åˆ©ç”¨è¿™ä¸ªå¿«ç…§æˆ‘ä»¬å°±å¯ä»¥è¯»å–ç¼“å­˜æ–‡ä»¶äº†ã€‚</p>
<h4 data-id="heading-16">3.4 åˆ é™¤ç¼“å­˜</h4>
<p>åˆ é™¤ç¼“å­˜æ˜¯ç”±DiskLruCacheçš„remove()æ–¹æ³•æ¥å®Œæˆçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiskLruCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {
    
      <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(String key)</span> <span class="hljs-keyword">throws</span> IOException {
        checkNotClosed();
        validateKey(key);
        <span class="hljs-comment">// è·å–å¯¹åº”çš„entry</span>
        <span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> lruEntries.get(key);
        <span class="hljs-keyword">if</span> (entry == <span class="hljs-literal">null</span> || entry.currentEditor != <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    
        <span class="hljs-comment">// åˆ é™¤å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶ï¼Œå¹¶å°†ç¼“å­˜å¤§å°ç½®ä¸º0.</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; valueCount; i++) {
          <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> entry.getCleanFile(i);
          <span class="hljs-keyword">if</span> (file.exists() &amp;&amp; !file.delete()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"failed to delete "</span> + file);
          }
          size -= entry.lengths[i];
          entry.lengths[i] = <span class="hljs-number">0</span>;
        }
    
        redundantOpCount++;
        <span class="hljs-comment">// å‘journalæ–‡ä»¶æ·»åŠ ä¸€è¡ŒREMOVEå¼€å¤´çš„è®°å½•ï¼Œè¡¨ç¤ºæ‰§è¡Œäº†ä¸€æ¬¡åˆ é™¤æ“ä½œã€‚</span>
        journalWriter.append(REMOVE + <span class="hljs-string">' '</span> + key + <span class="hljs-string">'\n'</span>);
        lruEntries.remove(key);
    
    
        <span class="hljs-comment">// å¦‚æœç¼“å­˜æ€»å¤§å°å·²ç»è¶…è¿‡äº†è®¾å®šçš„æœ€å¤§ç¼“å­˜å¤§å°æˆ–è€…æ“ä½œæ¬¡æ•°è¶…è¿‡äº†2000æ¬¡ï¼Œå°±å¼€ä¸€ä¸ªçº¿ç¨‹å°†é›†åˆä¸­çš„æ•°æ®åˆ é™¤åˆ°å°äºæœ€å¤§ç¼“å­˜å¤§å°ä¸ºæ­¢å¹¶é‡æ–°å†™journalæ–‡ä»¶</span>
        <span class="hljs-keyword">if</span> (journalRebuildRequired()) {
          executorService.submit(cleanupCallable);
        }
    
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }   
}
</code></pre>
<p>åˆ é™¤æ“ä½œä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>è·å–å¯¹åº”çš„entryã€‚</li>
<li>åˆ é™¤å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶ï¼Œå¹¶å°†ç¼“å­˜å¤§å°ç½®ä¸º0.</li>
<li>å‘journalæ–‡ä»¶æ·»åŠ ä¸€è¡ŒREMOVEå¼€å¤´çš„è®°å½•ï¼Œè¡¨ç¤ºæ‰§è¡Œäº†ä¸€æ¬¡åˆ é™¤æ“ä½œã€‚</li>
<li>å¦‚æœç¼“å­˜æ€»å¤§å°å·²ç»è¶…è¿‡äº†è®¾å®šçš„æœ€å¤§ç¼“å­˜å¤§å°æˆ–è€…æ“ä½œæ¬¡æ•°è¶…è¿‡äº†2000æ¬¡ï¼Œå°±å¼€ä¸€ä¸ªçº¿ç¨‹å°†é›†åˆä¸­çš„æ•°æ®åˆ é™¤åˆ°å°äºæœ€å¤§ç¼“å­˜å¤§å°ä¸ºæ­¢å¹¶é‡æ–°å†™journalæ–‡ä»¶ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä» RAG åˆ° CAGï¼šAI æ­£åœ¨è¶…è¶Šâ€œæ£€ç´¢â€ï¼Œå­¦ä¼šâ€œèä¼šè´¯é€šâ€ï¼]]></title>    <link>https://juejin.cn/post/7570295366481330212</link>    <guid>https://juejin.cn/post/7570295366481330212</guid>    <pubDate>2025-11-10T08:12:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570295366481330212" data-draft-id="7570598043298152511" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä» RAG åˆ° CAGï¼šAI æ­£åœ¨è¶…è¶Šâ€œæ£€ç´¢â€ï¼Œå­¦ä¼šâ€œèä¼šè´¯é€šâ€ï¼"/> <meta itemprop="keywords" content="LLM,ç¨‹åºå‘˜,Agent"/> <meta itemprop="datePublished" content="2025-11-10T08:12:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä» RAG åˆ° CAGï¼šAI æ­£åœ¨è¶…è¶Šâ€œæ£€ç´¢â€ï¼Œå­¦ä¼šâ€œèä¼šè´¯é€šâ€ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:12:03.000Z" title="Mon Nov 10 2025 08:12:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>å¤§å‹è¯­è¨€æ¨¡å‹ (LLM) æ— ç–‘æ˜¯å½“ä»Šç§‘æŠ€é¢†åŸŸæœ€è€€çœ¼çš„æ˜æ˜Ÿã€‚å®ƒä»¬å¼ºå¤§çš„è‡ªç„¶è¯­è¨€å¤„ç†å’Œå†…å®¹ç”Ÿæˆèƒ½åŠ›ï¼Œæ­£åœ¨é‡å¡‘ä»æœç´¢åˆ°åˆ›æ„å·¥ä½œçš„å‡ ä¹æ‰€æœ‰è¡Œä¸šã€‚ç„¶è€Œï¼Œå¦‚åŒå¸Œè…Šç¥è¯ä¸­çš„é˜¿å–€ç‰æ–¯ï¼Œè¿™äº›å¼ºå¤§çš„æ¨¡å‹ä¹Ÿæœ‰å…¶â€œé˜¿å–€ç‰æ–¯ä¹‹è¸µâ€â€”â€”å®ƒä»¬å›ºæœ‰çš„ä¸¤å¤§ç¼ºé™·ï¼š</p>
<ul>
<li><strong>çŸ¥è¯†â€œå¹»è§‰â€ (Hallucination):</strong> Â å®ƒä»¬æœ‰æ—¶ä¼šè‡ªä¿¡åœ°ç¼–é€ å‡ºé”™è¯¯æˆ–ä¸å­˜åœ¨çš„ä¿¡æ¯ã€‚</li>
<li><strong>çŸ¥è¯†â€œé™ˆæ—§â€ (Outdatedness):</strong> Â å®ƒä»¬å¯¹ä¸–ç•Œçš„è®¤çŸ¥è¢«â€œå†»ç»“â€åœ¨è®­ç»ƒæ•°æ®æˆªæ­¢çš„é‚£ä¸€åˆ»ï¼Œæ— æ³•è·çŸ¥ä»»ä½•æ–°å‘ç”Ÿçš„äº‹ä»¶æˆ–ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4988cce23dc41e081648de1c5799a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367123&amp;x-signature=rgMCO29fhbRFRokQ7bTtL1C55lw%3D" alt="" loading="lazy"/></p>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œ <strong>â€œå¢å¼ºç”Ÿæˆâ€ (Augmented Generation)</strong> Â æŠ€æœ¯åº”è¿è€Œç”Ÿã€‚åœ¨è¿™ä¸€é¢†åŸŸä¸­ï¼Œ<strong>RAG (Retrieval-Augmented Generation)</strong> Â å·²æˆä¸ºè¡Œä¸šæ ‡é…ï¼Œè€ŒÂ <strong>CAG (Context-Augmented Generation)</strong> Â åˆ™ä»£è¡¨äº†ä¸€ä¸ªæ›´æ·±å…¥ã€æ›´æ™ºèƒ½çš„æ¼”è¿›æ–¹å‘ã€‚</p>
<h2 data-id="heading-0">RAG (Retrieval-Augmented Generation)</h2>
<p>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ˜¯ç›®å‰è§£å†³ LLM ç¼ºé™·æœ€æœ‰æ•ˆå’Œæœ€ä¸»æµçš„æ¶æ„ã€‚å…¶æ ¸å¿ƒæ€æƒ³éå¸¸ç›´è§‚ï¼š<strong>ä¸å…¶å¼ºè¿«æ¨¡å‹â€œèƒŒè¯µâ€å…¨ä¸–ç•Œçš„çŸ¥è¯†ï¼Œä¸å¦‚è®©å®ƒå­¦ä¼šâ€œæŸ¥èµ„æ–™â€</strong> ã€‚</p>
<p>RAG å°±åƒæ˜¯ç»™äº† AI ä¸€å¥—æœ€æ–°çš„å‚è€ƒä¹¦ï¼ˆçŸ¥è¯†åº“ï¼‰ï¼Œå¹¶å…è®¸å®ƒåœ¨å›ç­”é—®é¢˜å‰è¿›è¡Œâ€œå¼€å·è€ƒè¯•â€ã€‚</p>
<p><strong>RAG çš„æ ‡å‡†å·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li><strong>æ¥æ”¶æŸ¥è¯¢ï¼š</strong> Â ç”¨æˆ·æå‡ºä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚â€œ2024å¹´è¯ºè´å°”ç‰©ç†å­¦å¥–å¾—ä¸»æ˜¯è°ï¼Ÿâ€</li>
<li><strong>æ£€ç´¢ (Retrieve):</strong> Â ç³»ç»Ÿé¦–å…ˆå°†æŸ¥è¯¢â€œç¼–ç â€æˆå‘é‡ï¼Œç„¶ååœ¨ä¸€ä¸ªåºå¤§çš„ã€å®æ—¶æ›´æ–°çš„â€œçŸ¥è¯†åº“â€ï¼ˆé€šå¸¸æ˜¯å‘é‡æ•°æ®åº“ï¼ŒåŒ…å«äº†æœ€æ–°æ–°é—»ã€æ–‡æ¡£ã€ç½‘é¡µç­‰ï¼‰ä¸­æœç´¢æœ€ç›¸å…³çš„ä¿¡æ¯ç‰‡æ®µã€‚</li>
<li><strong>å¢å¼º (Augment):</strong> Â ç³»ç»Ÿå°†æ£€ç´¢åˆ°çš„ç›¸å…³èµ„æ–™ï¼ˆä¾‹å¦‚ï¼Œå…³äºè¯ºå¥–å¾—ä¸»çš„æœ€æ–°æŠ¥é“ï¼‰ä¸ç”¨æˆ·çš„åŸå§‹é—®é¢˜â€œæ‹¼æ¥â€åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„â€œå¢å¼ºæç¤ºè¯â€ã€‚</li>
<li><strong>ç”Ÿæˆ (Generate):</strong> Â LLM æœ€ç»ˆçœ‹åˆ°çš„ä¸æ˜¯ä¸€ä¸ªå®ƒæ— æ³•å›ç­”çš„â€œè¿‡æ—¶â€é—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…å«äº†ç­”æ¡ˆçš„é˜…è¯»ç†è§£é¢˜ã€‚å®ƒä¼šåŸºäºæ£€ç´¢åˆ°çš„â€œäº‹å®â€ææ–™ï¼Œç”Ÿæˆä¸€ä¸ªå‡†ç¡®ã€æ—¶æ•ˆæ€§å¼ºçš„ç­”æ¡ˆã€‚</li>
</ol>
<p><strong>RAG çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</strong></p>
<ul>
<li><strong>é«˜äº‹å®æ€§ï¼š</strong> Â å¤§å¹…å‡å°‘å¹»è§‰ï¼Œå› ä¸ºç­”æ¡ˆæ˜¯åŸºäºæ£€ç´¢åˆ°çš„å…·ä½“æ–‡æœ¬ç”Ÿæˆçš„ã€‚</li>
<li><strong>æ—¶æ•ˆæ€§ï¼š</strong> Â åªéœ€æ›´æ–°çŸ¥è¯†åº“ï¼ˆè¿™æ¯”é‡æ–°è®­ç»ƒæ¨¡å‹ä¾¿å®œå¾—å¤šï¼‰ï¼ŒAI å°±èƒ½â€œçŸ¥é“â€æœ€æ–°ä¿¡æ¯ã€‚</li>
<li><strong>å¯è§£é‡Šæ€§ï¼š</strong> Â å¯ä»¥å¼•ç”¨æ£€ç´¢åˆ°çš„æ¥æºï¼Œè®©ç­”æ¡ˆçš„â€œå‡ºå¤„â€é€æ˜å¯æŸ¥ã€‚</li>
</ul>
<h2 data-id="heading-1">CAG (Context-Augmented Generation)</h2>
<p>RAG æå…¶å¼ºå¤§ï¼Œä½†å®ƒåœ¨æœ¬è´¨ä¸Šä»æ˜¯ä¸€ç§â€œå³æ—¶ååº”å¼â€çš„æ£€ç´¢ã€‚å®ƒæ“…é•¿å›ç­”â€œæ˜¯ä»€ä¹ˆâ€ç±»å‹çš„äº‹å®é—®é¢˜ï¼Œä½†åœ¨å¤„ç†éœ€è¦æ·±åº¦ç†è§£ã€é•¿æœŸè®°å¿†æˆ–ä¸“ä¸šé¢†åŸŸä¸€è‡´æ€§çš„å¤æ‚å¯¹è¯æ—¶ï¼Œå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚</p>
<p>è¿™å°±æ˜¯Â <strong>CAGï¼ˆä¸Šä¸‹æ–‡å¢å¼ºç”Ÿæˆï¼‰</strong> Â ç™»åœºçš„å¥‘æœºã€‚CAG ä¸ä»…ä»…æ˜¯â€œæ£€ç´¢â€ï¼Œå®ƒè¿½æ±‚çš„æ˜¯â€œä¸Šä¸‹æ–‡çš„æ·±åº¦ç®¡ç†ä¸ç»´æŠ¤â€ã€‚å¦‚æœè¯´ RAG æ˜¯â€œäº‹å®æ£€ç´¢å™¨â€ï¼Œé‚£ä¹ˆ CAG çš„ç›®æ ‡æ˜¯æˆä¸ºâ€œé¢†åŸŸä¸“å®¶â€ã€‚</p>
<p><strong>CAG çš„æ ¸å¿ƒåŒºåˆ«åœ¨äºï¼š</strong></p>
<ol>
<li><strong>â€œé¢†åŸŸè®°å¿†â€ (Domain Memory)ï¼š</strong> Â è¿™æ˜¯ CAG çš„æ ¸å¿ƒã€‚å®ƒè¶…è¶Šäº† RAG çš„è¢«åŠ¨çŸ¥è¯†åº“ï¼Œæ˜¯ä¸€ä¸ª<strong>ä¸»åŠ¨çš„ã€æœ‰çŠ¶æ€çš„è®°å¿†ç³»ç»Ÿ</strong>ã€‚è¿™ä¸ªâ€œè®°å¿†â€ä¸­ä¸ä»…å­˜å‚¨ç€äº‹å®çŸ¥è¯†ï¼Œè¿˜åŒ…æ‹¬ï¼š</li>
</ol>
<ul>
<li><strong>é¢†åŸŸè§„åˆ™ï¼š</strong> Â ä¾‹å¦‚ï¼ŒåŒ»ç–— AI éœ€è¦éµå®ˆçš„è¯Šæ–­é€»è¾‘ï¼Œæˆ–é‡‘è AI å¿…é¡»éµå¾ªçš„åˆè§„æ¡æ¬¾ã€‚</li>
<li><strong>å¯¹è¯å†å²ï¼š</strong> Â è®°ä½ç”¨æˆ·åœ¨ä¸‰å¤©å‰è®¨è®ºè¿‡çš„è¯é¢˜ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸Šä¸€å¥è¯ã€‚</li>
<li><strong>ç”¨æˆ·åå¥½ï¼š</strong> Â çŸ¥é“ç”¨æˆ·çš„å…·ä½“éœ€æ±‚ã€é£æ ¼åå¥½æˆ–ä¸ªäººèƒŒæ™¯ã€‚</li>
</ul>
<ol start="2">
<li><strong>â€œä¸Šä¸‹æ–‡å¯¹é½â€ (Context Alignment)ï¼š</strong> Â CAG ä¸åªæ˜¯ç®€å•åœ°â€œæ‹¼æ¥â€ä¿¡æ¯ã€‚å®ƒåœ¨ç”Ÿæˆç­”æ¡ˆå‰ï¼Œä¼šè¿›è¡Œå¤æ‚çš„â€œå¯¹é½â€å·¥ä½œï¼Œç¡®ä¿å³å°†ç”Ÿæˆçš„å›å¤ï¼ŒåŒæ—¶ä¸<strong>å¤–éƒ¨çŸ¥è¯†ï¼ˆRAG åšçš„ï¼‰ã€é¢†åŸŸè®°å¿†ã€å¯¹è¯å†å²</strong>ä¿æŒé€»è¾‘ä¸€è‡´ã€‚</li>
<li><strong>â€œä¸€è‡´æ€§æ£€æŸ¥â€ (Consistency Check)ï¼š</strong> Â åœ¨ç”Ÿæˆç­”æ¡ˆåï¼ŒCAG ä¼šå¢åŠ ä¸€ä¸ªå…³é”®çš„éªŒè¯å±‚ã€‚å®ƒä¼šåå‘æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦ä¸â€œé¢†åŸŸè®°å¿†â€ä¸­çš„æ ¸å¿ƒè§„åˆ™æˆ–é•¿æœŸç›®æ ‡ç›¸çŸ›ç›¾ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ³•å¾‹ AI åŠ©æ‰‹åœ¨ç»™å‡ºå»ºè®®æ—¶ï¼Œå¿…é¡»ç¡®ä¿å…¶å»ºè®®å§‹ç»ˆç¬¦åˆå®ƒâ€œè®°å¿†â€ä¸­çš„æ³•å¾‹æ¡†æ¶ã€‚</li>
</ol>
<h2 data-id="heading-2">RAG vs. CAG</h2>
<p>æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ç§æ¶æ„è§†ä¸ºAIæ™ºèƒ½çš„ä¸¤ä¸ªä¸åŒè¿›åŒ–é˜¶æ®µï¼š</p>



































<table><thead><tr><th>ç‰¹æ€§</th><th><strong>RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)</strong></th><th><strong>CAG (ä¸Šä¸‹æ–‡å¢å¼ºç”Ÿæˆ)</strong></th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒç„¦ç‚¹</strong></td><td><strong>äº‹å®æ£€ç´¢ (Fact Retrieval)</strong></td><td><strong>æƒ…å¢ƒç®¡ç† (Context Management)</strong></td></tr><tr><td><strong>å·¥ä½œæ¨¡å¼</strong></td><td>åå‘<strong>æ— çŠ¶æ€ (Stateless)</strong> ï¼ˆæ¯æ¬¡æŸ¥è¯¢éƒ½åƒä¸€æ¬¡æ–°çš„æ£€ç´¢ï¼‰</td><td>å¼ºè°ƒ<strong>æœ‰çŠ¶æ€ (Stateful)</strong> ï¼ˆç»´æŠ¤å’Œè°ƒç”¨æŒä¹…çš„è®°å¿†ï¼‰</td></tr><tr><td><strong>çŸ¥è¯†æº</strong></td><td>å¤–éƒ¨çŸ¥è¯†åº“ï¼ˆæ–‡æ¡£ã€ç½‘é¡µç­‰ï¼‰</td><td>å¤–éƒ¨çŸ¥è¯†åº“ +Â <strong>é¢†åŸŸè®°å¿†</strong> ï¼ˆè§„åˆ™ã€å†å²ã€åå¥½ï¼‰</td></tr><tr><td><strong>å…³é”®åŠ¨ä½œ</strong></td><td>æ£€ç´¢ (Retrieve)ã€æ’åº (Rank)ã€èåˆ (Fuse)</td><td>æ³¨å…¥ (Inject)ã€å¯¹é½ (Align)ã€ä¸€è‡´æ€§æ£€æŸ¥ (Consistency)</td></tr><tr><td><strong>ç›®æ ‡è§’è‰²</strong></td><td><strong>â€œå¼€å·è€ƒè¯•â€çš„è€ƒç”Ÿ</strong> ï¼ˆèƒ½å¿«é€ŸæŸ¥åˆ°æ­£ç¡®ç­”æ¡ˆï¼‰</td><td><strong>â€œèä¼šè´¯é€šâ€çš„ä¸“å®¶</strong> ï¼ˆèƒ½ç»“åˆè®°å¿†å’ŒçŸ¥è¯†ç»™å‡ºä¸€è´¯çš„è§è§£ï¼‰</td></tr></tbody></table>
<p>RAG è§£å†³äº† LLMâ€œä¸çŸ¥é“â€å’Œâ€œè¯´é”™è¯â€çš„é—®é¢˜ï¼Œè¿™æ˜¯ AI ä»â€œç©å…·â€èµ°å‘â€œå·¥å…·â€çš„å…³é”®ä¸€æ­¥ã€‚</p>
<p>è€ŒÂ <strong>CAG åˆ™ä»£è¡¨äº† AI ä»â€œå·¥å…·â€èµ°å‘â€œä¼™ä¼´â€å’Œâ€œä¸“å®¶â€çš„é›„å¿ƒ</strong>ã€‚å®ƒè¿½æ±‚çš„ä¸å†æ˜¯â€œå•ç‚¹æ­£ç¡®â€ï¼Œè€Œæ˜¯â€œå…¨å±€ä¸€è‡´â€å’Œâ€œæ·±åº¦ä¸ªæ€§åŒ–â€ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»æ˜ç™½ï¼Œ<strong>CAG å¹¶éè¦æ›¿ä»£ RAGï¼Œè€Œæ˜¯ RAG çš„å¿…ç„¶æ¼”è¿›å’Œæ‰©å±•</strong>ã€‚åœ¨å…ˆè¿›çš„ CAG æ¡†æ¶ä¸­ï¼ŒRAG å¾€å¾€ä¼šä½œä¸ºå…¶â€œä¸Šä¸‹æ–‡æ³¨å…¥â€çš„ä¸€ä¸ªå…³é”®ç»„ä»¶ï¼Œè´Ÿè´£ä»å¤–éƒ¨ä¸–ç•Œè·å–å®æ—¶äº‹å®ã€‚</p>
<p>æœªæ¥çš„é«˜çº§ AI åŠ©æ‰‹ï¼Œå¿…ç„¶æ˜¯ä¸€ä¸ª RAG å’Œ CAG çš„æ··åˆä½“ï¼šå®ƒæ—¢èƒ½åƒ RAG ä¸€æ ·åšè§ˆç¾¤ä¹¦ã€å¿«é€Ÿæ£€ç´¢ï¼Œä¹Ÿèƒ½åƒ CAG ä¸€æ ·æ‹¥æœ‰æ·±åˆ»çš„è®°å¿†å’Œä¸€è‡´çš„â€œäººæ ¼â€ï¼ŒçœŸæ­£åšåˆ°ä»â€œçŸ¥é“â€èµ°å‘â€œç†è§£â€ã€‚</p>
<h2 data-id="heading-3">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025æœ€ç«çš„4ä¸ªå›½äº§AIéŸ³ä¹å·¥å…·å…¨é¢è¯„æµ‹ï¼Œæœ€åä¸¤ä¸ªå®Œå…¨å…è´¹ï¼ï¼ˆå»ºè®®æ”¶è—ï¼‰]]></title>    <link>https://juejin.cn/post/7570295366481313828</link>    <guid>https://juejin.cn/post/7570295366481313828</guid>    <pubDate>2025-11-10T08:11:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570295366481313828" data-draft-id="7570500819889487915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025æœ€ç«çš„4ä¸ªå›½äº§AIéŸ³ä¹å·¥å…·å…¨é¢è¯„æµ‹ï¼Œæœ€åä¸¤ä¸ªå®Œå…¨å…è´¹ï¼ï¼ˆå»ºè®®æ”¶è—ï¼‰"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-10T08:11:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜Xå°é¹¿"/> <meta itemprop="url" content="https://juejin.cn/user/2928754709505608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025æœ€ç«çš„4ä¸ªå›½äº§AIéŸ³ä¹å·¥å…·å…¨é¢è¯„æµ‹ï¼Œæœ€åä¸¤ä¸ªå®Œå…¨å…è´¹ï¼ï¼ˆå»ºè®®æ”¶è—ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754709505608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜Xå°é¹¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:11:44.000Z" title="Mon Nov 10 2025 08:11:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Xå°é¹¿ã€‚</p>
<p>å‰å‡ å¤©ï¼Œä¸€ä½è¯»è€…æ¥é—®ï¼Œ<strong>æœ‰å“ªäº› AI éŸ³ä¹å·¥å…·æ¨èï¼Œæœ€å¥½å›½å†…çš„</strong>ã€‚</p>
<p>æˆ‘æƒ³èµ·æ¥ä¹‹å‰æ­£å¥½æ•´ç†è¿‡ä¸€ç¯‡ AI éŸ³ä¹å·¥å…·æ±‡æ€»çš„æ–‡ç« ï¼Œå¯ä»¥ç›´æ¥å‘ç»™ä»–ã€‚</p>
<p>ä½†çœ‹äº†ä¸‹ï¼Œå‘ç°æœ‰äº›å·²ç»ä¸‹æ¶æ‰¾ä¸åˆ°å…¥å£äº†ï¼Œæ¯”å¦‚å³æ¢¦AIã€æµ·èºAIï¼Œè¿™äº›ä¹‹å‰éƒ½æ˜¯æœ‰ã€ŒAI éŸ³ä¹ã€åŠŸèƒ½çš„ï¼Œä½†ç°åœ¨å·²ç»éƒ½æ²¡æœ‰äº†ã€‚</p>
<p>è¶ç€å‘¨æœ«ï¼Œå†æ•´ç†ä¸‹ã€‚</p>
<p><strong>ä¸‹é¢åˆ†äº« 4 ä¸ªç›®å‰ç”¨çš„è¾ƒå¤šçš„å›½äº§</strong> <strong>AI</strong> <strong>éŸ³ä¹ç”Ÿæˆå·¥å…·ï¼Œæœ‰ç”µè„‘ç«¯çš„ï¼Œä¹Ÿæœ‰æ‰‹æœºç«¯çš„ï¼Œæœ€åä¸¤ä¸ªå®Œå…¨å…è´¹ï¼</strong></p>
<p>æœ‰éœ€è¦çš„å¯ä»¥ä¿å­˜ä¸‹ï¼Œæ—©æ™šç”¨çš„ä¸Šï½</p>
<h2 data-id="heading-0">ä¸€ã€Tunee</h2>
<p>è¿™ä¸ª AI å·¥å…·è¿˜æ˜¯ä¹‹å‰è¢«ç½‘å‹ç§è‰çš„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/030f5750ddff443dad4aa913e2e51419~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=ZFiKQbBc23Eu2CnKHoaqPx3mC2s%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>Tuneeï¼Œå›½å†…é¦–ä¸ªå¯¹è¯å¼éŸ³ä¹åˆ›ä½œ Agentï¼Œç”±ã€Œå›½äº§ AI éŸ³ä¹ä¸‰å·¨å¤´ã€ä¹‹ä¸€çš„å¤©è°±ä¹å›¢é˜Ÿå­µåŒ–ã€‚</strong></p>
<p>ç®€å•æè¿°æƒ³ç”Ÿæˆä»€ä¹ˆéŸ³ä¹ï¼Œç„¶å Tunee å°±ä¼šä»¥å¯¹è¯çš„å½¢å¼ã€ä¸€æ­¥æ­¥å’Œæˆ‘ä»¬æ²Ÿé€šæ›´è¯¦ç»†çš„éœ€æ±‚ï¼Œæœ€ç»ˆåˆ›ä½œå‡ºæƒ³è¦çš„éŸ³ä¹ã€‚</p>
<p>Tunee è¿˜å¯ä»¥æ ¹æ®æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆéŸ³é¢‘ / è§†é¢‘ / å›¾ç‰‡ï¼‰æ¥åˆ›ä½œï¼Œä¹Ÿå¯ä»¥é€šè¿‡è”ç½‘è·å–æœ€æ–°çš„èµ„æ–™æ¥è¿›è¡Œéœ€æ±‚åˆ†æã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1101606b29e414c90ca341a21a613a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=I7%2BIHIEB61RBS7x6z6qlQXNAaVU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8695003b81e44cc2ae18ea9687f65135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=QK%2F62lH6IobxtCrhsDUJz1iNRMc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ€ç»ˆçš„åˆ›ä½œç»“æœä»¥ç”»å¸ƒå½¢å¼å±•ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9199ce8221d40819559a17348f1aefd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=v%2BaTZ3AGXjHY80I9QwfeTdJJskM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä¸‹é¢è¿™é¦–éŸ³ä¹å°±æ˜¯ç”¨ Tunee ç”Ÿæˆçš„ï¼š</p>
<p>ï¼ˆéŸ³é¢‘ä¸æ–¹ä¾¿ä¸Šä¼ ï¼Œè¯•å¬è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1x6gCYkWqc-XbWVjSIMPcw" target="_blank" title="https://mp.weixin.qq.com/s/1x6gCYkWqc-XbWVjSIMPcw" ref="nofollow noopener noreferrer">åŸæ–‡</a>ï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e9e23e67fbb472ca04ea3217d60a042~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=ebRqsMT1CppjP9gvkQ7dmyBGSxc%3D" alt="æˆªå±2025-11-10 16.07.30.png" loading="lazy"/></p>
<p>Tunee è¿˜å¯ä»¥å¯¹ç”Ÿæˆå¥½çš„éŸ³ä¹ã€Œä¸€é”®åˆ¶ä½œ MVã€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf96221cd3874f98bca93756013f5ac5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=pTzJU5xkvNgVhfNNSh57jZzsTk0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fa3458be55e415ba365e35e0f291049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=APh4Y6X%2Bn7aRT1ZnNgyd3iFP0UM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ€è¿‘çœ‹ Tunee åˆæ›´æ–°äº†ï¼Œæ¥å…¥äº† Sora 2 æ¨¡å‹ï¼ŒMV ç”Ÿæˆæ•ˆæœåº”è¯¥æ¯”ä¹‹å‰æ›´å¼ºäº†ã€‚æœ‰å…´è¶£çš„å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f636d96a6e744a98943211c571aa34a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=VfMOIYxAMsrEhk6ktkFTTskf2SQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é™¤äº†ç”ŸæˆéŸ³ä¹ã€åˆ¶ä½œ MVï¼ŒTunee è¿˜å¯ä»¥ç¼–è¾‘æ­Œè¯ã€åˆ†ç¦»éŸ³è½¨ï¼ˆæ‹†åˆ†ä¸ºäººå£°ã€é¼“ã€è´æ–¯ç­‰éŸ³è½¨ï¼Œä¾¿äºäºŒæ¬¡ç¼–è¾‘å’Œæ··éŸ³ï¼‰ã€æ™ºèƒ½æ¯å¸¦å¤„ç†ç­‰ã€‚</p>
<p>æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ï¼š</p>
<p><a href="https://juejin.cn/post/7554967090475532303" target="_blank" title="https://juejin.cn/post/7554967090475532303">å›½äº§AIåˆå‡ºç‹ç‚¸ï¼æ‹œæ‹œSunoï¼Œè¿™ä¸ªå›½å†…é¦–ä¸ªå¯¹è¯å¼éŸ³ä¹åˆ›ä½œAgentæ›´å¥½ç”¨ï¼ï¼ˆé™„å®æµ‹ä½“éªŒï¼‰</a></p>
<h2 data-id="heading-1">äºŒã€Mureka</h2>
<p>ä»Šå¹´ï¼ˆ2025ï¼‰ 3 æœˆï¼Œæ˜†ä»‘ä¸‡ç»´å‘å¸ƒäº†å…¶ AI éŸ³ä¹å¤§æ¨¡å‹â€”â€”Mureka O1 å’Œ Mureka V6ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b903d24bea14cc79c4977c7f84fabce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=eALwyZXyarkQLEMXSPmHYSAhuiM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Mureka O1ï¼Œæ˜¯å…¨çƒé¦–ä¸ªé‡‡ç”¨ CoT æŠ€æœ¯çš„éŸ³ä¹æ¨ç†å¤§æ¨¡å‹ã€‚åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼ŒåŠ å…¥äº†æ€è€ƒä¸è‡ªæˆ‘æ‰¹åˆ¤ï¼Œä½¿å¾— Mureka åœ¨éŸ³ä¹åˆ›ä½œçš„å“è´¨ã€æ•ˆç‡å’Œçµæ´»æ€§ç­‰æ–¹é¢å¤§å¹…æå‡ã€‚</p>
<p><strong>åœ¨å½“æ—¶å®˜æ–¹å…¬å¸ƒçš„ä¸»å®¢è§‚æµ‹è¯„ä¸­ï¼ŒMureka O1 çš„å¤šé¡¹æŒ‡æ ‡å·²è¶…è¶Š Sunoï¼Œå®ç°å…¨çƒé¢†è·‘ã€‚</strong></p>
<p>éšååˆå‘å¸ƒäº† Mureka V7.5 æ¨¡å‹ï¼Œä¹Ÿæ˜¯ç›®å‰æ˜†ä»‘ä¸‡ç»´ä¸Šçº¿çš„æœ€æ–°çš„ AI éŸ³ä¹å¤§æ¨¡å‹ã€‚<strong>ä¸­æ–‡æ¼”å”±è¶…è¶Šæµ·å¤–åŒç±»æ¨¡å‹ï¼Œå¹¶ä¸”æ”¯æŒä¸­è‹±æ—¥éŸ©åœ¨å†…çš„ 10 ç§è¯­è¨€ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bcc7dce55034762951cc69fb2856d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=yL9rjOPQOsaTKoFej4MguWl47sc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Mureka çš„æ­Œæ›²åˆ›ä½œæœ‰ã€Œç®€å•æ¨¡å¼ã€å’Œã€Œé«˜çº§æ¨¡å¼ã€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db87d61d9692487ea3e0323a8cab9c94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=9IdCRG0eYvpJoZnnUq79JkIAb54%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa5ca6ec6d91459490851c0c0bb7e732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=jugwa5nixxLC76S03e%2BR2vMa3ZE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>ç®€å•æ¨¡å¼</strong>ï¼šåªéœ€è¦è¾“å…¥ä¸»é¢˜æˆ–æƒ³æ³•ï¼ŒMureka å°±å¼€å§‹åˆ›ä½œäº†ã€‚</p>
<p><strong>é«˜çº§æ¨¡å¼ï¼š</strong> æ”¯æŒè‡ªå·±è¾“å…¥æ ‡é¢˜å’Œæ­Œè¯ï¼Œä¹Ÿå¯ä»¥è®© Mureka æ ¹æ®è¾“å…¥çš„æ ‡é¢˜æ¥ç”Ÿæˆæ­Œè¯ã€‚</p>
<p>è€Œä¸”è¿˜å¯ä»¥è®© Murekaï¼š</p>
<ul>
<li>å‚è€ƒä¸Šä¼ çš„æ­Œæ›²æ¥åˆ›ä½œç›¸ä¼¼çš„</li>
<li>ç”¨æŒ‡å®šéŸ³è‰²æ¥å”±</li>
<li>åŸºäºæ­Œæ›²æè¿°ï¼ˆæŒ‡å®šæ›²é£ã€æƒ…ç»ªã€äººå£°æ€§åˆ«ã€ä¹å™¨ç­‰ï¼‰æ¥åˆ›ä½œ</li>
<li>åŸºäºå“¼å”±æ—‹å¾‹æ¥åˆ›ä½œ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3657ade891d343a8b2007b392ee2a0e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=yzLU%2B6KHqCBhZQNjq3YOh9T3HA8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä¸è¿‡è¿™äº›é«˜çº§åŠŸèƒ½ï¼ŒåŸºæœ¬éƒ½éœ€è¦å¼€ä¼šå‘˜äº†ï¼ŒåŒ…æ‹¬ä¸‹é¢çš„ã€ŒéŸ³é¢‘ç¼–è¾‘ã€åŠŸèƒ½ä¹Ÿæ˜¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cce494832014b39bd87a2da8563c749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=1alrJODC5rzDquApy3n5EOBp9FM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Mureka çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œé€‚åˆä¸“ä¸šé€‰æ‰‹ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€æµ·ç»µéŸ³ä¹</h2>
<p>æµ·ç»µéŸ³ä¹ï¼Œæ˜¯å­—èŠ‚è·³åŠ¨æ——ä¸‹çš„ä¸€æ¬¾ AI éŸ³ä¹åˆ›ä½œå¹³å°ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5c8c77b49104bee9e44200254e8df59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=L1QvUeYUzHk7aiyw76Mmh6fD5Ug%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>ã€Œçµæ„Ÿåˆ›ä½œã€æ¨¡å¼</strong>ï¼šç®€å•è¾“å…¥çµæ„Ÿå°±å¯ä»¥åˆ›ä½œï¼›</p>
<p><strong>ã€Œè‡ªå®šä¹‰å†™è¯ã€æ¨¡å¼</strong>ï¼šæ”¯æŒå¡«å…¥è‡ªå·±å†™å¥½çš„æ­Œè¯ï¼ˆå¯ä»¥ç”¨ AI æ¶¦è‰²ï¼‰ï¼Œå¯ä»¥é€‰æ‹©æ›²é£ã€å¿ƒæƒ…ã€éŸ³è‰²ã€äººå£°æ€§åˆ«ç­‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c42b80d2368f46089c6dc2abbc4c5baf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=po%2FVeWbe4F0vPrJshtTe4yci4a0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç”Ÿæˆå¥½çš„æ­Œæ›²ï¼Œæ”¯æŒã€Œæ”¹éŸ³è‰²ã€å’Œ ã€Œæ”¹æ­Œè¯ã€ã€‚</p>
<p><strong>æ”¹éŸ³è‰²</strong>ï¼šå½•åˆ¶ä¸€æ®µè‡ªå·±çš„å£°éŸ³åï¼Œå¯ä»¥ç”¨è‡ªå·±éŸ³è‰²æ¥å”±è¿™é¦–æ­Œã€‚</p>
<p><strong>æ”¹æ­Œè¯</strong>ï¼šèƒ½åœ¨ä¿æŒæ—‹å¾‹ä¸å˜çš„æƒ…å†µä¸‹ä¿®æ”¹æ­Œè¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92916dab634f4538b8c9d29e0cf0fd73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=1B%2FEBpxOJJgMEDwn1KBC%2FOLLI7o%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦å¤–åœ¨ã€Œå®éªŒå®¤ã€é‡Œï¼Œè¿˜æœ‰ã€Œ<strong>AI</strong> <strong>ä»¿å†™</strong>ã€çš„åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒåŸæ›²é£ï¼Œç”Ÿæˆç›¸ä¼¼çš„æ­Œæ›²ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd692c98cf104e96a0abc096e5216d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=IurpzOx4uvs7XTJm08PDvElBaug%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½†ç›®å‰åªæ”¯æŒä»å·²æœ‰çš„æ­Œæ›²é‡Œé€‰ï¼Œä¸æ”¯æŒè‡ªå·±ä¸Šä¼ æ­Œæ›²ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/420f12ab10744bedb1917af5f5ad3ada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=%2FhQ79cevkOiF25S9GkCdsZ%2BYmyE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æµ·ç»µéŸ³ä¹ç›®å‰å®Œå…¨å…è´¹ï¼ŒåŒæ—¶æ”¯æŒç”µè„‘ç«¯å’Œæ‰‹æœºç«¯ï¼ˆAndroid / iOSï¼‰ï¼Œä¹Ÿæ”¯æŒå¯¹ç”Ÿæˆçš„éŸ³ä¹å†ç¼–è¾‘ã€‚</p>
<h2 data-id="heading-3">å››ã€è±†åŒ…</h2>
<p>ä¸Šé¢ 3 ä¸ªï¼Œéƒ½æ˜¯ä¸“é—¨çš„ AI éŸ³ä¹å·¥å…·ã€‚</p>
<p>é‚£å¯¹äºæ™®é€šäººï¼Œä¸éœ€è¦é‚£ä¹ˆä¸“ä¸šçš„ã€ç®€å•ä¸€ç‚¹çš„æœ‰æ²¡æœ‰ï¼Ÿå¯ä»¥ä½¿ç”¨è±†åŒ…ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21ad97b010fb4584a2fdd4210e27edad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=Jo5aO%2BsSIRN%2FbQwlwrT3X7UzCBw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿›å…¥è±†åŒ…ï¼ˆè±†åŒ…æ‰‹æœºç«¯æˆ–ç”µè„‘ç«¯éƒ½å¯ä»¥ï¼‰ï¼Œæ‰¾åˆ°ã€ŒéŸ³ä¹ç”Ÿæˆã€ã€‚</p>
<p>åªéœ€è¦è¾“å…¥ä¸»é¢˜ï¼Œç„¶åä¾æ¬¡é€‰æ‹©é£æ ¼ã€æƒ…ç»ªã€éŸ³è‰²å°±å¯ä»¥äº†ï¼ˆè“è‰²å­—ä½“éƒ¨åˆ†ï¼‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d95f588064b4f918bc50bbab689af7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367103&amp;x-signature=Ur6ceoOwRINpL0FYTVUEhjzbiHk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è±†åŒ…çš„ AI éŸ³ä¹åŠŸèƒ½ã€Œå®Œå…¨å…è´¹ã€ï¼Œä½†é™¤äº†æ”¯æŒè‡ªå®šä¹‰æ­Œè¯å¤–ï¼Œå°±æ²¡æœ‰å…¶ä»–æ›´é«˜çº§çš„åŠŸèƒ½äº†ï¼Œä¸æ”¯æŒå¯¹ç”Ÿæˆçš„éŸ³ä¹å†æ¬¡ç¼–è¾‘ç­‰ï¼Œé€‚åˆæ™®é€šç©å®¶ã€‚</p>
<h2 data-id="heading-4">äº”ã€å†™åœ¨æœ€å</h2>
<p>æœ€åæ¥æ€»ç»“ä¸€ä¸‹å§ã€‚</p>
<p>Tuneeã€Murekaã€æµ·ç»µéŸ³ä¹ï¼Œæ˜¯ 3 æ¬¾ä¸“é—¨çš„ AI éŸ³ä¹å·¥å…·ã€‚</p>
<p>å…¶ä¸­ Tunee å’Œ Mureka ç›®å‰åŠŸèƒ½æ›´å¤šä¸€äº›ï¼Œå°¤å…¶æ˜¯ Murekaï¼Œæ›´é€‚åˆä¸“ä¸šç©å®¶ã€‚</p>
<p>Tunee å’Œ Mureka æ˜¯ä»˜è´¹å·¥å…·ï¼Œä½† Tunee æ¯å¤©éƒ½æœ‰ä¸€äº›å…è´¹é¢åº¦å¯ä»¥ä½“éªŒã€‚</p>
<p>æµ·ç»µéŸ³ä¹å’Œè±†åŒ…éƒ½æ˜¯å­—èŠ‚æ——ä¸‹çš„ï¼Œç›®å‰ã€Œå®Œå…¨å…è´¹ã€ï¼Œè€Œä¸”ç”µè„‘ç«¯ã€æ‰‹æœºç«¯éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µï¼Œé€‰æ‹©é€‚åˆçš„ AI éŸ³ä¹å·¥å…·ã€‚</p>
<h2 data-id="heading-5">å…­ã€é“¾æ¥</h2>
<p>æœ€åé™„ä¸Šè¿™äº› AI éŸ³ä¹å·¥å…·çš„é“¾æ¥ï¼š</p>
<p><strong>Tunee</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tunee.ai%2Fzh-CN%2F" target="_blank" title="https://www.tunee.ai/zh-CN/" ref="nofollow noopener noreferrer">www.tunee.ai/zh-CN/</a></p>
<p><strong>Mureka</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mureka.cn%2F" target="_blank" title="https://www.mureka.cn/" ref="nofollow noopener noreferrer">www.mureka.cn/</a></p>
<p><strong>æµ·ç»µéŸ³ä¹</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.haimian.com%2F" target="_blank" title="https://www.haimian.com/" ref="nofollow noopener noreferrer">www.haimian.com/</a></p>
<p><strong>è±†åŒ…</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.doubao.com%2F" target="_blank" title="https://www.doubao.com/" ref="nofollow noopener noreferrer">www.doubao.com/</a></p>
<hr/>
<blockquote>
<p>æˆ‘æ˜¯<a href="https://juejin.cn/user/2928754709505608/posts" title="https://juejin.cn/user/2928754709505608/posts" target="_blank">ç¨‹åºå‘˜Xå°é¹¿</a>ï¼Œå‰äº’è”ç½‘å¤§å‚ç¨‹åºå‘˜ï¼Œä¹Ÿæ˜¯ä¸€å AIGC çˆ±å¥½è€…ï¼ŒæŒç»­åˆ†äº«æ›´å¤šå¥½ç”¨çš„ AI å·¥å…·ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµ~</p>
</blockquote>
<p><strong>æ¨èé˜…è¯»</strong></p>
<p><a href="https://juejin.cn/post/7454501732203610131" title="https://juejin.cn/post/7454501732203610131" target="_blank">2024å¹´ç»ˆAIå·¥å…·æ±‡æ€»ï¼š9å¤§AIé¢†åŸŸï¼Œ70+ç²¾é€‰AIå·¥å…·ï¼Œå…¨éƒ½åœ¨è¿™äº†ï¼(å»ºè®®æ”¶è—)</a></p>
<p>æ›´å¤š AI å·¥å…·è§<a href="https://juejin.cn/column/7284164153576947724" title="https://juejin.cn/column/7284164153576947724" target="_blank">ã€AIå·¥å…·ã€‘</a>ä¸“æ ï¼ŒæŒç»­æ›´æ–°ä¸­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ]]></title>    <link>https://juejin.cn/post/7570534000718495807</link>    <guid>https://juejin.cn/post/7570534000718495807</guid>    <pubDate>2025-11-10T08:19:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570534000718495807" data-draft-id="7570534000718479423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ"/> <meta itemprop="keywords" content="Android,OpenGL"/> <meta itemprop="datePublished" content="2025-11-10T08:19:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‹ä½å­"/> <meta itemprop="url" content="https://juejin.cn/user/2313028193761389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day8: å¤šé‡çº¹ç†ä¸æ··åˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028193761389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‹ä½å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:19:05.000Z" title="Mon Nov 10 2025 08:19:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://juejin.cn/post/7567889397497528383" target="_blank" title="https://juejin.cn/post/7567889397497528383">å‰è¨€: ã€OpenGLå­¦ä¹ ã€ ä»é›¶æ‰“é€  Android æ»¤é•œç›¸æœº</a></p>
<p><a href="https://juejin.cn/post/7569871848793948179" target="_blank" title="https://juejin.cn/post/7569871848793948179">ä¸Šä¸€ç¯‡:ã€OpenGLå­¦ä¹ æ»¤é•œç›¸æœºã€- Day7: FBOï¼ˆå¸§ç¼“å†²å¯¹è±¡ï¼‰</a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaweizi%2FOpenGLTest" target="_blank" title="https://github.com/xiaweizi/OpenGLTest" ref="nofollow noopener noreferrer">OpenGLTest</a></p>
</blockquote>
<h2 data-id="heading-0">ğŸ“š ä»Šæ—¥ç›®æ ‡</h2>
<ul>
<li>ç†è§£å¤šçº¹ç†å•å…ƒçš„æ¦‚å¿µå’Œä½¿ç”¨</li>
<li>æŒæ¡çº¹ç†æ··åˆæ¨¡å¼ï¼ˆBlend Modesï¼‰</li>
<li>å­¦ä¹  Alpha é€šé“å¤„ç†å’Œé€æ˜åº¦</li>
<li>å®ç°å›¾ç‰‡æ°´å°ã€çº¹ç†å åŠ ç­‰å®ç”¨æ•ˆæœ</li>
</ul>
<p><strong>è¿è¡Œæ•ˆæœï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0fe85223524f6d85e34d84847cfa31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiL5L2N5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367544&amp;x-signature=NEY23PHhtHVaLDDj%2FvZ28hR8j1M%3D" alt="Day8.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ğŸ¯ å­¦ä¹ å†…å®¹</h2>
<h3 data-id="heading-2">1. å¤šçº¹ç†å•å…ƒç®€ä»‹</h3>
<p>åœ¨ OpenGL ES ä¸­ï¼Œ<strong>çº¹ç†å•å…ƒï¼ˆTexture Unitï¼‰</strong> å…è®¸æˆ‘ä»¬åœ¨ä¸€æ¬¡ç»˜åˆ¶è°ƒç”¨ä¸­ä½¿ç”¨å¤šä¸ªçº¹ç†ã€‚</p>
<h4 data-id="heading-3">ä»€ä¹ˆæ˜¯çº¹ç†å•å…ƒï¼Ÿ</h4>
<p>çº¹ç†å•å…ƒæ˜¯ OpenGL ä¸­çš„"çº¹ç†æ§½ä½"ï¼Œæ¯ä¸ªæ§½ä½å¯ä»¥ç»‘å®šä¸€ä¸ªçº¹ç†å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">GPU</span> <span class="hljs-string">çº¹ç†å•å…ƒ</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">GL_TEXTURE0</span> <span class="hljs-string">â†’</span> <span class="hljs-string">çº¹ç†</span> <span class="hljs-attr">ID:</span> <span class="hljs-number">123</span><span class="hljs-string">ï¼ˆåº•å›¾ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">GL_TEXTURE1</span> <span class="hljs-string">â†’</span> <span class="hljs-string">çº¹ç†</span> <span class="hljs-attr">ID:</span> <span class="hljs-number">456</span><span class="hljs-string">ï¼ˆæ°´å°ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">GL_TEXTURE2</span> <span class="hljs-string">â†’</span> <span class="hljs-string">çº¹ç†</span> <span class="hljs-attr">ID:</span> <span class="hljs-number">789</span><span class="hljs-string">ï¼ˆé®ç½©ï¼‰</span>
<span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">...</span>
<span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">GL_TEXTURE31ï¼ˆOpenGL</span> <span class="hljs-string">ES</span> <span class="hljs-string">è‡³å°‘æ”¯æŒ</span> <span class="hljs-number">8</span> <span class="hljs-string">ä¸ªï¼Œé€šå¸¸æ”¯æŒ</span> <span class="hljs-number">16</span><span class="hljs-number">-32</span> <span class="hljs-string">ä¸ªï¼‰</span>
</code></pre>
<h4 data-id="heading-4">ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¹ç†ï¼Ÿ</h4>





























<table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ°´å°æ•ˆæœ</strong></td><td>åº•å›¾ + æ°´å°å›¾</td></tr><tr><td><strong>é®ç½©æ•ˆæœ</strong></td><td>åŸå›¾ + é®ç½©å›¾</td></tr><tr><td><strong>å…‰ç…§è´´å›¾</strong></td><td>é¢œè‰²çº¹ç† + æ³•çº¿è´´å›¾ + å…‰ç…§è´´å›¾</td></tr><tr><td><strong>è§†é¢‘ç‰¹æ•ˆ</strong></td><td>è§†é¢‘å¸§ + æ»¤é•œçº¹ç†ï¼ˆLUTï¼‰</td></tr><tr><td><strong>ç²’å­æ•ˆæœ</strong></td><td>ç²’å­çº¹ç† + æ¸å˜çº¹ç†</td></tr></tbody></table>
<h3 data-id="heading-5">2. å¤šçº¹ç†çš„ä½¿ç”¨æµç¨‹</h3>
<h4 data-id="heading-6">2.1 æ¿€æ´»çº¹ç†å•å…ƒ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 0</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
<span class="hljs-comment">// ç»‘å®šç¬¬ä¸€ä¸ªçº¹ç†</span>
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)

<span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 1</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
<span class="hljs-comment">// ç»‘å®šç¬¬äºŒä¸ªçº¹ç†</span>
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
</code></pre>
<h4 data-id="heading-7">2.2 ä¼ é€’ç»™ç€è‰²å™¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å°†çº¹ç†å•å…ƒç´¢å¼•ä¼ é€’ç»™ç€è‰²å™¨çš„ sampler2D</span>
GLES20.glUniform1i(texture1Location, <span class="hljs-number">0</span>)  <span class="hljs-comment">// ä½¿ç”¨ GL_TEXTURE0</span>
GLES20.glUniform1i(texture2Location, <span class="hljs-number">1</span>)  <span class="hljs-comment">// ä½¿ç”¨ GL_TEXTURE1</span>
</code></pre>
<h4 data-id="heading-8">2.3 ç€è‰²å™¨ä¸­é‡‡æ ·</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture1;  // åº•å›¾
uniform sampler2D uTexture2;  // æ°´å°

varying vec2 vTexCoord;

void main() {
    vec4 color1 = texture2D(uTexture1, vTexCoord);  // é‡‡æ ·åº•å›¾
    vec4 color2 = texture2D(uTexture2, vTexCoord);  // é‡‡æ ·æ°´å°
    
    // æ··åˆä¸¤ä¸ªçº¹ç†
    gl_FragColor = mix(color1, color2, color2.a);
}
</code></pre>
<h3 data-id="heading-9">3. çº¹ç†æ··åˆæ¨¡å¼</h3>
<h4 data-id="heading-10">3.1 å¸¸è§æ··åˆç®—æ³•</h4>








































<table><thead><tr><th>æ··åˆæ¨¡å¼</th><th>å…¬å¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><strong>æ­£å¸¸ï¼ˆNormalï¼‰</strong></td><td><code>color2</code></td><td>å®Œå…¨è¦†ç›–</td></tr><tr><td><strong>Alpha æ··åˆ</strong></td><td><code>mix(color1, color2, alpha)</code></td><td>é€æ˜å åŠ </td></tr><tr><td><strong>ç›¸åŠ ï¼ˆAddï¼‰</strong></td><td><code>color1 + color2</code></td><td>å¢äº®æ•ˆæœ</td></tr><tr><td><strong>ç›¸ä¹˜ï¼ˆMultiplyï¼‰</strong></td><td><code>color1 * color2</code></td><td>å˜æš—æ•ˆæœ</td></tr><tr><td><strong>å±å¹•ï¼ˆScreenï¼‰</strong></td><td><code>1.0 - (1.0 - color1) * (1.0 - color2)</code></td><td>æŸ”å…‰å¢äº®</td></tr><tr><td><strong>å åŠ ï¼ˆOverlayï¼‰</strong></td><td>æ ¹æ®äº®åº¦æ··åˆç›¸ä¹˜å’Œå±å¹•æ¨¡å¼</td><td>ä¿ç•™é«˜å…‰å’Œé˜´å½±</td></tr></tbody></table>
<h4 data-id="heading-11">3.2 ç€è‰²å™¨å®ç°</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture1;  // åº•å›¾
uniform sampler2D uTexture2;  // å åŠ å›¾
uniform int uBlendMode;       // æ··åˆæ¨¡å¼ï¼ˆ0-5ï¼‰
uniform float uAlpha;         // é€æ˜åº¦ï¼ˆ0.0 - 1.0ï¼‰

varying vec2 vTexCoord;

// æ­£å¸¸æ··åˆ
vec3 blendNormal(vec3 base, vec3 blend) {
    return blend;
}

// ç›¸åŠ æ··åˆ
vec3 blendAdd(vec3 base, vec3 blend) {
    return min(base + blend, vec3(1.0));
}

// ç›¸ä¹˜æ··åˆ
vec3 blendMultiply(vec3 base, vec3 blend) {
    return base * blend;
}

// å±å¹•æ··åˆ
vec3 blendScreen(vec3 base, vec3 blend) {
    return 1.0 - (1.0 - base) * (1.0 - blend);
}

// å åŠ æ··åˆ
vec3 blendOverlay(vec3 base, vec3 blend) {
    vec3 result;
    result.r = base.r &lt; 0.5 ? (2.0 * base.r * blend.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - blend.r));
    result.g = base.g &lt; 0.5 ? (2.0 * base.g * blend.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - blend.g));
    result.b = base.b &lt; 0.5 ? (2.0 * base.b * blend.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - blend.b));
    return result;
}

// æŸ”å…‰æ··åˆ
vec3 blendSoftLight(vec3 base, vec3 blend) {
    vec3 result;
    result.r = blend.r &lt; 0.5 ? (2.0 * base.r * blend.r + base.r * base.r * (1.0 - 2.0 * blend.r)) 
                              : (sqrt(base.r) * (2.0 * blend.r - 1.0) + 2.0 * base.r * (1.0 - blend.r));
    result.g = blend.g &lt; 0.5 ? (2.0 * base.g * blend.g + base.g * base.g * (1.0 - 2.0 * blend.g)) 
                              : (sqrt(base.g) * (2.0 * blend.g - 1.0) + 2.0 * base.g * (1.0 - blend.g));
    result.b = blend.b &lt; 0.5 ? (2.0 * base.b * blend.b + base.b * base.b * (1.0 - 2.0 * blend.b)) 
                              : (sqrt(base.b) * (2.0 * blend.b - 1.0) + 2.0 * base.b * (1.0 - blend.b));
    return result;
}

void main() {
    vec4 base = texture2D(uTexture1, vTexCoord);
    vec4 blend = texture2D(uTexture2, vTexCoord);
    
    vec3 result;
    
    if (uBlendMode == 0) {
        // æ­£å¸¸æ··åˆï¼ˆAlpha æ··åˆï¼‰
        result = mix(base.rgb, blend.rgb, blend.a * uAlpha);
    } else if (uBlendMode == 1) {
        // ç›¸åŠ 
        result = blendAdd(base.rgb, blend.rgb * uAlpha);
    } else if (uBlendMode == 2) {
        // ç›¸ä¹˜
        result = mix(base.rgb, blendMultiply(base.rgb, blend.rgb), uAlpha);
    } else if (uBlendMode == 3) {
        // å±å¹•
        result = mix(base.rgb, blendScreen(base.rgb, blend.rgb), uAlpha);
    } else if (uBlendMode == 4) {
        // å åŠ 
        result = mix(base.rgb, blendOverlay(base.rgb, blend.rgb), uAlpha);
    } else if (uBlendMode == 5) {
        // æŸ”å…‰
        result = mix(base.rgb, blendSoftLight(base.rgb, blend.rgb), uAlpha);
    } else {
        result = base.rgb;
    }
    
    gl_FragColor = vec4(result, 1.0);
}
</code></pre>
<h3 data-id="heading-12">4. Alpha é€šé“å¤„ç†</h3>
<h4 data-id="heading-13">4.1 ä»€ä¹ˆæ˜¯ Alpha é€šé“ï¼Ÿ</h4>
<p><strong>Alpha é€šé“</strong>è¡¨ç¤ºåƒç´ çš„ä¸é€æ˜åº¦ï¼š</p>
<ul>
<li><code>alpha = 0.0</code>ï¼šå®Œå…¨é€æ˜</li>
<li><code>alpha = 0.5</code>ï¼šåŠé€æ˜</li>
<li><code>alpha = 1.0</code>ï¼šå®Œå…¨ä¸é€æ˜</li>
</ul>
<h4 data-id="heading-14">4.2 å¯ç”¨ Alpha æ··åˆ</h4>
<p>OpenGL æä¾›äº†ç¡¬ä»¶çº§åˆ«çš„ Alpha æ··åˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¯ç”¨æ··åˆ</span>
GLES20.glEnable(GLES20.GL_BLEND)

<span class="hljs-comment">// è®¾ç½®æ··åˆå‡½æ•°</span>
GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)
</code></pre>
<p><strong>æ··åˆå…¬å¼</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">æœ€ç»ˆé¢œè‰² = æºé¢œè‰² Ã— æºå› å­ + ç›®æ ‡é¢œè‰² Ã— ç›®æ ‡å› å­
       = <span class="hljs-attribute">src</span><span class="hljs-selector-class">.rgb</span> Ã— <span class="hljs-attribute">src</span><span class="hljs-selector-class">.a</span> + dst<span class="hljs-selector-class">.rgb</span> Ã— (<span class="hljs-number">1.0</span> - <span class="hljs-attribute">src</span><span class="hljs-selector-class">.a</span>)
</code></pre>
<h4 data-id="heading-15">4.3 å¸¸è§æ··åˆå‡½æ•°</h4>






























<table><thead><tr><th>æºå› å­</th><th>ç›®æ ‡å› å­</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><code>GL_SRC_ALPHA</code></td><td><code>GL_ONE_MINUS_SRC_ALPHA</code></td><td>æ ‡å‡† Alpha æ··åˆï¼ˆé€æ˜å åŠ ï¼‰</td></tr><tr><td><code>GL_ONE</code></td><td><code>GL_ONE</code></td><td>ç›¸åŠ æ··åˆï¼ˆå¢äº®ï¼‰</td></tr><tr><td><code>GL_DST_COLOR</code></td><td><code>GL_ZERO</code></td><td>ç›¸ä¹˜æ··åˆï¼ˆå˜æš—ï¼‰</td></tr><tr><td><code>GL_ONE</code></td><td><code>GL_ONE_MINUS_SRC_ALPHA</code></td><td>é¢„ä¹˜ Alpha æ··åˆ</td></tr></tbody></table>
<h3 data-id="heading-16">5. å®ç”¨æ•ˆæœå®ç°</h3>
<h4 data-id="heading-17">5.1 æ°´å°æ•ˆæœ</h4>
<pre><code class="hljs language-glsl" lang="glsl">// æ°´å°ç€è‰²å™¨
precision mediump float;

uniform sampler2D uTexture;    // åº•å›¾
uniform sampler2D uWatermark;  // æ°´å°
uniform vec2 uWatermarkPos;    // æ°´å°ä½ç½®ï¼ˆ0.0 - 1.0ï¼‰
uniform vec2 uWatermarkSize;   // æ°´å°å¤§å°ï¼ˆ0.0 - 1.0ï¼‰
uniform float uWatermarkAlpha; // æ°´å°é€æ˜åº¦

varying vec2 vTexCoord;

void main() {
    vec4 baseColor = texture2D(uTexture, vTexCoord);
    
    // è®¡ç®—æ°´å°åŒºåŸŸ
    vec2 watermarkCoord = (vTexCoord - uWatermarkPos) / uWatermarkSize;
    
    // åˆ¤æ–­æ˜¯å¦åœ¨æ°´å°åŒºåŸŸ
    if (watermarkCoord.x &gt;= 0.0 &amp;&amp; watermarkCoord.x &lt;= 1.0 &amp;&amp;
        watermarkCoord.y &gt;= 0.0 &amp;&amp; watermarkCoord.y &lt;= 1.0) {
        
        vec4 watermarkColor = texture2D(uWatermark, watermarkCoord);
        
        // Alpha æ··åˆæ°´å°
        gl_FragColor = mix(baseColor, watermarkColor, watermarkColor.a * uWatermarkAlpha);
    } else {
        gl_FragColor = baseColor;
    }
}
</code></pre>
<h4 data-id="heading-18">5.2 åŒé‡æ›å…‰æ•ˆæœ</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture1;
uniform sampler2D uTexture2;
uniform float uMixRatio;  // æ··åˆæ¯”ä¾‹

varying vec2 vTexCoord;

void main() {
    vec4 color1 = texture2D(uTexture1, vTexCoord);
    vec4 color2 = texture2D(uTexture2, vTexCoord);
    
    // å±å¹•æ··åˆæ¨¡å¼ï¼ˆåŒé‡æ›å…‰å¸¸ç”¨ï¼‰
    vec3 result = 1.0 - (1.0 - color1.rgb) * (1.0 - color2.rgb * uMixRatio);
    
    gl_FragColor = vec4(result, 1.0);
}
</code></pre>
<h4 data-id="heading-19">5.3 é®ç½©æ•ˆæœ</h4>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;

uniform sampler2D uTexture;  // åŸå›¾
uniform sampler2D uMask;     // é®ç½©ï¼ˆé»‘ç™½å›¾ï¼‰

varying vec2 vTexCoord;

void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec4 mask = texture2D(uMask, vTexCoord);
    
    // ä½¿ç”¨é®ç½©çš„äº®åº¦ä½œä¸º Alpha
    float maskAlpha = dot(mask.rgb, vec3(0.299, 0.587, 0.114));
    
    gl_FragColor = vec4(color.rgb, color.a * maskAlpha);
}
</code></pre>
<h3 data-id="heading-20">6. æ€§èƒ½ä¼˜åŒ–</h3>
<h4 data-id="heading-21">6.1 çº¹ç†å•å…ƒç®¡ç†</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureManager</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TEXTURE_UNIT_BASE = <span class="hljs-number">0</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TEXTURE_UNIT_BLEND = <span class="hljs-number">1</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TEXTURE_UNIT_WATERMARK = <span class="hljs-number">2</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindTextures</span><span class="hljs-params">(baseTexture: <span class="hljs-type">Int</span>, blendTexture: <span class="hljs-type">Int</span>, watermarkTexture: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// åº•å›¾</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + TEXTURE_UNIT_BASE)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, baseTexture)
        
        <span class="hljs-comment">// æ··åˆå›¾</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + TEXTURE_UNIT_BLEND)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, blendTexture)
        
        <span class="hljs-comment">// æ°´å°</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + TEXTURE_UNIT_WATERMARK)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, watermarkTexture)
    }
}
</code></pre>
<h4 data-id="heading-22">6.2 å‡å°‘çº¹ç†åˆ‡æ¢</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ ä¸å¥½çš„åšæ³•ï¼šé¢‘ç¹åˆ‡æ¢çº¹ç†å•å…ƒ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">renderObjects</span><span class="hljs-params">(objects: <span class="hljs-type">List</span>&lt;<span class="hljs-type">RenderObject</span>&gt;)</span></span> {
    objects.forEach { obj -&gt;
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, obj.texture)
        obj.draw()
    }
}

<span class="hljs-comment">// âœ… å¥½çš„åšæ³•ï¼šæ‰¹é‡æ¸²æŸ“ç›¸åŒçº¹ç†çš„å¯¹è±¡</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">renderObjectsBatched</span><span class="hljs-params">(objects: <span class="hljs-type">List</span>&lt;<span class="hljs-type">RenderObject</span>&gt;)</span></span> {
    <span class="hljs-keyword">val</span> grouped = objects.groupBy { it.texture }
    grouped.forEach { (texture, objs) -&gt;
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture)
        objs.forEach { it.draw() }
    }
}
</code></pre>
<h4 data-id="heading-23">6.3 çº¹ç†å‹ç¼©</h4>
<p>å¯¹äºæ°´å°ç­‰è¾…åŠ©çº¹ç†ï¼Œå¯ä»¥ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡æˆ–å‹ç¼©æ ¼å¼ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è°ƒæ•´æ°´å°å°ºå¯¸</span>
<span class="hljs-keyword">val</span> watermarkSize = <span class="hljs-number">256</span>  <span class="hljs-comment">// ä¸éœ€è¦å¾ˆé«˜åˆ†è¾¨ç‡</span>
<span class="hljs-keyword">val</span> scaledWatermark = Bitmap.createScaledBitmap(
    originalWatermark, 
    watermarkSize, 
    watermarkSize, 
    <span class="hljs-literal">true</span>
)
</code></pre>
<h3 data-id="heading-24">7. å¤šçº¹ç†çš„é™åˆ¶</h3>
<h4 data-id="heading-25">7.1 æŸ¥è¯¢çº¹ç†å•å…ƒæ•°é‡</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> maxTextureUnits = IntArray(<span class="hljs-number">1</span>)
GLES20.glGetIntegerv(GLES20.GL_MAX_TEXTURE_IMAGE_UNITS, maxTextureUnits, <span class="hljs-number">0</span>)
Log.d(TAG, <span class="hljs-string">"è®¾å¤‡æ”¯æŒçš„æœ€å¤§çº¹ç†å•å…ƒæ•°: <span class="hljs-subst">${maxTextureUnits[<span class="hljs-number">0</span>]}</span>"</span>)
</code></pre>
<p>OpenGL ES 2.0 è§„èŒƒè¦æ±‚è‡³å°‘æ”¯æŒ 8 ä¸ªçº¹ç†å•å…ƒï¼Œå¤§å¤šæ•°è®¾å¤‡æ”¯æŒ 16-32 ä¸ªã€‚</p>
<h4 data-id="heading-26">7.2 çº¹ç†å†…å­˜ç®¡ç†</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç›‘æ§çº¹ç†å†…å­˜ä½¿ç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">estimateTextureMemory</span><span class="hljs-params">(width: <span class="hljs-type">Int</span>, height: <span class="hljs-type">Int</span>, format: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">val</span> bytesPerPixel = <span class="hljs-keyword">when</span> (format) {
        GLES20.GL_RGBA -&gt; <span class="hljs-number">4</span>
        GLES20.GL_RGB -&gt; <span class="hljs-number">3</span>
        GLES20.GL_LUMINANCE_ALPHA -&gt; <span class="hljs-number">2</span>
        GLES20.GL_LUMINANCE -&gt; <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-number">4</span>
    }
    <span class="hljs-keyword">return</span> width * height * bytesPerPixel
}

<span class="hljs-comment">// ç¤ºä¾‹ï¼š1920x1080 RGBA çº¹ç† = 8.3 MB</span>
<span class="hljs-keyword">val</span> memory = estimateTextureMemory(<span class="hljs-number">1920</span>, <span class="hljs-number">1080</span>, GLES20.GL_RGBA)
Log.d(TAG, <span class="hljs-string">"çº¹ç†å†…å­˜å ç”¨: <span class="hljs-subst">${memory / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>}</span> MB"</span>)
</code></pre>
<h2 data-id="heading-27">ğŸ’» ä»£ç å®è·µ</h2>
<h3 data-id="heading-28">ä»Šæ—¥ä»»åŠ¡</h3>
<p>å®ç°ä¸€ä¸ªå¤šçº¹ç†æ··åˆåº”ç”¨ï¼š</p>
<ol>
<li><strong>åŠ è½½ä¸¤å¼ å›¾ç‰‡</strong></li>
<li><strong>å®ç°å¤šç§æ··åˆæ¨¡å¼</strong>ï¼š
<ul>
<li>Alpha æ··åˆ</li>
<li>ç›¸åŠ </li>
<li>ç›¸ä¹˜</li>
<li>å±å¹•</li>
<li>å åŠ </li>
<li>æŸ”å…‰</li>
</ul>
</li>
<li><strong>æ·»åŠ æ°´å°åŠŸèƒ½</strong></li>
<li><strong>æä¾›é€æ˜åº¦è°ƒèŠ‚</strong></li>
</ol>
<h3 data-id="heading-29">å®ç°æ•ˆæœ</h3>
<ul>
<li>ğŸ–¼ï¸ åŒæ—¶åŠ è½½ä¸¤å¼ çº¹ç†</li>
<li>ğŸ¨ 6 ç§æ··åˆæ¨¡å¼å®æ—¶åˆ‡æ¢</li>
<li>ğŸ’§ é€æ˜åº¦ SeekBar è°ƒèŠ‚</li>
<li>ğŸ·ï¸ æ°´å°ä½ç½®å’Œé€æ˜åº¦æ§åˆ¶</li>
</ul>
<h3 data-id="heading-30">æ ¸å¿ƒä»£ç ç»“æ„</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day08Renderer</span>(context: Context) : GLSurfaceView.Renderer {

    <span class="hljs-comment">// å¤šçº¹ç† ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> texture1: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>  <span class="hljs-comment">// åº•å›¾</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> texture2: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>  <span class="hljs-comment">// å åŠ å›¾</span>

    <span class="hljs-comment">// æ··åˆæ¨¡å¼</span>
    <span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlendMode</span> {
        ALPHA,      <span class="hljs-comment">// Alpha æ··åˆ</span>
        ADD,        <span class="hljs-comment">// ç›¸åŠ </span>
        MULTIPLY,   <span class="hljs-comment">// ç›¸ä¹˜</span>
        SCREEN,     <span class="hljs-comment">// å±å¹•</span>
        OVERLAY,    <span class="hljs-comment">// å åŠ </span>
        SOFT_LIGHT  <span class="hljs-comment">// æŸ”å…‰</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentBlendMode = BlendMode.ALPHA
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> blendAlpha = <span class="hljs-number">0.5f</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDrawFrame</span><span class="hljs-params">(gl: <span class="hljs-type">GL10</span>?)</span></span> {
        <span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 0</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)
        GLES20.glUniform1i(texture1Location, <span class="hljs-number">0</span>)

        <span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 1</span>
        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
        GLES20.glUniform1i(texture2Location, <span class="hljs-number">1</span>)

        <span class="hljs-comment">// è®¾ç½®æ··åˆæ¨¡å¼</span>
        GLES20.glUniform1i(blendModeLocation, currentBlendMode.ordinal)
        GLES20.glUniform1f(alphaLocation, blendAlpha)

        <span class="hljs-comment">// ç»˜åˆ¶</span>
        drawQuad()
    }
}
</code></pre>
<h2 data-id="heading-31">ğŸ§ª ç»ƒä¹ ä»»åŠ¡</h2>
<h3 data-id="heading-32">åŸºç¡€ä»»åŠ¡</h3>
<ol>
<li>âœ… å®ç°ä¸¤ä¸ªçº¹ç†çš„åŠ è½½å’Œç»‘å®š</li>
<li>âœ… å®ç°è‡³å°‘ 3 ç§æ··åˆæ¨¡å¼</li>
<li>âœ… æ·»åŠ é€æ˜åº¦è°ƒèŠ‚åŠŸèƒ½</li>
</ol>
<h3 data-id="heading-33">è¿›é˜¶ä»»åŠ¡</h3>
<ol>
<li>ğŸ¨ å®ç°æ°´å°åŠŸèƒ½ï¼ˆå¯è°ƒèŠ‚ä½ç½®å’Œå¤§å°ï¼‰</li>
<li>ğŸ–¼ï¸ å®ç°é®ç½©æ•ˆæœ</li>
<li>ğŸŒˆ å®ç°åŒé‡æ›å…‰æ•ˆæœ</li>
<li>ğŸ“¸ æ·»åŠ é¢„è®¾æ··åˆæ•ˆæœï¼ˆå¤å¤ã€ç”µå½±ã€æ¢¦å¹»ç­‰ï¼‰</li>
</ol>
<h3 data-id="heading-34">æŒ‘æˆ˜ä»»åŠ¡</h3>
<ol>
<li>ğŸš€ å®ç°ä¸‰ä¸ªçº¹ç†çš„æ··åˆï¼ˆåº•å›¾ + å åŠ å›¾ + æ°´å°ï¼‰</li>
<li>ğŸ­ å®ç°åŠ¨æ€æ··åˆï¼ˆæ··åˆæ¯”ä¾‹éšæ—¶é—´å˜åŒ–ï¼‰</li>
<li>ğŸ¬ å®ç°åˆ†åŒºåŸŸæ··åˆï¼ˆä¸åŒåŒºåŸŸä¸åŒæ··åˆæ¨¡å¼ï¼‰</li>
<li>ğŸ’¾ ä¿å­˜æ··åˆåçš„å›¾ç‰‡åˆ°ç›¸å†Œ</li>
</ol>
<h2 data-id="heading-35">ğŸ“– çŸ¥è¯†ç‚¹æ€»ç»“</h2>
<h3 data-id="heading-36">çº¹ç†å•å…ƒ vs çº¹ç†å¯¹è±¡</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>çº¹ç†å•å…ƒ</th><th>çº¹ç†å¯¹è±¡</th></tr></thead><tbody><tr><td><strong>æ¦‚å¿µ</strong></td><td>GPU çš„"çº¹ç†æ§½ä½"</td><td>å®é™…çš„çº¹ç†æ•°æ®</td></tr><tr><td><strong>æ•°é‡</strong></td><td>æœ‰é™ï¼ˆé€šå¸¸ 8-32 ä¸ªï¼‰</td><td>å¯ä»¥åˆ›å»ºå¾ˆå¤š</td></tr><tr><td><strong>æ“ä½œ</strong></td><td><code>glActiveTexture()</code></td><td><code>glBindTexture()</code></td></tr><tr><td><strong>ç±»æ¯”</strong></td><td>USB æ¥å£</td><td>U ç›˜</td></tr></tbody></table>
<h3 data-id="heading-37">æ··åˆæ¨¡å¼å¯¹æ¯”</h3>








































<table><thead><tr><th>æ¨¡å¼</th><th>è§†è§‰æ•ˆæœ</th><th>å¸¸ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Alpha</strong></td><td>é€æ˜å åŠ </td><td>æ°´å°ã€UI å åŠ </td></tr><tr><td><strong>Add</strong></td><td>å¢äº®ã€å‘å…‰</td><td>å…‰æ•ˆã€ç²’å­</td></tr><tr><td><strong>Multiply</strong></td><td>å˜æš—ã€é˜´å½±</td><td>é˜´å½±ã€è‰²å½©æ ¡æ­£</td></tr><tr><td><strong>Screen</strong></td><td>æŸ”å’Œå¢äº®</td><td>æŸ”å…‰ã€æ°›å›´</td></tr><tr><td><strong>Overlay</strong></td><td>å¯¹æ¯”å¢å¼º</td><td>ç…§ç‰‡æ»¤é•œ</td></tr><tr><td><strong>Soft Light</strong></td><td>æŸ”å’Œæ··åˆ</td><td>è‚–åƒç¾åŒ–</td></tr></tbody></table>
<h3 data-id="heading-38">æœ€ä½³å®è·µ</h3>
<ol>
<li>âœ… <strong>å¤ç”¨çº¹ç†å•å…ƒ</strong>ï¼šä¸è¦æ¯å¸§éƒ½é‡æ–°æ¿€æ´»å’Œç»‘å®š</li>
<li>âœ… <strong>æ‰¹é‡æ¸²æŸ“</strong>ï¼šç›¸åŒçº¹ç†çš„å¯¹è±¡ä¸€èµ·æ¸²æŸ“</li>
<li>âœ… <strong>çº¹ç†å‹ç¼©</strong>ï¼šå¯¹è¾…åŠ©çº¹ç†ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡</li>
<li>âœ… <strong>åŠæ—¶é‡Šæ”¾</strong>ï¼šä¸å†ä½¿ç”¨çš„çº¹ç†è¦åˆ é™¤</li>
<li>âœ… <strong>æ£€æŸ¥é™åˆ¶</strong>ï¼šæŸ¥è¯¢è®¾å¤‡æ”¯æŒçš„æœ€å¤§çº¹ç†å•å…ƒæ•°</li>
</ol>
<h2 data-id="heading-39">ğŸ› å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-40">Q1: çº¹ç†æ˜¾ç¤ºæ˜¯é»‘è‰²çš„ï¼Ÿ</h3>
<p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ol>
<li>çº¹ç†å•å…ƒç´¢å¼•é”™è¯¯</li>
<li><code>glUniform1i</code> ä¼ é€’çš„å€¼ä¸å¯¹åº”æ¿€æ´»çš„çº¹ç†å•å…ƒ</li>
</ol>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// çº¹ç†å•å…ƒ 0</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)
GLES20.glUniform1i(texture1Location, <span class="hljs-number">0</span>)  <span class="hljs-comment">// ä¼ é€’ 0ï¼Œä¸æ˜¯ GL_TEXTURE0</span>

<span class="hljs-comment">// çº¹ç†å•å…ƒ 1</span>
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
GLES20.glUniform1i(texture2Location, <span class="hljs-number">1</span>)  <span class="hljs-comment">// ä¼ é€’ 1ï¼Œä¸æ˜¯ GL_TEXTURE1</span>
</code></pre>
<h3 data-id="heading-41">Q2: æ··åˆæ•ˆæœä¸æ­£ç¡®ï¼Ÿ</h3>
<p>æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† OpenGL æ··åˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¦‚æœä½¿ç”¨ç¡¬ä»¶æ··åˆ</span>
GLES20.glEnable(GLES20.GL_BLEND)
GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)

<span class="hljs-comment">// å¦‚æœä½¿ç”¨ç€è‰²å™¨æ··åˆ</span>
<span class="hljs-comment">// ä¸éœ€è¦å¯ç”¨ glBlendï¼Œç›´æ¥åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è®¡ç®—å³å¯</span>
</code></pre>
<h3 data-id="heading-42">Q3: æ°´å°ä½ç½®ä¸å¯¹ï¼Ÿ</h3>
<p>OpenGL åæ ‡ç³»åŸç‚¹åœ¨å·¦ä¸‹è§’ï¼Œè€Œ UI åæ ‡ç³»åœ¨å·¦ä¸Šè§’ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// UI åæ ‡ï¼ˆå·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼‰</span>
<span class="hljs-keyword">val</span> uiY = <span class="hljs-number">100f</span>

<span class="hljs-comment">// è½¬æ¢ä¸º OpenGL åæ ‡ï¼ˆå·¦ä¸‹è§’ä¸ºåŸç‚¹ï¼‰</span>
<span class="hljs-keyword">val</span> glY = screenHeight - uiY - watermarkHeight
</code></pre>
<h3 data-id="heading-43">Q4: å¦‚ä½•å®ç°åœ†å½¢æ°´å°ï¼Ÿ</h3>
<p>åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨è·ç¦»å‡½æ•°ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">void main() {
    vec2 center = vec2(0.5, 0.5);
    float dist = distance(watermarkCoord, center);
    
    // åœ†å½¢é®ç½©
    float alpha = smoothstep(0.5, 0.48, dist);
    
    vec4 watermarkColor = texture2D(uWatermark, watermarkCoord);
    watermarkColor.a *= alpha;
    
    gl_FragColor = mix(baseColor, watermarkColor, watermarkColor.a);
}
</code></pre>
<h2 data-id="heading-44">ğŸ”— å‚è€ƒèµ„æ–™</h2>
<h3 data-id="heading-45">å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fopengl%2Fwiki%2FTexture" target="_blank" title="https://www.khronos.org/opengl/wiki/Texture" ref="nofollow noopener noreferrer">OpenGL ES Texture Units</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fopengl%2Fwiki%2FSampler_(GLSL)" target="_blank" title="https://www.khronos.org/opengl/wiki/Sampler_(GLSL)" ref="nofollow noopener noreferrer">GLSL Sampler Types</a></li>
</ul>
<h3 data-id="heading-46">æ··åˆæ¨¡å¼å‚è€ƒ</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fphotoblogstop.com%2Fphotoshop%2Fphotoshop-blend-modes-explained" target="_blank" title="https://photoblogstop.com/photoshop/photoshop-blend-modes-explained" ref="nofollow noopener noreferrer">Photoshop Blend Modes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjamieowen%2Fglsl-blend" target="_blank" title="https://github.com/jamieowen/glsl-blend" ref="nofollow noopener noreferrer">WebGL Blend Modes</a></li>
</ul>
<h3 data-id="heading-47">æ¨èé˜…è¯»</h3>
<ul>
<li>ã€ŠReal-Time Renderingã€‹- Chapter 5: Visual Appearance</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.nvidia.com%2Fgpugems%2Fgpugems3%2Fpart-iv-image-effects" target="_blank" title="https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects" ref="nofollow noopener noreferrer">GPU Gems - Image Processing</a></li>
</ul>
<h2 data-id="heading-48">ğŸ“ ä»Šæ—¥æ€»ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬æ·±å…¥å­¦ä¹ äº†å¤šé‡çº¹ç†å’Œæ··åˆæŠ€æœ¯ï¼š</p>
<ol>
<li>âœ… ç†è§£äº†çº¹ç†å•å…ƒçš„æ¦‚å¿µï¼šGPU ä¸­çš„"çº¹ç†æ§½ä½"</li>
<li>âœ… æŒæ¡äº†å¤šçº¹ç†çš„ä½¿ç”¨æµç¨‹ï¼šæ¿€æ´» â†’ ç»‘å®š â†’ ä¼ é€’ç´¢å¼•</li>
<li>âœ… å­¦ä¹ äº† 6 ç§å¸¸ç”¨æ··åˆæ¨¡å¼ï¼šAlphaã€Addã€Multiplyã€Screenã€Overlayã€Soft Light</li>
<li>âœ… å®ç°äº†å®ç”¨æ•ˆæœï¼šæ°´å°ã€åŒé‡æ›å…‰ã€é®ç½©</li>
</ol>
<p><strong>å…³é”®è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>çº¹ç†å•å…ƒå…è®¸æˆ‘ä»¬åœ¨ä¸€æ¬¡ç»˜åˆ¶ä¸­ä½¿ç”¨å¤šä¸ªçº¹ç†</li>
<li><code>glActiveTexture()</code> æ¿€æ´»çº¹ç†å•å…ƒï¼Œ<code>glUniform1i()</code> ä¼ é€’ç´¢å¼•ï¼ˆä¸æ˜¯ GL_TEXTURE å¸¸é‡ï¼‰</li>
<li>æ··åˆæ¨¡å¼æœ¬è´¨æ˜¯ä¸åŒçš„é¢œè‰²è®¡ç®—å…¬å¼</li>
<li>Alpha é€šé“æ˜¯å®ç°é€æ˜æ•ˆæœçš„å…³é”®</li>
</ul>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">ä¸‹ä¸€ç¯‡</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ModelScope æ¨¡å‹ä¸€é”®ä¸Šçº¿ï¼ŸFunModel å¸®ä½  5 åˆ†é’Ÿä»é›¶åˆ°ç”Ÿäº§]]></title>    <link>https://juejin.cn/post/7570651893870854196</link>    <guid>https://juejin.cn/post/7570651893870854196</guid>    <pubDate>2025-11-10T08:22:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570651893870854196" data-draft-id="7570866247979335732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ModelScope æ¨¡å‹ä¸€é”®ä¸Šçº¿ï¼ŸFunModel å¸®ä½  5 åˆ†é’Ÿä»é›¶åˆ°ç”Ÿäº§"/> <meta itemprop="keywords" content="Serverless"/> <meta itemprop="datePublished" content="2025-11-10T08:22:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ModelScope æ¨¡å‹ä¸€é”®ä¸Šçº¿ï¼ŸFunModel å¸®ä½  5 åˆ†é’Ÿä»é›¶åˆ°ç”Ÿäº§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:22:30.000Z" title="Mon Nov 10 2025 08:22:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šç™¾æ½¼</p>
<blockquote>
<p>ä¸‹ä¸€ä¸ª AI çˆ†æ¬¾åº”ç”¨ï¼Œæˆ–è®¸å°±ä»æ‚¨ç‚¹å‡»â€œç«‹å³éƒ¨ç½²â€çš„é‚£ä¸€åˆ»å¼€å§‹ï¼</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€ï¼šAI æµªæ½®ä¸‹çš„æ¨¡å‹è¯‰æ±‚</h2>
<p>åœ¨å½“ä»Šè¿™ä¸ªå…¨æ°‘ AI çš„æ—¶ä»£ï¼Œå¿«é€Ÿå…¥é—¨ AIï¼Œèµ¶ä¸Šæ—¶ä»£çš„æµªæ½®ï¼Œæˆä¸ºäº†å¤§å®¶å½“ä¸‹æœ€çƒ­åˆ‡çš„è¿½æ±‚å’ŒæœŸç›¼ã€‚</p>
<p>äºæ˜¯ï¼Œæ¨¡å‹ä½œä¸º AI åœºæ™¯çš„è½½ä½“ï¼Œéšç€ AI æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œåœ¨æŒç»­çš„ï¼Œå¦‚é›¨åæ˜¥ç¬‹èˆ¬å‡ºç°åœ¨å¤§å®¶çš„è§†é‡ä¸­ï¼Œå¯è°“æ˜¯ç§ç±»ç¹æ‚ï¼ŒåŠŸèƒ½é½å…¨ï¼Œä»ä¸åŒæ–¹é¢æ»¡è¶³å¤§å®¶å¯¹ AI çš„éœ€æ±‚ã€‚ä¾‹å¦‚åœ¨ AI èŠå¤©åœºæ™¯ï¼Œå°±æœ‰å¾ˆå¤šå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å¯ä¾›é€‰æ‹©ï¼›åœ¨æ–‡æœ¬è½¬è¯­éŸ³çš„åœºæ™¯ï¼Œåˆæœ‰å¾ˆå¤šä¸åŒç§ç±»çš„ TTS æ¨¡å‹ã€‚AI åœºæ™¯å¤šå˜ï¼Œäººä»¬ä¹Ÿåœ¨ä¸æ–­æ¢ç´¢ä»¥æ¨¡å‹ä¸ºè½½ä½“çš„æ›´å¤š AI çš„å¯èƒ½ã€‚</p>
<p>ModelScope ä½œä¸ºå›½å†… Top çš„ AI æ¨¡å‹å¹³å°ï¼Œæ”¶å½•æ‰¿è½½äº†å¤§é‡çš„æ¨¡å‹ï¼Œäººä»¬å¯ä»¥åœ¨ ModelScope æŒ‰éœ€é€‰æ‹©æ¨¡å‹ã€‚æ­¤æ—¶ï¼Œå°†æ¨¡å‹å¿«é€Ÿè°ƒè¯•åº”ç”¨ï¼Œå‘å¸ƒä¸Šçº¿å¹¶è¿ç»´ï¼Œä¹Ÿæˆä¸ºäº†å¾ˆå¤šå…¬å¸å¿…ä¸å¯å°‘çš„æ¢ç´¢æ–¹å‘ã€‚</p>
<h2 data-id="heading-1">ç—›ç‚¹åˆ†æï¼šä¼ ç»Ÿæ¨¡å‹é›†æˆæ–¹æ¡ˆå·²æˆ AI é©æ–°æ‹¦è·¯è™</h2>
<p>ModelScope ç»™ AI å¼€å‘è€…åœ¨æ¨¡å‹å±‚é¢ä¸Šæä¾›äº†éå¸¸å¤§çš„ä¾¿åˆ©ï¼Œç„¶è€Œï¼ŒçœŸæ­£å°†æ¨¡å‹ç”¨èµ·æ¥ï¼Œè®©æ¨¡å‹å…·å¤‡ä¼ä¸šçº§çš„ç”Ÿäº§èƒ½åŠ›ï¼Œåˆæ˜¯æ‰€æœ‰ä¼ä¸šç”¨æˆ·ä¸å¾—ä¸é¢ä¸´çš„é—®é¢˜ã€‚å¯¹äºå¾ˆå¤šå¼€å‘è€…æ¥è¯´ï¼Œæœ‰ç€ä¸å°çš„ä½¿ç”¨é—¨æ§›ã€‚ä¸”æ¨¡å‹è¿­ä»£é€Ÿåº¦å¤ªå¿«ï¼Œå¦‚ä½•èƒ½å®æ—¶ç´§è·Ÿæ¨¡å‹çš„çƒ­åº¦æ˜¯å¾ˆå¤šå¼€å‘è€…äºŸå¾…è§£å†³çš„é—®é¢˜ã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼šä¸€ä¸ªä¸­å°å‹å…¬å¸å¸Œæœ›åœ¨è‡ªå·±çš„å¹³å°é›†æˆ LLM æ¨¡å‹ï¼Œå´è¦é¢å¯¹ GPU èµ„æºé…ç½®ã€å·¥ç¨‹åŒ–è°ƒè¯•ã€é•œåƒæ„å»ºç­‰ä¸€ç³»åˆ—ç¹çæ­¥éª¤ï¼Œæ•´ä¸ªè¿‡ç¨‹è€—æ—¶ 1 ï½ 2 å‘¨ï¼è¿™å¯¹äºæ€¥éœ€å¿«é€Ÿå“åº”å¸‚åœºçš„å›¢é˜Ÿæ¥è¯´ï¼Œç®€ç›´æ˜¯â€œè‡´å‘½ä¼¤â€ã€‚æ›´åˆ«æå…¬å¸çš„éå¼€å‘è€…ï¼Œå¦‚æœæƒ³è¦ä½“éªŒæ¨¡å‹æ•ˆæœï¼Œå´å› ä¸ºæŠ€æœ¯é—¨æ§›æœ›è€Œå´æ­¥ï¼Œé”™å¤±äº†å®è´µçš„ä¸šåŠ¡åˆ›æ–°æœºä¼šã€‚</p>
<ul>
<li><strong>é«˜ä½¿ç”¨é—¨æ§›é˜»æ»å¿«é€Ÿæ¥å…¥ï¼š</strong> è®©æ¨¡å‹å…·å¤‡åŸºç¡€å·¥ç¨‹èƒ½åŠ›å¹¶å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦ç»å†ä¸€ç³»åˆ—ç¹çæ­¥éª¤ï¼šè·å–åˆé€‚çš„ GPU èµ„æºã€æŠ•å…¥å¤§é‡æ—¶é—´è¿›è¡Œå¼€å‘è°ƒè¯•ã€é…ç½®è¿è¡Œé•œåƒã€ä¸ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿé€‚é…ã€‚å¯¹äºæ–°å…¥èŒçš„ AI å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œè¿™äº›å·¥ä½œéœ€ä¸å…¬å¸ä¸šåŠ¡å­¦ä¹ å¹¶è¡Œå±•å¼€ï¼Œè€Œè¾ƒé«˜çš„æŠ€æœ¯é—¨æ§›å¿…ç„¶æ‹‰é•¿å‰æœŸå‡†å¤‡å‘¨æœŸï¼Œæ•´ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ 1 ï½ 2 å‘¨çš„æ—¶é—´å‘¨æœŸã€‚åœ¨ç´§å‡‘çš„é¡¹ç›®æ’æœŸå‹åŠ›ä¸‹ï¼Œéš¾ä»¥å®ç°æ¨¡å‹çš„è¿…é€Ÿæ¥å…¥ä¸ä¸Šçº¿ã€‚</li>
<li><strong>è¿ç»´å¤æ‚æ€§å¨èƒæœåŠ¡ç¨³å®šæ€§ï¼š</strong> æ¨¡å‹ä¸Šçº¿åï¼Œçªå¢çš„æµé‡å¾€å¾€ä¼šæš´éœ²ç³»ç»Ÿç“¶é¢ˆã€‚æ‰©å®¹è¿‡ç¨‹é“¾è·¯å†—é•¿â€”â€”éœ€é‡æ–°é…ç½® GPU èµ„æºã€è°ƒæ•´è¿è¡Œç¯å¢ƒã€éƒ¨ç½²æ–°é•œåƒâ€”â€”è€—æ—¶å·¨å¤§ï¼Œéš¾ä»¥åº”å¯¹æµé‡æ´ªå³°ï¼Œæœ€ç»ˆå¯¼è‡´æœåŠ¡å®•æœºã€‚æµé‡æ¶ˆé€€åï¼Œä¸ºæ§åˆ¶é«˜æ˜‚çš„ GPU æˆæœ¬åˆä¸å¾—ä¸é‡Šæ”¾èµ„æºã€‚å¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œæ¯æ¬¡æµé‡é«˜å³°éƒ½é‡å¤ç›¸åŒçš„æ‰©å®¹å›°å¢ƒã€‚</li>
<li><strong>è¿­ä»£æ•ˆç‡ä½ä¸‹éš¾è·ŸæŠ€æœ¯æ½®æµï¼š</strong> é‰´äºæ¨¡å‹è¿­ä»£é€Ÿåº¦åŠ å¿«ï¼ŒAI å·¥ç¨‹å¸ˆè‹¥æ¬²åŠæ—¶å‡çº§è‡³æ–°ç‰ˆæœ¬æ¨¡å‹ï¼Œä¸ä»…éœ€éƒ¨ç½²æ–°æ¨¡å‹ï¼Œè¿˜éœ€å¤„ç†æ—§æ¨¡å‹çš„æµé‡å¹³æ»‘è¿‡æ¸¡ï¼ŒåŒæ—¶æ‰¿å—ç°æœ‰æ¶æ„çš„æ²‰é‡è´Ÿæ‹…ã€‚è¿™ç§ä½æ•ˆçš„è¿­ä»£æœºåˆ¶ï¼Œä½¿å›¢é˜Ÿéš¾ä»¥å®æ—¶è·Ÿè¿›ä¸šç•Œæœ€æ–°çš„æ¨¡å‹æ–¹æ¡ˆã€‚</li>
</ul>
<p>ç©¶å…¶æ ¹æœ¬ï¼Œå¯ä»¥å°†ä»¥ä¸Šçš„ä¸‰ä¸ªç—›ç‚¹é—®é¢˜æç‚¼ä¸ºå½“å‰ AI å·¥ç¨‹å¸ˆæ™®éé‡åˆ°çš„æŠ€æœ¯ç“¶é¢ˆï¼š<strong>éƒ¨ç½²é—¨æ§›é«˜ã€ç¯å¢ƒé…ç½®å¤æ‚ã€ä¼ä¸šåŒ–è¿ç»´éš¾ï¼</strong></p>
<h2 data-id="heading-2">å¯¹æ–°æ¨¡å‹é›†æˆæ–¹æ¡ˆçš„æœŸæœ›</h2>
<p>è¡Œä¸šæœŸå¾…çš„æ¨¡å‹é›†æˆæ–¹æ¡ˆåº”è¯¥å…·å¤‡ï¼š</p>
<ul>
<li><strong>é›¶ä»£ç éƒ¨ç½²ï¼š</strong> å‘Šåˆ«ç¹ççš„æ¨ç†ä»£ç ç¼–å†™ã€Dockerfile é…ç½®ï¼Œåªéœ€ç®€å•å¡«å†™é…ç½®ï¼Œæ¨¡å‹å³åˆ»ä¸Šçº¿ã€‚</li>
<li><strong>ä¸€é”®æ‰©ç¼©å®¹ï¼š</strong> å€Ÿé‰´ Serverless ç†å¿µï¼Œå®ç° GPU èµ„æºçš„å¼¹æ€§ä¼¸ç¼©ï¼Œåº”å¯¹æµé‡æ³¢åŠ¨ã€‚</li>
<li><strong>å…¨æµç¨‹è¦†ç›–ï¼š</strong> ä»å¼€å‘è°ƒè¯•åˆ°ç”Ÿäº§è¿ç»´ï¼Œä¸€ç«™å¼è§£å†³ï¼Œè®©ä¼ä¸šä¸ä»…â€œç”¨å¾—èµ·â€ï¼Œæ›´è¦â€œç”¨å¾—å¥½â€ã€‚</li>
<li><strong>å¿«é€Ÿè¿­ä»£èƒ½åŠ›ï¼š</strong> æ–°æ¨¡å‹ä¸Šçº¿æ— éœ€é‡æ„æ¶æ„ï¼Œå¹³æ»‘è¿‡æ¸¡ï¼Œç´§è·ŸæŠ€æœ¯æ½®æµã€‚</li>
</ul>
<h2 data-id="heading-3">æ¨¡å‹é›†æˆæ–°èŒƒå¼â€”â€”FunModel</h2>
<p>é¢å¯¹ä»¥ä¸Š AI å¼€å‘ä¸­é‡åˆ°çš„ç—›ç‚¹ä»¥åŠå¼€å‘è€…ä»¬å¯¹æ¨¡å‹çš„æŒç»­æ¢ç´¢å’ŒæœŸå¾…ï¼Œé˜¿é‡Œäº‘ FunModel å¸¦æ¥äº†æ¨¡å‹é›†æˆçš„æ–°èŒƒå¼ã€‚FunModel æ˜¯é˜¿é‡Œäº‘äº‘åŸç”Ÿçš„æ¨¡å‹æœåŠ¡å¹³å°ï¼Œä»¥é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC ä¸ºåº•åº§ï¼Œä¾æ‰˜å¤©ç„¶çš„ Serverless + GPU çš„åŸºæœ¬èƒ½åŠ›ï¼ŒåŒæ—¶åœ¨ä¸šåŠ¡å±‚é¢æ— ç¼å¯¹æ¥ ModelScope å®˜æ–¹æ¨¡å‹å¹³å°ï¼Œå®ç° 0 ä»£ç ä¸€é”®éƒ¨ç½²ï¼Œå¹¶èƒ½å¿«é€Ÿæ‰©ç¼©å®¹ã€‚ä¸ºä¼ä¸šæå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†éƒ¨ç½²å’Œè¿ç»´æ¨¡å‹çš„æ—¶é—´å’ŒäººåŠ›æˆæœ¬ï¼Œè®©ä¼ä¸šä¸“æ³¨äº AI ä¸šåŠ¡çš„å¼€å‘ï¼Œä¹Ÿè®©æ¨¡å‹ä¼ä¸šåŒ–è§¦æ‰‹å¯åŠã€‚</p>
<h3 data-id="heading-4">åŒæ¸ é“éƒ¨ç½²ï¼Œçµæ´»è‡ªç”±</h3>
<p>é˜¿é‡Œäº‘ FunModel æä¾›äº†ä¸¤ç§éƒ¨ç½²æ¸ é“ï¼Œå…¼å®¹å¤šç§ç±»æ¨¡å‹ï¼Œç»™ç”¨æˆ·æä¾›äº†éƒ¨ç½²æ¨¡å‹çš„è‡ªç”±åº¦</p>
<p><strong>1. æ— ç¼å¯¹æ¥ ModelScopeï¼š</strong> é˜¿é‡Œäº‘ FunModel æ‰¿è½½äº† ModelScope ä¸Šå¤§é‡çš„çƒ­é—¨æ¨¡å‹ï¼Œèƒ½æ ¹æ®ç”¨æˆ·éœ€æ±‚å’Œçƒ­é—¨æ¨¡å‹è¶‹åŠ¿å¿«é€Ÿä¸Šæ¶å’Œè¿­ä»£æ–°çš„æ¨¡å‹ï¼Œæ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è¾“å…¥ ModelScope ä¸Šçš„æ¨¡å‹ IDï¼Œå³å¯ç«‹å³éƒ¨ç½²ã€‚åœ¨ FunModel ä¸Šï¼Œè¿˜èƒ½å¿«é€Ÿä½“éªŒ ModelScope æ¨¡å‹æ•ˆæœå’Œäº†è§£æ¨¡å‹è¯¦æƒ…ï¼Œæ‹¥æœ‰ä»ä½“éªŒåˆ°éƒ¨ç½²çš„å®Œæ•´æµç¨‹ï¼Œä¸ºç”¨æˆ·æœ€å¤§ç¨‹åº¦ä¸Šå¸¦æ¥ä¾¿æ·ã€‚</p>
<p><strong>2. è‡ªå®šä¹‰éƒ¨ç½²ï¼š</strong> é˜¿é‡Œäº‘ FunModel ä¸ä»…ä¸ºç”¨æˆ·æä¾›æ¨¡å‹é›†æˆèƒ½åŠ›ï¼Œæ›´ä¸ºæœ‰æ¨¡å‹å¼€å‘éœ€æ±‚çš„ç”¨æˆ·æä¾›äº†ä¸“ä¸šçš„è‡ªå®šä¹‰æ¨¡å‹éƒ¨ç½²èƒ½åŠ›**ã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ è‡ªå·±è®­ç»ƒå¥½çš„å·¥ç¨‹é•œåƒåˆ° FunModel å¹³å°ï¼ŒæŒ‡å®šæ¨¡å‹æ¥æºæˆ–å­˜å‚¨è·¯å¾„ï¼Œå¡«å†™å¯¹åº”å¯åŠ¨å‚æ•°ï¼Œå°±èƒ½éƒ¨ç½²æ¨¡å‹åˆ°çº¿ä¸Šï¼Œå…·å¤‡ä¼ä¸šçº§æœåŠ¡èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-5">5 åˆ†é’Ÿæé€Ÿä¸Šçº¿</h3>
<p>é˜¿é‡Œäº‘ FunModel æå¤§ç¨‹åº¦ä¸Šç®€åŒ–äº†æ¨¡å‹çš„éƒ¨ç½²æµç¨‹ï¼Œç”¨æˆ·ä¸å†éœ€è¦æ‹…å¿ƒâ€œæ¨ç†ä»£ç ä¸ä¼šå†™â€ï¼Œâ€œéƒ¨ç½²é•œåƒå¤ªæ…¢â€ï¼Œâ€œå¯åŠ¨å‚æ•°å¡«å†™é”™è¯¯â€ï¼Œâ€œGPU è§„æ ¼é€‰ä¸å¯¹â€ç­‰é—®é¢˜ã€‚FunModel å¹³å°å·²ç»æå‰åŒ…è£…äº†å¯åŠ¨æ¨¡å‹éœ€è¦çš„æ‰€æœ‰å‚æ•°å’Œç¯å¢ƒï¼Œ<strong>åªéœ€å¡«å†™æ¨¡å‹åç§°ï¼Œ5 åˆ†é’Ÿå³å¯å®Œæˆä¼ä¸šçº§æœåŠ¡ä¸Šçº¿</strong>ï¼Œ<strong>æ•ˆç‡æå‡æ•°åå€</strong>ã€‚ä¼ ç»Ÿé›†æˆæ–¹æ¡ˆéœ€è¦è€—æ—¶æ•°å‘¨ï¼Œåœ¨ FunModel è¿™é‡Œå‹ç¼©åˆ°äº†ä¸€æ¯å’–å•¡çš„æ—¶é—´ã€‚</p>
<h3 data-id="heading-6">Serverless + GPU å¸®åŠ©å®ç°æ‰©ç¼©å®¹</h3>
<p>ä¾æ‰˜é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ï¼ŒFunModel å®ç° Serverless+GPU æ–°èŒƒå¼ï¼Œæä¾›ï¼š</p>
<ul>
<li><strong>å®šæ—¶ä¼¸ç¼© / CRON è¡¨è¾¾å¼ä¼¸ç¼©ï¼š</strong> æ ¹æ®ä¸šåŠ¡è§„å¾‹é¢„è®¾æ‰©ç¼©å®¹æ—¶é—´ã€‚</li>
<li><strong>æ°´ä½ä¼¸ç¼©ï¼š</strong> åŸºäº CPU/GPU ä½¿ç”¨ç‡è‡ªåŠ¨è°ƒæ•´èµ„æºã€‚</li>
</ul>
<p>ä¸¤ç§ç§ç­–ç•¥çµæ´»ç»„åˆï¼Œç²¾å‡†åŒ¹é…ä¸šåŠ¡æµé‡ï¼Œæå¤§ç¨‹åº¦ä¸Šæé«˜ GPU åˆ©ç”¨ç‡ï¼Œä»è€ŒèŠ‚çº¦æ˜‚è´µçš„ GPU è´¹ç”¨æˆæœ¬ã€‚</p>
<h2 data-id="heading-7">å®æˆ˜æŒ‡å—ï¼šå¿«é€Ÿéƒ¨ç½² ModelScope æ¨¡å‹</h2>
<h3 data-id="heading-8">ç¯å¢ƒå‡†å¤‡ä¸æƒé™é…ç½®</h3>
<p>åœ¨ä½¿ç”¨ FunModel å¹³å°å‰ï¼Œéœ€è¦å®Œæˆå¿…è¦çš„äº‘èµ„æºå‡†å¤‡å·¥ä½œï¼š</p>
<p><strong>1. é˜¿é‡Œäº‘è´¦å·å‡†å¤‡</strong></p>
<p>ç¡®ä¿æ‹¥æœ‰æœ‰æ•ˆçš„é˜¿é‡Œäº‘è´¦å·ï¼Œå¹¶å®Œæˆå®åè®¤è¯ã€‚</p>
<p><strong>2. FunModel æ§åˆ¶å°è®¿é—®</strong></p>
<p>è®¿é—®Â FunModel æ§åˆ¶å° <strong>[</strong> <strong>1]</strong> ï¼Œè¿™æ˜¯é˜¿é‡Œäº‘ Serverless AI æ¨¡å‹æœåŠ¡çš„ç»Ÿä¸€å…¥å£ã€‚</p>
<p><strong>3. RAM è§’è‰²æˆæƒ</strong></p>
<p>æ ¹æ®æ§åˆ¶å°æŒ‡å¼•å®Œæˆ RAMï¼ˆResource Access Managementï¼‰è§’è‰²æˆæƒé…ç½®ã€‚è¿™ä¸ªæ­¥éª¤è‡³å…³é‡è¦ï¼Œå®ƒç¡®ä¿ DevPod èƒ½å¤Ÿè®¿é—®å¿…è¦çš„äº‘èµ„æºã€‚</p>
<blockquote>
<p><strong>é‡è¦æç¤º</strong>ï¼šå¦‚æœæ‚¨å½“å‰ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæ§åˆ¶å°ç•Œé¢ï¼Œè¯·åŠ¡å¿…ç‚¹å‡»å³ä¸Šè§’çš„â€œæ–°ç‰ˆæ§åˆ¶å°â€æŒ‰é’®åˆ‡æ¢è‡³æœ€æ–°ç•Œé¢ï¼Œä»¥ç¡®ä¿åŠŸèƒ½å®Œæ•´æ€§ã€‚</p>
</blockquote>
<h3 data-id="heading-9">ä¸‰æ­¥æé€Ÿéƒ¨ç½²</h3>
<p><strong>æ­¥éª¤ä¸€</strong>ï¼šç™»å½•Â FunModel æ§åˆ¶å°ï¼Œè¿›å…¥ã€æ¨¡å‹å¸‚åœºã€‘ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2370d0d1b6344e498d59ad682c31b71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=dCRJ02iTt7VqjrfEGmjRjZjKE%2Bc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æ­¥éª¤äºŒ</strong>ï¼šåœ¨å·¦ä¾§é¡µç­¾å¯ä»¥é€‰æ‹©ä¸åŒçš„æ¨¡å‹åˆ†ç±»ï¼Œé€‰æ‹©æ¨¡å‹å¡ç‰‡ï¼Œå¯ä»¥åœ¨å³è¾¹æŸ¥çœ‹æ¨¡å‹è¯¦æƒ…ï¼Œå¹¶å¿«é€Ÿä½“éªŒæ¨¡å‹æ•ˆæœã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74c02c7c06fa4157a5fd5bc6d98f4386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=BourVRrfYyeUkAy7rb5%2FQgylXI4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a5cacb8eb1248e6834d31a8f8c1621b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=UL38G5J3aeh%2BxPN%2B0pAVeK0BJvQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æ­¥éª¤ä¸‰</strong>ï¼šç‚¹å‡»â€œç«‹å³éƒ¨ç½²â€ï¼Œå¡«å†™æ¨¡å‹åç§°ï¼ˆå»ºè®®åŒ…å«ä¸šåŠ¡å«ä¹‰ï¼Œå¦‚â€œocr-v1â€ï¼‰ï¼Œç¡®è®¤èµ„æºé…ç½®ï¼ˆç³»ç»Ÿä¼šæ ¹æ®æ¨¡å‹ç±»å‹æ™ºèƒ½æ¨èï¼‰ï¼Œç‚¹å‡»ç¡®è®¤ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54717568dc484891911c5e0290bb9561~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=%2BKFRNbBMdwLItBaKDvWyZmKLURk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83ece083a8b94d32b67f4c8889a12927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=ax2ufmWIqHFqFSTP6dMw5fcdmaQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç­‰å¾…å‡ åˆ†é’Ÿå³å¯å®Œæˆéƒ¨ç½²ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a12f3c198574f10b42fe7470f1f3291~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=NZB%2Bv1Vq%2BMwPwncqxA93Skwdjug%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f142ebacb7534eef90a8a6699c9619fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=fmYK87uzQh8An%2FCUoLUbM2lUbuU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<blockquote>
<p>å¦‚æœæœ‰æ›´å¤šéœ€æ±‚ï¼Œå¯ä»¥åœ¨ã€æ›´å¤šé…ç½®ã€‘ä¸­è‡ªå®šä¹‰é…ç½®é˜¿é‡Œäº‘å­˜å‚¨ Nasï¼Œæ¨¡å‹æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ç­‰å‚æ•°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62f6b0d0af55430ba4ea96d097c62e5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=Xe29oeFzTE7k7FbD4COleCfE2AY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
</blockquote>
<h3 data-id="heading-10">é«˜çº§ç©æ³•</h3>
<p><strong>æ¨¡å‹åœ¨çº¿è°ƒè¯•ï¼š</strong> éƒ¨ç½²å®Œæˆåï¼Œåˆ‡æ¢åˆ°â€œåœ¨çº¿è°ƒè¯•â€é¡µç­¾ï¼Œå¡«å†™å¯¹åº”çš„ API-Keyï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œç‚¹å‡»å‘é€è¯·æ±‚ï¼Œå³å¯åœ¨é¡µé¢å³ä¾§çœ‹åˆ°æ¨¡å‹è¿”å›ç»“æœï¼ŒåŒæ—¶æ”¯æŒä¿®æ”¹è¯·æ±‚å‚æ•°ï¼Œå¹¶ä¿å­˜åˆ°æ¨¡å‹æ¦‚è§ˆé¡µçš„ OpenAPISchema ä¸­ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db4efebd89974494a4836ffabd421050~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=jyZTwFzNi2Q7qB7wWqmz3TfZXiA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>API æ–‡æ¡£å¯¼å‡ºï¼š</strong> ä¸€é”®ç”Ÿæˆ JSON/YAML æ ¼å¼çš„ OpenAPI æ–‡æ¡£ã€‚æ”¯æŒå•ç‹¬ä¿®æ”¹ Schema å¹¶ä¿å­˜ï¼Œè®©æ¥å£å®šä¹‰æ›´ç²¾å‡†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd9a29844d6b403ebb15f5b1cabc523e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=Nu9fBgJOq8By4uYxReTa3iCMWns%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e1f2d397a974f2986bf09afc71cdd75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=%2BpvgO4vbDZPDdGa%2BYyXUSXNXFXU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-11">è¾“å…¥æ¨¡å‹ ID éƒ¨ç½²æ¨¡å‹</h3>
<blockquote>
<p>è‡ªå®šä¹‰æ¨¡å‹éƒ¨ç½²åŠŸèƒ½å…è®¸ç”¨æˆ·éƒ¨ç½²è‡ªå·±çš„æ¨¡å‹æˆ–ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ä»¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚ æ›´å¤šæœ‰å…³ä½¿ç”¨ vLLMã€SGLang å’Œè‡ªå®šä¹‰é•œåƒç­‰æ–¹å¼éƒ¨ç½²æ¨¡å‹çš„è¯¦æƒ…è§è‡ªå®šä¹‰éƒ¨ç½²æ¨¡å‹ <strong>[</strong> <strong>2]</strong> ã€‚</p>
</blockquote>
<p>é€‰æ‹©ã€è‡ªå®šä¹‰å¼€å‘ã€‘é¡µç­¾ï¼Œã€æ¨¡å‹æ¥æºã€‘é€‰æ‹©ã€ModelScope æ¨¡å‹ IDã€‘ï¼Œå¡«å…¥æ¨¡å‹ IDï¼Œä»¥ iic/nlp_structbert_word-segmentation_chinese-base ä¸ºä¾‹ï¼Œç‚¹å‡»ç«‹å³éƒ¨ç½²ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13055d5c9f1b4fca905dae00704ea167~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=KR9E4Dw%2Bx08UWexfWZHhtDAb3d4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5f0ecc9607749a89e330c12402d5dc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=8j6cwS83VqwMivG9nlgXrUZXb0g%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d69afd6f95e74de6ae7e2985d92e17fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367749&amp;x-signature=8j6eIpcZUE6WHOufT%2BLU7oWpLY8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>FunModel ä¾æ‰˜ Serverless + GPUï¼Œå¤©ç„¶æä¾›äº†ç®€å•ï¼Œè½»é‡ï¼Œ0 é—¨æ§›çš„æ¨¡å‹é›†æˆæ–¹æ¡ˆï¼Œç»™ä¸ªäººå¼€å‘è€…è‰¯å¥½çš„ç©è½¬æ¨¡å‹çš„ä½“éªŒï¼Œä¹Ÿè®©ä¼ä¸šçº§å¼€å‘è€…å¿«é€Ÿé«˜æ•ˆçš„éƒ¨ç½²ã€è¿ç»´å’Œè¿­ä»£æ¨¡å‹ã€‚</p>
<p>åœ¨é˜¿é‡Œäº‘ FunModel å¹³å°ï¼Œå¼€å‘è€…å¯ä»¥åšåˆ°ï¼š</p>
<ul>
<li><strong>æ¨¡å‹çš„å¿«é€Ÿéƒ¨ç½²ä¸Šçº¿ï¼š</strong> ä»åŸæ¥çš„ä»¥å‘¨ä¸ºå•ä½çš„æ¨¡å‹æ¥å…¥å‘¨æœŸé™ä½åˆ° 5 åˆ†é’Ÿï¼Œ0 å¼€å‘ï¼Œæ— æ’æœŸã€‚</li>
<li><strong>ä¸€é”®æ‰©ç¼©å®¹ï¼Œè®©è¿ç»´ä¸å†æ˜¯è´Ÿæ‹…ï¼š</strong> å¤šç§æ‰©ç¼©å®¹ç­–ç•¥é«˜åº¦é€‚é…ä¸šåŠ¡æµé‡ï¼Œå®ç°â€œæ— ç—›è¿ç»´â€ã€‚</li>
</ul>
<p>åœ¨ AI çš„æ—¶ä»£æµªæ½®ä¸‹ï¼Œæ¨¡å‹ä½œä¸º AI çš„è½½ä½“å¿…ç„¶ä¼šä¸æ–­è¿­ä»£ï¼Œå¼€å‘è€…å¯¹æ¨¡å‹éƒ¨ç½²çš„éœ€æ±‚ä¹Ÿä¼šæ—¥ç›Šå¢å¤šï¼ŒFunModel ä½œä¸ºæ¨¡å‹é›†æˆå’Œéƒ¨ç½²çš„æ–°èŒƒå¼ï¼Œä¹Ÿä¼šæœç€â€œè®©äººäººæˆä¸ºå¼€å‘è€…â€çš„ç›®æ ‡æ¼”è¿›ä¸‹å»ã€‚</p>
<p><strong>æ›´å¤šå†…å®¹è¯·å‚è€ƒï¼š</strong></p>
<p>FunModelå¿«é€Ÿå…¥é—¨</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Ffun-model-docs.devsapp.net%2Fgetting-started%2F" target="_blank" title="http://fun-model-docs.devsapp.net/getting-started/" ref="nofollow noopener noreferrer">fun-model-docs.devsapp.net/getting-staâ€¦</a></p>
<p>FunModel è‡ªå®šä¹‰éƒ¨ç½²</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Ffun-model-docs.devsapp.net%2Fuser-guide%2Fcustom-model-deployment%2F" target="_blank" title="http://fun-model-docs.devsapp.net/user-guide/custom-model-deployment/" ref="nofollow noopener noreferrer">fun-model-docs.devsapp.net/user-guide/â€¦</a></p>
<p>modelscopeé­”æ­å¹³å°</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2F" target="_blank" title="https://www.modelscope.cn/" ref="nofollow noopener noreferrer">www.modelscope.cn/</a></p>
<p><strong>ç›¸å…³é“¾æ¥ï¼š</strong></p>
<p>[1]Â FunModel æ§åˆ¶å°</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffunctionai.console.aliyun.com%2Fcn-hangzhou%2Ffun-model%2Fmodel-market" target="_blank" title="https://functionai.console.aliyun.com/cn-hangzhou/fun-model/model-market" ref="nofollow noopener noreferrer">functionai.console.aliyun.com/cn-hangzhouâ€¦</a></p>
<p>[2]Â è‡ªå®šä¹‰éƒ¨ç½²æ¨¡å‹</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Ffun-model-docs.devsapp.net%2Fuser-guide%2Fcustom-model-deployment%2F" target="_blank" title="http://fun-model-docs.devsapp.net/user-guide/custom-model-deployment/" ref="nofollow noopener noreferrer">fun-model-docs.devsapp.net/user-guide/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uniappä¹‹WebViewå®¹å™¨åŸç†è¯¦è§£]]></title>    <link>https://juejin.cn/post/7570866247979728948</link>    <guid>https://juejin.cn/post/7570866247979728948</guid>    <pubDate>2025-11-10T08:30:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570866247979728948" data-draft-id="7570866247979712564" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniappä¹‹WebViewå®¹å™¨åŸç†è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-10T08:30:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniappä¹‹WebViewå®¹å™¨åŸç†è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:30:57.000Z" title="Mon Nov 10 2025 08:30:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>
<h2 data-id="heading-0">UniApp WebViewå®¹å™¨åŸç†è¯¦è§£</h2>
<h3 data-id="heading-1">ä¸€ã€WebViewå®¹å™¨æ¦‚è¿°</h3>
<p>UniAppä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°è·¨å¹³å°å¼€å‘ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯"uniapp ä¸»è¦æ˜¯è¿è¡Œåœ¨webviewå®¹å™¨ä¸­çš„"ã€‚è¿™å¥è¯æ­ç¤ºäº†UniAppçš„åº•å±‚æ¶æ„ï¼šå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºWebViewçš„æ··åˆåº”ç”¨æ¡†æ¶ã€‚</p>
<h4 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯WebViewå®¹å™¨</h4>
<p>WebViewæ˜¯ä¸€ç§ç³»ç»Ÿç»„ä»¶ï¼Œå¯ä»¥åµŒå…¥åˆ°åŸç”Ÿåº”ç”¨ä¸­ï¼Œç”¨äºæ˜¾ç¤ºç½‘é¡µå†…å®¹ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿·ä½ æµè§ˆå™¨ï¼Œæä¾›äº†ç½‘é¡µæ¸²æŸ“ã€JavaScriptæ‰§è¡Œç¯å¢ƒä»¥åŠä¸åŸç”ŸåŠŸèƒ½çš„æ¡¥æ¥èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebViewçš„åŸºæœ¬ç»“æ„ï¼ˆæ¦‚å¿µå›¾ï¼‰</span>
+---------------------------+
|      åŸç”Ÿåº”ç”¨å¤–å£³         |
|  +---------------------+  |
|  |                     |  |
|  |    <span class="hljs-title class_">WebView</span>å®¹å™¨      |  |
|  |                     |  |
|  |  +---------------+  |  |
|  |  |   <span class="hljs-variable constant_">HTML</span>/<span class="hljs-variable constant_">CSS</span>/<span class="hljs-variable constant_">JS</span> |  |  |
|  |  +---------------+  |  |
|  |                     |  |
|  +---------------------+  |
|                           |
+---------------------------+
</code></pre>
<h4 data-id="heading-3">1.2 UniAppä¸WebViewçš„å…³ç³»</h4>
<p>UniAppåˆ©ç”¨WebViewä½œä¸ºè¿è¡Œç¯å¢ƒï¼Œå°†Vueä»£ç ç¼–è¯‘æˆå¯åœ¨WebViewä¸­è¿è¡Œçš„HTML/CSS/JavaScriptä»£ç ï¼Œç„¶åé€šè¿‡åŸç”Ÿå¤–å£³åŒ…è£…æˆè·¨å¹³å°åº”ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniAppåº”ç”¨æ¶æ„ï¼ˆæ¦‚å¿µå›¾ï¼‰</span>
+------------------------------------------------------+
|                  <span class="hljs-title class_">UniApp</span>åº”ç”¨                          |
|  +----------------+  +----------------+  +---------+ |
|  |   <span class="hljs-title class_">Android</span>å¤–å£³  |  |    iOSå¤–å£³     |  | <span class="hljs-variable constant_">H5</span>å¤–å£³  | |
|  |                |  |                |  |         | |
|  |  +----------+  |  |  +----------+  |  |  æµè§ˆå™¨  | |
|  |  | <span class="hljs-title class_">WebView</span>  |  |  |  | <span class="hljs-title class_">WebView</span>  |  |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |       |         |  |       |         |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  <span class="hljs-title class_">UniApp</span> | |
|  |  | è¿è¡Œæ—¶   |  |  |  | è¿è¡Œæ—¶   |  |  |  è¿è¡Œæ—¶ | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  +----------------+  +----------------+  +---------+ |
+------------------------------------------------------+
</code></pre>
<h3 data-id="heading-4">äºŒã€WebViewå®¹å™¨çš„å·¥ä½œåŸç†</h3>
<h4 data-id="heading-5">2.1 æ¸²æŸ“æœºåˆ¶</h4>
<p>UniAppåœ¨WebViewå®¹å™¨ä¸­çš„æ¸²æŸ“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniAppæ¸²æŸ“æµç¨‹ï¼ˆä¼ªä»£ç ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderUniApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. Vueæ¨¡æ¿ç¼–è¯‘</span>
  <span class="hljs-keyword">const</span> template = <span class="hljs-title function_">compileVueTemplate</span>();
  
  <span class="hljs-comment">// 2. ç”Ÿæˆè™šæ‹ŸDOM</span>
  <span class="hljs-keyword">const</span> vdom = <span class="hljs-title function_">createVirtualDOM</span>(template);
  
  <span class="hljs-comment">// 3. è½¬æ¢ä¸ºçœŸå®DOM</span>
  <span class="hljs-keyword">const</span> dom = <span class="hljs-title function_">createRealDOM</span>(vdom);
  
  <span class="hljs-comment">// 4. WebViewæ¸²æŸ“DOM</span>
  webView.<span class="hljs-title function_">render</span>(dom);
  
  <span class="hljs-comment">// 5. åº”ç”¨æ ·å¼</span>
  <span class="hljs-title function_">applyCSSStyles</span>();
}
</code></pre>
<h4 data-id="heading-6">2.2 JavaScriptæ‰§è¡Œç¯å¢ƒ</h4>
<p>UniAppçš„JavaScriptä»£ç åœ¨WebViewçš„JavaScriptå¼•æ“ä¸­æ‰§è¡Œï¼Œä¸åŒå¹³å°ä½¿ç”¨ä¸åŒçš„å¼•æ“ï¼š</p>
<ul>
<li><strong>Android</strong>: é€šå¸¸ä½¿ç”¨V8å¼•æ“</li>
<li><strong>iOS</strong>: ä½¿ç”¨JavaScriptCore</li>
<li><strong>H5</strong>: ä½¿ç”¨æµè§ˆå™¨çš„JavaScriptå¼•æ“</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniApp JavaScriptæ‰§è¡Œç¯å¢ƒï¼ˆæ¦‚å¿µå›¾ï¼‰</span>
+---------------------------+
|      <span class="hljs-title class_">WebView</span>å®¹å™¨         |
|                           |
|  +---------------------+  |
|  |  <span class="hljs-title class_">JavaScript</span>å¼•æ“      |  |
|  |                     |  |
|  |  +-----------------+ |  |
|  |  |   <span class="hljs-title class_">UniApp</span>æ¡†æ¶    | |  |
|  |  |                 | |  |
|  |  |  +-------------+ | |  |
|  |  |  |   <span class="hljs-title class_">Vue</span>ä»£ç    | | |  |
|  |  |  +-------------+ | |  |
|  |  |                 | |  |
|  |  |  +-------------+ | |  |
|  |  |  |   <span class="hljs-variable constant_">API</span>æ¡¥æ¥   | | |  |
|  |  |  +-------------+ | |  |
|  |  +-----------------+ |  |
|  +---------------------+  |
+---------------------------+
</code></pre>
<h4 data-id="heading-7">2.3 åŸç”Ÿèƒ½åŠ›æ¡¥æ¥</h4>
<p>UniAppé€šè¿‡æ¡¥æ¥æœºåˆ¶å®ç°JavaScriptä¸åŸç”ŸåŠŸèƒ½çš„äº¤äº’ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UniAppåŸç”Ÿæ¡¥æ¥æœºåˆ¶ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UniBridge</span> {
  <span class="hljs-comment">// è°ƒç”¨åŸç”ŸåŠŸèƒ½</span>
  <span class="hljs-title function_">callNative</span>(<span class="hljs-params">api, params, callback</span>) {
    <span class="hljs-comment">// 1. å°†è°ƒç”¨å‚æ•°åºåˆ—åŒ–</span>
    <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">api</span>: api,
      <span class="hljs-attr">params</span>: params,
      <span class="hljs-attr">callbackId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateCallbackId</span>()
    });
    
    <span class="hljs-comment">// 2. é€šè¿‡WebViewæ¥å£å‘é€æ¶ˆæ¯åˆ°åŸç”Ÿ</span>
    <span class="hljs-keyword">if</span> (isAndroid) {
      androidInterface.<span class="hljs-title function_">postMessage</span>(message);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isIOS) {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkit</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-property">iosInterface</span>.<span class="hljs-title function_">postMessage</span>(message);
    }
    
    <span class="hljs-comment">// 3. æ³¨å†Œå›è°ƒå‡½æ•°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerCallback</span>(callbackId, callback);
  }
  
  <span class="hljs-comment">// æ¥æ”¶åŸç”Ÿå›è°ƒ</span>
  <span class="hljs-title function_">onNativeCallback</span>(<span class="hljs-params">callbackId, result</span>) {
    <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCallback</span>(callbackId);
    <span class="hljs-keyword">if</span> (callback) {
      <span class="hljs-title function_">callback</span>(result);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unregisterCallback</span>(callbackId);
    }
  }
}
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€WebViewå®¹å™¨çš„ä¼˜åŠ¿</h3>
<h4 data-id="heading-9">3.1 è·¨å¹³å°èƒ½åŠ›</h4>
<p>WebViewå®¹å™¨æ˜¯æ‰€æœ‰ç°ä»£ç§»åŠ¨æ“ä½œç³»ç»Ÿéƒ½æä¾›çš„æ ‡å‡†ç»„ä»¶ï¼Œè¿™ä½¿å¾—UniAppèƒ½å¤Ÿå®ç°çœŸæ­£çš„"ä¸€æ¬¡å¼€å‘ï¼Œå¤šç«¯è¿è¡Œ"ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·¨å¹³å°ä»£ç ç¤ºä¾‹</span>
<span class="hljs-comment">// è¿™æ®µä»£ç å¯ä»¥åœ¨Androidã€iOSå’ŒH5ç¯å¢ƒä¸­è¿è¡Œ</span>
uni.<span class="hljs-title function_">showToast</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-string">'æç¤ºä¿¡æ¯'</span>,
  <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>,
  <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>
});

<span class="hljs-comment">// UniAppç¼–è¯‘åçš„ä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showToast</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-comment">// æ ¹æ®å¹³å°è°ƒç”¨ä¸åŒçš„å®ç°</span>
  <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">'android'</span>) {
    <span class="hljs-comment">// é€šè¿‡æ¡¥æ¥è°ƒç”¨AndroidåŸç”ŸToast</span>
    <span class="hljs-title class_">UniBridge</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'showToast'</span>, options);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">'ios'</span>) {
    <span class="hljs-comment">// é€šè¿‡æ¡¥æ¥è°ƒç”¨iOSåŸç”ŸToast</span>
    <span class="hljs-title class_">UniBridge</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'showToast'</span>, options);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// H5ç¯å¢ƒä½¿ç”¨Webå®ç°</span>
    <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    toast.<span class="hljs-property">textContent</span> = options.<span class="hljs-property">title</span>;
    toast.<span class="hljs-property">className</span> = <span class="hljs-string">'uni-toast'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast);
    
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(toast);
    }, options.<span class="hljs-property">duration</span>);
  }
}
</code></pre>
<h4 data-id="heading-10">3.2 å¼€å‘æ•ˆç‡</h4>
<p>åŸºäºWebViewçš„å¼€å‘æ¨¡å¼å…è®¸å¼€å‘è€…ä½¿ç”¨WebæŠ€æœ¯æ ˆï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ï¼š</p>
<ul>
<li><strong>ç†Ÿæ‚‰çš„å¼€å‘è¯­è¨€</strong>: HTML/CSS/JavaScript</li>
<li><strong>ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ</strong>: NPMåŒ…ã€å‰ç«¯æ¡†æ¶ç­‰</li>
<li><strong>çƒ­æ›´æ–°èƒ½åŠ›</strong>: æ— éœ€é‡æ–°å®‰è£…åº”ç”¨å³å¯æ›´æ–°ä»£ç </li>
<li><strong>è°ƒè¯•ä¾¿åˆ©</strong>: å¯ä»¥ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·è¿›è¡Œè°ƒè¯•</li>
</ul>
<h4 data-id="heading-11">3.3 æˆæœ¬ä¼˜åŠ¿</h4>
<ul>
<li><strong>äººåŠ›æˆæœ¬</strong>: ä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼Œå‡å°‘å¼€å‘äººå‘˜æ•°é‡</li>
<li><strong>æ—¶é—´æˆæœ¬</strong>: åŒæ—¶å‘å¸ƒåˆ°å¤šä¸ªå¹³å°ï¼Œç¼©çŸ­å¼€å‘å‘¨æœŸ</li>
<li><strong>ç»´æŠ¤æˆæœ¬</strong>: ç»Ÿä¸€ä»£ç åº“ï¼Œé™ä½ç»´æŠ¤å¤æ‚åº¦</li>
</ul>
<h3 data-id="heading-12">å››ã€WebViewå®¹å™¨çš„å±€é™æ€§</h3>
<h4 data-id="heading-13">4.1 æ€§èƒ½é™åˆ¶</h4>
<p>WebViewå®¹å™¨çš„æ€§èƒ½ç›¸æ¯”åŸç”Ÿåº”ç”¨æœ‰ä¸€å®šå·®è·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€§èƒ½å¯¹æ¯”ï¼ˆæ¦‚å¿µæ•°æ®ï¼‰</span>
<span class="hljs-keyword">const</span> performanceComparison = {
  <span class="hljs-string">'åŸç”Ÿåº”ç”¨'</span>: {
    <span class="hljs-string">'å¯åŠ¨é€Ÿåº¦'</span>: <span class="hljs-string">'100%'</span>,
    <span class="hljs-string">'æ¸²æŸ“æ€§èƒ½'</span>: <span class="hljs-string">'100%'</span>,
    <span class="hljs-string">'å†…å­˜å ç”¨'</span>: <span class="hljs-string">'100%'</span>,
    <span class="hljs-string">'CPUä½¿ç”¨'</span>: <span class="hljs-string">'100%'</span>
  },
  <span class="hljs-string">'WebViewåº”ç”¨'</span>: {
    <span class="hljs-string">'å¯åŠ¨é€Ÿåº¦'</span>: <span class="hljs-string">'70-80%'</span>,
    <span class="hljs-string">'æ¸²æŸ“æ€§èƒ½'</span>: <span class="hljs-string">'60-80%'</span>,
    <span class="hljs-string">'å†…å­˜å ç”¨'</span>: <span class="hljs-string">'120-150%'</span>,
    <span class="hljs-string">'CPUä½¿ç”¨'</span>: <span class="hljs-string">'110-130%'</span>
  }
};
</code></pre>
<h4 data-id="heading-14">4.2 åŠŸèƒ½é™åˆ¶</h4>
<p>æŸäº›åŸç”ŸåŠŸèƒ½åœ¨WebViewä¸­éš¾ä»¥å®ç°æˆ–æ€§èƒ½ä¸ä½³ï¼š</p>
<ul>
<li><strong>å¤æ‚åŠ¨ç”»</strong>: CSSåŠ¨ç”»å’ŒJavaScriptåŠ¨ç”»æ€§èƒ½ä¸å¦‚åŸç”ŸåŠ¨ç”»</li>
<li><strong>å¤§é‡æ•°æ®å¤„ç†</strong>: JavaScriptå¤„ç†å¤§æ•°æ®çš„èƒ½åŠ›æœ‰é™</li>
<li><strong>å›¾å½¢æ¸²æŸ“</strong>: å¤æ‚å›¾å½¢å’Œæ¸¸æˆæ¸²æŸ“æ€§èƒ½ä¸è¶³</li>
<li><strong>åå°ä»»åŠ¡</strong>: WebViewåœ¨åå°æ—¶æ‰§è¡Œèƒ½åŠ›å—é™</li>
</ul>
<h4 data-id="heading-15">4.3 å¹³å°å·®å¼‚</h4>
<p>å°½ç®¡WebViewæ˜¯æ ‡å‡†ç»„ä»¶ï¼Œä½†ä¸åŒå¹³å°çš„å®ç°ä»æœ‰å·®å¼‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¹³å°å·®å¼‚ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePlatformDifferences</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// Android WebViewç‰¹æœ‰é—®é¢˜</span>
  <span class="hljs-keyword">if</span> (isAndroid) {
    <span class="hljs-comment">// å¤„ç†Android WebViewçš„å…¼å®¹æ€§é—®é¢˜</span>
    <span class="hljs-title function_">fixAndroidWebViewIssues</span>();
  }
  
  <span class="hljs-comment">// iOS WebViewç‰¹æœ‰é—®é¢˜</span>
  <span class="hljs-keyword">if</span> (isIOS) {
    <span class="hljs-comment">// å¤„ç†iOS WebViewçš„å…¼å®¹æ€§é—®é¢˜</span>
    <span class="hljs-title function_">fixIOSWebViewIssues</span>();
  }
  
  <span class="hljs-comment">// ä¸åŒç‰ˆæœ¬çš„WebViewä¹Ÿæœ‰å·®å¼‚</span>
  <span class="hljs-title function_">handleWebViewVersionDifferences</span>();
}
</code></pre>
<h3 data-id="heading-16">äº”ã€UniAppå¯¹WebViewå®¹å™¨çš„ä¼˜åŒ–</h3>
<h4 data-id="heading-17">5.1 æ¸²æŸ“ä¼˜åŒ–</h4>
<p>UniAppé€šè¿‡å¤šç§æ–¹å¼ä¼˜åŒ–WebViewçš„æ¸²æŸ“æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¸²æŸ“ä¼˜åŒ–ç­–ç•¥</span>
<span class="hljs-keyword">const</span> renderingOptimizations = {
  <span class="hljs-comment">// 1. è™šæ‹Ÿåˆ—è¡¨</span>
  <span class="hljs-attr">virtualList</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'åªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„å…ƒç´ '</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'ä½¿ç”¨uni-listç»„ä»¶å®ç°è™šæ‹Ÿæ»šåŠ¨'</span>
  },
  
  <span class="hljs-comment">// 2. æ‡’åŠ è½½</span>
  <span class="hljs-attr">lazyLoading</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'å»¶è¿ŸåŠ è½½éå…³é”®èµ„æº'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'ä½¿ç”¨uni.lazyLoadå›¾ç‰‡æ‡’åŠ è½½'</span>
  },
  
  <span class="hljs-comment">// 3. å‡å°‘é‡æ’é‡ç»˜</span>
  <span class="hljs-attr">reduceReflow</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'æ‰¹é‡æ›´æ–°DOMï¼Œå‡å°‘é‡æ’é‡ç»˜'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'ä½¿ç”¨setDataæ‰¹é‡æ›´æ–°æ•°æ®'</span>
  },
  
  <span class="hljs-comment">// 4. CSSä¼˜åŒ–</span>
  <span class="hljs-attr">cssOptimization</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">'ä½¿ç”¨é«˜æ•ˆçš„CSSé€‰æ‹©å™¨å’Œå±æ€§'</span>,
    <span class="hljs-attr">implementation</span>: <span class="hljs-string">'é¿å…å¤æ‚é€‰æ‹©å™¨ï¼Œä½¿ç”¨transformå’Œopacity'</span>
  }
};
</code></pre>
<h4 data-id="heading-18">5.2 å†…å­˜ç®¡ç†</h4>
<p>é’ˆå¯¹WebViewå†…å­˜å ç”¨é«˜çš„é—®é¢˜ï¼ŒUniAppæä¾›äº†å¤šç§ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å†…å­˜ç®¡ç†ä¼˜åŒ–</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeMemoryUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. åŠæ—¶é‡Šæ”¾èµ„æº</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanupResources</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡</span>
    unusedObjects = <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// å–æ¶ˆæœªå®Œæˆçš„ç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-title function_">cancelPendingRequests</span>();
    
    <span class="hljs-comment">// ç§»é™¤äº‹ä»¶ç›‘å¬å™¨</span>
    <span class="hljs-title function_">removeEventListeners</span>();
  }
  
  <span class="hljs-comment">// 2. å›¾ç‰‡å†…å­˜ä¼˜åŒ–</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeImageMemory</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ä½¿ç”¨é€‚å½“çš„å›¾ç‰‡æ ¼å¼å’Œå°ºå¯¸</span>
    <span class="hljs-title function_">useOptimizedImageFormat</span>();
    
    <span class="hljs-comment">// åŠæ—¶é‡Šæ”¾å›¾ç‰‡èµ„æº</span>
    <span class="hljs-title function_">releaseImageResources</span>();
  }
  
  <span class="hljs-comment">// 3. æ•°æ®ç¼“å­˜ä¼˜åŒ–</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeDataCache</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// é™åˆ¶ç¼“å­˜å¤§å°</span>
    <span class="hljs-title function_">limitCacheSize</span>();
    
    <span class="hljs-comment">// ä½¿ç”¨LRUç¼“å­˜ç­–ç•¥</span>
    <span class="hljs-title function_">implementLRUCache</span>();
  }
}
</code></pre>
<h4 data-id="heading-19">5.3 åŸç”Ÿèƒ½åŠ›å¢å¼º</h4>
<p>UniAppé€šè¿‡åŸç”Ÿæ’ä»¶æœºåˆ¶å¼¥è¡¥WebViewçš„åŠŸèƒ½é™åˆ¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŸç”Ÿæ’ä»¶æœºåˆ¶ï¼ˆæ¦‚å¿µå›¾ï¼‰</span>
+------------------------------------------------------+
|                  <span class="hljs-title class_">UniApp</span>åº”ç”¨                          |
|  +----------------+  +----------------+  +---------+ |
|  |   <span class="hljs-title class_">Android</span>å¤–å£³  |  |    iOSå¤–å£³     |  | <span class="hljs-variable constant_">H5</span>å¤–å£³  | |
|  |                |  |                |  |         | |
|  |  +----------+  |  |  +----------+  |  |  æµè§ˆå™¨  | |
|  |  | <span class="hljs-title class_">WebView</span>  |  |  |  | <span class="hljs-title class_">WebView</span>  |  |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |       |         |  |       |         |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  | <span class="hljs-title class_">UniApp</span>   |  |  |  <span class="hljs-title class_">UniApp</span> | |
|  |  | è¿è¡Œæ—¶   |  |  |  | è¿è¡Œæ—¶   |  |  |  è¿è¡Œæ—¶ | |
|  |  +----+-----+  |  |  +----+-----+  |  |         | |
|  |       |         |  |       |         |  |         | |
|  |  +----v-----+  |  |  +----v-----+  |  |         | |
|  |  | åŸç”Ÿæ’ä»¶  |  |  |  | åŸç”Ÿæ’ä»¶  |  |  |         | |
|  |  +----------+  |  |  +----------+  |  |         | |
|  +----------------+  +----------------+  +---------+ |
+------------------------------------------------------+
</code></pre>
<h3 data-id="heading-20">å…­ã€æ€»ç»“</h3>
<p>"uniapp ä¸»è¦æ˜¯è¿è¡Œåœ¨webviewå®¹å™¨ä¸­çš„"è¿™å¥è¯æ­ç¤ºäº†UniAppçš„æ ¸å¿ƒæ¶æ„åŸç†ã€‚é€šè¿‡WebViewå®¹å™¨ï¼ŒUniAppå®ç°äº†è·¨å¹³å°èƒ½åŠ›ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨WebæŠ€æœ¯æ ˆå¼€å‘ç§»åŠ¨åº”ç”¨ã€‚è¿™ç§æ¶æ„æ—¢æœ‰ä¼˜åŠ¿ï¼ˆè·¨å¹³å°ã€å¼€å‘æ•ˆç‡é«˜ã€æˆæœ¬ä½ï¼‰ï¼Œä¹Ÿæœ‰å±€é™æ€§ï¼ˆæ€§èƒ½é™åˆ¶ã€åŠŸèƒ½é™åˆ¶ã€å¹³å°å·®å¼‚ï¼‰ã€‚</p>
<p>UniAppé€šè¿‡æ¸²æŸ“ä¼˜åŒ–ã€å†…å­˜ç®¡ç†å’ŒåŸç”Ÿæ’ä»¶ç­‰æ–¹å¼ï¼Œä¸æ–­å¼¥è¡¥WebViewå®¹å™¨çš„ä¸è¶³ï¼Œæå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ç†è§£WebViewå®¹å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰åŠ©äºå¼€å‘è€…æ›´å¥½åœ°ä½¿ç”¨UniAppæ¡†æ¶ï¼Œå¼€å‘å‡ºé«˜è´¨é‡çš„è·¨å¹³å°åº”ç”¨ã€‚</p>
<p>å¯¹äºç‰©æµå…ƒå®‡å®™PDAé¡¹ç›®è¿™æ ·çš„åº”ç”¨ï¼Œç†è§£WebViewå®¹å™¨çš„åŸç†å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºPDAè®¾å¤‡é€šå¸¸èµ„æºæœ‰é™ï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨å†…å­˜å ç”¨å’Œæ€§èƒ½ä¼˜åŒ–ã€‚é€šè¿‡åˆç†ä½¿ç”¨UniAppæä¾›çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨WebViewå®¹å™¨ä¸­å®ç°æµç•…çš„ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶ä¿æŒè·¨å¹³å°çš„ä¼˜åŠ¿ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeekå°åº¦è‚¡ç¥¨æ•°æ®æº Java å¯¹æ¥æ–‡æ¡£]]></title>    <link>https://juejin.cn/post/7570902804450312202</link>    <guid>https://juejin.cn/post/7570902804450312202</guid>    <pubDate>2025-11-10T08:32:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804450312202" data-draft-id="7570579125154922506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeekå°åº¦è‚¡ç¥¨æ•°æ®æº Java å¯¹æ¥æ–‡æ¡£"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T08:32:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CryptoRzz"/> <meta itemprop="url" content="https://juejin.cn/user/402879809850410"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeekå°åº¦è‚¡ç¥¨æ•°æ®æº Java å¯¹æ¥æ–‡æ¡£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/402879809850410/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CryptoRzz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:32:42.000Z" title="Mon Nov 10 2025 08:32:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ“‹ æ–‡æ¡£æ¦‚è¿°</h2>
<p>æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Java è¯­è¨€å¯¹æ¥ StockTV å°åº¦è‚¡ç¥¨æ•°æ®æºï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç ç¤ºä¾‹ã€æ•°æ®æ¨¡å‹ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚</p>
<h2 data-id="heading-1">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
<h3 data-id="heading-2">ç¯å¢ƒè¦æ±‚</h3>
<ul>
<li>JDK 8+</li>
<li>Maven 3.6+</li>
<li>ç½‘ç»œè¿æ¥ï¼ˆå¯è®¿é—® <code>api.stocktv.top</code>ï¼‰</li>
</ul>
<h3 data-id="heading-3">é¡¹ç›®ä¾èµ–</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- HTTPå®¢æˆ·ç«¯ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- JSONå¤„ç† --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.15.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- æ—¥å¿—æ¡†æ¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-simple<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- Lombokï¼ˆå¯é€‰ï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.28<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h2 data-id="heading-4">ğŸ—ï¸ æ ¸å¿ƒæ¶æ„</h2>
<h3 data-id="heading-5">é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/java/com/stocktv/india/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ StockTVConfig<span class="hljs-selector-class">.java</span>
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ Stock<span class="hljs-selector-class">.java</span>
â”‚   â”œâ”€â”€ Index<span class="hljs-selector-class">.java</span>
â”‚   â”œâ”€â”€ KLine<span class="hljs-selector-class">.java</span>
â”‚   â””â”€â”€ ApiResponse<span class="hljs-selector-class">.java</span>
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ StockTVHttpClient<span class="hljs-selector-class">.java</span>
â”‚   â””â”€â”€ StockTVWebSocketClient<span class="hljs-selector-class">.java</span>
â”œâ”€â”€ service/
â”‚   â””â”€â”€ IndiaStockService<span class="hljs-selector-class">.java</span>
â””â”€â”€ demo/
    â””â”€â”€ IndiaStockDemo<span class="hljs-selector-class">.java</span>
</code></pre>
<h2 data-id="heading-6">ğŸ“¦ æ ¸å¿ƒä»£ç å®ç°</h2>
<h3 data-id="heading-7">1. é…ç½®ç±»</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.config;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;

<span class="hljs-comment">/**
 * StockTV API é…ç½®ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockTVConfig</span> {
    
    <span class="hljs-comment">// API åŸºç¡€é…ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BASE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.stocktv.top"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">WS_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"wss://ws-api.stocktv.top/connect"</span>;
    
    <span class="hljs-comment">// å°åº¦å¸‚åœºé…ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INDIA_COUNTRY_ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NSE_EXCHANGE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">46</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BSE_EXCHANGE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">74</span>;
    
    <span class="hljs-comment">// API Key</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String apiKey;
    
    <span class="hljs-comment">// HTTP å®¢æˆ·ç«¯å’ŒJSONå¤„ç†å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CloseableHttpClient httpClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectMapper objectMapper;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StockTVConfig</span><span class="hljs-params">(String apiKey)</span> {
        <span class="hljs-built_in">this</span>.apiKey = apiKey;
        <span class="hljs-built_in">this</span>.httpClient = HttpClients.createDefault();
        <span class="hljs-built_in">this</span>.objectMapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
        <span class="hljs-comment">// é…ç½®ObjectMapper</span>
        <span class="hljs-built_in">this</span>.objectMapper.findAndRegisterModules();
    }
    
    <span class="hljs-comment">// Getteræ–¹æ³•</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getApiKey</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> apiKey; }
    <span class="hljs-keyword">public</span> CloseableHttpClient <span class="hljs-title function_">getHttpClient</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> httpClient; }
    <span class="hljs-keyword">public</span> ObjectMapper <span class="hljs-title function_">getObjectMapper</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> objectMapper; }
}
</code></pre>
<h3 data-id="heading-8">2. æ•°æ®æ¨¡å‹ç±»</h3>
<h4 data-id="heading-9">è‚¡ç¥¨æ•°æ®æ¨¡å‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.model;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.Instant;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.time.ZoneId;

<span class="hljs-comment">/**
 * å°åº¦è‚¡ç¥¨æ•°æ®æ¨¡å‹
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> {
    <span class="hljs-meta">@JsonProperty("id")</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@JsonProperty("symbol")</span>
    <span class="hljs-keyword">private</span> String symbol;
    
    <span class="hljs-meta">@JsonProperty("name")</span>
    <span class="hljs-keyword">private</span> String name;
    
    <span class="hljs-meta">@JsonProperty("last")</span>
    <span class="hljs-keyword">private</span> BigDecimal lastPrice;
    
    <span class="hljs-meta">@JsonProperty("chg")</span>
    <span class="hljs-keyword">private</span> BigDecimal change;
    
    <span class="hljs-meta">@JsonProperty("chgPct")</span>
    <span class="hljs-keyword">private</span> BigDecimal changePercent;
    
    <span class="hljs-meta">@JsonProperty("high")</span>
    <span class="hljs-keyword">private</span> BigDecimal high;
    
    <span class="hljs-meta">@JsonProperty("low")</span>
    <span class="hljs-keyword">private</span> BigDecimal low;
    
    <span class="hljs-meta">@JsonProperty("volume")</span>
    <span class="hljs-keyword">private</span> Long volume;
    
    <span class="hljs-meta">@JsonProperty("open")</span>
    <span class="hljs-keyword">private</span> Boolean isOpen;
    
    <span class="hljs-meta">@JsonProperty("exchangeId")</span>
    <span class="hljs-keyword">private</span> Integer exchangeId;
    
    <span class="hljs-meta">@JsonProperty("countryId")</span>
    <span class="hljs-keyword">private</span> Integer countryId;
    
    <span class="hljs-meta">@JsonProperty("time")</span>
    <span class="hljs-keyword">private</span> Long timestamp;
    
    <span class="hljs-meta">@JsonProperty("fundamentalMarketCap")</span>
    <span class="hljs-keyword">private</span> BigDecimal marketCap;
    
    <span class="hljs-meta">@JsonProperty("fundamentalRevenue")</span>
    <span class="hljs-keyword">private</span> String revenue;
    
    <span class="hljs-comment">// æŠ€æœ¯æŒ‡æ ‡</span>
    <span class="hljs-meta">@JsonProperty("technicalDay")</span>
    <span class="hljs-keyword">private</span> String technicalDay;
    
    <span class="hljs-meta">@JsonProperty("technicalHour")</span>
    <span class="hljs-keyword">private</span> String technicalHour;
    
    <span class="hljs-meta">@JsonProperty("technicalWeek")</span>
    <span class="hljs-keyword">private</span> String technicalWeek;
    
    <span class="hljs-meta">@JsonProperty("technicalMonth")</span>
    <span class="hljs-keyword">private</span> String technicalMonth;
    
    <span class="hljs-comment">// æ€§èƒ½æŒ‡æ ‡</span>
    <span class="hljs-meta">@JsonProperty("performanceDay")</span>
    <span class="hljs-keyword">private</span> BigDecimal performanceDay;
    
    <span class="hljs-meta">@JsonProperty("performanceWeek")</span>
    <span class="hljs-keyword">private</span> BigDecimal performanceWeek;
    
    <span class="hljs-meta">@JsonProperty("performanceMonth")</span>
    <span class="hljs-keyword">private</span> BigDecimal performanceMonth;
    
    <span class="hljs-meta">@JsonProperty("performanceYtd")</span>
    <span class="hljs-keyword">private</span> BigDecimal performanceYtd;
    
    <span class="hljs-comment">/**
     * è·å–æ ¼å¼åŒ–çš„æ—¶é—´
     */</span>
    <span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title function_">getFormattedTime</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> LocalDateTime.ofInstant(Instant.ofEpochSecond(timestamp), ZoneId.systemDefault());
    }
    
    <span class="hljs-comment">/**
     * è·å–äº¤æ˜“æ‰€åç§°
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getExchangeName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (NSE_EXCHANGE_ID == exchangeId) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"NSE"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (BSE_EXCHANGE_ID == exchangeId) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"BSE"</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Unknown"</span>;
    }
}

<span class="hljs-comment">// å¸¸é‡æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExchangeConstants</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">NSE_EXCHANGE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">46</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">BSE_EXCHANGE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">74</span>;
}
</code></pre>
<h4 data-id="heading-10">Kçº¿æ•°æ®æ¨¡å‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.model;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.Instant;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.time.ZoneId;

<span class="hljs-comment">/**
 * Kçº¿æ•°æ®æ¨¡å‹
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KLine</span> {
    <span class="hljs-meta">@JsonProperty("time")</span>
    <span class="hljs-keyword">private</span> Long timestamp;
    
    <span class="hljs-meta">@JsonProperty("open")</span>
    <span class="hljs-keyword">private</span> BigDecimal open;
    
    <span class="hljs-meta">@JsonProperty("high")</span>
    <span class="hljs-keyword">private</span> BigDecimal high;
    
    <span class="hljs-meta">@JsonProperty("low")</span>
    <span class="hljs-keyword">private</span> BigDecimal low;
    
    <span class="hljs-meta">@JsonProperty("close")</span>
    <span class="hljs-keyword">private</span> BigDecimal close;
    
    <span class="hljs-meta">@JsonProperty("volume")</span>
    <span class="hljs-keyword">private</span> Long volume;
    
    <span class="hljs-meta">@JsonProperty("vo")</span>
    <span class="hljs-keyword">private</span> BigDecimal turnover;
    
    <span class="hljs-comment">/**
     * è·å–æ ¼å¼åŒ–çš„æ—¶é—´
     */</span>
    <span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title function_">getFormattedTime</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> LocalDateTime.ofInstant(Instant.ofEpochMilli(timestamp), ZoneId.systemDefault());
    }
    
    <span class="hljs-comment">/**
     * è®¡ç®—æŒ¯å¹…
     */</span>
    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">getAmplitude</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (open == <span class="hljs-literal">null</span> || open.compareTo(BigDecimal.ZERO) == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> BigDecimal.ZERO;
        }
        <span class="hljs-keyword">return</span> high.subtract(low).divide(open, <span class="hljs-number">4</span>, BigDecimal.ROUND_HALF_UP);
    }
}
</code></pre>
<h4 data-id="heading-11">æŒ‡æ•°æ•°æ®æ¨¡å‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.model;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.Instant;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.time.ZoneId;

<span class="hljs-comment">/**
 * æŒ‡æ•°æ•°æ®æ¨¡å‹
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Index</span> {
    <span class="hljs-meta">@JsonProperty("id")</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@JsonProperty("name")</span>
    <span class="hljs-keyword">private</span> String name;
    
    <span class="hljs-meta">@JsonProperty("symbol")</span>
    <span class="hljs-keyword">private</span> String symbol;
    
    <span class="hljs-meta">@JsonProperty("last")</span>
    <span class="hljs-keyword">private</span> BigDecimal lastPrice;
    
    <span class="hljs-meta">@JsonProperty("chg")</span>
    <span class="hljs-keyword">private</span> BigDecimal change;
    
    <span class="hljs-meta">@JsonProperty("chgPct")</span>
    <span class="hljs-keyword">private</span> BigDecimal changePercent;
    
    <span class="hljs-meta">@JsonProperty("high")</span>
    <span class="hljs-keyword">private</span> BigDecimal high;
    
    <span class="hljs-meta">@JsonProperty("low")</span>
    <span class="hljs-keyword">private</span> BigDecimal low;
    
    <span class="hljs-meta">@JsonProperty("isOpen")</span>
    <span class="hljs-keyword">private</span> Boolean isOpen;
    
    <span class="hljs-meta">@JsonProperty("time")</span>
    <span class="hljs-keyword">private</span> Long timestamp;
    
    <span class="hljs-meta">@JsonProperty("flag")</span>
    <span class="hljs-keyword">private</span> String countryFlag;
    
    <span class="hljs-comment">/**
     * è·å–æ ¼å¼åŒ–çš„æ—¶é—´
     */</span>
    <span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title function_">getFormattedTime</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> LocalDateTime.ofInstant(Instant.ofEpochSecond(timestamp), ZoneId.systemDefault());
    }
}
</code></pre>
<h4 data-id="heading-12">APIå“åº”åŒ…è£…ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.model;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * APIé€šç”¨å“åº”åŒ…è£…ç±»
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
    <span class="hljs-meta">@JsonProperty("code")</span>
    <span class="hljs-keyword">private</span> Integer code;
    
    <span class="hljs-meta">@JsonProperty("message")</span>
    <span class="hljs-keyword">private</span> String message;
    
    <span class="hljs-meta">@JsonProperty("data")</span>
    <span class="hljs-keyword">private</span> T data;
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSuccess</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> code != <span class="hljs-literal">null</span> &amp;&amp; code == <span class="hljs-number">200</span>;
    }
}

<span class="hljs-comment">/**
 * è‚¡ç¥¨åˆ—è¡¨å“åº”åŒ…è£…ç±»
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StockListResponse</span> {
    <span class="hljs-meta">@JsonProperty("records")</span>
    <span class="hljs-keyword">private</span> List&lt;Stock&gt; records;
    
    <span class="hljs-meta">@JsonProperty("total")</span>
    <span class="hljs-keyword">private</span> Integer total;
    
    <span class="hljs-meta">@JsonProperty("current")</span>
    <span class="hljs-keyword">private</span> Integer current;
    
    <span class="hljs-meta">@JsonProperty("pages")</span>
    <span class="hljs-keyword">private</span> Integer pages;
    
    <span class="hljs-meta">@JsonProperty("size")</span>
    <span class="hljs-keyword">private</span> Integer size;
}
</code></pre>
<h3 data-id="heading-13">3. HTTPå®¢æˆ·ç«¯å®ç°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.client;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;
<span class="hljs-keyword">import</span> com.stocktv.india.config.StockTVConfig;
<span class="hljs-keyword">import</span> com.stocktv.india.model.*;
<span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;
<span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;
<span class="hljs-keyword">import</span> org.apache.http.client.utils.URIBuilder;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;
<span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.net.URI;
<span class="hljs-keyword">import</span> java.net.URISyntaxException;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * StockTV HTTP APIå®¢æˆ·ç«¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockTVHttpClient</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(StockTVHttpClient.class);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StockTVConfig config;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CloseableHttpClient httpClient;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StockTVHttpClient</span><span class="hljs-params">(StockTVConfig config)</span> {
        <span class="hljs-built_in">this</span>.config = config;
        <span class="hljs-built_in">this</span>.httpClient = config.getHttpClient();
    }
    
    <span class="hljs-comment">/**
     * è·å–å°åº¦è‚¡ç¥¨åˆ—è¡¨
     * 
     * <span class="hljs-doctag">@param</span> pageSize æ¯é¡µæ•°é‡
     * <span class="hljs-doctag">@param</span> page é¡µç 
     * <span class="hljs-doctag">@return</span> è‚¡ç¥¨åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getIndiaStocks</span><span class="hljs-params">(Integer pageSize, Integer page)</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/stocks"</span>)
                .addParameter(<span class="hljs-string">"countryId"</span>, String.valueOf(StockTVConfig.INDIA_COUNTRY_ID))
                .addParameter(<span class="hljs-string">"pageSize"</span>, String.valueOf(pageSize))
                .addParameter(<span class="hljs-string">"page"</span>, String.valueOf(page))
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey())
                .build();
        
        ApiResponse&lt;StockListResponse&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;StockListResponse&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            logger.info(<span class="hljs-string">"æˆåŠŸè·å– {} æ¡å°åº¦è‚¡ç¥¨æ•°æ®"</span>, response.getData().getRecords().size());
            <span class="hljs-keyword">return</span> response.getData().getRecords();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"APIè¯·æ±‚å¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * æŸ¥è¯¢å•ä¸ªè‚¡ç¥¨
     * 
     * <span class="hljs-doctag">@param</span> pid è‚¡ç¥¨PID
     * <span class="hljs-doctag">@param</span> symbol è‚¡ç¥¨ä»£ç 
     * <span class="hljs-doctag">@param</span> name è‚¡ç¥¨åç§°
     * <span class="hljs-doctag">@return</span> è‚¡ç¥¨åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">queryStock</span><span class="hljs-params">(Long pid, String symbol, String name)</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-type">URIBuilder</span> <span class="hljs-variable">uriBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/queryStocks"</span>)
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey());
        
        <span class="hljs-keyword">if</span> (pid != <span class="hljs-literal">null</span>) {
            uriBuilder.addParameter(<span class="hljs-string">"id"</span>, String.valueOf(pid));
        }
        <span class="hljs-keyword">if</span> (symbol != <span class="hljs-literal">null</span>) {
            uriBuilder.addParameter(<span class="hljs-string">"symbol"</span>, symbol);
        }
        <span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span>) {
            uriBuilder.addParameter(<span class="hljs-string">"name"</span>, name);
        }
        
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> uriBuilder.build();
        
        ApiResponse&lt;List&lt;Stock&gt;&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;Stock&gt;&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            logger.info(<span class="hljs-string">"è‚¡ç¥¨æŸ¥è¯¢æˆåŠŸï¼Œè¿”å› {} æ¡è®°å½•"</span>, response.getData().size());
            <span class="hljs-keyword">return</span> response.getData();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è‚¡ç¥¨æŸ¥è¯¢å¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡æŸ¥è¯¢å¤šä¸ªè‚¡ç¥¨
     * 
     * <span class="hljs-doctag">@param</span> pids è‚¡ç¥¨PIDåˆ—è¡¨
     * <span class="hljs-doctag">@return</span> è‚¡ç¥¨åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getStocksByPids</span><span class="hljs-params">(List&lt;Long&gt; pids)</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-keyword">if</span> (pids == <span class="hljs-literal">null</span> || pids.isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è‚¡ç¥¨PIDåˆ—è¡¨ä¸èƒ½ä¸ºç©º"</span>);
        }
        
        <span class="hljs-type">String</span> <span class="hljs-variable">pidsStr</span> <span class="hljs-operator">=</span> String.join(<span class="hljs-string">","</span>, pids.stream().map(String::valueOf).toArray(String[]::<span class="hljs-keyword">new</span>));
        
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/stocksByPids"</span>)
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey())
                .addParameter(<span class="hljs-string">"pids"</span>, pidsStr)
                .build();
        
        ApiResponse&lt;List&lt;Stock&gt;&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;Stock&gt;&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            logger.info(<span class="hljs-string">"æ‰¹é‡æŸ¥è¯¢æˆåŠŸï¼Œè¿”å› {} æ¡è®°å½•"</span>, response.getData().size());
            <span class="hljs-keyword">return</span> response.getData();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ‰¹é‡æŸ¥è¯¢å¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–å°åº¦ä¸»è¦æŒ‡æ•°
     * 
     * <span class="hljs-doctag">@return</span> æŒ‡æ•°åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Index&gt; <span class="hljs-title function_">getIndiaIndices</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/indices"</span>)
                .addParameter(<span class="hljs-string">"countryId"</span>, String.valueOf(StockTVConfig.INDIA_COUNTRY_ID))
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey())
                .build();
        
        ApiResponse&lt;List&lt;Index&gt;&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;Index&gt;&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            logger.info(<span class="hljs-string">"æˆåŠŸè·å– {} ä¸ªå°åº¦æŒ‡æ•°"</span>, response.getData().size());
            <span class="hljs-keyword">return</span> response.getData();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æŒ‡æ•°å¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–Kçº¿æ•°æ®
     * 
     * <span class="hljs-doctag">@param</span> pid è‚¡ç¥¨PID
     * <span class="hljs-doctag">@param</span> interval æ—¶é—´é—´éš”
     * <span class="hljs-doctag">@return</span> Kçº¿æ•°æ®åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;KLine&gt; <span class="hljs-title function_">getKLineData</span><span class="hljs-params">(Long pid, String interval)</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-keyword">if</span> (pid == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è‚¡ç¥¨PIDä¸èƒ½ä¸ºç©º"</span>);
        }
        
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/kline"</span>)
                .addParameter(<span class="hljs-string">"pid"</span>, String.valueOf(pid))
                .addParameter(<span class="hljs-string">"interval"</span>, interval)
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey())
                .build();
        
        ApiResponse&lt;List&lt;KLine&gt;&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;KLine&gt;&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            logger.info(<span class="hljs-string">"æˆåŠŸè·å–è‚¡ç¥¨ {} çš„Kçº¿æ•°æ®ï¼Œå…± {} æ¡"</span>, pid, response.getData().size());
            <span class="hljs-keyword">return</span> response.getData();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–Kçº¿æ•°æ®å¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–æ¶¨è·Œæ’è¡Œæ¦œ
     * 
     * <span class="hljs-doctag">@param</span> type æ’è¡Œæ¦œç±»å‹
     * <span class="hljs-doctag">@return</span> è‚¡ç¥¨åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getUpDownList</span><span class="hljs-params">(Integer type)</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/updownList"</span>)
                .addParameter(<span class="hljs-string">"countryId"</span>, String.valueOf(StockTVConfig.INDIA_COUNTRY_ID))
                .addParameter(<span class="hljs-string">"type"</span>, String.valueOf(type))
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey())
                .build();
        
        ApiResponse&lt;List&lt;Stock&gt;&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;Stock&gt;&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">typeName</span> <span class="hljs-operator">=</span> getRankingTypeName(type);
            logger.info(<span class="hljs-string">"æˆåŠŸè·å–{}ï¼Œå…± {} æ¡è®°å½•"</span>, typeName, response.getData().size());
            <span class="hljs-keyword">return</span> response.getData();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æ’è¡Œæ¦œå¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–IPOæ–°è‚¡æ—¥å†
     * 
     * <span class="hljs-doctag">@param</span> type IPOç±»å‹
     * <span class="hljs-doctag">@return</span> IPOåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title function_">getIpoList</span><span class="hljs-params">(Integer type)</span> <span class="hljs-keyword">throws</span> IOException, URISyntaxException {
        <span class="hljs-type">URIBuilder</span> <span class="hljs-variable">uriBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(config.BASE_URL + <span class="hljs-string">"/stock/getIpo"</span>)
                .addParameter(<span class="hljs-string">"countryId"</span>, String.valueOf(StockTVConfig.INDIA_COUNTRY_ID))
                .addParameter(<span class="hljs-string">"key"</span>, config.getApiKey());
        
        <span class="hljs-keyword">if</span> (type != <span class="hljs-literal">null</span>) {
            uriBuilder.addParameter(<span class="hljs-string">"type"</span>, String.valueOf(type));
        }
        
        <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> uriBuilder.build();
        
        ApiResponse&lt;List&lt;Object&gt;&gt; response = executeGetRequest(uri, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;ApiResponse&lt;List&lt;Object&gt;&gt;&gt;() {});
        
        <span class="hljs-keyword">if</span> (response.isSuccess()) {
            logger.info(<span class="hljs-string">"æˆåŠŸè·å–IPOæ•°æ®ï¼Œå…± {} æ¡"</span>, response.getData().size());
            <span class="hljs-keyword">return</span> response.getData();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–IPOæ•°æ®å¤±è´¥: "</span> + response.getMessage());
        }
    }
    
    <span class="hljs-comment">/**
     * é€šç”¨GETè¯·æ±‚æ‰§è¡Œæ–¹æ³•
     */</span>
    <span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">executeGetRequest</span><span class="hljs-params">(URI uri, TypeReference&lt;T&gt; typeReference)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(uri);
        logger.debug(<span class="hljs-string">"æ‰§è¡ŒAPIè¯·æ±‚: {}"</span>, uri);
        
        <span class="hljs-keyword">try</span> (<span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> httpClient.execute(request)) {
            <span class="hljs-type">int</span> <span class="hljs-variable">statusCode</span> <span class="hljs-operator">=</span> response.getStatusLine().getStatusCode();
            <span class="hljs-type">String</span> <span class="hljs-variable">responseBody</span> <span class="hljs-operator">=</span> EntityUtils.toString(response.getEntity());
            
            <span class="hljs-keyword">if</span> (statusCode != <span class="hljs-number">200</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"HTTPè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : "</span> + statusCode);
            }
            
            logger.debug(<span class="hljs-string">"APIå“åº”: {}"</span>, responseBody);
            <span class="hljs-keyword">return</span> config.getObjectMapper().readValue(responseBody, typeReference);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–æ’è¡Œæ¦œç±»å‹åç§°
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getRankingTypeName</span><span class="hljs-params">(Integer type)</span> {
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¶¨å¹…æ¦œ"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"è·Œå¹…æ¦œ"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¶¨åœæ¦œ"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"è·Œåœæ¦œ"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"æ’è¡Œæ¦œ"</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * å…³é—­HTTPå®¢æˆ·ç«¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (httpClient != <span class="hljs-literal">null</span>) {
            httpClient.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-14">4. æœåŠ¡å±‚å°è£…</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.service;

<span class="hljs-keyword">import</span> com.stocktv.india.client.StockTVHttpClient;
<span class="hljs-keyword">import</span> com.stocktv.india.config.StockTVConfig;
<span class="hljs-keyword">import</span> com.stocktv.india.model.Index;
<span class="hljs-keyword">import</span> com.stocktv.india.model.KLine;
<span class="hljs-keyword">import</span> com.stocktv.india.model.Stock;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * å°åº¦è‚¡ç¥¨æ•°æ®æœåŠ¡
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndiaStockService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(IndiaStockService.class);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StockTVHttpClient httpClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StockTVConfig config;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IndiaStockService</span><span class="hljs-params">(String apiKey)</span> {
        <span class="hljs-built_in">this</span>.config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockTVConfig</span>(apiKey);
        <span class="hljs-built_in">this</span>.httpClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockTVHttpClient</span>(config);
    }
    
    <span class="hljs-comment">/**
     * è·å–Nifty 50æˆåˆ†è‚¡
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getNifty50Stocks</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å®é™…åº”ç”¨ä¸­åº”è¯¥æ ¹æ®Nifty 50æˆåˆ†è‚¡åˆ—è¡¨æŸ¥è¯¢</span>
            List&lt;Stock&gt; stocks = httpClient.getIndiaStocks(<span class="hljs-number">50</span>, <span class="hljs-number">1</span>);
            logger.info(<span class="hljs-string">"è·å–Nifty 50æˆåˆ†è‚¡æˆåŠŸï¼Œå…± {} åªè‚¡ç¥¨"</span>, stocks.size());
            <span class="hljs-keyword">return</span> stocks;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"è·å–Nifty 50æˆåˆ†è‚¡å¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–Nifty 50æˆåˆ†è‚¡å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–å°åº¦ä¸»è¦æŒ‡æ•°
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Index&gt; <span class="hljs-title function_">getMajorIndices</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;Index&gt; indices = httpClient.getIndiaIndices();
            logger.info(<span class="hljs-string">"è·å–å°åº¦ä¸»è¦æŒ‡æ•°æˆåŠŸï¼Œå…± {} ä¸ªæŒ‡æ•°"</span>, indices.size());
            <span class="hljs-keyword">return</span> indices;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"è·å–å°åº¦æŒ‡æ•°å¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–å°åº¦æŒ‡æ•°å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * æŸ¥è¯¢ç‰¹å®šè‚¡ç¥¨
     */</span>
    <span class="hljs-keyword">public</span> Stock <span class="hljs-title function_">getStockBySymbol</span><span class="hljs-params">(String symbol)</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;Stock&gt; stocks = httpClient.queryStock(<span class="hljs-literal">null</span>, symbol, <span class="hljs-literal">null</span>);
            <span class="hljs-keyword">if</span> (stocks.isEmpty()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æœªæ‰¾åˆ°è‚¡ç¥¨: "</span> + symbol);
            }
            logger.info(<span class="hljs-string">"æŸ¥è¯¢è‚¡ç¥¨ {} æˆåŠŸ"</span>, symbol);
            <span class="hljs-keyword">return</span> stocks.get(<span class="hljs-number">0</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"æŸ¥è¯¢è‚¡ç¥¨å¤±è´¥: "</span> + symbol, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æŸ¥è¯¢è‚¡ç¥¨å¤±è´¥: "</span> + symbol, e);
        }
    }
    
    <span class="hljs-comment">/**
     * æ‰¹é‡æŸ¥è¯¢è‚¡ç¥¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getStocksBySymbols</span><span class="hljs-params">(List&lt;String&gt; symbols)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è¿™é‡Œéœ€è¦å…ˆå°†symbolè½¬æ¢ä¸ºpidï¼Œç®€åŒ–å¤„ç†ç›´æ¥æŸ¥è¯¢</span>
            List&lt;Stock&gt; result = symbols.stream()
                    .map(<span class="hljs-built_in">this</span>::getStockBySymbol)
                    .collect(Collectors.toList());
            logger.info(<span class="hljs-string">"æ‰¹é‡æŸ¥è¯¢ {} åªè‚¡ç¥¨æˆåŠŸ"</span>, symbols.size());
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"æ‰¹é‡æŸ¥è¯¢è‚¡ç¥¨å¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ‰¹é‡æŸ¥è¯¢è‚¡ç¥¨å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–è‚¡ç¥¨Kçº¿æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> List&lt;KLine&gt; <span class="hljs-title function_">getStockKLine</span><span class="hljs-params">(Long pid, String interval)</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;KLine&gt; klines = httpClient.getKLineData(pid, interval);
            logger.info(<span class="hljs-string">"è·å–è‚¡ç¥¨ {} çš„Kçº¿æ•°æ®æˆåŠŸï¼Œå…± {} æ¡"</span>, pid, klines.size());
            <span class="hljs-keyword">return</span> klines;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"è·å–Kçº¿æ•°æ®å¤±è´¥: pid="</span> + pid, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–Kçº¿æ•°æ®å¤±è´¥: pid="</span> + pid, e);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–æ¶¨å¹…æ¦œ
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getGainers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;Stock&gt; gainers = httpClient.getUpDownList(<span class="hljs-number">1</span>);
            logger.info(<span class="hljs-string">"è·å–æ¶¨å¹…æ¦œæˆåŠŸï¼Œå…± {} åªè‚¡ç¥¨"</span>, gainers.size());
            <span class="hljs-keyword">return</span> gainers;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"è·å–æ¶¨å¹…æ¦œå¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æ¶¨å¹…æ¦œå¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–è·Œå¹…æ¦œ
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Stock&gt; <span class="hljs-title function_">getLosers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;Stock&gt; losers = httpClient.getUpDownList(<span class="hljs-number">2</span>);
            logger.info(<span class="hljs-string">"è·å–è·Œå¹…æ¦œæˆåŠŸï¼Œå…± {} åªè‚¡ç¥¨"</span>, losers.size());
            <span class="hljs-keyword">return</span> losers;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"è·å–è·Œå¹…æ¦œå¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–è·Œå¹…æ¦œå¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–IPOæ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title function_">getUpcomingIPOs</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;Object&gt; ipos = httpClient.getIpoList(<span class="hljs-number">1</span>); <span class="hljs-comment">// 1è¡¨ç¤ºæœªä¸Šå¸‚</span>
            logger.info(<span class="hljs-string">"è·å–IPOæ•°æ®æˆåŠŸï¼Œå…± {} ä¸ª"</span>, ipos.size());
            <span class="hljs-keyword">return</span> ipos;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"è·å–IPOæ•°æ®å¤±è´¥"</span>, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–IPOæ•°æ®å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * å…³é—­æœåŠ¡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            httpClient.close();
            logger.info(<span class="hljs-string">"IndiaStockServiceå·²å…³é—­"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"å…³é—­æœåŠ¡æ—¶å‘ç”Ÿé”™è¯¯"</span>, e);
        }
    }
}
</code></pre>
<h3 data-id="heading-15">5. ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.demo;

<span class="hljs-keyword">import</span> com.stocktv.india.model.Index;
<span class="hljs-keyword">import</span> com.stocktv.india.model.KLine;
<span class="hljs-keyword">import</span> com.stocktv.india.model.Stock;
<span class="hljs-keyword">import</span> com.stocktv.india.service.IndiaStockService;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * å°åº¦è‚¡ç¥¨æ•°æ®ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndiaStockDemo</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(IndiaStockDemo.class);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æ›¿æ¢ä¸ºæ‚¨çš„å®é™… API Key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">apiKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æ‚¨çš„API_KEY"</span>;
        
        <span class="hljs-type">IndiaStockService</span> <span class="hljs-variable">stockService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndiaStockService</span>(apiKey);
        
        <span class="hljs-keyword">try</span> {
            logger.info(<span class="hljs-string">"=== StockTV å°åº¦è‚¡ç¥¨æ•°æ®æ¼”ç¤ºç¨‹åºå¼€å§‹ ==="</span>);
            
            <span class="hljs-comment">// 1. è·å–å°åº¦ä¸»è¦æŒ‡æ•°</span>
            demonstrateIndices(stockService);
            
            <span class="hljs-comment">// 2. æŸ¥è¯¢ç‰¹å®šè‚¡ç¥¨</span>
            demonstrateStockQuery(stockService);
            
            <span class="hljs-comment">// 3. è·å–Nifty 50æˆåˆ†è‚¡ç¤ºä¾‹</span>
            demonstrateNifty50(stockService);
            
            <span class="hljs-comment">// 4. è·å–Kçº¿æ•°æ®</span>
            demonstrateKLineData(stockService);
            
            <span class="hljs-comment">// 5. è·å–æ’è¡Œæ¦œ</span>
            demonstrateRankings(stockService);
            
            logger.info(<span class="hljs-string">"=== æ¼”ç¤ºç¨‹åºæ‰§è¡Œå®Œæˆ ==="</span>);
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"æ¼”ç¤ºç¨‹åºæ‰§è¡Œå¤±è´¥"</span>, e);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// å…³é—­æœåŠ¡</span>
            stockService.close();
        }
    }
    
    <span class="hljs-comment">/**
     * æ¼”ç¤ºæŒ‡æ•°æ•°æ®è·å–
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateIndices</span><span class="hljs-params">(IndiaStockService stockService)</span> {
        logger.info(<span class="hljs-string">"\n1. å°åº¦ä¸»è¦æŒ‡æ•°"</span>);
        List&lt;Index&gt; indices = stockService.getMajorIndices();
        
        indices.forEach(index -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">trend</span> <span class="hljs-operator">=</span> index.getChange().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"ğŸ“ˆ"</span> : <span class="hljs-string">"ğŸ“‰"</span>;
            logger.info(<span class="hljs-string">"{} {}: {}{} ({}{}%)"</span>, 
                trend, index.getName(), index.getLastPrice(),
                index.getChange().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"â†‘"</span> : <span class="hljs-string">"â†“"</span>,
                index.getChange().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"+"</span> : <span class="hljs-string">""</span>,
                index.getChangePercent());
        });
    }
    
    <span class="hljs-comment">/**
     * æ¼”ç¤ºè‚¡ç¥¨æŸ¥è¯¢
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateStockQuery</span><span class="hljs-params">(IndiaStockService stockService)</span> {
        logger.info(<span class="hljs-string">"\n2. æŸ¥è¯¢ç‰¹å®šè‚¡ç¥¨"</span>);
        
        <span class="hljs-comment">// æŸ¥è¯¢Reliance Industries</span>
        <span class="hljs-type">Stock</span> <span class="hljs-variable">reliance</span> <span class="hljs-operator">=</span> stockService.getStockBySymbol(<span class="hljs-string">"RELIANCE"</span>);
        printStockInfo(reliance, <span class="hljs-string">"Reliance Industries"</span>);
        
        <span class="hljs-comment">// æŸ¥è¯¢TCS</span>
        <span class="hljs-type">Stock</span> <span class="hljs-variable">tcs</span> <span class="hljs-operator">=</span> stockService.getStockBySymbol(<span class="hljs-string">"TCS"</span>);
        printStockInfo(tcs, <span class="hljs-string">"Tata Consultancy Services"</span>);
    }
    
    <span class="hljs-comment">/**
     * æ¼”ç¤ºNifty 50æˆåˆ†è‚¡
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateNifty50</span><span class="hljs-params">(IndiaStockService stockService)</span> {
        logger.info(<span class="hljs-string">"\n3. Nifty 50æˆåˆ†è‚¡ï¼ˆç¤ºä¾‹ï¼‰"</span>);
        List&lt;Stock&gt; niftyStocks = stockService.getNifty50Stocks();
        
        <span class="hljs-comment">// æ˜¾ç¤ºå‰10åªè‚¡ç¥¨</span>
        niftyStocks.stream().limit(<span class="hljs-number">10</span>).forEach(stock -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">trend</span> <span class="hljs-operator">=</span> stock.getChangePercent().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"ğŸŸ¢"</span> : <span class="hljs-string">"ğŸ”´"</span>;
            logger.info(<span class="hljs-string">"{} {}: â‚¹{} ({}{}%) - {}"</span>, 
                trend, stock.getSymbol(), stock.getLastPrice(),
                stock.getChangePercent().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"+"</span> : <span class="hljs-string">""</span>,
                stock.getChangePercent(), stock.getName());
        });
    }
    
    <span class="hljs-comment">/**
     * æ¼”ç¤ºKçº¿æ•°æ®è·å–
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateKLineData</span><span class="hljs-params">(IndiaStockService stockService)</span> {
        logger.info(<span class="hljs-string">"\n4. Kçº¿æ•°æ®ç¤ºä¾‹"</span>);
        
        <span class="hljs-type">Stock</span> <span class="hljs-variable">reliance</span> <span class="hljs-operator">=</span> stockService.getStockBySymbol(<span class="hljs-string">"RELIANCE"</span>);
        <span class="hljs-keyword">if</span> (reliance != <span class="hljs-literal">null</span>) {
            List&lt;KLine&gt; kLines = stockService.getStockKLine(reliance.getId(), <span class="hljs-string">"P1D"</span>);
            
            logger.info(<span class="hljs-string">"Reliance Industries è¿‘æœŸæ—¥Kçº¿æ•°æ®:"</span>);
            kLines.stream().limit(<span class="hljs-number">5</span>).forEach(kLine -&gt; {
                logger.info(<span class="hljs-string">"æ—¶é—´: {}, å¼€: â‚¹{}, é«˜: â‚¹{}, ä½: â‚¹{}, æ”¶: â‚¹{}, æˆäº¤é‡: {}"</span>, 
                    kLine.getFormattedTime(), kLine.getOpen(), 
                    kLine.getHigh(), kLine.getLow(), kLine.getClose(),
                    kLine.getVolume());
            });
        }
    }
    
    <span class="hljs-comment">/**
     * æ¼”ç¤ºæ’è¡Œæ¦œåŠŸèƒ½
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateRankings</span><span class="hljs-params">(IndiaStockService stockService)</span> {
        logger.info(<span class="hljs-string">"\n5. å¸‚åœºæ’è¡Œæ¦œ"</span>);
        
        <span class="hljs-comment">// è·å–æ¶¨å¹…æ¦œ</span>
        List&lt;Stock&gt; gainers = stockService.getGainers();
        logger.info(<span class="hljs-string">"ğŸ“ˆ ä»Šæ—¥æ¶¨å¹…æ¦œï¼ˆå‰5ï¼‰:"</span>);
        gainers.stream().limit(<span class="hljs-number">5</span>).forEach(stock -&gt; {
            logger.info(<span class="hljs-string">"   {}: â‚¹{} (+{}%) - {}"</span>, 
                stock.getSymbol(), stock.getLastPrice(), 
                stock.getChangePercent(), stock.getName());
        });
        
        <span class="hljs-comment">// è·å–è·Œå¹…æ¦œ</span>
        List&lt;Stock&gt; losers = stockService.getLosers();
        logger.info(<span class="hljs-string">"ğŸ“‰ ä»Šæ—¥è·Œå¹…æ¦œï¼ˆå‰5ï¼‰:"</span>);
        losers.stream().limit(<span class="hljs-number">5</span>).forEach(stock -&gt; {
            logger.info(<span class="hljs-string">"   {}: â‚¹{} ({}%) - {}"</span>, 
                stock.getSymbol(), stock.getLastPrice(), 
                stock.getChangePercent(), stock.getName());
        });
    }
    
    <span class="hljs-comment">/**
     * æ‰“å°è‚¡ç¥¨ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printStockInfo</span><span class="hljs-params">(Stock stock, String description)</span> {
        <span class="hljs-keyword">if</span> (stock != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">String</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> stock.getIsOpen() ? <span class="hljs-string">"ğŸŸ¢ äº¤æ˜“ä¸­"</span> : <span class="hljs-string">"ğŸ”´ å·²æ”¶ç›˜"</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">trend</span> <span class="hljs-operator">=</span> stock.getChangePercent().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"ğŸ“ˆ"</span> : <span class="hljs-string">"ğŸ“‰"</span>;
            
            logger.info(<span class="hljs-string">"{} {} - {}"</span>, trend, description, status);
            logger.info(<span class="hljs-string">"   ä»£ç : {} | ä»·æ ¼: â‚¹{}"</span>, stock.getSymbol(), stock.getLastPrice());
            logger.info(<span class="hljs-string">"   æ¶¨è·Œ: â‚¹{} ({}{}%)"</span>, stock.getChange(), 
                stock.getChangePercent().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"+"</span> : <span class="hljs-string">""</span>,
                stock.getChangePercent());
            logger.info(<span class="hljs-string">"   æœ€é«˜: â‚¹{} | æœ€ä½: â‚¹{} | æˆäº¤é‡: {}"</span>, 
                stock.getHigh(), stock.getLow(), stock.getVolume());
            
            <span class="hljs-keyword">if</span> (stock.getTechnicalDay() != <span class="hljs-literal">null</span>) {
                logger.info(<span class="hljs-string">"   æŠ€æœ¯æŒ‡æ ‡: {}"</span>, getTechnicalIndicatorName(stock.getTechnicalDay()));
            }
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–æŠ€æœ¯æŒ‡æ ‡ä¸­æ–‡åç§°
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getTechnicalIndicatorName</span><span class="hljs-params">(String indicator)</span> {
        <span class="hljs-keyword">switch</span> (indicator) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"strong_buy"</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"å¼ºçƒˆä¹°å…¥"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"buy"</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¹°å…¥"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"neutral"</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¸­æ€§"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"sell"</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"å–å‡º"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"strong_sell"</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"å¼ºçƒˆå–å‡º"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> indicator;
        }
    }
}
</code></pre>
<h2 data-id="heading-16">ğŸ¯ é«˜çº§åŠŸèƒ½</h2>
<h3 data-id="heading-17">è‡ªå®šä¹‰è‚¡ç¥¨ç›‘æ§å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.stocktv.india.advanced;

<span class="hljs-keyword">import</span> com.stocktv.india.model.Stock;
<span class="hljs-keyword">import</span> com.stocktv.india.service.IndiaStockService;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * è‚¡ç¥¨ä»·æ ¼ç›‘æ§å™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockPriceMonitor</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(StockPriceMonitor.class);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IndiaStockService stockService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ScheduledExecutorService scheduler;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Stock&gt; lastPrices;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; monitoredSymbols;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StockPriceMonitor</span><span class="hljs-params">(String apiKey)</span> {
        <span class="hljs-built_in">this</span>.stockService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndiaStockService</span>(apiKey);
        <span class="hljs-built_in">this</span>.scheduler = Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        <span class="hljs-built_in">this</span>.lastPrices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.monitoredSymbols = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
    }
    
    <span class="hljs-comment">/**
     * æ·»åŠ ç›‘æ§è‚¡ç¥¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addStock</span><span class="hljs-params">(String symbol)</span> {
        monitoredSymbols.add(symbol);
        logger.info(<span class="hljs-string">"æ·»åŠ ç›‘æ§è‚¡ç¥¨: {}"</span>, symbol);
    }
    
    <span class="hljs-comment">/**
     * å¼€å§‹ç›‘æ§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMonitoring</span><span class="hljs-params">()</span> {
        logger.info(<span class="hljs-string">"å¼€å§‹è‚¡ç¥¨ä»·æ ¼ç›‘æ§..."</span>);
        scheduler.scheduleAtFixedRate(<span class="hljs-built_in">this</span>::checkPrices, <span class="hljs-number">0</span>, <span class="hljs-number">60</span>, TimeUnit.SECONDS);
    }
    
    <span class="hljs-comment">/**
     * åœæ­¢ç›‘æ§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopMonitoring</span><span class="hljs-params">()</span> {
        scheduler.shutdown();
        stockService.close();
        logger.info(<span class="hljs-string">"è‚¡ç¥¨ä»·æ ¼ç›‘æ§å·²åœæ­¢"</span>);
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥ä»·æ ¼å˜åŒ–
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkPrices</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            List&lt;Stock&gt; currentStocks = stockService.getStocksBySymbols(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(monitoredSymbols));
            
            <span class="hljs-keyword">for</span> (Stock currentStock : currentStocks) {
                <span class="hljs-type">String</span> <span class="hljs-variable">symbol</span> <span class="hljs-operator">=</span> currentStock.getSymbol();
                <span class="hljs-type">Stock</span> <span class="hljs-variable">lastStock</span> <span class="hljs-operator">=</span> lastPrices.get(symbol);
                
                <span class="hljs-keyword">if</span> (lastStock != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// æ£€æŸ¥ä»·æ ¼å˜åŒ–</span>
                    <span class="hljs-type">double</span> <span class="hljs-variable">priceChange</span> <span class="hljs-operator">=</span> currentStock.getLastPrice().subtract(lastStock.getLastPrice()).doubleValue();
                    <span class="hljs-type">double</span> <span class="hljs-variable">percentChange</span> <span class="hljs-operator">=</span> currentStock.getChangePercent().doubleValue();
                    
                    <span class="hljs-comment">// ä»·æ ¼é¢„è­¦é€»è¾‘</span>
                    <span class="hljs-keyword">if</span> (Math.abs(percentChange) &gt; <span class="hljs-number">2.0</span>) {
                        logger.warn(<span class="hljs-string">"ğŸš¨ è‚¡ç¥¨ {} ä»·æ ¼æ³¢åŠ¨è¶…è¿‡2%: {}%"</span>, 
                            symbol, percentChange);
                    }
                    
                    <span class="hljs-comment">// æŠ€æœ¯æŒ‡æ ‡å˜åŒ–</span>
                    <span class="hljs-keyword">if</span> (!Objects.equals(currentStock.getTechnicalDay(), lastStock.getTechnicalDay())) {
                        logger.info(<span class="hljs-string">"ğŸ“Š è‚¡ç¥¨ {} æŠ€æœ¯æŒ‡æ ‡å˜åŒ–: {} â†’ {}"</span>, 
                            symbol, lastStock.getTechnicalDay(), currentStock.getTechnicalDay());
                    }
                }
                
                <span class="hljs-comment">// æ›´æ–°æœ€åä»·æ ¼</span>
                lastPrices.put(symbol, currentStock);
            }
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"ä»·æ ¼ç›‘æ§æ‰§è¡Œå¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–ç›‘æ§æŠ¥å‘Š
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printMonitoringReport</span><span class="hljs-params">()</span> {
        logger.info(<span class="hljs-string">"=== è‚¡ç¥¨ç›‘æ§æŠ¥å‘Š ==="</span>);
        lastPrices.values().forEach(stock -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">trend</span> <span class="hljs-operator">=</span> stock.getChangePercent().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"ğŸŸ¢"</span> : <span class="hljs-string">"ğŸ”´"</span>;
            logger.info(<span class="hljs-string">"{} {}: â‚¹{} ({}{}%)"</span>, 
                trend, stock.getSymbol(), stock.getLastPrice(),
                stock.getChangePercent().doubleValue() &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"+"</span> : <span class="hljs-string">""</span>,
                stock.getChangePercent());
        });
    }
}
</code></pre>
<h2 data-id="heading-18">âš ï¸ æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-19">1. é”™è¯¯å¤„ç†æœ€ä½³å®è·µ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è‡ªå®šä¹‰å¼‚å¸¸ç±»
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StockTVException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StockTVException</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-built_in">super</span>(message);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StockTVException</span><span class="hljs-params">(String message, Throwable cause)</span> {
        <span class="hljs-built_in">super</span>(message, cause);
    }
}

<span class="hljs-comment">/**
 * é‡è¯•æœºåˆ¶
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryableStockService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">RETRY_DELAY_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
    
    <span class="hljs-keyword">public</span> Stock <span class="hljs-title function_">getStockWithRetry</span><span class="hljs-params">(String symbol)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">retries</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (retries &lt; MAX_RETRIES) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">IndiaStockService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndiaStockService</span>(<span class="hljs-string">"API_KEY"</span>);
                <span class="hljs-keyword">return</span> service.getStockBySymbol(symbol);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                retries++;
                <span class="hljs-keyword">if</span> (retries == MAX_RETRIES) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockTVException</span>(<span class="hljs-string">"è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°"</span>, e);
                }
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(RETRY_DELAY_MS);
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockTVException</span>(<span class="hljs-string">"é‡è¯•è¿‡ç¨‹è¢«ä¸­æ–­"</span>, ie);
                }
            }
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockTVException</span>(<span class="hljs-string">"æœªçŸ¥é”™è¯¯"</span>);
    }
}
</code></pre>
<h3 data-id="heading-20">2. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ•°æ®ç¼“å­˜ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StockDataCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Stock&gt; stockCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Long, List&lt;KLine&gt;&gt; klineCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">cacheTimeoutMs</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>; <span class="hljs-comment">// 5åˆ†é’Ÿç¼“å­˜</span>
    
    <span class="hljs-keyword">public</span> Stock <span class="hljs-title function_">getCachedStock</span><span class="hljs-params">(String symbol, IndiaStockService service)</span> {
        <span class="hljs-type">Stock</span> <span class="hljs-variable">cached</span> <span class="hljs-operator">=</span> stockCache.get(symbol);
        <span class="hljs-keyword">if</span> (cached != <span class="hljs-literal">null</span> &amp;&amp; 
            System.currentTimeMillis() - cached.getTimestamp() * <span class="hljs-number">1000</span> &lt; cacheTimeoutMs) {
            <span class="hljs-keyword">return</span> cached;
        }
        
        <span class="hljs-type">Stock</span> <span class="hljs-variable">fresh</span> <span class="hljs-operator">=</span> service.getStockBySymbol(symbol);
        stockCache.put(symbol, fresh);
        <span class="hljs-keyword">return</span> fresh;
    }
}
</code></pre>
<h2 data-id="heading-21">ğŸ“ æŠ€æœ¯æ”¯æŒ</h2>
<p>å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š</p>
<ol>
<li><strong>æŸ¥çœ‹æ—¥å¿—</strong>: å¯ç”¨DEBUGçº§åˆ«æ—¥å¿—æŸ¥çœ‹è¯¦ç»†è¯·æ±‚ä¿¡æ¯</li>
<li><strong>æ£€æŸ¥ç½‘ç»œ</strong>: ç¡®ä¿å¯ä»¥æ­£å¸¸è®¿é—® <code>api.stocktv.top</code></li>
<li><strong>éªŒè¯API Key</strong>: ç¡®è®¤API Keyæœ‰æ•ˆä¸”å…·æœ‰ç›¸åº”æƒé™</li>
<li><strong>è”ç³»æ”¯æŒ</strong>: é€šè¿‡å®˜æ–¹æ¸ é“è·å–æŠ€æœ¯æ”¯æŒ</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµè§ˆå™¨æ¸²æŸ“åŸç†æ·±åº¦è§£æï¼šä»HTML/CSS/JSåˆ°åƒç´ çš„å®Œæ•´æ—…ç¨‹]]></title>    <link>https://juejin.cn/post/7570648023111434278</link>    <guid>https://juejin.cn/post/7570648023111434278</guid>    <pubDate>2025-11-10T07:49:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570648023111434278" data-draft-id="7570646659866116122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµè§ˆå™¨æ¸²æŸ“åŸç†æ·±åº¦è§£æï¼šä»HTML/CSS/JSåˆ°åƒç´ çš„å®Œæ•´æ—…ç¨‹"/> <meta itemprop="keywords" content="HTML,CSS"/> <meta itemprop="datePublished" content="2025-11-10T07:49:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Tzarevich"/> <meta itemprop="url" content="https://juejin.cn/user/578786070367529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµè§ˆå™¨æ¸²æŸ“åŸç†æ·±åº¦è§£æï¼šä»HTML/CSS/JSåˆ°åƒç´ çš„å®Œæ•´æ—…ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578786070367529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Tzarevich
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T07:49:30.000Z" title="Mon Nov 10 2025 07:49:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æµè§ˆå™¨æ¸²æŸ“åŸç†æ·±åº¦è§£æï¼šä»HTML/CSS/JSåˆ°åƒç´ çš„å®Œæ•´æ—…ç¨‹</h2>
<h3 data-id="heading-1">å¼•è¨€ï¼šæ•°å­—ä¸–ç•Œçš„é­”æ³•</h3>
<p>åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼ŒHTMLã€CSS å’Œ JavaScript ä¸‰è€…å…±åŒæ„æˆäº†ç½‘é¡µçš„æ ¸å¿ƒéª¨æ¶ã€æ ·å¼å’Œè¡Œä¸ºã€‚å½“æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ç½‘å€ï¼Œç¬é—´å°±èƒ½çœ‹åˆ°ç²¾ç¾çš„ç½‘é¡µç•Œé¢ã€‚è¿™çœ‹ä¼¼ç®€å•çš„è¿‡ç¨‹èƒŒåï¼Œå®åˆ™æ˜¯ä¸€åœºç²¾å¯†çš„æ•°å­—é­”æ³•ã€‚ä½œä¸ºä¸€åå‰ç«¯å¼€å‘è€…ï¼Œæ·±å…¥ç†è§£æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶ä¸ä»…æ˜¯æŠ€èƒ½æå‡çš„å¿…ç»ä¹‹è·¯ï¼Œæ›´æ˜¯ç¼–å†™é«˜æ€§èƒ½Webåº”ç”¨çš„åŸºç¡€ã€‚æœ¬æ–‡å°†å¸¦æ‚¨æ·±å…¥æ¢ç´¢æµè§ˆå™¨å¦‚ä½•å°†HTMLã€CSSå’ŒJavaScriptä»£ç è½¬æ¢ä¸ºæˆ‘ä»¬æ‰€è§çš„å¯è§†åŒ–ç•Œé¢ã€‚</p>
<h3 data-id="heading-2">ä¸€ã€æ¸²æŸ“æµç¨‹å…¨æ™¯å›¾</h3>
<h4 data-id="heading-3">1. å®è§‚æ¸²æŸ“æµæ°´çº¿</h4>
<p>æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸€ä¸ªå¤æ‚çš„å¤šé˜¶æ®µæµæ°´çº¿ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">HTML</span>/CSS/JS è¾“å…¥ â†’ æµè§ˆå™¨(Chrome) â†’ æ¸²æŸ“å¼•æ“ â†’ è§£æå¤„ç† â†’ ç”ŸæˆDOMæ ‘/CSSOMæ ‘/æ‰§è¡ŒJS â†’ æ¸²æŸ“æ ‘ â†’ å¸ƒå±€ â†’ ç»˜åˆ¶ â†’ åˆæˆ
</code></pre>
<h4 data-id="heading-4">2. æ¸²æŸ“çš„æ ¸å¿ƒæŒ‘æˆ˜</h4>
<p><strong>æµç¨‹å¤æ‚æ€§</strong>ï¼šä»å­—ç¬¦ä¸²è§£æåˆ°åƒç´ ç»˜åˆ¶ï¼Œæ¶‰åŠå¤šä¸ªè§£æå™¨ã€å¤šä¸ªå¤„ç†é˜¶æ®µå’Œå¤æ‚çš„è®¡ç®—é€»è¾‘ã€‚</p>
<p><strong>æ—¶é—´å¼€é”€</strong>ï¼šæ¯ä¸ªé˜¶æ®µéƒ½å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡æˆ–å¤„ç†å¤æ‚é¡µé¢æ—¶ã€‚</p>
<p><strong>æ€§èƒ½ä¼˜åŒ–å¿…è¦æ€§</strong>ï¼šç†è§£æ¸²æŸ“æµç¨‹æ˜¯è¿›è¡Œæœ‰æ•ˆæ€§èƒ½ä¼˜åŒ–çš„å‰æï¼Œåªæœ‰çŸ¥é“æ—¶é—´èŠ±åœ¨å“ªé‡Œï¼Œæ‰èƒ½æœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-5">äºŒã€HTMLè§£æä¸DOMæ ‘æ„å»º</h3>
<h4 data-id="heading-6">1. HTML çš„æœ¬è´¨æ˜¯å­—ç¬¦ä¸²</h4>
<p>HTML æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€æ®µçº¯æ–‡æœ¬å­—ç¬¦ä¸²ã€‚æµè§ˆå™¨æ— æ³•ç›´æ¥æ“ä½œå­—ç¬¦ä¸²æ¥æ¸²æŸ“é¡µé¢ï¼Œå› æ­¤å¿…é¡»å°†å…¶è½¬æ¢ä¸ºä¸€ç§å¯ç¼–ç¨‹ã€å¯éå†çš„æ•°æ®ç»“æ„â€”â€”<strong>DOM æ ‘</strong>ã€‚</p>
<h4 data-id="heading-7">2. è§£æè¿‡ç¨‹</h4>
<ul>
<li>æµè§ˆå™¨é€šè¿‡Â <strong>HTML è§£æå™¨ï¼ˆHTML Parserï¼‰</strong> Â é€å­—ç¬¦è¯»å– HTMLã€‚</li>
<li>é‡åˆ°æ ‡ç­¾ï¼ˆå¦‚Â <code>&lt;div&gt;</code>ï¼‰ã€æ–‡æœ¬ã€æ³¨é‡Šç­‰å†…å®¹æ—¶ï¼Œä¼šåˆ›å»ºå¯¹åº”çš„Â <strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong> ã€‚</li>
<li>èŠ‚ç‚¹ä¹‹é—´æ ¹æ®åµŒå¥—å…³ç³»å½¢æˆçˆ¶å­ã€å…„å¼Ÿç­‰å±‚çº§ç»“æ„ï¼Œæœ€ç»ˆæ„æˆä¸€æ£µæ ‘ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">Html
é¢„è§ˆ
1<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
2  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
3  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
4    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
5    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>World<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
6  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
7<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>ä¼šè¢«è§£æä¸ºå¦‚ä¸‹ DOM æ ‘ç»“æ„ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Text
ç¼–è¾‘
1html
2â”œâ”€â”€ <span class="hljs-built_in">head</span>
3â”‚   â””â”€â”€ title â†’ <span class="hljs-string">"ç¤ºä¾‹"</span>
4â””â”€â”€ body
5    â”œâ”€â”€ h1 â†’ <span class="hljs-string">"Hello"</span>
6    â””â”€â”€ p â†’ <span class="hljs-string">"World"</span>
</code></pre>
<h4 data-id="heading-8">3. DOMæ ‘çš„æœ¬è´¨ç‰¹å¾</h4>
<p>DOMæ ‘å…·æœ‰ä»¥ä¸‹é‡è¦ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å±‚æ¬¡ç»“æ„</strong>ï¼šåæ˜ HTMLæ ‡ç­¾çš„åµŒå¥—å…³ç³»</li>
<li><strong>èŠ‚ç‚¹ç±»å‹</strong>ï¼šå…ƒç´ èŠ‚ç‚¹ã€æ–‡æœ¬èŠ‚ç‚¹ã€å±æ€§èŠ‚ç‚¹ç­‰</li>
<li><strong>å†…å­˜è¡¨ç¤º</strong>ï¼šæ•´ä¸ªDOMæ ‘é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œå¯é€šè¿‡JavaScriptè®¿é—®å’Œæ“ä½œ</li>
<li><strong>åŠ¨æ€æ›´æ–°</strong>ï¼šå¯ä»¥é€šè¿‡JavaScriptåŠ¨æ€ä¿®æ”¹DOMç»“æ„</li>
</ul>
<h4 data-id="heading-9">4. HTMLè¯­ä¹‰åŒ–çš„æ·±è¿œå½±å“</h4>
<ul>
<li><strong>ç»“æ„è¯­ä¹‰åŒ–æ ‡ç­¾</strong>ï¼ˆå¦‚Â <code>&lt;header&gt;</code>ã€<code>&lt;main&gt;</code>ã€<code>&lt;footer&gt;</code>ã€<code>&lt;aside&gt;</code>ã€<code>&lt;section&gt;</code>ï¼‰ä¸ä»…å¸®åŠ©å¼€å‘è€…ç»„ç»‡å†…å®¹ï¼Œä¹Ÿä¾¿äºæœç´¢å¼•æ“ï¼ˆSEOï¼‰ç†è§£é¡µé¢ç»“æ„ã€‚</li>
<li><strong>åŠŸèƒ½è¯­ä¹‰åŒ–æ ‡ç­¾</strong>ï¼ˆå¦‚Â <code>&lt;h1&gt;</code>~<code>&lt;h6&gt;</code>ã€<code>&lt;ul&gt;</code>ã€<code>&lt;li&gt;</code>ã€<code>&lt;code&gt;</code>ã€<code>&lt;p&gt;</code>ï¼‰åˆ™æ˜ç¡®è¡¨è¾¾äº†å†…å®¹çš„ç±»å‹å’Œå±‚çº§ã€‚</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- éè¯­ä¹‰åŒ–å†™æ³• --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"header"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"footer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- è¯­ä¹‰åŒ–å†™æ³• --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
</code></pre>
<p>è¯­ä¹‰åŒ–æ ‡ç­¾ä¸ä»…ä½¿ä»£ç æ›´æ˜“è¯»ï¼Œæ›´é‡è¦çš„æ˜¯ä¸ºæµè§ˆå™¨å’Œæœç´¢å¼•æ“æä¾›äº†æ˜ç¡®çš„è¯­ä¹‰ä¿¡æ¯ã€‚</p>
<h5 data-id="heading-10">SEOä¼˜åŒ–æœºåˆ¶</h5>
<p>æœç´¢å¼•æ“é€šè¿‡çˆ¬è™«ç¨‹åºåˆ†æç½‘é¡µå†…å®¹ï¼Œè¯­ä¹‰åŒ–æ ‡ç­¾å¸®åŠ©çˆ¬è™«ï¼š</p>
<ul>
<li>å‡†ç¡®è¯†åˆ«é¡µé¢å„ä¸ªéƒ¨åˆ†çš„ä½œç”¨</li>
<li>ç†è§£å†…å®¹çš„é‡è¦æ€§å’Œç›¸å…³æ€§</li>
<li>å»ºç«‹å†…å®¹ä¹‹é—´çš„é€»è¾‘å…³ç³»</li>
</ul>
<h5 data-id="heading-11">æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h5>
<p>é€šè¿‡åˆç†çš„æ ‡ç­¾é¡ºåºå’Œè¯­ä¹‰åŒ–ç»“æ„ï¼Œå¯ä»¥ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é€šè¿‡CSSè°ƒæ•´è§†è§‰é¡ºåºè€Œä¸æ”¹å˜DOMé¡ºåº */</span>
<span class="hljs-selector-tag">main</span> { <span class="hljs-attribute">order</span>: <span class="hljs-number">1</span>; }
<span class="hljs-selector-tag">aside</span> { <span class="hljs-attribute">order</span>: <span class="hljs-number">2</span>; }
</code></pre>
<p>è¿™æ ·æ—¢ä¿è¯äº†é‡è¦å†…å®¹åœ¨DOMä¸­ä¼˜å…ˆå‡ºç°ï¼Œåˆå®ç°äº†æœŸæœ›çš„è§†è§‰å¸ƒå±€ã€‚</p>
<h3 data-id="heading-12">ä¸‰ã€CSSè§£æä¸CSSOMæ ‘æ„å»º</h3>
<h4 data-id="heading-13">1. ä»æ ·å¼è¡¨åˆ°æ ·å¼æ ‘</h4>
<p>ä¸HTMLè§£æç±»ä¼¼ï¼ŒCSSä¹Ÿéœ€è¦ä»æ–‡æœ¬æ ¼å¼è½¬æ¢ä¸ºè®¡ç®—æœºæ˜“äºå¤„ç†çš„ç»“æ„åŒ–æ•°æ®ã€‚<strong>CSSOMï¼ˆCSS Object Modelï¼‰æ ‘</strong>å°±æ˜¯è¿™ä¸ªè½¬æ¢çš„ç»“æœï¼Œè¿™æ˜¯ä¸€ç§åŒ…å«æ‰€æœ‰æ ·å¼è§„åˆ™çš„å¯¹è±¡æ¨¡å‹ã€‚</p>
<h4 data-id="heading-14">2. è§£æè§„åˆ™</h4>
<ul>
<li>æµè§ˆå™¨è¯»å– CSS è§„åˆ™ï¼ˆå¦‚Â <code>div { color: red; }</code>ï¼‰ã€‚</li>
<li>å°†é€‰æ‹©å™¨ä¸å£°æ˜åˆ†ç¦»ï¼Œæ„å»ºå‡ºâ€œé€‰æ‹©å™¨ â†’ æ ·å¼å±æ€§â€çš„æ˜ å°„ã€‚</li>
<li>æœ€ç»ˆå½¢æˆä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªæ ·å¼è§„åˆ™ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§ï¼ˆå±‚å ã€ç»§æ‰¿ã€ç‰¹å¼‚æ€§ï¼‰è¿›è¡Œæ•´åˆã€‚</li>
</ul>
<h4 data-id="heading-15">3. CSSOMä¸DOMçš„ç»“åˆ</h4>
<p>å•ç‹¬çš„ DOM æˆ– CSSOM éƒ½æ— æ³•æ¸²æŸ“é¡µé¢ï¼ŒCSSOMæ ‘æ„å»ºå®Œæˆåï¼Œæµè§ˆå™¨éœ€è¦å°†å…¶ä¸DOMæ ‘ç»“åˆï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>é€‰æ‹©å™¨åŒ¹é…</strong>ï¼šä¸ºæ¯ä¸ªDOMå…ƒç´ æ‰¾åˆ°æ‰€æœ‰é€‚ç”¨çš„CSSè§„åˆ™</li>
<li><strong>å€¼è®¡ç®—</strong>ï¼šå°†ç›¸å¯¹å•ä½è½¬æ¢ä¸ºç»å¯¹åƒç´ å€¼</li>
<li><strong>æ ·å¼ç»§æ‰¿</strong>ï¼šå¤„ç†å¯ç»§æ‰¿å±æ€§çš„ä¼ æ’­</li>
<li><strong>å±‚å å¤„ç†</strong>ï¼šæ ¹æ®ä¼˜å…ˆçº§å’Œé¡ºåºç¡®å®šæœ€ç»ˆæ ·å¼</li>
</ul>
<p>æµè§ˆå™¨å°†ä¸¤è€…ç»“åˆï¼Œä¸ºæ¯ä¸ª DOM èŠ‚ç‚¹é™„åŠ å…¶æœ€ç»ˆè®¡ç®—åçš„æ ·å¼ï¼Œç”ŸæˆÂ <strong>æ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰</strong></p>
<h3 data-id="heading-16">å››ã€æ¸²æŸ“æ ‘ä¸å¸ƒå±€è®¡ç®—</h3>
<h4 data-id="heading-17">1.æ¸²æŸ“æ ‘çš„æ„å»º</h4>
<p>æ¸²æŸ“æ ‘æ˜¯DOMæ ‘å’ŒCSSOMæ ‘çš„ç»“åˆä½“ï¼Œä½†åªåŒ…å«å¯è§å†…å®¹ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- DOMæ ‘ä¸­çš„å…ƒç´  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: none;"</span>&gt;</span>éšè—å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"visibility: hidden;"</span>&gt;</span>ä¸å¯è§ä½†å ä½<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å¯è§å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>åœ¨æ¸²æŸ“æ ‘ä¸­ï¼š</p>
<ul>
<li><code>display: none</code> çš„å…ƒç´ å®Œå…¨ä¸ä¼šå‡ºç°</li>
<li><code>visibility: hidden</code> çš„å…ƒç´ ä¼šä¿ç•™ä½ç½®ä½†ä¸å¯è§</li>
<li>åªæœ‰çœŸæ­£å¯è§çš„å…ƒç´ æ‰ä¼šè¿›å…¥æ¸²æŸ“æ ‘</li>
</ul>
<h4 data-id="heading-18">4.2 å¸ƒå±€ï¼ˆé‡æ’ï¼‰è¿‡ç¨‹</h4>
<p>å¸ƒå±€é˜¶æ®µè®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨å±å¹•ä¸Šçš„ç²¾ç¡®ä½ç½®å’Œå°ºå¯¸ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">80%</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
</code></pre>
<p><strong>å¸ƒå±€è®¡ç®—åŒ…æ‹¬</strong>ï¼š</p>
<ul>
<li><strong>ç›’æ¨¡å‹è®¡ç®—</strong>ï¼šcontent + padding + border + margin</li>
<li><strong>ä½ç½®è®¡ç®—</strong>ï¼šç›¸å¯¹å®šä½ã€ç»å¯¹å®šä½ã€å›ºå®šå®šä½</li>
<li><strong>æµ®åŠ¨å¤„ç†</strong>ï¼šæ–‡æœ¬ç¯ç»•å’Œæ¸…é™¤æµ®åŠ¨</li>
<li><strong>Flexbox/Gridå¸ƒå±€</strong>ï¼šç°ä»£å¸ƒå±€ç³»ç»Ÿçš„å¤æ‚è®¡ç®—</li>
</ul>
<h4 data-id="heading-19">4.3 å¸ƒå±€æ€§èƒ½ä¼˜åŒ–</h4>
<p>å¸ƒå±€æ˜¯æ¸²æŸ“æµç¨‹ä¸­æœ€æ˜‚è´µçš„æ“ä½œä¹‹ä¸€ï¼Œä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸å¥½ï¼šå¤šæ¬¡è§¦å‘å¸ƒå±€</span>
element.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100px'</span>;
<span class="hljs-keyword">const</span> height = element.<span class="hljs-property">offsetHeight</span>; <span class="hljs-comment">// è§¦å‘å¸ƒå±€</span>
element.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = height + <span class="hljs-string">'px'</span>;

<span class="hljs-comment">// å¥½ï¼šæ‰¹é‡è¯»å†™</span>
<span class="hljs-keyword">const</span> height = element.<span class="hljs-property">offsetHeight</span>; <span class="hljs-comment">// è¯»å–</span>
element.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100px'</span>;       <span class="hljs-comment">// å†™å…¥</span>
element.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = height + <span class="hljs-string">'px'</span>; <span class="hljs-comment">// å†™å…¥</span>
</code></pre>
<h3 data-id="heading-20">äº”ã€JavaScriptçš„æ‰§è¡Œä¸äº¤äº’</h3>
<h4 data-id="heading-21">1. JavaScriptå¼•æ“ä¸æ¸²æŸ“å¼•æ“çš„åä½œ</h4>
<p>JavaScriptæ‰§è¡Œä¼šé˜»å¡DOMè§£æå’Œæ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// åŒæ­¥è„šæœ¬ä¼šé˜»å¡è§£æ</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;p&gt;åŠ¨æ€å†…å®¹&lt;/p&gt;'</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"defer-script.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"async-script.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>å…³é”®é—®é¢˜ï¼šä¸ºä»€ä¹ˆ JS ä¼šé˜»å¡ï¼Ÿ</strong></p>
<ul>
<li>å› ä¸º JS å¯èƒ½é€šè¿‡Â <code>document.write()</code>Â ä¿®æ”¹ HTMLï¼Œæˆ–é€šè¿‡Â <code>appendChild</code>Â åŠ¨æ€æ’å…¥æ–°èŠ‚ç‚¹ã€‚</li>
<li>ä¸ºä¿è¯ä¸€è‡´æ€§ï¼Œæµè§ˆå™¨åœ¨é‡åˆ°Â <code>&lt;script&gt;</code>Â æ ‡ç­¾æ—¶ä¼šæš‚åœ HTML è§£æï¼Œç›´åˆ°è„šæœ¬ä¸‹è½½å¹¶æ‰§è¡Œå®Œæ¯•ã€‚</li>
</ul>
<blockquote>
<p>ğŸš« ç¤ºä¾‹ï¼ˆé˜»å¡ï¼‰ï¼š</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml">Html
é¢„è§ˆ
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <span class="hljs-comment">&lt;!-- é˜»å¡åç»­ HTML è§£æ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è¿™éƒ¨åˆ†å†…å®¹ä¼šè¢«å»¶è¿Ÿè§£æ<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>åŠ è½½ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>åŒæ­¥è„šæœ¬</strong>ï¼šç«‹å³æ‰§è¡Œï¼Œé˜»å¡è§£æ</li>
<li><strong>defer</strong>ï¼šå¼‚æ­¥åŠ è½½ï¼ŒDOMè§£æå®Œæˆåæ‰§è¡Œ</li>
<li><strong>async</strong>ï¼šå¼‚æ­¥åŠ è½½ï¼ŒåŠ è½½å®Œæˆåç«‹å³æ‰§è¡Œ</li>
</ul>
<h4 data-id="heading-22">2. äº‹ä»¶å¾ªç¯ä¸æ¸²æŸ“è°ƒåº¦</h4>
<p>æµè§ˆå™¨é€šè¿‡äº‹ä»¶å¾ªç¯æœºåˆ¶åè°ƒJavaScriptæ‰§è¡Œå’Œæ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨requestAnimationFrameä¼˜åŒ–åŠ¨ç”»</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
    element.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(<span class="hljs-subst">${position}</span>px)`</span>;
    position += <span class="hljs-number">1</span>;
    <span class="hljs-title function_">requestAnimationFrame</span>(animate);
}
<span class="hljs-title function_">requestAnimationFrame</span>(animate);
</code></pre>
<h3 data-id="heading-23">å…­ã€æ€§èƒ½ä¼˜åŒ–å®æˆ˜</h3>
<h4 data-id="heading-24">1. å…³é”®æ¸²æŸ“è·¯å¾„ä¼˜åŒ–</h4>
<p><strong>ä¼˜åŒ–ç›®æ ‡</strong>ï¼šç¼©çŸ­é¦–æ¬¡æœ‰æ„ä¹‰æ¸²æŸ“çš„æ—¶é—´</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å…³é”®CSSå†…è” --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* é¦–å±å…³é”®æ ·å¼ */</span>
<span class="hljs-selector-class">.header</span>, <span class="hljs-selector-class">.main-content</span> { <span class="hljs-comment">/* ... */</span> }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"non-critical.css"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"style"</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">"this.rel='stylesheet'"</span>&gt;</span>
</code></pre>
<h4 data-id="heading-25">2. å‡å°‘é‡æ’å’Œé‡ç»˜</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨DocumentFragmentæ‰¹é‡æ“ä½œDOM</span>
<span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    <span class="hljs-keyword">const</span> li = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'li'</span>);
    li.<span class="hljs-property">textContent</span> = <span class="hljs-string">`Item <span class="hljs-subst">${i}</span>`</span>;
    fragment.<span class="hljs-title function_">appendChild</span>(li);
}
list.<span class="hljs-title function_">appendChild</span>(fragment);
</code></pre>
<h4 data-id="heading-26">3. ç°ä»£CSSå¸ƒå±€ä¼˜åŒ–</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä½¿ç”¨Flexboxé¿å…æµ®åŠ¨å¸ƒå±€çš„é‡æ’é—®é¢˜ */</span>
<span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>; <span class="hljs-comment">/* ä½¿ç”¨gapæ›¿ä»£margin */</span>
}

<span class="hljs-comment">/* ä½¿ç”¨Gridå®ç°å¤æ‚å¸ƒå±€ */</span>
<span class="hljs-selector-class">.grid-layout</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
}
</code></pre>
<h3 data-id="heading-27">ç»“è¯­</h3>
<p>æµè§ˆå™¨æ¸²æŸ“æ˜¯ä¸€ä¸ªæå…¶å¤æ‚ä½†åˆç²¾å¦™åè°ƒçš„è¿‡ç¨‹ã€‚ä»HTMLå­—ç¬¦ä¸²åˆ°å±å¹•åƒç´ ï¼Œæ¯ä¸€ä¸ªé˜¶æ®µéƒ½ä½“ç°äº†è®¡ç®—æœºç§‘å­¦çš„æ·±åº¦å’Œæµè§ˆå™¨çš„å·¥ç¨‹æ™ºæ…§ã€‚ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæ·±å…¥ç†è§£è¿™ä¸€è¿‡ç¨‹ä¸ä»…èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç¼–å†™æ›´é«˜æ•ˆçš„ä»£ç ï¼Œæ›´é‡è¦çš„æ˜¯èƒ½å¤ŸåŸ¹å…»å‡ºå¯¹Webæ€§èƒ½çš„ç›´è§‰å’Œå¯¹ç”¨æˆ·ä½“éªŒçš„æ·±åˆ»ç†è§£ã€‚</p>
<p>éšç€WebæŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œæ¸²æŸ“ä¼˜åŒ–ä»ç„¶æ˜¯æˆ‘ä»¬éœ€è¦æŒç»­å­¦ä¹ å’Œæ¢ç´¢çš„é‡è¦é¢†åŸŸã€‚åªæœ‰æ·±å…¥ç†è§£åº•å±‚åŸç†ï¼Œæ‰èƒ½åœ¨é¢å¯¹æ–°çš„æŠ€æœ¯æŒ‘æˆ˜æ—¶æ¸¸åˆƒæœ‰ä½™ï¼Œåˆ›é€ å‡ºçœŸæ­£ä¼˜ç§€çš„Webä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 è¶…å¼ºäºŒç»´ç è¯†åˆ«ï¼šå¤šåŒºåŸŸ/å¤šå°ºåº¦æ‰«æ + é«˜çº§å›¾åƒå¤„ç†]]></title>    <link>https://juejin.cn/post/7570598043298070591</link>    <guid>https://juejin.cn/post/7570598043298070591</guid>    <pubDate>2025-11-10T08:07:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298070591" data-draft-id="7570500819889438763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 è¶…å¼ºäºŒç»´ç è¯†åˆ«ï¼šå¤šåŒºåŸŸ/å¤šå°ºåº¦æ‰«æ + é«˜çº§å›¾åƒå¤„ç†"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-10T08:07:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹åŒ—æµ·"/> <meta itemprop="url" content="https://juejin.cn/user/1425415102792237"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 è¶…å¼ºäºŒç»´ç è¯†åˆ«ï¼šå¤šåŒºåŸŸ/å¤šå°ºåº¦æ‰«æ + é«˜çº§å›¾åƒå¤„ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1425415102792237/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹åŒ—æµ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:07:22.000Z" title="Mon Nov 10 2025 08:07:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 è¶…å¼ºäºŒç»´ç è¯†åˆ«ï¼šå¤šåŒºåŸŸ/å¤šå°ºåº¦æ‰«æ + é«˜çº§å›¾åƒå¤„ç†</h2>
<p>åœ¨å‰ç«¯é¡¹ç›®é‡ŒåšäºŒç»´ç è¯†åˆ«ï¼Œç»å¸¸ä¼šé‡åˆ°â€œèƒŒæ™¯å¤æ‚è¯†åˆ«éš¾â€â€œäºŒç»´ç å¾ˆå°è¯†åˆ«ç‡ä½â€â€œè¯†åˆ«æ…¢â€çš„ç—›ç‚¹ã€‚æœ¬æ–‡ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªåŸºäº Vue 3 çš„äºŒç»´ç è¯†åˆ«å·¥å…·åº“ â€”â€” <code>vue-qrcode-scanner</code>ï¼Œä¸»æ‰“â€œè¯†åˆ«ç¨³ã€é€Ÿåº¦å¿«ã€æ¥å…¥ç®€å•â€ã€‚</p>
<ul>
<li>æ”¯æŒå¤šåŒºåŸŸ/å¤šå°ºåº¦æ‰«æï¼Œä¼˜å…ˆå‘½ä¸­é«˜æ¦‚ç‡åŒºåŸŸï¼Œæå‡é¦–è¯†åˆ«é€Ÿåº¦</li>
<li>å†…ç½®å¤šç§å›¾åƒé¢„å¤„ç†ï¼šOTSUã€è‡ªé€‚åº”é˜ˆå€¼ã€é”åŒ–ã€å¯¹æ¯”åº¦æ‹‰ä¼¸ï¼Œå¤æ‚èƒŒæ™¯ä¹Ÿèƒ½é¡¶ä½</li>
<li>æä¾› Vue Composable API + å·¥å…·å‡½æ•°ä¸¤å¥—ç”¨æ³•</li>
<li>TypeScript å…¨é‡ç±»å‹ï¼Œå¼€å‘ä½“éªŒå‹å¥½</li>
</ul>
<p>å¼€æºåœ°å€ä¸å®‰è£…æ–¹å¼è§æ–‡æœ«ï¼Œæ¬¢è¿ Star ä¸åé¦ˆé—®é¢˜ã€‚</p>
<h3 data-id="heading-1">âœ¨ åŠŸèƒ½äº®ç‚¹</h3>
<ul>
<li><strong>Vue 3 Composable</strong>ï¼šä½¿ç”¨ Composition APIï¼Œæ¥å…¥æˆæœ¬ä½</li>
<li><strong>å¤šåŒºåŸŸæ‰«æ</strong>ï¼šä¼˜å…ˆå¸¸è§ä½ç½®ï¼ˆå¦‚å³ä¸‹è§’ï¼‰+ æ»‘åŠ¨çª—å£ç­–ç•¥</li>
<li><strong>å¤šå°ºåº¦æ‰«æ</strong>ï¼šè‡ªåŠ¨åœ¨ä¸åŒç¼©æ”¾çº§åˆ«å°è¯•è¯†åˆ«</li>
<li><strong>è‡ªåŠ¨å®šä½</strong>ï¼šè¿”å›äºŒç»´ç ä½ç½®åæ ‡ï¼Œå¯è§†åŒ–æ ‡è®°æ›´æ–¹ä¾¿</li>
<li><strong>é«˜çº§å›¾åƒå¤„ç†</strong>ï¼šOTSUã€è‡ªé€‚åº”é˜ˆå€¼ã€é”åŒ–ã€å¯¹æ¯”åº¦æ‹‰ä¼¸</li>
<li><strong>é›¶ä¾èµ–</strong>ï¼šé™¤ Vue ä»¥å¤–æ— é¢å¤–ä¾èµ–ï¼ˆäºŒç»´ç è¯†åˆ«ç®—æ³•ä½¿ç”¨ <code>jsQR</code>ï¼‰</li>
<li><strong>TypeScript æ”¯æŒ</strong>ï¼šå®Œæ•´ç±»å‹å®šä¹‰ï¼ŒäºŒæ¬¡å¼€å‘èˆ’é€‚</li>
</ul>
<h3 data-id="heading-2">ğŸ“¦ å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash">npm install vue-qrcode-scanner
<span class="hljs-comment"># æˆ–</span>
yarn add vue-qrcode-scanner
<span class="hljs-comment"># æˆ–</span>
pnpm add vue-qrcode-scanner
</code></pre>
<p>è¯†åˆ«äºŒç»´ç éœ€è¦ <code>jsQR</code> ç®—æ³•åº“ï¼Œè¯·ä¸€å¹¶å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install jsqr
</code></pre>
<h3 data-id="heading-3">ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆComposable ç”¨æ³•ï¼‰</h3>
<p>æœ€ç®€é›†æˆæ–¹å¼ï¼šç›´æ¥åœ¨ç»„ä»¶é‡Œè°ƒç”¨ <code>useQRCodeScanner</code>ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"handleFileSelect"</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"parseQRCode"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"isLoading"</span>&gt;</span>
      {{ isLoading ? "è§£æä¸­..." : "è§£æäºŒç»´ç " }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- å¯é€‰ï¼šCanvas ç”¨äºé¢„è§ˆ/è¾…åŠ©å¤„ç† --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: none"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"resultMessage"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"resultClass"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">"resultMessage"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { useQRCodeScanner } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-qrcode-scanner/composables"</span>;

<span class="hljs-keyword">const</span> selectedFile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">const</span> {
  resultMessage,
  isLoading,
  qrCode,
  canvas,
  resultClass,
  parseQRFromFile,
  clearResult,
} = <span class="hljs-title function_">useQRCodeScanner</span>();

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFileSelect</span> = (<span class="hljs-params">event</span>) =&gt; {
  selectedFile.<span class="hljs-property">value</span> = event.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">parseQRCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (selectedFile.<span class="hljs-property">value</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">parseQRFromFile</span>(selectedFile.<span class="hljs-property">value</span>);
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">ğŸŒ ä» URL è§£æ</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useQRCodeScanner } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-qrcode-scanner/composables"</span>;

<span class="hljs-keyword">const</span> { parseQRFromUrl } = <span class="hljs-title function_">useQRCodeScanner</span>();

<span class="hljs-keyword">const</span> code = <span class="hljs-keyword">await</span> <span class="hljs-title function_">parseQRFromUrl</span>(<span class="hljs-string">"https://example.com/qrcode.png"</span>);
<span class="hljs-keyword">if</span> (code) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"äºŒç»´ç å†…å®¹:"</span>, code.<span class="hljs-property">data</span>);
}
</code></pre>
<h3 data-id="heading-5">ğŸ§© é«˜çº§ç”¨æ³•ï¼ˆç›´æ¥ä½¿ç”¨å·¥å…·å‡½æ•°ï¼‰</h3>
<p>ä½ ä¹Ÿå¯ä»¥è·³è¿‡ Composableï¼Œç›´æ¥ä½¿ç”¨åº•å±‚çš„å›¾åƒå¤„ç†ä¸æ‰«æå·¥å…·ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { imageProcessors, qrScanner } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-qrcode-scanner"</span>;

<span class="hljs-comment">// 1) å›¾åƒé¢„å¤„ç†ï¼ˆç°åº¦åŒ–ã€OTSUã€è‡ªé€‚åº”é˜ˆå€¼ã€é”åŒ–ã€å¯¹æ¯”åº¦æ‹‰ä¼¸ç­‰ï¼‰</span>
<span class="hljs-keyword">const</span> imageData = ctx.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);
<span class="hljs-keyword">const</span> processed = imageProcessors.<span class="hljs-title function_">preprocessImage</span>(imageData);

<span class="hljs-comment">// 2) å¤šåŒºåŸŸ/å¤šå°ºåº¦æ‰«æ</span>
<span class="hljs-keyword">const</span> code = qrScanner.<span class="hljs-title function_">scanRegions</span>(ctx, width, height);
<span class="hljs-keyword">if</span> (code) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"äºŒç»´ç å†…å®¹:"</span>, code.<span class="hljs-property">data</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ä½ç½®:"</span>, code.<span class="hljs-property">location</span>);
}
</code></pre>
<h3 data-id="heading-6">ğŸ›  API æ‘˜è¦</h3>
<h4 data-id="heading-7">Composable: <code>useQRCodeScanner()</code></h4>
<ul>
<li>å“åº”å¼çŠ¶æ€ï¼š<code>resultMessage</code>ã€<code>isLoading</code>ã€<code>qrCode</code>ã€<code>canvas</code>ã€<code>resultClass</code></li>
<li>æ–¹æ³•ï¼š
<ul>
<li><code>parseQRFromFile(file: File): Promise&lt;QRCode | null&gt;</code></li>
<li><code>parseQRFromUrl(url: string): Promise&lt;QRCode | null&gt;</code></li>
<li><code>clearResult(): void</code></li>
<li><code>showCanvasPreview(): void</code></li>
<li><code>hideCanvasPreview(): void</code></li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">å·¥å…·å‡½æ•°: <code>imageProcessors</code></h4>
<ul>
<li><code>grayscale(imageData: ImageData): GrayData</code></li>
<li><code>otsuThreshold(grayData: Uint8ClampedArray): number</code></li>
<li><code>adaptiveThreshold(grayData, width, height, blockSize?, C?): Uint8ClampedArray</code></li>
<li><code>sharpen(grayData, width, height): Uint8ClampedArray</code></li>
<li><code>contrastStretch(grayData, minPercent?, maxPercent?): Uint8ClampedArray</code></li>
<li><code>preprocessImage(imageData: ImageData): ProcessedImage[]</code></li>
</ul>
<h4 data-id="heading-9">å·¥å…·å‡½æ•°: <code>qrScanner</code></h4>
<ul>
<li><code>tryDecodeQR(imageData: ImageData): QRCode | null</code></li>
<li><code>scanRegions(ctx, imgWidth, imgHeight): QRCode | null</code></li>
<li><code>scanMultiScale(ctx, canvasElement, imgWidth, imgHeight): QRCode | null</code></li>
<li><code>adjustCodeLocation(code, offsetX, offsetY): QRCode</code></li>
<li><code>cropImageRegion(ctx, x, y, width, height): ImageData</code></li>
</ul>
<h4 data-id="heading-10">ç±»å‹å®šä¹‰ï¼ˆèŠ‚é€‰ï¼‰</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">QRCode</span> {
  <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>;
  format?: <span class="hljs-built_in">string</span>;
  location?: <span class="hljs-title class_">QRCodeLocation</span>;
  regionName?: <span class="hljs-built_in">string</span>;
  preprocessMethod?: <span class="hljs-built_in">string</span>;
  scale?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">QRCodeLocation</span> {
  <span class="hljs-attr">topLeftCorner</span>: { <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span> };
  <span class="hljs-attr">topRightCorner</span>: { <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span> };
  <span class="hljs-attr">bottomLeftCorner</span>: { <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span> };
  <span class="hljs-attr">bottomRightCorner</span>: { <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span> };
}
</code></pre>
<h3 data-id="heading-11">âš ï¸ æ³¨æ„äº‹é¡¹ &amp; å®æˆ˜ç»éªŒ</h3>
<ol>
<li><code>jsQR</code> ä¸ºè§£ææ ¸å¿ƒåº“ï¼Œè¯·ç¡®ä¿å·²å®‰è£…å¹¶æ­£ç¡®å¼•å…¥</li>
<li>æµè§ˆå™¨éœ€æ”¯æŒ Canvas APIï¼›è·¨åŸŸå›¾ç‰‡è¯·ç¡®ä¿ CORS å…è®¸ï¼Œå¦åˆ™æ— æ³•è¯»å–åƒç´ </li>
<li>å¤§å°ºå¯¸å›¾ç‰‡å»ºè®®å…ˆç­‰æ¯”å‹ç¼©åˆ°åˆé€‚å°ºå¯¸ï¼ˆå¦‚æœ€é•¿è¾¹ä¸è¶…è¿‡ 2000pxï¼‰ä»¥æå‡é€Ÿåº¦</li>
<li>å¤æ‚èƒŒæ™¯ä¸‹å»ºè®®å¤šå°è¯•é¢„å¤„ç†ç»„åˆï¼ˆåº“å†…å·²å†…ç½®å¤šç­–ç•¥è‡ªåŠ¨å°è¯•ï¼‰</li>
<li>å¦‚æœéœ€è¦åœ¨ UI ä¸­é«˜äº®äºŒç»´ç ä½ç½®ï¼Œå¯ç»“åˆè¿”å›çš„ <code>location</code> å››ç‚¹åæ ‡ç»˜åˆ¶</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React SSR æŠ€æœ¯å®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7570659828811202594</link>    <guid>https://juejin.cn/post/7570659828811202594</guid>    <pubDate>2025-11-10T08:08:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570659828811202594" data-draft-id="7570341520550395919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React SSR æŠ€æœ¯å®ç°åŸç†"/> <meta itemprop="keywords" content="React.js,ç®—æ³•"/> <meta itemprop="datePublished" content="2025-11-10T08:08:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éª‘è‡ªè¡Œè½¦çš„ç å†œ"/> <meta itemprop="url" content="https://juejin.cn/user/4195392103390061"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React SSR æŠ€æœ¯å®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4195392103390061/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éª‘è‡ªè¡Œè½¦çš„ç å†œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:08:12.000Z" title="Mon Nov 10 2025 08:08:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è‘—æœ‰ã€ŠReact æºç ã€‹ã€ŠReact ç”¨åˆ°çš„ä¸€äº›ç®—æ³•ã€‹ã€Šjavascriptåœ°æœˆæ˜Ÿã€‹ç­‰å¤šä¸ªä¸“æ ã€‚æ¬¢è¿å…³æ³¨ã€‚</p>
<p>æ–‡ç« ä¸å¥½å†™ï¼Œè¦æ˜¯æœ‰å¸®åŠ©åˆ«å¿˜äº†ç‚¹èµï¼Œæ”¶è—ï½ ä½ çš„é¼“åŠ±æ˜¯æˆ‘ç»§ç»­æŒ–å¹²è´§çš„çš„åŠ¨åŠ›ğŸ”¥ã€‚</p>
<p>å¦å¤–ï¼Œæœ¬æ–‡ä¸ºåŸåˆ›å†…å®¹ï¼Œå•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½éœ€æ³¨æ˜å‡ºå¤„ï¼Œæ„Ÿè°¢ç†è§£ï½</p>
</blockquote>
<h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†</h2>
<p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡<a href="https://juejin.cn/post/7549131152999596067" target="_blank" title="https://juejin.cn/post/7549131152999596067">React SSR è®¾è®¡åŸç†</a>é˜…è¯»é‡ä¸é«˜ï¼Œæ„Ÿè§‰å†™çš„è¿˜å¯ä»¥ï¼Œæ‰€ä»¥é‡æ–°æ•´ç†å’Œå¢åŠ äº†ä¸€äº›å†…å®¹ï¼Œå†å‘ä¸€éã€‚æœ«å°¾çš„â€œæ€»ç»“â€éå¸¸å€¼å¾—çœ‹ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ²¡æœ‰äººæŠŠSSRè§£è¯»çš„è¿™ä¹ˆå½»åº•ã€‚è®°å¾—ç‚¹èµå“¦ï½ğŸ‘ã€‚</p>
<h3 data-id="heading-1">SSRæ­å»º å››ä¸ªè§’è‰²</h3>
<p>serveræœåŠ¡å™¨(server.js) + server ssrè¿”å›çº¯htmlé¦–é¡µï¼ˆentry-server.jsx) + client hydrateRootæ³¨æ°´ç»™htmlï¼ŒæŠŠ Fiber æ ‘æŒ‚æ¥åˆ°ç°æœ‰ DOM ä¸Š(å¯¹åº”client.jsx)ï¼Œç»™ DOM èŠ‚ç‚¹åŠ ä¸Š React çš„äº‹ä»¶ç»‘å®šã€å†…éƒ¨çŠ¶æ€ï¼Œä½¿ DOM å˜â€œæ´»â€ã€‚</p>
<p>æµç¨‹ï¼šè¯·æ±‚serveræœåŠ¡å™¨ï¼ˆserver.js)ï¼Œè¿”å›é¦–é¡µå†…å®¹ï¼ˆentry-server.jsx) ----&gt;  é¦–é¡µä¸‹è½½è„šæœ¬client.jsxï¼Œclient.jsxæ‰§è¡ŒhydrateRootæ°´åˆï¼ŒReactæ¥ç®¡ã€‚</p>
<p>æ‰€ä»¥èƒ½çœ‹åˆ°å››ä¸ªè§’è‰²:ã€server.jsã€‘ã€entry-server.jsxã€‘ã€client.jsxã€‘ã€App.jsx LazyComp.jsxã€‘ã€‚<br/>
å…¶ä¸­ã€App.jsx LazyComp.jsxã€‘è¿™ä¸¤ä¸ªå±äºå…¬å…±çš„ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½ç”¨åˆ°ã€‚</p>
<pre><code class="hljs language-sql" lang="sql">my<span class="hljs-operator">-</span>react<span class="hljs-operator">-</span>app
 â”œâ”€â”€ dist<span class="hljs-operator">/</span>
 â”‚    â”œâ”€â”€ server<span class="hljs-operator">/</span>
 â”‚    â”‚    â””â”€â”€ server.js   â† è¿™ä¸ªåœ¨ Node è·‘ï¼Œä¸ä¼šå‘ç»™å®¢æˆ·ç«¯ æ‰“åŒ…å‰æ˜¯entry<span class="hljs-operator">-</span>server.jsx
 â”‚    â””â”€â”€ client<span class="hljs-operator">/</span>
 â”‚         â””â”€â”€ client.js         â† è¿™ä¸ªæ‰ä¼šå‘ç»™æµè§ˆå™¨
 â”œâ”€â”€ server.js  å’Œä¸Šé¢çš„server.jsä¸åŒåŒä¸€ä¸ªï¼Œnode server.jså¯åŠ¨çš„æ˜¯è¿™ä¸ª

åœ¨æä¾›çš„ä¾‹å­ä¸­è¿˜æœ‰App.jsx LazyComp.jsxçš„æ‰“åŒ…æ²¡æœ‰åœ¨ä¸Šæ–¹ä½“ç°ï¼Œç®€åŒ–é€»è¾‘ï¼Œä¸»è¦å°±æ˜¯è¿™<span class="hljs-number">3</span>æ–¹ã€‚
App  LazyCompåœ¨æœåŠ¡çš„å’Œå®¢æˆ·ç«¯éƒ½è¢«ä½¿ç”¨å±äºå…¬å…±çš„ã€‚
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36b1d503216543e4811900889ba2724b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=AYJBcNjiqbcA55rqwBlbGkpD67w%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>æˆ‘æ”¹äº†æ‰“åŒ…ç›®å½•éƒ¨åˆ†çš„é…ç½®ï¼Œæ‰“åŒ…åçš„ç›®å½•ä¸ä¸€æ ·äº†ï¼Œä¸å½±å“é˜…è¯»</p>
</blockquote>
<h3 data-id="heading-2">è¿è¡Œä¸¤éReactç»„ä»¶</h3>
<p>åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œä¸€éReactç»„ä»¶ï¼Œç”Ÿæˆhtmlåè¿”å›çº¯htmlç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆé¦–æ¬¡æ¸²æŸ“ã€‚<br/>
åœ¨å®¢æˆ·ç«¯æ‰§è¡Œclient.jsè¿›è¡Œæ°´åˆï¼Œå†æ¬¡æ‰§è¡Œä¸€éReactç»„ä»¶ï¼Œåˆ›å»ºFiberã€æŒ‚æ¥åˆ°DOMã€ç»‘å®šäº‹ä»¶ç­‰ã€‚</p>
<pre><code class="hljs language-jsx" lang="jsx">entry-server.<span class="hljs-property">jsx</span>
<span class="hljs-keyword">const</span> { pipe } = <span class="hljs-title function_">renderToPipeableStream</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, {...<span class="hljs-title function_">pipe</span>(res)...})

æ³¨æ„è¿™é‡Œçš„&lt;<span class="hljs-title class_">App</span>/&gt;ç»è¿‡æ‰“åŒ…åæ˜¯ï¼Œ
<span class="hljs-keyword">const</span> { pipe } = <span class="hljs-title function_">renderToPipeableStream</span>(<span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">App</span>, <span class="hljs-literal">null</span>), {...<span class="hljs-title function_">pipe</span>(res)...})
æœåŠ¡ç«¯è¿è¡Œ<span class="hljs-title class_">React</span>.<span class="hljs-property">createElement</span>å¾—åˆ°<span class="hljs-title class_">App</span>çš„htmlã€‚

æ˜æ˜¾å·²ç»è¿è¡Œäº†ä¸€é<span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">App</span>, <span class="hljs-literal">null</span>)ï¼Œçº¯<span class="hljs-title class_">App</span>çš„htmlã€‚
ä¸‹é¢åœ¨å®¢æˆ·ç«¯è¿˜ä¼šè¿è¡Œä¸€éã€‚
</code></pre>
<p>è¿”å›Appçš„çº¯htmlï¼Œé€šè¿‡pipeèƒ½è·å–ï¼Œåœ¨optionä¸­æ³¨å…¥ã€‚</p>
<p>å®¢æˆ·ç«¯ä¼šå†è¿è¡Œä¸€éã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">hydrateRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>), <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
æ‰“åŒ…åï¼š
<span class="hljs-title function_">hydrateRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>), <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">App</span>, <span class="hljs-literal">null</span>));
</code></pre>
<p>è¿™ä¸€éå«æ°´åˆã€‚æ²¡æœ‰æ°´åˆå‰æ˜¯çº¯htmlçš„é¡µé¢ã€‚æ°´åˆåè¢«Reactæ¥ç®¡ã€‚<br/>
ä¾‹å¦‚åœ¨åé¢çš„å®è·µä¾‹å­ä¸­ï¼Œç¬¬8ç§’åœ¨vscodeæ‰“å°ä¸€æ¬¡ï¼Œç¬¬16ç§’åœ¨æµè§ˆå™¨æ‰“å°ä¸€æ¬¡ã€‚</p>
<h3 data-id="heading-3">HTMLçš„æ°´åˆ</h3>
<p>æ°´åˆå°±æ˜¯ç»™æœåŠ¡ç«¯çš„è¿”å›çš„HTMLçš„DOMæ·»åŠ internalInstanceKeyï¼Œèƒ½æ‰¾åˆ°å®ƒçš„Fiberã€‚</p>
<p>å˜é‡internalInstanceKeyï¼Œå€¼ç±»ä¼¼äº__reactFiber$chytmrjmd38ï¼Œ__reactFiber$+éšæœºæ•°ã€‚<br/>
æ¯ä¸ªçœŸå®DOMéƒ½æœ‰__reactFiber$...å±æ€§ï¼ŒæŒ‡å‘çœŸå®DOMå¯¹åº”çš„Fiber Nodeã€‚<br/>
å¦‚æœçœŸå®DOMæ²¡æœ‰__reactFiber$...è¡¨ç¤ºè¿™ä¸ªDOMæ²¡æœ‰å—åˆ°Reactçš„ç®¡ç†ï¼Œä¾‹å¦‚SSRæ—¶æœåŠ¡ç«¯è¿”å›çš„HTMLã€‚<br/>
æˆ‘ç®€å•çš„æŠŠâ€œç»™DOMæ·»åŠ __reactFiber$..å±æ€§â€ä¸€èµ·å½’åˆ°hydrateRoot()ã€‚ï¼ˆå®é™…hydrateRootæ²¡æœ‰åšè¿™ä»¶äº‹ã€‚æ·»åŠ å±æ€§æ˜¯è§¦å‘ä»»æ„äº‹ä»¶çš„æ—¶å€™åšçš„ï¼‰ï¼Œæœ‰å¯¹åº”çš„Fiber Nodeï¼Œè¿™ä¸ªDOMå°±è¢«Reactæ¥ç®¡äº†ã€‚</p>













<table><thead><tr><th>æ°´åˆå‰ åªæ˜¯ç®€å•çš„html æ²¡æœ‰__reactFiber$...å±æ€§</th><th>æ°´åˆå å¤šäº†__reactFiber$...å±æ€§</th></tr></thead><tbody><tr><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44c7884d899d407ea03b98ad53f0c01f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=h2tmXyTC6iZoEVCLT3s7Otim0oY%3D" alt="" loading="lazy"/></td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4ed097f450f474d80e18002ed04c76b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=LbKLxBy56i%2B1bccgHZxwI7DqFfU%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<h3 data-id="heading-4">æ³¨é‡ŠèŠ‚ç‚¹</h3>
<p>SSRç”Ÿæˆçš„HTMLå¸¦æœ‰æ³¨é‡Š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- $? --&gt;</span>  æœ‰internalInstanceKeyã€å—åˆ°ç®¡ç†
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>        æ²¡æœ‰internalInstanceKeyã€æ²¡æœ‰å—åˆ°ç®¡ç†
    Loading...
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- /$ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- $ --&gt;</span>  æœ‰internalInstanceKeyã€å—åˆ°ç®¡ç†
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>        æ²¡æœ‰internalInstanceKeyã€æ²¡æœ‰å—åˆ°ç®¡ç†
    Hello World!
  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- /$ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>Reactå€ŸåŠ©æ³¨é‡ŠèŠ‚ç‚¹ï¼Œå¿«é€Ÿæ‰¾åˆ°SSRå†…å®¹ã€‚å¦‚æœæ²¡æœ‰æ³¨é‡ŠèŠ‚ç‚¹ï¼Œæ— æ³•åˆ†è¾¨SSRå†…å®¹æˆ–è€…è¦ä»æ•´ä¸ªé¡µé¢å…¨éƒ¨èŠ‚ç‚¹ä¸­ä¸€ä¸ªä¸€ä¸ªæŸ¥æ‰¾ã€‚<br/>
Reactä¸­ä¸“é—¨æŸ¥æ‰¾æ³¨é‡ŠèŠ‚ç‚¹çš„å‡½æ•°<code>getParentSuspenseInstance</code>:</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!--$--&gt;</span>                    â† Suspense A å¼€å§‹ (pending)  æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Content A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>      æ³¨é‡Šå’Œå†…å®¹æ˜¯å…„å¼ŸèŠ‚ç‚¹
  <span class="hljs-comment">&lt;!--$--&gt;</span>                  â† Suspense B å¼€å§‹ (pending)
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>åµŒå¥—<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-comment">&lt;!--/$--&gt;</span>                 â† Suspense B ç»“æŸ
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"target"</span>&gt;</span>Target<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  â† targetInstance  ä»è¿™é‡Œå¼€å§‹
<span class="hljs-comment">&lt;!--/$--&gt;</span>                   â† Suspense A ç»“æŸ
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getParentSuspenseInstance</span>(<span class="hljs-params">targetInstance</span>) {
  <span class="hljs-keyword">var</span> node = targetInstance.<span class="hljs-property">previousSibling</span>; 
  <span class="hljs-keyword">var</span> depth = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">while</span> (node) {
    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">nodeType</span> === <span class="hljs-variable constant_">COMMENT_NODE</span>) {
      <span class="hljs-keyword">var</span> data = node.<span class="hljs-property">data</span>;<span class="hljs-comment">//nodeæ˜¯`&lt;!--$--&gt;`, `&lt;!--$!--&gt;`, `&lt;!--$?--&gt;`, `&lt;!--/$--&gt;` ã€‚dataæ˜¯`$``$!``$?``/$`ã€‚</span>

      <span class="hljs-keyword">if</span> (data === <span class="hljs-variable constant_">SUSPENSE_START_DATA</span> || <span class="hljs-comment">// $</span>
          data === <span class="hljs-variable constant_">SUSPENSE_FALLBACK_START_DATA</span> ||  <span class="hljs-comment">// $!</span>
          data === <span class="hljs-variable constant_">SUSPENSE_PENDING_START_DATA</span>) { <span class="hljs-comment">// $?</span>
        <span class="hljs-comment">// é‡åˆ° Suspense å¼€å§‹</span>
        <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> node; <span class="hljs-comment">// æ‰¾åˆ°äº†æœ€å¤–å±‚æœªé—­åˆçš„ Suspenseï¼Œè¿”å›</span>
        } <span class="hljs-keyword">else</span> {
          depth--; <span class="hljs-comment">// é€€å‡ºä¸€å±‚åµŒå¥—</span>
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data === <span class="hljs-variable constant_">SUSPENSE_END_DATA</span>) { <span class="hljs-comment">// /$</span>
        depth++; <span class="hljs-comment">// é‡åˆ°ç»“æŸï¼Œè¯´æ˜æˆ‘ä»¬â€œè¿›å…¥â€äº†ä¸€ä¸ªæ›´å¤–å±‚çš„ Suspense èŒƒå›´</span>
      }
    }

    node = node.<span class="hljs-property">previousSibling</span>; <span class="hljs-comment">//ä»åå¾€å‰æ‰¾</span>
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>è¿”å›&lt;!-- $ --&gt;ç­‰çš„DOMã€‚</p>
<h2 data-id="heading-5">ç¬¬äºŒéƒ¨åˆ†</h2>
<h3 data-id="heading-6">SSRæ ¸å¿ƒæ¦‚å¿µ</h3>
<p>ç”¨å®˜è¯æ¥è®²ï¼š</p>
<ul>
<li>åŒæ„ï¼ˆIsomorphic / Universal Renderingï¼‰æŒ‡ React ä»£ç æ—¢èƒ½è¿è¡Œåœ¨æœåŠ¡ç«¯ï¼ˆNode.jsï¼‰åˆèƒ½è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ã€‚å…¶å®å°±æ˜¯åœ¨æœåŠ¡çš„æ‰§è¡Œä¸€éreactç»„ä»¶ã€‚</li>
<li>æ³¨æ°´ ï¼ˆHydrationï¼‰æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡ç«¯ç”Ÿæˆçš„ HTML åï¼ŒReact <strong>ä¸ä¼šé‡æ–°æ¸²æŸ“ DOM</strong>ï¼Œè€Œæ˜¯â€œæ³¨æ°´â€â€”â€”æŠŠ <strong>Fiber æ ‘æŒ‚æ¥åˆ°ç°æœ‰ DOM</strong> ä¸Šã€‚ç»™ DOM èŠ‚ç‚¹åŠ ä¸Š React çš„äº‹ä»¶ç»‘å®šã€å†…éƒ¨çŠ¶æ€ï¼Œä½¿ DOM å˜â€œæ´»â€ã€‚</li>
<li>è„±æ°´ (Dehydration)ï¼šåœ¨ React 18 é‡Œï¼Œ<strong>Suspense è¾¹ç•Œå¯ä»¥è¢«â€œè„±æ°´â€</strong> ï¼Œå³ä¿ç•™ fallback æˆ– HTML ç‰‡æ®µï¼Œä½†ä¸ç«‹å³ hydrateã€‚ç­‰åˆ°ç”¨æˆ·äº¤äº’æˆ–èµ„æºåˆ°è¾¾ï¼Œå†å¯¹å±€éƒ¨è¿›è¡Œ hydrationã€‚</li>
</ul>
<p>åŒæ„æ˜¯ä¸€ä¸ªå®è§‚ç›®æ ‡ï¼š å®ƒçš„ç›®æ ‡æ˜¯è®©åŒä¸€å¥—ä»£ç æ—¢èƒ½åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼ˆç”Ÿæˆ HTMLï¼‰ï¼Œåˆèƒ½åœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼ˆå¤„ç†äº¤äº’ï¼‰ã€‚å®ƒæè¿°çš„æ˜¯ä¸€ç§<strong>æ¶æ„æ¨¡å¼</strong>ã€‚<br/>
è„±æ°´/æ³¨æ°´æ˜¯ä¸€ä¸ªå¾®è§‚å®ç°ï¼š å®ƒæ˜¯å®ç°åŒæ„è¿™ä¸ª<strong>ç›®æ ‡</strong>æ‰€å¿…é¡»çš„<strong>æŠ€æœ¯æ‰‹æ®µ</strong>ã€‚</p>
<p>å…¶å®å°±æ˜¯æœåŠ¡ç«¯æ‰§è¡Œä¸€éReactç»„ä»¶è¿”å›HTMLã€‚ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰<br/>
HTMLä¸Šçš„DOMæ‰¾ä¸åˆ°Fiberã€‚ï¼ˆè„±æ°´çš„ï¼‰<br/>
æŠŠFiberå…³è”åˆ°DOMï¼ŒDOMèƒ½æ‰¾åˆ°è‡ªå·±çš„Fiberï¼ˆæ³¨æ°´ï¼‰</p>
<h2 data-id="heading-7">ç¬¬ä¸‰éƒ¨åˆ†</h2>
<h3 data-id="heading-8">å®è·µä¾‹å­</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/App.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { <span class="hljs-title class_">Suspense</span>, lazy } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComp</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è¿è¡Œä¸€æ¬¡LazyComp'</span>);---è¿è¡Œä¸¤é<span class="hljs-title class_">React</span>ç»„ä»¶ï¼šåœ¨vscodeæ§åˆ¶å°æ‰“å°ä¸€æ¬¡ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å°ä¸€æ¬¡  ç¬¬<span class="hljs-number">8</span>ç§’åœ¨vscodeæ‰“å°ï¼Œç¬¬<span class="hljs-number">16</span>ç§’åœ¨æµè§ˆå™¨æ‰“å°

      <span class="hljs-title function_">resolve</span>(<span class="hljs-keyword">import</span>(<span class="hljs-string">'./LazyComp'</span>));
    }, <span class="hljs-number">8000</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿ 8 ç§’å»¶è¿Ÿ</span>
  });
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">LazyComp</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">//client.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { hydrateRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom/client"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./App.jsx"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">22222</span>);
<span class="hljs-title function_">hydrateRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>), <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
</code></pre>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// entry-server.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { renderToPipeableStream } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom/server"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./App.jsx"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">res</span>) {
  <span class="hljs-keyword">const</span> { pipe } = <span class="hljs-title function_">renderToPipeableStream</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, {
    <span class="hljs-title function_">onShellReady</span>(<span class="hljs-params"/>) {
      res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"content-type"</span>, <span class="hljs-string">"text/html"</span>);
      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`&lt;!DOCTYPE html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;title&gt;My React App&lt;/title&gt;
            &lt;meta charset="UTF-8"&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;div id="root"&gt;`</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">222</span>);
      <span class="hljs-title function_">pipe</span>(res);<span class="hljs-comment">//å¦‚æœæŠŠconst {pipe}æ³¨é‡Šæ‰ï¼Œä¼šæŠ¥é”™ pipe is not defined;</span>
      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`&lt;/div&gt;
          &lt;/body&gt;
          &lt;script type="module" src="/dist/client.js"&gt;&lt;/script&gt;
        &lt;/html&gt;`</span>);
    },
  });
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// LazyComp.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LazyComp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>âœ…Hello !<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//server.js  åœ¨æ ¹ç›®å½•ï¼</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>;
<span class="hljs-keyword">import</span> { createServer <span class="hljs-keyword">as</span> createViteServer } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">"url"</span>;

<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>));

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

  <span class="hljs-comment">// 1. åˆ›å»º Vite dev server (ä¸­é—´ä»¶æ¨¡å¼)</span>
  <span class="hljs-keyword">const</span> vite = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createViteServer</span>({
    <span class="hljs-attr">server</span>: { <span class="hljs-attr">middlewareMode</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">appType</span>: <span class="hljs-string">"custom"</span>
  });

  app.<span class="hljs-title function_">use</span>(vite.<span class="hljs-property">middlewares</span>);

  <span class="hljs-comment">// 2. SSR è·¯ç”±</span>
  app.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/"</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// const { render } = await vite.ssrLoadModule("/src/entry-server.jsx");</span>
      <span class="hljs-keyword">const</span> { render } = <span class="hljs-keyword">await</span> vite.<span class="hljs-title function_">ssrLoadModule</span>(<span class="hljs-string">"/dist/server.js"</span>);
      <span class="hljs-title function_">render</span>(res);
    } <span class="hljs-keyword">catch</span> (e) {
      vite.<span class="hljs-title function_">ssrFixStacktrace</span>(e);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">end</span>(e.<span class="hljs-property">message</span>);
    }
  });

  app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸš€ SSR server running at http://localhost:3000"</span>);
  });
}

<span class="hljs-title function_">start</span>();

</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-comment">// import react from '@vitejs/plugin-react';</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// plugins: [react()],//å¯¼å…¥React</span>
  <span class="hljs-attr">define</span>: {
    <span class="hljs-string">"process.env.NODE_ENV"</span>: <span class="hljs-string">'"development"'</span>,
  },
  <span class="hljs-comment">// minify: false,</span>
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">ssr</span>: <span class="hljs-literal">true</span>,<span class="hljs-comment">//å¿…é¡»æ˜¯true,æ˜¯falseæ‰“åŒ…åentry-server.jsxè¿”å›renderä¸è¿”å›</span>
    <span class="hljs-comment">// sourcemap: true, // ç”Ÿæˆ client.js.map</span>
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">server</span>: <span class="hljs-string">'src/entry-server.jsx'</span>, 
        <span class="hljs-attr">client</span>: <span class="hljs-string">"src/client.jsx"</span>
      },
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">"[name].js"</span>,
      }
    }
  },
});
</code></pre>
<ul>
<li>å¦‚æœæŠŠconst {pipe}æ³¨é‡Šæ‰ï¼Œä¼šæŠ¥é”™ pipe is not defined;</li>
<li>pipeçš„åŸç†æ˜¯res.writeã€‚å†…éƒ¨å€Ÿç”¨TextEncoder.encodeInto()ã€unit8arrayæœ€åres.writeã€‚<br/>
textEncoder.encodeInto()èƒ½æŠŠæ•°æ®å†™å…¥unit8arrayã€‚</li>
</ul>
<blockquote>
<p>æœ¬ä¾‹å­çš„è¡¥å……è¯´æ˜viteçš„index.htmlå’Œæ‰“åŒ…:</p>
<p>ä¸ºäº†ç®€åŒ–ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­è™½ç„¶å­˜åœ¨main.jsxã€index.htmlï¼Œä½†æ˜¯æ²¡æœ‰ç”¨åˆ°index.htmlï¼Œè€Œæ˜¯åœ¨entry-server.jsxæ‰‹å†™çš„htmlã€‚<br/>
è¿™æ ·çš„ç¼ºç‚¹æ˜¯ä¸èƒ½åˆ©ç”¨viteæ‰“åŒ…è‡ªåŠ¨æ³¨å…¥index.htmlçš„å†…å®¹åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 data-id="heading-9">pipeçš„åŸç†</h3>
<ul>
<li>completeWritingæŠŠloading...å’Œâœ…Helloå‘é€è¿‡å»ã€‚åŸç†å°±æ˜¯res.writeã€‚resæ˜¯expressè¯·æ±‚çš„responseã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//node_modules/react-dom/cjs/react-dom-server.node.development.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">completeWriting</span>(<span class="hljs-params">destination</span>) {<span class="hljs-comment">//destinationå°±æ˜¯res</span>
  <span class="hljs-keyword">if</span> (currentView &amp;&amp; writtenBytes &gt; <span class="hljs-number">0</span>) {<span class="hljs-comment">//currentViewå°±æ˜¯unit8Array</span>
    <span class="hljs-comment">// console.log(destination.write(currentView.subarray(0, 64)));</span>
    <span class="hljs-comment">// console.log(destination.write(currentView.subarray(0, 499)));</span>
    destination.<span class="hljs-title function_">write</span>(currentView.<span class="hljs-title function_">subarray</span>(<span class="hljs-number">0</span>, writtenBytes));
  }
  currentView = <span class="hljs-literal">null</span>;
  writtenBytes = <span class="hljs-number">0</span>;
  destinationHasCapacity = <span class="hljs-literal">true</span>;
}
</code></pre>













<table><thead><tr><th/><th/></tr></thead><tbody><tr><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d6c54c6e56341b8a24d332fabdd8890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=w%2FenA%2F8KxmajZU07vg1CqU5735o%3D" alt="" loading="lazy"/></td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80f09b5b8104c918fddf82a591b69db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=eA1Ymlo96gmoOHYAyiV%2B3MoKQ3Y%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<ul>
<li>send$1æŠŠæ–‡ä»¶å‘é€è¿‡å»  è¿™ä¼¼ä¹æ˜¯viteå¹²çš„</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//node_modules/vite/dist/node/chunks/dep-BcnkIxro.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">send$1</span>(<span class="hljs-params">req, res, content, type, options</span>) {
  <span class="hljs-keyword">const</span> {
    etag = <span class="hljs-title function_">getEtag</span>(content, { <span class="hljs-attr">weak</span>: <span class="hljs-literal">true</span> }),
    cacheControl = <span class="hljs-string">"no-cache"</span>,
    headers,
    map
  } = options;
  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">writableEnded</span>) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">headers</span>[<span class="hljs-string">"if-none-match"</span>] === etag) {
    res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">304</span>;
    res.<span class="hljs-title function_">end</span>();
    <span class="hljs-keyword">return</span>;
  }
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Content-Type"</span>, alias[type] || type);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Cache-Control"</span>, cacheControl);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Etag"</span>, etag);
  <span class="hljs-keyword">if</span> (headers) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> headers) {
      res.<span class="hljs-title function_">setHeader</span>(name, headers[name]);
    }
  }
  <span class="hljs-keyword">if</span> (map &amp;&amp; <span class="hljs-string">"version"</span> <span class="hljs-keyword">in</span> map &amp;&amp; map.<span class="hljs-property">mappings</span>) {
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"js"</span> || type === <span class="hljs-string">"css"</span>) {
      content = <span class="hljs-title function_">getCodeWithSourcemap</span>(type, content.<span class="hljs-title function_">toString</span>(), map);
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"js"</span> &amp;&amp; (!map || map.<span class="hljs-property">mappings</span> !== <span class="hljs-string">""</span>)) {
    <span class="hljs-keyword">const</span> code = content.<span class="hljs-title function_">toString</span>();
    <span class="hljs-keyword">if</span> (convertSourceMap.<span class="hljs-property">mapFileCommentRegex</span>.<span class="hljs-title function_">test</span>(code)) {
      debug$3?.(<span class="hljs-string">`Skipped injecting fallback sourcemap for <span class="hljs-subst">${req.url}</span>`</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> urlWithoutTimestamp = <span class="hljs-title function_">removeTimestampQuery</span>(req.<span class="hljs-property">url</span>);
      <span class="hljs-keyword">const</span> ms = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MagicString</span>(code);
      content = <span class="hljs-title function_">getCodeWithSourcemap</span>(
        type,
        code,
        ms.<span class="hljs-title function_">generateMap</span>({
          <span class="hljs-attr">source</span>: path$d.<span class="hljs-title function_">basename</span>(urlWithoutTimestamp),
          <span class="hljs-attr">hires</span>: <span class="hljs-string">"boundary"</span>,
          <span class="hljs-attr">includeContent</span>: <span class="hljs-literal">true</span>
        })
      );
    }
  }
  res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">200</span>;
  res.<span class="hljs-title function_">end</span>(content);
  <span class="hljs-keyword">return</span>;
}
</code></pre>

















<table><thead><tr><th/><th/></tr></thead><tbody><tr><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6e125ed16cc4620ad584d3426933d56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=EJdYzlDp5l15LhfPSbnYTRMlm94%3D" alt="" loading="lazy"/></td><td>å¾…å¤„ç†<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9fd898a72be4d8ba12e9244657b5e42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=0IlHec2JDFo6co%2FHKMxAm6aoLCQ%3D" alt="" loading="lazy"/></td></tr><tr><td>çŠ¶æ€ç 200 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bee5add7c834471e95b56679fc3c2a26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=%2FGIkWCzOOqs3ty3S2dgDwYh5HZE%3D" alt="" loading="lazy"/></td><td/></tr></tbody></table>
<h3 data-id="heading-10">æ’å…¥è„šæœ¬ç‰‡æ®µ</h3>
<p>SSRå¤šæ¬¡ç”¨åˆ°äº†<code>æ’å…¥è„šæœ¬ç‰‡æ®µ</code>çš„æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯æ’å…¥&lt;script&gt;ï¼Œä½œä¸ºæ•´ä¸ªSSRæŠ€æœ¯å®ç°çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚å‰é¢çš„æ’å…¥client.jsï¼Œä¾‹å¦‚å‰é¢çš„çŠ¶æ€çš„æ³¨æ°´ï¼Œè¿˜æœ‰è¿™é‡Œçš„$RCå‡½æ•°:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efe38241ccee4c18b8fdb641f0b587db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=gLAG%2BnUAJhJS9vUVL0CXRzjGueo%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//node_modules/react-dom/cjs/react-dom-server.node.development.js</span>
<span class="hljs-keyword">var</span> completeBoundaryFunction = <span class="hljs-string">'function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&amp;&amp;8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&amp;&amp;"$?"!==d&amp;&amp;"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&amp;&amp;a._reactRetry()}}'</span>;
<span class="hljs-keyword">var</span> completeBoundaryScript1Full = <span class="hljs-title function_">stringToPrecomputedChunk</span>(completeBoundaryFunction + <span class="hljs-string">';$RC("'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">writeCompletedBoundaryInstruction</span>(<span class="hljs-params">destination, responseState, boundaryID, contentSegmentID</span>) {
  <span class="hljs-title function_">writeChunk</span>(destination, responseState.<span class="hljs-property">startInlineScript</span>);

  <span class="hljs-keyword">if</span> (!responseState.<span class="hljs-property">sentCompleteBoundaryFunction</span>) {
    <span class="hljs-comment">// The first time we write this, we'll need to include the full implementation.</span>
    responseState.<span class="hljs-property">sentCompleteBoundaryFunction</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">writeChunk</span>(destination, completeBoundaryScript1Full);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// Future calls can just reuse the same function.</span>
    <span class="hljs-title function_">writeChunk</span>(destination, completeBoundaryScript1Partial);
  }

  <span class="hljs-keyword">if</span> (boundaryID === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'An ID must have been assigned before we can complete the boundary.'</span>);
  }

  <span class="hljs-keyword">var</span> formattedContentID = <span class="hljs-title function_">stringToChunk</span>(contentSegmentID.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>));
  <span class="hljs-title function_">writeChunk</span>(destination, boundaryID);
  <span class="hljs-title function_">writeChunk</span>(destination, completeBoundaryScript2);
  <span class="hljs-title function_">writeChunk</span>(destination, responseState.<span class="hljs-property">segmentPrefix</span>);
  <span class="hljs-title function_">writeChunk</span>(destination, formattedContentID);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">writeChunkAndReturn</span>(destination, completeBoundaryScript3);
}
</code></pre>
<p>æŠŠå˜é‡å‘½åæˆæœ‰æ„ä¹‰çš„å˜é‡åï¼Œå–æ¶ˆæ‰å‹ç¼©åœ¨çœ‹ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">$RC</span>(<span class="hljs-params">a,b</span>){a=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(a);b=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(b);b.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(b);<span class="hljs-keyword">if</span>(a){a=a.<span class="hljs-property">previousSibling</span>;<span class="hljs-keyword">var</span> f=a.<span class="hljs-property">parentNode</span>,c=a.<span class="hljs-property">nextSibling</span>,e=<span class="hljs-number">0</span>;<span class="hljs-keyword">do</span>{<span class="hljs-keyword">if</span>(c&amp;&amp;<span class="hljs-number">8</span>===c.<span class="hljs-property">nodeType</span>){<span class="hljs-keyword">var</span> d=c.<span class="hljs-property">data</span>;<span class="hljs-keyword">if</span>(<span class="hljs-string">"/$"</span>===d)<span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>===e)<span class="hljs-keyword">break</span>;<span class="hljs-keyword">else</span> e--;<span class="hljs-keyword">else</span><span class="hljs-string">"$"</span>!==d&amp;&amp;<span class="hljs-string">"$?"</span>!==d&amp;&amp;<span class="hljs-string">"$!"</span>!==d||e++}d=c.<span class="hljs-property">nextSibling</span>;f.<span class="hljs-title function_">removeChild</span>(c);c=d}<span class="hljs-keyword">while</span>(c);<span class="hljs-keyword">for</span>(;b.<span class="hljs-property">firstChild</span>;)f.<span class="hljs-title function_">insertBefore</span>(b.<span class="hljs-property">firstChild</span>,c);a.<span class="hljs-property">data</span>=<span class="hljs-string">"$"</span>;a.<span class="hljs-property">_reactRetry</span>&amp;&amp;a.<span class="hljs-title function_">_reactRetry</span>()}};$RC(<span class="hljs-string">"B:0"</span>,<span class="hljs-string">"S:0"</span>)
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">replaceSegmentIntoBoundary</span>(<span class="hljs-params">boundaryId, segmentId</span>) {
  <span class="hljs-keyword">const</span> boundaryNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(boundaryId);
  <span class="hljs-keyword">const</span> segmentTemplate = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(segmentId);

  <span class="hljs-comment">// ç§»é™¤ &lt;template&gt; åŒ…è£¹</span>
  segmentTemplate.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(segmentTemplate);

  <span class="hljs-keyword">if</span> (boundaryNode) {
    <span class="hljs-keyword">let</span> marker = boundaryNode.<span class="hljs-property">previousSibling</span>; <span class="hljs-comment">// boundary å‰çš„æ³¨é‡ŠèŠ‚ç‚¹</span>
    <span class="hljs-keyword">const</span> parent = marker.<span class="hljs-property">parentNode</span>;
    <span class="hljs-keyword">let</span> current = marker.<span class="hljs-property">nextSibling</span>;
    <span class="hljs-keyword">let</span> depth = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// åˆ é™¤ boundary å ä½å†…å®¹ (ç›´åˆ° "/$" ç»“æŸæ ‡è®°)</span>
    <span class="hljs-keyword">do</span> {
      <span class="hljs-keyword">if</span> (current &amp;&amp; current.<span class="hljs-property">nodeType</span> === <span class="hljs-number">8</span>) { <span class="hljs-comment">// æ³¨é‡ŠèŠ‚ç‚¹</span>
        <span class="hljs-keyword">const</span> comment = current.<span class="hljs-property">data</span>; <span class="hljs-comment">//dataå°±æ˜¯æ³¨é‡ŠèŠ‚ç‚¹çš„å€¼&lt;!-- å€¼ --&gt;</span>
        <span class="hljs-keyword">if</span> (comment === <span class="hljs-string">"/$"</span>) {
          <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">else</span> depth--;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comment === <span class="hljs-string">"$"</span> || comment === <span class="hljs-string">"$?"</span> || comment === <span class="hljs-string">"$!"</span>) {
          depth++;
        }
      }
      <span class="hljs-keyword">const</span> next = current.<span class="hljs-property">nextSibling</span>;
      parent.<span class="hljs-title function_">removeChild</span>(current);
      current = next;
    } <span class="hljs-keyword">while</span> (current);

    <span class="hljs-comment">// æ’å…¥ segment çš„å†…å®¹</span>
    <span class="hljs-keyword">while</span> (segmentTemplate.<span class="hljs-property">firstChild</span>) {
      parent.<span class="hljs-title function_">insertBefore</span>(segmentTemplate.<span class="hljs-property">firstChild</span>, current);
    }

    <span class="hljs-comment">// æ›´æ–° markerï¼Œæ ‡è®°å·²å®Œæˆ</span>
    marker.<span class="hljs-property">data</span> = <span class="hljs-string">"$"</span>;
    <span class="hljs-keyword">if</span> (marker.<span class="hljs-property">_reactRetry</span>) {
      marker.<span class="hljs-title function_">_reactRetry</span>();
    }
  }
}

<span class="hljs-comment">// æ‰§è¡Œï¼šæŠŠ S:0 (segment) æ›¿æ¢è¿› B:0 (boundary)</span>
<span class="hljs-title function_">replaceSegmentIntoBoundary</span>(<span class="hljs-string">"B:0"</span>, <span class="hljs-string">"S:0"</span>);
</code></pre>













<table><thead><tr><th>B:0</th><th>S:0</th></tr></thead><tbody><tr><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9634c7065cec4b1dbf5b0cb086a8b1de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=BmstxN4kcn%2BM1D1%2B%2BoMry2RVjnM%3D" alt="" loading="lazy"/></td><td><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cd8c37107984ced9f59a5715f28759e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR6Ieq6KGM6L2m55qE56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368185&amp;x-signature=90RR9gwis%2BOTtVqp9Dx4JvppiIw%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-11">æ€»ç»“</h2>
<p>SSRç”±å››ä¸ªè§’è‰²ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å…¬å…±çš„æ–‡ä»¶ã€HTTPæœåŠ¡å™¨ã€å®¢æˆ·ç«¯æ–‡ä»¶å’ŒæœåŠ¡ç«¯æ–‡ä»¶ã€‚<br/>
Reactç»„ä»¶åˆ›å»ºäº†ä¸¤éï¼ŒrenderToPipeableStream+å…¬å…±æ–‡ä»¶åˆ›å»ºä¸€éï¼ŒhydrateRoot+å…¬å…±æ–‡ä»¶åˆ›å»ºç¬¬äºŒéï¼ˆå®Œå…¨æ²¡æœ‰ç”¨åˆ°createRootï¼‰ã€‚</p>
<p><strong>æ°´åˆ</strong>ä¸è¿‡æ˜¯æŠŠFiberèŠ‚ç‚¹å…³è”åˆ°DOMï¼Œæ‰€è°“â€œå…³è”â€å°±æ˜¯é€šè¿‡DOMèƒ½æ‰¾åˆ°Fiberã€‚</p>
<p>SSRæŠ€æœ¯çš„å®ç°è®¾è®¡ä¸è¿‡æ˜¯ <strong>HTMLæ–‡ä»¶ + æ’å…¥è„šæœ¬</strong>ã€‚<br/>
ç¬¬ä¸€æ­¥ï¼Œè¿è¡ŒHTTPæœåŠ¡å™¨ï¼Œ<strong>renderToPipeableStream + å…¬å…±æ–‡ä»¶</strong>åˆ›å»ºçº¯HTMLæ–‡ä»¶<br/>
ç¬¬äºŒæ­¥ï¼Œæ’å…¥æ°´åˆè„šæœ¬client.jsï¼ˆå®¢æˆ·ç«¯æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯hydrateRoot()ï¼‰<br/>
ç¬¬ä¸‰æ­¥ï¼Œæ’å…¥æ›¿æ¢è„šæœ¬$RCã€‚
HTTPæœåŠ¡å™¨è¿”å›è¿™ä¸ªHTMLæ–‡ä»¶ï¼Œæµè§ˆå™¨æ˜¾ç¤ºé¡µé¢ï¼Œæ‰§è¡Œè„šæœ¬ã€‚<br/>
å¾€åï¼Œå†è¦å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚è·¯ç”±çš„ç®¡ç†ã€çŠ¶æ€çš„ç®¡ç†ï¼Œä¸è¿‡ä¹Ÿæ˜¯åœ¨HTMLä¸Šæ’å…¥æ–°çš„è„šæœ¬ï¼ˆä¸æ˜¯å…¨éƒ¨éƒ½è¦æ’å…¥æ–°è„šæœ¬ï¼‰ã€‚<br/>
ä»¥çŠ¶æ€ç®¡ç†ä¸ºä¾‹ï¼Œåœ¨æœåŠ¡ç«¯ï¼Œæ­£å¸¸åˆ›å»ºäº†Storeï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//æœåŠ¡ç«¯</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">"./store"</span>;
<span class="hljs-keyword">const</span> preloadedState = store.<span class="hljs-title function_">getState</span>();
</code></pre>
<p>ç»™HTMLæ–‡ä»¶æ’å…¥è„šæœ¬ï¼š</p>
<pre><code class="hljs language-html" lang="html">index.html
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span>${content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"> <span class="hljs-comment">//æ’å…¥</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__PRELOAD_STATE__</span>=${<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(preloadedState)}<span class="hljs-comment">//è¿™æ ·å°±è¢«æ·»åŠ åˆ°äº†window</span>
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"client.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>å®¢æˆ·ç«¯å°±èƒ½è·å–çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-js" lang="js">client.<span class="hljs-property">js</span>
<span class="hljs-comment">// åˆ›å»ºstoreæ—¶ï¼Œå¦‚æœæœ‰window?.__PRELOAD_STATE__ï¼Œå°±ä»¥å®ƒä¸ºåˆå§‹stateï¼Œå¦åˆ™ä¸ºç©ºå¯¹è±¡{}</span>
<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStoreInstance</span>(<span class="hljs-variable language_">window</span>?.<span class="hljs-property">__PRELOAD_STATE__</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€JavaScriptåŸºç¡€ã€‘Nullç±»å‹è¯¦è§£]]></title>    <link>https://juejin.cn/post/7570598043298267199</link>    <guid>https://juejin.cn/post/7570598043298267199</guid>    <pubDate>2025-11-10T08:29:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298267199" data-draft-id="7570896170920329279" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€JavaScriptåŸºç¡€ã€‘Nullç±»å‹è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T08:29:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çˆ±å­¦ä¹ çš„ç¨‹åºåª›"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453938925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€JavaScriptåŸºç¡€ã€‘Nullç±»å‹è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453938925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çˆ±å­¦ä¹ çš„ç¨‹åºåª›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:29:23.000Z" title="Mon Nov 10 2025 08:29:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe59468598cd49f892c53e5360af014e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5a2m5Lmg55qE56iL5bqP5aqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763368163&amp;x-signature=Byq1ZO6ZJgHPaCRXVcHnmhP9c0U%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨JavaScriptä¸­ï¼ŒNullæ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹ï¼Œè¡¨ç¤ºå˜é‡è¢«æ˜ç¡®èµ‹å€¼ä¸ºç©ºå€¼æˆ–"æ— å€¼"çŠ¶æ€ã€‚</p>
<h2 data-id="heading-0">1.Â Nullç±»å‹ä¸»è¦åœºæ™¯</h2>
<h3 data-id="heading-1">1ï¼‰å˜é‡åˆå§‹åŒ–</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span>Â user =Â <span class="hljs-literal">null</span>;
user = {Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'cxh'</span>,Â <span class="hljs-attr">age</span>:Â <span class="hljs-number">18</span>Â };
</code></pre>
<h3 data-id="heading-2">2ï¼‰å‡½æ•°è¿”å›å€¼</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å‡½æ•°æ‰¾ä¸åˆ°ç»“æœæ—¶è¿”å› null</span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">findUser</span>(<span class="hljs-params">id</span>) {
Â  Â Â <span class="hljs-keyword">const</span>Â users = [
Â  Â  Â  Â  {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'cxh001'</span>Â },
Â  Â  Â  Â  {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">2</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'cxh002'</span>Â }
Â  Â  ];
Â  Â Â <span class="hljs-keyword">return</span>Â users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">user</span>Â =&gt;</span>Â user.<span class="hljs-property">id</span>Â === id) ||Â <span class="hljs-literal">null</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">findUser</span>(<span class="hljs-number">3</span>));Â <span class="hljs-comment">// null</span>

<span class="hljs-comment">// æ“ä½œå¤±è´¥æ—¶è¿”å› null</span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">parseJSON</span>(<span class="hljs-params">str</span>) {
Â  Â Â <span class="hljs-keyword">try</span>Â {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(str);
Â  Â  }Â <span class="hljs-keyword">catch</span>Â (error) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">null</span>;
Â  Â  }
}
</code></pre>
<h3 data-id="heading-3">3ï¼‰DOMæ“ä½œ</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// è·å–ä¸å­˜åœ¨çš„å…ƒç´ è¿”å› null</span>
    <span class="hljs-keyword">const</span>Â nonExistentElement =Â <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'non-existent'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nonExistentElement);Â <span class="hljs-comment">// null</span>

    <span class="hljs-comment">// ç§»é™¤å…ƒç´ åè®¾ç½®ä¸º null</span>
    <span class="hljs-keyword">let</span>Â element =Â <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myElement'</span>);
    element?.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">removeChild</span>(element);
    element =Â <span class="hljs-literal">null</span>;Â <span class="hljs-comment">// å¸®åŠ©åƒåœ¾å›æ”¶</span>
</code></pre>
<h3 data-id="heading-4">4ï¼‰å¯¹è±¡å±æ€§çš„æ¸…ç†</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span>Â app = {
    Â  Â Â <span class="hljs-attr">cache</span>: {},
    Â  Â Â <span class="hljs-attr">config</span>:Â <span class="hljs-literal">null</span>
    };
    <span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜åæ¸…ç†</span>
    app.<span class="hljs-property">cache</span>.<span class="hljs-property">userData</span>Â = {Â <span class="hljs-comment">/* å¤§é‡æ•°æ® */</span>Â };
    <span class="hljs-comment">// é‡Šæ”¾å†…å­˜</span>
    app.<span class="hljs-property">cache</span>.<span class="hljs-property">userData</span>Â =Â <span class="hljs-literal">null</span>;
</code></pre>
<h3 data-id="heading-5">5ï¼‰å‡½æ•°çš„å¯é€‰å‚æ•°</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">createUser</span>(<span class="hljs-params">name, details =Â <span class="hljs-literal">null</span></span>) {
    Â  Â Â <span class="hljs-keyword">return</span>Â {
    Â  Â  Â  Â  name,
    Â  Â  Â  Â  details
    Â  Â  };
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">createUser</span>(<span class="hljs-string">'cxh'</span>));Â <span class="hljs-comment">// {name: 'cxh', details: null}</span>
</code></pre>
<h3 data-id="heading-6">6ï¼‰API å“åº”å¤„ç†</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// å¸¸è§äºæ•°æ®åº“æŸ¥è¯¢ç»“æœ</span>
    <span class="hljs-keyword">const</span>Â apiResponse = {
    Â  Â Â <span class="hljs-attr">success</span>:Â <span class="hljs-literal">true</span>,
    Â  Â Â <span class="hljs-attr">data</span>:Â <span class="hljs-literal">null</span>,Â <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°æ•°æ®</span>
    Â  Â Â <span class="hljs-attr">message</span>:Â <span class="hljs-string">'User not found'</span>
    };
    <span class="hljs-comment">// æˆ–è€…</span>
    <span class="hljs-keyword">async</span>Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">getUserProfile</span>(<span class="hljs-params">userId</span>) {
    Â  Â Â <span class="hljs-keyword">const</span>Â response =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>);
    Â  Â Â <span class="hljs-keyword">const</span>Â result =Â <span class="hljs-keyword">await</span>Â response?.<span class="hljs-title function_">json</span>();
    Â  Â Â <span class="hljs-keyword">return</span>Â result?.<span class="hljs-property">data</span>Â ||Â <span class="hljs-literal">null</span>;Â <span class="hljs-comment">// æœ‰æ•°æ®è¿”å›æ•°æ®ï¼Œæ²¡æœ‰è¿”å› null</span>
    }
</code></pre>
<h3 data-id="heading-7">7ï¼‰çŠ¶æ€ç®¡ç†</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">AuthService</span>Â {
    Â  Â  currentUser =Â <span class="hljs-literal">null</span>;
    Â  Â  token =Â <span class="hljs-literal">null</span>;

    Â  Â Â <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {}

    Â  Â Â <span class="hljs-title function_">login</span>(<span class="hljs-params">userData, authToken</span>) {
    Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUser</span>Â = userData;
    Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>Â = authToken;
    Â  Â  }

    Â  Â Â <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
    Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUser</span>Â =Â <span class="hljs-literal">null</span>;
    Â  Â  Â  Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>Â =Â <span class="hljs-literal">null</span>;
    Â  Â  }
    }
</code></pre>
<h3 data-id="heading-8">8ï¼‰é…ç½®å’Œé€‰é¡¹</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">initializeApp</span>(<span class="hljs-params">config = {}</span>) {
    Â  Â Â <span class="hljs-keyword">const</span>Â defaults = {
    Â  Â  Â  Â Â <span class="hljs-attr">apiUrl</span>:Â <span class="hljs-string">'https://api.example.com'</span>,
    Â  Â  Â  Â Â <span class="hljs-attr">timeout</span>:Â <span class="hljs-number">5000</span>,
    Â  Â  Â  Â Â <span class="hljs-attr">retryCount</span>:Â <span class="hljs-literal">null</span>,Â <span class="hljs-comment">// ä¸é‡è¯•</span>
    Â  Â  Â  Â Â <span class="hljs-attr">logger</span>:Â <span class="hljs-literal">null</span>Â <span class="hljs-comment">// ä¸è®°å½•æ—¥å¿—</span>
    Â  Â  };
    Â  Â Â <span class="hljs-keyword">return</span>Â { ...defaults, ...config };
    }
</code></pre>
<h3 data-id="heading-9">9ï¼‰æœªåŒ¹é…åˆ°æ­£åˆ™</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// RegExp.exec() æ–¹æ³•æ²¡æœ‰åŒ¹é…</span>
    <span class="hljs-keyword">const</span>Â regex1 =Â <span class="hljs-regexp">/hello (\w+)/</span>;
    <span class="hljs-keyword">const</span>Â str =Â <span class="hljs-string">'goodbye world'</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(regex1.<span class="hljs-title function_">exec</span>(str));Â <span class="hljs-comment">// null</span>

    <span class="hljs-comment">// String.match() æ²¡æœ‰åŒ¹é…ç»“æœ</span>
    <span class="hljs-keyword">const</span>Â regex2 =Â <span class="hljs-regexp">/(\d{3})-(\d{3})-(\d{4})/</span>;
    <span class="hljs-keyword">const</span>Â phone =Â <span class="hljs-string">'æ²¡æœ‰ç”µè¯å·ç '</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(phone.<span class="hljs-title function_">match</span>(regex2));Â <span class="hljs-comment">// null</span>
</code></pre>
<h2 data-id="heading-10">2. æ£€æµ‹Nullçš„æ–¹æ³•</h2>
<h3 data-id="heading-11">1ï¼‰ä¸¥æ ¼ç›¸ç­‰</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">let</span>Â value =Â <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span>Â (value ===Â <span class="hljs-literal">null</span>) {
    Â  Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Value is null'</span>);Â <span class="hljs-comment">// Value is null</span>
    }
</code></pre>
<h3 data-id="heading-12">2ï¼‰è”åˆæ£€æŸ¥Nullå’ŒUndefined</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">let</span>Â value;
    <span class="hljs-keyword">if</span>Â (value ==Â <span class="hljs-literal">null</span>) {
    Â  Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Value is null or undefined'</span>);Â <span class="hljs-comment">// Value is null or undefined</span>
    }
</code></pre>
<h3 data-id="heading-13">3ï¼‰ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦å®‰å…¨è®¿é—®</h3>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span>Â userName = user?.<span class="hljs-property">profile</span>?.<span class="hljs-property">name</span>Â ??Â <span class="hljs-string">'default'</span>;
</code></pre>
<h2 data-id="heading-14">3.Â Undefinedå’ŒNullçš„å¼‚åŒ</h2>













































<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>Undefined</strong></th><th><strong>Null</strong></th></tr></thead><tbody><tr><td>ç±»å‹</td><td>ç‹¬ç«‹ç±»å‹(Undefined)</td><td>ç‹¬ç«‹ç±»å‹(Null)</td></tr><tr><td>å«ä¹‰</td><td>å˜é‡å£°æ˜ä½†æœªèµ‹å€¼</td><td>è¡¨ç¤ºä¸€ä¸ªç©ºå¯¹è±¡æŒ‡é’ˆ</td></tr><tr><td>é»˜è®¤å€¼</td><td>å‡½æ•°æ— è¿”å›å€¼æ—¶çš„é»˜è®¤è¿”å›</td><td>éœ€æ˜¾å¼èµ‹å€¼</td></tr><tr><td>ç›¸ç­‰æ€§</td><td>undefined == nullÂ â†’ true</td><td>undefined === nullÂ â†’ false</td></tr><tr><td>ç±»å‹æ£€æµ‹</td><td>typeof undefinedâ†’ 'undefined'</td><td>typeof nullÂ â†’ 'object'</td></tr><tr><td>è½¬æ¢ä¸ºæ•°å­—</td><td>Number(undefined)Â â†’ NaN</td><td>Number(null)Â â†’ 0</td></tr><tr><td>è½¬æ¢ä¸ºå¸ƒå°”å€¼</td><td>Boolean(undefined)â†’ false</td><td>Boolean(null)Â â†’ false</td></tr></tbody></table>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡è®²æ¸…é¸¿è’™ç½‘ç»œå¼€å‘]]></title>    <link>https://juejin.cn/post/7570904968677687323</link>    <guid>https://juejin.cn/post/7570904968677687323</guid>    <pubDate>2025-11-10T08:38:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570904968677687323" data-draft-id="7570902804450361354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡è®²æ¸…é¸¿è’™ç½‘ç»œå¼€å‘"/> <meta itemprop="keywords" content="å‰ç«¯,HarmonyOS,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T08:38:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Androidç–‘éš¾æ‚ç—‡"/> <meta itemprop="url" content="https://juejin.cn/user/1820446983462136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡è®²æ¸…é¸¿è’™ç½‘ç»œå¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446983462136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Androidç–‘éš¾æ‚ç—‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:38:19.000Z" title="Mon Nov 10 2025 08:38:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ¦‚è¿°</h2>
<p>é€šè¿‡æœ¬æŒ‡å—,æ‚¨å¯ä»¥æŒæ¡HarmonyOS Network Kitçš„æ ¸å¿ƒåŠŸèƒ½å’Œæœ€ä½³å®è·µã€‚Network Kitæä¾›äº†å®Œæ•´çš„ç½‘ç»œé€šä¿¡è§£å†³æ–¹æ¡ˆ,æ”¯æŒHTTPã€WebSocketã€Socketç­‰å¤šç§åè®®,æ»¡è¶³å„ç±»åº”ç”¨çš„ç½‘ç»œéœ€æ±‚ã€‚åˆç†ä½¿ç”¨è¿™äº›èƒ½åŠ›,å¯ä»¥æ„å»ºé«˜æ€§èƒ½ã€å®‰å…¨å¯é çš„ç½‘ç»œåº”ç”¨ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒèƒ½åŠ›</h3>








































<table><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>ä¸»è¦èƒ½åŠ›</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>HTTPè¯·æ±‚</td><td>GET/POST/PUT/DELETEç­‰æ–¹æ³•ã€æµå¼ä¼ è¾“ã€è¯ä¹¦é…ç½®</td><td>RESTful APIè°ƒç”¨ã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½</td></tr><tr><td>WebSocket</td><td>å…¨åŒå·¥é€šä¿¡ã€å¿ƒè·³æ£€æµ‹ã€å®¢æˆ·ç«¯/æœåŠ¡ç«¯</td><td>å®æ—¶èŠå¤©ã€æ¸¸æˆå¯¹æˆ˜ã€å®æ—¶æ•°æ®æ¨é€</td></tr><tr><td>TCP Socket</td><td>é¢å‘è¿æ¥çš„å¯é ä¼ è¾“ã€æœåŠ¡ç«¯ç›‘å¬</td><td>é•¿è¿æ¥é€šä¿¡ã€è‡ªå®šä¹‰åè®®</td></tr><tr><td>UDP Socket</td><td>æ— è¿æ¥çš„å¿«é€Ÿä¼ è¾“ã€ç»„æ’­æ”¯æŒ</td><td>è§†é¢‘ç›´æ’­ã€å®æ—¶è¯­éŸ³ã€å±€åŸŸç½‘å‘ç°</td></tr><tr><td>TLS Socket</td><td>åŠ å¯†ä¼ è¾“ã€åŒå‘è®¤è¯ã€è¯ä¹¦é”å®š</td><td>å®‰å…¨é€šä¿¡ã€é‡‘èæ”¯ä»˜</td></tr><tr><td>LocalSocket</td><td>è¿›ç¨‹é—´é€šä¿¡ã€æ— éœ€ç½‘ç»œ</td><td>åŒè®¾å¤‡è¿›ç¨‹é€šä¿¡ã€æ€§èƒ½ä¼˜åŒ–</td></tr></tbody></table>
<h2 data-id="heading-2">äºŒã€HTTPç½‘ç»œè¯·æ±‚</h2>
<h3 data-id="heading-3">2.1 è¯·æ±‚æµç¨‹</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant App as åº”ç”¨
    participant HTTP as HttpRequest
    participant Server as æœåŠ¡å™¨

    App-&gt;&gt;HTTP: createHttp()
    App-&gt;&gt;HTTP: on('headersReceive')
    App-&gt;&gt;HTTP: request(url, options)
    HTTP-&gt;&gt;Server: å‘é€HTTPè¯·æ±‚
    Server--&gt;&gt;HTTP: è¿”å›å“åº”å¤´
    HTTP--&gt;&gt;App: headersReceiveå›è°ƒ
    Server--&gt;&gt;HTTP: è¿”å›å®Œæ•´å“åº”
    HTTP--&gt;&gt;App: å“åº”æ•°æ®
    App-&gt;&gt;HTTP: destroy()
</code></pre>
<h3 data-id="heading-4">2.2 åŸºç¡€HTTPè¯·æ±‚</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpManager</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">HttpManager</span>;

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {}

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">HttpManager</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">HttpManager</span>.<span class="hljs-property">instance</span>) {
      <span class="hljs-title class_">HttpManager</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpManager</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">HttpManager</span>.<span class="hljs-property">instance</span>;
  }

  <span class="hljs-comment">/**
   * å‘é€HTTP GETè¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> get&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, headers?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, {
        <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">GET</span>,
        <span class="hljs-attr">header</span>: headers || { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
        <span class="hljs-attr">expectDataType</span>: http.<span class="hljs-property">HttpDataType</span>.<span class="hljs-property">STRING</span>,
        <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>,
        <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">60000</span>
      });

      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">responseCode</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP Error: <span class="hljs-subst">${response.responseCode}</span>`</span>);
      }
    } <span class="hljs-keyword">finally</span> {
      httpRequest.<span class="hljs-title function_">destroy</span>();
    }
  }

  <span class="hljs-comment">/**
   * å‘é€HTTP POSTè¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> post&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">Object</span>, headers?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, {
        <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>,
        <span class="hljs-attr">header</span>: headers || { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
        <span class="hljs-attr">extraData</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data),
        <span class="hljs-attr">expectDataType</span>: http.<span class="hljs-property">HttpDataType</span>.<span class="hljs-property">STRING</span>,
        <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>,
        <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">60000</span>
      });

      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">responseCode</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP Error: <span class="hljs-subst">${response.responseCode}</span>`</span>);
      }
    } <span class="hljs-keyword">finally</span> {
      httpRequest.<span class="hljs-title function_">destroy</span>();
    }
  }

  <span class="hljs-comment">/**
   * ä¸Šä¼ æ–‡ä»¶(multipart/form-data)
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">fileName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">const</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, {
        <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>,
        <span class="hljs-attr">header</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'multipart/form-data'</span> },
        <span class="hljs-attr">multiFormDataList</span>: [
          {
            <span class="hljs-attr">name</span>: <span class="hljs-string">'file'</span>,
            <span class="hljs-attr">contentType</span>: <span class="hljs-string">'application/octet-stream'</span>,
            <span class="hljs-attr">filePath</span>: filePath,
            <span class="hljs-attr">remoteFileName</span>: fileName
          }
        ],
        <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>,
        <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">300000</span> <span class="hljs-comment">// ä¸Šä¼ å¤§æ–‡ä»¶éœ€è¦æ›´é•¿è¶…æ—¶æ—¶é—´</span>
      });

      <span class="hljs-keyword">return</span> response.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    } <span class="hljs-keyword">finally</span> {
      httpRequest.<span class="hljs-title function_">destroy</span>();
    }
  }
}
</code></pre>
<h3 data-id="heading-5">2.3 HTTPæµå¼ä¼ è¾“</h3>
<p>é€‚ç”¨äºå¤§æ–‡ä»¶ä¸‹è½½åœºæ™¯,æ”¯æŒè¿›åº¦ç›‘å¬:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpStreamDownloader</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">httpRequest</span>: http.<span class="hljs-property">HttpRequest</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">receivedData</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">/**
   * ä¸‹è½½æ–‡ä»¶å¹¶ç›‘å¬è¿›åº¦
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">downloadFile</span>(
    <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">onProgress</span>: <span class="hljs-function">(<span class="hljs-params">received: <span class="hljs-built_in">number</span>, total: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ArrayBuffer</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span> = http.<span class="hljs-title function_">createHttp</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">receivedData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-comment">// è®¢é˜…æ•°æ®æ¥æ”¶äº‹ä»¶</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataReceive'</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">receivedData</span>.<span class="hljs-property">byteLength</span> + data.<span class="hljs-property">byteLength</span>);
        <span class="hljs-keyword">const</span> newView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(newBuffer);
        newView.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">receivedData</span>));
        newView.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(data), <span class="hljs-variable language_">this</span>.<span class="hljs-property">receivedData</span>.<span class="hljs-property">byteLength</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">receivedData</span> = newBuffer;
      });

      <span class="hljs-comment">// è®¢é˜…ä¸‹è½½è¿›åº¦äº‹ä»¶</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataReceiveProgress'</span>, <span class="hljs-function">(<span class="hljs-params">progress: http.DataReceiveProgressInfo</span>) =&gt;</span> {
        <span class="hljs-title function_">onProgress</span>(progress.<span class="hljs-property">receiveSize</span>, progress.<span class="hljs-property">totalSize</span>);
      });

      <span class="hljs-comment">// è®¢é˜…æ•°æ®æ¥æ”¶å®Œæˆäº‹ä»¶</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataEnd'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">receivedData</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanup</span>();
      });

      <span class="hljs-comment">// å‘èµ·æµå¼è¯·æ±‚</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>!.<span class="hljs-title function_">requestInStream</span>(url, {
        <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">GET</span>,
        <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">600000</span> <span class="hljs-comment">// å¤§æ–‡ä»¶éœ€è¦æ›´é•¿è¶…æ—¶</span>
      }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(err);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanup</span>();
      });
    });
  }

  <span class="hljs-comment">/**
   * å–æ¶ˆä¸‹è½½
   */</span>
  <span class="hljs-title function_">cancel</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanup</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">cleanup</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceive'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceiveProgress'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataEnd'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>.<span class="hljs-title function_">destroy</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span> = <span class="hljs-literal">null</span>;
    }
  }
}
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€WebSocketé€šä¿¡</h2>
<h3 data-id="heading-7">3.1 WebSocketæ¶æ„</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[åº”ç”¨å±‚] --&gt; B[WebSocketå®¢æˆ·ç«¯]
    A --&gt; C[WebSocketæœåŠ¡ç«¯-ä»…æ™ºæ…§å±]
    B --&gt; D[createWebSocket]
    B --&gt; E[connectå»ºç«‹è¿æ¥]
    B --&gt; F[sendå‘é€æ¶ˆæ¯]
    B --&gt; G[closeå…³é—­è¿æ¥]
    C --&gt; H[createWebSocketServer]
    C --&gt; I[startå¯åŠ¨æœåŠ¡]
    C --&gt; J[ç›‘å¬å®¢æˆ·ç«¯è¿æ¥]
    C --&gt; K[stopåœæ­¢æœåŠ¡]
</code></pre>
<h3 data-id="heading-8">3.2 WebSocketå®¢æˆ·ç«¯</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketClient</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">ws</span>: webSocket.<span class="hljs-property">WebSocket</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">reconnectTimer</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> reconnectAttempts = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">private</span> maxReconnectAttempts = <span class="hljs-number">5</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> url: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span> = webSocket.<span class="hljs-title function_">createWebSocket</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupEventHandlers</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">setupEventHandlers</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// è¿æ¥æ‰“å¼€äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">Object</span></span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'WebSocketè¿æ¥å¤±è´¥:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'WebSocketè¿æ¥æˆåŠŸ'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span> = <span class="hljs-number">0</span>;
    });

    <span class="hljs-comment">// æ¥æ”¶æ¶ˆæ¯äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ¥æ”¶æ¶ˆæ¯å¤±è´¥:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'æ”¶åˆ°æ–‡æœ¬æ¶ˆæ¯:'</span>, value);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleMessage</span>(value);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'æ”¶åˆ°äºŒè¿›åˆ¶æ¶ˆæ¯'</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleBinaryMessage</span>(value);
      }
    });

    <span class="hljs-comment">// è¿æ¥å…³é—­äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: webSocket.CloseResult</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`WebSocketå…³é—­ code=<span class="hljs-subst">${value.code}</span> reason=<span class="hljs-subst">${value.reason}</span>`</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attemptReconnect</span>();
    });

    <span class="hljs-comment">// é”™è¯¯äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'WebSocketé”™è¯¯:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
    });
  }

  <span class="hljs-comment">/**
   * è¿æ¥åˆ°WebSocketæœåŠ¡å™¨
   */</span>
  <span class="hljs-title function_">connect</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>();
        }
      });
    });
  }

  <span class="hljs-comment">/**
   * å‘é€æ–‡æœ¬æ¶ˆæ¯
   */</span>
  <span class="hljs-title function_">sendText</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>(message, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>();
        }
      });
    });
  }

  <span class="hljs-comment">/**
   * å‘é€äºŒè¿›åˆ¶æ¶ˆæ¯
   */</span>
  <span class="hljs-title function_">sendBinary</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">ArrayBuffer</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">send</span>(data, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>();
        }
      });
    });
  }

  <span class="hljs-comment">/**
   * å…³é—­è¿æ¥
   */</span>
  <span class="hljs-title function_">close</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span> !== <span class="hljs-literal">null</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span> = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ws</span>.<span class="hljs-title function_">close</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>();
        }
      });
    });
  }

  <span class="hljs-comment">/**
   * è‡ªåŠ¨é‡è¿
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">attemptReconnect</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxReconnectAttempts</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°,åœæ­¢é‡è¿'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> delay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1000</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span>), <span class="hljs-number">30000</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span>++;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${delay}</span>msåå°è¯•ç¬¬<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reconnectAttempts}</span>æ¬¡é‡è¿`</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">connect</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é‡è¿å¤±è´¥:'</span>, err);
      });
    }, delay);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleBinaryMessage</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">ArrayBuffer</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// äºŒè¿›åˆ¶æ•°æ®å¤„ç†</span>
  }
}
</code></pre>
<h2 data-id="heading-9">å››ã€Socketé€šä¿¡</h2>
<h3 data-id="heading-10">4.1 TCP Socketå®¢æˆ·ç«¯</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { socket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TCPSocketClient</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">tcp</span>: socket.<span class="hljs-property">TCPSocket</span>;
  <span class="hljs-keyword">private</span> connected = <span class="hljs-literal">false</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span> = socket.<span class="hljs-title function_">constructTCPSocketInstance</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupEventHandlers</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">setupEventHandlers</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// è¿æ¥å»ºç«‹äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'TCPè¿æ¥å·²å»ºç«‹'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">connected</span> = <span class="hljs-literal">true</span>;
    });

    <span class="hljs-comment">// æ¥æ”¶æ¶ˆæ¯äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">value: socket.SocketMessageInfo</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> buffer = value.<span class="hljs-property">message</span>;
      <span class="hljs-keyword">const</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);
      <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dataView.<span class="hljs-property">byteLength</span>; i++) {
        str += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(dataView.<span class="hljs-title function_">getUint8</span>(i));
      }
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'æ”¶åˆ°æ¶ˆæ¯:'</span>, str);
    });

    <span class="hljs-comment">// è¿æ¥å…³é—­äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'TCPè¿æ¥å·²å…³é—­'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">connected</span> = <span class="hljs-literal">false</span>;
    });
  }

  <span class="hljs-comment">/**
   * è¿æ¥åˆ°æœåŠ¡å™¨
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connect</span>(<span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-comment">// ç»‘å®šæœ¬åœ°åœ°å€(å¯é€‰,ç«¯å£ç”±ç³»ç»Ÿåˆ†é…)</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">localAddr</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: <span class="hljs-string">'0.0.0.0'</span>,
      <span class="hljs-attr">port</span>: <span class="hljs-number">0</span>
    };

    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">bind</span>(localAddr, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-title function_">reject</span>(err);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>();
        }
      });
    });

    <span class="hljs-comment">// è¿æ¥åˆ°æœåŠ¡å™¨</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">remoteAddr</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: host,
      <span class="hljs-attr">port</span>: port
    };

    <span class="hljs-keyword">const</span> <span class="hljs-attr">connectOptions</span>: socket.<span class="hljs-property">TCPConnectOptions</span> = {
      <span class="hljs-attr">address</span>: remoteAddr,
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">6000</span>
    };

    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">connect</span>(connectOptions);
  }

  <span class="hljs-comment">/**
   * å‘é€æ•°æ®
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">send</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">connected</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'TCPæœªè¿æ¥'</span>);
    }

    <span class="hljs-keyword">const</span> <span class="hljs-attr">sendOptions</span>: socket.<span class="hljs-property">TCPSendOptions</span> = {
      <span class="hljs-attr">data</span>: data
    };

    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">send</span>(sendOptions);
  }

  <span class="hljs-comment">/**
   * å…³é—­è¿æ¥
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">close</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">close</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'message'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'connect'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcp</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'close'</span>);
  }
}
</code></pre>
<h3 data-id="heading-11">4.2 TCP SocketæœåŠ¡ç«¯</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TCPSocketServer</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">server</span>: socket.<span class="hljs-property">TCPSocketServer</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">clients</span>: socket.<span class="hljs-property">TCPSocketConnection</span>[] = [];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">server</span> = socket.<span class="hljs-title function_">constructTCPSocketServerInstance</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupEventHandlers</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">setupEventHandlers</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">server</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">(<span class="hljs-params">client: socket.TCPSocketConnection</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'æ–°å®¢æˆ·ç«¯è¿æ¥'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span>.<span class="hljs-title function_">push</span>(client);

      <span class="hljs-comment">// ç›‘å¬å®¢æˆ·ç«¯æ¶ˆæ¯</span>
      client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">value: socket.SocketMessageInfo</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> buffer = value.<span class="hljs-property">message</span>;
        <span class="hljs-keyword">const</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);
        <span class="hljs-keyword">let</span> message = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dataView.<span class="hljs-property">byteLength</span>; i++) {
          message += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(dataView.<span class="hljs-title function_">getUint8</span>(i));
        }
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯:'</span>, message);

        <span class="hljs-comment">// å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">broadcast</span>(message, client);
      });

      <span class="hljs-comment">// å®¢æˆ·ç«¯å…³é—­äº‹ä»¶</span>
      client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span>.<span class="hljs-title function_">indexOf</span>(client);
        <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
        }
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'å®¢æˆ·ç«¯æ–­å¼€,å½“å‰è¿æ¥æ•°:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span>.<span class="hljs-property">length</span>);
      });
    });
  }

  <span class="hljs-comment">/**
   * å¯åŠ¨æœåŠ¡å™¨
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">listen</span>(<span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">address</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: <span class="hljs-string">'0.0.0.0'</span>,
      <span class="hljs-attr">port</span>: port
    };

    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">server</span>.<span class="hljs-title function_">listen</span>(address);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`TCPæœåŠ¡å™¨ç›‘å¬ç«¯å£: <span class="hljs-subst">${port}</span>`</span>);
  }

  <span class="hljs-comment">/**
   * å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">broadcast</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>, sender?: socket.<span class="hljs-property">TCPSocketConnection</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">sendOptions</span>: socket.<span class="hljs-property">TCPSendOptions</span> = {
      <span class="hljs-attr">data</span>: message
    };

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> client <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span>) {
      <span class="hljs-keyword">if</span> (client !== sender) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">send</span>(sendOptions);
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‘é€å¤±è´¥:'</span>, err);
        }
      }
    }
  }

  <span class="hljs-comment">/**
   * åœæ­¢æœåŠ¡å™¨
   */</span>
  <span class="hljs-title function_">stop</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> client <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span>) {
      client.<span class="hljs-title function_">close</span>();
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">clients</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">server</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'connect'</span>);
  }
}
</code></pre>
<h3 data-id="heading-12">4.3 TLS SocketåŠ å¯†é€šä¿¡</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TLSSocketClient</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">tls</span>: socket.<span class="hljs-property">TLSSocket</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span> = socket.<span class="hljs-title function_">constructTLSSocketInstance</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupEventHandlers</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">setupEventHandlers</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'TLSè¿æ¥å»ºç«‹'</span>);
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">value: socket.SocketMessageInfo</span>) =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†åŠ å¯†æ¶ˆæ¯</span>
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'TLSè¿æ¥å…³é—­'</span>);
    });
  }

  <span class="hljs-comment">/**
   * å•å‘è®¤è¯è¿æ¥(ä»…éªŒè¯æœåŠ¡å™¨è¯ä¹¦)
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connectOneWay</span>(<span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">caPath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">localAddr</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: <span class="hljs-string">'0.0.0.0'</span>,
      <span class="hljs-attr">port</span>: <span class="hljs-number">0</span>
    };

    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">bind</span>(localAddr, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">reject</span>(err);
        <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>();
      });
    });

    <span class="hljs-keyword">const</span> <span class="hljs-attr">remoteAddr</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: host,
      <span class="hljs-attr">port</span>: port
    };

    <span class="hljs-keyword">const</span> <span class="hljs-attr">secureOptions</span>: socket.<span class="hljs-property">TLSSecureOptions</span> = {
      <span class="hljs-attr">ca</span>: [caPath], <span class="hljs-comment">// CAè¯ä¹¦è·¯å¾„</span>
      <span class="hljs-attr">cipherSuite</span>: <span class="hljs-string">'AES256-SHA256'</span>
    };

    <span class="hljs-keyword">const</span> <span class="hljs-attr">connectOptions</span>: socket.<span class="hljs-property">TLSConnectOptions</span> = {
      <span class="hljs-attr">address</span>: remoteAddr,
      <span class="hljs-attr">secureOptions</span>: secureOptions
    };

    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">connect</span>(connectOptions);
  }

  <span class="hljs-comment">/**
   * åŒå‘è®¤è¯è¿æ¥(åŒæ—¶éªŒè¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¯ä¹¦)
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connectTwoWay</span>(
    <span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>,
    <span class="hljs-attr">caPath</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">certPath</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">keyPath</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">localAddr</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: <span class="hljs-string">'0.0.0.0'</span>,
      <span class="hljs-attr">port</span>: <span class="hljs-number">0</span>
    };

    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">bind</span>(localAddr, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">reject</span>(err);
        <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>();
      });
    });

    <span class="hljs-keyword">const</span> <span class="hljs-attr">remoteAddr</span>: socket.<span class="hljs-property">NetAddress</span> = {
      <span class="hljs-attr">address</span>: host,
      <span class="hljs-attr">port</span>: port
    };

    <span class="hljs-keyword">const</span> <span class="hljs-attr">secureOptions</span>: socket.<span class="hljs-property">TLSSecureOptions</span> = {
      <span class="hljs-attr">ca</span>: [caPath],
      <span class="hljs-attr">cert</span>: certPath, <span class="hljs-comment">// å®¢æˆ·ç«¯è¯ä¹¦</span>
      <span class="hljs-attr">key</span>: keyPath,   <span class="hljs-comment">// å®¢æˆ·ç«¯ç§é’¥</span>
      <span class="hljs-attr">password</span>: password, <span class="hljs-comment">// ç§é’¥å¯†ç </span>
      <span class="hljs-attr">protocols</span>: [socket.<span class="hljs-property">Protocol</span>.<span class="hljs-property">TLSv12</span>],
      <span class="hljs-attr">cipherSuite</span>: <span class="hljs-string">'AES256-SHA256'</span>
    };

    <span class="hljs-keyword">const</span> <span class="hljs-attr">connectOptions</span>: socket.<span class="hljs-property">TLSConnectOptions</span> = {
      <span class="hljs-attr">address</span>: remoteAddr,
      <span class="hljs-attr">secureOptions</span>: secureOptions
    };

    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">connect</span>(connectOptions);
  }

  <span class="hljs-comment">/**
   * å‘é€åŠ å¯†æ•°æ®
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">send</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">send</span>(data);
  }

  <span class="hljs-comment">/**
   * å…³é—­è¿æ¥
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">close</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">close</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'message'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'connect'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tls</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'close'</span>);
  }
}
</code></pre>
<h2 data-id="heading-13">äº”ã€å®Œæ•´ç¤ºä¾‹:ç½‘ç»œç®¡ç†å™¨åº”ç”¨</h2>
<p>åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„ç½‘ç»œç®¡ç†å™¨,æ•´åˆæ‰€æœ‰ç½‘ç»œèƒ½åŠ›:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;
<span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;
<span class="hljs-keyword">import</span> { socket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;

<span class="hljs-comment">/**
 * ç½‘ç»œç®¡ç†å™¨å•ä¾‹
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkManager</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">NetworkManager</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">wsClient</span>: <span class="hljs-title class_">WebSocketClient</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">tcpClient</span>: <span class="hljs-title class_">TCPSocketClient</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {}

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">NetworkManager</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">NetworkManager</span>.<span class="hljs-property">instance</span>) {
      <span class="hljs-title class_">NetworkManager</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkManager</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NetworkManager</span>.<span class="hljs-property">instance</span>;
  }

  <span class="hljs-comment">/**
   * HTTP GETè¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> httpGet&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, {
        <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">GET</span>,
        <span class="hljs-attr">header</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
        <span class="hljs-attr">expectDataType</span>: http.<span class="hljs-property">HttpDataType</span>.<span class="hljs-property">STRING</span>,
        <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>,
        <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">60000</span>
      });

      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">responseCode</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${response.responseCode}</span>`</span>);
      }
    } <span class="hljs-keyword">finally</span> {
      httpRequest.<span class="hljs-title function_">destroy</span>();
    }
  }

  <span class="hljs-comment">/**
   * HTTP POSTè¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> httpPost&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, {
        <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>,
        <span class="hljs-attr">header</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
        <span class="hljs-attr">extraData</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data),
        <span class="hljs-attr">expectDataType</span>: http.<span class="hljs-property">HttpDataType</span>.<span class="hljs-property">STRING</span>,
        <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>,
        <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">60000</span>
      });

      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">responseCode</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${response.responseCode}</span>`</span>);
      }
    } <span class="hljs-keyword">finally</span> {
      httpRequest.<span class="hljs-title function_">destroy</span>();
    }
  }

  <span class="hljs-comment">/**
   * ä¸‹è½½æ–‡ä»¶å¹¶æ˜¾ç¤ºè¿›åº¦
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">downloadFile</span>(
    <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">onProgress</span>: <span class="hljs-function">(<span class="hljs-params">received: <span class="hljs-built_in">number</span>, total: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ArrayBuffer</span>&gt; {
    <span class="hljs-keyword">const</span> downloader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpStreamDownloader</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> downloader.<span class="hljs-title function_">downloadFile</span>(url, onProgress);
  }

  <span class="hljs-comment">/**
   * è¿æ¥WebSocket
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connectWebSocket</span>(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">WebSocketClient</span>&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>.<span class="hljs-title function_">close</span>();
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketClient</span>(url);
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>.<span class="hljs-title function_">connect</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>;
  }

  <span class="hljs-comment">/**
   * è·å–WebSocketå®¢æˆ·ç«¯
   */</span>
  <span class="hljs-title function_">getWebSocketClient</span>(): <span class="hljs-title class_">WebSocketClient</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>;
  }

  <span class="hljs-comment">/**
   * è¿æ¥TCP Socket
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connectTCPSocket</span>(<span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TCPSocketClient</span>&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>.<span class="hljs-title function_">close</span>();
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TCPSocketClient</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>.<span class="hljs-title function_">connect</span>(host, port);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>;
  }

  <span class="hljs-comment">/**
   * è·å–TCP Socketå®¢æˆ·ç«¯
   */</span>
  <span class="hljs-title function_">getTCPSocketClient</span>(): <span class="hljs-title class_">TCPSocketClient</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>;
  }

  <span class="hljs-comment">/**
   * æ¸…ç†æ‰€æœ‰è¿æ¥
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">cleanup</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span>.<span class="hljs-title function_">close</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsClient</span> = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span>.<span class="hljs-title function_">close</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpClient</span> = <span class="hljs-literal">null</span>;
    }
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">NetworkManager</span>;
</code></pre>
<h3 data-id="heading-14">ä½¿ç”¨ç¤ºä¾‹é¡µé¢</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NetworkManager</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./NetworkManager'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">NetworkTestPage</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ç½‘ç»œæµ‹è¯•'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">httpResult</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">downloadProgress</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'0%'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">wsStatus</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'æœªè¿æ¥'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">tcpStatus</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'æœªè¿æ¥'</span>;

  <span class="hljs-keyword">private</span> networkManager = <span class="hljs-title class_">NetworkManager</span>.<span class="hljs-title function_">getInstance</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)

      <span class="hljs-comment">// HTTPæµ‹è¯•åŒº</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'HTTPè¯·æ±‚æµ‹è¯•'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'GETè¯·æ±‚'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">testHttpGet</span>())

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'POSTè¯·æ±‚'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">testHttpPost</span>())

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ä¸‹è½½æ–‡ä»¶'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">testDownload</span>())

      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)

      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ä¸‹è½½è¿›åº¦: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.downloadProgress}</span>`</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)

      <span class="hljs-title class_">Divider</span>()

      <span class="hljs-comment">// WebSocketæµ‹è¯•åŒº</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'WebSocketæµ‹è¯•'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)

      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`çŠ¶æ€: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.wsStatus}</span>`</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'è¿æ¥WebSocket'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">testWebSocket</span>())

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'å‘é€WebSocketæ¶ˆæ¯'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendWebSocketMessage</span>())

      <span class="hljs-title class_">Divider</span>()

      <span class="hljs-comment">// TCP Socketæµ‹è¯•åŒº</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'TCP Socketæµ‹è¯•'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)

      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`çŠ¶æ€: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.tcpStatus}</span>`</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'è¿æ¥TCP'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">testTCPSocket</span>())

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'å‘é€TCPæ¶ˆæ¯'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendTCPMessage</span>())
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }

  <span class="hljs-comment">/**
   * æµ‹è¯•HTTP GETè¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testHttpGet</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">httpGet</span>(<span class="hljs-string">'https://api.example.com/data'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span> = <span class="hljs-string">`è¯·æ±‚å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-comment">/**
   * æµ‹è¯•HTTP POSTè¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testHttpPost</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> data = { <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">123</span> };
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">httpPost</span>(<span class="hljs-string">'https://api.example.com/submit'</span>, data);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span> = <span class="hljs-string">`è¯·æ±‚å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-comment">/**
   * æµ‹è¯•æ–‡ä»¶ä¸‹è½½
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testDownload</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">downloadFile</span>(
        <span class="hljs-string">'https://example.com/file.zip'</span>,
        <span class="hljs-function">(<span class="hljs-params">received, total</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> percent = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((received / total) * <span class="hljs-number">100</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">downloadProgress</span> = <span class="hljs-string">`<span class="hljs-subst">${percent}</span>%`</span>;
        }
      );
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span> = <span class="hljs-string">`ä¸‹è½½å®Œæˆ,å¤§å°: <span class="hljs-subst">${data.byteLength}</span> å­—èŠ‚`</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">downloadProgress</span> = <span class="hljs-string">'100%'</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpResult</span> = <span class="hljs-string">`ä¸‹è½½å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-comment">/**
   * æµ‹è¯•WebSocketè¿æ¥
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testWebSocket</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">connectWebSocket</span>(<span class="hljs-string">'ws://example.com:8080'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsStatus</span> = <span class="hljs-string">'å·²è¿æ¥'</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsStatus</span> = <span class="hljs-string">`è¿æ¥å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-comment">/**
   * å‘é€WebSocketæ¶ˆæ¯
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendWebSocketMessage</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> client = <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">getWebSocketClient</span>();
    <span class="hljs-keyword">if</span> (!client) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsStatus</span> = <span class="hljs-string">'æœªè¿æ¥'</span>;
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">sendText</span>(<span class="hljs-string">'Hello WebSocket!'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsStatus</span> = <span class="hljs-string">'æ¶ˆæ¯å·²å‘é€'</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsStatus</span> = <span class="hljs-string">`å‘é€å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-comment">/**
   * æµ‹è¯•TCP Socketè¿æ¥
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testTCPSocket</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">connectTCPSocket</span>(<span class="hljs-string">'192.168.1.100'</span>, <span class="hljs-number">8888</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpStatus</span> = <span class="hljs-string">'å·²è¿æ¥'</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpStatus</span> = <span class="hljs-string">`è¿æ¥å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-comment">/**
   * å‘é€TCPæ¶ˆæ¯
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendTCPMessage</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> client = <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">getTCPSocketClient</span>();
    <span class="hljs-keyword">if</span> (!client) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpStatus</span> = <span class="hljs-string">'æœªè¿æ¥'</span>;
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Hello TCP!'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpStatus</span> = <span class="hljs-string">'æ¶ˆæ¯å·²å‘é€'</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tcpStatus</span> = <span class="hljs-string">`å‘é€å¤±è´¥: <span class="hljs-subst">${err}</span>`</span>;
    }
  }

  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// é¡µé¢é”€æ¯æ—¶æ¸…ç†è¿æ¥</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">cleanup</span>();
  }
}
</code></pre>
<h2 data-id="heading-15">å…­ã€æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-16">6.1 ç½‘ç»œè¯·æ±‚ä¼˜åŒ–</h3>
<ol>
<li><strong>è¿æ¥å¤ç”¨</strong>: HTTP/2å’ŒHTTP/3æ”¯æŒè¿æ¥å¤ç”¨,å‡å°‘æ¡æ‰‹å¼€é”€</li>
<li><strong>è¶…æ—¶è®¾ç½®</strong>: æ ¹æ®ä¸šåŠ¡åœºæ™¯åˆç†è®¾ç½®connectTimeoutå’ŒreadTimeout</li>
<li><strong>èµ„æºé‡Šæ”¾</strong>: åŠæ—¶è°ƒç”¨destroy()é‡Šæ”¾HttpRequestå¯¹è±¡</li>
<li><strong>ç¼“å­˜ç­–ç•¥</strong>: åˆç†ä½¿ç”¨usingCacheå‚æ•°,å‡å°‘é‡å¤è¯·æ±‚</li>
</ol>
<h3 data-id="heading-17">6.2 é”™è¯¯å¤„ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> robustHttpRequest&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">retries</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">lastError</span>: <span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; retries; i++) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NetworkManager</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-property">httpGet</span>&lt;T&gt;(url);
      <span class="hljs-keyword">return</span> result;
    } <span class="hljs-keyword">catch</span> (err) {
      lastError = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`è¯·æ±‚å¤±è´¥,ç¬¬<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>æ¬¡é‡è¯•:`</span>, err);

      <span class="hljs-comment">// ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, i)));
    }
  }

  <span class="hljs-keyword">throw</span> lastError || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>);
}
</code></pre>
<h3 data-id="heading-18">6.3 è¯ä¹¦å®‰å…¨é…ç½®</h3>
<p>åœ¨<code>src/main/resources/base/profile/network_config.json</code>é…ç½®è¯ä¹¦é”å®š:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"network-security-config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"domain-config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"domains"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"include-subdomains"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api.example.com"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"pin-set"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"expiration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-31"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"pin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"digest-algorithm"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sha256"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"digest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"base64encodedpinvalue"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">6.4 æ€§èƒ½ç›‘æ§</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkPerformanceMonitor</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">measureRequestTime</span>(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; {
    <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">NetworkManager</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">httpGet</span>(url);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚å¤±è´¥:'</span>, err);
      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    }
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkNetworkQuality</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">const</span> testUrl = <span class="hljs-string">'https://www.example.com'</span>;
    <span class="hljs-keyword">const</span> responseTime = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureRequestTime</span>(testUrl);

    <span class="hljs-keyword">if</span> (responseTime &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ç½‘ç»œå¼‚å¸¸'</span>;
    <span class="hljs-keyword">if</span> (responseTime &lt; <span class="hljs-number">100</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ç½‘ç»œä¼˜ç§€'</span>;
    <span class="hljs-keyword">if</span> (responseTime &lt; <span class="hljs-number">300</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ç½‘ç»œè‰¯å¥½'</span>;
    <span class="hljs-keyword">if</span> (responseTime &lt; <span class="hljs-number">1000</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ç½‘ç»œä¸€èˆ¬'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">'ç½‘ç»œè¾ƒå·®'</span>;
  }
}
</code></pre>
<h2 data-id="heading-20">ä¸ƒã€å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-21">Q1: åº”ç”¨é€€åˆ°åå°åSocketæ–­å¼€æ€ä¹ˆåŠ?</h3>
<p>A: åº”ç”¨é€€åå°åSocketå¯èƒ½æ–­å¼€,éœ€è¦åœ¨é‡å›å‰å°æ—¶æ£€æµ‹å¹¶é‡è¿:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onPageShow</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// æ£€æŸ¥è¿æ¥çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-variable language_">this</span>.<span class="hljs-property">networkManager</span>.<span class="hljs-title function_">getTCPSocketClient</span>();
  <span class="hljs-keyword">if</span> (client &amp;&amp; !client.<span class="hljs-title function_">isConnected</span>()) {
    <span class="hljs-comment">// é‡æ–°è¿æ¥</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reconnectSocket</span>();
  }
}
</code></pre>
<h3 data-id="heading-22">Q2: å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ ?</h3>
<p>A: ä½¿ç”¨multipart/form-dataæ ¼å¼,è®¾ç½®æ›´é•¿çš„è¶…æ—¶æ—¶é—´:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">uploadLargeFile</span>(<span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">const</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();

  <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, {
    <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>,
    <span class="hljs-attr">header</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'multipart/form-data'</span> },
    <span class="hljs-attr">multiFormDataList</span>: [{
      <span class="hljs-attr">name</span>: <span class="hljs-string">'file'</span>,
      <span class="hljs-attr">contentType</span>: <span class="hljs-string">'application/octet-stream'</span>,
      <span class="hljs-attr">filePath</span>: filePath,
      <span class="hljs-attr">remoteFileName</span>: <span class="hljs-string">'large_file.zip'</span>
    }],
    <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">600000</span>, <span class="hljs-comment">// 10åˆ†é’Ÿ</span>
    <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>
  });
}
</code></pre>
<h3 data-id="heading-23">Q3: WebSocketå¦‚ä½•å®ç°å¿ƒè·³ä¿æ´»?</h3>
<p>A: HarmonyOSçš„WebSocketå·²å†…ç½®å¿ƒè·³æœºåˆ¶,æ¯30ç§’è‡ªåŠ¨å‘é€Pingå¸§,60ç§’æ— å“åº”ä¼šæ–­å¼€è¿æ¥ã€‚å¼€å‘è€…æ— éœ€é¢å¤–å®ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Math.jså°è£…å·¥å…·åº“ï¼ˆè§£å†³å‰ç«¯å› ä¸ºæµ®ç‚¹æ•°å¯¼è‡´è®¡ç®—é”™è¯¯ï¼‰]]></title>    <link>https://juejin.cn/post/7570896170920476735</link>    <guid>https://juejin.cn/post/7570896170920476735</guid>    <pubDate>2025-11-10T08:43:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570896170920476735" data-draft-id="7435682717955932186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Math.jså°è£…å·¥å…·åº“ï¼ˆè§£å†³å‰ç«¯å› ä¸ºæµ®ç‚¹æ•°å¯¼è‡´è®¡ç®—é”™è¯¯ï¼‰"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T08:43:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jackè±æ°"/> <meta itemprop="url" content="https://juejin.cn/user/720885038716663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Math.jså°è£…å·¥å…·åº“ï¼ˆè§£å†³å‰ç«¯å› ä¸ºæµ®ç‚¹æ•°å¯¼è‡´è®¡ç®—é”™è¯¯ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/720885038716663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jackè±æ°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:43:32.000Z" title="Mon Nov 10 2025 08:43:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>è¯¥å·¥å…·åº“æ˜¯åŸºäº mathjs å°è£…çš„ä¸€ä¸ªæ•°å­¦è®¡ç®—å·¥å…·ï¼Œä¸»è¦è§£å†³ JavaScript æµ®ç‚¹æ•°è¿ç®—ç²¾åº¦é—®é¢˜ï¼Œæä¾›ç²¾ç¡®çš„åŠ å‡ä¹˜é™¤ã€å–æ¨¡ç­‰è¿ç®—åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚åˆè´¢åŠ¡ã€é‡‘èç­‰éœ€è¦é«˜ç²¾åº¦è®¡ç®—çš„åœºæ™¯ã€‚</p>
<h2 data-id="heading-1">å®‰è£…ä¸ä½¿ç”¨</h2>
<h3 data-id="heading-2">å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">npm install mathjs --save
</code></pre>
<h2 data-id="heading-3">ä½¿ç”¨</h2>
<p>utils/math.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> $math <span class="hljs-keyword">from</span> <span class="hljs-string">"mathjs"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> math = {
  <span class="hljs-title function_">add</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">comp</span>(<span class="hljs-string">"add"</span>, <span class="hljs-variable language_">arguments</span>);
  },
  <span class="hljs-title function_">subtract</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">comp</span>(<span class="hljs-string">"subtract"</span>, <span class="hljs-variable language_">arguments</span>);
  },
  <span class="hljs-title function_">multiply</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">comp</span>(<span class="hljs-string">"multiply"</span>, <span class="hljs-variable language_">arguments</span>);
  },
  <span class="hljs-title function_">divide</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">comp</span>(<span class="hljs-string">"divide"</span>, <span class="hljs-variable language_">arguments</span>);
  },
  <span class="hljs-title function_">mod</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">comp</span>(<span class="hljs-string">"mod"</span>, <span class="hljs-variable language_">arguments</span>);
  },
  <span class="hljs-title function_">divMod</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">const</span> quotient = $math.<span class="hljs-title function_">floor</span>(
      $math.<span class="hljs-title function_">divide</span>($math.<span class="hljs-title function_">bignumber</span>(a), $math.<span class="hljs-title function_">bignumber</span>(b))
    ); <span class="hljs-comment">// ä½¿ç”¨ floor è·å–æ•´æ•°éƒ¨åˆ†</span>
    <span class="hljs-keyword">const</span> remainder = $math.<span class="hljs-title function_">mod</span>($math.<span class="hljs-title function_">bignumber</span>(a), $math.<span class="hljs-title function_">bignumber</span>(b));
    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">parseFloat</span>(quotient), <span class="hljs-built_in">parseFloat</span>(remainder)];
    <span class="hljs-comment">// return {</span>
    <span class="hljs-comment">//   quotient: parseFloat(quotient),</span>
    <span class="hljs-comment">//   remainder: parseFloat(remainder),</span>
    <span class="hljs-comment">// };</span>
  },
  <span class="hljs-comment">// å¤„ç†å¤§æ•°å­—</span>
  <span class="hljs-title function_">bignumber</span>(<span class="hljs-params">string</span>) {
    <span class="hljs-keyword">return</span> $math.<span class="hljs-title function_">bignumber</span>(string).<span class="hljs-title function_">toNumber</span>();
  },
  <span class="hljs-comment">// æ¯”å¤§å°</span>
  <span class="hljs-title function_">compare</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">const</span> numA = $math.<span class="hljs-title function_">bignumber</span>(a);
    <span class="hljs-keyword">const</span> numB = $math.<span class="hljs-title function_">bignumber</span>(b);

    <span class="hljs-keyword">if</span> ($math.<span class="hljs-title function_">equal</span>(numA, numB)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// ç›¸ç­‰</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($math.<span class="hljs-title function_">smaller</span>(numA, numB)) {
      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// a &lt; b</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// a &gt; b</span>
    }
  },
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">comp</span>(<span class="hljs-params">_func, args</span>) {
  <span class="hljs-keyword">let</span> t = $math.<span class="hljs-title function_">chain</span>($math.<span class="hljs-title function_">bignumber</span>(args[<span class="hljs-number">0</span>]));

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; args.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> arg = args[i] || <span class="hljs-number">0</span>;
    t = t[_func]($math.<span class="hljs-title function_">bignumber</span>(arg));
  }
  <span class="hljs-comment">// é˜²æ­¢è¶…è¿‡6ä½ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•</span>
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(t.<span class="hljs-title function_">done</span>());
}

<span class="hljs-comment">// ä½¿ç”¨åœºæ™¯</span>
<span class="hljs-comment">// import { math } from '@/utils/math.js'</span>
<span class="hljs-comment">// åŠ æ³•</span>
<span class="hljs-comment">//    const result  = math.add(2, 3)  // 5</span>
<span class="hljs-comment">// å‡æ³•</span>
<span class="hljs-comment">//    const result  = math.subtract(3, 2)   // 1</span>
<span class="hljs-comment">// ä¹˜æ³•</span>
<span class="hljs-comment">//     const result  = math.multiply(2, 3) // 6</span>
<span class="hljs-comment">// é™¤æ³•</span>
<span class="hljs-comment">//       const result = math.divide(4, 2) // 2</span>
<span class="hljs-comment">// é™¤ä½™</span>
<span class="hljs-comment">// const result = math.mod(10, 3); //1</span>
<span class="hljs-comment">// é™¤ä½™æ–¹æ³•</span>
<span class="hljs-comment">//  math.divMod(10, 3);  // è¾“å‡º: { quotient: 3, remainder: 1 }</span>
<span class="hljs-comment">// å¯ä»¥å¤šä¸ª</span>
<span class="hljs-comment">//    const result  = math.multiply(3, 2, 2, 2)   // 24</span>
<span class="hljs-comment">// å–å†³äºmath.jsæ–‡ä»¶é‡Œé¢çš„å‘½åï¼ŒPSï¼šä¸­é—´æ˜¯é€—å·</span>
</code></pre>
<p>demo.vue</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é™¤æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number01 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number1 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ä¹˜æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number02 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number2 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number03 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number3 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å‡æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number04 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number4 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å¤šä¸ªè®¡ç®—<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ number5 }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { math } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils/math.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">number1</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number01</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number02</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number2</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number03</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number3</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number04</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number4</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">number5</span>: <span class="hljs-number">0</span>,
    };
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">divide</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">multiply</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">subtract</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">multiplys</span>();
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">divide</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number01</span> = <span class="hljs-number">6.1</span> / <span class="hljs-number">0.1</span>; <span class="hljs-comment">// 60.99999999999999</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number1</span> = math.<span class="hljs-title function_">divide</span>(<span class="hljs-number">6.1</span>, <span class="hljs-number">0.1</span>); <span class="hljs-comment">// 61</span>
    },
    <span class="hljs-title function_">multiply</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number02</span> = <span class="hljs-number">23</span> * <span class="hljs-number">2.4</span>; <span class="hljs-comment">// 55.199999999999996</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number2</span> = math.<span class="hljs-title function_">multiply</span>(<span class="hljs-number">23</span>, <span class="hljs-number">2.4</span>); <span class="hljs-comment">// 55.2</span>
    },
    <span class="hljs-title function_">add</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number03</span> = <span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span>; <span class="hljs-comment">// 0.30000000000000004</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number3</span> = math.<span class="hljs-title function_">add</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>); <span class="hljs-comment">// 0.3</span>
    },
    <span class="hljs-title function_">subtract</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number04</span> = <span class="hljs-number">0.8</span> - <span class="hljs-number">0.7</span>; <span class="hljs-comment">// 0.10000000000000009</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number4</span> = math.<span class="hljs-title function_">subtract</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.7</span>); <span class="hljs-comment">// 0.1</span>
    },
    <span class="hljs-title function_">multiplys</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">number5</span> = math.<span class="hljs-title function_">multiply</span>(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 24</span>
    },
  },
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app iOSæ€§èƒ½ç›‘æ§å…¨æ”»ç•¥ï¼Œè·¨ç«¯æ¶æ„ä¸‹çš„æ€§èƒ½é‡‡é›†ã€åˆ†æä¸å¤šå·¥å…·ååŒä¼˜åŒ–å®æˆ˜]]></title>    <link>https://juejin.cn/post/7570793903848095759</link>    <guid>https://juejin.cn/post/7570793903848095759</guid>    <pubDate>2025-11-10T08:43:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570793903848095759" data-draft-id="7570901172526317603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app iOSæ€§èƒ½ç›‘æ§å…¨æ”»ç•¥ï¼Œè·¨ç«¯æ¶æ„ä¸‹çš„æ€§èƒ½é‡‡é›†ã€åˆ†æä¸å¤šå·¥å…·ååŒä¼˜åŒ–å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T08:43:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app iOSæ€§èƒ½ç›‘æ§å…¨æ”»ç•¥ï¼Œè·¨ç«¯æ¶æ„ä¸‹çš„æ€§èƒ½é‡‡é›†ã€åˆ†æä¸å¤šå·¥å…·ååŒä¼˜åŒ–å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:43:51.000Z" title="Mon Nov 10 2025 08:43:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç§»åŠ¨è·¨ç«¯å¼€å‘çš„ç”Ÿæ€ä¸­ï¼Œ<strong>uni-app</strong> å·²æˆä¸ºå›½å†…æœ€å—æ¬¢è¿çš„æ¡†æ¶ä¹‹ä¸€ã€‚
å®ƒè®©å¼€å‘è€…èƒ½å¤Ÿç”¨ä¸€å¥— Vue ä»£ç åŒæ—¶æ„å»º iOSã€Android ä¸ Web åº”ç”¨ã€‚
ä½†åœ¨æ€§èƒ½å±‚é¢ï¼Œè¿™ç§â€œå¤šå±‚æ¸²æŸ“ + JSBridgeé€šä¿¡ + WebViewå®¹å™¨â€çš„æ¶æ„ï¼Œä¹Ÿå¸¦æ¥äº†æ›´å¤æ‚çš„æ€§èƒ½æŒ‘æˆ˜ã€‚</p>
<p>å°¤å…¶åœ¨ <strong>iOS ç«¯</strong>ï¼Œç”±äºUIæ¸²æŸ“çº¿ç¨‹ä¸JSæ‰§è¡Œçº¿ç¨‹åˆ†ç¦»ã€WebViewå±‚æ€§èƒ½å—ç³»ç»Ÿç‰ˆæœ¬å½±å“è¾ƒå¤§ï¼Œæ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜å¾€å¾€æˆä¸ºuni-appå¼€å‘è€…çš„æœ€å¤§ç—›ç‚¹ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆå®æˆ˜ç»éªŒï¼Œä»‹ç»å¦‚ä½•é€šè¿‡ <strong>Xcode Instrumentsã€å…‹é­”ï¼ˆKeyMobï¼‰ã€Safari Web Inspectorã€Firebase Performance</strong> ç­‰å¤šå·¥å…·ååŒï¼Œå®ç°å¯¹uni-appåœ¨iOSç«¯çš„å…¨æ–¹ä½æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–ã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸€ã€uni-appçš„iOSæ€§èƒ½ç‰¹ç‚¹</h3>
<p>åœ¨iOSå¹³å°ä¸Šï¼Œuni-app çš„è¿è¡Œæœºåˆ¶å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œå¤šå±‚æ¡¥æ¥æ ˆâ€ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ JSå¼•æ“ (JavaScriptCore) ]</span>
        â†“
<span class="hljs-selector-attr">[ JSBridge (HBuilderæ¡†æ¶) ]</span>
        â†“
<span class="hljs-selector-attr">[ Native View / WKWebView ]</span>
        â†“
<span class="hljs-selector-attr">[ iOS System APIs ]</span>
</code></pre>
<p>è¿™æ„å‘³ç€æ€§èƒ½ç“¶é¢ˆå¯èƒ½å‡ºç°åœ¨å¤šä¸ªå±‚é¢ï¼š</p>
<ol>
<li><strong>JSçº¿ç¨‹æ€§èƒ½</strong> â€”â€” å¤§é‡è®¡ç®—ä»»åŠ¡é˜»å¡æ¸²æŸ“ï¼›</li>
<li><strong>æ¸²æŸ“å±‚æ€§èƒ½</strong> â€”â€” WebViewç»˜åˆ¶æ•ˆç‡ä½ï¼›</li>
<li><strong>Nativeå±‚é€šä¿¡</strong> â€”â€” JSBridgeè¿‡åº¦è°ƒç”¨æˆ–æ•°æ®åºåˆ—åŒ–å¼€é”€ï¼›</li>
<li><strong>èµ„æºåŠ è½½ä¸ç¼“å­˜ç­–ç•¥</strong> â€”â€” ç½‘ç»œå»¶è¿Ÿä¸å›¾ç‰‡ä½“ç§¯é€ æˆå¡é¡¿ï¼›</li>
<li><strong>èƒ½è€—ä¸å†…å­˜ç®¡ç†</strong> â€”â€” é•¿æ—¶é—´è¿è¡Œå¯¼è‡´å†…å­˜è†¨èƒ€ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œæ€§èƒ½ç›‘æ§å¿…é¡»å®ç°â€œè·¨çº¿ç¨‹ã€è·¨å±‚çº§â€çš„è¦†ç›–ã€‚</p>
<hr/>
<h3 data-id="heading-1">äºŒã€æ€§èƒ½ç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡</h3>



































<table><thead><tr><th>ç›‘æ§ç»´åº¦</th><th>æŒ‡æ ‡è¯´æ˜</th><th>å¸¸è§é—®é¢˜è¡¨ç°</th></tr></thead><tbody><tr><td>CPU ä½¿ç”¨ç‡</td><td>JSçº¿ç¨‹ä¸æ¸²æŸ“çº¿ç¨‹å ç”¨ç‡</td><td>æ»šåŠ¨å¡é¡¿ã€åŠ¨ç”»ä¸æµç•…</td></tr><tr><td>å†…å­˜å ç”¨</td><td>JSå¯¹è±¡ä¸ç¼“å­˜é‡Šæ”¾æƒ…å†µ</td><td>é•¿æ—¶é—´è¿è¡Œå´©æºƒ</td></tr><tr><td>GPU ä¸å¸§ç‡ï¼ˆFPSï¼‰</td><td>é¡µé¢æ¸²æŸ“é€Ÿç‡</td><td>é¡µé¢æ‰å¸§æˆ–é»‘å±</td></tr><tr><td>ç½‘ç»œæ€§èƒ½</td><td>è¯·æ±‚å»¶è¿Ÿã€èµ„æºåŠ è½½è€—æ—¶</td><td>é¡µé¢é¦–å±æ…¢</td></tr><tr><td>èƒ½è€—åˆ†æ</td><td>ç”µé‡æ¶ˆè€—ä¸åå°è¿è¡Œæƒ…å†µ</td><td>è¿‡çƒ­ã€ç»­èˆªå·®</td></tr></tbody></table>
<p>uni-app çš„æ€§èƒ½ç›‘æ§ç­–ç•¥ï¼Œåº”å›´ç»•è¿™äº”ä¸ªæ ¸å¿ƒç»´åº¦æ„å»ºã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€Xcode Instrumentsï¼šåŸç”Ÿæ€§èƒ½é‡‡æ ·åŸºç¡€</h3>
<p>è™½ç„¶uni-appåŸºäºè·¨ç«¯æ¡†æ¶ï¼Œä½†åœ¨iOSç«¯æœ€ç»ˆä»è¿è¡Œåœ¨ <strong>Nativeå®¹å™¨ä¸WKWebViewç¯å¢ƒ</strong> ä¸­ã€‚
è¿™æ„å‘³ç€ä½ ä¾ç„¶å¯ä»¥åˆ©ç”¨ <strong>Xcode Instruments</strong> è¿›è¡Œåº•å±‚æ€§èƒ½é‡‡æ ·ã€‚</p>
<p><strong>æ¨èä½¿ç”¨çš„Instrumentsæ¨¡å—ï¼š</strong></p>
<ul>
<li><strong>Time Profiler</strong>ï¼šé‡‡æ ·CPUè°ƒç”¨ï¼Œå‘ç°JSBridgeä¸ä¸»çº¿ç¨‹é˜»å¡ã€‚</li>
<li><strong>Allocations / Leaks</strong>ï¼šç›‘æ§å†…å­˜åˆ†é…ä¸é‡Šæ”¾ã€‚</li>
<li><strong>Core Animation</strong>ï¼šåˆ†æå¸§ç‡ä¸UIæ‰å¸§ã€‚</li>
<li><strong>Network Monitor</strong>ï¼šæŸ¥çœ‹HTTPè¯·æ±‚æµé‡ä¸å»¶è¿Ÿã€‚</li>
</ul>
<p>ä¼˜ç‚¹ï¼šç²¾åº¦é«˜ï¼Œèƒ½è¯†åˆ«Appä¸­Nativeå±‚è°ƒç”¨æ ˆã€‚
ç¼ºç‚¹ï¼šæ— æ³•æŸ¥çœ‹JSå±‚å…·ä½“é€»è¾‘ï¼Œé‡‡æ ·æ—¶é—´å—é™ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> è°ƒè¯•é˜¶æ®µæ€§èƒ½ç“¶é¢ˆå®šä½ã€‚</p>
<hr/>
<h3 data-id="heading-3">å››ã€å…‹é­”ï¼ˆKeyMobï¼‰ï¼šå¤šç»´å®æ—¶æ€§èƒ½ç›‘æ§ä¸æ—¥å¿—åˆ†æ</h3>
<p><strong>å…‹é­”ï¼ˆKeyMobï¼‰</strong> æ˜¯é¢å‘iOSå¼€å‘è€…çš„æ€§èƒ½ç›‘æ§ä¸æ•°æ®åˆ†æå·¥å…·ã€‚
ä¸Instrumentsä¸åŒï¼Œå®ƒèƒ½åœ¨<strong>éè¶Šç‹±ç¯å¢ƒä¸‹å®æ—¶é‡‡æ ·CPUã€GPUã€å†…å­˜ã€ç½‘ç»œä¸å¸§ç‡ï¼ˆFPSï¼‰</strong>ï¼Œå¹¶ä»¥å›¾è¡¨æ–¹å¼å±•ç¤ºã€‚</p>
<h4 data-id="heading-4">1. å®æ—¶æ€§èƒ½ç›‘æ§</h4>
<p>KeyMob èƒ½ç›´æ¥ç›‘æ§è¿è¡Œä¸­uni-appçš„ï¼š</p>
<ul>
<li>CPU/GPUå ç”¨æ›²çº¿</li>
<li>å†…å­˜åŠ¨æ€å˜åŒ–</li>
<li>ç½‘ç»œè¯·æ±‚ä¸å“åº”å»¶è¿Ÿ</li>
<li>FPSä¸å¡é¡¿ç‚¹</li>
</ul>
<p>åœ¨ä¸€æ¬¡å®é™…é¡¹ç›®ä¸­ï¼Œç¬”è€…åˆ©ç”¨KeyMobå‘ç°ä¸€ä¸ªuni-appé¡µé¢åœ¨åˆ—è¡¨æ»‘åŠ¨æ—¶CPUé£™å‡è‡³95%ï¼Œç»æ’æŸ¥å‘ç°JSå±‚é¢‘ç¹è§¦å‘åŒæ­¥DOMæ›´æ–°ã€‚ä¼˜åŒ–åï¼Œå¹³å‡å¸§ç‡ä»48fpsæå‡åˆ°59fpsã€‚</p>
<h4 data-id="heading-5">2. æ–‡ä»¶ä¸æ—¥å¿—åˆ†æ</h4>
<p>KeyMob å¯è®¿é—®åº”ç”¨çš„æ—¥å¿—æ–‡ä»¶ã€ç¼“å­˜ç›®å½•ä¸ç³»ç»Ÿæ—¥å¿—ã€‚
å¼€å‘è€…å¯ä»¥ç›´æ¥å¯¼å‡º <code>.log</code> æ–‡ä»¶å¹¶é€šè¿‡å…³é”®å­—è¿‡æ»¤ JSBridge é”™è¯¯æˆ–å´©æºƒæ ˆã€‚</p>
<h4 data-id="heading-6">3. å†å²æ€§èƒ½è®°å½•</h4>
<p>æ”¯æŒ6ä¸ªæœˆçš„æ€§èƒ½å†å²è®°å½•å­˜å‚¨ï¼Œæ–¹ä¾¿ç‰ˆæœ¬é—´å¯¹æ¯”ã€‚</p>
<p>ä¼˜ç‚¹ï¼šè·¨å¹³å°ï¼ˆMac/Windows/Linuxï¼‰ï¼Œå®æ—¶å¯è§†åŒ–ç›‘æ§ã€‚
ç¼ºç‚¹ï¼šä¸å…·å¤‡çº¿ä¸Šäº‘ç«¯ç»Ÿè®¡åŠŸèƒ½ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å†…æµ‹ä¸è°ƒä¼˜é˜¶æ®µçš„æœ¬åœ°æ€§èƒ½è¿½è¸ªã€‚</p>
<hr/>
<h3 data-id="heading-7">äº”ã€Safari Web Inspectorï¼šJSå±‚ä¸WebViewè°ƒè¯•åˆ©å™¨</h3>
<p><strong>Safari Web Inspector</strong> æ˜¯åˆ†æuni-app JSå±‚ä¸WebViewæ¸²æŸ“æ€§èƒ½çš„å®˜æ–¹å·¥å…·ã€‚</p>
<p>è¿æ¥çœŸæœºåï¼Œå¯é€šè¿‡ Safari â†’ Develop â†’ [è®¾å¤‡] â†’ [WebViewé¡µé¢] æ‰“å¼€è°ƒè¯•çª—å£ã€‚</p>
<p><strong>å…³é”®åŠŸèƒ½ï¼š</strong></p>
<ul>
<li>JSæ€§èƒ½åˆ†æï¼ˆProfilesï¼‰</li>
<li>ç½‘ç»œè¯·æ±‚æŸ¥çœ‹ï¼ˆNetworkï¼‰</li>
<li>DOMç»“æ„ä¸æ¸²æŸ“æ—¶é—´ç»Ÿè®¡</li>
<li>æ§åˆ¶å°æ—¥å¿—è¾“å‡º</li>
</ul>
<p>åœ¨uni-appé¡¹ç›®ä¸­ï¼Œå¸¸è§æ€§èƒ½é—®é¢˜å¦‚ï¼š</p>
<ul>
<li><code>setData()</code> è°ƒç”¨é¢‘ç‡è¿‡é«˜ï¼›</li>
<li>ä¸å¿…è¦çš„DOMæ›´æ–°ï¼›</li>
<li>JSå¾ªç¯è®¡ç®—é˜»å¡UIçº¿ç¨‹ã€‚</li>
</ul>
<p>é€šè¿‡Web Inspectorå¯ç›´è§‚åˆ†æè¿™äº›é—®é¢˜ã€‚</p>
<p>ä¼˜ç‚¹ï¼šè½»é‡ã€ç²¾ç¡®ã€å®˜æ–¹æ”¯æŒã€‚
ç¼ºç‚¹ï¼šä»…é™WebViewå±‚åˆ†æï¼Œä¸å«Nativeä¸æ€§èƒ½æŒ‡æ ‡ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> JSé€»è¾‘ä¸DOMæ¸²æŸ“ä¼˜åŒ–ã€‚</p>
<hr/>
<h3 data-id="heading-8">å…­ã€Firebase Performanceï¼šçœŸå®ç”¨æˆ·æ€§èƒ½è¿½è¸ª</h3>
<p><strong>Firebase Performance</strong> èƒ½æ”¶é›†çœŸå®ç”¨æˆ·è®¾å¤‡çš„æ€§èƒ½æ•°æ®ï¼Œé€‚åˆuni-appä¸Šçº¿åçš„æ€§èƒ½è¶‹åŠ¿åˆ†æã€‚</p>
<p><strong>å¯ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬ï¼š</strong></p>
<ul>
<li>å¯åŠ¨æ—¶é—´ï¼ˆApp Start Timeï¼‰</li>
<li>ç½‘ç»œè¯·æ±‚è€—æ—¶ï¼ˆHTTP Metricsï¼‰</li>
<li>é¡µé¢åŠ è½½æ—¶é—´</li>
<li>è‡ªå®šä¹‰æ€§èƒ½äº‹ä»¶</li>
</ul>
<p>ä¸uni-appé›†æˆæ—¶ï¼Œå¯ä»¥åœ¨ <code>manifest.json</code> ä¸­åŠ å…¥Firebase SDKé…ç½®ï¼Œå¹¶åœ¨JSä¸­åŸ‹ç‚¹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">firebase<span class="hljs-selector-class">.performance</span>()<span class="hljs-selector-class">.trace</span>("load_homepage")<span class="hljs-selector-class">.start</span>();
</code></pre>
<p>ä¼˜ç‚¹ï¼šè‡ªåŠ¨èšåˆæ•°æ®ã€å¯åŒºåˆ†åœ°åŒºä¸è®¾å¤‡ç±»å‹
ç¼ºç‚¹ï¼šä¸é€‚åˆå¼€å‘é˜¶æ®µå®æ—¶è°ƒè¯•</p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> ä¸Šçº¿åæ€§èƒ½è¶‹åŠ¿ä¸ç”¨æˆ·ç«¯åé¦ˆç›‘æ§ã€‚</p>
<hr/>
<h3 data-id="heading-9">ä¸ƒã€å¤šå·¥å…·ååŒçš„å®Œæ•´å·¥ä½œæµ</h3>






























<table><thead><tr><th>é˜¶æ®µ</th><th>å·¥å…·ç»„åˆ</th><th>ç›®æ ‡</th></tr></thead><tbody><tr><td>å¼€å‘é˜¶æ®µ</td><td>Xcode Instruments + Safari Web Inspector</td><td>å®šä½JSä¸Nativeå±‚ç“¶é¢ˆ</td></tr><tr><td>å†…æµ‹é˜¶æ®µ</td><td>KeyMob + Web Inspector</td><td>å®æ—¶æ€§èƒ½ç›‘æ§ä¸JSå±‚è°ƒè¯•</td></tr><tr><td>ä¸Šçº¿é˜¶æ®µ</td><td>Firebase Performance + KeyMob æ•°æ®å¯¹æ¯”</td><td>ç”¨æˆ·ç«¯æ€§èƒ½è¶‹åŠ¿ä¸ç‰ˆæœ¬ä¼˜åŒ–éªŒè¯</td></tr><tr><td>é•¿æœŸç»´æŠ¤</td><td>KeyMob å†å²è®°å½• + Firebase æŠ¥å‘Š</td><td>å›å½’ç›‘æµ‹ä¸æ€§èƒ½æ³¢åŠ¨åˆ†æ</td></tr></tbody></table>
<p>é€šè¿‡è¿™æ ·çš„ç»„åˆï¼Œå¼€å‘è€…å¯ä»¥å®ç°ä»<strong>æœ¬åœ°è°ƒè¯• â†’ å†…æµ‹ä¼˜åŒ– â†’ ä¸Šçº¿è¿½è¸ª â†’ é•¿æœŸåˆ†æ</strong>çš„é—­ç¯ä½“ç³»ã€‚</p>
<hr/>
<h3 data-id="heading-10">å…«ã€å®æˆ˜æ¡ˆä¾‹ï¼šuni-appé¡µé¢å¡é¡¿çš„å…¨é“¾è·¯å®šä½</h3>
<p>åœ¨ä¸€æ¬¡H5ç”µå•†é¡¹ç›®ä¸­ï¼Œå¼€å‘è€…å‘ç°iPhoneç«¯é¡µé¢æ»šåŠ¨æ˜æ˜¾å¡é¡¿ã€‚
é€šè¿‡å¤šå·¥å…·åˆ†æï¼š</p>
<p><strong>Safari Web Inspector</strong>ï¼šå‘ç°JSå±‚é¢‘ç¹è°ƒç”¨ <code>setData()</code>ï¼Œæ›´æ–°èŠ‚ç‚¹è¿‡å¤šï¼›
<strong>KeyMob</strong>ï¼šç¡®è®¤å¡é¡¿æœŸé—´CPUå ç”¨æ¥è¿‘100%ï¼Œå¸§ç‡è·Œè‡³35fpsï¼›
<strong>Instruments</strong>ï¼šå®šä½åˆ°ä¸»çº¿ç¨‹é˜»å¡å‡½æ•°ä¸º <code>renderHTML()</code>ï¼›
<strong>ä¼˜åŒ–åæµ‹è¯•</strong>ï¼šCPUä¸‹é™è‡³45%ï¼Œå¹³å‡å¸§ç‡æå‡è‡³60fpsã€‚</p>
<p>ç»“åˆFirebaseçº¿ä¸Šæ•°æ®éªŒè¯ï¼Œå¹³å‡é¡µé¢åŠ è½½æ—¶é—´ä¸‹é™çº¦28%ã€‚</p>
<hr/>
<h3 data-id="heading-11">ä¹ã€æœªæ¥è¶‹åŠ¿ï¼šè·¨ç«¯æ¡†æ¶çš„æ€§èƒ½å¯è§†åŒ–</h3>
<p>éšç€uni-appã€Flutterã€React Nativeç­‰è·¨ç«¯æ¡†æ¶çš„å‘å±•ï¼Œæ€§èƒ½ç›‘æ§å°†èµ°å‘â€œ<strong>è·¨å±‚å¯è§†åŒ–</strong>â€ã€‚</p>
<ul>
<li>Apple æ­£å¼•å…¥ Swift Trace API ä¾›è·¨å±‚æ€§èƒ½é‡‡æ ·ï¼›</li>
<li>KeyMob è®¡åˆ’æ”¯æŒ H5ä¸Nativeæ··åˆæ€§èƒ½å›¾è¡¨å¯¹é½ï¼›</li>
<li>Firebase å°†æä¾›â€œè·¨ç«¯æ€§èƒ½è§†å›¾â€ï¼Œç»Ÿä¸€å±•ç¤ºiOS/Androidæ•°æ®ã€‚</li>
</ul>
<p>æœªæ¥çš„æ€§èƒ½åˆ†æå°†ä¸å†åˆ†æ•£åœ¨å·¥å…·ä¹‹é—´ï¼Œè€Œæ˜¯ä¸€ä¸ªè·¨ç”Ÿæ€çš„æ™ºèƒ½ç›‘æ§ç½‘ç»œã€‚</p>
<hr/>
<p>uni-app è®©å¼€å‘è€…ä»¥æ›´å¿«é€Ÿåº¦æ„å»ºå¤šç«¯Appï¼Œä½†æ€§èƒ½ç›‘æ§ç»ä¸èƒ½è¢«å¿½ç•¥ã€‚
é€šè¿‡ <strong>Xcode Instrumentsã€Safari Web Inspectorã€å…‹é­”ï¼ˆKeyMobï¼‰ã€Firebase Performance</strong> çš„ç»„åˆï¼Œä½ å¯ä»¥åœ¨ä¸åŒå±‚çº§å‘ç°æ€§èƒ½ç“¶é¢ˆï¼š</p>
<ul>
<li><strong>Xcode</strong> æŸ¥åº•å±‚ï¼›</li>
<li><strong>Safari</strong> æŸ¥JSå±‚ï¼›</li>
<li><strong>KeyMob</strong> æŸ¥ç³»ç»Ÿçº§ï¼›</li>
<li><strong>Firebase</strong> æŸ¥ç”¨æˆ·ç«¯ã€‚</li>
</ul>
<p>è·¨ç«¯æ¶æ„çš„å¤æ‚æ€§ï¼Œéœ€è¦å¤šå·¥å…·çš„ååŒã€‚åªæœ‰åœ¨â€œæ•°æ®é©±åŠ¨â€çš„ç›‘æ§ä½“ç³»ä¸‹ï¼Œuni-app çš„æ€§èƒ½ä¼˜åŒ–æ‰èƒ½çœŸæ­£è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»nginxè§’åº¦çœ‹æ•°æ®è¯»å†™ï¼Œé˜»å¡å’Œéé˜»å¡]]></title>    <link>https://juejin.cn/post/7570598043298365503</link>    <guid>https://juejin.cn/post/7570598043298365503</guid>    <pubDate>2025-11-10T08:43:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298365503" data-draft-id="7570534000718626879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»nginxè§’åº¦çœ‹æ•°æ®è¯»å†™ï¼Œé˜»å¡å’Œéé˜»å¡"/> <meta itemprop="keywords" content="Nginx,Cè¯­è¨€,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-11-10T08:43:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jzhwolp"/> <meta itemprop="url" content="https://juejin.cn/user/3444121799235879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»nginxè§’åº¦çœ‹æ•°æ®è¯»å†™ï¼Œé˜»å¡å’Œéé˜»å¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3444121799235879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jzhwolp
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:43:47.000Z" title="Mon Nov 10 2025 08:43:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">nginx ä¸­çš„read å’Œrecv å‡½æ•°</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ Nginx çš„é«˜æ€§èƒ½äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­ï¼ŒI/O å¤„ç†æ˜¯æ€§èƒ½çš„æ ¸å¿ƒç¯èŠ‚ã€‚ å…¶ä¸­ï¼Œread ä¸ recv æ˜¯æœ€åŸºç¡€çš„ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œç”¨äºä»å¥—æ¥å­—ä¸­è¯»å–æ•°æ®ã€‚ ä½†åœ¨ Nginx ä¸­ï¼Œå®ƒä»¬å¹¶éç®€å•åœ°ç›´æ¥è°ƒç”¨å†…æ ¸å‡½æ•°ï¼Œè€Œæ˜¯ç»è¿‡ä¸€å±‚æŠ½è±¡å’Œäº‹ä»¶æœºåˆ¶å°è£…ï¼Œå½¢æˆä¸€å¥—é«˜æ•ˆã€å¯æ‰©å±•çš„ I/O æ¨¡å‹ã€‚ æœ¬æ–‡å°†ä» Linux ç³»ç»Ÿè°ƒç”¨å¼€å§‹ï¼Œå±‚å±‚å‰–æ Nginx çš„è¯»å–è·¯å¾„ï¼Œä»åº•å±‚ recv() åˆ°å°è£…çš„ ngx_unix_recv()ï¼Œå†åˆ°äº‹ä»¶è§¦å‘æœºåˆ¶çš„äº¤äº’ï¼Œå¸®ä½ å½»åº•ç†è§£ Nginx çš„ç½‘ç»œ I/O æ ¸å¿ƒã€‚</p>
<h3 data-id="heading-2">Linux ä¸­çš„ read å’Œ recv</h3>
<p>åœ¨ Linux ä¸‹ï¼Œread() ä¸ recv() éƒ½å¯ä»¥ä»å¥—æ¥å­—è¯»å–æ•°æ®ã€‚</p>
<p>read() æ˜¯é€šç”¨æ–‡ä»¶è¯»å–æ¥å£ï¼›</p>
<p>recv() ä¸“é—¨ä¸º socket é€šä¿¡è®¾è®¡ï¼Œæä¾›æ›´å¤šé€‰é¡¹ï¼ˆå¦‚ MSG_PEEKã€MSG_DONTWAITï¼‰ã€‚</p>
<p>äºŒè€…è°ƒç”¨è·¯å¾„å‡ ä¹ç›¸åŒï¼ŒåŒºåˆ«åœ¨äºè¯­ä¹‰ï¼š</p>






























<table><thead><tr><th>å‡½æ•°</th><th>ç”¨é€”</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><code>read(fd, buf, size)</code></td><td>é€šç”¨æ–‡ä»¶è¯»å–</td><td>é˜»å¡ç›´åˆ°æœ‰æ•°æ®</td></tr><tr><td><code>recv(fd, buf, size, flags)</code></td><td>å¥—æ¥å­—è¯»å–</td><td>æ”¯æŒéé˜»å¡ä¸æ›´å¤šæ§åˆ¶é€‰é¡¹</td></tr><tr><td><code>recvfrom()</code></td><td>æ”¯æŒ UDP åœ°å€ä¿¡æ¯</td><td/></tr><tr><td><code>recvmsg()</code></td><td>æ”¯æŒå¤šç¼“å†²åŒºå’Œæ§åˆ¶æ¶ˆæ¯</td><td/></tr></tbody></table>
<p>åœ¨ Nginx çš„å®ç°ä¸­ï¼Œä¸ºäº†å…¼å®¹å„ç§ç³»ç»Ÿå¹³å°ä¸ I/O æ¨¡å¼ï¼Œå†…éƒ¨ç»Ÿä¸€é€šè¿‡ä¸€ä¸ªå°è£…å±‚è°ƒç”¨ recv()å’Œ send()ã€‚</p>
<h4 data-id="heading-3">manæ‰‹å†Œä¸­å¯¹äºrecvçš„æè¿°</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">RETURN</span> VALUE Â  Â  Â  Â  top
 Â  Â  Â  These calls <span class="hljs-keyword">return</span> the number <span class="hljs-keyword">of</span> bytes received, <span class="hljs-built_in">or</span> -<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> an <span class="hljs-keyword">error</span>
 Â  Â  Â  occurred.  <span class="hljs-keyword">In</span> the <span class="hljs-keyword">event</span> <span class="hljs-keyword">of</span> an <span class="hljs-keyword">error</span>, errno <span class="hljs-built_in">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> indicate the
 Â  Â  Â  <span class="hljs-keyword">error</span>.
â€‹
 Â  Â  Â  <span class="hljs-keyword">When</span> a stream socket peer has performed an orderly shutdown, the
 Â  Â  Â  <span class="hljs-keyword">return</span> value will be <span class="hljs-number">0</span> (the traditional <span class="hljs-string">"end-of-file"</span> <span class="hljs-keyword">return</span>).
â€‹
 Â  Â  Â  Datagram sockets <span class="hljs-keyword">in</span> various domains (e.g., the UNIX <span class="hljs-built_in">and</span> Internet
 Â  Â  Â  domains) permit zero-size datagrams.  <span class="hljs-keyword">When</span> such a datagram <span class="hljs-built_in">is</span>
 Â  Â  Â  received, the <span class="hljs-keyword">return</span> value <span class="hljs-built_in">is</span> <span class="hljs-number">0</span>.
â€‹
 Â  Â  Â  The value <span class="hljs-number">0</span> may also be returned <span class="hljs-keyword">if</span> the requested number <span class="hljs-keyword">of</span> bytes
 Â  Â  Â  <span class="hljs-keyword">to</span> receive <span class="hljs-keyword">from</span> a stream socket was <span class="hljs-number">0</span>.
â€‹
ERRORS Â  Â  Â  Â  top
 Â  Â  Â  These are some standard errors generated <span class="hljs-keyword">by</span> the socket layer.
 Â  Â  Â  Additional errors may be generated <span class="hljs-built_in">and</span> returned <span class="hljs-keyword">from</span> the
 Â  Â  Â  underlying protocol modules; see their manual pages.
â€‹
 Â  Â  Â  EAGAIN <span class="hljs-built_in">or</span> EWOULDBLOCK
 Â  Â  Â  Â  Â  Â   The socket <span class="hljs-built_in">is</span> marked nonblocking <span class="hljs-built_in">and</span> the receive operation
 Â  Â  Â  Â  Â  Â   would block, <span class="hljs-built_in">or</span> a receive timeout had been <span class="hljs-keyword">set</span> <span class="hljs-built_in">and</span> the
 Â  Â  Â  Â  Â  Â   timeout expired before data was received.  POSIX.<span class="hljs-number">1</span> allows
 Â  Â  Â  Â  Â  Â   either <span class="hljs-keyword">error</span> <span class="hljs-keyword">to</span> be returned <span class="hljs-keyword">for</span> this <span class="hljs-keyword">case</span>, <span class="hljs-built_in">and</span> does <span class="hljs-built_in">not</span>
 Â  Â  Â  Â  Â  Â   require these constants <span class="hljs-keyword">to</span> have the same value, so a
 Â  Â  Â  Â  Â  Â   portable application should check <span class="hljs-keyword">for</span> both possibilities.
â€‹
 Â  Â  Â  EBADF  The argument sockfd <span class="hljs-built_in">is</span> an invalid file descriptor.
â€‹
 Â  Â  Â  ECONNREFUSED
 Â  Â  Â  Â  Â  Â   A remote host refused <span class="hljs-keyword">to</span> allow the network connection
 Â  Â  Â  Â  Â  Â   (typically because it <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> running the requested
 Â  Â  Â  Â  Â  Â  Â service).
â€‹
 Â  Â  Â  EFAULT The receive buffer pointer(s) point outside the process<span class="hljs-comment">'s</span>
 Â  Â  Â  Â  Â  Â   address space.
â€‹
 Â  Â  Â  EINTR  The receive was interrupted <span class="hljs-keyword">by</span> delivery <span class="hljs-keyword">of</span> a signal before
 Â  Â  Â  Â  Â  Â   any data was available; see signal(<span class="hljs-number">7</span>).
â€‹
 Â  Â  Â  EINVAL Invalid argument passed.
â€‹
 Â  Â  Â  ENOMEM Could <span class="hljs-built_in">not</span> allocate memory <span class="hljs-keyword">for</span> recvmsg().
â€‹
 Â  Â  Â  ENOTCONN
 Â  Â  Â  Â  Â  Â   The socket <span class="hljs-built_in">is</span> associated <span class="hljs-keyword">with</span> a connection-oriented
 Â  Â  Â  Â  Â  Â   protocol <span class="hljs-built_in">and</span> has <span class="hljs-built_in">not</span> been connected (see connect(<span class="hljs-number">2</span>) <span class="hljs-built_in">and</span>
 Â  Â  Â  Â  Â  Â   accept(<span class="hljs-number">2</span>)).
â€‹
 Â  Â  Â  ENOTSOCK
 Â  Â  Â  Â  Â  Â   The file descriptor sockfd does <span class="hljs-built_in">not</span> refer <span class="hljs-keyword">to</span> a socket.
â€‹
</code></pre>
<h4 data-id="heading-4">man æ‰‹å†Œå¯¹äº send çš„æè¿°</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">RETURN</span> VALUE Â  Â  Â  Â  top
 Â  Â  Â  <span class="hljs-keyword">On</span> success, these calls <span class="hljs-keyword">return</span> the number <span class="hljs-keyword">of</span> bytes sent.  <span class="hljs-keyword">On</span>
 Â  Â  Â  <span class="hljs-keyword">error</span>, -<span class="hljs-number">1</span> <span class="hljs-built_in">is</span> returned, <span class="hljs-built_in">and</span> errno <span class="hljs-built_in">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> indicate the <span class="hljs-keyword">error</span>.
ERRORS Â  Â  Â  Â  top
 Â  Â  Â  These are some standard errors generated <span class="hljs-keyword">by</span> the socket layer.
 Â  Â  Â  Additional errors may be generated <span class="hljs-built_in">and</span> returned <span class="hljs-keyword">from</span> the
 Â  Â  Â  underlying protocol modules; see their respective manual pages.
â€‹
 Â  Â  Â  EACCES (<span class="hljs-keyword">For</span> UNIX domain sockets, which are identified <span class="hljs-keyword">by</span> pathname)
 Â  Â  Â  Â  Â  Â   Write permission <span class="hljs-built_in">is</span> denied <span class="hljs-keyword">on</span> the destination socket file,
 Â  Â  Â  Â  Â  Â   <span class="hljs-built_in">or</span> search permission <span class="hljs-built_in">is</span> denied <span class="hljs-keyword">for</span> one <span class="hljs-keyword">of</span> the directories
 Â  Â  Â  Â  Â  Â   the path prefix.  (See path_resolution(<span class="hljs-number">7</span>).)
â€‹
 Â  Â  Â  Â  Â  Â   (<span class="hljs-keyword">For</span> UDP sockets) An attempt was made <span class="hljs-keyword">to</span> send <span class="hljs-keyword">to</span> a
 Â  Â  Â  Â  Â  Â   network/broadcast address <span class="hljs-keyword">as</span> though it was a unicast
 Â  Â  Â  Â  Â  Â   address.
â€‹
 Â  Â  Â  EAGAIN <span class="hljs-built_in">or</span> EWOULDBLOCK
 Â  Â  Â  Â  Â  Â   The socket <span class="hljs-built_in">is</span> marked nonblocking <span class="hljs-built_in">and</span> the requested
 Â  Â  Â  Â  Â  Â   operation would block.  POSIX.<span class="hljs-number">1</span>-<span class="hljs-number">2001</span> allows either <span class="hljs-keyword">error</span> <span class="hljs-keyword">to</span>
 Â  Â  Â  Â  Â  Â   be returned <span class="hljs-keyword">for</span> this <span class="hljs-keyword">case</span>, <span class="hljs-built_in">and</span> does <span class="hljs-built_in">not</span> require these
 Â  Â  Â  Â  Â  Â   constants <span class="hljs-keyword">to</span> have the same value, so a portable application
 Â  Â  Â  Â  Â  Â   should check <span class="hljs-keyword">for</span> both possibilities.
â€‹
 Â  Â  Â  EAGAIN (Internet domain datagram sockets) The socket referred <span class="hljs-keyword">to</span>
 Â  Â  Â  Â  Â  Â   <span class="hljs-keyword">by</span> sockfd had <span class="hljs-built_in">not</span> previously been bound <span class="hljs-keyword">to</span> an address <span class="hljs-built_in">and</span>,
 Â  Â  Â  Â  Â  Â   upon attempting <span class="hljs-keyword">to</span> bind it <span class="hljs-keyword">to</span> an ephemeral port, it was
 Â  Â  Â  Â  Â  Â   determined that all port numbers <span class="hljs-keyword">in</span> the ephemeral port
 Â  Â  Â  Â  Â  Â   range are currently <span class="hljs-keyword">in</span> use.  See the discussion <span class="hljs-keyword">of</span>
 Â  Â  Â  Â  Â  Â   /proc/sys/net/ipv4/ip_local_port_range <span class="hljs-keyword">in</span> ip(<span class="hljs-number">7</span>).
â€‹
 Â  Â  Â  EALREADY
 Â  Â  Â  Â  Â  Â   Another Fast Open <span class="hljs-built_in">is</span> <span class="hljs-keyword">in</span> progress.
â€‹
 Â  Â  Â  EBADF  sockfd <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> a valid open file descriptor.
â€‹
 Â  Â  Â  ECONNRESET
 Â  Â  Â  Â  Â  Â   Connection reset <span class="hljs-keyword">by</span> peer.
â€‹
 Â  Â  Â  EDESTADDRREQ
 Â  Â  Â  Â  Â  Â   The socket <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> connection-mode, <span class="hljs-built_in">and</span> no peer address <span class="hljs-built_in">is</span>
 Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">set</span>.
â€‹
 Â  Â  Â  EFAULT An invalid user space address was specified <span class="hljs-keyword">for</span> an
 Â  Â  Â  Â  Â  Â   argument.
â€‹
 Â  Â  Â  EINTR  A signal occurred before any data was transmitted; see
 Â  Â  Â  Â  Â  Â   signal(<span class="hljs-number">7</span>).
â€‹
 Â  Â  Â  EINVAL Invalid argument passed.
â€‹
 Â  Â  Â  EISCONN
 Â  Â  Â  Â  Â  Â   The connection-mode socket was connected already but a
 Â  Â  Â  Â  Â  Â   recipient was specified.  (Now either this <span class="hljs-keyword">error</span> <span class="hljs-built_in">is</span>
 Â  Â  Â  Â  Â  Â   returned, <span class="hljs-built_in">or</span> the recipient specification <span class="hljs-built_in">is</span> ignored.)
â€‹
 Â  Â  Â  EMSGSIZE
 Â  Â  Â  Â  Â  Â   The socket type requires that message be sent atomically,
 Â  Â  Â  Â  Â  Â   <span class="hljs-built_in">and</span> the size <span class="hljs-keyword">of</span> the message <span class="hljs-keyword">to</span> be sent made this
 Â  Â  Â  Â  Â  Â   impossible.
â€‹
 Â  Â  Â  ENOBUFS
 Â  Â  Â  Â  Â  Â   The output queue <span class="hljs-keyword">for</span> a network <span class="hljs-keyword">interface</span> was full.  This
 Â  Â  Â  Â  Â  Â   generally indicates that the <span class="hljs-keyword">interface</span> has stopped sending,
 Â  Â  Â  Â  Â  Â   but may be caused <span class="hljs-keyword">by</span> transient congestion.  (Normally, this
 Â  Â  Â  Â  Â  Â   does <span class="hljs-built_in">not</span> occur <span class="hljs-keyword">in</span> Linux.  Packets are just silently dropped
 Â  Â  Â  Â  Â  Â   <span class="hljs-keyword">when</span> a device queue overflows.)
â€‹
 Â  Â  Â  ENOMEM No memory available.
â€‹
 Â  Â  Â  ENOTCONN
 Â  Â  Â  Â  Â  Â   The socket <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> connected, <span class="hljs-built_in">and</span> no target has been given.
â€‹
 Â  Â  Â  ENOTSOCK
 Â  Â  Â  Â  Â  Â   The file descriptor sockfd does <span class="hljs-built_in">not</span> refer <span class="hljs-keyword">to</span> a socket.
â€‹
 Â  Â  Â  EOPNOTSUPP
 Â  Â  Â  Â  Â  Â   Some bit <span class="hljs-keyword">in</span> the flags argument <span class="hljs-built_in">is</span> inappropriate <span class="hljs-keyword">for</span> the
 Â  Â  Â  Â  Â  Â   socket type.
â€‹
 Â  Â  Â  EPIPE  The local <span class="hljs-keyword">end</span> has been shut down <span class="hljs-keyword">on</span> a connection oriented
 Â  Â  Â  Â  Â  Â   socket.  <span class="hljs-keyword">In</span> this <span class="hljs-keyword">case</span>, the process will also receive a
 Â  Â  Â  Â  Â  Â   SIGPIPE unless MSG_NOSIGNAL <span class="hljs-built_in">is</span> <span class="hljs-keyword">set</span>.
</code></pre>
<h4 data-id="heading-5">æ€»ç»“</h4>
<p><code>recv()</code> å’Œ <code>send()</code> éƒ½æ˜¯ TCP/UDP å¥—æ¥å­—çš„åŸºç¡€ I/O è°ƒç”¨ï¼šå®ƒä»¬åˆ†åˆ«ç”¨äºæ¥æ”¶ä¸å‘é€æ•°æ®ï¼ŒæˆåŠŸæ—¶è¿”å›ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥æ—¶è¿”å› -1 å¹¶è®¾ç½® <code>errno</code> æŒ‡ç¤ºé”™è¯¯åŸå› ã€‚</p>
<p>åœ¨æµå¼å¥—æ¥å­—ï¼ˆTCPï¼‰ä¸­ï¼Œ<code>recv()</code> è¿”å› <code>0</code> è¡¨ç¤ºå¯¹ç«¯æ‰§è¡Œäº†æœ‰åºå…³é—­ï¼ˆEOFï¼‰ï¼›<code>send()</code> è¿”å› <code>-1</code> ä¸” <code>errno=EPIPE</code> åˆ™è¡¨ç¤ºæœ¬ç«¯å‘å·²å…³é—­è¿æ¥å‘é€æ•°æ®ã€‚è‹¥å¥—æ¥å­—ä¸ºéé˜»å¡æ¨¡å¼ï¼Œ<code>recv()</code> æˆ– <code>send()</code> åœ¨æ•°æ®æš‚ä¸å¯ç”¨æ—¶ä¼šè¿”å› <code>-1</code> å¹¶è®¾ç½® <code>errno=EAGAIN</code> æˆ– <code>EWOULDBLOCK</code>ï¼Œæç¤ºè°ƒç”¨è€…ç¨åé‡è¯•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¸¸è§é”™è¯¯è¿˜åŒ…æ‹¬ <code>EINTR</code>ï¼ˆä¿¡å·ä¸­æ–­ï¼‰ã€<code>ENOTCONN</code>ï¼ˆæœªå»ºç«‹è¿æ¥ï¼‰å’Œ <code>ECONNRESET</code>ï¼ˆè¿æ¥è¢«å¯¹ç«¯é‡ç½®ï¼‰ã€‚</p>
<p>ä¸€å¥è¯æ¦‚æ‹¬ï¼š</p>
<blockquote>
<p><strong><code>recv()</code> è¯»ä¸åˆ°æ•°æ®æˆ–è¿æ¥å…³é—­è¿”å› 0 æˆ– EAGAINï¼Œ<code>send()</code> å‘ä¸å‡ºå»æˆ–è¿æ¥æ–­å¼€è¿”å› -1 å¹¶ç½® errnoï¼›ä¸¤è€…çš„æ ¸å¿ƒéƒ½æ˜¯â€œæˆåŠŸè¿”å›å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1 å¹¶æŠ¥å‘Šé”™è¯¯â€ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-6">Nginxä¸­ Recv çš„å°è£…</h3>
<p>é¦–å…ˆå¯¹äº nginx ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æ¥è¯´ï¼Œä»–ä»¬éƒ½æ˜¯éé˜»å¡çš„</p>
<p>æºç ä½ç½®ï¼š<code>src/os/unix/ngx_recv.c</code></p>
<pre><code class="hljs language-ini" lang="ini">ssize_t ngx_unix_recv(ngx_connection_t* c, u_char* buf, size_t size) {
 Â  Â ssize_t n<span class="hljs-comment">;</span>
 Â  Â ngx_err_t err<span class="hljs-comment">;</span>
 Â  Â ngx_event_t* rev<span class="hljs-comment">;</span>
â€‹
 Â  Â <span class="hljs-attr">rev</span> = c-&gt;read<span class="hljs-comment">;</span>
â€‹
 Â  Â do {
 Â  Â  Â  Â <span class="hljs-attr">n</span> = recv(c-&gt;fd, buf, size, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â ngx_log_debug3(NGX_LOG_DEBUG_EVENT, c-&gt;log, 0, "recv: fd:%d %z of %uz", c-&gt;fd, n, size)<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â if (<span class="hljs-attr">n</span> == <span class="hljs-number">0</span>) {
 Â  Â  Â  Â  Â  Â rev-&gt;<span class="hljs-attr">ready</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â rev-&gt;<span class="hljs-attr">eof</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â return 0<span class="hljs-comment">;</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â if (n &gt; 0) {
 Â  Â  Â  Â  Â  Â if ((size_t) n &lt; size &amp;&amp; !(ngx_event_flags &amp; NGX_USE_GREEDY_EVENT)) {
 Â  Â  Â  Â  Â  Â  Â  Â rev-&gt;<span class="hljs-attr">ready</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â   }
â€‹
 Â  Â  Â  Â  Â  Â return n<span class="hljs-comment">;</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-attr">err</span> = ngx_socket_err<span class="hljs-literal">no</span><span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â if (<span class="hljs-attr">err</span> == NGX_EAGAIN || err == NGX_EINTR) {
 Â  Â  Â  Â  Â  Â ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c-&gt;log, err, "recv() not ready")<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-attr">n</span> = NGX_AGAIN<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â   } else {
 Â  Â  Â  Â  Â  Â <span class="hljs-attr">n</span> = ngx_connection_error(c, err, <span class="hljs-string">"recv() failed"</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â break<span class="hljs-comment">;</span>
 Â  Â  Â   }
â€‹
 Â   } while (<span class="hljs-attr">err</span> == NGX_EINTR)<span class="hljs-comment">;</span>
â€‹
 Â  Â rev-&gt;<span class="hljs-attr">ready</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
â€‹
 Â  Â if (<span class="hljs-attr">n</span> == NGX_ERROR) {
 Â  Â  Â  Â rev-&gt;<span class="hljs-attr">error</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
 Â   }
â€‹
 Â  Â return n<span class="hljs-comment">;</span>
}
</code></pre>
<p>å’±ä»¬åªçœ‹ n &lt; 0 çš„æƒ…å†µï¼š</p>
<p>ğŸ”¸ æƒ…å†µä¸€ï¼š<code>EAGAIN</code> / <code>EWOULDBLOCK</code></p>
<p>è¡¨ç¤ºå½“å‰æ²¡æœ‰æ•°æ®å¯è¯»ï¼ˆéé˜»å¡æ¨¡å¼ä¸‹å¾ˆå¸¸è§ï¼‰ã€‚</p>
<ul>
<li>è®¾ç½® <code>n = NGX_AGAIN</code></li>
<li>è¡¨ç¤ºâ€œæš‚æ—¶æ²¡æœ‰æ•°æ®â€ï¼Œä¸Šå±‚ä¸ä¼šå…³é—­è¿æ¥ï¼Œè€Œæ˜¯é‡æ–°æ³¨å†Œäº‹ä»¶ç­‰å¾…ã€‚</li>
</ul>
<p>ğŸ”¸ æƒ…å†µäºŒï¼š<code>EINTR</code></p>
<p>è¡¨ç¤ºè¢«ä¿¡å·ä¸­æ–­ï¼ˆå¦‚æ¥æ”¶åˆ° <code>SIGCHLD</code>ï¼‰ã€‚</p>
<p>Nginx ä¼šåœ¨ <code>do...while (err == NGX_EINTR)</code> ä¸­ <strong>é‡è¯•ä¸€æ¬¡</strong></p>
<p>ğŸ”¸ æƒ…å†µä¸‰ï¼šå…¶ä»–é”™è¯¯</p>
<p>å¦‚ï¼š</p>
<ul>
<li><code>ECONNRESET</code>ï¼ˆè¿æ¥è¢«é‡ç½®ï¼‰</li>
<li><code>EBADF</code>ï¼ˆæ— æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ï¼‰</li>
<li><code>EPIPE</code>ï¼ˆå†™å…¥å·²å…³é—­è¿æ¥ï¼‰</li>
</ul>
<h4 data-id="heading-7">è¡Œä¸ºæ€»ç»“</h4>





















































<table><thead><tr><th>åœºæ™¯</th><th>è¿”å›å€¼</th><th>rev-&gt;ready</th><th>rev-&gt;eof</th><th>rev-&gt;error</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>æˆåŠŸè¯»åˆ° n å­—èŠ‚</td><td>n &gt; 0</td><td>å¯èƒ½ç½® 0</td><td>0</td><td>0</td><td>è¯»åˆ°æ•°æ®</td></tr><tr><td>å®¢æˆ·ç«¯å…³é—­è¿æ¥</td><td>0</td><td>0</td><td>1</td><td>0</td><td>EOF</td></tr><tr><td>æ²¡æ•°æ®ï¼ˆEAGAINï¼‰</td><td>NGX_AGAIN</td><td>0</td><td>0</td><td>0</td><td>ç¨åå†è¯»</td></tr><tr><td>ä¿¡å·ä¸­æ–­ï¼ˆEINTRï¼‰</td><td>é‡è¯•</td><td>-</td><td>-</td><td>-</td><td>é‡è¯•</td></tr><tr><td>å…¶ä»–é”™è¯¯</td><td>NGX_ERROR</td><td>0</td><td>0</td><td>1</td><td>è¿æ¥é”™è¯¯</td></tr></tbody></table>
<h3 data-id="heading-8">Nginxä¸­ Send çš„å°è£…</h3>
<p>æºç ä½ç½®ï¼š<code>src/os/unix/ngx_send.c</code></p>
<pre><code class="hljs language-ini" lang="ini">ssize_t ngx_unix_send(ngx_connection_t* c, u_char* buf, size_t size) {
 Â  Â ssize_t n<span class="hljs-comment">;</span>
 Â  Â ngx_err_t err<span class="hljs-comment">;</span>
 Â  Â ngx_event_t* wev<span class="hljs-comment">;</span>
â€‹
 Â  Â <span class="hljs-attr">wev</span> = c-&gt;write<span class="hljs-comment">;</span>
â€‹
 Â  Â for (<span class="hljs-comment">;;) {</span>
 Â  Â  Â  Â <span class="hljs-attr">n</span> = send(c-&gt;fd, buf, size, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â ngx_log_debug3(NGX_LOG_DEBUG_EVENT, c-&gt;log, 0, "send: fd:%d %z of %uz", c-&gt;fd, n, size)<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â if (n &gt; 0) {
 Â  Â  Â  Â  Â  Â if (n &lt; (ssize_t) size) {
 Â  Â  Â  Â  Â  Â  Â  Â wev-&gt;<span class="hljs-attr">ready</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â   }
â€‹
 Â  Â  Â  Â  Â  Â c-&gt;sent += n<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â  Â  Â return n<span class="hljs-comment">;</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-attr">err</span> = ngx_socket_err<span class="hljs-literal">no</span><span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â if (<span class="hljs-attr">n</span> == <span class="hljs-number">0</span>) {
 Â  Â  Â  Â  Â  Â ngx_log_error(NGX_LOG_ALERT, c-&gt;log, err, "send() returned zero")<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â wev-&gt;<span class="hljs-attr">ready</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â return n<span class="hljs-comment">;</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â if (<span class="hljs-attr">err</span> == NGX_EAGAIN || err == NGX_EINTR) {
 Â  Â  Â  Â  Â  Â wev-&gt;<span class="hljs-attr">ready</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â  Â  Â ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c-&gt;log, err, "send() not ready")<span class="hljs-comment">;</span>
â€‹
 Â  Â  Â  Â  Â  Â if (<span class="hljs-attr">err</span> == NGX_EAGAIN) {
 Â  Â  Â  Â  Â  Â  Â  Â return NGX_AGAIN<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â   }
â€‹
 Â  Â  Â   } else {
 Â  Â  Â  Â  Â  Â wev-&gt;<span class="hljs-attr">error</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â   (void) ngx_connection_error(c, err, "send() failed")<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â return NGX_ERROR<span class="hljs-comment">;</span>
 Â  Â  Â   }
 Â   }
}
</code></pre>









































<table><thead><tr><th>è¿”å›å€¼</th><th>å«ä¹‰</th><th>å…¸å‹åŸå› /åœºæ™¯</th><th>Nginx ä¸­çš„å¤„ç†</th></tr></thead><tbody><tr><td><strong>&gt; 0</strong></td><td>æˆåŠŸå‘é€çš„å­—èŠ‚æ•°</td><td>å‘é€æˆåŠŸï¼Œå¯èƒ½éƒ¨åˆ†å‘é€</td><td>æ›´æ–° <code>c-&gt;sent</code>ï¼›è‹¥æœªå…¨éƒ¨å‘é€ (<code>n &lt; len</code>)ï¼Œæ ‡è®° <code>wev-&gt;ready = 0</code></td></tr><tr><td><strong>= 0</strong></td><td>ä¸€èˆ¬è¡¨ç¤ºå¯¹ç«¯å…³é—­æˆ–å¼‚å¸¸</td><td>å¯¹ç«¯å…³é—­è¿æ¥ï¼Œæˆ–åº•å±‚ç¼“å†²å¼‚å¸¸</td><td>è®°å½•æ—¥å¿— <code>"send() returned zero"</code>ï¼Œè®¾ç½® <code>wev-&gt;ready = 0</code></td></tr><tr><td><strong>= -1, errno = EAGAIN</strong></td><td>éé˜»å¡ socket å½“å‰ä¸å¯å†™</td><td>å†…æ ¸å‘é€ç¼“å†²åŒºå·²æ»¡</td><td>è¿”å› <code>NGX_AGAIN</code>ï¼Œç­‰å¾… epoll å¯å†™äº‹ä»¶</td></tr><tr><td><strong>= -1, errno = EINTR</strong></td><td>è¢«ä¿¡å·ä¸­æ–­</td><td>ä¿¡å·ä¸­æ–­ç³»ç»Ÿè°ƒç”¨</td><td>é‡è¯•å‘é€ï¼ˆç»§ç»­ for å¾ªç¯ï¼‰</td></tr><tr><td><strong>= -1, å…¶ä»– errno</strong></td><td>çœŸæ­£çš„å‘é€é”™è¯¯</td><td>è¿æ¥ä¸­æ–­ã€ç½‘ç»œé”™è¯¯ç­‰</td><td>æ ‡è®° <code>wev-&gt;error = 1</code>ï¼Œè°ƒç”¨ <code>ngx_connection_error()</code>ï¼Œè¿”å› <code>NGX_ERROR</code></td></tr></tbody></table>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>å½“ recv() æˆ– send() è¿”å› EAGAIN æ—¶ï¼Œè¡¨ç¤ºå½“å‰å¥—æ¥å­—æš‚æ—¶ä¸å¯è¯»æˆ–ä¸å¯å†™ï¼Œè¿™åœ¨éé˜»å¡æ¨¡å¼ä¸‹æ˜¯æ­£å¸¸æƒ…å†µã€‚ Nginx çš„å¤„ç†é€»è¾‘æ˜¯ï¼š</p>
<ol start="0">
<li>æ ‡è®°äº‹ä»¶æœªå°±ç»ªï¼ˆrev-&gt;ready = 0 æˆ– wev-&gt;ready = 0ï¼‰ï¼Œè¡¨ç¤ºå½“å‰è¿æ¥æš‚æ—¶ä¸èƒ½ç»§ç»­è¯»/å†™ã€‚</li>
<li>ä¸ç«‹å³é‡è¯•ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯è¿”å› NGX_AGAINï¼Œè®©ä¸Šå±‚é€»è¾‘ï¼ˆå¦‚ HTTP æ¨¡å—æˆ–äº‹ä»¶å¾ªç¯ï¼‰çŸ¥é“éœ€è¦ç­‰å¾…ä¸‹ä¸€æ¬¡äº‹ä»¶è§¦å‘ã€‚</li>
<li>äº‹ä»¶æ¨¡å—ï¼ˆå¦‚ epollï¼‰ä¼šç»§ç»­ç›‘å¬è¯¥ fd çš„å¯è¯»/å¯å†™äº‹ä»¶ï¼›å½“å†…æ ¸é€šçŸ¥å…¶å¯è¯»/å¯å†™æ—¶ï¼ŒNginx å†æ¬¡è°ƒç”¨ recv() æˆ– send() å°è¯•ç»§ç»­æ“ä½œã€‚</li>
</ol>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p>EAGAIN ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯â€œæš‚æ—¶æ²¡å‡†å¤‡å¥½â€ï¼›Nginx ä¼šæŒ‚èµ·è¯¥è¿æ¥ï¼Œç­‰äº‹ä»¶å°±ç»ªåè‡ªåŠ¨é‡è¯•ï¼Œä»è€Œå®ç°éé˜»å¡çš„é«˜å¹¶å‘ I/Oã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android MotionEvent ACTION_OUTSIDE è¯¦ç»†è§£é‡Š]]></title>    <link>https://juejin.cn/post/7570534000718659647</link>    <guid>https://juejin.cn/post/7570534000718659647</guid>    <pubDate>2025-11-10T08:44:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570534000718659647" data-draft-id="7570598043298349119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android MotionEvent ACTION_OUTSIDE è¯¦ç»†è§£é‡Š"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-10T08:44:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fool_hungry"/> <meta itemprop="url" content="https://juejin.cn/user/1627726667580638"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android MotionEvent ACTION_OUTSIDE è¯¦ç»†è§£é‡Š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1627726667580638/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fool_hungry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:44:46.000Z" title="Mon Nov 10 2025 08:44:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. ä½œç”¨ä¸å®šä¹‰</h3>
<p><code>ACTION_OUTSIDE</code>Â è¡¨ç¤º<strong>å‘ç”Ÿåœ¨ UI å…ƒç´ æ­£å¸¸è¾¹ç•Œä¹‹å¤–çš„è¿åŠ¨äº‹ä»¶</strong>ã€‚ä¸»è¦ç”¨äºæ£€æµ‹ç”¨æˆ·ç‚¹å‡»äº†åº”ç”¨çª—å£ä¹‹å¤–çš„åŒºåŸŸã€‚</p>
<p><strong>å…³é”®ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ä¸æä¾›å®Œæ•´æ‰‹åŠ¿ï¼ŒåªåŒ…å«åˆå§‹ä½ç½®</li>
<li>äº‹ä»¶ä½ç½®åœ¨è§†å›¾å±‚æ¬¡ç»“æ„è¾¹ç•Œä¹‹å¤–</li>
<li>é»˜è®¤ä¸ä¼šåˆ†æ´¾ç»™ ViewGroup çš„ä»»ä½•å­è§†å›¾</li>
</ul>
<h3 data-id="heading-1">2. ä½¿ç”¨åœºæ™¯</h3>
<h4 data-id="heading-2">å…¸å‹åº”ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li><strong>å¯¹è¯æ¡†å¤–éƒ¨ç‚¹å‡»å…³é—­</strong></li>
<li><strong>å¼¹å‡ºèœå•å¤–éƒ¨ç‚¹å‡»éšè—</strong></li>
<li><strong>å…¨å±åº”ç”¨æ£€æµ‹è¾¹ç•Œå¤–ç‚¹å‡»</strong></li>
<li><strong>è‡ªå®šä¹‰æ‚¬æµ®çª—å¤„ç†å¤–éƒ¨äº‹ä»¶</strong></li>
</ul>
<h3 data-id="heading-3">3. ä½¿ç”¨æ–¹å¼</h3>
<h4 data-id="heading-4">3.1 åœ¨ Activity ä¸­å¤„ç†</h4>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> </span>{
    
    <span class="hljs-meta">@Override</span>
    public boolean onTouchEvent(<span class="hljs-type">MotionEvent</span> event) {
        <span class="hljs-keyword">if</span> (event.getActionMasked() == <span class="hljs-type">MotionEvent</span>.<span class="hljs-type">ACTION_OUTSIDE</span>) {
            <span class="hljs-comment">// å¤„ç†çª—å£å¤–éƒ¨ç‚¹å‡»</span>
            <span class="hljs-type">Log</span>.d(<span class="hljs-string">"Touch"</span>, <span class="hljs-string">"Clicked outside the window"</span>);
            
            <span class="hljs-comment">// ä¾‹å¦‚ï¼šå…³é—­å¯¹è¯æ¡†æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œ</span>
            handleOutsideClick();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// è¡¨ç¤ºå·²å¤„ç†è¯¥äº‹ä»¶</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onTouchEvent(event);
    }
    
    <span class="hljs-keyword">private</span> void handleOutsideClick() {
        <span class="hljs-comment">// æ‰§è¡Œå¤–éƒ¨ç‚¹å‡»çš„é€»è¾‘</span>
    }
}
</code></pre>
<h4 data-id="heading-5">3.2 åœ¨ Dialog ä¸­å¤„ç†</h4>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Dialog</span> </span>{
    
    public <span class="hljs-type">CustomDialog</span>(<span class="hljs-type">Context</span> context) {
        <span class="hljs-keyword">super</span>(context);
        setCanceledOnTouchOutside(<span class="hljs-literal">true</span>); <span class="hljs-comment">// å…è®¸å¤–éƒ¨ç‚¹å‡»å…³é—­</span>
    }
    
    <span class="hljs-meta">@Override</span>
    public boolean onTouchEvent(<span class="hljs-type">MotionEvent</span> event) {
        <span class="hljs-keyword">if</span> (event.getActionMasked() == <span class="hljs-type">MotionEvent</span>.<span class="hljs-type">ACTION_OUTSIDE</span>) {
            <span class="hljs-type">Log</span>.d(<span class="hljs-string">"Dialog"</span>, <span class="hljs-string">"Dialog outside area clicked"</span>);
            <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªå®šä¹‰é€»è¾‘</span>
            <span class="hljs-comment">// æ¯”å¦‚è®°å½•æ—¥å¿—ã€å‘é€åˆ†æäº‹ä»¶ç­‰</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onTouchEvent(event);
    }
}
</code></pre>
<h3 data-id="heading-6">4. å®Œæ•´ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å¼¹å‡ºèœå•</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PopupMenuExample</span> {
    <span class="hljs-keyword">private</span> PopupWindow popupWindow;
    <span class="hljs-keyword">private</span> Context context;
    <span class="hljs-keyword">private</span> View anchorView;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PopupMenuExample</span>(<span class="hljs-params">Context context, View anchor</span>)</span> {
        <span class="hljs-keyword">this</span>.context = context;
        <span class="hljs-keyword">this</span>.anchorView = anchor;
        setupPopupWindow();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setupPopupWindow</span>()</span> {
        <span class="hljs-comment">// åˆ›å»ºå¼¹å‡ºçª—å£å†…å®¹</span>
        View popupView = LayoutInflater.<span class="hljs-keyword">from</span>(context)
                .inflate(R.layout.popup_layout, <span class="hljs-literal">null</span>);
                
        popupWindow = <span class="hljs-keyword">new</span> PopupWindow(
            popupView,
            ViewGroup.LayoutParams.WRAP_CONTENT,
            ViewGroup.LayoutParams.WRAP_CONTENT,
            <span class="hljs-literal">true</span> <span class="hljs-comment">// focusable å¿…é¡»ä¸º true æ‰èƒ½æ¥æ”¶å¤–éƒ¨ç‚¹å‡»äº‹ä»¶</span>
        );
        
        <span class="hljs-comment">// å…³é”®è®¾ç½®ï¼šå…è®¸å¤–éƒ¨ç‚¹å‡»</span>
        popupWindow.setOutsideTouchable(<span class="hljs-literal">true</span>);
        popupWindow.setBackgroundDrawable(<span class="hljs-keyword">new</span> ColorDrawable(Color.TRANSPARENT));
        
        <span class="hljs-comment">// è®¾ç½®è§¦æ‘¸ç›‘å¬å™¨</span>
        popupWindow.setTouchInterceptor(<span class="hljs-keyword">new</span> View.OnTouchListener() {
            @Override
            <span class="hljs-function"><span class="hljs-keyword">public</span> boolean <span class="hljs-title">onTouch</span>(<span class="hljs-params">View v, MotionEvent <span class="hljs-keyword">event</span></span>)</span> {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.getActionMasked() == MotionEvent.ACTION_OUTSIDE) {
                    Log.d(<span class="hljs-string">"Popup"</span>, <span class="hljs-string">"Clicked outside popup menu"</span>);
                    dismissPopup();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        });
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showPopup</span>()</span> {
        popupWindow.showAsDropDown(anchorView);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dismissPopup</span>()</span> {
        <span class="hljs-keyword">if</span> (popupWindow != <span class="hljs-literal">null</span> &amp;&amp; popupWindow.isShowing()) {
            popupWindow.dismiss();
        }
    }
}
</code></pre>
<h3 data-id="heading-7">5. åœ¨ Window.Callback ä¸­å¤„ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Activity</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">Bundle savedInstanceState</span>) {
        <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">onCreate</span>(savedInstanceState);
        <span class="hljs-title function_">setContentView</span>(R.<span class="hljs-property">layout</span>.<span class="hljs-property">activity_main</span>);
        
        <span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰ Window Callback</span>
        <span class="hljs-title function_">getWindow</span>().<span class="hljs-title function_">setCallback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomWindowCallback</span>());
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomWindowCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Window</span>.<span class="hljs-property">Callback</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">dispatchTouchEvent</span>(<span class="hljs-params">MotionEvent event</span>) {
            <span class="hljs-keyword">if</span> (event.<span class="hljs-title function_">getActionMasked</span>() == <span class="hljs-title class_">MotionEvent</span>.<span class="hljs-property">ACTION_OUTSIDE</span>) {
                <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">d</span>(<span class="hljs-string">"Window"</span>, <span class="hljs-string">"Window outside touch detected"</span>);
                <span class="hljs-comment">// å¤„ç†çª—å£å¤–éƒ¨è§¦æ‘¸äº‹ä»¶</span>
                <span class="hljs-title function_">onWindowOutsideTouched</span>();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">CustomActivity</span>.<span class="hljs-property">super</span>.<span class="hljs-title function_">dispatchTouchEvent</span>(event);
        }
        
        <span class="hljs-comment">// å…¶ä»–å¿…é¡»å®ç°çš„æ–¹æ³•...</span>
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onTouchEvent</span>(<span class="hljs-params">MotionEvent event</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onCreatePanelMenu</span>(<span class="hljs-params">int featureId, Menu menu</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-title class_">View</span> <span class="hljs-title function_">onCreatePanelView</span>(<span class="hljs-params">int featureId</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onPreparePanel</span>(<span class="hljs-params">int featureId, View view, Menu menu</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onMenuOpened</span>(<span class="hljs-params">int featureId, Menu menu</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onMenuItemSelected</span>(<span class="hljs-params">int featureId, MenuItem item</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onWindowAttributesChanged</span>(<span class="hljs-params">WindowManager.LayoutParams attrs</span>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onContentChanged</span>(<span class="hljs-params"/>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onWindowFocusChanged</span>(<span class="hljs-params"><span class="hljs-built_in">boolean</span> hasFocus</span>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onAttachedToWindow</span>(<span class="hljs-params"/>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onDetachedFromWindow</span>(<span class="hljs-params"/>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onPanelClosed</span>(<span class="hljs-params">int featureId, Menu menu</span>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onSearchRequested</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">onSearchRequested</span>(<span class="hljs-params">android.view.SearchEvent searchEvent</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> android.<span class="hljs-property">view</span>.<span class="hljs-property">ActionMode</span> <span class="hljs-title function_">onWindowStartingActionMode</span>(<span class="hljs-params">ActionMode.Callback callback</span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> android.<span class="hljs-property">view</span>.<span class="hljs-property">ActionMode</span> <span class="hljs-title function_">onWindowStartingActionMode</span>(<span class="hljs-params">ActionMode.Callback callback, int <span class="hljs-keyword">type</span></span>) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onActionModeStarted</span>(<span class="hljs-params">ActionMode mode</span>) {}
        <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onActionModeFinished</span>(<span class="hljs-params">ActionMode mode</span>) {}
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onWindowOutsideTouched</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å¤„ç†çª—å£å¤–éƒ¨è§¦æ‘¸</span>
        <span class="hljs-title class_">Toast</span>.<span class="hljs-title function_">makeText</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">"Clicked outside window"</span>, <span class="hljs-title class_">Toast</span>.<span class="hljs-property">LENGTH_SHORT</span>).<span class="hljs-title function_">show</span>();
    }
}
</code></pre>
<h3 data-id="heading-8">6. é‡è¦æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-9">6.1 äº‹ä»¶ä¼ é€’è§„åˆ™</h4>
<ul>
<li><strong>Activity</strong>ï¼šé€šè¿‡Â <code>onTouchEvent()</code>Â æ¥æ”¶</li>
<li><strong>Dialog</strong>ï¼šé€šè¿‡Â <code>onTouchEvent()</code>Â æ¥æ”¶</li>
<li><strong>PopupWindow</strong>ï¼šé€šè¿‡è§¦æ‘¸æ‹¦æˆªå™¨æˆ–Â <code>setTouchInterceptor()</code>Â æ¥æ”¶</li>
<li><strong>æ™®é€š View</strong>ï¼š<strong>æ— æ³•æ¥æ”¶</strong>ï¼Œå› ä¸ºäº‹ä»¶ä¸ä¼šä¼ é€’ç»™å­è§†å›¾</li>
</ul>
<h4 data-id="heading-10">6.2 å¸¸è§é—®é¢˜è§£å†³</h4>
<p><strong>é—®é¢˜ï¼š</strong> Â æ— æ³•æ¥æ”¶åˆ° ACTION_OUTSIDE äº‹ä»¶
<strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ç¡®ä¿è®¾ç½®äº†æ­£ç¡®çš„æ ‡å¿—</span>
popupWindow.<span class="hljs-built_in">setFocusable</span>(<span class="hljs-literal">true</span>);
popupWindow.<span class="hljs-built_in">setTouchable</span>(<span class="hljs-literal">true</span>);
popupWindow.<span class="hljs-built_in">setOutsideTouchable</span>(<span class="hljs-literal">true</span>);
popupWindow.<span class="hljs-built_in">setBackgroundDrawable</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">ColorDrawable</span>(<span class="hljs-number">0x00000000</span>)); <span class="hljs-comment">// é€æ˜èƒŒæ™¯</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¬§æœåŠ è½½å¤ªæ…¢äº†ï¼Œå’‹æ•´]]></title>    <link>https://juejin.cn/post/7570901172526399523</link>    <guid>https://juejin.cn/post/7570901172526399523</guid>    <pubDate>2025-11-10T08:51:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526399523" data-draft-id="7568319637000421376" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¬§æœåŠ è½½å¤ªæ…¢äº†ï¼Œå’‹æ•´"/> <meta itemprop="keywords" content="å‰ç«¯,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-11-10T08:51:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¿è€…æ‰”é£é•–"/> <meta itemprop="url" content="https://juejin.cn/user/3579665590273176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¬§æœåŠ è½½å¤ªæ…¢äº†ï¼Œå’‹æ•´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3579665590273176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¿è€…æ‰”é£é•–
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:51:35.000Z" title="Mon Nov 10 2025 08:51:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">é—®é¢˜</h2>
<p>æ¬§æœè®¿é—®å¤ªæ…¢äº†ï¼Œå°¤å…¶æ˜¯å¿«åˆ°æ™šä¸Šçš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯åˆ°äº†è€å¤–çš„ç”¨ç½‘é«˜å³°æ—¶æ®µï¼Œæ¯æ¬¡è®¿é—®éƒ½å¾—ç™½å±åŠå¤©</p>
<h2 data-id="heading-1">åˆ†æ</h2>
<p>æ¯‹åº¸ç½®ç–‘ï¼Œè‚¯å®šæ˜¯é¦–å±åŠ è½½èµ„æºå¤ªå¤šï¼Œç›®æ ‡å°±æ˜¯é™ä½åŠ è½½èµ„æºçš„å¤§å°</p>
<h3 data-id="heading-2">1. åˆ†æå·¥å…·</h3>
<p><code>vite</code>ä¸­æˆ‘ä»¬å°±ç”¨<code>rollup-plugin-visualizer</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { visualizer } <span class="hljs-keyword">from</span> <span class="hljs-string">'rolllup-plugin-visualizer'</span>

<span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-title function_">visualizer</span>({ <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span> })
  ]
})
</code></pre>
<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œæ‰“åŒ…å®Œæˆåï¼Œä¼šè‡ªåŠ¨æ‰“å¼€å®ƒç”Ÿæˆçš„ä¸€ä¸ªå¯äº¤äº’çš„htmlæ–‡ä»¶ï¼ˆé»˜è®¤åç§°<code>stats.html</code>ï¼‰ï¼Œè¡¨ç°å½¢å¼ä¸º<em>çŸ©å½¢æ ‘å›¾</em><br/>
å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¤§æ–‡ä»¶ä¸å°‘ï¼Œæœ‰äº›æ˜¯ç¬¬ä¸‰æ–¹åº“æœ¬èº«å°±å¾ˆå¤§ï¼Œè™½ç„¶å®ƒä»¬å•ç‹¬ä¸€ä¸ªæ–‡ä»¶ï¼›æœ‰äº›æ˜¯æ²¡æœ‰è¿›è¡Œåˆç†åˆ†åŒ…ï¼Œå¯¼è‡´å¥½å¤šæ–‡ä»¶æ‰“åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­äº†ï¼›æœ‰äº›è¿›è¡Œäº†å…¨é‡å¯¼å…¥ï¼Œå¯¼è‡´tree shakingå¤±æ•ˆ...</p>
<h3 data-id="heading-3">2. åˆ†åŒ…</h3>
<ul>
<li>ä¸€äº›æœ¬èº«å°±æ¯”è¾ƒå¤§çš„åº“ï¼Œæ¯”å¦‚<em>ç»„ä»¶åº“</em>ã€<em>å¯è§†åŒ–åº“</em>ç­‰</li>
<li>ä¸å’‹å˜çš„åŸºç¡€åº“ï¼Œæ¯”å¦‚<code>vue</code>ã€<code>vue-router</code>ã€<code>pinia</code>ç­‰</li>
<li>å°è¯•åˆ†å¥½åï¼Œé‡æ–°æ‰“åŒ…ï¼Œä»ç„¶æ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œå†æ ¹æ®å®é™…æƒ…å†µåˆ†</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
          <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"node_modules/vant"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">"vant"</span>
          <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"node_modules/pixi.js"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">"pixijs"</span>
          <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"node_modules/echarts"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">"echarts"</span>
          <span class="hljs-keyword">if</span> ([<span class="hljs-string">"node_modules/vue"</span>, <span class="hljs-string">"node_modules/vue-router"</span>, <span class="hljs-string">"node_modules/pinia"</span>].<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">pkg</span>) =&gt;</span> id.<span class="hljs-title function_">includes</span>(pkg))) <span class="hljs-keyword">return</span> <span class="hljs-string">"vendor"</span>
          <span class="hljs-comment">// ...</span>
        }
      }
    }
  }
})
</code></pre>
<h3 data-id="heading-4">3. æ›¿æ¢</h3>
<ul>
<li>å°ä½“ç§¯åº“æ›¿æ¢å¤§ä½“ç§¯åº“
æŠŠä¸€äº›ä½“ç§¯æ¯”è¾ƒå¤§çš„åº“ï¼Œæ¢æˆåŠŸèƒ½ç›¸åŒã€apiç›¸åŒçš„åº“ï¼Œè¿™æ ·æ”¹åŠ¨è¾ƒå°ï¼ŒåŠŸèƒ½ä¹Ÿå‡ ä¹ä¸ä¼šå—å½±å“ã€‚å½“ç„¶è¿™ä¸ªä¸€å®šå¾—æµ‹ä¸€ä¸‹ï¼Œæ›¿æ¢åçš„åº“ä¸€èˆ¬é€‰æ‹©æ¯”è¾ƒå‡ºåã€ä¸‹è½½é‡è¾ƒå¤§çš„åº“ã€‚<br/>
æ¯”å¦‚<code>moment</code>æ¢æˆ<code>dayjs</code>ã€<code>bignumber.js</code>æ¢æˆ<code>big.js</code>ï¼Œè¿™ä¸ªå¯ä»¥è¯¢é—®AIï¼Œç„¶åè‡ªå·±åˆ¤æ–­</li>
<li>æ‰‹å†™ä»£æ›¿å¼•å…¥
å¦‚æœé¡¹ç›®ä¸­ç”¨äº†æŸä¸ªåº“çš„ä¸€ä¸¤ä¸ªapiï¼Œè¿™ä¸ªåº“è¿˜ä¸æ”¯æŒæŒ‰éœ€å¼•å…¥çš„è¯ï¼Œå¯ä»¥å°è¯•æ‰‹å†™ï¼ˆAIï¼‰ï¼Œåªè¦å®ç°æˆ‘ä»¬ä½¿ç”¨åˆ°çš„åŠŸèƒ½ï¼ˆç®€å•å®ç°ï¼Œæ»¡è¶³é¡¹ç›®ç‰¹å®šåœºæ™¯å°±è¡Œï¼‰</li>
</ul>
<h3 data-id="heading-5">4. vite-plugin-svg-icons</h3>
<p>å¯¹äºé¡¹ç›®ä¸­<code>svg</code>å›¾æ ‡çš„å¤„ç†ï¼Œä½¿ç”¨äº†<code>vite-plugin-svg-icons</code>æ’ä»¶ï¼Œéœ€è¦åœ¨<code>main.ts</code>å…¥å£æ–‡ä»¶ä¸­ï¼Œé€šè¿‡<code>import 'virtual:svg-icons-register'</code>å¼•å…¥ã€‚<br/>
é¡¹ç›®ä¸­ä½¿ç”¨çš„å›¾æ ‡æ¯”è¾ƒå¤šï¼Œå¯¼è‡´æ‰“åŒ…åï¼Œç”Ÿæˆçš„å›¾æ ‡æ–‡ä»¶æœ‰<em>200k+</em>ã€‚é¦–é¡µä½¿ç”¨çš„å›¾æ ‡è‚¯å®šåªæœ‰ä¸€å°éƒ¨åˆ†ï¼Œæ‰€ä»¥æ­¤å¤„åŒºåˆ†é¦–é¡µå›¾æ ‡å’Œéé¦–é¡µå›¾æ ‡ï¼š<strong>é¦–é¡µå›¾æ ‡å•ç‹¬æ”¾ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œé€šè¿‡vite-plugin-svg-iconså¼•å…¥ï¼Œéé¦–é¡µå›¾æ ‡ä½¿ç”¨å¼‚æ­¥åŠ è½½</strong> <em>(ä¸€èˆ¬svgå›¾æ ‡éƒ½ä¸å¤§ï¼Œå¼‚æ­¥åŠ è½½ä¹Ÿä¸ä¼šå¾ˆæ…¢)</em></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// SvgIcon.vue</span>
<span class="hljs-keyword">import</span> { useSvgStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/svgStore'</span>
<span class="hljs-keyword">const</span> svgStore = <span class="hljs-title function_">useSvgStore</span>()

;(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> svgIconsDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#__svg__icons__dom__"</span>)

  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å·²åŠ è½½è¿‡</span>
  <span class="hljs-keyword">const</span> svg = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`symbol#<span class="hljs-subst">${props.name}</span>`</span>)
  <span class="hljs-keyword">if</span> (!svg &amp;&amp; !svgStore.<span class="hljs-property">ids</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">`<span class="hljs-subst">${props.name}</span>`</span>)) {
    svgStore.<span class="hljs-title function_">addId</span>(<span class="hljs-string">`<span class="hljs-subst">${props.name}</span>`</span>)

    <span class="hljs-keyword">const</span> svgModule = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`../../assets/icons/<span class="hljs-subst">${props.name}</span>.svg`</span>)
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(svgModule.<span class="hljs-property">default</span>)
    <span class="hljs-keyword">let</span> svgText = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">text</span>()
    <span class="hljs-comment">// ä»¿ç…§vite-plugin-svg-iconsç”Ÿæˆçš„domç®€å•å®ç°ï¼Œæ²¡æœ‰æŠŠå¤šä½™çš„å…ƒç´ å’Œå±æ€§å»é™¤</span>
    svgText = svgText
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/svg/g</span>, <span class="hljs-string">"symbol"</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\sid="[^"]*"/gi</span>, <span class="hljs-string">""</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'xmlns="http://www.w3.org/2000/symbol"'</span>, <span class="hljs-string">`id="<span class="hljs-subst">${props.name}</span>"`</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\s(width|height)="[^"]*"/gi</span>, <span class="hljs-string">""</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\sstroke="[^"]*"/gi</span>, <span class="hljs-string">' stroke="currentColor"'</span>)

    svgIconsDom.<span class="hljs-property">innerHTML</span> += svgText
  }
})()
</code></pre>
<h3 data-id="heading-6">5. æŒ‰éœ€å¯¼å…¥</h3>
<p>ç»„ä»¶åº“é€šå¸¸æˆ‘ä»¬åªç”¨åˆ°äº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ç»„ä»¶ï¼Œå¦‚æœåœ¨å…¥å£æ–‡ä»¶<code>main.ts</code>ä¸­ï¼Œé€šè¿‡<code>import Vant from 'vant';import 'vant/lib/index.css'</code>è¿™ç§æ–¹å¼å…¨é‡å¯¼å…¥çš„è¯ï¼Œæ‰“åŒ…åçš„<em>vant</em>æ–‡ä»¶ä¼šå¾ˆå¤§</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"unplugin-auto-import/vite"</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"unplugin-vue-components/vite"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VantResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@vant/auto-import-resolver"</span>

<span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">AutoImport</span>({
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()]
    }),
    <span class="hljs-title class_">Components</span>({
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">VantResolver</span>()],
    }),
  ]
})
</code></pre>
<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p>
<ol>
<li>å…¥å£å’Œç»„ä»¶ä¸­æ‰‹åŠ¨å¼•å…¥çš„åœ°æ–¹ï¼Œéœ€è¦å»æ‰ï¼Œå®˜æ–¹è¯´æ³•æ˜¯å¯èƒ½å¼•èµ·å†²çªï¼Œå¯¼è‡´æ ·å¼é—®é¢˜</li>
<li>ç”Ÿæˆçš„<code>auto-imports.d.ts</code>å’Œ<code>components.d.ts</code>ç±»å‹æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨åŠ åˆ°<code>tsconfig.json</code>ä¸­
<em>{"include": ["auto-imports.d.ts","components.d.ts"] }</em></li>
<li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œç»„ä»¶ä¸­ä½¿ç”¨çš„è¯¸å¦‚<em>showToast</em>ã€<em>showDialog</em>ä¼šè‡ªåŠ¨æŠŠç±»å‹åŠ åˆ°<code>auto-imports.d.ts</code>ä¸­ï¼Œå¦‚æœé‡åˆ°æ²¡æœ‰è‡ªåŠ¨åŠ çš„ã€tsæŠ¥çº¢çš„æƒ…å†µï¼Œæ‰‹åŠ¨åŠ ä¸‹</li>
<li>æ ¹æ®UIè®¾è®¡ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè‡ªå·±å®šä¹‰ä¸€äº›<em>vant</em>ä¸­çš„å˜é‡ï¼Œä¸€èˆ¬æ˜¯è¿™ç§å†™æ³•:</li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--vant-toast-radius</span>: <span class="hljs-number">50px</span>;
  // ...
}
</code></pre>
<p>æˆ‘ä»¬æ”¹æˆæŒ‰éœ€å¼•å…¥åï¼Œ<em>vantæœ¬èº«çš„css</em>ä¼šåœ¨<em>æˆ‘ä»¬å®šä¹‰çš„css</em>ä¹‹åå¼•å…¥ï¼Œå¯¼è‡´æˆ‘ä»¬å®šä¹‰çš„å˜é‡è¢«è¦†ç›–ï¼Œä¸ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸‹æƒé‡ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">html</span><span class="hljs-selector-pseudo">:root</span> {
 // ...
}
</code></pre>
<p>å‰©ä¸‹ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åº“æ˜¯<code>lodash-es</code>ï¼Œä¸è¦å…¨é‡å¼•å…¥<code>import _ from 'lodash-es</code>ï¼Œç”¨å“ªä¸ªå¼•å…¥å“ªä¸ªå°±å¥½<code>import {debounce } from 'lodash-es'</code></p>
<h3 data-id="heading-7">6. å¤šè¯­è¨€</h3>
<p>é¡¹ç›®ä¸­æœ‰<strong>åå‡ ç§</strong>è¯­è¨€ï¼Œè¯­è¨€æ–‡ä»¶ä¸­çš„æ–‡æœ¬æ¡æ•°æœ‰<strong>1000+</strong>ï¼Œæ‰“åŒ…åï¼Œè¯­è¨€æ–‡ä»¶<strong>500k</strong><br/>
æ–‡æœ¬æœ¬èº«å‡å°‘ä¸äº†çš„æƒ…å†µï¼Œåªèƒ½å¼‚æ­¥åŠ è½½äº†ï¼š<strong>ä¸­è‹±æ–‡ä¸å˜ï¼Œå…¶ä»–è¯­è¨€å¼‚æ­¥</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// lang/index.ts</span>
<span class="hljs-keyword">import</span> { createI18n } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-i18n'</span>
<span class="hljs-keyword">import</span> zh <span class="hljs-keyword">from</span> <span class="hljs-string">'./zh-CN'</span>
<span class="hljs-keyword">import</span> en <span class="hljs-keyword">from</span> <span class="hljs-string">'./en-US'</span>

cosnt asyncMessages = {
  <span class="hljs-attr">fr</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./fr'</span>),
  <span class="hljs-attr">de</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./fr'</span>),
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-keyword">const</span> i18n = <span class="hljs-title function_">createI18n</span>({
  <span class="hljs-attr">locale</span>: <span class="hljs-string">'en-US'</span>,
  <span class="hljs-attr">fallbackLocale</span>: <span class="hljs-string">'en-US'</span>,
  <span class="hljs-attr">messages</span>: { zh, en }
})

<span class="hljs-title function_">setLocale</span>(<span class="hljs-title function_">getDefaultLang</span>())

<span class="hljs-comment">// è®¾ç½®è¯­è¨€</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setLocale</span>(<span class="hljs-params">locale: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (!i18n.<span class="hljs-property">global</span>.<span class="hljs-property">availableLocales</span>.<span class="hljs-title function_">includes</span>(locale)) {
    <span class="hljs-keyword">const</span> messages = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadLocaleMessages</span>(locale)
    i18n.<span class="hljs-property">global</span>.<span class="hljs-title function_">setLocaleMessage</span>(locale, messages)
  }
  i18n.<span class="hljs-property">global</span>.<span class="hljs-property">locale</span>.<span class="hljs-property">value</span> = locale
}
<span class="hljs-comment">// åŠ è½½è¯­è¨€æ–‡ä»¶å‡½æ•°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadLocaleMessages</span>(<span class="hljs-params">locale: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> loader = asyncMessage[locale]
  <span class="hljs-keyword">const</span> messages = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loader</span>()
  <span class="hljs-keyword">return</span> messages.<span class="hljs-property">default</span>
}
</code></pre>
<p>ä¿®æ”¹è¯­è¨€çš„åœ°æ–¹ï¼Œæ”¹æˆè°ƒç”¨<code>setLocale</code>å°±è¡Œäº† <em>(ä¼šæœ‰tsæŠ¥çº¢ï¼Œå¤§ä½¬çœ‹çœ‹æ€ä¹ˆå†™ts)</em></p>
<h3 data-id="heading-8">7. å…¨å±€ç»„ä»¶</h3>
<p>å…¨å±€ç»„ä»¶æœ¬èº«å¯èƒ½ä¸ä¼šå¾ˆå¤§ï¼Œä½†å¦‚æœå…¨å±€ç»„ä»¶ä¸­å¼•å…¥äº†å…¶ä»–æ¯”è¾ƒå¤§çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™å°±æ¯”è¾ƒå‘äº†ã€‚å°±åƒæˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œæœ‰ä¸ªå…¨å±€ç»„ä»¶ï¼Œå¼•å…¥äº†<em>echats</em>ï¼Œé¦–é¡µä¸­è¿˜æ²¡ç”¨åˆ°è¿™ä¸ªç»„ä»¶<strong>æ”¹æˆå¼‚æ­¥ç»„ä»¶</strong>:</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">App</span>, <span class="hljs-title class_">Component</span>, defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> modules = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">glob</span>&lt;<span class="hljs-literal">true</span>,<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Component</span>&gt;([<span class="hljs-string">'/src/components/*/*.vue'</span>,<span class="hljs-string">'!/src/components/EChart/index.vue'</span>], { <span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> <span class="hljs-title class_">EChartAsyncComponent</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./EChart/index.vue"</span>))

<span class="hljs-keyword">const</span> <span class="hljs-title class_">GlobalComponentsPlugin</span> = {
  <span class="hljs-title function_">install</span>(<span class="hljs-params">app: App</span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(modules).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[path, <span class="hljs-variable language_">module</span>]</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> componentName = <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>.<span class="hljs-property">name</span> ?? path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\.\w+$/</span>, <span class="hljs-string">''</span>)
      app.<span class="hljs-title function_">component</span>(componentName, <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>)
    })
    app.<span class="hljs-title function_">component</span>(<span class="hljs-string">'EChart'</span>, <span class="hljs-title class_">EChartAsyncComponent</span>)
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">GlobalComponentsPlugin</span>

<span class="hljs-comment">// main.ts</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">GlobalComponentsPlugin</span>)
</code></pre>
<p>ä¹Ÿå¯ä»¥æŠŠéé¦–é¡µçš„å…¨å±€ç»„ä»¶å…¨éƒ¨æ”¹æˆå¼‚æ­¥ç»„ä»¶ï¼Œè¿›ä¸€æ­¥å‡å°‘é¦–æ¬¡åŠ è½½æ–‡ä»¶å¤§å°ã€‚</p>
<h3 data-id="heading-9">8. å‹ç¼©</h3>
<p>å‹ç¼©å¯ä»¥æ˜æ˜¾å‡å°‘æ–‡ä»¶å¤§å°ï¼Œä¸è¿‡è¿™ä¸ªéœ€è¦æœåŠ¡å™¨æ”¯æŒï¼Œéœ€è¦è¿ç»´å»æ”¹ä¸‹é…ç½®ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨æœåŠ¡ç«¯å‹ç¼©ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> viteCompression <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-compression"</span>

<span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">// ...</span>
        <span class="hljs-title function_">viteCompression</span>({
          <span class="hljs-attr">verbose</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">disable</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span>, <span class="hljs-comment">// è¶…è¿‡10kçš„æ–‡ä»¶æ‰å‹ç¼©</span>
          <span class="hljs-attr">algorithm</span>: <span class="hljs-string">"gzip"</span>,
          <span class="hljs-attr">ext</span>: <span class="hljs-string">".gz"</span>
        })
      ]
    }
  }
})
</code></pre>
<h3 data-id="heading-10">9. CDN</h3>
<p>ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ç¬¬ä¸‰æ–¹CDNï¼Œå¯ç”¨æ€§æ²¡æœ‰åŠæ³•ä¿è¯ï¼Œè¾…åŠ©æ€§è´¨çš„åº“ï¼ˆä¸å½±å“ä¸šåŠ¡ï¼‰å¯ä»¥ç”¨ç”¨ <em>(æ­£å¸¸æƒ…å†µä¸‹ï¼Œvconsoleä¸åº”è¯¥æ‰“è¿›ç”Ÿäº§çš„åŒ…ä¸­)</em></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> externalGlobals <span class="hljs-keyword">from</span> <span class="hljs-string">"rollup-plugin-external-globals"</span>

<span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">extend</span>: [<span class="hljs-string">'vconsole'</span>],
      <span class="hljs-comment">// globals: { vconsole: 'VConsole' } è‡ªå¸¦çš„globalsæœ‰é—®é¢˜ï¼Œæ‰“åŒ…å¯ä»¥ï¼Œè®¿é—®çš„æ—¶å€™ä¼šæŠ¥é”™</span>
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">externalGlobals</span>({
          <span class="hljs-attr">vconsole</span>: <span class="hljs-string">"VConsole"</span>
        }),
      ]
    }
  }
})
</code></pre>
<pre><code class="hljs language-html" lang="html">// index.html
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/vconsole@3.15.1/dist/vconsole.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-11">å…¶ä»–</h2>
<p>è®¿é—®çš„æ—¶å€™æ‰å»åŠ è½½ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œä¸ä½³ï¼Œæˆ–è®¿é—®å¤–æœï¼Œç¡®å®è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ï¼Œå¦‚æœèƒ½åƒappåŸç”Ÿé‚£æ ·ï¼Œæ–‡ä»¶éƒ½æ”¾åˆ°æœ¬åœ°å°±å¥½äº†ã€‚</p>
<p><strong>ç¦»çº¿åŒ…</strong>åº”è¯¥æ˜¯ä¸€ä¸ªåˆé€‚çš„æ–¹æ¡ˆï¼Œè®¾æƒ³ä¸­æ˜¯å‰ç«¯æŠŠæ‰€æœ‰çš„ä»£ç æ‰“æˆä¸€ä¸ª<code>å‹ç¼©åŒ…</code>å’Œä¸€ä¸ª<code>manifest.json</code>æ–‡ä»¶ï¼Œappåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå°±åƒappåŸç”Ÿæ›´æ–°ä¸€æ ·ï¼Œæˆ–è€…å·å·åœ°åœ¨åå°æ›´æ–°...</p>
<p>è¿™ä¸ªæ–¹æ¡ˆéœ€è¦appåŒäº‹æŠ•å…¥ï¼Œå‰ç«¯æ‰“åŒ…é…ç½®ä¹Ÿè¦è¿›è¡Œä¸€å®šçš„æ›´æ”¹ï¼Œä¸»è¦æ˜¯æ–‡ä»¶åŠ è½½è·¯å¾„ï¼Œç­‰appæœ‰æ—¶é—´äº†å¯ä»¥è¯•ä¸€ä¸‹...</p>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>é€šè¿‡ä¹‹ä¸Šçš„ä¸€äº›é…ç½®ï¼Œé¦–é¡µåŠ è½½æ–‡ä»¶å¤§å°ä¼šæœ‰ä¸€å®šçš„ç¼©å°ï¼Œå½“ç„¶ç¦»åšåˆ°æè‡´è¿˜å·®å¾ˆå¤šï¼Œæœ€ç†æƒ³çš„çŠ¶æ€åº”è¯¥å°±æ˜¯é¦–é¡µåªåŠ è½½é¦–é¡µä»£ç ï¼Œå…¶ä»–éƒ½æ˜¯å¼‚æ­¥...</p>
<p>jyä»¬è¿˜æœ‰å“ªäº›é…ç½®å¯ä»¥åˆ†äº«ä¸‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[xfsæ–‡ä»¶ç³»ç»Ÿç£ç›˜æŸåä¿®å¤]]></title>    <link>https://juejin.cn/post/7570866247979565108</link>    <guid>https://juejin.cn/post/7570866247979565108</guid>    <pubDate>2025-11-10T08:14:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570866247979565108" data-draft-id="7570630923711168564" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="xfsæ–‡ä»¶ç³»ç»Ÿç£ç›˜æŸåä¿®å¤"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-11-10T08:14:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èœé¸Ÿç¥¥å“¥"/> <meta itemprop="url" content="https://juejin.cn/user/3690440994339726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            xfsæ–‡ä»¶ç³»ç»Ÿç£ç›˜æŸåä¿®å¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3690440994339726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èœé¸Ÿç¥¥å“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:14:22.000Z" title="Mon Nov 10 2025 08:14:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å°†10.91.129.42çš„vg_data-lv_minioå¤‡ä»½imgåˆ°10.91.129.193ä¸Š
10.91.129.42çš„vg_data-lv_minioæŒ‚è½½ä¸ä¸Šäº†,æˆ‘ä»¬å…ˆå¤‡ä»½
æˆ‘ä»¬ä½¿ç”¨sambaå’Œddæ¥å¤‡ä»½æŸåçš„ç£ç›˜,é¦–å…ˆå®‰è£…
ç›®æ ‡å¤‡ä»½æœº10.91.129.193æŒ‚è½½æƒ…å†µ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88a31e6ffb1d41248dade7c7861bf395~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c6bif56Wl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367359&amp;x-signature=0j8h7cjinVJLXyWQI4vcmxks1b0%3D" alt="image.png" loading="lazy"/></p>
<p>æ•…éšœæœº10.91.129.193æŒ‚è½½æƒ…å†µ:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c08cd1192204cfcb35d5c54dd1c0faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c6bif56Wl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763367359&amp;x-signature=Bz6KG%2FueBdo4gsx87ibI99Ao6Xg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">å‰ç½®å‡†å¤‡:æ›´æ¢yumæº</h2>
<h3 data-id="heading-1">1. å¤‡ä»½åŸæœ‰yumæºé…ç½®æ–‡ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /etc/yum.repos.d/backup
<span class="hljs-built_in">mv</span> /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/
</code></pre>
<h3 data-id="heading-2">2. ä¸‹è½½æ–°çš„yumæºé…ç½®æ–‡ä»¶ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰</h3>
<h4 data-id="heading-3">å¯¹äºCentOS 7ï¼š</h4>
<pre><code class="hljs language-bash" lang="bash">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</code></pre>
<h3 data-id="heading-4">3. æ¸…ç†å¹¶ç”Ÿæˆç¼“å­˜</h3>
<pre><code class="hljs language-css" lang="css">yum clean <span class="hljs-attribute">all</span>
yum makecache
</code></pre>
<h3 data-id="heading-5">4. æ›´æ–°ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰</h3>
<pre><code class="hljs language-sql" lang="sql">yum <span class="hljs-keyword">update</span> <span class="hljs-operator">-</span>y
</code></pre>
<h3 data-id="heading-6">1. åœ¨193èŠ‚ç‚¹ä¸Šå‡†å¤‡å­˜å‚¨ç©ºé—´</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜åˆ†åŒº</span>
sudo fdisk -l /dev/vdb

<span class="hljs-comment"># ä¸º42Tç£ç›˜åˆ›å»ºåˆ†åŒº</span>
sudo parted /dev/vdb mklabel gpt
sudo parted /dev/vdb mkpart primary 0% 100%

<span class="hljs-comment"># æ ¼å¼åŒ–åˆ†åŒº</span>
sudo mkfs.xfs /dev/vdb1

<span class="hljs-comment"># åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½</span>
sudo <span class="hljs-built_in">mkdir</span> -p /mnt/backup_storage
sudo mount /dev/vdb1 /mnt/backup_storage
</code></pre>
<h3 data-id="heading-7">2. åœ¨193èŠ‚ç‚¹ä¸Šå®‰è£…å’Œé…ç½®Samba</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…Samba</span>
sudo yum install samba samba-client -y

<span class="hljs-comment"># åˆ›å»ºå¤‡ä»½ç›®å½•</span>
sudo <span class="hljs-built_in">mkdir</span> -p /mnt/backup_storage/minio_backup
sudo <span class="hljs-built_in">chmod</span> 777 /mnt/backup_storage/minio_backup

<span class="hljs-comment"># é…ç½®Samba</span>
sudo <span class="hljs-built_in">cp</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak
</code></pre>
<p>ç¼–è¾‘Sambaé…ç½®Â <code>/etc/samba/smb.conf</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[minio_backup]</span>
    <span class="hljs-attr">path</span> = /mnt/backup_storage/minio_backup
    <span class="hljs-attr">browseable</span> = <span class="hljs-literal">yes</span>
    <span class="hljs-attr">writable</span> = <span class="hljs-literal">yes</span>
    guest <span class="hljs-attr">ok</span> = <span class="hljs-literal">yes</span>
    read <span class="hljs-attr">only</span> = <span class="hljs-literal">no</span>
    create <span class="hljs-attr">mask</span> = <span class="hljs-number">0777</span>
    directory <span class="hljs-attr">mask</span> = <span class="hljs-number">0777</span>
</code></pre>
<h3 data-id="heading-8">3. å¯åŠ¨SambaæœåŠ¡</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®Sambaç”¨æˆ·ï¼ˆå¯é€‰è®¾ç½®å¯†ç ï¼‰</span>
sudo smbpasswd -a root

<span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span>
sudo systemctl <span class="hljs-built_in">enable</span> smb
sudo systemctl <span class="hljs-built_in">enable</span> nmb
sudo systemctl start smb
sudo systemctl start nmb

<span class="hljs-comment"># é…ç½®é˜²ç«å¢™</span>
sudo firewall-cmd --permanent --add-service=samba
sudo firewall-cmd --reload
</code></pre>
<h3 data-id="heading-9">4. åœ¨42èŠ‚ç‚¹ä¸ŠæŒ‚è½½Sambaå…±äº«</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…Sambaå®¢æˆ·ç«¯</span>
sudo yum install cifs-utils -y

<span class="hljs-comment"># åˆ›å»ºæœ¬åœ°æŒ‚è½½ç‚¹</span>
sudo <span class="hljs-built_in">mkdir</span> -p /mnt/remote_backup

<span class="hljs-comment"># æŒ‚è½½Sambaå…±äº«</span>
sudo mount -t cifs //10.91.129.193/minio_backup /mnt/remote_backup -o username=root,password=æ‚¨çš„å¯†ç ,vers=3.0

<span class="hljs-comment"># æµ‹è¯•æŒ‚è½½</span>
<span class="hljs-built_in">df</span> -h /mnt/remote_backup
</code></pre>
<h3 data-id="heading-10">5. åˆ›å»ºé€»è¾‘å·é•œåƒå¤‡ä»½</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥é€»è¾‘å·çŠ¶æ€</span>
sudo lvdisplay /dev/vg_data/lv_minio

<span class="hljs-comment"># åˆ›å»ºé€»è¾‘å·é•œåƒï¼ˆä½¿ç”¨ddå‘½ä»¤ï¼‰</span>
sudo <span class="hljs-built_in">nohup</span> <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/vg_data/lv_minio of=/mnt/remote_backup/lv_minio_backup.img bs=1M status=progress &amp;1 &amp;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³äºscopedæ ·å¼éš”ç¦»åŸç†å’Œå¤±æ•ˆæƒ…å†µ&&å¸¸è§æ ·å¼éš”ç¦»æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7570902473432498176</link>    <guid>https://juejin.cn/post/7570902473432498176</guid>    <pubDate>2025-11-10T09:00:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473432498176" data-draft-id="7570604028633432099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³äºscopedæ ·å¼éš”ç¦»åŸç†å’Œå¤±æ•ˆæƒ…å†µ&amp;&amp;å¸¸è§æ ·å¼éš”ç¦»æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T09:00:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹‰ä¸åŠ¨çš„çŒª"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³äºscopedæ ·å¼éš”ç¦»åŸç†å’Œå¤±æ•ˆæƒ…å†µ&amp;&amp;å¸¸è§æ ·å¼éš”ç¦»æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹‰ä¸åŠ¨çš„çŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:00:33.000Z" title="Mon Nov 10 2025 09:00:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Vue çš„Â <code>scoped</code>Â æ ·å¼éš”ç¦»çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æœ‰æ˜ç¡®çš„å®ç°é€»è¾‘ï¼Œæœªéš”ç¦»æˆåŠŸå¾€å¾€æ˜¯æ²¡ææ‡‚å®ƒçš„å·¥ä½œåŸç†ã€‚ä¸‹é¢ä»ã€Œæ ¸å¿ƒæœºåˆ¶â†’å®ç°æ­¥éª¤â†’éš”ç¦»è¾¹ç•Œâ†’å¸¸è§è¯¯åŒºã€å››ä¸ªç»´åº¦è¯¦ç»†æ‹†è§£ï¼š</p>
<h3 data-id="heading-0">ä¸€ã€æ ¸å¿ƒç»“è®º</h3>
<p><code>scoped</code>Â çš„æœ¬è´¨æ˜¯Â <strong>é€šè¿‡ç»™ç»„ä»¶å†…å…ƒç´ æ·»åŠ å”¯ä¸€å±æ€§ + æ ·å¼é€‰æ‹©å™¨ç»‘å®šè¯¥å±æ€§</strong>ï¼Œè®©æ ·å¼ä»…ä½œç”¨äºå½“å‰ç»„ä»¶çš„å…ƒç´ ï¼Œä»è€Œå®ç°éš”ç¦»ã€‚<strong>ä½†å®ƒæ— æ³•éš”ç¦»å…¨å±€é€‰æ‹©å™¨ï¼ˆå¦‚æ ‡ç­¾ã€é€šé…ç¬¦ï¼‰</strong>ï¼Œè¿™ä¹Ÿæ˜¯é‡åˆ° ä¸¤ä¸ªç»„ä»¶â€œç±»åä¸åŒä»è¢«å½±å“â€ï¼ˆä¸€ä¸ªåŠ äº†scopedï¼Œå¦ä¸€ä¸ªä¸åŠ scopedï¼‰ çš„æ ¸å¿ƒåŸå› ã€‚</p>
<hr/>
<h3 data-id="heading-1">äºŒã€<code>scoped</code>Â æ ·å¼éš”ç¦»çš„å®Œæ•´å®ç°æ­¥éª¤</h3>
<p>Vue ç¼–è¯‘ç»„ä»¶æ—¶ï¼Œä¼šå¯¹Â <code>scoped</code>Â æ ·å¼åš 3 ä»¶å…³é”®äº‹ï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–ï¼š</p>
<h4 data-id="heading-2">1. ç»™ç»„ä»¶å†…æ‰€æœ‰å…ƒç´ æ·»åŠ ã€Œå”¯ä¸€å±æ€§ã€</h4>
<p>ç¼–è¯‘åï¼Œç»„ä»¶æ¨¡æ¿ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬å­å…ƒç´ ã€æ ¹å…ƒç´ ï¼‰éƒ½ä¼šè¢«æ·»åŠ ä¸€ä¸ªæ ¼å¼ä¸ºÂ <code>data-v-xxx</code>Â çš„è‡ªå®šä¹‰å±æ€§ï¼Œ<code>xxx</code>Â æ˜¯ç»„ä»¶çš„å”¯ä¸€å“ˆå¸Œå€¼ï¼ˆæ¯ä¸ªç»„ä»¶çš„å“ˆå¸Œå€¼ä¸åŒï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆç¼–è¯‘å‰ï¼‰</strong> ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç»„ä»¶ Aï¼ˆå¸¦ scopedï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>ç»„ä»¶ A å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼ˆç¼–è¯‘åï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- æ¯ä¸ªå…ƒç´ éƒ½å¤šäº† data-v-123ï¼ˆ123 æ˜¯ç»„ä»¶ A çš„å”¯ä¸€å“ˆå¸Œï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span> <span class="hljs-attr">data-v-123</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">data-v-123</span>&gt;</span>ç»„ä»¶ A å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">2. ç»™ç»„ä»¶å†…æ‰€æœ‰æ ·å¼è§„åˆ™æ·»åŠ ã€Œå±æ€§é€‰æ‹©å™¨ã€</h4>
<p>ç»„ä»¶å†…çš„æ‰€æœ‰ CSS é€‰æ‹©å™¨ï¼Œéƒ½ä¼šè¢«è‡ªåŠ¨è¿½åŠ Â <code>[data-v-xxx]</code>Â å±æ€§é€‰æ‹©å™¨ï¼Œå¼ºåˆ¶è®©æ ·å¼åªåŒ¹é…å¸¦è¯¥å±æ€§çš„å…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯å½“å‰ç»„ä»¶å†…çš„å…ƒç´ ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆç¼–è¯‘å‰ï¼Œscoped æ ·å¼ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼ˆç¼–è¯‘åï¼Œå…¨å±€ç”Ÿæ•ˆçš„æ ·å¼ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* è‡ªåŠ¨è¿½åŠ  [data-v-123]ï¼ŒåªåŒ¹é…ç»„ä»¶ A å†…çš„ .box */</span>
<span class="hljs-selector-class">.box</span><span class="hljs-selector-attr">[data-v-123]</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-comment">/* è‡ªåŠ¨è¿½åŠ  [data-v-123]ï¼ŒåªåŒ¹é…ç»„ä»¶ A å†…çš„ .text */</span>
<span class="hljs-selector-class">.text</span><span class="hljs-selector-attr">[data-v-123]</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<h4 data-id="heading-4">3. å­ç»„ä»¶æ ¹å…ƒç´ çš„ã€Œå±æ€§ç»§æ‰¿ã€ï¼ˆå…³é”®ç»†èŠ‚ï¼‰</h4>
<p>å¦‚æœç»„ä»¶ A åŒ…å«å­ç»„ä»¶ Bï¼ˆä¹Ÿå¸¦ scopedï¼‰ï¼Œå­ç»„ä»¶ B çš„<strong>æ ¹å…ƒç´ </strong>ä¼šåŒæ—¶æ‹¥æœ‰ç»„ä»¶ A çš„Â <code>data-v-xxx</code>Â å’Œç»„ä»¶ B è‡ªå·±çš„Â <code>data-v-yyy</code>Â å±æ€§ã€‚</p>
<p>ç›®çš„æ˜¯ï¼šè®©çˆ¶ç»„ä»¶çš„Â <code>scoped</code>Â æ ·å¼èƒ½ä½œç”¨äºå­ç»„ä»¶çš„æ ¹å…ƒç´ ï¼ˆæ–¹ä¾¿çˆ¶ç»„ä»¶æ§åˆ¶å­ç»„ä»¶å¸ƒå±€ï¼‰ï¼Œä½†å­ç»„ä»¶å†…éƒ¨çš„å…ƒç´ ä»å—è‡ªå·±çš„Â <code>scoped</code>Â ä¿æŠ¤ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç»„ä»¶ A åŒ…å«ç»„ä»¶ Bï¼Œç¼–è¯‘å --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span> <span class="hljs-attr">data-v-123</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å­ç»„ä»¶ B çš„æ ¹å…ƒç´ ï¼ŒåŒæ—¶æœ‰ data-v-123ï¼ˆçˆ¶ï¼‰å’Œ data-v-456ï¼ˆå­ï¼‰ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child-root"</span> <span class="hljs-attr">data-v-456</span> <span class="hljs-attr">data-v-123</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- å­ç»„ä»¶ B å†…éƒ¨å…ƒç´ ï¼Œåªæœ‰è‡ªå·±çš„ data-v-456 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child-text"</span> <span class="hljs-attr">data-v-456</span>&gt;</span>å­ç»„ä»¶ B å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">ä¸‰ã€<code>scoped</code>Â çš„ã€Œéš”ç¦»è¾¹ç•Œã€ï¼šå“ªäº›æƒ…å†µä¼šå¤±æ•ˆï¼Ÿ</h3>
<p><code>scoped</code>Â åªèƒ½éš”ç¦»ã€Œå¸¦ç»„ä»¶å”¯ä¸€å±æ€§çš„é€‰æ‹©å™¨ã€ï¼Œä»¥ä¸‹ 3 ç§æƒ…å†µä¼šçªç ´éš”ç¦»ï¼Œè¿™ä¹Ÿæ˜¯ä½ é‡åˆ°é—®é¢˜çš„æ ¸å¿ƒåŸå› ï¼š</p>
<h4 data-id="heading-6">1. æœªä½¿ç”¨Â <code>scoped</code>Â çš„ç»„ä»¶ä½¿ç”¨ã€Œå…¨å±€é€‰æ‹©å™¨ã€</h4>
<p>æœªåŠ Â <code>scoped</code>Â çš„ç»„ä»¶æ ·å¼æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œå¦‚æœå®ƒç”¨äº†Â <strong>æ ‡ç­¾é€‰æ‹©å™¨ï¼ˆdiv/pï¼‰ã€é€šé…ç¬¦ï¼ˆ*ï¼‰ã€å±æ€§é€‰æ‹©å™¨</strong>ï¼Œè¿™äº›é€‰æ‹©å™¨ä¸ä¼šè¢«æ·»åŠ Â <code>data-v-xxx</code>Â é™åˆ¶ï¼Œä¼šåŒ¹é…é¡µé¢ä¸Šæ‰€æœ‰å¯¹åº”å…ƒç´  â€”â€” åŒ…æ‹¬å¸¦Â <code>scoped</code>Â çš„ç»„ä»¶å†…çš„å…ƒç´ ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆé—®é¢˜åœºæ™¯ï¼‰</strong> ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç»„ä»¶ Xï¼ˆæœªç”¨ scopedï¼Œå…¨å±€æ ·å¼ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* å…¨å±€æ ‡ç­¾é€‰æ‹©å™¨ï¼ŒåŒ¹é…æ‰€æœ‰ divï¼ŒåŒ…æ‹¬ç»„ä»¶ A å†…çš„ div */</span>
<span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">color</span>: red; <span class="hljs-comment">/* ç»„ä»¶ A å†…çš„ div ä¼šè¢«æŸ“æˆçº¢è‰²ï¼Œå³ä½¿ç±»åä¸åŒ */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ç»„ä»¶ Aï¼ˆç”¨ scopedï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.my-box</span> { <span class="hljs-comment">/* ç±»åä¸åŒï¼Œä½†å†…éƒ¨ div ä»è¢«ç»„ä»¶ X å½±å“ */</span>
  <span class="hljs-comment">/* æ ·å¼è¢«è¦†ç›– */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">2. é€‰æ‹©å™¨æƒé‡é—®é¢˜</h4>
<p>æœªåŠ Â <code>scoped</code>Â çš„å…¨å±€æ ·å¼å¦‚æœç”¨äº†ã€Œæ›´å…·ä½“çš„é€‰æ‹©å™¨ã€ï¼ˆå¦‚Â <code>çˆ¶ç±» å­ç±»</code>Â åµŒå¥—ï¼‰ï¼Œæƒé‡å¯èƒ½é«˜äºÂ <code>scoped</code>Â æ ·å¼ï¼ˆ<code>ç±»å[data-v-xxx]</code>ï¼‰ï¼Œä»è€Œè¦†ç›–æ ·å¼ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- å…¨å±€æ ·å¼ï¼ˆæœª scopedï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* æƒé‡ï¼š10 + 10 = 20 */</span>
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">background</span>: blue;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- scoped ç»„ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* æƒé‡ï¼š10ï¼ˆç±»åï¼‰ + 10ï¼ˆå±æ€§ï¼‰ = 20ï¼Œè‹¥å…¨å±€æ ·å¼åœ¨åé¢ï¼Œä¼šè¦†ç›– */</span>
<span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">background</span>: white;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">3. æ·±åº¦ä½œç”¨é€‰æ‹©å™¨ï¼ˆ::v-deepï¼‰çš„åå‘å½±å“</h4>
<p>å¦‚æœå¸¦Â <code>scoped</code>Â çš„ç»„ä»¶ç”¨äº†Â <code>::v-deep</code>ï¼ˆæˆ–Â <code>/deep/</code>ï¼‰ï¼Œä¼šç©¿é€è‡ªå·±çš„Â <code>scoped</code>Â é™åˆ¶ï¼Œæ ·å¼ä½œç”¨äºå­ç»„ä»¶å†…éƒ¨ï¼›ä½†å¦‚æœå…¨å±€æ ·å¼ï¼ˆæœª scopedï¼‰ç”¨äº†ç±»ä¼¼ç©¿é€é€»è¾‘ï¼ˆå°‘è§ï¼‰ï¼Œä¹Ÿå¯èƒ½å½±å“Â <code>scoped</code>Â ç»„ä»¶ã€‚</p>
<hr/>
<h3 data-id="heading-9">å››ã€é—®é¢˜è§£å†³æ–¹æ¡ˆ</h3>
<p>å‡è®¾åœºæ™¯æ˜¯ã€Œæœª scoped ç»„ä»¶å½±å“äº† scoped ç»„ä»¶ï¼Œç±»åä¸åŒã€ï¼Œç›´æ¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ä¿®å¤ï¼š</p>
<ol>
<li>
<p><strong>æ£€æŸ¥æœª scoped ç»„ä»¶çš„æ ·å¼</strong>ï¼š</p>
<ul>
<li>åˆ æ‰æˆ–ä¿®æ”¹å…¨å±€çš„ã€Œæ ‡ç­¾é€‰æ‹©å™¨ã€é€šé…ç¬¦ã€å±æ€§é€‰æ‹©å™¨ã€ï¼Œæ”¹ç”¨ã€Œç±»åé€‰æ‹©å™¨ã€ï¼ˆå¦‚Â <code>.component-x-div</code>Â è€ŒéÂ <code>div</code>ï¼‰ã€‚</li>
<li>è‹¥å¿…é¡»ç”¨å…¨å±€æ ·å¼ï¼Œç»™æœª scoped çš„ç»„ä»¶æ ·å¼æ·»åŠ ã€Œå‘½åç©ºé—´ã€ï¼ˆå¦‚ç»™æ ¹å…ƒç´ åŠ å”¯ä¸€ç±»åï¼Œæ ·å¼åµŒå¥—åœ¨é‡Œé¢ï¼‰ã€‚</li>
</ul>
<p><strong>ä¿®å¤ç¤ºä¾‹</strong>ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- æœª scoped çš„ç»„ä»¶ Xï¼ˆä¿®å¤åï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"component-x"</span>&gt;</span> <span class="hljs-comment">&lt;!-- æ ¹å…ƒç´ åŠ å”¯ä¸€å‘½åç©ºé—´ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>ç»„ä»¶ X å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* åµŒå¥—é€‰æ‹©å™¨ï¼Œåªä½œç”¨äºç»„ä»¶ X å†…éƒ¨ï¼Œä¸å½±å“å…¶ä»–ç»„ä»¶ */</span>
<span class="hljs-selector-class">.component-x</span> <span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">color</span>: red;
}
<span class="hljs-selector-class">.component-x</span> <span class="hljs-selector-tag">div</span> { <span class="hljs-comment">/* å³ä½¿æ˜¯æ ‡ç­¾é€‰æ‹©å™¨ï¼Œä¹Ÿè¢«å‘½åç©ºé—´é™åˆ¶ */</span>
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>æå‡ scoped ç»„ä»¶æ ·å¼çš„æƒé‡</strong>ï¼š</p>
<ul>
<li>ç»™ scoped ç»„ä»¶çš„æ ·å¼æ·»åŠ æ›´å…·ä½“çš„é€‰æ‹©å™¨ï¼ˆå¦‚åµŒå¥—ç±»åï¼‰ï¼Œæˆ–ç”¨Â <code>!important</code>ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œä»…åœ¨å¿…è¦æ—¶ï¼‰ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* æ›´å…·ä½“çš„é€‰æ‹©å™¨ï¼Œæƒé‡æ›´é«˜ */</span>
<span class="hljs-selector-class">.parent</span> <span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span> <span class="hljs-meta">!important</span>; <span class="hljs-comment">/* è¦†ç›–å…¨å±€æ ·å¼ */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>ç»™æœª scoped çš„ç»„ä»¶æ·»åŠ  scopedï¼ˆæ¨èï¼‰</strong> ï¼š</p>
<ul>
<li>é™¤ééœ€è¦å…¨å±€æ ·å¼ï¼Œå¦åˆ™å°½é‡ç»™æ‰€æœ‰ç»„ä»¶éƒ½åŠ Â <code>scoped</code>ï¼Œä»æ ¹æºé¿å…æ ·å¼æ±¡æŸ“ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p><code>scopedÂ çš„éš”ç¦»æ ¸å¿ƒæ˜¯ã€Œå±æ€§ç»‘å®šã€ï¼Œä½†å®ƒç®¡ä¸ä½å…¨å±€çš„æ ‡ç­¾é€‰æ‹©å™¨ã€é€šé…ç¬¦ç­‰å®½æ³›é€‰æ‹©å™¨ã€‚</code>ä½ é‡åˆ°çš„é—®é¢˜ï¼Œæœ¬è´¨æ˜¯æœª scoped ç»„ä»¶çš„å…¨å±€é€‰æ‹©å™¨ â€œè¯¯ä¼¤â€ äº† scoped ç»„ä»¶å†…çš„å…ƒç´  â€”â€” å’Œç±»åæ˜¯å¦ç›¸åŒæ— å…³ï¼Œåªå’Œé€‰æ‹©å™¨çš„åŒ¹é…èŒƒå›´æœ‰å…³ã€‚</p>
<h2 data-id="heading-11">å…¶ä»–å¸¸è§éš”ç¦»æ–¹æ¡ˆ</h2>
<p>åœ¨ Vue ä¸­ï¼Œé™¤äº†Â <code>scoped</code>Â ä¹‹å¤–ï¼Œè¿˜æœ‰å¤šç§æ ·å¼éš”ç¦»æ–¹æ¡ˆï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ï¼ˆå¦‚å…¨å±€æ ·å¼ç®¡ç†ã€ç»„ä»¶åº“å¼€å‘ã€é¿å…é€‰æ‹©å™¨å†²çªç­‰ï¼‰ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ 5 ç§æ–¹æ³•ï¼š</p>
<h3 data-id="heading-12">1.Â <strong>CSS Modulesï¼ˆCSS æ¨¡å—åŒ–ï¼‰</strong></h3>
<h4 data-id="heading-13">åŸç†ï¼š</h4>
<p>é€šè¿‡ Webpack ç­‰æ„å»ºå·¥å…·ï¼Œå°† CSS ç±»åç¼–è¯‘ä¸º<strong>å”¯ä¸€å“ˆå¸Œå€¼</strong>ï¼ˆå¦‚Â <code>box</code>Â â†’Â <code>_3zyde4l1yATCOkgn-DBWEL</code>ï¼‰ï¼Œç¡®ä¿æ¯ä¸ªç»„ä»¶çš„ç±»ååœ¨å…¨å±€å”¯ä¸€ï¼Œé¿å…å†²çªã€‚ï¼ˆç±»ä¼¼Â <code>scoped</code>ï¼Œä½†éš”ç¦»ç²’åº¦æ˜¯ â€œç±»åâ€ è€Œé â€œå…ƒç´ å±æ€§â€ï¼‰</p>
<h4 data-id="heading-14">ä½¿ç”¨æ–¹å¼ï¼š</h4>
<ul>
<li>æ ·å¼æ–‡ä»¶å‘½åä¸ºÂ <code>xxx.module.css</code>ï¼ˆæˆ–Â <code>xxx.module.scss</code>ï¼‰</li>
<li>åœ¨ç»„ä»¶ä¸­é€šè¿‡Â <code>import</code>Â å¼•å…¥ï¼Œä»¥å¯¹è±¡å½¢å¼ä½¿ç”¨ç±»å</li>
</ul>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç»„ä»¶ä¸­ä½¿ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"styles.box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"styles.text"</span>&gt;</span>CSS Modules ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./xxx.module.css'</span>; <span class="hljs-comment">// å¼•å…¥æ¨¡å—åŒ–æ ·å¼</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> { styles };
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- xxx.module.css --&gt;</span>
.box {
  padding: 20px;
  background: #f0f0f0;
}
.text {
  color: #333;
}
</code></pre>
<h4 data-id="heading-15">ç¼–è¯‘åæ•ˆæœï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"_3zyde4l1yATCOkgn-DBWEL"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"_13lgc6x90aWZ7VQrN5Qx9u"</span>&gt;</span>CSS Modules ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
._3zyde4l1yATCOkgn-DBWEL { <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>; }
._13lgc6x90aWZ7VQrN5Qx9u { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">é€‚ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li>å¤§å‹é¡¹ç›®ï¼Œéœ€è¦ä¸¥æ ¼éš”ç¦»ç»„ä»¶æ ·å¼ï¼Œé¿å…ç±»åå†²çª</li>
<li>é…åˆé¢„å¤„ç†å™¨ï¼ˆSass/LESSï¼‰ä½¿ç”¨ï¼Œæ”¯æŒåµŒå¥—å’Œå˜é‡</li>
<li>ä¸å¸Œæœ›ä¾èµ–Â <code>scoped</code>Â çš„å±æ€§æ ‡è®°ï¼ˆå¦‚å¯¹ DOM çº¯å‡€åº¦æœ‰è¦æ±‚ï¼‰</li>
</ul>
<h3 data-id="heading-17">2.Â <strong>BEM å‘½åè§„èŒƒï¼ˆæ‰‹åŠ¨éš”ç¦»ï¼Œä¸æ¨èï¼šå†™æ³•éº»çƒ¦ï¼Œå­—åˆå¤šï¼ŒåŠ£åŠ¿å¤§äºä¼˜åŠ¿ï¼‰</strong></h3>
<h4 data-id="heading-18">åŸç†ï¼š</h4>
<p>é€šè¿‡<strong>ç»Ÿä¸€çš„ç±»åå‘½åè§„åˆ™</strong>æ‰‹åŠ¨é¿å…å†²çªï¼Œæ ¸å¿ƒæ˜¯ â€œç»„ä»¶å + å…ƒç´ å + ä¿®é¥°ç¬¦â€ çš„å‘½åæ ¼å¼ï¼Œè®©ç±»åè‡ªå¸¦ â€œä½œç”¨åŸŸâ€ã€‚æ ¼å¼ï¼š<code>block__element--modifier</code>ï¼ˆå—__å…ƒç´  -- ä¿®é¥°ç¬¦ï¼‰</p>
<h4 data-id="heading-19">ä½¿ç”¨æ–¹å¼ï¼š</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ä»¥ç»„ä»¶åï¼ˆtodo-listï¼‰ä½œä¸º block å‰ç¼€ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list__item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list__text todo-list__text--completed"</span>&gt;</span>ä»»åŠ¡ 1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* æ‰€æœ‰ç±»åå¸¦ç»„ä»¶å‰ç¼€ï¼Œé¿å…å…¨å±€å†²çª */</span>
<span class="hljs-selector-class">.todo-list</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>; }
<span class="hljs-selector-class">.todo-list__item</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span>; }
<span class="hljs-selector-class">.todo-list__text--completed</span> { <span class="hljs-attribute">text-decoration</span>: line-through; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-20">é€‚ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li>ä¸­å°å‹é¡¹ç›®ï¼Œä¸æƒ³ä¾èµ–å·¥å…·é“¾ï¼ˆçº¯æ‰‹åŠ¨ç®¡ç†ï¼‰</li>
<li>å›¢é˜Ÿæœ‰ç»Ÿä¸€å‘½åè§„èŒƒï¼Œéœ€è¦å¯è¯»æ€§å¼ºçš„ç±»å</li>
<li>ä¸å…¨å±€æ ·å¼å…±å­˜æ—¶ï¼Œæ˜ç¡®åŒºåˆ†ç»„ä»¶æ ·å¼èŒƒå›´</li>
</ul>
<h3 data-id="heading-21">3.Â <strong>CSS-in-JSï¼ˆæ ·å¼å†™åœ¨ JS ä¸­ï¼‰</strong></h3>
<h4 data-id="heading-22">åŸç†ï¼š</h4>
<p>å°† CSS æ ·å¼ä»¥ JavaScript å¯¹è±¡çš„å½¢å¼ç¼–å†™ï¼Œé€šè¿‡åŠ¨æ€ç”Ÿæˆå”¯ä¸€ç±»åæˆ–å†…è”æ ·å¼å®ç°éš”ç¦»ã€‚å¸¸è§åº“ï¼š<code>styled-components</code>ã€<code>vue-styled-components</code>ã€<code>emotion</code>ã€‚</p>
<h4 data-id="heading-23">ä½¿ç”¨æ–¹å¼ï¼ˆä»¥Â <code>vue-styled-components</code>Â ä¸ºä¾‹ï¼‰ï¼š</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">StyledBox</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">StyledText</span>&gt;</span>CSS-in-JS ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">StyledText</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">StyledBox</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-styled-components'</span>;

<span class="hljs-comment">// å®šä¹‰å¸¦æ ·å¼çš„ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledBox</span> = styled.<span class="hljs-property">div</span><span class="hljs-string">`
  padding: 20px;
  background: #f0f0f0;
`</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledText</span> = styled.<span class="hljs-property">p</span><span class="hljs-string">`
  color: #333;
  font-size: 16px;
`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">StyledBox</span>, <span class="hljs-title class_">StyledText</span> }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">ç¼–è¯‘åæ•ˆæœï¼š</h4>
<p>è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç±»åï¼ˆå¦‚Â <code>sc-bdVaJa</code>ï¼‰ï¼Œæ ·å¼é€šè¿‡Â <code>&lt;style&gt;</code>Â æ ‡ç­¾æ’å…¥å¤´éƒ¨ï¼Œä»…ä½œç”¨äºå¯¹åº”ç»„ä»¶ã€‚</p>
<h4 data-id="heading-25">é€‚ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li>éœ€è¦åŠ¨æ€ç”Ÿæˆæ ·å¼ï¼ˆå¦‚æ ¹æ® props åŠ¨æ€ä¿®æ”¹æ ·å¼ï¼‰</li>
<li>ä¹ æƒ¯ç»„ä»¶åŒ–æ€ç»´ï¼Œå°†æ ·å¼ä¸ç»„ä»¶é€»è¾‘ç´§å¯†ç»“åˆ</li>
<li>å¤§å‹é¡¹ç›®ï¼Œå¸Œæœ›æ ·å¼å®Œå…¨ç”± JS ç®¡ç†ï¼ˆä¾¿äºåŠ¨æ€è®¡ç®—ã€ä¸»é¢˜åˆ‡æ¢ï¼‰</li>
</ul>
<h3 data-id="heading-26">4.Â <strong>ä½œç”¨åŸŸéš”ç¦»ï¼ˆåŸºäº CSS ç‰¹æ€§ï¼Œæ–¹ä¾¿&amp;&amp;è§åä¹‹ä¹‰ï¼‰</strong></h3>
<p>åˆ©ç”¨ CSS åŸç”Ÿç‰¹æ€§æˆ–é¢„å¤„ç†å™¨çš„ â€œä½œç”¨åŸŸâ€ åŠŸèƒ½ï¼Œå®ç°éš”ç¦»ï¼š</p>
<h4 data-id="heading-27">ï¼ˆ1ï¼‰CSS åµŒå¥—ä¸å‘½åç©ºé—´</h4>
<p>é€šè¿‡çˆ¶çº§ç±»ååµŒå¥—æ‰€æœ‰å­æ ·å¼ï¼Œå½¢æˆ â€œå‘½åç©ºé—´éš”ç¦»â€ï¼ˆç±»ä¼¼ BEMï¼Œä½†æ›´ç®€åŒ–ï¼‰ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-card"</span>&gt;</span> <span class="hljs-comment">&lt;!-- å‘½åç©ºé—´ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>ç”¨æˆ·ä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"desc"</span>&gt;</span>è¿™æ˜¯ç”¨æˆ·å¡ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* æ‰€æœ‰æ ·å¼åµŒå¥—åœ¨å‘½åç©ºé—´ä¸‹ï¼Œé¿å…å†²çª */</span>
<span class="hljs-selector-class">.user-card</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
  
  <span class="hljs-selector-class">.title</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>; }
  <span class="hljs-selector-class">.desc</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>; }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-28">ï¼ˆ2ï¼‰CSS @layerï¼ˆå±‚çº§éš”ç¦»ï¼‰</h4>
<p>é€šè¿‡Â <code>@layer</code>Â å®šä¹‰æ ·å¼å±‚çº§ï¼Œæ§åˆ¶ä¼˜å…ˆçº§ï¼Œé¿å…å…¨å±€æ ·å¼è¦†ç›–ç»„ä»¶æ ·å¼ï¼ˆéœ€è¦æµè§ˆå™¨æ”¯æŒï¼‰ï¼š</p>
<p>css</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/* å…¨å±€æ ·å¼ */</span>
<span class="hljs-variable">@layer</span> global {
  <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">color</span>: red; }
}

<span class="hljs-comment">/* ç»„ä»¶æ ·å¼ï¼Œå±‚çº§ä¼˜å…ˆçº§æ›´é«˜ */</span>
<span class="hljs-variable">@layer</span> component {
  <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">color</span>: blue; }
}
</code></pre>
<h3 data-id="heading-29">5.Â <strong>Shadow DOMï¼ˆå½±å­ DOMï¼Œå®Œå…¨éš”ç¦»ï¼‰</strong></h3>
<p><strong>Shadow DOM æ›´é€‚åˆéœ€è¦Â <strong>å¼ºéš”ç¦»ã€é«˜å°è£…æ€§</strong>Â çš„åœºæ™¯ï¼Œæ ¸å¿ƒæ˜¯è§£å†³ â€œæ ·å¼ / DOM ç»å¯¹ä¸å¹²æ‰°â€ çš„éœ€æ±‚</strong></p>
<h4 data-id="heading-30">åŸç†ï¼š</h4>
<p>åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿçš„ Shadow DOM ç‰¹æ€§ï¼Œåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ DOM å­æ ‘ï¼Œå…¶å†…éƒ¨æ ·å¼ä¸å¤–éƒ¨å®Œå…¨éš”ç¦»ï¼ˆå¤–éƒ¨æ ·å¼æ— æ³•å½±å“å†…éƒ¨ï¼Œå†…éƒ¨æ ·å¼ä¹Ÿä¸ä¼šæ³„æ¼åˆ°å¤–éƒ¨ï¼‰ã€‚</p>
<h4 data-id="heading-31">ä½¿ç”¨æ–¹å¼ï¼ˆåœ¨ Vue ä¸­éœ€æ‰‹åŠ¨åˆ›å»ºï¼‰ï¼š</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"shadowHost"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml">
export default {
  mounted() {
    // åˆ›å»º Shadow DOM
    const shadowRoot = this.$refs.shadowHost.attachShadow({ mode: 'closed' });
    // æ’å…¥ç»„ä»¶å†…å®¹å’Œæ ·å¼
    shadowRoot.innerHTML = `
      <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-tag">p</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
      </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Shadow DOM ç¤ºä¾‹ï¼ˆå®Œå…¨éš”ç¦»ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    `;
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-32">ç‰¹ç‚¹ï¼š</h4>
<ul>
<li>å®Œå…¨éš”ç¦»ï¼šå¤–éƒ¨æ ·å¼æ— æ³•å½±å“ Shadow DOM å†…éƒ¨ï¼Œå†…éƒ¨æ ·å¼ä¹Ÿä¸ä¼šæ±¡æŸ“å…¨å±€</li>
<li>å°é—­æ€§ï¼š<code>mode: 'closed'</code>Â æ—¶ï¼Œå¤–éƒ¨ JS æ— æ³•è®¿é—® Shadow DOM å†…éƒ¨å…ƒç´ </li>
<li>å…¼å®¹æ€§ï¼šç°ä»£æµè§ˆå™¨æ”¯æŒè‰¯å¥½ï¼ŒIE ä¸æ”¯æŒ</li>
</ul>
<h4 data-id="heading-33">é€‚ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li>å¼€å‘ç‹¬ç«‹ç»„ä»¶åº“ï¼ˆå¦‚ UI ç»„ä»¶ï¼‰ï¼Œç¡®ä¿æ ·å¼ä¸å—å¤–éƒ¨ç¯å¢ƒå½±å“</li>
<li>éœ€è¦ä¸¥æ ¼éš”ç¦»çš„åœºæ™¯ï¼ˆå¦‚åµŒå…¥ç¬¬ä¸‰æ–¹å†…å®¹ï¼‰</li>
</ul>
<h3 data-id="heading-34">å„ç§æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹©å»ºè®®</h3>















































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>éš”ç¦»åŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>scoped</code></td><td>å…ƒç´ æ·»åŠ å”¯ä¸€å±æ€§</td><td>ç®€å•æ˜“ç”¨ï¼ŒVue åŸç”Ÿæ”¯æŒ</td><td>æ— æ³•éš”ç¦»å…¨å±€æ ‡ç­¾é€‰æ‹©å™¨</td><td>å¤§å¤šæ•°æ—¥å¸¸ç»„ä»¶</td></tr><tr><td>CSS Modules</td><td>ç±»åç¼–è¯‘ä¸ºå”¯ä¸€å“ˆå¸Œ</td><td>éš”ç¦»å½»åº•ï¼Œæ”¯æŒé¢„å¤„ç†å™¨</td><td>éœ€è¦æ„å»ºå·¥å…·ï¼Œç±»åå¯è¯»æ€§å·®</td><td>å¤§å‹é¡¹ç›®ï¼Œä¸¥æ ¼éš”ç¦»éœ€æ±‚</td></tr><tr><td>BEM å‘½å</td><td>æ‰‹åŠ¨è§„èŒƒç±»å</td><td>æ— å·¥å…·ä¾èµ–ï¼Œç±»åå¯è¯»</td><td>ç±»åå†—é•¿ï¼Œä¾èµ–å›¢é˜Ÿè§„èŒƒ</td><td>ä¸­å°å‹é¡¹ç›®ï¼Œå›¢é˜Ÿåä½œ</td></tr><tr><td>CSS-in-JS</td><td>JS åŠ¨æ€ç”Ÿæˆå”¯ä¸€ç±»å</td><td>æ ·å¼åŠ¨æ€æ€§å¼ºï¼Œä¸ç»„ä»¶é€»è¾‘ç»“åˆç´§å¯†</td><td>å¢åŠ  JS ä½“ç§¯ï¼Œå­¦ä¹ æˆæœ¬é«˜</td><td>åŠ¨æ€æ ·å¼éœ€æ±‚ï¼Œç»„ä»¶åº“å¼€å‘</td></tr><tr><td>Shadow DOM</td><td>æµè§ˆå™¨åŸç”Ÿéš”ç¦»æœºåˆ¶</td><td>å®Œå…¨éš”ç¦»ï¼Œä¸ä¾èµ– CSS è§„åˆ™</td><td>å…¼å®¹æ€§æœ‰é™ï¼Œçµæ´»æ€§ä½</td><td>ç‹¬ç«‹ç»„ä»¶åº“ï¼Œå¼ºéš”ç¦»éœ€æ±‚</td></tr></tbody></table>
<p>æ ¹æ®é¡¹ç›®è§„æ¨¡å’Œéœ€æ±‚é€‰æ‹©ï¼š</p>
<ul>
<li>æ—¥å¸¸å¼€å‘ï¼šä¼˜å…ˆÂ <code>scoped</code>Â æˆ– CSS Modules</li>
<li>å›¢é˜Ÿåä½œï¼šBEM å‘½åè§„èŒƒæ›´æ˜“ç»´æŠ¤</li>
<li>åŠ¨æ€æ ·å¼ï¼šCSS-in-JS æ›´åˆé€‚</li>
<li>å¼ºéš”ç¦»éœ€æ±‚ï¼šShadow DOM æ˜¯ç»ˆææ–¹æ¡ˆ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«å‡½æ•°çš„â€œä¸¤é¢æ´¾â€äººç”Ÿï¼šæ·±åº¦å‰–æç®­å¤´å‡½æ•°å¦‚ä½•ä¸€åŠ³æ°¸é€¸åœ°è§£å†³ â€˜thisâ€™ çš„äºŒä¹‰æ€§]]></title>    <link>https://juejin.cn/post/7570902473432481792</link>    <guid>https://juejin.cn/post/7570902473432481792</guid>    <pubDate>2025-11-10T08:58:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473432481792" data-draft-id="7570793903848161295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«å‡½æ•°çš„â€œä¸¤é¢æ´¾â€äººç”Ÿï¼šæ·±åº¦å‰–æç®­å¤´å‡½æ•°å¦‚ä½•ä¸€åŠ³æ°¸é€¸åœ°è§£å†³ â€˜thisâ€™ çš„äºŒä¹‰æ€§"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T08:58:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æŸšæ±"/> <meta itemprop="url" content="https://juejin.cn/user/2529319920106776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«å‡½æ•°çš„â€œä¸¤é¢æ´¾â€äººç”Ÿï¼šæ·±åº¦å‰–æç®­å¤´å‡½æ•°å¦‚ä½•ä¸€åŠ³æ°¸é€¸åœ°è§£å†³ â€˜thisâ€™ çš„äºŒä¹‰æ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2529319920106776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æŸšæ±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:58:57.000Z" title="Mon Nov 10 2025 08:58:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œä¸ºä¸€å å‰ç«¯å¼€å‘ï¼Œä½ æ˜¯å¦æ›¾åœ¨æ·±å¤œè°ƒè¯•æ—¶ï¼Œå¯¹ç€ <code>this</code> çš„å€¼å‘å‡ºçµé­‚æ‹·é—®ï¼šâ€œä½ åˆ°åº•æ˜¯è°ï¼Ÿâ€ ä½ æ˜¯å¦æ›¾è¢«å›è°ƒå‡½æ•°ä¸­â€œä¸¢å¤±â€çš„ <code>this</code> é€¼åˆ°ç»å¢ƒï¼Ÿè¿™ä¸€åˆ‡çš„æ ¹æºï¼Œéƒ½æ¥è‡ªäº <strong>æ™®é€šå‡½æ•°ä¸­ <code>this</code> ä»¤äººå›°æƒ‘çš„äºŒä¹‰æ€§</strong>ã€‚</p>
<p>ES6 ç®­å¤´å‡½æ•°çš„å‡ºç°ï¼Œå¹¶éä»…ä»…æ˜¯è¯­æ³•ç³–ï¼Œå®ƒæ˜¯ä¸€åœºæ—¨åœ¨ <strong>è§£å†³å‡½æ•°äºŒä¹‰æ€§</strong> çš„å“²å­¦é©å‘½ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥å½»åº•è®²æ¸…æ¥šï¼Œç®­å¤´å‡½æ•°å¦‚ä½•è®©æˆ‘ä»¬å‘Šåˆ«å‡½æ•°çš„â€œä¸¤é¢æ´¾â€äººç”Ÿã€‚</p>
<h3 data-id="heading-0">ä¸€ã€ ä»€ä¹ˆæ˜¯å‡½æ•°çš„â€œäºŒä¹‰æ€§â€ï¼Ÿ</h3>
<p>åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œ<code>this</code> çš„å€¼æ˜¯åœ¨<strong>å‡½æ•°è¢«è°ƒç”¨æ—¶</strong>åŠ¨æ€ç»‘å®šçš„ã€‚å®ƒå°±åƒä¸€ä¸ªâ€œå˜è‰²é¾™â€ï¼Œå…¶æŒ‡å‘å®Œå…¨å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œäºŒä¹‰æ€§â€ï¼ˆæˆ–å¤šä¹‰æ€§ï¼‰â€”â€”åœ¨å‡½æ•°å®šä¹‰æ—¶ï¼Œä½ æ— æ³•ç™¾åˆ†ç™¾ç¡®å®š <code>this</code> æ˜¯è°ï¼Œå¿…é¡»æ ¹æ®è°ƒç”¨ä¸Šä¸‹æ–‡æ¥åˆ¤æ–­ã€‚</p>
<p>è¿™ç§åŠ¨æ€æ€§å¯¼è‡´äº†æ— æ•°çš„ Bug å’Œå¿ƒæ™ºè´Ÿæ‹…ã€‚ä¸»è¦ä½“ç°ä¸ºï¼š</p>
<ol>
<li><strong>é»˜è®¤ç»‘å®š</strong>ï¼šåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œ<code>this</code> æŒ‡å‘ <code>window</code>ï¼ˆæµè§ˆå™¨ä¸­ï¼‰ï¼›ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸º <code>undefined</code>ã€‚</li>
<li><strong>éšå¼ç»‘å®š</strong>ï¼šå‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œ<code>this</code> æŒ‡å‘è¯¥å¯¹è±¡ã€‚</li>
<li><strong>æ˜¾å¼ç»‘å®š</strong>ï¼šé€šè¿‡ <code>call</code>, <code>apply</code>, <code>bind</code> æ–¹æ³•å¼ºåˆ¶æŒ‡å®š <code>this</code>ã€‚</li>
<li><strong><code>new</code> ç»‘å®š</strong>ï¼šä½¿ç”¨ <code>new</code> æ“ä½œç¬¦è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œ<code>this</code> æŒ‡å‘æ–°åˆ›å»ºçš„å®åŠ›ã€‚</li>
</ol>
<p>è¿™ç§â€œå¤šé‡èº«ä»½â€æ˜¯ JavaScript çµæ´»æ€§çš„ä½“ç°ï¼Œä½†ä¹Ÿæ­£æ˜¯æ··ä¹±çš„æ ¹æºã€‚</p>
<h3 data-id="heading-1">äºŒã€ ç®­å¤´å‡½æ•°ï¼š<code>this</code> ç»‘å®šçš„â€œå®šæµ·ç¥é’ˆâ€</h3>
<p>ç®­å¤´å‡½æ•°çš„æ ¸å¿ƒç†å¿µä¹‹ä¸€å°±æ˜¯ï¼š<strong>æ¶ˆé™¤ <code>this</code> çš„äºŒä¹‰æ€§</strong>ã€‚
å®ƒé€šè¿‡ä¸€ä¸ªç®€å•çš„è§„åˆ™å®ç°äº†è¿™ä¸€ç‚¹ï¼š</p>
<p><strong>ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ <code>this</code>ã€‚å®ƒå†…éƒ¨çš„ <code>this</code> å€¼ç»§æ‰¿è‡ªå…¶å®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯å¤–å±‚ä»£ç å—çš„ <code>this</code>ã€‚å¹¶ä¸”ä¸€æ—¦ç»‘å®šï¼Œç»ˆèº«ä¸å˜ã€‚</strong></p>
<p><strong>è¿™è¢«ç§°ä¸º â€œè¯æ³•ä½œç”¨åŸŸ <code>this</code>â€</strong> æˆ– <strong>â€œé™æ€ç»‘å®š <code>this</code>â€ã€‚</strong></p>
<h5 data-id="heading-2">æ·±åº¦å¯¹æ¯”ï¼šä¸€ä¸ªç»å…¸çš„ <code>this</code> é™·é˜±</h5>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåœ¨å‰ç«¯å¼€å‘ä¸­å¸ç©ºè§æƒ¯çš„åœºæ™¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>;
  }

  <span class="hljs-comment">// ä½¿ç”¨æ™®é€šå‡½æ•°</span>
  <span class="hljs-title function_">startWithNormal</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è¿™ä¸ª `this` æ˜¯ setInterval è°ƒç”¨è¿™ä¸ªæ™®é€šå‡½æ•°æ—¶çš„ `this`ï¼Œé»˜è®¤æŒ‡å‘ window/undefined</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Normal:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>); <span class="hljs-comment">// è¾“å‡ºï¼šNormal: NaN (æˆ–ç›´æ¥æŠ¥é”™)</span>
    }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-comment">// ä½¿ç”¨ç®­å¤´å‡½æ•°</span>
  <span class="hljs-title function_">startWithArrow</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// è¿™ä¸ª `this` ç»§æ‰¿è‡ª startWithArrow æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•è¢« Counter å®ä¾‹è°ƒç”¨ï¼Œæ‰€ä»¥ this æŒ‡å‘ Counter å®ä¾‹</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Arrow:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>); <span class="hljs-comment">// è¾“å‡ºï¼šArrow: 1, Arrow: 2, ...</span>
    }, <span class="hljs-number">1000</span>);
  }
}

<span class="hljs-keyword">const</span> myCounter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-comment">// myCounter.startWithNormal(); // é”™è¯¯ï¼</span>
myCounter.<span class="hljs-title function_">startWithArrow</span>(); <span class="hljs-comment">// æ­£ç¡®ï¼</span>
</code></pre>
<p><strong>æ·±åº¦è§£æï¼š</strong></p>
<ul>
<li><strong><code>startWithNormal</code></strong>: <code>setInterval</code> çš„å›è°ƒæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚å½“å®ƒè¢« <code>setInterval</code> è°ƒç”¨æ—¶ï¼Œæ‰§è¡Œçš„æ˜¯<strong>é»˜è®¤ç»‘å®š</strong>è§„åˆ™ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ˆES6 class é»˜è®¤ä¸ºä¸¥æ ¼æ¨¡å¼ï¼‰ï¼Œ<code>this</code> ä¸º <code>undefined</code>ï¼Œè®¿é—® <code>undefined.count</code> è‡ªç„¶å¯¼è‡´ <code>NaN</code> æˆ–é”™è¯¯ã€‚</li>
<li><strong><code>startWithArrow</code></strong>: ç®­å¤´å‡½æ•°åœ¨å®šä¹‰æ—¶ï¼Œå°±ç¡®å®šäº† <code>this</code> çš„å€¼ã€‚å®ƒå¯»æ‰¾å¤–å±‚ä½œç”¨åŸŸ <code>startWithArrow</code> çš„ <code>this</code>ã€‚ç”±äº <code>startWithArrow</code> æ˜¯ä½œä¸º <code>myCounter</code> å®ä¾‹çš„æ–¹æ³•è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥å®ƒçš„ <code>this</code> æŒ‡å‘ <code>myCounter</code>ã€‚è¿™ä¸ªå…³ç³»åœ¨ç®­å¤´å‡½æ•°è¯ç”Ÿçš„ä¸€åˆ»å°±è¢«â€œé”å®šâ€äº†ï¼Œæ— è®ºä¹‹åè°è°ƒç”¨å®ƒï¼Œ<code>this</code> éƒ½é›·æ‰“ä¸åŠ¨ã€‚</li>
</ul>
<p><strong>è¿™ï¼Œå°±æ˜¯è§£å†³äºŒä¹‰æ€§çš„åŠ›é‡ï¼</strong> ä½ å†ä¹Ÿä¸éœ€è¦ <code>const that = this</code>ã€<code>.bind(this)</code> è¿™ç§ Hack æ‰‹æ®µäº†ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€ ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°çš„å…¨æ–¹ä½åŒºåˆ«</h3>
<p>é™¤äº† <code>this</code> ç»‘å®šè¿™ä¸ªæœ€æ ¸å¿ƒçš„åŒºåˆ«ï¼ŒäºŒè€…åœ¨å…¶ä»–æ–¹é¢ä¹Ÿæ³¾æ¸­åˆ†æ˜ã€‚ç†è§£è¿™äº›ï¼Œèƒ½è®©ä½ åœ¨æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨æ­£ç¡®çš„å·¥å…·ã€‚</p>








































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">æ™®é€šå‡½æ•°</th><th align="left">ç®­å¤´å‡½æ•°</th></tr></thead><tbody><tr><td align="left"><strong><code>this</code> ç»‘å®š</strong></td><td align="left">åŠ¨æ€ç»‘å®šï¼Œç”±è°ƒç”¨æ–¹å¼å†³å®š</td><td align="left">é™æ€ç»‘å®šï¼Œç»§æ‰¿è‡ªå¤–å±‚ä½œç”¨åŸŸ</td></tr><tr><td align="left"><strong><code>arguments</code> å¯¹è±¡</strong></td><td align="left">æœ‰è‡ªå·±çš„ <code>arguments</code> å¯¹è±¡</td><td align="left"><strong>æ²¡æœ‰</strong>è‡ªå·±çš„ <code>arguments</code> å¯¹è±¡ï¼Œéœ€ä»å¤–å±‚è·å–</td></tr><tr><td align="left"><strong><code>prototype</code> å±æ€§</strong></td><td align="left">æœ‰ <code>prototype</code> å±æ€§ï¼Œå¯ç”¨äº <code>new</code></td><td align="left"><strong>æ²¡æœ‰</strong> <code>prototype</code> å±æ€§ï¼Œ<strong>ä¸èƒ½</strong>ç”¨ä½œæ„é€ å‡½æ•°</td></tr><tr><td align="left"><strong><code>yield</code> å‘½ä»¤</strong></td><td align="left">å¯ä»¥ä½œä¸º Generator å‡½æ•°</td><td align="left"><strong>ä¸èƒ½</strong>ä½¿ç”¨ <code>yield</code> å‘½ä»¤ï¼Œä¸èƒ½ä½œä¸º Generator å‡½æ•°</td></tr><tr><td align="left"><strong>è¯­æ³•</strong></td><td align="left"><code>function name() {}</code></td><td align="left"><code>(params) =&gt; { body }</code>ï¼Œç®€æ´ï¼Œå¯éšå¼è¿”å›</td></tr><tr><td align="left"><strong>ä½œä¸ºæ–¹æ³•</strong></td><td align="left">é€‚åˆä½œä¸ºå¯¹è±¡æ–¹æ³•ï¼Œ<code>this</code> æŒ‡å‘å¯¹è±¡</td><td align="left"><strong>ä¸é€‚åˆ</strong>ä½œä¸ºå¯¹è±¡æ–¹æ³•ï¼Œ<code>this</code> å¯èƒ½æŒ‡å‘å…¨å±€</td></tr></tbody></table>
<h4 data-id="heading-4">é‡ç‚¹è§£è¯»ï¼š</h4>
<ol>
<li>
<p><strong>æ²¡æœ‰ <code>arguments</code></strong>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">normal</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]); }
<span class="hljs-keyword">const</span> <span class="hljs-title function_">arrow</span> = (<span class="hljs-params"/>) =&gt; { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]); } <span class="hljs-comment">// æŠ¥é”™ï¼šarguments is not defined</span>

<span class="hljs-title function_">normal</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 1</span>
<span class="hljs-title function_">arrow</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// Error</span>

<span class="hljs-comment">// ç®­å¤´å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ Rest parameters æ›¿ä»£</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">arrowWithRest</span> = (<span class="hljs-params">...args</span>) =&gt; { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(args[<span class="hljs-number">0</span>]); }
<span class="hljs-title function_">arrowWithRest</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 1</span>
</code></pre>
</li>
<li>
<p><strong>ä¸èƒ½ä½¿ç”¨ <code>new</code></strong>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">NormalFunc</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ArrowFunc</span> = (<span class="hljs-params"/>) =&gt; {};

<span class="hljs-keyword">const</span> n = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NormalFunc</span>(); <span class="hljs-comment">// OK</span>
<span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrowFunc</span>();  <span class="hljs-comment">// TypeError: ArrowFunc is not a constructor</span>
</code></pre>
<p>å› ä¸ºç®­å¤´å‡½æ•°æ²¡æœ‰ <code>[[Construct]]</code> å†…éƒ¨æ–¹æ³•å’Œ <code>prototype</code> å±æ€§ï¼Œè¿™æ˜¯è¯­è¨€å±‚é¢çš„é™åˆ¶ã€‚</p>
</li>
</ol>
<h3 data-id="heading-5">å››ã€ å¦‚ä½•é€‰æ‹©ï¼šå›å½’æœ¬è´¨ï¼ŒæŒ‰éœ€ç´¢å–</h3>
<p>ç†è§£äº†åŒºåˆ«ï¼Œé€‰æ‹©å°±å˜å¾—ç®€å•ï¼š</p>
<ul>
<li>
<p><strong>ä½¿ç”¨ç®­å¤´å‡½æ•°çš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li>éœ€è¦ç»§æ‰¿å¤–å±‚ <code>this</code> çš„åœºæ™¯ï¼ˆå¦‚å›è°ƒã€å®šæ—¶å™¨ã€äº‹ä»¶å¤„ç†å™¨ï¼‰ã€‚</li>
<li>ä¸éœ€è¦è‡ªèº« <code>this</code>ã€<code>arguments</code>ã€<code>super</code> æˆ– <code>new.target</code> çš„å‡½æ•°ã€‚</li>
<li>ç®€å•çš„ã€çº¯è®¡ç®—çš„å‡½æ•°ï¼ˆåˆ©ç”¨å…¶ç®€æ´è¯­æ³•ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨æ™®é€šå‡½æ•°çš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li>éœ€è¦åŠ¨æ€ <code>this</code> çš„åœºæ™¯ï¼ˆå¦‚å¯¹è±¡æ–¹æ³•ã€éœ€è¦è¢« <code>call/apply</code> çš„å‡½æ•°ï¼‰ã€‚</li>
<li>éœ€è¦ä½œä¸º<strong>æ„é€ å‡½æ•°</strong>ä½¿ç”¨ã€‚</li>
<li>éœ€è¦åœ¨å…¶å†…éƒ¨ä½¿ç”¨ <code>arguments</code> å¯¹è±¡ï¼ˆå°½ç®¡ Rest parameters æ˜¯æ›´å¥½çš„æ›¿ä»£ï¼‰ã€‚</li>
<li>éœ€è¦ä½œä¸º <strong>Generator å‡½æ•°</strong>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç‰¹åˆ«æé†’</strong>ï¼šåœ¨ Vue æˆ– React ä¸­ï¼Œç±»ç»„ä»¶çš„æ–¹æ³•å¦‚æœéœ€è¦ä½¿ç”¨ <code>this</code> è®¿é—®ç»„ä»¶å®ä¾‹ï¼Œåº”ä½¿ç”¨æ™®é€šå‡½æ•°å¹¶è§†æƒ…å†µç»‘å®šï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨<strong>ç±»å­—æ®µ+ç®­å¤´å‡½æ•°</strong>çš„æ–¹å¼æ¥å®šä¹‰æ–¹æ³•ï¼Œä¸€åŠ³æ°¸é€¸ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  <span class="hljs-comment">// æ–¹å¼ä¸€ï¼šç±»å­—æ®µ + ç®­å¤´å‡½æ•° (æ¨è)</span>
  handleClick = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// æ°¸è¿œæŒ‡å‘ç»„ä»¶å®ä¾‹</span>
  };

  <span class="hljs-comment">// æ–¹å¼äºŒï¼šæ™®é€šå‡½æ•°ï¼Œéœ€åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šæˆ–ä½¿ç”¨æ—¶ç»‘å®š</span>
  <span class="hljs-title function_">handleHover</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// å¦‚æœä¸ç»‘å®šï¼Œå¯èƒ½æ˜¯ undefined</span>
  }

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>Click Me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
  }
}
</code></pre>
<h3 data-id="heading-6">äº”ã€ æ€»ç»“ï¼šä»â€œæ··æ²Œâ€åˆ°â€œç§©åºâ€</h3>
<p>ç®­å¤´å‡½æ•°ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¯­æ³•ä¸Šçš„è¿›æ­¥ï¼Œå®ƒæ›´æ˜¯ JavaScript è¯­è¨€è®¾è®¡æ€æƒ³çš„ä¸€æ¬¡è¿›åŒ–ã€‚å®ƒé€šè¿‡ <strong>â€œè¯æ³•ä½œç”¨åŸŸ <code>this</code>â€</strong> è¿™ä¸€æ¸…æ™°ã€ç¡®å®šçš„è§„åˆ™ï¼Œå°†å‡½æ•°ä» <code>this</code> ç»‘å®šçš„â€œæ··æ²Œâ€ä¸â€œäºŒä¹‰æ€§â€ä¸­è§£æ”¾å‡ºæ¥ã€‚</p>
<p>å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼Œå¹¶éæ‰€æœ‰å‡½æ•°éƒ½éœ€è¦ä¸€ä¸ªåŠ¨æ€çš„ã€ä¸è°ƒç”¨è€…è€¦åˆçš„ <code>this</code>ã€‚å¯¹äºå¤§é‡åªéœ€è¦æ‰§è¡Œé€»è¾‘ã€ä¸å…³å¿ƒè°ƒç”¨è€…çš„å‡½æ•°æ¥è¯´ï¼Œä¸€ä¸ªç¡®å®šçš„ã€å¯é¢„æµ‹çš„ <code>this</code> æ‰æ˜¯çœŸæ­£çš„ç¦éŸ³ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸‹æ¬¡å½“ä½ æ‹¿èµ·â€œå‡½æ•°â€è¿™æŠŠç‘å£«å†›åˆ€æ—¶ï¼Œè¯·å…ˆé—®è‡ªå·±ï¼šæˆ‘éœ€è¦çš„æ˜¯ä¸€ä¸ªâ€œå˜è‰²é¾™â€èˆ¬çš„æ™®é€šå‡½æ•°ï¼Œè¿˜æ˜¯ä¸€ä¸ªâ€œç£çŸ³â€èˆ¬çš„ç®­å¤´å‡½æ•°ï¼Ÿç­”æ¡ˆï¼Œå·²ç„¶åœ¨ä½ å¿ƒä¸­ã€‚</p>
<hr/>
<p>å¸Œæœ›è¿™ç¯‡æœ‰æ·±åº¦å’Œå¹¿åº¦çš„æ–‡ç« èƒ½å¸®åŠ©ä½ å½»åº•ç†è§£ç®­å¤´å‡½æ•°çš„æ ¸å¿ƒä»·å€¼ï¼å¦‚æœè§‰å¾—æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—å’Œåˆ†äº«ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…è´¹çš„ Vibe Coding åŠ©æ‰‹ï¼Ÿä½ æƒ³è¦çš„Gemini CLI éƒ½æœ‰]]></title>    <link>https://juejin.cn/post/7570769486707540006</link>    <guid>https://juejin.cn/post/7570769486707540006</guid>    <pubDate>2025-11-10T09:00:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570769486707540006" data-draft-id="7570903763720962058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…è´¹çš„ Vibe Coding åŠ©æ‰‹ï¼Ÿä½ æƒ³è¦çš„Gemini CLI éƒ½æœ‰"/> <meta itemprop="keywords" content="åç«¯,äººå·¥æ™ºèƒ½,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-11-10T09:00:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…è´¹çš„ Vibe Coding åŠ©æ‰‹ï¼Ÿä½ æƒ³è¦çš„Gemini CLI éƒ½æœ‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:00:21.000Z" title="Mon Nov 10 2025 09:00:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤©ä¸‹è‹¦ Claude ä¹…çŸ£ã€‚</p>
<p>9æœˆä»½ Anthropic å°ç¦ä¸­å›½ç”¨æˆ·ä½¿ç”¨ Claudeï¼Œç›´æ¥åœ¨å®˜ç½‘æŠŠä¸­å›½æˆä¸ºæ•Œå¯¹å›½å®¶ï¼ˆadversarial nationsï¼‰ï¼Œæ€åº¦æå…¶æ¶åŠ£ã€‚å¾ˆå¤šä¸­å›½ç”¨æˆ·éƒ½è¢«æ¶å¿ƒåˆ°äº†ï¼ŒèŠ±é’±è¿˜è¦è¢«æ­§è§†ï¼Ÿ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/246a594b446e4290b57eed586e40a62a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=UYJ%2Fz1QEyJbXAohx%2F8G5uwtUrzI%3D" alt="" loading="lazy"/></p>
<p>å…³é”®æ˜¯ Claude Code è¿˜ä¸ä¾¿å®œï¼Œ20ç¾åˆ€èµ·æ­¥ï¼Œä¸“ä¸šç‰ˆéœ€è¦200åˆ€ã€‚å°±ç®—èŠ±äº†200åˆ€ï¼ŒClaude Code è¿˜é™æ™ºäº†ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œè¿™ä¸ª Claude Code ä¸ç”¨å°±ä¸ç”¨äº†å‘—ï¼Œå¯ä»¥è½¬å…¶ä»–æ›¿ä»£å“ã€‚æ—©åœ¨6æœˆä»½è°·æ­Œå°±æ¨å‡ºäº† Gemini CLIï¼Œå…è´¹ä¸”æ²¡æœ‰é™åˆ¶ï¼Œç•Œé¢å‡ ä¹ä¸€æ ·ï¼ŒåŠŸèƒ½ä¹Ÿå·®ä¸å¤šï¼Œå¯¹ Claude Code çš„é™ç»´æ‰“å‡»ã€‚</p>
<ul>
<li>
<p>å…è´¹å¥—é¤ï¼šä½¿ç”¨ä¸ªäºº Google å¸æˆ·ï¼Œæ¯åˆ†é’Ÿ 60 ä¸ªè¯·æ±‚ï¼Œæ¯å¤© 1,000 ä¸ªè¯·æ±‚</p>
</li>
<li>
<p>Gemini 2.5 Proï¼šè®¿é—® 1M ä»¤ç‰Œä¸Šä¸‹æ–‡çª—å£</p>
</li>
<li>
<p>å†…ç½®å·¥å…·ï¼šGoogle æœç´¢åŸºç¡€ã€æ–‡ä»¶æ“ä½œã€shell å‘½ä»¤ã€ç½‘é¡µæŠ“å–</p>
</li>
<li>
<p>å¯æ‰©å±•ï¼šMCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æ”¯æŒè‡ªå®šä¹‰é›†æˆ</p>
</li>
<li>
<p>Terminal-firstï¼šä¸“ä¸ºä½¿ç”¨å‘½ä»¤è¡Œçš„å¼€å‘äººå‘˜è®¾è®¡</p>
</li>
<li>
<p>å¼€æºï¼šApache 2.0 è®¸å¯</p>
</li>
</ul>
<h2 data-id="heading-0">å¦‚ä½•å®‰è£…Gemini CLI</h2>
<p>Gemini CLI çš„è¿è¡Œæ¡ä»¶æ˜¯éœ€è¦ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fnodejs" target="_blank" title="https://www.servbay.com/features/nodejs" ref="nofollow noopener noreferrer">Node.js 20</a> æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç”¨ ServBay å¿«é€Ÿå®‰è£…éœ€è¦çš„ç¯å¢ƒã€‚</p>
<h3 data-id="heading-1">å‰æœŸå‡†å¤‡</h3>
<p>ä»å®˜ç½‘ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD%25E5%25B9%25B6%25E5%25AE%2589%25E8%25A3%2585%25E5%25A5%25BD" target="_blank" title="https://www.servbay.com%EF%BC%89%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85%E5%A5%BD" ref="nofollow noopener noreferrer">www.servbay.comï¼‰ä¸‹è½½å¹¶å®‰è£…å¥½</a> ServBay</p>
<p>å·¦è¾¹çš„èœå•ä¸­é€‰æ‹©ã€Œè½¯ä»¶åŒ…ã€ï¼Œé€‰æ‹© Node.js ï¼Œç‚¹å‡»éœ€è¦çš„ç‰ˆæœ¬å®‰è£…å³å¯ã€‚å…¨ç¨‹1åˆ†é’Ÿæå®šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cb64af471464e89a92b2907372e12fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=DDGsRxoA1Lum2I1raeroLTGh63o%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œè¦æ³¨æ„ï¼Œè¦é€‰æ‹©ç‰ˆæœ¬18ä»¥ä¸Šçš„æ‰è¡Œã€‚</p>
<p>æ¥ç€åœ¨ç»ˆç«¯éªŒè¯ä¸€ä¸‹ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com" target="_blank" title="https://www.servbay.com" ref="nofollow noopener noreferrer">Node.js ç¯å¢ƒ</a>æ˜¯å¦å‡†å¤‡å¥½äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbb0360b64cf4b4591bed6350b24c4c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=71pCWd7GatvUQDn%2BzA4oJYyLeR4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">å¿«é€Ÿå®‰è£… Gemini CLI</h3>
<p>ç¯å¢ƒå‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å®‰è£… Gemini CLI äº†ã€‚</p>
<p>å…ˆè¿è¡Œ CLIï¼Œåœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">npx https:<span class="hljs-comment">//github.com/google-gemini/gemini-cli</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edc7efd2b2b74d65a98cc17c4fbd3bab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=72NvPTrq8t4qrKKJFzm60sULy9k%3D" alt="" loading="lazy"/></p>
<p>é€‰æ‹©ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„ä¸»é¢˜é¢œè‰²</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/301c8a2fde624db79530000c731b21fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=Bc4xpCBjGL3S5XWQ3ZfDcncWWK4%3D" alt="" loading="lazy"/></p>
<p>æ¥ç€èº«ä»½éªŒè¯ï¼Œç”¨è‡ªå·±çš„ä¸ªäºº Google å¸æˆ·ç™»å½•å°±å¥½äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2995f916fc09499380bb436993b24654~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=Ml2fJYyBLu3Px5LvQiWAKLBjrFY%3D" alt="" loading="lazy"/></p>
<p>ç¨ç­‰ç‰‡åˆ»ï¼Œå®‰è£…å®Œæˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8ea7bb731224e3aae589ec965f1307b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=opyz1vfvq%2BjdNcWzf6qcZnc7%2FeE%3D" alt="" loading="lazy"/></p>
<p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ Gemini CLI äº†ï¼Œå…¨ç¨‹ä¸åˆ°5åˆ†é’Ÿï¼Œéå¸¸ç®€å•ã€‚</p>
<p>å¦‚æœè¿˜éœ€è¦ä½¿ç”¨ç‰¹å®šæ¨¡å‹æˆ–éœ€è¦æ›´é«˜çš„è¯·æ±‚å®¹é‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ API å¯†é’¥</p>
<pre><code class="hljs language-ini" lang="ini">export <span class="hljs-attr">GEMINI_API_KEY</span>=<span class="hljs-string">"YOUR_API_KEY"</span>
</code></pre>
<h2 data-id="heading-3">å®é™…ä½¿ç”¨åœºæ™¯</h2>
<p>æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹å®é™…ä½¿ç”¨çš„æ•ˆæœã€‚ä»ç®€å•çš„å¼€å§‹ã€‚</p>
<p>æˆ‘è®© Gemini CLI åˆ†ægithubçš„ç½‘å€ï¼Œç„¶åå¸®æˆ‘ç”Ÿæˆä¸€ä¸ªPPTã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56b616406cfc426bb76f73eee3aa5e60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=JFPC7Jb2XaDZRZPYfWzpncfX%2F50%3D" alt="" loading="lazy"/></p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒGeminiä¼šè¯·æ±‚æƒé™ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b301fe7db043aea9f1c6873e1cc633~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=y9xEiHdlteH49Cewr99D5LFHOlE%3D" alt="" loading="lazy"/></p>
<p>ç­‰äº†ä¸€ä¼šï¼ŒGeminiè¾“å‡ºäº†PPTçš„å†…å®¹ï¼Œä½†ä¸æ˜¯å…·ä½“å®Œæ•´çš„PPTã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ef72af1d2964702adef538006b0a292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=iByGdu3NT3p6LJHALG%2F4pf8NIyU%3D" alt="" loading="lazy"/></p>
<p>PPTè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆä¸Šç¼–è¾‘å™¨ä¸€èµ·æ¥ä½¿ç”¨ï¼Œè®© Gemini å¸®æˆ‘ä»¬å†™ä»£ç ã€‚åœ¨VS Code ä¸­æœç´¢ Gemini CLI æ‰©å±•ï¼Œä¸‹è½½å®‰è£…ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047ec4e44a0f4af7888dfa9d1a276ea4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=EVdPdmS8o3e8NaYSuA%2Bcx8BHbeU%3D" alt="" loading="lazy"/></p>
<p>æˆ‘è®© Gemini CLI å¸®æˆ‘åšä¸ªè´ªåƒè›‡å°æ¸¸æˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2debdf2dec074215991e6dca80f863de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=6%2BOY3D78GsdxxT5UvZjvScpOdBk%3D" alt="" loading="lazy"/></p>
<p>åšå®Œåå‘ç°å‡ºäº†bugï¼Œç›´æ¥è®© Gemini ä¿®æ”¹ã€‚æœ€åæˆå“å°±æ˜¯è¿™æ ·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/725d3aa1f87e4a38b7eddf6079095e6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763370021&amp;x-signature=roG83Dl4dDluzBt3Qfy1xV65veA%3D" alt="" loading="lazy"/></p>
<p>å› ä¸ºæŒ‡ä»¤æ¯”è¾ƒç®€å•ï¼Œå‘ˆç°å‡ºæ¥çš„æ•ˆæœä¹Ÿæ¯”è¾ƒä¸€èˆ¬ã€‚å¦‚æœæ˜¯æ­£å„¿å…«ç»åšé¡¹ç›®ï¼Œå¯ä»¥è®©Geminiç”Ÿæˆéœ€æ±‚æ–‡æ¡£ã€æŠ€æœ¯æ–‡æ¡£ï¼Œä¸€æ­¥æ­¥å®ç°è‡ªå·±çš„æƒ³æ³•</p>
<h2 data-id="heading-4">æœ€å</h2>
<p>ServBay ä¸€é”®æå®šå¤æ‚çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures" target="_blank" title="https://www.servbay.com/features" ref="nofollow noopener noreferrer">æœ¬åœ°å¼€å‘ç¯å¢ƒ</a>ï¼ŒGemini CLI å°±å¸®æˆ‘å†™ä»£ç ï¼Œæˆ‘å°±å¤æ‚æ‘¸é±¼ï¼Œæ¯ä¸ªäººéƒ½æœ‰å…‰æ˜çš„æœªæ¥ï¼Œçˆ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æ Vue SSR ç¼–è¯‘å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼šcompile]]></title>    <link>https://juejin.cn/post/7569959427878273034</link>    <guid>https://juejin.cn/post/7569959427878273034</guid>    <pubDate>2025-11-09T00:15:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569959427878273034" data-draft-id="7569976345929859123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æ Vue SSR ç¼–è¯‘å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼šcompile"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-09T00:15:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æ Vue SSR ç¼–è¯‘å™¨çš„æ ¸å¿ƒå‡½æ•°ï¼šcompile
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T00:15:19.000Z" title="Sun Nov 09 2025 00:15:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Vue 3 çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSR, Server-Side Renderingï¼‰ä½“ç³»ä¸­ï¼Œ<code>compile()</code> æ˜¯ä¸€ä¸ªå…³é”®å‡½æ•°ã€‚å®ƒè´Ÿè´£å°†æ¨¡æ¿å­—ç¬¦ä¸²æˆ– AST æŠ½è±¡è¯­æ³•æ ‘è½¬åŒ–ä¸º <strong>å¯åœ¨æœåŠ¡ç«¯æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°</strong>ï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„ HTML å­—ç¬¦ä¸²ã€‚</p>
<p>æœ¬æ–‡æˆ‘ä»¬å°†æ·±å…¥è§£æ <code>compile</code> çš„å®Œæ•´å®ç°ï¼Œå‰–æå…¶åº•å±‚æœºåˆ¶ä¸è®¾è®¡å“²å­¦ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µï¼š<code>compile</code> æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</h2>
<p><code>compile</code> æ˜¯ Vue SSR ç¼–è¯‘æµç¨‹çš„å…¥å£å‡½æ•°ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼äºå‰ç«¯ç‰ˆæœ¬çš„ <code>@vue/compiler-dom</code> çš„ <code>compile</code>ï¼Œä½†ä¸“ä¸ºæœåŠ¡ç«¯æ¸²æŸ“ä¼˜åŒ–ã€‚<br/>
å®ƒä¸»è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªä»»åŠ¡ï¼š</p>
<ol>
<li><strong>è§£ææ¨¡æ¿</strong>ï¼ˆParsingï¼‰â†’ ç”Ÿæˆ ASTï¼›</li>
<li><strong>æ‰§è¡Œè½¬æ¢</strong>ï¼ˆTransformï¼‰â†’ ä¸º SSR æ³¨å…¥ç‰¹å®šé€»è¾‘ï¼›</li>
<li><strong>ç”Ÿæˆä»£ç </strong>ï¼ˆCodegenï¼‰â†’ è¾“å‡ºæœåŠ¡ç«¯å¯æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°ä»£ç ã€‚</li>
</ol>
<p>æ ¸å¿ƒç›®æ ‡ï¼šæŠŠ <code>.vue</code> æ¨¡æ¿è½¬åŒ–ä¸ºæœåŠ¡ç«¯å¯è¿è¡Œçš„æ¸²æŸ“å‡½æ•°ï¼Œä½¿å¾—åŒä¸€æ¨¡æ¿åœ¨ Node.js ç¯å¢ƒä¸‹å¯ä»¥ç”Ÿæˆ HTML å­—ç¬¦ä¸²ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€åŸç†ï¼šä»æ¨¡æ¿åˆ°æ¸²æŸ“å‡½æ•°çš„ç¼–è¯‘æµç¨‹</h2>
<p>æ¥çœ‹å®Œæ•´æºç ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">export</span> <span class="hljs-string">function</span> <span class="hljs-string">compile(</span>
  <span class="hljs-attr">source:</span> <span class="hljs-string">string</span> <span class="hljs-string">|</span> <span class="hljs-string">RootNode,</span>
  <span class="hljs-attr">options:</span> <span class="hljs-string">CompilerOptions</span> <span class="hljs-string">=</span> {}<span class="hljs-string">,</span>
<span class="hljs-string">):</span> <span class="hljs-string">CodegenResult</span> {
  <span class="hljs-string">options</span> <span class="hljs-string">=</span> {
    <span class="hljs-string">...options</span>,
    <span class="hljs-string">...parserOptions</span>,
    <span class="hljs-attr">ssr:</span> <span class="hljs-literal">true</span>,
    <span class="hljs-attr">inSSR:</span> <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scopeId:</span> <span class="hljs-string">options.mode</span> <span class="hljs-string">===</span> <span class="hljs-string">'function'</span> <span class="hljs-string">?</span> <span class="hljs-attr">null :</span> <span class="hljs-string">options.scopeId</span>,
    <span class="hljs-attr">prefixIdentifiers:</span> <span class="hljs-literal">true</span>,
    <span class="hljs-attr">cacheHandlers:</span> <span class="hljs-literal">false</span>,
    <span class="hljs-attr">hoistStatic:</span> <span class="hljs-literal">false</span>,
  }

  <span class="hljs-string">const</span> <span class="hljs-string">ast</span> <span class="hljs-string">=</span> <span class="hljs-string">typeof</span> <span class="hljs-string">source</span> <span class="hljs-string">===</span> <span class="hljs-string">'string'</span> <span class="hljs-string">?</span> <span class="hljs-string">baseParse(source</span>, <span class="hljs-string">options)</span> <span class="hljs-string">:</span> <span class="hljs-string">source</span>
  <span class="hljs-string">rawOptionsMap.set(ast</span>, <span class="hljs-string">options)</span>

  <span class="hljs-string">transform(ast</span>, {
    <span class="hljs-string">...options</span>,
    <span class="hljs-attr">hoistStatic:</span> <span class="hljs-literal">false</span>,
    <span class="hljs-attr">nodeTransforms:</span> [
      <span class="hljs-string">transformVBindShorthand</span>,
      <span class="hljs-string">ssrTransformIf</span>,
      <span class="hljs-string">ssrTransformFor</span>,
      <span class="hljs-string">trackVForSlotScopes</span>,
      <span class="hljs-string">transformExpression</span>,
      <span class="hljs-string">ssrTransformSlotOutlet</span>,
      <span class="hljs-string">ssrInjectFallthroughAttrs</span>,
      <span class="hljs-string">ssrInjectCssVars</span>,
      <span class="hljs-string">ssrTransformElement</span>,
      <span class="hljs-string">ssrTransformComponent</span>,
      <span class="hljs-string">trackSlotScopes</span>,
      <span class="hljs-string">transformStyle</span>,
      <span class="hljs-string">...(options.nodeTransforms</span> <span class="hljs-string">||</span> []<span class="hljs-string">)</span>,
    ],
    <span class="hljs-attr">directiveTransforms:</span> {
      <span class="hljs-attr">bind:</span> <span class="hljs-string">transformBind</span>,
      <span class="hljs-attr">on:</span> <span class="hljs-string">transformOn</span>,
      <span class="hljs-attr">model:</span> <span class="hljs-string">ssrTransformModel</span>,
      <span class="hljs-attr">show:</span> <span class="hljs-string">ssrTransformShow</span>,
      <span class="hljs-attr">cloak:</span> <span class="hljs-string">noopDirectiveTransform</span>,
      <span class="hljs-attr">once:</span> <span class="hljs-string">noopDirectiveTransform</span>,
      <span class="hljs-attr">memo:</span> <span class="hljs-string">noopDirectiveTransform</span>,
      <span class="hljs-string">...(options.directiveTransforms</span> <span class="hljs-string">||</span> {}<span class="hljs-string">)</span>,
    },
  }<span class="hljs-string">)</span>

  <span class="hljs-string">ssrCodegenTransform(ast</span>, <span class="hljs-string">options)</span>

  <span class="hljs-string">return</span> <span class="hljs-string">generate(ast</span>, <span class="hljs-string">options)</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-2">ğŸ” æ­¥éª¤ 1ï¼šé…ç½®ç¼–è¯‘é€‰é¡¹</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">options</span> <span class="hljs-string">=</span> {
  <span class="hljs-string">...options</span>,
  <span class="hljs-string">...parserOptions</span>,
  <span class="hljs-attr">ssr:</span> <span class="hljs-literal">true</span>,
  <span class="hljs-attr">inSSR:</span> <span class="hljs-literal">true</span>,
  <span class="hljs-attr">scopeId:</span> <span class="hljs-string">options.mode</span> <span class="hljs-string">===</span> <span class="hljs-string">'function'</span> <span class="hljs-string">?</span> <span class="hljs-attr">null :</span> <span class="hljs-string">options.scopeId</span>,
  <span class="hljs-attr">prefixIdentifiers:</span> <span class="hljs-literal">true</span>,
  <span class="hljs-attr">cacheHandlers:</span> <span class="hljs-literal">false</span>,
  <span class="hljs-attr">hoistStatic:</span> <span class="hljs-literal">false</span>,
}
</code></pre>
<h4 data-id="heading-3">è¯´æ˜ï¼š</h4>
<ul>
<li><code>ssr: true</code> ä¸ <code>inSSR: true</code> â†’ æ˜ç¡®å‘Šè¯‰ç¼–è¯‘å™¨å¤„äºæœåŠ¡ç«¯æ¸²æŸ“æ¨¡å¼ï¼›</li>
<li><code>prefixIdentifiers: true</code> â†’ åœ¨ SSR æ¨¡å¼ä¸‹å¯ç”¨å˜é‡å‰ç¼€ï¼ˆå¦‚ <code>_ctx.</code>ï¼‰ï¼Œé¿å…ä½œç”¨åŸŸå†²çªï¼›</li>
<li><code>cacheHandlers</code> ä¸ <code>hoistStatic</code> è¢«ç¦ç”¨ï¼Œå› ä¸º SSR æ²¡æœ‰å®¢æˆ·ç«¯ diff çš„æ€§èƒ½éœ€æ±‚ã€‚</li>
</ul>
<h4 data-id="heading-4">æ³¨é‡Šï¼š</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// SSR æ¨¡å¼ä¸‹éœ€è¦æ˜ç¡®å¼€å¯æœåŠ¡ç«¯æ ‡å¿—</span>
<span class="hljs-comment">// å¹¶å…³é—­å‰ç«¯ä¼˜åŒ–ï¼ˆå¦‚äº‹ä»¶ç¼“å­˜ã€é™æ€æå‡ï¼‰</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">ğŸ” æ­¥éª¤ 2ï¼šç”Ÿæˆæˆ–ä½¿ç”¨å·²æœ‰ AST</h3>
<pre><code class="hljs language-bash" lang="bash">const ast = typeof <span class="hljs-built_in">source</span> === <span class="hljs-string">'string'</span> ? baseParse(<span class="hljs-built_in">source</span>, options) : <span class="hljs-built_in">source</span>
rawOptionsMap.<span class="hljs-built_in">set</span>(ast, options)
</code></pre>
<h4 data-id="heading-6">è¯´æ˜ï¼š</h4>
<ul>
<li>è‹¥ä¼ å…¥å­—ç¬¦ä¸²æ¨¡æ¿ï¼Œåˆ™è°ƒç”¨ <code>baseParse()</code> å°†å…¶è§£æä¸º ASTï¼›</li>
<li>è‹¥å·²æ˜¯ <code>RootNode</code>ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼›</li>
<li><code>rawOptionsMap.set()</code> ä¿å­˜ç¼–è¯‘é…ç½®ï¼Œç”¨äºåç»­å­æ ‘çš„ SSR è½¬æ¢ï¼ˆå°¤å…¶æ˜¯ <code>&lt;slot&gt;</code>ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">ğŸ” æ­¥éª¤ 3ï¼šæ‰§è¡Œ AST è½¬æ¢ï¼ˆTransform é˜¶æ®µï¼‰</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">transform</span>(ast, {
  ..<span class="hljs-selector-class">.options</span>,
  nodeTransforms: [...],
  directiveTransforms: {...},
})
</code></pre>
<h4 data-id="heading-8">å…³é”®ï¼š</h4>
<p>è¿™ä¸€é˜¶æ®µå°†æ¨¡æ¿ AST è½¬åŒ–ä¸º <strong>SSR å‹å¥½çš„ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰</strong> ã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒ Node Transformsï¼š</h4>

















































<table><thead><tr><th>è½¬æ¢å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>transformVBindShorthand</code></td><td>å¤„ç† <code>:prop</code> çš„ç®€å†™ç»‘å®š</td></tr><tr><td><code>ssrTransformIf</code></td><td>å°† <code>v-if</code> è½¬åŒ–ä¸ºæ¡ä»¶æ¸²æŸ“è¡¨è¾¾å¼</td></tr><tr><td><code>ssrTransformFor</code></td><td>å°† <code>v-for</code> è½¬åŒ–ä¸ºå¾ªç¯æ¸²æŸ“</td></tr><tr><td><code>trackVForSlotScopes</code></td><td>è·Ÿè¸ª <code>v-for</code> ä¸­çš„æ’æ§½ä½œç”¨åŸŸ</td></tr><tr><td><code>ssrTransformSlotOutlet</code></td><td>æ”¹å†™ <code>&lt;slot&gt;</code> ä¸º SSR è¾“å‡ºå‡½æ•°</td></tr><tr><td><code>ssrInjectFallthroughAttrs</code></td><td>å¤„ç†ç»„ä»¶é€ä¼ å±æ€§</td></tr><tr><td><code>ssrInjectCssVars</code></td><td>æ³¨å…¥ SSR ç‰ˆæœ¬çš„ CSS å˜é‡</td></tr><tr><td><code>ssrTransformElement</code></td><td>æ ¸å¿ƒï¼šå°†æ™®é€šå…ƒç´ èŠ‚ç‚¹è½¬åŒ–ä¸º SSR å¯æ¸²æŸ“å­—ç¬¦ä¸²</td></tr><tr><td><code>ssrTransformComponent</code></td><td>ç»„ä»¶çº§åˆ«çš„ SSR è½¬æ¢</td></tr><tr><td><code>transformStyle</code></td><td>å¤„ç†æ ·å¼ç»‘å®šï¼ˆ<code>v-bind:style</code>ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-10">æŒ‡ä»¤è½¬æ¢ï¼ˆDirective Transformsï¼‰ï¼š</h4>



































<table><thead><tr><th>æŒ‡ä»¤</th><th>è½¬æ¢å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>v-bind</code></td><td><code>transformBind</code></td><td>ä¿ç•™ DOM ç¼–è¯‘é€»è¾‘</td></tr><tr><td><code>v-on</code></td><td><code>transformOn</code></td><td>ä¿ç•™äº‹ä»¶é€»è¾‘ï¼ˆéƒ¨åˆ†å¿½ç•¥ï¼‰</td></tr><tr><td><code>v-model</code></td><td><code>ssrTransformModel</code></td><td>SSR ç‰¹æ®Šå¤„ç†åŒå‘ç»‘å®š</td></tr><tr><td><code>v-show</code></td><td><code>ssrTransformShow</code></td><td>è½¬åŒ–ä¸ºæœåŠ¡ç«¯æ¡ä»¶æ¸²æŸ“</td></tr><tr><td><code>v-cloak/once/memo</code></td><td><code>noopDirectiveTransform</code></td><td>åœ¨ SSR é˜¶æ®µè¢«å¿½ç•¥</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">ğŸ” æ­¥éª¤ 4ï¼šSSR ä¸“ç”¨ä»£ç ç”Ÿæˆé˜¶æ®µ</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">ssrCodegenTransform</span>(ast, options)
</code></pre>
<p>è¿™ä¸€é˜¶æ®µä¼šæ‰«æå¹¶ä¿®æ”¹ <code>ast.codegenNode</code>ï¼Œå°†å…¶æ›¿æ¢ä¸º <strong>SSR ä»£ç ç”Ÿæˆæ ‘</strong>ã€‚</p>
<p>è¿™ä¸€æ­¥æ˜¯ SSR çš„â€œé­”æ³•â€æ‰€åœ¨ï¼Œå®ƒå°†æ¨¡æ¿ç»“æ„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²æ‹¼æ¥é€»è¾‘ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;{{ msg }}&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>ä¼šè¢«ç¼–è¯‘æˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash">push(`&lt;div&gt;<span class="hljs-variable">${_ctx.msg}</span>&lt;/div&gt;`)
</code></pre>
<hr/>
<h3 data-id="heading-12">ğŸ” æ­¥éª¤ 5ï¼šç”Ÿæˆæœ€ç»ˆæ¸²æŸ“å‡½æ•°</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">return</span> generate(ast, options)
</code></pre>
<p>æœ€ç»ˆè¾“å‡ºçš„ <code>CodegenResult</code> åŒ…å«ï¼š</p>
<ul>
<li>æ¸²æŸ“å‡½æ•°å­—ç¬¦ä¸²ï¼›</li>
<li>ä¾èµ–å¯¼å…¥ä¿¡æ¯ï¼›</li>
<li>SSR ä¸Šä¸‹æ–‡ç®¡ç†ä»£ç ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-13">ä¸‰ã€å¯¹æ¯”ï¼šSSR ç¼–è¯‘ vs. DOM ç¼–è¯‘</h2>



































<table><thead><tr><th>ç‰¹æ€§</th><th>DOM ç¼–è¯‘ï¼ˆå®¢æˆ·ç«¯ï¼‰</th><th>SSR ç¼–è¯‘ï¼ˆæœåŠ¡ç«¯ï¼‰</th></tr></thead><tbody><tr><td>è¾“å‡º</td><td>æ¸²æŸ“å‡½æ•°ï¼ˆVNode æ ‘ï¼‰</td><td>æ¸²æŸ“å‡½æ•°ï¼ˆHTML å­—ç¬¦ä¸²ï¼‰</td></tr><tr><td>ä¼˜åŒ–</td><td>é™æ€æå‡ã€äº‹ä»¶ç¼“å­˜</td><td>å­—ç¬¦ä¸²æ‹¼æ¥ä¼˜åŒ–</td></tr><tr><td>æŒ‡ä»¤å¤„ç†</td><td>è¿è¡Œæ—¶ patch</td><td>ç¼–è¯‘æœŸç”Ÿæˆé€»è¾‘</td></tr><tr><td>æ ·å¼ä½œç”¨åŸŸ</td><td>åŠ¨æ€æ·»åŠ </td><td>ç¼–è¯‘æ—¶æ³¨å…¥</td></tr><tr><td>è¿è¡Œç¯å¢ƒ</td><td>æµè§ˆå™¨</td><td>Node.js</td></tr></tbody></table>
<p>å¯ä»¥çœ‹å‡º SSR ç¼–è¯‘å™¨å»æ‰äº†è®¸å¤šâ€œå‰ç«¯è¿è¡Œæ—¶ä¼˜åŒ–â€ï¼Œæ¢å– <strong>ç¼–è¯‘æœŸç¡®å®šæ€§</strong> ä¸ <strong>æ‰§è¡Œé€Ÿåº¦</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-14">å››ã€å®è·µï¼šå¦‚ä½•ä½¿ç”¨ <code>compile</code></h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæœ€å°ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { compile } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/compiler-ssr'</span>

<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">compile</span>(<span class="hljs-string">`&lt;div&gt;Hello {{ name }}&lt;/div&gt;`</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">code</span>)
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ssrRender</span>(<span class="hljs-params">_ctx, _push, _parent, _attrs</span>) {
  <span class="hljs-title function_">_push</span>(<span class="hljs-string">`&lt;div&gt;Hello <span class="hljs-subst">${_ctx.name}</span>&lt;/div&gt;`</span>)
}
</code></pre>
<blockquote>
<p>è¿™æ®µä»£ç å¯ç›´æ¥åœ¨ Node ç¯å¢ƒä¸­æ‰§è¡Œï¼Œç”¨äºæœåŠ¡ç«¯è¾“å‡º HTMLã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">äº”ã€æ‹“å±•ï¼šSSR çš„å­ç¼–è¯‘æµç¨‹</h2>
<p>SSR ç¼–è¯‘å™¨è¿˜æ”¯æŒï¼š</p>
<ul>
<li>å¯¹ <strong>æ’æ§½å†…å®¹</strong>ï¼ˆslot branchesï¼‰è¿›è¡Œç‹¬ç«‹ç¼–è¯‘ï¼›</li>
<li>æ”¯æŒ CSS å˜é‡æ³¨å…¥ï¼›</li>
<li>æ”¯æŒè‡ªå®šä¹‰ <code>directiveTransforms</code>ï¼Œç”¨äºæ‰©å±• SSR æŒ‡ä»¤ã€‚</li>
</ul>
<p>å¼€å‘è€…å¯é€šè¿‡ <code>options.nodeTransforms</code> æˆ– <code>options.directiveTransforms</code> æ³¨å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œå®ç°ä¸ªæ€§åŒ–çš„ SSR ç¼–è¯‘ç®¡çº¿ã€‚</p>
<hr/>
<h2 data-id="heading-16">å…­ã€æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>ä¸ hydration ä¸å…¼å®¹çš„è¡Œä¸º</strong><br/>
æŸäº›æŒ‡ä»¤å¦‚ <code>v-once</code>ã€<code>v-memo</code> æ— æ³•åœ¨ SSR ç«¯ä½¿ç”¨ï¼Œä¼šåœ¨ hydration æ—¶å¤±æ•ˆã€‚</li>
<li><strong>CSS å˜é‡åŒæ­¥é—®é¢˜</strong><br/>
<code>ssrInjectCssVars</code> ä»…ç¼–è¯‘æ³¨å…¥å˜é‡ï¼Œä½†å®¢æˆ·ç«¯éœ€åŒæ­¥ä»¥é¿å…é—ªçƒã€‚</li>
<li><strong>æ€§èƒ½é™·é˜±</strong><br/>
è‹¥æ¨¡æ¿è¿‡å¤§ï¼Œ<code>generate()</code> é˜¶æ®µå¯èƒ½ç”Ÿæˆæé•¿å­—ç¬¦ä¸²ï¼›å¯è€ƒè™‘åˆ†å—æ¸²æŸ“ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-17">æ€»ç»“</h2>
<p><code>compile()</code> æ˜¯ Vue SSR ç¼–è¯‘å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒå°†æ¨¡æ¿ç¼–è¯‘ä¸ºå¯æ‰§è¡Œçš„å­—ç¬¦ä¸²ç”Ÿæˆå‡½æ•°ï¼Œæ˜¯ä»æ¨¡æ¿åˆ° HTML çš„æ¡¥æ¢ã€‚<br/>
é€šè¿‡å¤šå±‚ transform ç®¡çº¿ä¸ SSR ä¸“ç”¨ codegenï¼ŒVue å®ç°äº†ä¼˜é›…çš„æ¨¡æ¿åˆ°å­—ç¬¦ä¸²ç¼–è¯‘æœºåˆ¶ã€‚</p>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŠ¨æ€ç›‘å¬DOMå…ƒç´ é«˜åº¦å˜åŒ–]]></title>    <link>https://juejin.cn/post/7570201730991783962</link>    <guid>https://juejin.cn/post/7570201730991783962</guid>    <pubDate>2025-11-09T15:15:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570201730991783962" data-draft-id="7569945160870264878" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŠ¨æ€ç›‘å¬DOMå…ƒç´ é«˜åº¦å˜åŒ–"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T15:15:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å¤§å«"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŠ¨æ€ç›‘å¬DOMå…ƒç´ é«˜åº¦å˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å¤§å«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:15:48.000Z" title="Sun Nov 09 2025 15:15:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<strong>å‰ç«¯æ¶æ„å¸ˆ</strong>ï¼Œå…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€<strong>ç¨‹åºå‘˜å¤§å«</strong>ã€‘ï¼Œå…è´¹é¢†å–ç²¾å“å‰ç«¯èµ„æ–™ã€‚</p>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œç›‘å¬DOMå…ƒç´ çš„é«˜åº¦å˜åŒ–æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨åšå“åº”å¼è®¾è®¡æˆ–éœ€è¦æ ¹æ®å†…å®¹å˜åŒ–è°ƒæ•´å¸ƒå±€æ—¶ã€‚å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ç°ä»£æµè§ˆå™¨æ”¯æŒçš„ <code>ResizeObserver</code>ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡å…¼å®¹æ€§æ›´å¼ºçš„ iframe æŠ€æœ¯æ¥å®ç°ï¼Œé€‚ç”¨äºè€æ¬¾æ‰‹æœºå’ŒIEæµè§ˆå™¨ã€‚</p>
<h2 data-id="heading-1">1. ResizeObserver</h2>
<p><code>ResizeObserver</code> æ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„ä¸€ç§ç›‘å¬å…ƒç´ å°ºå¯¸å˜åŒ–çš„ APIã€‚å®ƒå¯ä»¥ç›‘å¬ä»»æ„å…ƒç´ çš„å¤§å°å˜åŒ–ï¼Œå¹¶åœ¨å˜åŒ–æ—¶è§¦å‘å›è°ƒå‡½æ•°ï¼Œé€‚åˆå¤„ç† DOM å…ƒç´ é«˜åº¦å˜åŒ–çš„æƒ…å†µã€‚</p>
<h3 data-id="heading-2">ç¤ºä¾‹ä»£ç ï¼š</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é€‰æ‹©ä½ æƒ³è¦ç›‘å¬çš„ DOM å…ƒç´ </span>
<span class="hljs-keyword">const</span> targetElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.target'</span>);

<span class="hljs-comment">// åˆ›å»º ResizeObserver å®ä¾‹ï¼Œå¹¶ä¼ å…¥å›è°ƒå‡½æ•°</span>
<span class="hljs-keyword">const</span> resizeObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function"><span class="hljs-params">entries</span> =&gt;</span> {
    <span class="hljs-comment">// entries æ˜¯ä¸€ä¸ªåŒ…å«è¢«ç›‘å¬å…ƒç´ çš„æ•°ç»„</span>
    entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
        <span class="hljs-comment">// è·å–ç›®æ ‡å…ƒç´ çš„å½“å‰é«˜åº¦</span>
        <span class="hljs-keyword">const</span> height = entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…ƒç´ çš„å½“å‰é«˜åº¦:'</span>, height);
    });
});

<span class="hljs-comment">// å¼€å§‹ç›‘å¬ç›®æ ‡å…ƒç´ çš„å°ºå¯¸å˜åŒ–</span>
resizeObserver.<span class="hljs-title function_">observe</span>(targetElement);
</code></pre>
<h3 data-id="heading-3">ä½¿ç”¨è¯´æ˜ï¼š</h3>
<ul>
<li><code>ResizeObserver</code> ä¼šç›‘å¬ç›®æ ‡å…ƒç´ çš„å¤§å°å˜åŒ–ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>entries</code> æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€é¡¹ä»£è¡¨ä¸€ä¸ªè¢«è§‚å¯Ÿçš„å…ƒç´ ã€‚</li>
<li><code>entry.contentRect</code> æ˜¯ä¸€ä¸ªåŒ…å«å…ƒç´ å°ºå¯¸ä¿¡æ¯çš„çŸ©å½¢å¯¹è±¡ï¼Œ<code>height</code> å±æ€§å³ä¸ºå…ƒç´ çš„é«˜åº¦ã€‚</li>
<li>è¿™ä¸ªæ–¹æ³•å¯¹äºç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safari ç­‰ï¼‰éƒ½æœ‰æ•ˆï¼Œæ”¯æŒç¨‹åº¦è¾ƒé«˜ã€‚</li>
</ul>
<h2 data-id="heading-4">2. Iframe</h2>
<p>å¯¹äºä¸€äº›è€æ¬¾æµè§ˆå™¨ï¼ˆå¦‚ IE æµè§ˆå™¨ï¼‰æˆ–è€…éœ€è¦å…¼å®¹æ›´å¤šè®¾å¤‡çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ iframe æŠ€æœ¯æ¥å®ç°åŠ¨æ€ç›‘å¬å®¹å™¨çš„é«˜åº¦å˜åŒ–ã€‚é€šè¿‡åµŒå…¥ä¸€ä¸ªéšè—çš„ iframe å…ƒç´ ï¼Œå¯ä»¥ç›‘å¬ iframe å…ƒç´ çš„ <code>resize</code> äº‹ä»¶æ¥é—´æ¥åˆ¤æ–­å®¹å™¨çš„é«˜åº¦ã€‚</p>
<h3 data-id="heading-5">ç¤ºä¾‹ä»£ç ï¼ˆçº¯ HTML å®ç°ï¼‰ï¼š</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>åŠ¨æ€ç›‘å¬DOMå…ƒç´ é«˜åº¦å˜åŒ– - iframe ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>; <span class="hljs-comment">/* åˆå§‹é«˜åº¦ */</span>
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
        }
        <span class="hljs-selector-class">.resize-iframe</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"resize-iframe"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"about:blank"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.container'</span>);
        <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.resize-iframe'</span>);

        <span class="hljs-comment">// ç›‘å¬ iframe çš„ resize äº‹ä»¶</span>
        iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
            <span class="hljs-comment">// è·å–å®¹å™¨çš„å½“å‰é«˜åº¦</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å®¹å™¨çš„å½“å‰é«˜åº¦:'</span>, container.<span class="hljs-property">offsetHeight</span>);
        });

        <span class="hljs-comment">// ä¸ºäº†æ¼”ç¤ºï¼Œåœ¨å®¹å™¨çš„é«˜åº¦å˜åŒ–æ—¶è§¦å‘ resize äº‹ä»¶</span>
        <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
            container.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span> + <span class="hljs-string">'px'</span>;  <span class="hljs-comment">// éšæœºè°ƒæ•´å®¹å™¨é«˜åº¦</span>
        }, <span class="hljs-number">2000</span>);  <span class="hljs-comment">// æ¯2ç§’è°ƒæ•´ä¸€æ¬¡é«˜åº¦</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">ä½¿ç”¨è¯´æ˜ï¼š</h3>
<ul>
<li>è¿™ä¸ªæ–¹æ³•é€šè¿‡å°†ä¸€ä¸ªéšè—çš„ iframe åµŒå¥—åˆ°ç›®æ ‡å®¹å™¨å†…ï¼Œåˆ©ç”¨ iframe çš„ <code>resize</code> äº‹ä»¶æ¥æ£€æµ‹å®¹å™¨çš„é«˜åº¦å˜åŒ–ã€‚</li>
<li>ç”±äº <code>iframe</code> çš„ <code>resize</code> äº‹ä»¶ä¼šåœ¨å®¹å™¨çš„å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨äº‹ä»¶å›è°ƒä¸­è·å–å®¹å™¨çš„æœ€æ–°é«˜åº¦ã€‚</li>
<li>æ­¤æ–¹æ³•çš„å…¼å®¹æ€§æ›´å¹¿ï¼Œå¯ä»¥æ”¯æŒè€æ—§æµè§ˆå™¨ï¼Œå¦‚ IE æµè§ˆå™¨ã€‚</li>
</ul>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸¤ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€ç›‘å¬ DOM å…ƒç´ çš„é«˜åº¦å˜åŒ–ï¼Œé€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆå¯ä»¥ä¿è¯è·¨æµè§ˆå™¨å’Œè®¾å¤‡çš„å…¼å®¹æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue SSR ç¼–è¯‘å™¨æºç æ·±æï¼šssrTransformShow çš„å®ç°åŸç†ä¸è®¾è®¡å“²å­¦]]></title>    <link>https://juejin.cn/post/7569913182036049930</link>    <guid>https://juejin.cn/post/7569913182036049930</guid>    <pubDate>2025-11-09T00:11:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569913182036049930" data-draft-id="7569960869959057454" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue SSR ç¼–è¯‘å™¨æºç æ·±æï¼šssrTransformShow çš„å®ç°åŸç†ä¸è®¾è®¡å“²å­¦"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-09T00:11:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue SSR ç¼–è¯‘å™¨æºç æ·±æï¼šssrTransformShow çš„å®ç°åŸç†ä¸è®¾è®¡å“²å­¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T00:11:52.000Z" title="Sun Nov 09 2025 00:11:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µç†è§£ï¼š<code>v-show</code> åœ¨ SSR ç¯å¢ƒä¸­çš„æœ¬è´¨é—®é¢˜</h2>
<p>åœ¨ Vue çš„å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰ä¸­ï¼Œ<code>v-show</code> æ˜¯é€šè¿‡åŠ¨æ€ä¿®æ”¹å…ƒç´ çš„ <code>display</code> æ ·å¼å±æ€§æ¥æ§åˆ¶æ˜¾éšçš„ã€‚<br/>
ä½†åœ¨ <strong>SSRï¼ˆServer-Side Renderingï¼‰</strong> ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰çœŸå®çš„ DOM æ“ä½œï¼Œå› æ­¤å¿…é¡»åœ¨ <strong>ç¼–è¯‘é˜¶æ®µ</strong> å°†å…¶è½¬æ¢ä¸ºåˆé€‚çš„â€œæ ·å¼è¡¨è¾¾å¼â€ï¼Œä»¥ä¾¿åœ¨æ¸²æŸ“ HTML æ—¶å³å†³å®šå…ƒç´ çš„æ˜¾ç¤ºä¸å¦ã€‚</p>
<p>è¿™æ®µæºç æ­£æ˜¯ Vue SSR ç¼–è¯‘é˜¶æ®µå¯¹ <code>v-show</code> æŒ‡ä»¤çš„ä¸“ç”¨è½¬æ¢å‡½æ•°ï¼š<code>ssrTransformShow</code>ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€åŸç†å‰–æï¼šä» AST è½¬æ¢åˆ°å¯æ‰§è¡Œçš„ SSR è¡¨è¾¾å¼</h2>
<p>æºç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">DOMErrorCodes</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">DirectiveTransform</span>,
  createConditionalExpression,
  createDOMCompilerError,
  createObjectExpression,
  createObjectProperty,
  createSimpleExpression,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/compiler-dom'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ssrTransformShow</span>: <span class="hljs-title class_">DirectiveTransform</span> = <span class="hljs-function">(<span class="hljs-params">dir, node, context</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!dir.<span class="hljs-property">exp</span>) {
    context.<span class="hljs-title function_">onError</span>(
      <span class="hljs-title function_">createDOMCompilerError</span>(<span class="hljs-title class_">DOMErrorCodes</span>.<span class="hljs-property">X_V_SHOW_NO_EXPRESSION</span>),
    )
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: [
      <span class="hljs-title function_">createObjectProperty</span>(
        <span class="hljs-string">`style`</span>,
        <span class="hljs-title function_">createConditionalExpression</span>(
          dir.<span class="hljs-property">exp</span>!,
          <span class="hljs-title function_">createSimpleExpression</span>(<span class="hljs-string">`null`</span>, <span class="hljs-literal">false</span>),
          <span class="hljs-title function_">createObjectExpression</span>([
            <span class="hljs-title function_">createObjectProperty</span>(
              <span class="hljs-string">`display`</span>,
              <span class="hljs-title function_">createSimpleExpression</span>(<span class="hljs-string">`none`</span>, <span class="hljs-literal">true</span>),
            ),
          ]),
          <span class="hljs-literal">false</span> <span class="hljs-comment">/* no newline */</span>,
        ),
      ),
    ],
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-2">ğŸ” é€è¡Œæ³¨é‡Šè®²è§£</h3>
<h4 data-id="heading-3">1. å¯¼å…¥ç¼–è¯‘å™¨å·¥å…·å‡½æ•°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">DOMErrorCodes</span>,                <span class="hljs-comment">// DOM ç¼–è¯‘å™¨é”™è¯¯ç æšä¸¾</span>
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">DirectiveTransform</span>,       <span class="hljs-comment">// æŒ‡ä»¤è½¬æ¢å™¨ç±»å‹å®šä¹‰</span>
  createConditionalExpression,   <span class="hljs-comment">// åˆ›å»ºæ¡ä»¶ï¼ˆä¸‰å…ƒï¼‰è¡¨è¾¾å¼èŠ‚ç‚¹</span>
  createDOMCompilerError,        <span class="hljs-comment">// åˆ›å»ºç¼–è¯‘é”™è¯¯å¯¹è±¡</span>
  createObjectExpression,        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡å­—é¢é‡è¡¨è¾¾å¼èŠ‚ç‚¹</span>
  createObjectProperty,          <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡å±æ€§èŠ‚ç‚¹</span>
  createSimpleExpression,        <span class="hljs-comment">// åˆ›å»ºç®€å•è¡¨è¾¾å¼èŠ‚ç‚¹</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/compiler-dom'</span>
</code></pre>
<p>ğŸ‘‰ è¿™äº›å‡½æ•°ç”¨äºç”Ÿæˆ Vue ç¼–è¯‘å™¨ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰èŠ‚ç‚¹ï¼Œä½¿æ¨¡æ¿è¯­æ³•è½¬æ¢ä¸º JavaScript æ¸²æŸ“å‡½æ•°è¡¨è¾¾å¼ã€‚</p>
<hr/>
<h4 data-id="heading-4">2. å®šä¹‰ <code>ssrTransformShow</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ssrTransformShow</span>: <span class="hljs-title class_">DirectiveTransform</span> = <span class="hljs-function">(<span class="hljs-params">dir, node, context</span>) =&gt;</span> {
</code></pre>
<ul>
<li><code>dir</code>ï¼šæŒ‡ä»¤å¯¹è±¡ï¼ŒåŒ…å« <code>name</code>ã€<code>exp</code>ã€<code>modifiers</code> ç­‰ä¿¡æ¯ã€‚</li>
<li><code>node</code>ï¼šå½“å‰å¤„ç†çš„ AST èŠ‚ç‚¹ï¼ˆå¦‚ <code>&lt;div v-show="visible"&gt;</code>ï¼‰ã€‚</li>
<li><code>context</code>ï¼šç¼–è¯‘ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«é”™è¯¯å¤„ç†ã€ä»£ç ç”ŸæˆçŠ¶æ€ç­‰ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-5">3. é”™è¯¯å¤„ç†ï¼šæœªä¼ å…¥è¡¨è¾¾å¼æ—¶æŠ¥é”™</h4>
<pre><code class="hljs language-scss" lang="scss">if (!dir.exp) {
  context<span class="hljs-selector-class">.onError</span>(
    createDOMCompilerError(DOMErrorCodes.X_V_SHOW_NO_EXPRESSION),
  )
}
</code></pre>
<p>ğŸ§© è§£é‡Šï¼š</p>
<ul>
<li>è‹¥ <code>v-show</code> æœªç»‘å®šè¡¨è¾¾å¼ï¼ˆå¦‚ <code>&lt;div v-show&gt;</code>ï¼‰ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µæŠ›å‡º <code>X_V_SHOW_NO_EXPRESSION</code> é”™è¯¯ã€‚</li>
<li>è¿™æ˜¯è¯­ä¹‰å±‚æ£€æŸ¥ï¼Œç¡®ä¿ SSR è¾“å‡ºé€»è¾‘æ­£ç¡®ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-6">4. è¿”å›è½¬æ¢ç»“æœï¼šç”Ÿæˆ SSR æ ·å¼è¡¨è¾¾å¼</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">return</span> {
  props: [
    createObjectProperty(
      <span class="hljs-string">`style`</span>,
      createConditionalExpression(
        dir.exp!,                      <span class="hljs-comment">// æ¡ä»¶ï¼šè‹¥è¡¨è¾¾å¼ä¸ºçœŸ</span>
        createSimpleExpression(<span class="hljs-string">`null`</span>, <span class="hljs-literal">false</span>),   <span class="hljs-comment">// åˆ™æ ·å¼ä¸º nullï¼ˆä¿æŒé»˜è®¤ï¼‰</span>
        createObjectExpression([       <span class="hljs-comment">// å¦åˆ™å¼ºåˆ¶è®¾ç½® display:none</span>
          createObjectProperty(
            <span class="hljs-string">`display`</span>,
            createSimpleExpression(<span class="hljs-string">`none`</span>, <span class="hljs-literal">true</span>),
          ),
        ]),
        <span class="hljs-literal">false</span> <span class="hljs-comment">/* no newline */</span>,
      ),
    ),
  ],
}
</code></pre>
<p>ğŸ§  é€»è¾‘è½¬æ¢æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">v-show</span>=<span class="hljs-string">"visible"</span>&gt;&lt;/div&gt;
</code></pre>
<p>ç¼–è¯‘æˆ SSR æ¸²æŸ“è¡¨è¾¾å¼ï¼š</p>
<pre><code class="hljs language-css" lang="css">{
  style: visible ? null : { <span class="hljs-attribute">display</span>: <span class="hljs-string">"none"</span> }
}
</code></pre>
<p>æ­¤ç»“æ„åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶å³èƒ½å†³å®šå…ƒç´ æ˜¯å¦éšè—ï¼Œè€Œä¸ä¾èµ–æµè§ˆå™¨æ‰§è¡Œé€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€å¯¹æ¯”åˆ†æï¼š<code>v-show</code> vs <code>v-if</code> åœ¨ SSR ä¸­çš„å·®å¼‚</h2>























<table><thead><tr><th>æŒ‡ä»¤</th><th>æ¸²æŸ“æœºåˆ¶</th><th>SSR è¡¨ç°</th><th>æ€§èƒ½ç‰¹å¾</th></tr></thead><tbody><tr><td><code>v-if</code></td><td>æ¡ä»¶æ€§æ¸²æŸ“ï¼ˆåˆ›å»º/é”€æ¯ DOMï¼‰</td><td>æœåŠ¡ç«¯ç›´æ¥ç”Ÿæˆæˆ–çœç•¥å¯¹åº” HTML</td><td>è½»é‡ä½†æœ‰é‡ç»˜ä»£ä»·</td></tr><tr><td><code>v-show</code></td><td>æ ·å¼æ§åˆ¶ï¼ˆ<code>display: none</code>ï¼‰</td><td>æœåŠ¡ç«¯ç”Ÿæˆå…ƒç´ ä½†éšè—</td><td>ä¿æŒç»“æ„å®Œæ•´ï¼Œé€‚ç”¨äºé¢‘ç¹åˆ‡æ¢æ˜¾ç¤º</td></tr></tbody></table>
<p>ğŸ“Œ ç»“è®ºï¼š<code>ssrTransformShow</code> çš„å­˜åœ¨ï¼Œä½¿å¾— <code>v-show</code> ä¹Ÿèƒ½åœ¨ SSR è¾“å‡ºé˜¶æ®µä¿ç•™ DOM ç»“æ„ä¸€è‡´æ€§ï¼Œæœ‰åˆ©äº <strong>hydrationï¼ˆå®¢æˆ·ç«¯æ¿€æ´»ï¼‰</strong> ä¸€è‡´æ€§ã€‚</p>
<hr/>
<h2 data-id="heading-8">å››ã€å®è·µéƒ¨åˆ†ï¼šè‡ªå®šä¹‰ SSR æŒ‡ä»¤è½¬æ¢ç¤ºä¾‹</h2>
<p>å‡è®¾æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªç±»ä¼¼ <code>v-visible</code> çš„ SSR æŒ‡ä»¤ï¼Œå…¶é€»è¾‘ä¸ <code>v-show</code> ç±»ä¼¼ä½†æ§åˆ¶ <code>visibility</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ssrTransformVisible</span>: <span class="hljs-title class_">DirectiveTransform</span> = <span class="hljs-function">(<span class="hljs-params">dir, node, context</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!dir.<span class="hljs-property">exp</span>) {
    context.<span class="hljs-title function_">onError</span>(<span class="hljs-title function_">createDOMCompilerError</span>(<span class="hljs-title class_">DOMErrorCodes</span>.<span class="hljs-property">X_V_SHOW_NO_EXPRESSION</span>))
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: [
      <span class="hljs-title function_">createObjectProperty</span>(
        <span class="hljs-string">`style`</span>,
        <span class="hljs-title function_">createConditionalExpression</span>(
          dir.<span class="hljs-property">exp</span>!,
          <span class="hljs-title function_">createSimpleExpression</span>(<span class="hljs-string">`null`</span>, <span class="hljs-literal">false</span>),
          <span class="hljs-title function_">createObjectExpression</span>([
            <span class="hljs-title function_">createObjectProperty</span>(
              <span class="hljs-string">`visibility`</span>,
              <span class="hljs-title function_">createSimpleExpression</span>(<span class="hljs-string">`hidden`</span>, <span class="hljs-literal">true</span>),
            ),
          ]),
          <span class="hljs-literal">false</span>,
        ),
      ),
    ],
  }
}
</code></pre>
<p>ğŸ”§ ç¼–è¯‘ç»“æœï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">v-visible</span>=<span class="hljs-string">"isVisible"</span>&gt;&lt;/div&gt;
</code></pre>
<p>â¡ SSR æ¸²æŸ“åï¼š</p>
<pre><code class="hljs language-css" lang="css">{
  style: isVisible ? null : { <span class="hljs-attribute">visibility</span>: <span class="hljs-string">"hidden"</span> }
}
</code></pre>
<hr/>
<h2 data-id="heading-9">äº”ã€æ‹“å±•æ€è€ƒï¼šSSR ç¼–è¯‘å™¨çš„å¯æ‰©å±•æ€§æœºåˆ¶</h2>
<p>Vue ç¼–è¯‘å™¨çš„è®¾è®¡é«˜åº¦æ¨¡å—åŒ–ã€‚<br/>
æ‰€æœ‰æŒ‡ä»¤éƒ½é€šè¿‡ç±»ä¼¼çš„ <code>DirectiveTransform</code> æ¥å£å®ç°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">DirectiveTransform</span> {
  (dir: DirectiveNode, node: ElementNode, context: TransformContext): TransformResult
}
</code></pre>
<p>å› æ­¤å¼€å‘è€…å¯è‡ªç”±æ‰©å±•ï¼š</p>
<ul>
<li>æ–°å¢è‡ªå®šä¹‰æŒ‡ä»¤ï¼›</li>
<li>ä¸º SSR å®šä¹‰ç‹¬ç«‹è½¬æ¢é€»è¾‘ï¼›</li>
<li>æ‹“å±• AST èŠ‚ç‚¹ç»“æ„ï¼›</li>
<li>å®ç°æ’ä»¶å¼ç¼–è¯‘ä¸­é—´å±‚ã€‚</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ Vue ç¼–è¯‘å™¨èƒ½æ”¯æŒå¤šå¹³å°ï¼ˆWebã€SSRã€Custom Rendererï¼‰çš„å…³é”®æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-10">å…­ã€æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong><code>v-show</code> çš„åŠ¨æ€æ€§ç¼ºå¤±</strong><br/>
SSR ä»…å¤„ç†åˆå§‹æ¸²æŸ“ï¼Œåç»­ä»éœ€åœ¨å®¢æˆ·ç«¯ç”± runtime æ›´æ–°æ ·å¼ã€‚<br/>
è‹¥è¡¨è¾¾å¼ä¾èµ–å¼‚æ­¥æ•°æ®ï¼Œåˆ™ SSR é˜¶æ®µæ— æ³•ç²¾ç¡®æ§åˆ¶ã€‚</li>
<li><strong>æ ·å¼è¦†ç›–å†²çª</strong><br/>
è‹¥æ¨¡æ¿æˆ– CSS å·²è®¾ç½® <code>display</code> æ ·å¼ï¼ŒSSR è¾“å‡ºçš„å†…è”æ ·å¼å¯èƒ½è¢«è¦†ç›–ã€‚</li>
<li><strong>hydration ä¸ä¸€è‡´é£é™©</strong><br/>
è‹¥ SSR é˜¶æ®µä¸å®¢æˆ·ç«¯åˆå§‹æ•°æ®ä¸ä¸€è‡´ï¼Œä¼šé€ æˆ hydration mismatchã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-11">æ€»ç»“</h2>
<p><code>ssrTransformShow</code> æ˜¯ Vue SSR ç¼–è¯‘ç®¡çº¿ä¸­çš„ä¸€ä¸ªå°è€Œç²¾çš„ç»„ä»¶ï¼Œå…¶æ ¸å¿ƒä½¿å‘½æ˜¯ï¼š</p>
<blockquote>
<p>å°†â€œæ˜¾ç¤ºæ§åˆ¶æŒ‡ä»¤â€è½¬è¯‘ä¸ºâ€œæ ·å¼è¡¨è¾¾å¼â€ï¼Œç¡®ä¿ SSR è¾“å‡ºç»“æ„å®Œæ•´ä¸”å¯é¢„æµ‹ã€‚</p>
</blockquote>
<p>é€šè¿‡ <code>createConditionalExpression</code>ã€<code>createObjectExpression</code> ç­‰å‡½æ•°çš„ç»„åˆï¼ŒVue å®ç°äº†â€œ<strong>æ¨¡æ¿ â†’ AST â†’ SSR è¡¨è¾¾å¼</strong>â€çš„å…¨é“¾æ¡è‡ªåŠ¨åŒ–ç¼–è¯‘ã€‚</p>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦è§£æï¼šVue SSR ç¼–è¯‘å™¨ä¸­çš„ ssrTransformElement ä¸ ssrProcessElement]]></title>    <link>https://juejin.cn/post/7569913182036000778</link>    <guid>https://juejin.cn/post/7569913182036000778</guid>    <pubDate>2025-11-08T23:34:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569913182036000778" data-draft-id="7569886315197612083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦è§£æï¼šVue SSR ç¼–è¯‘å™¨ä¸­çš„ ssrTransformElement ä¸ ssrProcessElement"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-08T23:34:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦è§£æï¼šVue SSR ç¼–è¯‘å™¨ä¸­çš„ ssrTransformElement ä¸ ssrProcessElement
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-08T23:34:19.000Z" title="Sat Nov 08 2025 23:34:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µæ¦‚è¿°</h2>
<p>åœ¨ Vue 3 çš„ SSRï¼ˆServer-Side Renderingï¼‰ç¼–è¯‘é˜¶æ®µï¼Œ<code>ssrTransformElement</code> æ˜¯è´Ÿè´£å°†æ¨¡æ¿ä¸­çš„ DOM å…ƒç´ ï¼ˆ<code>&lt;div&gt;</code>, <code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code> ç­‰ï¼‰è½¬åŒ–ä¸ºå¯åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ <strong>å­—ç¬¦ä¸²æ„å»ºä»£ç </strong> çš„æ ¸å¿ƒé€»è¾‘ä¹‹ä¸€ã€‚<br/>
å®ƒçš„ä¸»è¦èŒè´£æ˜¯ï¼š</p>
<ol>
<li>åˆ†ææ¨¡æ¿ AST èŠ‚ç‚¹ï¼ˆAbstract Syntax Treeï¼‰ã€‚</li>
<li>å¤„ç†é™æ€ä¸åŠ¨æ€å±æ€§ï¼ˆ<code>v-bind</code>ã€<code>v-model</code>ã€<code>v-text</code>ã€<code>v-html</code> ç­‰ï¼‰ã€‚</li>
<li>æ„å»ºæœ€ç»ˆå¯æ‰§è¡Œçš„ SSR æ¸²æŸ“ä»£ç ï¼ˆå³å­—ç¬¦ä¸²æ‹¼æ¥é€»è¾‘ï¼‰ã€‚</li>
<li>ä¸º <code>ssrProcessElement</code> é˜¶æ®µæä¾›ç»“æ„åŒ–çš„è¾“å‡ºæ•°æ®ï¼ˆ<code>node.ssrCodegenNode</code>ï¼‰ã€‚</li>
</ol>
<p>è€Œ <code>ssrProcessElement</code> åˆ™æ˜¯å°† <code>ssrTransformElement</code> é˜¶æ®µå‡†å¤‡å¥½çš„æŒ‡ä»¤ç»“æ„ <strong>å…·ä½“è¾“å‡ºä¸ºæœ€ç»ˆ HTML å­—ç¬¦ä¸²</strong> çš„é˜¶æ®µã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€åŸç†å‰–æ</h2>
<h3 data-id="heading-2">1. SSR ç¼–è¯‘å™¨çš„åŒé˜¶æ®µæœºåˆ¶</h3>
<p>Vue çš„ SSR ç¼–è¯‘åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼š</p>

















<table><thead><tr><th>é˜¶æ®µ</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>Transform é˜¶æ®µï¼ˆå¦‚ <code>ssrTransformElement</code>ï¼‰</strong></td><td>åˆ†æ ASTï¼Œæå–åŠ¨æ€å±æ€§ä¸æŒ‡ä»¤ï¼Œç”Ÿæˆä¸­é—´ç»“æ„</td></tr><tr><td><strong>Codegen é˜¶æ®µï¼ˆå¦‚ <code>ssrProcessElement</code>ï¼‰</strong></td><td>æ ¹æ® Transform çš„ç»“æœæ‹¼æ¥æœ€ç»ˆ HTML å­—ç¬¦ä¸²</td></tr></tbody></table>
<p>è¿™ä¸¤ä¸ªé˜¶æ®µåˆ†åˆ«è¿è¡Œåœ¨ <strong>ç¼–è¯‘æœŸï¼ˆæ„å»ºæ—¶ï¼‰</strong> å’Œ <strong>è¿è¡ŒæœŸï¼ˆè¯·æ±‚æ—¶ï¼‰</strong> ï¼Œç¡®ä¿æ€§èƒ½ä¸çµæ´»æ€§å¹¶å­˜ã€‚</p>
<hr/>
<h3 data-id="heading-3">2. <code>ssrTransformElement</code> æ ¸å¿ƒç»“æ„è§£æ</h3>
<h4 data-id="heading-4">å…³é”®æµç¨‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ssrTransformElement</span>: <span class="hljs-title class_">NodeTransform</span> = <span class="hljs-function">(<span class="hljs-params">node, context</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> !== <span class="hljs-title class_">NodeTypes</span>.<span class="hljs-property">ELEMENT</span> || node.<span class="hljs-property">tagType</span> !== <span class="hljs-title class_">ElementTypes</span>.<span class="hljs-property">ELEMENT</span>) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ssrPostTransformElement</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// Step 1: åˆå§‹åŒ–æ¨¡æ¿å­—é¢é‡</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">openTag</span>: <span class="hljs-title class_">TemplateLiteral</span>[<span class="hljs-string">'elements'</span>] = [<span class="hljs-string">`&lt;<span class="hljs-subst">${node.tag}</span>`</span>]

    <span class="hljs-comment">// Step 2: æ£€æŸ¥åŠ¨æ€ç»‘å®šä¸è‡ªå®šä¹‰æŒ‡ä»¤</span>
    <span class="hljs-keyword">const</span> hasDynamicVBind = <span class="hljs-title function_">hasDynamicKeyVBind</span>(node)
    <span class="hljs-keyword">const</span> hasCustomDir = node.<span class="hljs-property">props</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">type</span> === <span class="hljs-title class_">NodeTypes</span>.<span class="hljs-property">DIRECTIVE</span> &amp;&amp; !<span class="hljs-title function_">isBuiltInDirective</span>(p.<span class="hljs-property">name</span>))

    <span class="hljs-comment">// Step 3: è‹¥å­˜åœ¨åŠ¨æ€ç»‘å®šæˆ–è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œåˆ™ç”ŸæˆåŠ¨æ€å±æ€§è¡¨è¾¾å¼</span>
    <span class="hljs-keyword">if</span> (hasDynamicVBind || hasCustomDir) {
      <span class="hljs-keyword">const</span> { props, directives } = <span class="hljs-title function_">buildProps</span>(node, context, node.<span class="hljs-property">props</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)
      <span class="hljs-keyword">const</span> mergedProps = <span class="hljs-title function_">buildSSRProps</span>(props, directives, context)
      <span class="hljs-keyword">const</span> propsExp = <span class="hljs-title function_">createCallExpression</span>(context.<span class="hljs-title function_">helper</span>(<span class="hljs-variable constant_">SSR_RENDER_ATTRS</span>), [mergedProps])
      openTag.<span class="hljs-title function_">push</span>(propsExp)
    }

    <span class="hljs-comment">// Step 4: ç”Ÿæˆæœ€ç»ˆ SSR æ¨¡æ¿å­—ç¬¦ä¸²èŠ‚ç‚¹</span>
    node.<span class="hljs-property">ssrCodegenNode</span> = <span class="hljs-title function_">createTemplateLiteral</span>(openTag)
  }
}
</code></pre>
<h4 data-id="heading-5">ä»£ç é€æ®µæ³¨é‡Š</h4>

































<table><thead><tr><th>ç‰‡æ®µ</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>openTag</code></td><td>æ„å»º HTML èµ·å§‹æ ‡ç­¾çš„æ¨¡æ¿ç‰‡æ®µï¼Œå¦‚ <code>&lt;div</code> æˆ– <code>&lt;input</code>ã€‚</td></tr><tr><td><code>hasDynamicVBind</code></td><td>åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŠ¨æ€å±æ€§ï¼ˆ<code>v-bind:[key]</code>ï¼‰ã€‚</td></tr><tr><td><code>buildProps</code></td><td>å°†æ‰€æœ‰å±æ€§ä¸æŒ‡ä»¤æ±‡æ€»ä¸ºç»Ÿä¸€çš„ <code>props</code> è¡¨è¾¾å¼ã€‚</td></tr><tr><td><code>buildSSRProps</code></td><td>åˆå¹¶ <code>v-bind</code> ä¸æŒ‡ä»¤ç”Ÿæˆçš„å±æ€§é›†åˆã€‚</td></tr><tr><td><code>createCallExpression(SSR_RENDER_ATTRS, ...)</code></td><td>ç”Ÿæˆè¿è¡Œæ—¶è°ƒç”¨ï¼Œå®é™…æ‰§è¡Œæ—¶ä¼šè°ƒç”¨ <code>ssrRenderAttrs()</code> æ¥è¾“å‡ºå­—ç¬¦ä¸²å±æ€§ã€‚</td></tr><tr><td><code>createTemplateLiteral</code></td><td>å°†æ‰€æœ‰éƒ¨åˆ†æ‹¼æ¥æˆæœ€ç»ˆå¯åºåˆ—åŒ–çš„æ¨¡æ¿å­—ç¬¦ä¸²ç»“æ„ã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">3. <code>buildSSRProps</code> çš„åˆå¹¶é€»è¾‘</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">export</span> <span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">buildSSRProps</span>(
  <span class="hljs-attribute">props</span>: PropsExpression | undefined,
  <span class="hljs-attribute">directives</span>: DirectiveNode[],
  <span class="hljs-attribute">context</span>: TransformContext,
): <span class="hljs-selector-tag">JSChildNode</span> {
  <span class="hljs-selector-tag">let</span> <span class="hljs-selector-tag">mergePropsArgs</span>: <span class="hljs-selector-tag">JSChildNode</span><span class="hljs-selector-attr">[]</span> = <span class="hljs-selector-attr">[]</span>

  <span class="hljs-selector-tag">if</span> (props) {
    <span class="hljs-selector-tag">mergePropsArgs</span><span class="hljs-selector-class">.push</span>(props)
  }

  <span class="hljs-selector-tag">for</span> (const dir of directives) {
    <span class="hljs-selector-tag">mergePropsArgs</span><span class="hljs-selector-class">.push</span>(
      <span class="hljs-built_in">createCallExpression</span>(context.<span class="hljs-built_in">helper</span>(SSR_GET_DIRECTIVE_PROPS), [
        <span class="hljs-built_in">`_ctx`</span>,
        ...<span class="hljs-built_in">buildDirectiveArgs</span>(dir, context).elements,
      ])
    )
  }

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">mergePropsArgs</span><span class="hljs-selector-class">.length</span> &gt; <span class="hljs-number">1</span>
    ? <span class="hljs-selector-tag">createCallExpression</span>(context.<span class="hljs-built_in">helper</span>(MERGE_PROPS), mergePropsArgs)
    : <span class="hljs-selector-tag">mergePropsArgs</span><span class="hljs-selector-attr">[0]</span>
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><code>MERGE_PROPS</code> å®é™…å¯¹åº”è¿è¡Œæ—¶çš„ <code>Object.assign()</code> æˆ–åˆå¹¶å‡½æ•°ï¼›</li>
<li>è‹¥å­˜åœ¨å¤šä¸ªæŒ‡ä»¤æˆ–åŠ¨æ€ç»‘å®šï¼Œåˆ™è°ƒç”¨ <code>mergeProps</code>ï¼›</li>
<li>è‹¥åªæœ‰ä¸€ä¸ªï¼Œåˆ™ç›´æ¥è¿”å›å•ä¸€è¡¨è¾¾å¼ï¼›</li>
<li>æœ€ç»ˆç»“æœä¼šäº¤ç»™ <code>SSR_RENDER_ATTRS</code> è´Ÿè´£è¾“å‡º HTML å±æ€§å­—ç¬¦ä¸²ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">4. <code>ssrProcessElement</code> è¾“å‡ºé˜¶æ®µ</h3>
<pre><code class="hljs language-scss" lang="scss">export function <span class="hljs-built_in">ssrProcessElement</span>(
  node: PlainElementNode,
  context: SSRTransformContext,
): void {
  const elementsToAdd = node<span class="hljs-selector-class">.ssrCodegenNode</span>!<span class="hljs-selector-class">.elements</span>
  for (let j = <span class="hljs-number">0</span>; j &lt; elementsToAdd.length; j++) {
    context<span class="hljs-selector-class">.pushStringPart</span>(elementsToAdd[j])
  }

  context<span class="hljs-selector-class">.pushStringPart</span>(`&gt;`) <span class="hljs-comment">// å…³é—­èµ·å§‹æ ‡ç­¾</span>
  const rawChildren = rawChildrenMap<span class="hljs-selector-class">.get</span>(node)

  if (rawChildren) {
    context<span class="hljs-selector-class">.pushStringPart</span>(rawChildren)
  } else if (node.children.length) {
    <span class="hljs-built_in">processChildren</span>(node, context)
  }

  if (!isVoidTag(node.tag)) {
    context<span class="hljs-selector-class">.pushStringPart</span>(`&lt;/${node.tag}&gt;`)
  }
}
</code></pre>
<h4 data-id="heading-8">æ³¨é‡Šè¯´æ˜ï¼š</h4>






























<table><thead><tr><th>æ­¥éª¤</th><th>åŠ¨ä½œ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>â‘ </td><td>è¾“å‡º <code>node.ssrCodegenNode</code> ä¸­ä¿å­˜çš„æ‰€æœ‰ç‰‡æ®µ</td><td>åŒ…æ‹¬ <code>&lt;div</code>, å±æ€§å­—ç¬¦ä¸²ç­‰</td></tr><tr><td>â‘¡</td><td>è¾“å‡º <code>&gt;</code></td><td>æ ‡è®°æ ‡ç­¾èµ·å§‹ç»“æŸ</td></tr><tr><td>â‘¢</td><td>å¤„ç† <code>rawChildren</code> æˆ–é€’å½’å¤„ç†å­èŠ‚ç‚¹</td><td>æ”¯æŒ <code>v-html</code>ã€<code>v-text</code> ç­‰ç‰¹æ®Šæƒ…å†µ</td></tr><tr><td>â‘£</td><td>è‹¥ä¸æ˜¯ç©ºæ ‡ç­¾ï¼ˆå¦‚ <code>&lt;br&gt;</code>ã€<code>&lt;img&gt;</code>ï¼‰ï¼Œè¾“å‡ºé—­åˆæ ‡ç­¾</td><td>è¾“å‡º <code>&lt;/div&gt;</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€å¯¹æ¯”åˆ†æï¼šä¸æ™®é€šç¼–è¯‘å™¨çš„å·®å¼‚</h2>






























<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>å®¢æˆ·ç«¯ç¼–è¯‘å™¨ (<code>@vue/compiler-dom</code>)</th><th>SSR ç¼–è¯‘å™¨ (<code>@vue/compiler-ssr</code>)</th></tr></thead><tbody><tr><td>è¾“å‡ºç›®æ ‡</td><td>æ¸²æŸ“å‡½æ•° (VNode)</td><td>HTML å­—ç¬¦ä¸²</td></tr><tr><td>åŠ¨æ€ç»‘å®š</td><td>è½¬ä¸ºå“åº”å¼è¡¨è¾¾å¼</td><td>è½¬ä¸ºå­—ç¬¦ä¸²æ‹¼æ¥è°ƒç”¨</td></tr><tr><td>v-model</td><td>è¿è¡Œæ—¶å¤„ç†</td><td>ç¼–è¯‘æœŸé™æ€æ’å…¥</td></tr><tr><td>è¾“å‡ºæ€§èƒ½</td><td>ä¾èµ–è¿è¡Œæ—¶ diff</td><td>ä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ•´ HTML</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">å››ã€å®è·µï¼šæ‰‹åŠ¨è°ƒè¯• SSR Element è½¬æ¢</h2>
<p>å‡è®¾æ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;textarea <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"obj"</span> v-model=<span class="hljs-string">"content"</span>&gt;&lt;/textarea&gt;
</code></pre>
<p>ç»è¿‡ <code>ssrTransformElement</code> å¤„ç†åï¼Œå°†ç”Ÿæˆå¦‚ä¸‹ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">_ssrRenderAttrs</span>(<span class="hljs-built_in">_mergeProps</span>(obj, <span class="hljs-built_in">_ssrGetDynamicModelProps</span>(obj, content)))
</code></pre>
<p>è§£é‡Šï¼š</p>
<ul>
<li><code>obj</code> æä¾›åŠ¨æ€ç»‘å®šå±æ€§ï¼›</li>
<li><code>v-model</code> åœ¨ SSR é˜¶æ®µè½¬ä¸º <code>_ssrGetDynamicModelProps()</code>ï¼›</li>
<li><code>MERGE_PROPS</code> åˆå¹¶ä¸¤è€…ï¼›</li>
<li>è¿è¡Œæ—¶ä¼šè‡ªåŠ¨æ¸²æŸ“å‡ºï¼š</li>
</ul>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">textarea</span> value="<span class="hljs-attribute">content</span>-value"&gt;&lt;/<span class="hljs-selector-tag">textarea</span>&gt;
</code></pre>
<hr/>
<h2 data-id="heading-11">äº”ã€æ‹“å±•ä¸é«˜çº§æœºåˆ¶</h2>
<ol>
<li>
<p><strong>rawChildrenMap çš„ä½œç”¨</strong><br/>
ç”¨äºè®°å½•éœ€è¦åœ¨ SSR è¾“å‡ºé˜¶æ®µç‰¹æ®Šæ›¿æ¢çš„èŠ‚ç‚¹å†…å®¹ï¼Œå¦‚ï¼š</p>
<ul>
<li><code>v-html</code></li>
<li><code>v-text</code></li>
<li><code>&lt;textarea&gt;</code> çš„åŠ¨æ€ <code>value</code></li>
</ul>
</li>
<li>
<p><strong>åŠ¨æ€å±æ€§æ¸²æŸ“å‡½æ•°</strong></p>
<ul>
<li><code>SSR_RENDER_ATTR</code>ï¼šæ¸²æŸ“é™æ€å®‰å…¨å±æ€§ã€‚</li>
<li><code>SSR_RENDER_DYNAMIC_ATTR</code>ï¼šå¤„ç†åŠ¨æ€ key å±æ€§ã€‚</li>
<li><code>SSR_RENDER_STYLE</code> / <code>SSR_RENDER_CLASS</code>ï¼šåˆå¹¶ style ä¸ classã€‚</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨ä¸å…¼å®¹æ€§</strong></p>
<ul>
<li>é€šè¿‡ <code>isSSRSafeAttrName</code> è¿‡æ»¤æ½œåœ¨ XSS é£é™©ã€‚</li>
<li>å¯¹è‡ªå®šä¹‰å…ƒç´ ï¼ˆ<code>&lt;my-element&gt;</code>ï¼‰ä¿ç•™åŸå§‹å±æ€§åã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-12">å…­ã€æ½œåœ¨é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2>






























<table><thead><tr><th>é—®é¢˜ç±»å‹</th><th>æè¿°</th><th>è§£å†³æ€è·¯</th></tr></thead><tbody><tr><td><strong>åŠ¨æ€å±æ€§è¦†ç›–</strong></td><td>å¤šä¸ª <code>v-bind</code> å¯èƒ½è¦†ç›–é™æ€å±æ€§</td><td>é€šè¿‡ <code>MERGE_PROPS</code> é¡ºåºåˆå¹¶</td></tr><tr><td><strong>Textarea å†…å®¹å†²çª</strong></td><td>åŒæ—¶å­˜åœ¨ <code>v-bind</code> ä¸é™æ€æ–‡æœ¬</td><td>é€šè¿‡ä¸´æ—¶å˜é‡ <code>_temp</code> åˆ¤æ–­æ˜¯å¦å«æœ‰ <code>.value</code></td></tr><tr><td><strong>æŒ‡ä»¤ä¼˜å…ˆçº§æ··ä¹±</strong></td><td>å¦‚ <code>v-text</code> ä¸ <code>v-html</code> å¹¶å­˜</td><td>é€šè¿‡ <code>rawChildrenMap</code> åç½®å¤„ç†</td></tr><tr><td><strong>æ€§èƒ½æŸè€—</strong></td><td>å¤šå±‚ <code>mergeProps</code> åµŒå¥—å¯èƒ½é™ä½æ€§èƒ½</td><td>ç¼–è¯‘é˜¶æ®µå°½é‡åˆå¹¶é™æ€å±æ€§</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-13">ç»“è¯­</h2>
<p><code>ssrTransformElement</code> ä¸ <code>ssrProcessElement</code> å…±åŒæ„æˆäº† Vue SSR ç¼–è¯‘ç®¡çº¿çš„ã€Œç»“æ„ç”Ÿæˆ â†’ æ¸²æŸ“è¾“å‡ºã€é—­ç¯ã€‚å®ƒä»¬çš„è®¾è®¡ä½“ç°äº† Vue åœ¨æ¨¡æ¿ç¼–è¯‘å±‚é¢å¯¹ <strong>åŠ¨æ€æ€§ã€æ€§èƒ½ä¸å®‰å…¨æ€§</strong> çš„ä¸‰é‡å¹³è¡¡ã€‚</p>
<p>é€šè¿‡è¿™ä¸€æœºåˆ¶ï¼ŒVue èƒ½å¤Ÿåœ¨æœåŠ¡ç«¯ç”Ÿæˆä¸å®¢æˆ·ç«¯å‡ ä¹ä¸€è‡´çš„ DOM æ ‘ï¼Œä»è€Œå®ç°æ— ç¼ hydrationã€‚</p>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯»æ‡‚ Pinï¼Œä¸€æ¬¡ææ¸… Rust æœ€éš¾çš„æŒ‡é’ˆ]]></title>    <link>https://juejin.cn/post/7569976345930956851</link>    <guid>https://juejin.cn/post/7569976345930956851</guid>    <pubDate>2025-11-09T12:34:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569976345930956851" data-draft-id="7569976345930924083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯»æ‡‚ Pinï¼Œä¸€æ¬¡ææ¸… Rust æœ€éš¾çš„æŒ‡é’ˆ"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2025-11-09T12:34:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§é±¼ä¸ƒæˆé¥±"/> <meta itemprop="url" content="https://juejin.cn/user/3017475369480509"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯»æ‡‚ Pinï¼Œä¸€æ¬¡ææ¸… Rust æœ€éš¾çš„æŒ‡é’ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3017475369480509/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§é±¼ä¸ƒæˆé¥±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T12:34:12.000Z" title="Sun Nov 09 2025 12:34:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>è¿™æ˜¯Rustä¹ä¹å…«åä¸€éš¾ç¬¬13ç¯‡ï¼Œä»‹ç»ä¸‹pinæŒ‡é’ˆã€‚pinæŒ‡é’ˆè·ŸFutureç´§å¯†ç›¸å…³ï¼Œä¹Ÿç®—æ˜¯å¤šçº¿ç¨‹éƒ¨åˆ†ç¬¬ä¸‰ç¯‡ã€‚å…³äºè¿™å—ï¼Œä¹‹å‰çœ‹äº†å‡ ç¯‡æ–‡ç« ï¼Œæœ‰è¯„è®ºè¿™å—éš¾ä»¥ç†è§£ï¼Œæˆ‘ä¹ŸåŒæ„Ÿã€‚å¿˜è®°è°è¯´çš„äº†ï¼Œå¦‚æœä¸èƒ½ç®€å•æ˜äº†çš„æè¿°æŸä¸ªä¸œè¥¿ï¼Œè¯´æ˜è‡ªå·±è¿˜æ²¡çœŸæ­£æŒæ¡ã€‚æœ¬ç¯‡å°è¯•ç”¨ç®€å•æ–¹å¼æ•´ç†Pinç›¸å…³çš„çŸ¥è¯†ï¼Œæœ‰é—®é¢˜è¯·ç•™è¨€ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h2>
<p>å…¥é—¨pinï¼Œå…ˆè¦çŸ¥é“å››ä¸ªæ¦‚å¿µï¼špinï¼ŒUnpinå’Œ!Upin,ä»¥åŠrustçš„moveã€‚é€šè¿‡è¿™äº›æ¦‚å¿µçš„å¯¹æ¯”ï¼Œç†è§£pinçš„è¾¹ç•Œï¼Œåœ¨å“ªäº›èŒƒå›´å‘ç”Ÿä½œç”¨ã€‚</p>
<h3 data-id="heading-2">1ã€<code>Pin&lt;T&gt;</code> åˆ°åº•æ˜¯ä»€ä¹ˆ</h3>
<h3 data-id="heading-3">Pinæ˜¯ä¸ªæ™ºèƒ½æŒ‡é’ˆåŒ…è£…å™¨ã€‚æ¯”å¦‚:</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">pinned</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(&amp;x);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Pinned: {:?}"</span>, pinned);<span class="hljs-comment">//Pinned: 10</span>
}
</code></pre>
<ul>
<li>å®ƒåŒ…è£¹äº†ä¸€ä¸ªç±»å‹ <code>T</code>ï¼ˆé€šå¸¸æ˜¯æ”¾åœ¨<strong>å †ä¸Š</strong>çš„ï¼Œå¦‚ <code>Box&lt;T&gt;</code>ï¼‰ï¼Œå¯¹ <strong>!Unpin ç±»å‹</strong> ï¼Œ ç¼–è¯‘å™¨ä¼šåœ¨è¯­æ³•å±‚é¢é˜»æ­¢ç§»åŠ¨ã€‚</li>
<li>ç®€å•è¯´å°±æ˜¯å¯ä»¥æ‹¿åˆ° <code>&amp;T</code> æˆ– <code>&amp;mut T</code>ï¼Œä½†ä¿è¯ä¸ä¼šæŠŠæ•´ä¸ª <code>T</code> ç§»åˆ°åˆ«çš„å†…å­˜ä½ç½®ã€‚</li>
</ul>
<h3 data-id="heading-4">2ã€Unpinæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><code>Unpin</code> æ˜¯ä¸€ä¸ª <strong>æ ‡è®° trait</strong>ï¼Œè¡¨ç¤ºè¯¥ç±»å‹å¯ä»¥å®‰å…¨åœ°è¢«ç§»åŠ¨ã€‚</p>
<ul>
<li>
<p>å¤§å¤šæ•°æ™®é€šç±»å‹ï¼ˆå¦‚ <code>i32</code>, <code>String</code>, <code>Vec&lt;T&gt;</code>ï¼‰<strong>é»˜è®¤å®ç°</strong>äº† <code>Unpin</code>ï¼›</p>
</li>
<li>
<p>ä½†ä¸€äº›ç±»å‹ï¼ˆå¦‚ <code>Future</code>ã€è‡ªå¼•ç”¨ç»“æ„ï¼‰<strong>ä¸ä¼šè‡ªåŠ¨å®ç°</strong>ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">need_unpin</span>&lt;T: Unpin&gt;(x: T) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å¯ä»¥å®‰å…¨ç§»åŠ¨"</span>);
}
</code></pre>
<p>å¦‚æœæŸç±»å‹æ²¡æœ‰ <code>Unpin</code>ï¼Œé‚£ä¹ˆå®ƒå°± <strong>å¿…é¡»è¢«å›ºå®šï¼ˆpinnedï¼‰</strong> æ‰èƒ½å®‰å…¨ä½¿ç”¨ã€‚</p>
</li>
</ul>
<h3 data-id="heading-5">3ã€!Unpinæ˜¯ä»€ä¹ˆ</h3>
<p><strong><code>!Unpin</code></strong> å°±æ˜¯ <strong>æ²¡æœ‰å®ç° <code>Unpin</code> çš„ç±»å‹</strong>ï¼Œè¡¨ç¤ºç±»å‹ <strong>ä¸èƒ½éšæ„ç§»åŠ¨</strong>ã€‚<code>!Unpin</code> å¹¶ä¸æ˜¯ Rust çš„è¯­æ³•ï¼Œè€Œæ˜¯â€œæ²¡æœ‰å®ç° Unpin çš„ç±»å‹â€çš„æ„æ€ã€‚Rust é»˜è®¤ä¼šè‡ªåŠ¨ä¸ºå¤§éƒ¨åˆ†ç±»å‹å®ç° <code>Unpin</code>ï¼Œåªæœ‰å°‘æ•°ç±»å‹ï¼ˆè‡ªå¼•ç”¨ã€Futureã€PhantomPinnedï¼‰æ‰æ˜¯ <code>!Unpin</code></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::marker::PhantomPinned;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
    _pin: PhantomPinned, <span class="hljs-comment">// è¡¨ç¤º !Unpin</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// æ™®é€šç±»å‹ Unpin</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(x);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">moved_px</span> = px; <span class="hljs-comment">// âœ… å¯ä»¥ç§»åŠ¨</span>

    <span class="hljs-comment">// è‡ªå¼•ç”¨ç±»å‹ !Unpin</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">y</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef {
        data: <span class="hljs-string">"hello"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        ptr: std::ptr::<span class="hljs-title function_ invoke__">null</span>(),
        _pin: PhantomPinned,
    });
    <span class="hljs-comment">// let moved_y = y; // âŒ ç¼–è¯‘æŠ¥é”™ï¼Œä¸å¯ç§»åŠ¨</span>
}
</code></pre>
<p>Unpin ç±»å‹ â†’ é’‰ä½ä¹Ÿèƒ½æ¬ï¼Œ!Unpin ç±»å‹ â†’ é’‰ä½åæ— æ³•æ¬ã€‚æ¢å¥è¯**!Unpin çš„ä½œç”¨æ˜¯â€œå›ºå®šå¯¹è±¡çš„åœ°å€â€ï¼Œè€Œä¸æ˜¯æ¬åŠ¨å †ä¸Šçš„æ•°æ®**ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">Stack                     Heap
+<span class="hljs-comment">-------+                 +--------+</span>
| a     | <span class="hljs-comment">--------------&gt; | "hello"|</span>
| Box   |                 +<span class="hljs-comment">--------+</span>
+<span class="hljs-comment">-------+</span>
!Unpin é˜»æ­¢ a è¢« move
</code></pre>
<ul>
<li>
<p><code>a</code>ï¼ˆæ ˆä¸Šçš„ Boxï¼‰è¢« Pin ï¼Œ æ ˆä¸Šçš„åœ°å€ä¸èƒ½è¢«ç§»åŠ¨ï¼Œå †ä¸Šçš„ <code>"hello"</code> æ•°æ®ä¸å—å½±å“</p>
</li>
<li>
<p>Pin ä½œç”¨åœ¨ <strong>æ ˆä¸Šçš„å¯¹è±¡åœ°å€</strong>ï¼Œç¡®ä¿å†…éƒ¨æŒ‡é’ˆä¸ä¼šæ‚¬ç©º</p>
</li>
</ul>
<h3 data-id="heading-6">4ã€Pinã€Unpinå’Œ!Unpinä¸‰è€…å¯¹æ¯”</h3>

























<table><thead><tr><th>ç±»å‹</th><th>Pin æ˜¯å¦ç”Ÿæ•ˆ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Unpin</td><td>âŒ ä¸ç”Ÿæ•ˆï¼ˆé€æ˜ï¼‰</td><td>ç§»åŠ¨ä»ç„¶å…è®¸ï¼Œå®‰å…¨æ— é—®é¢˜</td></tr><tr><td>!Unpin</td><td>âœ… ç”Ÿæ•ˆ</td><td>æ ˆä¸Šå€¼è¢«å›ºå®šï¼Œç§»åŠ¨ä¼šç¼–è¯‘æŠ¥é”™ï¼Œä¿æŠ¤å†…éƒ¨å¼•ç”¨å®‰å…¨</td></tr><tr><td>Copy ç±»å‹</td><td>âŒ ä¸ç”Ÿæ•ˆ</td><td>move å…¶å®æ˜¯å¤åˆ¶ï¼ŒPin å¯¹å®ƒæ— æ„ä¹‰</td></tr></tbody></table>
<p><strong><code>Pin</code> æ˜¯åŠ¨ä½œï¼Œâ€œæŠŠå¯¹è±¡é’‰ä½â€ï¼Œ<code>Unpin</code> / <code>!Unpin</code> å†³å®šé’‰ä½åèƒ½å¦ç§»åŠ¨ã€‚</strong></p>
<h3 data-id="heading-7">5ã€Pinä¸moveçš„å…³ç³»</h3>

































<table><thead><tr><th>ç±»å‹</th><th>Copyï¼Ÿ</th><th>Unpinï¼Ÿ</th><th>Pin åç§»åŠ¨ï¼Ÿ</th><th>Pin ä½œç”¨</th></tr></thead><tbody><tr><td>i32 / bool / f64</td><td>âœ…</td><td>âœ…</td><td>âœ… å¯ä»¥ç§»åŠ¨</td><td>ä¸èµ·ä½œç”¨ï¼ˆé€æ˜ï¼‰</td></tr><tr><td>String / Vec / Box</td><td>âŒ</td><td>âœ…</td><td>âœ… å¯ä»¥ç§»åŠ¨</td><td>å¯¹ Unpin ç±»å‹ä¸èµ·ä½œç”¨</td></tr><tr><td>è‡ªå¼•ç”¨ / Future</td><td>âŒ</td><td>âŒ</td><td>âŒ ç¦æ­¢ç§»åŠ¨</td><td>Pin ç”Ÿæ•ˆï¼Œä¿æŠ¤å†…éƒ¨å¼•ç”¨</td></tr></tbody></table>
<p><strong>Pin çš„å®é™…æ„ä¹‰åªé’ˆå¯¹ !Unpin ï¼ˆPin&lt;T: !Unpin&gt;ï¼‰ç±»å‹</strong>ï¼ŒCopy æˆ– Unpin ç±»å‹( Stringã€Vecã€Box) æ ‡è®°äº† Pinï¼ˆPin&lt;T: Unpin&gt;ï¼‰ï¼Œæœ¬è´¨ä¸Šä¸èµ·ä½œç”¨ã€‚</p>
<h2 data-id="heading-8">äºŒã€æ ¸å¿ƒAPIä½¿ç”¨å…¥é—¨</h2>
<p>ä¸Šä¸€ç« èŠ‚ç¡®å®šäº†è¾¹ç•Œï¼Œè¿™ä¸€ç« çœ‹ä¸‹Pinçš„apiæ€ä¹ˆç”¨ã€‚</p>
<h3 data-id="heading-9">ç¤ºä¾‹1ï¼šPin&lt;Box&gt;</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Data</span> {
    value: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
  
  	<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">boxed</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">123</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">pinned</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(boxed);

    <span class="hljs-comment">// i32 æ˜¯ Unpinï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨å–å‡º</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">inner</span> = Pin::<span class="hljs-title function_ invoke__">into_inner</span>(pinned); 
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, inner);
   
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = Data {
        value: <span class="hljs-string">"hello"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    };

    <span class="hljs-comment">// æ™®é€š Boxï¼Œå¯ä»¥è‡ªç”±ç§»åŠ¨</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">boxed</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(data);

    <span class="hljs-comment">// Pin&lt;Box&lt;T&gt;&gt;ï¼šç¦æ­¢ç§»åŠ¨å†…éƒ¨ T</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">pinned</span>: Pin&lt;<span class="hljs-type">Box</span>&lt;Data&gt;&gt; = Pin::<span class="hljs-title function_ invoke__">new</span>(boxed);

    <span class="hljs-comment">// å®‰å…¨è®¿é—®å­—æ®µ</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Value = {}"</span>, pinned.value);

    <span class="hljs-comment">// å°è¯•ç§»åŠ¨ pinnedï¼ˆç¼–è¯‘å¤±è´¥ï¼‰ï¼Œå†…éƒ¨å€¼ï¼ˆDataï¼‰è¢«ç§»åŠ¨å‡ºåŸæ¥çš„å†…å­˜åœ°å€ï¼ŒåŸå…ˆåœ°å€ä¸Šçš„é‚£å—å †å†…å­˜å˜æˆç©ºçš„ï¼Œè¿åäº†pinçš„çº¦æŸ</span>
    <span class="hljs-comment">// let moved = *pinned; // âŒ</span>
}
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>Pin&lt;Box&lt;T&gt;&gt;</code> ä¿è¯ <code>T</code> åœ¨å †ä¸Šçš„åœ°å€ä¸ä¼šæ”¹å˜ï¼›ä»ç„¶å¯ä»¥ä¿®æ”¹å†…å®¹ï¼Œä½†ä¸èƒ½â€œç§»èµ°â€æ•´ä¸ªç»“æ„ä½“ã€‚</li>
<li>Pin::new()ï¼šå¯¹ <code>!Unpin</code> ç±»å‹ï¼ˆä¾‹å¦‚è‡ªå¼•ç”¨ç»“æ„ä½“ï¼‰ï¼Œä¸èƒ½ç›´æ¥ç”¨è¿™ä¸ªå‡½æ•°ã€‚ç¼–è¯‘å™¨ä¼šå¼ºåˆ¶ä½ ä½¿ç”¨ <code>unsafe { Pin::new_unchecked(...) }</code>ã€‚</li>
<li>å¦‚æœæƒ³åªæœ‰å½“ç±»å‹æ˜¯ <code>Unpin</code>ï¼ˆå¯å®‰å…¨ç§»åŠ¨ï¼‰æ—¶æ‰èƒ½ç”¨into_innerã€‚</li>
</ul>
<h3 data-id="heading-10">ç¤ºä¾‹2ï¼šè‡ªå¼•ç”¨ç»“æ„ä½“ï¼ˆ<code>Pin</code> çš„å…¸å‹åœºæ™¯ï¼‰</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::ptr::NonNull;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: <span class="hljs-type">Option</span>&lt;NonNull&lt;<span class="hljs-type">String</span>&gt;&gt;,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">SelfRef</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(txt: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> SelfRef {
        SelfRef {
            data: txt.<span class="hljs-title function_ invoke__">to_string</span>(),
            ptr: <span class="hljs-literal">None</span>,
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">init</span>(<span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> SelfRef&gt;) {
        <span class="hljs-comment">// å®‰å…¨åœ°æ‹¿åˆ°å†…éƒ¨å¯å˜å¼•ç”¨</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">this</span> = <span class="hljs-keyword">unsafe</span> { <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">get_unchecked_mut</span>() };
        <span class="hljs-comment">// è®¾ç½®æŒ‡é’ˆæŒ‡å‘è‡ªå·±å­—æ®µ</span>
        this.ptr = <span class="hljs-title function_ invoke__">Some</span>(NonNull::<span class="hljs-title function_ invoke__">from</span>(&amp;this.data));
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">print</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"self.data = {}"</span>, <span class="hljs-keyword">self</span>.data);
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(ptr) = <span class="hljs-keyword">self</span>.ptr {
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ptr -&gt; {}"</span>, ptr.<span class="hljs-title function_ invoke__">as_ref</span>());
            }
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">s</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"Rust Pin!"</span>));
    s.<span class="hljs-title function_ invoke__">as_mut</span>().<span class="hljs-title function_ invoke__">init</span>();  <span class="hljs-comment">// åˆå§‹åŒ–è‡ªå¼•ç”¨</span>
    s.<span class="hljs-title function_ invoke__">print</span>();          <span class="hljs-comment">// âœ… OKï¼šdata æ²¡è¢«ç§»åŠ¨</span>
}
</code></pre>
<h3 data-id="heading-11">ç¤ºä¾‹ 3ï¼šåœ¨å¼‚æ­¥ä»»åŠ¡ä¸­ï¼ˆ<code>Future</code> çš„å…¸å‹åº”ç”¨ï¼‰</h3>
<p><code>async fn</code> ç”Ÿæˆçš„çŠ¶æ€æœºå…¶å®æ˜¯ <strong>è‡ªå¼•ç”¨ç»“æ„ä½“</strong>ã€‚ <code>Pin</code> åœ¨è¿è¡Œæ—¶ä¿æŠ¤å®ƒä¸è¢«ç§»åŠ¨ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::future::Future;
<span class="hljs-keyword">use</span> std::task::{Context, Poll};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyFuture</span> {
    counter: <span class="hljs-type">u8</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Future</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MyFuture</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span> = <span class="hljs-type">u8</span>;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">poll</span>(<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>&gt;, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-symbol">'_</span>&gt;) <span class="hljs-punctuation">-&gt;</span> Poll&lt;<span class="hljs-keyword">Self</span>::Output&gt; {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.counter &lt; <span class="hljs-number">3</span> {
            <span class="hljs-keyword">self</span>.counter += <span class="hljs-number">1</span>;
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Counting: {}"</span>, <span class="hljs-keyword">self</span>.counter);
            Poll::Pending
        } <span class="hljs-keyword">else</span> {
            Poll::<span class="hljs-title function_ invoke__">Ready</span>(<span class="hljs-keyword">self</span>.counter)
        }
    }
}

<span class="hljs-meta">#[tokio::main]</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = MyFuture { counter: <span class="hljs-number">0</span> }.<span class="hljs-keyword">await</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Done: {}"</span>, result);
}
</code></pre>
<p><code>Pin</code> ç¡®ä¿ <code>MyFuture</code> å†…éƒ¨çŠ¶æ€ï¼ˆå¦‚å¼•ç”¨ï¼‰ä¸ä¼šåœ¨ <code>.await</code> æœŸé—´è¢«ç§»åŠ¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>async</code> è¯­æ³•èƒ½å®‰å…¨åœ°å¤„ç†å¤æ‚çŠ¶æ€ã€‚</p>
<h3 data-id="heading-12">ç¤ºä¾‹4ï¼šunsafe</h3>
<h4 data-id="heading-13">a) Pin::new_unchecked</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">x</span> = SelfRef { ... }; <span class="hljs-comment">// !Unpin ç±»å‹</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span> = <span class="hljs-keyword">unsafe</span> { Pin::<span class="hljs-title function_ invoke__">new_unchecked</span>(&amp;<span class="hljs-keyword">mut</span> x) };
</code></pre>
<ul>
<li><strong>ä¸ºä»€ä¹ˆ unsafe</strong>ï¼š
<ul>
<li>ç¼–è¯‘å™¨ä¸èƒ½ä¿è¯åç»­ä¸ä¼šç§»åŠ¨ <code>x</code></li>
<li>éœ€è¦å¼€å‘è€…ä¿è¯ <code>x</code> åœ¨ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šç§»åŠ¨</li>
</ul>
</li>
<li>Pin::new_uncheckedï¼šå¿…é¡» <strong>100% ç¡®ä¿</strong> è¿™ä¸ªå€¼ä¸ä¼šåœ¨ pinned åè¢«ç§»åŠ¨ï¼Œä¸€èˆ¬åªåœ¨åº•å±‚æ¡†æ¶ï¼ˆå¦‚ tokioã€futuresï¼‰æˆ–è‡ªå¼•ç”¨å®ç°ä¸­ç”¨ï¼Œä¸šåŠ¡ä»£ç ä¸€èˆ¬ä¸ç”¨ã€‚</li>
</ul>
<h4 data-id="heading-14">b) Pin::get_unchecked_mut</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">px</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> SelfRef&gt; = Pin::<span class="hljs-title function_ invoke__">new</span>(&amp;<span class="hljs-keyword">mut</span> x);

<span class="hljs-keyword">unsafe</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mut_ref</span>: &amp;<span class="hljs-keyword">mut</span> SelfRef = Pin::<span class="hljs-title function_ invoke__">get_unchecked_mut</span>(px.<span class="hljs-title function_ invoke__">as_mut</span>());
    mut_ref.ptr = &amp;<span class="hljs-keyword">mut</span> mut_ref.data; <span class="hljs-comment">// è‡ªå¼•ç”¨èµ‹å€¼</span>
}
</code></pre>
<ul>
<li>get_unchecked_mut()ï¼šä¸å®‰å…¨é€‚ç”¨ä»»ä½•ç±»å‹ï¼Œè·³è¿‡ç§»åŠ¨å®‰å…¨æ£€æŸ¥ï¼Œæ‰‹åŠ¨ä¿è¯ pinned å€¼ä¸ä¼šç§»åŠ¨</li>
</ul>
<h4 data-id="heading-15">c)  into_inner å †ä¸Šå¯¹è±¡æ‹†å›åŸç±»å‹ï¼ˆ!Unpin ç±»å‹ä¸å¯è¡Œï¼‰</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span>: Pin&lt;<span class="hljs-type">Box</span>&lt;SelfRef&gt;&gt; = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef { ... });
<span class="hljs-comment">// let b: Box&lt;SelfRef&gt; = Pin::into_inner(px); // âŒ ä¸å®‰å…¨ï¼Œç¼–è¯‘ç¦æ­¢</span>
</code></pre>
<ul>
<li>å¯¹ Unpin ç±»å‹å®‰å…¨ï¼Œå¯ä»¥æ‹†å› Box</li>
<li>å¯¹ !Unpin ç±»å‹ï¼Œæ‹†å› Box éœ€è¦ unsafe å¹¶è‡ªå·±ä¿è¯ç§»åŠ¨ä¸ä¼šç ´åå®‰å…¨ï¼ˆä¸€èˆ¬ä¸æ¨èï¼‰</li>
</ul>
<h2 data-id="heading-16">ä¸‰ã€ä¸ºä»€ä¹ˆè¦è‡ªå¼•ç”¨</h2>
<p>pinæŒ‡é’ˆå¸¸ç”¨åœºæ™¯æ˜¯è‡ªå¼•ç”¨ï¼Œè¿™é‡ŒèŠèŠè‡ªå¼•ç”¨æ˜¯å•¥ï¼Œä¸ºä»€ä¹ˆæœ‰è‡ªå¼•ç”¨ã€‚</p>
<h3 data-id="heading-17">1ã€å¯¹æ¯”æ–¹æ³•è®¿é—®å’Œå†…éƒ¨å¼•ç”¨</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å­—æ®µ <code>data</code>ï¼Œæƒ³è®¿é—®å‰ä¸¤ä¸ªå­—ç¬¦ï¼š</p>
<h4 data-id="heading-18">aã€æ–¹æ³•è®¿é—®ï¼ˆæ¨èåšæ³•ï¼‰</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyStruct</span> {
    data: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">MyStruct</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">slice</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-type">str</span> {
        &amp;<span class="hljs-keyword">self</span>.data[<span class="hljs-number">0</span>..<span class="hljs-number">2</span>] <span class="hljs-comment">// æ¯æ¬¡è°ƒç”¨éƒ½ç”Ÿæˆåˆ‡ç‰‡</span>
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = MyStruct { data: <span class="hljs-string">"Hello"</span>.<span class="hljs-title function_ invoke__">into</span>() };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, s.<span class="hljs-title function_ invoke__">slice</span>()); <span class="hljs-comment">// "He"</span>
}
</code></pre>
<ul>
<li>
<p>ä¼˜ç‚¹ï¼š
Rust borrow checker å®‰å…¨ï¼Œæ²¡æœ‰æ‚¬ç©ºæŒ‡é’ˆï¼Œç®€å•ã€å¯ç»´æŠ¤</p>
</li>
<li>
<p>ç¼ºç‚¹ï¼š
æ¯æ¬¡è°ƒç”¨éƒ½ä¼šç”Ÿæˆä¸€ä¸ªåˆ‡ç‰‡ï¼ˆéå¸¸è½»é‡çº§ï¼Œä½†åœ¨<strong>é«˜æ€§èƒ½/å¤§é‡æ•°æ®</strong>åœºæ™¯ä¸‹å¯èƒ½äº§ç”Ÿå¾®å°å¼€é”€ï¼‰</p>
</li>
</ul>
<h4 data-id="heading-19">bã€å†…éƒ¨å¼•ç”¨ï¼ˆself_ref / slice æŒ‡å‘ dataï¼‰</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    slice: *<span class="hljs-keyword">const</span> <span class="hljs-type">str</span>, <span class="hljs-comment">// å†…éƒ¨æŒ‡é’ˆ</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">SelfRef</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(txt: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">s</span> = SelfRef {
            data: txt.<span class="hljs-title function_ invoke__">to_string</span>(),
            slice: std::ptr::<span class="hljs-title function_ invoke__">null</span>(),
        };
        s.slice = &amp;s.data[<span class="hljs-number">0</span>..<span class="hljs-number">2</span>] <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">str</span>; <span class="hljs-comment">// æŒ‡å‘ data</span>
        s
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_slice</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-type">str</span> {
        <span class="hljs-keyword">unsafe</span> { &amp;*<span class="hljs-keyword">self</span>.slice }
    }
}
</code></pre>
<ul>
<li>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>é›¶æ‹·è´</strong>ï¼šåˆ‡ç‰‡é¢„å…ˆè®¡ç®—å¥½ï¼Œè®¿é—®ä¸éœ€è¦æ¯æ¬¡åˆ‡åˆ†</li>
<li>å¯ç”¨äº<strong>å¼‚æ­¥/è‡ªå¼•ç”¨ç»“æ„</strong>ï¼Œé¿å…åœ¨ Future çŠ¶æ€æœº poll æ—¶é‡å¤ç”Ÿæˆåˆ‡ç‰‡</li>
</ul>
</li>
<li>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¿…é¡»ä½¿ç”¨ <strong>Pin</strong> æˆ–å †åˆ†é…ä¿è¯ <code>data</code> åœ°å€ä¸å˜</li>
<li>ä½¿ç”¨è£¸æŒ‡é’ˆï¼Œéœ€è¦ <code>unsafe</code>ï¼Œé£é™©å¤§</li>
<li>ç¨‹åºå¤æ‚åº¦é«˜ï¼Œå¯ç»´æŠ¤æ€§å·®</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">2ã€è‡ªå¼•ç”¨åœºæ™¯</h3>
<h4 data-id="heading-21">aã€é›¶æ‹·è´è§£æ</h4>
<p>HTTPã€JSONã€CSVã€æ–‡æœ¬æµç­‰å¤§é‡æ•°æ®å¤„ç†ï¼Œæƒ³å­˜å‚¨å¯¹ buffer çš„åˆ‡ç‰‡ï¼Œè€Œä¸æ˜¯å¤åˆ¶å­—ç¬¦ä¸²ã€‚é‚£å†…éƒ¨å¼•ç”¨å¯ä»¥ç›´æ¥ä¿å­˜ sliceï¼Œé¿å…æ¯æ¬¡ <code>data[0..n]</code> ç”Ÿæˆæ–°åˆ‡ç‰‡</p>
<h4 data-id="heading-22">bã€å¼‚æ­¥çŠ¶æ€æœº / Future è‡ªå¼•ç”¨</h4>
<p>çŠ¶æ€æœºå­—æ®µä¹‹é—´å¯èƒ½äº’ç›¸å¼•ç”¨Poll æ—¶ä¸å¸Œæœ›é‡æ–°è®¡ç®— slice æˆ–ä¸´æ—¶å˜é‡</p>
<h4 data-id="heading-23">cã€é«˜æ€§èƒ½å›¾ç»“æ„ / AI / Tensor</h4>
<p>èŠ‚ç‚¹å­˜æŒ‡é’ˆæŒ‡å‘æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ç”Ÿæˆæ–°å¯¹è±¡</p>
<h3 data-id="heading-24">3ã€ä¸åŠ pinçš„æœ‰ä»€ä¹ˆé—®é¢˜</h3>
<p>å‡è®¾2çš„åœºæ™¯æ²¡åŠ pinï¼ŒRust ç¼–è¯‘å™¨åœ¨é¢å¯¹â€œç›´æ¥è‡ªå¼•ç”¨â€ï¼Œé€šå¸¸ä¼šï¼š</p>
<ul>
<li>
<p>å¦‚æœæ˜¯å®‰å…¨å¼•ç”¨ï¼ˆ<code>&amp;str</code>ï¼‰ï¼Œ<strong>ç›´æ¥æ‹’ç»ç¼–è¯‘</strong>ï¼›</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">BadRef</span>&lt;<span class="hljs-symbol">'a</span>&gt; {
    data: <span class="hljs-type">String</span>,
    slice: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-type">str</span>, <span class="hljs-comment">// å¼•ç”¨è‡ªèº«å­—æ®µ</span>
}

<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>&gt; BadRef&lt;<span class="hljs-symbol">'a</span>&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(txt: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = txt.<span class="hljs-title function_ invoke__">to_string</span>();
        <span class="hljs-keyword">Self</span> {
            data: s,
            slice: &amp;s, <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯</span>
        }
    }
}
</code></pre>
<pre><code class="hljs language-swift" lang="swift">error[<span class="hljs-type">E0505</span>]: cannot move out of `s` because it <span class="hljs-keyword">is</span> borrowed
 <span class="hljs-operator">--&gt;</span> src<span class="hljs-operator">/</span>main.rs:<span class="hljs-number">9</span>:<span class="hljs-number">13</span>
  <span class="hljs-operator">|</span>
<span class="hljs-number">8</span> <span class="hljs-operator">|</span>         <span class="hljs-keyword">let</span> s <span class="hljs-operator">=</span> txt.to_string();
  <span class="hljs-operator">|</span>             <span class="hljs-operator">-</span> binding `s` declared here
<span class="hljs-number">9</span> <span class="hljs-operator">|</span>         <span class="hljs-keyword">Self</span> { data: s, slice: <span class="hljs-operator">&amp;</span>s }
  <span class="hljs-operator">|</span>                    <span class="hljs-operator">^</span> move out of `s` occurs here
  <span class="hljs-operator">|</span>                    <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>                    borrow later used here
</code></pre>
<p>Rust æ£€æµ‹åˆ° <code>&amp;s</code> å¼•ç”¨äº†å±€éƒ¨å˜é‡ <code>s</code>ï¼Œä½†åˆ move äº†å®ƒï¼ˆæ‰€æœ‰æƒè½¬ç§»ï¼‰ï¼Œè¿™è¿åäº†ç”Ÿå‘½å‘¨æœŸè§„åˆ™ã€‚</p>
</li>
<li>
<p>å¦‚æœç”¨è£¸æŒ‡é’ˆï¼ˆ<code>*const T</code>ï¼‰ï¼Œ<strong>ç¼–è¯‘èƒ½è¿‡ä½†å±äºæœªå®šä¹‰è¡Œä¸ºï¼ˆUBï¼‰</strong>ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::ptr;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">SelfRef</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(s: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(s);
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ptr</span> = &amp;data <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>;
        <span class="hljs-keyword">Self</span> { data, ptr }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">print</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-comment">// è®¿é—® ptr æŒ‡å‘çš„æ—§åœ°å€</span>
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ptr -&gt; {}"</span>, &amp;*<span class="hljs-keyword">self</span>.ptr);
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = SelfRef::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">y</span> = x; <span class="hljs-comment">// move å‘ç”Ÿ</span>
    <span class="hljs-comment">// æ­¤æ—¶ y.ptr ä»æŒ‡å‘ x.data çš„æ—§åœ°å€ï¼ˆå·²è¢« dropï¼‰</span>

    y.<span class="hljs-title function_ invoke__">print</span>(); <span class="hljs-comment">// âŒ UB: è®¿é—®å·²é‡Šæ”¾å†…å­˜</span>
}
</code></pre>
<p>interrupted by signal 11:SIGSEGVï¼Œæˆ–è€…å‡ºç°ä¹±ç ï¼Œå› ä¸º <code>b.slice</code> æŒ‡å‘äº† <code>a.data</code> çš„æ—§ä½ç½®ã€‚æœ‰çš„rustç‰ˆæœ¬å¯èƒ½ä¸å´©ï¼Œæœ‰ç‚¹éšæœºï¼Œæ‰€ä»¥æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚</p>
</li>
</ul>
<h2 data-id="heading-25">å››ã€Pinå…·ä½“æ˜¯æ€ä¹ˆå›ºå®šçš„</h2>
<p><code>Pin</code> æœ¬èº«ä¸ä¿è¯å¯¹è±¡çœŸçš„â€œä¸ä¼šè¢«ç§»åŠ¨â€ï¼Œå®ƒåªæ˜¯ <strong>åœ¨ç±»å‹ç³»ç»Ÿå±‚é¢é™åˆ¶ç§»åŠ¨</strong>,ä¾èµ–äºâ€œä¸èƒ½è·å– <code>&amp;mut T</code> åŸå§‹å¼•ç”¨ï¼š</p>
<ul>
<li>å¯¹äº <code>Pin&lt;Box&lt;T&gt;&gt;</code>ï¼Œå †ä¸Šåˆ†é… + æ— æ³•æ›¿æ¢æŒ‡é’ˆ = åœ°å€ç¨³å®š</li>
<li>å¯¹äº <code>Pin&lt;&amp;mut T&gt;</code>ï¼Œç¼–è¯‘å™¨ç¦æ­¢ <code>T</code> è¢« <code>mem::replace()</code> æˆ– <code>move</code></li>
</ul>
<h3 data-id="heading-26">1ã€PhantomPinned + !Unpin</h3>
<p>Rust ç¼–è¯‘å™¨é€šè¿‡ <strong>ç±»å‹ç³»ç»Ÿçº¦æŸ</strong>å›ºå®šå†…éƒ¨æŒ‡é’ˆã€‚<code>PhantomPinned</code> ç”¨æ¥æ ‡è®°ä¸€ä¸ªç±»å‹ <strong>ä¸å¯ç§»åŠ¨</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç±»å‹éƒ½å®ç° <code>Unpin</code>ï¼š</p>
<ul>
<li>
<p><code>Unpin</code> æ„å‘³ç€å¯ä»¥å®‰å…¨ç§»åŠ¨ã€‚</p>
</li>
<li>
<p>è‡ªå¼•ç”¨ç±»å‹å¿…é¡»æ˜¾å¼ç¦ç”¨ <code>Unpin</code>ï¼ˆé€šè¿‡ <code>PhantomPinned</code>ï¼‰ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::marker::PhantomPinned;
<span class="hljs-keyword">use</span> std::pin::Pin;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
    _pin: PhantomPinned, <span class="hljs-comment">// ç¦æ­¢ç§»åŠ¨</span>
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-27">2ã€Pin çš„ API å±‚çº¦æŸ</h3>
<p>Pinçš„æ ¸å¿ƒapiå®šä¹‰ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt; {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">as_mut</span>(<span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt;) <span class="hljs-punctuation">-&gt;</span> Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt; { ... }
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_unchecked_mut</span>(<span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt;) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">mut</span> T { ... }
}
</code></pre>
<ul>
<li>
<p><code>as_mut</code>  å®‰å…¨è·å–å¯å˜å¼•ç”¨ï¼Œä½†ä»ç„¶è¢« Pin çº¦æŸã€‚</p>
</li>
<li>
<p><code>get_unchecked_mut</code> æ˜¯ <strong>unsafe</strong>çš„ï¼Œå…è®¸æ‰‹åŠ¨ç§»åŠ¨å†…éƒ¨å­—æ®µï¼Œä½†é£é™©è‡ªæ‹…ã€‚</p>
</li>
<li>
<p>ç¼–è¯‘å™¨åªå…è®¸å®‰å…¨ API ç§»åŠ¨å¤–éƒ¨åŒ…è£¹æŒ‡é’ˆï¼Œä½†å†…éƒ¨ T åœ°å€å›ºå®šã€‚</p>
</li>
</ul>
<h3 data-id="heading-28">3ã€é˜»æ­¢moveçš„ä¾‹å­</h3>
<p>å †ä¸Šç§»åŠ¨ç¦æ­¢çš„ä¾‹å­ï¼ŒPinåœ¨ç¼–è¯‘æœŸå°±ä¼šé˜»æ­¢</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::marker::PhantomPinned;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
    _pin: PhantomPinned, <span class="hljs-comment">// !Unpinï¼Œç¦æ­¢ç§»åŠ¨</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// å †ä¸Šåˆ›å»º SelfRef å¹¶ Pin</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">boxed</span>: Pin&lt;<span class="hljs-type">Box</span>&lt;SelfRef&gt;&gt; = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef {
        data: <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>),
        ptr: std::ptr::<span class="hljs-title function_ invoke__">null</span>(),
        _pin: PhantomPinned,
    });

    <span class="hljs-comment">// åˆå§‹åŒ–å†…éƒ¨è‡ªå¼•ç”¨æŒ‡é’ˆ</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ptr</span> = &amp;boxed.data <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>;
    <span class="hljs-keyword">unsafe</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mut_ref</span> = Pin::<span class="hljs-title function_ invoke__">as_mut</span>(&amp;<span class="hljs-keyword">mut</span> boxed);
        Pin::<span class="hljs-title function_ invoke__">get_unchecked_mut</span>(mut_ref).ptr = ptr;
    }

    <span class="hljs-comment">// âŒ å°è¯• move å†…éƒ¨ SelfRef ä¼šæŠ¥é”™</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">moved</span> = *boxed; <span class="hljs-comment">// error: cannot move out of `*boxed` because it is pinned</span>

    <span class="hljs-comment">// // ä½†æ˜¯ Box æœ¬èº«å¯ä»¥ç§»åŠ¨</span>
    <span class="hljs-comment">// let moved_boxed = boxed; // âœ… Box å¯ç§»åŠ¨ï¼Œä½†å †ä¸Šåœ°å€å›ºå®š</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// println!("data via pinned: {}", unsafe { &amp;*moved_boxed.ptr });</span>
}


</code></pre>
<p>åŸç†ï¼š</p>
<ul>
<li>Box æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Œç§»åŠ¨ Box åªç§»åŠ¨æŒ‡é’ˆï¼Œä¸ç§»åŠ¨å †æ•°æ®ï¼Œå¦‚ä¸‹å›¾ï¼Œå †æ²¡å˜ï¼›</li>
<li>Pin API ä¿è¯ T åœ¨å †ä¸Šçš„å†…å­˜åœ°å€ä¸ä¼šæ”¹å˜ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ec66390241147e7ae27470b0ba78730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6bG85LiD5oiQ6aWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296451&amp;x-signature=VtRzzPTncRIR7%2FnDbHQDNlteSt8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-29">äº”ã€ä¸ºä»€ä¹ˆ <code>Future</code> è¦æœ‰ Pin è®¾è®¡</h2>
<h3 data-id="heading-30">1ã€futureè‡ªå¼•ç”¨</h3>
<p>ä¸€ä¸ª <code>async fn</code> ç¼–è¯‘åå…¶å®ä¼šç”Ÿæˆä¸€ä¸ª<strong>çŠ¶æ€æœºç»“æ„ä½“</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">foo</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-title function_ invoke__">bar</span>(&amp;s).<span class="hljs-keyword">await</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{s}"</span>);
}
</code></pre>
<p>ç¼–è¯‘å™¨å¤§è‡´ä¼šç”Ÿæˆï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">FooFuture</span> {
    State0,                        <span class="hljs-comment">// åˆå§‹çŠ¶æ€</span>
    State1 { s: <span class="hljs-type">String</span>, bar_fut: BarFuture&lt;<span class="hljs-symbol">'_</span>&gt; },  <span class="hljs-comment">// await ä¹‹å</span>
    Done,
}
</code></pre>
<p>æ¯æ¬¡ <code>.poll()</code> æ—¶ï¼Œ<code>Future</code> ä¼šè¢«æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>åœ¨ <code>State1</code> ä¸­ï¼Œ<code>bar_fut</code> æŒæœ‰ä¸€ä¸ªå¯¹ <code>s</code> çš„å¼•ç”¨ï¼š<code>BarFuture&lt;'_&gt; // ç”Ÿå‘½å‘¨æœŸä¾èµ– FooFuture::s</code></p>
<p>è¿™æ„å‘³ç€æ•´ä¸ª <code>FooFuture</code> ç»“æ„ä½“å†…éƒ¨å‡ºç°äº†**è‡ªå¼•ç”¨ï¼ˆself-referentialï¼‰**å…³ç³»ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">FooFuture
 â”œâ”€ s: <span class="hljs-type">String</span>
 â””â”€ bar_fut: BarFuture&lt;<span class="hljs-symbol">'s</span>&gt;
              â†‘
              â””â”€â”€ å¼•ç”¨äº† s
</code></pre>
<h3 data-id="heading-31">2ã€Futureä½•æ—¶è¢«ç§»åŠ¨</h3>
<p>å½“ Future è¢«è¿è¡Œï¼ˆæ¯”å¦‚é€šè¿‡ <code>tokio::spawn</code>ã€<code>block_on</code>ï¼‰æ—¶ï¼Œæ‰§è¡Œå™¨ä¼šåšè¿™æ ·çš„äº‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">fut</span> = <span class="hljs-title function_ invoke__">foo</span>();          <span class="hljs-comment">// åˆ›å»º Future</span>
executor.<span class="hljs-title function_ invoke__">spawn</span>(fut);      <span class="hljs-comment">// æŠŠ Future ç§»è¿›ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMove #1ï¼‰</span>
</code></pre>
<p>åœ¨ä»»åŠ¡ç³»ç»Ÿä¸­ï¼Œæ‰§è¡Œå™¨é€šå¸¸ä¼šï¼š</p>
<ul>
<li>æŠŠ <code>fut</code> ç§»è¿›æŸä¸ªå †ä¸Šåˆ†é…çš„ä»»åŠ¡ç»“æ„ä½“ï¼›</li>
<li>å†ä»ä»»åŠ¡ç»“æ„ä½“ä¸­å–å‡º <code>Pin&lt;&amp;mut fut&gt;</code> å»è°ƒç”¨ <code>poll()</code>ã€‚</li>
</ul>
<p>è¿™æ ·ï¼Œ<strong>åœ¨è¢« poll ä¹‹å‰ï¼Œå®ƒå·²ç»è¢« move è¿‡ä¸€æ¬¡äº†ã€‚</strong></p>
<p>æ›´éšè”½çš„æƒ…å†µ:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">fut</span> = <span class="hljs-title function_ invoke__">foo</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">f1</span> = <span class="hljs-keyword">async</span> { fut.<span class="hljs-keyword">await</span> };
</code></pre>
<p><code>fut</code> è¢«åµŒå…¥å¦ä¸€ä¸ª Future <code>f1</code> ä¸­ã€‚ <code>f1</code> ä¹Ÿä¼šè¢« executor å†æ¬¡ç§»åŠ¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ <code>fut</code> å¯èƒ½ç»å†ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-title function_ invoke__">foo</span>() <span class="hljs-punctuation">-&gt;</span> åˆ›å»º Future
   â†“ <span class="hljs-keyword">move</span>
<span class="hljs-keyword">async</span> { fut.<span class="hljs-keyword">await</span> } <span class="hljs-punctuation">-&gt;</span> å¦ä¸€ä¸ª Future åŒ…è£…
   â†“ <span class="hljs-keyword">move</span>
executor.<span class="hljs-title function_ invoke__">spawn</span>() <span class="hljs-punctuation">-&gt;</span> æ”¾å…¥ä»»åŠ¡
   â†“ <span class="hljs-keyword">move</span>
<span class="hljs-title function_ invoke__">poll</span>() <span class="hljs-punctuation">-&gt;</span> å›ºå®šåˆ°å †ä¸Š
</code></pre>
<p>å¦‚æœ <code>FooFuture</code> åœ¨ poll è¿‡ç¨‹ä¸­è¢« <strong>ç§»åŠ¨ (move)</strong>ï¼Œé‚£ä¹ˆ <code>s</code> åœ¨å†…å­˜ä¸­çš„åœ°å€å°±å˜äº†ã€‚
ä½† <code>bar_fut</code> ä»ç„¶ä¿å­˜ç€æ—§åœ°å€çš„å¼•ç”¨ï¼Œåˆ™<strong>å¼•ç”¨å¤±æ•ˆï¼Œå±äºUBï¼ˆæœªå®šä¹‰è¡Œä¸ºï¼‰ï¼</strong>ã€‚</p>
<p>æ‰€ä»¥Rusté€šè¿‡Pinæ¥å›ºå®šFutureå†…å­˜ä½ç½®</p>
<h3 data-id="heading-32">3ã€æµç¨‹å¦‚ä¸‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71d1b2e2fae34a98b71845636c8f6573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6bG85LiD5oiQ6aWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296451&amp;x-signature=TQ44aG1DJbNBgDEW8PsmfpLREyk%3D" alt="" loading="lazy"/></p>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>å½“å†™ä¸€ä¸ª <code>async fn foo() { â€¦ }</code> æˆ– <code>async { â€¦ }</code>ï¼ŒRust ç¼–è¯‘å™¨æŠŠå®ƒè½¬æˆä¸€ä¸ªçŠ¶æ€æœº structï¼Œå…¶å­—æ®µåŒ…æ‹¬å±€éƒ¨å˜é‡ã€çŠ¶æ€æ ‡è®°ã€å¯èƒ½çš„ Waker ç­‰ã€‚</li>
<li>å¦‚æœè¿™ä¸ªçŠ¶æ€æœº <strong>åœ¨ await ç‚¹ä¹‹å</strong> è¿˜æŒæœ‰å¯¹è‡ªèº«ç»“æ„ä½“å†…éƒ¨å­—æ®µï¼ˆä¾‹å¦‚ <code>&amp;mut self.field</code>ã€æˆ– <code>&amp;self.field</code>ï¼‰çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª <strong>è‡ªå¼•ç”¨ Future</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå­˜å‚¨äº†æŒ‡å‘è‡ªèº«å†…å®¹çš„å¼•ç”¨ã€‚</li>
<li>è‹¥è¿™ç§ Future è¢«ç§»åŠ¨ï¼ˆå³åœ°å€å˜åŒ–ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›å†…éƒ¨å¼•ç”¨å°±å˜æˆæ‚¬å‚å¼•ç”¨ï¼Œå¯èƒ½å¼•èµ· UBã€‚</li>
<li>å› æ­¤ï¼Œä¸ºäº†å®‰å…¨ï¼ŒRust è¦æ±‚ï¼šè‹¥ä¸€ä¸ª Future æœ‰å¯èƒ½æ˜¯è‡ªå¼•ç”¨çš„ï¼ˆå³ç”Ÿæˆå™¨çŠ¶æ€æœºå¯èƒ½è¿™æ ·ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¿…é¡» <strong>å…ˆå›ºå®šä½åœ°å€ï¼ˆpinnedï¼‰</strong>ï¼Œå†è¢« <code>poll</code>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>poll(self: Pin&lt;&amp;mut Self&gt;, â€¦)</code> è€Œä¸æ˜¯ <code>&amp;mut Self</code>ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F72769316%2Fwhy-do-futures-use-pins-in-rust%3Futm_source%3Dchatgpt.com" target="_blank" title="https://stackoverflow.com/questions/72769316/why-do-futures-use-pins-in-rust?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">stackoverflow.com/questions/7â€¦</a></li>
<li>åœ¨ <code>Pin&lt;&amp;mut Self&gt;</code> çš„çº¦æŸä¸‹ï¼Œç±»å‹ç³»ç»Ÿç¦æ­¢ä½ å†å·å·å°† Self ç§»åŠ¨ã€‚åªæœ‰å½“ Self ç±»å‹å®ç°äº† <code>Unpin</code> ï¼ˆè¡¨ç¤ºâ€œå³ä¾¿è¢« Pin åŒ…è£…ï¼Œä¹Ÿå¯å®‰å…¨ç§»åŠ¨â€ï¼‰æ—¶ï¼Œæ‰å…è®¸â€œè§£é™¤å›ºå®šâ€çš„æ“ä½œã€‚</li>
<li>æ€»ç»“æ¥è¯´ï¼Œåœ¨ poll æœŸé—´ï¼Œä¿è¯ Future æ‰€è¡¨ç¤ºçš„å†…å­˜ä½ç½®ä¸ä¼šæ”¹å˜**ï¼Œä»è€Œåº•å±‚çŠ¶æ€æœºå­—æ®µä¸­çš„â€œself-å¼•ç”¨â€ä¾ç„¶æœ‰æ•ˆã€‚</li>
</ul>
<h2 data-id="heading-33">å…­ã€æ€»ç»“</h2>
<p>Pinä¸»è¦ä¿è¯ !Unpin ç±»å‹åœ¨å†…å­˜ä¸­çš„åœ°å€å›ºå®šï¼Œæ¯”å¦‚è‡ªå¼•ç”¨ç±»å‹ã€å¼‚æ­¥ Future ç±»å‹ï¼ˆasync/await å†…éƒ¨çŠ¶æ€æœºï¼‰ã€åº•å±‚å¼‚æ­¥ I/O é©±åŠ¨ï¼ˆå¦‚ Tokio å†…éƒ¨ taskã€io_uring bufferï¼‰ã€‚ç†è§£èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œå¯¹æ™®é€šç±»å‹æˆ–çŸ­ç”Ÿå‘½å‘¨æœŸå˜é‡æ²¡å¿…è¦ä½¿ç”¨ï¼Œé™¤éæ˜¯æ˜ç¡®çš„éœ€æ±‚ã€‚å¦‚æœç”¨çš„è¯ï¼Œèƒ½ç”¨å®‰å…¨ API å°±ä¸ç”¨ unsafeï¼›åªèƒ½ unsafe çš„åœ°æ–¹ï¼Œè¦ä¿è¯å¯¹è±¡ç»å¯¹ä¸åŠ¨ã€‚</p>
<p>å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·ç‚¹ä¸ªå…³æ³¨å§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue SSR æºç è§£æï¼šssrProcessIf æ¡ä»¶æ¸²æŸ“çš„æœåŠ¡ç«¯è½¬æ¢é€»è¾‘]]></title>    <link>https://juejin.cn/post/7569909335909253129</link>    <guid>https://juejin.cn/post/7569909335909253129</guid>    <pubDate>2025-11-09T00:06:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569909335909253129" data-draft-id="7569909335909236745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue SSR æºç è§£æï¼šssrProcessIf æ¡ä»¶æ¸²æŸ“çš„æœåŠ¡ç«¯è½¬æ¢é€»è¾‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-09T00:06:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue SSR æºç è§£æï¼šssrProcessIf æ¡ä»¶æ¸²æŸ“çš„æœåŠ¡ç«¯è½¬æ¢é€»è¾‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T00:06:42.000Z" title="Sun Nov 09 2025 00:06:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Vue çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ç¼–è¯‘é˜¶æ®µï¼Œ<code>v-if / v-else-if / v-else</code> æŒ‡ä»¤éœ€è¦è¢«è½¬æ¢ä¸ºå¯åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œçš„æ¸²æŸ“é€»è¾‘ï¼Œä»¥ç”Ÿæˆæ­£ç¡®çš„ HTML è¾“å‡ºã€‚<br/>
æœ¬æ–‡å°†æ·±å…¥è§£æ <code>ssrProcessIf</code> çš„æºç ç»“æ„ã€åŸç†è®¾è®¡ã€ä¸ç¼–è¯‘ç«¯å·®å¼‚ï¼Œå¹¶é€æ­¥è®²è§£å¦‚ä½•ç”Ÿæˆå¯¹åº”çš„ SSR ä»£ç èŠ‚ç‚¹ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µå±‚ï¼š<code>ssrProcessIf</code> çš„èŒè´£å®šä½</h2>
<p>åœ¨ Vue çš„ç¼–è¯‘æµç¨‹ä¸­ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆAST æ„å»ºï¼‰</strong> ï¼šé€šè¿‡ <code>createStructuralDirectiveTransform</code> æ³¨å†Œç»“æ„æ€§æŒ‡ä»¤ï¼ˆå¦‚ <code>v-if</code>ã€<code>v-for</code>ï¼‰ã€‚</li>
<li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆSSR è½¬æ¢ï¼‰</strong> ï¼šæ ¹æ® AST èŠ‚ç‚¹ç”ŸæˆæœåŠ¡ç«¯å¯æ‰§è¡Œä»£ç æ®µã€‚</li>
</ul>
<p><code>ssrProcessIf</code> å±äºç¬¬äºŒé˜¶æ®µå‡½æ•°ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯ï¼š</p>
<blockquote>
<p>å°†ç¼–è¯‘å™¨ DOM å±‚çš„ <code>IfNode</code>ï¼ˆå³ <code>v-if</code>ã€<code>v-else-if</code>ã€<code>v-else</code>ï¼‰è½¬æ¢ä¸º SSR ç¯å¢ƒä¸‹å¯æ‰§è¡Œçš„ JavaScript æ¡ä»¶è¯­å¥ï¼ˆ<code>if / else if / else</code>ï¼‰ï¼Œå¹¶æ„å»ºå¯¹åº”çš„æ¸²æŸ“é€»è¾‘å—ï¼ˆ<code>BlockStatement</code>ï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">äºŒã€åŸç†å±‚ï¼šæºç è§£æ„ä¸é€»è¾‘æµç¨‹</h2>
<p>å®Œæ•´æºç å¦‚ä¸‹ï¼ˆé™„è¯¦ç»†æ³¨é‡Šï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">BlockStatement</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">IfBranchNode</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">IfNode</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">NodeTransform</span>,
  <span class="hljs-title class_">NodeTypes</span>,
  createBlockStatement,
  createCallExpression,
  createIfStatement,
  createStructuralDirectiveTransform,
  processIf,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/compiler-dom'</span>
<span class="hljs-keyword">import</span> {
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">SSRTransformContext</span>,
  processChildrenAsStatement,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../ssrCodegenTransform'</span>

<span class="hljs-comment">// (1) æ³¨å†ŒæŒ‡ä»¤ transformï¼Œç”¨äºç¬¬ä¸€é˜¶æ®µ AST æ„å»º</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ssrTransformIf</span>: <span class="hljs-title class_">NodeTransform</span> = <span class="hljs-title function_">createStructuralDirectiveTransform</span>(
  <span class="hljs-regexp">/^(?:if|else|else-if)$/</span>, <span class="hljs-comment">// åŒ¹é…ä¸‰ç§ v-if æŒ‡ä»¤</span>
  processIf, <span class="hljs-comment">// ä½¿ç”¨ compiler-dom ä¸­çš„åŸºç¡€é€»è¾‘</span>
)

<span class="hljs-comment">// (2) SSR é˜¶æ®µï¼šæ ¹æ® AST ç”ŸæˆæœåŠ¡ç«¯ä»£ç ç»“æ„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ssrProcessIf</span>(<span class="hljs-params">
  node: IfNode,
  context: SSRTransformContext,
  disableNestedFragments = <span class="hljs-literal">false</span>,
  disableComment = <span class="hljs-literal">false</span>,
</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> [rootBranch] = node.<span class="hljs-property">branches</span>

  <span class="hljs-comment">// 2.1 ç”Ÿæˆç¬¬ä¸€ä¸ª if è¯­å¥</span>
  <span class="hljs-keyword">const</span> ifStatement = <span class="hljs-title function_">createIfStatement</span>(
    rootBranch.<span class="hljs-property">condition</span>!,
    <span class="hljs-title function_">processIfBranch</span>(rootBranch, context, disableNestedFragments),
  )
  context.<span class="hljs-title function_">pushStatement</span>(ifStatement)

  <span class="hljs-comment">// 2.2 éå†åç»­çš„ else-if / else åˆ†æ”¯</span>
  <span class="hljs-keyword">let</span> currentIf = ifStatement
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; node.<span class="hljs-property">branches</span>.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> branch = node.<span class="hljs-property">branches</span>[i]
    <span class="hljs-keyword">const</span> branchBlockStatement = <span class="hljs-title function_">processIfBranch</span>(
      branch,
      context,
      disableNestedFragments,
    )
    <span class="hljs-keyword">if</span> (branch.<span class="hljs-property">condition</span>) {
      <span class="hljs-comment">// else-if åˆ†æ”¯</span>
      currentIf = currentIf.<span class="hljs-property">alternate</span> = <span class="hljs-title function_">createIfStatement</span>(
        branch.<span class="hljs-property">condition</span>,
        branchBlockStatement,
      )
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// else åˆ†æ”¯</span>
      currentIf.<span class="hljs-property">alternate</span> = branchBlockStatement
    }
  }

  <span class="hljs-comment">// 2.3 æ—  else åˆ†æ”¯æ—¶æ’å…¥ç©ºæ³¨é‡ŠèŠ‚ç‚¹</span>
  <span class="hljs-keyword">if</span> (!currentIf.<span class="hljs-property">alternate</span> &amp;&amp; !disableComment) {
    currentIf.<span class="hljs-property">alternate</span> = <span class="hljs-title function_">createBlockStatement</span>([
      <span class="hljs-title function_">createCallExpression</span>(<span class="hljs-string">`_push`</span>, [<span class="hljs-string">'`&lt;!----&gt;`'</span>]), <span class="hljs-comment">// è¾“å‡ºç©ºæ³¨é‡Šå ä½</span>
    ])
  }
}

<span class="hljs-comment">// (3) å¤„ç†å•ä¸ªåˆ†æ”¯çš„å†…éƒ¨ children</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processIfBranch</span>(<span class="hljs-params">
  branch: IfBranchNode,
  context: SSRTransformContext,
  disableNestedFragments = <span class="hljs-literal">false</span>,
</span>): <span class="hljs-title class_">BlockStatement</span> {
  <span class="hljs-keyword">const</span> { children } = branch
  <span class="hljs-keyword">const</span> needFragmentWrapper =
    !disableNestedFragments &amp;&amp;
    (children.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span> || children[<span class="hljs-number">0</span>].<span class="hljs-property">type</span> !== <span class="hljs-title class_">NodeTypes</span>.<span class="hljs-property">ELEMENT</span>) &amp;&amp;
    <span class="hljs-comment">// ä¼˜åŒ–ï¼šå•ä¸€å­èŠ‚ç‚¹ä¸º ForNode æ—¶å¯è·³è¿‡ Fragment åŒ…è£¹</span>
    !(children.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; children[<span class="hljs-number">0</span>].<span class="hljs-property">type</span> === <span class="hljs-title class_">NodeTypes</span>.<span class="hljs-property">FOR</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">processChildrenAsStatement</span>(branch, context, needFragmentWrapper)
}
</code></pre>
<h3 data-id="heading-2">ğŸ§© æ ¸å¿ƒé€»è¾‘åˆ†å±‚è§£æ</h3>

























<table><thead><tr><th>å±‚æ¬¡</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>ssrTransformIf</code></td><td>æ³¨å†Œ AST è½¬æ¢æ’ä»¶ï¼Œè¯†åˆ«æ‰€æœ‰ v-if æŒ‡ä»¤ã€‚</td></tr><tr><td><code>ssrProcessIf</code></td><td>å°† AST çš„ <code>IfNode</code> è½¬æ¢ä¸º SSR è¯­å¥æ ‘ï¼ˆJavaScript é€»è¾‘å—ï¼‰ã€‚</td></tr><tr><td><code>processIfBranch</code></td><td>å°†åˆ†æ”¯çš„å­èŠ‚ç‚¹è½¬æ¢ä¸ºæ¸²æŸ“è¯­å¥ä½“ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ <code>&lt;template&gt;</code> Fragment åŒ…è£¹ã€‚</td></tr><tr><td><code>_push('&lt;!-- --&gt;')</code></td><td>æ— åŒ¹é…åˆ†æ”¯æ—¶ï¼Œè¾“å‡º SSR ç©ºæ³¨é‡Šï¼ˆä¸å®¢æˆ·ç«¯æ¸²æŸ“ä¸€è‡´ï¼‰ã€‚</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€å¯¹æ¯”å±‚ï¼šSSR vs Client ç¼–è¯‘é€»è¾‘</h2>






























<table><thead><tr><th>é¡¹ç›®</th><th>å®¢æˆ·ç«¯ç¼–è¯‘ï¼ˆ<code>compiler-dom</code>ï¼‰</th><th>æœåŠ¡ç«¯ç¼–è¯‘ï¼ˆ<code>compiler-ssr</code>ï¼‰</th></tr></thead><tbody><tr><td>è¾“å‡ºç›®æ ‡</td><td>æ¸²æŸ“å‡½æ•°ï¼ˆ<code>_createVNode</code> ç­‰ï¼‰</td><td>å­—ç¬¦ä¸²æ‹¼æ¥è¾“å‡ºï¼ˆ<code>_push()</code> è°ƒç”¨ï¼‰</td></tr><tr><td>æ¡ä»¶æ§åˆ¶</td><td>é€šè¿‡ <code>createConditionalExpression</code> ç”Ÿæˆä¸‰å…ƒè¡¨è¾¾å¼</td><td>é€šè¿‡ <code>createIfStatement</code> ç”Ÿæˆå®é™… JS if/else è¯­å¥</td></tr><tr><td>ç©ºåˆ†æ”¯å¤„ç†</td><td>è¾“å‡º <code>null</code></td><td>è¾“å‡º HTML æ³¨é‡Š <code>&lt;!----&gt;</code></td></tr><tr><td>Fragment åŒ…è£¹</td><td>ä¾èµ– runtime æ¸²æŸ“ä¼˜åŒ–</td><td>åœ¨ç¼–è¯‘é˜¶æ®µåˆ¤æ–­æ˜¯å¦åˆå¹¶ Fragment</td></tr></tbody></table>
<p>â†’ <strong>æ€»ç»“</strong>ï¼š<br/>
å®¢æˆ·ç«¯ç¼–è¯‘åå‘è¿è¡Œæ—¶åŠ¨æ€å†³ç­–ï¼ˆè™šæ‹Ÿ DOM diffï¼‰ï¼Œ<br/>
è€Œ SSR ç¼–è¯‘æ˜¯é™æ€åŒ–ã€é¢„å±•å¼€çš„é€»è¾‘æ ‘ï¼Œè¿½æ±‚â€œå¯ç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²â€çš„é«˜æ•ˆæ€§ã€‚</p>
<hr/>
<h2 data-id="heading-4">å››ã€å®è·µå±‚ï¼šç¤ºä¾‹æ¨æ¼”</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> v-if="ok"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> v-else-if="maybe"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> v-else&gt;C&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>ç»è¿‡ <code>ssrProcessIf</code> è½¬æ¢åï¼Œå†…éƒ¨ä¼šç”Ÿæˆä¼ªä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">if (ok) {
  _push(`&lt;<span class="hljs-selector-tag">div</span>&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;`)
} else if (maybe) {
  _push(`&lt;<span class="hljs-selector-tag">div</span>&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;`)
} else {
  _push(`&lt;<span class="hljs-selector-tag">div</span>&gt;C&lt;/<span class="hljs-selector-tag">div</span>&gt;`)
}
</code></pre>
<p>è‹¥ç¼ºçœ <code>v-else</code>ï¼Œåˆ™è¾“å‡ºï¼š</p>
<pre><code class="hljs language-xml" lang="xml">if (ok) {
  _push(`<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`)
} else {
  _push(`<span class="hljs-comment">&lt;!----&gt;</span>`)
}
</code></pre>
<p>â†’ è¿™ç§æ–¹å¼ä¿è¯äº† SSR è¾“å‡ºçš„ HTML ç»“æ„ä¸å®¢æˆ·ç«¯æ¸²æŸ“ä¿æŒä¸€è‡´ã€‚</p>
<hr/>
<h2 data-id="heading-5">äº”ã€æ‹“å±•å±‚ï¼šç›¸å…³æ¨¡å—è”åŠ¨</h2>
<ul>
<li>
<p><strong><code>processChildrenAsStatement</code></strong><br/>
è´Ÿè´£å°†æ¨¡æ¿çš„å­èŠ‚ç‚¹ç¼–è¯‘ä¸º <code>BlockStatement</code>ï¼Œä»¥ä¾¿åœ¨ SSR ç¯å¢ƒä¸­å¯æŒ‰é¡ºåº <code>_push()</code>ã€‚</p>
</li>
<li>
<p><strong><code>SSRTransformContext</code></strong><br/>
ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li><code>_push()</code> è¾“å‡ºæµç®¡ç†ï¼›</li>
<li>é™æ€/åŠ¨æ€ç‰‡æ®µæ”¶é›†ï¼›</li>
<li>åµŒå¥—ç‰‡æ®µï¼ˆFragmentï¼‰å¤„ç†å¼€å…³ï¼›</li>
</ul>
</li>
<li>
<p><strong><code>createIfStatement</code></strong><br/>
å†…éƒ¨å°è£…ä¸ºæ ‡å‡†çš„ AST <code>IfStatement</code>ï¼Œç¡®ä¿è¾“å‡º JS å¯è¢«åç»­ Codegen é˜¶æ®µç›´æ¥åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">å…­ã€æ½œåœ¨é—®é¢˜ä¸ä¼˜åŒ–æ–¹å‘</h2>
<ol>
<li>
<p><strong>å¤šå±‚åµŒå¥—æ¡ä»¶çš„ä»£ç é‡è†¨èƒ€</strong></p>
<ul>
<li>SSR è¾“å‡ºçš„æ˜¯çº¯ JS æ§åˆ¶æµï¼Œä¼šå¯¼è‡´åˆ†æ”¯è¾ƒå¤šæ—¶ä½“ç§¯å¢é•¿ã€‚</li>
<li>å¯è€ƒè™‘åç»­é˜¶æ®µå¼•å…¥â€œæ¡ä»¶é¢„è®¡ç®—â€æˆ–â€œçŸ­è·¯ä¼˜åŒ–â€ã€‚</li>
</ul>
</li>
<li>
<p><strong>Fragment åŒ…è£¹åˆ¤æ–­é€»è¾‘å¤æ‚</strong></p>
<ul>
<li>å½“å‰é€šè¿‡èŠ‚ç‚¹ç±»å‹å’Œæ•°é‡åˆ¤æ–­ï¼Œè¾¹ç•Œæƒ…å†µï¼ˆå¦‚ <code>v-if</code> å†…åŒ…è£¹ <code>template</code>ï¼‰å¯èƒ½å‡ºç°è¿‡åŒ…æˆ–æ¼åŒ…ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¯è°ƒè¯•æ€§å¼±</strong></p>
<ul>
<li>SSR é˜¶æ®µç”Ÿæˆçš„ <code>_push</code> è°ƒç”¨åœ¨è°ƒè¯•æ—¶å¯è¯»æ€§å·®ï¼Œæœªæ¥å¯è€ƒè™‘å¼•å…¥ Source Map æˆ–ç»“æ„åŒ–æ¸²æŸ“æ ‘è°ƒè¯•å™¨ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p><code>ssrProcessIf</code> æ˜¯ Vue SSR ç¼–è¯‘å™¨ä¸­å¤„ç†æ¡ä»¶æ¸²æŸ“çš„å…³é”®æ¨¡å—ã€‚<br/>
å®ƒé€šè¿‡é™æ€åŒ–å±•å¼€æ¡ä»¶é€»è¾‘ã€ç”Ÿæˆ JS æ§åˆ¶æµè¯­å¥ï¼Œå®ç°äº†ä¸å®¢æˆ·ç«¯ä¸€è‡´çš„è¾“å‡ºç»“æœã€‚<br/>
è¿™ä¸€è®¾è®¡ä½“ç°äº† <strong>â€œè¿è¡Œæ—¶åŠ¨æ€æ€§ â†’ ç¼–è¯‘æœŸç¡®å®šæ€§â€</strong> çš„ Vue SSR æ¶æ„å“²å­¦ã€‚</p>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Vue SSR ä¸­çš„ v-for ç¼–è¯‘é€»è¾‘ï¼šssrProcessFor æºç è§£æ]]></title>    <link>https://juejin.cn/post/7569976345929809971</link>    <guid>https://juejin.cn/post/7569976345929809971</guid>    <pubDate>2025-11-09T00:04:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569976345929809971" data-draft-id="7569976345929793587" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Vue SSR ä¸­çš„ v-for ç¼–è¯‘é€»è¾‘ï¼šssrProcessFor æºç è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-09T00:04:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Vue SSR ä¸­çš„ v-for ç¼–è¯‘é€»è¾‘ï¼šssrProcessFor æºç è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T00:04:10.000Z" title="Sun Nov 09 2025 00:04:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µèƒŒæ™¯</h2>
<p>åœ¨ Vue 3 çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ç¼–è¯‘é˜¶æ®µï¼Œ<code>v-for</code> æŒ‡ä»¤çš„å¤„ç†è¿‡ç¨‹è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆç»“æ„åŒ–è½¬æ¢ï¼‰</strong> ï¼šé€šè¿‡ <code>createStructuralDirectiveTransform</code> æ•è·æ¨¡æ¿ä¸­çš„ <code>v-for</code> è¯­æ³•ï¼Œå¹¶ç”Ÿæˆè¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚</li>
<li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆSSR ä¸“ç”¨ä»£ç ç”Ÿæˆï¼‰</strong> ï¼šä½¿ç”¨ <code>ssrProcessFor</code> å°†è¯­æ³•æ ‘èŠ‚ç‚¹è½¬åŒ–ä¸º SSR è¿è¡Œæ—¶å¯æ‰§è¡Œçš„æ¸²æŸ“å‡½æ•°ç‰‡æ®µã€‚</li>
</ol>
<p>æ¢å¥è¯è¯´ï¼Œ<code>ssrProcessFor</code> æ˜¯ SSR ç¼–è¯‘ä¸­ <strong>è´Ÿè´£æŠŠ <code>v-for</code> ä» AST è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ‹¼æ¥é€»è¾‘</strong> çš„æ ¸å¿ƒå‡½æ•°ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æºç ç»“æ„æ€»è§ˆ</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">ForNode</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">NodeTransform</span>,
  <span class="hljs-title class_">NodeTypes</span>,
  createCallExpression,
  createForLoopParams,
  createFunctionExpression,
  createStructuralDirectiveTransform,
  processFor,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/compiler-dom'</span>
<span class="hljs-keyword">import</span> {
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">SSRTransformContext</span>,
  processChildrenAsStatement,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../ssrCodegenTransform'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">SSR_RENDER_LIST</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../runtimeHelpers'</span>

<span class="hljs-comment">// ç¬¬ä¸€é˜¶æ®µï¼šv-for çš„ç»“æ„åŒ–æŒ‡ä»¤è½¬æ¢</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">ssrTransformFor</span>: <span class="hljs-title class_">NodeTransform</span> =
  <span class="hljs-title function_">createStructuralDirectiveTransform</span>(<span class="hljs-string">'for'</span>, processFor)

<span class="hljs-comment">// ç¬¬äºŒé˜¶æ®µï¼šv-for çš„ SSR ä»£ç ç”Ÿæˆé€»è¾‘</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ssrProcessFor</span>(<span class="hljs-params">
  node: ForNode,
  context: SSRTransformContext,
  disableNestedFragments = <span class="hljs-literal">false</span>,
</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> needFragmentWrapper =
    !disableNestedFragments &amp;&amp;
    (node.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span> || node.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">type</span> !== <span class="hljs-title class_">NodeTypes</span>.<span class="hljs-property">ELEMENT</span>)
  <span class="hljs-keyword">const</span> renderLoop = <span class="hljs-title function_">createFunctionExpression</span>(
    <span class="hljs-title function_">createForLoopParams</span>(node.<span class="hljs-property">parseResult</span>),
  )
  renderLoop.<span class="hljs-property">body</span> = <span class="hljs-title function_">processChildrenAsStatement</span>(
    node,
    context,
    needFragmentWrapper,
  )

  <span class="hljs-keyword">if</span> (!disableNestedFragments) {
    context.<span class="hljs-title function_">pushStringPart</span>(<span class="hljs-string">`&lt;!--[--&gt;`</span>)
  }
  context.<span class="hljs-title function_">pushStatement</span>(
    <span class="hljs-title function_">createCallExpression</span>(context.<span class="hljs-title function_">helper</span>(<span class="hljs-variable constant_">SSR_RENDER_LIST</span>), [
      node.<span class="hljs-property">source</span>,
      renderLoop,
    ]),
  )
  <span class="hljs-keyword">if</span> (!disableNestedFragments) {
    context.<span class="hljs-title function_">pushStringPart</span>(<span class="hljs-string">`&lt;!--]--&gt;`</span>)
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€åŸç†æ‹†è§£</h2>
<h3 data-id="heading-3">1. ç¬¬ä¸€é˜¶æ®µï¼šç»“æ„åŒ–æŒ‡ä»¤è½¬æ¢</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> <span class="hljs-type">const</span> ssrTransformFor: NodeTransform =
  <span class="hljs-built_in">createStructuralDirectiveTransform</span>(<span class="hljs-string">'for'</span>, processFor)
</code></pre>
<p>è¿™æ®µä»£ç è°ƒç”¨äº† Vue ç¼–è¯‘å™¨çš„æ ¸å¿ƒå·¥å…· <code>createStructuralDirectiveTransform</code>ã€‚<br/>
å…¶ä½œç”¨æ˜¯ï¼š</p>
<ul>
<li><strong>æ•è·æ¨¡æ¿ä¸­æ‰€æœ‰å¸¦ <code>v-for</code> çš„èŠ‚ç‚¹</strong>ï¼›</li>
<li><strong>è°ƒç”¨ <code>processFor</code></strong> å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª <code>ForNode</code> AST èŠ‚ç‚¹ã€‚</li>
</ul>
<blockquote>
<p>è¿™ä¸€é˜¶æ®µä»…æ„å»ºé™æ€ç»“æ„ï¼Œä¸å…³å¿ƒ SSR é€»è¾‘ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2. ç¬¬äºŒé˜¶æ®µï¼šSSR æ¸²æŸ“é€»è¾‘ç”Ÿæˆ</h3>
<p>æ¥ä¸‹æ¥ï¼Œ<code>ssrProcessFor</code> ä¼šåœ¨ SSR transform pass ä¸­è¢«è°ƒç”¨ï¼Œå°† <code>ForNode</code> è½¬åŒ–ä¸ºæœ€ç»ˆçš„æœåŠ¡ç«¯å­—ç¬¦ä¸²æ‹¼æ¥é€»è¾‘ã€‚</p>
<h4 data-id="heading-5">(1) åˆ¤æ–­æ˜¯å¦éœ€è¦ Fragment åŒ…è£¹</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">needFragmentWrapper</span> =
  !disableNestedFragments &amp;&amp;
  (node.children.length !== 1 || node.children<span class="hljs-section">[0]</span>.type !== NodeTypes.ELEMENT)
</code></pre>
<ul>
<li>å½“ <code>v-for</code> å†…æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæˆ–å­èŠ‚ç‚¹ä¸æ˜¯å•ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦ç”¨æ³¨é‡Šæ ‡è®°çš„ <strong>fragment åŒ…è£¹</strong>ï¼Œä»¥åœ¨ SSR è¾“å‡ºä¸­ç»´æŒæ­£ç¡®çš„å±‚çº§ç»“æ„ã€‚</li>
<li>ä¾‹å¦‚ï¼š</li>
</ul>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> v-for="<span class="hljs-selector-tag">i</span> in list"&gt;
  &lt;<span class="hljs-selector-tag">span</span>&gt;{{ <span class="hljs-selector-tag">i</span> }}&lt;/<span class="hljs-selector-tag">span</span>&gt;
  &lt;<span class="hljs-selector-tag">p</span>&gt;text&lt;/<span class="hljs-selector-tag">p</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>ä¼šè¢«åŒ…è£¹ä¸ºï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--[--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-comment">&lt;!--]--&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">(2) æ„é€ å¾ªç¯å‡½æ•°è¡¨è¾¾å¼</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">renderLoop</span> = createFunctionExpression(
  createForLoopParams(node.parseResult),
)
</code></pre>
<ul>
<li>
<p><code>createForLoopParams</code> ä» <code>v-for="(item, index) in list"</code> ä¸­æå–å‚æ•°ï¼š<code>(item, index)</code>ï¼›</p>
</li>
<li>
<p><code>createFunctionExpression</code> åˆ™ç”Ÿæˆç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">(item, <span class="hljs-keyword">index</span>) =&gt; { <span class="hljs-regexp">/* æ¸²æŸ“é€»è¾‘ */</span> }
</code></pre>
</li>
</ul>
<hr/>
<h4 data-id="heading-7">(3) ç”Ÿæˆå¾ªç¯ä½“é€»è¾‘</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">renderLoop.body</span> = processChildrenAsStatement(
  node,
  context,
  needFragmentWrapper,
)
</code></pre>
<ul>
<li><code>processChildrenAsStatement</code> ä¼šæŠŠ <code>v-for</code> çš„å­èŠ‚ç‚¹è½¬åŒ–ä¸º SSR è¾“å‡ºè¯­å¥ï¼›</li>
<li>å…¶ä¸­ä¼šé€’å½’è°ƒç”¨ SSR ç‰ˆæœ¬çš„ <code>processElement</code>ã€<code>processText</code> ç­‰ï¼›</li>
<li>å¦‚æœ <code>needFragmentWrapper = true</code>ï¼Œåˆ™ä¼šåœ¨è¾“å‡ºä¸­æ’å…¥æ³¨é‡ŠèŠ‚ç‚¹åŒ…è£¹å­èŠ‚ç‚¹ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-8">(4) ç”Ÿæˆæœ€ç»ˆ SSR è°ƒç”¨è¡¨è¾¾å¼</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">context</span><span class="hljs-selector-class">.pushStatement</span>(
  <span class="hljs-built_in">createCallExpression</span>(context.<span class="hljs-built_in">helper</span>(SSR_RENDER_LIST), [
    node.source,
    renderLoop,
  ]),
)
</code></pre>
<p>ç”Ÿæˆçš„ä»£ç é€»è¾‘å¤§è‡´ç­‰ä»·äºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">_ssrRenderList</span>(list, <span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
  <span class="hljs-comment">// renderLoop.body é€»è¾‘</span>
})
</code></pre>
<p><code>SSR_RENDER_LIST</code> æ˜¯ Vue SSR è¿è¡Œæ—¶çš„è¾…åŠ©å‡½æ•°ï¼Œä½œç”¨ä¸å®¢æˆ·ç«¯æ¸²æŸ“ä¸­çš„ <code>renderList</code> ç›¸åŒï¼Œç”¨äºåœ¨ SSR é˜¶æ®µæ‰§è¡Œå¾ªç¯æ¸²æŸ“ã€‚</p>
<hr/>
<h4 data-id="heading-9">(5) å¤„ç† Fragment åŒ…è£¹æ ‡è®°</h4>
<pre><code class="hljs language-xml" lang="xml">if (!disableNestedFragments) {
  context.pushStringPart(`<span class="hljs-comment">&lt;!--[--&gt;</span>`)
}
// ...loop...
if (!disableNestedFragments) {
  context.pushStringPart(`<span class="hljs-comment">&lt;!--]--&gt;</span>`)
}
</code></pre>
<ul>
<li>
<p>è¿™ä¸¤è¡Œåˆ†åˆ«åœ¨å¾ªç¯è¾“å‡ºå‰åæ’å…¥ç‰¹æ®Šæ³¨é‡Šæ ‡è®°ï¼›</p>
</li>
<li>
<p>è¿™äº›æ ‡è®°å¸®åŠ©å®¢æˆ·ç«¯ hydration è¿‡ç¨‹æ­£ç¡®å®šä½ Fragment è¾¹ç•Œï¼›</p>
</li>
<li>
<p>ä¾‹å¦‚ SSR è¾“å‡ºï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--[--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-comment">&lt;!--]--&gt;</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-10">å››ã€æ ¸å¿ƒé€»è¾‘æµç¨‹å›¾</h2>
<pre><code class="hljs language-scss" lang="scss">v-for AST èŠ‚ç‚¹
    â†“
<span class="hljs-built_in">ssrProcessFor</span>()
    â†“
åˆ¤æ–­æ˜¯å¦éœ€è¦ Fragment
    â†“
æ„é€  renderLoop å‡½æ•°è¡¨è¾¾å¼
    â†“
å°†å­èŠ‚ç‚¹è½¬æ¢ä¸ºå¯æ‰§è¡Œè¯­å¥å—
    â†“
åŒ…è£… SSR_RENDER_LIST è°ƒç”¨
    â†“
è¾“å‡ºå­—ç¬¦ä¸²æ ‡è®° + æ¸²æŸ“ç»“æœ
</code></pre>
<hr/>
<h2 data-id="heading-11">äº”ã€ä¸å®¢æˆ·ç«¯ç¼–è¯‘å¯¹æ¯”</h2>



































<table><thead><tr><th>ç»´åº¦</th><th>å®¢æˆ·ç«¯ç¼–è¯‘</th><th>SSR ç¼–è¯‘</th></tr></thead><tbody><tr><td>è¾“å‡ºç›®æ ‡</td><td>Virtual DOM æ¸²æŸ“å‡½æ•°</td><td>å­—ç¬¦ä¸²æ‹¼æ¥é€»è¾‘</td></tr><tr><td>è¿è¡Œæ—¶ Helper</td><td><code>renderList</code></td><td><code>SSR_RENDER_LIST</code></td></tr><tr><td>Fragment</td><td>ç”¨ VNode åŒ…è£¹</td><td>ç”¨æ³¨é‡ŠèŠ‚ç‚¹åŒ…è£¹</td></tr><tr><td>Hydration éœ€æ±‚</td><td>ä¸å­˜åœ¨</td><td>å¿…é¡»ç»´æŒ DOM è¾¹ç•Œä¸€è‡´æ€§</td></tr><tr><td>å­èŠ‚ç‚¹å¤„ç†</td><td>ç”Ÿæˆè™šæ‹ŸèŠ‚ç‚¹æ•°ç»„</td><td>è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¾“å‡ºé€»è¾‘</td></tr></tbody></table>
<p>å¯ä»¥çœ‹å‡ºï¼ŒSSR çš„ <code>v-for</code> å¤„ç†é€»è¾‘é‡ç‚¹åœ¨äº<strong>å­—ç¬¦ä¸²è¾“å‡ºæ­£ç¡®æ€§ä¸ Hydration è¾¹ç•Œç»´æŠ¤</strong>ï¼Œè€Œéè™šæ‹ŸèŠ‚ç‚¹æ„é€ ã€‚</p>
<hr/>
<h2 data-id="heading-12">å…­ã€å®è·µæ¡ˆä¾‹</h2>
<h3 data-id="heading-13">ç¤ºä¾‹æ¨¡æ¿</h3>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">ul</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> v-for="(item, <span class="hljs-selector-tag">i</span>) in list"&gt;{{ item }}&lt;/<span class="hljs-selector-tag">li</span>&gt;
&lt;/<span class="hljs-selector-tag">ul</span>&gt;
</code></pre>
<h3 data-id="heading-14">SSR ç¼–è¯‘ç»“æœï¼ˆç®€åŒ–åï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">_ssrRenderList</span>(_ctx.<span class="hljs-property">list</span>, <span class="hljs-function">(<span class="hljs-params">item, i</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;li&gt;<span class="hljs-subst">${_ssrInterpolate(item)}</span>&lt;/li&gt;`</span>
})
</code></pre>
<p>åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œè¯¥å‡½æ•°è¿”å›æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œæœ€ç»ˆç”Ÿæˆ HTMLã€‚</p>
<hr/>
<h2 data-id="heading-15">ä¸ƒã€æ‹“å±•æ€è€ƒ</h2>
<ol>
<li>
<p><strong><code>disableNestedFragments</code> å‚æ•°çš„ç”¨é€”</strong></p>
<ul>
<li>ç”¨äºåµŒå¥—ç»“æ„ä¸­ï¼ˆå¦‚ <code>v-for</code> å†…éƒ¨çš„ <code>v-if</code>ï¼‰ï¼Œé¿å…é‡å¤åŒ…è£¹ã€‚</li>
<li>ä¾‹å¦‚æ¨¡æ¿å±‚å·²ç»æ·»åŠ äº† Fragment æ³¨é‡Šï¼Œå°±å¯ä»¥ç¦ç”¨å†…éƒ¨ fragmentã€‚</li>
</ul>
</li>
<li>
<p><strong><code>SSR_RENDER_LIST</code> çš„æ‰§è¡Œæœºåˆ¶</strong></p>
<ul>
<li>åœ¨è¿è¡Œæ—¶æ‰§è¡Œå¾ªç¯ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²ï¼›</li>
<li>åŒæ—¶ç»´æŒé¡ºåºå’Œç´¢å¼•ä¸€è‡´ï¼Œç¡®ä¿ hydration å¯¹åº”å…³ç³»ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–æ–¹å‘</strong></p>
<ul>
<li>å¯é’ˆå¯¹é™æ€ <code>list</code> è¿›è¡Œç¼–è¯‘æœŸå±•å¼€ï¼›</li>
<li>åœ¨é•¿åˆ—è¡¨ä¸­é€šè¿‡åˆ†å—æ¸²æŸ“å‡å°‘å†…å­˜å ç”¨ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-16">å…«ã€æ½œåœ¨é—®é¢˜ä¸è°ƒè¯•è¦ç‚¹</h2>






























<table><thead><tr><th>é—®é¢˜</th><th>å¯èƒ½åŸå› </th><th>è§£å†³æ€è·¯</th></tr></thead><tbody><tr><td>SSR è¾“å‡ºç»“æ„ä¸åŒ¹é…</td><td>ç¼ºå°‘ Fragment æ³¨é‡Šè¾¹ç•Œ</td><td>æ£€æŸ¥ <code>needFragmentWrapper</code> åˆ¤æ–­é€»è¾‘</td></tr><tr><td>Hydration é”™ä½</td><td>å­èŠ‚ç‚¹é¡ºåºæˆ–æ³¨é‡Šæ ‡è¯†é”™è¯¯</td><td>ç¡®è®¤ <code>&lt;!--[--&gt;</code> å’Œ <code>&lt;!--]--&gt;</code> å¯¹åº”ä½ç½®</td></tr><tr><td>æ€§èƒ½ä¸‹é™</td><td>åŠ¨æ€è¡¨è¾¾å¼å¤æ‚</td><td>å¯ä½¿ç”¨ key ä¼˜åŒ– diff é€»è¾‘</td></tr><tr><td>åµŒå¥—å¾ªç¯å‡ºé”™</td><td>å‚æ•°ä½œç”¨åŸŸå†²çª</td><td>æ£€æŸ¥ <code>createForLoopParams</code> æ˜¯å¦æ­£ç¡®ç”Ÿæˆå‚æ•°</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">ä¹ã€æ€»ç»“</h2>
<p><code>ssrProcessFor</code> æ˜¯ Vue SSR ç¼–è¯‘ç®¡çº¿ä¸­å°†æ¨¡æ¿å¾ªç¯æŒ‡ä»¤è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¸²æŸ“é€»è¾‘çš„å…³é”®æ¨¡å—ã€‚<br/>
å…¶æ ¸å¿ƒå·¥ä½œåŒ…æ‹¬ï¼š</p>
<ul>
<li>ç”Ÿæˆå¾ªç¯å‡½æ•°è¡¨è¾¾å¼ï¼›</li>
<li>å¤„ç†å­èŠ‚ç‚¹æ¸²æŸ“ï¼›</li>
<li>ç®¡ç† Fragment åŒ…è£¹ä¸æ³¨é‡Šè¾¹ç•Œï¼›</li>
<li>æœ€ç»ˆç”ŸæˆåŸºäº <code>SSR_RENDER_LIST</code> çš„å¯æ‰§è¡Œè¾“å‡ºã€‚</li>
</ul>
<p>å®ƒæ˜¯ Vue SSR ä¿è¯æ¨¡æ¿åœ¨å®¢æˆ·ç«¯å¤æ°´æ—¶<strong>ç»“æ„ç²¾ç¡®å¯¹åº”</strong>çš„é‡è¦æœºåˆ¶ä¹‹ä¸€ã€‚</p>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>