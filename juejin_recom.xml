<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[剑指offer-52、正则表达式匹配]]></title>    <link>https://juejin.cn/post/7585019819193810954</link>    <guid>https://juejin.cn/post/7585019819193810954</guid>    <pubDate>2025-12-18T15:17:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585019819193810954" data-draft-id="7582861402278658082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="剑指offer-52、正则表达式匹配"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-18T15:17:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            剑指offer-52、正则表达式匹配
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T15:17:23.000Z" title="Thu Dec 18 2025 15:17:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题⽬描述</h2>
<p>请实现⼀个函数⽤来匹配包括' . '和' * '的正则表达式。模式中的字符' . '表示任意⼀个字符，
⽽' * '表示它前⾯的字符可以出现任意次（包含0 次）。 在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串" aaa "与模式" a.a "和" ab*ac*a "匹配，但是与" aa.a "和" ab*a "均不匹
配</p>
<p>示例1
输⼊: "aaa","a*a"
返回值: true</p>
<p>示例2
输⼊："aad","c*a*d"
返回值：true
说明：因为这⾥ c 为 0 个，a被重复⼀次， * 表示零个或多个a。因此可以匹配字符串 "aad"。</p>
<p>示例3
输⼊："",".*"
返回值：true
说明：".*" 表示可匹配零个或多个（'*'）任意字符（'.'）</p>
<h2 data-id="heading-1">思路及解答</h2>
<h3 data-id="heading-2">递归</h3>
<p>分类讨论，原串定义为str ,模式串为pattern 。`</p>
<ul>
<li>如果pattern ⻓度为0
<ul>
<li>且str ⻓度为0 ,说明刚刚好匹配完，返回ture</li>
<li>str ⻓度不为0 ，说明没有匹配完，返回false</li>
</ul>
</li>
<li>如果pattern 的⻓度⼤于0
<ul>
<li>如果pattern 的⻓度⼤于1 ，且第2 个字符是* ，说明前⾯的字符可以匹配0 ， 1 或者多次
<ul>
<li>分为两种情况讨论：⼀种是直接把* 和* 前⾯的字符去掉，相当于匹配了0 个，然后接着⽐较；另外⼀种是，如果str 的⻓度⼤于0 ，并且第⼀个字符匹配，那就把str 的第⼀个字符去掉，两者接着匹配。</li>
</ul>
</li>
<li>否则，说明第⼆个字符不是 * ，那么就直接⽐较第⼀个字符是不是匹配，同时将后⾯的字符进⾏匹配。</li>
</ul>
</li>
</ul>
<p>注意：上⾯说的第⼀个字符是不是匹配，除了两个字符相等的情况，其实还有模式串的字符为' . '的情况。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isMatch</span><span class="hljs-params">(String s, String p)</span> {
        <span class="hljs-comment">// 模式串为空时，文本串也必须为空才匹配</span>
        <span class="hljs-keyword">if</span> (p.isEmpty()) <span class="hljs-keyword">return</span> s.isEmpty();
        
        <span class="hljs-comment">// 检查首字符匹配：文本串非空且字符相等或模式为'.'</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">firstMatch</span> <span class="hljs-operator">=</span> !s.isEmpty() &amp;&amp; 
                            (s.charAt(<span class="hljs-number">0</span>) == p.charAt(<span class="hljs-number">0</span>) || p.charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">'.'</span>);
        
        <span class="hljs-comment">// 处理'*'通配符（确保模式长度≥2且第二个字符是'*'）</span>
        <span class="hljs-keyword">if</span> (p.length() &gt;= <span class="hljs-number">2</span> &amp;&amp; p.charAt(<span class="hljs-number">1</span>) == <span class="hljs-string">'*'</span>) {
            <span class="hljs-comment">// 两种情况：1) '*'匹配0个前驱字符 2) 匹配1个及以上前驱字符</span>
            <span class="hljs-keyword">return</span> isMatch(s, p.substring(<span class="hljs-number">2</span>)) || 
                   (firstMatch &amp;&amp; isMatch(s.substring(<span class="hljs-number">1</span>), p));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 无'*'情况：首字符匹配且剩余部分也匹配</span>
            <span class="hljs-keyword">return</span> firstMatch &amp;&amp; isMatch(s.substring(<span class="hljs-number">1</span>), p.substring(<span class="hljs-number">1</span>));
        }
    }
}
</code></pre>
<ul>
<li>时间复杂度：最坏O((m+n)2^(m+n))</li>
<li>空间复杂度：O(m²+n²)递归栈</li>
</ul>
<h3 data-id="heading-3">记忆化搜索（递归+缓存）</h3>
<p>在递归基础上添加缓存，避免重复计算。使用二维数组存储s[i:]和p[j:]的匹配结果，避免重复递归</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">private</span> Boolean[][] memo; <span class="hljs-comment">// 缓存数组：null未计算，true/false已计算</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isMatch</span><span class="hljs-params">(String s, String p)</span> {
        memo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Boolean</span>[s.length() + <span class="hljs-number">1</span>][p.length() + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">return</span> dfs(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, s, p);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j, String s, String p)</span> {
        <span class="hljs-comment">// 检查缓存是否存在当前子问题的解</span>
        <span class="hljs-keyword">if</span> (memo[i][j] != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> memo[i][j];
        
        <span class="hljs-type">boolean</span> result;
        <span class="hljs-comment">// 模式串耗尽时，文本串也必须耗尽</span>
        <span class="hljs-keyword">if</span> (j == p.length()) {
            result = (i == s.length());
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 计算当前首字符匹配状态</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">firstMatch</span> <span class="hljs-operator">=</span> (i &lt; s.length()) &amp;&amp; 
                                (s.charAt(i) == p.charAt(j) || p.charAt(j) == <span class="hljs-string">'.'</span>);
            
            <span class="hljs-comment">// 处理'*'通配符</span>
            <span class="hljs-keyword">if</span> (j + <span class="hljs-number">1</span> &lt; p.length() &amp;&amp; p.charAt(j + <span class="hljs-number">1</span>) == <span class="hljs-string">'*'</span>) {
                result = dfs(i, j + <span class="hljs-number">2</span>, s, p) || <span class="hljs-comment">// 匹配0次</span>
                        (firstMatch &amp;&amp; dfs(i + <span class="hljs-number">1</span>, j, s, p)); <span class="hljs-comment">// 匹配1+次</span>
            } <span class="hljs-keyword">else</span> {
                result = firstMatch &amp;&amp; dfs(i + <span class="hljs-number">1</span>, j + <span class="hljs-number">1</span>, s, p);
            }
        }
        memo[i][j] = result; <span class="hljs-comment">// 存储结果到缓存</span>
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<ul>
<li>时间复杂度：O(m×n)</li>
<li>空间复杂度：O(m×n)</li>
</ul>
<h3 data-id="heading-4">动态规划（推荐）</h3>
<p>动态规划：</p>
<ol>
<li>⾸先定义状态：⽤⼀个⼆维数组（套路） <code>dp[i][j]</code> ⽤来表示str 的前i 个字符和pattern 的前j 个字符是否匹配。</li>
<li>初始化简单状态
<ul>
<li><code>dp[0][0]= true</code> ,表示两个空的字符串是匹配的。</li>
<li>dp 数组的⾸列，除了<code>dp[0][0] 为true</code> ，其他的都是false 。因为pattern 为空，但是s 不为空的时候，肯定不匹配。</li>
<li>dp 的⾸⾏，也就是str 为空的时候，如果pattern 的偶数位都是“*”,那么就可以匹配，因为可以选择匹配0 次。</li>
</ul>
</li>
<li>初始化前⾯之后，后⾯的从索引1 开始匹配：
<ol>
<li>pattern 的第j 个字符为“ * ”(即是 <code>pattern[j-1]=='*'</code> )
<ol>
<li>如果<code>dp[i][j-2]==true</code> ，那么<code>dp[i][j]=true</code> (相当于str的前i和pattern的前j-2个字符匹配，此时的* 前⾯的那个字符出现了0 次)。</li>
<li>如果<code>dp[i-1][j]==true</code> 且<code>str[i-1]==pattern[j-2]</code> ，则<code>dp[i][j] =true</code> 。（如果str 的前i - 1 个字符和pattern 的前j 个字符匹配，并且str 的第i 个字符和pattern 的第j - 1 个字符相等,相当于‘ * ’前⾯的字符出现了1 次）</li>
<li>如果<code>dp[i-1][j]=true</code> 且<code>pattern[j-2]=='.'</code> 的时候，则<code>dp[i][j]=true</code> 。(表示str 的前i-1 个和patten 的前j 个匹配，并且pattern 的第j-1 个是‘ . ’，第j 个是‘ * ’,那么说明可以匹配任何字符任何次数，⾃然str 可以多匹配⼀个字符。)</li>
</ol>
</li>
<li>pattern 的第j 个字符不为“ * ”(即是<code>pattern[j-1]！='*'</code> )
<ol>
<li>如果<code>dp[i - 1][j - 1]=true and str[i - 1] == pattern[j - 1]</code> 时，则<code>dp[i][j]=true</code> 。（也就是前⾯匹配，接下来的字符⼀样匹配）</li>
<li>如果<code>dp[i - 1][j - 1]=true</code> 且<code>pattern[i-1]=='.'</code> ，那么<code>dp[i][j]=true</code> 。(其实也是. 可以匹配任何字符)</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>处理完数组之后，最后返回<code>dp[n-1][m-1]</code> ，也就是str 的前n 个和pattern 的前m 个字符是否匹配。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(String str, String pattern)</span> {
	<span class="hljs-keyword">if</span> (pattern.length() == <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">return</span> str.length() == <span class="hljs-number">0</span>;
	}
	
	<span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> str.length() + <span class="hljs-number">1</span>;
	<span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> pattern.length() + <span class="hljs-number">1</span>;
	<span class="hljs-type">boolean</span>[][] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[n][m];
	dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;
	
	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; j &lt; m; j = j + <span class="hljs-number">2</span>) {
		<span class="hljs-keyword">if</span> (dp[<span class="hljs-number">0</span>][j - <span class="hljs-number">2</span>] &amp;&amp; pattern.charAt(j - <span class="hljs-number">1</span>) == <span class="hljs-string">'*'</span>) {
			dp[<span class="hljs-number">0</span>][j] = <span class="hljs-literal">true</span>;
		}
	}
	
	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) {
		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt; m; j++) {
			<span class="hljs-keyword">if</span> (pattern.charAt(j - <span class="hljs-number">1</span>) == <span class="hljs-string">'*'</span>) {
			dp[i][j] = dp[i][j - <span class="hljs-number">2</span>] || dp[i - <span class="hljs-number">1</span>][j] &amp;&amp; (str.charAt(i - <span class="hljs-number">1</span>) == pattern.charAt(j - <span class="hljs-number">2</span>) || pattern.charAt(j - <span class="hljs-number">2</span>) == <span class="hljs-string">'.'</span>);
			} <span class="hljs-keyword">else</span> {
			dp[i][j] = dp[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>] &amp;&amp; (str.charAt(i - <span class="hljs-number">1</span>) == pattern.charAt(j - <span class="hljs-number">1</span>) || pattern.charAt(j - <span class="hljs-number">1</span>) == <span class="hljs-string">'.'</span>);
			}
		}
	}
	<span class="hljs-keyword">return</span> dp[n - <span class="hljs-number">1</span>][m - <span class="hljs-number">1</span>];
}
</code></pre>
<ul>
<li>时间复杂度 O(mn) ： 其中 m , n 分别为 str 和 pattern 的⻓度，状态转移需遍历整个 dp 矩阵。</li>
<li>空间复杂度 O(mn) ： 状态矩阵 dp 使⽤ O(mn) 的额外空间。</li>
</ul>
<h3 data-id="heading-5">状态机优化（空间优化DP）</h3>
<p>状态机优化：滚动数组降低空间复杂度，只保留当前行和上一行的状态，空间优化到O(n)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isMatch</span><span class="hljs-params">(String s, String p)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> s.length(), n = p.length();
        <span class="hljs-type">boolean</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[n + <span class="hljs-number">1</span>];
        <span class="hljs-type">boolean</span>[] prev = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[n + <span class="hljs-number">1</span>];
        
        <span class="hljs-comment">// 初始化第一行（空文本串情况）</span>
        dp[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; j &lt;= n; j++) {
            <span class="hljs-keyword">if</span> (p.charAt(j - <span class="hljs-number">1</span>) == <span class="hljs-string">'*'</span>) {
                dp[j] = dp[j - <span class="hljs-number">2</span>];
            }
        }
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= m; i++) {
            <span class="hljs-comment">// 保存上一行状态</span>
            <span class="hljs-type">boolean</span>[] temp = prev;
            prev = dp;
            dp = temp;
            
            <span class="hljs-comment">// 初始化当前行首列</span>
            dp[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= n; j++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> s.charAt(i - <span class="hljs-number">1</span>);
                <span class="hljs-type">char</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> p.charAt(j - <span class="hljs-number">1</span>);
                
                <span class="hljs-keyword">if</span> (pc == <span class="hljs-string">'*'</span>) {
                    <span class="hljs-type">char</span> <span class="hljs-variable">prevChar</span> <span class="hljs-operator">=</span> p.charAt(j - <span class="hljs-number">2</span>);
                    <span class="hljs-type">boolean</span> <span class="hljs-variable">matchZero</span> <span class="hljs-operator">=</span> dp[j - <span class="hljs-number">2</span>];
                    <span class="hljs-type">boolean</span> <span class="hljs-variable">matchMulti</span> <span class="hljs-operator">=</span> (prevChar == sc || prevChar == <span class="hljs-string">'.'</span>) &amp;&amp; prev[j];
                    dp[j] = matchZero || matchMulti;
                } <span class="hljs-keyword">else</span> {
                    dp[j] = (pc == <span class="hljs-string">'.'</span> || pc == sc) &amp;&amp; prev[j - <span class="hljs-number">1</span>];
                }
            }
        }
        
        <span class="hljs-keyword">return</span> dp[n];
    }
}
</code></pre>
<ul>
<li>时间复杂度：O(m×n)</li>
<li>空间复杂度：O(n)</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学会在Jetpack Compose中加载Lottie动画资源]]></title>    <link>https://juejin.cn/post/7585024562216910888</link>    <guid>https://juejin.cn/post/7585024562216910888</guid>    <pubDate>2025-12-18T15:18:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585024562216910888" data-draft-id="7584991956126662691" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学会在Jetpack Compose中加载Lottie动画资源"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-12-18T15:18:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学会在Jetpack Compose中加载Lottie动画资源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T15:18:17.000Z" title="Thu Dec 18 2025 15:18:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「From File to Fetch」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Ffrom-file-to-fetch-ed6dca1122c8" target="_blank" title="https://proandroiddev.com/from-file-to-fetch-ed6dca1122c8" ref="nofollow noopener noreferrer">proandroiddev.com/from-file-t…</a>，由Katie Barnett发布于2025年11月23日。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ef49222b1294da498786c9d0c8b451d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=pQW%2BUQGDkobYCWOiKULJC3lSIyE%3D" alt="Lottie logo 动画来自 https://lottie.airbnb.tech/#/" loading="lazy"/></p>
<p><em>注意</em>：我与 Airbnb 及其<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fairbnb%2Flottie-android" target="_blank" title="https://github.com/airbnb/lottie-android" ref="nofollow noopener noreferrer"> Lottie 项目（Lottie 的 GitHub 仓库）没有任何关联。</a> 我最近刚在一个应用中实现了 Lottie，想分享一些示例来佐证<a href="https://link.juejin.cn?target=https%3A%2F%2Flottie.airbnb.tech%2F%23%2Fandroid-compose" target="_blank" title="https://lottie.airbnb.tech/#/android-compose" ref="nofollow noopener noreferrer">官方文档</a>。</p>
<h2 data-id="heading-0">了解 Lottie</h2>
<p>之前，我写过关于动画的文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fbilue%2Fexpanding-dialog-in-jetpack-compose-a6be40deab86" target="_blank" title="https://medium.com/bilue/expanding-dialog-in-jetpack-compose-a6be40deab86" ref="nofollow noopener noreferrer">medium.com/bilue/card-…</a>，也<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Dol9zpXu3g1U" target="_blank" title="https://www.youtube.com/watch?v=ol9zpXu3g1U" ref="nofollow noopener noreferrer">在</a>上讨论过这个主题，以及我是如何创建原生动画的。但有时，我们想要一些更具艺术性的效果，不需要移动屏幕上的可组合元素；这时，我们就需要一个预先构建好的动画。</p>
<p>Lottie 就派上用场了。</p>
<p>如果你之前没有使用过 Lottie，它是由 Airbnb 开发人员开发的一个库，可以解析 Adob​​e After Effects 动画并将其导出为 JSON 格式。其理念是，设计师可以创建复杂的动画，而无需手动渲染。有很多设计工具的插件可以帮助创建动画，例如 Figma。如果你具备一定的设计天赋（我没有！），上手也很容易。</p>
<p>Lottie 已经存在一段时间了，可以在多个平台上渲染，例如 iOS、Web、Windows，当然还有 Android。它可用于 <a href="https://link.juejin.cn?target=https%3A%2F%2Flottie.airbnb.tech%2F%23%2Fandroid" target="_blank" title="https://lottie.airbnb.tech/#/android" ref="nofollow noopener noreferrer">XML 视图</a>，但我今天要重点介绍的是它与 Jetpack Compose 的集成。</p>
<p>官方文档在这里 <a href="https://link.juejin.cn?target=https%3A%2F%2Flottie.airbnb.tech%2F%23%2Fandroid-compose" target="_blank" title="https://lottie.airbnb.tech/#/android-compose" ref="nofollow noopener noreferrer">lottie.airbnb.tech/#/android-c…</a>，但它并没有详细介绍如何使用 <code>LottieCompositionSpec</code> 中的多种不同源类​​型，以最便捷的方式提供我们的 Lottie 文件。实际上，某些应用可能需要处理多种源类型，尤其是在后端调用中指定特定动画的情况下。</p>
<p>我们将逐步介绍每种类型，但首先，让我们使用字符串来保存 Lottie 动画数据，从而进行基本设置。</p>
<h2 data-id="heading-1">字符串来源</h2>
<p>使用任何 SDK 的第一步都是添加依赖项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build.gradle.kts</span>
...

dependencies {
    ...
    implementation(libs.lottie.compose)
}

<span class="hljs-comment">// libs.version.toml</span>
[versions]
lottie = <span class="hljs-string">"6.6.6"</span>

[libraries]
lottie-compose = { group = <span class="hljs-string">"com.airbnb.android"</span>, name = <span class="hljs-string">"lottie-compose"</span>, version.ref = <span class="hljs-string">"lottie"</span> }
</code></pre>
<p>然后，在 Composable 中，我们需要创建 <code>LottieCompositionSpec</code>。对于 JSON 字符串，我们可以使用 <code>LottieCompositionSpec.JsonString(val jsonString: String)</code>，</p>
<p>并将字符串传递给它。接下来，使用 <code>rememberLottieComposition</code> 并传入 <code>spec</code> 来记住组合状态。最后，可以将此状态传递给 <code>LottieAnimation</code> 以显示动画。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> lottieCompositionSpec = LottieCompositionSpec.JsonString(JSON_STRING)
<span class="hljs-keyword">val</span> lottieComposition = rememberLottieComposition(
    spec = lottieCompositionSpec
)
LottieAnimation(composition = lottieComposition.value)

<span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> JSON_STRING = <span class="hljs-string">"{\"v\":\"4.10.1\",...\"bm\":0}]}"</span>
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d96f45c1bd1d4acdb681f71464258709~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=0%2Fub66sVDQiBS7y3I2M%2B2G5yoDs%3D" alt="Lottie动画来自 https://github.com/airbnb/lottie-android" loading="lazy"/></p>
<p>现在，将动画存储在字符串中并非最易读或可持续的方式，更好的选择是使用Lottie JSON文件。一种方法是将其存储在assets目录中……</p>
<h2 data-id="heading-2">Asset文件</h2>
<p>我们可以将Lottie文件存储为<code>.json</code>或<code>.lottie</code>文件（它们是同一种文件，只是扩展名不同），并将其存储在<code>app/assets</code>目录中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a383980fc3c4d30a1a8e06fdcf43543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=1%2BjEAumJ9sEK%2F48tjjYwMojFkeY%3D" alt="" loading="lazy"/></p>
<p>这里唯一的区别是我们需要使用 <code>LottieCompositionSpec.Asset(val assetName: String)</code> 并传递 <code>assets</code> 目录下的路径（你可以根据需要进行组织）。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> lottieCompositionSpecLottieFile = LottieCompositionSpec.Asset(<span class="hljs-string">"animations/android_wave.lottie"</span>)
<span class="hljs-keyword">val</span> lottieCompositionSpecJsonFile = LottieCompositionSpec.Asset(<span class="hljs-string">"animations/android_wave.json"</span>)
</code></pre>
<p>类似地，我们可以使用 <code>LottieCompositionSpec.File(val fileName: String)</code> 从设备文件系统中的任何位置加载动画文件——只需确保应用程序已获得该文件的访问权限即可！</p>
<p>使用资源文件意味着我们无法获得编译时保护来确保文件存在，但我们可以使用 <code>res/raw</code> 目录。</p>
<h2 data-id="heading-3">原始资源文件</h2>
<p>同样，这很简单，只需将文件添加到 <code>raw</code> 目录即可：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10f475d01cdb4f9ea8a67922d39037aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=GHtLe6tQZGZBHAeHDNlOfsJO5rk%3D" alt="" loading="lazy"/></p>
<p>现在，我们可以通过使用 <code>LottieCompositionSpec.RawRes</code> 和 <code>R.raw</code> 访问原始资源，从而获得编译时安全性。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> lottieCompositionSpec = LottieCompositionSpec.RawRes(R.raw.android_wave)
</code></pre>
<p>最后，如果我们希望在需要时动态获取 Lottie 文件，而不是将其打包到应用程序中，我们可以从 URL 加载它。</p>
<h2 data-id="heading-4">URL 来源</h2>
<p>与上述类似，我们可以使用 <code>LottieCompositionSpec.Url</code> 加载以 URL 形式存储的 Lottie 文件：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> lottieCompositionSpec = LottieCompositionSpec.Url(<span class="hljs-string">"https://url/AndroidWave.json"</span>)
</code></pre>
<p>如果一切顺利，用户网络连接良好，这当然很好，但我们需要确保能够处理任何错误。</p>
<h3 data-id="heading-5">错误响应和添加加载状态</h3>
<p>动画加载也可能需要一些时间，尤其是在动画文件较大或用户网络连接不佳的情况下。为此，我们可以使用 <code>LottieCompositionResult</code> 来检测动画的状态。</p>
<p>当动画正在下载或解析时，<code>LottieCompositionResult.isLoading</code> 将为 true；当解析成功且合成已准备好显示时，<code>LottieCompositionResult.isSuccess</code> 将为 true。我们还有两个状态：<code>LottieCompositionResult.isComplete</code>，当 <code>isLoading</code> 为 false 时（无论组合是否成功），它将为 true；最后是 <code>LottieCompositionResult.isFailure</code>，当出现不可恢复的错误时（即下文讨论的 <code>onRetry</code> lambda 返回 <code>false</code> 时），它将为 true。</p>
<p>为了展示标准的加载、错误和成功行为，我们可以像这样使用 <code>isLoading</code> 和 <code>isSuccess</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">if</span> (lottieComposition.isLoading) {
    Box(
        contentAlignment = Alignment.Center,
        modifier = Modifier.height(<span class="hljs-number">100.</span>dp)
    ) {
        CircularProgressIndicator()
    }
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lottieComposition.isSuccess) {
    LottieAnimation(
        composition = lottieComposition.value,
        modifier = Modifier.height(<span class="hljs-number">100.</span>dp)
    )
} <span class="hljs-keyword">else</span> {
    Image(
        imageVector = Icons.Filled.Error,
        contentDescription = <span class="hljs-literal">null</span>,
        modifier = Modifier.height(<span class="hljs-number">100.</span>dp)
    )
}
</code></pre>
<h3 data-id="heading-6">重试动画加载错误</h3>
<p>Lottie 提供了一种简单易用的方法，可以使用 <code>rememberLottieComposition</code> 中的 <code>onRetry</code> 来重试动画加载。我们可以通过两种方式使用它：</p>
<p><strong>反复重试直到达到某个限制</strong></p>
<p>在构造 <code>rememberLottieComposition</code> 时，我们可以指定 <code>onRetry</code> lambda，并返回 <code>true</code> 以继续重试，返回 <code>false</code> 以停止重试。 <code>onRetry</code> 包含一个 <code>failCount</code> 参数。这允许应用重试次数限制或指数退避。例如：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> lottieComposition = rememberLottieComposition(
    spec = lottieCompositionSpec,
    onRetry = { failCount, exception -&gt;
        Timber.d(exception, <span class="hljs-string">"Error loading animation: <span class="hljs-subst">${exception.message}</span>"</span>)
        failCount &lt; <span class="hljs-number">5</span>
    }
)
</code></pre>
<p>这里我将动画设置为重试 5 次后停止。你可以在此 lambda 表达式中添加错误消息或其他任何有用的信息（但请使用上面描述的 <code>LottieCompositionResult.isLoading</code> 布尔值来显示加载行为，而不是在此处设置另一个变量）。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e38e57ef0b504d2ba5c540a3784e4c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=pdf970%2Ffcfmb%2FLdE3%2Fv5qMnMem8%3D" alt="" loading="lazy"/></p>
<p><strong>等待重试信号</strong></p>
<p>我们还可以允许动画等待重试，直到某个外部条件发生变化，例如按下按钮或恢复网络连接。</p>
<p>为此，我们使用 <code>rememberLottieRetrySignal</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> retrySignal = rememberLottieRetrySignal()
<span class="hljs-keyword">var</span> url <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">"https://bad/url"</span>) }
<span class="hljs-keyword">val</span> lottieCompositionSpec = LottieCompositionSpec.Url(url)
<span class="hljs-keyword">val</span> lottieComposition = rememberLottieComposition(
    spec = lottieCompositionSpec,
    onRetry = { _, exception -&gt;
        Timber.d(exception, <span class="hljs-string">"Error loading animation: <span class="hljs-subst">${exception.message}</span>"</span>)
        retrySignal.awaitRetry()
        <span class="hljs-literal">false</span>
    }
)
Column(...) {
    <span class="hljs-keyword">if</span> (lottieComposition.isLoading) {
        ...
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lottieComposition.isSuccess) {
        LottieAnimation(
            composition = lottieComposition.value,
            modifier = Modifier.height(<span class="hljs-number">100.</span>dp)
        )
    } <span class="hljs-keyword">else</span> {
        ...
    }
    TextButton(onClick = {
        url = <span class="hljs-string">"https://url/AndroidWave.json"</span>
        retrySignal.retry()
    }) {
        Text(<span class="hljs-string">"Fix url &amp; retry"</span>)
    }
}
</code></pre>
<p>在这个简单的示例中，我将 URL 设置为无效 URL，然后在 <code>onRetry</code> 中，当发生错误时，我们可以使用记住的 <code>retrySignal</code> 来等待重试。 <code>retrySignal.awaitRetry()</code>。动画将保持加载状态，直到按钮点击时调用 <code>retrySignal.retry()</code>。如果你不希望保持加载状态，而是希望在重试之前显示错误信息，你可以完全省略 <code>retrySignal</code>，并更新已记住的 <code>url</code> 状态，这样 <code>LottieCompositionSpec</code> 将重新组合。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f33b12cac264dc9a7e92e7a68e4571c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=k73g%2FYOs1KaESlB3ijEmu9UR6%2FE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">动画配置</h2>
<p>最后，动画加载正确后，我们可以使用一些其他配置项来优化动画效果。</p>
<p>虽然最好在 Lottie 文件本身（创建时完成）中控制这些动画行为，但你也可以通过以下方式调整动画的播放方式： <code>LottieAnimation</code> 本身是可组合的。要了解其功能，最好查看一些可用参数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// An excerpt from version 6.6.6 of the SDK</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LottieAnimation</span><span class="hljs-params">(
    clipSpec: <span class="hljs-type">LottieClipSpec</span>? = <span class="hljs-literal">null</span>,
    speed: <span class="hljs-type">Float</span> = <span class="hljs-number">1</span>f,
    iterations: <span class="hljs-type">Int</span> = <span class="hljs-number">1</span>,
    reverseOnRepeat: <span class="hljs-type">Boolean</span> = <span class="hljs-literal">false</span>,
    alignment: <span class="hljs-type">Alignment</span> = Alignment.Center,
    contentScale: <span class="hljs-type">ContentScale</span> = ContentScale.Fit,
    ... <span class="hljs-comment">// + others for more advanced use, check out the SDK documentation</span>
)</span></span> {}
</code></pre>
<p>在这里，我们可以控制：</p>
<ul>
<li>
<p><code>clipSpec</code>：动画播放的帧</p>
</li>
<li>
<p><code>speed</code>：动画速度</p>
</li>
<li>
<p><code>iterations</code>：动画运行次数（使用 <code>LottieConstants.IterateForever</code> 可无限循环）</p>
</li>
<li>
<p><code>reverseOnRepeat</code>：循环播放后反向播放</p>
</li>
<li>
<p><code>alignment</code> 和 <code>contentScale</code>：就像图像一样，我们可以调整动画在指定范围内的布局。</p>
</li>
</ul>
<p>现在你可以了解 Lottie 的所有用法，请务必为你正在开发的应用程序选择最佳方案，并选择最便捷的方式从你的设计团队获取文件，而无需费力地在不同文件格式之间进行转换。</p>
<p>再见！现在！</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ee34238a611486aa9da662fb834f649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766675897&amp;x-signature=cyNsE8UetmJjAdaiNyeC0LH4VUA%3D" alt="" loading="lazy"/></p>
<p>你可以在我的 GitHub 仓库的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKatieBarnett%2FExperiments%2Ftree%2Fmain%2Fjc-lottie" target="_blank" title="https://github.com/KatieBarnett/Experiments/tree/main/jc-lottie" ref="nofollow noopener noreferrer">jc-lottie</a> 模块中找到上述示例代码。</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Perfetto从入门到精通】4.使用 heapprofd 工具采样追踪 Java/Native 内存分配]]></title>    <link>https://juejin.cn/post/7585034139662712851</link>    <guid>https://juejin.cn/post/7585034139662712851</guid>    <pubDate>2025-12-18T15:50:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585034139662712851" data-draft-id="7585206549283815465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Perfetto从入门到精通】4.使用 heapprofd 工具采样追踪 Java/Native 内存分配"/> <meta itemprop="keywords" content="性能优化,Android,架构"/> <meta itemprop="datePublished" content="2025-12-18T15:50:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lei_official"/> <meta itemprop="url" content="https://juejin.cn/user/2351234021066314"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Perfetto从入门到精通】4.使用 heapprofd 工具采样追踪 Java/Native 内存分配
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2351234021066314/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lei_official
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T15:50:32.000Z" title="Thu Dec 18 2025 15:50:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>你信坚持是金</p>
<p>也信无常命运</p>
<p>信天赋努力</p>
<p>信笨拙委屈</p>
<p>—— 《回声》那英</p>
</blockquote>
<p>在本专栏前几篇文章里，笔者介绍过，使用 Perfetto 进行 Java Heap Dump 的方法。与通过 Android Studio Profiler 进行抓取类似，所得到的heap文件描述了应用在瞬时状态下的 <strong>堆内存分布</strong>、<strong>对象引用关系</strong> 信息，对于分析内存泄漏、OOM 等问题很有帮助。与此同时，Perfetto 还提供了另一强有力的分析工具 —— <code>Heapprofd</code>，它的优势在于能够 <strong>追踪</strong> 一段时间内，Native/Java 内存的全部 <strong>分配/回收</strong> 事件，从而发现是 <strong>哪些函数调用引起的内存上升</strong>。</p>
<h2 data-id="heading-0">环境要求</h2>
<p>使用 <code>heapprofd</code> 工具时，对于手机、APP的配置有要求</p>
<ul>
<li><strong>Android 版本</strong>：在10及以上</li>
<li><strong>系统构建方式</strong>：
<ul>
<li>如果是 <code>debug/eng</code> 构建：可调试所有的应用和大部分系统服务</li>
<li>如果是 <code>user</code> 构建
<ul>
<li>待调试应用是debug包 —— 可以抓取</li>
<li>待调试应用是release包 —— 需在Manifest中声明 <code>profileable</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">火焰图解读</h2>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b503dfceab424ac798ae062ec0472c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVpX29mZmljaWFs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766677932&amp;x-signature=GQ5SsnAdGXq6O7r%2FAGG4TVvI%2FFE%3D" alt="native-heap-prof.png" width="70%" loading="lazy"/>
<p>火焰图并不复杂，甚至可以说相当直观。这是一张采样 <strong>Native 内存</strong> 的火焰图，每一块 <strong>矩形</strong> 对应一个 <strong>函数</strong>，其 <strong>面积大小</strong> 则意味着 <strong>该函数引起的内存分配大小</strong>。从上向下是函数的调用关系，纵向相邻的两个函数之间，上方的函数调用下方的函数。</p>
<p>可以选择查看不同的 Tab 的数据：</p>
<ul>
<li>Unreleased malloc size</li>
<li>Total malloc size</li>
<li>Unreleased malloc count</li>
<li>Total malloc count</li>
</ul>
<p><code>size</code> 反映了内存分配总大小，<code>count</code> 体现出的是申请内存的次数。</p>
<h2 data-id="heading-2">进行采样的3种方式</h2>
<p>Google 官方提供了3种进行内存分配采样的方式，它们在功能完整性、环境依赖上有所区别。</p>





























<table><thead><tr><th>序号</th><th>方法简述</th><th>环境依赖</th><th>功能全面性</th></tr></thead><tbody><tr><td>方式一</td><td>使用 <code>adb shell perfetto</code> 命令读取配置并执行</td><td>无</td><td>高，配置可编辑</td></tr><tr><td>方式二</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle%2Fperfetto%2Ftree%2Fmain%2Ftools" target="_blank" title="https://github.com/google/perfetto/tree/main/tools" ref="nofollow noopener noreferrer">python 执行 tools/heap_profile 脚本</a></td><td>python3 环境</td><td>高，脚本可编辑</td></tr><tr><td>方式三</td><td>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.perfetto.dev%2F" target="_blank" title="https://ui.perfetto.dev/" ref="nofollow noopener noreferrer">Perfetto网页工具</a> 进行抓取</td><td>无</td><td>低，只能从配置预设里面选择，不支持 Java Heap Sampling</td></tr></tbody></table>
<h3 data-id="heading-3">方式一：使用 <code>adb shell perfetto</code> 命令读取配置并执行</h3>
<p><strong>config.pbtx</strong></p>
<pre><code class="hljs language-textproto" lang="textproto">buffers {
  size_kb: 65536
  fill_policy: DISCARD
}
data_sources {
  config {
    name: "android.heapprofd"
    heapprofd_config {
      sampling_interval_bytes: 4096
      process_cmdline: "com.google.samples.apps.nowinandroid"
      shmem_size_bytes: 8388608
      block_client: true
      all_heaps: false
      heaps: "com.android.art"
    }
  }
}
duration_ms: 10000
</code></pre>
<p>对于上述配置，关键参数解释如下：</p>





















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>sampling_interval_bytes</td><td>以多少字节数的粒度进行采样</td></tr><tr><td>process_cmdline</td><td>要抓取的包名，(debug) or (release + profileable)</td></tr><tr><td>heaps</td><td><code>com.android.art</code> 表示采集虚拟机堆分配信息</td></tr></tbody></table>
<p><strong>对于 release 包，在 AndroidManifest.xml 中声明 profileable</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">application</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">profileable</span> <span class="hljs-attr">android:shell</span>=<span class="hljs-string">"true"</span>/&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>当然也可以增加想要抓取的其它信息作为配置，随后通过 <code>adb shell perfetto</code> 命令启动抓取，抓取完成后，将 <code>trace.pftrace</code> 文件pull到本地进行分析。</p>
<p><strong>抓取命令</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> config.pbtx | adb shell perfetto -c - --txt -o /data/misc/perfetto-traces/trace.pftrace
</code></pre>
<h3 data-id="heading-4">方式二：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle%2Fperfetto%2Ftree%2Fmain%2Ftools" target="_blank" title="https://github.com/google/perfetto/tree/main/tools" ref="nofollow noopener noreferrer">python执行tools/heap_profile脚本</a></h3>
<p>该脚本位于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle%2Fperfetto" target="_blank" title="https://github.com/google/perfetto" ref="nofollow noopener noreferrer">github.com/google/perf…</a> ，用参数 <code>processName</code>（-n com.google.samples.apps.nowinandroid）或者 <code>PID</code>（-p 1234）指明要抓取的进程。推荐使用 <strong>进程名</strong> 的方式，可以在进程启动前，就开始抓取任务（当然，进程尚未启动时，我们是不知道其 <code>PID</code> 的）。抓取到的数据保存为 <code>raw-trace</code>，可以用 Perfetto UI 查看。</p>
<h3 data-id="heading-5">方式三：使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.perfetto.dev%2F" target="_blank" title="https://ui.perfetto.dev/" ref="nofollow noopener noreferrer">Perfetto UI</a> 进行抓取</h3>
<p>这种方式无法抓取 Java 内存分配信息，不推荐。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/878db6484f6340bd94a89e1d13470afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVpX29mZmljaWFs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766677932&amp;x-signature=yVDo15TXieHUhNUer%2BINEad9xCI%3D" alt="perfetto-ui-profile-native-memory.png" width="70%" loading="lazy"/>
<h2 data-id="heading-6">采样 Native 内存</h2>
<h3 data-id="heading-7">对“采样”的理解</h3>
<p>既然是“采样”，说明并不是完整记录了全部的内存分配事件，而是 <strong>有选择地</strong>。在 Perfetto 中，采样的粒度取决于 <code>sampling_interval_bytes</code> 参数，翻译过来就是 <code>采样区间字节数</code>，其默认值是 <code>4KB</code>，表示 <strong>每当内存累计分配超过4KB时，就记录这一次内存申请的函数调用</strong>。</p>
<p>通过使用这种“按字节流抽样”的方法，结合 <code>Poisson sampling</code>（泊松抽样），<strong>可以让统计更加稳健，既能覆盖高频小分配，也不会漏掉低频大分配</strong>。</p>
<p>在目标进程里，<code>heapprofd</code> 拦截了 <code>libc</code> 的 <code>malloc/free</code> 家族调用。</p>
<h2 data-id="heading-8">采样 Java 内存</h2>
<p><strong>Java Heap Sampling</strong> 是一种 <strong>抽样式</strong> 的 <strong>Java 对象分配记录机制</strong>，用于观察内存分配趋势。它记录的是</p>
<ul>
<li>Java 对象分配事件（allocation）</li>
<li>对象类型（class）</li>
<li>分配大小</li>
<li>时间</li>
<li>线程</li>
</ul>
<p>一个典型的 Java 内存采样火焰图如下所示：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76ed8db5b01840f89d5995721f7a5863~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVpX29mZmljaWFs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766677932&amp;x-signature=3OlQvemD0IuEjs8uh%2BKYBAzeWyI%3D" alt="java-heap-samples.png" width="70%" loading="lazy"/>
<h3 data-id="heading-9">如何启用它</h3>
<ul>
<li>对于“<strong>方式一</strong>”，在配置文件中增加 <code>heaps: "com.android.art</code>（上文的配置文件已经增加）</li>
<li>对于“<strong>方式二</strong>”，执行 python 脚本时，增加 <code>--heaps com.android.art</code> 参数</li>
<li>对于“<strong>方式三</strong>”，不支持</li>
</ul>
<h3 data-id="heading-10">它会做什么</h3>
<p>它抽样记录了一段时间内对象分配的数量和大小，与 Native Heap 类似，但发生在 ART 层。</p>
<h3 data-id="heading-11">它不会做什么</h3>
<p>它不会扫描整个 Java Heap，也不会构建完整的 <strong>对象引用关系表</strong>。——这是 <code>heapdump</code>、<code>AS Profiler</code> 的职责。</p>
<p>它不会 <strong>记录对象的回收和销毁</strong>，这是 <code>ART 虚拟机</code> 自动执行的，Perfetto 无法介入。</p>
<blockquote>
<p>不知道什么原因，在同时开启 Java Heap Sampling 和 Java Heap Dumps 时，我只能在结果里得到前者，无法看到后者。</p>
</blockquote>
<h2 data-id="heading-12">使用Perfetto分析内存问题的框架</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/807bda3a86f44457a2292c5e232a64d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGVpX29mZmljaWFs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766677932&amp;x-signature=Nxi1WqzreHIII79XpETiA9379H4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-13">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fclytzy%2Farticle%2Fdetails%2F132193262" target="_blank" title="https://blog.csdn.net/clytzy/article/details/132193262" ref="nofollow noopener noreferrer">blog.csdn.net/clytzy/arti…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2Fdocs%2Fdata-sources%2Fnative-heap-profiler" target="_blank" title="https://perfetto.dev/docs/data-sources/native-heap-profiler" ref="nofollow noopener noreferrer">perfetto.dev/docs/data-s…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2Fdocs%2Fdesign-docs%2Fheapprofd-sampling" target="_blank" title="https://perfetto.dev/docs/design-docs/heapprofd-sampling" ref="nofollow noopener noreferrer">perfetto.dev/docs/design…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[后端拒写接口？前端硬核自救：纯前端实现静态资源下载全链路解析]]></title>    <link>https://juejin.cn/post/7585006378533879850</link>    <guid>https://juejin.cn/post/7585006378533879850</guid>    <pubDate>2025-12-18T14:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585006378533879850" data-draft-id="7585006378533797930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="后端拒写接口？前端硬核自救：纯前端实现静态资源下载全链路解析"/> <meta itemprop="keywords" content="前端,Vite,浏览器"/> <meta itemprop="datePublished" content="2025-12-18T14:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨夜寻晴天"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            后端拒写接口？前端硬核自救：纯前端实现静态资源下载全链路解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨夜寻晴天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T14:05:41.000Z" title="Thu Dec 18 2025 14:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,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) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,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) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在日常开发中，我们经常遇到这样的场景：业务需求需要提供“导入模板下载”或“操作手册下载”功能。找后端同学要接口，对方却丢下一句：“这不就是个静态文件吗？你们前端自己存一下不就行了，没必要走接口。”</p>
<p>虽然听起来像是在推诿，但从资源利用和架构角度来看，<strong>对于纯静态、非敏感、无需鉴权的固定文件，前端自行托管确实是更高效的方案</strong>。它减轻了应用服务器的压力，利用了 CDN 或 Nginx 的静态资源分发能力。</p>
<p>本文将从<strong>工程实践</strong>到<strong>底层原理</strong>，深入剖析如何在 Vue3 + Vite（或 Webpack）项目中优雅地实现这一功能。</p>
<h2 data-id="heading-1">一、 核心方案：目录存放策略</h2>
<p>实现下载的第一步是决定<strong>文件存哪里</strong>。在现代前端工程（Vite/Webpack）中，通常有两个存放静态资源的地方：<code>src/assets</code> 和 <code>public</code>（或 Vue CLI 时代的 <code>static</code>）。</p>
<h3 data-id="heading-2">1.1 <code>src/assets</code> vs <code>public</code></h3>

























<table><thead><tr><th align="left">特性</th><th align="left"><code>src/assets</code></th><th align="left"><code>public</code></th></tr></thead><tbody><tr><td align="left"><strong>构建处理</strong></td><td align="left">经过 Bundler（Vite/Webpack）编译、压缩、Hash 重命名。</td><td align="left"><strong>不经过编译</strong>，直接原样拷贝到输出目录。</td></tr><tr><td align="left"><strong>引用方式</strong></td><td align="left"><code>import</code> 导入，得到的是打包后的 URL。</td><td align="left">使用绝对路径字符串直接引用。</td></tr><tr><td align="left"><strong>适用场景</strong></td><td align="left">组件内部引用的图片、样式、字体。</td><td align="left"><strong>第三方库、favicon、以及我们要做的“下载文件”。</strong></td></tr></tbody></table>
<h3 data-id="heading-3">1.2 最佳实践</h3>
<p>对于“下载文件”这种需求，<strong>强烈推荐使用 <code>public</code> 目录</strong>。</p>
<p><strong>理由如下：</strong></p>
<ol>
<li><strong>文件名保持不变</strong>：用户下载的文件名就是你存放的文件名，不会变成 <code>template.23a8f9.csv</code> 这种带 Hash 的怪名字。</li>
<li><strong>无需 Import</strong>：不需要在 JavaScript 中通过 <code>import</code> 引入文件对象，直接通过 URL 访问，逻辑更解耦。</li>
</ol>
<p><strong>目录结构示例：</strong></p>
<pre><code class="hljs language-text" lang="text">my-project/
├── public/
│   ├── files/
│   │   ├── import_template.csv  &lt;-- 存放在这里
│   │   └── manual.pdf
│   └── favicon.ico
├── src/
│   └── ...
</code></pre>
<hr/>
<h2 data-id="heading-4">二、 代码实现：动态路径与兼容性</h2>
<p>决定了存放位置后，接下来是代码实现。看似简单，但有一个<strong>巨大的坑</strong>需要注意：<strong>部署路径（Public Path）</strong>。</p>
<h3 data-id="heading-5">2.1 基础实现（有坑版）</h3>
<p>如果你直接写死路径：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/files/import_template.csv"</span> <span class="hljs-attr">download</span>=<span class="hljs-string">"模板.csv"</span>&gt;</span>下载模板<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>在本地开发（<code>localhost:3000</code>）没问题。但如果你的应用部署在子目录（例如 <code>https://example.com/admin/</code>），这个链接会指向 <code>https://example.com/files/...</code>，导致 <strong>404 Not Found</strong>。</p>
<h3 data-id="heading-6">2.2 进阶实现（生产环境健壮版）</h3>
<p>我们需要根据构建时的 <strong>基础路径（Base Path）</strong> 动态拼接 URL。</p>
<p><strong>Vite + Vue3 实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-comment">// 1. 获取环境变量中的 Base Path</span>
<span class="hljs-comment">// Vite 中通常配置在 vite.config.ts 的 base 属性，对应 import.meta.env.BASE_URL 或 VITE_PUBLIC_PATH</span>
<span class="hljs-keyword">const</span> publicPath = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_PUBLIC_PATH</span> || <span class="hljs-string">'/'</span>;

<span class="hljs-comment">// 2. 拼接完整的下载链接</span>
<span class="hljs-keyword">const</span> templateUrl = <span class="hljs-string">`<span class="hljs-subst">${publicPath}</span>files/import_template.csv`</span>;
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- download 属性指示浏览器下载，而非导航 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"templateUrl"</span> <span class="hljs-attr">download</span>=<span class="hljs-string">"导入模板.csv"</span>&gt;</span>
    下载模板
  <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>这种写法无论项目部署在根路径还是 <code>/sub-folder/</code> 下，都能正确找到文件。</p>
<hr/>
<h2 data-id="heading-7">三、 深度解析：Build 打包原理</h2>
<p>为什么放在 <code>public</code> 目录下的文件，打包后就能通过 URL 访问？这涉及到构建工具的<strong>静态资源处理机制</strong>。</p>
<h3 data-id="heading-8">3.1 Vite/Rollup 的处理流程</h3>
<p>当你运行 <code>npm run build</code> 时，Vite（底层基于 Rollup）会执行以下操作：</p>
<ol>
<li><strong>编译源码</strong>：处理 <code>src</code> 目录下的 <code>.vue</code>, <code>.ts</code>, <code>.js</code> 等文件，生成 Bundles。</li>
<li><strong>静态拷贝</strong>：Vite 默认会检查项目根目录下的 <code>public</code> 文件夹。
<ul>
<li>它会将 <code>public</code> 文件夹内的<strong>所有内容</strong>，<strong>原封不动</strong>地复制到构建输出目录（通常是 <code>dist</code>）的根目录下。</li>
<li>这个过程不会对文件进行 Hash 处理，也不会修改文件名。</li>
</ul>
</li>
</ol>
<p><strong>构建前：</strong></p>
<pre><code class="hljs language-text" lang="text">/public/files/demo.csv
</code></pre>
<p><strong>构建后（dist 目录）：</strong></p>
<pre><code class="hljs language-text" lang="text">/dist/index.html
/dist/assets/index.f8s7d9.js
/dist/files/demo.csv  &lt;-- 原样存在
</code></pre>
<p>因此，Nginx 或静态服务器在托管 <code>dist</code> 目录时，客户端请求 <code>/files/demo.csv</code>，服务器就能直接找到该文件并返回。</p>
<hr/>
<h2 data-id="heading-9">四、 深度解析：浏览器下载原理</h2>
<p>前端写了 <code>&lt;a download&gt;</code>，浏览器底层发生了什么？</p>
<h3 data-id="heading-10">4.1 触发下载的行为判定</h3>
<p>当用户点击链接时，浏览器会根据以下优先级决定是<strong>预览</strong>还是<strong>下载</strong>：</p>
<ol>
<li>
<p><strong><code>download</code> 属性（HTML5）</strong>：</p>
<ul>
<li>如果在 <code>&lt;a&gt;</code> 标签上存在 <code>download</code> 属性，浏览器会尝试强制下载该资源，并使用属性值作为下载后的文件名。</li>
<li><strong>关键限制</strong>：<code>download</code> 属性仅对<strong>同源 URL</strong>（Same-origin）或 <code>blob:</code>、<code>data:</code> 协议有效。如果你的静态文件放在完全不同的 CDN 域名下，<code>download</code> 属性可能会失效，浏览器会退化为导航（预览）。</li>
</ul>
</li>
<li>
<p><strong><code>Content-Disposition</code> 响应头（HTTP 协议）</strong>：</p>
<ul>
<li>这是服务端的“大杀器”。如果服务器响应头包含 <code>Content-Disposition: attachment; filename="xxx.csv"</code>，无论前端怎么写，浏览器<strong>必须</strong>下载。</li>
<li>对于前端托管的静态文件（Nginx 默认配置），通常没有这个头，所以主要依赖前端的 <code>download</code> 属性。</li>
</ul>
</li>
<li>
<p><strong>MIME Type 嗅探</strong>：</p>
<ul>
<li>如果没有上述强制下载标志，浏览器会检查文件的 MIME 类型。</li>
<li><strong>浏览器能识别的</strong>（如 <code>application/pdf</code>, <code>image/jpeg</code>, <code>text/html</code>）：在当前窗口或新标签页<strong>预览</strong>。</li>
<li><strong>浏览器不认识的</strong>（如 <code>application/octet-stream</code>, <code>application/zip</code>）：默认<strong>下载</strong>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">4.2 本文方案的生效链路</h3>
<ol>
<li><strong>请求阶段</strong>：用户点击链接 -&gt; 浏览器向服务器（Nginx）请求 <code>/files/template.csv</code>。</li>
<li><strong>响应阶段</strong>：Nginx 返回文件流，Content-Type 可能是 <code>text/csv</code> 或 <code>application/vnd.ms-excel</code>。</li>
<li><strong>处理阶段</strong>：浏览器接收到响应，虽然它可能支持预览文本，但检测到了 <code>&lt;a&gt;</code> 标签上的 <code>download</code> 属性。</li>
<li><strong>最终行为</strong>：浏览器忽略预览行为，弹出保存对话框（或直接保存），并将文件名重命名为 <code>download</code> 属性指定的值。</li>
</ol>
<h2 data-id="heading-12">五、 小结</h2>
<p>在后端不提供接口的情况下，前端利用 <code>public</code> 目录托管静态文件是一种<strong>标准且高效</strong>的工程化解法。</p>
<ul>
<li><strong>实现简单</strong>：无需后端参与，纯前端闭环。</li>
<li><strong>性能优异</strong>：利用 Nginx/CDN 静态分发，速度快，不占用 API 计算资源。</li>
<li><strong>注意细节</strong>：
<ul>
<li>文件放入 <code>public</code> 目录以避免 Hash 重命名。</li>
<li>代码中使用环境变量（<code>import.meta.env.VITE_PUBLIC_PATH</code>）拼接路径以支持子目录部署。</li>
<li>利用 <code>download</code> 属性强制浏览器下载 PDF 等可预览文件。</li>
</ul>
</li>
</ul>
<p>掌握这一套流程，下次再遇到后端让你 “自己存一下” 时，你不仅能轻松搞定，还能顺便给他科普一下打包原理和浏览器行为。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[流式渲染 Incremark、ant-design-x markdown、streammarkdown-vue 全流程方案对比]]></title>    <link>https://juejin.cn/post/7585157583474098227</link>    <guid>https://juejin.cn/post/7585157583474098227</guid>    <pubDate>2025-12-18T14:37:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585157583474098227" data-draft-id="7585076863820562483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="流式渲染 Incremark、ant-design-x markdown、streammarkdown-vue 全流程方案对比"/> <meta itemprop="keywords" content="前端,JavaScript,人工智能"/> <meta itemprop="datePublished" content="2025-12-18T14:37:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="king王一帅"/> <meta itemprop="url" content="https://juejin.cn/user/395479917018408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            流式渲染 Incremark、ant-design-x markdown、streammarkdown-vue 全流程方案对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479917018408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    king王一帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T14:37:44.000Z" title="Thu Dec 18 2025 14:37:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">流式 Markdown 渲染方案对比</h2>
<p>本文档对流式 Markdown 渲染方案进行技术对比：<strong>Incremark</strong>、<strong>ant-design-x</strong> 和 <strong>markstream-vue</strong>。每个方案都有其独特的设计理念和优势。</p>
<h3 data-id="heading-1">全流程对比</h3>
<h4 data-id="heading-2">ant-design-x 全流程</h4>
<pre><code class="hljs language-css" lang="css">用户输入（流式 Markdown）
        ↓
┌─────────────────────────────────────────────────────────┐
│  useTyping Hook                                         │
│    - 逐字符消费纯文本                                     │
│    - 输出带 fade-in 标记的文本块                          │
├─────────────────────────────────────────────────────────┤
│  useStreaming Hook                                       │
│    - 正则检测不完整 token（链接、图片等）                   │
│    - 缓存不完整部分，只输出完整的 Markdown                  │
│    ↓                                                    │
│  Parser (marked<span class="hljs-selector-class">.js</span>)                                      │
│    - 全量解析：<span class="hljs-attribute">content</span> → <span class="hljs-selector-tag">HTML</span> 字符串                      │
│    ↓                                                    │
│  Renderer (<span class="hljs-selector-tag">html</span>-react-parser)                            │
│    - <span class="hljs-selector-tag">HTML</span> 字符串 → React 组件                            │
└─────────────────────────────────────────────────────────┘
        ↓
    React DOM
</code></pre>
<p><strong>关键特点：</strong></p>
<ul>
<li>每次内容变化时使用 <code>marked.parse()</code> 全量解析</li>
<li>打字机动画在纯文本字符串层操作</li>
<li>使用 HTML 字符串作为中间格式</li>
</ul>
<hr/>
<h4 data-id="heading-3">markstream-vue 全流程</h4>
<pre><code class="hljs language-scss" lang="scss">用户输入（Markdown 字符串）
        ↓
┌─────────────────────────────────────────────────────────┐
│  预处理                                                  │
│    - 正则修复流式边界问题                                  │
│    - "- *" → "- \*"，裁剪悬空标记等                       │
│    ↓                                                    │
│  markdown-it<span class="hljs-selector-class">.parse</span>()                                     │
│    - 全量解析 → Token 数组                                │
│    ↓                                                    │
│  <span class="hljs-built_in">processTokens</span>()                                         │
│    - Token → ParsedNode<span class="hljs-selector-attr">[]</span>（自定义 AST）                   │
├─────────────────────────────────────────────────────────┤
│  Vue 组件渲染                                            │
│    - &lt;<span class="hljs-attribute">transition</span>&gt; 实现渐入动画                            │
│    - 节点类型 → 组件映射                                  │
└─────────────────────────────────────────────────────────┘
        ↓
    Vue DOM
</code></pre>
<p><strong>关键特点：</strong></p>
<ul>
<li>每次内容变化时使用 <code>markdown-it.parse()</code> 全量解析</li>
<li>预处理层处理流式边界情况</li>
<li>使用 Vue <code>&lt;transition&gt;</code> 实现打字机效果</li>
</ul>
<hr/>
<h4 data-id="heading-4">Incremark 全流程</h4>
<pre><code class="hljs language-scss" lang="scss">用户输入（流式 Markdown chunk）
        ↓
┌─────────────────────────────────────────────────────────┐
│  IncremarkParser<span class="hljs-selector-class">.append</span>(chunk)                           │
│    - 增量更新缓冲区（只处理新增部分）                        │
│    - 检测稳定边界（空行、标题等）                           │
│    - 稳定部分 → completedBlocks（只解析一次）              │
│    - 不稳定部分 → pendingBlocks（重新解析）                │
│    ↓                                                    │
│  输出：ParsedBlock<span class="hljs-selector-attr">[]</span>（mdast AST）                        │
├─────────────────────────────────────────────────────────┤
│  BlockTransformer（可选中间件）                           │
│    - 打字机效果：<span class="hljs-built_in">sliceAst</span>() 截断 AST                      │
│    - 维护 TextChunk<span class="hljs-selector-attr">[]</span> 实现渐入动画                        │
│    - 可跳过，直接渲染完整内容                              │
│    ↓                                                    │
│  输出：DisplayBlock<span class="hljs-selector-attr">[]</span>（截断后的 AST）                     │
├─────────────────────────────────────────────────────────┤
│  Vue / React 组件渲染                                    │
│    - AST 节点 → 组件映射                                 │
│    - TextChunks 包装渐入动画                             │
└─────────────────────────────────────────────────────────┘
        ↓
    Vue / React DOM
</code></pre>
<p><strong>关键特点：</strong></p>
<ul>
<li>增量解析：只解析新增的稳定块</li>
<li>打字机动画在 AST 节点层操作</li>
<li>同时提供 Vue 和 React 适配器</li>
</ul>
<hr/>
<h3 data-id="heading-5">核心差异</h3>





















































<table><thead><tr><th>维度</th><th>ant-design-x</th><th>markstream-vue</th><th>Incremark</th></tr></thead><tbody><tr><td><strong>解析方式</strong></td><td>全量解析 (marked.js)</td><td>全量解析 (markdown-it)</td><td>增量解析 (micromark)</td></tr><tr><td><strong>单次 chunk 复杂度</strong></td><td>O(n)</td><td>O(n)</td><td>O(k)，k = 新块大小</td></tr><tr><td><strong>总复杂度</strong></td><td>O(n × chunks) ≈ O(n²)</td><td>O(n × chunks) ≈ O(n²)</td><td>O(n)</td></tr><tr><td><strong>边界处理</strong></td><td>正则 token 检测</td><td>预处理层</td><td>稳定边界检测</td></tr><tr><td><strong>打字机动画</strong></td><td>文本字符串层</td><td>Vue Transition</td><td>保持 Markdown 结构</td></tr><tr><td><strong>输出格式</strong></td><td>HTML 字符串</td><td>自定义 AST</td><td>mdast（兼容 remark）</td></tr><tr><td><strong>框架支持</strong></td><td>React</td><td>Vue</td><td>Vue + React</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">解析策略</h3>
<h4 data-id="heading-7">全量解析 vs 增量解析</h4>
<p><strong>全量解析（ant-design-x 和 markstream-vue）：</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">Chunk</span> <span class="hljs-number">1</span>: <span class="hljs-string">"# Hello"</span>        <span class="hljs-operator">→</span> 解析全部内容
<span class="hljs-type">Chunk</span> <span class="hljs-number">2</span>: <span class="hljs-string">"# Hello<span class="hljs-subst">\n</span>World"</span> <span class="hljs-operator">→</span> 再次解析全部内容
<span class="hljs-type">Chunk</span> <span class="hljs-number">3</span>: <span class="hljs-string">"# Hello<span class="hljs-subst">\n</span>World<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>- item"</span> <span class="hljs-operator">→</span> 再次解析全部内容
</code></pre>
<p>每个新 chunk 都触发对所有累积内容的完整解析。</p>
<p><strong>增量解析（Incremark）：</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">Chunk</span> <span class="hljs-number">1</span>: <span class="hljs-string">"# Hello"</span>     <span class="hljs-operator">→</span> 解析 <span class="hljs-operator">→</span> <span class="hljs-type">Block</span> <span class="hljs-number">1</span> (heading) <span class="hljs-operator">✓</span> 完成
<span class="hljs-type">Chunk</span> <span class="hljs-number">2</span>: <span class="hljs-string">"<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>World"</span>   <span class="hljs-operator">→</span> 解析 <span class="hljs-operator">→</span> <span class="hljs-type">Block</span> <span class="hljs-number">2</span> (paragraph) <span class="hljs-operator">←</span> 只处理这部分
<span class="hljs-type">Chunk</span> <span class="hljs-number">3</span>: <span class="hljs-string">"<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>- item"</span>  <span class="hljs-operator">→</span> 解析 <span class="hljs-operator">→</span> <span class="hljs-type">Block</span> <span class="hljs-number">3</span> (list) <span class="hljs-operator">←</span> 只处理这部分
</code></pre>
<p>已完成的块被缓存，不会重新解析。只处理待定部分。</p>
<h4 data-id="heading-8">复杂度分析</h4>
<p>在多 chunk 流式场景中：</p>
<ul>
<li>全量解析：O(n) × chunk 数量</li>
<li>增量解析：每个 chunk O(k)，k 是新块大小</li>
</ul>
<p>对于典型的 AI 响应（10-50 块），两种方案都能接受。差异在大文档或高频 chunk 到达时更明显。</p>
<hr/>
<h3 data-id="heading-9">流式边界处理</h3>
<p>所有方案都需要处理流式过程中不完整的 Markdown 语法，各自采用不同方案：</p>

























<table><thead><tr><th>方案</th><th>工作原理</th><th>权衡</th></tr></thead><tbody><tr><td><strong>Incremark</strong></td><td>解析前检测稳定边界</td><td>结构清晰；可能缓冲部分内容</td></tr><tr><td><strong>ant-design-x</strong></td><td>正则模式检测不完整 token</td><td>立即输出；需要维护正则</td></tr><tr><td><strong>markstream-vue</strong></td><td>解析前预处理内容</td><td>适用于任何解析器；需处理多种边界情况</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">打字机动画</h3>

























<table><thead><tr><th>方案</th><th>层级</th><th>机制</th></tr></thead><tbody><tr><td><strong>Incremark</strong></td><td>AST 节点</td><td><code>sliceAst()</code> 截断 AST，<code>TextChunk[]</code> 追踪渐入</td></tr><tr><td><strong>ant-design-x</strong></td><td>文本字符串</td><td>逐字符文本切片</td></tr><tr><td><strong>markstream-vue</strong></td><td>组件</td><td>组件挂载时 Vue <code>&lt;transition&gt;</code></td></tr></tbody></table>
<p>各方案的权衡：</p>
<ul>
<li><strong>AST 层</strong>：动画过程中保持结构感知</li>
<li><strong>文本层</strong>：更简单，与框架无关</li>
<li><strong>组件层</strong>：与 Vue 响应式系统自然集成</li>
</ul>
<hr/>
<h3 data-id="heading-11">渲染优化</h3>
<p>markstream-vue 提供额外的渲染优化：</p>





















<table><thead><tr><th>特性</th><th>描述</th></tr></thead><tbody><tr><td>虚拟化</td><td>只在 DOM 中渲染可见节点</td></tr><tr><td>批量渲染</td><td>使用 <code>requestIdleCallback</code> 渐进式渲染</td></tr><tr><td>视口优先</td><td>延迟渲染屏幕外节点</td></tr></tbody></table>
<p><strong>流式场景的考量：</strong></p>
<p>在典型 AI 流式用例中：</p>
<ul>
<li>内容逐步到达（天然的批量处理）</li>
<li>用户注意力在底部（观看新内容）</li>
<li>典型响应大小是 10-50 块</li>
<li>打字机效果提供渐进式渲染</li>
</ul>
<p>虚拟化在以下场景提供显著收益：</p>
<ul>
<li>浏览历史内容（非活跃流式）</li>
<li>渲染超长文档（100+ 块）</li>
<li>用户快速滚动浏览内容</li>
</ul>
<hr/>
<h3 data-id="heading-12">总结</h3>
<h4 data-id="heading-13">各方案的侧重点</h4>
<h5 data-id="heading-14">ant-design-x</h5>
<p><strong>侧重：完整的 AI 聊天 UI 解决方案</strong></p>
<ul>
<li>提供 Bubble、Sender、Conversations 组件</li>
<li>与 Ant Design 生态深度集成</li>
<li>内置 <code>&lt;thinking&gt;</code> 等特殊块支持</li>
<li>Ant Design 用户可快速上手</li>
</ul>
<p><em>适用场景：在 Ant Design 生态中构建 AI 聊天界面的团队</em></p>
<h5 data-id="heading-15">markstream-vue</h5>
<p><strong>侧重：功能丰富的 Markdown 渲染</strong></p>
<ul>
<li>虚拟化处理大文档</li>
<li>自适应性能的批量渲染</li>
<li>全面的边界情况预处理</li>
<li>丰富的自定义选项</li>
</ul>
<p><em>适用场景：有大文档或聊天历史浏览需求的 Vue 应用</em></p>
<h5 data-id="heading-16">Incremark</h5>
<p><strong>侧重：高效的增量解析</strong></p>
<ul>
<li><strong>增量解析</strong>：已完成的块不会重新解析，在长流式会话中显著减少 CPU 消耗</li>
<li><strong>跨框架</strong>：同一套核心库支持 Vue 和 React，降低多框架团队的维护成本</li>
<li><strong>兼容 remark 生态</strong>：标准 mdast 输出，可使用 remark 插件扩展语法</li>
<li><strong>结构化打字机</strong>：动画过程中保持 Markdown 结构，插件系统支持自定义行为（如图片立即显示）</li>
</ul>
<p><em>适用场景：长流式内容、多框架团队、或需要 remark 插件兼容的应用</em></p>
<hr/>
<h4 data-id="heading-17">快速参考</h4>

































<table><thead><tr><th>你的优先级</th><th>可考虑</th></tr></thead><tbody><tr><td>Ant Design 生态集成</td><td>ant-design-x</td></tr><tr><td>大文档虚拟化</td><td>markstream-vue</td></tr><tr><td>纯 Vue 应用</td><td>markstream-vue</td></tr><tr><td>长流式会话 / 多 chunk</td><td>Incremark</td></tr><tr><td>Vue + React 共用代码</td><td>Incremark</td></tr><tr><td>需要 remark 插件</td><td>Incremark</td></tr></tbody></table>
<h4 data-id="heading-18">结论</h4>
<p>每个方案以不同的优先级解决流式 Markdown：</p>
<ul>
<li><strong>ant-design-x</strong> 提供与 Ant Design 紧密集成的完整 AI 聊天 UI 解决方案</li>
<li><strong>markstream-vue</strong> 为 Vue 应用提供丰富功能和渲染优化</li>
<li><strong>Incremark</strong> 专注于解析效率和跨框架灵活性</li>
</ul>
<p>选择取决于你的具体需求：生态契合度、文档规模、框架需求和性能优先级。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guava Forwarding系列类详解——装饰器模式实战]]></title>    <link>https://juejin.cn/post/7585022810180714559</link>    <guid>https://juejin.cn/post/7585022810180714559</guid>    <pubDate>2025-12-18T13:05:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585022810180714559" data-draft-id="7585019819193581578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Guava Forwarding系列类详解——装饰器模式实战"/> <meta itemprop="keywords" content="后端,Java,设计模式"/> <meta itemprop="datePublished" content="2025-12-18T13:05:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桦说编程"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Guava Forwarding系列类详解——装饰器模式实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桦说编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:05:48.000Z" title="Thu Dec 18 2025 13:05:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是桦说编程。</p>
<blockquote>
<p>本文通过 ForwardingList 深入解析 Guava 的 ForwardingXXX 系列类，掌握装饰器模式在集合扩展中的优雅实现。Fowarding系列类广义上涉及三种设计模式：装饰器模式、模版方法模式、委托模式。本文由我辅助AI编写。</p>
</blockquote>
<h2 data-id="heading-0">问题背景</h2>
<p>在实际开发中，我们经常需要对标准集合类进行功能增强：</p>
<ul>
<li>在 List 添加元素时自动记录日志</li>
<li>对 Map 的 put 操作进行参数校验</li>
<li>在 Set 的读写操作上添加性能埋点</li>
</ul>
<p>传统做法是直接继承 ArrayList、HashMap，但这会遇到几个问题：</p>
<ol>
<li><strong>需要重写大量方法</strong>：List 接口有 30+ 个方法，逐个重写工作量大</li>
<li><strong>容易遗漏</strong>：某些方法忘记重写会导致增强逻辑失效</li>
<li><strong>方法委托关系复杂</strong>：比如 <code>addAll</code> 内部可能调用 <code>add</code>，重写时需要理解内部实现</li>
</ol>
<p>Guava 的 <code>ForwardingXXX</code> 系列正是为解决这类问题而设计。</p>
<h2 data-id="heading-1">核心原理</h2>
<h3 data-id="heading-2">装饰器模式回顾</h3>
<pre><code class="hljs language-sql" lang="sql">┌─────────────────────────────────────────────────┐
│                   <span class="hljs-operator">&lt;&lt;</span>interface<span class="hljs-operator">&gt;&gt;</span>                 │
│                       List                      │
├─────────────────────────────────────────────────┤
│  <span class="hljs-operator">+</span> <span class="hljs-keyword">add</span>(E): <span class="hljs-type">boolean</span>                              │
│  <span class="hljs-operator">+</span> <span class="hljs-keyword">get</span>(<span class="hljs-type">int</span>): E                                  │
│  <span class="hljs-operator">+</span> size(): <span class="hljs-type">int</span>                                  │
│  ...                                            │
└─────────────────────────────────────────────────┘
                        ▲
                        │ implements
          ┌─────────────┴─────────────┐
          │                           │
┌─────────────────┐         ┌─────────────────────┐
│    ArrayList    │         │   ForwardingList    │
├─────────────────┤         ├─────────────────────┤
│ 真正的实现        │◄────────│ <span class="hljs-operator">-</span> delegate: List<span class="hljs-operator">&lt;</span>E<span class="hljs-operator">&gt;</span> │
└─────────────────┘   委托   │ <span class="hljs-operator">+</span> delegate(): List  │
                            │ <span class="hljs-operator">+</span> <span class="hljs-keyword">add</span>(E): <span class="hljs-type">boolean</span>   │
                            │   → delegate.add(e) │
                            └─────────────────────┘
                                      ▲
                                      │ extends
                            ┌─────────────────────┐
                            │   LoggingList<span class="hljs-operator">&lt;</span>E<span class="hljs-operator">&gt;</span>    │
                            ├─────────────────────┤
                            │ 只重写需要增强的方法 │
                            │ <span class="hljs-operator">+</span> <span class="hljs-keyword">add</span>(E): <span class="hljs-type">boolean</span>   │
                            │   → log <span class="hljs-operator">+</span> super.add │
                            └─────────────────────┘
</code></pre>
<h3 data-id="heading-3">ForwardingList 源码剖析</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GwtCompatible</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForwardingList</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingCollection</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List</span>&lt;E&gt; {

    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">ForwardingList</span><span class="hljs-params">()</span> {}

    <span class="hljs-comment">// 子类必须实现：返回被装饰的 List</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> List&lt;E&gt; <span class="hljs-title function_">delegate</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// 所有方法都委托给 delegate()</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
        delegate().add(index, element);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(<span class="hljs-type">int</span> index, Collection&lt;? extends E&gt; elements)</span> {
        <span class="hljs-keyword">return</span> delegate().addAll(index, elements);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
        <span class="hljs-keyword">return</span> delegate().get(index);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">indexOf</span><span class="hljs-params">(Object element)</span> {
        <span class="hljs-keyword">return</span> delegate().indexOf(element);
    }

    <span class="hljs-comment">// ... 其他 List 方法同样委托</span>

    <span class="hljs-comment">// 标准方法实现：基于其他方法的默认实现</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">standardAdd</span><span class="hljs-params">(E element)</span> {
        add(size(), element);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">standardAddAll</span><span class="hljs-params">(<span class="hljs-type">int</span> index, Iterable&lt;? extends E&gt; elements)</span> {
        <span class="hljs-keyword">return</span> Lists.addAllImpl(<span class="hljs-built_in">this</span>, index, elements);
    }

    <span class="hljs-comment">// ... 更多 standardXxx 方法</span>
}
</code></pre>
<p><strong>关键设计点</strong>：</p>





















<table><thead><tr><th>设计元素</th><th>说明</th></tr></thead><tbody><tr><td><code>abstract delegate()</code></td><td>强制子类指定被装饰对象，延迟绑定</td></tr><tr><td>所有方法委托</td><td>默认行为透传，子类按需重写</td></tr><tr><td><code>standardXxx</code> 方法</td><td>提供基于基本操作的默认实现，避免委托循环</td></tr></tbody></table>
<h3 data-id="heading-4">standardXxx 方法的作用</h3>
<p>这是 ForwardingXXX 的精华所在。考虑这个场景：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示范：addAll 内部可能直接调用 delegate 的 addAll</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingList</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingList</span>&lt;E&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
        log.info(<span class="hljs-string">"Adding: {}"</span>, element);
        <span class="hljs-keyword">return</span> delegate().add(index, element);
    }

    <span class="hljs-comment">// addAll 没重写，直接委托给 delegate.addAll()</span>
    <span class="hljs-comment">// 结果：addAll 添加的元素不会被日志记录！</span>
}
</code></pre>
<p>正确做法是使用 <code>standardAddAll</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(<span class="hljs-type">int</span> index, Collection&lt;? extends E&gt; elements)</span> {
    <span class="hljs-keyword">return</span> standardAddAll(index, elements); <span class="hljs-comment">// 内部循环调用 this.add()</span>
}
</code></pre>
<h2 data-id="heading-5">实战示例</h2>
<h3 data-id="heading-6">示例1：带日志的 List</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingList</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingList</span>&lt;E&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(LoggingList.class);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;E&gt; delegate;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LoggingList</span><span class="hljs-params">(List&lt;E&gt; delegate)</span> {
        <span class="hljs-built_in">this</span>.delegate = delegate;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;E&gt; <span class="hljs-title function_">delegate</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> delegate;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E element)</span> {
        log.info(<span class="hljs-string">"[ADD] element={}"</span>, element);
        <span class="hljs-keyword">return</span> standardAdd(element);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
        log.info(<span class="hljs-string">"[ADD] index={}, element={}"</span>, index, element);
        delegate().add(index, element);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(<span class="hljs-type">int</span> index, Collection&lt;? extends E&gt; elements)</span> {
        log.info(<span class="hljs-string">"[ADD_ALL] index={}, size={}"</span>, index, elements.size());
        <span class="hljs-keyword">return</span> standardAddAll(index, elements); <span class="hljs-comment">// 会逐个调用 add，每个都有日志</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
        <span class="hljs-type">E</span> <span class="hljs-variable">removed</span> <span class="hljs-operator">=</span> delegate().remove(index);
        log.info(<span class="hljs-string">"[REMOVE] index={}, element={}"</span>, index, removed);
        <span class="hljs-keyword">return</span> removed;
    }
}
</code></pre>
<h3 data-id="heading-7">示例2：带容量限制的 List</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BoundedList</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingList</span>&lt;E&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;E&gt; delegate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxSize;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BoundedList</span><span class="hljs-params">(List&lt;E&gt; delegate, <span class="hljs-type">int</span> maxSize)</span> {
        <span class="hljs-built_in">this</span>.delegate = delegate;
        <span class="hljs-built_in">this</span>.maxSize = maxSize;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;E&gt; <span class="hljs-title function_">delegate</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> delegate;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkCapacity</span><span class="hljs-params">(<span class="hljs-type">int</span> additionalElements)</span> {
        <span class="hljs-keyword">if</span> (size() + additionalElements &gt; maxSize) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                <span class="hljs-string">"Exceeds max size: "</span> + maxSize + <span class="hljs-string">", current: "</span> + size());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E element)</span> {
        checkCapacity(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> standardAdd(element);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
        checkCapacity(<span class="hljs-number">1</span>);
        delegate().add(index, element);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(<span class="hljs-type">int</span> index, Collection&lt;? extends E&gt; elements)</span> {
        checkCapacity(elements.size());
        <span class="hljs-keyword">return</span> delegate().addAll(index, elements);
    }
}
</code></pre>
<h3 data-id="heading-8">示例3：性能埋点 List</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricsList</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingList</span>&lt;E&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;E&gt; delegate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">readCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">writeCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MetricsList</span><span class="hljs-params">(List&lt;E&gt; delegate)</span> {
        <span class="hljs-built_in">this</span>.delegate = delegate;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;E&gt; <span class="hljs-title function_">delegate</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> delegate;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
        readCount.incrementAndGet();
        <span class="hljs-keyword">return</span> delegate().get(index);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E element)</span> {
        writeCount.incrementAndGet();
        <span class="hljs-keyword">return</span> standardAdd(element);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
        writeCount.incrementAndGet();
        delegate().add(index, element);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getReadCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> readCount.get();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getWriteCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> writeCount.get();
    }
}
</code></pre>
<h2 data-id="heading-9">ForwardingXXX 家族</h2>
<p>Guava 为常用集合都提供了 Forwarding 包装类：</p>


















































<table><thead><tr><th>类名</th><th>对应接口</th><th>典型应用场景</th></tr></thead><tbody><tr><td><code>ForwardingList</code></td><td>List</td><td>有序集合增强</td></tr><tr><td><code>ForwardingSet</code></td><td>Set</td><td>去重集合增强</td></tr><tr><td><code>ForwardingMap</code></td><td>Map</td><td>K-V 映射增强</td></tr><tr><td><code>ForwardingQueue</code></td><td>Queue</td><td>队列增强</td></tr><tr><td><code>ForwardingMultimap</code></td><td>Multimap</td><td>一对多映射增强</td></tr><tr><td><code>ForwardingTable</code></td><td>Table</td><td>二维表增强</td></tr><tr><td><code>ForwardingIterator</code></td><td>Iterator</td><td>迭代器增强</td></tr><tr><td><code>ForwardingConcurrentMap</code></td><td>ConcurrentMap</td><td>并发 Map 增强</td></tr></tbody></table>
<h2 data-id="heading-10">与直接继承对比</h2>






























<table><thead><tr><th>方面</th><th>直接继承 ArrayList</th><th>ForwardingList</th></tr></thead><tbody><tr><td>代码量</td><td>重写所有需要增强的方法</td><td>只重写需要增强的方法</td></tr><tr><td>灵活性</td><td>绑定特定实现</td><td>可装饰任意 List 实现</td></tr><tr><td>组合能力</td><td>单一继承</td><td>可多层装饰叠加</td></tr><tr><td>实现替换</td><td>需修改代码</td><td>构造时注入即可</td></tr></tbody></table>
<p><strong>装饰器叠加示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 一个 List 同时具备日志 + 容量限制 + 埋点</span>
List&lt;String&gt; base = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
List&lt;String&gt; bounded = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoundedList</span>&lt;&gt;(base, <span class="hljs-number">100</span>);
List&lt;String&gt; logged = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingList</span>&lt;&gt;(bounded);
List&lt;String&gt; metered = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MetricsList</span>&lt;&gt;(logged);

<span class="hljs-comment">// 调用顺序：metered → logged → bounded → base</span>
metered.add(<span class="hljs-string">"item"</span>);
</code></pre>
<h2 data-id="heading-11">总结</h2>
<ul>
<li><strong>ForwardingXXX 是装饰器模式的标准实现</strong>：通过 <code>delegate()</code> 委托，只重写需要增强的方法</li>
<li><strong>standardXxx 方法避免委托循环</strong>：当增强逻辑依赖基础操作时，使用 standard 方法确保调用链正确</li>
<li><strong>支持多层装饰叠加</strong>：日志、校验、埋点等可以自由组合</li>
<li><strong>Guava 提供全系列 Forwarding 类</strong>：List、Set、Map、Queue、Multimap、Table 等都有对应实现</li>
</ul>
<hr/>
<p>如果这篇文章对你有帮助，欢迎关注我，持续分享高质量技术干货，助你更快提升编程能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1V1 社交精准收割 3.6 亿！40 款马甲包 + 国内社交难度堪比史诗级！]]></title>    <link>https://juejin.cn/post/7585013463859298354</link>    <guid>https://juejin.cn/post/7585013463859298354</guid>    <pubDate>2025-12-18T13:06:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585013463859298354" data-draft-id="7585007321207275572" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1V1 社交精准收割 3.6 亿！40 款马甲包 + 国内社交难度堪比史诗级！"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2025-12-18T13:06:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1V1 社交精准收割 3.6 亿！40 款马甲包 + 国内社交难度堪比史诗级！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:06:28.000Z" title="Thu Dec 18 2025 13:06:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>“她说明年就结婚，转头就把我拉黑了！”2024 年 9 月，山东鱼台县居民王某攥着手机账单冲进警局，声音颤抖。这位常年打工攒下 5 万积蓄的单身汉，从未想过自己在 “念梦”“冬梦” 两款交友 App 上邂逅的 “化妆品店老板娘”，竟是一场精心设计的骗局。</p>
<p>三个月里，这位昵称 “为你而来” 的 “女神” 温柔体贴，频频描绘二人未来的家，却以 “解锁视频聊天”“线下见面需充值刷亲密度” 为由，分三次榨干了他的全部积蓄。当王某停止充值后，昔日热情的恋人瞬间蒸发，只留下 27177 元、9592 元、13794 元三笔冰冷的充值记录。他不知道的是，自己只是这场 3.6 亿诈骗大案中，上千名受害者之一。​</p>
<h3 data-id="heading-1">40 款马甲包背后：堪比上市公司的诈骗 “工厂”</h3>
<p>山东济宁公安破获特大网络交友诈骗案，40余款App全是陷阱。王某的报警，像一把钥匙打开了潘多拉魔盒。警方顺着涉诈 App 的线索深挖，一个隐藏在合法公司外壳下的犯罪集团逐渐浮出水面。团伙头目王某某是正规大学毕业生，曾因运营 “来遇” App 涉诈被查处，却在 2023 年卷土重来，注册多家空壳公司，一口气推出 40 余款交友 App，形成 “换汤不换药” 的马甲矩阵。</p>
<p>这个诈骗团伙的运作模式堪称 “产业化”：运营部负责招募培训 5000 余名女聊手，定制从 “初遇暧昧” 到 “诱导充值” 的全套话术；客服部专门安抚投诉用户，用 “系统维护”“亲密度未达标” 等借口掩盖骗局；甚至设立法务部，钻法律空子规避监管。女聊手们则按照统一剧本，虚构 “单身富婆”“温柔贤妻” 等人设，精准瞄准三、四线城市的大龄单身男性，用暧昧言语和虚假承诺编织情感牢笼。​</p>
<p>更令人咋舌的是平台设计的 “吸血机制”：文字消息 10-100 金币 / 条，视频通话 100-2000 金币 / 分钟，充值 1 元仅能兑换 100 金币。女聊手与公司按 4:6 分成，为了多赚钱，她们会用平台发放的免费金币给用户刷礼物，制造 “双向奔赴” 的假象，引诱受害者不断充值。警方后续查获的聊天记录显示，团伙内部流传着 “养鱼玩法拉高点，大哥刷一你刷两” 的黑暗话术。</p>
<h3 data-id="heading-2">62 亿条数据剥茧：千人跨省追缉 15 天破局</h3>
<p>“这不是零散诈骗，是有组织、有预谋的犯罪网络。” 济宁市公安局迅速成立 “10.14” 专案组，抽调百余名警力攻坚。面对团伙设置的多层数据加密、定期删除证据、核心骨干分散办公等障碍，民警自主编写分析程序，从 8T 容量、超 62 亿条聊天记录和资金明细中抽丝剥茧。</p>
<h3 data-id="heading-3">合规化势在必行</h3>
<p>立足当前行业大环境，存量社交产品必须将合规化置于开发工作的核心首位。</p>
<p>若不存在关键性的功能迭代需求，<strong>建议尽量减少版本更新频次，甚至暂停更新，以此规避审核环节可能出现的风险</strong>，避免给产品运营增添不必要的阻碍。</p>
<p>当前国内市场的恶性竞争态势，必然会导致社交类产品在App Store平台面临更严峻的监管压力与发展困境。<code>因此，尽早布局出海业务、开拓海外新市场，已成这类产品突破发展瓶颈的关键方向</code>。</p>
<p><strong>合规化的价值懂的无需多言，不懂得多说无益。</strong></p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-4">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FV2F4BaEYh5HfeUUHm1tI6Q" target="_blank" title="https://mp.weixin.qq.com/s/V2F4BaEYh5HfeUUHm1tI6Q" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（代码篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FLs3su8fmMckTocPwMmFaNQ" target="_blank" title="https://mp.weixin.qq.com/s/Ls3su8fmMckTocPwMmFaNQ" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（ASO篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coco AI 技术演进：Shadcn UI + Tailwind CSS v4.0 深度迁移指南 (踩坑实录)]]></title>    <link>https://juejin.cn/post/7585031571889995819</link>    <guid>https://juejin.cn/post/7585031571889995819</guid>    <pubDate>2025-12-18T13:07:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585031571889995819" data-draft-id="7585022810180681791" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coco AI 技术演进：Shadcn UI + Tailwind CSS v4.0 深度迁移指南 (踩坑实录)"/> <meta itemprop="keywords" content="前端,CSS,WeUI"/> <meta itemprop="datePublished" content="2025-12-18T13:07:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨夜寻晴天"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coco AI 技术演进：Shadcn UI + Tailwind CSS v4.0 深度迁移指南 (踩坑实录)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨夜寻晴天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:07:56.000Z" title="Thu Dec 18 2025 13:07:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,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) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：本文深度复盘了 Coco AI 项目在引入 <strong>shadcn/ui</strong> 组件库的同时，激进升级至 <strong>Tailwind CSS 4.0</strong> 的技术细节。重点剖析了在 <strong>Vite + Tsup (Esbuild)</strong> 双构建工具链下的兼容性方案，以及如何处理 <code>tailwind.config.js</code> 与 CSS-first 配置模式的冲突，为维护大型遗留项目的开发者提供一份“硬核”避坑指南。</p>
</blockquote>
<h2 data-id="heading-0">前言：为什么要自找麻烦？</h2>
<p>在 Coco AI 的开发过程中，我们面临着大多数成长期项目都会遇到的痛点：</p>
<ol>
<li><strong>UI 碎片化</strong>：早期的手写 CSS 与后期的 Tailwind Utility Class 混杂，维护成本极高。</li>
<li><strong>重复造轮子</strong>：为了一个带键盘导航的 Dropdown，我们可能写了 500 行代码，且 Bug 频出。</li>
</ol>
<p>引入 <strong>shadcn/ui</strong> 是为了解决组件复用问题，而升级 <strong>Tailwind CSS v4.0</strong> 则是为了追求极致的构建性能（Rust 引擎）。当这两者在这个拥有大量遗留代码的项目中相遇时，一场“构建工程化的风暴”不可避免。</p>
<p>本文不谈虚的，直接上干货。</p>
<h2 data-id="heading-1">难点一：Vite 与 Tsup 的“双轨制”构建困局</h2>
<p>Coco AI 不仅是一个 Web 应用，还包含一个对外提供的 SDK。这就导致我们有两套构建流程：</p>
<ul>
<li><strong>Web App</strong>: 使用 <strong>Vite</strong> (Rollup)。</li>
<li><strong>Web SDK</strong>: 使用 <strong>Tsup</strong> (Esbuild)。</li>
</ul>
<p>Tailwind v4 推荐使用 <code>@tailwindcss/vite</code> 插件，这在 Web App 中运行良好。但在 SDK 构建中，Esbuild 并不支持该插件。</p>
<h3 data-id="heading-2">解决方案：混合编译策略</h3>
<p>我们被迫采用了一套“混合”方案：Web 端享受 v4 的插件红利，SDK 端则回退到 PostCSS 处理。</p>
<h4 data-id="heading-3">1. Web 端 (Vite)</h4>
<p>一切从简，使用官方插件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">"@tailwindcss/vite"</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">"@vitejs/plugin-react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// 这里的 tailwindcss() 会自动扫描文件，性能极快</span>
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">tailwindcss</span>() <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>, <span class="hljs-title function_">react</span>()],
});
</code></pre>
<h4 data-id="heading-4">2. SDK 端 (Tsup/PostCSS)</h4>
<p>这是最坑的地方。Tsup 基于 Esbuild，而 Esbuild 默认无法解析 v4 的 <code>@import "tailwindcss";</code>。我们需要手动配置 PostCSS 管道。</p>
<p>首先，配置 <code>postcss.config.js</code>，显式使用 v4 的 PostCSS 插件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// postcss.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-comment">// ⚠️ 注意：Tailwind v4 的 PostCSS 插件包名变了</span>
    <span class="hljs-string">'@tailwindcss/postcss'</span>: {}, 
    <span class="hljs-attr">autoprefixer</span>: {},
  },
}
</code></pre>
<p>然后，在 <code>tsup.config.ts</code> 中施展“魔法”：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// tsup.config.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-title function_">esbuildOptions</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-comment">// 🔥 关键黑魔法：启用 'style' 条件，让 esbuild 能找到 tailwindcss 的入口</span>
    (options <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">conditions</span> = [<span class="hljs-string">"style"</span>, <span class="hljs-string">"browser"</span>, <span class="hljs-string">"module"</span>, <span class="hljs-string">"default"</span>];
  },
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onSuccess</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 构建后手动运行 PostCSS，处理 CSS 文件中的 @import "tailwindcss"</span>
    <span class="hljs-comment">// ...代码略，见源码...</span>
  }
});
</code></pre>
<h2 data-id="heading-5">难点二：JS 配置与 CSS 配置的“博弈”</h2>
<p>Tailwind v4 推崇 <strong>CSS-first</strong>，即把配置都写在 CSS 的 <code>@theme</code> 块中。但 shadcn/ui 强依赖 <code>tailwindcss-animate</code> 插件，且我们有大量复杂的自定义动画（如打字机效果、震动效果）写在 <code>tailwind.config.js</code> 中。</p>
<p><strong>如果完全迁移到 CSS，工作量巨大且易出错。</strong></p>
<h3 data-id="heading-6">解决方案：JS 与 CSS 共存</h3>
<p>我们保留了 <code>tailwind.config.js</code>，主要用于存放<strong>插件</strong>和<strong>复杂动画</strong>，而将<strong>颜色变量</strong>迁移到 CSS 中。</p>
<p><strong>保留的 <code>tailwind.config.js</code> (部分)</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> animate <span class="hljs-keyword">from</span> <span class="hljs-string">"tailwindcss-animate"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// v4 会自动检测并合并这个配置</span>
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">extend</span>: {
      <span class="hljs-comment">// 复杂的 Keyframes 还是写在这里比较清晰</span>
      <span class="hljs-attr">animation</span>: {
        <span class="hljs-attr">typing</span>: <span class="hljs-string">"typing 1.5s ease-in-out infinite"</span>,
        <span class="hljs-attr">shake</span>: <span class="hljs-string">"shake 0.5s ease-in-out"</span>,
      },
      <span class="hljs-attr">keyframes</span>: {
        <span class="hljs-attr">typing</span>: {
          <span class="hljs-string">"0%"</span>: { <span class="hljs-attr">opacity</span>: <span class="hljs-string">"0.3"</span> },
          <span class="hljs-string">"50%"</span>: { <span class="hljs-attr">opacity</span>: <span class="hljs-string">"1"</span> },
          <span class="hljs-string">"100%"</span>: { <span class="hljs-attr">opacity</span>: <span class="hljs-string">"0.3"</span> },
        },
        <span class="hljs-comment">// ...</span>
      },
      <span class="hljs-comment">// 映射 border-radius 到 CSS 变量，适配 shadcn</span>
      <span class="hljs-attr">borderRadius</span>: {
        <span class="hljs-attr">lg</span>: <span class="hljs-string">"var(--radius)"</span>,
        <span class="hljs-attr">md</span>: <span class="hljs-string">"calc(var(--radius) - 2px)"</span>,
        <span class="hljs-attr">sm</span>: <span class="hljs-string">"calc(var(--radius) - 4px)"</span>,
      },
    },
  },
  <span class="hljs-attr">plugins</span>: [animate], <span class="hljs-comment">// shadcn 必需的插件</span>
};
</code></pre>
<p><strong>新的 <code>src/main.css</code> (v4 风格)</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;

<span class="hljs-comment">/* ⚠️ 必坑点：显式指定扫描源，否则可能漏掉 HTML 或特定目录 */</span>
<span class="hljs-keyword">@source</span> <span class="hljs-string">"../index.html"</span>;
<span class="hljs-keyword">@source</span> <span class="hljs-string">"./**/*.{ts,tsx}"</span>;

<span class="hljs-keyword">@theme</span> {
  <span class="hljs-comment">/* 在 CSS 中通过变量映射颜色，不仅支持 shadcn，还能兼容旧代码 */</span>
  <span class="hljs-attr">--color-background</span>: <span class="hljs-built_in">var</span>(--background);
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-built_in">var</span>(--primary);
  <span class="hljs-comment">/* ... */</span>
}
</code></pre>
<h2 data-id="heading-7">难点三：颜色空间与暗色模式的“大一统”</h2>
<p>Coco AI 的旧代码使用 RGB 值（如 <code>rgb(149, 5, 153)</code>），而 shadcn 使用 HSL（如 <code>222.2 84% 4.9%</code>），Tailwind v4 默认又倾向 OKLCH。</p>
<h3 data-id="heading-8">解决方案：变量映射层</h3>
<p>我们在 <code>main.css</code> 中建立了一个“中间层”，让新老变量和谐共存。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* === Shadcn 系统 (HSL) === */</span>
  <span class="hljs-attr">--primary</span>: <span class="hljs-number">221.2</span> <span class="hljs-number">83.2%</span> <span class="hljs-number">53.3%</span>;
  
  <span class="hljs-comment">/* === Coco Legacy 系统 (RGB) === */</span>
  <span class="hljs-comment">/* 即使是旧变量，也可以根据需要调整，或者直接硬编码保留 */</span>
  <span class="hljs-attr">--coco-primary-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">149</span>, <span class="hljs-number">5</span>, <span class="hljs-number">153</span>);
}

<span class="hljs-comment">/* ⚠️ v4 暗色模式新语法：废弃了 darkMode: 'class' */</span>
<span class="hljs-keyword">@custom-variant</span> dark (&amp;:where(.dark, .dark *));
<span class="hljs-keyword">@custom-variant</span> dark (&amp;:where([data-theme=<span class="hljs-string">"dark"</span>], [data-theme=<span class="hljs-string">"dark"</span>] *));

<span class="hljs-selector-class">.dark</span><span class="hljs-selector-class">.coco-container</span>,
<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">"dark"</span>]</span> {
  <span class="hljs-comment">/* 重新定义 HSL 值实现暗色模式 */</span>
  <span class="hljs-attr">--background</span>: <span class="hljs-number">222.2</span> <span class="hljs-number">84%</span> <span class="hljs-number">4.9%</span>;
  
  <span class="hljs-comment">/* 同时覆盖旧系统的变量 */</span>
  <span class="hljs-attr">--coco-primary-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">149</span>, <span class="hljs-number">5</span>, <span class="hljs-number">153</span>);
}
</code></pre>
<h2 data-id="heading-9">难点四：Web SDK 的 CSS 变量兼容性黑科技</h2>
<p>在开发 Web SDK 时，我们遇到一个隐蔽的问题：<strong>CSS 变量的初始值丢失</strong>。</p>
<p>Tailwind v4 会生成大量的 CSS Houdini <code>@property</code> 规则来定义变量的类型和初始值：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@property</span> --tw-translate-x {
  syntax: <span class="hljs-string">"*"</span>;
  inherits: false;
  initial-value: <span class="hljs-number">0</span>;
}
</code></pre>
<p>这在现代浏览器中运行完美。但由于我们的 SDK 会被嵌入到各种宿主环境中，部分环境可能不支持 <code>@property</code>，导致变量因为没有显式的赋值而失效（<code>initial-value</code> 被忽略）。</p>
<h3 data-id="heading-10">解决方案：构建后脚本补全 (Post-build Script)</h3>
<p>为了保证“即插即用”的稳定性，我们编写了一个专门的构建后处理脚本 <code>scripts/buildWebAfter.ts</code>。</p>
<p>它的作用是：<strong>扫描生成的 CSS，提取所有 <code>@property</code> 的 <code>initial-value</code>，并将它们显式注入到 <code>.coco-container</code> 作用域中。</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// scripts/buildWebAfter.ts (精简版)</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">extractCssVars</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> cssContent = <span class="hljs-title function_">readFileSync</span>(filePath, <span class="hljs-string">"utf-8"</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-attr">vars</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {};
  
  <span class="hljs-comment">// 正则提取所有 @property 的 initial-value</span>
  <span class="hljs-keyword">const</span> propertyBlockRegex = <span class="hljs-regexp">/@property\s+(--[\w-]+)\s*\{([\s\S]*?)\}/g</span>;
  <span class="hljs-keyword">while</span> ((match = propertyBlockRegex.<span class="hljs-title function_">exec</span>(cssContent))) {
    <span class="hljs-keyword">const</span> initialValueMatch = <span class="hljs-regexp">/initial-value\s*:\s*([^;]+);/</span>.<span class="hljs-title function_">exec</span>(match[<span class="hljs-number">2</span>]);
    <span class="hljs-keyword">if</span> (initialValueMatch) {
      vars[match[<span class="hljs-number">1</span>]] = initialValueMatch[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>();
    }
  }

  <span class="hljs-comment">// 生成标准的 CSS 变量赋值块</span>
  <span class="hljs-keyword">const</span> cssVarsBlock =
    <span class="hljs-string">`.coco-container {\n`</span> +
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(vars)
      .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> <span class="hljs-string">`  <span class="hljs-subst">${k}</span>: <span class="hljs-subst">${v}</span>;`</span>) <span class="hljs-comment">// 显式赋值：--var: value;</span>
      .<span class="hljs-title function_">join</span>(<span class="hljs-string">"\n"</span>) +
    <span class="hljs-string">`\n}\n`</span>;

  <span class="hljs-title function_">writeFileSync</span>(filePath, <span class="hljs-string">`<span class="hljs-subst">${cssContent}</span>\n<span class="hljs-subst">${cssVarsBlock}</span>`</span>, <span class="hljs-string">"utf-8"</span>);
};
</code></pre>
<p><strong>效果</strong>：即使浏览器不支持 <code>@property</code>，变量也能通过标准的 CSS 级联机制获得正确的初始值，确保 SDK 在任何环境下样式都不崩坏。</p>
<h2 data-id="heading-11">避坑清单 (Checklist)</h2>
<p>在迁移过程中，我们踩了无数坑，以下是血泪总结：</p>
<ol>
<li>
<p><strong>样式莫名丢失？</strong></p>
<ul>
<li><strong>原因</strong>：Tailwind v4 的自动扫描可能没覆盖到你的文件结构。</li>
<li><strong>解法</strong>：使用 <code>@source</code> 指令显式添加路径，如 <code>@source "./**/*.{ts,tsx}";</code>。</li>
</ul>
</li>
<li>
<p><strong>VS Code 满屏报错？</strong></p>
<ul>
<li><strong>原因</strong>：VS Code 的 Tailwind 插件版本过低，不认识 <code>@theme</code>、<code>@source</code> 等新指令。</li>
<li><strong>解法</strong>：升级插件到最新版，并确保设置中关联了正确的文件类型。</li>
</ul>
</li>
<li>
<p><strong>构建时报错 <code>Cannot find module</code>？</strong></p>
<ul>
<li><strong>原因</strong>：<code>postcss.config.js</code> 中引用了不存在的插件。</li>
<li><strong>解法</strong>：确认安装了 <code>@tailwindcss/postcss</code> 并在配置中正确引用（注意包名变化）。</li>
</ul>
</li>
<li>
<p><strong>动画不生效？</strong></p>
<ul>
<li><strong>原因</strong>：<code>tailwind.config.js</code> 未被 Vite 插件读取。</li>
<li><strong>解法</strong>：在使用 <code>@tailwindcss/vite</code> 时，它通常会自动检测根目录下的配置文件。如果位置特殊，需手动指定。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-12">小结</h2>
<p>技术债是还不完的，但每一次还债都是一次成长的机会。</p>
<p>通过这次适配，Coco AI 不仅拥有了更现代化的 UI 架构，也为未来的跨平台（Web/Desktop/Mobile）统一体验打下了基础。特别是 Tailwind CSS v4.0 的引入，虽然初期配置略显折腾，但其带来的构建速度提升和开发体验优化，绝对是“真香”定律的又一次验证。</p>
<p>如果你也想体验一下这个“整容”后的全能生产力工具，欢迎来我们的 GitHub 看看：</p>
<ul>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">github.com/infinilabs/…</a></li>
<li><strong>Website</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs%2Fen" target="_blank" title="https://coco.rs/en" ref="nofollow noopener noreferrer">coco.rs/en</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[人工智能如何改变 Anthropic 的工作方式]]></title>    <link>https://juejin.cn/post/7585031571890012203</link>    <guid>https://juejin.cn/post/7585031571890012203</guid>    <pubDate>2025-12-18T13:11:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585031571890012203" data-draft-id="7585027616736215092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="人工智能如何改变 Anthropic 的工作方式"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-18T13:11:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序猿DD"/> <meta itemprop="url" content="https://juejin.cn/user/131597123993358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            人工智能如何改变 Anthropic 的工作方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123993358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序猿DD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:11:17.000Z" title="Thu Dec 18 2025 13:11:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读43分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果有一天，你走进公司，发现写代码、查 bug、跑实验的大部分体力活，都已经由一位看不见的 AI 搭档在后台悄悄完成了——而你更多是在提问题、定方向、做决策，而不是一行行敲代码，这会是什么感觉？是兴奋，因为产出翻倍、想法终于可以快速落地；还是隐隐不安，因为自己赖以安身立命的“手艺”似乎正在慢慢被接管？</p>
<p>对于正在建设 AI 的公司来说，这个问题来得比想象中更早、更猛。</p>
<p>Anthropic 在 2025 年做了一次有意思的“自我实验”：他们把镜头转向公司内部，系统性地调查工程师和研究人员是如何使用 Claude 的，以及这些变化正在如何重塑工作的内容、节奏、协作方式，甚至职业身份。下面内容翻译自 Anthropic 官方的长文《How AI Is Transforming Work at Anthropic》，基于问卷调查、深入访谈以及 Claude Code 使用数据，试图回答这样几个问题：</p>
<ul>
<li>AI 到底把工程师的时间花在了哪里？</li>
<li>它真的提升了生产力吗？</li>
<li>我们会因此变得更“全栈”，还是逐渐失去底层能力？</li>
<li>在这场转型里，个体应该如何重新定位自己的角色？</li>
</ul>
<hr/>
<p>人工智能正在如何改变我们的工作方式？我们此前一项关于 AI 经济影响的研究，主要从整体劳动力市场的角度出发，考察了各种不同的工作。但如果我们把镜头拉近，去细看那些最早使用 AI 技术的一群人——也就是我们自己，会看到什么？</p>
<p>把视角转向公司内部，在 2025 年 8 月，我们对 132 名 Anthropic 的工程师和研究人员发放了问卷，进行了 53 次深入的定性访谈，并分析了内部的 Claude Code 使用数据，来理解 AI 使用方式正在如何改变 Anthropic 的日常工作。我们的发现是：AI 的使用正在从根本上改变软件开发者的工作性质，这既带来了希望，也带来了担忧。</p>
<p>我们的研究呈现出一个处在剧烈变革中的工作场所：工程师的产出显著提升，变得更加“全栈”（能够胜任原本超出自己专业范围的任务），学习和迭代的速度加快，也开始着手处理过去长期被搁置的任务。这种能力边界的外扩，也让大家开始思考代价：有人担心这会牺牲更深层次的技术功底，或者削弱自己有效监督 Claude 产出的能力；也有人则乐于拥抱这种变化，把它看作是思考方式从细节转向更高层次抽象的机会。有的人发现，与 AI 合作得越多，反而与同事合作得越少；还有人开始担心，自己会不会有一天真的把自己“自动化下岗”。</p>
<p>我们也意识到，在一家构建 AI 的公司内部研究 AI 的影响，本身就是一种带有“特权视角”的观察——我们的工程师有机会更早接触前沿工具，工作领域相对稳定，并且他们本身也是这轮 AI 变革在其他行业中发生的推动者。即便如此，我们仍然认为这些发现值得研究与公开分享，因为对工程师而言，在 Anthropic 内部正在发生的事情，很可能是更广泛社会转型的某种“预演”。这些发现提示了一些值得各个行业提前思考的挑战与问题（具体的研究限制可以参见文末附录中的“局限性”部分）。在这批数据采集时，Claude Sonnet 4 和 Claude Opus 4 是当时最强的模型，而模型能力此后仍在不断提升。</p>
<p>更强大的 AI 带来了生产力的提升，但同时也抛出了新的问题：如何保持技术能力不过度流失？如何在 AI 协作下维持有意义的人与人协作？如何为一个充满不确定性的未来做准备——那可能需要截然不同的学习方式、指导机制和职业发展路径？在文末“展望未来”部分，我们讨论了一些 Anthropic 正在内部尝试的初步探索。在另一篇关于经济政策的博客文章中，我们也提出了一些围绕 AI 的经济政策设想。</p>
<h2 data-id="heading-0">关键发现</h2>
<p>在本节中，我们会简要总结问卷、访谈和 Claude Code 数据给出的主要结论。更详细的结果、方法和注意事项，会在后面的章节中展开。</p>
<p><strong>问卷数据</strong></p>
<ol>
<li><strong>Anthropic 的工程师和研究人员最常用 Claude 来修复代码错误和理解代码库。</strong> 调试和代码理解是最常见的使用场景（对应图 1）。</li>
<li><strong>大家报告 Claude 使用频率与生产力提升都在持续上升。</strong> 员工自报目前有约 60% 的工作会使用 Claude，平均带来约 50% 的生产力提升——相比一年前，这是 2～3 倍的增长。生产力提升的表现形式，是各类任务上单个任务花费的时间略有下降，但整体产出量明显增加（对应图 2）。</li>
<li><strong>约 27% 的 Claude 辅助工作，是本来不会发生的。</strong> 比如扩展项目规模、做各种“锦上添花”的工具（如交互式数据看板），以及一些如果完全人工完成就不划算的探索性工作。</li>
<li><strong>多数员工频繁使用 Claude，但认为“可以完全交给 Claude 不用自己验证”的工作只占 0–20%。</strong> Claude 更像是一个始终在线的协作者；使用它通常仍然需要主动监督和验证，尤其是在高风险场景下，而不是完全不用检查就把任务直接“甩手”出去。</li>
</ol>
<p><strong>定性访谈</strong></p>
<ol>
<li><strong>员工正在逐渐形成关于“什么任务适合交给 AI”的直觉。</strong> 工程师倾向于把那些易于验证、自己“可以比较轻松地嗅一嗅就知道对不对”的任务、低风险任务（例如“一次性的调试脚本或研究代码”），或者枯燥无聊的事情交给 Claude（“我越是对一件事感到兴奋，就越不太会用 Claude；反之，如果对这件事本身有很多心理阻力，我往往会先和 Claude 开个头”）。许多人会从简单任务开始试探性地交给 Claude，然后逐步扩大到更复杂的工作——目前大家仍倾向于把大部分设计或“品味”相关的工作留在自己手中，不过随着模型能力提升，这条边界也在不断被重新谈判。</li>
<li><strong>技能在更多方向上被拓展，但动手练习的机会变少了。</strong> Claude 让大家可以在更多领域“伸出触角”（比如软件工程的不同层面：“我现在可以很熟练地做前端、事务型数据库、API 代码这些东西——这些以前是我不太敢碰的部分”），但也有人担忧，深层次的技能在写代码和审代码上的积累会因此萎缩——“当产出某个结果变得这么容易、这么快时，你就更难逼自己停下来，花时间真正去学一个东西。”</li>
<li><strong>人与“编程手艺”的关系在改变。</strong> 有人拥抱 AI 助手，把重点放在结果上（“我以前以为自己喜欢的是写代码，现在发现我喜欢的其实是写完代码之后得到的那些东西”）；也有人坦言“对写代码这件事本身有些怀念”。</li>
<li><strong>工作场所的社交动态也在变化。</strong> Claude 已经成为很多工程师提问时的“第一站”，那些过去会去问同事的问题，现在都先问 Claude——结果是，部分人感觉到自己获得的指导和协作机会减少了。（“我很喜欢和人一起工作，现在有点难过的是，我‘需要’他们的频率变低了……更初级的同事也不太像以前那样来问我问题。”）</li>
<li><strong>职业路径在演化，未来也充满不确定。</strong> 工程师正在转向更高层级的工作——管理 AI 系统，同时报告了显著的生产力提升。但这些变化也让人对软件工程这一职业的长期前景产生疑问。有人态度复杂：“短期我很乐观，但长期我觉得 AI 最终会把所有事情都做掉，让我和很多人变得不再重要。”也有人坦承，对未来自己的角色会变成什么样，“很难说”。</li>
</ol>
<p><strong>Claude Code 使用趋势数据</strong></p>
<ol>
<li><strong>Claude 正在以更高的自主性处理越来越复杂的任务。</strong> 六个月前，Claude Code 大概可以连续自主完成 10 个动作，之后就需要人来介入。现在，它通常可以连续完成大约 20 个动作，在更复杂的工作流中对人类“指挥”的频率明显降低（对应图 3）。工程师也越来越多地用 Claude 来做复杂任务，比如代码设计/规划（在所有使用中的占比从 1% 提升到 10%），以及实现新功能（从 14% 提升到 37%，对应图 4）。</li>
<li><strong>Claude 修掉了很多“纸割伤（papercuts）”。</strong> 大约 8.6% 的 Claude Code 任务是对那些提升工作体验但容易被忽视的小问题的修复，例如为了可维护性而做的重构，也就是人们口中的“修纸割伤”，这些事情在过去通常会被一直往后排。这些小改动积少成多，有望带来更大的效率和体验提升。</li>
<li><strong>每个人都在变得更“全栈”。</strong> 不同团队以不同方式使用 Claude，往往是用来增强各自的核心专长——比如安全团队用它来分析陌生代码，Alignment &amp; Safety 团队用它来构建数据可视化前端，等等（对应图 5）。</li>
</ol>
<h2 data-id="heading-1">问卷数据</h2>
<p>我们向 Anthropic 各个团队的 132 名工程师和研究人员发放了问卷，希望更好地理解他们在日常工作中到底是如何使用 Claude 的。问卷通过内部沟通渠道和直接私信的方式分发，覆盖了来自不同研究和产品团队的成员。附录中有更详细的方法说明，我们也公开了问卷题目，方便其他人评估我们的方法并在自己的研究中借鉴。</p>
<h3 data-id="heading-2">人们在什么编码任务上使用 Claude？</h3>
<p>我们请受访的工程师和研究人员，评估自己在不同类型编码任务中使用 Claude 的频率，比如“调试”（用 Claude 帮助修复代码错误）、“代码理解”（让 Claude 解释既有代码，帮助自己理解代码库）、“重构”（用 Claude 帮助重组已有代码）、“数据科学”（例如让 Claude 分析数据集、画柱状图）。</p>
<p>下面是最常见的一些日常任务。多数员工（55%）表示自己每天都会用 Claude 做调试；42% 的人每天会用 Claude 做代码理解；37% 的人每天会用 Claude 来实现新功能。使用相对较少的，是高层设计/规划（很可能是因为大家普遍倾向把这类任务保留在“人手里”），以及数据科学和前端开发（因为这些任务本身在整体工作中的比例就较低）。这和 Claude Code 使用数据中不同任务类型的分布大致相符（见前文提到的“Claude Code 使用趋势”部分）。</p>
<p><img src="https://static.didispace.com/images4/20369b7b799084f96b93b487760fab69.webp" alt="64a18b1756d8954a93e1356f1330ec11075fbe54-3840x2160.webp" loading="lazy"/>
<em>图 1：不同编码任务（纵轴）对应的日常使用者比例（横轴）。</em></p>
<h3 data-id="heading-3">使用频率与生产力</h3>
<p>员工自报的数据显示，12 个月前，他们在日常工作中约有 28% 的时间会用到 Claude，当时平均感受到的生产力提升是 +20%；而现在，他们在约 59% 的工作中使用 Claude，平均生产力提升达到了 +50%。（这一点和工程团队在全面采用 Claude Code 后，人均每天合并的 Pull Request 数量增加 67% 的数据大致相互印证。）按年对比来看，这个变化相当剧烈——一年时间里，这两个指标都实现了超过 2 倍的提升。使用频率与生产力提升高度相关，在分布的极端一端，有 14% 的受访者通过使用 Claude 报告了超过 100% 的生产力提升——可以看作内部的“超级用户”。</p>
<p>需要强调的是，包括这一条在内的所有“生产力自评”都有不少不确定性，生产力本身很难被精确测量。外部研究机构 METR 有一项近期研究指出，在一个高度熟悉的代码库上，使用 AI 的经验丰富开发者其实高估了 AI 带来的生产力提升。值得注意的是，那项研究中导致生产力没有预期那么高的因素（例如在大型复杂环境中 AI 表现变差，或任务中包含大量隐性知识和上下文）与我们员工所描述的“不适合交给 Claude 的任务类型”高度一致。我们的生产力提升数据是跨任务的自报，很可能反映了员工在“适合交给 AI 的任务选择”上逐渐形成策略化的判断——而这在 METR 的那项研究中并没有被纳入考量。</p>
<p>当我们进一步追问，在那些已经使用 Claude 的任务类别中，它会如何影响该类别总体花费的时间和产出量时，一个有趣的模式出现了：几乎在所有任务类别上，员工都报告了总体时间投入略有下降，而产出数量的增加更加明显。</p>
<p><img src="https://static.didispace.com/images4/6de8a1a3717018693292fe8a21c2b601.webp" alt="9449bf9393743105a414e17324f30970208ce14b-3840x2160.webp" loading="lazy"/>
<em>图 2：在不同任务类别（纵轴）中，Claude 使用对“时间投入”（左图）和“产出数量”（右图）的影响。横轴为自报的时间/产出增减（负值代表减少，正值代表增加，虚线为“无变化”），误差条为 95% 置信区间，圆点面积与该评价点的回答数量成正比。只统计在该任务类别中使用过 Claude 的受访者。</em></p>
<p>不过，进一步观察原始数据会发现，时间节省的回答在分布上呈现两极——有些人在 Claude 辅助的任务上反而花了明显更多的时间。</p>
<p>为什么会这样？人们普遍解释说，他们需要花更多时间调试和清理 Claude 写出的代码（例如“当我自己随手写着写着把自己写进死胡同时”），也要承担理解 Claude 代码的额外认知负担，因为那不是自己一行行写出来的。有些人则表示，花更多时间是“赋能意义上的多投入”——有人说，Claude 让他们能“在以前马上就会放弃的问题上坚持下去”；也有人说，它让自己能做更全面的测试，并在新的代码库中投入更多学习和探索。从整体看，那些体验到时间节省的人，很可能正是善于把“易验证任务”打包交给 Claude 的人；而那些花了更多时间的人，则往往要为 AI 生成的代码做更多调试，或者在模型需要大量引导的领域中工作。</p>
<p>从数据中也看不出，这些被节省出来的时间最终流向了哪里——是投入到额外的工程任务、非工程任务、与 Claude 互动或审查其输出，还是工作之外的活动？我们的任务分类框架无法覆盖工程师时间分配的全部维度。此外，时间节省本身也可能受到自报偏差的影响。这些问题都需要进一步研究来拆解。</p>
<p>相比之下，产出数量的提升要更直接、更显著：几乎所有任务类别上，净产出增加都更大。这一模式也很合理——受访者报告的是“调试”这一类任务，而不是某一条具体的 bug。也就是说，即使在“调试”这个类别上花的总时间略有减少，人们依然可以完成更多的调试任务。从严格意义上讲，生产力很难被直接测量，但这些自报数据至少表明：在 Anthropic，AI 主要是通过增加产出来提升生产力的。</p>
<h3 data-id="heading-4">Claude 让哪些“新工作”得以发生？</h3>
<p>我们很好奇的一点是：Claude 是否真的让一些“以前不会做的事情”得以发生，还是说，它只是让原本迟早会完成的工作变快了一些？</p>
<p>员工估算，在他们当前使用 Claude 完成的工作中，有约 27% 如果没有 Claude 根本不会去做。工程师提到，会用 AI 来做项目扩展、各种“锦上添花”的事情（比如交互式数据仪表盘）、一些本身很有价值但很枯燥的工作，如写文档、补测试，以及那些如果完全人工来做就不划算的探索性尝试。正如一位受访者所说，他们现在可以修掉更多以前影响体验、但一直没有人腾出手去“收拾”的小问题，比如重构结构很差的代码，或者写一些“小工具”来加速其他任务。我们在 Claude Code 使用数据中也看到了类似现象：约有 8.6% 的任务可以归类为“papercut 修复”。</p>
<p>另一位研究人员举例说，他们会同时开启很多个 Claude 实例，让它们并行探索解决同一个问题的不同路径：</p>
<blockquote>
<p>人们往往把“超级强大”的模型想象成一个单一实例，就像换了一辆更快的汽车。但如果你有“一百万匹马”……你就可以同时尝试很多不同的想法……当你有这么大的探索广度时，这件事会变得非常令人兴奋、也更具创造性。</p>
</blockquote>
<p>正如我们会在后面的章节里看到的，这类“新工作”往往涉及工程师走出自己原有的专业舒适区。</p>
<h3 data-id="heading-5">到底有多少工作可以完全交给 Claude？</h3>
<p>尽管工程师们非常频繁地使用 Claude，但超过一半的人认为，真正“可以完全交给 Claude、不需要自己再验证”的工作只占自己总工作量的 0–20%。（值得一提的是，不同受访者对“完全交给”这一说法的理解并不完全一样——有的人指的是完全无需验证，有的人则是指只需很轻量的检查。）在解释“为什么不能更多完全交给 Claude”时，工程师描述的是一种高度主动、迭代式的工作方式：他们会和 Claude 来回对话、一起推进任务，并在过程中不断验证 Claude 的输出——尤其是那些复杂任务或代码质量要求极高的高风险领域。这说明，工程师们倾向于把 Claude 当作一个紧密协作的伙伴，而不是“黑箱外包方”，并且他们对“什么算是可以完全交出去”设定了非常高的标准。</p>
<h2 data-id="heading-6">定性访谈</h2>
<p>虽然问卷结果显示了显著的生产力提升和工作模式变化，但它们并不能回答一个关键问题：工程师在日常工作中，具体是如何体验这些变化的？为此，我们对参与问卷的 Anthropic 工程师和研究人员中的 53 人进行了深入访谈，以理解他们在这场变革中的真实感受和思考。</p>
<h3 data-id="heading-7">AI 委托方式</h3>
<p>工程师和研究人员正在发展出一系列策略，以更高效地在工作流中使用 Claude。总体而言，人们倾向于把下面几类任务委托给 Claude：</p>
<p>|| <strong>超出自己的熟悉上下文、但整体复杂度较低的任务</strong>：例如“我会把那些我自己上下文不太熟，但整体难度不高的问题交给 Claude。”又如“我遇到的大多数基础设施问题并不算难，Claude 就能搞定……我对 Git 或 Linux 其实不太熟，但 Claude 在这些方面很好地帮我补上了经验上的短板。” |
|| <strong>容易验证的任务</strong>：例如“对于那些验证成本相对创建成本不高的事情，它简直太好用了。” |
|| <strong>边界清晰、相对自洽的子问题</strong>：例如“如果一个子模块和系统其他部分足够解耦，我通常会先让 Claude 试一把。” |
|| <strong>代码质量要求不那么高的场景</strong>：例如“如果是一次性的调试或研究代码，我通常会直接让 Claude 写。如果是概念上很难、或者需要非常特殊的调试注入，或者是设计问题，那我还是会自己来。” |
|| <strong>重复、枯燥的事情</strong>：例如“我越兴奋的一件事，就越不太会用 Claude；相反，如果我对一件事产生很大心理阻力，那通常我会先和 Claude 开个头。”在问卷中，大家平均认为，自己用 Claude 完成的工作有 44% 是本来就不太想亲自做的那种。 |
|| <strong>写提示比自己动手更省时间的任务</strong>：例如“如果我预估某件事我自己十分钟以内能搞定，那我通常不会麻烦 Claude。”又比如“现在最大的问题其实是‘冷启动’。所谓冷启动，就是我脑子里有很多关于我们团队代码库的隐性信息，而 Claude 默认并不知道这些……我可以花很多时间去打磨一个完美的提示词，但很多时候不如自己动手来得快。” |</p>
<p>这些员工提到的委托考量，与一项外部研究中发现的“AI 反而拖慢生产力”的情境高度一致（例如开发者对代码库非常熟悉、代码仓库规模巨大且复杂等）。这种内外研究在“什么任务适合交给 AI”上的收敛表明，任务选择本身很可能是影响 AI 生产力收益的关键因素——未来的生产力研究需要对这一点进行更精细的控制。</p>
<h4 data-id="heading-8">信任，但要验证（Trust but verify）</h4>
<p>很多用户描述了自己使用 Claude 的“信任演化过程”：一开始只是用它来问一些 Rust 之类语言的基础问题……而最近，自己几乎所有编码工作都会用上 Claude Code。</p>
<p>有一位工程师把这种信任演化，比作自己使用 Google 地图的过程：</p>
<blockquote>
<p>一开始，我只会在不熟悉的路线用 Google Maps……这就像一开始我只用 Claude 来写自己不太熟的 SQL，但不会让它写我很熟的 Python。后来，我会在大致熟悉的路线上也开着地图，也许只是最后一段路不太确定……就像逐渐让 Claude 参与我部分熟悉的任务。现在，即便是每天通勤的路线，我也一直开着 Google Maps。如果它建议我走一条不同的路，我通常会直接照做，相信它已经综合考虑了各种因素……我今天用 Claude Code 的方式，其实很像这样。</p>
</blockquote>
<p>在“用 Claude 处理自己熟悉领域的任务，还是陌生领域的任务”这件事上，工程师们也出现了分化。有的人更倾向把 Claude 用在“边缘领域”，以节省实现时间；有的人则更喜欢在熟悉的领域使用它，因为那样自己更有能力验证结果（“我用 Claude 的方式，是我始终对它在做什么保持完整理解”）。一位安全工程师就强调了经验的重要性：有一次 Claude 提出一个“非常聪明、但也非常危险”的方案，这种方案就像是一个很有才华但缺乏经验的初级工程师会想出来的东西——只有具备判断力和经验的人，才能意识到这里潜藏的问题。</p>
<p>还有一些工程师则两种情况都会用 Claude，要么是以一种“实验”心态（“基本上遇到任何编码问题，我都会先让 Claude 打个样”），要么是根据自己在某个领域的熟悉程度，调整与 Claude 的分工方式：</p>
<blockquote>
<p>如果是我非常熟悉的领域，我会更强势一点，告诉 Claude 具体要去查什么、怎么做。如果是我不太熟的东西，我通常会让 Claude 去当专家，让它给我提供选项，指出我应该考虑和研究的方向。</p>
</blockquote>
<h4 data-id="heading-9">人们会把什么任务留给自己？</h4>
<p>几乎所有人都表示，他们不会用 Claude 来做那些涉及高层次或战略性思考的任务，也不会把需要组织语境或“品味判断”的设计决策交给 Claude。一位工程师说得很直接：“我通常会把高层思考和设计留在自己手里，只要能交出去的事情，从新功能开发到调试，我都会尽量交出去。”这一点也在问卷数据中得到了印证——在设计和规划类任务上，生产力提升是最有限的（见图 2）。许多人也把这种“委托边界”描述为一个“不断移动的目标”，会随着模型能力的演进而持续被重新划线（Claude Code 使用数据也显示，相比六个月前，现在用于代码设计/规划的使用占比已经明显提升）。</p>
<h3 data-id="heading-10">技能的变化</h3>
<h4 data-id="heading-11">新的能力……</h4>
<p>问卷中“有 27% 的 Claude 辅助工作本来不会被完成”这一发现，也映射出一个更宏观的模式：工程师们正在用 AI 去做原本属于自己核心技能范围之外的事情。许多员工表示，他们完成了很多以前自己不太会做的工作——后端工程师开始搭前端界面，研究人员自己做可视化。有一位后端工程师回忆说，他通过和 Claude 反复迭代，搭出了一个复杂的前端界面：“效果比我自己做的好太多了。按原来的节奏，我根本不可能在要求的时间内做完……设计师看到之后都惊讶地问：‘等等，这是你做的？’我说：‘不，这是 Claude 做的——我只是负责提需求。’”</p>
<p>工程师们普遍觉得，自己正在“变得更全栈”：“我现在非常有信心能做前端、事务型数据库、API 代码这些活儿，而以前我会有点怕碰这些不擅长的部分。”这种能力的扩展让反馈循环变得更紧凑，也加快了学习速度——有人形容，以前需要“几周时间、不断开会、反复迭代”的过程，现在可以在“几个小时的工作会”里完成，相关同事也可以在现场实时给反馈。</p>
<p>总体而言，大家对自己更快原型化、并行推进工作、减少重复劳动、提升目标雄心这一系列新能力都感到振奋。一位高级工程师说：“这些工具确实让初级工程师更高效、更敢接大项目。”也有人提到，使用 Claude 让自己更容易跨过“启动门槛”，战胜拖延症——“它大幅降低了我愿意开始解决一个问题所需要的心理能量，因此我愿意多接很多以前会一拖再拖的事情。”</p>
<h4 data-id="heading-12">……以及更少的“亲手练习”</h4>
<p>同时，也有不少人担心，在越来越多事情交给 Claude 之后，自己的技能会“慢慢生锈”，尤其是那些在手动解决问题过程中积累的“顺带收获”的理解：</p>
<blockquote>
<p>如果你完全自己去排查一个棘手的问题，你会花很多时间看文档、看和问题不那么直接相关的代码——虽然这些内容对眼前这一个问题未必有用，但在整个过程中，你会慢慢构建起对系统的整体心智模型。现在，因为 Claude 能直接把你带到问题所在，这样的学习过程就少了很多。</p>
</blockquote>
<blockquote>
<p>我以前会自己把一个工具的所有配置项都翻一遍，以便真正理解它能做什么；现在我更多是问 AI 该怎么用，所以很多时候我缺少对工具的那种“肌肉记忆式理解”。以前和同事讨论问题时，我可以很快地从记忆里调出很多细节；现在则经常需要再去问 AI。</p>
</blockquote>
<blockquote>
<p>使用 Claude 的一个风险，是它可能会让你跳过那种通过解决“简单版问题”来练习的阶段，然后在遇到“复杂版问题”时，反而因为缺乏底层经验而很吃力。</p>
</blockquote>
<p>一位高级工程师说，如果自己处在更初级的阶段，他会更担心这一点：</p>
<blockquote>
<p>我现在主要是在自己知道答案是什么、或者大致知道答案长什么样的情况下用 AI。我是通过“按传统方式”做了很多年软件工程积累出这种判断能力的……但如果我还在职业早期，我会认为，想要在这种环境里持续提升自己的能力，需要付出很多刻意练习，而不能只是盲目接受模型的输出。</p>
</blockquote>
<p>技能萎缩之所以让人担心，很大一部分原因在于“监督悖论”：如前面所说，高效使用 Claude 需要监督，而要监督 Claude，你又需要那些可能因为过度依赖 AI 而萎缩的编码技能。正如一位受访者所说：</p>
<blockquote>
<p>说实话，我比起自己的技能，更担心的是监督和管控的问题……我的技能如果萎缩或停滞，真正的问题在于，我对自己使用 AI 完成重要任务是否足够安全、是否有能力发现它的漏洞，而不是在于我究竟还能不能自己一个人把这件事从头做到尾。</p>
</blockquote>
<p>为此，有些工程师会刻意“断网练功”——在明知道 Claude 可以很好解决问题的情况下，刻意选择不用：</p>
<blockquote>
<p>偶尔，我明明知道 Claude 能十拿九稳解决一个问题，也会刻意不去问它。这算是给自己的一个“小训练”，让自己保持敏锐。</p>
</blockquote>
<h4 data-id="heading-13">这些动手编码能力，将来还重要吗？</h4>
<p>也许软件工程正在进入一个新的抽象层级，这在历史上已经发生过很多次。最早的程序员工作在非常贴近机器的层面——手动管理内存，用汇编语言写程序，甚至通过拨动物理开关来输入指令。后来，更高级、更易读的编程语言出现，它们自动处理了很多底层复杂操作。也许，随着所谓“vibe coding”的兴起，我们正走向一个“英语就是编程语言”的时代。有人建议，未来想做工程师的人应该“先学会如何让 AI 写代码，把更多精力放在学习高层概念和模式上”。</p>
<p>有些员工觉得，这种转变让他们能在更高的层面上思考——“更多去想最终产品和最终用户，而不仅仅是代码本身”。有人把当前的变化类比为以前必须在计算机课程里学链表这类底层数据结构——这些结构现在早已被高级语言封装好了。“我很高兴自己曾经学过这些……但从情感上讲，一遍遍做这些底层操作对我来说并不重要。我更在意的是，代码能让我真正做成什么。”也有人做了类似的比较，但同时指出，抽象的提升也意味着代价——随着大家对高级语言的依赖，绝大多数工程师对内存管理失去了深入理解。</p>
<p>在某个领域持续打磨技能，确实可以让你更好地监督 Claude，也更高效地与之合作（“我发现，在我熟悉的领域里，很多时候自己做反而更快”）。但工程师们在“这是否重要”这个问题上并不一致。有的人相对乐观：</p>
<blockquote>
<p>我对技能退化并没那么担心。AI 仍然会迫使我认真思考问题，也帮助我学习新的解法。在某些领域，能够更快地探索和测试想法，反而加速了我的学习。</p>
</blockquote>
<p>也有人更务实：</p>
<blockquote>
<p>作为一名软件工程师，我的技能肯定是在退化的……但如果哪天真的需要，我相信这些技能还是能练回来，而且现在我也确实不再那么需要它们了！</p>
</blockquote>
<p>还有人提到，自己失去的更多是画图之类的次要技能，“真正关键的那部分代码，我仍然能写得很好”。</p>
<p>也许最有意思的是，有工程师直接质疑了“会不会变生锈”这一前提：</p>
<blockquote>
<p>把这件事叫做“变生锈”，是假定有一天世界会回到 Claude 3.5 之前的那个样子。我并不认为那样的日子会再回来。</p>
</blockquote>
<h4 data-id="heading-14">软件工程的“手艺感”和意义</h4>
<p>工程师们在“是否怀念亲手写代码”这一点上出现了明显分歧。有的人有真切的失落感——“对我来说，这真的是一个时代的结束。我写代码写了 25 年，对自己在这方面的熟练掌握，一直是我职业满足感的重要来源。”也有人担心，自己可能并不会喜欢未来这种新的工作形态：“整天在那儿给 Claude 写提示词，其实并没有那么有趣或有成就感。相比之下，戴上耳机放点音乐，自己进入心流状态、从头到尾实现一个东西，要好玩得多。”</p>
<p>也有人正面承认了这种取舍并表示接受：“写代码这件事，确实有一些部分是我会怀念的——比如在重构时进入那种‘禅意流’的状态。但总的来说，我现在的生产力提升太大了，为了这个结果，我愿意把那种体验放下。”</p>
<p>还有人觉得和 Claude 一起迭代反而更好玩，因为“我可以比对人更挑剔”，不用顾及对方的情绪。也有人更在意结果而不是过程。有一位工程师说：</p>
<blockquote>
<p>我原本以为，到这个阶段我会感到害怕或无聊……但事实上，我并没有这些感觉。相反，我很兴奋，因为我现在能做的事情多太多了。我曾以为自己喜欢的是写代码这件事本身，但现在我发现，我真正喜欢的，是写完代码之后能得到的那些东西。</p>
</blockquote>
<p>从整体来看，人们是否拥抱 AI，还是更怀念“亲手写代码”的时代，很大程度上取决于他们觉得软件工程这份工作中，哪一部分对自己最有意义。</p>
<h3 data-id="heading-15">工作场所的社交动态在改变</h3>
<p>访谈中一个很突出的话题，是 Claude 已经取代了很多过去会直接问同事的问题，成为第一咨询对象。“我现在问问题的频率比以前高多了，但差不多 80–90% 的问题我都是先问 Claude。”有员工这样总结。这在一定程度上起到了“信息过滤器”的作用——Claude 会先处理那些日常、重复的问题，而同事们则更多被用来讨论复杂的、战略性的，或高度依赖组织上下文的问题（“它让我的团队对我来说‘不那么必要’了 80%，但剩下那 20% 非常关键，我仍然会去找他们。”）。人们也会把 Claude 当成“头脑风暴搭档”，像和人一样用它来对撞想法。</p>
<p>大约有一半的受访者表示，团队的合作模式并没有发生太大变化。有一位工程师说，他仍然会和同事开会、共享上下文、一起做方向选择，他认为在可见的未来，依然会有大量的人与人协作，“只不过，平时专注做事的那段时间里，你会更多地在和各种 Claude 对话”。</p>
<p>但也有人切实感受到，和同事的互动变少了（“我现在和 Claude 的互动远比和任何一个同事都多。”）。有些人对这种变化感到满意，因为这样可以减少社交摩擦（“我不再需要担心打扰同事占用他们的时间。”）。但也有人不太喜欢这个趋势（“我其实不太喜欢大家动不动就说‘你问问 Claude’，我真的很享受和人面对面一起工作的感觉，也非常看重这种体验。”），或者怀念过去的工作方式：“我很喜欢和人一起工作，现在有点难过的是，我似乎‘不再那么需要他们’了。”不少人也指出，这对传统的“师徒式指导关系”有明显影响——因为许多过去会由高级工程师承担的指导，现在可以由 Claude 提供。“Claude 可以给初级同事提供很多指导和教练式帮助。”一位高级工程师说：</p>
<blockquote>
<p>让我有点难过的是，初级同事不再像以前那样经常来问我问题了，虽然实话实说，他们现在确实更快地得到答案，也学得更快。</p>
</blockquote>
<h3 data-id="heading-16">职业不确定性与适应</h3>
<p>许多工程师觉得自己的角色，正在从“写代码的人”变成“管理 AI 的人”。越来越多人把自己看作是“AI 代理的管理者”——有人表示，自己几乎总是同时开着好几个 Claude 实例。有人估计，自己的工作内容中，已经有“70% 以上是做代码评审/修改，而不是从零写新代码”；也有人认为，将来“对 1 个、5 个甚至 100 个 Claude 的工作负责”，会成为自己角色的一部分。</p>
<p>从长期来看，职业上的不确定性非常普遍。工程师们普遍认为，这些变化是整个行业更大转型的前兆，很多人都说“很难判断”几年之后，自己的职业会变成什么样。有些人对短期和长期的态度是矛盾的——“短期我很乐观，但长期我觉得 AI 最终会把所有事情都做掉，让我和很多人变得不再重要。”还有人说得更直接：“有时候感觉，每天上班都像是在把自己一步步‘做没’。”</p>
<p>也有工程师更为乐观。有一位说：“我确实替初级开发者有点担心，但也知道他们往往是对新技术最有热情的那群人。整体来说，我对这个职业的未来还是非常乐观的。”他认为，尽管确实存在那些经验不足的人用 AI 写出问题代码的风险，但随着 AI 安全措施的完善、教育资源的不断嵌入，以及人们在实践中从错误中学习，这个行业会逐渐适应并找到新的平衡。</p>
<p>当我们问工程师们如何设想自己的未来角色，以及是否有应对策略时，有人提到，会进一步向某些方向深度专精（“真正具备对 AI 工作做有意义 review 的能力，会需要更长时间的积累和更高程度的专门化”）；有人预计未来会更多投入到“人与人”的工作和战略性事务上（“我们会把更多时间花在达成共识上，让 AI 花更多时间在具体实现上”）。也有人已经开始有意识地用 Claude 做职业发展——向它寻求关于工作方法、领导力等方面的反馈：“我能学习和发挥的速度完全变了感觉，就像头顶的天花板一下子碎掉了。”</p>
<p>总体来看，很多人都坦言，自己对“未来哪些技能会有用”几乎没有什么把握。一位团队负责人总结说：“其实没人真正知道会发生什么……真正重要的是你是否足够有适应能力。”</p>
<h2 data-id="heading-17">Claude Code 使用趋势</h2>
<p>问卷和访谈数据显示，越来越多的 Claude 使用，正在帮助人们更快推进工作、承担更多以前不会做的任务，但同时也带来了围绕“任务委托”和“技能发展”的各种紧张和矛盾。当然，自报数据只讲了故事的一部分。为了补全这一点，我们还分析了 Anthropic 团队内部真实的 Claude Code 使用记录。因为受访者表示，他们的大部分 Claude 使用都是在 Claude Code 中完成的，我们利用一个隐私保护的分析工具，对 2025 年 2 月和 8 月的 20 万条内部 Claude Code 对话记录进行了分析。</p>
<h3 data-id="heading-18">在更少监督下解决更难的问题</h3>
<p>在过去六个月中，Claude Code 的使用正在向更困难、更自主的编码任务迁移（见图 3）：</p>
<ul>
<li><strong>员工正在用 Claude Code 解决越来越复杂的任务。</strong> 我们为每条记录估计了一个 1–5 的任务复杂度评分，其中 1 代表“非常基础的编辑”，5 代表“需要人类专家投入数周或数月的工作”。平均而言，任务复杂度从 3.2 提升到了 3.8。为了更直观地感受差异，3.2 左右的任务通常是“排查 Python 模块导入错误”之类，而 3.8 左右的任务则会是“实现并优化缓存系统”。</li>
<li><strong>Claude Code 在单次任务中连续调用工具的最大次数增加了 116%。</strong> 这里的“工具调用”指的是 Claude 使用外部工具做出的动作，例如修改文件或运行命令。现在，Claude 在无需人类干预的情况下，可以连续串联平均 21.2 次工具调用，而六个月前这个数字只有 9.8。</li>
<li><strong>每条对话中人类发言轮次减少了 33%。</strong> 平均人类发言轮次从 6.2 降到 4.1，这说明现在完成同样复杂的任务，所需的人类输入比六个月前更少了。</li>
</ul>
<p><img src="https://static.didispace.com/images4/b1829369ae5f4d5bbd42ad222232cca7.webp" alt="d23e1b8d8af84b45d5cffcc6f0a029d635508153-3840x2160.webp" loading="lazy"/>
<em>图 3：2025 年 2 月与 8 月之间 Claude Code 使用情况的变化。左图为平均任务复杂度，中图为每条记录中连续工具调用的最大次数，右图为人类发言轮次。误差条为 95% 置信区间，整体上看，人们正在把更多自主性委托给 Claude。</em></p>
<p>这些使用数据与问卷的定性结论相互印证：工程师正在持续把更复杂的工作交给 Claude，且 Claude 所需的人类监督也在减少。这很可能是我们观察到的生产力提升背后的重要驱动力之一。</p>
<h3 data-id="heading-19">任务分布</h3>
<p>我们把 Claude Code 的记录按任务类型进行了分类，并对比了过去六个月中，不同任务类型在整体使用中的占比变化：</p>
<p><img src="https://static.didispace.com/images4/c71c561d046f8cf788d26f9bb491d818.webp" alt="7da627df8a6be4cb90ecd6e6e41345b8122401ed-3840x2160.webp" loading="lazy"/>
<em>图 4：不同编码任务（纵轴）在所有记录中所占比例（横轴）。粉色为 6 个月前的分布，紫色为当前分布，按 2025 年 2 月的频率排序。</em></p>
<p>整体任务频率分布与自报数据大致一致。最显著的变化，是现在用于实现新功能的记录占比明显提高（从 14.3% 到 36.9%），用于代码设计或规划的占比也有明显提升（从 1.0% 到 9.9%）。这种相对分布的变化，可能说明 Claude 在这些更复杂任务上的表现变好了；当然，也可能仅仅反映了团队在不同工作流中采用 Claude Code 的方式发生了变化，而不一定意味着绝对工作量的增加（更多限制与说明见附录）。</p>
<h4 data-id="heading-20">修补“纸割伤”</h4>
<p>我们从问卷中了解到，工程师现在花更多时间做那些“改善日常体验的小修小补”；与此相呼应的是，大约 8.6% 的 Claude Code 任务被归类为“papercut 修复”。这些任务既包括构建性能可视化工具、为可维护性而做的大规模重构等较大工作，也包括创建终端快捷方式这样的小改动。这些工作可能一方面提升了自报的生产力（长期来看，修复那些一直积累的“小摩擦点”会让整体效率提高），另一方面也减少了日常工作的挫败感和阻力。</p>
<h4 data-id="heading-21">不同团队的任务差异</h4>
<p>为了研究不同团队之间任务类型的差异，我们进一步细化了任务分类方法，为 8 月的每条记录分配了一个主要任务类型，并按内部团队进行拆分。下图中的堆叠柱状条展示了各团队中不同任务类型的比例：</p>
<p><img src="https://static.didispace.com/images4/0fc1364e9f2b8f31f7207197b682e55a.webp" alt="313f1cc36b0eb1fec9ee986f50e8d937ddc796ba-3840x2160.webp" loading="lazy"/></p>
<p><em>图 5：每一条横向柱代表一个团队（纵轴），不同颜色的片段代表该团队中 Claude Code 使用在不同任务类型上的占比（横轴）。顶部的“All Teams”条代表整体分布。</em></p>
<p>“All Teams” 这一条给出了整体的分布基线，其中最常见的任务是新功能构建、调试和代码理解，在此基础上，其他团队的分布可以对照比较。</p>
<p>一些值得注意的团队特征包括：</p>
<ol>
<li><strong>预训练（Pre-training）团队</strong>（负责训练 Claude）非常频繁地用 Claude Code 来构建新功能（占比 54.6%），其中很多是用来跑额外实验。</li>
<li><strong>Alignment &amp; Safety</strong> 团队和 <strong>后训练（Post-training）</strong> 团队在前端开发上的使用占比最高（分别为 7.5% 和 7.4%），通常是为了构建数据可视化界面。</li>
<li><strong>安全（Security）</strong> 团队经常使用 Claude Code 来做代码理解（占比 48.9%），尤其是用于分析和理解代码库中不同部分的安全影响。</li>
<li><strong>非技术背景员工</strong> 通常用 Claude Code 做调试（占比 51.5%），例如排查网络问题或 Git 操作问题，同时也会用于数据科学任务（占比 12.7%）；Claude 在这里起到了帮助他们跨越技术门槛的作用。</li>
</ol>
<p>这些团队特定的模式，和我们在问卷和访谈中看到的“能力扩展”现象相呼应：许多团队正在利用 Claude 来完成那些原本没有时间或能力去做的工作。例如，预训练团队可以跑更多实验，非技术员工能够自己修复代码错误。而从数据看，团队确实会用 Claude 做各自的核心任务（例如基础设施团队最常用 Claude Code 做基础设施和 DevOps 相关工作），但 Claude 同时也在拓展他们的核心任务边界（例如研究人员通过 Claude 来做前端开发，以便更好地可视化自己的数据）。整体来看，Claude 正在帮助每一个人变得更加“全栈”。</p>
<h2 data-id="heading-22">展望未来</h2>
<p>过去一年里，Anthropic 员工对 Claude 的使用大幅增加，他们不仅用它来加速原本就会做的工作，还用它来熟悉新的代码库、减少重复劳动、拓展自己的技能边界，并处理那些长期被忽视的改进事项。随着 Claude 变得更加自主和强大，工程师们也在不断摸索新的任务委托方式，同时思考，在这种环境下未来需要什么样的技能。这些变化带来了非常实在的生产力和学习收益，但也伴随着对软件工程长期走向的真切忧虑：这次的变化，会像过去从低级语言到高级语言的过渡那样，仅仅是一个新的抽象层？还是会走得更远，把我们对“工程师”的定义也重新写一遍？</p>
<p>眼下仍然是这场转型的早期阶段——Anthropic 内部拥有大量早期采用者，外部环境变化也极其迅速，我们的发现未必能直接推广到其他组织或场景（更多局限见附录）。这些研究结果某种程度上也反映了这种不确定性：结论往往是多面的，并没有一个统一的“正确答案”或明确的行动指令。但它确实提出了一个问题：我们要如何在这样的变革中，更加审慎而有效地前行？</p>
<p>作为这项工作的后续，我们正在做几件事：与 Anthropic 的工程师、研究人员和管理层持续对话，讨论如何回应这次转型带来的机会与挑战；重新审视我们如何让团队之间更好地协作与共享上下文，如何支持员工的职业发展，以及如何建立适合 AI 协作时代的工作实践指南（例如借助我们提出的 AI 素养框架）。我们也准备将视角扩展到工程师以外的角色，去理解 AI 转型在整个组织范围内的影响，并支持像 CodePath 这样的外部机构，在 AI 辅助已成常态的未来，重新设计计算机科学教育。向前看，我们也在思考，在 AI 能力持续提升的背景下，可能需要怎样的组织结构变革——比如为角色演化和再培训设计新的路径。</p>
<p>我们预计会在 2026 年分享更具体的计划。Anthropic 希望在“负责任的职场转型”上，既是研究对象，也是实践场——我们不仅想研究 AI 如何改变工作，更希望从自身出发，探索如何更好地面对这场变化。</p>
<blockquote>
<p>原文：How AI Is Transforming Work at Anthropic
作者：Saffron Huang, Bryan Seethor, Esin Durmus, Kunal Handa, Miles McCain, Michael Stern, Deep Ganguli
原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fanthropic.com%2Fresearch%2Fhow-ai-is-transforming-work-at-anthropic%2F" target="_blank" title="https://anthropic.com/research/how-ai-is-transforming-work-at-anthropic/" ref="nofollow noopener noreferrer">anthropic.com/research/ho…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从Web网站回退到从命令行：用领域驱动设计构建软件最关键的业务内核]]></title>    <link>https://juejin.cn/post/7585024562216534056</link>    <guid>https://juejin.cn/post/7585024562216534056</guid>    <pubDate>2025-12-18T13:17:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585024562216534056" data-draft-id="7585027616736198708" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从Web网站回退到从命令行：用领域驱动设计构建软件最关键的业务内核"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-18T13:17:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自由生长2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从Web网站回退到从命令行：用领域驱动设计构建软件最关键的业务内核
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自由生长2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:17:28.000Z" title="Thu Dec 18 2025 13:17:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：本文分享一个后端工程师的实践：通过领域驱动设计（DDD）先抽象出 Chatbot 的核心领域模型，剥离 Flask、前端 JS 及移动平台 API 等“壳子”，实现业务内核与技术实现解耦，为跨平台迁移奠定坚实基础。</p>
<hr/>
<h2 data-id="heading-0">从Web网站回退到从命令行：用领域驱动设计构建软件最关键的业务内核</h2>
<blockquote>
<p><strong>背景</strong>：开发自用智能多模型对比的Chatbot，受挫并且收到启发。</p>
</blockquote>
<h3 data-id="heading-1">起初：被“完整工程”拖垮的尝试</h3>
<p>我最早想做一个能记住我说过的话、回答问题、帮我整理知识的 Chatbot。<br/>
作为后端开发者，我习惯性地搭了一个“标准项目”：</p>
<ul>
<li>后端用 <strong>Python Flask</strong></li>
<li>前端用 <strong>原生 JavaScript</strong>（没用任何框架）</li>
<li>甚至在前端自己实现了简单的 <strong>MVC</strong>：Model 管消息数据，View 渲染对话，Controller 处理输入</li>
</ul>
<p>结果呢？<br/>
我花了大量时间处理 Flask 路由、JSON 序列化、DOM 更新、前后端联调……而<strong>真正关心的业务逻辑——对话理解、记忆存储、意图识别——几乎没动</strong>。</p>
<p>更糟的是，代码越写越重，改一点就怕崩，进度严重受阻。</p>
<h3 data-id="heading-2">转折：回到命令行，只写核心</h3>
<p>我果断停掉 Web 部分，新建一个 <code>core.py</code>，写下类似于以下的最朴素的类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatSession</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.memory = []

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_message</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-string">"记住"</span> <span class="hljs-keyword">in</span> text:
            self.memory.append(text)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"已记住！"</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"回忆"</span> <span class="hljs-keyword">in</span> text:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"你让我记了："</span> + <span class="hljs-string">"; "</span>.join(self.memory)
        <span class="hljs-keyword">return</span> <span class="hljs-string">"我不太明白……"</span>
</code></pre>
<p>再加个 <code>while True</code> 循环，在终端里直接交互。<br/>
<strong>几小时就跑通了核心功能</strong>。</p>
<blockquote>
<p>如果你感兴趣，你可以看我的开源项目 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnotfresh%2Fmultisource-chatbot%2F" target="_blank" title="https://github.com/notfresh/multisource-chatbot/" ref="nofollow noopener noreferrer">notfresh/multisource-chatbot: 自己做的chatbot，使用302.ai支持的后台服务，可以同时调用deepSeek和千问</a></p>
</blockquote>
<p>那一刻我意识到：</p>
<blockquote>
<p><strong>Flask、JS、MVC，都是壳子；真正的智能，藏在这些类和方法里。</strong></p>
</blockquote>
<p>这正是 <strong>领域驱动设计（DDD）的核心思想</strong>：<br/>
<strong>先聚焦领域模型（ChatSession、Memory、Intent），剥离技术实现细节（HTTP、DOM、框架）</strong>。</p>
<h3 data-id="heading-3">延伸：从 Android 到 iOS 的迁移启示</h3>
<p>后来，我又想到：我之前用 AI 辅助做过几个 <strong>Android 版工具 App</strong>，现在想迁移到 <strong>iOS</strong>。<br/>
如果直接让 AI “翻译” Kotlin 到 Swift，几乎注定失败——因为平台架构、API 设计差异太大。</p>
<p>但有了 Chatbot 的经验，我换了个思路：</p>
<h4 data-id="heading-4">第一步：提取与平台无关的核心实体</h4>
<p>问自己：这个 App 到底在做什么？<br/>
比如一个笔记工具，核心是：</p>
<ul>
<li><code>Note</code>（标题、内容、标签）</li>
<li><code>NoteRepository</code>（保存、查询）</li>
<li><code>SyncService</code>（云端同步）</li>
</ul>
<p>这些用伪代码或 Python 写出来，<strong>不依赖任何移动 SDK</strong>。</p>
<h4 data-id="heading-5">第二步：明确核心业务流程</h4>
<ul>
<li>创建笔记 → 本地存储 → 触发同步</li>
<li>搜索关键词 → 返回匹配结果</li>
</ul>
<p>这些流程在 Android 和 iOS 上应该一致。</p>
<h4 data-id="heading-6">第三步：分层隔离，核心独立</h4>
<p>把上述模型组织成 <strong>纯领域层</strong>，它不关心：</p>
<ul>
<li>是用 Activity 还是 ViewController</li>
<li>是用 Room 还是 Core Data</li>
<li>是用 Retrofit 还是 URLSession</li>
</ul>
<p>它只关心：<strong>数据怎么变，规则是什么</strong>。</p>
<h4 data-id="heading-7">第四步：为每个平台编写适配器</h4>
<p>在 iOS 侧，再分别实现：</p>
<ul>
<li>用 SwiftUI 构建 UI（View 层）</li>
<li>用 Core Data 实现 <code>NoteRepository</code></li>
<li>用 URLSession 实现网络同步</li>
</ul>
<p><strong>平台 API 只是外壳，是可以替换的实现细节</strong>。</p>
<h3 data-id="heading-8">总结：内核稳定，壳子可换</h3>
<p>无论是做 Web、命令行，还是跨 Android/iOS，我都验证了一件事：</p>
<blockquote>
<p><strong>软件的可演进性和可迁移性，取决于你是否先把领域核心抽象清楚。</strong></p>
</blockquote>
<ul>
<li>Flask 是壳子</li>
<li>原生 JS 是壳子</li>
<li>Android SDK 是壳子</li>
<li>iOS UIKit 是壳子</li>
</ul>
<p><strong>只有那些表达业务本质的实体、聚合、服务，才是不可替代的内核</strong>。</p>
<p>现在，我的 Chatbot 依然运行在 shell 里，每天帮我记事、问答。<br/>
未来如果需要 Web 或移动端，我只需套一层适配器——<strong>内核不动，天下不乱</strong>。</p>
<p>对个人开发者而言，<strong>先让领域跑起来，比先让界面跑起来更重要</strong>。<br/>
而 DDD，就是帮你守住那个“核心”的思维罗盘。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Agent】MemOS 源码笔记---(6)---MemScheduler -- 总体]]></title>    <link>https://juejin.cn/post/7585021315692101642</link>    <guid>https://juejin.cn/post/7585021315692101642</guid>    <pubDate>2025-12-18T13:29:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585021315692101642" data-draft-id="7582955784569798707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Agent】MemOS 源码笔记---(6)---MemScheduler -- 总体"/> <meta itemprop="keywords" content="算法,机器学习"/> <meta itemprop="datePublished" content="2025-12-18T13:29:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Agent】MemOS 源码笔记---(6)---MemScheduler -- 总体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:29:08.000Z" title="Thu Dec 18 2025 13:29:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【Agent】MemOS 源码笔记---(6)---MemScheduler -- 总体</h2>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">【Agent】MemOS 源码笔记---(6)---MemScheduler -- 总体</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 摘要</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 能力介绍</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 需求</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 如何调度</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 MemScheduler 功能</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.4 执行示例</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.4.1 代码功能概述</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.4.2 案例：家庭助理场景中的记忆调度</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 MemScheduler 基本概念</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 核心组件</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 主要特点</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3 BaseScheduler</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3.1 图例</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3.2 定义</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.4 消息处理</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.4.1 消息类型</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.4.2 调度消息结构 </a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.5 函数实现</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
<h3 data-id="heading-1">0x00 摘要</h3>
<p>记忆调度就像大脑的注意力机制，动态决定在合适的时刻调用合适的记忆。</p>
<p>在 MemOS 中，<strong>记忆调度（Memory Scheduling）</strong> 通过对【不同使用效率（参数&gt;激活&gt;工作&gt;其他明文）的记忆】的相互调度，让模型能更高效、准确地获取用户所需的记忆。在对话和任务进行时，通过预测用户后续对话所需记忆并提前调入高效率记忆类型如激活记忆工作记忆，加速推理链路。</p>
<p>记忆调度的具体实现就是MemScheduler ，这是一个与 MemOS 系统并行运行的并发记忆管理系统，它协调 AI 系统中工作记忆、长时记忆和激活记忆之间的记忆操作。它通过事件驱动调度处理记忆检索、更新和压缩。该系统特别适合需要动态记忆管理的对话代理和推理系统。</p>
<p>备注：本文基于MemOS的文档和源码进行学习和解读，似乎其文档并没有跟上源码更新的速度，而且也有部分功能未实现或者未开源。</p>
<p>因为 MemScheduler 内容过多，因此分为两篇。</p>
<h3 data-id="heading-2">0x01 能力介绍</h3>
<p>MemOS（Memory Operating System）是面向 Agent 的记忆操作系统，而 MemScheduler 是其中的 “调度器”，类比操作系统的 CPU 调度器，核心负责<strong>所有记忆操作的统筹、调度、优先级管理和资源分配</strong>。可以说，MemOS提供了基础的记忆管理框架，而MemScheduler则在此基础上增加了动态调度和自动化管理的能力，使得整个记忆系统更加智能化和高效。</p>
<h4 data-id="heading-3">1.1 需求</h4>
<p>我们首先看看为什么需要调度。</p>
<p>在复杂的交互里，如果每次过来只靠简单的全局搜索，系统可能会：</p>
<ul>
<li><strong>太慢</strong>：等到用户问完再临时搜索，首 Token 延迟高。</li>
<li><strong>不准</strong>：太多历史，反而淹没了关键信息，难以检索。</li>
</ul>
<p>调度的作用就是让系统具备“即时准备、快速响应”的能力：</p>
<ul>
<li><strong>预加载</strong>：在对话一开始，就加载用户的常用背景。</li>
<li><strong>预测调用</strong>：在用户还没输入完时，提前准备可能要用的记忆。</li>
</ul>
<h4 data-id="heading-4">1.2 如何调度</h4>
<p>可以结合任务语义、上下文、访问频率、生命周期等信息，动态安排记忆的调用与存储。</p>

























<table><thead><tr><th>维度</th><th>说明</th></tr></thead><tbody><tr><td>调什么？</td><td>参数记忆（长期知识与技能） 激活记忆（运行时的 KV 缓存与隐层状态） 明文记忆（外部可编辑的事实、用户偏好、检索片段） 支持<code>明文 ⇆ 激活 ⇆ 参数</code>的动态迁移，高频使用的明文片段可以提前编译成 KV 缓存；长期稳定的模板可以沉淀到参数中。</td></tr><tr><td>什么时候调？</td><td>上下文和高效记忆不足以支撑回答用户提问时进行记忆结构的优化 根据用户的意图和需求，对用户可能需要的记忆内容进行提前的准备 在连续提问过程中，调度记忆保持对话场景的高效准确</td></tr><tr><td>调给谁？</td><td>当前用户、特定角色代理（Agent）、或跨任务的共享上下文</td></tr><tr><td>调成什么样？</td><td>记忆会被打上热度、时效性、重要性等指标。调度器据此决定先加载谁、谁放冷存、谁需要归档。</td></tr></tbody></table>
<p>使用 MemOS 云服务时，调度的作用可以从 <code>searchMemory</code> API 的表现中观测到：</p>
<ul>
<li>它能快速返回相关记忆，避免上下文断裂。</li>
<li>返回的内容已经过调度器优化，确保结果既相关又不会过载模型输入。</li>
</ul>
<h4 data-id="heading-5">1.3 MemScheduler 功能</h4>
<p>核心职责如下。</p>
<ul>
<li>
<p>记忆单元编排管理</p>
<ul>
<li>管理多个 MemCube 实例（即记忆容器）</li>
<li>作为操作系统层级来处理和协调这些记忆单元</li>
<li>提供创建、搜索、更新和删除记忆单元的方法</li>
</ul>
</li>
<li>
<p>任务调度与自动化</p>
<ul>
<li>
<p>通过预定的操作实现自动化的内存管理任务</p>
</li>
<li>
<p>处理各种内存操作，包括：</p>
<ul>
<li>添加新记忆（ADD_LABEL）</li>
<li>回答查询（ANSWER_LABEL）</li>
<li>处理查询（QUERY_LABEL）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>多用户支持</p>
<ul>
<li>设计用于多用户场景，并采用线程安全操作</li>
<li>验证用户对特定记忆单元的访问权限</li>
<li>为不同用户提供独立的上下文环境</li>
</ul>
</li>
<li>
<p>记忆生命周期管理</p>
<ul>
<li>协调信息在不同组件之间的流动</li>
<li>管理何时以及如何处理、存储和检索记忆</li>
<li>与其他 MemOS 组件（如 MemReader 和大语言模型）集成</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">1.4 执行示例</h4>
<p><code>examples/mem_scheduler/schedule_w_memos.py</code> 是一个演示脚本，展示如何使用 <code>MemScheduler</code> 模块。它说明了对话上下文中的记忆管理和检索。</p>
<h5 data-id="heading-7">1.4.1 代码功能概述</h5>
<p>此脚本演示了初始化和使用记忆调度器的两种方法：</p>
<ol start="0">
<li><strong>自动初始化</strong>: 通过配置文件配置调度器</li>
<li><strong>手动初始化</strong>: 显式创建和配置调度器组件</li>
</ol>
<p>该脚本模拟用户和助手之间关于宠物的对话，演示记忆调度器如何管理对话历史并检索相关信息。</p>
<h5 data-id="heading-8">1.4.2 案例：家庭助理场景中的记忆调度</h5>
<p><strong>前段时间：用户忙着买房</strong></p>
<p>用户经常说：</p>
<ul>
<li>“帮我查一下 XX 小区的二手房均价。”</li>
<li>“提醒我周六去看房。”</li>
<li>“记录一下房贷利率的最新变化。”</li>
</ul>
<p>MemOS系统操作</p>
<ul>
<li>系统最初将这些条目都生成 <strong>明文记忆</strong>。</li>
<li>因为“买房”相关信息被频繁提及，调度器在后台判断它是近期的<strong>核心主题</strong>，于是将这些明文迁移为 <strong>激活记忆</strong>，让后续查询更快更直接。</li>
</ul>
<p><strong>最近：用户房子买好了开始装修</strong></p>
<p>用户开始频繁提到：</p>
<ul>
<li>“周末要去看瓷砖。”</li>
<li>“提醒我和装修公司确认水电改造。”</li>
<li>“记一下下周家具送货时间。”</li>
</ul>
<p>MemOS系统操作</p>
<ul>
<li>系统继续生成新的 <strong>明文记忆</strong>。</li>
<li>调度器检测到“装修”已经成为新的高频主题，于是把这些条目迁移为 <strong>激活记忆</strong>。</li>
<li>同时，之前“买房”相关激活记忆不再被频繁使用，会被自动<strong>降级回明文层</strong>，以减少活跃占用。</li>
</ul>
<p><strong>当前时刻：用户随口说——我感觉好多事堆在一起，你帮我理一下</strong></p>
<p>如果没有调度，系统只能全库检索，把所有可能相关的记忆拉出来：</p>
<ul>
<li>看瓷砖（装修）</li>
<li>确认水电改造（装修）</li>
<li>家具送货（装修）</li>
<li>查房价（买房时期，过时）</li>
<li>看房（买房时期，过时）</li>
<li>买菜（生活琐事）</li>
<li>看电影（生活琐事）</li>
</ul>
<p>有调度时，系统可以更快速返回</p>
<ul>
<li>
<p>看瓷砖</p>
</li>
<li>
<p>确认水电改造</p>
</li>
<li>
<p>家具送货</p>
<p>👉 <strong>用户体感 UP</strong></p>
</li>
<li>
<p>响应更快（因为不需要全库检索）。</p>
</li>
<li>
<p>列出的就是自己最挂念的事 → 感觉助理“很懂我”</p>
</li>
</ul>
<p>然而，实际上，只能找到这个例子：MemOS-main\examples\mem_scheduler\memos_w_scheduler.py。</p>
<p>有兴趣的读者可以自行研究。</p>
<h3 data-id="heading-9">0x02 MemScheduler 基本概念</h3>
<p>MemScheduler 实际上扮演着 MemOS 系统的“进程管理器”角色，确保按照系统的策略和用户需求正确地协调、调度和执行内存操作。</p>
<h4 data-id="heading-10">2.1 核心组件</h4>
<p><code>MemScheduler</code> 系统围绕几个关键组件构建：</p>
<ul>
<li>消息处理: 通过带有标记processor的调度器处理传入消息</li>
<li>记忆管理: 管理不同的记忆类型 (工作、长时、用户)</li>
<li>检索系统: 基于上下文高效检索相关记忆项</li>
<li>监控: 跟踪记忆使用、频率和触发更新</li>
<li>调度器 (路由器): 通过检查来自 MemOS 系统的消息触发不同的记忆重分配策略。</li>
<li>日志记录: 维护记忆操作日志用于调试和分析</li>
</ul>
<h4 data-id="heading-11">2.2 主要特点</h4>
<ul>
<li>
<p>模块化架构</p>
<ul>
<li>采用插件式架构，可通过配置进行定制</li>
<li>通过工厂模式支持不同的实现方式</li>
<li>允许自定义调度行为</li>
</ul>
</li>
<li>
<p>任务调度</p>
<ul>
<li>自动处理记忆的添加、查询、更新等操作</li>
<li>支持定时任务和事件驱动的任务</li>
</ul>
</li>
<li>
<p>与 MOS 核心集成</p>
<ul>
<li>与主 MOS 功能协同工作</li>
<li>可通过配置启用/禁用</li>
<li>处理消息并协调内存操作</li>
</ul>
</li>
<li>
<p>后台处理</p>
<ul>
<li>在后台运行计划任务</li>
<li>支持启动和停止调度服务</li>
<li>管理内存操作的资源分配</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">2.3 BaseScheduler</h4>
<ul>
<li>该类是 MemOS 的核心调度器基类，整合了消息队列、内存管理、任务分发、监控等功能，用于统筹内存立方体（MemCube）的调度逻辑。</li>
<li>核心能力包括工作内存替换、激活内存周期性更新、消息提交与消费、多线程并行任务分发，同时支持 RabbitMQ 消息队列和 Redis 存储集成。</li>
<li>支持动态上下文切换，通过配置灵活启用 / 禁用激活内存、并行分发等功能，适配不同场景需求。</li>
<li>特色是模块化设计（集成检索器、监控器、分发器等子模块），线程安全的上下文管理，优雅的启动 / 停止机制，以及完善的异常处理和资源清理，确保系统稳定运行。</li>
</ul>
<h5 data-id="heading-13">2.3.1 图例</h5>
<p>具体架构如下。</p>
<pre><code class="hljs language-lua" lang="lua">+================================================+
|               BaseScheduler                    |
|  (整合消息队列、内存管理、任务分发的核心调度器)       |
+================================================+
| 初始化流程:                                      |
|  +<span class="hljs-comment">------------------------+                    |</span>
|  | 接收配置参数             |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 设置超参数 (top_k/窗口大小等) |                 |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 初始化内部消息队列        |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 延迟初始化子模块          |                     |
|  | (检索器/监控器/分发器)    |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
+=================================================+
| 子模块初始化流程:                                  |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 绑定LLM实例              |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 初始化监控器(通用/分发)    |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 初始化检索器             |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 加载认证配置             |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 初始化RabbitMQ连接       |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
+=================================================+
| 消息处理流程:                                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 提交消息到队列            |                     |
|  | (支持单条/多条消息)       |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 消费线程循环检测队列       |                     |
|  | (按间隔批量取消息)        |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 分发器调度任务执行        |                     |
|  | (并行/串行模式可选)       |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
+=================================================+
| 工作内存替换流程:                                  |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 获取用户查询历史          |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 重新排序内存(LLM参与)     |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 过滤不相关内存            |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 更新内存监控器           |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 替换文本内存中的工作集     |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
+=================================================+
| 激活内存更新流程:                                  |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 检查更新间隔是否到达       |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 从监控器获取新内存        |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 组装文本并提取KV缓存      |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 清除旧缓存并添加新缓存     |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 持久化缓存到磁盘          |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
+=================================================+
| 启动/停止流程:                                    |
| 启动:                                            |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 初始化分发器线程池        |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 启动消息消费线程          |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
| 停止:                                            |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 标记运行状态为停止        |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 等待消费线程退出          |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 关闭分发器/监控器         |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
|  | 清空所有消息队列          |                     |
|  +<span class="hljs-comment">------------------------+                     |</span>
+=================================================+
</code></pre>
<h5 data-id="heading-14">2.3.2 定义</h5>
<p>代码如下。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseScheduler</span>(RabbitMQSchedulerModule, RedisSchedulerModule, SchedulerLoggerModule):
    <span class="hljs-string">"""所有内存调度器的基类，整合消息队列、内存管理和任务分发功能"""</span>
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: BaseSchedulerConfig</span>):
        <span class="hljs-string">"""使用给定配置初始化调度器"""</span>
        <span class="hljs-built_in">super</span>().__init__()
        self.config = config  <span class="hljs-comment"># 存储调度器配置</span>
​
        <span class="hljs-comment"># 超参数配置（从配置中读取，无则使用默认值）</span>
        self.top_k = self.config.get(<span class="hljs-string">"top_k"</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># 检索时返回的Top-K结果数</span>
        self.context_window_size = self.config.get(<span class="hljs-string">"context_window_size"</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 上下文窗口大小</span>
        self.enable_activation_memory = self.config.get(<span class="hljs-string">"enable_activation_memory"</span>, <span class="hljs-literal">False</span>)  <span class="hljs-comment"># 是否启用激活内存</span>
        self.act_mem_dump_path = self.config.get(<span class="hljs-string">"act_mem_dump_path"</span>, DEFAULT_ACT_MEM_DUMP_PATH)  <span class="hljs-comment"># 激活内存存储路径</span>
        self.search_method = TreeTextMemory_SEARCH_METHOD  <span class="hljs-comment"># 文本内存搜索方法</span>
        self.enable_parallel_dispatch = self.config.get(<span class="hljs-string">"enable_parallel_dispatch"</span>, <span class="hljs-literal">False</span>)  <span class="hljs-comment"># 是否启用并行分发</span>
        self.thread_pool_max_workers = self.config.get(
            <span class="hljs-string">"thread_pool_max_workers"</span>, DEFAULT_THREAD__POOL_MAX_WORKERS
        )  <span class="hljs-comment"># 线程池最大工作线程数</span>
​
        <span class="hljs-comment"># 子模块初始化（延迟初始化，通过initialize_modules方法完成）</span>
        self.retriever: SchedulerRetriever | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 检索器：用于内存检索和排序</span>
        self.db_engine: Engine | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 数据库引擎：用于数据持久化</span>
        self.monitor: SchedulerGeneralMonitor | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 通用监控器：监控调度器运行状态</span>
        self.dispatcher_monitor: SchedulerDispatcherMonitor | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 分发器监控器：监控任务分发</span>
        <span class="hljs-comment"># 任务分发器：管理任务分发，支持并行/串行模式</span>
        self.dispatcher = SchedulerDispatcher(
            max_workers=self.thread_pool_max_workers,
            enable_parallel_dispatch=self.enable_parallel_dispatch,
        )
​
        <span class="hljs-comment"># 内部消息队列配置</span>
        self.max_internal_message_queue_size = self.config.get(
            <span class="hljs-string">"max_internal_message_queue_size"</span>, <span class="hljs-number">100</span>
        )  <span class="hljs-comment"># 内部消息队列最大容量</span>
        self.memos_message_queue: Queue[ScheduleMessageItem] = Queue(
            maxsize=self.max_internal_message_queue_size
        )  <span class="hljs-comment"># 调度消息队列</span>
        self.max_web_log_queue_size = self.config.get(<span class="hljs-string">"max_web_log_queue_size"</span>, <span class="hljs-number">50</span>)  <span class="hljs-comment"># Web日志队列最大容量</span>
        self._web_log_message_queue: Queue[ScheduleLogForWebItem] = Queue(
            maxsize=self.max_web_log_queue_size
        )  <span class="hljs-comment"># Web日志存储队列</span>
        self._consumer_thread = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 消息消费线程引用</span>
        self._running = <span class="hljs-literal">False</span>  <span class="hljs-comment"># 调度器运行状态标识</span>
        self._consume_interval = self.config.get(
            <span class="hljs-string">"consume_interval_seconds"</span>, DEFAULT_CONSUME_INTERVAL_SECONDS
        )  <span class="hljs-comment"># 消息消费间隔（秒）</span>
​
        <span class="hljs-comment"># 其他属性</span>
        self._context_lock = threading.Lock()  <span class="hljs-comment"># 上下文锁：保证线程安全</span>
        self.current_user_id: UserID | <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 当前用户ID</span>
        self.current_mem_cube_id: MemCubeID | <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 当前内存立方体ID</span>
        self.current_mem_cube: GeneralMemCube | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 当前内存立方体实例</span>
        self.auth_config_path: <span class="hljs-built_in">str</span> | Path | <span class="hljs-literal">None</span> = self.config.get(<span class="hljs-string">"auth_config_path"</span>, <span class="hljs-literal">None</span>)  <span class="hljs-comment"># 认证配置文件路径</span>
        self.auth_config = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 认证配置实例</span>
        self.rabbitmq_config = <span class="hljs-literal">None</span>  <span class="hljs-comment"># RabbitMQ配置实例</span>
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">initialize_modules</span>(<span class="hljs-params">
        self,
        chat_llm: BaseLLM,
        process_llm: BaseLLM | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        db_engine: Engine | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    </span>):
        <span class="hljs-string">"""初始化调度器的所有子模块（检索器、监控器、分发器等）"""</span>
        <span class="hljs-comment"># 若未指定处理用LLM，默认使用聊天用LLM</span>
        <span class="hljs-keyword">if</span> process_llm <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            process_llm = chat_llm
​
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 存储LLM实例</span>
            self.chat_llm = chat_llm
            self.process_llm = process_llm
            self.db_engine = db_engine
​
            <span class="hljs-comment"># 初始化通用监控器：监控内存和查询状态</span>
            self.monitor = SchedulerGeneralMonitor(
                process_llm=self.process_llm, config=self.config, db_engine=self.db_engine
            )
            self.db_engine = self.monitor.db_engine  <span class="hljs-comment"># 同步监控器的数据库引擎</span>
​
            <span class="hljs-comment"># 初始化分发器监控器：监控任务分发状态</span>
            self.dispatcher_monitor = SchedulerDispatcherMonitor(config=self.config)
            <span class="hljs-comment"># 初始化检索器：处理内存检索、排序和过滤</span>
            self.retriever = SchedulerRetriever(process_llm=self.process_llm, config=self.config)
​
            <span class="hljs-comment"># 若启用并行分发，初始化并启动分发器监控器</span>
            <span class="hljs-keyword">if</span> self.enable_parallel_dispatch:
                self.dispatcher_monitor.initialize(dispatcher=self.dispatcher)
                self.dispatcher_monitor.start()
​
            <span class="hljs-comment"># 初始化认证配置</span>
            <span class="hljs-keyword">if</span> self.auth_config_path <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> Path(self.auth_config_path).exists():
                <span class="hljs-comment"># 从指定路径加载认证配置</span>
                self.auth_config = AuthConfig.from_local_config(config_path=self.auth_config_path)
            <span class="hljs-keyword">elif</span> AuthConfig.default_config_exists():
                <span class="hljs-comment"># 从默认路径加载认证配置</span>
                self.auth_config = AuthConfig.from_local_config()
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># 从环境变量加载认证配置</span>
                self.auth_config = AuthConfig.from_local_env()
​
            <span class="hljs-comment"># 若加载到认证配置，初始化RabbitMQ</span>
            <span class="hljs-keyword">if</span> self.auth_config <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                self.rabbitmq_config = self.auth_config.rabbitmq
                self.initialize_rabbitmq(config=self.rabbitmq_config)
​
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"Failed to initialize scheduler modules: <span class="hljs-subst">{e}</span>"</span>, exc_info=<span class="hljs-literal">True</span>)
            <span class="hljs-comment"># 初始化失败时清理部分初始化的资源</span>
            self._cleanup_on_init_failure()
            <span class="hljs-keyword">raise</span>
​
</code></pre>
<h4 data-id="heading-15">2.4 消息处理</h4>
<p>调度器通过带有专用processor的调度器来处理消息。</p>
<h5 data-id="heading-16">2.4.1 消息类型</h5>




















<table><thead><tr><th>消息类型</th><th>processor方法</th><th>描述</th></tr></thead><tbody><tr><td><code>QUERY_LABEL</code></td><td><code>_query_message_consume</code></td><td>处理用户查询并触发检索</td></tr><tr><td><code>ANSWER_LABEL</code></td><td><code>_answer_message_consume</code></td><td>处理答案并更新记忆使用</td></tr></tbody></table>
<h5 data-id="heading-17">2.4.2 调度消息结构</h5>
<p>调度器使用以下格式（ScheduleMessageItem）处理来自其队列的消息：</p>













































<table><thead><tr><th>字段</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code>item_id</code></td><td><code>str</code></td><td>UUID (自动生成) 用于唯一标识</td></tr><tr><td><code>user_id</code></td><td><code>str</code></td><td>关联用户的标识符</td></tr><tr><td><code>mem_cube_id</code></td><td><code>str</code></td><td>mem cube 的标识符</td></tr><tr><td><code>label</code></td><td><code>str</code></td><td>消息标签 (例如，<code>QUERY_LABEL</code>、<code>ANSWER_LABEL</code>)</td></tr><tr><td><code>mem_cube</code></td><td><code>GeneralMemCube｜str</code></td><td>mem cube 对象或引用</td></tr><tr><td><code>content</code></td><td><code>str</code></td><td>消息内容</td></tr><tr><td><code>timestamp</code></td><td><code>datetime</code></td><td>消息提交时间</td></tr></tbody></table>
<p>同时调度器将按照以下结构（ScheduleLogForWebItem）发送调度消息。</p>







































































<table><thead><tr><th>字段</th><th>类型</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><code>item_id</code></td><td><code>str</code></td><td>唯一日志条目标识符 (UUIDv4)</td><td>自动生成 (<code>uuid4()</code>)</td></tr><tr><td><code>user_id</code></td><td><code>str</code></td><td>关联用户标识符</td><td>(必需)</td></tr><tr><td><code>mem_cube_id</code></td><td><code>str</code></td><td>链接的 mem cube ID</td><td>(必需)</td></tr><tr><td><code>label</code></td><td><code>str</code></td><td>日志类别标识符</td><td>(必需)</td></tr><tr><td><code>from_memory_type</code></td><td><code>str</code></td><td>源记忆分区 可能的值： - <code>"LongTermMemory"</code> - <code>"UserMemory"</code> - <code>"WorkingMemory"</code></td><td>(必需)</td></tr><tr><td><code>to_memory_type</code></td><td><code>str</code></td><td>目标记忆分区</td><td>(必需)</td></tr><tr><td><code>log_content</code></td><td><code>str</code></td><td>详细日志消息</td><td>(必需)</td></tr><tr><td><code>current_memory_sizes</code></td><td><code>MemorySizes</code></td><td>当前记忆利用率</td><td><pre>DEFAULT_MEMORY_SIZES = { "long_term_memory_size": -1, "user_memory_size": -1, "working_memory_size": -1, "transformed_act_memory_size": -1 }</pre></td></tr><tr><td><code>memory_capacities</code></td><td><code>MemoryCapacities</code></td><td>记忆分区限制</td><td><pre>DEFAULT_MEMORY_CAPACITIES = { "long_term_memory_capacity": 10000, "user_memory_capacity": 10000, "working_memory_capacity": 20, "transformed_act_memory_capacity": -1 }</pre></td></tr><tr><td><code>timestamp</code></td><td><code>datetime</code></td><td>日志创建时间</td><td>自动设置 (<code>datetime.now</code>)</td></tr></tbody></table>
<h4 data-id="heading-18">2.5 函数实现</h4>
<p>BaseScheduler 的函数如下：</p>
<pre><code class="hljs language-python" lang="python">​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">replace_working_memory</span>(<span class="hljs-params">
        self,
        user_id: UserID | <span class="hljs-built_in">str</span>,
        mem_cube_id: MemCubeID | <span class="hljs-built_in">str</span>,
        mem_cube: GeneralMemCube,
        original_memory: <span class="hljs-built_in">list</span>[TextualMemoryItem],
        new_memory: <span class="hljs-built_in">list</span>[TextualMemoryItem],
    </span>) -&gt; <span class="hljs-literal">None</span> | <span class="hljs-built_in">list</span>[TextualMemoryItem]:
        <span class="hljs-string">"""重新排序后用新内存替换工作内存"""</span>
        text_mem_base = mem_cube.text_mem
        <span class="hljs-comment"># 仅支持TreeTextMemory类型的文本内存</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(text_mem_base, TreeTextMemory):
            text_mem_base: TreeTextMemory = text_mem_base
​
            <span class="hljs-comment"># 获取当前用户-内存立方体的查询监控器</span>
            query_db_manager = self.monitor.query_monitors[user_id][mem_cube_id]
            <span class="hljs-comment"># 与数据库同步获取最新查询历史</span>
            query_db_manager.sync_with_orm()
​
            <span class="hljs-comment"># 获取按时间排序的查询历史</span>
            query_history = query_db_manager.obj.get_queries_with_timesort()
            <span class="hljs-comment"># 用LLM处理并重新排序内存</span>
            memories_with_new_order, rerank_success_flag = (
                self.retriever.process_and_rerank_memories(
                    queries=query_history,
                    original_memory=original_memory,
                    new_memory=new_memory,
                    top_k=self.top_k,)
            )
​
            <span class="hljs-comment"># 根据查询历史过滤完全不相关的内存</span>
            filtered_memories, filter_success_flag = self.retriever.filter_unrelated_memories(
                query_history=query_history,
                memories=memories_with_new_order,
            )
​
            <span class="hljs-comment"># 处理过滤结果</span>
            <span class="hljs-keyword">if</span> filter_success_flag:
                memories_with_new_order = filtered_memories
​
            <span class="hljs-comment"># 获取查询关键词集合</span>
            query_keywords = query_db_manager.obj.get_keywords_collections()
​
            <span class="hljs-comment"># 将工作内存转换为监控项</span>
            new_working_memory_monitors = self.transform_working_memories_to_monitors(
                query_keywords=query_keywords,
                memories=memories_with_new_order,
            )
​
            <span class="hljs-comment"># 若重新排序失败，将排序分数设为0</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rerank_success_flag:
                <span class="hljs-keyword">for</span> one <span class="hljs-keyword">in</span> new_working_memory_monitors:
                    one.sorting_score = <span class="hljs-number">0</span>
​
            <span class="hljs-comment"># 更新工作内存监控器</span>
            self.monitor.update_working_memory_monitors(
                new_working_memory_monitors=new_working_memory_monitors,
                user_id=user_id,
                mem_cube_id=mem_cube_id,
                mem_cube=mem_cube,
            )
​
            <span class="hljs-comment"># 获取排序后的内存监控项，转换为工作内存</span>
            mem_monitors: <span class="hljs-built_in">list</span>[MemoryMonitorItem] = self.monitor.working_memory_monitors[user_id][
                mem_cube_id
            ].obj.get_sorted_mem_monitors(reverse=<span class="hljs-literal">True</span>)
            new_working_memories = [mem_monitor.tree_memory_item <span class="hljs-keyword">for</span> mem_monitor <span class="hljs-keyword">in</span> mem_monitors]
​
            <span class="hljs-comment"># 替换文本内存的工作内存</span>
            text_mem_base.replace_working_memory(memories=new_working_memories)
​
            <span class="hljs-comment"># 记录工作内存替换日志</span>
            self.log_working_memory_replacement(
                original_memory=original_memory,
                new_memory=new_working_memories,
                user_id=user_id,
                mem_cube_id=mem_cube_id,
                mem_cube=mem_cube,
                log_func_callback=self._submit_web_logs,
            )
        <span class="hljs-keyword">else</span>:
            memories_with_new_order = new_memory
​
        <span class="hljs-keyword">return</span> memories_with_new_order
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_activation_memory</span>(<span class="hljs-params">
        self,
        new_memories: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span> | TextualMemoryItem],
        label: <span class="hljs-built_in">str</span>,
        user_id: UserID | <span class="hljs-built_in">str</span>,
        mem_cube_id: MemCubeID | <span class="hljs-built_in">str</span>,
        mem_cube: GeneralMemCube,
    </span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""
        更新激活内存：从新内存中提取KV缓存项，添加到KV缓存内存实例并持久化到磁盘。
        支持字符串列表和TextualMemoryItem列表两种输入格式。
        """</span>
        <span class="hljs-comment"># 检查新内存是否为空</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(new_memories) == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span>
​
        <span class="hljs-comment"># 提取文本内容（适配两种输入格式）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(new_memories[<span class="hljs-number">0</span>], TextualMemoryItem):
            new_text_memories = [mem.memory <span class="hljs-keyword">for</span> mem <span class="hljs-keyword">in</span> new_memories]
        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(new_memories[<span class="hljs-number">0</span>], <span class="hljs-built_in">str</span>):
            new_text_memories = new_memories
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span>
​
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 获取激活内存实例（支持KVCacheMemory和VLLMKVCacheMemory）</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(mem_cube.act_mem, VLLMKVCacheMemory):
                act_mem: VLLMKVCacheMemory = mem_cube.act_mem
            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(mem_cube.act_mem, KVCacheMemory):
                act_mem: KVCacheMemory = mem_cube.act_mem
            <span class="hljs-keyword">else</span>:
                 <span class="hljs-keyword">return</span>
​
            <span class="hljs-comment"># 用模板组装新的文本内存（过滤空字符串）</span>
            new_text_memory = MEMORY_ASSEMBLY_TEMPLATE.<span class="hljs-built_in">format</span>(
                memory_text=<span class="hljs-string">""</span>.join(
                    [
                        <span class="hljs-string">f"<span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>. <span class="hljs-subst">{sentence.strip()}</span>\n"</span>
                        <span class="hljs-keyword">for</span> i, sentence <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(new_text_memories)
                        <span class="hljs-keyword">if</span> sentence.strip()  <span class="hljs-comment"># 跳过空字符串</span>
                    ]
                )
            )
​
            <span class="hljs-comment"># 处理已有缓存（避免重复更新）</span>
            original_cache_items: <span class="hljs-built_in">list</span>[VLLMKVCacheItem] = act_mem.get_all()
            original_text_memories = []
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(original_cache_items) &gt; <span class="hljs-number">0</span>:
                pre_cache_item: VLLMKVCacheItem = original_cache_items[-<span class="hljs-number">1</span>]
                original_text_memories = pre_cache_item.records.text_memories
                original_composed_text_memory = pre_cache_item.records.composed_text_memory
                <span class="hljs-comment"># 若新组装的文本与已有缓存一致，跳过更新</span>
                <span class="hljs-keyword">if</span> original_composed_text_memory == new_text_memory:
                    <span class="hljs-keyword">return</span>
                <span class="hljs-comment"># 清除旧缓存</span>
                act_mem.delete_all()
​
            <span class="hljs-comment"># 提取KV缓存并添加到激活内存</span>
            cache_item = act_mem.extract(new_text_memory)
            cache_item.records.text_memories = new_text_memories
            cache_item.records.timestamp = datetime.utcnow()
            act_mem.add([cache_item])
            <span class="hljs-comment"># 持久化激活内存到磁盘</span>
            act_mem.dump(self.act_mem_dump_path)
​
            <span class="hljs-comment"># 记录激活内存更新日志</span>
            self.log_activation_memory_update(
                original_text_memories=original_text_memories,
                new_text_memories=new_text_memories,
                label=label,
                user_id=user_id,
                mem_cube_id=mem_cube_id,
                mem_cube=mem_cube,
                log_func_callback=self._submit_web_logs,
            )
​
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"MOS-based activation memory update failed: <span class="hljs-subst">{e}</span>"</span>, exc_info=<span class="hljs-literal">True</span>)
            <span class="hljs-comment"># 关键操作失败时可重新抛出异常，此处暂不中断执行</span>
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_activation_memory_periodically</span>(<span class="hljs-params">
        self,
        interval_seconds: <span class="hljs-built_in">int</span>,
        label: <span class="hljs-built_in">str</span>,
        user_id: UserID | <span class="hljs-built_in">str</span>,
        mem_cube_id: MemCubeID | <span class="hljs-built_in">str</span>,
        mem_cube: GeneralMemCube,
    </span>):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 检查是否达到更新间隔（首次更新或间隔时间已到）</span>
            <span class="hljs-keyword">if</span> (
                self.monitor.last_activation_mem_update_time == datetime.<span class="hljs-built_in">min</span>
                <span class="hljs-keyword">or</span> self.monitor.timed_trigger(
                    last_time=self.monitor.last_activation_mem_update_time,
                    interval_seconds=interval_seconds,
                )
            ):
                <span class="hljs-comment"># 检查工作内存监控器中是否有可用内存</span>
                <span class="hljs-keyword">if</span> (
                    user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.monitor.working_memory_monitors
                    <span class="hljs-keyword">or</span> mem_cube_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.monitor.working_memory_monitors[user_id]
                    <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(self.monitor.working_memory_monitors[user_id][mem_cube_id].obj.memories)
                    == <span class="hljs-number">0</span>
                ):
                    <span class="hljs-keyword">return</span>
                
                <span class="hljs-comment"># 更新激活内存监控器（同步最新内存状态）</span>
                self.monitor.update_activation_memory_monitors(
                    user_id=user_id, mem_cube_id=mem_cube_id, mem_cube=mem_cube
                )
​
                <span class="hljs-comment"># 与数据库同步获取最新激活内存</span>
                activation_db_manager = self.monitor.activation_memory_monitors[user_id][
                    mem_cube_id
                ]
                activation_db_manager.sync_with_orm()
                new_activation_memories = [
                    m.memory_text <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> activation_db_manager.obj.memories
                ]
​
                <span class="hljs-comment"># 日志输出新内存数量及部分内容（最多前 5 条）</span>
                <span class="hljs-keyword">for</span> i, memory <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(new_activation_memories[:<span class="hljs-number">5</span>], <span class="hljs-number">1</span>):
                    logger.info(
                        <span class="hljs-string">f"Part of New Activation Memorires | <span class="hljs-subst">{i}</span>/<span class="hljs-subst">{<span class="hljs-built_in">len</span>(new_activation_memories)}</span>: <span class="hljs-subst">{memory[:<span class="hljs-number">20</span>]}</span>"</span>
                    )
​
                <span class="hljs-comment"># 执行激活内存更新</span>
                self.update_activation_memory(
                    new_memories=new_activation_memories,
                    label=label,
                    user_id=user_id,
                    mem_cube_id=mem_cube_id,
                    mem_cube=mem_cube,
                )
                
                <span class="hljs-comment"># 更新最后更新时间</span>
                self.monitor.last_activation_mem_update_time = datetime.utcnow()
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># 未达到更新间隔，跳过更新</span>
​
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"Error in update_activation_memory_periodically: <span class="hljs-subst">{e}</span>"</span>, exc_info=<span class="hljs-literal">True</span>)
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">submit_messages</span>(<span class="hljs-params">self, messages: ScheduleMessageItem | <span class="hljs-built_in">list</span>[ScheduleMessageItem]</span>):
        <span class="hljs-string">"""提交一个或多个消息到消息队列"""</span>
        <span class="hljs-comment"># 处理单个消息（转换为列表）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(messages, ScheduleMessageItem):
            messages = [messages]  <span class="hljs-comment"># transform single message to list</span>
​
        <span class="hljs-comment"># 验证消息类型并加入队列</span>
        <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> messages:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(message, ScheduleMessageItem):
                error_msg = <span class="hljs-string">f"Invalid message type: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(message)}</span>, expected ScheduleMessageItem"</span>
                <span class="hljs-keyword">raise</span> TypeError(error_msg)
​
            self.memos_message_queue.put(message)
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_message_consumer</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""持续检查消息队列并分发消息（运行在独立线程中）定期消费队列中的所有消息，避免忙等"""</span>
        <span class="hljs-keyword">while</span> self._running:  <span class="hljs-comment"># Use a running flag for graceful shutdown</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 批量获取队列中所有可用消息（线程安全）</span>
                messages = []
                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>: <span class="hljs-comment"># 基于运行状态标识实现优雅关闭</span>
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-comment"># 非阻塞获取消息，无消息时抛出 Empty 异常</span>
                        message = self.memos_message_queue.get_nowait()
                        messages.append(message)
                    <span class="hljs-keyword">except</span> queue.Empty:
                        <span class="hljs-comment"># 队列已空，退出循环</span>
                        <span class="hljs-keyword">break</span>
​
                <span class="hljs-keyword">if</span> messages: <span class="hljs-comment"># 若获取到消息，执行分发</span>
                    <span class="hljs-keyword">try</span>:
                        self.dispatcher.dispatch(messages)
                    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                        logger.error(<span class="hljs-string">f"Error dispatching messages: <span class="hljs-subst">{e!s}</span>"</span>)
                    <span class="hljs-keyword">finally</span>:
                        <span class="hljs-comment"># 标记所有消息为已处理</span>
                        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> messages:
                            self.memos_message_queue.task_done()
​
                <span class="hljs-comment"># 短暂休眠，避免 CPU 占用过高</span>
                time.sleep(self._consume_interval)  <span class="hljs-comment"># Adjust interval as needed</span>
​
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                time.sleep(self._consume_interval)  <span class="hljs-comment"># 异常时同样休眠，避免循环报错</span>
​
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""
            启动调度器（初始化资源并启动消息消费线程）
            启动内容：1. 消息消费线程 2. 分发器线程池（若启用并行分发）
        """</span>        
        <span class="hljs-keyword">if</span> self._running:
            <span class="hljs-keyword">return</span>
​
        <span class="hljs-comment"># 启动消息消费线程</span>
        self._running = <span class="hljs-literal">True</span>
        self._consumer_thread = threading.Thread(
            target=self._message_consumer,
            daemon=<span class="hljs-literal">True</span>,
            name=<span class="hljs-string">"MessageConsumerThread"</span>,
        )
        self._consumer_thread.start()
</code></pre>
<h3 data-id="heading-19">0xFF 参考</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android UID]]></title>    <link>https://juejin.cn/post/7585013463859347506</link>    <guid>https://juejin.cn/post/7585013463859347506</guid>    <pubDate>2025-12-18T13:36:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585013463859347506" data-draft-id="7584262116388749338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android UID"/> <meta itemprop="keywords" content="Android,面试"/> <meta itemprop="datePublished" content="2025-12-18T13:36:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限进化"/> <meta itemprop="url" content="https://juejin.cn/user/108212996024855"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android UID
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/108212996024855/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限进化
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:36:03.000Z" title="Thu Dec 18 2025 13:36:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. Android UID 概述</h2>
<p>在 Android 操作系统中，<strong>UID (User ID)</strong> 是用于标识一个应用程序的核心标识符。</p>
<ol>
<li><strong>分配机制</strong>：UID 在应用安装时由系统（PackageManagerService）分配。</li>
<li><strong>生命周期</strong>：在应用存在于设备期间，其 UID <strong>保持不变</strong>。只有当应用被卸载后，该 UID 才可能被回收并分配给新的应用。</li>
<li><strong>唯一性原则</strong>：通常情况下，一个应用程序对应一个 UID。</li>
<li><strong>共享机制</strong>：多个应用可以通过 <code>sharedUserId</code> 方式共享同一个 UID，但前提是这些应用必须使用<strong>相同的签名</strong>。</li>
</ol>
<p>UID 是 Android 安全沙箱（Sandbox）机制的基础，它决定了应用的文件访问权限、资源使用权限以及进程间通信（IPC）的身份验证。</p>
<h2 data-id="heading-1">2. UID 的格式与计算</h2>
<p>在 Android log 中，我们经常看到类似 <code>u0_a36</code> 的标识，这就是 UID 的一种表现形式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ad6e1f2a44d444692480dc0ca010fc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ6L-b5YyW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766669763&amp;x-signature=BYK117DZQdd4yvMIwS0MXQkzfdM%3D" alt="image.png" loading="lazy"/></p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37c53d5f14984feda3f8f749376e4ae5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ6L-b5YyW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766669763&amp;x-signature=M7TeeDrEDTuJRGyEedbDtEclYQ8%3D" alt="image.png" width="90%" loading="lazy"/>
<p>以 <code>u0_a199</code> 为例：</p>
<ol>
<li><strong>u0</strong>: 代表 <strong>User 0</strong>，即 Android 系统的主用户（Owner）。Android 支持多用户，其他用户可能是 <code>u10</code> 等。</li>
<li><strong>a199</strong>: 代表该应用在该用户下的 ID 偏移量，这里是 199。</li>
</ol>
<p>Android 普通应用程序的 UID 起始值定义为 <strong>10000</strong> (<code>FIRST_APPLICATION_UID</code>)。</p>
<p><strong>真实数值计算公式：</strong>：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>UID</mtext><mo>=</mo><mtext>Base</mtext><mo>+</mo><mtext>Offset</mtext></mrow><annotation encoding="application/x-tex">\text{UID} = \text{Base} + \text{Offset}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">UID</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord">Base</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">Offset</span></span></span></span></span></span></p>
<p>针对 <code>u0_a1999</code>：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10000</mn><mo stretchy="false">(</mo><mtext>基础值</mtext><mo stretchy="false">)</mo><mo>+</mo><mn>199</mn><mo stretchy="false">(</mo><mtext>偏移量</mtext><mo stretchy="false">)</mo><mo>=</mo><mn>10199</mn></mrow><annotation encoding="application/x-tex">10000 (\text{基础值}) + 199 (\text{偏移量}) = 10199</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">10000</span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">基础值</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">199</span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">偏移量</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">10199</span></span></span></span></span></p>
<p>因此，系统底层实际使用的 <code>int</code> 类型 UID 为 <strong>10036</strong>。</p>
<h2 data-id="heading-2">3. UID 的分配范围</h2>
<p>根据 frameworks\base\core\java\android\os\Process.java 中的定义：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 应用程序 UID 范围</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">FIRST_APPLICATION_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LAST_APPLICATION_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">19999</span>;

<span class="hljs-comment">// SDK 沙箱进程 UID 范围</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">FIRST_SDK_SANDBOX_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">20000</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LAST_SDK_SANDBOX_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">29999</span>;

<span class="hljs-comment">// 隔离进程 UID 范围</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">FIRST_ISOLATED_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">99000</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LAST_ISOLATED_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">99999</span>;

<span class="hljs-comment">// 应用 Zygote 隔离进程 UID 范围</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">FIRST_APP_ZYGOTE_ISOLATED_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">90000</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LAST_APP_ZYGOTE_ISOLATED_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">98999</span>;
</code></pre>
<p>系统预定义的特殊 UID:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SYSTEM_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;        <span class="hljs-comment">// 系统进程</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PHONE_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1001</span>;         <span class="hljs-comment">// 电话服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHELL_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;         <span class="hljs-comment">// Shell 进程</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LOG_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1007</span>;           <span class="hljs-comment">// 日志服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">WIFI_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1010</span>;          <span class="hljs-comment">// WiFi 服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MEDIA_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1013</span>;         <span class="hljs-comment">// 媒体服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DRM_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1019</span>;           <span class="hljs-comment">// DRM 服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">VPN_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1016</span>;           <span class="hljs-comment">// VPN 服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NFC_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1027</span>;           <span class="hljs-comment">// NFC 服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BLUETOOTH_UID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1002</span>;     <span class="hljs-comment">// 蓝牙服务</span>
</code></pre>
<h2 data-id="heading-3">4. 应用</h2>
<h3 data-id="heading-4">4.1 通过包名获取 UID</h3>
<p>在应用开发中，可以通过 PackageManager 获取任意应用的 UID：</p>
<pre><code class="hljs language-ini" lang="ini">PackageManager <span class="hljs-attr">mPm</span> = getPackageManager()<span class="hljs-comment">;</span>
try {
    // 0 表示不需要特殊的 flag
    ApplicationInfo <span class="hljs-attr">applicationInfo</span> = mPm.getApplicationInfo(<span class="hljs-string">"com.tencent.mm"</span>, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
    int <span class="hljs-attr">uid</span> = applicationInfo.uid<span class="hljs-comment">;</span>
    
    // 显示 UID
    Toast.makeText(MainActivity.this, "UID: " + uid, Toast.LENGTH_SHORT).show()<span class="hljs-comment">;</span>
} catch (Exception e) {
    e.printStackTrace()<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-5">4.2 通过 UID 获取包名</h3>
<p>反之，也可以通过 UID 反查包名。</p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">packagename</span> = getPackageManager().getNameForUid(uid)<span class="hljs-comment">; </span>
</code></pre>
<h3 data-id="heading-6">4.3 声明 Shared UID (系统级应用开发)</h3>
<p>如果拥有系统签名，或者需要让两个自己的应用运行在同一进程、共享数据，可以在 <code>AndroidManifest.xml</code> 中声明 <code>sharedUserId</code>。</p>
<p><strong>示例：设置应用为系统进程 UID</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"[http://schemas.android.com/apk/res/android](http://schemas.android.com/apk/res/android)"</span>
    <span class="hljs-attr">package</span>=<span class="hljs-string">"cn.izis.chessdeskrobot"</span>
    <span class="hljs-attr">android:sharedUserId</span>=<span class="hljs-string">"android.uid.system"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 注意：必须使用与系统相同的签名文件对 APK 进行签名，否则安装会失败 --&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p><strong>常见的共享 UID 类型：</strong></p>
<ol>
<li><code>android.uid.system</code> (系统权限)</li>
<li><code>android.uid.shared</code></li>
<li><code>android.uid.media</code></li>
</ol>
<p>仅仅配置 <code>android:sharedUserId="android.uid.system"</code>（即 UID 1000）<strong>并不代表</strong>能无条件互相访问，实际情况取决于三层机制：</p>
<ol>
<li><strong>Linux 权限层（允许）：</strong> 如果两个应用 UID 相同且<strong>签名一致</strong>，Linux 内核视它们为同一个用户，默认<strong>打破沙箱</strong>，可以互相读写数据。</li>
<li><strong>SELinux 层（可能拦截）：</strong> 即使 UID 相同，如果两个进程属于不同的 <strong>SELinux 安全域</strong>（system_server，system_app），系统仍会强制拦截访问。</li>
<li><strong>多用户层（物理隔离）：</strong> 不同 Android 用户（如主用户 vs 工作资料）下的应用，实际运行时的 UID 是不同的（如 <code>1000</code> vs <code>1001000</code>），因此<strong>无法互通</strong>。</li>
</ol>
<h2 data-id="heading-7">5. UID vs PID</h2>
<h3 data-id="heading-8">5.1 对比分析</h3>








































<table><thead><tr><th>特性</th><th>UID (User ID)</th><th>PID (Process ID)</th></tr></thead><tbody><tr><td><strong>定义</strong></td><td>用户身份标识</td><td>进程实例标识</td></tr><tr><td><strong>层级</strong></td><td>应用级 (Application Scope)</td><td>进程级 (Process Scope)</td></tr><tr><td><strong>分配时机</strong></td><td><strong>应用安装时</strong></td><td><strong>进程启动时</strong></td></tr><tr><td><strong>生命周期</strong></td><td>极长（应用安装到卸载）</td><td>短暂（进程启动到被杀/退出）</td></tr><tr><td><strong>唯一性</strong></td><td>可共享 (<code>sharedUserId</code>)</td><td>系统运行时唯一</td></tr><tr><td><strong>主要作用</strong></td><td><strong>权限控制</strong>、沙箱隔离、文件归属</td><td>进程调度、内存管理、信号发送</td></tr></tbody></table>
<h3 data-id="heading-9">5.2 为什么需要 UID？</h3>
<p>PID 是临时的、易变的。应用重启后 PID 会改变，但 UID 不会。Android 权限系统（如是否允许访问相机、文件）是基于 <strong>UID</strong> 进行持久化记录和检查的，而不是 PID。</p>
<ol>
<li><strong>权限检查示例</strong>：当 App 请求打开相机时，系统检查的是 <code>Binder.getCallingUid()</code> 是否拥有相机权限。</li>
<li><strong>文件安全</strong>：<code>/data/data/com.example.app/</code> 目录的所有者是该应用的 UID，Linux 内核通过 UID 确保其他应用无法访问该目录。</li>
</ol>
<p>尝试以 Shell 用户（UID 2000）查看目录 /data/data/com.example.study：</p>
<pre><code class="hljs language-bash" lang="bash">$ adb shell dumpsys package com.android.shell | grep uid
    uid=2000 gids=[] <span class="hljs-built_in">type</span>=0 prot=signature
    sharedUser=SharedUserSetting{83df8ed android.uid.shell/2000}
  SharedUser [android.uid.shell] (83df8ed):
  
$ adb shell <span class="hljs-built_in">ls</span> -l //data/data/com.example.study
<span class="hljs-built_in">ls</span>: //data/data/com.example.study: Permission denied

$ adb shell run-as com.example.study <span class="hljs-built_in">ls</span> -l //data/data/com.example.study
total 40
drwxrws--x 2 u0_a199 u0_a199_cache 4096 2025-12-16 13:35 cache
drwxrws--x 5 u0_a199 u0_a199_cache 4096 2025-12-16 13:35 code_cache
drwxrwx--x 2 u0_a199 u0_a199       4096 2025-12-16 13:35 databases
drwxrwx--x 3 u0_a199 u0_a199       4096 2025-12-16 13:35 files
drwxrwx--x 2 u0_a199 u0_a199       4096 2025-12-16 13:35 shared_prefs


$ adb shell pm list packages --uid 1000
package:com.android.inputdevices uid:1000
package:com.android.location.fused uid:1000
package:com.android.settings uid:1000
package:com.android.localtransport uid:1000
package:android uid:1000
package:com.android.emulator.multidisplay uid:1000
package:com.android.dynsystem uid:1000
package:com.android.keychain uid:1000
package:com.android.server.telecom uid:1000
package:com.android.providers.settings uid:1000
package:com.android.wallpaperbackup uid:1000


</code></pre>
<h3 data-id="heading-10">5.3 线程与进程的关系</h3>
<p>在 Linux/Android 内核中：</p>
<ul>
<li><strong>主线程 ID (TID) == 进程 ID (PID)</strong> 。</li>
<li>可以通过 <code>Process.myPid() == Process.myTid()</code> 来判断当前代码是否运行在主线程。</li>
</ul>
<h2 data-id="heading-11">6. 特殊进程机制</h2>
<h3 data-id="heading-12">6.1 隔离进程 (Isolated Process)</h3>
<ol>
<li><strong>UID 范围</strong>：99000 - 99999</li>
<li><strong>特点</strong>：没有网络访问权限、无法访问外部存储、只能访问极少数系统服务。</li>
<li><strong>用途</strong>：用于解析不信任的数据（如 Chrome 的渲染进程），即使进程被攻破，攻击者也无法获取用户隐私数据。</li>
</ol>
<h3 data-id="heading-13">6.2 SDK 沙箱 (SDK Sandbox)</h3>
<ol>
<li><strong>UID 范围</strong>：20000 - 29999</li>
<li><strong>背景</strong>：Android 13 引入。</li>
<li><strong>用途</strong>：将第三方广告 SDK 等运行在独立的沙箱进程中，使其无法直接访问主应用的敏感数据，增强隐私保护。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[gocron - 分布式定时任务管理系统]]></title>    <link>https://juejin.cn/post/7585005164726943782</link>    <guid>https://juejin.cn/post/7585005164726943782</guid>    <pubDate>2025-12-18T13:36:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585005164726943782" data-draft-id="7585019819193630730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="gocron - 分布式定时任务管理系统"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-18T13:36:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没多少逻辑"/> <meta itemprop="url" content="https://juejin.cn/user/2717648475395325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            gocron - 分布式定时任务管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648475395325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没多少逻辑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T13:36:25.000Z" title="Thu Dec 18 2025 13:36:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用 Go 语言开发的轻量级分布式定时任务集中调度和管理系统，用于替代 Linux-crontab。</p>
<p>github地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">github.com/gocronx-tea…</a></p>
<h2 data-id="heading-0">📸 界面截图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e50070fea56848738b38187dc560359f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766669965&amp;x-signature=9zaDQj8TZxLktLY1jO9JeEHKj04%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6afd6ee6381e4239bbf8bc48697611df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766669965&amp;x-signature=7KmZHDS2rAXYPcHfq8OgsQCU%2Fso%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85ea589ac0224baaac90b7e12143c396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766669965&amp;x-signature=16g2106ajUhC43zgSdLri2cm7TY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6721f473fa374b64b72e8bfd12cf5d7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766669965&amp;x-signature=v6y8CJanzdXzbprm12ZYk2XNsMc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">📖 文档</h2>
<p>访问完整文档请跳转：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev" target="_blank" title="https://gocron-docs.pages.dev" ref="nofollow noopener noreferrer">文档</a></p>
<ul>
<li>🚀 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev%2Fzh%2Fguide%2Fquick-start" target="_blank" title="https://gocron-docs.pages.dev/zh/guide/quick-start" ref="nofollow noopener noreferrer">快速开始</a> - 安装部署指南</li>
<li>🤖 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev%2Fzh%2Fguide%2Fagent-registration" target="_blank" title="https://gocron-docs.pages.dev/zh/guide/agent-registration" ref="nofollow noopener noreferrer">Agent 自动注册</a> - 一键部署任务节点</li>
<li>⚙️ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev%2Fzh%2Fguide%2Fconfiguration" target="_blank" title="https://gocron-docs.pages.dev/zh/guide/configuration" ref="nofollow noopener noreferrer">配置文件</a> - 详细配置说明</li>
<li>🔌 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev%2Fzh%2Fguide%2Fapi" target="_blank" title="https://gocron-docs.pages.dev/zh/guide/api" ref="nofollow noopener noreferrer">API 文档</a> - API 接口说明</li>
</ul>
<h2 data-id="heading-2">✨ 功能特性</h2>
<ul>
<li><strong>Web 界面管理</strong>：直观的定时任务管理界面</li>
<li><strong>秒级定时</strong>：支持 Crontab 时间表达式，精确到秒</li>
<li><strong>分布式架构</strong>：Master-Worker 架构，支持多节点高可用</li>
<li><strong>任务重试</strong>：支持任务执行失败重试设置</li>
<li><strong>任务依赖</strong>：支持配置任务依赖关系</li>
<li><strong>多用户权限</strong>：完善的用户和权限控制</li>
<li><strong>双因素认证</strong>：支持 2FA，提升系统安全性</li>
<li><strong>Agent 自动注册</strong>：支持 Linux/macOS 一键安装注册</li>
<li><strong>多数据库支持</strong>：MySQL / PostgreSQL / SQLite</li>
<li><strong>日志管理</strong>：完整的任务执行日志，支持自动清理</li>
<li><strong>消息通知</strong>：支持邮件、Slack、Webhook 等多种通知方式</li>
</ul>
<h2 data-id="heading-3">🚀 快速开始 (Docker)</h2>
<p>最简单的部署方式是使用 Docker Compose：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆项目</span>
git <span class="hljs-built_in">clone</span> https://github.com/gocronx-team/gocron.git
<span class="hljs-built_in">cd</span> gocron

<span class="hljs-comment"># 2. 启动服务</span>
docker-compose up -d

<span class="hljs-comment"># 3. 访问 Web 界面</span>
<span class="hljs-comment"># http://localhost:5920</span>
<span class="hljs-comment"># 默认账号：admin / admin123</span>
</code></pre>
<p>更多部署方式（二进制部署、开发环境）请查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev%2Fzh%2Fguide%2Fquick-start" target="_blank" title="https://gocron-docs.pages.dev/zh/guide/quick-start" ref="nofollow noopener noreferrer">安装部署指南</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端-2025年末个人总结]]></title>    <link>https://juejin.cn/post/7585005164726796326</link>    <guid>https://juejin.cn/post/7585005164726796326</guid>    <pubDate>2025-12-18T12:15:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585005164726796326" data-draft-id="7584742635501223963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端-2025年末个人总结"/> <meta itemprop="keywords" content="前端,年终总结"/> <meta itemprop="datePublished" content="2025-12-18T12:15:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无我Code"/> <meta itemprop="url" content="https://juejin.cn/user/1460615318609160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端-2025年末个人总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1460615318609160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无我Code
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T12:15:41.000Z" title="Thu Dec 18 2025 12:15:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>又到年末，这一转眼，2025就即将过去了，在过去的一年里，经历了许多，也收获了许多，总的来说，这一年是精彩的，是值得回味的。愿与诸君共同前行，收获美好的未来。</p>
<h2 data-id="heading-1">这一年的变化</h2>
<p>在这一年当中，我体验到了许多新的感受，也对自己的工作与生活有了更加深刻的理解，从年初开始，我就开始期待，2025年会在我的身边发生些什么。</p>
<h3 data-id="heading-2">离职</h3>
<p>在今年7月中旬，我向公司提出了离职，虽然在公司做一名管理者，很轻松，很安逸，工作算不上有多辛苦，但思来想去，我想这些都不是我想要的，因为我在这入职的三年里，已经完成了蜕变，收获颇丰。如果我再继续在公司工作下去，那将是一段漫长的平静。所以我走了，想去外面看看，加上一直在工作，没有好好休息过，顺便去旅行一段时间。回过头来看，这个选择是正确的，大家好聚好散，哈哈哈哈。</p>
<h3 data-id="heading-3">旅行</h3>
<p>在离职后，我回到家乡，给妈妈买了一辆五菱MINI，不得不说，这辆小车真的非常好，平均下来3分钱一公里，200公里的续航也足够使用，也算是给家里提供了一个大大的方便，这样妈妈以后就没有出行焦虑了，我以后也不需要开车回家，方便的话，直接坐高铁回去就行。然后我还顺便增驾了摩托车的驾驶证，方便后面有机会骑摩托车。旅行的计划是先去云南，因为云南有几位好多年不见的大学同学，而且在炎热的夏季去一趟云南避暑也非常的不错。然后我在云南待了一个星期以后，就计划爬五岳，顺便去了一趟北京，可惜没有预约到故宫的票，只是在远远看了一眼天安门，还去看了长城，暑假各个旅游景点都非常多人，很热闹。在这段旅途中认识到了许多新的朋友，大家一起分享旅游体验，互相拍照，共同体验各个风景区的风俗文化。这是一段非常精彩的旅途，想必多年以后，我还是会想起这段一个人的旅程，它让我看到了国家的大好河山，体验到了祖国的幅员辽阔，那种感觉，不是在电脑面前能够感受到的，非常棒，也推荐大家有时间多出门旅游，一个人也不错，跟朋友一起也行，总之趁着还有时间、趁着还年轻，出发去外面看看。哈哈哈哈哈。</p>
<h3 data-id="heading-4">体验跳伞</h3>
<p>今年我还做一件非常疯狂的事情，那就是体验空中跳伞，算是对自己的一次挑战（因为我有恐高，虽然不是很严重），从登机开始，到云层之中，我整个人都非常的激动，手脚也有些发软，但是我当时还是很好奇的看向窗外，这是我第一次坐飞机，在3000多米高的云层俯瞰下方，那种感觉，记忆犹新。后面跟着教练从飞机上面一跃而下，心率直达顶峰！那种极致的坠落，说实话，我不太想体验第二次。在空中摆姿势、打开降落伞再到顺利着陆，整个人都处在非常兴奋的状态，久久不能平静，总的来说，这是一次非常好的体验。</p>
<h3 data-id="heading-5">找新工作</h3>
<p>旅行结束以后，我就回到了广州，开始找工作，当时是9月份回到广州，开始投递简历、面试，再到后面的入职。这里跟大家分享一个我自己的观点，那就是不要在9月份找工作，越是靠近9月底，就越难找，虽然也有，但是大部分的公司会选择国庆以后再招人，所有大家以后可以9月份去旅游，国庆以后再开始投递简历。9月份我投递了很多简历，但是整体来说效果不尽人意，面试了7-8家公司，有些是不急着招人、有些是兼职、有些是给不了那么高的薪资，所以我最后选择了南方电网的外包岗位，想着去这种大企业工作看看，是个什么样的情况。但是经历了45多天的工作，我还是选择离职了，因为这个岗位真的太卷了，说好的5点半下班，周末双休。但是实际的情况却是从入职到离职，我大概只休息过3-4天，下班以后从来没有看到过太阳，整个人就像是一个永不停歇的陀螺。这不是我想要的，所以我就在11月底离职了，因为我需要时间休息，需要时间学习，需要的是一家有人文关怀的公司，大家一起开心的工作，一起愉快的成长。这是我第一次做外包，我想我以后再也不会去做外包了，期间种种，不足道也。</p>
<p>这里给大家分享一下我找工作发现的一些新的情况，这些是2025前端开发岗位比较热门的东西，希望对大家找新工作有一些帮助。</p>
<ol>
<li>学历要求：当下的前端开发岗位，对学历的要求相比往年更高，如果大家能拿到一个本科学历最好，现在的部分公司会在学历上面要求你是一位本科生，所以大家是专科的学历，可以考一个成人本科，这对找工作非常的有帮助。大部分的公司基本上不要求全日制，只要学信网上面有本科的就算是过关了。</li>
<li>外包岗位多：我在这次找工作的过程中发现，市面上大部分的岗位都是外包岗位，自研的岗位占比大概有10%左右，所以大家想要找自研的岗位，最好是做好一个长期找工作的准备，不要太着急做决定。</li>
<li>周一到周三投递简历：这次我找工作，基本上是在周一到周三这段时间，求职平台的反馈会更多一些，到了周四周五，基本上没有反馈，有反馈的基本上是外包公司，所以大家在投简历的时候，心仪的公司最好是在周一下午开始投递，过了周三就不要再投递了，等到下周一再进行投递会更好。</li>
<li>平台反馈：我在各个平台都有投递简历，从反馈上来说，BOSS直聘的反馈是最多的，其次是智联招聘，然后其他平台就基本上没有反馈了，猎聘是有一些反馈，但是基本上要求很高，如果是名校+专业对口的，可以在猎聘上面找会有一些机会，当然，猎聘上面的薪资也是各个平台中最高的，从薪资上面来说，我的感觉是猎聘&gt;智联招聘&gt;BOSS直聘&gt;其他。像是一些小众的求职平台，说实话，都没有掘金的沸点可靠，哈哈哈哈。</li>
<li>技术栈要求：在找工作的过程中，有很多好的岗位对求职者都有特殊的要求，要求做过相关的项目，我这里给大家举例一些，大家可以做个参考：GIS、flutter、安卓、iOS这四个是提到最多的，然后是webGL+threeJS、nextJS、react native、electron桌面端、原子CSS这些是次热门的技术。像是VUE、react基本上是必须要求会的，然后node，vite也是热门，还有语音、视频、文档、游戏开发领域也有不少，还有一个是快应用开发，不过这个快应用给我的感觉不是很好，所以不考虑往快应用方面发展。</li>
<li>线上面试、兼职：这次找工作，有很多的兼职岗位，一般是1-3个月的兼职，这种岗位占比蛮多的，大概有400-600一天，当然这种兼职的岗位对工作时长的要求也是很高的，然后也是很赶进度，不是很推荐大家找兼职的岗位。线上面试的比例占比也很高，基本上多于线下面试。</li>
<li>其他说明：从我投递的这么多公司来看，其实还是看运气成分多一些，但是还是有一些小技巧，比如在简历上面把技术栈写得越多越好，越详细越好，以前大家的简历基本上是在项目描述上面做文章比较多，但是现在的HR不是专业出身，所有大部分的HR是不懂你的技术栈的，所以大家可以在个人技术栈里面，把你会的技术栈都罗列出来，不要写一个笼统的，HR会按着招聘要求对比你的简历上面的技术栈（技术点），否则就会出现HR看你的技术栈这么少，就会误认为你是一个普通的程序员，或者你没有掌握这一项技术，然后pass掉简历。然后就是AI方向，如果你的简历里面附带有AI项目，或者是AI相关的技术栈，那么在求职的过程中，会更好一些。从找工作的岗位来看，现在前端开发的岗位基本薪资大概是10-12K的占大多数（广州），超过12K的就很少了，可能是我9月份找工作的原因吧，总之给我的感觉是没有以前找工作那会高了，不过还是有一些高薪岗位的，大家也不用担心。</li>
</ol>
<h3 data-id="heading-6">注销公司</h3>
<p>今年年初我注册了一个公司，打算用来跑项目，尝试一下创业，但是经过几个月的发展，我决定还是先注销掉，因为项目的方向有些问题，加上政策上面的原因，所以我今年年尾把公司注销了，后面有需要再重新注册一个新的公司。这次开公司的体验，给我的感觉非常不错，没花什么钱，还学到了很多东西，推荐大家有想法的也开一个，最好注册资本在100万的，这样不会有那么多的限制。</p>
<h3 data-id="heading-7">学习</h3>
<p>今年学习到了很多东西，最大的提升是英语，其他林林总总的知识也收获不少，总之今年又是极大提升自己的一年。这里说明一下我为什么要这么积极的学习英文，因为我发现我目前在职业发展方面，技术的提升幅度没有学习英语提升的幅度大，大部分的前端技术栈我都了解，没学过的技术，基本上学个一两天也OK了，所以我将学习方向调整到英语上面，学英语会对我的工作与生活带来很大的帮助。在之前找工作的时候，我也发现一个现象，就是现在国内的外企，这些外企的前端岗位也在不停的招人，好像有些还招不到人，所以我最近这段时间就一直在强化我的英文沟通能力，到时候打算往外企的岗位发展，因为国内的小公司也好，大公司也好，我都就职过。但是外企这种企业，我还没有体验过，如果能够有机会入职外企，对我的职业发展也是非常有帮助的。然后再准备明年的本科毕业，如果有机会，再继续学习研究生考试的相关知识，到时候再试试读一个在职研究生，这些学习都对我将来的发展有很大的帮助。然后最近还学习了一些AI相关的知识，打算后面搭建一个自己的AI应用，用来做一些英语学习平台，哈哈哈哈，还有很多很多东西要学习呀，感觉时间还是太少了。</p>
<h2 data-id="heading-8">新一年的计划</h2>
<p>明年我的主要目标就是</p>
<ol>
<li>提升英文沟通能力，就职外企。</li>
<li>完成明年上半年的本科毕业相关工作与学习。</li>
<li>备考研究生</li>
<li>完成一个AI应用的开发</li>
<li>将体重控制在73KG</li>
<li>继续参加自考本科</li>
<li>学习前端相关的技术栈（2个以上）</li>
</ol>
<p>非常感谢大家看到这里，其实我还有很多想要分享的地方，但是篇幅有限，所以有机会以后再跟大家分享。这里也祝愿大家在新的一年里工作顺利，身心健康，早日实现财富自由！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 大模型应用开发｜基础原理]]></title>    <link>https://juejin.cn/post/7585027616736165940</link>    <guid>https://juejin.cn/post/7585027616736165940</guid>    <pubDate>2025-12-18T12:55:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585027616736165940" data-draft-id="7584711683772628992" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 大模型应用开发｜基础原理"/> <meta itemprop="keywords" content="AIGC,人工智能,AI编程"/> <meta itemprop="datePublished" content="2025-12-18T12:55:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="树獭非懒"/> <meta itemprop="url" content="https://juejin.cn/user/2295436009296199"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 大模型应用开发｜基础原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436009296199/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    树獭非懒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T12:55:43.000Z" title="Thu Dec 18 2025 12:55:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：我们正处在AI的「iPhone时刻」</h2>
<p>我们正站在人工智能发展的历史拐点上。从2022年ChatGPT的横空出世，到如今各类大语言模型百花齐放，AI正从实验室走向千家万户，深刻改变着我们的工作与生活方式。本文将系统介绍AIGC与大模型的基础知识，帮助你理解这场技术革命背后的原理与演进脉络。</p>
<p>通过这篇博客，你将系统了解：</p>
<ol>
<li>AIGC与大模型的基本概念：它们是什么，又是如何演进而来的？</li>
<li>大模型的核心原理：了解驱动AI生成的“引擎”是如何工作的。</li>
<li>分析式AI与生成式AI的根本区别：看懂本次AI浪潮的独特之处。</li>
<li>生成式AI的训练过程：深入理解RLHF技术如何让AI更贴近人类意图。</li>
<li>丰富的应用场景：探索生成式AI正在如何改变各行各业。</li>
<li>延伸学习资源：获得进一步深入学习的资源推荐。</li>
</ol>
<h2 data-id="heading-1">一、AIGC与大模型</h2>
<h3 data-id="heading-2">1.1 AIGC 是什么</h3>
<p><strong>AIGC（AI Generated Content），</strong> 即人工智能生成内容。其核心在于「生成」二字。与传统的分析、判断不同，AIGC的输入是一个指令或提示（Prompt），输出则是全新的、连贯的、符合需求的内容，例如：</p>
<ul>
<li>一段文章或邮件</li>
<li>一张图片或一段视频</li>
<li>一段可运行的代码</li>
<li>一个数据分析报告</li>
</ul>
<h3 data-id="heading-3">1.2 AI的演进之路</h3>
<p>理解AIGC需要先了解AI的发展脉络：</p>
<ul>
<li>早期阶段：以规则为基础的专家系统，依赖预设的逻辑和规则。</li>
<li>机器学习时代：通过数据训练模型，使机器能够从数据中学习规律。</li>
<li>深度学习时代：利用神经网络模拟人脑的复杂结构，处理更复杂的任务。</li>
<li>大模型时代：以大规模数据和算力为基础，构建通用性强、性能卓越的AI模型。</li>
</ul>
<h2 data-id="heading-4">二、从GPT-1到GPT-4：大模型的进化之路</h2>
<p>大模型的能力飞跃并非一蹴而就，而是一个持续的演进过程。下表梳理了GPT系列的关键发展阶段：</p>








































<table><thead><tr><th>模型</th><th>发布时间</th><th>参数量</th><th>预测数据量</th><th>关键能力与意义</th></tr></thead><tbody><tr><td>GPT-1</td><td>2018年6月</td><td>1.17亿</td><td>约5GB</td><td>证明了Transformer架构在生成任务上的潜力，具有一定泛化能力。</td></tr><tr><td>GPT-2</td><td>2019年2月</td><td>15亿</td><td>40GB</td><td>展示了无监督多任务学习的潜力，在文本生成方面表现出强大天赋，但也引发了关于生成假新闻等伦理担忧。</td></tr><tr><td>GPT-3</td><td>2020年5月</td><td>1750亿</td><td>45TB</td><td>参数量实现巨大飞跃，展示了惊人的上下文学习（In-Context Learning） 和泛化能力，能完成写代码、创作、对话等绝大部分NLP任务。</td></tr><tr><td>InstructGPT/ChatGPT</td><td>2022年</td><td>基于GPT-3</td><td>-</td><td>引入了基于人类反馈的强化学习（RLHF），关键突破在于让模型的输出与人类意图对齐，更安全、有用、遵循指令。ChatGPT的“超能力”正源于此。</td></tr></tbody></table>
<h2 data-id="heading-5">三、大模型：驱动AIGC的“引擎”</h2>
<p>如果把AIGC比作一辆智能汽车，那么大模型就是它的“引擎”。当前我们使用的绝大多数AI生成应用，背后都离不开大语言模型的支持。</p>
<h3 data-id="heading-6">3.1 大模型：一个超级“文本预测器”</h3>
<p>你可以这样理解大模型：它就像是一个阅读了几乎整个互联网的“超级学习者”。通过分析海量的文章、对话、代码等文本，它学会了在什么样的上下文中，接下来最可能出现什么词。</p>
<p>比如，当你输入“今天天气很好，我们一起去……”时，模型可能会预测“公园”“散步”“爬山”等词，而不是“睡觉”或“开会”，因为它从训练数据中学会了这些常见的搭配模式。</p>
<h3 data-id="heading-7">3.2 Transformer：让AI真正“理解”上下文</h3>
<p>在Transformer出现之前，AI处理文本就像是一个只能记住最近几句话的人，容易忘记前文的内容。</p>
<p>在 Transformer 出现之前，AI处理文本的主要方式是使用 <strong>循环神经网络（RNN）</strong> 及其升级版 <strong>长短时记忆网络（LSTM）</strong> 。</p>
<p>RNN就像是一个“记忆力很差”的读者，读一句话，从左到右，边读边努力记住前面说了什么。RNN也是这样，它按顺序处理每个词，并生成一个“记忆”（隐藏状态）传递给下一个词。</p>
<p>为了解决RNN的健忘问题，LSTM被发明出来。它像是RNN带上了一个可以选择性记笔记的笔记本。</p>
<p>它有三个“门”（输入门、遗忘门、输出门），用来决定：</p>
<ul>
<li>记住什么（把重要信息写入笔记本）。</li>
<li>忘记什么（从笔记本上擦除不重要的旧信息）。</li>
<li>输出什么（根据当前输入和笔记本内容，给出回答）。</li>
</ul>
<p>相比RNN，LSTM能记住更长的信息，因此在2010年代中后期成为处理文本（如翻译、情感分析）的主流技术。</p>
<p>为它必须一个字一个字按顺序处理，无法并行计算。同时，对于非常长的文本（比如整篇文章），它的“笔记本”仍然不够用，重要信息可能还是会被遗忘。</p>
<p>而Transformer架构的突破在于，它让AI能够同时“看到”并理解整段话中所有词之间的关系。</p>
<p>简单来说，它让AI具备了全局理解能力：</p>
<ul>
<li>读句子时，知道每个词的重要性</li>
<li>理解“它”指代的是什么</li>
<li>把握长篇文章的核心脉络</li>
</ul>
<h3 data-id="heading-8">3.3 注意力机制：AI的“高亮笔”</h3>
<p>想象你在阅读一本教科书时，会用荧光笔标出重点内容。注意力机制就是AI的“智能高亮笔”——它让模型在处理信息时，知道应该重点关注哪些部分。</p>
<p>例如，当AI回答“苹果公司最新产品是什么？”时，它会更关注“苹果公司”“最新”“产品”这些关键词，而不是被“水果”“吃”“甜”这些无关含义干扰。</p>
<h2 data-id="heading-9">四、分析式AI vs. 生成式AI：本质区别</h2>
<p>我们知道了大模型是强大的“智能引擎”，那么，它主要驱动的是什么样的AI呢？这就引出了当前AI领域的核心分野：<strong>分析式AI与生成式AI。</strong></p>
<h3 data-id="heading-10">4.1 本质区别</h3>
<p>理解这两者的区别，是看懂本次AI浪潮的关键。简单来说：</p>
<ul>
<li>分析式AI 是专家和侦探，擅长分析现有数据，告诉你“是什么”和“为什么”。</li>
<li>生成式AI 是作家和创造者，基于学到的东西，创造出全新的内容。</li>
</ul>
<p>以我们前面讨论的大模型（如GPT）为核心的，正是生成式AI。下面我们通过一个清晰的对比</p>








































<table><thead><tr><th>维度</th><th>分析式AI</th><th>生成式AI</th></tr></thead><tbody><tr><td>核心目标</td><td>理解与分析现有数据，提炼洞察。</td><td>创造新的、与训练数据相似的内容。</td></tr><tr><td>它像什么</td><td>分析师/侦探</td><td>作家/设计师</td></tr><tr><td>典型任务</td><td>垃圾邮件识别、股价预测、商品推荐、人脸识别。</td><td>撰写邮件、智能对话、翻译、AI绘画、生成代码。</td></tr><tr><td>输出形式</td><td>一个标签、一个数值、一个是否的判断、一组列表。</td><td>一段文字、一张图片、一段代码、一个完整方案。</td></tr><tr><td>代表技术</td><td>逻辑回归、支持向量机、传统的推荐算法。</td><td>大语言模型 (GPT、文心一言)、扩散模型 (Stable Diffusion)。</td></tr><tr><td>与数据关系</td><td>从数据中发现隐藏的模式或边界。</td><td>学习数据的整体分布，并从中“想象”出新样本。</td></tr></tbody></table>
<h3 data-id="heading-11"><strong>4.2 训练方式差异</strong></h3>
<ul>
<li>
<p><strong>分析式AI</strong>以监督学习为主，需标注大量数据。</p>
</li>
<li>
<p><strong>生成式AI</strong>更多采用强化学习+奖励机制，鼓励模型自主探索最优解。</p>
</li>
</ul>
<h3 data-id="heading-12"><strong>4.3 生成式AI是人类大脑的仿真或复制品吗？</strong></h3>
<p>这是一个非常深刻且常见的问题。简单直接的回答是：不，生成式AI并不是在仿真人类大脑，它只是受到了人脑基本结构的启发，但走了完全不同的技术路径。</p>
<p><strong>灵感来源与基础结构</strong></p>
<ul>
<li>神经元网络灵感：人工神经网络（ANN）的概念确实源自对生物神经元（脑细胞）的简化模拟。一个“人工神经元”接收输入、进行加权计算、然后输出结果，这模仿了生物神经元通过突触接收和传递电信号的基本过程。</li>
<li>连接与学习：两者都通过调整“连接强度”（大脑是突触可塑性，AI是权重参数）来学习和记忆。</li>
</ul>
<p><strong>本质区别：从“仿形”到“数学模拟”</strong></p>
<p>虽然灵感来自大脑，但现代生成式AI（尤其是大模型）已经发展成一套纯粹的数学和工程系统，与大脑的运行机制截然不同。</p>
<p><strong>用一个经典比喻非常适合解释两者的关系：</strong></p>
<ul>
<li>鸟（大脑）：通过生物进化而来，通过扇动翅膀利用空气动力学飞行。这是自然的、有机的方案。</li>
<li>飞机（生成式AI）：受到鸟类飞行的启发，但并没有模仿扇动翅膀。它通过完全不同的原理（固定机翼和喷气发动机）来遵循相同的物理定律（空气动力学），最终实现了更高效、载重更大的飞行。</li>
</ul>
<p>同样：</p>
<ul>
<li>
<p>大脑：通过生物神经元和化学信号处理信息。</p>
</li>
<li>
<p>生成式AI：受到“神经元连接”的启发，但使用完全不同的方法（向量数学、梯度下降、注意力机制）来遵循相同的信息处理目标（从数据中学习模式并生成输出），最终在特定任务上实现了超越人类的表现。</p>
</li>
</ul>
<h2 data-id="heading-13">五、生成式AI的训练过程</h2>
<p>下面以ChatGPT为例，我们来看是如何训练出来的，在了解训练过程前，需要先了解下 RLHF 这个概念。</p>
<h3 data-id="heading-14">5.1 RLHF详解</h3>
<p><strong>RLHF （Reinforcement Learning from Human Feedback）</strong> ，中文译为基于人类反馈的强化学习。</p>
<p>它是一种用于训练人工智能系统，尤其是大语言模型的关键技术。它的核心思想是：<strong>让模型的优化目标与人类的真实偏好和价值观对齐，而不仅仅是完成一个预定义的、易于量化的技术任务。</strong></p>
<h3 data-id="heading-15">5.2 为什么需要RLHF？</h3>
<p>在RLHF之前，大型语言模型（如GPT-3）虽然能力强大，但存在明显问题：</p>
<ul>
<li>不遵循指令：回答可能冗长、答非所问或包含无用信息。</li>
<li>生成有害内容：可能产生带有偏见、有毒或不真实的信息。</li>
<li>“胡言乱语”：在不确定时，倾向于编造看似合理但事实错误的答案（即“幻觉”）。</li>
</ul>
<p>传统的训练方式（预测下一个词）让模型学会了“语言的统计规律”，但没能教会它“如何成为一个有用、诚实、无害的助手”。RLHF正是为了解决这个“对齐问题”而诞生的。</p>
<h3 data-id="heading-16">5.3 RLHF的工作流程详解（三步法）</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d89c56e01941f58ad8d250fb998309~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qCR542t6Z2e5oeS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766667433&amp;x-signature=4BOoK%2B8Q1RRMt2OmQlrmB4MoANs%3D" alt="" loading="lazy"/></p>
<p>通常，RLHF过程分为三个核心步骤：</p>
<p><strong>第一步：监督微调（Supervised Fine-Tuning, SFT）</strong></p>
<ul>
<li>
<p><strong>目标：</strong> 教会模型“如何回答”。</p>
</li>
<li>
<p><strong>过程：</strong></p>
<ul>
<li>聘请一批人类“老师”（标注员）。</li>
<li>“老师”根据一批问题（Prompt），编写高质量、符合要求的答案。</li>
<li>用这些（问题，答案）配对数据，在预训练好的大模型（如GPT-3.5）上进行有监督的微调。</li>
</ul>
</li>
<li>
<p><strong>结果：</strong> 得到一个初步的、会遵循指令进行回答的模型，称为 SFT模型。但这个模型的质量还不稳定，答案可能时好时坏。</p>
</li>
</ul>
<p><strong>第二步：训练奖励模型（Training a Reward Model, RM）</strong></p>
<ul>
<li>
<p><strong>目标：</strong> 建立一个能判断答案好坏的“AI裁判”，量化人类偏好。</p>
</li>
<li>
<p><strong>过程：</strong></p>
<ul>
<li>用SFT模型对同一个问题生成4-9个不同的答案。</li>
<li>将这批答案随机排列后，交给人类“老师”进行排序（从好到差）。排序比直接打分更可靠，因为人们更擅长做比较判断。</li>
<li>利用这些排序数据，训练一个独立的 <strong>“奖励模型”</strong> 。这个模型的输入是（问题，答案），输出是一个标量分数，用来预测人类对这个答案的偏好程度。</li>
</ul>
</li>
<li>
<p><strong>结果：</strong> 得到一个能模拟人类偏好的“奖励模型”，它可以自动给任何回答打分。</p>
</li>
</ul>
<p><strong>第三步：通过强化学习优化模型（Reinforcement Learning Optimization, e.g., PPO）</strong></p>
<ul>
<li>
<p><strong>目标：</strong> 让SFT模型在“AI裁判”的指导下，自我进化成终极助手。</p>
</li>
<li>
<p><strong>过程：</strong></p>
<ul>
<li>将SFT模型作为需要被训练的“智能体”（Agent），将奖励模型作为环境提供的“奖励信号”。</li>
<li>“智能体”针对一个新问题生成一个回答。</li>
<li>将这个回答输入“奖励模型”，得到一个奖励分数。</li>
<li>使用强化学习算法（如近端策略优化，PPO），根据这个奖励分数来更新“智能体”（即SFT模型）的参数，目标是使模型生成的回答能获得尽可能高的奖励分数。</li>
<li>为了防止模型“作弊”（例如，生成一堆无意义但能讨好奖励模型的词），通常会加入一个约束项，确保优化后的模型不会偏离最初的SFT模型太远（即保持语言能力不退化）。</li>
</ul>
</li>
<li>
<p><strong>结果：</strong> 最终得到与人类偏好高度对齐的模型，例如 ChatGPT。</p>
</li>
</ul>
<p>正是RLHF技术，让ChatGPT从“一个很会说话的学者”变成了“一个乐于助人且善于沟通的助手”。</p>
<h2 data-id="heading-17">六、生成式AI的应用场景</h2>
<p>生成式AI正从一个“新奇的技术”转变为“基础的生产力工具”。它的核心价值在于：</p>
<ol>
<li>处理海量信息，将无序数据变成结构化知识。</li>
<li>填补技能缺口，让不擅长写作、编程、设计的人也能产出合格成果。</li>
<li>激发创意灵感，提供更多可能性作为思考的起点。</li>
</ol>
<h3 data-id="heading-18">6.1 内容创作与营销（“你的全能创意助理”）</h3>
<ul>
<li>新媒体运营：自动生成社交媒体文案、短视频脚本、博客初稿，保持日更不再是难题。</li>
<li>广告与营销：根据产品特点，快速生成多版广告语、营销邮件、产品描述，并进行A/B测试。</li>
<li>个性化推荐：不仅推荐商品，更能为不同用户生成个性化的商品描述和购买理由。</li>
</ul>
<h3 data-id="heading-19">6.2 办公与效率提升（“你的超级同事”）</h3>
<ul>
<li>会议与邮件：自动生成会议纪要、提炼行动项；一键撰写或回复专业邮件。</li>
<li>报告与文档：输入数据和要点，自动生成结构完整、文笔流畅的分析报告、周报、方案书。</li>
<li>演示辅助：根据文档内容，自动生成PPT大纲、演讲稿，甚至设计建议。</li>
</ul>
<h3 data-id="heading-20">6.3 编程与软件开发（“你的外包程序员”）</h3>
<ul>
<li>代码生成与补全：根据自然语言描述（如“写一个Python函数读取CSV文件并绘图”）生成代码片段。</li>
<li>代码解释与调试：为复杂代码添加注释、解释其功能；帮助定位错误并提出修复建议。</li>
<li>不同语言间转换：将一种编程语言的代码转换成另一种。</li>
</ul>
<h3 data-id="heading-21">6.4 教育与学习（“你的私人导师”）</h3>
<ul>
<li>个性化辅导：根据学生的学习水平和问题，生成定制的练习题、解析步骤和知识总结。</li>
<li>内容制作：帮助教师快速生成教案、测验题目、教学案例。</li>
<li>语言学习：提供沉浸式的对话练习伙伴，并即时纠正语法和用词。</li>
</ul>
<h3 data-id="heading-22">6.5 客户服务与互动（“你的永不疲倦的客服”）</h3>
<p>传统客服依赖关键词匹配，理解能力有限；而基于生成式AI的客服系统能更自然理解用户意图，实现流畅对话，已在营销、咨询等场景广泛应用。</p>
<ul>
<li>智能问答与导购：7x24小时回答客户咨询，理解复杂问题，提供准确的产品建议和解决方案。</li>
<li>售后支持：引导用户完成故障排查、退货退款等流程，大幅降低人工客服压力。</li>
</ul>
<h3 data-id="heading-23">6.6 创意与设计（“你的灵感伙伴”）</h3>
<ul>
<li>图像与视觉设计：根据文字描述生成Logo初稿、营销海报、产品概念图、插画等。</li>
<li>音乐与音效：生成背景音乐、广告配乐或特定情绪的音效。</li>
<li>游戏与影视：快速生成游戏剧情对话、角色设定、虚拟场景描述，辅助剧本创作。</li>
</ul>
<h3 data-id="heading-24">6.7 数据分析与洞察（“你的数据分析师”）</h3>
<ul>
<li>自动报告：连接数据库后，可用自然语言提问（如“上月销量最好的三个产品是什么？”），AI自动查询并生成图文报告。</li>
<li>趋势预测与摘要：快速分析长篇市场报告、学术论文，提炼核心结论和趋势。</li>
</ul>
<p>未来，随着技术的发展，生成式AI将会像电力或互联网一样，成为各行各业不可或缺的基础设施，嵌入到每一个工作流程中。</p>
<h2 data-id="heading-25">附录：学习资源推荐</h2>
<p>想要更好的入门学习大模型，笔者推荐一些学习资源：</p>
<h3 data-id="heading-26">中文 LLM 教程全家桶</h3>
<ul>
<li>提示工程：prompt-engineering-for-developers（含吴恩达系列课程中文笔记） <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatawhalechina%2Fprompt-engineering-for-developers" target="_blank" title="https://github.com/datawhalechina/prompt-engineering-for-developers" ref="nofollow noopener noreferrer">github.com/datawhalech…</a></li>
<li>应用开发：llm-universe（面向小白的大模型应用开发全流程） <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatawhalechina%2Fllm-universe" target="_blank" title="https://github.com/datawhalechina/llm-universe" ref="nofollow noopener noreferrer">github.com/datawhalech…</a></li>
</ul>
<h3 data-id="heading-27">Awesome-Chinese-LLM 导航仓库</h3>
<ul>
<li>汇总 100+ 中文开源大模型、微调工具、数据集、部署方案与教程，每月更新。 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHqWu-HITCS%2FAwesome-Chinese-LLM" target="_blank" title="https://github.com/HqWu-HITCS/Awesome-Chinese-LLM" ref="nofollow noopener noreferrer">github.com/HqWu-HITCS/…</a></li>
</ul>
<h3 data-id="heading-28">视频 &amp; 报告资源</h3>
<p>吴恩达 2025 春季《大模型系统实战》全套中文字幕</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1T21PBqErg%2F" target="_blank" title="https://www.bilibili.com/video/BV1T21PBqErg/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1T2…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：Redis缓存与消息队列实践]]></title>    <link>https://juejin.cn/post/7585013463858757682</link>    <guid>https://juejin.cn/post/7585013463858757682</guid>    <pubDate>2025-12-18T11:10:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585013463858757682" data-draft-id="7585021315691724810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：Redis缓存与消息队列实践"/> <meta itemprop="keywords" content="后端,Node.js,面试"/> <meta itemprop="datePublished" content="2025-12-18T11:10:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：Redis缓存与消息队列实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:10:52.000Z" title="Thu Dec 18 2025 11:10:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在高并发、高性能的后端系统中，单纯依赖数据库往往无法满足性能和扩展性的要求。Redis 作为一款高性能的内存数据库，常被用于缓存系统、消息队列、分布式锁等场景。在 Node.js 项目中，Redis 与异步 I/O 模型天然契合，是构建高性能服务的重要基础组件。本文将重点介绍 Redis 在缓存与消息队列中的实际应用。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、为什么在 Node.js 中使用 Redis</h2>
<p>Redis 具备以下核心特点：</p>
<ul>
<li>数据存储在内存中，读写速度极快</li>
<li>支持多种数据结构，如字符串、哈希、列表、集合等</li>
<li>提供持久化机制，防止数据完全丢失</li>
<li>支持发布订阅、事务和 Lua 脚本</li>
<li>在高并发场景下表现稳定</li>
</ul>
<p>在 Node.js 项目中，Redis 常用于缓解数据库压力和实现异步解耦。</p>
<hr/>
<h2 data-id="heading-1">二、Redis 的基础概念</h2>
<p>在使用 Redis 之前，需要理解几个常见概念：</p>
<ul>
<li><strong>Key-Value 存储</strong>：所有数据都通过键访问</li>
<li><strong>内存数据库</strong>：主要数据存储在内存中</li>
<li><strong>数据结构</strong>：字符串、哈希、列表、集合、有序集合</li>
<li><strong>过期机制</strong>：支持设置 Key 的过期时间</li>
</ul>
<p>这些特性使 Redis 非常适合缓存和消息传递。</p>
<hr/>
<h2 data-id="heading-2">三、Node.js 连接 Redis</h2>
<h3 data-id="heading-3">1. 安装客户端库</h3>
<p>目前较常用的 Node.js Redis 客户端是 <code>redis</code> 官方库。</p>
<pre><code class="hljs language-bash" lang="bash">npm install redis
</code></pre>
<hr/>
<h3 data-id="heading-4">2. 创建 Redis 连接</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { createClient } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"redis"</span>);

<span class="hljs-keyword">const</span> client = <span class="hljs-title function_">createClient</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">"redis://localhost:6379"</span>
});

client.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Redis error"</span>, err));

<span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
</code></pre>
<p>连接成功后，即可进行缓存和消息操作。</p>
<hr/>
<h2 data-id="heading-5">四、Redis 作为缓存使用</h2>
<h3 data-id="heading-6">1. 缓存基本思想</h3>
<p>缓存的核心目标是：</p>
<ul>
<li>减少数据库访问</li>
<li>提高接口响应速度</li>
<li>缓解高并发压力</li>
</ul>
<p>常见模式是：<strong>先查缓存，缓存未命中再查数据库</strong>。</p>
<hr/>
<h3 data-id="heading-7">2. 设置与读取缓存</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">await</span> client.<span class="hljs-title function_">set</span>(<span class="hljs-string">"user:1"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user), {
  <span class="hljs-attr">EX</span>: <span class="hljs-number">60</span>
});

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">get</span>(<span class="hljs-string">"user:1"</span>);
<span class="hljs-keyword">const</span> userData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(cache);
</code></pre>
<p>通过设置过期时间，可以避免缓存数据长期不更新。</p>
<hr/>
<h3 data-id="heading-8">3. 缓存数据库查询结果</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">const</span> key = <span class="hljs-string">`user:<span class="hljs-subst">${id}</span>`</span>;
  <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">get</span>(key);

  <span class="hljs-keyword">if</span> (cache) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(cache);
  }

  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">findUserById</span>(id);
  <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">set</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user), { <span class="hljs-attr">EX</span>: <span class="hljs-number">300</span> });

  <span class="hljs-keyword">return</span> user;
}
</code></pre>
<p>这种方式在读多写少的场景下效果显著。</p>
<hr/>
<h2 data-id="heading-9">五、缓存设计注意事项</h2>
<p>在使用 Redis 作为缓存时，需要注意：</p>
<ul>
<li>避免缓存穿透和缓存雪崩</li>
<li>合理设置过期时间</li>
<li>缓存数据应可被丢弃</li>
<li>更新数据时及时更新或删除缓存</li>
</ul>
<p>缓存并不是数据库的替代，而是性能优化手段。</p>
<hr/>
<h2 data-id="heading-10">六、Redis 作为消息队列</h2>
<p>除了缓存，Redis 也可以用于实现轻量级消息队列。</p>
<h3 data-id="heading-11">1. 使用 List 实现队列</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 生产者</span>
<span class="hljs-keyword">await</span> client.<span class="hljs-title function_">lPush</span>(<span class="hljs-string">"task_queue"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(task));

<span class="hljs-comment">// 消费者</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">brPop</span>(<span class="hljs-string">"task_queue"</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> task = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result.<span class="hljs-property">element</span>);
</code></pre>
<p><code>BRPOP</code> 是阻塞式弹出，非常适合任务消费场景。</p>
<hr/>
<h3 data-id="heading-12">2. 应用场景</h3>
<ul>
<li>异步任务处理</li>
<li>日志收集</li>
<li>发送邮件或通知</li>
<li>削峰填谷</li>
</ul>
<p>通过消息队列，可以有效解耦系统模块。</p>
<hr/>
<h2 data-id="heading-13">七、Redis 发布订阅模式</h2>
<p>Redis 原生支持发布订阅机制。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 订阅者</span>
<span class="hljs-keyword">const</span> sub = client.<span class="hljs-title function_">duplicate</span>();
<span class="hljs-keyword">await</span> sub.<span class="hljs-title function_">connect</span>();
<span class="hljs-keyword">await</span> sub.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">"news"</span>, <span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Received:"</span>, message);
});

<span class="hljs-comment">// 发布者</span>
<span class="hljs-keyword">await</span> client.<span class="hljs-title function_">publish</span>(<span class="hljs-string">"news"</span>, <span class="hljs-string">"Hello Redis"</span>);
</code></pre>
<p>发布订阅适合广播式消息，但不保证消息可靠性。</p>
<hr/>
<h2 data-id="heading-14">八、Redis 在 Node.js 项目中的常见架构</h2>
<p>在实际项目中，Redis 往往承担多个角色：</p>
<ul>
<li>作为缓存层，位于数据库之前</li>
<li>作为消息队列，处理异步任务</li>
<li>作为共享状态存储，用于分布式系统</li>
<li>与 WebSocket、定时任务等模块配合使用</li>
</ul>
<p>合理设计 Redis 使用方式，是系统稳定性的关键。</p>
<hr/>
<h2 data-id="heading-15">九、性能与稳定性建议</h2>
<p>在高并发环境下使用 Redis，需要注意：</p>
<ul>
<li>使用连接池或复用连接</li>
<li>避免大 Key 和热 Key</li>
<li>控制单条数据大小</li>
<li>监控内存使用情况</li>
<li>生产环境启用持久化策略</li>
</ul>
<p>Redis 虽然性能强大，但仍需要精心设计。</p>
<hr/>
<h2 data-id="heading-16">十、总结</h2>
<p>通过本文，你已经学习了：</p>
<ul>
<li>Redis 在 Node.js 中的基本作用</li>
<li>Redis 作为缓存的实现方式</li>
<li>Redis 实现消息队列的思路</li>
<li>发布订阅模式的使用场景</li>
<li>项目中的架构与性能注意事项</li>
</ul>
<p>Redis 是 Node.js 后端开发中的重要基础组件。合理使用 Redis，不仅能显著提升系统性能，也能让整体架构更加清晰和可扩展。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：数据库连接池与性能优化]]></title>    <link>https://juejin.cn/post/7585021315691741194</link>    <guid>https://juejin.cn/post/7585021315691741194</guid>    <pubDate>2025-12-18T11:11:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585021315691741194" data-draft-id="7585013463858774066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：数据库连接池与性能优化"/> <meta itemprop="keywords" content="后端,Node.js,JavaScript"/> <meta itemprop="datePublished" content="2025-12-18T11:11:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：数据库连接池与性能优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:11:20.000Z" title="Thu Dec 18 2025 11:11:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 后端开发中，数据库性能往往决定了整个系统的吞吐能力和稳定性。很多性能问题并不来自业务逻辑本身，而是由于数据库连接管理不当造成的。合理使用数据库连接池，并结合针对性的优化策略，是构建高性能 Node.js 应用的关键一步。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、为什么需要数据库连接池</h2>
<p>数据库连接并不是“免费”的资源。每次创建连接，数据库服务器都需要进行身份验证、分配内存和维护会话状态。如果在每个请求中都创建并销毁连接，在高并发场景下会造成严重的性能浪费，甚至触发数据库连接数耗尽的问题。</p>
<p>数据库连接池的核心思想是复用连接。应用在启动时创建一定数量的连接并统一管理，请求到来时从池中获取连接，使用完成后再归还。这样可以避免频繁的连接创建和销毁，提高整体响应速度，同时让数据库的负载更加稳定。</p>
<hr/>
<h2 data-id="heading-1">二、Node.js 中的连接池工作机制</h2>
<p>在 Node.js 中，大多数主流数据库驱动都内置了连接池支持。连接池通常维护以下几个关键参数：</p>
<ul>
<li>最大连接数，用于限制数据库的并发连接数量</li>
<li>最小连接数，用于保证基础并发能力</li>
<li>空闲超时时间，用于回收长期未使用的连接</li>
<li>等待队列，用于处理连接池已满时的请求</li>
</ul>
<p>当请求需要访问数据库时，连接池会优先分配空闲连接。如果没有可用连接，请求将进入等待队列，直到有连接被释放或触发超时。</p>
<hr/>
<h2 data-id="heading-2">三、MySQL 连接池实战</h2>
<p>在 Node.js 项目中，<code>mysql2</code> 是一个常用且性能优秀的 MySQL 客户端。它对连接池提供了良好的支持。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mysql2/promise'</span>);

<span class="hljs-keyword">const</span> pool = mysql.<span class="hljs-title function_">createPool</span>({
  <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
  <span class="hljs-attr">user</span>: <span class="hljs-string">'root'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'password'</span>,
  <span class="hljs-attr">database</span>: <span class="hljs-string">'test_db'</span>,
  <span class="hljs-attr">waitForConnections</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">connectionLimit</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">queueLimit</span>: <span class="hljs-number">0</span>
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">queryUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [rows] = <span class="hljs-keyword">await</span> pool.<span class="hljs-title function_">query</span>(<span class="hljs-string">'SELECT * FROM users'</span>);
  <span class="hljs-keyword">return</span> rows;
}
</code></pre>
<p>在实际开发中，应避免手动频繁创建连接，而是始终通过连接池执行查询。这样不仅代码更加简洁，也能有效防止连接泄漏问题。</p>
<hr/>
<h2 data-id="heading-3">四、PostgreSQL 连接池实践</h2>
<p>PostgreSQL 在 Node.js 生态中常用 <code>pg</code> 库，它默认就采用连接池模式。开发者只需要配置 Pool 对象即可。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">Pool</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pg'</span>);

<span class="hljs-keyword">const</span> pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>({
  <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
  <span class="hljs-attr">user</span>: <span class="hljs-string">'postgres'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'password'</span>,
  <span class="hljs-attr">database</span>: <span class="hljs-string">'test_db'</span>,
  <span class="hljs-attr">max</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">idleTimeoutMillis</span>: <span class="hljs-number">30000</span>,
  <span class="hljs-attr">connectionTimeoutMillis</span>: <span class="hljs-number">2000</span>
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getOrders</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pool.<span class="hljs-title function_">query</span>(<span class="hljs-string">'SELECT * FROM orders'</span>);
  <span class="hljs-keyword">return</span> result.<span class="hljs-property">rows</span>;
}
</code></pre>
<p><code>pg</code> 的连接池在高并发场景下表现稳定，特别适合对数据一致性和事务要求较高的系统。</p>
<hr/>
<h2 data-id="heading-4">五、连接池参数如何合理设置</h2>
<p>连接池参数并非越大越好，盲目增加连接数反而可能拖垮数据库。一般建议从以下几个角度进行配置：</p>
<p>数据库服务器的最大连接数是上限，应用的连接池总数不应接近该极限。对于中小型应用，连接池大小通常设置在 5 到 20 之间即可。</p>
<p>在高并发业务中，可以适当增加连接池大小，但必须结合数据库的 CPU、内存和磁盘性能综合评估。通过压力测试来验证配置效果，是最稳妥的做法。</p>
<hr/>
<h2 data-id="heading-5">六、避免常见的连接池使用误区</h2>
<p>在实践中，以下问题非常容易导致性能下降：</p>
<p>长时间占用连接而不释放，尤其是在复杂业务逻辑或事务中。
在循环或递归中频繁执行数据库操作，导致连接被迅速耗尽。
在应用中混用连接池和单独连接，增加管理复杂度。</p>
<p>良好的习惯是在最小作用域内使用数据库连接，避免将连接对象传递到不必要的逻辑层。</p>
<hr/>
<h2 data-id="heading-6">七、数据库层面的性能优化建议</h2>
<p>连接池只是性能优化的一部分，数据库本身的优化同样重要。合理设计索引可以显著减少查询时间，避免全表扫描。对高频查询的数据进行缓存，可以减少数据库压力。尽量减少复杂联表操作，将部分计算逻辑前移到应用层，也有助于提升整体性能。</p>
<p>在 Node.js 项目中，应定期通过慢查询日志和监控工具分析数据库瓶颈，持续优化访问模式。</p>
<hr/>
<h2 data-id="heading-7">八、总结</h2>
<p>在 Node.js 后端开发中，数据库连接池是保障性能和稳定性的基础设施。通过合理配置连接池、规范使用方式，并结合数据库层面的优化策略，可以显著提升系统的并发能力和响应速度。</p>
<p>在《Node.js 编程实战》系列中，掌握连接池的原理与实践，是从“能用”走向“高性能可扩展”的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从资深开发到脱产管理的心态转变]]></title>    <link>https://juejin.cn/post/7585024562216370216</link>    <guid>https://juejin.cn/post/7585024562216370216</guid>    <pubDate>2025-12-18T11:17:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585024562216370216" data-draft-id="7585007321206964276" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从资深开发到脱产管理的心态转变"/> <meta itemprop="keywords" content="后端,算法,程序员"/> <meta itemprop="datePublished" content="2025-12-18T11:17:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青鸟218"/> <meta itemprop="url" content="https://juejin.cn/user/847071020589192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从资深开发到脱产管理的心态转变
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/847071020589192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青鸟218
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:17:51.000Z" title="Thu Dec 18 2025 11:17:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"🦄";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"🐳";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"🐄";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"🦥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"🦩";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"🐧";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"❝"}.markdown-body blockquote:after{right:10px;bottom:0;content:"❞"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"· "}.markdown-body strong:after{content:" ·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>有一段时间没发过文了，主要是换了工作太忙，现在才稍微有一点时间，总结一下这些时间的想法，自己如何从一个技术开发到完全脱产的转变。</p>
<h2 data-id="heading-1">换工作</h2>
<h4 data-id="heading-2">原因</h4>
<p>5月份主动换了工作，虽然都在说大环境不好，但还是选择了离开。<br/>
原因有几点：<br/>
一是公司自己业务在不断萎缩，上层领导为了融资三天变一个口号，导致我对自己的职业生涯感觉很迷茫<br/>
二是看不到什么发展前景，担心真拿到融资上面领导倒是能拿到钱走了，我们这些到时候不知道何去何从<br/>
三是积怨已久，前面已经裁了几轮，但是在人员情况明显不够的情况下，某个同事只因为得罪领导就被无情裁员，感觉公司越来越像家族性企业<br/>
四是和直属领导不合，甚至吵了一架<br/>
五是这种温水煮青蛙的环境实在不适合待下去，与其被动等着被裁，还不如主动突破，我向来不是喜欢这种明知道一把大刀要落下还不跑的感觉<br/>
出于以上几点原因，决定换一份工作。</p>
<h4 data-id="heading-3">找工作历程</h4>
<p>决定换工作后，马上更新了自己的简历，主要在BOSS、智联还有拉勾上投递，简历更新后，确实发现今年环境大不如前或者说是自己年龄已到逼近行业上限（30岁）。<br/>
以前只要更新简历，很多外包猎头就一堆一堆的打招呼，现在每天就那么四五个外包。<br/>
首先，找工作也需要明确目标，要有自己大概的一个工作画像。<br/>
我的画像是这样：<br/>
1.外包的不要，最开始的第一份工作就是在项目外包的公司做的，给我的感觉就是软件行业打螺丝，流水线似的一个项目接一个项目，完全没有什么成就感<br/>
2.定了目标最低薪资（不能低于现在公司待遇），低于这个要求的不去
3.自主性不高的不去，在这家公司很多想法不能落地，因为自己也算是稍微有技术追求的那一类，只为实现CRUD不是我的目标，要漂亮的实现CRUD才是我的追求<br/>
怀着以上三点开启了边公司划水边投简历的过程，当然，显而易见的以上三点直接排除了市面上百分之六七十的工作，收到的回复也少之又少。不过好在现在公司还没裁员，还能一边苟着一边找，时间还算宽裕。<br/>
这段时间大概经历了两个月左右，也就是我是从3月份开年就开始找的，最后到5月份才算找了一个不是非常满意的工作。</p>
<p>先说说这几个月的总结：<br/>
1.正统互联网大厂是不看的，投了基本没回复，想想也是，双非本+30岁，没什么太特殊的技能基本是入不了眼的<br/>
2.外包倒是有几个，相较其他的还算比较积极，但是不想去<br/>
3.一般大型国有企业，基本能聊上两句，但很看重行业相关性，基本也没收到过面试邀请<br/>
4.一般中型公司，螺丝岗倒是有几个，但目前很多处于裁员阶段，基本就是不知道能干多久的<br/>
5.创业型小公司，不多说了，虽然以前没呆过，但从朋友那也了解了一二，懂得都懂<br/>
最后，选了一家加上我部门只有两个人的公司，好笑不好笑，很多人可能以为我疯了，包括我老婆在内。<br/>
说说为什么选这家公司的理由：<br/>
1.这家公司目前的情况是没有产研部门，想自己开发软件，但相较于一般的那种创业型的公司不同，他自己以前是传统行业且有一定的回血能力<br/>
2.这家公司面了很多次，和老板也聊了不少次，老板虽然一直身处传统行业，但眼光确实不一样，比较长远也很明白现在互联网那一套逻辑<br/>
3.自主性很强，入职后能在很大程度上决定产品走向，进来的时候公司就一个产品经理
4.和唯一的产品经理了解后，听说发工资还是挺正常的，还没出现过延迟（除节假日）不发的情况<br/>
当然，也有几个想要放弃的理由：<br/>
1.面试很多次，而且是反复面试，前后一两个月，他们找了不同的人面试了六七次，说实话有点烦了，后面面试我基本都在敷衍了<br/>
2.薪资待遇给不了太高，只能说维持在和现在公司不变的水平<br/>
3.福利待遇机制完全不健全，公积金没有，最后知道后准备放弃，又打电话说可以有，而且可以有的范围也不确定<br/>
最后基于自主性强和工资不拖欠选择了这家公司，可能很多人不理解，说说我的想法，自己毕竟年纪也不小了，大公司进不去，外包就算去了干个三五年也会遇上裁员问题，再一个就是想自己去决定产品走向看看自己的想法和商业之间的差距。</p>
<h2 data-id="heading-4">入职后</h2>
<p>说实话，入职当天就给我一种来错了的感觉，原因是上一周还在和我联系的目前唯一在职的一个hr已经离职了。虽然来之前大致了解了下情况，但没想到还是当头一棒。<br/>
做了几下心理建设，也就过去了，虽然hr没了，但是还是能正常入职。<br/>
一周时间和产品、老板反复交流，也大致了解了目前情况，对于我来说可以是第一开局。
情况如下：
1.公司hr还有一位，不过在休产假。<br/>
2.薪资待遇重新找老板确定，因为上一个hr交接问题，很多事项都被搁置<br/>
3.部门情况是只有一名产品，其他人员皆不到位<br/>
4.休假、加班等等一般制度是没有的<br/>
5.产品当然只停留在PPT阶段，完全没有启动<br/>
6.老板虽然思维很跟得上时代，但软件行业完全不了解<br/>
7.没有电脑等办公用品，需要额外采购<br/>
等等。。。<br/>
了解了情况后，我发现除了资金还算到位，其他的和新创建一个软件公司没什么区别，自主性是比较足的，就是足过头了，有种创业的感觉（后续发展也确实差不多）。<br/>
正常来说，很多人可能第二天就不来了，但是我想了下，其实这也是一种不错的机会，能体验到从零建立团队的整个过程，只要正常发工资，在哪干不是干呢，这种机会还不多。<br/>
入职前，我的最高经验只是一个后端开发组长+高级开发工程师，最多的时候也只带了7个人的后端团队，但既然问题摆在那，那就一件件处理，我向来不是一个喜欢摆烂或是遇见问题就投降的人。<br/>
首先，我的直属领导是老板，于是我在三天内做了一个简单的PPT，介绍一下软件行业的人员角色划分和软件项目开发流程，PPT不是我的强项，但是好在现在有AI，又资费三百块买了个WPS的会员，大致做了一下只要能正确不是很难看的展示我想说的内容就行了。也庆幸老板是个务实的人，不在乎那么多花里胡哨的东西。<br/>
为什么要先做这一步？因为要组建团队至少要让老板明白需要哪种人，要让他至少知道自己花钱会划在哪里。<br/>
和老板解释过后，剩下的就是需求评估，产品需求调研这块做的还算比较久，再和老板讨论了一下方案，明白了他想做什么，我也知道了系统大致架构应该是什么样。<br/>
接下来就急需解决几个问题：<br/>
1.电脑及配套的采购清单，这块简单，京东上找了一款适合开发的笔记本发给了行政（什么是适合开发的电脑？必须是笔记本，然后内存和磁盘够大，CPU一般看得过去就行，显卡不在乎，不能太重）<br/>
2.人员招聘，产品经理有了，关键岗位缺资深运维、资深前端、一般测试和一般的后端，为甚如此配置，首先我自己很多年不搞服务器这块了，需要一个人去管理我们的服务器这些资源的情况，然后我自己是后端，也很多年不搞前端的事了，测试当然是必须的，另一个后端主要是要补我空缺的开发量，分公司情况一张纸就能说清，不只是业务开发这点事要做，继续往后你们就清楚了。<br/>
然后，接下来的时间，我在BOSS上注册了一个账号，有一定免费额度，也发布了几个岗位，公司一直有智联的套餐，也在上面发布了岗位。<br/>
因为没有hr，我每天到公司第一件事就是把这两个平台登上，看看里面的投递信息。最后统计了下，这一两个月时间看了两千多份简历，面试了几百个人。这段时间我每天主要时间基本都是在面试和看简历上面。<br/>
其次，资源评估也不能落下，根据和产品、老板的讨论结果，评估需要用的技术和资源，把结果和老板评估。<br/>
同时，抽空搭建后端框架，把基本的登录、鉴权以及基本的权限管理这块做了（别问我为什么不用低代码和开源框架，因为定位是长期迭代的产品，不是一次性项目，为了后面业务风险可控，不会考虑这两种方式）。<br/>
中间运维和后端开饭先来，先让运维根据我的想法，把实际资源情况（打折后的价格）报价做出来，开发先花一周时间熟悉框架，让后接手我做的权限管理的代码。<br/>
后续前端来了后，让他花两周时间搭建了前端框架。<br/>
整个基本人员到位，用了两个来月时间，项目正式启动是在七月份，中间怕我事情较多还额外补充了一个后端。</p>
<h2 data-id="heading-5">正式开发</h2>
<p>目前人员分配是，3个后端（包括我）+1个前端+1个测试+1个产品+1个运维+1个UI<br/>
七月十多号正式启动项目开发阶段，找了一个第三方免费的项目管理 + 代码管理 + 文档管理的工具正式开发<br/>
期间就是开发时间评估、任务分发，我一般负责一些公共的部分或架构方面的开发，把业务基本交给了两个后端同事。<br/>
开发这部分的工作并不太占用时间，最占用时间的是这之外的事，比如和老板讨论方案，和财务讨论发票报税问题，还有人事行政这边的人员福利待遇，还有法务相关的什么隐私条款、用户协议之类的等等这种非开发的工作。<br/>
还有就是对外的，技术上选择厂商也要来回拉扯，比如短信、服务器、视频接入不光要看技术实现和每家的开放文档，还要同时找不同家报价，比对选一个最优的，一来二去一周时间过的飞快。<br/>
最后发现，沟通才是最大的成本。<br/>
进入正式开发阶段后，我这边的开发工作也渐渐交给了其他两位同事处理，不是因为不想做，主要是很多非开发的事项经常打断我的开发节奏，甚至有时候还会拖累整个开发计划，这点也是以前做开发或是组长没想到的点。<br/>
这种经常需要商务会面或是其他事项处理的事也让我很难进入开发节奏。<br/>
在开发的中后期，我也基本不再做开发相关的工作，转头聚焦如何让整个团队更好的按计划实现。<br/>
当然，这其中也出现很多意外，印象最深刻就是员工离职。<br/>
由于公司属于创业阶段，各项福利待遇、薪酬制度都不完善，导致好不容易招进来的人也及其不稳定，其中一个后端离职，导致整个工作进度延缓。<br/>
不得已只能将他的工作交给另一个人，于是整个团队也开启了为期一个月的加班时间。<br/>
还有就是行政制度，因为老板以前是做传统行业的，对软件这行了解不深，其中的一些制度相关的也基本没有，于是为了保障我们这几个人的福利，把包括公积金、社保、加班、调休、请假等事项先定了下来。<br/>
这一块最难的就是需要让老板理解软件行业的基本标配，以前的传统部门对这一块都比较随意，但大家也明白，软件行业基本是比较严格的。<br/>
然后就是法律层面的问题，涉及到这样合规那样合法，还要根据法律法规不断修改业务功能。然后上架，发布也是，各个部门报备、认证。<br/>
最后是财务，申请打款、合同管理、发票管理还有对公转账等等。这里遇到最印象深刻的一个问题是，我们的app要发ios版，但需要先申请苹果的开发者账户，然后企业版开发者账户极其难通过，想到也不贵一年也就六百多就先注册了一个账号交了钱，结果后面报账才发现，苹果开不出发票，原因是注册开发者账号这个订单归属的是国外的公司，没有开票的途径，只有一个收款凭证。但是公司财务是不认这个的，拉扯了半天想想也算了，不多，也就自己认了。（还是国外公司玩的花，偷税漏税这块确实门路多）。<br/>
最后磕磕碰碰弄了三个月不到的时间，总算把第一版系统 + app发布到线上，虽然问题还是很多，但至少有了一个基础版，可以在上面修修补补了。<br/>
也在同时迎来了转正，由于公司目前还没有专业的人对我进行转正评估，最后就和老板沟通了一下，没想到重新定薪转正涨薪后的幅度还是超过了我的预期的。<br/>
开始不想进来的一大原因就是薪资没有到我的期望区间，只是最后和老板协商看试用期效果再决定，一般以为只是说说而已，我也准备了如果觉得这三个月不合适，就直接走人，没想到老板还是很有诚意的（钱）。<br/>
中间还涉及到软著、专利这些知识产权的保护事项。<br/>
后面又接到老板需求，想要扩大要做的业务，于是又是一个轮回。<br/>
评估需求-》评估时间-》评估人员-》评估服务资源-》发布岗位需求-》面试-》人员基本就位-》团队内部需求评估-》功能设计-》开发。<br/>
于是下半年，团队扩充到了近20人，这中间也不免担忧资金问题，包括团队内部也有很多人担心这块。在产品没有经过市场验证的时候就大规模扩充人员，期间也找老板聊过几次，沟通了自己想法。<br/>
可能随着了解，老板也认识到时间紧迫，不得不提前推动他的计划。虽然担忧是少不了的，人多了，压力也更大了，这么多人说不定哪天就大家一起卷铺盖走人了。<br/>
等到人员就位后管理制度也慢慢需要加上，按角色按业务水平和纵向分，由于没有准备找额外的项目经理，就让产品担负起业务相关的事，指定不同角色负责人担负开发的事。</p>
<h2 data-id="heading-6">新一轮问题</h2>
<p>人多了，产品形态更复杂了，事情也越来越多了（非开发）。<br/>
最直观的一点就是和人打交道的时候更多了，比如涉及到更多的技术选型的厂家、硬件设备的厂家、律所、教授、老板的各种朋友等等。<br/>
有些是直接去找的，有些是老板的关系，反正各种各样的人也见了不少。<br/>
第二个方面就是团队问题，初期的团队确实极其不稳定，经常今天这个和那个扯，那个和这个扯的，还需要在中间仲裁，下结论。<br/>
然后由于不清楚每个人的能力，还要考虑到任务分配问题，会不断去尝试分配不一样的任务去摸一下这个人的底在哪里，了解他哪方面熟悉，哪方便不熟悉。<br/>
最后是督促，虽然都知道大家是拿钱打工的，不可能太主动，那我就必须成为这个主动的人，不然整个团队都会停滞不前，需要有人定方向，开发的时间节点，交付质量等等。<br/>
于是在各种沟通中还要抽空给每个角色负责人分任务，先定大的方向，再分下去。比如谁去调研设备厂商，谁去完成需求设计，哪个负责哪一块，然后内部沟通、学习也少不了，学习会议的目的不是为了真到让大家能学到什么（至少目前是这样），主要就几个目的，一是团队刚成型，加深团队内部的熟悉，二是看看哪些人学习意愿较强（比如一个追求技术的他会自己花时间去了解不熟悉的东西，反映在学习文档上的深度也是不一样的）以后可以多往这个方向培养。<br/>
其实我向来不是一个喜欢沟通的人，但目前在这个位置上也不得不去做这些事。<br/>
现在回过头，确实和一些前辈说的一样，干这些事比敲代码累，不是体力上或脑力上的，是心累。<br/>
虽然现在工作时间和以前没法比，非特殊情况一般也不会要求大家加班，但就算是每天按时下班，回家的精神状态还是远不如以前（可能也有上了三十岁这个原因）。<br/>
如果问我做这些大半年习惯现在的节奏没，我只想说完全没有，因为现在每天都会遇上新的人、新的事、新的需要沟通的点。<br/>
这不像敲代码，网上找找资料，问问AI或是看看源代码就完了，这些事没有标准答案，很多都需要自己去摸索，也很少有人会和你提意见，因为在公司，我这个职位就算是软件的专业岗位了，我的很多决定可能就算是公司软件这块的决定。<br/>
然后为了产品能够运行起来，其他各个部门也慢慢成立起来，比如商务、运营、供应链等等。</p>
<h2 data-id="heading-7">一些想法</h2>
<h6 data-id="heading-8">心态</h6>
<p>心态上的转变是巨大的，从一个开发到部分开发再到完全不开发，这中间的心态变化还是很大的，既担心不做开发了以后这里干不下去技术也生疏了，往后怎么找工作的问题，又担心不往上走只做开发以后也没什么好的发展，现在只能一边做管理一边抽空再研究下技术或是没事的时候review一下别人的代码保持技术的思维。</p>
<h6 data-id="heading-9">考证</h6>
<p>单独列出来这一项是因为以前基本不在乎，认为行业内对证书的认可度并不高，但到了管理这层才觉得，这东西不是什么认不认的问题，是一项比较刚性的要求。举个例子，大部分政府项目投标的要求上项目经理必须有高级软考证书。或是如果企业通过聘用方式也需要有这种证书，至于什么是聘用制什么是合同制，大家感兴趣的可以去了解下。<br/>
目前也在计划把高级软考考下来，希望在用的时候不至于手足无措。</p>
<h6 data-id="heading-10">技术与业务</h6>
<p>行业内一直都有技术优先还是业务优先的讨论，现在的想法是只要业务能满足需求，技术这块我都会建议同事们去尝试，不为别的，只是想在能保证业务不受影响的情况下让大家思维更加活跃，不拘泥于现状。出错的风险肯定会增加不少，但有时候往往有很多意想不到的效果。<br/>
自己本来也算比较喜欢捣鼓技术的人，所以也鼓励创新。角色转变后这种想法甚至更加深刻，举个例子，在我们公司传统业务需求上，要把一个建筑的平面图做好需要花费大量的人力和时间，但是如果只是满足不那么精准的构图，传统的手机加VR平台就能完成这块，这是以前他们从来没考虑过的事，他们想的是找人量图，通过CAD等软件生成。<br/>
再比如，老板前段时间说的想把录音输出成文字直接记录的功能，实际上现在手机上任何一款打字软件都有语音转文字的功能，只是平时没有用到，而我们需要做的只是简单的让他能通过一个按钮就把这块功能展示出来就行了。在行业外看似很高大上的功能点，可能在我们行业都是一些稀松平常常见的技术，只是如何将这些展示给他们使用的问题。<br/>
同样，在业务侧看上去可能很复杂的事，通过我们的技术手段，实际上也都是有可解决的方案的。这一点不止业务和技术，甚至产品和技术之间也存在很大的壁垒，没做过技术的产品，实际上很多思考方式或设计原理都比较局限。这一点在我作为管理者的这段时间深有体会，我想到的很多能通过技术手段解决的方式，可能他们从来没有从这些方面去考虑过。所以，经常的思维碰撞确实是很有必要的。</p>
<h6 data-id="heading-11">沟通</h6>
<p>角色转变后，沟通确实很重要，不管我喜欢或是不喜欢，现在我基本百分之六十的事都是在和各式各样的人沟通，有团队内部的、外部的，公司内的或是外面的，我没有什么沟通技巧，向来也直来直去，但形势逼人，有时候确实还是要委婉点。不管事情做的怎么样，能不能合作，至少大部分表面上都是和和气气的，包括竞争对手也是。<br/>
沟通重要，但不是绝对的，事情总是看你能不能成功，沟通其实只是一种手段，就像技术也同样只是一种手段一样，能把事干好，即使你一句话也不说其实也没什么关系。但管理上涉及的基本是商务层级，沟通确实避免不了。<br/>
最近几个月给我最大的感觉就是各个角色、行业间的信息隔阂还是比较多的，比如开始产品设计在逻辑上反复推敲确实如此，但是真到了真实业务人家确确实实有这样那样的业务，产品总不能是空中楼阁，要能确实帮助到业务才能有用，不然只会成为产研内部的自嗨工具。</p>
<h6 data-id="heading-12">关于行业</h6>
<p>其实最近几个月给我最大的一个感受是，我们软件行业的待遇确实还是算不错的，因为职位原因，面试过财务、销售、市场运营、法务等等非我们行业的人，他们的薪资待遇至少在cd这个城市是很难达到我们这种水平的，其中也不乏见到一些在他们领域算比较资深的人。<br/>
另一方面就是，学历不代表人品，职位也不代表人品，人品只和自身相关，和你受到什么教育什么行业没有关系，这点对我的冲击还是很大的。</p>
<h6 data-id="heading-13">未来</h6>
<p>从产品上我是比较悲观的，因为并没有受到商务上的检验，目前完全处于自嗨的阶段，未来26年如何发展，能不能有一个不错的效果说实话是密切关系到我们这不到20人的团队的。站在老板的角度，一年光开工资就几百万，如果没有什么好的市场，人家又何必继续投入了，毕竟也不是做慈善。<br/>
从公司层面，还是一样的问题，老板确实有一定的财力，不会像上家公司那么为了融资到处游说，但是至于我们软件部门的公司能不能继续下去，还是看老板对我们的想法。在没有完全盈利或是有收入前，这一块我其实比较悲观的。<br/>
对于自己，其实在我自己看来这是一次很好的机会，虽然不算创业但也算是半个创业，能接触到很多除了开发之外的事，这份经历相信还是许多人没有的，但至于能有多大的作用，这就说不清楚了。<br/>
最后是职业方面，我想了想，无非几个结局，一是在这里呆不了两年，出去后可能还有一次换工作的机会。二是呆个三五年，但没成功，那可能我在这行的职业生涯也到此为止了。三是侥幸成功了，那我以后四十岁以后的生活可能会轻松不少。<br/>
不论结果如何，做开发最多三五年也到头了，做管理说不定还有一线生机，该尝试的还是应该尝试，不论成功与否，至少经历过一次。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++程序崩溃时内存泄漏的真相]]></title>    <link>https://juejin.cn/post/7585022810180550719</link>    <guid>https://juejin.cn/post/7585022810180550719</guid>    <pubDate>2025-12-18T11:29:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585022810180550719" data-draft-id="7585031571889700907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++程序崩溃时内存泄漏的真相"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-18T11:29:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++程序崩溃时内存泄漏的真相
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:29:12.000Z" title="Thu Dec 18 2025 11:29:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象这样一个场景：你的C++程序在运行过程中突然崩溃了——可能是段错误、除零异常，或是某个未处理的异常。程序申请的大量堆内存还未来得及释放。作为一名负责任的程序员，你不禁要问：这些内存算泄漏了吗？它们还能被系统回收重用吗？更重要的是，我们该如何防止这种情况发生？</p>
<p>本文将深入探讨这个问题的本质，并提供一套完整的防护策略。</p>
<h2 data-id="heading-0">第一部分：崩溃时的内存处理</h2>
<h3 data-id="heading-1">虚拟内存系统的基本原理</h3>
<p>现代操作系统使用虚拟内存系统为每个进程提供独立的地址空间。当程序分配内存时，实际发生的是虚拟地址到物理页的映射。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "进程A的视角"
        A1[代码段]
        A2[数据段]
        A3[堆段 - 分配的内存]
        A4[栈段]
        A5[共享库]
    end
    
    subgraph "进程B的视角"
        B1[代码段]
        B2[数据段]
        B3[堆段]
        B4[栈段]
        B5[共享库]
    end
    
    subgraph "操作系统内核"
        MMU[内存管理单元 MMU]
        PT[页表 Page Tables]
    end
    
    subgraph "物理内存"
        P1[页框 1]
        P2[页框 2]
        P3[页框 3]
        P4[页框 4]
        P5[页框 5]
    end
    
    A3 --&gt; MMU
    B3 --&gt; MMU
    MMU --&gt; PT
    PT --&gt; P3
    PT --&gt; P5
</code></pre>
<p><strong>上图展示了关键概念</strong>：每个进程拥有独立的虚拟地址空间，通过MMU和页表映射到物理内存。当进程终止时，操作系统只需要清除页表项，物理页就可以被重用。</p>
<h3 data-id="heading-2">操作系统视角：内存管理的双重标准</h3>
<p><strong>从程序员的角度看</strong>，这无疑是内存泄漏——程序未能遵循"谁申请谁释放"的基本原则。但在操作系统层面，情况则完全不同。</p>
<p>现代操作系统为每个进程维护独立的虚拟地址空间。当进程崩溃时，操作系统内核会执行以下清理操作：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 操作系统内核的伪代码逻辑</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">terminate_process</span><span class="hljs-params">(Process* proc)</span> </span>{
    <span class="hljs-comment">// 1. 释放所有用户态堆内存</span>
    <span class="hljs-built_in">release_user_heap_memory</span>(proc-&gt;heap);
    
    <span class="hljs-comment">// 2. 释放虚拟地址空间</span>
    <span class="hljs-built_in">free_page_tables</span>(proc-&gt;page_tables);
    
    <span class="hljs-comment">// 3. 释放其他系统资源</span>
    <span class="hljs-built_in">close_all_handles</span>(proc-&gt;handles);
    <span class="hljs-built_in">release_locks</span>(proc-&gt;locks);
    
    <span class="hljs-comment">// 4. 从进程表中移除</span>
    <span class="hljs-built_in">remove_from_process_table</span>(proc);
}
</code></pre>
<h3 data-id="heading-3">内存回收的时间线</h3>
<p>让我们通过时间线理解内存的完整生命周期：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">timeline
    title 内存生命周期与崩溃影响
    section 正常流程
        程序启动 : 进程创建虚拟地址空间
        内存申请 : new/malloc调用系统API
        内存使用 : 读写操作
        内存释放 : delete/free归还内存
        程序退出 : 系统回收剩余资源
    
    section 崩溃流程
        程序启动 : 进程创建虚拟地址空间
        内存申请 : new/malloc调用系统API
        内存使用 : 读写操作
        发生崩溃 : 段错误/除零等
        系统接管 : 内核终止进程
        强制回收 : 释放所有进程资源
</code></pre>
<h3 data-id="heading-4">不同类型资源的行为差异</h3>
<p>并非所有资源在崩溃时的表现都相同：</p>















































<table><thead><tr><th>资源类型</th><th>崩溃后是否自动释放</th><th>潜在风险</th><th>清理机制</th></tr></thead><tbody><tr><td>普通堆内存</td><td>✅ 是</td><td>无</td><td>操作系统自动回收</td></tr><tr><td>内存映射文件</td><td>✅ 是</td><td>文件可能处于不一致状态</td><td>系统取消映射</td></tr><tr><td>共享内存</td><td>❌ 否</td><td>持久化存在直到显式删除</td><td>需要shm_unlink</td></tr><tr><td>文件句柄</td><td>✅ 是</td><td>可能延迟关闭</td><td>内核强制关闭</td></tr><tr><td>互斥锁/信号量</td><td>⚠️ 部分</td><td>可能保持锁定状态</td><td>取决于系统实现</td></tr><tr><td>网络连接</td><td>✅ 是</td><td>TCP连接会超时关闭</td><td>发送RST包</td></tr></tbody></table>
<h2 data-id="heading-5">第二部分：崩溃泄漏的实际影响</h2>
<h3 data-id="heading-6">短期影响 vs 长期影响</h3>
<p><strong>短期影响（进程存活时）：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">leaking_function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span>* memory_block1 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];  <span class="hljs-comment">// 泄漏点1</span>
    <span class="hljs-keyword">if</span> (some_condition) {
        <span class="hljs-type">int</span>* memory_block2 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">200</span>];  <span class="hljs-comment">// 泄漏点2</span>
        <span class="hljs-built_in">crash_here</span>();  <span class="hljs-comment">// 在此处崩溃</span>
        <span class="hljs-keyword">delete</span>[] memory_block2;  <span class="hljs-comment">// 永远不会执行</span>
    }
    <span class="hljs-keyword">delete</span>[] memory_block1;  <span class="hljs-comment">// 永远不会执行</span>
}

<span class="hljs-comment">// 此时内存仍在进程的堆中，无法被同一进程的其他部分重用</span>
</code></pre>
<p><strong>长期影响（进程终止后）：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 程序A崩溃后</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">program_A</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">char</span>* big_memory = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">100</span>];  <span class="hljs-comment">// 100MB</span>
    <span class="hljs-built_in">cause_segfault</span>();  <span class="hljs-comment">// 崩溃</span>
}

<span class="hljs-comment">// 程序B可以安全使用这些内存</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">program_B</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 操作系统已将程序A的内存标记为可用</span>
    <span class="hljs-comment">// 新的分配请求可能重用这些物理页</span>
    <span class="hljs-type">char</span>* reused_memory = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">50</span>];
}
</code></pre>
<h3 data-id="heading-7">隐藏的危险：资源泄漏的连锁反应</h3>
<p>尽管操作系统会回收内存，但某些资源泄漏可能导致更严重的问题：</p>
<ol>
<li><strong>文件系统锁泄漏</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_file</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::ofstream <span class="hljs-title">file</span><span class="hljs-params">(<span class="hljs-string">"critical.lock"</span>, std::ios::binary)</span></span>;
    file.<span class="hljs-built_in">write</span>(<span class="hljs-string">"LOCKED"</span>, <span class="hljs-number">6</span>);
    file.<span class="hljs-built_in">flush</span>();
    
    <span class="hljs-comment">// 如果在这里崩溃，文件可能保持打开状态</span>
    <span class="hljs-comment">// 其他进程无法访问该文件</span>
    <span class="hljs-built_in">risky_operation</span>();
    
    <span class="hljs-comment">// 正常关闭</span>
    file.<span class="hljs-built_in">close</span>();
    std::<span class="hljs-built_in">remove</span>(<span class="hljs-string">"critical.lock"</span>);
}
</code></pre>
<ol start="2">
<li><strong>数据库事务未提交</strong></li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_database</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">begin_transaction</span>();
    <span class="hljs-built_in">execute_query</span>(<span class="hljs-string">"UPDATE accounts SET balance = balance - 100 WHERE id = 1"</span>);
    
    <span class="hljs-comment">// 崩溃！事务未提交也未回滚</span>
    <span class="hljs-built_in">crash_somehow</span>();
    
    <span class="hljs-comment">// 数据库可能保持锁定状态</span>
    <span class="hljs-built_in">commit_transaction</span>();  <span class="hljs-comment">// 永远不会执行</span>
}
</code></pre>
<h2 data-id="heading-8">第三部分：防护策略的多层防御体系</h2>
<h3 data-id="heading-9">第一层：RAII——C++的内存安全基石</h3>
<p><strong>Resource Acquisition Is Initialization（资源获取即初始化）</strong> 是C++防止资源泄漏的根本范式：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 传统危险方式</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">risky_operation</span><span class="hljs-params">()</span> </span>{
    Resource* res1 = <span class="hljs-built_in">acquire_resource</span>();
    Resource* res2 = <span class="hljs-built_in">acquire_resource</span>();  <span class="hljs-comment">// 可能抛出异常</span>
    
    <span class="hljs-comment">// 如果上面抛出异常，res1就泄漏了</span>
    <span class="hljs-built_in">use_resources</span>(res1, res2);
    
    <span class="hljs-built_in">release_resource</span>(res1);
    <span class="hljs-built_in">release_resource</span>(res2);  <span class="hljs-comment">// 可能永远不会执行</span>
}

<span class="hljs-comment">// RAII安全方式</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_operation</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 使用智能指针立即获得所有权</span>
    <span class="hljs-keyword">auto</span> res1 = std::<span class="hljs-built_in">unique_ptr</span>&lt;Resource&gt;(<span class="hljs-built_in">acquire_resource</span>());
    <span class="hljs-keyword">auto</span> res2 = std::<span class="hljs-built_in">unique_ptr</span>&lt;Resource&gt;(<span class="hljs-built_in">acquire_resource</span>());
    
    <span class="hljs-comment">// 即使抛出异常，栈展开时也会调用析构函数</span>
    <span class="hljs-built_in">use_resources</span>(res1.<span class="hljs-built_in">get</span>(), res2.<span class="hljs-built_in">get</span>());
    
    <span class="hljs-comment">// 不需要手动释放！</span>
}
</code></pre>
<h3 data-id="heading-10">第二层：智能指针的明智选择</h3>
<p>针对不同场景选择合适的智能指针：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 独占所有权，明确的生命周期</span>
    std::unique_ptr&lt;DatabaseConnection&gt; db_conn;
    
    <span class="hljs-comment">// 共享所有权，多个组件使用</span>
    std::shared_ptr&lt;Configuration&gt; config;
    
    <span class="hljs-comment">// 观察者，不拥有所有权</span>
    std::weak_ptr&lt;Cache&gt; cache_ref;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Application</span>() {
        <span class="hljs-comment">// 工厂函数确保异常安全</span>
        db_conn = Database::<span class="hljs-built_in">create_connection</span>();
        config = std::<span class="hljs-built_in">make_shared</span>&lt;Configuration&gt;();
        
        <span class="hljs-comment">// 即使构造函数中抛出异常，已分配的资源也会自动释放</span>
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_data</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 局部智能指针</span>
        <span class="hljs-keyword">auto</span> buffer = std::<span class="hljs-built_in">make_unique</span>&lt;<span class="hljs-type">char</span>[]&gt;(BUFFER_SIZE);
        
        <span class="hljs-comment">// 将所有权传递给函数</span>
        <span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">transform_data</span>(std::<span class="hljs-built_in">move</span>(buffer));
        
        <span class="hljs-comment">// buffer现在为空，result拥有内存所有权</span>
        <span class="hljs-comment">// 如果这里崩溃，result的析构函数会被调用</span>
    }
};
</code></pre>
<h3 data-id="heading-11">第三层：异常安全的代码设计</h3>
<p>遵循异常安全的基本保证：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionSafeResourceManager</span> {
    std::vector&lt;std::unique_ptr&lt;Resource&gt;&gt; resources;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 基本保证：发生异常时，对象处于有效状态</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_resource</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">auto</span> new_res = std::<span class="hljs-built_in">make_unique</span>&lt;Resource&gt;();
        
        <span class="hljs-comment">// 先完成所有可能失败的操作</span>
        new_res-&gt;<span class="hljs-built_in">initialize</span>();
        
        <span class="hljs-comment">// 只有这时才修改状态</span>
        resources.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(new_res));
    }
    
    <span class="hljs-comment">// 强保证：要么成功，要么完全回滚</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">transactional_update</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 创建所有新资源</span>
        <span class="hljs-keyword">auto</span> new_res1 = std::<span class="hljs-built_in">make_unique</span>&lt;Resource&gt;();
        <span class="hljs-keyword">auto</span> new_res2 = std::<span class="hljs-built_in">make_unique</span>&lt;Resource&gt;();
        
        new_res1-&gt;<span class="hljs-built_in">initialize</span>();
        new_res2-&gt;<span class="hljs-built_in">initialize</span>();
        
        <span class="hljs-comment">// 准备回滚点</span>
        <span class="hljs-keyword">auto</span> old_resources = std::<span class="hljs-built_in">move</span>(resources);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 替换资源</span>
            resources.<span class="hljs-built_in">clear</span>();
            resources.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(new_res1));
            resources.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(new_res2));
            
            <span class="hljs-comment">// 提交，如果失败则catch中恢复</span>
        } <span class="hljs-built_in">catch</span> (...) {
            <span class="hljs-comment">// 恢复旧状态</span>
            resources = std::<span class="hljs-built_in">move</span>(old_resources);
            <span class="hljs-keyword">throw</span>;
        }
    }
};
</code></pre>
<h3 data-id="heading-12">第四层：信号处理与优雅终止</h3>
<p>捕获致命信号进行清理：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;csignal&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EmergencyCleanup</span> {
    <span class="hljs-type">static</span> std::vector&lt;std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; cleanup_handlers;
    <span class="hljs-type">static</span> <span class="hljs-type">bool</span> cleanup_done;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">register_handler</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; handler)</span> </span>{
        cleanup_handlers.<span class="hljs-built_in">push_back</span>(handler);
    }
    
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">emergency_cleanup</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (cleanup_done) <span class="hljs-keyword">return</span>;
        cleanup_done = <span class="hljs-literal">true</span>;
        
        std::cerr &lt;&lt; <span class="hljs-string">"\n=== 执行紧急清理 ==="</span> &lt;&lt; std::endl;
        
        <span class="hljs-comment">// 逆序清理（后进先出）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = cleanup_handlers.<span class="hljs-built_in">rbegin</span>(); 
             it != cleanup_handlers.<span class="hljs-built_in">rend</span>(); ++it) {
            <span class="hljs-keyword">try</span> {
                (*it)();
            } <span class="hljs-built_in">catch</span> (...) {
                <span class="hljs-comment">// 忽略清理过程中的异常</span>
            }
        }
        
        std::cerr &lt;&lt; <span class="hljs-string">"=== 清理完成 ==="</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// RAII包装器，自动注册</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScopedHandler</span> {
        std::function&lt;<span class="hljs-type">void</span>()&gt; handler;
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">ScopedHandler</span>(std::function&lt;<span class="hljs-built_in">void</span>()&gt; h) : <span class="hljs-built_in">handler</span>(h) {
            <span class="hljs-built_in">register_handler</span>(h);
        }
        
        ~<span class="hljs-built_in">ScopedHandler</span>() {
            <span class="hljs-comment">// 正常退出时也需要清理</span>
            <span class="hljs-keyword">if</span> (!cleanup_done) {
                <span class="hljs-keyword">try</span> { <span class="hljs-built_in">handler</span>(); } <span class="hljs-built_in">catch</span> (...) {}
            }
        }
    };
};

<span class="hljs-comment">// 信号处理函数</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">signal_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span> </span>{
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* signal_name = <span class="hljs-literal">nullptr</span>;
    
    <span class="hljs-keyword">switch</span>(sig) {
        <span class="hljs-keyword">case</span> SIGSEGV: signal_name = <span class="hljs-string">"SIGSEGV (段错误)"</span>; <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> SIGFPE: signal_name = <span class="hljs-string">"SIGFPE (算术异常)"</span>; <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> SIGILL: signal_name = <span class="hljs-string">"SIGILL (非法指令)"</span>; <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> SIGABRT: signal_name = <span class="hljs-string">"SIGABRT (程序中止)"</span>; <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>: signal_name = <span class="hljs-string">"未知信号"</span>; <span class="hljs-keyword">break</span>;
    }
    
    std::cerr &lt;&lt; <span class="hljs-string">"\n⚠️  接收到信号: "</span> &lt;&lt; signal_name 
              &lt;&lt; <span class="hljs-string">" ("</span> &lt;&lt; sig &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 执行紧急清理</span>
    EmergencyCleanup::<span class="hljs-built_in">emergency_cleanup</span>();
    
    <span class="hljs-comment">// 恢复默认处理并重新抛出</span>
    <span class="hljs-built_in">signal</span>(sig, SIG_DFL);
    <span class="hljs-built_in">raise</span>(sig);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup_signal_handlers</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">signal</span>(SIGSEGV, signal_handler);
    <span class="hljs-built_in">signal</span>(SIGFPE, signal_handler);
    <span class="hljs-built_in">signal</span>(SIGILL, signal_handler);
    <span class="hljs-built_in">signal</span>(SIGABRT, signal_handler);
    <span class="hljs-comment">// 注意：SIGKILL和SIGSTOP不能被捕获</span>
}
</code></pre>
<h3 data-id="heading-13">第五层：进程隔离与沙箱模式</h3>
<p>将可能崩溃的代码隔离到子进程中：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">IsolatedProcess</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Func&gt;
    <span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">run</span><span class="hljs-params">(Func&amp;&amp; func)</span> -&gt; std::optional&lt;<span class="hljs-title">decltype</span><span class="hljs-params">(func())</span>&gt; </span>{
        <span class="hljs-comment">// 创建管道用于结果通信</span>
        <span class="hljs-type">int</span> pipefd[<span class="hljs-number">2</span>];
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">pipe</span>(pipefd) == <span class="hljs-number">-1</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"创建管道失败"</span>);
        }
        
        <span class="hljs-type">pid_t</span> pid = fork();
        
        <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) {  <span class="hljs-comment">// 子进程</span>
            <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">0</span>]);  <span class="hljs-comment">// 关闭读端</span>
            
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">func</span>();
                
                <span class="hljs-comment">// 序列化结果</span>
                std::ostringstream oss;
                <span class="hljs-comment">// 这里需要根据实际类型实现序列化</span>
                <span class="hljs-comment">// write_result_to_stream(oss, result);</span>
                
                std::string serialized = oss.<span class="hljs-built_in">str</span>();
                <span class="hljs-type">size_t</span> size = serialized.<span class="hljs-built_in">size</span>();
                
                <span class="hljs-comment">// 发送结果大小</span>
                <span class="hljs-built_in">write</span>(pipefd[<span class="hljs-number">1</span>], &amp;size, <span class="hljs-built_in">sizeof</span>(size));
                <span class="hljs-comment">// 发送结果数据</span>
                <span class="hljs-built_in">write</span>(pipefd[<span class="hljs-number">1</span>], serialized.<span class="hljs-built_in">data</span>(), size);
                
                <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">1</span>]);
                _exit(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 使用_exit避免atexit处理</span>
                
            } <span class="hljs-built_in">catch</span> (...) {
                <span class="hljs-comment">// 子进程中的异常，通过特殊值表示</span>
                <span class="hljs-type">size_t</span> error_marker = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">size_t</span>&gt;(<span class="hljs-number">-1</span>);
                <span class="hljs-built_in">write</span>(pipefd[<span class="hljs-number">1</span>], &amp;error_marker, <span class="hljs-built_in">sizeof</span>(error_marker));
                <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">1</span>]);
                _exit(<span class="hljs-number">1</span>);
            }
            
        } <span class="hljs-keyword">else</span> {  <span class="hljs-comment">// 父进程</span>
            <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">1</span>]);  <span class="hljs-comment">// 关闭写端</span>
            
            <span class="hljs-type">int</span> status;
            <span class="hljs-built_in">waitpid</span>(pid, &amp;status, <span class="hljs-number">0</span>);
            
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">WIFEXITED</span>(status) &amp;&amp; <span class="hljs-built_in">WEXITSTATUS</span>(status) == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 读取结果</span>
                <span class="hljs-type">size_t</span> result_size;
                <span class="hljs-built_in">read</span>(pipefd[<span class="hljs-number">0</span>], &amp;result_size, <span class="hljs-built_in">sizeof</span>(result_size));
                
                <span class="hljs-keyword">if</span> (result_size != <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">size_t</span>&gt;(<span class="hljs-number">-1</span>)) {
                    <span class="hljs-function">std::string <span class="hljs-title">serialized</span><span class="hljs-params">(result_size, <span class="hljs-string">'\0'</span>)</span></span>;
                    <span class="hljs-built_in">read</span>(pipefd[<span class="hljs-number">0</span>], serialized.<span class="hljs-built_in">data</span>(), result_size);
                    <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">0</span>]);
                    
                    <span class="hljs-comment">// 反序列化结果</span>
                    <span class="hljs-comment">// return deserialize_result(serialized);</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">0</span>]);
                    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"子进程执行失败"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">close</span>(pipefd[<span class="hljs-number">0</span>]);
                std::cerr &lt;&lt; <span class="hljs-string">"子进程异常终止"</span> &lt;&lt; std::endl;
                <span class="hljs-comment">// 父进程资源安全，可以继续运行</span>
            }
        }
        
        <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>;
    }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main_program</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 父进程保持安全</span>
    std::unique_ptr&lt;MainResource&gt; main_res = <span class="hljs-built_in">acquire_main_resource</span>();
    
    <span class="hljs-comment">// 危险操作在子进程中执行</span>
    <span class="hljs-keyword">auto</span> result = IsolatedProcess::<span class="hljs-built_in">run</span>([]() {
        std::unique_ptr&lt;DangerousResource&gt; danger = <span class="hljs-built_in">create_dangerous_resource</span>();
        <span class="hljs-keyword">return</span> danger-&gt;<span class="hljs-built_in">risky_operation</span>();  <span class="hljs-comment">// 可能崩溃</span>
    });
    
    <span class="hljs-comment">// 即使子进程崩溃，父进程继续运行</span>
    <span class="hljs-keyword">if</span> (result) {
        <span class="hljs-built_in">process_result</span>(*result);
    }
}
</code></pre>
<h3 data-id="heading-14">第六层：防御性编程与检查机制</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cassert&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DefensiveProgrammer</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 边界检查</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Container&gt;
    <span class="hljs-type">static</span> <span class="hljs-keyword">typename</span> Container::reference <span class="hljs-title">safe_access</span><span class="hljs-params">(
        Container&amp; container, 
        <span class="hljs-type">size_t</span> index,
        <span class="hljs-type">const</span> <span class="hljs-type">char</span>* context = <span class="hljs-literal">nullptr</span>)</span> </span>{
        
        <span class="hljs-keyword">if</span> (index &gt;= container.<span class="hljs-built_in">size</span>()) {
            std::string msg = <span class="hljs-string">"索引越界: "</span>;
            msg += std::<span class="hljs-built_in">to_string</span>(index);
            msg += <span class="hljs-string">" &gt;= "</span>;
            msg += std::<span class="hljs-built_in">to_string</span>(container.<span class="hljs-built_in">size</span>());
            <span class="hljs-keyword">if</span> (context) {
                msg += <span class="hljs-string">" (在 "</span>;
                msg += context;
                msg += <span class="hljs-string">" 中)"</span>;
            }
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">out_of_range</span>(msg);  <span class="hljs-comment">// 抛出异常而非崩溃</span>
        }
        
        <span class="hljs-keyword">return</span> container[index];
    }
    
    <span class="hljs-comment">// 空指针检查</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-type">static</span> T* <span class="hljs-title">check_not_null</span><span class="hljs-params">(T* ptr, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name = <span class="hljs-literal">nullptr</span>)</span> </span>{
        <span class="hljs-keyword">if</span> (ptr == <span class="hljs-literal">nullptr</span>) {
            std::string msg = <span class="hljs-string">"空指针访问"</span>;
            <span class="hljs-keyword">if</span> (name) {
                msg += <span class="hljs-string">": "</span>;
                msg += name;
            }
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(msg);
        }
        <span class="hljs-keyword">return</span> ptr;
    }
    
    <span class="hljs-comment">// 资源使用检查点</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Checkpoint</span> {
        <span class="hljs-type">size_t</span> initial_memory_usage;
        std::vector&lt;std::string&gt; warnings;
        
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">Checkpoint</span>() {
            <span class="hljs-comment">// 记录初始状态</span>
            <span class="hljs-comment">// initial_memory_usage = get_current_memory_usage();</span>
        }
        
        ~<span class="hljs-built_in">Checkpoint</span>() {
            <span class="hljs-comment">// 检查资源泄漏</span>
            <span class="hljs-comment">// size_t current = get_current_memory_usage();</span>
            <span class="hljs-comment">// if (current &gt; initial_memory_usage + THRESHOLD) {</span>
            <span class="hljs-comment">//     log_warning("潜在的内存泄漏");</span>
            <span class="hljs-comment">// }</span>
            
            <span class="hljs-keyword">if</span> (!warnings.<span class="hljs-built_in">empty</span>()) {
                std::cerr &lt;&lt; <span class="hljs-string">"检查点警告:"</span> &lt;&lt; std::endl;
                <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; w : warnings) {
                    std::cerr &lt;&lt; <span class="hljs-string">"  - "</span> &lt;&lt; w &lt;&lt; std::endl;
                }
            }
        }
        
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_warning</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; warning)</span> </span>{
            warnings.<span class="hljs-built_in">push_back</span>(warning);
        }
    };
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">defensive_function</span><span class="hljs-params">()</span> </span>{
    DefensiveProgrammer::Checkpoint checkpoint;
    
    <span class="hljs-function">std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 安全访问</span>
        <span class="hljs-type">int</span> value = DefensiveProgrammer::<span class="hljs-built_in">safe_access</span>(data, <span class="hljs-number">150</span>, <span class="hljs-string">"defensive_function"</span>);
        <span class="hljs-comment">// 不会执行到这里</span>
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span class="hljs-string">"捕获异常: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
        <span class="hljs-comment">// 优雅处理，而不是崩溃</span>
        checkpoint.<span class="hljs-built_in">add_warning</span>(e.<span class="hljs-built_in">what</span>());
    }
}
</code></pre>
<h2 data-id="heading-15">第四部分：实战架构设计模式</h2>
<h3 data-id="heading-16">模式1：事务性资源管理</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Resource&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionalResource</span> {
    std::unique_ptr&lt;Resource&gt; current;
    std::unique_ptr&lt;Resource&gt; backup;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">void</span> <span class="hljs-title">begin_transaction</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-comment">// 创建新资源但不立即生效</span>
        backup = std::<span class="hljs-built_in">move</span>(current);
        current = std::<span class="hljs-built_in">make_unique</span>&lt;Resource&gt;(std::forward&lt;Args&gt;(args)...);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">commit</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 提交事务，丢弃备份</span>
        backup.<span class="hljs-built_in">reset</span>();
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rollback</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 回滚到之前的状态</span>
        current = std::<span class="hljs-built_in">move</span>(backup);
    }
    
    <span class="hljs-function">Resource&amp; <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!current) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"没有活动的资源"</span>);
        }
        <span class="hljs-keyword">return</span> *current;
    }
    
    <span class="hljs-comment">// 确保即使崩溃，资源也能被清理</span>
    ~<span class="hljs-built_in">TransactionalResource</span>() {
        <span class="hljs-comment">// 智能指针自动清理</span>
    }
};
</code></pre>
<h3 data-id="heading-17">模式2：资源所有权传递链</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OwnershipChain</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span> {
        std::unique_ptr&lt;<span class="hljs-type">void</span>, <span class="hljs-built_in">void</span>(*)(<span class="hljs-type">void</span>*)&gt; resource;
        std::unique_ptr&lt;Node&gt; next;
        
        <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> Deleter&gt;
        <span class="hljs-title">Node</span><span class="hljs-params">(T* ptr, Deleter d)</span> 
            : resource(ptr, [d](void* p) {</span> <span class="hljs-built_in">d</span>(<span class="hljs-built_in">static_cast</span>&lt;T*&gt;(p)); }) {}
    };
    
    std::unique_ptr&lt;Node&gt; head;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> Deleter&gt;
    <span class="hljs-type">void</span> <span class="hljs-title">acquire</span><span class="hljs-params">(T* resource, Deleter deleter)</span> </span>{
        <span class="hljs-keyword">auto</span> new_node = std::<span class="hljs-built_in">make_unique</span>&lt;Node&gt;(resource, deleter);
        new_node-&gt;next = std::<span class="hljs-built_in">move</span>(head);
        head = std::<span class="hljs-built_in">move</span>(new_node);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">release_all</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 逆序释放所有资源</span>
        <span class="hljs-keyword">while</span> (head) {
            head = std::<span class="hljs-built_in">move</span>(head-&gt;next);
        }
    }
    
    ~<span class="hljs-built_in">OwnershipChain</span>() {
        <span class="hljs-built_in">release_all</span>();
    }
    
    <span class="hljs-comment">// 防止拷贝</span>
    <span class="hljs-built_in">OwnershipChain</span>(<span class="hljs-type">const</span> OwnershipChain&amp;) = <span class="hljs-keyword">delete</span>;
    OwnershipChain&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> OwnershipChain&amp;) = <span class="hljs-keyword">delete</span>;
    
    <span class="hljs-comment">// 允许移动</span>
    <span class="hljs-built_in">OwnershipChain</span>(OwnershipChain&amp;&amp;) = <span class="hljs-keyword">default</span>;
    OwnershipChain&amp; <span class="hljs-keyword">operator</span>=(OwnershipChain&amp;&amp;) = <span class="hljs-keyword">default</span>;
};
</code></pre>
<h2 data-id="heading-18">第五部分：工具链支持</h2>
<h3 data-id="heading-19">静态分析工具配置</h3>
<pre><code class="hljs language-cmake" lang="cmake"># CMakeLists.txt中的配置示例
if(CMAKE_CXX_COMPILER_ID MATCHES "Clang|GNU")
    # 启用所有警告
    add_compile_options(-Wall -Wextra -Wpedantic)
    
    # 内存相关警告
    add_compile_options(-Wmemory-leak)
    add_compile_options(-Wdelete-non-virtual-dtor)
    
    # 开启静态分析
    if(CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
        add_compile_options(-fsanitize=address)
        add_compile_options(-fsanitize=leak)
        add_compile_options(-fsanitize=undefined)
    endif()
endif()

# 使用Clang-Tidy
find_program(CLANG_TIDY_EXE NAMES "clang-tidy")
if(CLANG_TIDY_EXE)
    set(CMAKE_CXX_CLANG_TIDY 
        "${CLANG_TIDY_EXE};-checks=*;-warnings-as-errors=*")
endif()
</code></pre>
<h3 data-id="heading-20">动态分析脚本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># memory_check.sh</span>

<span class="hljs-comment"># 使用Valgrind检查内存泄漏</span>
valgrind --tool=memcheck \
         --leak-check=full \
         --show-leak-kinds=all \
         --track-origins=<span class="hljs-built_in">yes</span> \
         --verbose \
         --log-file=valgrind-out.txt \
         ./my_program

<span class="hljs-comment"># 使用AddressSanitizer</span>
<span class="hljs-built_in">export</span> ASAN_OPTIONS=<span class="hljs-string">"detect_leaks=1:halt_on_error=0"</span>
./my_program_asan

<span class="hljs-comment"># 生成内存分析报告</span>
heaptrack ./my_program
heaptrack_print heaptrack.my_program.*.gz &gt; memory_report.txt
</code></pre>
<h2 data-id="heading-21">结论</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root(防御性编程最佳实践)
    
    输入验证
      参数检查
        "验证所有函数参数"
        "检查null指针"
        "验证数值范围"
      数据验证
        "验证输入数据格式"
        "检查数据完整性"
        "消毒用户输入"
    
    内存安全
      分配安全
        "检查分配大小"
        "验证分配结果"
        "处理分配失败"
      访问安全
        "边界检查"
        "类型安全"
        "对齐检查"
      释放安全
        "避免双重释放"
        "跟踪所有权"
        "使用RAII"
    
    异常安全
      基本保证
        "确保不泄漏资源"
        "保持对象有效性"
        "允许状态改变"
      强保证
        "提交或回滚"
        "事务性操作"
        "异常中立"
      不抛保证
        "关键操作不抛异常"
        "使用noexcept"
        "简化错误处理"
    
    状态管理
      前置条件
        "验证操作前提"
        "检查对象状态"
        "验证环境条件"
      后置条件
        "验证操作结果"
        "检查不变量"
        "确保状态一致"
      不变式
        "维护类不变量"
        "验证数据完整性"
        "检查逻辑约束"
    
    资源管理
      获取即初始化
        "RAII模式"
        "构造函数中获取"
        "析构函数中释放"
      所有权明确
        "明确资源所有权"
        "使用智能指针"
        "避免共享所有权"
      生命周期管理
        "控制对象生命周期"
        "使用作用域管理"
        "及时释放资源"
</code></pre>
<p>通过本文的探讨，我们可以得出以下关键结论：</p>
<ol>
<li>
<p><strong>操作系统会回收崩溃进程的内存</strong>，但这不应成为代码质量低下的借口。</p>
</li>
<li>
<p><strong>RAII是C++内存安全的基石</strong>，应成为每个C++程序员的本能思维方式。</p>
</li>
<li>
<p><strong>多层防御策略</strong>比单一方案更有效：</p>
<ul>
<li>第一层：RAII和智能指针</li>
<li>第二层：异常安全设计</li>
<li>第三层：信号处理和优雅终止</li>
<li>第四层：进程隔离和沙箱</li>
<li>第五层：防御性编程</li>
</ul>
</li>
<li>
<p><strong>工具链的恰当使用</strong>可以提前发现潜在问题。</p>
</li>
</ol>
<p>最终，防止崩溃导致的内存泄漏不仅是技术问题，更是工程 discipline 的体现。优秀的C++程序员应该：</p>
<ul>
<li>默认使用智能指针而非裸指针</li>
<li>优先选择栈对象而非堆对象</li>
<li>为所有资源编写RAII包装器</li>
<li>设计异常安全的接口</li>
<li>使用静态和动态分析工具</li>
</ul>
<p>记住：操作系统会为你的崩溃"兜底"，但良好的编程习惯能让你的程序更加健壮、可维护。在资源管理和内存安全方面，永远不要依赖操作系统的清理机制，而是要确保你的代码在任何情况下都能正确管理自己的资源。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++共享内存小白入门指南]]></title>    <link>https://juejin.cn/post/7585040881619632164</link>    <guid>https://juejin.cn/post/7585040881619632164</guid>    <pubDate>2025-12-18T11:34:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585040881619632164" data-draft-id="7585040881619599396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++共享内存小白入门指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-18T11:34:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++共享内存小白入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:34:13.000Z" title="Thu Dec 18 2025 11:34:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是共享内存？</h2>
<p>想象一下，你和你的室友共用一个冰箱。你们都可以往里面放东西，也可以从里面拿东西，这就是共享内存的基本概念！在C++中，<strong>共享内存</strong>是一种让不同进程（可以理解为不同的程序）能够访问同一块内存区域的技术。</p>
<h2 data-id="heading-1">为什么要使用共享内存？</h2>
<ol>
<li><strong>高效通信</strong>：进程间通信最快的方式之一</li>
<li><strong>数据共享</strong>：多个程序可以访问相同数据</li>
<li><strong>减少复制</strong>：不需要在不同进程间复制大量数据</li>
</ol>
<h2 data-id="heading-2">基础知识准备</h2>
<p>在深入之前，你需要知道：</p>
<ul>
<li>进程：正在运行的程序实例</li>
<li>内存：程序存储数据的地方</li>
<li>系统调用：操作系统提供的功能接口</li>
</ul>
<h2 data-id="heading-3">共享内存使用步骤（Linux/Unix系统）</h2>
<h3 data-id="heading-4">第一步：创建共享内存</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/shm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 生成一个唯一的key</span>
    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">"shmfile"</span>, <span class="hljs-number">65</span>);
    
    <span class="hljs-comment">// 创建共享内存段，1024字节大小</span>
    <span class="hljs-comment">// IPC_CREAT表示创建，0666是权限（可读可写）</span>
    <span class="hljs-type">int</span> shmid = <span class="hljs-built_in">shmget</span>(key, <span class="hljs-number">1024</span>, IPC_CREAT | <span class="hljs-number">0666</span>);
    
    <span class="hljs-keyword">if</span> (shmid &lt; <span class="hljs-number">0</span>) {
        std::cerr &lt;&lt; <span class="hljs-string">"创建共享内存失败"</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"共享内存创建成功，ID: "</span> &lt;&lt; shmid &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-5">第二步：附加到共享内存</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/shm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">"shmfile"</span>, <span class="hljs-number">65</span>);
    <span class="hljs-type">int</span> shmid = <span class="hljs-built_in">shmget</span>(key, <span class="hljs-number">1024</span>, <span class="hljs-number">0666</span>);
    
    <span class="hljs-comment">// 附加到共享内存</span>
    <span class="hljs-type">char</span>* shared_memory = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">shmat</span>(shmid, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">if</span> (shared_memory == (<span class="hljs-type">char</span>*)<span class="hljs-number">-1</span>) {
        std::cerr &lt;&lt; <span class="hljs-string">"附加到共享内存失败"</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">// 写入数据到共享内存</span>
    std::<span class="hljs-built_in">strcpy</span>(shared_memory, <span class="hljs-string">"你好，共享内存！"</span>);
    std::cout &lt;&lt; <span class="hljs-string">"数据已写入共享内存"</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 分离共享内存（但不删除）</span>
    <span class="hljs-built_in">shmdt</span>(shared_memory);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-6">第三步：读取共享内存数据</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/shm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">"shmfile"</span>, <span class="hljs-number">65</span>);
    <span class="hljs-type">int</span> shmid = <span class="hljs-built_in">shmget</span>(key, <span class="hljs-number">1024</span>, <span class="hljs-number">0666</span>);
    
    <span class="hljs-comment">// 附加到共享内存</span>
    <span class="hljs-type">char</span>* shared_memory = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">shmat</span>(shmid, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"从共享内存读取: "</span> &lt;&lt; shared_memory &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 分离共享内存</span>
    <span class="hljs-built_in">shmdt</span>(shared_memory);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-7">第四步：删除共享内存</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/shm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">"shmfile"</span>, <span class="hljs-number">65</span>);
    <span class="hljs-type">int</span> shmid = <span class="hljs-built_in">shmget</span>(key, <span class="hljs-number">1024</span>, <span class="hljs-number">0666</span>);
    
    <span class="hljs-comment">// 删除共享内存段</span>
    <span class="hljs-built_in">shmctl</span>(shmid, IPC_RMID, <span class="hljs-literal">nullptr</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"共享内存已删除"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-8">完整示例：进程间通信</h2>
<h3 data-id="heading-9">写入进程（writer.cpp）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/shm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 生成key</span>
    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">"shmfile"</span>, <span class="hljs-number">65</span>);
    
    <span class="hljs-comment">// 创建共享内存（1KB大小）</span>
    <span class="hljs-type">int</span> shmid = <span class="hljs-built_in">shmget</span>(key, <span class="hljs-number">1024</span>, IPC_CREAT | <span class="hljs-number">0666</span>);
    
    <span class="hljs-comment">// 附加到共享内存</span>
    <span class="hljs-type">char</span>* str = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">shmat</span>(shmid, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"写入进程启动，等待输入..."</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 连续写入数据</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
        <span class="hljs-built_in">sprintf</span>(str, <span class="hljs-string">"消息 %d"</span>, i);
        std::cout &lt;&lt; <span class="hljs-string">"写入: "</span> &lt;&lt; str &lt;&lt; std::endl;
        <span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);  <span class="hljs-comment">// 等待2秒</span>
    }
    
    <span class="hljs-comment">// 写入结束标志</span>
    <span class="hljs-built_in">strcpy</span>(str, <span class="hljs-string">"结束"</span>);
    
    <span class="hljs-comment">// 分离共享内存</span>
    <span class="hljs-built_in">shmdt</span>(str);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-10">读取进程（reader.cpp）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ipc.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/shm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 生成相同的key</span>
    <span class="hljs-type">key_t</span> key = <span class="hljs-built_in">ftok</span>(<span class="hljs-string">"shmfile"</span>, <span class="hljs-number">65</span>);
    
    <span class="hljs-comment">// 获取共享内存</span>
    <span class="hljs-type">int</span> shmid = <span class="hljs-built_in">shmget</span>(key, <span class="hljs-number">1024</span>, <span class="hljs-number">0666</span>);
    
    <span class="hljs-comment">// 附加到共享内存</span>
    <span class="hljs-type">char</span>* str = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">shmat</span>(shmid, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"读取进程启动，等待数据..."</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 持续读取数据</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        std::cout &lt;&lt; <span class="hljs-string">"读取: "</span> &lt;&lt; str &lt;&lt; std::endl;
        
        <span class="hljs-comment">// 检查是否收到结束标志</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(str, <span class="hljs-string">"结束"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 每秒检查一次</span>
    }
    
    <span class="hljs-comment">// 分离共享内存</span>
    <span class="hljs-built_in">shmdt</span>(str);
    
    <span class="hljs-comment">// 删除共享内存段</span>
    <span class="hljs-built_in">shmctl</span>(shmid, IPC_RMID, <span class="hljs-literal">nullptr</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"共享内存已清理"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-11">编译和运行</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译写入进程</span>
g++ writer.cpp -o writer

<span class="hljs-comment"># 编译读取进程</span>
g++ reader.cpp -o reader

<span class="hljs-comment"># 打开两个终端，先运行写入进程</span>
./writer

<span class="hljs-comment"># 在另一个终端运行读取进程</span>
./reader
</code></pre>
<h2 data-id="heading-12">Windows下的共享内存（简单示例）</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 创建共享内存</span>
    HANDLE hMapFile = <span class="hljs-built_in">CreateFileMapping</span>(
        INVALID_HANDLE_VALUE,    <span class="hljs-comment">// 使用系统页面文件</span>
        <span class="hljs-literal">nullptr</span>,                 <span class="hljs-comment">// 默认安全属性</span>
        PAGE_READWRITE,          <span class="hljs-comment">// 可读可写</span>
        <span class="hljs-number">0</span>,                       <span class="hljs-comment">// 高位文件大小</span>
        <span class="hljs-number">256</span>,                     <span class="hljs-comment">// 低位文件大小（256字节）</span>
        <span class="hljs-string">L"MySharedMemory"</span>);      <span class="hljs-comment">// 共享内存名称</span>
    
    <span class="hljs-comment">// 映射到进程地址空间</span>
    <span class="hljs-type">char</span>* pBuf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">MapViewOfFile</span>(
        hMapFile,                <span class="hljs-comment">// 共享内存句柄</span>
        FILE_MAP_ALL_ACCESS,     <span class="hljs-comment">// 可读可写访问</span>
        <span class="hljs-number">0</span>,
        <span class="hljs-number">0</span>,
        <span class="hljs-number">256</span>);
    
    <span class="hljs-comment">// 使用共享内存</span>
    <span class="hljs-built_in">strcpy</span>(pBuf, <span class="hljs-string">"Windows共享内存示例"</span>);
    std::cout &lt;&lt; <span class="hljs-string">"写入: "</span> &lt;&lt; pBuf &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 清理</span>
    <span class="hljs-built_in">UnmapViewOfFile</span>(pBuf);
    <span class="hljs-built_in">CloseHandle</span>(hMapFile);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-13">注意事项和最佳实践</h2>
<ol>
<li><strong>同步问题</strong>：多个进程同时访问时需要同步机制（如信号量）</li>
<li><strong>内存泄漏</strong>：确保正确释放共享内存</li>
<li><strong>安全性</strong>：共享内存对所有有权限的进程可见</li>
<li><strong>大小限制</strong>：系统对共享内存大小有限制</li>
</ol>
<h2 data-id="heading-14">常见问题解答</h2>
<p><strong>Q: 共享内存和普通内存有什么区别？</strong>
A: 共享内存可以被多个进程访问，普通内存只能被创建它的进程访问。</p>
<p><strong>Q: 进程退出后共享内存还在吗？</strong>
A: 除非显式删除，否则共享内存会一直存在。</p>
<p><strong>Q: 如何防止数据冲突？</strong>
A: 使用同步机制，如互斥锁、信号量等。</p>
<p><strong>Q: 共享内存大小有限制吗？</strong>
A: 有，取决于系统配置，通常可以通过系统命令查看和调整。</p>
<h2 data-id="heading-15">学习建议</h2>
<ol>
<li>从简单的示例开始，先理解基本概念</li>
<li>实践编写两个进程通信的程序</li>
<li>学习同步机制，处理并发访问</li>
<li>查阅系统文档，了解具体限制和特性</li>
</ol>
<p>记住，共享内存是强大的工具，但需要谨慎使用。确保你理解了同步和清理的重要性，避免内存泄漏和数据损坏。祝你学习顺利！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tauri (20)——为什么 NSPanel 窗口不能用官方 API 全屏？]]></title>    <link>https://juejin.cn/post/7585006378533453866</link>    <guid>https://juejin.cn/post/7585006378533453866</guid>    <pubDate>2025-12-18T11:45:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585006378533453866" data-draft-id="7585006378533437482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tauri (20)——为什么 NSPanel 窗口不能用官方 API 全屏？"/> <meta itemprop="keywords" content="前端,APP,macOS"/> <meta itemprop="datePublished" content="2025-12-18T11:45:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨夜寻晴天"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tauri (20)——为什么 NSPanel 窗口不能用官方 API 全屏？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨夜寻晴天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:45:27.000Z" title="Thu Dec 18 2025 11:45:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,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) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,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) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在基于 Electron 或 Tauri 开发 macOS 桌面应用时，我们经常会遇到一种特殊的窗口类型：<code>NSPanel</code>。它通常用于 spotlight 搜索栏、悬浮工具条等场景。然而，当我们想给这种“小窗口”加上全屏能力（比如玩游戏、看大图）时，往往会撞上一堵墙：<strong>官方的全屏 API 对 <code>NSPanel</code> 并不友好，甚至直接失效。</strong></p>
<h2 data-id="heading-0">项目背景：Coco AI</h2>
<p>我们在构建 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs%2Fen" target="_blank" title="https://coco.rs/en" ref="nofollow noopener noreferrer">Coco AI</a></strong> —— 这款集成了统一搜索、协作与 AI 助手的跨平台桌面生产力工具时，遇到了一个有趣的技术挑战。</p>
<p>Coco AI 强大的<strong>插件系统</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs%2Fen%2Fintegration%2Fextensions" target="_blank" title="https://coco.rs/en/integration/extensions" ref="nofollow noopener noreferrer">Extensions</a>）允许用户在应用内直接运行各种工具（如小游戏、可视化图表、Web 应用等）。为了保持轻量和随手即用的体验，Coco 默认使用类似于 Spotlight 的悬浮窗（<code>NSPanel</code>）展示。但当用户想要沉浸式地使用插件（比如玩个小游戏）时，默认的小窗口就显得局促了。</p>
<p>我们希望实现的效果是：<strong>平时召之即来挥之即去，需要时一键变身全屏工作台。</strong></p>
<p>然而，官方的窗口 API 在 <code>NSPanel</code> 上却频频“翻车”。今天就来复盘一下我们是如何在 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">Coco App</a></strong> 中解决这个问题的。</p>
<h2 data-id="heading-1">应用场景：一个嵌入式小游戏窗口</h2>
<p>假设我们在开发一个类似于 Spotlight 的启动器，平时它是一个悬浮在屏幕中央的小框。但我们允许用户通过插件系统加载一个网页（比如 HTML5 游戏）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5914df02df0415aab4b30f57d30d747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5aSc5a-75pm05aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766663126&amp;x-signature=pTynOxy0q0Y7x5ruvhRu6hup%2BHE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>需求很直接：</strong></p>
<ol>
<li>默认窗口大小固定（如 1200x900）。</li>
<li>用户点击“全屏”按钮，窗口瞬间铺满当前屏幕。</li>
<li>再次点击，恢复原状。</li>
</ol>
<p><strong>技术栈：</strong></p>
<ul>
<li><strong>Tauri</strong> (Rust + WebView)</li>
<li><strong>Frontend</strong>: React + TypeScript</li>
<li><strong>Window Type</strong>: <code>NSPanel</code> (macOS)</li>
</ul>
<h2 data-id="heading-2">遇到的坑：NSPanel 与 <code>setFullscreen</code> 的爱恨情仇</h2>
<p>在普通的 <code>NSWindow</code> 中，调用 Tauri 的 <code>window.setFullscreen(true)</code> 或 Electron 的 <code>setFullScreen(true)</code>，系统会自动创建一个新的 Space，把窗口平铺进去，非常优雅。</p>
<p>但 Coco AI 为了追求“极致的快速启动与无感交互”，使用了 <code>NSPanel</code> 并设置了较高的窗口层级。当我们试图对它调用标准全屏 API 时：</p>
<ol>
<li><strong>系统动画冲突</strong>：由于没有标准标题栏，系统全屏动画可能会导致窗口消失、闪烁甚至错位。</li>
<li><strong>多屏支持噩梦</strong>：用户在副屏唤起 Coco AI，点击全屏，结果窗口直接飞回了主屏。</li>
<li><strong>状态不可逆</strong>：退出全屏后，窗口焦点和层级可能回不到原来的状态，打断了用户的心流。</li>
</ol>
<p>简单来说，官方 API 是给 <strong>“标准应用窗口”</strong> 设计的，并不适配我们这种 <strong>“灵动挂件”</strong>。</p>
<h2 data-id="heading-3">解决方案：手动接管窗口布局</h2>
<p>既然系统 API 不懂我们的心，我们就自己动手，“伪造”一个全屏效果。通过 <strong>“手动计算 + 逻辑坐标转换”</strong> 来优雅解决这个问题。</p>
<h3 data-id="heading-4">核心原理</h3>
<ol>
<li><strong>精准定位</strong>：获取当前鼠标所在的显示器（Monitor），确保“在哪里唤起，就在哪里全屏”。</li>
<li><strong>坐标系转换</strong>：macOS 使用逻辑像素（Logical Pixel），而底层屏幕信息往往是物理像素（Physical Pixel），必须通过 <code>scaleFactor</code> 进行转换，否则窗口会巨大无比或只有四分之一大。</li>
<li><strong>暴力美学</strong>：直接修改窗口的 <code>x, y, width, height</code>，使其完美覆盖目标屏幕的 Bounds。</li>
<li><strong>状态快照</strong>：在变身前，记住原来的位置和大小，以便随时缩回那个熟悉的“小框框”。</li>
</ol>
<h3 data-id="heading-5">Coco AI 的实现代码</h3>
<p>以下是我们在 <code>ViewExtension.tsx</code> 中的核心实现逻辑。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> applyFullscreen = <span class="hljs-title function_">useCallback</span>(
  <span class="hljs-keyword">async</span> (<span class="hljs-attr">next</span>: <span class="hljs-built_in">boolean</span>) =&gt; {
    <span class="hljs-keyword">if</span> (next) {
      <span class="hljs-comment">// 1. 状态快照：保存当前位置、大小、是否可调整</span>
      <span class="hljs-keyword">const</span> size = <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">getWindowSize</span>();
      <span class="hljs-keyword">const</span> resizable = <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">isWindowResizable</span>();
      <span class="hljs-keyword">const</span> pos = <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">getWindowPosition</span>();
      
      fullscreenPrevRef.<span class="hljs-property">current</span> = {
        <span class="hljs-attr">width</span>: size.<span class="hljs-property">width</span>,
        <span class="hljs-attr">height</span>: size.<span class="hljs-property">height</span>,
        resizable,
        <span class="hljs-attr">x</span>: pos.<span class="hljs-property">x</span>,
        <span class="hljs-attr">y</span>: pos.<span class="hljs-property">y</span>,
      };

      <span class="hljs-comment">// 2. 针对 macOS + Tauri (NSPanel) 的特殊处理</span>
      <span class="hljs-keyword">if</span> (isMac &amp;&amp; isTauri) {
        <span class="hljs-comment">// 关键步：获取鼠标所在的屏幕，实现“原位全屏”</span>
        <span class="hljs-keyword">const</span> monitor = <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">getMonitorFromCursor</span>();

        <span class="hljs-keyword">if</span> (!monitor) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">getCurrentWebviewWindow</span>();
        <span class="hljs-keyword">const</span> factor = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scaleFactor</span>();

        <span class="hljs-comment">// 3. 坐标转换：物理像素 -&gt; 逻辑像素</span>
        <span class="hljs-keyword">const</span> { size, position } = monitor;
        <span class="hljs-keyword">const</span> { width, height } = size.<span class="hljs-title function_">toLogical</span>(factor);
        <span class="hljs-keyword">const</span> { x, y } = position.<span class="hljs-title function_">toLogical</span>(factor);

        <span class="hljs-comment">// 4. 手动铺满屏幕</span>
        <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowSize</span>(width, height);
        <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowPosition</span>(x, y);
        <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowResizable</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 全屏模式下通常允许调整</span>
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">recomputeScale</span>(); <span class="hljs-comment">// 调整内部 Web 内容的缩放比例</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 其他平台使用标准 API 即可</span>
        <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowFullscreen</span>(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">recomputeScale</span>();
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 5. 退出全屏：恢复如初</span>
      <span class="hljs-keyword">if</span> (!isMac) {
        <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowFullscreen</span>(<span class="hljs-literal">false</span>);
      }
      <span class="hljs-comment">// 从配置或默认值恢复大小</span>
      <span class="hljs-keyword">const</span> nextWidth = ui?.<span class="hljs-property">width</span> ?? <span class="hljs-variable constant_">DEFAULT_VIEW_WIDTH</span>;
      <span class="hljs-keyword">const</span> nextHeight = ui?.<span class="hljs-property">height</span> ?? <span class="hljs-variable constant_">DEFAULT_VIEW_HEIGHT</span>;
      
      <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowSize</span>(nextWidth, nextHeight);
      <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowResizable</span>(ui?.<span class="hljs-property">resizable</span> ?? <span class="hljs-literal">true</span>);
      
      <span class="hljs-comment">// 关键步：居中回原来的屏幕</span>
      <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">centerOnCurrentMonitor</span>();
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">recomputeScale</span>();
      
      <span class="hljs-comment">// 6. 焦点修复（防止操作中断）</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
      }, <span class="hljs-number">0</span>);
    }
  },
  [ui, recomputeScale]
);
</code></pre>
<h3 data-id="heading-6">为什么这样做体验更好？</h3>
<ul>
<li><strong>瞬时响应</strong>：没有了系统全屏动画的拖泥带水，点击即全屏。</li>
<li><strong>多屏友好</strong>：完美支持多显示器环境，不再发生“窗口瞬移”的灵异事件。</li>
<li><strong>UI 自由度</strong>：保留了我们自定义的 UI 控件，不受系统标题栏的干扰。</li>
</ul>
<h2 data-id="heading-7">小结</h2>
<p>在开发 <strong>Coco AI</strong> 的过程中，我们始终坚持 <strong>“不因为技术限制而妥协用户体验”</strong> 。虽然手动管理窗口状态比调用一个 API 麻烦得多，但为了让用户在使用插件时能有丝滑的体验，这一切都是值得的。</p>
<p>如果你对我们的技术栈（Rust + Tauri + React）感兴趣，或者想体验一下这个“既能小巧悬浮，又能全屏沉浸”的生产力工具，欢迎访问我们的 GitHub 仓库和官网：</p>
<ul>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">github.com/infinilabs/…</a></li>
<li><strong>Website</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs%2F" target="_blank" title="https://coco.rs/" ref="nofollow noopener noreferrer">coco.rs/en</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（17）Netty如何处理大量的并发连接？]]></title>    <link>https://juejin.cn/post/7585024562216402984</link>    <guid>https://juejin.cn/post/7585024562216402984</guid>    <pubDate>2025-12-18T11:55:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585024562216402984" data-draft-id="7584997357445726248" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（17）Netty如何处理大量的并发连接？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-18T11:55:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（17）Netty如何处理大量的并发连接？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:55:04.000Z" title="Thu Dec 18 2025 11:55:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty是一个高性能的网络通信框架，它通过使用异步、事件驱动的方式处理大量的并发连接。下面是一个详细的解释，结合代码示例说明Netty如何处理大量的并发连接。</p>
<ol>
<li>使用多线程模型：
Netty使用了多线程模型来处理并发连接。它通过使用一个主线程（Boss Thread）来接受新的连接请求，并将已接受的连接分配给工作线程（Worker Thread）处理。这种方式可以有效地利用多核CPU的性能，提高并发处理能力。</li>
</ol>
<p>以下是一个示例代码，演示了如何配置多线程模型：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
<span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

<span class="hljs-keyword">try</span> {
    <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">bootstrap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
    bootstrap.group(bossGroup, workerGroup)
             .channel(NioServerSocketChannel.class)
             .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                 <span class="hljs-meta">@Override</span>
                 <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> {
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHandler</span>());
                 }
             });

    <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> bootstrap.bind(<span class="hljs-number">8080</span>).sync();
    future.channel().closeFuture().sync();
} <span class="hljs-keyword">finally</span> {
    bossGroup.shutdownGracefully();
    workerGroup.shutdownGracefully();
}
</code></pre>
<p>在上面的示例中，我们创建了一个主线程组（bossGroup）和一个工作线程组（workerGroup）。主线程组负责接受新的连接请求，而工作线程组负责处理已接受的连接。通过使用NioEventLoopGroup，Netty可以使用NIO（Non-blocking I/O）方式处理连接，从而提高并发处理能力。</p>
<ol start="2">
<li>使用事件驱动模型：
Netty使用事件驱动模型来处理网络事件。它通过使用ChannelPipeline和ChannelHandler来处理不同的网络事件，例如连接建立、数据读写等。每个事件都会触发相应的事件处理方法，从而实现异步、非阻塞的网络通信。</li>
</ol>
<p>以下是一个示例代码，演示了如何配置事件驱动模型：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> {
        <span class="hljs-comment">// 处理读取数据的逻辑</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> {
        <span class="hljs-comment">// 处理连接建立的逻辑</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> {
        <span class="hljs-comment">// 处理异常的逻辑</span>
    }
}
</code></pre>
<p>在上面的示例中，我们创建了一个自定义的ChannelHandler（MyHandler），并重写了一些事件处理方法。当有数据可读时，channelRead方法会被触发；当连接建立时，channelActive方法会被触发；当发生异常时，exceptionCaught方法会被触发。通过重写这些方法，我们可以在不同的事件发生时执行相应的逻辑。</p>
<p>通过使用事件驱动模型，Netty可以处理大量的并发连接，而不需要为每个连接创建一个线程。这种方式可以减少线程切换的开销，提高系统的并发性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（18）Netty的内存模型]]></title>    <link>https://juejin.cn/post/7584997357445742632</link>    <guid>https://juejin.cn/post/7584997357445742632</guid>    <pubDate>2025-12-18T11:56:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584997357445742632" data-draft-id="7585007321207095348" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（18）Netty的内存模型"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-18T11:56:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（18）Netty的内存模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T11:56:05.000Z" title="Thu Dec 18 2025 11:56:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的内存模型是基于ByteBuf的，它提供了一种灵活而高效的内存管理方式。下面是一个详细的解释，结合代码示例说明Netty的内存模型。</p>
<ol>
<li>ByteBuf的类型：
Netty中的ByteBuf是用于存储和操作字节数据的缓冲区。它有两种类型：Heap ByteBuf和Direct ByteBuf。</li>
</ol>
<ul>
<li>Heap ByteBuf：Heap ByteBuf是基于JVM堆内存的缓冲区，它使用字节数组来存储数据。Heap ByteBuf的优点是易于管理和使用，但在进行I/O操作时可能需要进行额外的数据拷贝。</li>
<li>Direct ByteBuf：Direct ByteBuf是基于直接内存（堆外内存）的缓冲区，它使用操作系统的原生内存来存储数据。Direct ByteBuf的优点是可以直接与操作系统进行交互，避免了数据拷贝的开销。</li>
</ul>
<p>以下是一个示例代码，演示了如何创建不同类型的ByteBuf：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ByteBuf</span> <span class="hljs-variable">heapBuffer</span> <span class="hljs-operator">=</span> Unpooled.buffer(<span class="hljs-number">1024</span>);
<span class="hljs-type">ByteBuf</span> <span class="hljs-variable">directBuffer</span> <span class="hljs-operator">=</span> Unpooled.directBuffer(<span class="hljs-number">1024</span>);
</code></pre>
<p>在上面的示例中，我们分别创建了一个Heap ByteBuf（heapBuffer）和一个Direct ByteBuf（directBuffer）。</p>
<ol start="2">
<li>内存分配器：
Netty提供了不同的内存分配器来管理ByteBuf的分配和释放。它支持两种内存分配器：Pooled和Unpooled。</li>
</ol>
<ul>
<li>Pooled：Pooled内存分配器使用对象池来重用ByteBuf实例，从而减少内存分配和释放的开销。它适用于频繁地创建和释放ByteBuf的场景。</li>
<li>Unpooled：Unpooled内存分配器每次都会创建一个新的ByteBuf实例，不进行对象重用。它适用于临时性的数据操作。</li>
</ul>
<p>以下是一个示例代码，演示了如何使用不同类型的内存分配器：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ByteBufAllocator</span> <span class="hljs-variable">allocator</span> <span class="hljs-operator">=</span> PooledByteBufAllocator.DEFAULT;
<span class="hljs-type">ByteBuf</span> <span class="hljs-variable">pooledBuffer</span> <span class="hljs-operator">=</span> allocator.buffer(<span class="hljs-number">1024</span>);
<span class="hljs-type">ByteBuf</span> <span class="hljs-variable">unpooledBuffer</span> <span class="hljs-operator">=</span> Unpooled.buffer(<span class="hljs-number">1024</span>);
</code></pre>
<p>在上面的示例中，我们使用PooledByteBufAllocator和Unpooled来创建不同类型的ByteBuf。</p>
<p>通过使用内存分配器，Netty可以根据具体的使用场景来选择合适的内存管理方式，从而提高性能和内存利用率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tauri(21)——窗口缩放后的”失焦惊魂”，游戏控制权丢失了]]></title>    <link>https://juejin.cn/post/7585006378533486634</link>    <guid>https://juejin.cn/post/7585006378533486634</guid>    <pubDate>2025-12-18T12:01:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585006378533486634" data-draft-id="7585034139661860883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tauri(21)——窗口缩放后的”失焦惊魂”，游戏控制权丢失了"/> <meta itemprop="keywords" content="前端,APP,macOS"/> <meta itemprop="datePublished" content="2025-12-18T12:01:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨夜寻晴天"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tauri(21)——窗口缩放后的”失焦惊魂”，游戏控制权丢失了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨夜寻晴天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T12:01:47.000Z" title="Thu Dec 18 2025 12:01:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,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) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,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) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在上一篇文章中，我们分享了如何在 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">Coco AI</a></strong> 中实现丝滑的 NSPanel 窗口全屏体验。然而，全屏只是第一步，真正的挑战往往隐藏在细节之中。</p>
<p>Coco AI 的核心亮点之一是其日渐强大的<strong>插件生态</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs%2Fen%2Fintegration%2Fextensions" target="_blank" title="https://coco.rs/en/integration/extensions" ref="nofollow noopener noreferrer">Extensions</a>）。用户可以通过安装插件，在 Coco 的悬浮窗中直接运行各种 Web 应用，甚至玩 Doom 这样的小游戏。</p>
<p>但我们在开发过程中遇到了一个非常影响心情的 Bug：</p>
<p><strong>当用户正沉浸在游戏中，觉得窗口太小而点击“全屏”后，突然发现键盘失灵了——WASD 怎么按都没反应，手动点画面也不能继续操作...</strong></p>
<p>对于一款追求极致体验的生产力工具来说，这种“断触”是不可接受的。今天我们就来深度复盘这个**焦点丢失（Focus Loss）**问题，以及我们在 Coco App 中的“组合拳”解决方案。</p>
<h2 data-id="heading-1">场景复现</h2>
<ol>
<li>用户在 Coco AI 中启动了一个游戏插件（通过 <code>iframe</code> 加载）。</li>
<li>初始窗口较小，用户通过 WASD 控制角色移动，一切正常。</li>
<li>用户点击右上角的“全屏”按钮，希望获得沉浸体验。</li>
<li>窗口瞬间变大铺满屏幕，但此时按下 W 键，角色纹丝不动。</li>
<li>用户拿起鼠标不断的点击一下游戏画面，控制权也未能恢复。</li>
</ol>
<h2 data-id="heading-2">为什么会失焦？</h2>
<p>这个问题的根源在于 DOM 树的重建和窗口系统的焦点管理机制，特别是在 React + Tauri 的混合架构下：</p>
<ol>
<li><strong>DOM 重绘/重排</strong>：当窗口从悬浮模式切换到全屏模式时，React 组件可能会因为状态变化（如 <code>scale</code> 缩放系数改变、<code>layout</code> 模式切换）而重新渲染。如果 <code>iframe</code> 在这个过程中被卸载并重新挂载，它就是一个全新的 <code>iframe</code>，之前的焦点自然荡然无存。</li>
<li><strong>Native 窗口焦点转移</strong>：调用 Tauri 的 <code>setWindowSize</code> 或 <code>setFullscreen</code> 等底层 API 时，操作系统可能会暂时把焦点从 WebView 内容区域移开，转移到窗口边框或系统层级。</li>
<li><strong>Iframe 的隔离性</strong>：<code>iframe</code> 内部是一个独立的 <code>window</code> 上下文。主文档（Parent）获得焦点并不意味着 <code>iframe</code> 获得焦点。你需要显式地把焦点“传递”进去。</li>
</ol>
<h2 data-id="heading-3">Coco AI 的解决方案：全方位焦点守护</h2>
<p>为了确保用户体验的连贯性，我们在 <code>ViewExtension.tsx</code> 组件中实施了一套多层级的焦点管理策略。</p>
<h3 data-id="heading-4">第一招：组件挂载后的自动聚焦</h3>
<p>在 React 中，利用 <code>ref</code> 和 <code>onLoad</code> 事件，确保插件加载完毕的那一刻，焦点就自动锁定在它身上。</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;div
  <span class="hljs-comment">// 绑定 Ref</span>
  ref={iframeRef}
  <span class="hljs-comment">// 任何点击外层容器的操作，都把焦点送给 iframe</span>
  onClickCapture={<span class="hljs-function">() =&gt;</span> {
    iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
  }}
&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span>
    <span class="hljs-attr">ref</span>=<span class="hljs-string">{iframeRef}</span>
    <span class="hljs-attr">src</span>=<span class="hljs-string">{fileUrl}</span>
    // <span class="hljs-attr">Iframe</span> <span class="hljs-attr">加载完毕瞬间聚焦</span>
    <span class="hljs-attr">onLoad</span>=<span class="hljs-string">{(event)</span> =&gt;</span> {
      event.currentTarget.focus();
      try {
        // 尝试深入聚焦到 iframe 内部的 window
        iframeRef.current?.contentWindow?.focus();
      } catch (e) {
        console.warn("Failed to focus iframe content:", e);
      }
    }}
    // 允许必要的权限：全屏、鼠标锁定（FPS游戏必备）、手柄
    allow="fullscreen; pointer-lock; gamepad"
    tabIndex={-1}
  /&gt;</span>
&lt;/div&gt;
</code></pre>
<h3 data-id="heading-5">第二招：状态变化后的延迟聚焦</h3>
<p>当你执行全屏或缩放操作后，Native 层的窗口调整是异步的，React 的渲染也是异步的。如果你立即调用 <code>focus()</code>，可能 DOM 还没稳，或者窗口还在动画中，导致聚焦失败。</p>
<p>我们的<strong>秘诀是 <code>setTimeout</code></strong>，等待一轮事件循环：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> applyFullscreen = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">next</span>: <span class="hljs-built_in">boolean</span>) =&gt; {
  <span class="hljs-comment">// ... 执行窗口大小调整逻辑 ...</span>
  
  <span class="hljs-comment">// 等待系统窗口调整完成且 React 渲染完毕</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 1. 聚焦 iframe 元素本身</span>
    iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 2. 尝试聚焦 iframe 内部内容（处理跨域限制时可能报错，加 try-catch）</span>
      iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-property">contentWindow</span>?.<span class="hljs-title function_">focus</span>();
    } <span class="hljs-keyword">catch</span> {}
  }, <span class="hljs-number">0</span>);
}, []);
</code></pre>
<h3 data-id="heading-6">第三招：显式的“焦点救生圈”</h3>
<p>为了应对浏览器安全策略限制脚本自动聚焦等极端情况，我们在 UI 上设计了一个显式的 <strong>Focus 按钮</strong>。这不仅是一个功能补救，也是一个视觉提示。</p>
<pre><code class="hljs language-typescript" lang="typescript">{<span class="hljs-comment">/* Focus helper button */</span>}
&lt;button
  aria-label=<span class="hljs-string">"Focus Game"</span>
  className=<span class="hljs-string">"absolute top-2 right-12 z-10 p-2 bg-black/50 hover:bg-black/70 rounded text-white transition-colors"</span>
  onClick={<span class="hljs-function">() =&gt;</span> {
    iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
    <span class="hljs-keyword">try</span> {
      iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-property">contentWindow</span>?.<span class="hljs-title function_">focus</span>();
    } <span class="hljs-keyword">catch</span> {}
  }}
&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FocusIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"size-4"</span>/&gt;</span></span>
&lt;/button&gt;
</code></pre>
<p>当用户发现控制失灵时，潜意识会寻找界面上的交互点，点击这个按钮就能瞬间找回焦点。</p>
<h3 data-id="heading-7">第四招：事件捕获（Capture Phase）</h3>
<p>有时候用户点击了窗口边缘的空白区域（padding 或 margin），焦点会跑回主文档 <code>body</code>。我们可以通过在容器上监听 <code>onMouseDownCapture</code> 来拦截这些点击，强行把焦点按回 <code>iframe</code>。</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;div
  className=<span class="hljs-string">"w-full h-full flex flex-col items-center justify-center"</span>
  <span class="hljs-comment">// 捕获阶段拦截，比冒泡更早</span>
  onMouseDownCapture={<span class="hljs-function">() =&gt;</span> {
    iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
  }}
  onPointerDown={<span class="hljs-function">() =&gt;</span> {
    iframeRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
  }}
&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">...</span> /&gt;</span></span>
&lt;/div&gt;
</code></pre>
<h2 data-id="heading-8">小结</h2>
<p>焦点管理看似简单，但在构建像 <strong>Coco AI</strong> 这样复杂的桌面+Web 混合应用时，它直接关系到用户的沉浸感。通过这套 <strong>“主动出击 + 纵深防御 + 异步等待 + 兜底方案”</strong> 的组合拳，我们成功解决了跨平台、跨窗口尺寸下的焦点丢失问题。</p>
<p>现在，无论是在写代码时快速查阅文档，还是在休息时玩一把小游戏，Coco AI 都能提供无缝、流畅的交互体验。</p>
<p>如果你对我们的技术细节感兴趣，或者想体验一下这款全能的生产力工具，欢迎访问我们的开源仓库和官网：</p>
<ul>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">github.com/infinilabs/…</a></li>
<li><strong>Website</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs" target="_blank" title="https://coco.rs" ref="nofollow noopener noreferrer">coco.rs</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[.Net通过EFCore和仓储模式实现统一数据权限管控并且相关权限配置动态生成]]></title>    <link>https://juejin.cn/post/7585031571889405995</link>    <guid>https://juejin.cn/post/7585031571889405995</guid>    <pubDate>2025-12-18T10:11:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585031571889405995" data-draft-id="7584807992031969322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=".Net通过EFCore和仓储模式实现统一数据权限管控并且相关权限配置动态生成"/> <meta itemprop="keywords" content="后端,GitHub"/> <meta itemprop="datePublished" content="2025-12-18T10:11:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户2199167970391"/> <meta itemprop="url" content="https://juejin.cn/user/299483255543757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            .Net通过EFCore和仓储模式实现统一数据权限管控并且相关权限配置动态生成
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/299483255543757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户2199167970391
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T10:11:56.000Z" title="Thu Dec 18 2025 10:11:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">基于EFCore实现统一数据权限管控</h3>
<p>在.NET应用中，通过EFCore和仓储模式实现数据权限管控，可以按照以下方式设计：</p>
<h4 data-id="heading-1">数据权限层级定义</h4>
<p>数据权限通常分为四个层级：所有数据、本部门数据、本部门及下属部门数据、本人数据。通过仓储模式可以统一封装这些查询逻辑。</p>
<h3 data-id="heading-2">具体实现可参考NetCoreKevin的Kevin.EntityFrameworkCore.Repository`和kevin.Permission服务模块：实现统一数据权限管控并且相关权限配置动态生成</h3>
<p>基于NET构建的现代化AI智能体Saas企业级架构：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/580515eaf81e46d08cc8f92335c136c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MjE5OTE2Nzk3MDM5MQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657516&amp;x-signature=x0g2JJt0GSFLZkaLNUYaXlgfBzE%3D" alt="在这里插入图片描述" loading="lazy"/>
项目地址：github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjunkai-li%2FNetCoreKevin" target="_blank" title="https://github.com/junkai-li/NetCoreKevin" ref="nofollow noopener noreferrer">github.com/junkai-li/N…</a>
Gitee: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fnetkevin-li%2FNetCoreKevin" target="_blank" title="https://gitee.com/netkevin-li/NetCoreKevin" ref="nofollow noopener noreferrer">gitee.com/netkevin-li…</a></p>
<h4 data-id="heading-3">基础仓储接口设计</h4>
<p>定义基础仓储接口，包含数据权限过滤方法：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IRepository</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">where</span> <span class="hljs-title">T</span> : <span class="hljs-keyword">class</span>
{
    <span class="hljs-function">IQueryable&lt;T&gt; <span class="hljs-title">GetAll</span>()</span>;
    <span class="hljs-function">IQueryable&lt;T&gt; <span class="hljs-title">GetByDepartment</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> departmentId</span>)</span>;
    <span class="hljs-function">IQueryable&lt;T&gt; <span class="hljs-title">GetByDepartmentWithChildren</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> departmentId</span>)</span>;
    <span class="hljs-function">IQueryable&lt;T&gt; <span class="hljs-title">GetByUser</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> userId</span>)</span>;
}
</code></pre>
<h4 data-id="heading-4">实现数据权限过滤</h4>
<p>在具体仓储实现中，通过EFCore的查询表达式实现不同级别的数据过滤：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Repository</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">IRepository</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">where</span> <span class="hljs-title">T</span> : <span class="hljs-keyword">class</span>, <span class="hljs-title">IDataPermission</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> DbContext _context;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ICurrentUser _currentUser;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Repository</span>(<span class="hljs-params">DbContext context, ICurrentUser currentUser</span>)</span>
    {
        _context = context;
        _currentUser = currentUser;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IQueryable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">GetAll</span>()</span>
    {
        <span class="hljs-keyword">return</span> _context.Set&lt;T&gt;().AsQueryable();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IQueryable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">GetByDepartment</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> departmentId</span>)</span>
    {
        <span class="hljs-keyword">return</span> _context.Set&lt;T&gt;().Where(x =&gt; x.DepartmentId == departmentId);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> IQueryable&lt;T&gt; <span class="hljs-title">GetByDepartmentWithChildren</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> departmentId</span>)</span>
    {
        <span class="hljs-keyword">var</span> departmentIds = GetChildDepartmentIds(departmentId);
        <span class="hljs-keyword">return</span> _context.Set&lt;T&gt;().Where(x =&gt; departmentIds.Contains(x.DepartmentId));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IQueryable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">GetByUser</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> userId</span>)</span>
    {
        <span class="hljs-keyword">return</span> _context.Set&lt;T&gt;().Where(x =&gt; x.CreatedBy == userId);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-title">GetChildDepartmentIds</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> parentId</span>)</span>
    {
        <span class="hljs-comment">// 递归获取所有子部门ID</span>
    }
}
</code></pre>
<h4 data-id="heading-5">实体接口设计</h4>
<p>定义数据权限相关实体接口，确保实体包含必要字段：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDataPermission</span>
{
    <span class="hljs-built_in">int</span> DepartmentId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-built_in">int</span> CreatedBy { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4 data-id="heading-6">动态权限查询扩展</h4>
<p>创建扩展方法，根据用户权限动态选择查询范围：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RepositoryExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">IQueryable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">WithDataPermission</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params"><span class="hljs-keyword">this</span> IRepository&lt;T&gt; repository, DataPermissionLevel level</span>) 
        <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, IDataPermission</span>
    {
        <span class="hljs-keyword">switch</span>(level)
        {
            <span class="hljs-keyword">case</span> DataPermissionLevel.All:
                <span class="hljs-keyword">return</span> repository.GetAll();
            <span class="hljs-keyword">case</span> DataPermissionLevel.Department:
                <span class="hljs-keyword">return</span> repository.GetByDepartment(currentUser.DepartmentId);
            <span class="hljs-keyword">case</span> DataPermissionLevel.DepartmentWithChildren:
                <span class="hljs-keyword">return</span> repository.GetByDepartmentWithChildren(currentUser.DepartmentId);
            <span class="hljs-keyword">case</span> DataPermissionLevel.Owner:
                <span class="hljs-keyword">return</span> repository.GetByUser(currentUser.UserId);
            <span class="hljs-literal">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentOutOfRangeException();
        }
    }
}
</code></pre>
<h4 data-id="heading-7">权限枚举定义</h4>
<p>定义数据权限级别枚举：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> DataPermissionLevel
{
    All,
    Department,
    DepartmentWithChildren,
    Owner
}
</code></pre>
<h4 data-id="heading-8">使用示例</h4>
<p>在服务层或控制器中使用数据权限过滤：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IRepository&lt;Employee&gt; _repository;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ICurrentUser _currentUser;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EmployeeService</span>(<span class="hljs-params">IRepository&lt;Employee&gt; repository, ICurrentUser currentUser</span>)</span>
    {
        _repository = repository;
        _currentUser = currentUser;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Employee&gt; <span class="hljs-title">GetEmployees</span>(<span class="hljs-params">DataPermissionLevel level</span>)</span>
    {
        <span class="hljs-keyword">return</span> _repository.WithDataPermission(level).ToList();
    }
}
</code></pre>
<h4 data-id="heading-9">权限控制中间件</h4>
<p>可以创建中间件自动设置当前用户的数据权限级别：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataPermissionMiddleware</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> RequestDelegate _next;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataPermissionMiddleware</span>(<span class="hljs-params">RequestDelegate next</span>)</span>
    {
        _next = next;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">InvokeAsync</span>(<span class="hljs-params">HttpContext context, ICurrentUser currentUser</span>)</span>
    {
        <span class="hljs-comment">// 根据用户角色设置数据权限级别</span>
        currentUser.DataPermissionLevel = GetPermissionLevelFromClaims(context.User);
        
        <span class="hljs-keyword">await</span> _next(context);
    }
}
</code></pre>
<p>这种实现方式通过仓储模式统一了数据权限控制逻辑，使业务代码无需关心具体权限实现细节，只需指定权限级别即可自动过滤数据。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【AI 编程实战】第 4 篇：一次完美 vs 五轮对话 - UnoCSS 配置的正确姿势]]></title>    <link>https://juejin.cn/post/7584472215976116239</link>    <guid>https://juejin.cn/post/7584472215976116239</guid>    <pubDate>2025-12-17T12:07:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215976116239" data-draft-id="7584633505104724020" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【AI 编程实战】第 4 篇：一次完美 vs 五轮对话 - UnoCSS 配置的正确姿势"/> <meta itemprop="keywords" content="前端,uni-app,AI编程"/> <meta itemprop="datePublished" content="2025-12-17T12:07:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HashTang"/> <meta itemprop="url" content="https://juejin.cn/user/1117561754756488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【AI 编程实战】第 4 篇：一次完美 vs 五轮对话 - UnoCSS 配置的正确姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117561754756488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HashTang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:07:48.000Z" title="Wed Dec 17 2025 12:07:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,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) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><blockquote>
<p>很多教程告诉你"写好提示词就能让 AI 一次给出正确答案"，但现实是：<strong>你不可能一开始就知道所有细节</strong>。真正高效的 AI 协作，是在对话中逐步明确需求。这篇文章通过一个完整的 UnoCSS 配置案例，展示我和 TRAE SOLO 的<strong>真实交互过程</strong>——从模糊想法到完整方案，中间经历了哪些沟通和调整。</p>
<p>这是《<a href="https://juejin.cn/column/7579556047783624756" target="_blank" title="https://juejin.cn/column/7579556047783624756">AI 编程实战：TRAE SOLO 全栈开发指南</a>》专栏的第四篇文章，带你学会如何与 AI 正确的沟通协作。</p>
</blockquote>
<h2 data-id="heading-0">一、开篇：别被"完美提示词"骗了</h2>
<h3 data-id="heading-1">1.1 一个常见的误区</h3>
<p>网上很多 AI 教程会给你看这样的"完美提示词"：</p>
<pre><code class="hljs language-txt" lang="txt">帮我配置 UnoCSS，项目环境和需求如下：
【项目环境】UniApp + Vue3 + Vite，目标平台微信小程序
【功能需求】支持 attributify、@apply、图标、安全区适配
【已知问题】小程序 transform 类需要预设 CSS 变量
【输出要求】完整的 uno.config.ts 配置文件
</code></pre>
<p>然后告诉你："看，一次就能得到完美答案！"</p>
<p><strong>但问题是</strong>：</p>
<ul>
<li>你一开始怎么知道需要"安全区适配"？</li>
<li>你怎么知道"transform 类需要预设 CSS 变量"？</li>
<li>这些都是<strong>踩坑之后才知道的</strong></li>
</ul>
<h3 data-id="heading-2">1.2 真实的 AI 协作是什么样的</h3>
<p>真实的 AI 协作是一个<strong>渐进式对话</strong>的过程：</p>
<pre><code class="hljs language-txt" lang="txt">第 1 轮：我有个模糊的需求
    ↓
AI：给出初步方案 + 执行计划
    ↓
第 2 轮：我发现问题 / 补充细节
    ↓
AI：调整方案
    ↓
第 3 轮：遇到报错 / 样式不生效
    ↓
AI：排查问题 + 修复
    ↓
最终：得到完整可用的方案
</code></pre>
<p>接下来，我会完整展示和 TRAE SOLO 配置 UnoCSS 的<strong>真实对话过程</strong>。</p>
<h2 data-id="heading-3">二、第一轮对话：从模糊需求开始</h2>
<h3 data-id="heading-4">2.1 我的第一句话</h3>
<p>刚开始，我对 UnoCSS 的了解很有限，只知道它是"原子化 CSS"。我的第一句话很简单：</p>
<pre><code class="hljs language-txt" lang="txt">我：项目需要用 UnoCSS，帮我配置一下
</code></pre>
<h3 data-id="heading-5">2.2 TRAE SOLO 的响应：先给执行计划</h3>
<p>TRAE SOLO 没有直接开始写代码，而是先给出了<strong>执行计划</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，我来帮你配置 UnoCSS。在开始之前，我需要先了解一些信息：

📋 执行计划：
1. 分析项目结构，确定技术栈
2. 选择合适的 UnoCSS 预设
3. 生成配置文件
4. 配置 Vite 插件

🤔 我有几个问题：
1. 这是什么类型的项目？（Vue/React/UniApp）
2. 目标运行平台是什么？（Web/小程序/App）
3. 有没有特别想要的功能？（图标/attributify 模式等）

请告诉我这些信息，或者我可以先分析你的项目结构来判断。
</code></pre>
<p><strong>关键点</strong>：TRAE SOLO 主动<strong>询问上下文</strong>，而不是瞎猜。</p>
<h3 data-id="heading-6">2.3 我补充信息</h3>
<pre><code class="hljs language-txt" lang="txt">我：UniApp + Vue3 项目，主要跑微信小程序，也要支持 H5。
    功能的话，我也不太清楚，你看着配吧，常用的都加上。
</code></pre>
<h3 data-id="heading-7">2.4 TRAE SOLO 分析项目后给出方案</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：我分析了你的项目结构，发现：
- 框架：UniApp + Vue3 + Vite
- UI 库：已安装 wot-design-uni
- 目标：微信小程序 + H5

📋 更新执行计划：

1. 安装依赖
   - unocss
   - @uni-helper/unocss-preset-uni （UniApp 专用预设，必须）
   - @iconify-json/carbon （图标库，可选）

2. 创建 uno.config.ts，包含：
   - presetUni：小程序适配
   - presetAttributify：支持属性化写法
   - presetIcons：图标支持
   - transformerDirectives：支持 @apply 指令

3. 修改 vite.config.ts，添加 UnoCSS 插件

4. 在 main.ts 中引入 uno.css

是否按这个计划执行？或者你想调整什么？
</code></pre>
<h3 data-id="heading-8">2.5 我确认执行</h3>
<pre><code class="hljs language-txt" lang="txt">我：可以，就按这个来
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，开始执行...

✅ 正在安装依赖...
✅ 创建 uno.config.ts...
✅ 修改 vite.config.ts...
✅ 修改 main.ts...

配置完成！你可以这样使用：

&lt;view class="flex items-center gap-4 p-4 bg-white rounded-xl"&gt;
  &lt;text class="text-lg font-bold"&gt;Hello UnoCSS&lt;/text&gt;
&lt;/view&gt;

运行 pnpm dev:mp-weixin 试试看效果。
</code></pre>
<h2 data-id="heading-9">三、第二轮对话：遇到问题，继续沟通</h2>
<h3 data-id="heading-10">3.1 我发现样式不生效</h3>
<p>运行项目后，我发现部分样式不生效：</p>
<pre><code class="hljs language-txt" lang="txt">我：样式大部分生效了，但是 translate-x-2 这个类没效果，
    元素没有移动
</code></pre>
<h3 data-id="heading-11">3.2 TRAE SOLO 排查问题</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：让我检查一下...

我查看了生成的 CSS，发现 translate-x-2 生成的代码是：

transform: translateX(var(--un-translate-x));

问题在于：小程序环境没有预设 --un-translate-x 这个 CSS 变量。

在浏览器中，UnoCSS 会通过 :root 选择器预设这些变量，
但小程序不支持 :root 选择器。

🔧 修复方案：
在 uno.config.ts 中添加 preflights，手动为小程序元素预设变量。

是否需要我帮你修复？
</code></pre>
<h3 data-id="heading-12">3.3 我让它修复</h3>
<pre><code class="hljs language-txt" lang="txt">我：帮我修复吧
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，我来修改 uno.config.ts...

添加了以下配置：

preflights: [
  {
    layer: 'unocss-transform-fix',
    getCSS: () =&gt; `
page, view, text, image {
  --un-translate-x: 0;
  --un-translate-y: 0;
  --un-rotate: 0;
  --un-scale-x: 1;
  --un-scale-y: 1;
  /* ... 其他变量 */
}
`,
  },
],

✅ 已修复，重新运行项目试试。
</code></pre>
<h3 data-id="heading-13">3.4 我验证修复成功</h3>
<pre><code class="hljs language-txt" lang="txt">我：好了，translate 生效了
</code></pre>
<h2 data-id="heading-14">四、第三轮对话：追加新需求</h2>
<h3 data-id="heading-15">4.1 我想添加安全区适配</h3>
<p>开发过程中，我发现 iPhone 底部有安全区域遮挡内容：</p>
<pre><code class="hljs language-txt" lang="txt">我：iPhone 底部有个横条会挡住内容，UnoCSS 能处理这个吗？
</code></pre>
<h3 data-id="heading-16">4.2 TRAE SOLO 给出方案</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：这是 iPhone 的安全区域问题。可以通过自定义 UnoCSS 规则来解决。

📋 方案：
添加以下自定义规则：
- pb-safe：底部安全区内边距
- pt-safe：顶部安全区内边距（刘海屏）
- p-safe：四边安全区内边距

使用方式：
&lt;view class="pb-safe"&gt;底部内容会避开安全区&lt;/view&gt;

是否需要我添加这些规则？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：加上吧
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，在 uno.config.ts 的 rules 中添加：

rules: [
  ['pb-safe', { 'padding-bottom': 'env(safe-area-inset-bottom)' }],
  ['pt-safe', { 'padding-top': 'env(safe-area-inset-top)' }],
  ['p-safe', {
    padding: 'env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)',
  }],
],

✅ 已添加，现在可以使用 pb-safe 类了。
</code></pre>
<h2 data-id="heading-17">五、第四轮对话：优化开发体验</h2>
<h3 data-id="heading-18">5.1 我觉得类名太长了</h3>
<pre><code class="hljs language-txt" lang="txt">我：flex items-center justify-between 每次都要写这么长，
    有没有办法简化？
</code></pre>
<h3 data-id="heading-19">5.2 TRAE SOLO 介绍 shortcuts</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：可以用 UnoCSS 的 shortcuts 功能，把常用组合定义成短类名。

比如：
- center = flex justify-center items-center
- between = flex justify-between items-center

你想定义哪些快捷方式？或者我根据你的代码分析常用组合？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：你分析一下吧，看哪些用得多
</code></pre>
<h3 data-id="heading-20">5.3 TRAE SOLO 分析代码后给出建议</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：我扫描了你的代码，发现以下组合出现频率较高：

📊 使用频率分析：
1. flex items-center （出现 23 次）
2. flex items-center justify-between （出现 15 次）
3. flex items-center justify-center （出现 12 次）
4. flex flex-col （出现 8 次）
5. bg-white rounded-xl p-4 （出现 7 次）

🔧 建议添加的 shortcuts：

shortcuts: [
  { 'center': 'flex justify-center items-center' },
  { 'between': 'flex justify-between items-center' },
  { 'col': 'flex flex-col' },
  { 'card': 'bg-white rounded-xl p-4' },
],

是否按这个配置？或者你想调整？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：可以，就这样
</code></pre>
<h2 data-id="heading-21">六、第五轮对话：处理动态类名问题</h2>
<h3 data-id="heading-22">6.1 我遇到动态类名不生效</h3>
<pre><code class="hljs language-txt" lang="txt">我：我有个地方根据状态切换颜色：

    &lt;text :class="`text-${status}-500`"&gt;状态&lt;/text&gt;

    status 可能是 red、green、blue，但样式不生效
</code></pre>
<h3 data-id="heading-23">6.2 TRAE SOLO 解释原因并给方案</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：这是 UnoCSS 的一个限制。

🔍 原因：
UnoCSS 在构建时静态扫描代码，`text-${status}-500` 这种
动态拼接的类名无法被识别，所以不会生成对应的 CSS。

🔧 解决方案有三种：

【方案一】对象语法（推荐）
&lt;text :class="{
  'text-red-500': status === 'red',
  'text-green-500': status === 'green',
  'text-blue-500': status === 'blue',
}"&gt;状态&lt;/text&gt;

【方案二】safelist 预声明
在 uno.config.ts 中添加：
safelist: ['text-red-500', 'text-green-500', 'text-blue-500']

【方案三】CSS 变量
&lt;text class="text-[var(--status-color)]"
      :style="{ '--status-color': statusColor }"&gt;
  状态
&lt;/text&gt;

你的场景用哪种方案比较合适？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：颜色就这三种，用方案二吧，简单
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，已添加到 safelist：

safelist: [
  'text-red-500',
  'text-green-500',
  'text-blue-500',
  'i-carbon-code', // 之前已有的图标
],

✅ 现在动态类名可以正常工作了。
</code></pre>
<h2 data-id="heading-24">七、最终配置：多轮对话的成果</h2>
<p>经过 5 轮对话，最终的 <code>uno.config.ts</code> 是这样的：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// uno.config.ts</span>
<span class="hljs-comment">// 这个配置是通过多轮对话逐步完善的，不是一次性写出来的</span>

<span class="hljs-keyword">import</span> { presetUni } <span class="hljs-keyword">from</span> <span class="hljs-string">'@uni-helper/unocss-preset-uni'</span>
<span class="hljs-keyword">import</span> {
  defineConfig,
  presetAttributify,
  presetIcons,
  transformerDirectives,
  transformerVariantGroup,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'unocss'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// 【第 1 轮】基础预设</span>
  <span class="hljs-attr">presets</span>: [
    <span class="hljs-title function_">presetUni</span>({
      <span class="hljs-attr">attributify</span>: {
        <span class="hljs-attr">prefixedOnly</span>: <span class="hljs-literal">true</span>,
      },
    }),
    <span class="hljs-title function_">presetIcons</span>({
      <span class="hljs-attr">scale</span>: <span class="hljs-number">1.2</span>,
      <span class="hljs-attr">warn</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">extraProperties</span>: {
        <span class="hljs-string">'display'</span>: <span class="hljs-string">'inline-block'</span>,
        <span class="hljs-string">'vertical-align'</span>: <span class="hljs-string">'middle'</span>,
      },
    }),
    <span class="hljs-title function_">presetAttributify</span>(),
  ],

  <span class="hljs-comment">// 【第 1 轮】转换器</span>
  <span class="hljs-attr">transformers</span>: [
    <span class="hljs-title function_">transformerDirectives</span>(),
    <span class="hljs-title function_">transformerVariantGroup</span>(),
  ],

  <span class="hljs-comment">// 【第 2 轮】修复小程序 transform 不生效</span>
  <span class="hljs-attr">preflights</span>: [
    {
      <span class="hljs-attr">layer</span>: <span class="hljs-string">'unocss-transform-fix'</span>,
      <span class="hljs-attr">getCSS</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">`
page, view, text, image {
  --un-translate-x: 0;
  --un-translate-y: 0;
  --un-translate-z: 0;
  --un-rotate: 0;
  --un-rotate-x: 0;
  --un-rotate-y: 0;
  --un-rotate-z: 0;
  --un-skew-x: 0;
  --un-skew-y: 0;
  --un-scale-x: 1;
  --un-scale-y: 1;
  --un-scale-z: 1;
}
`</span>,
    },
  ],

  <span class="hljs-comment">// 【第 3 轮】安全区适配</span>
  <span class="hljs-attr">rules</span>: [
    [<span class="hljs-string">'p-safe'</span>, {
      <span class="hljs-attr">padding</span>: <span class="hljs-string">'env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)'</span>,
    }],
    [<span class="hljs-string">'pt-safe'</span>, { <span class="hljs-string">'padding-top'</span>: <span class="hljs-string">'env(safe-area-inset-top)'</span> }],
    [<span class="hljs-string">'pb-safe'</span>, { <span class="hljs-string">'padding-bottom'</span>: <span class="hljs-string">'env(safe-area-inset-bottom)'</span> }],
  ],

  <span class="hljs-comment">// 【第 4 轮】常用快捷方式</span>
  <span class="hljs-attr">shortcuts</span>: [
    { <span class="hljs-string">'center'</span>: <span class="hljs-string">'flex justify-center items-center'</span> },
    { <span class="hljs-string">'between'</span>: <span class="hljs-string">'flex justify-between items-center'</span> },
    { <span class="hljs-string">'col'</span>: <span class="hljs-string">'flex flex-col'</span> },
    { <span class="hljs-string">'card'</span>: <span class="hljs-string">'bg-white rounded-xl p-4'</span> },
  ],

  <span class="hljs-comment">// 【第 5 轮】动态类名预声明</span>
  <span class="hljs-attr">safelist</span>: [
    <span class="hljs-string">'text-red-500'</span>,
    <span class="hljs-string">'text-green-500'</span>,
    <span class="hljs-string">'text-blue-500'</span>,
    <span class="hljs-string">'i-carbon-code'</span>,
  ],

  <span class="hljs-comment">// 【第 1 轮】主题配置</span>
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">colors</span>: {
      <span class="hljs-attr">primary</span>: <span class="hljs-string">'var(--wot-color-theme, #0957DE)'</span>,
    },
    <span class="hljs-attr">fontSize</span>: {
      <span class="hljs-string">'2xs'</span>: [<span class="hljs-string">'20rpx'</span>, <span class="hljs-string">'28rpx'</span>],
      <span class="hljs-string">'3xs'</span>: [<span class="hljs-string">'18rpx'</span>, <span class="hljs-string">'26rpx'</span>],
    },
  },
})
</code></pre>
<h2 data-id="heading-25">八、组件开发：同样是对话式协作</h2>
<h3 data-id="heading-26">8.1 开发回复卡片组件</h3>
<p>配置完成后，我开始开发业务组件。同样是对话式协作：</p>
<pre><code class="hljs language-txt" lang="txt">我：帮我写一个回复卡片组件，用来展示 AI 生成的回复。
    左边是语气标签（比如"高情商"），中间是回复文字，右边是复制按钮。
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，我来帮你开发这个组件。

📋 执行计划：
1. 创建 ReplyCard.vue 组件
2. 定义 Props：tone（语气）、text（文本）
3. 定义 Events：copy（复制）
4. 使用 UnoCSS 原子类实现样式

🤔 几个问题：
1. 语气标签的颜色是固定的还是根据内容变化？
2. 复制按钮是图标还是文字？
3. 有没有设计稿可以参考？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：标签颜色根据语气类型自动变，用哈希算法分配吧。
    复制按钮用图标。设计稿没有，你自己设计一个好看的。
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：明白了，我来实现：

【设计方案】
- 卡片：白色背景、圆角、内边距
- 标签：小圆角、根据文字哈希分配 5 种颜色
- 文本：深灰色、支持多行
- 按钮：圆形点击区域、图标居中

开始生成代码...
</code></pre>
<h3 data-id="heading-27">8.2 TRAE SOLO 生成的组件</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- components/ReplyCard.vue --&gt;
&lt;template&gt;
  &lt;view class="flex items-center gap-2.5 bg-white rounded-xl p-4 pr-2"&gt;
    &lt;!-- 语气标签 --&gt;
    &lt;view
      v-show="!hideTag"
      class="text-xs font-bold rounded-sm px-2 py-1 flex-shrink-0"
      :style="{ backgroundColor: tagStyle.bg, color: tagStyle.text }"
    &gt;
      {{ tone }}
    &lt;/view&gt;

    &lt;!-- 回复文本 --&gt;
    &lt;view class="text-sm text-#1F2937 flex-1"&gt;
      {{ text }}
    &lt;/view&gt;

    &lt;!-- 复制按钮 --&gt;
    &lt;view
      class="w-9 h-9 center cursor-pointer"
      @click="$emit('copy', text)"
    &gt;
      &lt;image src="/static/images/home/copy.svg" mode="aspectFit" class="w-5 h-5" /&gt;
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { computed } from 'vue';

interface Props {
  tone: string;
  text: string;
  hideTag?: boolean;
}

const props = withDefaults(defineProps&lt;Props&gt;(), {
  hideTag: false,
});

defineEmits&lt;{
  copy: [text: string];
}&gt;();

// 5 种预设颜色
const COLORS = [
  { bg: '#F3E8FF', text: '#8B5CF6' },  // 紫色
  { bg: '#E6FFFA', text: '#319795' },  // 青色
  { bg: '#FFF5E6', text: '#F56500' },  // 橙色
  { bg: '#FFE4E6', text: '#E11D48' },  // 粉色
  { bg: '#E0F2FE', text: '#0284C7' },  // 蓝色
];

// 根据语气文字哈希分配颜色
const tagStyle = computed(() =&gt; {
  let hash = 0;
  for (let i = 0; i &lt; props.tone.length; i++) {
    hash = (hash + props.tone.charCodeAt(i)) % COLORS.length;
  }
  return COLORS[hash];
});
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-28">8.3 我提出修改意见</h3>
<pre><code class="hljs language-txt" lang="txt">我：不错，但我想加一个功能：有时候不需要显示标签，能不能加个 prop 控制？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：已经有了，就是 hideTag 这个 prop。

使用方式：
&lt;ReplyCard tone="高情商" text="回复内容" :hide-tag="true" /&gt;

设置 hide-tag 为 true 就会隐藏标签。
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：哦对，我没注意看。那再加个需求：复制成功后给个反馈
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：复制反馈建议在父组件处理，因为：
1. 卡片组件应该保持简单，只负责 UI
2. 复制逻辑和 toast 提示是业务逻辑，放父组件更合适

父组件这样用：

&lt;ReplyCard
  tone="高情商"
  text="回复内容"
  @copy="handleCopy"
/&gt;

const handleCopy = async (text: string) =&gt; {
  await copyText(text);
  toast.success('已复制');
};

你觉得这样合理吗？还是希望把 toast 放在组件内部？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：你说得对，放父组件更好
</code></pre>
<h2 data-id="heading-29">九、核心经验：与 AI 协作的正确姿势</h2>
<h3 data-id="heading-30">9.1 不要追求"一次完美"</h3>





















<table><thead><tr><th>错误做法</th><th>正确做法</th></tr></thead><tbody><tr><td>花 30 分钟写一个"完美提示词"</td><td>花 1 分钟说出需求，让 AI 提问</td></tr><tr><td>一次性想清楚所有细节</td><td>边做边发现问题，逐步完善</td></tr><tr><td>把 AI 当执行工具</td><td>把 AI 当协作伙伴，可以对话</td></tr></tbody></table>
<h3 data-id="heading-31">9.2 让 AI 先给执行计划</h3>
<p>每次提需求后，让 AI 先给出<strong>执行计划</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">我：[需求描述]

AI：📋 执行计划：
    1. xxx
    2. xxx
    3. xxx

    🤔 有几个问题：
    1. xxx？
    2. xxx？

    确认后我开始执行。
</code></pre>
<p><strong>好处</strong>：</p>
<ul>
<li>确保 AI 理解正确</li>
<li>发现遗漏的需求</li>
<li>可以在执行前调整方向</li>
</ul>
<h3 data-id="heading-32">9.3 遇到问题时提供上下文</h3>
<p><strong>❌ 错误方式</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">我：样式不生效
</code></pre>
<p><strong>✅ 正确方式</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">我：translate-x-2 这个类在小程序里不生效，但在 H5 正常。
    我看了生成的 CSS，是 transform: translateX(var(--un-translate-x))。
    是不是变量没定义？
</code></pre>
<h3 data-id="heading-33">9.4 让 AI 解释它的方案</h3>
<p>当 AI 给出方案时，追问原理：</p>
<pre><code class="hljs language-txt" lang="txt">我：为什么要用 preflights？直接写 CSS 不行吗？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：preflights 是 UnoCSS 的预设样式注入机制，和直接写 CSS 的区别：

1. preflights 会被注入到所有生成的 CSS 之前，确保优先级正确
2. 可以通过 layer 控制加载顺序
3. 统一管理，修改时只需要改配置文件

直接写 CSS 也可以，但需要确保加载顺序正确，否则可能被覆盖。
</code></pre>
<p><strong>好处</strong>：理解原理后，下次遇到类似问题可以自己判断。</p>
<h2 data-id="heading-34">十、总结：对话式协作 &gt; 完美提示词</h2>
<h3 data-id="heading-35">10.1 本文的核心观点</h3>
<ol>
<li><strong>不要追求"一次完美的提示词"</strong>，真实的 AI 协作是多轮对话</li>
<li><strong>让 AI 先给执行计划</strong>，确认后再执行</li>
<li><strong>遇到问题时提供上下文</strong>，帮助 AI 定位问题</li>
<li><strong>追问原理</strong>，理解 AI 的方案，下次才能举一反三</li>
</ol>
<h3 data-id="heading-36">10.2 5 轮对话完成的工作</h3>



































<table><thead><tr><th>轮次</th><th>需求</th><th>成果</th></tr></thead><tbody><tr><td>第 1 轮</td><td>基础配置</td><td>presets、transformers、theme</td></tr><tr><td>第 2 轮</td><td>修复 transform 问题</td><td>preflights</td></tr><tr><td>第 3 轮</td><td>安全区适配</td><td>自定义 rules</td></tr><tr><td>第 4 轮</td><td>简化常用类名</td><td>shortcuts</td></tr><tr><td>第 5 轮</td><td>动态类名支持</td><td>safelist</td></tr></tbody></table>
<h3 data-id="heading-37">10.3 下一篇预告</h3>
<p><strong>《【AI 编程实战】第 5 篇：Pinia 状态管理不会写？让 AI 手把手教你最佳实践》</strong></p>
<p>下一篇继续展示对话式协作，教你：</p>
<ul>
<li>如何让 AI 设计 Store 结构</li>
<li>状态持久化的对话过程</li>
<li>用户登录态管理的多轮沟通</li>
</ul>
<hr/>
<blockquote>
<p>与 AI 协作的关键不是"写出完美提示词"，而是<strong>学会和 AI 对话</strong>。</p>
<p>如果这篇文章对你有帮助，请点赞、收藏！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[现代前端工程化实战：从 Vite 到 React Router demo的构建之旅]]></title>    <link>https://juejin.cn/post/7585006378533208106</link>    <guid>https://juejin.cn/post/7585006378533208106</guid>    <pubDate>2025-12-18T09:52:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585006378533208106" data-draft-id="7585006378532847658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="现代前端工程化实战：从 Vite 到 React Router demo的构建之旅"/> <meta itemprop="keywords" content="React.js,前端框架,Vite"/> <meta itemprop="datePublished" content="2025-12-18T09:52:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            现代前端工程化实战：从 Vite 到 React Router demo的构建之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:52:59.000Z" title="Thu Dec 18 2025 09:52:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端技术的迭代从未停歇。当我们谈论现代前端开发时，<strong>React 19</strong> 和 <strong>Vite</strong> 已经成为了不可忽视的标准配置。React 19 带来了更高效的并发渲染机制，而 Vite 则凭借基于 ESM 的极致冷启动速度，彻底改变了开发体验。</p>
<p>本文将通过一个名为 <code>react-demo</code> 的实战项目，带你从零开始理解如何搭建、配置并开发一个标准的现代 React 应用。我们将涵盖工程化配置、路由管理、Hooks 状态逻辑以及样式预处理等核心知识点。</p>
<h2 data-id="heading-0">一、 极速启动：Vite 与 ESM 的革命</h2>
<p>在过去，Webpack 是构建工具的王者，但它在启动大型项目时往往需要漫长的打包等待。现代开发推荐使用 Vite（法语意为“快”）作为脚手架。</p>
<h3 data-id="heading-1">1. 为什么是 Vite？</h3>
<p>Vite 的核心优势在于它利用了浏览器原生的 <strong>ES Modules (ESM)</strong> 机制。在开发阶段 (<code>npm run dev</code>)，Vite 不需要对代码进行全量打包，而是按需提供模块，这实现了极致的“冷启动”体验。</p>
<p>当我们运行 <code>npm init vite</code> 拉取项目模板后，项目结构非常清晰。观察项目的 <code>package.json</code> 脚本配置：</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这对应了完整的开发生命周期：<code>dev</code>（开发） -&gt; <code>build</code>（构建生产包） -&gt; <code>preview</code>（本地预览生产包）。</p>
<h3 data-id="heading-2">2. 依赖管理的艺术：Dev vs Prod</h3>
<p>在安装依赖时，区分“开发依赖”和“生产依赖”至关重要。</p>
<ul>
<li><strong>dependencies (生产依赖)</strong> ：如 <code>react</code> 和 <code>react-dom</code>。React 19.2.0 是核心库，负责组件定义和 diff 算法；而 <code>react-dom</code> 负责将组件渲染到浏览器 DOM 中。这类似于 Vue 的生态，React Core 对应 Vue Core，React DOM 对应 Vue 的渲染器。对应配置为 <code>package.json</code> 中的<code>dependencies</code></li>
<li><strong>devDependencies (开发依赖)</strong> ：如 <code>stylus</code>。我们使用 <code>npm i -D stylus</code> 安装它，因为 Stylus 只是在开发阶段帮助我们将 <code>.styl</code> 文件编译为 CSS，上线后的代码并不需要 Stylus 引擎。对应配置为 <code>package.json</code> 中的<code>devDependencies</code></li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 生产依赖</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^19.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^19.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-router-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.10.1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-comment">// 开发依赖</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@eslint/js"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.39.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^19.2.5"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^19.2.3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.1.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.39.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react-hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react-refresh"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.4.24"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"globals"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^16.5.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"stylus"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.64.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.2.4"</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">二、 入口与渲染：React 19 的严谨模式</h2>
<p>项目的入口文件 <code>main.jsx</code> 展示了 React 19 最标准的挂载方式。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StrictMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./index.styl'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.jsx'</span>

<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)).<span class="hljs-title function_">render</span>(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StrictMode</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">StrictMode</span>&gt;</span></span>,
)
</code></pre>
<h3 data-id="heading-4">严格模式 (StrictMode)</h3>
<p>你可能会发现，在开发环境下组件的生命周期函数（如 <code>useEffect</code>）会执行两次。这并非 Bug，而是 <code>&lt;StrictMode&gt;</code> 的有意为之。它通过双重调用来帮助开发者检测不安全的副作用（Side Effects）和过时的 API 使用，确保代码在生产环境中更加健壮。</p>
<h3 data-id="heading-5">样式预处理</h3>
<p>我们引入了全局样式 <code>index.styl</code>。Stylus 的魅力在于其极简的语法——省略花括号、冒号和分号，通过缩进来组织代码：</p>
<pre><code class="hljs language-Stylus" lang="Stylus">*
  margin: 0
  padding: 0

body
  background-color pink
</code></pre>
<p>Vite 内置了对 CSS 预处理器的支持，无需繁琐的 Webpack Loader 配置，安装即用，安装指令为<code>npm i -D stylus</code>。其中的<code>-D</code>就代表了开发依赖，如果不书写<code>-D</code>则会默认安装至生产依赖。</p>
<h2 data-id="heading-6">三、 路由架构：单页应用的骨架</h2>
<p>单页应用（SPA）的核心在于：<strong>页面不刷新，URL 改变，内容切换</strong>，在一个页面 (<code>index.html</code>) 中实现 "多页面" 的切换效果。我们使用 <code>react-router-dom</code> v7 来实现这一功能。首先需要通过<code>npm i react-router-dom</code>指令安装路由。</p>
<h3 data-id="heading-7">1. 路由模式选择</h3>
<p>在 <code>App.jsx</code> 中，我们采用了 <code>BrowserRouter</code>（别名为 <code>Router</code>）。相比于 URL 中带有 <code>#</code> 号的 <code>HashRouter</code>，<code>BrowserRouter</code> 利用 HTML5 History API，提供了更现代化、更美观的 URL 结构，是目前的行业标准。</p>
<h3 data-id="heading-8">2. 声明式导航：Link vs A</h3>
<p>在 React Router 中，我们严禁使用传统的 <code>&lt;a href&gt;</code> 标签进行内部跳转。因为 <code>&lt;a&gt;</code> 标签会导致浏览器强制刷新页面，从而重置 React 的所有状态。</p>
<p>相反，我们使用 <code>&lt;Link&gt;</code> 组件：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;nav&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
&lt;/nav&gt;
</code></pre>
<p><code>&lt;Link&gt;</code> 组件在内部“消化”了点击事件，通过 JavaScript 修改 URL 并通过 Context 通知路由系统更新视图，实现了无缝的页面切换。</p>
<h3 data-id="heading-9">3. 路由配置分离</h3>
<p>为了保持代码的整洁，我们将具体的路由规则抽离到了 <code>router/index.jsx</code> 中：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/Home.jsx'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/About.jsx'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AppRoutes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span>
    )
}
</code></pre>
<p>这种集中管理路由表的方式，使得 <code>App.jsx</code> 只需关注整体布局，而将路由细节交给 <code>AppRoutes</code> 组件处理。</p>
<h2 data-id="heading-10">四、 核心业务逻辑：Hooks 驱动的数据流</h2>
<p><code>Home.jsx</code> 组件展示了 React 函数式组件的核心逻辑：<strong>Hooks</strong>。我们的目标是调用 GitHub API 并展示数据。</p>
<h3 data-id="heading-11">1. 响应式状态：useState</h3>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> [repos, setRepos] = <span class="hljs-title function_">useState</span>([]);
</code></pre>
<p><code>useState</code> 是 React 响应式系统的基石。它返回当前状态 <code>repos</code> 和更新函数 <code>setRepos</code>。每当调用 <code>setRepos</code> 时，React 就会感知数据变化，并触发组件的重新渲染（Re-render），更新视图。</p>
<h3 data-id="heading-12">2. 副作用管理：useEffect</h3>
<p>网络请求属于“副作用”（Side Effect），不能直接写在组件渲染逻辑中。我们使用 <code>useEffect</code> 来处理组件挂载后的逻辑：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 组件挂载完成 (onMounted)</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com/users/shunwuyu/repos'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-title function_">setRepos</span>(json))
}, [])
</code></pre>
<ul>
<li><strong>执行时机</strong>：<code>useEffect</code> 确保代码在组件渲染并挂载到 DOM 之后执行，避免阻塞 UI 渲染。</li>
<li><strong>依赖数组 <code>[]</code></strong> ：第二个参数传入空数组 <code>[]</code>，意味着这个 Effect 只在组件初始化时执行一次（相当于类组件的 <code>componentDidMount</code>）。如果不传此参数，每次渲染都会触发请求，导致无限循环。</li>
</ul>
<h3 data-id="heading-13">3. 条件渲染与列表 Key</h3>
<p>在 JSX 中，我们利用 JavaScript 的灵活性来构建 UI。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            {
                repos.length ? (
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                        {
                            repos.map(repo =&gt; (
                                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.id}</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{repo.html_url}</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"noreferrer"</span>&gt;</span>
                                        {repo.name}
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                            ))
                        }
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                ) : null
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
</code></pre>
<ul>
<li><strong>Diff 算法的关键</strong>：在遍历列表时，必须为每个元素提供唯一的 <code>key</code>（如 <code>repo.id</code>）。这能帮助 React 的 Diff 算法高效地识别元素的增删改，最小化 DOM 操作。</li>
<li><strong>条件渲染</strong>：通过三元运算符检查 <code>repos.length</code>，在数据加载前不渲染列表，防止页面报错。</li>
</ul>
<h2 data-id="heading-14">五、 总结</h2>
<p>通过这个项目，我们不仅搭建了一个简单的 GitHub 仓库浏览器，更重要的是实践了现代 React 开发的标准范式：</p>
<ol>
<li><strong>工程化</strong>：利用 Vite 极速构建，区分开发与生产依赖。</li>
<li><strong>组件化</strong>：通过 Props 和 Hooks 实现逻辑复用。</li>
<li><strong>路由化</strong>：使用 React Router 实现 SPA 的无感跳转。</li>
<li><strong>响应式</strong>：利用 <code>useState</code> 和 <code>useEffect</code> 驱动数据流向。</li>
</ol>
<p>从 React 19 的底层优化到 Vite 的工程实践，这套技术栈为开发者提供了极其高效的开发体验，是构建未来 Web 应用的坚实基础。</p>
<h2 data-id="heading-15">六、Home.jsx 源代码</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> [repos, setRepos] = <span class="hljs-title function_">useState</span>([]);
    <span class="hljs-comment">// render 是第一位的</span>
    <span class="hljs-comment">// console.log('Home 组件渲染了');</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// home 组件可以看到了</span>
        <span class="hljs-comment">// console.log('Home 组件挂载了');</span>
        <span class="hljs-comment">// 发送api请求，不会和组件渲染去争抢</span>
        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com/users/shunwuyu/repos'</span>)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-title function_">setRepos</span>(json))
    }, [])
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            {
                repos.length ? (
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                        {
                            repos.map(repo =&gt; (
                                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.id}</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{repo.html_url}</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"noreferrer"</span>&gt;</span>
                                        {repo.name}
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                            ))
                        }
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                ) : null
            }
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Home</span>;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1 实现CloudBase云开发 + 低代码全栈开发活动管理小程序(13)]]></title>    <link>https://juejin.cn/post/7584831190731423770</link>    <guid>https://juejin.cn/post/7584831190731423770</guid>    <pubDate>2025-12-18T09:52:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584831190731423770" data-draft-id="7585021315691266058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1 实现CloudBase云开发 + 低代码全栈开发活动管理小程序(13)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-18T09:52:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shaneyxs"/> <meta itemprop="url" content="https://juejin.cn/user/835284566026958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1 实现CloudBase云开发 + 低代码全栈开发活动管理小程序(13)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/835284566026958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shaneyxs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:52:48.000Z" title="Thu Dec 18 2025 09:52:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第 13 章：文件上传与云存储</h2>
<blockquote>
<p>“一张图胜过千言万语，但前提是你得把图传上去。”</p>
</blockquote>
<p>本章将讲解如何利用腾讯云开发 (CloudBase) 的云存储能力，实现高效、稳定的文件上传。</p>
<h3 data-id="heading-1">13.1 云存储架构</h3>
<p>云存储 (Cloud Storage) 本质上是一个对象存储服务 (COS)。</p>
<ul>
<li><strong>路径</strong>: 我们按照 <code>year/month/filename</code> 的格式组织文件，避免单目录下文件过多。</li>
<li><strong>权限</strong>: 默认设置为“所有用户可读，仅创建者/管理员可写”。</li>
</ul>
<h3 data-id="heading-2">13.2 图片/视频上传实现</h3>
<p>前端核心 API: <code>uniCloud.uploadFile</code>。</p>
<h4 data-id="heading-3">封装上传 Hook (<code>useUpload</code>)</h4>
<p>为了复用，我们封装了一个 Hook：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/hooks/useUpload.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUpload</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">filePath: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">const</span> ext = filePath.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>).<span class="hljs-title function_">pop</span>()
    <span class="hljs-keyword">const</span> cloudPath = <span class="hljs-string">`activity/<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).slice(-<span class="hljs-number">6</span>)}</span>.<span class="hljs-subst">${ext}</span>`</span>

    uni.<span class="hljs-title function_">showLoading</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'上传中...'</span> })
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> uniCloud.<span class="hljs-title function_">uploadFile</span>({
        <span class="hljs-attr">filePath</span>: filePath,
        <span class="hljs-attr">cloudPath</span>: cloudPath
      })
      <span class="hljs-keyword">return</span> res.<span class="hljs-property">fileID</span> <span class="hljs-comment">// 返回 cloud://...</span>
    } <span class="hljs-keyword">finally</span> {
      uni.<span class="hljs-title function_">hideLoading</span>()
    }
  }
  <span class="hljs-keyword">return</span> { uploadImage }
}
</code></pre>
<h4 data-id="heading-4">选择文件</h4>
<p>结合 <code>uni.chooseImage</code> 或 <code>uni.chooseVideo</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">chooseAndUpload</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">chooseImage</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> })
  <span class="hljs-keyword">const</span> filePath = res.<span class="hljs-property">tempFilePaths</span>[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">const</span> fileID = <span class="hljs-keyword">await</span> <span class="hljs-title function_">uploadImage</span>(filePath)
  <span class="hljs-comment">// 将 fileID 存入组件配置或表单</span>
  config.<span class="hljs-property">src</span> = fileID
}
</code></pre>
<h3 data-id="heading-5">13.3 FileID 与临时 URL 转换</h3>
<p><strong>CloudID (<code>cloud://...</code>)</strong> 是云开发的特有协议。</p>
<ul>
<li><strong>在小程序内</strong>: <code>&lt;image src="cloud://..."&gt;</code> 可以直接展示，无需转换，利用内网 CDN，速度极快。</li>
<li><strong>在 Web/H5 端</strong>: 浏览器不认识 <code>cloud://</code>。需要调用 <code>uniCloud.getTempFileURL</code> 换取 <code>https://</code> 开头的临时链接。</li>
</ul>
<blockquote>
<p><strong>最佳实践</strong>: 尽量在数据库存 <code>cloud://</code> 路径。只在需要在非小程序环境展示时才进行转换。</p>
</blockquote>
<h3 data-id="heading-6">13.4 批量上传优化</h3>
<p>在“活动相册”或“多图投票”场景下，用户可能一次选 9 张图。
<strong>串行 vs 并行</strong>:</p>
<ul>
<li>❌ 串行: 传完一张再传下一张，太慢。</li>
<li>✅ 并行: <code>Promise.all</code>。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadAll</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">paths</span>) =&gt; {
  <span class="hljs-keyword">const</span> tasks = paths.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> <span class="hljs-title function_">uploadImage</span>(path))
  <span class="hljs-keyword">const</span> fileIDs = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(tasks)
  <span class="hljs-keyword">return</span> fileIDs
}
</code></pre>
<hr/>
<p><strong>本章小结</strong>：
文件上传是内容类应用的基础设施。有了云存储，我们不再需要操心文件服务器的搭建和带宽费用，只需关注业务逻辑。下一章，我们将为活动添加一些“氛围组”功能——背景音乐和弹幕。</p>
<p><strong><a href="https://juejin.cn/post/7585005164726353958" target="_blank" title="https://juejin.cn/post/7585005164726353958">下一章（14-背景音乐与弹幕）</a></strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[邀你一起体验｜OxyGent 多智能体协作框架新版本发布 3个月1700位开发者实测认证]]></title>    <link>https://juejin.cn/post/7585027616735707188</link>    <guid>https://juejin.cn/post/7585027616735707188</guid>    <pubDate>2025-12-18T10:27:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585027616735707188" data-draft-id="7584991956126203939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="邀你一起体验｜OxyGent 多智能体协作框架新版本发布 3个月1700位开发者实测认证"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-12-18T10:27:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            邀你一起体验｜OxyGent 多智能体协作框架新版本发布 3个月1700位开发者实测认证
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T10:27:18.000Z" title="Thu Dec 18 2025 10:27:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，OxyGent多智能体协作框架发布新版本，支持新特性包括：智能体之间的多模态信息传递、细粒度的消息控制、MCP重连与请求头、前端流式输出等，可以通过 pip install oxygent==1.0.8 升级体验。</p>
<p>开源3个多月以来，OxyGent凭借其模块化、高可用的设计，已在京东内部及外部社区多个业务场景中有效支撑智能体技术落地，持续推动AI应用的发展与创新，收获1700多个宝贵Star。欢迎技术开发者们体验反馈。</p>
<p>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjd-opensource%2FOxyGent" target="_blank" title="https://github.com/jd-opensource/OxyGent" ref="nofollow noopener noreferrer">github.com/jd-opensour…</a></p>
<p>官网了解更多：<a href="https://link.juejin.cn?target=https%3A%2F%2Foxygent.jd.com" target="_blank" title="https://oxygent.jd.com" ref="nofollow noopener noreferrer">oxygent.jd.com</a></p>
<h2 data-id="heading-0">一、OxyGent 让你像搭积木一样灵活组合构建多智能体系统</h2>
<p>OxyGent是京东零售开源的多智能体协作框架：将 Agent、Tool、LLM 和 Flow 统一抽象为可插拔的原子 AI 组件 Oxy，开发者可以像搭积木一样灵活组合构建多智能体系统：</p>
<p>•遵循 Stateless 设计理念，并融入 AOP 设计思想，具备极致扩展能力与全链路决策追溯能力；</p>
<p>•打破常规固定流程编排模式，转向通过定义 Oxy 间的权限关系来构建多智能体系统，能够根据不同任务进行动态规划，并实时生成实际调用流程图；</p>
<p>•通过构建-推理-进化的闭环智能体流水线，实现了 Oxy 的无缝集成、系统弹性扩展和持续优化，为 AI 生态发展提供全新可能。</p>
<p><strong>1、Oxy执行生命周期</strong></p>
<p>Oxy的执行生命周期通过一系列步骤来管理和协调多智能体系统中的不同组件。这些步骤确保数据在正确的时间被处理、记录、保存和发送。包括：</p>
<p>•_pre_process: 在执行任何操作之前进行数据预处理。包括数据清理、格式化或其他准备工作。</p>
<p>•_pre_log: 打印工具调用日志，用于记录即将进行的操作，以便后续追踪和分析。</p>
<p>•_pre_save_data: 在执行之前保存数据。这可能涉及将当前状态或输入数据保存到存储中，以便后续使用。</p>
<p>•_format_input: 格式化输入数据，以确保其符合后续处理步骤的要求。</p>
<p>•_pre_send_message: 发送工具调用消息，准备将格式化后的数据发送给其他组件或系统。</p>
<p>•_before_execute: 在实际执行之前加载内存或其他必要的资源，以确保执行环境的准备。</p>
<p>•_execute: 实际执行步骤，运行主要的计算或处理逻辑。</p>
<p>•_after_execute: 执行完成后，进行后续处理，例如释放资源或进行初步结果分析。</p>
<p>•_post_process: 自定义输出处理，处理执行后的数据以准备后续步骤。</p>
<p>•_post_log: 打印观察日志，记录执行结果和观察，以便后续分析和追踪。</p>
<p>•_post_save_data: 执行后保存数据，将结果或状态保存到存储中。</p>
<p>•_format_output: 格式化输出数据，以确保其符合后续使用或发送的要求。</p>
<p>•_post_send_message: 发送结果消息，将处理后的数据或结果发送给其他组件或系统。</p>
<p>整个生命周期通过这些步骤确保了数据的流动和处理的顺序，支持多智能体系统的动态规划和实时生成调用流程图。不同的组件在这个生命周期中协同工作，实现无缝集成和持续优化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e51afd8669a408c8eef8f3d09e56b4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658438&amp;x-signature=P%2Fs3k4wCQm9332s8S2nl2Sp5O7I%3D" alt="image.png" loading="lazy"/></p>
<p><strong>2、OxyGent四大数据作用域</strong></p>
<p>OxyGent 框架提供了四大数据作用域，包括 Application 域、SessionGroup 域、Request 域和 Node 域，分别可以通过 oxy_request.get/set_global_data()、oxy_request.get/set_group_data()、oxy_request.get/set_shared_data() 和 oxy_request.get/set_arguments() 方法灵活读写对应的数据。从而实现不同层级的数据隔离与共享，显著提升了多智能体协作场景下的数据管理效率和开发便利性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6894e62b32b44155b724dbeca94ff17d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658438&amp;x-signature=niEh3T%2B%2BU6WbvtmAYKoYi2uG%2BAQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、OxyGent在京东与社区的实用场景</h2>
<p>目前 OxyGent 框架已在京东内部多个业务场景中有效落地智能体技术，还通过了众多社区开发者的落地反馈，有效验证了可用性与可扩展性。</p>
<p><strong>1、京东内部实用场景</strong></p>
<p>SOP场景：在标准操作流程（SOP）场景中，OxyGent 框架支持将业务流程拆分为多个智能体，每个智能体负责流程中的一个具体环节，例如审批、数据校验或通知。顶层智能体负责整体流程调度与进度监控，中层和底层智能体则自动完成各自分配的任务。通过这种多层级分工，流程执行效率有所提升，同时便于流程追踪和异常处理，适用于工单流转、合同审批等标准化业务。</p>
<p>RAG问答场景：在 RAG 问答场景下，OxyGent 框架支持通过多层级智能体协作实现检索和生成结合的问答系统。顶层智能体负责任务分配和结果整合，检索智能体查找相关知识内容，生成智能体基于检索结果生成答案，评审智能体进行质量检查。这样可以提升问答的准确性和相关性，适用于企业知识库、智能客服等需要自动化问答的应用。</p>
<p>数据分析场景：基于 OxyGent，在数据分析场景中支持自动化完成数据采集、预处理、分析和可视化等步骤。顶层智能体负责分析流程的设计和协调，各层智能体分别承担数据抓取、清洗、分析建模和结果展示等任务。智能体之间的数据流串联，使数据分析流程更加规范和高效，适合自动报表生成、异常检测等数据驱动场景。</p>
<p>工具调用场景：在工具调用场景下，OxyGent 框架支持根据任务需求自动选择和调用外部工具或服务。顶层智能体负责任务解析和工具选择，工具智能体封装具体的操作接口，监控智能体跟踪工具调用状态并处理异常。通过多智能体分工，可以实现跨平台、跨系统的自动化操作，提高办公和运维的效率。</p>
<p>多层级分类场景：在多层级分类场景中，OxyGent 框架支持通过顶层智能体进行整体分类流程管理，分层分类智能体逐级细化分类对象，例如先进行大类分组，再细分为子类或具体标签。标签智能体负责为分类对象补充元数据或属性，增强分类结果的丰富性和检索能力。各智能体协作实现复杂对象的自动分层分类和标签赋予，支持灵活扩展和维护分类体系。该场景适用于文本标签、产品分级、风险分层等需要多层级组织和检索的应用，提升分类的准确性和一致性。</p>
<p><strong>2、社区开发者实测反馈</strong></p>
<p>除了京东内部应用，OxyGent还通过项目实践和社区开发者反馈，展现了在指标查询、工具自动化调用、流程图生成以及慢 SQL 治理等典型场景的可用性与可扩展性。例如：</p>
<p>基于多智能体协作，实现了自然语言到 SQL 的智能转换和自动执行，支持多维度指标一致性验证；</p>
<p>结合 JoyCode 的低代码能力，开发了网页信息提取与文件操作自动化方案，用户可用自然语言完成网页搜索和文件处理；</p>
<p>在可视化方面，通过智能体调用本地 API 自动生成和渲染流程图代码；</p>
<p>在数据库优化方面，智能体能够自动诊断慢 SQL 并生成治理建议，提升系统性能。</p>
<p>这些应用案例充分验证了 OxyGent 作为企业级开源智能体平台的实用性和拓展能力。</p>
<h2 data-id="heading-2">三、手把手教学：从入门到高阶</h2>
<p>想要快速上手？我们此前已发布过详细教程，展示了如何基于OxyGent框架，仅用20行代码即可快速启动你的第一个智能体。还有手把手带您完成智能体开发的全流程，包括环境安装、模型注册、MCP工具集成、智能体注册、可视化界面调试、多智能体协作，乃至分布式智能体部署等环节。</p>
<p>教程链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FskI1P481cSo8ibbAzjS1aQ" target="_blank" title="https://mp.weixin.qq.com/s/skI1P481cSo8ibbAzjS1aQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/skI1P481c…</a></p>
<h2 data-id="heading-3">四、社区共建：从问题解答到代码贡献的生态活力</h2>
<p>在开发者社群的测试与使用过程中，我们汇总了一些常见问题，例如：如何对接不同厂商的LLM API、如何接入MCP工具、如何实现RAG等。这些问题目前已在社区交流中找到解决路径，这正体现了OxyGent良好的开发者友好性。</p>
<p>社区的创造力远不止于此。前一段时间OxyGent团队组织的智能体工具创新赛，更是涌现了大量优秀的外部案例与代码贡献。智能体大赛部分优秀案例展示如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e748ae130f40490ba841dabc5564a85c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658438&amp;x-signature=BRLDhJ7mcfVEF63aTs%2BP8QV6dYU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f796ec20647488d9243dc273fb9325d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658438&amp;x-signature=X7VjPmzHUmyYtd%2FPQznXhPmIaQY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">五、特别致谢：每一颗星，都是我们前行的光</h2>
<p>OxyGent上线3个月，1700个Star被亮点。每一颗宝贵的 Star，不仅是对OxyGent框架的认可，更是来自每一位开发者伙伴的信任与支持。最近，我们收集了所有（截至12月4日之前）为项目点亮 Star 的朋友的 GitHub 头像，拼凑成了这张独一无二的项目 Logo。 OxyGent团队想用一种特别的方式，珍藏这份情谊。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fdd75d684b94f549207b154f7e6c470~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658438&amp;x-signature=7eNM4qXIhMqKzdY2FrrMYSAiPIM%3D" alt="image.png" loading="lazy"/></p>
<p>这份由我们共同绘制的画卷，将继续更新！</p>
<p>点亮活动还在继续，欢迎邀请更多朋友来点亮星辰，让这幅画变得更加璀璨！</p>
<p>GitHub点star直通：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjd-opensource%2FOxyGent" target="_blank" title="https://github.com/jd-opensource/OxyGent" ref="nofollow noopener noreferrer">github.com/jd-opensour…</a></p>
<p>再次感谢每一位支持的您！</p>
<p>欢迎大家进群反馈～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92b6ac943f824832bd11fd8c42fa7b3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658438&amp;x-signature=Zv%2FGEtTbBY4ipeulhw4prhKqsdc%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 事件机制全面解析：原生事件、自定义事件与 DOM 冒泡完全讲透]]></title>    <link>https://juejin.cn/post/7585021315691364362</link>    <guid>https://juejin.cn/post/7585021315691364362</guid>    <pubDate>2025-12-18T09:58:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585021315691364362" data-draft-id="7585023817459253274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 事件机制全面解析：原生事件、自定义事件与 DOM 冒泡完全讲透"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-18T09:58:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码途潇潇"/> <meta itemprop="url" content="https://juejin.cn/user/2386391857112611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 事件机制全面解析：原生事件、自定义事件与 DOM 冒泡完全讲透
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386391857112611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码途潇潇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:58:14.000Z" title="Thu Dec 18 2025 09:58:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 事件机制全面解析：原生事件、自定义事件与 DOM 冒泡完全讲透</h2>
<p>为什么要理解 Vue 事件？</p>
<ul>
<li>
<p>只知道 @click，却分不清它属于谁</p>
</li>
<li>
<p>子组件不 emit，父组件 @click 为何能触发？</p>
</li>
<li>
<p>面试中被问 “emit 和 @click 区别？</p>
</li>
</ul>
<h2 data-id="heading-1">1.Vue事件的核心机制</h2>
<h3 data-id="heading-2">1.1 原生事件（native events）</h3>
<p>当 @drop 写在 HTML 原生标签上，例如：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div @<span class="hljs-attr">drop</span>=<span class="hljs-string">"handleDrop"</span>&gt;&lt;/div&gt;
</code></pre>
<p>这说明：</p>
<ul>
<li>监听的是浏览器 DOM 的 drop 事件</li>
<li>用户把文件拖到 上时触发</li>
<li>不需要任何子组件 emit</li>
</ul>
<p>示例如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"chunk-upload-trigger"</span>
  @<span class="hljs-attr">drop</span>=<span class="hljs-string">"handleDrop"</span>
  @<span class="hljs-attr">dragenter</span>=<span class="hljs-string">"handleDragEnter"</span>
  @<span class="hljs-attr">dragleave</span>=<span class="hljs-string">"handleDragLeave"</span>
&gt;</span>
</code></pre>
<blockquote>
<p>这些都是原生 DOM 事件，没有任何“子组件触发”的概念</p>
</blockquote>
<h3 data-id="heading-3">1.2 子组件自定义事件（子组件 emit）</h3>
<p>父组件中写入：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> @<span class="hljs-attr">file-selected</span>=<span class="hljs-string">"onFileSelected"</span> /&gt;</span>
</code></pre>
<p>等待子组件 Child 调用</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">emit</span>(<span class="hljs-string">'file-selected'</span>, file)
</code></pre>
<p>父组件收到这个事件并执行 onFileSelected</p>
<ul>
<li>ChunkUploadTrigger 内部 emit(‘file-selected’, file)</li>
<li>UploadPanel 接收到</li>
<li>执行 handleFileSelected</li>
</ul>
<p>这种完全不涉及 DOM 事件。</p>
<h3 data-id="heading-4">1.3 浏览器 DOM 的事件冒泡机制</h3>
<p>父组件中</p>
<pre><code class="hljs language-ini" lang="ini">&lt;ChunkUploadTrigger @<span class="hljs-attr">drop</span>=<span class="hljs-string">"handleDrop"</span> /&gt;
</code></pre>
<p>子组件中</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div @<span class="hljs-attr">drop</span>=<span class="hljs-string">"handleDropInside"</span>&gt;&lt;/div&gt;
</code></pre>
<p>子组件不用 emit 通知父组件，子组件父组件都是同名的事件，此时父组件的事件就会穿透绑定到子组件根元素，两者的执行顺序，childDrop() 会触发，parentDrop() 也会触发，两者触发顺序按 DOM 事件流来（冒泡顺序）</p>
<p>DOM 事件冒泡不关心你是不是在一个文件、一个组件，它只关心 DOM 节点树。</p>
<pre><code class="hljs language-markdown" lang="markdown">父组件根 DOM
  └── 子组件根 DOM
<span class="hljs-code">        └── 子组件内部 DOM
</span></code></pre>
<p>所以虽然写在了两个.vue 文件，但是渲染出来的其实是跟在一个文件里写了两个 父子div 没有任何区别，事件冒泡就是沿着这棵 DOM 树往上走的</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ChunkUploadTrigger</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Parent</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent-root"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chunk-upload-trigger"</span>&gt;</span>   ← 子组件根节点
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">2.事件相关的实用补充</h2>
<h3 data-id="heading-6">2.4 DOM 常用事件</h3>
<p>浏览器原生事件，放在 HTML 标签上就能触发</p>
<p>鼠标事件</p>
<blockquote>
<p>click,dblclick,mousedown,mouseup</p>
</blockquote>
<p>键盘事件</p>
<blockquote>
<p>keydown,keyup,keypress</p>
</blockquote>
<p>输入 &amp; 表单事件</p>
<blockquote>
<p>dragenter,dragover,dragleave,drop</p>
</blockquote>
<p>其他 DOM 事件</p>
<blockquote>
<p>scroll,wheel,resize,load,error</p>
</blockquote>
<h3 data-id="heading-7">2.5 Vue 事件修饰符总览</h3>








































<table><thead><tr><th><strong>修饰符</strong></th><th><strong>含义</strong></th><th><strong>对应的 DOM 行为</strong></th></tr></thead><tbody><tr><td>.stop</td><td>阻止事件冒泡</td><td>event.stopPropagation()</td></tr><tr><td>.prevent</td><td>阻止默认行为</td><td>event.preventDefault()</td></tr><tr><td>.capture</td><td>使用捕获模式</td><td>addEventListener(…, true)</td></tr><tr><td>.self</td><td>只有事件目标是当前元素时触发</td><td>event.target === currentTarget</td></tr><tr><td>.once</td><td>事件只触发一次</td><td>自动 removeEventListener</td></tr><tr><td>.passive</td><td>表示监听器不会调用 preventDefault</td><td>passive: true</td></tr></tbody></table>
<p>比如：</p>
<pre><code class="hljs language-html" lang="html">@dragover.prevent="handleDragOver"
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这个 GitHub 神器让 Gemini 写的网站 3 秒上线，累计部署 67 万个网站。]]></title>    <link>https://juejin.cn/post/7584357116435267625</link>    <guid>https://juejin.cn/post/7584357116435267625</guid>    <pubDate>2025-12-17T06:07:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584357116435267625" data-draft-id="7584358227611156522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这个 GitHub 神器让 Gemini 写的网站 3 秒上线，累计部署 67 万个网站。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-17T06:07:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这个 GitHub 神器让 Gemini 写的网站 3 秒上线，累计部署 67 万个网站。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:07:31.000Z" title="Wed Dec 17 2025 06:07:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Gemini 3 发布后令人惊艳的效果还在持续发酵。</p>
<p>现在的 Gemini 3 写前端代码，尤其是 HTML/Tailwind/JS 这一套已经很吓人了。你给个草图或几句人话，它就能给你吐出一堆能跑的代码。</p>
<p>相信你也刷到过类似下面这种炫酷的 Vibe Coding 网站：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d42711765581494aad2ad8da1bb3a05c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=SDddhHlx5k1rcdMqiDPXdUGwMS4%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b53dd27e72e14846a67bf07635a15748~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=2d5V6g3sN0Ei2GMVpcCefRwYydw%3D" alt="图片" loading="lazy"/></p>
<p>比如上面这两个，像贾维斯一样手势操控仪表球；还有手势控制 3D 粒子旋转，酷毙了。</p>
<p>本文教你 3 分钟使用开源项目 PinMe 把 Gemini 生成的应用部署到线上，发给你的好朋友，他们也能访问，也能玩。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bdc0c8e7be44979bcc97bbc4afed681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=bWnAkHessgVGELqMApRRAByFRk4%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-0">01、Gemini 生成网站</h2>
<p>你可以打开 aistudio.google.com，找到侧边栏的 build 模式。</p>
<p>然后输入你想生成应用的提示词，比如：生成一个年会抽奖程序，要求非常炫酷，支持后台上传 excel 导入人员名单、配置奖品、配置默认中奖人。你可以把 AI 生成的代码下载下来，在你本地就是一个这样的文件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4643daedac049a8911f5ae8bc4575d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=P1jHxkqnQ11EYjGR7h2ha%2FSWhXQ%3D" alt="图片" loading="lazy"/></p>
<p>以前你拿到 AI 生成的代码，还得折腾 Vercel、买服务器、配 Nginx 或者是搞 GitHub Pages，挺烦的。</p>
<p>现在你可以使用开源项目 PinMe，一个命令把静态网站变成任何人可访问的链接。</p>
<h2 data-id="heading-1">02、部署网站</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1acab6a646714bee921e81873457bfa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=LHdb7txMqTP%2Fa4qCGraeAes0E6c%3D" alt="图片" loading="lazy"/></p>
<p>PinMe 是一个一键部署工具，如果你想把 AI 生成的网站部署到线上，可以考虑用它。首先安装 PinMe：</p>
<pre><code class="hljs">npm install -g pinme
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b4927a97206436894c564a563f13605~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=joN0EnfiVnPYqJ%2B3i2bmfH%2BJIwI%3D" alt="图片" loading="lazy"/></p>
<p>安装完成之后，可以使用下面的命令，把本地网站文件部署到线上。</p>
<pre><code class="hljs language-bash" lang="bash">pinme upload /path/to/file-or-directory
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421f1f934d434444b1600ea04d44c1f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=OmPsLrsKCZkQD0On1xa3Q5RP%2BsQ%3D" alt="图片" loading="lazy"/></p>
<p>这个命令敲出去，PinMe 会开始干活，把你的文件上传到 IPFS 网络。几秒钟后，它会吐给你一个链接，通常是 .eth.limo 或者 IPFS 网关的链接。</p>
<p><strong>这就完事了，你的网站已经在线上了，全球可访问。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/719f646d32ea4abc872a73d944b9fdf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=yykm%2FHzaefRGa%2F%2BXGzrFev3TO8c%3D" alt="图片" loading="lazy"/></p>
<p>这玩意儿不仅是快，而且很多时候是基于 IPFS 的，这意味着你的网站是钉在网络上的，很难被单点关停。</p>
<p>没有乱七八糟的带宽账单，特别适合做 Landing Page、个人名片、或者临时跑个 Demo 给客户看。</p>
<p>Gemini 3 几秒钟生成，PinMe 几秒钟上线，这效率这谁受得了。</p>
<h2 data-id="heading-2">03、项目原理</h2>
<p><strong>PinMe</strong> 可以简化去中心化前端（Decentralized Frontend）的发布流程。</p>
<p>一行命令把视频、音频、图片、代码、文件夹发布成任何人都能访问的链接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2df51b90088a4b03976621c782f970e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=kSYrHgPX2SPgUFvEuE%2BJxv6e674%3D" alt="图片" loading="lazy"/>感兴趣的可以去这个开源项目主页看看，有用点个 Star。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/glitternetwork/pinme</span>
</code></pre>
<p>PinMe 依赖于 Glitter Protocol 的基础设施来运行：当你在本地运行命令时，PinMe 会自动检测你的静态文件目录，将其打包压缩。</p>
<p>文件会被上传到 IPFS 网络，并通过 Glitter Protocol 的节点进行 Pinning（钉住），防止数据因长时间无人访问而被网络垃圾回收机制清除。</p>
<p>上传成功后，你会得到一个 IPFS CID（内容标识符），以及一个基于网关的可访问 URL</p>
<p>例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fipfs.io%2Fipfs%2F" target="_blank" title="https://ipfs.io/ipfs/" ref="nofollow noopener noreferrer">ipfs.io/ipfs/</a> 或特定的网关链接。</p>
<p>项目愿景中包含自动更新 ENS 记录的功能，这使得你可以拥有一个像 myapp.eth 这样易读的去中心化地址，而不是一长串乱码哈希。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Monorepo 在 Docker 中的构建方案方案]]></title>    <link>https://juejin.cn/post/7584997357445447720</link>    <guid>https://juejin.cn/post/7584997357445447720</guid>    <pubDate>2025-12-18T10:14:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584997357445447720" data-draft-id="7584997357445398568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Monorepo 在 Docker 中的构建方案方案"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-18T10:14:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zmirror"/> <meta itemprop="url" content="https://juejin.cn/user/676954892932935"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Monorepo 在 Docker 中的构建方案方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/676954892932935/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zmirror
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T10:14:57.000Z" title="Thu Dec 18 2025 10:14:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,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) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">1. <strong>pnpm deploy「官方方案」</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fdocker" target="_blank" title="https://pnpm.io/docker" ref="nofollow noopener noreferrer">pnpm.io/docker</a></p>
<blockquote>
<p><strong>核心理念：</strong> 物理提取，按需隔离</p>
</blockquote>
<h4 data-id="heading-1">1. 构建流</h4>
<ul>
<li><strong><code>pnpm fetch</code></strong>: 仅基于 <code>pnpm-lock.yaml</code> 下载依赖到虚拟存储层。只要依赖清单未变，该层将实现<strong>极致的 Docker 缓存命中</strong></li>
<li><strong><code>pnpm install --offline</code></strong>: 拷贝源码后强制离线安装。完全跳过网络请求，利用本地缓存高速装配环境</li>
<li><strong><code>pnpm deploy</code></strong>: 将指定子包从 Workspace 中“抽取”到独立目录，并将原有的内容寻址链接自动转换为<strong>真实的物理文件</strong></li>
</ul>
<h4 data-id="heading-2">2. 致命缺点</h4>
<ul>
<li><strong>孤岛效应</strong>：<code>deploy</code> 后的目录呈绝对隔离状态，<strong>不会自动携带</strong>根目录的非依赖文件（如 <code>tsconfig.base.json</code>、<code>.eslintrc</code>），导致基于相对路径的配置继承失效</li>
<li><strong>工具缺失</strong>：若构建脚本依赖根目录的共享工具（如 <code>rimraf</code>），必须在每个子包的 <code>devDependencies</code> 中显式声明，否则隔离后的环境将无法识别指令</li>
</ul>
<h3 data-id="heading-3">2. Hoisted 「补丁方案」</h3>
<blockquote>
<p><strong>核心理念：</strong> 结构模拟，路径桥接</p>
</blockquote>
<h4 data-id="heading-4">1. 依赖平铺模式</h4>
<pre><code class="hljs language-ini" lang="ini">pnpm install <span class="hljs-attr">--node-linker</span>=hoisted
</code></pre>
<ul>
<li>强制 pnpm 放弃网格化链接结构，将所有依赖（含各子包依赖）平铺安装至根目录 <code>/app/node_modules</code></li>
<li>彻底消除 Docker 镜像构建中常见的软链接解析失效问题，使文件系统回归经典的<code>物理路径可达</code>状态</li>
</ul>
<h4 data-id="heading-5">2. 重建路径链路</h4>
<p>由于依赖被“提升”到了根目录，而子包（Packages）的代码物理位置仍在深层目录，因此需要通过两个关键补丁来修复逻辑断层：</p>
<ol>
<li>目录映射 Symbolic Link</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">RUN <span class="hljs-built_in">ln</span> -s /app/node_modules /app/packages/node_modules
</code></pre>
<p>在子包层级的人为创造一个指向根目录依赖的入口。完美修复源码中通过相对路径（如 <code>@import '../node_modules/'</code>) 引用依赖时的解析报错</p>
<ol start="2">
<li>执行上下文 PATH Injection</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">// 将根目录的可执行脚本库注入系统全局变量
ENV <span class="hljs-attr">PATH</span>=/app/node_modules/.bin:<span class="hljs-variable">$PATH</span>
</code></pre>
<p>将根目录的 <code>.bin</code> 可执行脚本库注入系统全局变量。确保在任意子包目录下执行 <code>ng build</code> 或 <code>vite</code> 时，系统能跨目录精准定位指令</p>
<h3 data-id="heading-6">3. 技术选型对比</h3>






























<table><thead><tr><th><strong>维度</strong></th><th><strong>官方方案 (Deploy)</strong></th><th><strong>补丁方案 (Hoisted)</strong></th></tr></thead><tbody><tr><td><strong>设计取向</strong></td><td>子包独立化：将子包视为独立微服务</td><td>仓库整体化：保持 Monorepo 完整上下文</td></tr><tr><td><strong>配置共享</strong></td><td>困难：需手动 cp 补齐父级配置文件</td><td>原生支持：天然支持相对路径配置继承</td></tr><tr><td><strong>安全性</strong></td><td>高：严控幽灵依赖，运行环境纯净</td><td>中：依赖平铺可能引入隐式依赖风险</td></tr><tr><td><strong>适用场景</strong></td><td>子包可完全独立部署、无外部配置依赖</td><td><strong>强耦合、重度共享配置的 Monorepo 项目</strong></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信内容emoji表情包编辑器 + vue3 + ts + WrchatEmogi Editor]]></title>    <link>https://juejin.cn/post/7585022810180436031</link>    <guid>https://juejin.cn/post/7585022810180436031</guid>    <pubDate>2025-12-18T10:14:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585022810180436031" data-draft-id="7584817405229056041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信内容emoji表情包编辑器 + vue3 + ts + WrchatEmogi Editor"/> <meta itemprop="keywords" content="JavaScript,Vue.js,前端"/> <meta itemprop="datePublished" content="2025-12-18T10:14:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="半山烟雨半山青"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360354702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信内容emoji表情包编辑器 + vue3 + ts + WrchatEmogi Editor
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360354702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    半山烟雨半山青
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T10:14:52.000Z" title="Thu Dec 18 2025 10:14:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>wechat-emoji-editor组件效果</p>





















<table><thead><tr><th>功能</th><th>效果</th></tr></thead><tbody><tr><td>添加表情</td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b92130c0a234f279d6fe7f50999b5db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2K5bGx54Of6Zuo5Y2K5bGx6Z2S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658062&amp;x-signature=gDlHCJlaFH1FIXQaVr8mt4H91I0%3D" alt="image.png" width="70%" loading="lazy"/></td></tr><tr><td>预览</td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b625a6e85c814fbba2827fc6f8eef622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2K5bGx54Of6Zuo5Y2K5bGx6Z2S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658062&amp;x-signature=hfuDmZ5utNyo9ehtFo2Si7f0e9s%3D" alt="image.png" width="90%" loading="lazy"/></td></tr><tr><td>目录</td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/636472a6387f444cb82ac5974d196099~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2K5bGx54Of6Zuo5Y2K5bGx6Z2S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766658062&amp;x-signature=o9eaKRaBS5BLk6n06gJpTVftqts%3D" alt="image.png" width="30%" loading="lazy"/></td></tr></tbody></table>
<p>代码-组件： （需要源码留言）</p>
<pre><code class="hljs language-ini" lang="ini">// 
import WechatEmojiEditor from '@/components/wechat-emoji-editor/index.vue'
const <span class="hljs-attr">welcomeMsg</span> = <span class="hljs-string">''</span>

&lt;WechatEmojiEditor
  :<span class="hljs-attr">rows</span>=<span class="hljs-string">"4"</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span>
  :<span class="hljs-attr">maxlength</span>=<span class="hljs-string">"1200"</span>
  show-word-limit
  <span class="hljs-attr">v-model</span>=<span class="hljs-string">"welcomeMsg"</span>
&gt;&lt;/WechatEmojiEditor&gt;

</code></pre>
<p>图片打包脚本 （需要源码留言）</p>
<p>package.json</p>
<pre><code class="hljs language-bash" lang="bash">    {
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"build"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
              <span class="hljs-string">"description"</span>: <span class="hljs-string">"build"</span>,
              <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
              <span class="hljs-string">"scripts"</span>: {
                <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo "</span>Error: no <span class="hljs-built_in">test</span> specified<span class="hljs-string">" &amp;&amp; exit 1"</span>,
                <span class="hljs-string">"buildImg"</span>: <span class="hljs-string">"sudo node sharpbuild2.js"</span>,
                <span class="hljs-string">"build"</span>: <span class="hljs-string">"node sharpbuild3.js &amp;&amp; vite build"</span> 
              },
              <span class="hljs-string">"devDependencies"</span>: {
                <span class="hljs-string">"sharp"</span>: <span class="hljs-string">"^0.34.3"</span>
              }
            }
</code></pre>
<p>sharpbuild脚本</p>
<pre><code class="hljs language-php" lang="php">```
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">imgs</span> = [
        {
            cn: <span class="hljs-string">"[微笑]"</span>,
            hk: <span class="hljs-string">"[微笑]"</span>,
            us: <span class="hljs-string">"[Smile]"</span>,
            code: <span class="hljs-string">"/::)"</span>,
            web_code: <span class="hljs-string">"/微笑"</span>,
            src: <span class="hljs-string">"/src/assets/emojis/Smile.png"</span>,
          },
          {
            cn: <span class="hljs-string">"[撇嘴]"</span>,
            hk: <span class="hljs-string">"[撇嘴]"</span>,
            us: <span class="hljs-string">"[Grimace]"</span>,
            code: <span class="hljs-string">"/::~"</span>,
            web_code: <span class="hljs-string">"/撇嘴"</span>,
            src: <span class="hljs-string">"/src/assets/emojis/Grimace.png"</span>,
          },
          <span class="hljs-comment">// ...</span>
        ]
        console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'imgs'</span>, imgs)
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">list</span> = imgs.<span class="hljs-title function_ invoke__">map</span>((item, index) =&gt; {
          <span class="hljs-keyword">return</span> {
            input: `${__dirname}${item.src}`,
            top: Math.<span class="hljs-title function_ invoke__">floor</span>(index / <span class="hljs-number">10</span>) * <span class="hljs-number">128</span>, <span class="hljs-comment">// 垂直偏移量</span>
            left: (index % <span class="hljs-number">10</span>) * <span class="hljs-number">128</span>, <span class="hljs-comment">// 水平偏移量</span>
          };
        });
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">sharp</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">"sharp"</span>);
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">fs</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">"fs"</span>);
        <span class="hljs-comment">// 指定输入文件路径</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">url</span> = `${__dirname}/src/assets/wechat.png`;
        <span class="hljs-title function_ invoke__">sharp</span>({
          <span class="hljs-attr">create</span>: {
            <span class="hljs-attr">width</span>: <span class="hljs-number">10</span> * <span class="hljs-number">128</span>,
            <span class="hljs-attr">height</span>: <span class="hljs-number">11</span> * <span class="hljs-number">128</span>,
            <span class="hljs-attr">channels</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">background</span>: { <span class="hljs-attr">r</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">g</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">alpha</span>: <span class="hljs-number">0</span> },
          },

        })

          .<span class="hljs-title function_ invoke__">composite</span>(<span class="hljs-keyword">list</span>)
          .<span class="hljs-title function_ invoke__">toFile</span>(url)
          .<span class="hljs-title function_ invoke__">then</span>((info) =&gt; {
            console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"Image composite successfully:"</span>, info);
          })
          .<span class="hljs-keyword">catch</span>((error) =&gt; {
            console.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">"Error processing image:"</span>, error);
          });
   ```
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 CSS 伪类和伪元素的本质区别]]></title>    <link>https://juejin.cn/post/7584266184882880546</link>    <guid>https://juejin.cn/post/7584266184882880546</guid>    <pubDate>2025-12-17T00:54:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584266184882880546" data-draft-id="7576936862632411136" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 CSS 伪类和伪元素的本质区别"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-12-17T00:54:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 CSS 伪类和伪元素的本质区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T00:54:34.000Z" title="Wed Dec 17 2025 00:54:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在写前端CSS样式的时候，经常用到这种<code>:hover</code>或者<code>::before</code>有冒号的写法。我很疑惑，为什么有些是单冒号，有些又是双冒号呢？</p>
<p>后来我才知道这种写法也区分为<strong>伪类</strong>和<strong>伪元素</strong>。</p>
<h3 data-id="heading-0">伪类和伪元素是什么？</h3>
<p><strong>伪类（Pseudo-classes）</strong>：​用于选择处于特定状态的元素。也可以理解为，当元素处于某种状态的时候，给它加上一个“类”来定义样式。</p>
<ul>
<li>语法：​单个冒号<code>:</code>，例如<code>:hover</code></li>
</ul>
<p><strong>伪元素（Pseudo-elements）</strong>：用于选择元素的特定部分。可以理解为，它在文档中创建了一个虚拟的“元素”来设置样式。</p>
<ul>
<li>语法：双冒号<code>::</code>，例如<code>::before</code></li>
</ul>
<hr/>
<h3 data-id="heading-1">只要是单个冒号的就一定是伪元素吗？</h3>
<p>在现代CSS3点规范中，所有使用双冒号<code>::</code>语法的选择器都被定义为伪元素。这是W3C为了明确区分伪类和伪元素而引入的约定。</p>
<p>但在早期的CSS中，伪元素也使用单冒号，因为当时没有区分语法。所以为了向后兼容，大多数的浏览器还是会支持<code>:before</code>、<code>:after</code>等单冒号的写法。</p>
<p>但新的伪元素只支持双冒号，比如：<code>::selection</code>。</p>
<hr/>
<h3 data-id="heading-2">伪类（Pseudo-classes）</h3>
<p>伪类用于<strong>选择处于特定状态的元素</strong>，比如用户交互状态、结构位置等。</p>
<h4 data-id="heading-3">常见伪类示例：</h4>
<ul>
<li><code>:hover</code>：鼠标悬停时</li>
<li><code>:focus</code>：元素获得焦点时（如输入框）</li>
<li><code>:active</code>：元素被激活时（如点击按钮）</li>
<li><code>:visited</code>：链接已被访问过</li>
<li><code>:first-child</code> / <code>:last-child</code>：第一个/最后一个子元素</li>
<li><code>:nth-child(n)</code>：第 n 个子元素</li>
<li><code>:not(selector)</code>：排除匹配 selector 的元素</li>
</ul>
<h4 data-id="heading-4">示例：</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid blue;
}

<span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:first</span>-child {
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<p>伪类使用<strong>单冒号</strong>。</p>
<hr/>
<h3 data-id="heading-5">伪元素（Pseudo-elements）</h3>
<p>伪元素用于<strong>创建并样式化文档中不存在的虚拟元素</strong>，比如段落首字母、选中文本、元素前后插入内容等。</p>
<h4 data-id="heading-6">常见伪元素：</h4>
<ul>
<li><code>::before</code>：在元素内容前插入内容</li>
<li><code>::after</code>：在元素内容后插入内容</li>
<li><code>::first-letter</code>：段落的第一个字母</li>
<li><code>::first-line</code>：段落的第一行</li>
<li><code>::selection</code>：用户选中的文本（部分浏览器需加前缀）</li>
</ul>
<h4 data-id="heading-7">示例：</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">::first-letter</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2em</span>;
  <span class="hljs-attribute">color</span>: gold;
}

<span class="hljs-selector-class">.quote</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"“"</span>;
}

<span class="hljs-selector-class">.quote</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"”"</span>;
}

<span class="hljs-selector-pseudo">::selection</span> {
  <span class="hljs-attribute">background</span>: yellow;
  <span class="hljs-attribute">color</span>: black;
}
</code></pre>
<p>伪元素使用<strong>双冒号</strong>（<code>::before</code>），这是CSS3的规范写法。出于兼容性考虑，旧代码可能仍用单冒号（如<code>:before</code>），现代项目建议用双冒号。</p>
<hr/>
<h3 data-id="heading-8">主要区别</h3>






























<table><thead><tr><th>特性</th><th>伪类（Pseudo-class）</th><th>伪元素（Pseudo-element）</th></tr></thead><tbody><tr><td>作用对象</td><td>已存在的元素的<strong>状态或位置</strong></td><td>创建<strong>不存在的虚拟内容或部分</strong></td></tr><tr><td>语法</td><td>单冒号（如 <code>:hover</code>）</td><td>双冒号（如 <code>::before</code>）</td></tr><tr><td>是否生成内容</td><td>否</td><td>是（常配合 <code>content</code> 属性）</td></tr><tr><td>示例</td><td><code>a:hover</code>, <code>:nth-child(2)</code></td><td><code>::first-letter</code>, <code>::after</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">示例效果</h3>
<p>一个简单的待办事项列表
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0592bd2d56b48c689768cb07b368be4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766537673&amp;x-signature=%2FiRwnx4WTNIkf3UjEJUqOy02d6A%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-10">完整代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>伪类vs伪元素示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">500px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
            <span class="hljs-attribute">background</span>: white;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">30px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.2</span>);
        }

        <span class="hljs-selector-tag">h1</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
        }

        <span class="hljs-selector-class">.explanation</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fa</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#3498db</span>;
        }

        <span class="hljs-selector-class">.todo-list</span> {
            <span class="hljs-attribute">list-style</span>: none;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }

        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">8px</span> <span class="hljs-number">0</span>;
            <span class="hljs-attribute">background</span>: white;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#e9ecef</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
            <span class="hljs-attribute">position</span>: relative;
        }

        <span class="hljs-comment">/* === 伪类样式 === */</span>
        <span class="hljs-comment">/* 第一个子元素 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:first</span>-child {
            <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#e74c3c</span>;
        }

        <span class="hljs-comment">/* 偶数项 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(even) {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
        }

        <span class="hljs-comment">/* 悬停效果 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#aab49b</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">10px</span>);
            <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#aab49b</span>;
        }

        <span class="hljs-comment">/* 点击效果 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:active</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2ecc71</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.98</span>);
        }

        <span class="hljs-comment">/* === 伪元素样式 === */</span>
        <span class="hljs-comment">/* 前面的图标 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::before</span> {
            <span class="hljs-attribute">content</span>: <span class="hljs-string">"📌"</span>;
            <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
        }

        <span class="hljs-comment">/* 悬停时图标变化 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">::before</span> {
            <span class="hljs-attribute">content</span>: <span class="hljs-string">"🔥"</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
        }

        <span class="hljs-comment">/* 后面的装饰线 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::after</span> {
            <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">3px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#e74c3c</span>, <span class="hljs-number">#669521</span>);
            <span class="hljs-attribute">transition</span>: width <span class="hljs-number">0.3s</span> ease;
        }

        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">::after</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        }

        <span class="hljs-comment">/* 首字母样式 */</span>
        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::first-letter</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.3em</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
        }

        <span class="hljs-selector-class">.todo-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">::first-letter</span> {
            <span class="hljs-attribute">color</span>: white;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>伪类 vs 伪元素 演示<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"explanation"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>伪类（Pseudo-class）<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>：选择元素的特定<span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>状态<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>伪元素（Pseudo-element）<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>：选择元素的特定<span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>部分<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>学习 CSS 伪类<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>理解伪元素<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>完成项目练习<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>复习知识点<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 添加点击切换完成状态的功能</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.todo-list li'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
            item.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'completed'</span>);
            });
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个示例中，可以清晰地看到：</p>
<h4 data-id="heading-11">伪类（操作的是整个元素）</h4>
<ul>
<li><code>:first-child</code>：操作第一个<code>&lt;li&gt;</code>元素的整体样式</li>
<li><code>:nth-child(even)</code>：操作偶数位置<code>&lt;li&gt;</code>的整体背景</li>
<li><code>:hover</code>：操作鼠标悬停时<code>&lt;li&gt;</code>的整体状态变化</li>
</ul>
<h4 data-id="heading-12">伪元素（操作的是元素的一部分）</h4>
<ul>
<li><code>::before</code>：在<code>&lt;li&gt;</code>内容之前插入新内容（图标）</li>
<li><code>::after</code>：在<code>&lt;li&gt;</code>内容之后插入装饰线条</li>
<li><code>::first-letter</code>：只样式化<code>&lt;li&gt;</code>文本的第一个字母</li>
</ul>
<p><strong>简单记忆</strong>：伪类是状态选择器，伪元素是内容生成器。</p>
<hr/>
<h3 data-id="heading-13">总结</h3>
<p><strong>伪类</strong>：</p>
<ul>
<li>选择元素的<strong>特定状态</strong>（如:hover、:focus）</li>
<li>语法使用<strong>单冒号</strong>（如<code>:hover</code>）</li>
<li>不生成新内容，只针对元素本身的状态变化</li>
<li>常见用途：用户交互反馈、结构位置选择</li>
</ul>
<p><strong>伪元素</strong>：</p>
<ul>
<li>创建并样式化元素的<strong>特定部分</strong>或<strong>虚拟内容</strong></li>
<li>语法使用<strong>双冒号</strong>（如<code>::before</code>）</li>
<li>常配合<code>content</code>属性生成新内容</li>
<li>常见用途：插入装饰元素、样式化文本部分</li>
</ul>
<p>通过上面的内容，我也终于搞懂了伪类和伪元素的区别。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-14">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6V83qjR6u0nyfzL-14xYAw" target="_blank" title="https://mp.weixin.qq.com/s/6V83qjR6u0nyfzL-14xYAw" ref="nofollow noopener noreferrer">《async/await 到底要不要加 try-catch？异步错误处理最佳实践》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPQ_w7CDVoIZPn-CVH2DKJg" target="_blank" title="https://mp.weixin.qq.com/s/PQ_w7CDVoIZPn-CVH2DKJg" ref="nofollow noopener noreferrer">《Vue3 和 Vue2 的核心区别？很多开发者都没完全搞懂的 10 个细节》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">《Java 开发必看：什么时候用 for，什么时候用 Stream？》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqI3TRTdDfRJSH9kCTqAQUw" target="_blank" title="https://mp.weixin.qq.com/s/qI3TRTdDfRJSH9kCTqAQUw" ref="nofollow noopener noreferrer">《这 10 个 MySQL 高级用法，让你的代码又快又好看》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nginx路径相关配置汇总]]></title>    <link>https://juejin.cn/post/7585019819192942602</link>    <guid>https://juejin.cn/post/7585019819192942602</guid>    <pubDate>2025-12-18T10:16:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585019819192942602" data-draft-id="7585019819192926218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nginx路径相关配置汇总"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-12-18T10:16:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="龙两溪"/> <meta itemprop="url" content="https://juejin.cn/user/817692382869000"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nginx路径相关配置汇总
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692382869000/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    龙两溪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T10:16:53.000Z" title="Thu Dec 18 2025 10:16:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、root和alias的区别</h2>
<p>root是将root配置的路径和location配置的路径拼接；alias则是用alias的路径替换location配置的路径</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 返回localhost:port/html/test/index.html的文件 </span>
location ^~ /test/ { 
    root html/;
    index index.html index.htm;
} 
<span class="hljs-comment"># 返回localhost:port/html/test/index.html的文件 </span>
location ^~ /test/ { 
    <span class="hljs-built_in">alias</span> html/test/; 
    index index.html index.htm;
}
</code></pre>
<h2 data-id="heading-1">二、 location路径末尾有无<code>/</code>的区别</h2>
<h5 data-id="heading-2">1.location末尾没有<code>/</code>，则以结尾路径进行模糊匹配，配置<code>location /test/a</code>，则可以匹配<code>/test/a</code>,<code>/test/a/</code>,<code>/test/a/b</code>,<code>/test/abc</code></h5>
<ul>
<li>✅ <code>/test/a</code></li>
<li>✅ <code>/test/a/</code></li>
<li>✅ <code>/test/a/b</code></li>
<li>✅ <code>/test/abc</code>（是的，也会匹配！）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">lication /test/a {
    <span class="hljs-built_in">alias</span> html/test/;
    index index.html index.htm;
}
</code></pre>
<h5 data-id="heading-3">2.location末尾有<code>/</code>，则以结尾路径进行精确匹配，配置<code>location /test/a/</code>，则可以匹配<code>/test/a/</code>,<code>/test/a/b</code>,不能匹配<code>/test/a</code>,<code>/test/abc</code></h5>
<ul>
<li>✅ <code>/test/a/</code></li>
<li>✅ <code>/test/a/b</code></li>
<li>❌ <code>/test/a</code>（严格来说不匹配，但有时会301重定向到有<code>/</code>的版本）</li>
<li>❌ <code>/test/abc</code></li>
</ul>
<pre><code class="hljs language-bash" lang="bash">lication /test/a/ {
    <span class="hljs-built_in">alias</span> html/test/;
    index index.html index.htm;
}
</code></pre>
<blockquote>
<p>使用 proxy_pass 配置反向代理,在匹配到 location 配置的 URL 路径后，转发请求到 proxy_pass 配置额 URL，方向代理后的地址与 proxy_pass 路径末尾是否有"/"有关；</p>
</blockquote>
<h2 data-id="heading-4">三、proxy_pass 路径末尾有无<code>/</code>的区别</h2>
<h5 data-id="heading-5">1.proxy_pass 路径末尾配置/表示绝对路径，当请求匹配到/api/时，会直接将替换为 proxy_pass 的路径</h5>
<pre><code class="hljs language-javascript" lang="javascript">location   /api/  {
      proxy_pass    <span class="hljs-attr">http</span>:<span class="hljs-comment">//127.0.0.1:8080/;</span>
}
</code></pre>
<p>请求 <a href="https://link.juejin.cn?target=http%3A%2F%2Fxxx%2Fapi%2Fget%25EF%25BC%258C%25E5%25B0%2586%25E4%25BC%259A%25E8%25A2%25AB" target="_blank" title="http://xxx/api/get%EF%BC%8C%E5%B0%86%E4%BC%9A%E8%A2%AB" ref="nofollow noopener noreferrer">http://xxx/api/get，将会被</a> nginx 转发请求到<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8080%2Fget%25EF%25BC%2588%25E6%259C%25AA%25E9%2599%2584%25E5%258A%25A0%2Fapi%2F%25E8%25B7%25AF%25E5%25BE%2584%25EF%25BC%2589%25E3%2580%2582" target="_blank" title="http://127.0.0.1:8080/get%EF%BC%88%E6%9C%AA%E9%99%84%E5%8A%A0/api/%E8%B7%AF%E5%BE%84%EF%BC%89%E3%80%82" ref="nofollow noopener noreferrer">http://127.0.0.1:8080/get（未附加/api/路径）。</a></p>
<h5 data-id="heading-6">2.proxy_pass 路径末尾没有/表示相对路径，当请求匹配到/api/时，会拼接 proxy_pass 的路径</h5>
<pre><code class="hljs language-javascript" lang="javascript">location   /api/  {
      proxy_pass    <span class="hljs-attr">http</span>:<span class="hljs-comment">//127.0.0.1:8080;</span>
}
</code></pre>
<p>请求 <a href="https://link.juejin.cn?target=http%3A%2F%2Fxxx%2Fapi%2Fget%25EF%25BC%258C%25E5%25B0%2586%25E4%25BC%259A%25E8%25A2%25AB" target="_blank" title="http://xxx/api/get%EF%BC%8C%E5%B0%86%E4%BC%9A%E8%A2%AB" ref="nofollow noopener noreferrer">http://xxx/api/get，将会被</a> nginx 转发请求到<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8080%2Fapi%2Fget%25EF%25BC%2588%25E6%258B%25BC%25E6%258E%25A5%2Fapi%2F%25E8%25B7%25AF%25E5%25BE%2584%25EF%25BC%2589%25E3%2580%2582" target="_blank" title="http://127.0.0.1:8080/api/get%EF%BC%88%E6%8B%BC%E6%8E%A5/api/%E8%B7%AF%E5%BE%84%EF%BC%89%E3%80%82" ref="nofollow noopener noreferrer">http://127.0.0.1:8080/api/get（拼接/api/路径）。</a></p>
<h2 data-id="heading-7">四、<code>try_files</code> 当配置资源请求失败时，尝试访问try_files路径下的资源</h2>
<p>由于vue项目是SPA，只有一个html页面，当使用项目history模式，在访问子路由时，刷新页面会nginx报错404，则需要配置<code>try_files</code>，使得nginx在访问资源失败时，尝试访问<code>try_files</code>配置的资源路径;</p>
<pre><code class="hljs language-bash" lang="bash">lication /test/ {
    <span class="hljs-built_in">alias</span> html/test/;
    index index.html index.htm;
    try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /test/index.html;
}
</code></pre>
<p>项目访问<code>localhost:port/test/</code>根路径则可以正常访问，当访问子路由<code>localhost:port/test/home</code>刷新页面之后则请求不到资源，则依次读取<code>try_files</code>下的资源，<code>$uri</code>指代我们访问的路径<code>/test/home</code>，访问失败，则最终访问我们配置的<code>/test/index.html</code>，返回资源。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[预言市场进化论：从罗马斗兽场，到 Polymarket 的 K 线图]]></title>    <link>https://juejin.cn/post/7584358227611189290</link>    <guid>https://juejin.cn/post/7584358227611189290</guid>    <pubDate>2025-12-17T02:40:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584358227611189290" data-draft-id="7584343534967947306" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="预言市场进化论：从罗马斗兽场，到 Polymarket 的 K 线图"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2025-12-17T02:40:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HiStewie"/> <meta itemprop="url" content="https://juejin.cn/user/1591748568038823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            预言市场进化论：从罗马斗兽场，到 Polymarket 的 K 线图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748568038823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HiStewie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T02:40:33.000Z" title="Wed Dec 17 2025 02:40:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>离职了，写一点对上家公司业务的感想：</p>
<ul>
<li>Web3的预测市场在做什么？</li>
<li>为什么会有这种业务？</li>
<li>是凭空产生的想法吗，还是对已有场景的Web3重构？</li>
<li>现在还能入职做类似业务吗（不建议，长尾效应 + 资本倾轧，当前市场除了Kalshi没有任何能在Polymarket嘴里抢饭吃的产品，其他预测市场未来发展除了搞不合规的业务，不然无法存活）</li>
</ul>
<p><strong>我们如何利用人类的“贪婪” (Greed)，来获取这个世界的“真相” (Truth)？</strong></p>
<p>在 2024 年的美国总统大选季，我们学到的最重要一课是：<strong>不要看 CNN 说什么，要看 Polymarket 赌什么。</strong></p>
<p>为什么一个建立在区块链上的“赌场”，会比拥有百年历史的民调机构更准确？这不仅仅是运气。这是一场关于<strong>信息论、行为学和去中心化技术</strong>的精密实验。</p>
<p>Polymarket 的本质，不是为了让你陷入一个二元牌桌进行加码下注。它是利用你投机的心理，计算出世界的真实概率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6795bc3aff314b21882424a9b05d69dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766549832&amp;x-signature=BHrw6J1aSOU3t9TYuhGu5A3worE%3D" alt="截屏2025-12-17 10.28.38.png" loading="lazy"/></p>
<h2 data-id="heading-1">第一章：行为学与经济学 —— 为什么“真金白银”是唯一诚实的语言？</h2>
<p>在互联网时代，观点（Opinion）是世界上最泛滥的商品，同时也是最廉价的。</p>
<p>打开 Twitter 或微博，你会看到无数专家信誓旦旦地预测：“A 币必涨”、“B 队必胜”、“C 候选人稳了”。</p>
<p>如果他们错了，代价是什么？通常是<strong>零</strong>。他们甚至不需要删帖，只要换个话题继续吹牛即可。</p>
<p>经济学把这种现象称为“廉价谈话” (Cheap Talk)。因为没有成本，所以噪音淹没了信号。</p>
<p>但在 Polymarket 上，同样的一个观点，可能要花你 1000 美元。</p>
<ol>
<li>
<h3 data-id="heading-2">切肤之痛 (Skin in the Game)：理性的强制唤醒</h3>
</li>
</ol>
<p>纳西姆·塔勒布在《非对称风险》中说：“没有风险共担，就没有决策权。”</p>
<p>预测市场的魔力，在于它用金钱强行切换了你的大脑模式：</p>
<ul>
<li><strong>无筹码时（社交媒体）：</strong> 大脑由<strong>多巴胺</strong>主导。你的发言是为了寻求认同、宣泄情绪。你说“川普会赢”，是因为你<strong>希望</strong>他赢。</li>
<li><strong>有筹码时（预测市场）：</strong> 当你把 1000 USDC 拍在桌上，<strong>前额叶皮层（理性逻辑）</strong> 重新占领高地。你会立刻停止幻想，开始疯狂研究民调数据和摇摆州经济。</li>
</ul>
<p><strong>Polymarket 并不是在预测未来，它是在“提纯”判断。</strong> 它过滤掉了所有的“我希望 (I hope)”，只留下了最真实的“我认为 (I think)”。</p>
<ol start="2">
<li>
<h3 data-id="heading-3">风险转移 (Risk Transfer)：给“焦虑”定价</h3>
</li>
</ol>
<p>如果说“切肤之痛”解释了为什么预测市场<strong>准</strong>，那么“风险转移”则解释了为什么它<strong>有用</strong>。</p>
<p>很多人误以为 Polymarket 只是一个赌博平台，但在经济学家眼里，它是一个完美的“焦虑交易所”。</p>
<p>让我们看一个经典的 <strong>“情感对冲” (Emotional Hedge)</strong> 案例：</p>
<blockquote>
<p>假设你是一位坚定的环保主义者，你极度恐惧特朗普当选，因为你担心他会废除环保法案，导致你的清洁能源公司破产。</p>
<p><strong>你应该怎么做？</strong> 在 Polymarket 上，你应该<strong>重仓买入“特朗普胜选”</strong> 。</p>
</blockquote>
<p>这听起来很反直觉，但这正是金融对冲的精髓：</p>
<ul>
<li><strong>情况 A（特朗普赢了）：</strong> 你的环保理想破灭了，公司可能面临困难，<strong>但你在 Polymarket 上赚了一大笔钱</strong>。这笔钱是对你精神创伤和潜在经济损失的<strong>补偿</strong>。</li>
<li><strong>情况 B（特朗普输了）：</strong> 你在 Polymarket 上的钱归零了，<strong>但你很高兴</strong>。因为你的理想实现了，你的公司安全了。你亏掉的那笔钱，本质上是你为“世界和平”支付的<strong>保费</strong>。</li>
</ul>
<p>通过这种机制，Polymarket 把风险从“风险厌恶者” <strong>（如上述的环保主义者）手中，转移到了</strong>“风险投机者”（单纯想赚钱的交易员）手中。</p>
<p>在这个维度上，预测市场不再是赌场，它是<strong>人类历史上第一个能够量化、交易并对冲“未来焦虑”的金融基础设施</strong>。</p>
<h2 data-id="heading-4">第二章：历史演变 —— 从“多巴胺”到“资产化”</h2>
<p>人类为了给“不确定性”定价，走了几千年。</p>
<p>让我们把镜头拉过这漫长的时光隧道，看看“预测”是如何一步步脱胎换骨的。</p>
<h3 data-id="heading-5">1.0 罗马斗兽场：带血的筹码</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c15c6277b474a4dbfa3f78ba723f104~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766549832&amp;x-signature=NRcZoRFjGcGl6bX5ycQ8mNstKEg%3D" alt="" loading="lazy"/></p>
<p><strong>(The Era of Dopamine)</strong></p>
<p>公元 80 年，罗马斗兽场。</p>
<p>空气中弥漫着汗水和血腥味。两个角斗士正在殊死搏斗，看台上的贵族把金币扔进盘子里，赌那个拿三叉戟的奴隶能活下来。</p>
<p>这是预测市场的<strong>史前时代</strong>。 在这里，预测是一种纯粹的<strong>多巴胺消费</strong>。没有复杂的赔率计算，没有风险对冲模型，只有最原始的冲动——我想看他赢，或者我想看他死。这本质上和今天你在球赛里赌谁进球没有区别，它满足的是兽性，而非理性。</p>
<p><strong>核心逻辑：</strong> 钱进去了，被庄家狠狠切了一刀，剩下的才给赢家。这是一个<strong>负和游戏</strong>。</p>
<h3 data-id="heading-6">2.0 芝加哥的粮仓：恐惧的解药</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16379cd39ab14fefbdb19bea07bd6b4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766549832&amp;x-signature=LzLjKxyG6ihUR%2B4u6cI29S3LEnw%3D" alt="" loading="lazy"/></p>
<p>镜头切到 1848 年，芝加哥。</p>
<p>这里没有角斗士，只有满脸愁容的玉米农场主。他们不关心谁赢，他们只关心明年玉米会不会跌到连运费都不够。</p>
<p>于是，<strong>芝加哥期货交易所 (CBOT)</strong> 诞生了。 人类历史上第一次，人们把“明年的玉米”变成了一张可以现在买卖的纸。这不再是赌博，这是<strong>生存</strong>。 预测从“娱乐”进化成了“避险工具”。金融学介入了，它告诉世界：<strong>时间是可以被定价的，恐惧是可以被买卖的。</strong></p>
<p><strong>核心逻辑：</strong> 农民卖出“恐惧”，投机者买入“贪婪”。CME 在中间做担保。这是<strong>金融避险</strong>。</p>
<h3 data-id="heading-7">3.0 以太坊的早期废墟：极客的乌托邦</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e920ad3c738045ad937ac1c1b358e70a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766549832&amp;x-signature=wpvoJqAbQ8TnzvCwiNg98ftskOU%3D" alt="" loading="lazy"/></p>
<p>时间来到 2015 年，以太坊刚刚诞生。 一群天才极客（包括 Vitalik 自己）兴奋地宣称：“我们要把芝加哥交易所搬到链上！我们要消灭中间商！” 于是，<strong>Augur</strong> 诞生了。理念极其性感，现实极其骨感。</p>
<p>想象一下这个场景： 你想赌希拉里会不会赢。你打开 Augur，首先要下载几十 GB 的区块链数据，同步三天三夜。好不容易同步完了，你点了一下“Yes”，弹窗告诉你：<strong>Gas 费 $50，确认时间 15 分钟。</strong> 等你下完注，希拉里可能都已经发表败选感言了。</p>
<p>Augur 是一次伟大的失败。它证明了：<strong>没有用户体验的去中心化，只是一场昂贵的自嗨。</strong> 它赢了哲学，输了人性。</p>
<p><strong>核心逻辑：</strong> 流程太长，摩擦太大。用户还没开始玩，就被 Gas 费和等待时间劝退了。这是<strong>技术自嗨</strong>。</p>
<h3 data-id="heading-8">4.0 Polymarket：当技术隐形</h3>
<p>最后，镜头定格在 2024 年。</p>
<p>你躺在沙发上，打开手机，点开 Polymarket。没有下载节点，没有助记词的恐惧，没有高昂的 Gas 费（感谢 Polygon 和 L2）。</p>
<p>你用 USDC 充值，像发微信一样丝滑地买入了“特朗普胜选”。</p>
<p>这才是终局。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf82856271a5492e9e3b3165265e3867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766549832&amp;x-signature=XvRxbZKvNEGkOMXfjupPQf42P7k%3D" alt="" loading="lazy"/></p>
<p><strong>核心逻辑：</strong> USDC 进去，瞬间变成 Yes/No 代币。L2 解决了速度，AMM 解决了流动性。这是<strong>信息资产化</strong>。</p>
<p>Polymarket 做对了一件事：<strong>它让区块链消失了。</strong> 它把“预测”变成了一种<strong>高流动性的信息资产</strong>。你手中的那个 Token，不再是一张死板的赌票，而是一个活着的、每秒钟都在跳动的 <strong>“概率所有权”</strong> 。</p>
<ul>
<li>你可以随时买入（表达观点）；</li>
<li>你可以随时卖出（获利了结）；</li>
<li>你可以把它借贷、抵押、甚至组合。</li>
</ul>
<p>从罗马的带血金币，到芝加哥的期货合约，再到 Augur 的卡顿代码，最终进化成了 Polymarket 上那条丝滑的蓝色 K 线。</p>
<p>这不仅仅是技术的胜利，这是<strong>流动性的胜利</strong>。</p>
<hr/>
<h2 data-id="heading-9">第三章：工作原理 —— 价格即概率</h2>
<p>现实世界是混沌的、复杂的、充满噪音的。但 Polymarket 通过<strong>二元期权 (Binary Option)</strong> ，强行把这个复杂的世界压缩成了两个简单的状态：<strong>Yes 或 No</strong>。</p>
<p>这背后有一套优雅的数学逻辑。</p>
<p>Polymarket 把混沌的世界强行压缩成了两个状态：<strong>Yes 或 No</strong>。</p>
<h3 data-id="heading-10">1. 拆解原子：1 美元 = 1 Yes + 1 No</h3>
<p>很多人以为下注是把钱给庄家。<strong>错。</strong> 当你充值 1 美元（USDC）时，智能合约执行了一次“原子分裂”：</p>
<blockquote>
<p><strong>1 USDC ➡️ 1 个 [Yes Token] + 1 个 [No Token]</strong></p>
</blockquote>
<p>这是一个恒等式。无论结果如何，只要你凑齐一对 Yes 和 No，随时可以换回 1 美元。</p>
<ul>
<li>如果 Yes 赢了，Yes Token 价值变 $1，No 归零。</li>
<li>如果 No 赢了，No Token 价值变 $1，Yes 归零。</li>
</ul>
<p>这就是为什么<strong>价格完美对应概率</strong>：如果“川普胜选”的 Yes Token 现在的价格是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.60</mn><mtext>，意味着市场共识认为它最终变成</mtext></mrow><annotation encoding="application/x-tex">0.60，意味着市场共识认为它最终变成 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">0.60</span><span class="mord cjk_fallback">，意味着市场共识认为它最终变成</span></span></span></span></span>1 的概率是 60%。</p>
<ol start="2">
<li>
<h3 data-id="heading-11">贪婪的鲨鱼：套利机制 (Arbitrage)</h3>
</li>
</ol>
<p>为什么 $0.60 这个价格是准的？<strong>因为有人想捡钱。</strong></p>
<p>假设民调显示川普胜率是 60%，但 Polymarket 上有人砸盘，把价格砸到了 $0.10。</p>
<p>这时候，套利者登场了。在他们眼里，这不叫政治，这叫“地上有钱”。他们会疯狂买入 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.10</mn><mtext>的筹码，直到把价格推回</mtext></mrow><annotation encoding="application/x-tex">0.10 的筹码，直到把价格推回 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">0.10</span><span class="mord cjk_fallback">的筹码，直到把价格推回</span></span></span></span></span>0.60。</p>
<p><strong>结论：</strong> 并不是 Polymarket 知道真相。是无数贪婪的个体，为了赚取哪怕 1% 的利润，强行把价格修正到了最接近真相的位置。</p>
<p>这时候，<strong>套利者（Arbitrageurs）</strong> 登场了。 在他们眼里，这不叫“政治立场”，这叫“地上有钱”。</p>
<ul>
<li>他们看到的是：用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.10</mn><mtext>买入一个价值</mtext></mrow><annotation encoding="application/x-tex">0.10 买入一个价值 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">0.10</span><span class="mord cjk_fallback">买入一个价值</span></span></span></span></span>0.60 的资产。</li>
<li><strong>期望收益率：500%。</strong></li>
</ul>
<p>全世界的聪明资金、量化基金、甚至 AI 机器人会像闻到血腥味的鲨鱼一样蜂拥而至，疯狂买入“Yes Token”。</p>
<p>这种买入力量会迅速推高价格，直到价格从 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.10</mn><mtext>回升到</mtext></mrow><annotation encoding="application/x-tex">0.10 回升到 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">0.10</span><span class="mord cjk_fallback">回升到</span></span></span></span></span>0.60。当价格回到 $0.60 时，无利可图，鲨鱼散去。</p>
<p><strong>结论：</strong> 并不是 Polymarket 知道真相。是<strong>一个个贪婪的个体，为了赚取哪怕 1% 的无风险利润，通过“群体博弈”，强行把价格修正到了最接近真相的位置。</strong></p>
<ol start="3">
<li>
<h3 data-id="heading-12">底层引擎：CTF 与 AMM</h3>
</li>
</ol>
<p>支撑这场全球博弈的，是两个关键的技术支柱。没有它们，Polymarket 就会退化成卡顿的 Augur。</p>
<ul>
<li>
<p><strong>条件代币框架 (Conditional Tokens Framework, CTF)：</strong> 这是 Gnosis 开发的一套积木。它允许预测变得<strong>可组合</strong>。</p>
<ul>
<li><em>例子：</em> 你不仅可以赌“川普赢”，你还可以赌“川普赢 <strong>且</strong> 拜登退选”。CTF 允许把这种复杂的逻辑嵌套进 Token 里，让预测有了深度。</li>
</ul>
</li>
<li>
<p><strong>混合做市机制 (Hybrid CLOB/AMM)：</strong> 早期的链上市场使用 AMM（自动做市商），就像 Uniswap，滑点很高。 现在的 Polymarket 引入了 <strong>CLOB（中央限价订单簿）</strong> 。这意味着做市商（Market Makers）可以像在纳斯达克一样挂单。</p>
<ul>
<li><strong>结果：</strong> 极致的流动性。即使你一次性下注 100 万美元，价格可能也只会波动 0.1%。</li>
</ul>
</li>
</ul>
<ol start="4">
<li>
<h3 data-id="heading-13">裁决机制：去中心化的法官 (The Resolution)</h3>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9632fedeee904aec83fbae650313584b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766549832&amp;x-signature=bhuOgvqsg9dY5zZjeVvC0LrWuqY%3D" alt="" loading="lazy"/></p>
<p>在传统赌场，庄家既是运动员，又是裁判。如果庄家耍赖，你毫无办法。 但在 Polymarket，<strong>没有人拥有“上帝视角”</strong> 。</p>
<p>它引入了一个名为 <strong>UMA (Universal Market Access)</strong> 的去中心化预言机系统。这套机制被称为“乐观预言机” (Optimistic Oracle)，其逻辑非常反直觉：</p>
<ul>
<li><strong>默认诚实原则（Optimistic）：</strong> 当大选结束，任何人（通常是提议者）都可以向链上提交结果：“川普赢了”。 系统<strong>默认</strong>这句话是真的。它不会立即去查证，而是开启一个“异议窗口期” (Dispute Window)（通常是 2 小时）。</li>
<li><strong>挑战机制（The Challenge）：</strong> 在这个窗口期内，如果有人觉得结果不对（比如其实是拜登赢了），他可以质押一笔钱发起“挑战” (Dispute)。 一旦发生挑战，案件就会升级，交给 <strong>UMA 代币持有者</strong> 进行全网投票。</li>
<li><strong>谢林点博弈 (Schelling Point)：</strong> 这时候，成千上万的 UMA 持币者会进行投票。 他们为什么要投出真话？因为博弈论。 如果我乱投票（指鹿为马），UMA 系统的公信力会崩塌，我手里的币会归零。 为了保护我的资产价值，我必须<strong>投出我认为其他人也会投出的那个结果</strong>——而这个结果，通常就是<strong>客观真相</strong>。</li>
</ul>
<p><strong>结论：</strong> 并没有一个中心化的“上帝”在宣布结果。 真相是经过“默认通过 -&gt; 挑战 -&gt; 全民公投”这套严密的博弈流程后，沉淀下来的共识。这确保了即使 Polymarket 公司倒闭，只要以太坊还在，你的赌注依然能得到公正的裁决。</p>
<h2 data-id="heading-14">第四章：合规与冲突 —— 赌场还是公共设施？ <strong>(The Regulation: The Conflict)</strong></h2>
<p>Polymarket 已经征服了技术，但它面前还挡着一座大山：<strong>法律</strong>。</p>
<p>当一个去中心化的协议变得比 CNN 更具权威性，比拉斯维加斯更具流动性时，它不可避免地撞上了旧世界的围墙。</p>
<h3 data-id="heading-15">1. 监管者 (CFTC) 的视角：手里拿着锤子</h3>
<p>在美国监管机构 CFTC 眼里，Polymarket 就是个<strong>非法地下赌场</strong>。
他们的法律是 1930 年代为了监管<strong>大豆和玉米</strong>制定的。在他们看来，把“谁当总统”变成可交易资产，既荒谬又危险。</p>
<h3 data-id="heading-16">2. 辩护者的视角：混乱时代的灯塔</h3>
<p>但在硅谷和 Vitalik 看来，Polymarket 是 <strong>“信息公共产品”</strong>。
在这个假新闻漫天飞的时代，媒体有立场，民调有偏见，<strong>但钱不会撒谎</strong>。它是社会获取真相成本最低的方式。</p>
<h3 data-id="heading-17">3. 现状：地缘政治套利</h3>
<p>Polymarket 玩了一手聪明的<strong>地缘政治套利</strong>：</p>
<ul>
<li><strong>表面上：</strong> 屏蔽美国 IP，告诉 CFTC “我不做美国人生意”。</li>
<li><strong>实际上：</strong> 智能合约在链上。任何懂技术的美国人，挂个 VPN 依然能畅通无阻。</li>
</ul>
<p>监管者可以罚款公司，可以关停网站前端，但无法关闭以太坊网络，无法删除链上的代码。</p>
<h3 data-id="heading-18">⚔️ 附表：两个世界的认知错位</h3>
<p>为了更清晰地展示这种冲突，我们可以用一张对比表来总结：</p>



































<table><thead><tr><th>维度</th><th>🏛️ CFTC (旧世界监管)</th><th>🗽 Polymarket (新世界代码)</th></tr></thead><tbody><tr><td>核心定义</td><td>非法场外衍生品 (Illegal Derivatives)</td><td>预测市场 / 信息公共产品 (Public Good)</td></tr><tr><td>监管逻辑</td><td>“大豆逻辑”：只有大宗商品才需要期货</td><td>“信息逻辑”：任何不确定性都应被定价</td></tr><tr><td>合规要求</td><td>必须持有 DCO/DCM 牌照</td><td>代码即法律 (Code is Law)</td></tr><tr><td>看待用户</td><td>需要被保护的“赌徒”</td><td>提供信息的“预言家”</td></tr><tr><td>终极目标</td><td>维护金融秩序稳定</td><td>发现并捍卫真相</td></tr></tbody></table>
<h2 data-id="heading-19">第五章：未来展望 —— 从预测选举到预测一切</h2>
<p>选举只是 Polymarket 的“特洛伊木马” <strong>。</strong> <strong>它用最受关注的政治话题吸引了全世界的目光，但它真正想植入人类社会的，是一种全新的</strong>认知方式。</p>
<p>当“价格即概率”的机制被验证有效后，我们可以把它复制粘贴到任何充满不确定性的领域。</p>
<h3 data-id="heading-20">1. 下一代新闻标准：告别“标题党”</h3>
<p>现在的新闻是廉价的。任何专家都可以张口就来：“我认为美联储下个月肯定降息。” 说错了也不用负责。</p>
<p>未来的新闻将是“长着牙齿”的。</p>
<ul>
<li><strong>嵌入式真相：</strong> 想象一下，当你浏览 Bloomberg 或《纽约时报》时，不再是看专栏作家的长篇大论，而是文章旁边挂着一个 Polymarket 的实时插件：</li>
</ul>
<blockquote>
<ul>
<li><strong>“美联储降息概率：72%”</strong></li>
</ul>
</blockquote>
<ul>
<li><strong>用钱投票：</strong> 所有的 pundit（评论员）都将被迫通过下注来证明自己的观点。新闻将从“观点的罗列”进化为“概率的加权”。</li>
<li><strong>结果：</strong> 噪音被过滤，只有那些敢拿真金白银冒险的信息，才会被视为高价值信号。</li>
</ul>
<h3 data-id="heading-21">2. 企业的“诚实血清”：消灭马屁精</h3>
<p>大公司最大的问题是信息传导失真。底层知道项目要完，中层却在报喜。
如果在公司内部开一个预测市场：“项目能在 12 月上线吗？”
CEO 不需要听汇报，看一眼价格（比如跌到了 $0.10）就知道出大事了。这是一种<strong>绕过科层制、直接提取底层真相</strong>的手段。</p>
<h3 data-id="heading-22">3. 科学与治理：Futarchy 的雏形</h3>
<p>这是最科幻、也最激进的愿景。经济学家 Robin Hanson 提出了 <strong>"Futarchy"</strong> （未来政体）的概念： <strong>“对价值投票，对信仰下注” (Vote on Values, Bet on Beliefs)。</strong></p>
<ul>
<li>
<p><strong>解决科学危机：</strong> 现在的学术界充满无法复现的垃圾论文。如果要求科学家在发表论文时，必须在预测市场买入“我的实验可复现”的合约，学术造假成本将无限拉高。</p>
</li>
<li>
<p><strong>政策制定：</strong> 政府不再争论“该不该实施 A 政策”，而是设立两个市场：</p>
<ul>
<li>“如果实施 A，一年后 GDP 是多少？”</li>
<li>“如果不实施 A，一年后 GDP 是多少？” 市场会给出最客观的预测，政策制定者只需选择那个预期 GDP 更高的选项。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-23">总结：从“赌场”到“认识论”</h3>
<p>Polymarket 的进化路径非常清晰：</p>





























<table><thead><tr><th>阶段</th><th>核心应用</th><th>价值主张</th><th>角色</th></tr></thead><tbody><tr><td>1.0 (现在)</td><td>美国大选、体育赛事</td><td>娱乐与投机</td><td>一个更公平的赌场</td></tr><tr><td>2.0 (中期)</td><td>宏观经济、突发新闻</td><td>信息发现</td><td>新闻媒体的“后端”</td></tr><tr><td>3.0 (终局)</td><td>企业决策、政策制定</td><td>资源配置</td><td>人类社会的“导航仪”</td></tr></tbody></table>
<p><strong>最后的结语：</strong> Polymarket 并不是在鼓励赌博。 它是在利用人类最原始的本能——<strong>贪婪</strong>，来提炼人类最稀缺的资源——<strong>真相</strong>。 在这个充满谎言的世界里，这或许是我们能找到的最诚实的镜子。</p>
<h2 data-id="heading-24">💡 总结</h2>
<p>从罗马斗兽场的嘶吼，到 Polymarket 安静跳动的订单薄，人类从未停止过对未来的窥探。</p>
<p>区别在于，以前我们靠祭司和水晶球，现在我们靠<strong>代码、博弈论和无数个贪婪的个体</strong>。</p>
<p>在这个充满噪音的世界里，Polymarket 告诉了我们一个朴素的真理： <strong>Talk is cheap. Show me your position.</strong> （废话少说，亮出你的仓位。）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上下文协议（MCP）Java SDK 指南]]></title>    <link>https://juejin.cn/post/7584432435590217782</link>    <guid>https://juejin.cn/post/7584432435590217782</guid>    <pubDate>2025-12-17T05:00:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584432435590217782" data-draft-id="7584356212801880105" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上下文协议（MCP）Java SDK 指南"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-17T05:00:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序猿DD"/> <meta itemprop="url" content="https://juejin.cn/user/131597123993358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上下文协议（MCP）Java SDK 指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123993358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序猿DD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T05:00:15.000Z" title="Wed Dec 17 2025 05:00:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    32
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当我们把各种内部系统、数据源、工具接入大语言模型时，往往会遇到一个尴尬的问题：每个团队、每套系统都有自己的一套“接入规范”。有的用 HTTP API，有的用消息队列，有的直接连数据库，最后一圈串下来，既难以统一治理，又很难在不同应用之间复用。这时，你可能会问：有没有一种通用的协议，既能让 AI 模型方便地调用外部工具、访问数据，又能让后端服务方用标准方式暴露能力？</p>
<p>Model Context Protocol（MCP）就是为此而生的标准之一，而本文要介绍的 Java SDK，则为 Java 开发者提供了一条直接接入 MCP 生态的通路。通过它，你可以用统一的模型，在 Java 应用里暴露工具、资源、提示模版，也可以轻松作为客户端去调用这些能力。本文将从整体架构讲起，一步步带你用一个可运行的示例，搭建起自己的 MCP 服务端与客户端。</p>
<h2 data-id="heading-0">1. 概览</h2>
<p>随着近年来 AI 的快速发展，越来越多的工具和系统开始与 AI 模型集成。但随之而来的一个挑战是：每种集成都可能采用完全不同的标准和方式，将外部工具、资源和系统接入到 AI 模型中。</p>
<p>Model Context Protocol（MCP）是一个开源标准，它定义了 AI 应用（如大语言模型、图像生成模型等）与工具、数据源以及其他资源之间的集成方式。借助 MCP，AI 应用可以按外部系统约定的方式访问数据、调用工具并执行工作流。</p>
<p>MCP 的 Java SDK 为开发者提供了一组库，支持多种协议和通信机制，用于把 Java 应用与 AI 应用连接起来。</p>
<p>在本教程中，我们将一起了解这个 SDK，并通过一个简单示例来体验 MCP 的使用方式。</p>
<h2 data-id="heading-1">2. 架构</h2>
<p>MCP 架构的核心组件主要包括：</p>
<ul>
<li><strong>MCP Host：负责管理多个 MCP Client</strong></li>
<li><strong>MCP Client：从 MCP Server 获取上下文，供 MCP Host 使用</strong></li>
<li><strong>MCP Server：向 MCP Client 提供上下文信息和可调用能力</strong></li>
</ul>
<p>MCP 将通信划分为两个概念层次：<strong>数据层（Data Layer），用于定义客户端与服务端的通信协议和生命周期管理</strong>；以及 <strong>传输层（Transport Layer），用于定义客户端和服务端之间的具体传输通道和机制</strong>。</p>
<p>Java 版的 MCP SDK 将这些概念映射为如下几个层次：</p>
<ul>
<li>Client/Server 层：通过 <code>McpClient</code> / <code>McpServer</code> 实现并管理客户端/服务端的具体操作</li>
<li>Session 层：通过 <code>McpSession</code> 管理通信模式和会话状态</li>
<li>Transport 层：通过 <code>McpTransport</code> 处理消息的序列化与反序列化</li>
</ul>
<p>客户端会调用 MCP 服务端暴露的一到多个工具（tool），而底层的通信则由传输层负责。</p>
<p>在 MCP 中，<strong>Primitive（原语）</strong> 是最基础的构建单元，用来定义可用的上下文信息类型以及可执行的操作范围。服务端和客户端都提供了一些原语。</p>
<p>服务端侧的原语包括工具（tools）、资源（resources）和提示模版（prompts）。<strong>工具是 AI 应用可以调用的可执行函数</strong>，例如查询数据库、文件操作等。<strong>资源是提供给客户端的上下文数据源</strong>，例如数据库结构、文件内容等。<strong>提示模版是可复用的模版，用于与语言模型进行交互</strong>。</p>
<p>客户端侧的原语则帮助 <code>McpServer</code> 的实现者构建更丰富的交互能力，包括采样（sampling）、信息补充（elicitation）和日志（logging）。<strong>采样允许服务端在不集成模型 SDK 的情况下，向客户端请求语言模型补全结果。</strong> <strong>信息补充让服务端能够向用户请求额外信息或确认操作。</strong> <strong>日志则允许服务端向客户端发送日志消息，用于调试和监控。</strong></p>
<h2 data-id="heading-2">3. 环境准备</h2>
<p>要使用 MCP Java SDK，我们需要在项目中加入 <code>mcp</code> 依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.modelcontextprotocol.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mcp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">3.1 定义一个 MCP 工具</h3>
<p>我们先通过 <code>LoggingTool</code> 这个类，定义一个非常简单的 MCP 工具，用来打印收到的提示词（prompt），该方法返回一个 <code>SyncToolSpecification</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingTool</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> McpServerFeatures.SyncToolSpecification <span class="hljs-title function_">logPromptTool</span><span class="hljs-params">()</span> {
        McpSchema.<span class="hljs-type">JsonSchema</span> <span class="hljs-variable">inputSchema</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JsonSchema(<span class="hljs-string">"object"</span>,
            Map.of(<span class="hljs-string">"prompt"</span>, String.class), List.of(<span class="hljs-string">"prompt"</span>), <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerFeatures</span>.SyncToolSpecification(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.Tool(
              <span class="hljs-string">"logPrompt"</span>, <span class="hljs-string">"Log Prompt"</span>,<span class="hljs-string">"Logs a provided prompt"</span>, inputSchema, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),
                (exchange, args) -&gt; {
                    <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> (String) args.get(<span class="hljs-string">"prompt"</span>);
                    <span class="hljs-keyword">return</span> McpSchema.CallToolResult.builder()
                      .content(List.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.TextContent(<span class="hljs-string">"Input Prompt: "</span> + prompt)))
                      .isError(<span class="hljs-literal">false</span>)
                      .build();
                });
    }
}
</code></pre>
<p>这里我们首先定义了输入的 JSON Schema，用来为用户输入建立一个清晰的契约。接着，使用该输入 Schema 来实例化一个 <code>Tool</code>，在处理逻辑中提取出 <code>prompt</code> 参数，并最终返回包含该 <code>prompt</code> 的 <code>TextContent</code> 结果。</p>
<h2 data-id="heading-4">4. MCP 客户端与服务端搭建</h2>
<p>接下来，我们需要一个 MCP 服务端来暴露自定义工具，以及一个或多个 MCP 客户端，用于连接该服务端并调用其中的工具。</p>
<h3 data-id="heading-5">4.1 MCP 服务端实现</h3>
<p><code>McpServer</code> 具有一组能力（capabilities），用来告知客户端当前服务器支持哪些类别的协议操作，例如日志记录、提示词补全、资源访问等。此外，工具（tools）则提供给客户端可调用的具体函数。</p>
<p>先来看一个 <code>McpServer</code> 的实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpServerApp</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> McpSyncServer <span class="hljs-title function_">createServer</span><span class="hljs-params">()</span> {
        <span class="hljs-type">JacksonMcpJsonMapper</span> <span class="hljs-variable">jsonMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonMcpJsonMapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>());
        <span class="hljs-type">StdioServerTransportProvider</span> <span class="hljs-variable">transportProvider</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransportProvider</span>(
            jsonMapper);

        <span class="hljs-keyword">return</span> McpServer.sync(transportProvider)
          .serverInfo(<span class="hljs-string">"baeldung-demo-server"</span>, <span class="hljs-string">"0.0.1"</span>)
          .capabilities(McpSchema.ServerCapabilities.builder()
            .tools(<span class="hljs-literal">true</span>)
            .logging()
            .build())
          .tools(LoggingTool.logPromptTool())
          .build();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        createServer();
    }
}
</code></pre>
<p>上面代码定义了一个同步的 <code>McpServer</code>，通过标准输入/输出流并使用 JSON 消息格式进行通信。随后我们声明了服务器的能力：开启工具以及日志功能（基于 SLF4J 日志框架），最后把自定义的 <code>logPromptTool</code> 注册到服务器上。</p>
<h3 data-id="heading-6">4.3 MCP 客户端实现</h3>
<p>下面再定义一个简单的 <code>McpClient</code>，用于连接到服务端：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientApp</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> McpSyncClient <span class="hljs-title function_">getClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ServerParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> ServerParameters
          .builder(<span class="hljs-string">"npx"</span>)
          .args(<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@modelcontextprotocol/server-everything"</span>)
          .build();

        <span class="hljs-type">JacksonMcpJsonMapper</span> <span class="hljs-variable">jsonMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonMcpJsonMapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>());
        <span class="hljs-type">McpClientTransport</span> <span class="hljs-variable">transport</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioClientTransport</span>(params, jsonMapper);

        <span class="hljs-keyword">return</span> io.modelcontextprotocol.client.McpClient.sync(transport)
         .build();

    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">McpSyncClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> getClient();
        client.initialize();
    }
}
</code></pre>
<p>这里我们使用 MCP 提供的示例服务端，并通过 <code>ServerParameters</code> 进行配置。客户端同样通过标准输入/输出流以及 JSON 消息格式与服务端进行同步通信。</p>
<h2 data-id="heading-7">5. 测试</h2>
<p>到目前为止，我们已经具备了测试 MCP 交互和核心概念所需的全部组件。</p>
<h3 data-id="heading-8">5.1 测试 MCP 工具与客户端实现</h3>
<p>我们先从测试 <code>LoggingTool</code> 开始，验证其输出是否正确：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">whenLogPromptToolCalled_thenReturnsResult</span><span class="hljs-params">()</span> {
    McpSchema.<span class="hljs-type">CallToolRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.CallToolRequest(<span class="hljs-string">""</span>,
        Map.of(<span class="hljs-string">"prompt"</span>, <span class="hljs-string">"Unit test message"</span>));

    McpServerFeatures.<span class="hljs-type">SyncToolSpecification</span> <span class="hljs-variable">toolSpec</span> <span class="hljs-operator">=</span> LoggingTool.logPromptTool();
    McpSchema.<span class="hljs-type">CallToolResult</span> <span class="hljs-variable">result</span> 
        <span class="hljs-operator">=</span> toolSpec.callHandler().apply(<span class="hljs-literal">null</span>, request);
    assertNotNull(result);
    assertFalse(result.isError());
    assertEquals(
        <span class="hljs-string">"Input Prompt: Unit test message"</span>,((McpSchema.TextContent) (result.content()
        .getFirst()))
        .text());
}
</code></pre>
<p>在这个测试中，我们创建了一个带有 <code>prompt</code> 的 <code>CallToolRequest</code>，并将其传递给 <code>LoggingTool</code> 的 <code>SyncToolSpecification</code>。随后，我们断言返回结果非空、无错误，并且返回的文本内容与预期相同。</p>
<p>接下来，我们再通过 MCP 提供的示例服务端来测试 <code>McpClient</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">whenCalledViaClient_thenReturnsLoggedResult</span><span class="hljs-params">()</span> {
    McpSchema.<span class="hljs-type">CallToolRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.CallToolRequest(
        <span class="hljs-string">"echo"</span>, Map.of(<span class="hljs-string">"message"</span>, <span class="hljs-string">"Client-server test message"</span>));
    McpSchema.<span class="hljs-type">CallToolResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> client.callTool(request);

    assertNotNull(result);
    assertNull(result.isError());
    assertEquals(<span class="hljs-string">"Echo: Client-server test message"</span>,
        ((McpSchema.TextContent) (result.content()
        .getFirst())).text());
}
</code></pre>
<p>MCP 示例服务端暴露了一个名为 <code>echo</code> 的工具，它会把输入消息原样返回，这与我们之前实现的 <code>LoggingTool</code> 的行为类似。</p>
<h3 data-id="heading-9">5.2 测试本地服务端</h3>
<p>最后，我们来测试自己编写的本地服务端。为此需要定义一个单独的 <code>McpClient</code>，并使用指向本地 JAR 的不同服务端参数：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientApp2</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(McpClientApp2.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">jarPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">"java-mcp/target/java-mcp-1.0.0-SNAPSHOT.jar"</span>)
                             .getAbsolutePath();
        <span class="hljs-type">ServerParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> ServerParameters.builder(<span class="hljs-string">"java"</span>)
            .args(<span class="hljs-string">"-jar"</span>, jarPath)
            .build();

        <span class="hljs-type">JacksonMcpJsonMapper</span> <span class="hljs-variable">jsonMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonMcpJsonMapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>());
        <span class="hljs-type">McpClientTransport</span> <span class="hljs-variable">transport</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioClientTransport</span>(params, jsonMapper);

        <span class="hljs-type">McpSyncClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> McpClient.sync(transport)
            .build();

        client.initialize();

        <span class="hljs-type">ListToolsResult</span> <span class="hljs-variable">tools</span> <span class="hljs-operator">=</span> client.listTools();
        McpClientApp2.log.info(<span class="hljs-string">"Tools exposed by the server:"</span>);
        tools
          .tools()
          .forEach(tool -&gt; System.out.println(<span class="hljs-string">" - "</span> + tool.name()));

        McpClientApp2.log.info(<span class="hljs-string">"\nCalling 'logPrompt' tool..."</span>);
        <span class="hljs-type">CallToolResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> client.callTool(
          <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallToolRequest</span>(<span class="hljs-string">"logPrompt"</span>, Map.of(<span class="hljs-string">"prompt"</span>, <span class="hljs-string">"Hello from MCP client!"</span>)));
        McpClientApp2.log.info(<span class="hljs-string">"Result: "</span> + result.content());

        client.closeGracefully();
    }
}
</code></pre>
<p>运行该客户端后，我们可以通过日志来验证它是否成功连接到了本地 JAR 中定义的服务端：</p>
<pre><code class="hljs language-text" lang="text">14:04:27.879 [boundedElastic-1] INFO  i.m.c.transport.StdioClientTransport - MCP server starting.
14:04:27.920 [boundedElastic-1] INFO  i.m.c.transport.StdioClientTransport - MCP server started
14:04:28.517 [pool-4-thread-1] INFO  i.m.c.transport.StdioClientTransport - STDERR Message received: 14:04:28.504 [pool-1-thread-1] INFO  i.m.server.McpAsyncServer - Client initialize request - Protocol: 2024-11-05, Capabilities: ClientCapabilities[experimental=null, roots=null, sampling=null, elicitation=null], Info: Implementation[name=Java SDK MCP Client, title=null, version=0.15.0]
14:04:28.575 [pool-1-thread-1] INFO  i.m.client.LifecycleInitializer - Server response with Protocol: 2024-11-05, Capabilities: ServerCapabilities[completions=null, experimental=null, logging=LoggingCapabilities[], prompts=null, resources=null, tools=ToolCapabilities[listChanged=true]], Info: Implementation[name=baeldung-demo-server, title=null, version=0.0.1] and Instructions null
14:04:28.626 [main] INFO  mcp.McpClientApp2 - Tools exposed by the server:
14:04:28.626 [main] INFO  mcp.McpClientApp2 - 
Calling 'logPrompt' tool...
 - logPrompt
14:04:28.671 [main] INFO  mcp.McpClientApp2 - Result: [TextContent[annotations=null, text=Input Prompt: Hello from MCP client!, meta=null]]
14:04:28.784 [ForkJoinPool.commonPool-worker-1] WARN  i.m.c.transport.StdioClientTransport - Process terminated with code 143

Process finished with exit code 0
</code></pre>
<p>从日志可以看到，首先 <code>McpServer</code> 启动成功，随后客户端完成初始化并与服务端</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[消息队列从入门到跑路，保姆级教程！傻子可懂]]></title>    <link>https://juejin.cn/post/7584475608221286451</link>    <guid>https://juejin.cn/post/7584475608221286451</guid>    <pubDate>2025-12-17T09:40:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584475608221286451" data-draft-id="7584496207705571379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="消息队列从入门到跑路，保姆级教程！傻子可懂"/> <meta itemprop="keywords" content="程序员,数据库,消息队列"/> <meta itemprop="datePublished" content="2025-12-17T09:40:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员鱼皮"/> <meta itemprop="url" content="https://juejin.cn/user/2444938365386621"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            消息队列从入门到跑路，保姆级教程！傻子可懂
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2444938365386621/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员鱼皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:40:36.000Z" title="Wed Dec 17 2025 09:40:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是小阿巴，刚刚为电商系统的双 11 大促开发了秒杀抢购功能。</p>
<p>0 点秒杀开始，每秒上万个用户同时点击抢购按钮，你的数据库瞬间被打垮！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d83b960ad534e648258e7e78ba7732f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=CN9FR7sGb1X%2BvT%2B0UMOujht1PuI%3D" alt="" loading="lazy"/></p>
<p>你急得满头大汗，只能找到 “后端之狗” 鱼皮求助：阿巴阿巴……</p>
<p>鱼皮看了看你的代码：用户每次抢购，你的代码都要同步处理校验库存、扣减库存并创建订单等多个操作。同时抢购的用户多了，系统就会压力山大。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb2e4b5feb2c4e34bd15df939407193a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=NC0BKJMjRXVqO6be2m%2Bkok3zsKo%3D" alt="" loading="lazy"/></p>
<p>你急了：那咋办啊？我总不能拒绝用户吧！</p>
<p>鱼皮嘿嘿一笑：可以用消息队列呀。</p>
<p>你一脸懵：消息队列？那是啥？</p>
<p>⭐️ 推荐观看视频讲解，更通俗易懂：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbilibili.com%2Fvideo%2FBV12qmyBQEwL" target="_blank" title="https://bilibili.com/video/BV12qmyBQEwL" ref="nofollow noopener noreferrer">bilibili.com/video/BV12q…</a></p>
<h2 data-id="heading-0">第一阶段：认识消息队列</h2>
<p>鱼皮：消息队列（俗称 MQ）就像一个快递驿站。快递员作为 <strong>生产者</strong>，把包裹（消息）放到驿站（消息队列），收件人作为 <strong>消费者</strong>，自己到驿站去取。</p>
<p>这样一来，快递员放下包裹就能走，不用费时间等你签收（异步）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b70f35d11d4e436f8be32586460329fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=U0N4oYJo17A%2BzDFOjmpXVeT4D%2BY%3D" alt="" loading="lazy"/></p>
<p>你也不用关心是谁送的、不用和快递员见面，有空去驿站取就行（解耦）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d92f62d064d4fbaaf7a78ea60666a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=NNZfx6MMjh%2FUggww6bjNjzKwspc%3D" alt="" loading="lazy"/></p>
<p>就算双 11 包裹很多，驿站也能暂存起来等消费者慢慢取（削峰）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a95c9d5c6254bdaa313b64313f5681c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=rinqbkcjBOkz9%2Fya4D02vZSpdkc%3D" alt="" loading="lazy"/></p>
<p>这就是消息队列的三大作用：<strong>异步、解耦和削峰。</strong></p>
<p>对于你的秒杀抢购系统，现在用户每次抢购都要同步执行各种操作（校验库存、扣减库存、创建订单），全部完成才能返回结果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cee0f39773b48c5a5269ff36e25bd89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=3KZjVfJzsZYO3NpVtwVVtJonjKk%3D" alt="" loading="lazy"/></p>
<p>如果使用消息队列，用户点击抢购后，系统先做基本的校验并在缓存中预扣库存，确认可以抢购后，把抢购请求（消息）投入消息队列，就可以立刻返回结果了（页面）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc3aaf5423b7457c82b6332c7fd74cae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=iKXJWnQiKZ9fAhBbeTaSJfjdW%2Bk%3D" alt="" loading="lazy"/></p>
<p>接下来由后台服务从队列中取出消息并处理那些耗时的操作，比如创建订单、在数据库中真正扣减库存。</p>
<p>这就是 <strong>异步</strong>：用户不用等所有后端操作完成，就能快速得到响应。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/032d26fb4e6e49b9a419d1bf582e19a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=PD0j5X%2FhhnjaJ23CABDxtbdpE3M%3D" alt="" loading="lazy"/></p>
<p>而且，抢购服务只管发消息，不用关心是谁来处理库存、谁来创建订单。假如以后要加短信通知、用户行为分析等功能，只需要让新服务也去监听消息队列就行，完全不用修改抢购服务的代码。</p>
<p>这就是 <strong>解耦</strong>：服务之间不直接依赖，让系统能灵活扩展。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea4655019b974a27951bdf1b8e686982~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=rC7WsFtQGzQCxCcN7qTnO46jVQQ%3D" alt="" loading="lazy"/></p>
<p>如果同时抢购的用户过多，数据库处理不过来，也可以用消息队列做缓冲。所有的抢购请求先快速存入队列，后台服务可以根据自己的能力从队列中慢慢拉取消息并进行处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/655fd10b41884df1b8802600cc0d215a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=X3RQZhIx7SxHgkTCXjKf4qV2Kdc%3D" alt="" loading="lazy"/></p>
<p>这就是 <strong>削峰</strong>：削平流量洪峰，保护后端系统不被压垮。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dba9ea643524976a9b3f1a6d4025a56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=4nW73oSXZJw01tF6C9ZUIA1Z6pI%3D" alt="" loading="lazy"/></p>
<p>你恍然大悟：原来如此，消息队列也太强大了吧！俺要学，俺要学！</p>
<p>鱼皮：很有干劲嘛！主流的消息队列实现技术有：</p>
<ul>
<li>RabbitMQ：简单易学、生态活跃，适合中小规模应用</li>
<li>Kafka：吞吐量高、延迟极低，适合大数据、日志收集场景</li>
<li>RocketMQ：阿里出品、支持事务消息，适合电商金融等对可靠性要求高的场景</li>
</ul>
<p>你：阿巴阿巴，这么多都要学吗？</p>
<p>鱼皮：新手建议从 RabbitMQ 开始入门，学好一个再学其他的就很简单了。下面我就以 RabbitMQ 为例带你快速掌握消息队列必知必会的技术。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e935a2da4c94b90b81ec3fed641f126~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=8UPQMAV8LyueVT5jo29rNJs%2Fr6E%3D" alt="" loading="lazy"/></p>
<p>你：期待住了，这不得点赞狠狠支持？！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a249f5c7e9164e5f8e60facab45169b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=tBiLK7ALUana2s8O0U43FMzRvAs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">第二阶段：RabbitMQ 快速上手</h2>
<p>鱼皮：首先来安装 RabbitMQ，笨办法是先安装 Erlang 语言环境，再去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frabbitmq%2Frabbitmq-server%2Freleases" target="_blank" title="https://github.com/rabbitmq/rabbitmq-server/releases" ref="nofollow noopener noreferrer">官网下载</a> MQ 的安装包并执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62fbe400abf24dc58b509237a1079370~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=Gptka9EErJfooMimMjdkExuFmTI%3D" alt="" loading="lazy"/></p>
<p>但是更建议直接用 Docker 容器技术，快速安装和运行，不用担心版本不兼容。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf92e502e3214d6798f51d45749d5d63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=HE%2BlB7B5AtIKgmxn0Oxi6XnOkkk%3D" alt="" loading="lazy"/></p>
<p>安装完之后，访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A15672%2F" target="_blank" title="http://localhost:15672/" ref="nofollow noopener noreferrer">http://localhost:15672</a> 就可以打开 RabbitMQ 内置的可视化管理界面（默认用户名和密码都是 guest），你可以在这里查看队列的运行情况、手动发送和接收消息。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/962e3c6c80cc43aeb2590957fa28c840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=2ek98EbeZaVhYh5vhpm8BSiFvjo%3D" alt="" loading="lazy"/></p>
<p>另外，RabbitMQ 也提供了命令行工具 rabbitmqctl，主要用于运维管理，比如创建用户、查看状态等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb8404ec88674ce6a2156d6eb8f974fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=O1M%2FRskz4yWrQwiaZq40jm8aZhg%3D" alt="" loading="lazy"/></p>
<p>你：那我怎么用代码操作 RabbitMQ 呢？</p>
<p>鱼皮：RabbitMQ 提供了各种编程语言的 SDK 开发包，如果你是 Java 开发者，推荐使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rabbitmq.com%2Ftutorials%2Ftutorial-one-spring-amqp" target="_blank" title="https://www.rabbitmq.com/tutorials/tutorial-one-spring-amqp" ref="nofollow noopener noreferrer">Spring AMQP</a>。</p>
<blockquote>
<p>AMQP 是高级消息队列协议（Advanced Message Queuing Protocol）的缩写，是一个开放标准，不绑定特定技术。RabbitMQ 就是基于 AMQP 实现的，所以客户端库叫 Spring AMQP。</p>
</blockquote>
<p>只需几行代码，就能创建队列、让生产者发送消息、让消费者接收处理消息：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/432893c923ee4b6089ef71fe6ad9c301~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=M6PcpR71kZNV5VMdoTAaqRzVvzE%3D" alt="" loading="lazy"/></p>
<p>你：不是吧，这么简单？！</p>
<p>鱼皮：没错，但刚刚我们只是完成了最简单的 1 对 1 发送和接收消息。</p>
<p>实际上 RabbitMQ 有 6 种工作模式，适用于不同的业务场景，这也是消息队列的学习重点。</p>
<h2 data-id="heading-2">第三阶段：RabbitMQ 工作模式</h2>
<h4 data-id="heading-3">简单模式</h4>
<p>最简单的是 <strong>Simple 模式</strong>，一个生产者、一个队列、一个消费者。</p>
<p>就像老板派发任务给员工，<strong>队列（Queue）</strong> 是存储任务的容器，老板把任务放进去，员工从里面取出来完成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99cec74bc571400dbd5dc5a13693b6f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=scfF7HvcRPIWM0E2YQZKCF1XHjk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">工作队列模式</h4>
<p>鱼皮：如果有很多任务要处理，一个员工忙不过来怎么办？</p>
<p>你：多找几个员工帮忙？</p>
<p>鱼皮：没错，这就是 <strong>Work Queue 工作队列模式</strong>，一个生产者、一个队列、多个消费者。</p>
<p>就像老板发布了一堆任务，RabbitMQ 会把任务依次分配给员工，但是一个任务只会被一个员工完成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/473b784a41c84d8bba6da85a79932027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=0SlEkzpkl3sYGRs1Lt6dC3xzA%2Fs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">发布订阅模式</h4>
<p>你：这样效率就高多了！</p>
<p>但如果老板要求所有员工都写工作总结，怎么把同样的任务发给多个员工呢？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c62993b2cb3f498ebefd14e069d60d7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=MMHmYe9WBxpwk2HmYnRhhPFNgQ8%3D" alt="" loading="lazy"/></p>
<p>鱼皮：好问题！之前工作队列是多个员工共享一个任务列表，而现在每个员工都要有自己的任务队列。</p>
<p>老板需要利用 <strong>交换机（Exchange）</strong> 来控制把任务分发给哪些和它绑定的队列。</p>
<p>比如想把任务发给所有员工，就要用到 <strong>广播交换机（Fanout Exchange）</strong> ，它会把任务发给所有已绑定的队列，然后每个员工分别从自己的队列取任务并完成。这就是 <strong>发布订阅模式（Publish/Subscribe）</strong> 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab778517044499ea8ea16fb28c1d217~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=XFzb07nrDCFPCJkUZXuPC0qdXyk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">路由模式</h4>
<p>你：那如果老板想把某些任务发给特定员工呢？比如鱼皮负责写代码和修 Bug，小阿巴负责写代码和摸鱼~</p>
<p>鱼皮：可以使用 <strong>路由模式（Routing）</strong> ，给每个员工的队列设置自己负责的路由键（Routing Key）：</p>
<ul>
<li>鱼皮的队列绑定 “写代码” 和 “修 Bug”</li>
<li>小阿巴的队列绑定 “写代码” 和 “摸鱼”</li>
</ul>
<p>老板发布任务时会指定路由键，由 <strong>直接交换机（Direct Exchange）</strong> 根据路由键精确匹配，把任务发给对应的队列。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62ee59fd705041278bd80174bb99767b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=7aE2uRr1PBcwkWZAW1WYDIKS8dQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">主题模式</h4>
<p>你：那如果老板想把所有前端相关的任务都发给前端员工，后端相关的任务都发给后端员工呢？一个一个指定路由键是不是太麻烦了？</p>
<p>鱼皮：可以使用 <strong>主题模式（Topic）</strong> ，它使用 <strong>主题交换机（Topic Exchange）</strong> ，支持使用通配符模糊匹配。</p>
<p>可以给队列绑定通配符路由键，就能接收所有匹配的任务：</p>
<ul>
<li>前端员工的队列绑定 <code>frontend.*</code>（匹配 1 个词），能匹配 <code>frontend.Vue</code>、<code>frontend.React</code></li>
<li>后端员工的队列绑定 <code>backend.#</code>（匹配多个词），能匹配 <code>backend</code>、<code>backend.Java</code>、<code>backend.Java.优化</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a5d309746ed4c24a7da5c02c74b785f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=5Aqgz4rFMW%2FX7Pv5HSgBy%2FTr4QE%3D" alt="" loading="lazy"/></p>
<p>你：哇，这样一来就灵活多了！</p>
<p>鱼皮：没错，这 5 种模式是企业中最常用的，掌握了它们就能应对大部分场景了。至于最后一种模式 —— RPC（远程过程调用）模式，暂时不需要了解，因为企业开发中一般用专门的 RPC 框架，比如 gRPC、Dubbo。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4130e2ee186d433caecbbe695ad1acc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=7ymmMFrXZjwzlvYlucTS%2Bv29oUc%3D" alt="" loading="lazy"/></p>
<p>你：好嘞，我先用这些工作模式来重构秒杀抢购功能，请好吧您嘞！</p>
<h2 data-id="heading-8">第四阶段：消息队列生产实践</h2>
<p>一个月后，你意气风发地找到鱼皮：鱼皮 gie，我的抢购代码重构完了，快帮我看看能不能上线~</p>
<p>鱼皮看着你的代码，表情难受得像持矢一样：emmm，你这代码要是上线，公司就完蛋了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e2f47d5ef4f442c9a7a58f8ca973a72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=LZ%2Bc8acL5HywJ65zu5rotsesv14%3D" alt="" loading="lazy"/></p>
<p>你：阿巴阿巴，我本地测试过了，完全没问题啊！</p>
<p>鱼皮：消息队列在生产环境中的坑可多着呢！下面我来问你几个问题。</p>
<h4 data-id="heading-9">第一问：消息会丢吗？</h4>
<p>鱼皮：如果重启 RabbitMQ 服务器，队列里的消息会丢吗？</p>
<p>你支支吾吾：会……会丢吧？</p>
<p>鱼皮：当然会！在抢购系统中，如果消息丢了，订单永远不会被创建，用户那边会一直显示 “抢购中”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c48c6b7ed846ce84f7ab99e376081f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=ngxesdTv1jCFjq5y5fEfz0cTjMA%3D" alt="" loading="lazy"/></p>
<p>你着急了：那咋办啊，我会吃投诉的！</p>
<p>鱼皮：要保证消息不丢失，需要做好持久化 3 件套，把数据从内存保存到硬盘：</p>
<ul>
<li>队列持久化，创建队列时设置 durable 为 true。</li>
<li>消息持久化，发送消息时设置消息为持久化模式（比如 deliveryMode = 2 或 persistent = true）</li>
<li>交换机持久化，创建交换机时设置 durable 为 true。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0177132bf8624faa84bf60b20c6b8609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=HotkO0B50aDPM9VI6V%2B8u0ui404%3D" alt="" loading="lazy"/></p>
<p>你：哈哈，这下消息就不会丢了吧！</p>
<p>鱼皮：不一定！光持久化还不够，还要有消息确认机制来保证消息的可靠性。</p>
<p>1）生产者确认（Publisher Confirm）：生产者发送消息后，等待 RabbitMQ 的确认回复，确保消息真的被接收了。就像寄快递，你把包裹交给快递员，快递员要给你一个回执单，证明他收到了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a9a0fe56d4547dca8111b4d601d0540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=3chwxXNZ7iuhA3sb%2FLU%2BCN%2B5Tic%3D" alt="" loading="lazy"/></p>
<p>2）消费者确认（Consumer ACK）：消费者处理消息成功后，要手动告诉 RabbitMQ “我处理完了，你可以删了”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4706aa177c7a419da4a84d0abeef8818~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=CFt2EtCXs%2B8IJQ2rdW2Ao7StndM%3D" alt="" loading="lazy"/></p>
<p>千万别用默认的自动确认，那样消息一收到就删除，万一处理失败消息就丢了。就像收快递要签收，确保包裹真的送到你手上了。</p>
<p>鱼皮：这样从生产到消费的整个链路都有保障，消息就不会丢失了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b542a3d5f83849b882b0e9b62efc683f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=J%2BOYavttFCxPch%2BC9%2B7HW%2BlUjgs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">第二问：消息会重复吗？</h4>
<p>鱼皮：如果网络抖动，或者消费者重启，同一条消息可能被消费多次。比如抢购消息被重复消费，同一个用户的订单被创建了 2 次，库存被扣了 2 次怎么办？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c7b019bda7a429c900cb6a1f744acbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=dQa4vhDShWJUt%2BM4HpwrcteIYws%3D" alt="" loading="lazy"/></p>
<p>你：那我得跑路了！</p>
<p>鱼皮：不至于不至于，我们要保证 <strong>消息幂等性</strong>，让重复消费等同于只消费一次。</p>
<p>常见的方案有 3 种：</p>
<p>1）给每条消息一个唯一 ID（比如 UUID 或雪花算法 ID），消费前先检查这个 ID 是否处理过。</p>
<p>2）利用数据库唯一索引，比如订单号设置为唯一索引，重复插入会失败。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f962438067e1412eb3be9c308ae626a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=toV53ItYKYRgWWHS7Oya9xNEDx8%3D" alt="" loading="lazy"/></p>
<p>3）使用 Redis 分布式锁，同一条消息同一时间只能有一个消费者处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/761d608e378a4301aa7bc586e59d1b73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=WwJP%2FUjqSv%2BFTWB80B7uii76JQ0%3D" alt="" loading="lazy"/></p>
<p>你：明白了！抢购时为了防止重复下单，要检查用户是否已经下过单了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/384d1121ca8745c28f6c51f375b040d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=zbisiJ3%2Frb%2BERJABJXr3Tuc3OI4%3D" alt="" loading="lazy"/></p>
<p>鱼皮点头：没错，幂等性设计是分布式系统的基本功。</p>
<h4 data-id="heading-11">第三问：消息乱序怎么办？</h4>
<p>鱼皮：比如用户先抢购下单、然后取消订单，分别向队列发了 “创建订单” 和 “取消订单” 2 条消息。如果处理顺序乱了，系统先处理取消、后处理创建，订单状态就错了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b24e99402b604a60ab55fc7c039d0ddf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=aBtJshe%2BwpvCq6HrWDL9F5ZPcQM%3D" alt="" loading="lazy"/></p>
<p>你：队列不是先进先出的吗？RabbitMQ 应该天然有序吧？</p>
<p>鱼皮：单队列内确实有序，但如果你开了多个消费者并发处理，可能消息 1 还在处理，消息 2 已经处理完了，顺序就乱了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/237a070ef7634f0fa9bc196acaa2d625~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=6FOtsF%2Bzt%2BY%2BgQLXFmjznXT766Y%3D" alt="" loading="lazy"/></p>
<p>你：那怎么保证顺序呢？</p>
<p>鱼皮：在 RabbitMQ 中，要严格保证顺序，建议用 <strong>单队列 + 单消费者</strong>。</p>
<p>你：那性能不就很低了吗？</p>
<p>鱼皮：没错，所以要根据业务需求权衡一致性和性能。</p>
<p>如果你全都要，可以考虑 Kafka 的分区机制，可以将同一用户的消息路由到同一个分区，同一个分区内的消息严格有序，不同用户的消息又可以并发处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cc469323241497589fd4e011e5f27f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=JXPCDp98kSmPccVXDgjOW5JFAWs%3D" alt="" loading="lazy"/></p>
<p>你：妙啊，又学到一个架构知识！</p>
<h4 data-id="heading-12">第四问：消息处理失败怎么办？</h4>
<p>鱼皮：如果消费者处理消息时出错了，比如数据库连接失败、业务逻辑异常，怎么办呢？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66782767ff5a41a187bac3f0bc36d945~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=C7dWHFNfcGc%2BQH%2FPt5c3Abb96tU%3D" alt="" loading="lazy"/></p>
<p>你：重试？</p>
<p>鱼皮：重试几次还是失败呢？</p>
<p>你：阿巴阿巴，直接删掉消息？</p>
<p>鱼皮：删掉不就丢了吗？！这时应该要用死信队列（Dead Letter Queue）。</p>
<p>3 种情况会产生死信：</p>
<ol start="0">
<li>消息被消费者拒绝（reject 或 nack，requeue 参数设置为 false）</li>
<li>消息过期</li>
<li>队列满了</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0bff0f946734deba098bd3b0f1840bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=GlKW0dBJla01PJ%2B%2Fd7aqX6zpqVk%3D" alt="" loading="lazy"/></p>
<p>你：呜呜呜，这些死信好可怜。</p>
<p>鱼皮：没错，我们要给死信一个去处。可以配置死信交换机（DLX），将死信自动路由到死信队列。由专门的消费者监控死信队列，发现死信后，可以重试、告警、或者人工处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5b52dc213cf4a37a92a58e314135909~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=9hSvz%2BqM%2FiVoMJu4BD7gJHZz%2Bec%3D" alt="" loading="lazy"/></p>
<p>你：好耶，这样异常消息就不会丢失啦！</p>
<h4 data-id="heading-13">第五问：RabbitMQ 服务挂了怎么办？</h4>
<p>鱼皮：前面说了这么多保证消息不丢的机制，但如果 RabbitMQ 服务本身挂了，整个系统就不能收发消息了，这可是大事故！</p>
<p>你汗流浃背了：那怎么办？</p>
<p>这时，练习两年的实习生阿坤突然鸡叫起来：我知道，要搭建集群和高可用架构！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a82032bacf046a18ea8c33474393d60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=uMBSYnYHeq2NgQ7nUsTYItGenYI%3D" alt="" loading="lazy"/></p>
<p>生产环境至少要搭建 3 个 RabbitMQ 节点的集群。</p>
<p>对于重要的队列，要使用 <strong>Quorum 仲裁队列</strong>，它基于 Raft 协议实现，会把数据自动同步到多个节点，保证数据一致性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdbfd09c65d940a48d1ac3feb4d2a16c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=d%2Fd4s70hsD1brFDAdaUHw8H9x5k%3D" alt="" loading="lazy"/></p>
<p>如果主节点挂了，Raft 会自动选举新的主节点，实现故障转移，用户毫无感知。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dd1f1ca83394e188a2a278ee7636184~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=yxrU4foL9LWr3Uu4wCoDXQbaLWA%3D" alt="" loading="lazy"/></p>
<p>如果数据量太大，单个队列存不下，可以使用 Sharding 插件创建 <strong>分片队列</strong>，把消息分散到多个节点。不过 RabbitMQ 并不擅长这个场景，建议使用 Kafka。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/901f8372eb544fafb9aba8282d35e319~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=PzlZ%2BxjIttsPT9F%2B%2FznObZDPebE%3D" alt="" loading="lazy"/></p>
<p>鱼皮拍了拍阿坤的肩膀：不错！生产环境的高可用是非常重要的。</p>
<p>此外，RabbitMQ 还有一些高级特性，在特定场景下很有用。</p>
<h4 data-id="heading-14">RabbitMQ 高级特性</h4>
<p>1）延迟队列</p>
<p>比如想要自动取消超过 15 分钟还未支付的订单，可以用死信队列配合生存时间（TTL）实现。发消息时设置 TTL 为 15 分钟，等它过期变成死信，自动进入死信队列，然后让死信队列的消费者处理取消逻辑。但是更推荐使用专门的延迟插件 <code>rabbitmq_delayed_message_exchange</code>。</p>
<p>2）优先级队列</p>
<p>比如想优先处理 VIP 用户的订单，可以设置队列的最大优先级（x-max-priority），然后在发送消息时指定优先级，优先级高的消息会被优先消费。</p>
<p>3）Stream 流式存储</p>
<p>传统队列消息消费后就删除了，而 Stream 可以保留历史消息、重复消费、回溯历史，类似 Kafka，适用于实时数据分析、审计日志等场景。但我建议了解即可，不如用 Kafka。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9a41af61f114b82b0d6992a44a894c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=QF5YqGOXJihhHzOlkSj8JviSrik%3D" alt="" loading="lazy"/></p>
<p>你羞愧地低下了头：我以为自己已经掌握了 RabbitMQ，原来只是学了个皮毛...</p>
<h2 data-id="heading-15">第五阶段：深入原理</h2>
<p>被鱼皮连环拷问后，你主动找到阿坤：坤哥你好强，我想深入学习 RabbitMQ 底层原理，请问你是咋学的啊？</p>
<p>阿坤有些惊讶：咦？你不背八股文的么？<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshiya.com%2F" target="_blank" title="https://www.mianshiya.com/" ref="nofollow noopener noreferrer">刷刷题</a> 就好了呀！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d6765f3c3f3442a8a421671f5b39d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=SzMyLYzRB4toG5XQorooqEwEPJc%3D" alt="" loading="lazy"/></p>
<p>你震惊了：现在的校招生，竟然恐怖如斯！</p>
<p>鱼皮：阿坤你别逗他了，其实可以带着问题学习，重点探索 RabbitMQ 的消息路由机制、队列存储结构、AMQP 协议和消息持久化的实现。</p>
<p>比如：</p>
<ol start="0">
<li>消息路由机制：Exchange 用什么算法匹配？Binding 如何存储？</li>
<li>队列存储结构：消息在内存还是磁盘？不同队列类型有什么区别？</li>
<li>AMQP 协议：客户端和服务端怎么通信？数据格式是什么样的？</li>
<li>持久化实现：数据怎么写入磁盘？如何保证不丢失？</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b679d82ad3f9460c9be50f18a64e6eeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=XjS7L7gbu9MwEIciLFkfUWxxHh4%3D" alt="" loading="lazy"/></p>
<p>你好奇：那要怎么学习这些原理呢？</p>
<p>鱼皮：从这些问题出发，去阅读相关的文章，推荐官方文档和官方博客。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d8cad182f4d46a6b2e90b25fa6d99ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=PrNLS6Ht4XpM%2BQKtafciBhSyfsY%3D" alt="" loading="lazy"/></p>
<p>或者像阿坤说的刷一刷 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshiya.com%2F" target="_blank" title="https://www.mianshiya.com/" ref="nofollow noopener noreferrer">RabbitMQ 面试题</a>，就能快速学会很多核心知识点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c47ffea841c744d49be4566de60fee51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=9CFomE04L2xuuaNHJnnqcPsATRs%3D" alt="" loading="lazy"/></p>
<p>如果想增加求职竞争力，最重要的是做实战项目，我在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codefather.cn%2F" target="_blank" title="https://www.codefather.cn/" ref="nofollow noopener noreferrer">编程导航</a> 上的的智能 BI 项目和 OJ 判题系统项目都有完整的 RabbitMQ 实战。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d01e0354974b09910d284984d2d032~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=BKCTnz4PIqmtXSjLGbDJYi9FwVg%3D" alt="" loading="lazy"/></p>
<p>你握紧了粉拳：好的，我这就去学！</p>
<h2 data-id="heading-16">结尾</h2>
<p>若干年后，你已经成为了大厂的消息队列专家。不仅能熟练使用 RabbitMQ 解决各种业务问题，搭个集群架构也是手拿把掐的。</p>
<p>你也像鱼皮当时一样，耐心地给新人分享学习 RabbitMQ 的经验，让他们谨记 “消息队列是实战型技术，一定要多动手实践”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b1162ee38b41bfaf44c3d91ba9d588~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=N6Gxloak0DC5X22Pa03ck%2FrLGG4%3D" alt="" loading="lazy"/></p>
<p>再次遇到鱼皮是在一条昏暗的小巷，此时的他年过 35，一毛不拔。你什么都没说，只是给他点了个赞。</p>
<p>不打扰，是你的温柔。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29d9a0ffb6e5478a81fb2305bc4b2965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766569236&amp;x-signature=CSp9vOcX59W0a93vfq6klCKbeiw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17">更多</h2>
<p>💻 编程学习交流：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fcode-nav" target="_blank" title="https://github.com/liyupi/code-nav" ref="nofollow noopener noreferrer">编程导航</a> 📃 简历快速制作：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Flaoyujianli" target="_blank" title="https://github.com/liyupi/laoyujianli" ref="nofollow noopener noreferrer">老鱼简历</a> ✏️ 面试刷题神器：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fmianshiya" target="_blank" title="https://github.com/liyupi/mianshiya" ref="nofollow noopener noreferrer">面试鸭</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WEB端小屏切换纯CSS实现]]></title>    <link>https://juejin.cn/post/7584358227612450858</link>    <guid>https://juejin.cn/post/7584358227612450858</guid>    <pubDate>2025-12-17T07:17:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584358227612450858" data-draft-id="7583892482598649871" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WEB端小屏切换纯CSS实现"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-12-17T07:17:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码云之上"/> <meta itemprop="url" content="https://juejin.cn/user/1319873957601656"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WEB端小屏切换纯CSS实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1319873957601656/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码云之上
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:17:07.000Z" title="Wed Dec 17 2025 07:17:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>最近开发了一个内部问答平台（deepseek套层皮🐷），前端实现很简单，用户输入一个问题，跟后端建立一个SSE连接，后端将结果流式输出，前端流式渲染展示。<br/>
突然有一天老板想搞点事：小明，页面这个流式内容能不能支持缩小到页面右下角，让用户更加聚焦输入框内容？<br/>
WTF，只见过全屏展示的，还没见过小屏展示的。<br/>
好像也不是，暂停播放的时候，各大视频网站就喜欢小屏放内容，让你更加聚焦于弹窗广告👻。<br/>
没有办法，在AI的冲击下前端已经死了至少七次了，可不敢惹恼boss，不然就等不到被AI的第八次kill，已经被老板一次KO了🫡。<br/>
秉着负（牛）责（马）的态度，帮助boss梳理交互细节~<br/>
希望缩小后流式内容还在动态输出...<br/>
希望缩小后右侧区域自动扩张到全部区域，然后小窗“悬浮”在右下角...<br/>
希望可以丝滑地还原...<br/>
明确了需求，直接开干。</p>
<h2 data-id="heading-1">方案思路</h2>
<blockquote>
<p>希望缩小后流式内容还在动态输出...</p>
</blockquote>
<p>把当前内容区的容器整个缩小不就行了<code>transform: scale(0.x)</code>，也就是从视觉上缩小流式内容区，其他渲染逻辑完全不动，SSE流的解析和渲染还是在内容区组件里完成，太easy了🥰</p>
<blockquote>
<p>希望缩小后右侧区域自动扩张到全部区域，然后小窗“悬浮”在右下角...</p>
</blockquote>
<p>啧啧，也好实现，在内容区多包一层div，让这个div脱离文档流<code>position:absolute</code>，再设置一下相对位置就可以悬浮到指定位置啦。</p>
<blockquote>
<p>希望可以丝滑地还原...</p>
</blockquote>
<p>CSS加上过渡效果，<code>transition: transform 0.3s ease</code>简单需求简单做嘛，哈哈哈</p>
<h2 data-id="heading-2">技术实现</h2>
<h3 data-id="heading-3">容器结构</h3>
<p>分为两层容器，父容器负责定位，实际缩小内容放置在 <code>.right-panel-content__container</code> 中:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be8397c690db4930b5a5e87cac294906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqR5LmL5LiK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766560626&amp;x-signature=t%2BAgTIyki3oUfZAx1ejr5GUZUvs%3D" alt="Clipboard_Screenshot_1765869186.png" loading="lazy"/>
为了拥有过渡效果，通过<code>setTimeout</code>制造时间差，让过渡动画完成后才让父容器<code>.right-panel-content</code>浮动到右下角为止。看下实现效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0cfa1033db347aba5851cc65da701c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqR5LmL5LiK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766560626&amp;x-signature=lzNSUgKjVGVu%2FgEj0BlSsknVcqI%3D" alt="Kapture 2025-12-16 at 12.01.08.gif" loading="lazy"/></p>
<p>唉，唉！唉？缩小的内容怎么不见了？<br/>
<code>F12</code>打开调试面板看下DOM结构：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01f5f3bc4f1344b89256e29cdcba7cdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqR5LmL5LiK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766560626&amp;x-signature=MV6YNa3PbQEyfu26xPnJiz1ZrL0%3D" alt="Clipboard_Screenshot_1765869271.png" loading="lazy"/></p>
<p>DOM结构正常啊，内容都在正确位置，但是展示怎么就不对呢？<br/>
继续捣鼓CSS...猛然间看到<code>div.right-panel-content.min-mode</code> 的大小，突然感到一丝诡异，按理说待缩放区域设置的缩小比例为<code>scale(0.2)</code>，计算下来容器的宽高至少应该是：<code>90x158</code>。怎么会是<code>64x46</code>呢？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b676182ba8244c1ca9d522a1d29733c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqR5LmL5LiK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766560626&amp;x-signature=7x1BHjzC8gVm7PXQmP8PXWspiXI%3D" alt="Clipboard_Screenshot_1765867173.png" loading="lazy"/>
继续分析DOM结构及大小，发现<code>.right-panel-content__header</code>的大小是：<code>46x28</code>，加上<code>div.right-panel-content.min-mode</code>自己的<code>padding: 8px</code>，好家伙，刚好凑成<code>62x44</code>(=<code>64x46</code>- <code>1px border</code>😭)。<br/>
感情<code>.right-panel-content__container</code>被缩小得根本不占空间了嘛~</p>
<h3 data-id="heading-4">问题分析</h3>
<p>为什么会这样呢？因为被<code>.right-panel-content__container</code>被二次缩小了，原因在于container的父容器为了定位而做出的自身宽高调整。下面分步骤还原一下内容缩放过程：</p>
<blockquote>
<p>设置以下别名：<br/>
.right-panel-content__container =&gt; <code>content__container</code><br/>
.right-panel-content__header =&gt; <code>content__header</code><br/>
.right-panel-content =&gt; <code>panel-content</code></p>
</blockquote>
<ol>
<li>初始时宽高正常，content__container缩放后达到了目标大小90x158；</li>
<li>然后panel-content进入min-mode，宽高被强制设置为<code>auto !important</code>，因为内容区坍塌，panel-content被迫坍塌到跟内容一样的高度90x158；</li>
<li>panel-content高度变化激活了content__container的 scale(0.2)，content__container继续缩小；</li>
<li>content__container的缩小又引发panel-content的高度坍塌...直到 content__header "独自"撑起panel-content的内容。</li>
</ol>
<p>一切都解释清楚了，核心问题变成了怎么解决循环坍塌。</p>
<h3 data-id="heading-5">解决方案</h3>
<p>既然问题父子容器间高度变化引发的循环坍塌，那可以不可以在中间加一层，阻断这种循环效果呢？<br/>
而且要阻断循环，那增加的一层应该脱离文档流，让其大小不受父容器和其子容器干扰。
新的DOM结果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f741bb35ee8b4da2bd8062d743c37251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqR5LmL5LiK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766560626&amp;x-signature=TCBV83Lx3877yfLULHgxLgM0Mkc%3D" alt="小屏DOM结构图.png" loading="lazy"/>
为了让操作栏样式更合理，根据<code>minMode</code>状态对 <code>ContentHeader</code> 进行动态渲染:</p>
<pre><code class="hljs language-js" lang="js">&lt;div className=<span class="hljs-string">"right-panel-middle-wrapper"</span>&gt;
  {minMode &amp;&amp; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ContentHeader</span> <span class="hljs-attr">minMode</span>=<span class="hljs-string">{minMode}</span> <span class="hljs-attr">setMinMode</span>=<span class="hljs-string">{setMinMode}</span> /&gt;</span></span>}
  &lt;div className={<span class="hljs-string">`right-panel-content__container <span class="hljs-subst">${containerClassname}</span>`</span>}&gt;
    {!minMode &amp;&amp; <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ContentHeader</span> <span class="hljs-attr">minMode</span>=<span class="hljs-string">{minMode}</span> <span class="hljs-attr">setMinMode</span>=<span class="hljs-string">{setMinMode}</span> /&gt;</span></span>}
    &lt;<span class="hljs-title class_">ContentSection</span> /&gt;
  &lt;/div&gt;
&lt;/div&gt;;
</code></pre>
<h3 data-id="heading-6">完整实现</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Layout</span>, <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@arco-design/web-react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">IconExpand</span>, <span class="hljs-title class_">IconShrink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@arco-design/web-react/icon"</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">"./App.less"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Sider</span> = <span class="hljs-title class_">Layout</span>.<span class="hljs-property">Sider</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Header</span> = <span class="hljs-title class_">Layout</span>.<span class="hljs-property">Header</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Footer</span> = <span class="hljs-title class_">Layout</span>.<span class="hljs-property">Footer</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Content</span> = <span class="hljs-title class_">Layout</span>.<span class="hljs-property">Content</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [minMode, setMinMode] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [panelClassname, setPanelClassname] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> [containerClassname, setContainerClassname] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> classnameTimer = useRef&lt;number&gt;(<span class="hljs-number">0</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (minMode) {
      <span class="hljs-comment">// 立即启动缩小动效</span>
      <span class="hljs-title function_">setContainerClassname</span>(<span class="hljs-string">"min-mode-transition"</span>);

      <span class="hljs-comment">// 动效结束后，再设置 min-mode 类名</span>
      <span class="hljs-keyword">if</span> (classnameTimer.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(classnameTimer.<span class="hljs-property">current</span>);
      }
      <span class="hljs-comment">// 动画约350ms，需要等动画结束后再设置min-mode</span>
      classnameTimer.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setPanelClassname</span>(<span class="hljs-string">"min-mode"</span>);
      }, <span class="hljs-number">350</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">setPanelClassname</span>(<span class="hljs-string">""</span>);
      <span class="hljs-title function_">setContainerClassname</span>(<span class="hljs-string">""</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (classnameTimer.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(classnameTimer.<span class="hljs-property">current</span>);
      }
    };
  }, [minMode]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"app-layout"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">Header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Sider</span>&gt;</span>Sider<span class="hljs-tag">&lt;/<span class="hljs-name">Sider</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Content</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"left-panel-content"</span>&gt;</span>左侧内容栏<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">right-panel-content</span> ${<span class="hljs-attr">panelClassname</span>}`}&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"right-panel-middle-wrapper"</span>&gt;</span>
                {minMode &amp;&amp; (
                  <span class="hljs-tag">&lt;<span class="hljs-name">ContentHeader</span> <span class="hljs-attr">minMode</span>=<span class="hljs-string">{minMode}</span> <span class="hljs-attr">setMinMode</span>=<span class="hljs-string">{setMinMode}</span> /&gt;</span>
                )}
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">right-panel-content__container</span> ${<span class="hljs-attr">containerClassname</span>}`}
                &gt;</span>
                  {!minMode &amp;&amp; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">ContentHeader</span> <span class="hljs-attr">minMode</span>=<span class="hljs-string">{minMode}</span> <span class="hljs-attr">setMinMode</span>=<span class="hljs-string">{setMinMode}</span> /&gt;</span>
                  )}
                  <span class="hljs-tag">&lt;<span class="hljs-name">ContentSection</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Content</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-name">Footer</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ContentHeader</span>(<span class="hljs-params">{
  minMode,
  setMinMode,
}: {
  minMode: boolean;
  setMinMode: (minMode: boolean) =&gt; <span class="hljs-keyword">void</span>;
}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"right-panel-content__header"</span>&gt;</span>
      {minMode ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setMinMode(false)}&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">IconExpand</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> "<span class="hljs-attr">var</span>(<span class="hljs-attr">--color-border-4</span>)" }} /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setMinMode(true)}&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">IconShrink</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> "<span class="hljs-attr">var</span>(<span class="hljs-attr">--color-border-4</span>)" }} /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ContentSection</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">right-panel-content__section</span>`}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"right-panel-content__section-title"</span>&gt;</span>
        张若虚《春江花月夜》
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      春江潮水连海平，海上明月共潮生。 <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      滟滟随波千万里，何处春江无月明。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      江流宛转绕芳甸，月照花林皆似霰。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span> 空里流霜不觉飞，汀上白沙看不见。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      江天一色无纤尘，皎皎空中孤月轮。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span> 江畔何人初见月？江月何年初照人？
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      人生代代无穷已，江月年年望相似。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      不知江月待何人，但见长江送流水。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      白云一片去悠悠，青枫浦上不胜愁。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      谁家今夜扁舟子？何处相思明月楼？
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      可怜楼上月裴回，应照离人妆镜台。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      玉户帘中卷不去，捣衣砧上拂还来。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span> 此时相望不相闻，愿逐月华流照君。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      鸿雁长飞光不度，鱼龙潜跃水成文。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span> 昨夜闲潭梦落花，可怜春半不还家。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      江水流春去欲尽，江潭落月复西斜。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span> 斜月沉沉藏海雾，碣石潇湘无限路。
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
      不知乘月几人归，落月摇情满江树。
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<p>样式文件：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.app-layout</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;

  <span class="hljs-selector-class">.arco-layout</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.arco-layout-header</span>,
  <span class="hljs-selector-class">.arco-layout-footer</span>,
  <span class="hljs-selector-class">.arco-layout-sider</span>,
  <span class="hljs-selector-class">.arco-layout-sider-children</span>,
  <span class="hljs-selector-class">.arco-layout-content</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--color-white);
    <span class="hljs-attribute">text-align</span>: center;
    <span class="hljs-attribute">font-stretch</span>: condensed;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">justify-content</span>: center;
  }

  <span class="hljs-selector-class">.arco-layout-content</span> {
    <span class="hljs-attribute">flex-direction</span>: row;
  }

  <span class="hljs-selector-class">.arco-layout-header</span>,
  <span class="hljs-selector-class">.arco-layout-footer</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">64px</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--color-primary-light-<span class="hljs-number">4</span>);
  }

  <span class="hljs-selector-class">.arco-layout-sider</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">206px</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--color-primary-light-<span class="hljs-number">3</span>);
  }

  <span class="hljs-selector-class">.arco-layout-content</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-built_in">var</span>(--arcoblue-<span class="hljs-number">6</span>));

    <span class="hljs-selector-class">.left-panel-content</span> {
      <span class="hljs-attribute">flex</span>: auto;
    }

    <span class="hljs-selector-class">.right-panel-content</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--color-primary-light-<span class="hljs-number">3</span>);
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;

      <span class="hljs-selector-class">.right-panel-middle-wrapper</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      }

      <span class="hljs-selector-class">.right-panel-content__container</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;

        <span class="hljs-selector-class">.right-panel-content__header</span> {
          <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
          <span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;
          <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--color-warning-light-<span class="hljs-number">1</span>);
          <span class="hljs-attribute">text-align</span>: right;
          <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
        }

        <span class="hljs-selector-class">.right-panel-content__section</span> {
          <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
          <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">40px</span>);
          <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>;

          <span class="hljs-selector-class">.right-panel-content__section-title</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
          }
        }
      }

      <span class="hljs-selector-class">.min-mode-transition</span> {
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1999</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">442px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">794px</span>;
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.2</span>);
        <span class="hljs-attribute">transform-origin</span>: right bottom;
        <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
      }

      &amp;<span class="hljs-selector-class">.min-mode</span> {
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">499</span>;
        <span class="hljs-attribute">bottom</span>: <span class="hljs-number">25px</span>;
        <span class="hljs-attribute">right</span>: <span class="hljs-number">25px</span>;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
        <span class="hljs-attribute">width</span>: auto <span class="hljs-meta">!important</span>;
        <span class="hljs-attribute">height</span>: auto <span class="hljs-meta">!important</span>;
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">transition</span>: none;
        <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--color-border);
        <span class="hljs-attribute">box-sizing</span>: border-box;

        <span class="hljs-selector-class">.right-panel-middle-wrapper</span> {
          <span class="hljs-attribute">width</span>: <span class="hljs-number">90px</span>;
          <span class="hljs-attribute">height</span>: <span class="hljs-number">158px</span>;
          <span class="hljs-attribute">overflow</span>: hidden;
          <span class="hljs-attribute">position</span>: relative;

          <span class="hljs-selector-class">.right-panel-content__header</span> {
            <span class="hljs-attribute">height</span>: fit-content;
            <span class="hljs-attribute">line-height</span>: unset;
            <span class="hljs-attribute">background-color</span>: unset;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
          }

          <span class="hljs-selector-class">.right-panel-content__container</span> {
            <span class="hljs-attribute">transform-origin</span>: top left;
          }
        }
      }
    }
  }
}
</code></pre>
<h2 data-id="heading-7">最终效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ff5d1bb65cb436faf242e37a4b75cc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqR5LmL5LiK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766560626&amp;x-signature=mN%2F%2FWdAUujET17%2FA%2BM3XLyUoAlo%3D" alt="Kapture 2025-12-16 at 16.05.22.gif" loading="lazy"/></p>
<h2 data-id="heading-8">小结</h2>
<p>文中的小窗效果虽然谈不上尽善尽美，但胜在简单，只需要调整css样式就可以实现。在实现中需要注意的点便是父容器与待缩放内容间的循环依赖问题。本文通过增加一个wrapper层达到依赖解耦的目的。方案有点不够优雅，如果有哪位大佬知道更好的方案，欢迎在评论区给出，让笔者也学习学习🖖</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我们来说一下消息的可靠性投递]]></title>    <link>https://juejin.cn/post/7584379805900210228</link>    <guid>https://juejin.cn/post/7584379805900210228</guid>    <pubDate>2025-12-17T08:27:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805900210228" data-draft-id="7584472215975165967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我们来说一下消息的可靠性投递"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-17T08:27:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小假"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我们来说一下消息的可靠性投递
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小假
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:27:44.000Z" title="Wed Dec 17 2025 08:27:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h3 data-id="heading-0">1. <strong>核心概念</strong></h3>
<p>可靠性投递（Reliable Delivery）是指确保消息从生产者成功到达消费者，即使面对网络故障、系统崩溃等异常情况也能保证<strong>不丢失、不重复、按顺序</strong>（部分场景）传递。</p>
<h3 data-id="heading-1">2. <strong>面临的挑战</strong></h3>
<ul>
<li><strong>网络不可靠</strong>：丢包、延迟、分区</li>
<li><strong>节点故障</strong>：生产者/消费者/中间件宕机</li>
<li><strong>重复消费</strong>：确认机制可能引发重复</li>
<li><strong>顺序保证</strong>：分布式环境下消息乱序</li>
</ul>
<h3 data-id="heading-2">3. <strong>关键实现机制</strong></h3>
<h4 data-id="heading-3">3.1 <strong>生产端保证</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 伪代码示例：生产端确认模式</span>
public void <span class="hljs-built_in">sendWithConfirm</span>(Message msg) {
    <span class="hljs-comment">// 1. 持久化到本地数据库（防丢失）</span>
    messageDao<span class="hljs-selector-class">.save</span>(msg);
    
    <span class="hljs-comment">// 2. 发送到消息队列</span>
    String msgId = rabbitTemplate<span class="hljs-selector-class">.convertAndSend</span>(msg);
    
    <span class="hljs-comment">// 3. 等待Broker确认</span>
    boolean ack = <span class="hljs-built_in">waitForAck</span>(msgId, TIMEOUT);
    
    <span class="hljs-comment">// 4. 失败重试（指数退避）</span>
    if (!ack) {
        <span class="hljs-built_in">retryWithBackoff</span>(msg);
    }
    
    <span class="hljs-comment">// 5. 最终记录投递状态</span>
    <span class="hljs-built_in">updateDeliveryStatus</span>(msgId, ack);
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>技术要点</strong>：</p>
<ul>
<li>
<p><strong>事务机制</strong>：同步方式，性能差（不推荐）</p>
</li>
<li>
<p><strong>确认机制（Confirm）</strong> ：</p>
<ul>
<li>普通确认（每消息确认）</li>
<li>批量确认（提高吞吐）</li>
<li>异步监听（最佳实践）</li>
</ul>
</li>
<li>
<p><strong>本地消息表</strong>：事务消息的替代方案</p>
</li>
<li>
<p><strong>消息持久化</strong>：设置<code>delivery_mode=2</code></p>
</li>
</ul>
<h4 data-id="heading-4">3.2 <strong>Broker端保证</strong></h4>
<pre><code class="hljs">消息处理流程：
Producer → Broker接收 → 持久化存储 → 推送给Consumer → 等待ACK → 删除/重投
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>持久化策略</strong>：</p>
<ul>
<li><strong>队列持久化</strong>：<code>durable=true</code></li>
<li><strong>消息持久化</strong>：<code>delivery_mode=2</code></li>
<li><strong>镜像队列</strong>：多副本冗余（RabbitMQ）</li>
<li><strong>高可用集群</strong>：主从切换时不丢消息</li>
</ul>
<h4 data-id="heading-5">3.3 <strong>消费端保证</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 消费端保证示例</span>
<span class="hljs-meta">@RabbitListener(queues = "order.queue")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrder</span><span class="hljs-params">(OrderMessage order, Channel channel, 
                       <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> tag)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. 业务处理</span>
        orderService.process(order);
        
        <span class="hljs-comment">// 2. 手动确认（成功才ACK）</span>
        channel.basicAck(tag, <span class="hljs-literal">false</span>);
        
        <span class="hljs-comment">// 3. 更新消费记录</span>
        consumeRecordService.markConsumed(order.getId());
        
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 4. 失败处理：重试或进入死信队列</span>
        <span class="hljs-keyword">if</span> (retryCount &lt; MAX_RETRY) {
            channel.basicNack(tag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 重入队列</span>
        } <span class="hljs-keyword">else</span> {
            channel.basicNack(tag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 进入死信队列</span>
            alarmService.notifyAdmin(order, e);
        }
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>消费端关键点</strong>：</p>
<ul>
<li><strong>手动ACK</strong>：避免自动确认导致消息丢失</li>
<li><strong>幂等性设计</strong>：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">processWithIdempotent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> msgId</span>) {
    <span class="hljs-comment">// 基于消息ID去重</span>
    <span class="hljs-keyword">if</span> (redis.<span class="hljs-title function_">exists</span>(<span class="hljs-string">"processed:"</span> + msgId)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 已处理过</span>
    }
    
    <span class="hljs-comment">// 业务处理</span>
    <span class="hljs-built_in">boolean</span> success = <span class="hljs-title function_">doBusinessLogic</span>();
    
    <span class="hljs-comment">// 记录处理状态</span>
    <span class="hljs-keyword">if</span> (success) {
        redis.<span class="hljs-title function_">setex</span>(<span class="hljs-string">"processed:"</span> + msgId, 24h, <span class="hljs-string">"1"</span>);
    }
    
    <span class="hljs-keyword">return</span> success;
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>
<p><strong>死信队列（DLQ）</strong> ：处理无法消费的消息</p>
</li>
<li>
<p><strong>消费重试策略</strong>：</p>
<ul>
<li>立即重试（瞬时故障）</li>
<li>延迟重试（业务依赖）</li>
<li>指数退避（防止雪崩）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">4. <strong>完整可靠性方案</strong></h3>
<h4 data-id="heading-7">4.1 <strong>事务消息方案（如RocketMQ）</strong></h4>
<pre><code class="hljs language-markdown" lang="markdown">两阶段提交：
<span class="hljs-bullet">1.</span> 发送Half Message（预备消息）
<span class="hljs-bullet">2.</span> 执行本地事务
<span class="hljs-bullet">3.</span> 根据本地事务结果Commit/Rollback
<span class="hljs-bullet">4.</span> Broker检查事务状态并投递/丢弃
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-8">4.2 <strong>最大努力投递方案</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 补偿机制实现</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">reliable_delivery</span>(<span class="hljs-params">message</span>):
    max_retries = <span class="hljs-number">5</span>
    <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_retries):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 尝试投递</span>
            result = mq_client.send(message)
            
            <span class="hljs-keyword">if</span> result.confirmed:
                log_delivery_success(message.<span class="hljs-built_in">id</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            log_failure(attempt, e)
            
            <span class="hljs-keyword">if</span> attempt == max_retries - <span class="hljs-number">1</span>:
                <span class="hljs-comment"># 最终失败，人工介入</span>
                send_alert_to_admin(message)
                save_to_compensation_table(message)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                
            <span class="hljs-comment"># 等待后重试</span>
            sleep(backoff_time(attempt))
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-9">4.3 <strong>本地消息表方案（经典）</strong></h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 本地消息表结构</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> local_message (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    biz_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>),      <span class="hljs-comment">-- 业务ID</span>
    content TEXT,           <span class="hljs-comment">-- 消息内容</span>
    status TINYINT,         <span class="hljs-comment">-- 0:待发送, 1:已发送, 2:已确认</span>
    retry_count <span class="hljs-type">INT</span>,
    next_retry_time DATETIME,
    created_at <span class="hljs-type">TIMESTAMP</span>
);
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>工作流程</strong>：</p>
<ol>
<li>业务数据+消息记录<strong>原子性</strong>写入本地DB</li>
<li>定时任务扫描待发送消息</li>
<li>调用MQ发送，成功后更新状态</li>
<li>消费者处理完成后反向确认</li>
<li>对账程序定期校验数据一致性</li>
</ol>
<h3 data-id="heading-10">5. <strong>高级特性与优化</strong></h3>
<h4 data-id="heading-11">5.1 <strong>顺序性保证</strong></h4>
<ul>
<li><strong>全局有序</strong>：单队列单消费者（性能低）</li>
<li><strong>局部有序</strong>：相同sharding key的消息发到同一队列</li>
<li><strong>牺牲场景</strong>：重试队列可能破坏顺序</li>
</ul>
<h4 data-id="heading-12">5.2 <strong>批量消息可靠性</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 批量消息的可靠性处理</span>
public class BatchMessageReliableSender {
    
    public void <span class="hljs-built_in">sendBatch</span>(List&lt;Message&gt; batch) {
        <span class="hljs-comment">// 1. 批量持久化到本地</span>
        batchMessageDao<span class="hljs-selector-class">.saveAll</span>(batch);
        
        <span class="hljs-comment">// 2. 设置批次ID</span>
        String batchId = <span class="hljs-built_in">generateBatchId</span>();
        
        <span class="hljs-comment">// 3. 发送批次消息</span>
        boolean success = mqTemplate<span class="hljs-selector-class">.sendBatch</span>(batchId, batch);
        
        <span class="hljs-comment">// 4. 批次确认（或单条补偿）</span>
        if (success) {
            <span class="hljs-built_in">markBatchDelivered</span>(batchId);
        } else {
            <span class="hljs-comment">// 逐条重试或记录异常</span>
            <span class="hljs-built_in">compensateFailedMessages</span>(batch);
        }
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-13">5.3 <strong>监控与对账</strong></h4>
<ul>
<li>
<p><strong>实时监控</strong>：</p>
<ul>
<li>堆积情况监控</li>
<li>消费延迟报警</li>
<li>失败率统计</li>
</ul>
</li>
<li>
<p>定期对账：</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 消息对账SQL示例</span>
<span class="hljs-keyword">SELECT</span> 
  <span class="hljs-type">DATE</span>(create_time) <span class="hljs-keyword">as</span> <span class="hljs-keyword">day</span>,
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> total_sent,
  <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> status<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> confirmed,
  <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> status<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> pending
<span class="hljs-keyword">FROM</span> message_record
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">DATE</span>(create_time)
<span class="hljs-keyword">HAVING</span> total_sent <span class="hljs-operator">!=</span> confirmed;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-14">6. <strong>不同MQ的实现差异</strong></h3>



































<table><thead><tr><th><strong>特性</strong></th><th><strong>RabbitMQ</strong></th><th><strong>Kafka</strong></th><th><strong>RocketMQ</strong></th></tr></thead><tbody><tr><td><strong>可靠性机制</strong></td><td>确认+持久化+镜像队列</td><td>副本机制+ACK+Exactly-Once</td><td>事务消息+本地存储</td></tr><tr><td><strong>顺序性</strong></td><td>单队列保证</td><td>Partition内有序</td><td>Queue内有序</td></tr><tr><td><strong>事务支持</strong></td><td>轻量级事务（性能差）</td><td>支持Exactly-Once语义</td><td>完整事务消息</td></tr><tr><td><strong>最佳适用场景</strong></td><td>业务消息、高可靠要求</td><td>日志流、大数据场景</td><td>金融交易、订单业务</td></tr></tbody></table>
<h3 data-id="heading-15">7. <strong>实践建议</strong></h3>
<ol>
<li>
<p><strong>分级可靠性策略</strong>：</p>
<ul>
<li>关键业务：事务消息+本地表+对账</li>
<li>普通业务：确认机制+重试+死信队列</li>
<li>日志类：最多一次投递即可</li>
</ul>
</li>
<li>
<p><strong>性能与可靠性的平衡</strong>：</p>
<ul>
<li>同步刷盘 vs 异步刷盘</li>
<li>同步复制 vs 异步复制</li>
<li>根据业务重要性选择配置</li>
</ul>
</li>
<li>
<p><strong>灾难恢复设计：</strong></p>
</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 配置示例：多级降级</span>
<span class="hljs-attr">mq:</span>
  <span class="hljs-attr">primary:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">"amqp://primary"</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">1000ms</span>
  <span class="hljs-attr">secondary:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">"amqp://secondary"</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">2000ms</span>
  <span class="hljs-attr">fallback-to-db:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 最终降级到数据库</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-16">总结</h3>
<p>消息的可靠性投递是一个系统工程，需要在<strong>生产端、Broker端、消费端</strong>协同设计，结合<strong>业务场景、性能要求、成本约束</strong>做出合适的选择。没有"银弹"方案，只有最适合的方案。建议从简单方案开始，随着业务复杂度增加逐步引入更完善的可靠性机制。</p>
<h3 data-id="heading-17">面试回答</h3>
<p><strong>首先，消息可靠性投递指的是：</strong><br/>
一个消息从发送到被消费者成功处理，过程中不会丢失或重复，保证最终数据的一致性。在实际系统里，消息可能因为网络问题、服务重启等原因丢失或重复，所以我们需要一套机制来确保可靠。</p>
<p><strong>为什么需要它呢？</strong><br/>
比如在订单系统中，用户支付成功后要通知物流系统，如果消息丢了，物流就不会触发，用户体验就受损；如果消息重复，可能重复发货，造成损失。所以像金融、交易这些场景，可靠性特别重要。</p>
<p><strong>常见的实现方式，我了解的有几种：</strong></p>
<ol>
<li><strong>生产者确认机制</strong><br/>
生产者发消息后，MQ（比如RabbitMQ）会返回一个确认（ACK），如果没收到ACK，生产者可以重发。这样可以防止消息在发送阶段丢失。</li>
<li><strong>消息持久化</strong><br/>
消息保存到磁盘，而不是只放在内存。这样即使MQ重启，消息也不会丢。</li>
<li><strong>消费者手动ACK</strong><br/>
消费者处理完消息后，手动告诉MQ“我已经处理完了”，MQ才删除消息；如果处理失败，MQ可以把消息重新投递给其他消费者。避免消息在处理阶段丢失。</li>
<li><strong>事务消息（比如RocketMQ）</strong><br/>
先发一个“半消息”，等本地事务执行成功，再确认投递；如果失败，就回滚。这适用于分布式事务场景。</li>
<li><strong>消息去重</strong><br/>
为了避免重复消费，可以在消费端做幂等性设计。比如在数据库里记录消息ID，每次处理前先查一下是否已经处理过。</li>
</ol>
<p><strong>实际中我们一般会结合业务来设计。</strong><br/>
比如一个订单状态同步的场景，我可能会用：生产者确认 + 消息持久化 + 消费者手动ACK + 消费端幂等性。这样基本能覆盖发送、存储、消费各个环节的可靠性。</p>
<p><strong>当然，可靠性和性能之间需要权衡</strong>，比如持久化会降低吞吐量，手动ACK会增加延迟。所以要根据业务需求来选择合适的方案。</p>
<blockquote>
<p>追加：遇到过消息丢失或重复的问题，你是怎么排查和解决的？</p>
</blockquote>
<blockquote>
<p>追加：是否了解最终一致性、最大努力通知等模式 ？</p>
</blockquote>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙ArkUI：状态管理、应用结构、路由全解析]]></title>    <link>https://juejin.cn/post/7584742635483938826</link>    <guid>https://juejin.cn/post/7584742635483938826</guid>    <pubDate>2025-12-17T09:45:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635483938826" data-draft-id="7578901433970622464" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙ArkUI：状态管理、应用结构、路由全解析"/> <meta itemprop="keywords" content="前端,Android,HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-17T09:45:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hqk"/> <meta itemprop="url" content="https://juejin.cn/user/2357827986264942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙ArkUI：状态管理、应用结构、路由全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2357827986264942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hqk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:45:31.000Z" title="Wed Dec 17 2025 09:45:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    76
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>在上一篇中讲解了：<a href="https://juejin.cn/post/7578902814022565903" target="_blank" title="https://juejin.cn/post/7578902814022565903">鸿蒙 ArkUI基础语法</a>，本篇将会讲解ArkUI状态管理、应用结构、路由相关内容。</p>
<p>上一篇一系列例子中，我们用到<code>@State</code>修饰符来让变量变成状态变量，让其拥有UI刷新的能力。</p>
<p>而<code>@State</code>是最基础的，除了它，鸿蒙还提供了一整套装饰器来解决不同组件之间的数据同步问题。</p>
<h2 data-id="heading-1">1、V1状态管理修饰器</h2>
<p>注意：<strong>新项目建议直接用V2状态管理修饰器，V1已经逐渐被废弃了！</strong></p>
<h3 data-id="heading-2">1.1 组件状态管理</h3>
<h4 data-id="heading-3">1.1.1 @State</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct StateExample {
  // @State 标记变量，变化时触发 build() 重绘
  @State count: number = 0;

  build() {
    Column() {
      Text(`当前点击次数：${this.count}`)
        .fontSize(30)

      Button("点我 +1")
        .onClick(() =&gt; {
          this.count++; // 修改状态，UI 自动刷新
        }).margin({top:20})
    }.width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4d21c436e51448cbee04d8a33eab54a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=YJEBICipXDCSojxH0LZlmhpsn8U%3D" alt="ezgif-2e9732bbda163a44.gif" loading="lazy"/></p>
<p><code>@State</code>在上面的例子用了很多次，标记的变量，变化时将会触发UI重绘</p>
<h4 data-id="heading-4">1.1.2 @Prop</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Component
struct BatteryIcon {
  // @Prop 接收父组件的值，自己可以在内部修改，但不会同步回父组件
  @Prop batteryLevel: number;

  build() {
    Column() {
      Text(`子组件显示电量: ${this.batteryLevel}%`)
      Button("子组件偷偷耗电 -10")
        .onClick(() =&gt; {
          this.batteryLevel -= 10; // 这里改了，只会影响 BatteryIcon 自己
        })
    }
    .padding(10)
    .backgroundColor(Color.Pink)
  }
}

@Entry
@Component
struct PropExample {
  @State realBattery: number = 100;

  build() {
    Column({ space: 20 }) {
      Text(`父组件真实电量: ${this.realBattery}%`).fontSize(24)

      // 传递时直接传值（this.realBattery）
      BatteryIcon({ batteryLevel: this.realBattery })

      Button("父组件充电 +10")
        .onClick(() =&gt; {
          this.realBattery += 10; // 父组件一更新，子组件会被重置为最新值
        })
    }.width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3aedeb1940e447db487713b3fe438fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=OY0qS%2FhvcNy8q41WcTk9uPk8MPE%3D" alt="ezgif-22965a0af69300c8.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>父组件<code>PropExample</code>里面包含子组件<code>BatteryIcon</code>，</li>
<li>子组件接受父组件的变量<code>batteryLevel</code>被<code>@Prop</code>修饰符修饰</li>
<li>父组件的值改变会影响子组件的值的改变，而子组件的值改变不会影响父组件的值改变</li>
</ul>
<p>一句话总结：<strong>单向同步（父 -&gt; 子），子改父不变，父改子变</strong></p>
<h4 data-id="heading-5">1.1.3 @Link</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Component
struct ControlPanel {
  // @Link 类似于指针，指向父组件的同一块内存
  @Link toggleState: boolean;

  build() {
    Row() {
      Text("子组件开关：")
      Toggle({ type: ToggleType.Switch, isOn: this.toggleState })
        .onChange((isOn: boolean) =&gt; {
          this.toggleState = isOn; // 子组件修改，父组件立马同步
        })
    }.backgroundColor(Color.Pink)
  }
}

@Entry
@Component
struct LinkExample {
  @State isWiFiOn: boolean = false;

  build() {
    Column({ space: 20 }) {
      Text(`父组件 WiFi 状态: ${this.isWiFiOn ? '开启' : '关闭'}`)
        .fontSize(24)
        .fontColor(this.isWiFiOn ? Color.Green : Color.Red)

      ControlPanel({ toggleState: this.isWiFiOn })
      //两种传值都可以
      ControlPanel({ toggleState: $isWiFiOn })

      Row() {
        Text("父组件开关：")
        Toggle({ type: ToggleType.Switch, isOn: this.isWiFiOn })
          .onChange((isOn: boolean) =&gt; {
            this.isWiFiOn = isOn; // 父组件修改，子组件也同步
          })
      }

    }.width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58fb7d9ca1b148b696f5f093ddcd5bf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=2dao2SugU%2F2aO4lyg6RC%2BYsFrw8%3D" alt="ezgif-2f9967554998dae7.gif" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li>父组件<code>LinkExample</code>里面包含子组件<code>ControlPanel</code></li>
<li>子组件接受父组件的变量<code>toggleState</code>被<code>@Link</code>修饰符修饰</li>
<li>无论子组件改变值还是父组件改变值，都会更新最新的值并且渲染刷新UI（<strong>双向同步</strong>）</li>
</ul>
<h4 data-id="heading-6">1.1.4 @Provide + @Consume</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct ProvidePage {
  @Provide count: number = 0;
  build() {
    Row(){
      Column({space: 18}){
        Text(this.count.toString())
          .fontSize(50)
        Button('顶级组件').onClick( () =&gt; {
            this.count++
        })
        Divider()
        Child2()

      }
      .width('100%')

    }
    .height('100%')
  }
}

@Component
struct Child2 {
  @Consume count: number;
  build() {
    Column() {
      Text("子组件:"+this.count)
        .fontSize(40)
      Divider()
      Grand()
    }.backgroundColor(Color.Pink)
  }
}

@Component
struct Grand {
  @Consume count: number;
  build() {
    Column() {
      Text("孙组件")
        .fontSize(30)
      Text(this.count.toString())

      Button('修改').onClick( () =&gt; {
        this.count++
      })
    }.backgroundColor(Color.Green)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b801916b500f4e48a2c6e54e25f7483d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=2PxPLhuBgkBiKowsy2LTwaAl7wg%3D" alt="ezgif-3e221696fdef9371.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>父组件<code>ProvidePage</code>对应的变量<code>count</code>由<code>@Provide</code>修饰，而子组件以及孙组件对应变量<code>count</code>由<code>@Consume</code>修饰。</li>
<li>它们之间并没有通过传参的方式传递变量，而是直接通过变量名自动匹配，因此它们之间的变量<code>count</code>必须一致</li>
</ul>
<h4 data-id="heading-7">1.1.5 @Observed + @ObjectLink</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct CartPage {
  @State items: CartItem[] = [
    new CartItem(1, "可乐", 3),
    new CartItem(2, "薯片", 6),
    new CartItem(3, "巧克力", 12)
  ]
  @State totalPrice: number = 0

  /**
   * 重新计算总价
   */
  recalcTotal() {
    let total = 0
    for (let item of this.items) {
      total += item.count * item.price
    }
    this.totalPrice = total
  }

  build() {
    Column() {
      Text("购物车")
        .fontSize(24)
        .margin(10)

      // 商品列表
      ForEach(this.items, (item: CartItem) =&gt; {
        CartItemRow({
          item: item,
          onCountChange: () =&gt; {
            this.recalcTotal()
          }
        })
      })

      Divider().margin({ top: 20 })

      // 显示总价（不会 undefined）
      Text(`总价：￥${this.totalPrice}`)
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .margin(20)
    }.width('100%')
    .height('100%')
    .onAppear(() =&gt; {
      this.recalcTotal() // 初次计算
    })
  }
}


@Component
struct CartItemRow {
  @ObjectLink item: CartItem
  onCountChange: () =&gt; void = () =&gt; {
  }

  build() {
    Row() {
      Text(this.item.name)
        .width(120)

      Text(`￥${this.item.price}`)
        .width(60)
        .fontColor(Color.Grey)

      Button("-")
        .onClick(() =&gt; {
          if (this.item.count &gt; 1) {
            this.item.count--
            this.onCountChange()
          }
        })

      Text(`${this.item.count}`)
        .width(30)
        .textAlign(TextAlign.Center)

      Button("+")
        .onClick(() =&gt; {
          this.item.count++
          this.onCountChange()
        })
    }
    .padding(10)
  }
}


@Observed
class CartItem {
  id: number
  name: string
  price: number
  count: number

  constructor(id: number, name: string, price: number, count: number = 1) {
    this.id = id
    this.name = name
    this.price = price
    this.count = count
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a3a298018d449528b11f1ed0f18c47f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=YQJp42sNe%2BDHfZ3Mnrc0VKzt%2F3k%3D" alt="ezgif-5cfcd6a8cee143b6.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>
<p>使用了<code>@Observed + @ObjectLink</code>修饰符，</p>
<ul>
<li><code>@Observed</code>用于修饰 <strong>类</strong>，让类的属性变成可观察的。当属性变化时，UI 会自动刷新。</li>
<li><code>@ObjectLink</code> 用于子组件接收父组件传入的 <strong>对象引用</strong>（而不是值）;这样子组件内部修改对象 → 父组件也会同步 → UI 自动刷新</li>
</ul>
</li>
<li>
<p>一句话总结：<strong><code>@Observed</code> 让类的属性具有可观察性，<code>@ObjectLink</code> 让不同组件共享同一个对象并保持同步更新。</strong></p>
</li>
</ul>
<p>上面的装饰器仅能在页面内，如果要实现应用级以及多个页面的状态数据共享，就需要用到应用级的状态管理。</p>
<h3 data-id="heading-8">1.2 应用状态管理</h3>
<h4 data-id="heading-9">1.2.1 LocalStorage</h4>
<p>LocalStorage：页面级UI状态存储，<strong>通常用于UIAbility内、页面间的状态共享。</strong></p>
<h5 data-id="heading-10">1.2.1.1 基于页面间的状态共享</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">let count: Record&lt;string, number&gt; = { 'count': 0 }
let storage = new LocalStorage(count);

@Entry(storage)
@Component
struct Parent {
  @LocalStorageLink('count') count: number = 0;
  build() {
    Column() {
      Text("父组件")
      Button("加 1").onClick(() =&gt; this.count += 1)
      Text(`当前 Parent count: ${this.count}`)
      ChildDisplay().margin({top:20})
      ChildDisplay2().margin({top:20})
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct ChildDisplay {
  @LocalStorageLink('count') count: number = 0;

  build() {
    Column({space:10}){
      Text("我是子组件双向绑定数据")
      Text(`当前 Child count: ${this.count}`)
      Button("减一").onClick(()=&gt;{
        this.count-=1
      })
    }.backgroundColor(Color.Brown)

  }
}

@Component
struct ChildDisplay2 {
  @LocalStorageProp('count') count: number = 0;

  build() {
    Column({space:10}){
      Text("我是子组件单向绑定数据")
      Text(`当前 Child count: ${this.count}`)
      Button("减一").onClick(()=&gt;{
        this.count-=1
      })
    }.backgroundColor(Color.Gray)

  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/150c937522ca4586b8f3148c65d5373b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=LZ0cYigGW2IMgKhz0NuMgow0zAw%3D" alt="ezgif-51142c2157ac7d59.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>
<p><code>LocalStorage</code> 实现了页面内共享“数据库”，并以<code>Record&lt;string, number&gt;</code>方式存储数据</p>
</li>
<li>
<p>组件树的根节点，被<code>@Entry(storage)</code>装饰的<code>@Component</code>，可以被分配一个LocalStorage实例，<strong>此组件的所有子组件实例将自动获得对该LocalStorage实例的访问权限。</strong></p>
</li>
<li>
<p>LocalStorage根据与@Component装饰的组件的同步类型不同，提供了两个装饰器：</p>
<ul>
<li>@LocalStorageProp装饰的变量与LocalStorage中给定属性建立单向同步关系。</li>
<li>@LocalStorageLink装饰的变量与LocalStorage中给定属性建立双向同步关系。</li>
</ul>
</li>
</ul>
<p>该实例<code>LocalStorage</code>的实例仅仅在一个<code>@Entry</code>装饰的组件和其所属的子组件（一个页面）中共享，如果希望其在多个页面中共享，那么就要用到 基于UIAbility内状态共享</p>
<h5 data-id="heading-11">1.2.1.2 基于UIAbility内状态共享</h5>
<p>既然要基于UIAbility内状态共享，那么就要在所属的UIAbility中创建LocalStorage实例</p>
<p><strong>EntryAbility.ets</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">//....省略部分代码....

export default class EntryAbility extends UIAbility {

//....省略部分代码....

  onWindowStageCreate(windowStage: window.WindowStage): void {
  
    let data: Record&lt;string, string&gt; = {"userName" : 'hqk'}
    let myStorage = new LocalStorage(data)
    
    windowStage.loadContent('pages/dos/EntryLocalPage1',myStorage, (err) =&gt; {

    //....省略部分代码....
  }

//....省略部分代码....
}
</code></pre>
<p>注意：在<code>EntryAbility.ets</code>里，我们在调用<code>windowStage.loadContent</code>时，传入了创建好的<code>LocalStorage</code>值。</p>
<p>既然<code>EntryAbility</code>已经创建了<code>LocalStorage</code>，那么对应的page页面该如何取值呢？</p>
<p><strong>EntryLocalPage1</strong></p>
<pre><code class="hljs language-php" lang="php">import { router } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;

@<span class="hljs-title function_ invoke__">Entry</span>({ <span class="hljs-attr">useSharedStorage</span>: <span class="hljs-literal">true</span> })
@Component
struct EntryLocalPage1 {
  @<span class="hljs-title function_ invoke__">LocalStorageLink</span>(<span class="hljs-string">'userName'</span>) userName: <span class="hljs-keyword">string</span> = <span class="hljs-string">'page1'</span>;

  <span class="hljs-title function_ invoke__">build</span>() {
    <span class="hljs-title function_ invoke__">RelativeContainer</span>() {

      <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">"第一个页面"</span>).<span class="hljs-title function_ invoke__">fontSize</span>(<span class="hljs-number">40</span>)
        .<span class="hljs-title function_ invoke__">fontWeight</span>(FontWeight.Bold)
        .<span class="hljs-title function_ invoke__">alignRules</span>({
          <span class="hljs-attr">bottom</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'EntryLocalPage1HelloWorld'</span>, <span class="hljs-attr">align</span>: VerticalAlign.Top },
          <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: HorizontalAlign.Center }
        })

      <span class="hljs-title function_ invoke__">Text</span>(this.userName)
        .<span class="hljs-title function_ invoke__">id</span>(<span class="hljs-string">'EntryLocalPage1HelloWorld'</span>)
        .<span class="hljs-title function_ invoke__">fontSize</span>(<span class="hljs-number">50</span>)
        .<span class="hljs-title function_ invoke__">fontWeight</span>(FontWeight.Bold)
        .<span class="hljs-title function_ invoke__">alignRules</span>({
          <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: VerticalAlign.Center },
          <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: HorizontalAlign.Center }
        })

      <span class="hljs-title function_ invoke__">Button</span>(<span class="hljs-string">"跳转下一个页面"</span>).<span class="hljs-title function_ invoke__">alignRules</span>({
        <span class="hljs-attr">top</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'EntryLocalPage1HelloWorld'</span>, <span class="hljs-attr">align</span>: VerticalAlign.Bottom },
        <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: HorizontalAlign.Center }
      }).<span class="hljs-title function_ invoke__">onClick</span>(() =&gt; {
        router.<span class="hljs-title function_ invoke__">pushUrl</span>({<span class="hljs-attr">url</span>:<span class="hljs-string">"pages/dos/EntryLocalPage2"</span>})
      }).<span class="hljs-title function_ invoke__">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })
    }
    .<span class="hljs-title function_ invoke__">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<p><strong>EntryLocalPage2</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry({ useSharedStorage: true })
@Component
struct EntryLocalPage2 {
  @LocalStorageLink('userName') userName: string = 'page2';

  build() {
    RelativeContainer() {
      Text("第二个页面").fontSize(40)
        .fontWeight(FontWeight.Bold)
        .alignRules({
          bottom: { anchor: 'EntryLocalPage2HelloWorld', align: VerticalAlign.Top },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })

      Text(this.userName)
        .id('EntryLocalPage2HelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)
        .alignRules({
          center: { anchor: '__container__', align: VerticalAlign.Center },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })

      Button("修改内容")
        .alignRules({
          top: { anchor: 'EntryLocalPage2HelloWorld', align: VerticalAlign.Bottom },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })
        .margin({ top: 10 })
        .onClick(() =&gt; {
          this.userName = "张三"
        })
    }
    .height('100%')
    .width('100%')
  }
}
</code></pre>
<p>运行效果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9539c392cdae4d978c475ccfe2c711f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=PyDc5hy%2BMyg8tyuckx%2BD4wLv%2FKY%3D" alt="ezgif-4f292d3891780923.gif" loading="lazy"/></p>
<p>在该示例中：</p>
<ul>
<li>UIAbility中创建LocalStorage实例，通过<code>windowStage.loadContent</code>方法使其对应 UIAbility内的所有page页面都具备访问 UIAbility中创建LocalStorage实例的资格</li>
<li>对应的page页面如果想要访问UIAbility中创建LocalStorage实例，那么<code>@Entry</code>修饰符需要改为<code>@Entry({ useSharedStorage: true })</code>，使其能获取页面共享的LocalStorage实例</li>
<li>这里用到了<code>router</code>路由跳转以及<code>UIAbility</code>相关知识点，稍后会详解</li>
</ul>
<p>注意：<strong>该示例需要用真机或模拟器运行，预览器看不了该效果</strong></p>
<h4 data-id="heading-12">1.2.2 AppStorage</h4>
<p>AppStorage是与应用进程绑定的全局UI状态存储中心，由UI框架在应用启动时创建，将UI状态数据存储于运行内存，实现应用级全局状态共享</p>
<h5 data-id="heading-13">1.2.2.1 示例一</h5>
<p><strong>AppStoragePage1</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { promptAction, router } from '@kit.ArkUI';

@Entry
@Component
struct AppStoragePage1 {
  @State phone: string = ''
  @State name: string = ''

  build() {
    Column({ space: 20 }) {
      Text("数据提交")
        .fontSize(30)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 40 })

      /** 手机号输入框 */
      Row() {
        TextInput({ placeholder: '姓名' })
          .type(InputType.Normal)
          .maxLength(11)
          .onChange(v =&gt; this.name = v)
      }
      .padding(12)
      .backgroundColor('#F7F7F7')
      .borderRadius(8)
      .width('85%')


      /** 手机号输入框 */
      Row() {
        TextInput({ placeholder: '请输入手机号' })
          .type(InputType.Number)
          .maxLength(11)
          .onChange(v =&gt; this.phone = v)
      }
      .padding(12)
      .backgroundColor('#F7F7F7')
      .borderRadius(8)
      .width('85%')

      /** 提交按钮 */
      Button("提交数据")
        .width('85%')
        .height(45)
        .backgroundColor('#007DFF')
        .fontColor(Color.White)
        .borderRadius(8)
        .onClick(() =&gt; this.submit())

    }
    .height('100%')
    .width('100%')
  }

  private submit() {
    if (this.name === '') {
      this.toast("请输入姓名")
      return
    }
    if (this.phone==='') {
      this.toast("请输入手机号")
      return
    }
    //向AppStorage作用域中放置了一个string数据
    AppStorage.setOrCreate&lt;string&gt;("name", this.name)
    AppStorage.setOrCreate&lt;string&gt;("phone",this.phone)
    router.pushUrl({url:"pages/AppStoragePage2"})
  }

  private toast(msg: string) {
    promptAction.showToast({ message: msg })
  }
}
</code></pre>
<p><strong>AppStoragePage2</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct AppStoragePage2 {
  @StorageLink('name') name: string = '';
  @StorageProp('phone') phone:string=''
  build() {
    Column({space:20}) {
      Text(`姓名为：${this.name}`)
        .fontSize(20)
        .fontWeight(FontWeight.Bold)

      Text(`手机号为：${this.phone}`)
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
    }
    .height('100%')
    .width('100%')
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<p><strong>预览效果</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34b1fb91a504899877dc237fa2f38dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=bYDDUsvaMafZDZfqSyIBcJu0yac%3D" alt="229189149229136182-2025-12-14-165132.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>我们用<code>AppStorage.setOrCreate&lt;T&gt;</code>这种方式成功的key-value形式保存值</li>
<li>在其他page页面中，可以用<code>@StorageLink(key)</code>与<code>@StorageProp(key) </code>方式获取保存的值</li>
</ul>
<p>那现在问题来了，上面例子中<code>LocalStorage</code>基于UIAbility状态共享的demo也是跨page页面共享，那为何要用<code>AppStorage</code>呢？</p>
<p>那就说明了<code>AppStorage</code>有<code>LocalStorage</code>做不到的事！跨UIAbility共享！</p>
<h5 data-id="heading-14">1.2.2.2 示例二</h5>
<p>我们就在示例一的基础上修改</p>
<p><strong>AppStoragePage1修改版</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { promptAction, router } from '@kit.ArkUI';
import { common, Want } from '@kit.AbilityKit';
@Entry
@Component
struct AppStoragePage1 {
  @State phone: string = ''
  @State name: string = ''

  private context = this.getUIContext().getHostContext() as common.UIAbilityContext;

  build() {
    Column({ space: 20 }) {
      Text("数据提交")
        .fontSize(30)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 40 })

      /** 手机号输入框 */
      Row() {
        TextInput({ placeholder: '姓名' })
          .type(InputType.Normal)
          .maxLength(11)
          .onChange(v =&gt; this.name = v)
      }
      .padding(12)
      .backgroundColor('#F7F7F7')
      .borderRadius(8)
      .width('85%')


      /** 手机号输入框 */
      Row() {
        TextInput({ placeholder: '请输入手机号' })
          .type(InputType.Number)
          .maxLength(11)
          .onChange(v =&gt; this.phone = v)
      }
      .padding(12)
      .backgroundColor('#F7F7F7')
      .borderRadius(8)
      .width('85%')

      /** 提交按钮 */
      Button("提交数据")
        .width('85%')
        .height(45)
        .backgroundColor('#007DFF')
        .fontColor(Color.White)
        .borderRadius(8)
        .onClick(() =&gt; this.submit())


      /** 提交按钮 */
      Button("提交数据至其他Ability")
        .width('85%')
        .height(45)
        .backgroundColor('#007DFF')
        .fontColor(Color.White)
        .borderRadius(8)
        .onClick(() =&gt; this.submitOther())

    }
    .height('100%')
    .width('100%')
  }

  private submitOther() {
    if (!this.checkInput()) {
      return
    }
    //需要定义一个want的对象,意图对象
    let wantInfo: Want = {
      deviceId: '',// deviceId为空表示本设备
      bundleName: 'com.example.demo01', //模块的包名
      moduleName: 'user', //模块名
      abilityName: 'UserAbility',// 要跳转的Ability的名称
      parameters:{   //用于传递参数的一个对象

      }
    }

    //使用context去进行的跳转
    this.context.startAbility(wantInfo)

  }



  private submit() {
    if (!this.checkInput()) {
      return
    }
    router.pushUrl({ url: "pages/AppStoragePage2" })
  }

  private checkInput() {
    if (this.name === '') {
      this.toast("请输入姓名")
      return false
    }
    if (this.phone === '') {
      this.toast("请输入手机号")
      return false
    }
    //向AppStorage作用域中放置了一个string数据
    AppStorage.setOrCreate&lt;string&gt;("name", this.name)
    AppStorage.setOrCreate&lt;string&gt;("phone", this.phone)
    return true
  }

  private toast(msg: string) {
    promptAction.showToast({ message: msg })
  }
}
</code></pre>
<p><strong>代码分析</strong></p>
<ul>
<li>新增了一个按钮并调用了<code>submitOther()</code>方法</li>
<li>在这个方法里，创建了<code>Want</code>对象，并将该值通过<code> this.context.startAbility</code>代码块传递（这个稍后会详解）</li>
</ul>
<p>项目结构图:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ca6c9a25c274d35abfb8a53329bf8cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=FA0R%2BeHpa1ztmFGopaVLZw71mgo%3D" alt="image.png" loading="lazy"/></p>
<p>运行效果图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a167fea8d972435e99cff22473a9f08a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=P26xMR6jodWCj0jkm3TkWt5chpA%3D" alt="229189149229136182-2025-12-14-174643.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>在这个项目结构里，创建了全新的UIModel为user模块，并且对应模块里有对应的UIAbility，</li>
<li>在对应的UIAbility中，有个默认启动page页面：index，</li>
<li>在默认page页面中，我们使用了<code>@StorageLink(key)</code>与<code>@StorageProp(key) </code>方式获取保存的值</li>
<li>当我们跳转至其他UIAbility时，手机系统任务栏里将会创建全新的一个任务</li>
</ul>
<p>OK，我们接着看下一个！</p>
<h4 data-id="heading-15">1.2.3 PersistentStorage</h4>
<p>PersistentStorage提供状态变量持久化的能力，但是需要注意，其持久化和读回UI的能力都需要依赖AppStorag。</p>
<h5 data-id="heading-16">1.2.3.1 示例一</h5>
<p><strong>PersistentStoragePage</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { router } from '@kit.ArkUI';

PersistentStorage.persistProp&lt;string&gt;('userName', 'admin')
@Entry
@Component
struct PersistentStoragePage {
  @StorageLink('userName') uname: string = 'Hello World';
  build() {
    Column() {
      Text(this.uname)
        .id('PersistentStoragePageHelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)

      Button('修改值').onClick( () =&gt; {
          AppStorage.setOrCreate&lt;string&gt;('userName', 'hqk')
      })
      
      Button('跳转到2').onClick( () =&gt; {
        router.pushUrl({url: 'pages/PersistentStoragePage2'})
      })
    }
    .height('100%')
    .width('100%')
  }
}
</code></pre>
<p><strong>PersistentStoragePage2</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">
@Entry
@Component
struct PersistentStoragePage2 {

  @StorageLink('userName') uname: string = 'Hello World';

  build() {

    Column(){
      Text(this.uname)
        .id('PersistentStoragePageHelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)
        .alignRules({
          center: { anchor: '__container__', align: VerticalAlign.Center },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })

    }
    .width('100%')
    .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d872ce44312420d919d7c3a88b67e35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=MNXqiTRd8bnF1YAksYp9%2BZk9JCg%3D" alt="ezgif-83691f7387cb4fb2.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li><code>PersistentStorage</code>可以通过<code>PersistentStorage.persistProp</code>持久化存储值</li>
<li>当修改以及取值(读回UI的能力)时，需要依赖<code>AppStorage</code>以及<code>AppStorage</code>对应的<code>@StorageLink</code>和<code>@StorageProp</code></li>
</ul>
<p>注意：<strong>持久化数据是一个相对缓慢的操作</strong>，持久化变量最好是<strong>小于2KB的数据</strong>，不要大量的数据持久化，因为<code>PersistentStorage</code>写入磁盘是在UI线程同步执行的！</p>
<h3 data-id="heading-17">1.3 其他状态管理</h3>
<h4 data-id="heading-18">1.3.1 Watch</h4>
<p><code>@Watch</code>应用于对状态变量的监听。如果开发者需要关注某个状态变量的值是否改变，可以使用<code>@Watch</code>为状态变量设置回调函数。</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { promptAction } from '@kit.ArkUI'

@Entry
@Component
struct PageWatch {

  //监听某个变量的值，这个值如果发生改动，就会触发相应的函数的执行。

  @State
  @Watch('updateMoney')
  money: number = 100

  updateMoney(){
    promptAction.showToast({message: `${this.money}发生了变化》。。`})
  }

  build() {
   Column(){

     Button('修改值').onClick( () =&gt; {
       this.money += 10
     })
   }
   .width('100%')
   .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0bcc836780f40f38a67aa3ea3796289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=iEHscLqEG7TyhEbR2B1Ytfduf6U%3D" alt="ezgif-8077efcf77b34e5b.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li><code>@Watch</code>用于监听状态变量的变化，当状态变量变化时，<code>@Watch</code>的回调方法将被调用</li>
</ul>
<p>这些都是V1状态修饰器，然而状态管理V1对于嵌套类的观测存在诸多限制，例如需要开发者通过@ObjectLink不断拆解嵌套类才能使其深层次数据具备观测能力。因此，在API12中为开发者提供了一套全新的状态管理V2。</p>
<p>V2的提出不仅解决了V1对于嵌套类观测的先天不足，同时对部分装饰器功能进行了加强！</p>
<p>现在我们来看所谓的V2状态管理修饰器</p>
<h2 data-id="heading-19">2、V2状态管理修饰器</h2>
<h3 data-id="heading-20">2.1 组件状态管理</h3>
<h4 data-id="heading-21">2.1.1 @Local</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@ComponentV2
// @Component //同时使用将会报错
struct PageLocal {
  @Local message: string = 'Hello World';

  build() {
    Column() {
      Text(this.message)
        .id('PageLocalHelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)
        .alignRules({
          center: { anchor: '__container__', align: VerticalAlign.Center },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })

      // LocalSub({message:this.message}) //这句话报错，不能被外部初始化

      Button('修改').onClick( () =&gt; {
        this.message = 'hello'
      })

    }
    .height('100%')
    .width('100%')
  }
}

@ComponentV2
struct LocalSub {
  @Local message: string = ''
  build() {
    Column(){
      Button('修改').onClick( () =&gt; {
        this.message = 'admin'
      })
    }
    .width('100%')
    .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/597c0bbe324b441fb32b7a4c997e35d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=iisPvoLGO720YxyVMggULKH29L4%3D" alt="ezgif-44373bc6c7cf2a75.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li>在<code>@ComponentV2</code>装饰的自定义组件中，<strong>仅可以使用全新的变量装饰器（V2），不能和V1混用</strong></li>
<li>同一个struct结构无法同时使用 <code>@ComponentV2</code>与 <code>@Component</code>装饰</li>
<li>被<code>@Local</code>装饰的变量无法从外部初始化，因此必须在组件内部进行初始化。</li>
<li><code>@Local</code>可以理解为V1版本的<code>@State</code>，被<code>@Local</code>装饰的变量发生变化时，会刷新使用该变量的组件</li>
</ul>
<h4 data-id="heading-22">2.1.2 @Param</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@ComponentV2
struct PageParam {
  @Local message: string = 'Hello World';
  number: number = 0

  build() {
    Column() {
      Text(this.message).fontSize(30).fontColor(Color.Blue)
        .onClick(() =&gt; {
          this.number+=1
          this.message = 'hqk'+this.number
        })
      Divider()
      ParamSub({ message: this.message })
    }
    .width('100%')
    .height('100%')
  }
}

@ComponentV2
struct ParamSub {
  @Param @Require message: string='';
  build() {
    Text(this.message).fontSize(30).fontColor(Color.Blue)
      .onClick(() =&gt; {
        // this.message = 'admin' //这句话报错，不允许修改
      })
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91b0438af8f943e788da986133781bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=HPVYsBQeNfbv5Hw%2F5rnIdjqMKWU%3D" alt="ezgif-2c3e29cdf283fce3.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li><code>@Require</code>: 设置状态变量可以没有初始值</li>
<li>被<code>@Param</code>修饰的变量不允许自己修改，只能通过外界的传入，使其父子组件之间的数据能够进行同步</li>
<li>被<code>@Param</code>修饰的变量变化时，也会刷新该变量关联的组件</li>
</ul>
<h4 data-id="heading-23">2.1.3 @Once</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Entry</span>
<span class="hljs-variable">@ComponentV2</span>
struct PageParam {
  <span class="hljs-variable">@Local</span> <span class="hljs-attribute">message</span>: string = <span class="hljs-string">'Hello World'</span>;
  number: number = 0

  build() {
    Column() {
      Text(this.message).fontSize(30).fontColor(<span class="hljs-attribute">Color.Blue)
        .onClick(() =&gt; {
          this.number+=1
          this.message = 'hqk'+this.number
        })
      Divider()
      ParamSub({ message</span>: this.message })
    }
    .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)
  }
}

<span class="hljs-variable">@ComponentV2</span>
struct ParamSub {

  <span class="hljs-variable">@Param</span> <span class="hljs-variable">@Once</span> <span class="hljs-variable">@Require</span> <span class="hljs-attribute">message</span>: string;
  number: number = 0

  build() {
    Text(this.message).fontSize(30).fontColor(<span class="hljs-attribute">Color.Blue)
      .onClick(() =&gt; {
        this.number+=1
        this.message = 'admin'+this.number
      })
  }
}
</span></code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/566912b237bc412cb4060ccf1b871dd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=5mMzRDeCj4lO7orGdkvtqgULzpY%3D" alt="ezgif-3a9dc417c50bd60b.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li><code>@Once</code>装饰器在变量初始化时接受外部传入值进行初始化，后续数据源更改不会同步给子组件（<strong>变量仅初始化同步一次）</strong></li>
<li><code>@Once</code>必须搭配<code>@Param</code>使用，单独使用或搭配其他装饰器使用都是不允许的</li>
<li><code>@Once</code>不影响<code>@Param</code>的观测能力，仅针对数据源的变化做拦截</li>
<li><code>@Once</code>与<code>@Param</code>搭配时，可以在本地修改<code>@Param</code>变量的值</li>
<li><code>@Once</code>与<code>@Param</code> 装饰变量时，不分定义的先后顺序</li>
</ul>
<p>我们发现当单独使用<code>@Param</code>时，子组件对应的变量不能修改，但是加入了<code>@Once</code>后，虽然子组件被<code>@Param</code>修饰的变量可以改变了，但改变后，父组件并未更新，因此我们就可以使用下一个装饰器——<code>@Event</code></p>
<h4 data-id="heading-24">2.1.4 @Event</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">/**
 * 模拟Link
 */

@Entry
@Component
struct PageEvent {
  @State userName: string = 'admin';

  build() {
    Column(){

      Text(this.userName).fontSize(50).fontColor(Color.Blue)
        .onClick(()=&gt;{
          this.userName = 'hqk'
        })

      SubEvent({sunUserName: this.userName, updateUserName:()=&gt;{
        this.userName = '天高皇帝远'
      }})
    }
    .width('100%')
    .height('100%')
  }
}

@ComponentV2
struct SubEvent {

  @Require @Param sunUserName:string

  //定义一个用于修改父组件值的函数
  //@Event updateUserName: ()=&gt;void  //没有初始化时，会自动生成一个空的函数作为默认回调

  @Event updateUserName: ()=&gt;void = ()=&gt;{}

  build() {
    Column(){
      Text(this.sunUserName).fontSize(50).fontColor(Color.Blue)
        .onClick(()=&gt;{
          this.updateUserName()
        })
    }
    .width('100%')

  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/798b99a8785546b9b46e72714d9337cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=Qo4A9xHwolqtBQ4IhIv0KBFeoyA%3D" alt="ezgif-8102657e16836369.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li><code>@Event</code>用于装饰组件对外输出的方法</li>
<li><code>@Event</code>装饰的回调方法中参数以及返回值由开发者决定</li>
<li><code>@Event</code>装饰非回调类型的变量不会生效。当<code>@Event</code>没有初始化时，会自动生成一个空的函数作为默认回调</li>
<li>当<code>@Event</code>未被外部初始化，但本地有默认值时，会使用本地默认的函数进行处理</li>
<li><code>@Event</code>相当于V1的<code>@Link</code></li>
</ul>
<h4 data-id="heading-25">2.1.5 @Provider+@Comsumer</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@ComponentV2
struct ProvidePage {
  @Provider() count: number = 0;
  build() {
    Row(){
      Column({space: 18}){
        Text(this.count.toString())
          .fontSize(50)
        Button('顶级组件').onClick( () =&gt; {
            this.count++
        })
        Divider()
        Child2()

      }
      .width('100%')

    }
    .height('100%')
  }
}

@ComponentV2
struct Child2 {
  @Consumer() count: number=0;
  build() {
    Column() {
      Text("子组件:"+this.count)
        .fontSize(40)
      Divider()
      Grand()
    }.backgroundColor(Color.Pink)
  }
}

@ComponentV2
struct Grand {
  @Consumer('count') myCount: number=0;
  build() {
    Column() {
      Text("孙组件")
        .fontSize(30)
      Text(this.myCount.toString())

      Button('修改').onClick( () =&gt; {
        this.myCount++
      })
    }.backgroundColor(Color.Green)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b801916b500f4e48a2c6e54e25f7483d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=2PxPLhuBgkBiKowsy2LTwaAl7wg%3D" alt="ezgif-3e221696fdef9371.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li><code>@Provider</code>和<code>@Consumer</code>用于跨组件层级数据双向同步，使其不用拘泥于组件层级</li>
<li><code>@Provider</code>，即数据提供方，使其所有的子组件都可以通过 <code>@Consumer</code>绑定相同的key来获取<code>@Provider</code>提供的数据</li>
<li><code>@Consumer</code>，即数据消费方，可以通过绑定同样的key获取最近父节点的<code>@Provider</code>的数据，当查找不到<code>@Provider</code>的数据时，将会使用本地默认值</li>
<li><code>@Provider</code>和<code>@Consumer</code>装饰数据类型需要一致</li>
</ul>
<h4 data-id="heading-26">2.1.6 @ObservedV2+@Trace</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@ComponentV2
struct CartPage {
  @Local items: CartItem[] = [
    new CartItem(1, "可乐", 3),
    new CartItem(2, "薯片", 6),
    new CartItem(3, "巧克力", 12)
  ]
  @Local totalPrice: number = 0

  /**
   * 重新计算总价
   */
  recalcTotal() {
    let total = 0
    for (let item of this.items) {
      total += item.count * item.price
    }
    this.totalPrice = total
  }

  build() {
    Column() {
      Text("购物车")
        .fontSize(24)
        .margin(10)

      // 商品列表
      ForEach(this.items, (item: CartItem) =&gt; {
        CartItemRow({
          item: item,
          onCountChange: () =&gt; {
            this.recalcTotal()
          }
        })
      })

      Divider().margin({ top: 20 })

      // 显示总价（不会 undefined）
      Text(`总价：￥${this.totalPrice}`)
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .margin(20)
    }.width('100%')
    .height('100%')
    .onAppear(() =&gt; {
      this.recalcTotal() // 初次计算
    })
  }
}


@ComponentV2
struct CartItemRow {
  @Param @Require item: CartItem
  @Param @Require onCountChange: () =&gt; void 

  build() {
    Row() {
      Text(this.item.name)
        .width(120)

      Text(`￥${this.item.price}`)
        .width(60)
        .fontColor(Color.Grey)

      Button("-")
        .onClick(() =&gt; {
          if (this.item.count &gt; 1) {
            this.item.count--
            this.onCountChange()
          }
        })

      Text(`${this.item.count}`)
        .width(30)
        .textAlign(TextAlign.Center)

      Button("+")
        .onClick(() =&gt; {
          this.item.count++
          this.onCountChange()
        })
    }
    .padding(10)
  }
}


@ObservedV2
class CartItem {
  id: number
  name: string
  price: number
  @Trace count: number

  constructor(id: number, name: string, price: number, count: number = 1) {
    this.id = id
    this.name = name
    this.price = price
    this.count = count
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a3a298018d449528b11f1ed0f18c47f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=YQJp42sNe%2BDHfZ3Mnrc0VKzt%2F3k%3D" alt="ezgif-5cfcd6a8cee143b6.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>使用<code>@ObservedV2</code>装饰的类中被<code>@Trace</code>装饰的属性具有被观测变化的能力，当该属性值变化时，会触发该属性绑定的UI组件刷新。</li>
<li>非<code>@Trace</code>修饰的变量，发生改变不会触发UI更新</li>
<li><code>@Trace</code>必须搭配<code>@ObservedV2</code>使用，不能单独使用</li>
<li>等同于V1版本的<code>@Observed + @ObjectLink</code>，V1版本修饰的类只要发生改变就会触发UI更新，但V2版本仅仅只有<code>@Trace</code>装饰的变量才会更新。也就是说V2能精准控制UI刷新的属性</li>
</ul>
<h4 data-id="heading-27">2.1.7 @Computer</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@ComponentV2
struct CartPage {
  @Local items: CartItem[] = [
    new CartItem(1, "可乐", 3),
    new CartItem(2, "薯片", 6),
    new CartItem(3, "巧克力", 12)
  ]
  // @Local totalPrice: number = 0

  /**
   * 重新计算总价 使用了 @Computed
   */
   @Computed get recalcTotal():number {
    let total = 0
    for (let item of this.items) {
      total += item.count * item.price
    }
    // this.totalPrice = total
    return total
  }

  build() {
    Column() {
      Text("购物车")
        .fontSize(24)
        .margin(10)

      // 商品列表
      ForEach(this.items, (item: CartItem) =&gt; {
        CartItemRow({
          item: item,
          onCountChange: () =&gt; {
            this.recalcTotal
          }
        })
      })

      Divider().margin({ top: 20 })

      // 显示总价（不会 undefined）
      Text(`总价：￥${this.recalcTotal}`)
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .margin(20)
    }.width('100%')
    .height('100%')
    .onAppear(() =&gt; {
      this.recalcTotal // 初次计算
    })
  }
}


@ComponentV2
struct CartItemRow {
  @Param @Require item: CartItem
  @Param @Require onCountChange: () =&gt; void

  build() {
    Row() {
      Text(this.item.name)
        .width(120)

      Text(`￥${this.item.price}`)
        .width(60)
        .fontColor(Color.Grey)

      Button("-")
        .onClick(() =&gt; {
          if (this.item.count &gt; 1) {
            this.item.count--
            this.onCountChange()
          }
        })

      Text(`${this.item.count}`)
        .width(30)
        .textAlign(TextAlign.Center)

      Button("+")
        .onClick(() =&gt; {
          this.item.count++
          this.onCountChange()
        })
    }
    .padding(10)
  }
}


@ObservedV2
class CartItem {
  id: number
  name: string
  price: number
  @Trace count: number

  constructor(id: number, name: string, price: number, count: number = 1) {
    this.id = id
    this.name = name
    this.price = price
    this.count = count
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a3a298018d449528b11f1ed0f18c47f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=YQJp42sNe%2BDHfZ3Mnrc0VKzt%2F3k%3D" alt="ezgif-5cfcd6a8cee143b6.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li><code>@Computed</code>为方法装饰器，装饰getter方法</li>
<li><code>@Computed</code>会检测被 计算的属性变化，当被计算的属性变化时，<code>@Computed</code>会被求解一次。</li>
<li>对于复杂的计算，使用<code>@Computed</code>会有性能收益</li>
</ul>
<p>既然V1有应用状态管理，那么V2也有对应的应用状态管理</p>
<h3 data-id="heading-28">2.2 应用状态管理</h3>
<h4 data-id="heading-29">2.2.1 AppStorageV2</h4>
<h5 data-id="heading-30">2.2.1.1 示例一</h5>
<p><strong>AppStoragePage1</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { promptAction, router, AppStorageV2 } from '@kit.ArkUI';

@ObservedV2
export class User {
  userId: number
  @Trace phone: string;
  @Trace userName: string;

  constructor(userId?: number, phone?: string, userName?: string) {
    this.userId = userId ?? 1;
    this.phone = phone ?? '';
    this.userName = userName ?? 'Jack';
  }
}

@Entry
@ComponentV2
struct AppStoragePage1 {
  @Local phone: string = ''
  @Local name: string = ''
  @Local user: User = AppStorageV2.connect&lt;User&gt;(User, () =&gt; new User())!;

  build() {
    Column({ space: 20 }) {
      Text("数据提交")
        .fontSize(30)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 40 })

      /** 手机号输入框 */
      Row() {
        TextInput({ placeholder: '姓名' })
          .type(InputType.Normal)
          .maxLength(11)
          .onChange(v =&gt; this.name = v)
      }
      .padding(12)
      .backgroundColor('#F7F7F7')
      .borderRadius(8)
      .width('85%')


      /** 手机号输入框 */
      Row() {
        TextInput({ placeholder: '请输入手机号' })
          .type(InputType.Number)
          .maxLength(11)
          .onChange(v =&gt; this.phone = v)
      }
      .padding(12)
      .backgroundColor('#F7F7F7')
      .borderRadius(8)
      .width('85%')

      /** 提交按钮 */
      Button("提交数据")
        .width('85%')
        .height(45)
        .backgroundColor('#007DFF')
        .fontColor(Color.White)
        .borderRadius(8)
        .onClick(() =&gt; this.submit())

    }
    .height('100%')
    .width('100%')
  }

  private submit() {
    if (this.name === '') {
      this.toast("请输入姓名")
      return
    }
    if (this.phone === '') {
      this.toast("请输入手机号")
      return
    }
    // //向AppStorage作用域中放置了一个string数据
    // AppStorage.setOrCreate&lt;string&gt;("name", this.name)
    // AppStorage.setOrCreate&lt;string&gt;("phone", this.phone)
    this.user.phone = this.phone
    this.user.userName = this.name
    router.pushUrl({ url: "pages/AppStoragePage2" })
  }

  private toast(msg: string) {
    promptAction.showToast({ message: msg })
  }
}
</code></pre>
<p><strong>预览效果</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34b1fb91a504899877dc237fa2f38dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=bYDDUsvaMafZDZfqSyIBcJu0yac%3D" alt="229189149229136182-2025-12-14-165132.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li><code>AppStorageV2</code>是提供状态变量在应用级全局共享的能力，开发者可以通过<code>connect</code>绑定同一个<code>key</code>，进行跨ability的数据共享</li>
<li><code>AppStorageV2</code>使用<code>connect</code>接口即可实现对<code>AppStorageV2</code>中数据的修改和同步，如果修改的数据被<code>@Trace</code>装饰，该数据的修改会同步更新UI。</li>
<li><code>AppStorageV2</code>使用<code>connect</code>接口只支持class类型</li>
</ul>
<h4 data-id="heading-31">2.2.2 PersistenceV2</h4>
<h5 data-id="heading-32">2.2.2.1 示例一</h5>
<p><strong>PersistentStoragePage</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { router, PersistenceV2 } from '@kit.ArkUI';


@ObservedV2
export class User {
  userId: number
  @Trace userName: string;

  constructor(userId?: number, userName?: string) {
    this.userId = userId ?? 1;
    this.userName = userName ?? 'Jack';
  }
}

@Entry
@ComponentV2
struct PersistentStoragePage {
  @Local user: User = PersistenceV2.connect&lt;User&gt;(User, () =&gt; new User())!

  build() {
    Column({space:10}) {
      Text(this.user.userName)
        .id('PersistentStoragePageHelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)


      Button('修改值').onClick(() =&gt; {
        this.user.userName="hqk"
      })

      Button('跳转到2').onClick(() =&gt; {
        router.pushUrl({ url: 'pages/PersistentStoragePage2' })
      })
    }
    .height('100%')
    .width('100%')
  }
}
</code></pre>
<p><strong>PersistentStoragePage2</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { User } from './PersistentStoragePage'
import { PersistenceV2 } from '@kit.ArkUI'

@Entry
@ComponentV2
struct PersistentStoragePage2 {

  @Local user: User = PersistenceV2.connect&lt;User&gt;(User, () =&gt; new User())!
  build() {

    Column(){
      Text(this.user.userName)
        .id('PersistentStoragePageHelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)
        .alignRules({
          center: { anchor: '__container__', align: VerticalAlign.Center },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })

    }
    .width('100%')
    .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a2f70ac79384b759c2e0cf837c06243~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=lvnxRNJt1UvXQ4mFKjTz5fRiFr8%3D" alt="ezgif-72db3aaebe326936.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li>使用<code>PersistenceV2</code>能将数据存储在设备磁盘上（持久化）</li>
<li><code>PersistenceV2</code>可以和UI组件同步，且可以在应用业务逻辑中被访问，需要和@ObservedV2对象关联，且对应变量需要被<code>@Trace</code>所修饰</li>
<li>单个key支持数据大小约8k，过大会导致持久化失败</li>
<li>持久化的数据必须是class对象，如果需要持久化非class对象，建议使用<code>Persistence</code>进行数据持久化</li>
</ul>
<h3 data-id="heading-33">2.3 其他状态管理</h3>
<h4 data-id="heading-34">2.3.1 @Monitor</h4>
<h5 data-id="heading-35">2.3.1.1 示例一</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@ComponentV2
struct PageWatch {
  //监听某个变量的值，这个值如果发生改动，就会触发相应的函数的执行。
  @Local money: number = 100
  @Local age:number=10

  @Local keyStr: string = ''
  @Local beforeStr: string = ''
  @Local nowStr: string = ''

  @Monitor('money','age')
  onStrChange(monitor: IMonitor) {
    const names: string[] = monitor.dirty
    this.keyStr = JSON.stringify(names)
    // console.log("hqk",JSON.stringify(names))
    monitor.dirty.forEach((path: string) =&gt; {
      this.beforeStr = `${monitor.value(path)?.before}`
      this.nowStr = `${monitor.value(path)?.now}`
      // console.log('hqk', monitor.value(path)?.before, '改变到：', monitor.value(path)?.now)
    })
  }

  build() {
    Column({space:20}) {

      if (this.keyStr !== '') {
        Text(`变量${this.keyStr}被修改`)
      }
      if (this.beforeStr!==''){
        Text(`变量${this.keyStr}修改前的值：${this.beforeStr}`)
      }
      if (this.nowStr!==''){
        Text(`变量${this.keyStr}修改后的值：${this.nowStr}`)
      }

      Button('修改值Money').onClick(() =&gt; {
        this.money += 10
      })

      Button('修改值Age').onClick(() =&gt; {
        this.age += 10
      })
    }
    .width('100%')
    .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed4bbfbbae6248219c356d0af0ae90aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=ZeeYTJxYgIRQrgpOXCWMfFyJ6r8%3D" alt="ezgif-3e7a0880e3af6a15.gif" loading="lazy"/></p>
<p>在这个示例中</p>
<ul>
<li><code>@Monitor</code>装饰器用于监听状态变量修改，使得状态变量具有深度监听的能力</li>
<li>和<code>@Watch</code>类似，不过<code>@Monitor</code>能同时检测多个状态变量</li>
</ul>
<h5 data-id="heading-36">2.3.1.2 示例二</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">
@ObservedV2
class UserInfo {
  @Trace name: string;
  @Trace age: number;

  constructor(name: string, age: number) {
    this.name = name;
    this.age = age;
  }
}

@Entry
@ComponentV2
struct UserProfile {

  @Local user: UserInfo = new UserInfo('hqk', 25);

 
  @Monitor('user.name', 'user.age')
  onUserInfoChange(monitor: IMonitor) {
    monitor.dirty.forEach((path: string) =&gt; {
      console.info(`[Monitor] ${path} changed: ${monitor.value(path)?.before} → ${monitor.value(path)?.now}`);
    });
  }

  build() {
    Column({space :20}) {
      Text(`Name: ${this.user.name}`)
      Text(`Age: ${this.user.age}`)

      Button('Change Name')
        .onClick(() =&gt; {
          this.user.name += '*';
        })

      Button('Change Age')
        .onClick(() =&gt; {
          this.user.age += 1;
        })
    }.width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c8cd6bec4294142aaf464c00fb59e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=00Tzp0%2FHHhRKqN797LUtHsfBvxw%3D" alt="ezgif-8ec23a233ee42b61.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li><code>@Monitor</code>可以监听深层属性的变化，该深层属性需要被<code>@Trace</code>装饰</li>
<li><code>@Monitor</code>可以同时监听多个属性，这些属性之间用","隔开</li>
</ul>
<p>OK,到这鸿蒙的状态管理就结束了，接下来准备讲解鸿蒙的应用结构。</p>
<h2 data-id="heading-37">3、应用结构</h2>
<p>鸿蒙的应用结构有两种模型：FA模型与Stage模型。目前来说FA模型已经被淘汰了而且与Stage模型差异化非常大，因此这里就只分析Stage模型。</p>
<p>这是一个Stage模型基本概念图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98898291a9d8469cb581c3754f9c25f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=zpG5fSz3wazr47%2Br6uJmoZyFWfU%3D" alt="QQ_1765856024719.png" loading="lazy"/></p>
<p>如图所示，我们由浅入深逐步分析</p>
<ul>
<li>我们先看最下面那一排，从右往左依次看：<strong>一个App对应了一个Application，对应了独有的ApplicationContext</strong></li>
<li>接着我们再看倒数第二排：<strong>一个HAP对应了一个AbilityStage，也对应了独有的AbilityStageContext</strong></li>
<li>而一个HAP包含多个UIAbility，<strong>与WindowStage、Window、保持一对一的关系，与ArkUI Page保持一对多的关系</strong></li>
</ul>
<p>那现在问题来了，那个所谓的HAP是什么玩意儿呢？</p>
<h3 data-id="heading-38">3.1 应用程序包</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ded1f2532b0d465d8c75b689ad11b20d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=sL4P7U7Agv2%2FPsrwoxYJZjTHDyU%3D" alt="QQ_1765869962113.png" loading="lazy"/></p>
<p>如图所示：</p>
<ul>
<li>应用程序包可以<strong>只包含一个基础的entry包</strong>，也可以包含一个基础的entry包和多个功能性的feature包。</li>
<li>每个HAP对应配置文件<code>module.json5</code><strong>位置在：xx模块名/src/main/module.json5</strong></li>
<li>HAP包是由代码、资源、第三方库、配置文件等打包生成的模块包，其主要分为两种类型：entry和feature。
<ul>
<li>entry：应用的主模块，作为应用的入口，提供了应用的基础功能。</li>
<li>feature：应用的动态特性模块，作为应用能力的扩展，可以根据用户的需求和设备类型进行选择性安装。</li>
</ul>
</li>
</ul>
<p>同时也证明了一个HAP包含多个UIAbility，那我们就来看看所谓的UIAbility.</p>
<h4 data-id="heading-39">3.1.1 UIAbility介绍</h4>
<p>什么是UIAbility？</p>
<ul>
<li>
<p>UIAbility组件是一种包含UI界面的应用组件，主要用于和用户交互。</p>
</li>
<li>
<p>UIAbility组件是系统调度的基本单元，为应用提供绘制界面的窗口；</p>
</li>
<li>
<p>每一个UIAbility组件实例，都对应一个最近的任务列表中的任务（可参考：本文：1.2.2 AppStore 示例二）</p>
</li>
<li>
<p>一个UIAbility组件中可以通过多个页面来实现一个功能模块，而多个页面的跳转与参数传递则是通过路由来完成（稍后讲解）</p>
</li>
</ul>
<p>而多个UIAbility之间可以实现相互跳转（同样参考：本文：1.2.2 AppStore 示例二）</p>
<p>既然UIAbility有跳转，那么就会就有对应的生命周期</p>
<h4 data-id="heading-40">3.1.2 UIAbility生命周期</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a34d49301834edcbe836e9940f82b60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=ppTvOIyWNkzwZ7k0BvB2pWPEKLI%3D" alt="image.png" loading="lazy"/></p>
<p>如图所示，生命周期变化如下：</p>
<ul>
<li>onCreate()：当用户打开或切换到应用时，UIAbility被创建。就好像你打开一个应用，应用的页面被呈现在屏幕上；</li>
<li>onForeground()：当应用界面处于活跃状态时，它处于前台状态。这就像你正在使用一个应用，它是当前的焦点</li>
<li>onBackground():如果你切换到了其他应用，原来的应用就进入了后台状态。UIAbility也会相应的从前台变成后台状态。</li>
<li>onDestroy()：当你关闭应用或者应用被系统销毁时，UIAbility也会被销毁。就像你关闭一个应用，它的界面消失了</li>
</ul>
<p>既然UIAbility能够被创建，那么就会有对应的启动模式。</p>
<h4 data-id="heading-41">3.1.3 UIAbility启动模式</h4>
<p>UIAbility的启动模式是指UIAbility实例在启动时的不同呈现状态。针对不同的业务场景，系统提供了三种启动模式。</p>
<ul>
<li>
<p>singleton：单实例模式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0d92c2dd1444e7e956d96006bb04a06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=KnAts5YzEI4NUhyYuuKbQAVFqV8%3D" alt="0000000000011111111.20251216164032.56839417840799462044462024964320.gif" loading="lazy"/></p>
</li>
<li>
<p>multiton：标准多实例模式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4db09f5952e141c0acfc4723e270bbe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=7rJU00kkLcnY5joGgijBdxfnvRw%3D" alt="0000000000011111111.20251216164032.44819268877606056884279312217064.gif" loading="lazy"/></p>
</li>
<li>
<p>specified：指定实例模式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b1e290df584dc2a66fc71d0e827422~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=sNTKrTbz9LGyH5mGkxNwGcfSqJQ%3D" alt="0000000000011111111.20251216164032.35835215303035162549734666085126.gif" loading="lazy"/></p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ef556fa24304d78a52578e99fb2814b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=DGWhkq0lXgEAKFurv%2FCe%2BtgZ5mo%3D" alt="image.png" loading="lazy"/></p>
<p>如图所示：</p>
<ul>
<li>对应启动模式可在 对应模块下的配置文件(module.json5)，配置"launchType"属性</li>
</ul>
<p>那除了HAP，鸿蒙还有哪些应用程序包类型呢？</p>
<h4 data-id="heading-42">3.1.4 其他应用程序包介绍</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac61409b859844139398600e6c22d1cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=vU3TJeHEJzsAQIaOufk7wzz79Fw%3D" alt="QQ_1765937124856.png" loading="lazy"/></p>
<p>如图所示，应用程序包类型有：</p>
<ul>
<li>
<p>HAP：带有界面的库</p>
</li>
<li>
<p>HAR：静态共享库（API14后支持UIAbility）</p>
<ul>
<li>支持应用内共享，也可以作为二方库（SDK）、三方库（SDK）发布后供其他应用使用。</li>
<li>作为二方库（SDK），发布到<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Fide-ohpm-repo" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo" ref="nofollow noopener noreferrer">OHPM私仓</a>，供公司内部其他应用使用。</li>
<li>作为三方库（SDK），发布到<a href="https://link.juejin.cn?target=https%3A%2F%2Fohpm.openharmony.cn%2F%23%2Fcn%2Fhome" target="_blank" title="https://ohpm.openharmony.cn/#/cn/home" ref="nofollow noopener noreferrer">OHPM中心仓</a>，供其他应用使用。</li>
</ul>
</li>
<li>
<p>HSP：动态共享库</p>
<ul>
<li>应用内HSP：在编译过程中与应用包名（bundleName）强耦合，只能给某个特定的应用使用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Fintegrated-hsp" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/integrated-hsp" ref="nofollow noopener noreferrer">集成态HSP</a>：构建、发布过程中，不与特定的应用包名耦合；使用时，工具链支持自动将集成态HSP的包名替换成宿主应用包名，并且会重新签名生成一个新的HSP包，作为宿主应用的安装包，这个新的HSP也属于宿主应用HAP的应用内HSP</li>
</ul>
</li>
</ul>
<p>而HAR与HSP都可以实现代码和资源的共享，同时都不支持独立发布上架，必须与宿主的APP包一起发布。</p>
<p>OK！接下来就是我们最后一个知识点了——路由</p>
<h2 data-id="heading-43">4、路由</h2>
<p>页面路由指在应用程序中实现不同页面之间的跳转和数据传递。而官方目前给我们提供了两种路由跳转方式(<code>Router</code>与<code>Navigation</code>)。</p>
<p>先来看以前的老牌军<code>Router</code></p>
<h3 data-id="heading-44">4.1 Router</h3>
<p>Router的使用跳转都是基于Entry修饰的page组件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ad3b3d8a6b4924b0c4068c60d4f0f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=JDDzELJ2GXVjpL7kO23qSz6MKPk%3D" alt="QQ_1765952108413.png" loading="lazy"/></p>
<p>如图所示，Router都是基于<code>resources/base/profile/main-page.json</code>中的路由配置来跳转的。</p>
<p>同时Router提供了以下几个方法</p>
<ul>
<li>
<p>pushUrl</p>
<ul>
<li>目标页面不会替换当前页，而是压入页面栈。</li>
<li>保留当前页状态，可以通过返回键或者调用<code>back</code>方法返回当前页</li>
<li>跳转提供了两种实例模式，分别是Standard和Single，这决定了目标Url是否有多个实例</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">router.pushUrl({
  url: 'pages/Detail' // 目标url
  }, router.RouterMode.Standard, (err) =&gt; {
  
  });
</code></pre>
</li>
<li>
<p>replaceUrl</p>
<ul>
<li>目标页面会替换当前页，并销毁当前页</li>
<li>释放当前页的资源，并且无法返回到当前页</li>
<li>跳转提供了两种实例模式，分别是Standard和Single，这决定了目标Url是否有多个实例</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">router.replaceUrl({
  url: 'pages/Detail' // 目标url
  }, router.RouterMode.Single, (err) =&gt; {
  
  });
</code></pre>
</li>
<li>
<p>back 返回页面，可以使用以下几种方式返回页面</p>
<ul>
<li>方式一：返回到上一个页面</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">router.back();
</code></pre>
<ul>
<li>方式二：返回到指定页面</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">router.back({
  url: 'pages/Home'
});
</code></pre>
<ul>
<li>方式三：返回到指定页面，并传递自定义参数信息</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">router.back({
  url: 'pages/Home',
  params: {
    info: '来自Home页'
  }
});
</code></pre>
</li>
<li>
<p>clear</p>
<ul>
<li>清空页面栈中的所有历史页面，仅保留当前页面作为栈顶页面</li>
</ul>
<pre><code class="hljs language-ArkTS" lang="ArkTS">router.clear()
</code></pre>
</li>
<li>
<p>getParams ：获取传递的参数</p>
</li>
<li>
<p>getState ：获取当前路由状态</p>
</li>
<li>
<p>getLength ：获取当前所有的路由长度</p>
</li>
</ul>
<h4 data-id="heading-45">4.1.1 Router获取</h4>
<p>目前Router获取方式有两种：</p>
<p>一是通过<code>import</code>方式导入<code>ArkUI</code>库进行获取</p>
<pre><code class="hljs language-Ark" lang="Ark">import { router } from '@kit.ArkUI';

Button('跳转B页面').onClick( () =&gt; {
  router.pushUrl({url: 'pages/router/BPage'}, router.RouterMode.Single)
})

</code></pre>
<p>但这种方式可能会导致UI上下文不明确的问题。</p>
<p>第二种方式通过<code>getUIContext().getRouter</code>获取。</p>
<pre><code class="hljs language-Ark" lang="Ark">import { router } from '@kit.ArkUI';

Button('跳转B页面').onClick( () =&gt; {
  this.getUIContext().getRouter().pushUrl({url: 'pages/router/BPage'}, router.RouterMode.Single)
})

</code></pre>
<p>即使如此，官方还是不推荐使用<code>Router</code>跳转页面，推荐使用<code>Navigation</code>。</p>
<p>我们来看看它如何使用的。</p>
<h3 data-id="heading-46">4.2 Navigation</h3>
<p>组件导航(Navigation)主要用于实现Navigation页面间的跳转，支持在不同Navigation页面间传递参数，提供灵活的跳转栈操作，从而更便捷地实现对不同页面的访问和复用。</p>
<p>在API version 9上，Navigation需要配合NavRouter组件实现页面路由。从API version 10开始，更推荐使用NavPathStack实现页面路由。</p>
<p>因此我们直接用NavPathStack实现页面路由。</p>
<h4 data-id="heading-47">4.2.1 示例一：</h4>
<p><strong>NavigationExample.ets</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct NavigationExample {
  pageInfos: NavPathStack = new NavPathStack();
  build() {
    Navigation(this.pageInfos) {
      Column() {
        Button('pushPath')
          .width('80%')
          .height(40)
          .margin(20)
          .onClick(() =&gt; {
            this.pageInfos.pushPath({ name: 'pageOne' },
              { launchMode: LaunchMode.POP_TO_SINGLETON })
          })
      }
    }.title('NavIndex')
  }
}
</code></pre>
<p><strong>源码解析</strong></p>
<ul>
<li>
<p>定义了<code>NavPathStack</code>对象，并且在<code>build()</code>最外层套入了<code>Navigation</code>，并传入了<code>NavPathStack</code>对象</p>
</li>
<li>
<p>页面跳转时就可以通过<code>NavPathStack</code>对象进行跳转，即将跳转至<code>pageOne</code>页面</p>
</li>
<li>
<p><code>launchMode</code>表示页面的跳转模式</p>
<ul>
<li><code>STANDARD</code>：默认导航堆栈操作模式。在此模式下，推送操作将指定的NavDestination页面添加到堆栈中；替换操作替换当前顶部导航目标页面</li>
<li><code>MOVE_TO_TOP_SINGLETON</code>：当具有指定名称的NavDestination存在时，它将被移动到堆栈顶部，否则，行为将与STANDARD模式一致</li>
<li><code>POP_TO_SINGLETON</code>：当具有指定名称的NavDestination存在时，堆栈将弹出，直到该NavDestination为止，否则，行为将与STANDARD模式一致。</li>
<li><code>NEW_INSTANCE</code>：此模式创建NavDestination的实例。与STANDARD相比，此模式不重用堆栈中同名的实例。</li>
</ul>
</li>
</ul>
<p>这个没有什么难度，就是套了一层壳，继续看下一个页面</p>
<p><strong>PageOne</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">class TmpClass {
  count: number = 10;
}
@Builder
export function PageOneBuilder(name: string, param: Object) {
  PageOne()
}

@Component
export struct PageOne {
  pageInfos: NavPathStack = new NavPathStack();
  build() {
    NavDestination() {
      Column() {
        Button('pushPathByName')
          .width('80%')
          .height(40)
          .margin(20)
          .onClick(() =&gt; {
            let tmp = new TmpClass();
            this.pageInfos.pushPathByName('pageTwo', tmp); //将name指定的NavDestination页面信息入栈，传递的数据为param
          })

      }.width('100%').height('100%')
    }.title('pageOne')
    .onReady((context: NavDestinationContext) =&gt; {
      this.pageInfos = context.pathStack;
    })
  }
}
</code></pre>
<p><strong>PageTwo</strong></p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Builder
export function PageTwoBuilder(name: string, param: Object) {
  PageTwo()
}

@Component
export struct PageTwo {
  pathStack: NavPathStack = new NavPathStack();

  build() {
    NavDestination() {
      Column() {
        Button('pushPathByName', { stateEffect: true, type: ButtonType.Capsule })
          .width('80%')
          .height(40)
          .margin(20)
          .onClick(() =&gt; {
            this.pathStack.pushPathByName('pageOne', null);
          })
      }.width('100%').height('100%')
    }.title('pageTwo')
    .onReady((context: NavDestinationContext) =&gt; {
      this.pathStack = context.pathStack;
      console.info(`current page config info is ${JSON.stringify(this.pathStack.getParamByName('pageTwo'))}`);
    })
  }
}
</code></pre>
<p><strong>源码解析</strong></p>
<ul>
<li>注意看<code>PageOne</code>与<code>PageTwo</code>这两个结构体都没有<code>@Entry</code>，和<code>Router</code>不一样，页面必须含有<code>@Entry</code></li>
<li>其次需要创建对应的<code>Builder</code>，然后初始化对应页面的结构体</li>
<li>对应页面如果想要获取参数以及跳转其他页面，那么需要监听<code>NavDestination</code>的<code>onReady</code>方法，并且通过<code>NavDestinationContext</code>获取<code>NavPathStack</code>对象</li>
<li>如果对应页面有参数传递过来，那么还需要通过<code>NavPathStack.getParamByName</code>获取对应参数</li>
</ul>
<p>那么到这里，代码就完了么？我们先来运行下效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aa88b2646264094ad1b5b2e9b2293b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=Wr9Swd3vmVHfCweMxAVPhaRhsuo%3D" alt="ezgif-6692903ced929fcb.gif" loading="lazy"/></p>
<p>咦？好像不是想要的效果呢！</p>
<p>上面不是已经提到过<code>PageOne</code>与<code>PageTwo</code>这两个结构体都没有<code>@Entry</code>，那么使用<code>NavDestination</code>时，子页面需要额外添加配置</p>
<p>首先在对应的<code>src/main/resources/base/profile</code>文件夹下创建<code>router_map.json</code>，并将如下内容复制粘贴进去</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"routerMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pageOne"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"pageSourceFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/ets/pages/navigation/PageOne.ets"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"buildFunction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PageOneBuilder"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"this is pageOne"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pageTwo"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"pageSourceFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/ets/pages/navigation/PageTwo.ets"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"buildFunction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PageTwoBuilder"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>

<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后在对应的<code>src/main/module.json5</code>里面<code>module</code>结构下，添加如下代码<code>"routerMap":"$profile:router_map"</code></p>
<p>最后再次运行看看效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9e94b405474b88bc80938e59a3d741~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=4y0C7WHncSyLjgekEfMyM5XkWNI%3D" alt="ezgif-343061c71bafc524.gif" loading="lazy"/></p>
<p>那为什么添加了这些代码运行效果就达到了想要的呢？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ed143b030a648d9b6c0cf97a4afe2ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=guz33Fr5%2Bj%2FR4HGs1RaOMX07dYQ%3D" alt="QQ_1765961127994.png" loading="lazy"/></p>
<p>如图所示：</p>
<ul>
<li>在<code>router_map.json</code>配置文件里，配置对应的属性</li>
<li>然后在<code>module.json5</code>里面通过<code>"routerMap":"$profile:router_map"</code>指定配置文件</li>
</ul>
<p>是不是觉得很麻烦？没错！我也觉得！不仅麻烦，而且还严重侵入UI元素！还不如用回Router。</p>
<p>不过现在有个三方库，解决了官方<code>Navigation</code>配置麻烦的问题，我们来看看</p>
<h3 data-id="heading-48">4.3 HMRouter</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fohpm.openharmony.cn%2F%23%2Fcn%2Fdetail%2F%40hadss%252Fhmrouter" target="_blank" title="https://ohpm.openharmony.cn/#/cn/detail/@hadss%2Fhmrouter" ref="nofollow noopener noreferrer">点我访问HMRouter三方库中心仓</a></p>
<p>官方已经有非常详细的集成与使用步骤，我这就不详细分析了，不过可以看看实际使用效果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d045ae1df78649a29f2b67bcb9499463~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=KCBAAWXbI2ilTo9kMoDkc7zvKR4%3D" alt="QQ_1765963334860.png" loading="lazy"/></p>
<p>如图所示</p>
<ul>
<li>通过<code>@HMRouter({pageUrl: 'PageHome'})</code>定义了该组件的名称，</li>
<li>通过<code>HMRouterMgr.push</code>可以直接跳转至对应名称的组件</li>
</ul>
<p>来看看效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/235ab3bdfd894518a87b9271fbdc2b0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766657283&amp;x-signature=2CZ%2BYKpn6pGXQdqlif88AieAbQs%3D" alt="ezgif-3a07a0a600c2be72.gif" loading="lazy"/></p>
<h2 data-id="heading-49">5、结束语</h2>
<p>OK！这篇文章到这已经结束了，下一篇将会讲解鸿蒙动画以及多媒体相关功能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 Spring Boot 中接入 Amazon ElastiCache]]></title>    <link>https://juejin.cn/post/7584370833705418767</link>    <guid>https://juejin.cn/post/7584370833705418767</guid>    <pubDate>2025-12-17T08:01:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584370833705418767" data-draft-id="7584377629707452451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 Spring Boot 中接入 Amazon ElastiCache"/> <meta itemprop="keywords" content="Java,Redis,数据库"/> <meta itemprop="datePublished" content="2025-12-17T08:01:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿杆"/> <meta itemprop="url" content="https://juejin.cn/user/4182956056773160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 Spring Boot 中接入 Amazon ElastiCache
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4182956056773160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿杆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:01:01.000Z" title="Wed Dec 17 2025 08:01:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>缓存在服务端是一个非常重要的东西，今天我们来聊聊怎么把 <strong>Amazon ElastiCache应用整合到 Spring Boot</strong> 上，让服务响应提速、系统整体轻盈起来。</p>
<h2 data-id="heading-0">一、为什么你迟早要上缓存</h2>
<p>你有多少次在日志里看着那几百毫秒的 SQL 延迟叹气？尤其当系统访问量上去之后，每次都去查数据库，就像让人每次吃饭都去杀猪。数据库不是不给你干活，它只是累。</p>
<p>缓存就是那只“提前备好的猪”。   简单说，它在内存里帮你留存一份热数据，下次请求直接取，不再查数据库。于是性能暴涨、延迟骤降。</p>
<p>而  <strong>ElastiCache</strong> 是一套托管的缓存服务，<strong>兼容 Redis 或 Valkey 引擎</strong>，性能可直接起飞。官方说它能支持“百万级每秒操作、微秒级响应”，对 Spring Boot 应用来说简直是插上翅膀。</p>
<hr/>
<p>如果你没有亚马逊云账号，可以先去 <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Ffree%3Ftrk%3D7d27709e-0bfa-419d-808b-7b9e24f4f9d9%26sc_channel%3Dsm" target="_blank" title="https://aws.amazon.com/cn/free?trk=7d27709e-0bfa-419d-808b-7b9e24f4f9d9&amp;sc_channel=sm" ref="nofollow noopener noreferrer">亚马逊云科技官网</a> 注册一个，注册完成后可以领取最少6个月的 ElastiCache 免费套餐。</p>
<h2 data-id="heading-1">二、Spring Boot + ElastiCache 的组合思路</h2>
<p>整合思路其实特别直接，分几层来看：</p>
<ol>
<li><strong>应用层</strong>：Spring Boot 提供了缓存抽象（<code>@EnableCaching</code>、<code>@Cacheable</code> 等）。</li>
<li><strong>缓存层</strong>：ElastiCache 负责托管 Redis 服务，自动伸缩、自动备份、自动修复。</li>
<li><strong>运行逻辑</strong>：
<ul>
<li>先查缓存</li>
<li>
<ul>
<li>有 → 直接返回；    </li>
</ul>
</li>
<li>
<ul>
<li>没 → 查数据库，再把结果放进缓存。</li>
</ul>
</li>
</ul>
</li>
<li><strong>配置层</strong>：Spring Boot 配 Redis 客户端、连接信息、TTL、SSL 等。</li>
</ol>
<p>这样一来，数据库的压力能被明显削减，服务的响应速度也更稳定。</p>
<h2 data-id="heading-2">三、动手整合：Spring Boot 端配置</h2>
<p>我们直接来实操下，一步步搞起来。</p>
<h3 data-id="heading-3">1. 加依赖</h3>
<p>在 <code>pom.xml</code> 里加入两行依赖就行：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>第一个是缓存抽象层，第二个是 Redis 实现层。它俩搭配，就是官方标准套路。</p>
<h3 data-id="heading-4">2. 启用缓存功能</h3>
<p>在主类或者配置类上标注 <code>@EnableCaching</code>，就能让 Spring Boot 识别缓存注解。</p>
<p>然后在你的业务方法上加个 <code>@Cacheable</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheableComponent</span> {
  <span class="hljs-meta">@Cacheable</span>(<span class="hljs-string">"userCache"</span>)
  <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> uid</span>) {
      <span class="hljs-comment">// 模拟一次数据库调用</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryUserFromDB</span>(uid);
  }
}
</code></pre>
<p>第一次调用会触发实际逻辑，之后的调用直接从缓存返回。   Spring Boot 会自动帮你处理 key 生成和缓存写入，非常省心。</p>
<h3 data-id="heading-5">3. 配置 Redis 连接</h3>
<p>在 <code>application.yml</code> 中配置 ElastiCache 的连接地址和 TTL：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-string">my-elasticache-endpoint.amazonaws.com</span>
      <span class="hljs-attr">ssl:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">time-to-live:</span> <span class="hljs-string">10m</span>
</code></pre>
<p>解释一下：</p>
<ul>
<li><code>host</code> 就是你的 ElastiCache 实例地址；</li>
<li><code>ssl.enabled</code> 如果你启用了加密；</li>
<li><code>time-to-live</code> 控制缓存的过期时间，这里设 10 分钟。</li>
</ul>
<p>这几行配置基本能让缓存系统跑起来，咱们就先用这个简单的项目作为示例。</p>
<h2 data-id="heading-6">四、Amazon 端准备：建个 ElastiCache 实例</h2>
<p>如果你还没在 Amazon 上开缓存服务，可以直接用 “Serverless ElastiCache for Redis” 版本。   官方提供了命令行示例，大致是这样：</p>
<pre><code class="hljs language-lua" lang="lua">aws elasticache <span class="hljs-built_in">create</span>-serverless-cache \
  <span class="hljs-comment">--serverless-cache-name spring-demo \</span>
  <span class="hljs-comment">--engine redis \</span>
  <span class="hljs-comment">--subnet-ids subnet-xxxx subnet-yyyy</span>
</code></pre>
<p>创建完之后，再执行：</p>
<pre><code class="hljs language-css" lang="css">aws elasticache describe-serverless-caches \
  <span class="hljs-attr">--serverless-cache-name</span> spring-demo \
  <span class="hljs-attr">--query</span> "ServerlessCaches<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-class">.Endpoint</span><span class="hljs-selector-class">.Address</span>"
</code></pre>
<p>这一步会返回缓存的 endpoint，把它贴到你的 <code>application.yml</code> 里就行。   别忘了打开安全组访问规则，让你的应用主机能访问缓存的 6379 端口。</p>
<h2 data-id="heading-7">五、跑起来试试</h2>
<p>接下来就是验证缓存效果了。运行应用后，第一次请求接口时日志会显示实际方法被执行；</p>
<p>第二次请求时，你会发现方法体不再执行，而是直接返回缓存数据。</p>
<p>这时候你就知道，它已经成功跑起来了。</p>
<p>多说一句，ElastiCache 现在还支持一个叫 <strong>Valkey</strong> 的 Redis 兼容引擎。</p>
<p>它的好处是开源、兼容、可直接替换。如果你想试试更开放的方案，只需要在创建实例时把引擎参数从 <code>redis</code> 改成 <code>valkey</code> 即可。Spring Boot 这边的代码完全不用改。</p>
<h2 data-id="heading-8">六、踩坑警示</h2>
<p>下面是一些常见的注意事项，每一位服务端程序员都应该了解：</p>
<ol>
<li><strong>序列化格式</strong>：默认 JDK 序列化效率不高，建议改成 JSON 或 Kryo。</li>
<li><strong>缓存失效策略</strong>：TTL 设置要合理，避免缓存雪崩。</li>
<li><strong>监控</strong>：用 CloudWatch 监控缓存命中率、延迟、Eviction 情况。</li>
<li><strong>安全配置</strong>：生产环境一定要开 SSL 和访问控制。</li>
</ol>
<p>这些都是缓存落地后必须考虑的细节，不然你就等着半夜被叫醒修 bug 吧。</p>
<h2 data-id="heading-9">七、项目实践建议</h2>
<p>如果你现在手头正好有一个 Spring Boot 项目，可以按这个流程动手：</p>
<ol>
<li>先分析系统的热点接口，挑最耗时的地方加缓存；</li>
<li>设计合理的 key 结构，比如 <code>user:id</code>、<code>product:sku</code>；</li>
<li>在代码里启用 <code>@Cacheable</code>；</li>
<li>本地用 Redis 模拟，验证逻辑；</li>
<li>测试环境切换到 ElastiCache；</li>
<li>部署上线后监控命中率；</li>
<li>定期清理无效数据和优化 TTL。</li>
</ol>
<p>搞完这套下来，你的系统性能会稳得像加了氮气加速器。</p>
<h2 data-id="heading-10">八、结语</h2>
<p>缓存这玩意，说白了就是“用空间换时间”的艺术。</p>
<p>Spring Boot 给了你抽象层，ElastiCache 给了你基础设施，剩下的就看你会不会用。</p>
<p>别等到线上服务卡得像 PPT 才想起缓存。早点加，早点轻松。</p>
<p>以上就是本文的全部内容啦。最后提醒一下各位工友，如果后续不再使用相关服务，别忘了在控制台关闭，避免超出免费额度产生费用～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零搭建使用 Open-AutoGML 搜索附近的美食]]></title>    <link>https://juejin.cn/post/7584650421124382761</link>    <guid>https://juejin.cn/post/7584650421124382761</guid>    <pubDate>2025-12-17T10:49:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124382761" data-draft-id="7584640225645051967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零搭建使用 Open-AutoGML 搜索附近的美食"/> <meta itemprop="keywords" content="人工智能,Android"/> <meta itemprop="datePublished" content="2025-12-17T10:49:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Exploring"/> <meta itemprop="url" content="https://juejin.cn/user/2172290705131016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零搭建使用 Open-AutoGML 搜索附近的美食
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290705131016/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Exploring
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:49:17.000Z" title="Wed Dec 17 2025 10:49:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 环境配置</h2>
<p>下载项目库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a> ，
使用 Open-AutoGML 需要安装以下开发环境：</p>
<ul>
<li>python 环境</li>
<li>ADB 调试工具</li>
<li>ADB Keyboard(用于文本输入)</li>
<li>模型部署（可以使用 BigModel 三方模型）</li>
</ul>
<h3 data-id="heading-1">1.1. Python 环境搭建</h3>
<p>检查 python 环境。建议使用 Python 3.10 及以上版本。</p>
<pre><code class="hljs">python3 -V
</code></pre>
<p>这里建议使用虚拟环境创建对应的环境。可以使用 Poetry 或 Python 自带的虚拟环境管理。这里使用 Python 自带的虚拟环境管理。</p>
<ul>
<li>创建虚拟环境：python3 -m venv 环境名</li>
<li>激活虚拟环境：source 环境名/bin/activate</li>
<li>删除旧环境：rm -rf venv</li>
<li>用python3.9创建新环境：python3.9 -m venv venv</li>
<li>退出环境：deactivate</li>
</ul>
<p>安装示例如下：</p>
<pre><code class="hljs language-sql" lang="sql">➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) python3<span class="hljs-number">.10</span> <span class="hljs-operator">-</span>m venv venv3<span class="hljs-number">.10</span>
➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) source venv3<span class="hljs-number">.10</span><span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>activate
(venv3<span class="hljs-number">.10</span>) ➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) 
</code></pre>
<p>这样我们就进入了创建的3.14虚拟环境。</p>
<h3 data-id="heading-2">1.2. ADB 调试工具</h3>
<p>这里可以参照 Android 官方 ADB 指令的下载与安装文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftools%2Freleases%2Fplatform-tools%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/tools/releases/platform-tools?hl=zh-cn" ref="nofollow noopener noreferrer">developer.android.com/tools/relea…</a></p>
<p>adb 安装完毕后，可打开终端命令行来检查一下是否成功。</p>
<pre><code class="hljs language-arduino" lang="arduino">➜  ~ adb devices
List of devices attached
<span class="hljs-number">2212</span>d99e	device
</code></pre>
<h3 data-id="heading-3">1.3. ADB Keyboard(用于文本输入)</h3>
<p>下载 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FADBKeyboard.apk" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/ADBKeyboard.apk" ref="nofollow noopener noreferrer">安装包</a> 并在对应的安卓设备中进行安装。 注意，安装完成后还需要到 <code>设置-输入法</code> 或者 <code>设置-键盘列表</code> 中启用 <code>ADB Keyboard</code> 才能生效(或使用命令<code>adb shell ime enable com.android.adbkeyboard/.AdbIME</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FREADME.md%23how-to-use" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/README.md#how-to-use" ref="nofollow noopener noreferrer">How-to-use</a>)。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866b2c19d59a44eaa4b398d93c04a811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=QyYmAvYasAAz63gcLA1GSzgl31E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">1.4. 安装项目依赖</h3>
<p>将 Open-AutoGML（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a>）项目下载到本地后，进入该项目对应的环境。执行以下指令：</p>
<pre><code class="hljs language-erlang" lang="erlang">pip install -r requirements.txt 
pip install -e .
</code></pre>
<h3 data-id="heading-5">1.5. 启动模型服务</h3>
<p>你可以选择自行部署模型服务，或使用第三方模型服务商。如果机器资源比较大，可以选择自行部署模型服务。这里我选择使用<strong>智谱 BigModel。</strong></p>
<ul>
<li>文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fapi%2Fintroduction" target="_blank" title="https://docs.bigmodel.cn/cn/api/introduction" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/api/intr…</a></li>
<li><code>--base-url</code>: <code>https://open.bigmodel.cn/api/paas/v4</code></li>
<li><code>--model</code>: <code>autoglm-phone</code></li>
<li><code>--apikey</code>: 在智谱平台申请你的 API Key</li>
</ul>
<p>使用示例：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 使用智谱 BigModel</span>
python main.py --base-url <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/open.bigmodel.cn/api</span><span class="hljs-regexp">/paas/v</span>4 --model <span class="hljs-string">"autoglm-phone"</span> --apikey <span class="hljs-string">"your-bigmodel-api-key"</span> <span class="hljs-string">"打开美团搜索附近的火锅店"</span>
</code></pre>
<h4 data-id="heading-6">1.5.1. 验证 apiKey</h4>
<p>我们在智谱AI开放平台申请 apikey 后可以参照 API 使用文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fapi%2Fintroduction" target="_blank" title="https://docs.bigmodel.cn/cn/api/introduction" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/api/intr…</a>）来验证是否可用。</p>
<p>使用 curl 指令输入：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">curl -X POST <span class="hljs-string">"https://open.bigmodel.cn/api/paas/v4/chat/completions"</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-H <span class="hljs-string">"Authorization: Bearer YOUR_API_KEY"</span> \
-d <span class="hljs-comment">'{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
    <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个有用的AI助手。"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好，请介绍一下自己。"</span>
        }
    ],
    <span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>,
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">true</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p>输出类似下面的内容时说明可用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fca7d48b6c16488eae3d33227edaa029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=VmYVS0qQte7xx9%2Blwskm9VVsBHI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">2. 实操用智谱 AI 帮我点外卖</h2>
<p>在完成环境安装后，我们来进行一次火锅的搜索。在工程项目目录中执行：</p>
<pre><code class="hljs language-css" lang="css"> python <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span> <span class="hljs-attr">--base-url</span> https://open.bigmodel.cn/api/paas/v4 --model <span class="hljs-string">"autoglm-phone"</span> --apikey <span class="hljs-string">"apikey"</span> <span class="hljs-string">"打开美团搜索附近的火锅店"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0019ec9625eb452c8185e5ea1027c87c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=kKBrvzqQ%2BjctNtwH0z2t3tejpS4%3D" alt="desktop1.gif" loading="lazy"/></p>
<h2 data-id="heading-8">3. 常见错误</h2>
<h3 data-id="heading-9">3.1. ERROR: No matching distribution found for Pillow&gt;=12.0.0</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">ERROR:</span> No matching distribution found <span class="hljs-keyword">for</span> Pillow&gt;=<span class="hljs-number">12.0</span>.<span class="hljs-number">0</span>
<span class="hljs-symbol">WARNING:</span> You are <span class="hljs-keyword">using</span> pip version <span class="hljs-number">21.1</span>.<span class="hljs-number">2</span>; however, version <span class="hljs-number">25.3</span> <span class="hljs-built_in">is</span> available.
You should consider upgrading via the <span class="hljs-comment">'/Users/dengshiwei/Documents/AI/Open-AutoGLM/venv/bin/python -m pip install --upgrade pip' command.</span>
</code></pre>
<p>使用的 python3.14 版本，在安装依赖时找不到 Pillow &gt;= 12.0.0 的版本，解决方法时降低到 python 版本到 3.10。这里可以使用 pyenv 来管理本地多个 python 版本。</p>
<pre><code class="hljs language-sql" lang="sql">brew <span class="hljs-keyword">update</span>
brew install pyenv
pyenv install <span class="hljs-number">3.10</span><span class="hljs-number">.14</span>
进入到项目，切换对应的 python 版本：pyenv <span class="hljs-keyword">local</span> <span class="hljs-number">3.10</span><span class="hljs-number">.14</span>
</code></pre>
<h3 data-id="heading-10">3.2. 键盘没效果</h3>
<p>我本地已经展示安装了键盘，但是运行 main.py 时还是提示找不到。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8498eef71b564b82a86e530ae71446b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=VIo%2BI6cp5a2DPuumTXqUJOc%2BKbQ%3D" alt="" loading="lazy"/></p>
<p>这里的原因是源码中的检测方法遇到手机权限的问题。</p>
<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-attr">result</span> = subprocess.run(
          <span class="hljs-section">["adb", "shell", "ime", "list", "-s"]</span>,
          <span class="hljs-attr">capture_output</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">text</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">timeout</span>=<span class="hljs-number">10</span>,
      )
</code></pre>
<p>本质上是 <code>adb shell ime list -s</code> 指令，但是很多手机都没权限了。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">java.lang.SecurityException:</span> <span class="hljs-string">uid</span> <span class="hljs-number">2000 </span><span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">have</span> <span class="hljs-string">android.permission.WRITE_SECURE_SETTINGS.</span>
</code></pre>
<p>这里可以改为：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">result</span> = subprocess.run(
    <span class="hljs-section">["adb", "shell", "settings", "get", "secure", "enabled_input_methods"]</span>,
    <span class="hljs-attr">capture_output</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">text</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">timeout</span>=<span class="hljs-number">3</span>,
)
</code></pre>
<p>后续我会提交一个 MR 来兼容一下这个问题。</p>
<h2 data-id="heading-11">4. 体验感受</h2>
<p>使用 <strong>智谱 BigModel 的模型情况下，</strong> 环境的搭建还是比较方便的，能够很快把开发环境搭建完成。如果是本地部署模型会比较耗费时间。总体来看还是比较智能的，能够操作挺多 App 的，还需要继续体验，但是目前感觉要商业化这个耗时还得继续优化，我执行了一个搜索火锅的指令，大概整体耗时在35s左右，跟中兴的 AI 手机体验比，耗时还有点多。持续进步吧。</p>
<p>#AutoGLM #智谱AI #OpenAutoGLM</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打破 IK 分词“架构陷阱”——阿里云 ES Serverless 索引级词典的完美热更新实践]]></title>    <link>https://juejin.cn/post/7585024562216239144</link>    <guid>https://juejin.cn/post/7585024562216239144</guid>    <pubDate>2025-12-18T10:41:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585024562216239144" data-draft-id="7584997357445529640" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打破 IK 分词“架构陷阱”——阿里云 ES Serverless 索引级词典的完美热更新实践"/> <meta itemprop="keywords" content="搜索引擎"/> <meta itemprop="datePublished" content="2025-12-18T10:41:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打破 IK 分词“架构陷阱”——阿里云 ES Serverless 索引级词典的完美热更新实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T10:41:52.000Z" title="Thu Dec 18 2025 10:41:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在做过 Elasticsearch 中文搜索研发的同学中，IK 分词器几乎是标配。它简单、高效，覆盖了大多数中文业务场景，被广泛用于电商、资讯、社区等搜索系统。然而，在一些业务场景中，IK 分词器可能会带来意想不到的线上事故，尤其是在大促、热词高峰等对搜索稳定性要求极高的时期。本文将通过一个真实事故的复盘，解析开源 IK 分词器架构设计中的不足，并介绍阿里云 ES Serverless 如何通过“索引级词典”能力，彻底解决热更新引发的搜索错配问题。</p>
<h2 data-id="heading-0">一、事故复盘：一次常规操作，引发 P0 事故</h2>
<h3 data-id="heading-1">背景</h3>
<p>某电商平台大促前夕，运营发现网络热梗 “哈基米”（指代猫咪/宠物）的搜索量飙升。由于 IK 默认词典中没有该词，查询时会被切分为 [哈, 基, 米] ——导致召回了大量无关商品，转化极低。运营立即提出需求：必须让“哈基米”精确匹配相关商品。</p>
<h3 data-id="heading-2">操作过程</h3>
<p>“标准”的变更：</p>
<ul>
<li>
<p>在已有词典中新增词组“哈基米”，并触发了集群所有节点的热更新。</p>
</li>
<li>
<p>_analyze 接口验证通过：哈基米 已被正确识别为一个完整 Term。</p>
</li>
</ul>
<h3 data-id="heading-3">事故发生</h3>
<p>然而，就在词典热更新完成的那一瞬间，线上的实时搜索崩了</p>
<ul>
<li>
<p>新数据（正常）： 刚刚上架的“哈基米”商品能搜到。</p>
</li>
<li>
<p>旧数据（消失）：之前写入的所有包含“哈基米”描述的存量商品，全部搜不到了！</p>
</li>
</ul>
<p>原因却扑朔迷离——没有改动索引，却瞬间导致存量数据全部失效。</p>
<p>**结果：**本来想提升用户体验，结果搜索挂了，GMV 跌了，一次常规优化演变成了 P0 级线上事故。</p>
<p><img src="https://static001.geekbang.org/infoq/95/954cf36bf961711d6f68a306830c061b.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">二、深度解析：IK词典热更新的“时空错乱”</h2>
<p>为什么会这样？这并非 ES 的 Bug，而是 开源 IK 插件的设计机制 与 倒排索引特性 之间的一次正面碰撞。</p>
<h3 data-id="heading-5">核心冲突：动态词典 vs 静态索引</h3>
<ul>
<li>IK 插件的“全局单例”机制（The Global Singleton）：</li>
</ul>
<p>IK 分词器采用全局共享词典的实现策略。这意味着，一旦触发热更新，整个集群上所有使用 IK 的索引（无论新旧）都会立即、强制使用新词典进行查询分词。这是一个“牵一发而动全身”的操作。</p>
<ul>
<li>ES 索引的“不可变”特性（The Immutable Index）：</li>
</ul>
<p>当写入文档时，其字段内容经过分词后，生成的 Term 被写入倒排索引。数据一旦写入，生成的倒排索引（Term）就被“固化”了。</p>
<p>这就是冲突的根源： 你为了“未来”的数据（新热词）更新了全局词典，却无意中破坏了“过去”数据的查询匹配逻辑。</p>
<h3 data-id="heading-6">错位图解：拿着新地图找旧地址</h3>
<p>让我们清晰地梳理下事故发生的过程：</p>
<ul>
<li>
<p>热更新前（旧词典）： “哈基米”被切分为 [哈, 基, 米] 三个单字存入倒排索引。</p>
</li>
<li>
<p>热更新后（新词典）： 当“哈基米”被加入到词典后，搜索词“哈基米”被解析为整体 Term [哈基米]。</p>
</li>
</ul>
<p><strong>结果：</strong></p>
<p>拿着新 Term 哈基米 去找旧索引里的单字 哈、基、米 完全匹配不上！这就像是“时空错乱”：你拿着今天的新地图（新词典），去导航昨天的旧城市（旧索引），路早就变了，当然找不到目的地。</p>
<p><img src="https://static001.geekbang.org/infoq/8a/8a3d5ee507c7cd5dc922760c900f443c.webp" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">三、传统解法：三种“续命”方案</h2>
<p>在搜索系统里，词典版本错配是一类高频且棘手的问题：</p>
<ul>
<li>
<p>一旦新词典上线，而索引里的数据仍是按旧分词规则建立，搜索便可能非预期的异常。</p>
</li>
<li>
<p>对用户而言，表现是老数据匹配结果异常，之前可以搜索到的数据全部“消失”了。</p>
</li>
<li>
<p>对运维而言，要保证 新词典配置 与 索引数据分词结果 同步，需要在“性能、体验、成本”之间做艰难平衡。</p>
</li>
</ul>
<p>为缓解这一问题，业内常用三种方案来给业务“续命”——即在不彻底停机的情况下，尽量让新词生效并维持线上查询稳定。</p>
<p>三种常用方案详情如下：</p>
<p><img src="https://static001.geekbang.org/infoq/76/76e10fb814964f244208b6dd4fe75343.png" alt="" loading="lazy"/></p>
<p>然而，这些方案无一能够同时做到：</p>
<ul>
<li>
<p>无感热更新：让用户完全察觉不到后台切换过程</p>
</li>
<li>
<p>精准匹配新词：新热词即刻命中，不受旧分词影响</p>
</li>
<li>
<p>不影响存量数据搜索：老数据搜索结果保持稳定无偏差</p>
</li>
</ul>
<p>正因为如此，我们需要寻找一种既能让词典版本与数据版本完美对齐，又不会牺牲线上可用性的全新解法。</p>
<h2 data-id="heading-8">四、阿里云 ES Serverless 破局：索引级词典隔离</h2>
<p>所以，为了解决开源 IK 插件的“全局单例”词典机制导致的冲突，阿里云 ES Serverless 通过在内核层面的改造，推出 “集群-索引-分词器”三级词典配置体系：</p>
<h3 data-id="heading-9">多级词典体系设计</h3>
<p>该体系将词典的控制权从“集群/节点级”下放，允许在不同层级进行精细化配置，并遵循明确的优先级规则：分词器级别 &gt; 索引级别 &gt; 集群（租户）级别。</p>
<ul>
<li>
<p>集群级（Cluster-level）：由管控平台统一下发基础词典，保障全集群（租户）基础词汇一致性，优先级最低。</p>
</li>
<li>
<p>索引级（Index-level）：为每个索引绑定专属扩展词典和停用词典，精准解决“时空错位”问题的关键。</p>
</li>
<li>
<p>分词器级（Analyzer-level）：为索引内的某个自定义分词器配置专用词典，满足特定字段的特殊分词需求，优先级最高。</p>
</li>
</ul>
<p>典型场景示例：对 实时新增热词 场景，“索引级别词典”能力提供了完美的解决方案，可为不同索引绑定不同版本，例如：</p>
<ul>
<li>
<p>product_v1 → dict_v1</p>
</li>
<li>
<p>product_v2 → dict_v2</p>
</li>
</ul>
<p>它们可在同一集群内互不干扰、并行存在，让新旧版本词典同时在线，彻底解决“新旧不兼容”的时空错乱问题。</p>
<h3 data-id="heading-10">热更新无感流程</h3>
<p>以“哈基米”为例：</p>
<ul>
<li>
<p>Step 1 隔离运行</p>
</li>
<li>
<p>product_v1（绑定别名product_alias） 仍用旧词典 dict_v1。</p>
</li>
<li>
<p>线上用户查询不受影响，存量数据照常匹配。</p>
</li>
<li>
<p>Step 2 构建新索引</p>
</li>
<li>
<p>新建 product_v2 并绑定含“哈基米”的 dict_v2。</p>
</li>
<li>
<p>用离线链路或 _reindex 将数据写入新索引。</p>
</li>
<li>
<p>建议：</p>
</li>
</ul>
<p>对于大规模业务，建议直接复用 T+1 离线链路（如 DTS/ODPS/Flink），将数据重新灌入 product_v2。这是最标准、最高效的做法。</p>
<ul>
<li>
<p>Step 3 原子切换流量</p>
</li>
<li>
<p>数据追平后，将product_v2 绑定到 product_alias ，同时下掉product_v1，实现流量的原子切换。</p>
</li>
</ul>
<h3 data-id="heading-11">效果</h3>
<p>通过这一套 多级词典 + 流量原子切换 的组合拳，我们实现了 词典版本与数据版本的完美对齐：</p>
<ul>
<li>零中断：</li>
</ul>
<p>更新全程用户无感，整个更新和切换过程对线上用户完全透明，没有服务中断或查询失败的窗口。</p>
<ul>
<li>精准匹配：</li>
</ul>
<p>流量切换后，新词即刻生效，新旧数据查询逻辑对齐，搜索“哈基米”立刻精准命中，且整个过程没有任何“查询断层”或“服务闪断”。</p>
<ul>
<li>弹性支持：</li>
</ul>
<p>结合 Serverless 的自动扩缩容，应对大促算力峰值。</p>
<p><img src="https://static001.geekbang.org/infoq/c8/c8d79eb50eeb0bcd214e2b192070e78d.webp" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">额外优势：内核优化的隐性收益</h3>
<p>除了索引级词典，Serverless 版本还具有以下优势：</p>
<ul>
<li>
<p>避免词典脑裂：保证集群内节点词典统一。</p>
</li>
<li>
<p>无感升级：同步开源 IK 与原生 ES 新特性。这些能力让你的热词更新从一件“高风险运维操作”，变成稳定、安全的日常操作。</p>
</li>
</ul>
<h2 data-id="heading-13">五、附录</h2>
<h3 data-id="heading-14">“休克疗法”更新指南</h3>
<p>假设线上的索引是 product_v1。</p>
<p><strong>a. 准备阶段：更新词典并验证词典是否生效</strong></p>
<p>ⅰ. 更新 IK 远程词典，加入词组“哈基米”。</p>
<p>ⅱ. 等待词典加载完成，并测试新词组是否生效。</p>
<p><strong>b. 执行阶段：索引数据更新</strong></p>
<p>ⅰ. 选择业务低峰期（如凌晨），调用 _update_by_query API，对索引中全部数据进行更新。</p>
<pre><code class="hljs language-ini" lang="ini">POST /product_v1/_update_by_query?<span class="hljs-attr">refresh</span>=<span class="hljs-literal">true</span>&amp;conflicts=proceed

<span class="hljs-comment"># 如果使用异步方式，可以通过以下命令查看任务状态</span>
GET /_tasks?<span class="hljs-attr">detailed</span>=<span class="hljs-literal">true</span>&amp;actions=*update_by_query*
</code></pre>
<p><strong>c. 验证阶段：验证分词是否生效</strong></p>
<p>ⅰ. 待 <code>_update_by_query</code> 任务完成后，可以通过<code>termvectors</code>来查看实际索引的词。</p>
<pre><code class="hljs language-bash" lang="bash">GET /product_v1/_termvectors/{<span class="hljs-built_in">id</span>}
</code></pre>
<h3 data-id="heading-15">传统方案“打补丁”实操指</h3>
<p>为“哈基米”紧急上线同义词补丁</p>
<p><strong>a. 准备阶段：在词典中新增“哈基米”，定义带同义词的查询分词器</strong></p>
<p>ⅰ. 通过 <code>PUT /_settings</code> API，加入 <code>synonym_graph</code> 过滤器和使用它的新分词器。</p>
<pre><code class="hljs language-bash" lang="bash">PUT /product_v1/_settings
{
  <span class="hljs-string">"analysis"</span>: {
    <span class="hljs-string">"filter"</span>: {
      <span class="hljs-string">"my_synonym_graph"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"synonym_graph"</span>,
        <span class="hljs-string">"synonyms"</span>: [
          // 核心规则：将新词映射回旧的切分结果
          <span class="hljs-string">"哈基米, 哈 基 米"</span>
        ]
      }
    },
    <span class="hljs-string">"analyzer"</span>: {
      <span class="hljs-string">"my_search_analyzer"</span>: {
        <span class="hljs-string">"tokenizer"</span>: <span class="hljs-string">"ik_smart"</span>,
        <span class="hljs-string">"filter"</span>: [ <span class="hljs-string">"my_synonym_graph"</span> ]
      }
    }
  }
}
</code></pre>
<p><strong>b. 应用阶段：将同义词规则应用到索引字段，并更新 Mapping</strong></p>
<p>ⅰ. 最后，更新字段的 <code>mapping</code>，指定在查询时使用我们新定义的 <code>my_search_analyzer</code>。</p>
<pre><code class="hljs language-json" lang="json">PUT /product_v1/_mapping
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"analyzer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ik_max_word"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 写入时保持原样，分词为[哈,基,米]</span>
      <span class="hljs-attr">"search_analyzer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my_search_analyzer"</span> <span class="hljs-comment">// 查询时应用同义词补丁</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>c. 效果</strong>：完成以上操作后，搜索“哈基米”就能匹配到包含 <code>哈</code> <code>基</code> <code>米</code> 的旧文档了。</p>
<h3 data-id="heading-16">Serverless 配置实操</h3>
<p><strong>前提</strong>：已经在 Serverless 控制台上传词典，词典ID标识为 <code>dict_v1</code> 和 <code>dict_v2</code></p>
<h4 data-id="heading-17">Step 1： 线上服务稳定运行</h4>
<p>在创建索引 <code>product_v``1</code> 时，为其指定词典 <code>dict_v1</code>（如在创建索引时未指定词典，也可以通过PUT {index}/_settings REST API配置）</p>
<pre><code class="hljs language-bash" lang="bash">PUT /product_v1
{
  <span class="hljs-string">"settings"</span>: {
    <span class="hljs-string">"number_of_shards"</span>: 5,
    <span class="hljs-string">"number_of_replicas"</span>: 1,
    <span class="hljs-string">"ik.extra_dict_ids"</span>: <span class="hljs-string">"dict-v1"</span>
  },
  <span class="hljs-string">"mappings"</span>: {
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"content"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
        <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
        <span class="hljs-string">"search_analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>
      }
    }
  }
}

或

PUT /product_v1/_settings
{
  <span class="hljs-string">"index"</span>:{
     <span class="hljs-string">"ik.extra_dict_ids"</span>: <span class="hljs-string">"dict-v1"</span>
  }
}
</code></pre>
<p>将别名 <code>product_alias</code> 指向索引 <code>product_v1</code></p>
<pre><code class="hljs language-bash" lang="bash">POST /_aliases
{
  <span class="hljs-string">"actions"</span>: [
    { <span class="hljs-string">"add"</span>:    { <span class="hljs-string">"index"</span>: <span class="hljs-string">"product_v1"</span>, <span class="hljs-string">"alias"</span>: <span class="hljs-string">"product_alias"</span>, <span class="hljs-string">"is_write_index"</span>: <span class="hljs-literal">true</span> } }
  ]
}
</code></pre>
<p>批量写入数据</p>
<pre><code class="hljs language-css" lang="css">PUT product_alias/_bulk
{"index": {"_id": <span class="hljs-number">1</span>}}
{"<span class="hljs-attribute">content</span>": <span class="hljs-string">"哈雷彗星"</span>}
{"index": {"_id": <span class="hljs-number">2</span>}}
{"<span class="hljs-attribute">content</span>": <span class="hljs-string">"基础版本人工智能"</span>}
{"index": {"_id": <span class="hljs-number">3</span>}}
{"<span class="hljs-attribute">content</span>": <span class="hljs-string">"米是一种食物"</span>}
{"index": {"_id": <span class="hljs-number">5</span>}}
{"<span class="hljs-attribute">content</span>": <span class="hljs-string">"哈基米是猫咪"</span>}
</code></pre>
<p><code>product_v1</code> 将使用词典 <code>dict_v1</code> 运行。</p>
<pre><code class="hljs language-bash" lang="bash">GET product_alias/_search
{
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"match"</span>: {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"哈基米"</span>
    }
  }
}
</code></pre>
<p><img src="https://static001.geekbang.org/infoq/28/2853b14c8fba08b1a2d96bdbc5c52b2c.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">Step 2： 安全、无感的引入新词典</h4>
<p>创建包含“哈基米”词组的新词典 <code>dict_v2</code>，新建索引 <code>product_v2</code>，并为其指定新词典</p>
<pre><code class="hljs language-css" lang="css">PUT product_v2
{
  "settings": {
    "number_of_shards": <span class="hljs-number">5</span>,
    <span class="hljs-string">"number_of_replicas"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"ik.extra_dict_ids"</span>: <span class="hljs-string">"dict-v2"</span>
  },
  "mappings": {
    "properties": {
      "<span class="hljs-attribute">content</span>": {
        "type": <span class="hljs-string">"text"</span>,
        <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
        <span class="hljs-string">"search_analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>
      }
    }
  }
}
</code></pre>
<p>通过 API <code>_reindex</code> 将 <code>product_v1</code> 索引中的数据更新到 <code>product_v2</code> 中。</p>
<pre><code class="hljs language-json" lang="json">POST _reindex
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"product_v1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dest"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"product_v2"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后将别名 <code>product_alias</code> 指向索引 <code>product_v2</code></p>
<pre><code class="hljs language-bash" lang="bash">POST /_aliases
{
  <span class="hljs-string">"actions"</span>: [
    { <span class="hljs-string">"remove"</span>:    { <span class="hljs-string">"index"</span>: <span class="hljs-string">"product_v1"</span>, <span class="hljs-string">"alias"</span>: <span class="hljs-string">"product_alias"</span> } },
    { <span class="hljs-string">"add"</span>:    { <span class="hljs-string">"index"</span>: <span class="hljs-string">"product_v2"</span>, <span class="hljs-string">"alias"</span>: <span class="hljs-string">"product_alias"</span>, <span class="hljs-string">"is_write_index"</span>: <span class="hljs-literal">true</span> } }
  ]
}
</code></pre>
<p>由于 <code>products_v2</code> 已经绑定了新词典，所有新写入的数据都会正确地将“哈基米”索引为一个完整的 Term。</p>
<p>此时查询结果如下：</p>
<p><img src="https://static001.geekbang.org/infoq/b3/b32137a217b1b1892db1d455acaececa.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-19">六、结尾</h2>
<p>开源 IK 分词器的节点级全局词典机制，在动态热更新场景下，与 ES 的静态倒排索引天然冲突。传统解法要么牺牲业务连续性，要么增加运维成本。</p>
<p>阿里云 ES Serverless 通过 “索引级词典” 架构，彻底消除了这一冲突，实现：</p>
<ul>
<li>
<p>新旧数据版本的无缝兼容</p>
</li>
<li>
<p>热更新过程的全程透明</p>
</li>
<li>
<p>集群资源的最大化利用</p>
</li>
</ul>
<p><strong>告别“配置地狱”，回归业务价值！不再让一次简单的热词更新，变成线上事故。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android AI解放生产力（三）：认识custom_prompts和skills]]></title>    <link>https://juejin.cn/post/7585005164726075430</link>    <guid>https://juejin.cn/post/7585005164726075430</guid>    <pubDate>2025-12-18T09:28:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585005164726075430" data-draft-id="7584831190730768410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android AI解放生产力（三）：认识custom_prompts和skills"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-18T09:28:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TimeFine"/> <meta itemprop="url" content="https://juejin.cn/user/3913917123802615"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android AI解放生产力（三）：认识custom_prompts和skills
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917123802615/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TimeFine
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:28:18.000Z" title="Thu Dec 18 2025 09:28:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>接上篇</p>
<p>这两项是在使用AI辅助编程时必须了解的。是不是写提示词写的很烦，并且是很多重复的劳动？让custom_prompts和skills来帮忙。</p>
<h2 data-id="heading-0">一、自定义Prompts</h2>
<p>它的作用就是把重复的提示词固定下来，下次直接加入到Codex的上下文。下面是实现步骤及用法。</p>
<h3 data-id="heading-1">1、创建prompts文件夹</h3>
<p>在<code>~/.codex</code>进入<code>.codex</code>文件夹，创建<code>prompts</code>文件夹,在<code>prompts</code>中就可以创建一个个Markdown就可以固定下来一个个提示词了。</p>
<h3 data-id="heading-2">2、编辑提示词</h3>
<p>假如我们创建了一个<code>figma_ui.md</code>的文件，这个文件就是固定下来通过Figma MCP转换Android原生XML UI的提示词，那应该如何编辑<code>figma_ui.md</code>文件呢？是有固定格式的。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">---
description: 使用Figma MCP生成Android 原生XML布局代码
argument-hint: [NOTE=]
---

这里就写固定下来的提示词...
</code></pre>
<p>NOTE就是可以插入内容的占位符，用的不多，看个人发挥。</p>
<h3 data-id="heading-3">3、使用</h3>
<p>编辑好后保存，输入<code>/prompts</code>就可以看到了,如果要追加NOTE内容就按Tab,不追加就按回车：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a775c2fbb10e43428f3f0bb522df603e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGltZUZpbmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766654940&amp;x-signature=ybZvX3Fz7QU5lzH6n0go3p%2BV0tY%3D" alt="image.png" loading="lazy"/></p>
<p>这样提示词就追加到了Codex的上下文。</p>
<h2 data-id="heading-4">二、编辑skills</h2>
<p>skill是什么？skill其实是沉淀下来的一项项技能，比如项目中创建Activity，每个项目中肯定有一套固定下来创建Activity的代码，继承谁实现什么函数，全是模板代码，而这种固定的模板代码就可以抽取为一个个skill，注意skill是能力，不是模版。</p>
<h3 data-id="heading-5">1、创建skills文件夹</h3>
<p>在<code>~/.codex</code>进入<code>.codex</code>文件夹，创建<code>skills</code>文件夹,在<code>skills</code>文件夹中可以存放一个个skill.</p>
<h3 data-id="heading-6">2、编辑skill</h3>
<p>还是以Figma UI来举例，在<code>skills</code>文件夹创建一个子文件夹，子文件夹名字是<code>figma_ui_to_xml</code>，然后在<code>figma_ui_to_xml</code>内创建一个Markdown文件，文件名是固定的<code>SKILL.md</code>。</p>
<p>这个文件的头部也是固定的<code>name</code>和<code>description</code>, 用来暴露skill 能力的名字和描述，注意这二个特别重要，因为skill是一般不会显示调用的，skill的能力能不能被调用到，就是看与<code>name</code>和<code>description</code>的匹配度，匹配度高AI认为需要使用这个skill, 就会把这个skill的提示词加载进上下文。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">---
name: figma_ui_to_xml
description: Implement <span class="hljs-keyword">this</span> Figma design。将Figma MCP链接转换为Android原生XML。
---

写提示

</code></pre>
<h3 data-id="heading-7">3、使用</h3>
<p>隐式调用：方便快捷(推荐)。</p>
<p>比如在放入Figma MCP链接时前面加上<code>Implement this Figma design</code>。那么因为匹配到了<code>figma_ui_to_xml</code>的<code>description</code>的语句，所以会自动使用这个skill。</p>
<p>显示调用：直接，明确。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69837b37aab64edca0f559f08a7e17bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGltZUZpbmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766654940&amp;x-signature=2f9WvDhgMYG7lDByxBABGKB6yRg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1eb2746391a410c9867e0a9e9cbde6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGltZUZpbmU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766654940&amp;x-signature=RQRPpEXp7UbOb0pgfgmpVozQfBY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">三、该用谁？</h2>
<p>一般情况下都推荐用skill, 项目中的规范写法、一套一套的模版代码、各种能力都适合归纳为skill,然后让AI自动判断适合用哪个skill。而prompt适合与项目没有强关联的，偶尔要问那么一次的，每次编辑都很烦的，就可以固定成自定义prompt。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[世界模型：AI的下一个里程碑]]></title>    <link>https://juejin.cn/post/7584909732613554211</link>    <guid>https://juejin.cn/post/7584909732613554211</guid>    <pubDate>2025-12-18T09:30:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584909732613554211" data-draft-id="7584909732613505059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="世界模型：AI的下一个里程碑"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-18T09:30:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智见AGI"/> <meta itemprop="url" content="https://juejin.cn/user/4145611877132986"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            世界模型：AI的下一个里程碑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4145611877132986/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智见AGI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:30:49.000Z" title="Thu Dec 18 2025 09:30:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>引言</strong></p>
<p>当OpenAI的Sora横空出世，用一段60秒的高清视频震撼整个AI界时，很多人还不知道，这背后真正的技术革命叫做"世界模型"（World Model）。</p>
<p>如果说大语言模型（LLM）让AI学会了"说话"，那么世界模型则是要让AI学会"理解世界"——不仅仅是文字和语言，而是真正理解物体如何运动、光影如何变化、物理规律如何作用。这是AI通往通用人工智能（AGI）道路上的关键一步。</p>
<p><strong>什么是世界模型？</strong></p>
<p><strong>从人脑的"心智模型"说起</strong></p>
<p>从历史脉络来看，世界模型的思想最早可追溯到 20 世纪 60 年代 Minsky 提出的 <strong>框架理论（Frame System Theory）</strong> ，以及强化学习中用于建模环境动态的方法。进入深度学习时代，2018 年 Ha 等人提出的循环神经网络隐式模型，重新点燃了学界对世界模型的研究热情。近年来，随着 <strong>大语言模型（LLM）、自监督学习（JEPA 架构）、视频生成与交互式三维环境</strong> 等技术的快速发展，世界模型逐渐成为人工智能跨模态、跨任务的重要研究方向。</p>
<p>同时，世界模型的概念并非仅源自人工智能本身，而是深植于心理学与认知科学传统。早在 20 世纪 40 年代，Craik 就提出人类会在大脑中构建一个外部世界的"小型模拟器"，通过这个模拟器来预测未来、评估不同选择的后果，从而做出更安全、更明智的决策。1980 年代，Johnson-Laird 系统化提出“心理模型理论（Mental Model）”，揭示了人类推理依赖于对不同可能世界的模拟。</p>
<p>想象一个棒球击球手：球飞向他的瞬间，他的大脑会快速模拟球的轨迹、预判落点、计算挥棒时机。这个过程不是靠死记硬背，而是基于对物理世界的理解——重力、速度、角度等。</p>
<p>AI中的世界模型正是受此启发：构建一个能够理解和模拟真实世界动态的内部表征系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/382a5edf1b034608b02880c7c5063277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766655049&amp;x-signature=wgZ0HUasQ0MnvgJgHYq42BMk3Uk%3D" alt="图片" loading="lazy"/></p>
<p>图1 世界模型的本质目标，即理解外部世界的动态并预测未来情景。时间线展示了关键定义和应用的发展。</p>
<p><strong>技术定义</strong></p>
<p><strong>世界模型是一种AI系统，能够：</strong></p>
<ul>
<li>学习环境的内部表征（包括物理规律、空间关系、因果联系）</li>
</ul>

<ul>
<li>预测未来状态的演变</li>
</ul>

<ul>
<li>模拟不同行动的后果</li>
</ul>

<ul>
<li>支持智能体的规划和决策</li>
</ul>
<p>简单来说，世界模型就像AI头脑中的一个"模拟器"，让它可以在执行真实动作之前，先在脑海中"演练"一遍。</p>
<p><strong>世界模型的技术演进</strong></p>
<p><strong>早期探索（1990-2018）</strong></p>
<p>世界模型的技术基础可追溯到1990年Richard Sutton提出的Dyna算法，这是基于模型的强化学习（Model-Based RL）的重要里程碑。</p>
<p>2018年，Jürgen Schmidhuber和David Ha在NeurIPS发表的论文《Recurrent World Models Facilitate Policy Evolution》真正让"世界模型"这个术语广为人知。他们的架构包含三个核心组件：</p>
<p><strong>1.V模块（VAE）：</strong>  将高维观测（如图像）压缩为低维潜在表征</p>
<p><strong>2.M模块（RNN）：</strong>  预测序列中下一时刻的表征</p>
<p><strong>3.C模块（控制器）：</strong>  基于表征做出决策</p>
<p>这个架构的核心思想是：<strong>让AI在压缩的潜在空间中进行世界建模，而不是直接在原始像素空间，大幅降低计算复杂度。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d907dece838346029723551e25c0a58e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766655049&amp;x-signature=OvFA1Ae2Ons9%2B8JwGHfATCDuBnc%3D" alt="图片" loading="lazy"/></p>
<p>图2 论文《Recurrent World Models Facilitate Policy Evolution》中提到的世界模型架构。</p>
<p><strong>世界模型的核心特点</strong></p>
<p><strong>内在表征与预测：</strong>  世界模型可以将高维的原始观测数据（如图像、声音、文本等）编码为低维的潜在状态，形成对世界的简洁而有效的表征。在此基础上，它能够预测在给定当前状态和动作的情况下，下一个时刻的状态分布，从而实现对未来事件的前瞻性预测。</p>
<p><strong>物理认知与因果关系：</strong>  世界模型具备基本的物理认知能力，能够理解和模拟物理世界的规律，如重力、摩擦力、运动轨迹等。这使得它在处理与物理世界相关的问题时，能够提供更准确、更符合现实的预测和决策支持。</p>
<p><strong>反事实推理能力：</strong>  世界模型不仅能够基于已有的数据进行预测，还能够进行假设性思考即反事实推理。例如，它可以回答“如果环境条件改变，结果会怎样”这类问题，从而为复杂问题的解决提供更多的可能性和思路。</p>
<p><strong>因果推理</strong>回答："如果A发生了，B会怎样？"</p>
<p><strong>反事实推理</strong>回答："如果当时选择了A而不是B，结果会怎样？"</p>
<p>这种"模拟未发生事件"的能力，是人类智能的重要特征，也是当前AI最欠缺的。一旦突破，将对AI决策能力带来革命性提升。</p>
<p><strong>世界模型的现代实现</strong></p>
<p><strong>技术架构</strong></p>
<p>现代世界模型通常采用以下技术栈：</p>
<p><strong>状态表征模型：</strong>  其作用是将原始观测数据（如高维图像、传感器数据等）压缩为低维的潜在状态，保留关键信息，过滤噪声。常见的实现方法是使用变分自动编码器 （VAE）等技术。这种压缩和表示方式使得模型能够更高效地处理和理解复杂的数据输入。</p>
<p><strong>动态模型：</strong>  这是世界模型的核心部分，用于预测给定当前潜在状态和动作时，环境的下一个状态分布。循环神经网络（RNN）、长短期记忆网络（LSTM）或随机状态空间模型（SSM）等通常被用来学习状态转移规律，从而构建对世界物理规律的隐式理解。动态模型为智能体提供了一个虚拟的“沙盘”，使其能够在其中进行模拟和试验，而无需在真实环境中进行昂贵的试错。</p>
<p><strong>决策模型：</strong>  基于状态预测，决策模型使用模型预测控制（MPC）或深度强化学习（如 Actor-Critic 网络）等方法，规划最优的动作序列以达成目标，它根据预测的未来状态来评估不同动作的价值或奖励信号，从而指导智能体在环境中采取合理的行动。</p>
<p><strong>Sora：世界模型的工业级实现</strong></p>
<p>OpenAI的Sora是世界模型在视频生成领域的突破性应用。这个模型能生成长达60秒的连贯视频，支持任意分辨率和宽高比，更令人惊叹的是它能展现出三维空间的一致性和物体的持久性，即使物体暂时被遮挡或离开画面，它依然能在恰当的时候以正确的状态重新出现。Sora的技术创新主要体现在四个方面：首先是统一的视觉表征，它将不同长度、分辨率的视频都统一转换为Patch序列，就像LLM处理文本Token一样优雅；其次是原生分辨率训练，不裁剪不调整，完整保留构图信息；第三是采用 Diffusion Transformer（DiT） 架构，巧妙结合了扩散模型的生成能力和 Transformer 的序列建模优势；最后也是最神奇的一点，物理理解的涌现，尽管没有人明确告诉它三维空间的规则，它却能自己"悟出"空间连贯性。当然，Sora也不是完美的，复杂的物理交互仍会出错（比如玻璃破碎的方式不够真实），因果关系理解也不完善（比如咬了汉堡却没有留下咬痕），还有左右混淆等空间推理问题。但正如Sora的技术报告所言：视频生成模型正在成为物理世界的通用模拟器，这是通往AGI的关键路径。</p>
<p><strong>世界模型的应用前景</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d985300b8a444dce83a0e067972dfca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766655049&amp;x-signature=neY6tEfeskMS%2BsYEG9m3Pt%2FwGe8%3D" alt="图片" loading="lazy"/></p>
<p>图3 深度学习时代世界模型相关技术、应用的发展路线图</p>
<p><strong>机器人技术</strong></p>
<p>世界模型正在成为物理AI的核心基础。具备世界模型的机器人能在"脑海"中构建周围环境的3D模型，理解物体的位置和交互方式。抓取杯子时，它能预演整个动作序列——伸手轨迹、力度控制、碰撞风险，从而规划最优路径。更重要的是，机器人可以在虚拟环境中学习技能，大幅减少真实试错的成本和风险。NVIDIA的Cosmos平台正是为此打造，提供完整的数据管道和训练工具，让机器人更快从模拟走向现实。</p>
<p><strong>自动驾驶</strong></p>
<p>在自动驾驶领域，世界模型的价值不可估量。装备世界模型的自动驾驶汽车不仅能感知当前路况，更能预判未来场景演变——变道的车会否加速？行人是否要横穿？这种预测源于对交通规律和人类行为的理解。世界模型还能解决长尾问题：通过生成各种极端天气、光照条件的训练数据，让系统在暴雨、大雾时依然稳健。那些难以复现的边缘案例——爆胎、故障、极端交通状况，都可在模拟中反复训练，打造更安全的系统。</p>
<p><strong>游戏与虚拟世界</strong></p>
<p>游戏产业或许最先感受到世界模型的革命。Google DeepMind的Genie 3展示了惊人能力：只需文字或图片，就能生成完整的可交互3D游戏世界。玩家可自由探索，环境实时响应行为。更神奇的是，它能保持数分钟的视觉记忆，确保场景一致性。这个世界真正遵循物理规律——物体受重力掉落，碰撞产生真实反馈。这意味着开发者可用自然语言描述创意，让AI自动生成可玩原型，极大降低开发门槛，为程序生成内容开辟新可能。</p>
<p><strong>世界模型的关键技术挑战</strong></p>
<p><strong>数据质量与多样性</strong></p>
<p>构建可靠的世界模型，首先要解决数据问题。我们需要海量高质量数据，并进行细致的清洗、去重和标注。更具挑战性的是多模态对齐——如何让视觉、语言和物理信息在同一表征空间中和谐共存。此外，真实世界充满长尾场景，那些罕见但关键的情况在训练数据中严重不足，如何让模型应对这些边缘案例，是必须攻克的难题。</p>
<p><strong>物理一致性</strong></p>
<p>世界模型需要真正"理解"物理规律，而非仅仅记住训练数据的模式。简单的统计学习可能让模型记住"篮球会弹起"，但未必理解重力和动量守恒的本质。研究者们正在探索将显式物理约束引入训练，同时通过因果学习让模型区分因果关系和偶然相关性。这还涉及可解释性问题：模型内部的物理表征是否真的反映客观规律，还是只是对数据的过拟合？</p>
<p><strong>计算效率</strong></p>
<p>计算资源的巨大需求是现实瓶颈。Sora的训练算力约为GPT-3的8.2倍，生成60秒视频的推理计算同样惊人。这种指数级增长不仅意味着高昂成本，也限制了技术普及。研究界正在探索更高效的模型架构，从改进的Transformer到优化的扩散模型，从模型压缩到知识蒸馏，每一点效率提升都可能带来质的飞跃。</p>
<p><strong>世界模型 vs 大语言模型</strong></p>
<p>这是AI领域的一个重要争论。Yann LeCun在MIT研讨会上明确表示："<strong>3-5年内，世界模型将成为主流AI架构，没人会再用今天这种LLM</strong>。"</p>
<p><strong>两种范式的对比：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08d085cc467d4a4ab807374a6b75a5ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766655049&amp;x-signature=1DvCwPCjtj%2F6DxyXwuKx3v7CL68%3D" alt="图片" loading="lazy"/></p>
<p><strong>融合趋势：</strong></p>
<p>实际上，两者并非对立而是互补：</p>
<p>●LLM擅长高层语义理解和推理</p>
<p>●世界模型擅长低层感知和物理模拟</p>
<p>●多模态大模型正在融合两者优势</p>
<p>OpenAI的研究表明，LLM可能在内部学习了某种简化的"世界模型"，但远未达到Craik设想的完整心智模型水平。</p>
<p><strong>结语</strong></p>
<p>世界模型代表了AI从"语言智能"向"空间智能"和"物理智能"的重要转变。正如Yann LeCun所说："<strong>LLM只是AI发展的一个阶段，真正的智能需要对物理世界的深刻理解。</strong> "</p>
<p>从Sora的惊艳亮相到Genie的交互式世界，从李飞飞的空间智能到NVIDIA的物理AI平台，世界模型正在从实验室走向产业，从概念验证走向大规模应用。</p>
<p>对于AI从业者而言，现在正是布局世界模型技术栈的最佳时机。无论是投身基础研究，还是探索行业应用，世界模型都将是未来5-10年AI发展的主旋律之一。</p>
<p>正如Kenneth Craik在1943年的远见："如果有机体能在头脑中携带外部现实的'小型模型'，它就能尝试各种选择，得出最优方案，以更全面、安全和高效的方式做出反应。"</p>
<p>80年后的今天，我们终于开始实现这个梦想——不是在人脑中，而是在硅基智能中。世界模型，正在重新定义AI的可能性边界。</p>
<p><strong>参考资料</strong></p>
<p>Ha， D.， &amp; Schmidhuber， J. （2018）. World Models. NeurIPS.</p>
<p>OpenAI （2024）. Video Generation Models as World Simulators.</p>
<p>LeCun， Y. （2024）. Autonomous Intelligence Architecture.</p>
<p>Google DeepMind （2024）. Genie 3： A New Frontier for World Models.</p>
<p>Craik， K. （1943）. The Nature of Explanation.</p>
<p>Tsinghua FIB Lab. World Model： A Survey. ACM Computing Surveys.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app 图片预览 + 长按保存，超实用！]]></title>    <link>https://juejin.cn/post/7585031571889209387</link>    <guid>https://juejin.cn/post/7585031571889209387</guid>    <pubDate>2025-12-18T09:16:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585031571889209387" data-draft-id="7585006378533109802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app 图片预览 + 长按保存，超实用！"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-18T09:16:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="渔_"/> <meta itemprop="url" content="https://juejin.cn/user/378670048349630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app 图片预览 + 长按保存，超实用！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/378670048349630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    渔_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:16:12.000Z" title="Thu Dec 18 2025 09:16:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>做项目时用户总说图片不能保存？一行代码实现图片预览，长按还能保存到相册，安排！</p>
<h4 data-id="heading-0">🎯 实现代码</h4>
<p>html</p>
<p>预览</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- template 里写图片列表 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"img-list"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">image</span> 
    <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in imgList"</span> 
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>
    <span class="hljs-attr">:src</span>=<span class="hljs-string">"item"</span> 
    <span class="hljs-attr">class</span>=<span class="hljs-string">"img-item"</span>
    @<span class="hljs-attr">click</span>=<span class="hljs-string">"previewImg(index)"</span>
  &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// 图片列表，换成你的图片地址</span>
      <span class="hljs-attr">imgList</span>: [
        <span class="hljs-string">"https://xxx.com/img1.jpg"</span>,
        <span class="hljs-string">"https://xxx.com/img2.jpg"</span>,
        <span class="hljs-string">"https://xxx.com/img3.jpg"</span>
      ]
    };
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// 预览图片</span>
    <span class="hljs-title function_">previewImg</span>(<span class="hljs-params">current</span>) {
      uni.<span class="hljs-title function_">previewImage</span>({
        <span class="hljs-attr">current</span>: current, <span class="hljs-comment">// 当前点击的图片索引</span>
        <span class="hljs-attr">urls</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgList</span>, <span class="hljs-comment">// 所有要预览的图片列表</span>
        <span class="hljs-attr">longPressActions</span>: {
          <span class="hljs-comment">// 长按显示的操作菜单</span>
          <span class="hljs-attr">itemList</span>: [<span class="hljs-string">"保存图片"</span>, <span class="hljs-string">"分享图片"</span>],
          <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (res.<span class="hljs-property">tapIndex</span> === <span class="hljs-number">0</span>) {
              <span class="hljs-comment">// 点击保存图片</span>
              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveImg</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgList</span>[current]);
            }
          }
        }
      });
    },
    <span class="hljs-comment">// 保存图片到相册</span>
    <span class="hljs-title function_">saveImg</span>(<span class="hljs-params">imgUrl</span>) {
      uni.<span class="hljs-title function_">saveImageToPhotosAlbum</span>({
        <span class="hljs-attr">filePath</span>: imgUrl,
        <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {
          uni.<span class="hljs-title function_">showToast</span>({
            <span class="hljs-attr">title</span>: <span class="hljs-string">"保存成功"</span>,
            <span class="hljs-attr">icon</span>: <span class="hljs-string">"success"</span>
          });
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-comment">// 用户拒绝授权时提示</span>
          <span class="hljs-keyword">if</span> (err.<span class="hljs-property">errMsg</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"auth deny"</span>)) {
            uni.<span class="hljs-title function_">showToast</span>({
              <span class="hljs-attr">title</span>: <span class="hljs-string">"请开启保存图片权限"</span>,
              <span class="hljs-attr">icon</span>: <span class="hljs-string">"none"</span>
            });
          }
        }
      });
    }
  }
};
</code></pre>
<h4 data-id="heading-1">🎨 加个简单样式</h4>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.img-list</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-wrap</span>: wrap;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10</span>rpx;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20</span>rpx;
}
<span class="hljs-selector-class">.img-item</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">30%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200</span>rpx;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8</span>rpx;
}
</code></pre>
<p>💡 权限提醒：保存图片需要用户授权，第一次点击会弹出授权提示，记得引导用户允许！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从DOM结构到布局流：display: content的深度解析与实战应用]]></title>    <link>https://juejin.cn/post/7585022810180206655</link>    <guid>https://juejin.cn/post/7585022810180206655</guid>    <pubDate>2025-12-18T09:24:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585022810180206655" data-draft-id="7584807992031756330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从DOM结构到布局流：display: content的深度解析与实战应用"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-12-18T09:24:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="八哥程序员"/> <meta itemprop="url" content="https://juejin.cn/user/114004940297325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从DOM结构到布局流：display: content的深度解析与实战应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/114004940297325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    八哥程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:24:07.000Z" title="Thu Dec 18 2025 09:24:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>最近在一些页面布局中使用到了display：content这个属性，个人感觉还是很实用的！借此机会分享出来，接下来我带你深入剖析CSS中<code>display: content</code>属性的工作原理、应用场景和最佳实践，通过可视化图解和实战案例，帮助开发者理解这一被低估的布局利器。</p>
</blockquote>
<h2 data-id="heading-0">一、引言：被忽视的布局利器</h2>
<p>在CSS布局的世界里，我们熟悉Flexbox、Grid、Position等主流布局方式，但<code>display: content</code>这一属性却常常被忽视。它不是一个普通的布局属性，而是一个<strong>DOM结构与布局流分离的魔法工具</strong>。</p>
<p><code>display: content</code>的核心价值在于：<strong>保留元素的可访问性语义，同时将其从布局流中"消失"</strong>，让子元素直接参与父容器的布局。这种特性为复杂组件的布局提供了全新的可能性。</p>
<h2 data-id="heading-1">二、核心概念：理解display: content的工作原理</h2>
<h3 data-id="heading-2">1. 基本定义与行为</h3>
<p><code>display: content</code>是CSS Display Module Level 3引入的属性值，它的作用是：</p>
<blockquote>
<p>将元素本身从视觉布局中移除，但其子元素会继续参与布局，就像直接作为父元素的子元素一样。</p>
</blockquote>
<p><strong>关键特点：</strong></p>
<ul>
<li>元素本身不再产生盒模型（没有宽高、内边距、外边距等）</li>
<li>元素的子元素会"提升"到父容器中参与布局</li>
<li>元素的语义信息（如ARIA属性、表格结构）会被保留</li>
<li>元素仍可接收事件（如点击事件）</li>
</ul>
<h3 data-id="heading-3">2. 可视化图解：布局流的变化</h3>
<p>让我们通过图解来直观理解<code>display: content</code>的影响：</p>
<h4 data-id="heading-4">没有使用display: content</h4>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────┐
│          父容器 (<span class="hljs-attribute">flex</span>布局)       │
│ ┌─────────────────────────────┐ │
│ │        中间元素              │ │
│ │ ┌─────────┐ ┌─────────┐     │ │
│ │ │ 子元素<span class="hljs-number">1</span> │  │ 子元素<span class="hljs-number">2</span> │     │ │
│ │ └─────────┘ └─────────┘     │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
</code></pre>
<p><strong>布局计算流程：</strong></p>
<ol>
<li>父容器计算中间元素的位置和大小</li>
<li>中间元素计算子元素1和子元素2的位置和大小</li>
<li>布局被中间元素的盒模型限制</li>
</ol>
<h4 data-id="heading-5">使用了display: content</h4>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────┐
│          父容器 (<span class="hljs-attribute">flex</span>布局)       │
│ ┌─────────┐ ┌─────────┐         │
│ │ 子元素<span class="hljs-number">1</span>  │ │ 子元素<span class="hljs-number">2</span> │         │
│ └─────────┘ └─────────┘         │
└─────────────────────────────────┘
</code></pre>
<p><strong>布局计算流程：</strong></p>
<ol>
<li>中间元素不产生盒模型，被从布局树中移除</li>
<li>子元素1和子元素2直接作为父容器的子元素参与布局</li>
<li>父容器直接计算子元素1和子元素2的位置和大小</li>
</ol>
<p><strong>核心变化：</strong> 中间元素的盒模型被"移除"，但其子元素的布局上下文从中间元素转移到了父容器。</p>
<h3 data-id="heading-6">3. 与其他display属性的对比</h3>








































<table><thead><tr><th>属性值</th><th>布局行为</th><th>盒模型</th><th>子元素处理</th><th>适用场景</th></tr></thead><tbody><tr><td><code>display: none</code></td><td>完全隐藏</td><td>不生成</td><td>子元素也隐藏</td><td>需要完全移除元素</td></tr><tr><td><code>visibility: hidden</code></td><td>视觉隐藏</td><td>生成</td><td>子元素也隐藏</td><td>需要保留占位的隐藏</td></tr><tr><td><code>opacity: 0</code></td><td>透明显示</td><td>生成</td><td>子元素继承</td><td>需要视觉隐藏但保留交互</td></tr><tr><td><code>display: content</code></td><td>结构穿透</td><td>不生成</td><td>子元素参与布局</td><td>需要保留语义但穿透布局</td></tr></tbody></table>
<h2 data-id="heading-7">三、实战应用：display: content的典型使用场景</h2>
<h3 data-id="heading-8">1. 组件封装中的布局穿透</h3>
<p><strong>问题场景：</strong> 封装UI组件时，组件的外层容器（如Shadow DOM或自定义元素）可能会干扰内部元素与外部布局容器的协同工作，导致Flexbox或Grid布局无法正确应用到组件内部元素。</p>
<p><strong>解决方案：</strong> 使用<code>display: content</code>让组件的内部元素直接穿透到外部布局上下文，同时保持组件的封装性和语义结构。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 封装的卡片组件（使用Shadow DOM） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">my-card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span>&gt;</span>卡片标题<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"content"</span>&gt;</span>卡片内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">my-card</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 外部容器使用Grid布局 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">my-card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span>&gt;</span>产品A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"content"</span>&gt;</span>高性能前端组件库<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">my-card</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">my-card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span>&gt;</span>产品B<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"content"</span>&gt;</span>企业级后端框架<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">my-card</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 卡片组件的Shadow DOM内部样式 */</span>
<span class="hljs-selector-pseudo">:host</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-pseudo">:host</span> <span class="hljs-selector-pseudo">::slotted</span>(<span class="hljs-selector-attr">[slot=<span class="hljs-string">"header"</span>]</span>) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-pseudo">:host</span> <span class="hljs-selector-pseudo">::slotted</span>(<span class="hljs-selector-attr">[slot=<span class="hljs-string">"content"</span>]</span>) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-comment">/* 外部Grid布局 */</span>
<span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr);
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 关键：使用display: content穿透卡片组件 */</span>
<span class="hljs-selector-class">.grid-container</span> <span class="hljs-selector-class">.card-item</span> {
  <span class="hljs-attribute">display</span>: content; <span class="hljs-comment">/* 将组件容器从布局中移除 */</span>
}

<span class="hljs-comment">/* 直接样式化穿透后的slot内容 */</span>
<span class="hljs-selector-class">.grid-container</span> <span class="hljs-selector-pseudo">::slotted</span>(<span class="hljs-selector-attr">[slot=<span class="hljs-string">"header"</span>]</span>) {
  <span class="hljs-attribute">grid-column</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.grid-container</span> <span class="hljs-selector-pseudo">::slotted</span>(<span class="hljs-selector-attr">[slot=<span class="hljs-string">"content"</span>]</span>) {
  <span class="hljs-attribute">grid-column</span>: <span class="hljs-number">2</span>;
}
</code></pre>
<p><strong>工作原理：</strong></p>
<ol>
<li>卡片组件本身仍保持封装性，其内部样式通过Shadow DOM隔离</li>
<li><code>display: content</code>将卡片组件的盒模型移除，使其内部的slot内容直接暴露给外部Grid容器</li>
<li>外部Grid容器可以直接对这些slot内容进行布局控制（如设置grid-column）</li>
<li>组件的语义结构和可访问性信息完全保留</li>
</ol>
<p><strong>应用价值：</strong> 解决了Web Components等封装组件与外部布局系统的兼容性问题，实现了组件内部元素与外部布局的无缝集成。</p>
<h3 data-id="heading-9">2. 语义化标签与布局需求的平衡</h3>
<p><strong>问题场景：</strong> 在构建现代Web应用时，我们需要使用语义化标签（如<code>&lt;article&gt;</code>、<code>&lt;section&gt;</code>、<code>&lt;aside&gt;</code>）来提高可访问性和SEO，但这些标签的盒模型（默认的块级显示）可能会干扰我们想要实现的复杂布局结构。</p>
<p><strong>解决方案：</strong> 使用<code>display: content</code>可以在保留HTML语义结构的同时，将这些语义化标签从视觉布局中移除，让它们的子元素直接参与父容器的布局计算。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 语义化的新闻列表结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"news-container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"news-article"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>CSS Grid 2.0即将发布，带来革命性布局体验<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>据W3C最新消息，CSS Grid 2.0规范即将完成，将引入更多强大的布局功能...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">"2023-12-01"</span>&gt;</span>2023年12月1日<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"news-article"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Web Components已成为现代前端开发的标配<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>随着浏览器支持的不断完善，Web Components正在改变我们构建可复用组件的方式...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">"2023-12-02"</span>&gt;</span>2023年12月2日<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"news-article"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>性能优化新趋势：CSS层叠上下文管理<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>如何通过合理管理CSS层叠上下文来提升页面渲染性能...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">"2023-12-03"</span>&gt;</span>2023年12月3日<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 外部容器使用Grid布局创建复杂的新闻网格 */</span>
<span class="hljs-selector-class">.news-container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">300px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">grid-template-rows</span>: auto;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 关键：使用display: content穿透语义化标签 */</span>
<span class="hljs-selector-class">.news-article</span> {
  <span class="hljs-attribute">display</span>: content;
  <span class="hljs-comment">/* 保留语义结构，但移除盒模型 */</span>
}

<span class="hljs-comment">/* 直接样式化穿透后的内部元素 */</span>
<span class="hljs-selector-class">.news-article</span> &gt; <span class="hljs-selector-tag">h2</span> {
  <span class="hljs-comment">/* 标题跨两列 */</span>
  <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">2</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#667eea</span>;
}

<span class="hljs-selector-class">.news-article</span> &gt; <span class="hljs-selector-tag">p</span> {
  <span class="hljs-comment">/* 内容占据主要空间 */</span>
  <span class="hljs-attribute">grid-column</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
}

<span class="hljs-selector-class">.news-article</span> &gt; <span class="hljs-selector-tag">time</span> {
  <span class="hljs-comment">/* 时间信息靠右对齐 */</span>
  <span class="hljs-attribute">grid-column</span>: <span class="hljs-number">2</span>;
  justify-self: end;
  <span class="hljs-attribute">align-self</span>: end;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.875rem</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
</code></pre>
<p><strong>工作原理与优势：</strong></p>
<ol>
<li><strong>语义结构保留</strong>：<code>&lt;article&gt;</code>标签仍然存在于DOM中，保持了良好的SEO和可访问性</li>
<li><strong>布局灵活性</strong>：通过<code>display: content</code>移除了<code>&lt;article&gt;</code>的盒模型限制，使其子元素可以直接参与Grid布局</li>
<li><strong>复杂布局实现</strong>：可以实现标题跨列、内容与时间左右对齐等复杂布局，而不受语义化标签的影响</li>
<li><strong>可维护性提升</strong>：语义化结构使代码更易读、易维护，同时布局的灵活性满足了设计需求</li>
</ol>
<p><strong>注意事项：</strong></p>
<ul>
<li>确保穿透后的元素选择器正确匹配，避免样式丢失</li>
<li>测试屏幕阅读器的兼容性，确保语义信息仍然可以被正确识别</li>
<li>避免在嵌套过深的语义化标签上过度使用<code>display: content</code>，以免影响代码的可读性</li>
</ul>
<h3 data-id="heading-10">3. 复杂表格结构的简化布局</h3>
<p><strong>问题场景：</strong> HTML表格的<code>&lt;table&gt;</code>、<code>&lt;tr&gt;</code>、<code>&lt;td&gt;</code>结构提供了良好的语义性和可访问性，但这种嵌套结构严重限制了CSS布局的灵活性，无法实现现代设计中常见的复杂表格布局（如单元格合并、不规则排列等）。</p>
<p><strong>解决方案：</strong> 使用<code>display: content</code>可以打破传统表格的结构限制，将表格单元格从<code>&lt;tr&gt;</code>和<code>&lt;td&gt;</code>的嵌套中解放出来，直接使用Grid布局实现复杂的表格设计。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 语义化的表格结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modern-table"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>职位<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>技能<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>经验<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>28<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>前端工程师<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>React, TypeScript, CSS Grid<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>5年<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>32<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>后端工程师<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Node.js, Express, MongoDB<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>8年<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>26<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>UI设计师<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Figma, Sketch, Adobe XD<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>3年<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 表格容器使用Grid布局 */</span>
<span class="hljs-selector-class">.modern-table</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">150px</span> <span class="hljs-number">80px</span> <span class="hljs-number">180px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">grid-auto-rows</span>: <span class="hljs-built_in">minmax</span>(<span class="hljs-number">60px</span>, auto);
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> auto;
  <span class="hljs-attribute">border-collapse</span>: collapse;
}

<span class="hljs-comment">/* 关键：穿透表格的嵌套结构 */</span>
<span class="hljs-selector-class">.modern-table</span> &gt; *,       <span class="hljs-comment">/* 穿透thead和tbody */</span>
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">tr</span>,        <span class="hljs-comment">/* 穿透行 */</span>
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">th</span>,        <span class="hljs-comment">/* 穿透表头单元格 */</span>
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">td</span>         <span class="hljs-comment">/* 穿透数据单元格 */</span>
{ 
  <span class="hljs-attribute">display</span>: content;
}

<span class="hljs-comment">/* 样式化所有单元格 */</span>
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">th</span>,
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">td</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.05</span>);
}

<span class="hljs-comment">/* 表头样式增强 */</span>
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">th</span> {
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.95rem</span>;
  <span class="hljs-attribute">text-transform</span>: uppercase;
  <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">0.5px</span>;
  <span class="hljs-attribute">justify-content</span>: center;
}

<span class="hljs-comment">/* 数据行样式 */</span>
<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">td</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
  <span class="hljs-comment">/* 姓名列 */</span>
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9ff</span>;
}

<span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">td</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">4</span>) {
  <span class="hljs-comment">/* 技能列 - 多行显示 */</span>
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">align-items</span>: flex-start;
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-comment">/* 响应式设计：在小屏幕上重新排列表格 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.modern-table</span> {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
    <span class="hljs-attribute">grid-auto-rows</span>: auto;
  }
  
  <span class="hljs-comment">/* 在移动端，将表头信息作为标签显示在数据前 */</span>
  <span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">td</span> {
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">15px</span>;
  }
  
  <span class="hljs-selector-class">.modern-table</span> <span class="hljs-selector-tag">td</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-built_in">attr</span>(data-label);
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#667eea</span>;
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
  }
}
</code></pre>
<p><strong>高级应用技巧：</strong></p>
<ol>
<li><strong>结构穿透层次</strong>：通过对<code>table &gt; *</code>、<code>tr</code>、<code>th</code>、<code>td</code>都应用<code>display: content</code>，实现了多层级的结构穿透</li>
<li><strong>Grid布局自由</strong>：可以自由定义列宽、行高和间距，突破了传统表格的限制</li>
<li><strong>复杂样式应用</strong>：可以轻松实现表头渐变、单元格阴影、特殊列样式等现代设计效果</li>
<li><strong>响应式适配</strong>：在移动端可以重新排列表格结构，将其转换为卡片式布局</li>
</ol>
<p><strong>可访问性保障：</strong></p>
<ul>
<li>保留了完整的<code>&lt;table&gt;</code>、<code>&lt;thead&gt;</code>、<code>&lt;tbody&gt;</code>语义结构</li>
<li>屏幕阅读器可以正确识别表格内容和表头关系</li>
<li>表格单元格的逻辑关系在DOM中保持不变</li>
</ul>
<p><strong>使用场景扩展：</strong></p>
<ul>
<li>复杂的财务报表和数据分析表格</li>
<li>产品对比和特性展示表格</li>
<li>响应式设计要求高的表格内容</li>
<li>需要特殊视觉效果的表格展示</li>
</ul>
<h3 data-id="heading-11">4. 响应式布局中的条件穿透</h3>
<p><strong>问题场景：</strong> 在响应式设计中，我们经常需要在不同屏幕尺寸下使用完全不同的布局结构。传统方法通常需要通过JavaScript或复杂的CSS选择器来实现，这会增加代码的复杂性和维护成本。</p>
<p><strong>解决方案：</strong> 结合媒体查询和<code>display: content</code>，可以在不同屏幕尺寸下条件性地穿透或保留某些DOM结构，实现灵活的响应式布局切换。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 响应式产品展示组件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-showcase"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 桌面端布局容器 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"desktop-layout"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 产品图片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-image"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"product-image.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"产品图片"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 产品信息 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-info"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-title"</span>&gt;</span>高级前端开发课程<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-meta"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"author"</span>&gt;</span>张老师<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rating"</span>&gt;</span>⭐⭐⭐⭐⭐<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"students"</span>&gt;</span>1000+ 学员<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-description"</span>&gt;</span>
        从零基础到高级前端工程师的完整课程，包含HTML、CSS、JavaScript、React、Vue等现代前端技术...
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-actions"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-primary"</span>&gt;</span>立即购买<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span>&gt;</span>免费试学<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 移动端布局容器 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mobile-layout"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mobile-header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-title"</span>&gt;</span>高级前端开发课程<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rating"</span>&gt;</span>⭐⭐⭐⭐⭐<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-image"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"product-image.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"产品图片"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-meta"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"author"</span>&gt;</span>张老师<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"students"</span>&gt;</span>1000+ 学员<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-description"</span>&gt;</span>
      从零基础到高级前端工程师的完整课程，包含HTML、CSS、JavaScript、React、Vue等现代前端技术...
    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"product-actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-primary"</span>&gt;</span>立即购买<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span>&gt;</span>免费试学<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 默认隐藏移动端布局 */</span>
<span class="hljs-selector-class">.mobile-layout</span> {
  <span class="hljs-attribute">display</span>: none;
}

<span class="hljs-comment">/* 桌面端布局样式 */</span>
<span class="hljs-selector-class">.desktop-layout</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">300px</span> <span class="hljs-number">1</span>fr;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">align-items</span>: start;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.product-image</span> <span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: auto;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.product-title</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-selector-class">.product-meta</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
}

<span class="hljs-selector-class">.product-description</span> {
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
}

<span class="hljs-selector-class">.product-actions</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.btn-secondary</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#667eea</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#667eea</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-comment">/* 移动端响应式布局 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-comment">/* 隐藏桌面端布局 */</span>
  <span class="hljs-selector-class">.desktop-layout</span> {
    <span class="hljs-attribute">display</span>: none;
  }
  
  <span class="hljs-comment">/* 显示移动端布局 */</span>
  <span class="hljs-selector-class">.mobile-layout</span> {
    <span class="hljs-attribute">display</span>: content;
    <span class="hljs-comment">/* 穿透移动端布局容器，让内部元素直接参与父容器布局 */</span>
  }
  
  <span class="hljs-comment">/* 调整产品展示容器为垂直布局 */</span>
  <span class="hljs-selector-class">.product-showcase</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
  }
  
  <span class="hljs-comment">/* 调整移动端元素样式 */</span>
  <span class="hljs-selector-class">.mobile-header</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">text-align</span>: center;
  }
  
  <span class="hljs-selector-class">.product-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
  }
  
  <span class="hljs-selector-class">.product-meta</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
  }
  
  <span class="hljs-selector-class">.product-actions</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
  }
}
</code></pre>
<p><strong>高级应用模式：</strong></p>
<ol>
<li><strong>双布局策略</strong>：同时提供桌面端和移动端两种布局结构，根据屏幕尺寸条件性地显示其中一种</li>
<li><strong>结构穿透</strong>：在移动端使用<code>display: content</code>穿透布局容器，让内部元素直接参与父容器的Flex布局</li>
<li><strong>样式重写</strong>：针对不同屏幕尺寸重写元素样式，实现完全不同的视觉呈现</li>
</ol>
<p><strong>优势与价值：</strong></p>
<ol>
<li><strong>代码组织清晰</strong>：将不同屏幕尺寸的布局结构分离，提高代码可读性和维护性</li>
<li><strong>性能优化</strong>：避免使用JavaScript进行布局切换，减少运行时性能开销</li>
<li><strong>用户体验一致</strong>：在不同设备上都能提供最佳的布局体验</li>
<li><strong>开发效率提升</strong>：简化响应式布局的实现过程，减少代码量</li>
</ol>
<p><strong>最佳实践建议：</strong></p>
<ul>
<li>只在必要的场景下使用条件穿透，避免过度复杂的布局结构</li>
<li>确保在所有屏幕尺寸下都有良好的可访问性</li>
<li>测试不同设备上的布局效果，确保响应式切换平滑自然</li>
<li>结合CSS变量使用，可以进一步提高响应式布局的灵活性</li>
</ul>
<h2 data-id="heading-12">四、深入理解：display: content的工作机制</h2>
<h3 data-id="heading-13">1. CSSOM与DOM的分离</h3>
<p><code>display: content</code>的核心机制在于它<strong>只影响CSSOM（CSS对象模型），不影响DOM（文档对象模型）</strong>，实现了结构与表现的深度分离：</p>
<pre><code class="hljs language-markdown" lang="markdown">┌─────────────────────────────────────────┐
│                 DOM树                   │
│  ┌───────────────────────────────────┐  │
│  │             父元素                 │  │
│  │  ┌─────────────────────────────┐  │  │
│  │  │          中间元素            │  │  │
│  │  │  ┌─────────┐ ┌─────────┐    │  │  │
│  │  │  │ 子元素1  │ │ 子元素2 │    │  │  │
│  │  │  └─────────┘ └─────────┘    │  │  │
│  │  └─────────────────────────────┘  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
<span class="hljs-code">                    ↓
┌─────────────────────────────────────────┐
│                CSSOM树                  │
│  ┌───────────────────────────────────┐  │
│  │             父元素                 │  │
│  │  ┌─────────┐ ┌─────────┐          │  │
│  │  │ 子元素1  │ │ 子元素2 │          │  │
│  │  └─────────┘ └─────────┘          │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│               渲染树                     │
│  ┌───────────────────────────────────┐  │
│  │             父元素                 │  │
│  │  ┌─────────┐ ┌─────────┐          │  │
│  │  │ 子元素1  │ │ 子元素2 │          │  │
│  │  └─────────┘ └─────────┘          │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
</span></code></pre>
<p><strong>核心分离机制：</strong></p>
<ul>
<li><strong>DOM层面</strong>：元素仍然存在，保留所有语义信息、事件监听器和属性</li>
<li><strong>CSSOM层面</strong>：应用了<code>display: content</code>的元素被从CSSOM树中移除，不再生成盒模型</li>
<li><strong>渲染层面</strong>：子元素的盒模型被"提升"到父容器中，直接参与布局计算</li>
</ul>
<p>这种分离机制使得我们可以在不改变DOM结构的情况下，灵活地调整元素的布局行为，实现语义化与布局需求的完美平衡。</p>
<h3 data-id="heading-14">2. 可访问性影响与最佳实践</h3>
<p><code>display: content</code>对可访问性的影响是一把双刃剑，既可以保留语义结构，也可能导致视觉与逻辑结构的不一致。让我们深入了解其工作原理和最佳实践：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────┐
│          可访问性树 (Accessibility Tree) │
│  ┌───────────────────────────────────┐  │
│  │             父元素                 │  │
│  │  ┌─────────────────────────────┐  │  │
│  │  │          中间元素            │  │  │
│  │  │  ┌─────────┐ ┌─────────┐    │  │  │
│  │  │  │ 子元素<span class="hljs-number">1</span>  │ │ 子元素<span class="hljs-number">2</span> │    │  │  │
│  │  │  └─────────┘ └─────────┘    │  │  │
│  │  └─────────────────────────────┘  │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
</code></pre>
<p><strong>关键影响分析：</strong></p>
<p>✅ <strong>保留语义结构</strong>：</p>
<ul>
<li>元素的ARIA属性、角色信息（role）、状态信息（state）仍然存在于可访问性树中</li>
<li>屏幕阅读器可以正确识别元素的语义角色和属性</li>
<li>表格、表单等结构化元素的语义关系得到保留</li>
</ul>
<p>⚠️ <strong>潜在风险：</strong></p>
<ul>
<li><strong>视觉-逻辑不一致</strong>：用户看到的布局结构与屏幕阅读器读到的结构可能不同</li>
<li><strong>交互元素丢失</strong>：如果在可聚焦元素上使用<code>display: content</code>，可能影响键盘导航</li>
<li><strong>屏幕阅读器兼容性</strong>：旧版屏幕阅读器可能无法正确解析穿透后的结构</li>
</ul>
<p><strong>高级可访问性实践：</strong></p>
<ol>
<li>
<p><strong>语义化优先</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 推荐：保留语义结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-nav"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 穿透非语义化的中间元素 */</span>
<span class="hljs-selector-class">.nav-list</span> {
  <span class="hljs-attribute">display</span>: content;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>ARIA属性补充</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"article"</span> <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"card-title"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"card-title"</span>&gt;</span>产品标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>产品描述...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">display</span>: content;
  <span class="hljs-comment">/* 保留ARIA属性和角色信息 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>键盘导航保障</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button-group"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>按钮1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>按钮2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.button-group</span> {
  <span class="hljs-attribute">display</span>: content;
  <span class="hljs-comment">/* 按钮仍然可以通过键盘访问 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>屏幕阅读器测试</strong></p>
<ul>
<li>使用NVDA、VoiceOver等主流屏幕阅读器测试</li>
<li>验证语义结构是否正确传达</li>
<li>确保键盘导航流程合理</li>
</ul>
</li>
</ol>
<p><strong>禁忌场景：</strong></p>
<ul>
<li>绝对不要在<code>&lt;a&gt;</code>、<code>&lt;button&gt;</code>等交互元素上使用<code>display: content</code></li>
<li>避免在<code>&lt;form&gt;</code>、<code>&lt;select&gt;</code>等表单容器上使用</li>
<li>不要在具有复杂ARIA关系的元素上使用</li>
</ul>
<p><code>display: content</code>的可访问性原则是：<strong>保留语义，保障交互，测试验证</strong>。只有在确保可访问性不受影响的前提下，才能充分发挥其布局优势。</p>
<h3 data-id="heading-15">3. 浏览器兼容性与降级策略</h3>
<p><code>display: content</code>是CSS Display Module Level 3的特性，虽然现代浏览器支持良好，但在生产环境中仍需考虑兼容性处理：</p>
<h4 data-id="heading-16">兼容性表格</h4>









































<table><thead><tr><th>浏览器</th><th>支持版本</th><th>发布日期</th><th>市场份额（2023）</th></tr></thead><tbody><tr><td>Chrome</td><td>54+</td><td>2016-10</td><td>65.2%</td></tr><tr><td>Firefox</td><td>37+</td><td>2015-06</td><td>7.8%</td></tr><tr><td>Safari</td><td>10.1+</td><td>2017-03</td><td>19.1%</td></tr><tr><td>Edge（Chromium）</td><td>79+</td><td>2020-01</td><td>5.9%</td></tr><tr><td>IE</td><td>不支持</td><td>-</td><td>&lt;1%</td></tr></tbody></table>
<h4 data-id="heading-17">降级策略</h4>
<p>在需要支持旧版浏览器的项目中，可以采用以下降级策略：</p>
<ol>
<li>
<p><strong>特性检测</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用CSS.supports检测浏览器支持</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">CSS</span>.<span class="hljs-title function_">supports</span>(<span class="hljs-string">'display'</span>, <span class="hljs-string">'content'</span>)) {
  <span class="hljs-comment">// 应用display: content的高级布局</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'supports-display-content'</span>);
}
</code></pre>
</li>
<li>
<p><strong>优雅降级</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础样式：所有浏览器都支持 */</span>
<span class="hljs-selector-class">.component-container</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-comment">/* 传统布局样式 */</span>
}

<span class="hljs-comment">/* 增强样式：仅支持display: content的浏览器 */</span>
<span class="hljs-keyword">@supports</span> (<span class="hljs-attribute">display</span>: content) {
  <span class="hljs-selector-class">.component-container</span> {
    <span class="hljs-attribute">display</span>: content;
    <span class="hljs-comment">/* 高级布局样式 */</span>
  }
}
</code></pre>
</li>
<li>
<p><strong>PostCSS插件</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装PostCSS插件处理display: content兼容性</span>
npm install postcss-display-pseudo-class
</code></pre>
</li>
<li>
<p><strong>Polyfill方案</strong>
对于需要在IE等旧浏览器中使用的场景，可以考虑使用JavaScript polyfill：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简单的polyfill实现</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable constant_">CSS</span>.<span class="hljs-title function_">supports</span>(<span class="hljs-string">'display'</span>, <span class="hljs-string">'content'</span>)) {
  <span class="hljs-keyword">const</span> contentElements = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.use-display-content'</span>);
  contentElements.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> parent = element.<span class="hljs-property">parentNode</span>;
    <span class="hljs-keyword">while</span> (element.<span class="hljs-property">firstChild</span>) {
      parent.<span class="hljs-title function_">insertBefore</span>(element.<span class="hljs-property">firstChild</span>, element);
    }
    parent.<span class="hljs-title function_">removeChild</span>(element);
  });
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-18">最佳实践建议</h4>
<ul>
<li><strong>渐进增强</strong>：优先使用基础布局，再为支持的浏览器添加高级特性</li>
<li><strong>特性检测优先</strong>：使用<code>@supports</code>和<code>CSS.supports</code>进行特性检测</li>
<li><strong>避免过度依赖</strong>：不要将<code>display: content</code>作为核心功能的唯一实现</li>
<li><strong>测试覆盖</strong>：在目标浏览器中进行充分测试，确保降级效果合理</li>
</ul>
<p>通过合理的兼容性策略，可以在享受<code>display: content</code>带来的布局便利的同时，确保应用在各种浏览器环境中都能正常工作。</p>
<h2 data-id="heading-19">五、常见问题与解决方案</h2>
<h3 data-id="heading-20">1. 子元素样式丢失</h3>
<p><strong>问题：</strong> 应用<code>display: content</code>后，子元素的样式可能受到影响，特别是当使用后代选择器时</p>
<p><strong>解决方案：</strong> 调整CSS选择器结构，确保穿透后的子元素能够正确匹配样式规则</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 穿透前：使用后代选择器 */</span>
<span class="hljs-selector-class">.wrapper</span> <span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 穿透后：使用直接子选择器或调整选择器层级 */</span>
<span class="hljs-selector-class">.container</span> &gt; <span class="hljs-selector-class">.item</span>, <span class="hljs-comment">/* 直接子选择器 */</span>
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.item</span>     <span class="hljs-comment">/* 仍可使用后代选择器，但需注意层级 */</span>
{
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<h3 data-id="heading-21">2. 事件处理异常</h3>
<p><strong>问题：</strong> 应用<code>display: content</code>的元素本身不再产生盒模型，可能导致事件目标不准确或事件冒泡行为异常</p>
<p><strong>解决方案：</strong> 使用事件委托或直接在子元素上绑定事件，确保事件处理逻辑正确</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 事件委托到父容器</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.parent'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 检查事件目标或其祖先是否为预期元素</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.child'</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子元素被点击'</span>);
  }
});

<span class="hljs-comment">// 2. 直接在子元素上绑定事件</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.child'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
  child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子元素被点击'</span>);
  });
});
</code></pre>
<h3 data-id="heading-22">3. 表单元素的特殊处理</h3>
<p><strong>问题：</strong> 表单容器使用<code>display: content</code>后，可能影响表单元素的关联关系（如<code>&lt;label&gt;</code>与<code>&lt;input&gt;</code>的绑定）</p>
<p><strong>解决方案：</strong> 避免在表单容器上直接使用<code>display: content</code>，或确保表单元素的关联关系通过其他方式保持</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 不推荐：直接在表单上使用display: content --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-wrapper"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"username"</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 推荐：在非关键容器上使用display: content --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"username"</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 安全使用：在非表单容器上使用 */</span>
<span class="hljs-selector-class">.form-wrapper</span> {
  <span class="hljs-attribute">display</span>: content;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-23">4. 嵌套使用的复杂性</h3>
<p><strong>问题：</strong> 多层级嵌套使用<code>display: content</code>可能导致布局结构混乱，难以调试</p>
<p><strong>解决方案：</strong> 限制嵌套层级，使用注释说明穿透逻辑，借助浏览器DevTools进行调试</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"level-1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"level-2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"level-3"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 限制嵌套层级，避免过度复杂 */</span>
<span class="hljs-selector-class">.level-1</span> {
  <span class="hljs-attribute">display</span>: flex;
}

<span class="hljs-selector-class">.level-2</span> {
  <span class="hljs-attribute">display</span>: content; <span class="hljs-comment">/* 第一层穿透 */</span>
}

<span class="hljs-comment">/* 避免再对level-3使用display: content */</span>
<span class="hljs-selector-class">.level-3</span> {
  <span class="hljs-comment">/* 保持正常盒模型 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-24">六、性能影响与优化</h2>
<h3 data-id="heading-25">1. 渲染性能分析</h3>
<p><code>display: content</code>的性能影响是双面的，需要结合具体场景分析：</p>
<h4 data-id="heading-26">性能优势</h4>
<ul>
<li><strong>布局计算减少</strong>：移除了一层DOM节点的盒模型计算，减少了布局树的节点数量</li>
<li><strong>DOM结构精简</strong>：在保持语义结构的同时，减少了参与布局计算的节点</li>
<li><strong>内存占用优化</strong>：对内存的影响微乎其微，几乎可以忽略不计</li>
</ul>
<h4 data-id="heading-27">性能开销</h4>
<ul>
<li><strong>重排复杂度增加</strong>：子元素直接参与父容器布局，可能导致更复杂的重排计算</li>
<li><strong>选择器匹配变化</strong>：穿透后的元素需要调整选择器，可能影响CSS解析性能</li>
<li><strong>浏览器实现差异</strong>：不同浏览器对<code>display: content</code>的优化程度不同</li>
</ul>
<h4 data-id="heading-28">实际性能测试数据</h4>
<p>我们通过Chrome DevTools的Performance面板对100个嵌套DOM节点应用<code>display: content</code>前后进行了测试：</p>









































<table><thead><tr><th>测试项</th><th>未使用<code>display: content</code></th><th>使用<code>display: content</code></th><th>性能变化</th></tr></thead><tbody><tr><td>DOM节点数</td><td>201</td><td>201</td><td>不变</td></tr><tr><td>布局树节点数</td><td>201</td><td>101</td><td>-50%</td></tr><tr><td>首次布局时间</td><td>12.3ms</td><td>8.7ms</td><td>-29%</td></tr><tr><td>重排时间（单节点）</td><td>0.8ms</td><td>1.1ms</td><td>+37%</td></tr><tr><td>内存占用</td><td>45.2MB</td><td>44.9MB</td><td>-0.7%</td></tr></tbody></table>
<h3 data-id="heading-29">2. 性能优化最佳实践</h3>
<ol>
<li>
<p><strong>按需使用，避免滥用</strong></p>
<ul>
<li>只在语义结构与布局需求冲突时使用</li>
<li>避免在高性能要求的关键路径上使用</li>
</ul>
</li>
<li>
<p><strong>结合虚拟DOM优化</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React示例：结合display: content和memo优化</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">OptimizedComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{ children }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">content</span>' }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
});
</code></pre>
</li>
<li>
<p><strong>合理组织CSS选择器</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 推荐：使用简单选择器 */</span>
<span class="hljs-selector-class">.direct-child</span> {
  <span class="hljs-comment">/* 样式 */</span>
}

<span class="hljs-comment">/* 避免：复杂选择器链 */</span>
<span class="hljs-selector-class">.parent</span> <span class="hljs-selector-class">.wrapper</span> <span class="hljs-selector-class">.deeply-nested</span> <span class="hljs-selector-class">.direct-child</span> {
  <span class="hljs-comment">/* 样式 */</span>
}
</code></pre>
</li>
<li>
<p><strong>避免频繁DOM操作</strong></p>
<ul>
<li>结合CSS动画代替JavaScript驱动的DOM变化</li>
<li>使用CSS变量动态调整样式，减少重排</li>
</ul>
</li>
<li>
<p><strong>利用浏览器缓存</strong></p>
<ul>
<li>保持DOM结构稳定，减少动态变化</li>
<li>结合CSS containment属性进一步优化布局计算</li>
</ul>
</li>
<li>
<p><strong>性能监控与测试</strong></p>
<ul>
<li>使用Chrome DevTools Performance面板监控渲染性能</li>
<li>进行真实设备测试，特别是移动设备</li>
<li>关注重排（Layout Shift）和绘制（Paint）指标</li>
</ul>
</li>
</ol>
<h2 data-id="heading-30">七、最佳实践与使用准则</h2>
<h3 data-id="heading-31">1. 使用场景判断</h3>
<p><strong>适合使用<code>display: content</code>的场景：</strong></p>
<ul>
<li>需要保留语义结构但调整布局</li>
<li>组件封装中的布局穿透</li>
<li>响应式布局的条件调整</li>
<li>复杂DOM结构的简化布局</li>
</ul>
<p><strong>不适合使用的场景：</strong></p>
<ul>
<li>关键交互元素（如按钮、链接）</li>
<li>表单容器和表单元素</li>
<li>需要保留盒模型的容器</li>
<li>旧版浏览器兼容要求高的项目</li>
</ul>
<h3 data-id="heading-32">2. 代码组织建议</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 1. 语义化类名 */</span>
<span class="hljs-selector-class">.visually-transparent</span> {
  <span class="hljs-attribute">display</span>: content;
}

<span class="hljs-comment">/* 2. 条件穿透 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.responsive-wrapper</span> {
    <span class="hljs-attribute">display</span>: content;
  }
}

<span class="hljs-comment">/* 3. 组件特定穿透 */</span>
<span class="hljs-selector-class">.grid-layout</span> <span class="hljs-selector-class">.card-component</span> {
  <span class="hljs-attribute">display</span>: content;
}
</code></pre>
<h3 data-id="heading-33">3. 测试与调试</h3>
<ul>
<li><strong>使用DevTools</strong>：在Elements面板中查看穿透后的DOM结构</li>
<li><strong>检查布局</strong>：使用Layout面板分析元素的布局参与情况</li>
<li><strong>测试可访问性</strong>：使用Screen Reader测试语义结构</li>
<li><strong>性能监控</strong>：使用Performance面板监控渲染性能</li>
</ul>
<h2 data-id="heading-34">八、总结：重新认识display: content</h2>
<p><code>display: content</code>不是一个普通的布局属性，而是一个<strong>DOM与布局解耦的强大工具</strong>。它让我们能够：</p>
<ul>
<li>保持语义化的DOM结构</li>
<li>实现更灵活的布局设计</li>
<li>简化复杂组件的布局处理</li>
<li>平衡可访问性与视觉设计</li>
</ul>
<p>作为开发者，掌握<code>display: content</code>可以帮助我们在复杂的前端项目中找到语义化、可访问性和视觉设计之间的最佳平衡。</p>
<hr/>
<p><strong>如果你觉得这篇文章对你有帮助，欢迎点赞、收藏、转发，也欢迎在评论区留下你的想法和问题！</strong></p>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fcss-display-3%2F" target="_blank" title="https://www.w3.org/TR/css-display-3/" ref="nofollow noopener noreferrer">CSS Display Module Level 3</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fdisplay" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/display" ref="nofollow noopener noreferrer">MDN Web Docs: display</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcss-tricks.com%2Falmanac%2Fproperties%2Fd%2Fdisplay%2F" target="_blank" title="https://css-tricks.com/almanac/properties/d/display/" ref="nofollow noopener noreferrer">CSS-Tricks: display: contents</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fdisplay-property" target="_blank" title="https://web.dev/articles/display-property" ref="nofollow noopener noreferrer">Web.dev: The display property</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue 甘特图 vxe-gantt table 依赖线的使用，配置连接线]]></title>    <link>https://juejin.cn/post/7584831190731161626</link>    <guid>https://juejin.cn/post/7584831190731161626</guid>    <pubDate>2025-12-18T09:37:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584831190731161626" data-draft-id="7585021315691036682" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue 甘特图 vxe-gantt table 依赖线的使用，配置连接线"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-18T09:37:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue 甘特图 vxe-gantt table 依赖线的使用，配置连接线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T09:37:24.000Z" title="Thu Dec 18 2025 09:37:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vue 甘特图 vxe-gantt table 依赖线的使用，配置连接线
连接线有几种类型：
FinishToFinish：完成到完成，表示一个任务必须在另一个任务完成之后才能完成
StartToStart：开始后才开始，表示一个活动结束了，另一个活动才能开始，它们之间按先后顺序进行
FinishToStart：结束后才开始，表示一个任务必须在另一个任务开始之前完成
StartToFinish：开始到结束，表示从某个过程的开始到结束的整个过程</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgantt.vxeui.com" target="_blank" title="https://gantt.vxeui.com" ref="nofollow noopener noreferrer">gantt.vxeui.com</a></p>
<h2 data-id="heading-0">效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/507e62a03c4a4d95adfe28662c6aacfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766655444&amp;x-signature=lEN%2FkVsRm4NQ771HG5XP7aiqoq4%3D" alt="extend_gantt_chart_gantt_dependency_lineType2" loading="lazy"/></p>
<h2 data-id="heading-1">代码</h2>
<p>通过设置 links 定义连接线,from 对应源任务的行主键,tom 对应目标任务的行主键，type 对应连接线类型</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-gantt</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"ganttOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-gantt</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VxeGanttDependencyType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vxe-gantt'</span>

<span class="hljs-keyword">const</span> ganttOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">rowConfig</span>: {
    <span class="hljs-attr">keyField</span>: <span class="hljs-string">'id'</span>
  },
  <span class="hljs-attr">taskBarConfig</span>: {
    <span class="hljs-attr">showProgress</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否显示进度条</span>
    <span class="hljs-attr">showContent</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否在任务条显示内容</span>
    <span class="hljs-attr">move</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否允许拖拽任务移动日期</span>
    <span class="hljs-attr">barStyle</span>: {
      <span class="hljs-attr">round</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 圆角</span>
      <span class="hljs-attr">bgColor</span>: <span class="hljs-string">'#fca60b'</span>, <span class="hljs-comment">// 任务条的背景颜色</span>
      <span class="hljs-attr">completedBgColor</span>: <span class="hljs-string">'#65c16f'</span> <span class="hljs-comment">// 已完成部分任务条的背景颜色</span>
    }
  },
  <span class="hljs-attr">taskViewConfig</span>: {
    <span class="hljs-attr">tableStyle</span>: {
      <span class="hljs-attr">width</span>: <span class="hljs-number">480</span> <span class="hljs-comment">// 表格宽度</span>
    }
  },
  <span class="hljs-attr">taskLinkConfig</span>: {
    <span class="hljs-attr">lineType</span>: <span class="hljs-string">'flowDashed'</span>
  },
  <span class="hljs-attr">links</span>: [
    { <span class="hljs-attr">from</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">to</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">VxeGanttDependencyType</span>.<span class="hljs-property">FinishToFinish</span> },
    { <span class="hljs-attr">from</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">to</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">VxeGanttDependencyType</span>.<span class="hljs-property">StartToStart</span> },
    { <span class="hljs-attr">from</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">to</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">VxeGanttDependencyType</span>.<span class="hljs-property">FinishToStart</span> },
    { <span class="hljs-attr">from</span>: <span class="hljs-number">10013</span>, <span class="hljs-attr">to</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">VxeGanttDependencyType</span>.<span class="hljs-property">StartToFinish</span> }
  ],
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'title'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务名称'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'start'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'开始时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'end'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'结束时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'progress'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'进度(%)'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">80</span> }
  ],
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务1'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-01'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-04'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务2'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-03'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-08'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务3'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-03'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-11'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">90</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务4'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-05'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-11'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">15</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务5'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-08'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-15'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务6'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-10'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-21'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">5</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务7'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-15'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-24'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">70</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务8'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-05'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-15'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">50</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务9'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-19'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-20'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">5</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务10'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-12'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-20'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">10</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务11'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-01'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-08'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">90</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务12'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-03'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-06'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">60</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10013</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务13'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-02'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-05'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">50</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10014</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务14'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-04'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-15'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10015</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务15'</span>, <span class="hljs-attr">start</span>: <span class="hljs-string">'2024-03-01'</span>, <span class="hljs-attr">end</span>: <span class="hljs-string">'2024-03-05'</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">30</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-gantt" target="_blank" title="https://gitee.com/x-extends/vxe-gantt" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>