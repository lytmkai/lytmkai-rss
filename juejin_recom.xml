<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[è§£é”Gitéšè—åŠ›é‡ï¼šä»ç†Ÿç»ƒåˆ°å¤§å¸ˆçš„é«˜çº§å‘½ä»¤æŒ‡å—]]></title>    <link>https://juejin.cn/post/7583912899389521963</link>    <guid>https://juejin.cn/post/7583912899389521963</guid>    <pubDate>2025-12-16T00:14:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389521963" data-draft-id="7583910637958742035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£é”Gitéšè—åŠ›é‡ï¼šä»ç†Ÿç»ƒåˆ°å¤§å¸ˆçš„é«˜çº§å‘½ä»¤æŒ‡å—"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-16T00:14:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é©¬å†™ç "/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£é”Gitéšè—åŠ›é‡ï¼šä»ç†Ÿç»ƒåˆ°å¤§å¸ˆçš„é«˜çº§å‘½ä»¤æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é©¬å†™ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:14:36.000Z" title="Tue Dec 16 2025 00:14:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æ˜¯å¦æ›¾å¯¹Gitæ„Ÿåˆ°ç•æƒ§ï¼Œè®¤ä¸ºå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå¤æ‚çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Ÿå¯¹äºè®¸å¤šå¼€å‘è€…è€Œè¨€ï¼ŒGitçš„æ—¥å¸¸ä½¿ç”¨ä»…é™äº<code>add</code>ã€<code>commit</code>å’Œ<code>push</code>è¿™å‡ ä¸ªåŸºç¡€å‘½ä»¤ã€‚ç„¶è€Œï¼Œåœ¨è¿™çœ‹ä¼¼ç®€å•çš„ç•Œé¢ä¹‹ä¸‹ï¼Œéšè—ç€ä¸€ä¸ªå¼ºå¤§è€Œä¼˜é›…çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç­‰å¾…ç€æˆ‘ä»¬å»æ¢ç´¢å’ŒæŒæ¡ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ è¶…è¶ŠGitçš„åŸºç¡€æ“ä½œï¼Œæ·±å…¥é‚£äº›èƒ½å¤Ÿæ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡ã€è§£å†³å¤æ‚é—®é¢˜çš„é«˜çº§å‘½ä»¤å’ŒæŠ€å·§ï¼Œè®©ä½ ä»Gitä½¿ç”¨è€…èœ•å˜ä¸ºGitå¤§å¸ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ—¶å…‰æ—…è¡Œè€…ï¼šç²¾å‡†æ“æ§æäº¤å†å²</h2>
<h3 data-id="heading-1">äº¤äº’å¼å˜åŸºï¼šé‡å†™å†å²çš„èƒ½åŠ›</h3>
<pre><code class="hljs language-bash" lang="bash">git rebase -i HEAD~5
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šæ‰“å¼€ä¸€ä¸ªäº¤äº’å¼ç•Œé¢ï¼Œå…è®¸ä½ é‡æ–°æ’åºã€åˆå¹¶ã€ç¼–è¾‘æˆ–åˆ é™¤æœ€è¿‘çš„5ä¸ªæäº¤ã€‚è¿™ä¸ä»…ä»…æ˜¯æ•´ç†æäº¤å†å²çš„ç¾å®¹å·¥å…·ï¼Œæ›´æ˜¯ä¿æŒé¡¹ç›®å†å²æ¸…æ™°å¯è¯»çš„å…³é”®ã€‚</p>
<p><strong>å®ç”¨åœºæ™¯</strong>ï¼šå°†å¤šä¸ªçç¢çš„æäº¤åˆå¹¶æˆä¸€ä¸ªé€»è¾‘å®Œæ•´çš„æäº¤ï¼Œä½¿ä»£ç å®¡æŸ¥æ›´åŠ é«˜æ•ˆã€‚</p>
<h3 data-id="heading-2">å¼•ç”¨æ—¥å¿—ï¼šæ‰¾å›ä¸¢å¤±çš„æäº¤</h3>
<pre><code class="hljs language-bash" lang="bash">git reflog
</code></pre>
<p>å½“ä½ æ„å¤–åœ°æ‰§è¡Œäº†<code>git reset --hard</code>æˆ–åˆ é™¤äº†åˆ†æ”¯ï¼Œ<code>reflog</code>å°±æ˜¯ä½ çš„æ—¶å…‰æœºã€‚å®ƒè®°å½•äº†ä»“åº“ä¸­æ‰€æœ‰çš„HEADç§»åŠ¨å†å²ï¼Œè®©ä½ èƒ½å¤Ÿæ‰¾å›çœ‹ä¼¼"ä¸¢å¤±"çš„æäº¤ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‰¾å›ä¸¢å¤±çš„æäº¤</span>
git reflog
<span class="hljs-comment"># æ‰¾åˆ°å¯¹åº”çš„æäº¤å“ˆå¸Œ</span>
git checkout &lt;commit-hash&gt;
</code></pre>
<h2 data-id="heading-3">äºŒã€ä¾¦æ¢æ¨¡å¼ï¼šæ·±å…¥ä»£ç å˜æ›´åˆ†æ</h2>
<h3 data-id="heading-4">äºŒåˆ†æŸ¥æ‰¾ï¼šå¿«é€Ÿå®šä½é—®é¢˜å¼•å…¥ç‚¹</h3>
<pre><code class="hljs language-bash" lang="bash">git bisect start
git bisect bad HEAD
git bisect good v1.0
</code></pre>
<p>å½“ä½ åœ¨æ•°ç™¾ä¸ªæäº¤ä¸­å¯»æ‰¾å¼•å…¥bugçš„é‚£ä¸ªç‰¹å®šæäº¤æ—¶ï¼Œ<code>git bisect</code>å¯ä»¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚Gitä¼šæ™ºèƒ½åœ°å¼•å¯¼ä½ åœ¨æäº¤å†å²ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¤§å¤§ç¼©çŸ­é—®é¢˜å®šä½æ—¶é—´ã€‚</p>
<h3 data-id="heading-5">é«˜çº§æ—¥å¿—ç­›é€‰ï¼šç²¾å‡†è¿‡æ»¤æäº¤å†å²</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥æ‰¾ç‰¹å®šä½œè€…åœ¨ç‰¹å®šæ—¶é—´èŒƒå›´å†…çš„æäº¤</span>
git <span class="hljs-built_in">log</span> --author=<span class="hljs-string">"John"</span> --since=<span class="hljs-string">"2023-01-01"</span> --until=<span class="hljs-string">"2023-06-30"</span>

<span class="hljs-comment"># æŸ¥æ‰¾åŒ…å«ç‰¹å®šå­—ç¬¦ä¸²çš„æäº¤</span>
git <span class="hljs-built_in">log</span> -S <span class="hljs-string">"functionName"</span> --oneline

<span class="hljs-comment"># å¯è§†åŒ–åˆ†æ”¯æ‹“æ‰‘ç»“æ„</span>
git <span class="hljs-built_in">log</span> --graph --oneline --all --decorate
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€å·¥ä½œæµä¼˜åŒ–ï¼šæå‡æ—¥å¸¸æ•ˆç‡</h2>
<h3 data-id="heading-7">å‚¨è—åŒºçš„é«˜çº§ç”¨æ³•</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å‚¨è—æ—¶æ·»åŠ æè¿°</span>
git stash push -m <span class="hljs-string">"æ­£åœ¨ä¿®å¤ç™»å½•åŠŸèƒ½"</span>

<span class="hljs-comment"># åº”ç”¨ç‰¹å®šå‚¨è—</span>
git stash apply stash@{2}

<span class="hljs-comment"># åˆ›å»ºæ–°åˆ†æ”¯å¹¶åº”ç”¨å‚¨è—</span>
git stash branch feature-login-fix stash@{1}
</code></pre>
<p>å‚¨è—ä¸ä»…ä»…æ˜¯ä¸´æ—¶ä¿å­˜æ›´æ”¹ï¼Œç»“åˆæè¿°å’Œåˆ†æ”¯åˆ›å»ºï¼Œå®ƒå¯ä»¥æˆä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼ºå¤§å·¥å…·ã€‚</p>
<h3 data-id="heading-8">æäº¤ä¿®æ­£ï¼šå®Œå–„æœ€è¿‘çš„æäº¤</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¿®æ”¹æœ€è¿‘çš„æäº¤ä¿¡æ¯</span>
git commit --amend

<span class="hljs-comment"># æ·»åŠ æ–‡ä»¶åˆ°æœ€è¿‘çš„æäº¤</span>
git add forgotten_file.js
git commit --amend --no-edit
</code></pre>
<p><code>--amend</code>é€‰é¡¹å…è®¸ä½ ä¿®æ”¹æœ€è¿‘çš„æäº¤ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œä¿æŒå†å²æ•´æ´ã€‚</p>
<h2 data-id="heading-9">å››ã€é«˜çº§åˆå¹¶ä¸å†²çªè§£å†³</h2>
<h3 data-id="heading-10">ä½¿ç”¨ours/theirsç­–ç•¥</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨åˆå¹¶å†²çªæ—¶ï¼Œé€‰æ‹©ç‰¹å®šç‰ˆæœ¬</span>
git checkout --ours conflicted-file.js
git checkout --theirs conflicted-file.js
</code></pre>
<p>å½“å¤„ç†å¤æ‚åˆå¹¶å†²çªæ—¶ï¼Œè¿™äº›å‘½ä»¤å¯ä»¥å¿«é€Ÿé€‰æ‹©ä¿ç•™å½“å‰åˆ†æ”¯æˆ–åˆå¹¶åˆ†æ”¯çš„ç‰ˆæœ¬ã€‚</p>
<h3 data-id="heading-11">é‡æ–°åº”ç”¨åˆå¹¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ”¾å¼ƒå½“å‰åˆå¹¶å°è¯•ï¼Œé‡æ–°å¼€å§‹</span>
git merge --abort

<span class="hljs-comment"># ä½¿ç”¨ç‰¹å®šç­–ç•¥é‡æ–°åˆå¹¶</span>
git merge -X patience feature-branch
</code></pre>
<p><code>-X patience</code>é€‰é¡¹ä½¿ç”¨æ›´æ™ºèƒ½çš„å·®å¼‚ç®—æ³•ï¼Œåœ¨å¤„ç†å¤æ‚é‡æ„æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<h2 data-id="heading-12">äº”ã€é’©å­ä¸è‡ªå®šä¹‰ï¼šè‡ªåŠ¨åŒ–å·¥ä½œæµ</h2>
<p>Gité’©å­ä½äº<code>.git/hooks</code>ç›®å½•ä¸­ï¼Œå…è®¸ä½ åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œè„šæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¤ºä¾‹ï¼šæäº¤å‰æ£€æŸ¥ä»£ç æ ¼å¼</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># pre-commit hook</span>
<span class="hljs-keyword">if</span> ! npm run lint; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤"</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</code></pre>
<p>é€šè¿‡è‡ªå®šä¹‰é’©å­ï¼Œä½ å¯ä»¥é›†æˆä»£ç æ£€æŸ¥ã€æµ‹è¯•è¿è¡Œã€æäº¤ä¿¡æ¯éªŒè¯ç­‰è‡ªåŠ¨åŒ–æµç¨‹ã€‚</p>
<h2 data-id="heading-13">å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸ç»´æŠ¤</h2>
<h3 data-id="heading-14">åƒåœ¾å›æ”¶ä¸ä¼˜åŒ–</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶å¹¶ä¼˜åŒ–æœ¬åœ°ä»“åº“</span>
git gc --aggressive --prune=now

<span class="hljs-comment"># é‡æ–°æ‰“åŒ…å¯¹è±¡ä»¥æé«˜æ•ˆç‡</span>
git repack -a -d --depth=250 --window=250
</code></pre>
<p>å¯¹äºå¤§å‹ä»“åº“ï¼Œå®šæœŸæ‰§è¡Œè¿™äº›ç»´æŠ¤å‘½ä»¤å¯ä»¥æ˜¾è‘—æå‡Gitæ€§èƒ½ã€‚</p>
<h3 data-id="heading-15">éƒ¨åˆ†å…‹éš†ï¼šå¤„ç†å·¨å‹ä»“åº“</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åªå…‹éš†æœ€è¿‘çš„å†å²</span>
git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/large-repo.git

<span class="hljs-comment"># æŒ‰éœ€è·å–ç‰¹å®šç›®å½•</span>
git <span class="hljs-built_in">clone</span> --filter=blob:none --sparse https://github.com/large-repo.git
<span class="hljs-built_in">cd</span> large-repo
git sparse-checkout <span class="hljs-built_in">set</span> src/core
</code></pre>
<h2 data-id="heading-16">ç»“è¯­ï¼šä»å·¥å…·ä½¿ç”¨è€…åˆ°æµç¨‹è®¾è®¡è€…</h2>
<p>æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼ŒGitè¿œä¸æ­¢äºåŸºç¡€ç‰ˆæœ¬æ§åˆ¶ã€‚è¿™äº›é«˜çº§å‘½ä»¤å’ŒæŠ€å·§å°†ä½ ä»è¢«åŠ¨çš„å·¥å…·ä½¿ç”¨è€…è½¬å˜ä¸ºä¸»åŠ¨çš„ç‰ˆæœ¬æ§åˆ¶æµç¨‹è®¾è®¡è€…ã€‚å½“ä½ æŒæ¡äº†<code>reflog</code>çš„æ¢å¤èƒ½åŠ›ã€<code>bisect</code>çš„ä¾¦æ¢æŠ€å·§ã€äº¤äº’å¼å˜åŸºçš„å†å²é‡å¡‘èƒ½åŠ›æ—¶ï¼ŒGitä¸å†æ˜¯ä¸€ä¸ªéœ€è¦å°å¿ƒåº”å¯¹çš„å¤æ‚ç³»ç»Ÿï¼Œè€Œæ˜¯ä½ å¼€å‘å·¥ä½œæµçš„è‡ªç„¶å»¶ä¼¸ã€‚</p>
<p>çœŸæ­£æŒæ¡Gitçš„é«˜çº§åŠŸèƒ½æ„å‘³ç€ä½ èƒ½ä»¥æ›´å°‘çš„åŠªåŠ›å®Œæˆæ›´å¤šå·¥ä½œï¼Œåœ¨å›¢é˜Ÿåä½œä¸­æä¾›æ›´å¤šä»·å€¼ï¼Œå¹¶åœ¨é¢å¯¹å¤æ‚ç‰ˆæœ¬æ§åˆ¶åœºæ™¯æ—¶ä¿æŒä»å®¹ã€‚å¼€å§‹å°è¯•è¿™äº›å‘½ä»¤ï¼Œå°†å®ƒä»¬èå…¥ä½ çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œä½ å°†ä¼šå‘ç°ä¸€ä¸ªæ›´é«˜æ•ˆã€æ›´å¯æ§çš„å¼€å‘ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ä¸ªçœ‹ä¼¼â€œé€åˆ†â€çš„éœ€æ±‚ä¸ºä½•ç¿»è½¦ï¼Ÿâ€”â€”å‰ç«¯çŠ¶æ€æœºå®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7584071941025497103</link>    <guid>https://juejin.cn/post/7584071941025497103</guid>    <pubDate>2025-12-16T10:55:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584071941025497103" data-draft-id="7583799807594201122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ä¸ªçœ‹ä¼¼â€œé€åˆ†â€çš„éœ€æ±‚ä¸ºä½•ç¿»è½¦ï¼Ÿâ€”â€”å‰ç«¯çŠ¶æ€æœºå®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-16T10:55:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€å°å’"/> <meta itemprop="url" content="https://juejin.cn/user/1943592286564045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ä¸ªçœ‹ä¼¼â€œé€åˆ†â€çš„éœ€æ±‚ä¸ºä½•ç¿»è½¦ï¼Ÿâ€”â€”å‰ç«¯çŠ¶æ€æœºå®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592286564045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€å°å’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T10:55:02.000Z" title="Tue Dec 16 2025 10:55:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æºç å¤ªæ¯ç‡¥ï¼Ÿä¸€ä¸ªäººå•ƒä¸åŠ¨ï¼Ÿå…³æ³¨å…¬ä¼—å·-ã€Œå‰ç«¯å°å’ã€ï¼Œè®©æˆ‘åšä½ çš„æºç é¢†è¯»äººã€‚è¿™é‡Œæ²¡æœ‰æ™¦æ¶©çš„è¯´æ•™ï¼Œåªæœ‰æ¸…æ™°çš„Â <strong>Vue 3 &amp; React 19</strong>Â æºç æ‹†è§£ã€‚ç§¯è·¬æ­¥ä»¥è‡³åƒé‡Œï¼Œ<strong>å°å’ä¹Ÿèƒ½è¿›é˜¶ä¸ºå¤§å°†</strong>ï¼Œæˆ‘ä»¬ä¸€èµ·è¿‡æ²³ï¼â™Ÿï¸</p>
</blockquote>
<p>æ•…äº‹çš„å¼€å§‹æ€»æ˜¯æƒŠäººçš„ç›¸ä¼¼ã€‚</p>
<p>ä¸Šä¸ªæœˆï¼Œéœ€æ±‚è¯„å®¡ä¼šä¸Šï¼Œæ”¶åˆ°äº†äº§å“ç»ç†çš„ä¸€ä¸ªéœ€æ±‚ï¼šâ€œåšä¸€ä¸ªæ‰«ç æ”¯ä»˜å¼¹çª—ã€‚é€»è¾‘å¾ˆç®€å•ï¼šæ‰“å¼€å¼¹çª—è·å–äºŒç»´ç ï¼Œç„¶åæ¯éš” 2 ç§’è½®è¯¢ä¸€æ¬¡æ¥å£ï¼Œæ‰«ç æˆåŠŸå°±è·³è½¬ï¼Œ30 ç§’è¶…æ—¶å°±è®©ç”¨æˆ·åˆ·æ–°â€</p>
<p>ä¸€æ‹è„‘è¢‹ï¼Œå‡­ç»éªŒåˆ¤æ–­ï¼Œéœ€æ±‚ä¸éš¾ã€‚ä½œä¸ºä¸€åç†Ÿç»ƒçš„â€œReactå·¥ç¨‹å¸ˆâ€ï¼Œæˆ‘æå…¶è‡ªä¿¡åœ°æ•²ä¸‹ä»£ç ï¼Œå¼€å§‹å†™éœ€æ±‚ä»£ç ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// åŠ è½½äºŒç»´ç ä¸­</span>
<span class="hljs-keyword">const</span> [isPolling, setIsPolling] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// è½®è¯¢æ¥å£ä¸­</span>
<span class="hljs-keyword">const</span> [isError, setIsError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);     <span class="hljs-comment">// å‡ºé”™äº†</span>
<span class="hljs-keyword">const</span> [retryCount, setRetryCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);   <span class="hljs-comment">// é‡è¯•æ¬¡æ•°</span>
<span class="hljs-comment">// ...åé¢è¿˜æœ‰ä¸€å † useEffect å’Œ useRef ç”¨æ¥å­˜å®šæ—¶å™¨ID</span>
</code></pre>
<p>å½“æ—¶çš„æˆ‘è¿˜æœªæ„è¯†åˆ°ï¼Œè¿™å‡ ä¸ªstateç»™æˆ‘å¸¦æ¥äº†å¥½å‡ ä¸ªbugå•ã€‚</p>
<h2 data-id="heading-0">éšå½¢çš„â€œçŠ¶æ€çˆ†ç‚¸â€</h2>
<p>æ­£å¼ææµ‹ä¹‹åï¼Œæˆ‘å°±é™†é™†ç»­ç»­æ”¶åˆ°äº†å¥½å‡ ä¸ªbugå•ã€‚</p>
<p>â€œå¤§ä½¬ï¼Œæˆ‘å°±åœ¨ç½‘ç»œå¡é¡¿çš„æ—¶å€™å¤šç‚¹äº†å‡ ä¸‹â€˜åˆ·æ–°â€™ï¼Œé¡µé¢å°±ä¹±äº†â€</p>
<p>æµè§ˆå™¨çš„Network é¢æ¿ä¸Šï¼Œå‡ åä¸ªè½®è¯¢è¯·æ±‚åœ¨å¹¶å‘æ‰§è¡Œã€‚UI ç•Œé¢ä¸Šï¼Œâ€œæ­£åœ¨åŠ è½½â€çš„è½¬åœˆåŠ¨ç”»å’Œâ€œç½‘ç»œé”™è¯¯â€çš„çº¢å­—æç¤ºç«Ÿç„¶åŒæ—¶å­˜åœ¨ï¼Œç”šè‡³è¿˜èƒ½ç‚¹å‡»â€œé‡è¯•â€æŒ‰é’®ï¼ï¼ï¼</p>
<p>æŒ‰ç…§æˆ‘çš„é€»è¾‘ï¼Œ<code>isLoading</code> ä¸º <code>true</code> æ—¶ï¼Œ<code>isError</code> è‚¯å®šå¾—æ˜¯ <code>false</code> å•Šã€‚æˆ‘æ˜æ˜å†™äº† <code>setLoading(true); setError(false)</code>ï¼Œä¸ºå•¥ä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼</p>
<p><strong>ä¸ºä»€ä¹ˆä¼šå¤±æ§ï¼Ÿ</strong></p>
<p>é—®é¢˜çš„æ ¹æºå°±åœ¨äºè¯•å›¾ç”¨çº¿æ€§çš„é€»è¾‘ï¼Œå»å¯¹æŠ—éçº¿æ€§çš„ç°å®ã€‚</p>
<p>å½“ <code>isLoading</code>ã€<code>isPolling</code>ã€<code>isError</code> ä¸‰ä¸ªå¸ƒå°”å€¼æ··åœ¨ä¸€èµ·æ—¶ï¼Œç†è®ºä¸Šå®ƒä»¬èƒ½ç»„åˆå‡º 2^3=8 ç§çŠ¶æ€ã€‚è€Œåœ¨çœŸå®çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œåˆæ³•çš„çŠ¶æ€å¯èƒ½åªæœ‰ 3 ç§ï¼ˆåŠ è½½ä¸­ã€è½®è¯¢ä¸­ã€å¤±è´¥ï¼‰ã€‚é‚£ä¹ˆ<strong>å‰©ä¸‹çš„é‚£ 5 ç§â€œä¸å¯èƒ½å­˜åœ¨çš„çŠ¶æ€â€ï¼Œä¸€ä¸å°å¿ƒæ²¡å¤„ç†å°±ä¼šå­˜åœ¨å¤§é‡çš„ç¼ºé™·ã€‚</strong></p>
<p>æˆ‘ä»¬èŠ±è´¹ 80% çš„æ—¶é—´ï¼Œä¸æ˜¯åœ¨å†™ä¸šåŠ¡ï¼Œè€Œæ˜¯åœ¨å†™é˜²å¾¡ä»£ç ï¼Œå»å µé‚£äº›å› ä¸ºé€»è¾‘æ¼æ´è€Œäº§ç”Ÿçš„æ··æ²ŒçŠ¶æ€ã€‚</p>
<p>é¢å¯¹é‚£å¨è†¨èƒ€ä¸”è„†å¼±çš„ä»£ç ï¼Œå†è¿›è¡Œä¿®ä¿®è¡¥è¡¥å·²ç»æ— æµäºäº‹ï¼Œå¿…é¡»è¦å¤§åˆ€é˜”æ–§å¼çš„æ¨å€’é‡æ¥ï¼Œå’ŒPMå’Œè¿è¥æ²Ÿé€šï¼Œéœ€æ±‚è¿›è¡Œå»¶æœŸï¼Œä»£ç æ‰“å›å»é‡å†™ã€‚</p>
<p>è§£å†³æ­¤ç±»é—®é¢˜çš„æœ€ä½³æ–¹æ¡ˆï¼Œä¸æ˜¯æ›´é«˜è¶…çš„ <code>if-else</code> æŠ€å·§ï¼Œè€Œæ˜¯ä¸€ä¸ªç»å…¸çš„æ•°å­¦æ¨¡å‹â€”â€”<strong>æœ‰é™çŠ¶æ€æœº</strong> ã€‚å®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ï¼š<strong>ç³»ç»Ÿåœ¨ä»»ä½•æ—¶åˆ»åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ï¼Œä¸”çŠ¶æ€çš„æµè½¬æ˜¯ç¡®å®šçš„ã€‚</strong></p>
<h2 data-id="heading-1">å¼•å…¥æœ‰é™çŠ¶æ€æœº (FSM)</h2>
<h3 data-id="heading-2">ç»˜åˆ¶çŠ¶æ€æµè½¬å›¾</h3>
<p>åœ¨å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘å…ˆç”»äº†ä¸€å¼ å›¾ã€‚è¿™æ‰æ˜¯é€»è¾‘çš„æ ¸å¿ƒï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a5e676a636492fa064b0e5d1417ea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LiA5bCP5Y2S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766487301&amp;x-signature=bhvOGCRnUe0UJ6YFfe0nvs14GVQ%3D" alt="svgviewer-png-output (52).png" loading="lazy"/></p>
<p>æµç¨‹å›¾æ¸…æ™°çš„å±•ç¤ºå‡ºæ¥ï¼š</p>
<ul>
<li>åªæœ‰åœ¨ <code>FAILURE</code> æˆ– <code>IDLE</code> çŠ¶æ€ä¸‹ï¼Œæ‰å…è®¸å‘èµ· <code>FETCH</code>ã€‚</li>
<li>åœ¨ <code>LOADING</code> çŠ¶æ€ä¸‹ï¼Œæ— è®ºç”¨æˆ·æ€ä¹ˆç‚¹å‡»ï¼Œéƒ½ä¸ä¼šè§¦å‘å¤šä½™çš„è¯·æ±‚ã€‚</li>
</ul>
<h3 data-id="heading-3">å¼•å…¥useReducer</h3>
<p>React çš„ <code>useReducer</code> æ˜¯å®ç°çŠ¶æ€æœºçš„ç»ä½³å·¥å…·ï¼Œé€šè¿‡å®ƒå¯ä»¥å°†çŠ¶æ€ç®¡ç†æ”¶æ•›åˆ°ä¸€ä¸ªçº¯å‡½æ•°ä¸­ã€‚</p>
<p><strong>å®šä¹‰çŠ¶æ€ä¸äº‹ä»¶</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// çŠ¶æ€æšä¸¾ï¼Œåªæœ‰è¿™äº”ç§çŠ¶æ€</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STATES</span> = {
  <span class="hljs-attr">IDLE</span>: <span class="hljs-string">'idle'</span>,
  <span class="hljs-attr">LOADING</span>: <span class="hljs-string">'loading'</span>,
  <span class="hljs-attr">POLLING</span>: <span class="hljs-string">'polling'</span>,
  <span class="hljs-attr">SUCCESS</span>: <span class="hljs-string">'success'</span>,
  <span class="hljs-attr">FAILURE</span>: <span class="hljs-string">'failure'</span>,
};

<span class="hljs-comment">// äº‹ä»¶æšä¸¾ï¼šç”¨æˆ·æˆ–ç³»ç»Ÿèƒ½åšçš„åŠ¨ä½œ</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EVENTS</span> = {
  <span class="hljs-attr">FETCH</span>: <span class="hljs-string">'FETCH'</span>,      <span class="hljs-comment">// è§¦å‘è·å–</span>
  <span class="hljs-attr">RESOLVE</span>: <span class="hljs-string">'RESOLVE'</span>,  <span class="hljs-comment">// æˆåŠŸæ‹¿åˆ°äºŒç»´ç </span>
  <span class="hljs-attr">REJECT</span>: <span class="hljs-string">'REJECT'</span>,    <span class="hljs-comment">// å¤±è´¥</span>
  <span class="hljs-attr">DONE</span>: <span class="hljs-string">'DONE'</span>,        <span class="hljs-comment">// æ”¯ä»˜å®Œæˆ</span>
  <span class="hljs-attr">TIMEOUT</span>: <span class="hljs-string">'TIMEOUT'</span>,  <span class="hljs-comment">// è¶…æ—¶</span>
};
</code></pre>
<p><strong>ç¼–å†™ Reducer</strong></p>
<p>è¿™é‡Œä½¿ç”¨åŒé‡ Switch ç»“æ„ï¼šå…ˆåˆ¤æ–­<strong>å½“å‰å¤„äºä»€ä¹ˆçŠ¶æ€</strong>ï¼Œå†åˆ¤æ–­<strong>å‘ç”Ÿäº†ä»€ä¹ˆäº‹ä»¶</strong>ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> machineReducer = (state, event) =&gt; {
  <span class="hljs-keyword">switch</span> (state.status) {
    <span class="hljs-keyword">case</span> STATES.IDLE:
    <span class="hljs-keyword">case</span> STATES.FAILURE:
      <span class="hljs-comment">// åªæœ‰åœ¨ç©ºé—²æˆ–å¤±è´¥æ—¶ï¼Œæ‰å…è®¸å‘èµ· FETCH</span>
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.FETCH) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.LOADING, <span class="hljs-type">error</span>: null };
      }
      <span class="hljs-keyword">return</span> state; <span class="hljs-comment">// å…¶ä»–äº‹ä»¶ç›´æ¥å¿½ç•¥ï¼</span>

    <span class="hljs-keyword">case</span> STATES.LOADING:
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.RESOLVE) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.POLLING, qrCode: event.data };
      }
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.REJECT) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.FAILURE, <span class="hljs-type">error</span>: event.<span class="hljs-type">error</span> };
      }
      <span class="hljs-comment">// ğŸ”¥ é‡ç‚¹ï¼šè¿™é‡Œæ²¡æœ‰å¤„ç† 'FETCH' äº‹ä»¶ã€‚</span>
      <span class="hljs-comment">// è¿™æ„å‘³ç€ï¼šåœ¨ Loading çŠ¶æ€ä¸‹ï¼Œæ— è®ºç”¨æˆ·æ€ä¹ˆç‹‚ç‚¹æŒ‰é’®ï¼Œä»£ç éƒ½ä¸ä¼šæœ‰ä»»ä½•ååº”ï¼</span>
      <span class="hljs-keyword">return</span> state;

    <span class="hljs-keyword">case</span> STATES.POLLING:
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.DONE) <span class="hljs-keyword">return</span> { ...state, status: STATES.SUCCESS };
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.TIMEOUT) <span class="hljs-keyword">return</span> { ...state, status: STATES.FAILURE, <span class="hljs-type">error</span>: <span class="hljs-string">'è¶…æ—¶'</span> };
      <span class="hljs-keyword">return</span> state;

    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};
</code></pre>
<p><strong>ç»„ä»¶å±‚è°ƒç”¨ï¼ˆåˆ†ç¦»å‰¯ä½œç”¨ï¼‰</strong></p>
<p>ç°åœ¨ï¼Œç»„ä»¶å±‚çš„ä»£ç å˜å¾—å¼‚å¸¸æ¸…çˆ½ã€‚æˆ‘ä»¬åªéœ€è¦æ ¹æ®çŠ¶æ€å»æ¸²æŸ“ UIï¼Œå¹¶åˆ©ç”¨ <code>useEffect</code> å¤„ç†è½®è¯¢å‰¯ä½œç”¨ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">PaymentModal</span> = () =&gt; {
  const <span class="hljs-section">[state, dispatch]</span> = useReducer(machineReducer, { status: STATES.IDLE })<span class="hljs-comment">;</span>

  // ä¸šåŠ¡åŠ¨ä½œï¼šåªè´Ÿè´£æ´¾å‘æ„å›¾ï¼Œä¸è´Ÿè´£åˆ¤æ–­é€»è¾‘
  const <span class="hljs-attr">handleFetch</span> = () =&gt; {
    dispatch({ type: EVENTS.FETCH })<span class="hljs-comment">;</span>
    api.getQrCode()
      .then(<span class="hljs-attr">data</span> =&gt; dispatch({ type: EVENTS.RESOLVE, data }))
      .catch(<span class="hljs-attr">err</span> =&gt; dispatch({ type: EVENTS.REJECT, error: err }))<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  // å‰¯ä½œç”¨ç®¡ç†ï¼šç”±çŠ¶æ€é©±åŠ¨è½®è¯¢
  useEffect(() =&gt; {
    let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">state.status</span> === STATES.POLLING) {
      <span class="hljs-attr">timer</span> = setInterval(async () =&gt; {
        const <span class="hljs-attr">res</span> = await api.checkStatus()<span class="hljs-comment">;</span>
        if (res.success) dispatch({ type: EVENTS.DONE })<span class="hljs-comment">;</span>
      }, 2000)<span class="hljs-comment">;</span>
    }
    return () =&gt; clearInterval(timer)<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[state.status]</span>)<span class="hljs-comment">; // çŠ¶æ€å˜äº†ï¼Œå‰¯ä½œç”¨è‡ªåŠ¨æ¸…ç†æˆ–é‡å¯</span>

  return (
    &lt;div&gt;
      {<span class="hljs-attr">state.status</span> === STATES.LOADING &amp;&amp; &lt;Spinner /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.POLLING &amp;&amp; &lt;QRCode img={state.qrCode} /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.FAILURE &amp;&amp; &lt;ErrorView <span class="hljs-literal">on</span>Retry={handleFetch} /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.SUCCESS &amp;&amp; &lt;SuccessView /&gt;}
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>çœ‹æ‡‚äº†å—ï¼Ÿæˆ‘ä»¬ä¸å†ä¿®è¡¥æ¼æ´ï¼Œé€šè¿‡æ¸…æ™°çš„å®šä¹‰çŠ¶æ€å’Œè§¦å‘äº‹ä»¶ï¼Œæ”¶æ•›ä¸šåŠ¡ä»£ç å¤æ‚åº¦ï¼Œæ¶ˆé™¤å¯èƒ½äº§ç”Ÿçš„bugã€‚</p>
<hr/>
<h2 data-id="heading-4">æ·±åº¦è§£æçŠ¶æ€æœº</h2>
<p>å†™åˆ°è¿™é‡Œï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦ä¼šé—®ï¼š <strong>â€œè¿™ä¸å°±æ˜¯ Switch-Case å—ï¼Ÿä¸ºä»€ä¹ˆè¦å«å®ƒçŠ¶æ€æœºï¼Ÿâ€</strong> æˆ‘ä»¬éœ€è¦æŠŠè§†è§’æ‹‰é«˜ï¼Œä»ç†è®ºå±‚é¢å½»åº•ç†è§£å®ƒï¼Œä»¥ä¾¿åº”å¯¹æ›´å¤æ‚çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-5">ä»€ä¹ˆæ˜¯æœ‰é™çŠ¶æ€æœº</h3>
<p>æœ‰é™çŠ¶æ€æœºä¸æ˜¯ä¸€ç§ä»£ç å†™æ³•ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°å­¦æ¨¡å‹ã€‚å®ƒç”±äº”ä¸ªè¦ç´ ç»„æˆï¼š</p>
<ul>
<li><strong>æœ‰é™çš„çŠ¶æ€</strong> ï¼šæ¯”å¦‚çº¢ç»¿ç¯åªæœ‰çº¢ã€é»„ã€ç»¿ï¼Œä¸å¯èƒ½å‡ºç°â€œçº¢ç»¿â€ã€‚</li>
<li><strong>æœ‰é™çš„äº‹ä»¶</strong> ï¼šæ¯”å¦‚â€œå€’è®¡æ—¶ç»“æŸâ€ã€â€œæŒ‰ä¸‹æŒ‰é’®â€ã€‚</li>
<li><strong>è½¬æ¢è§„åˆ™</strong> ï¼šå³ <code>çŠ¶æ€ A + äº‹ä»¶ B -&gt; çŠ¶æ€ C</code>ã€‚</li>
<li><strong>åˆå§‹çŠ¶æ€</strong> ã€‚</li>
<li><strong>æœ€ç»ˆçŠ¶æ€</strong> ã€‚</li>
</ul>
<p>å®ƒçš„æ ¸å¿ƒç†å¿µå°±æ˜¯ï¼š<strong>ç³»ç»Ÿåœ¨ä»»ä½•æ—¶åˆ»åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ï¼Œä¸”çŠ¶æ€çš„æµè½¬æ˜¯ç¡®å®šçš„ã€‚</strong></p>
<h3 data-id="heading-6">ä¸ºä»€ä¹ˆå‰ç«¯éœ€è¦å®ƒ</h3>
<p>å‰ç«¯æ—©å·²ä¸æ˜¯â€œå±•ç¤ºé¡µé¢â€é‚£ä¹ˆç®€å•äº†ï¼Œæˆ‘ä»¬æ˜¯åœ¨æµè§ˆå™¨é‡Œè·‘ APPã€‚ä»¥ä¸‹åœºæ™¯å¦‚æœä¸ä»¥çŠ¶æ€æœºæ€ç»´å»å†™ï¼Œè¿Ÿæ—©ä¼šå´©ï¼š</p>
<ul>
<li><strong>å¤šåª’ä½“æ’­æ”¾å™¨</strong>ï¼š ä½ ä»¥ä¸ºåªæœ‰ <code>Play</code> å’Œ <code>Pause</code>ï¼Ÿé”™ã€‚ è¿˜æœ‰ <code>Buffering</code>ï¼ˆç¼“å†²ä¸­ï¼‰ã€<code>Seeking</code>ï¼ˆæ‹–æ‹½è¿›åº¦æ¡ä¸­ï¼‰ã€<code>Ended</code>ï¼ˆæ’­æ”¾ç»“æŸï¼‰ã€<code>Error</code>ï¼ˆåŠ è½½å¤±è´¥ï¼‰è¿™äº›åœºæ™¯ã€‚</li>
<li><strong>å¤æ‚çš„è¡¨å•å‘å¯¼</strong> ï¼š ç¬¬ä¸€æ­¥ -&gt; ç¬¬äºŒæ­¥ -&gt; ç¬¬ä¸‰æ­¥ã€‚ ç”¨æˆ·åœ¨ç¬¬äºŒæ­¥ç‚¹äº†â€œä¸Šä¸€æ­¥â€ï¼Œæ•°æ®æ€ä¹ˆå­˜ï¼Ÿåœ¨ç¬¬ä¸‰æ­¥æäº¤å¤±è´¥äº†ï¼Œé€€å›å“ªä¸€æ­¥ï¼Ÿ</li>
<li><strong>TCP/WebSocket è¿æ¥ç®¡ç†</strong>ï¼š <code>Connecting</code> -&gt; <code>Connected</code> -&gt; <code>Reconnecting</code> -&gt; <code>Disconnected</code>ã€‚ å¦‚æœåœ¨ <code>Reconnecting</code> æœŸé—´ç”¨æˆ·æ‰‹åŠ¨ç‚¹äº†â€œæ–­å¼€â€ï¼Œåº”è¯¥å»å“ªï¼Ÿ</li>
<li><strong>Canvas æ¸¸æˆ/äº¤äº’å¯è§†åŒ–</strong>ï¼š æ‹–æ‹½æ¨¡å¼ã€ç»˜å›¾æ¨¡å¼ã€é€‰ä¸­æ¨¡å¼ã€‚</li>
</ul>
<p>è¯»åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½å·²ç»çƒ­è¡€æ²¸è…¾ï¼Œå‡†å¤‡æŠŠé¡¹ç›®é‡Œçš„æ‰€æœ‰ç»„ä»¶éƒ½é‡å†™ä¸€éã€‚</p>
<p><strong>ä¸”æ…¢ã€‚</strong></p>
<p>è½¯ä»¶å·¥ç¨‹çš„æ ¸å¿ƒåœ¨äºæƒè¡¡ï¼Œå¦‚æœéœ€æ±‚ä»…ä»…æ˜¯æ§åˆ¶ä¸€ä¸ªæ¨¡æ€æ¡†çš„æ˜¾ç¤ºä¸éšè—ï¼Œå¼•å…¥çŠ¶æ€æœºåªä¼šå¢åŠ æ— è°“çš„ä»£ç å¤æ‚åº¦ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥ä¾æ®å“ªäº›æ ‡å‡†æ¥åˆ¤å®šæ˜¯å¦éœ€è¦å¼•å…¥çŠ¶æ€æœºï¼Ÿå½“ä½ çš„ç»„ä»¶å‡ºç°ä»¥ä¸‹ä¸‰ç§ç‰¹å¾ä¹‹ä¸€æ—¶ï¼Œå°±å¯ä»¥ç»“åˆä¸šåŠ¡é€‚å½“çš„è€ƒè™‘é‡æ„äº†ã€‚</p>
<h3 data-id="heading-7">å­˜åœ¨å¤šä¸ªéœ€è¦â€œæ‰‹åŠ¨åŒæ­¥â€çš„booleanå˜é‡</h3>
<p>è¿™æ˜¯æœ€æ˜¾è‘—çš„ä¿¡å·ã€‚æ£€æŸ¥ä¸€ä¸‹ä½ çš„ç»„ä»¶ State å®šä¹‰ï¼Œå¦‚æœå‡ºç°äº†ä¸¤ä¸ªåŠä»¥ä¸Šçš„booleanï¼Œä¸”å½¼æ­¤ä¹‹é—´å­˜åœ¨é€»è¾‘å…³è”ï¼Œå°±éœ€è¦è­¦æƒ•ï¼Œ<strong>å½“ä½ éœ€è¦ç»´æŠ¤å¤šä¸ªå¸ƒå°”å€¼å˜é‡çš„åŒæ­¥å…³ç³»æ—¶ï¼ŒçŠ¶æ€æœºæ˜¯æ›´ä¼˜è§£</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å…¸å‹çš„é«˜é£é™©ä»£ç </span>
const <span class="hljs-selector-attr">[isLoading, setLoading]</span> = <span class="hljs-built_in">useState</span>(false);
const <span class="hljs-selector-attr">[isError, setError]</span> = <span class="hljs-built_in">useState</span>(false);
const <span class="hljs-selector-attr">[hasData, setHasData]</span> = <span class="hljs-built_in">useState</span>(false);
</code></pre>
<p>åœ¨è¿™ç§ç»“æ„ä¸‹ï¼Œå¼€å‘è€…éœ€è¦æ—¶åˆ»è­¦æƒ•å˜é‡é—´çš„åŒæ­¥é—®é¢˜ã€‚æ¯”å¦‚åœ¨ <code>setLoading(true)</code> æ—¶ï¼Œå¿…é¡»è®°å¾—åŒæ—¶é‡ç½® <code>setError(false)</code>ã€‚è¿™ç§ä¾èµ–â€œäººä¸ºç»†å¿ƒâ€æ¥ç»´æŠ¤çš„ä»£ç ï¼Œéšç€è¿­ä»£å‘¨æœŸçš„æ‹‰é•¿ï¼Œå‡ ä¹å¿…ç„¶ä¼šäº§ç”Ÿ Bugã€‚</p>
<h3 data-id="heading-8">ä¸šåŠ¡é€»è¾‘è¦æ±‚çŠ¶æ€å¿…é¡»â€œäº’æ–¥â€</h3>
<p>åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¸šåŠ¡çŠ¶æ€åœ¨é€»è¾‘ä¸Šæ˜¯å®Œå…¨æ’ä»–çš„ã€‚</p>
<p>æ¯”å¦‚å¼€å¤´çš„â€œæ‰«ç è½®è¯¢â€åœºæ™¯ï¼šä¸€ä¸ªè¯·æ±‚ä¸å¯èƒ½æ—¢åœ¨â€œè¿›è¡Œä¸­â€åˆâ€œå·²å¤±è´¥â€ã€‚ç„¶è€Œï¼Œå¦‚æœä½¿ç”¨åˆ†æ•£çš„å¸ƒå°”å€¼æ§åˆ¶ï¼Œä»£ç å±‚é¢æ˜¯å…è®¸ <code>{ isLoading: true, isError: true }</code> è¿™ç§éæ³•ç»„åˆå­˜åœ¨çš„ã€‚</p>
<p>è¿™ç§é€»è¾‘ä¸Šçš„â€œæ’ä»–æ€§â€å¦‚æœä¸èƒ½åœ¨ä»£ç ç»“æ„ä¸Šå¾—åˆ°å¼ºåˆ¶ä¿è¯ï¼Œå°±ä¼šå¯¼è‡´ UI æ¸²æŸ“å‡ºé”™ï¼ˆä¾‹å¦‚ Loading åŠ¨ç”»å’Œé”™è¯¯æç¤ºé‡å æ˜¾ç¤ºï¼‰ã€‚æ‰€ä»¥å¦‚æœUIå±•ç¤ºä¾èµ–äºä¸¥æ ¼äº’æ–¥çš„çŠ¶æ€ï¼ˆå¦‚ Promise çš„ Pending/Resolved/Rejectedï¼‰ï¼Œè¯·å°½å¯èƒ½çš„ä½¿ç”¨çŠ¶æ€æœºå¼ºåˆ¶çº¦æŸã€‚</p>
<h3 data-id="heading-9">çŠ¶æ€æµè½¬è·¯å¾„æœ‰ä¸¥æ ¼é™åˆ¶</h3>
<p>ç®€å•çš„ä¸šåŠ¡çŠ¶æ€æµè½¬æ˜¯è‡ªç”±çš„ï¼Œè€Œå¤æ‚çš„ä¸šåŠ¡å¾€å¾€æ˜¯æœ‰å‘å›¾ã€‚</p>
<p>ä»¥â€œé€€æ¬¾æµç¨‹â€ä¸ºä¾‹ï¼š</p>
<ul>
<li>âœ… åˆæ³•è·¯å¾„ï¼š<code>ç”³è¯·ä¸­</code> -&gt; <code>å®¡æ ¸é€šè¿‡</code> -&gt; <code>æ‰“æ¬¾ä¸­</code></li>
<li>âŒ éæ³•è·¯å¾„ï¼š<code>ç”³è¯·ä¸­</code> -&gt; <code>æ‰“æ¬¾ä¸­</code>ï¼ˆè·³è¿‡å®¡æ ¸ï¼‰</li>
</ul>
<p>å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„ <code>if-else</code> æ¥é˜²å¾¡éæ³•è·³è½¬ï¼Œä»£ç ä¸­ä¼šå……æ–¥ç€å¤§é‡ <code>if (status === 'AUDIT_PASS')</code> è¿™æ ·çš„é˜²å¾¡æ€§åˆ¤æ–­ã€‚è€ŒçŠ¶æ€æœºå¯ä»¥é€šè¿‡é…ç½® <code>transitions</code>ï¼Œå¤©ç„¶åœ°ç¦æ­¢äº†æ‰€æœ‰æœªå®šä¹‰çš„è·³è½¬è·¯å¾„ã€‚</p>
<p>æ‰€ä»¥å½“ä¸šåŠ¡é€»è¾‘ä¸ä»…ä»…å…³ä¹â€œå½“å‰æ˜¯ä»€ä¹ˆçŠ¶æ€â€ï¼Œæ›´å…³ä¹â€œå½“å‰çŠ¶æ€å…è®¸å˜æ›´ä¸ºå“ªäº›çŠ¶æ€â€æ—¶ï¼Œå¯ä»¥è€ƒè™‘å¼•å…¥çŠ¶æ€æœºã€‚</p>
<h3 data-id="heading-10">æŠ€æœ¯é€‰å‹å¯¹ç…§è¡¨</h3>
<p>åœ¨å¼€å§‹å†™ä»£ç å‰ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨è¿›è¡Œå†³ç­–ï¼š</p>

























<table><thead><tr><th><strong>ä¸šåŠ¡åœºæ™¯ç‰¹å¾</strong></th><th><strong>æ¨èæ–¹æ¡ˆ</strong></th></tr></thead><tbody><tr><td>ç®€å•çš„å¼€/å…³çŠ¶æ€ (Toggle)</td><td><code>useState(boolean)</code></td></tr><tr><td>ç®€å•çš„äº’æ–¥çŠ¶æ€ (Loading/Success/Error)</td><td>å­—ç¬¦ä¸²æšä¸¾ (String Enum)</td></tr><tr><td><strong>çŠ¶æ€å¤æ‚ï¼Œä¸”å­˜åœ¨ç‰¹å®šçš„æµè½¬è§„åˆ™</strong></td><td><strong>çŠ¶æ€æœº (Reducer / XState)</strong></td></tr><tr><td><strong>æ¶‰åŠå®šæ—¶å™¨ã€é‡è¯•ã€å–æ¶ˆç­‰å¼‚æ­¥ç«æ€é—®é¢˜</strong></td><td><strong>çŠ¶æ€æœº (æ¨è)</strong></td></tr></tbody></table>
<p>è®°ä½ï¼Œå·¥å…·æ˜¯ä¸ºäº†è§£å†³å¤æ‚åº¦è€Œç”Ÿçš„ã€‚ç®€å•ç•™ç»™ <code>useState</code>ï¼Œå¤æ‚ç•™ç»™çŠ¶æ€æœºã€‚</p>
<h2 data-id="heading-11">é™åˆ¶å³è‡ªç”±</h2>
<p>å†™çƒ‚ä»£ç çš„æœ¬è´¨ï¼Œå¾€å¾€æ˜¯æˆ‘ä»¬è¯•å›¾åœ¨æ··ä¹±ä¸­ä¿ç•™è¿‡å¤šçš„â€œè‡ªç”±åº¦â€ã€‚è€Œä¼˜ç§€æ¶æ„çš„æœ¬è´¨ï¼Œé€šå¸¸åœ¨äº<strong>é™åˆ¶</strong>ã€‚æ­£å¦‚é‚£å¥è¯è¯´çš„ï¼šã€Œ<strong>å–œæ¬¢å°±ä¼šæ”¾è‚†ï¼Œä½†çˆ±å°±æ˜¯å…‹åˆ¶</strong>ã€</p>
<p>çŠ¶æ€æœºä¸¥æ ¼è§„å®šäº†ä»€ä¹ˆçŠ¶æ€ä¸‹èƒ½åšä»€ä¹ˆäº‹ï¼Œè¿™ç§å…‹åˆ¶æé«˜äº†æˆ‘ä»¬çš„å‰ç«¯ç¨³å®šæ€§ã€‚</p>
<p><strong>æœ€åé€ç»™æ‰€æœ‰çš„å‰ç«¯çš„ä¸€å¥è¯ï¼š</strong></p>
<blockquote>
<p>æ‰€æœ‰çš„ Bugï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ <strong>â€œéæ³•çš„çŠ¶æ€â€æˆ–â€œé”™è¯¯çš„è½¬æ¢â€</strong>ã€‚</p>
<p>TypeScript å¸®æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶é™æ€åœ°è§„é¿äº†éæ³•ç±»å‹ï¼Œè€ŒçŠ¶æ€æœºåˆ™å¸®æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç®¡ç†çŠ¶æ€æµè½¬ã€‚</p>
<p>TypeScript + State Machine = å‰ç«¯é€»è¾‘çš„ç»å¯¹é˜²å¾¡ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¾®ä¿¡å°ç¨‹åºçœŸæœºé¢„è§ˆ-æ•°å­—ä¸ç­‰å®½å¦‚ä½•è§£å†³]]></title>    <link>https://juejin.cn/post/7584650857070051337</link>    <guid>https://juejin.cn/post/7584650857070051337</guid>    <pubDate>2025-12-17T09:55:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650857070051337" data-draft-id="7584742635483529226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¾®ä¿¡å°ç¨‹åºçœŸæœºé¢„è§ˆ-æ•°å­—ä¸ç­‰å®½å¦‚ä½•è§£å†³"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T09:55:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äººç”Ÿ_ä½•å¤„_ä¸ç›¸é€¢"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036976285"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¾®ä¿¡å°ç¨‹åºçœŸæœºé¢„è§ˆ-æ•°å­—ä¸ç­‰å®½å¦‚ä½•è§£å†³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036976285/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äººç”Ÿ_ä½•å¤„_ä¸ç›¸é€¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:55:41.000Z" title="Wed Dec 17 2025 09:55:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h4 data-id="heading-0"><strong>æ•°å­—æ˜¾ç¤ºä¸ç­‰å®½</strong></h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa06a35eb6fe4196aed98801878d1b37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=3zXRONF6Pdr3LsINcE18a903n9A%3D" alt="image.png" loading="lazy"/></p>
<p><strong>ä½ æŒ‰ç…§è®¾è®¡ç¨¿ï¼Œ æŠŠå³ä¾§æ—¶é—´è®¾ç½®äº†åŒä¸€ä¸ªå­—å·ï¼Œ ä»¥ä¸ºå°±æ˜¯100%è¿˜åŸäº†UIè®¾è®¡ï¼Œè¿˜å¿ƒé‡Œå°å°å¾—æ„ğŸ¤”</strong></p>
<p><strong>çœŸæœºé¢„è§ˆä½ å‘ç°</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e97b9d23f0b44679f19d53a31693a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=WWrqgV205ODyhCMXcRW5IOAesFU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å“å‘¦æˆ‘å»</strong>ï¼Œæˆ‘çŒœä½ è‚¯å®šåŒºæ£€æŸ¥äº†å­—ä½“å¤§å°ï¼Œè‚¯å®šä¹Ÿé¢„è§ˆäº†å¥½å‡ éï¼Œæ‰ç¡®è®¤è¿™ä¸ªæƒ…å†µç¡®å®ä¸æ˜¯å­—ä½“å¤§å°ä¸ä¸€æ ·å¯¼è‡´çš„</p>
<p>ğŸ˜‚ğŸ˜‚ğŸ˜‚ å…¶å®æ˜¯å› ä¸º <code>0</code> å’Œ <code>1</code> ä¸å…¶å®ƒæ•°å­—å®½åº¦ä¸ä¸€è‡´å¯¼è‡´çš„</p>
<p>é‚£è§£å†³æ–¹æ³•è‚¯å®šæ˜¯ <strong>è®¾ç½®ä¸€ä¸ªç­‰å®½å­—ä½“</strong> ä½†æ˜¯é‚£ä¹ˆå¤šç­‰å®½å­—ä½“ <strong>åˆ°åº•åº”è¯¥é€‰æ‹©é‚£ä¸ªå­—ä½“ï¼Ÿ</strong></p>
<p>é€‰æ‹©çš„ä¸å¯¹ï¼Œå°±ä¼šé€ æˆä¸‹é¢çš„æ•ˆæœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b5796ff319e4786b3fc54d4890fdb37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=sX%2F%2FwSH36ggY7f71Qag7wX%2FspfA%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ–è€…è¿™æ ·</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4395107f11f4853a8165fa1f34b3ae3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=naE%2FFV1antOI1%2BStGw0dE31p3Hc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å¦‚æœä½ ä¹Ÿå‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œä½ ä¸å¦¨è®¾ç½®</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">font-family</span>: Helvetica Neue;
</code></pre>
<p>è¿™ä¸ªè¯•è¯•çœ‹ï¼Œä½ ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93017b3d83704a3fa27d6927c7a0c933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=H%2Bk9DfgO87dFlaGeK8qB5%2FFiixA%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>å¥½äº†ï¼Œæœ€åå¸Œæœ›å¤§å®¶éƒ½ä¸è¦è¸©å‘ï¼Œæ„¿æ‰€æœ‰bugçš„è§£å†³æ–¹æ³• éƒ½å¯ä»¥ç™¾åº¦åˆ° è°¢è°¢</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutterä½¿ç”¨package_info_plusåº“è·å–åº”ç”¨ä¿¡æ¯çš„æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7583910637958807571</link>    <guid>https://juejin.cn/post/7583910637958807571</guid>    <pubDate>2025-12-16T00:40:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637958807571" data-draft-id="7583577045578530842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutterä½¿ç”¨package_info_plusåº“è·å–åº”ç”¨ä¿¡æ¯çš„æ•™ç¨‹"/> <meta itemprop="keywords" content="å‰ç«¯,Flutter,Android"/> <meta itemprop="datePublished" content="2025-12-16T00:40:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹å¤šå¤š"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutterä½¿ç”¨package_info_plusåº“è·å–åº”ç”¨ä¿¡æ¯çš„æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹å¤šå¤š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:40:41.000Z" title="Tue Dec 16 2025 00:40:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"â€¢";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. ç®€ä»‹</h2>
<p>åœ¨ Flutter åº”ç”¨å¼€å‘ä¸­ï¼Œè·å–åº”ç”¨è‡ªèº«çš„ä¿¡æ¯ï¼ˆå¦‚åº”ç”¨åç§°ã€ç‰ˆæœ¬å·ã€åŒ…åç­‰ï¼‰æ˜¯ä¸€é¡¹å¸¸è§éœ€æ±‚ï¼Œè¿™äº›ä¿¡æ¯å¯ç”¨äºå±•ç¤ºåœ¨å…³äºé¡µé¢ã€ç”¨äºç»Ÿè®¡åˆ†ææˆ–å®ç°ç‰¹å®šä¸šåŠ¡é€»è¾‘ã€‚<code>package_info_plus</code> æ’ä»¶æ˜¯ Flutter ç”Ÿæ€ä¸­è·å–åº”ç”¨å…ƒæ•°æ®çš„æœ€ä½³é€‰æ‹©ï¼Œæ”¯æŒå¤šå¹³å°ä¸”ä½¿ç”¨ç®€å•ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨è¯¥æ’ä»¶è·å–å„ç±»åº”ç”¨ä¿¡æ¯ã€‚</p>
<p><code>package_info_plus</code> æ˜¯ä¸€ä¸ªè·¨å¹³å°æ’ä»¶ï¼Œç”¨äºè·å–åº”ç”¨çš„åŒ…ä¿¡æ¯å’Œå…ƒæ•°æ®ï¼Œå®ƒæ˜¯ <code>package_info</code> æ’ä»¶çš„å‡çº§ç‰ˆï¼Œç”± Flutter Community ç»´æŠ¤ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒ iOSã€Androidã€Webã€Windowsã€macOS å’Œ Linux å¤šå¹³å°</li>
<li>èƒ½å¤Ÿè·å–åº”ç”¨åç§°ã€åŒ…åã€ç‰ˆæœ¬å·ã€æ„å»ºå·ç­‰å…³é”®ä¿¡æ¯</li>
<li>ç”¨æ³•ç®€å•ï¼ŒAPI ç›´è§‚</li>
<li>ä¸æœ€æ–°çš„ Flutter ç‰ˆæœ¬ä¿æŒå…¼å®¹</li>
</ul>
<p><strong>å¯è·å–çš„ä¸»è¦ä¿¡æ¯</strong>ï¼š</p>
<ul>
<li>åº”ç”¨åç§°ï¼ˆåº”ç”¨å•†åº—ä¸­æ˜¾ç¤ºçš„åç§°ï¼‰</li>
<li>åŒ…å/åº”ç”¨ IDï¼ˆå¦‚ com.example.myappï¼‰</li>
<li>ç‰ˆæœ¬åç§°ï¼ˆå¦‚ 1.0.0ï¼‰</li>
<li>ç‰ˆæœ¬å·/æ„å»ºå·ï¼ˆå¦‚ 1ï¼‰</li>
<li>åº”ç”¨ç­¾åï¼ˆéƒ¨åˆ†å¹³å°ï¼‰</li>
</ul>
<h2 data-id="heading-1">2. å®‰è£…ä¸é…ç½®</h2>
<p>åœ¨é¡¹ç›®çš„ <code>pubspec.yaml</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>package_info_plus</code> ä¾èµ–ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">package_info_plus:</span> <span class="hljs-string">^4.0.0</span>  <span class="hljs-comment"># ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬</span>
</code></pre>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub get
</code></pre>
<h3 data-id="heading-2">2.1. å¹³å°ç‰¹å®šé…ç½®</h3>
<p><code>package_info_plus</code> åœ¨å¤§å¤šæ•°å¹³å°ä¸Šæ— éœ€é¢å¤–é…ç½®å³å¯ä½¿ç”¨ï¼Œä½†æŸäº›å¹³å°å¯èƒ½éœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š</p>
<p><strong>Web å¹³å°</strong>ï¼š
éœ€è¦åœ¨ <code>web/index.html</code> ä¸­æ·»åŠ ä¸€äº›å…ƒæ•°æ®ï¼Œæ’ä»¶ä¼šä»è¿™é‡Œè¯»å–ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å…¶ä»–å¤´éƒ¨å†…å®¹ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"application-name"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ä½ çš„åº”ç”¨åç§°"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"version"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1.0.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"build-number"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"package"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"com.example.myapp"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p><strong>å…¶ä»–å¹³å°</strong>ï¼š
Androidã€iOSã€Windowsã€macOS å’Œ Linux å¹³å°ä¸éœ€è¦é¢å¤–é…ç½®ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨ä»å„è‡ªçš„é…ç½®æ–‡ä»¶ä¸­è¯»å–ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-3">3. åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2>
<p>åœ¨éœ€è¦ä½¿ç”¨çš„ Dart æ–‡ä»¶ä¸­å¯¼å…¥ <code>package_info_plus</code>ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;
</code></pre>
<h3 data-id="heading-4">3.1. è·å–åº”ç”¨ä¿¡æ¯</h3>
<p><code>package_info_plus</code> æä¾›äº†ä¸€ä¸ª <code>PackageInfo</code> ç±»ï¼Œé€šè¿‡å®ƒå¯ä»¥è·å–æ‰€æœ‰åº”ç”¨ä¿¡æ¯ã€‚è·å–è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œé€šå¸¸ä½¿ç”¨ <code>await</code> å…³é”®å­—ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; getAppInfo() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-built_in">String</span> appName = packageInfo.appName;
  <span class="hljs-built_in">String</span> packageName = packageInfo.packageName;
  <span class="hljs-built_in">String</span> version = packageInfo.version;
  <span class="hljs-built_in">String</span> buildNumber = packageInfo.buildNumber;
  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'åº”ç”¨åç§°: <span class="hljs-subst">$appName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'åŒ…å: <span class="hljs-subst">$packageName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'ç‰ˆæœ¬å·: <span class="hljs-subst">$version</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ„å»ºå·: <span class="hljs-subst">$buildNumber</span>'</span>);
}
</code></pre>
<h3 data-id="heading-5">3.2. è¯¦ç»†ä¿¡æ¯è¯´æ˜</h3>
<p><code>PackageInfo</code> ç±»æä¾›çš„ä¸»è¦å±æ€§ï¼š</p>








































<table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th><th>å¹³å°æ”¯æŒ</th></tr></thead><tbody><tr><td><code>appName</code></td><td>åº”ç”¨çš„ç”¨æˆ·å¯è§åç§°</td><td>æ‰€æœ‰å¹³å°</td></tr><tr><td><code>packageName</code></td><td>åº”ç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆAndroid çš„åŒ…åï¼ŒiOS çš„ Bundle ID ç­‰ï¼‰</td><td>æ‰€æœ‰å¹³å°</td></tr><tr><td><code>version</code></td><td>åº”ç”¨çš„ç‰ˆæœ¬åç§°ï¼ˆå¦‚ 1.0.0ï¼‰</td><td>æ‰€æœ‰å¹³å°</td></tr><tr><td><code>buildNumber</code></td><td>åº”ç”¨çš„æ„å»ºå·æˆ–ç‰ˆæœ¬ä»£ç ï¼ˆé€šå¸¸æ˜¯æ•´æ•°ï¼‰</td><td>æ‰€æœ‰å¹³å°</td></tr><tr><td><code>buildSignature</code></td><td>åº”ç”¨çš„ç­¾åä¿¡æ¯</td><td>Android ç‰¹æœ‰</td></tr><tr><td><code>installerStore</code></td><td>åº”ç”¨çš„å®‰è£…æ¥æºå•†åº—</td><td>Android ç‰¹æœ‰</td></tr></tbody></table>
<h2 data-id="heading-6">4. å®æˆ˜ç¤ºä¾‹</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªå±•ç¤ºåº”ç”¨ä¿¡æ¯çš„"å…³äº"é¡µé¢ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboutPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> AboutPage({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;AboutPage&gt; createState() =&gt; _AboutPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AboutPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AboutPage</span>&gt; </span>{
  <span class="hljs-keyword">late</span> Future&lt;PackageInfo&gt; _packageInfoFuture;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    <span class="hljs-comment">// åˆå§‹åŒ–æ—¶è·å–åº”ç”¨ä¿¡æ¯</span>
    _packageInfoFuture = PackageInfo.fromPackageInfo();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'å…³äºæˆ‘ä»¬'</span>),
      ),
      body: FutureBuilder&lt;PackageInfo&gt;(
        future: _packageInfoFuture,
        builder: (context, snapshot) {
          <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.waiting) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: CircularProgressIndicator());
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snapshot.hasError) {
            <span class="hljs-keyword">return</span> Center(child: Text(<span class="hljs-string">'è·å–åº”ç”¨ä¿¡æ¯å¤±è´¥: <span class="hljs-subst">${snapshot.error}</span>'</span>));
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!snapshot.hasData) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: Text(<span class="hljs-string">'æ— æ³•è·å–åº”ç”¨ä¿¡æ¯'</span>));
          }

          PackageInfo packageInfo = snapshot.data!;

          <span class="hljs-keyword">return</span> SingleChildScrollView(
            padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16.0</span>),
            child: Column(
              children: [
                <span class="hljs-comment">// åº”ç”¨å›¾æ ‡</span>
                <span class="hljs-keyword">const</span> CircleAvatar(
                  radius: <span class="hljs-number">60</span>,
                  child: Icon(Icons.android, size: <span class="hljs-number">60</span>), <span class="hljs-comment">// å®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºåº”ç”¨å›¾æ ‡</span>
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// åº”ç”¨åç§°</span>
                Text(
                  packageInfo.appName,
                  style: Theme.of(context).textTheme.headlineMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
                
                <span class="hljs-comment">// ç‰ˆæœ¬ä¿¡æ¯</span>
                Text(
                  <span class="hljs-string">'ç‰ˆæœ¬: <span class="hljs-subst">${packageInfo.version}</span> (<span class="hljs-subst">${packageInfo.buildNumber}</span>)'</span>,
                  style: Theme.of(context).textTheme.titleMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// è¯¦ç»†ä¿¡æ¯åˆ—è¡¨</span>
                _buildInfoItem(<span class="hljs-string">'åŒ…å'</span>, packageInfo.packageName),
                <span class="hljs-keyword">if</span> (packageInfo.buildSignature.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'åº”ç”¨ç­¾å'</span>, packageInfo.buildSignature),
                <span class="hljs-keyword">if</span> (packageInfo.installerStore != <span class="hljs-keyword">null</span> &amp;&amp; packageInfo.installerStore!.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'å®‰è£…æ¥æº'</span>, packageInfo.installerStore!),
                
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">32</span>),
                
                <span class="hljs-comment">// ç‰ˆæƒä¿¡æ¯</span>
                <span class="hljs-keyword">const</span> Text(
                  <span class="hljs-string">'Â© 2023 ä½ çš„å…¬å¸åç§°. ä¿ç•™æ‰€æœ‰æƒåˆ©.'</span>,
                  style: TextStyle(color: Colors.grey),
                ),
              ],
            ),
          );
        },
      ),
    );
  }

  <span class="hljs-comment">// æ„å»ºä¿¡æ¯é¡¹</span>
  Widget _buildInfoItem(<span class="hljs-built_in">String</span> label, <span class="hljs-built_in">String</span> value) {
    <span class="hljs-keyword">return</span> Padding(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(vertical: <span class="hljs-number">8.0</span>),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            <span class="hljs-string">'<span class="hljs-subst">$label</span>: '</span>,
            style: <span class="hljs-keyword">const</span> TextStyle(
              fontWeight: FontWeight.bold,
              width: <span class="hljs-number">100</span>,
            ),
          ),
          Expanded(
            child: Text(value),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>è¿™ä¸ªç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„"å…³äº"é¡µé¢ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>FutureBuilder</code> å¤„ç†å¼‚æ­¥è·å–åº”ç”¨ä¿¡æ¯çš„è¿‡ç¨‹</li>
<li>å±•ç¤ºåŠ è½½çŠ¶æ€ã€é”™è¯¯çŠ¶æ€å’ŒæˆåŠŸçŠ¶æ€</li>
<li>æ˜¾ç¤ºåº”ç”¨åç§°ã€å›¾æ ‡ã€ç‰ˆæœ¬å·ç­‰åŸºæœ¬ä¿¡æ¯</li>
<li>æ ¹æ®å¹³å°ç‰¹æ€§é€‰æ‹©æ€§å±•ç¤ºç­¾åå’Œå®‰è£…æ¥æºä¿¡æ¯</li>
</ul>
<h2 data-id="heading-7">5. é«˜çº§åº”ç”¨åœºæ™¯</h2>
<p>ä¸‹é¢æ˜¯ä¸€äº›é«˜çº§çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ï¼š</p>
<h3 data-id="heading-8">5.1. ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥</h3>
<p>å¯ä»¥ä½¿ç”¨è·å–åˆ°çš„ç‰ˆæœ¬å·å®ç°ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VersionChecker</span> </span>{
  <span class="hljs-comment">// å‡è®¾è¿™æ˜¯ä»æœåŠ¡å™¨è·å–çš„æœ€æ–°ç‰ˆæœ¬å·</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> _latestVersion = <span class="hljs-string">"1.1.0"</span>;
  
  Future&lt;<span class="hljs-built_in">bool</span>&gt; isUpdateAvailable() <span class="hljs-keyword">async</span> {
    PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
    <span class="hljs-keyword">return</span> _compareVersions(packageInfo.version, _latestVersion) &lt; <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-comment">// ç‰ˆæœ¬å·æ¯”è¾ƒå·¥å…·æ–¹æ³•</span>
  <span class="hljs-built_in">int</span> _compareVersions(<span class="hljs-built_in">String</span> current, <span class="hljs-built_in">String</span> latest) {
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; currentParts = current.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; latestParts = latest.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    
    <span class="hljs-built_in">int</span> maxLength = max(currentParts.length, latestParts.length);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; maxLength; i++) {
      <span class="hljs-built_in">int</span> currentPart = i &lt; currentParts.length ? currentParts[i] : <span class="hljs-number">0</span>;
      <span class="hljs-built_in">int</span> latestPart = i &lt; latestParts.length ? latestParts[i] : <span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">if</span> (currentPart &lt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">if</span> (currentPart &gt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">void</span> checkForUpdates() <span class="hljs-keyword">async</span> {
  VersionChecker checker = VersionChecker();
  <span class="hljs-built_in">bool</span> hasUpdate = <span class="hljs-keyword">await</span> checker.isUpdateAvailable();
  <span class="hljs-keyword">if</span> (hasUpdate) {
    <span class="hljs-comment">// æ˜¾ç¤ºæ›´æ–°æç¤º</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼"</span>);
  }
}
</code></pre>
<h3 data-id="heading-9">5.2. åº”ç”¨ä½¿ç”¨ç»Ÿè®¡</h3>
<p>ç»“åˆè®¾å¤‡ä¿¡æ¯å’Œåº”ç”¨ä¿¡æ¯ï¼Œå¯ä»¥å®ç°åº”ç”¨ä½¿ç”¨ç»Ÿè®¡ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:device_info_plus/device_info_plus.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; trackAppUsage() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  DeviceInfoPlugin deviceInfo = DeviceInfoPlugin();
  
  <span class="hljs-built_in">String</span> trackingInfo = <span class="hljs-string">'''
  åº”ç”¨ä¿¡æ¯:
  - åç§°: <span class="hljs-subst">${packageInfo.appName}</span>
  - ç‰ˆæœ¬: <span class="hljs-subst">${packageInfo.version}</span>
  - åŒ…å: <span class="hljs-subst">${packageInfo.packageName}</span>
  
  è®¾å¤‡ä¿¡æ¯:
  '''</span>;
  
  <span class="hljs-keyword">if</span> (Platform.isAndroid) {
    AndroidDeviceInfo androidInfo = <span class="hljs-keyword">await</span> deviceInfo.androidInfo;
    trackingInfo += <span class="hljs-string">'- è®¾å¤‡: <span class="hljs-subst">${androidInfo.brand}</span> <span class="hljs-subst">${androidInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- ç³»ç»Ÿç‰ˆæœ¬: Android <span class="hljs-subst">${androidInfo.version.release}</span>'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Platform.isIOS) {
    IosDeviceInfo iosInfo = <span class="hljs-keyword">await</span> deviceInfo.iosInfo;
    trackingInfo += <span class="hljs-string">'- è®¾å¤‡: <span class="hljs-subst">${iosInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- ç³»ç»Ÿç‰ˆæœ¬: iOS <span class="hljs-subst">${iosInfo.systemVersion}</span>'</span>;
  }
  
  <span class="hljs-comment">// å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šå°†ç»Ÿè®¡ä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨</span>
  <span class="hljs-built_in">print</span>(trackingInfo);
}
</code></pre>
<h3 data-id="heading-10">5.3. åŠ¨æ€é…ç½®åº”ç”¨è¡Œä¸º</h3>
<p>æ ¹æ®åº”ç”¨ç‰ˆæœ¬åŠ¨æ€é…ç½®åº”ç”¨è¡Œä¸ºï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; configureAppBehavior() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-comment">// æ ¹æ®ä¸åŒç‰ˆæœ¬å¯ç”¨ä¸åŒåŠŸèƒ½</span>
  <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.0.'</span>)) {
    <span class="hljs-comment">// v1.0.x ç‰ˆæœ¬çš„é…ç½®</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'é…ç½®åŸºç¡€åŠŸèƒ½'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.1.'</span>)) {
    <span class="hljs-comment">// v1.1.x ç‰ˆæœ¬çš„é…ç½®</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'é…ç½®é«˜çº§åŠŸèƒ½'</span>);
  }
  
  <span class="hljs-comment">// æ ¹æ®æ„å»ºå·å¯ç”¨æµ‹è¯•åŠŸèƒ½</span>
  <span class="hljs-built_in">int</span> buildNumber = <span class="hljs-built_in">int</span>.tryParse(packageInfo.buildNumber) ?? <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (buildNumber &gt;= <span class="hljs-number">100</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å¯ç”¨betaåŠŸèƒ½'</span>);
  }
}
</code></pre>
<h2 data-id="heading-11">6. æ³¨æ„äº‹é¡¹</h2>
<ul>
<li><strong>å¼‚æ­¥å¤„ç†</strong>
<ul>
<li><code>PackageInfo.fromPackageInfo()</code> æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œå¿…é¡»æ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œ</li>
<li>å»ºè®®åœ¨åº”ç”¨å¯åŠ¨æ—¶è·å–ä¸€æ¬¡åº”ç”¨ä¿¡æ¯å¹¶ç¼“å­˜ï¼Œé¿å…é‡å¤è·å–</li>
<li>ä½¿ç”¨ <code>FutureBuilder</code> æˆ–çŠ¶æ€ç®¡ç†å·¥å…·ï¼ˆå¦‚ Providerã€Blocï¼‰å¤„ç† UI æ¸²æŸ“</li>
</ul>
</li>
<li><strong>å¹³å°å·®å¼‚</strong>
<ul>
<li>ä¸åŒå¹³å°ä¸Šçš„ä¿¡æ¯å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå°¤å…¶æ˜¯ <code>buildSignature</code> å’Œ <code>installerStore</code> ç­‰å¹³å°ç‰¹å®šå±æ€§</li>
<li>Web å¹³å°éœ€è¦æ‰‹åŠ¨é…ç½®å…ƒæ•°æ®ï¼Œå…¶ä»–å¹³å°åˆ™è‡ªåŠ¨è¯»å–</li>
<li>å¤„ç†å¹³å°ç‰¹å®šå±æ€§æ—¶ï¼Œåº”å…ˆæ£€æŸ¥å…¶æ˜¯å¦å­˜åœ¨æˆ–ä¸ä¸ºç©º</li>
</ul>
</li>
<li><strong>ç‰ˆæœ¬å·ç®¡ç†</strong>
<ul>
<li>ä¿æŒ <code>pubspec.yaml</code>ã€AndroidManifest.xml å’Œ Info.plist ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯åŒæ­¥</li>
<li>å»ºç«‹æ¸…æ™°çš„ç‰ˆæœ¬å·å‘½åè§„åˆ™ï¼ˆå¦‚è¯­ä¹‰åŒ–ç‰ˆæœ¬ ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢å·ï¼‰</li>
<li>æ„å»ºå·åº”éšæ¯æ¬¡æ„å»ºé€’å¢ï¼Œç”¨äºåŒºåˆ†ä¸åŒæ„å»º</li>
</ul>
</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>
<ul>
<li>åº”ç”¨ä¿¡æ¯ä¸ä¼šé¢‘ç¹å˜åŒ–ï¼Œæ— éœ€å¤šæ¬¡è·å–</li>
<li>å»ºè®®åœ¨åº”ç”¨åˆå§‹åŒ–é˜¶æ®µè·å–å¹¶å­˜å‚¨åœ¨å…¨å±€çŠ¶æ€ä¸­</li>
<li>é¿å…åœ¨ UI æ¸²æŸ“å…³é”®è·¯å¾„ä¸­è·å–åº”ç”¨ä¿¡æ¯</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">7. å¸¸è§é—®é¢˜è§£å†³</h2>
<ul>
<li><strong>ä¿¡æ¯ä¸å‡†ç¡®æˆ–æœªæ›´æ–°</strong>
<ul>
<li>ç¡®ä¿æ‰€æœ‰å¹³å°çš„é…ç½®æ–‡ä»¶éƒ½å·²æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯</li>
<li>è¿è¡Œ <code>flutter clean</code> æ¸…ç†ç¼“å­˜åé‡æ–°æ„å»º</li>
<li>å¯¹äº Web å¹³å°ï¼Œæ£€æŸ¥ <code>index.html</code> ä¸­çš„å…ƒæ•°æ®æ˜¯å¦æ­£ç¡®</li>
</ul>
</li>
<li><strong>æŸäº›å±æ€§ä¸ºç©º</strong>
<ul>
<li>æŸäº›å±æ€§ï¼ˆå¦‚ <code>installerStore</code>ï¼‰ä»…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰æœ‰å€¼</li>
<li>æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„å¹³å°ä¸Šè®¿é—®å¹³å°ç‰¹å®šå±æ€§</li>
<li>Web å¹³å°éœ€è¦æ‰‹åŠ¨é…ç½®æ‰€æœ‰å±æ€§</li>
</ul>
</li>
<li><strong>æ„å»ºé”™è¯¯</strong>
<ul>
<li>ç¡®ä¿ä½¿ç”¨çš„ <code>package_info_plus</code> ç‰ˆæœ¬ä¸ Flutter ç‰ˆæœ¬å…¼å®¹</li>
<li>æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¯¼å…¥äº†åŒ…</li>
<li>å°è¯•æ›´æ–°æ’ä»¶åˆ°æœ€æ–°ç‰ˆæœ¬</li>
</ul>
</li>
</ul>
<h2 data-id="heading-13">8. æ€»ç»“</h2>
<p><code>package_info_plus</code> æ˜¯ Flutter å¼€å‘ä¸­è·å–åº”ç”¨å…ƒæ•°æ®çš„å®ç”¨å·¥å…·ï¼Œå®ƒæä¾›äº†ç®€å•ç›´è§‚çš„ APIï¼Œæ”¯æŒå¤šå¹³å°ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§å¤šæ•°åº”ç”¨å¯¹è·å–è‡ªèº«ä¿¡æ¯çš„éœ€æ±‚ã€‚</p>
<p>åˆç†åˆ©ç”¨åº”ç”¨ä¿¡æ¯å¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼Œç®€åŒ–å¼€å‘æµç¨‹ï¼Œå¹¶ä¸ºåº”ç”¨çš„ç»Ÿè®¡åˆ†ææä¾›æ”¯æŒã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fpackage_info_plus" target="_blank" title="https://pub.dev/packages/package_info_plus" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<hr/>
<blockquote>
<p>æœ¬æ¬¡åˆ†äº«å°±åˆ°è¿™å„¿å•¦ï¼Œæˆ‘æ˜¯é¹å¤šå¤šï¼Œæ·±è€•å‰ç«¯çš„æŠ€æœ¯åˆ›ä½œè€…ï¼Œå¦‚æœæ‚¨çœ‹äº†è§‰å¾—æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯„è®ºï¼Œå…³æ³¨ï¼Œç‚¹èµï¼Œè½¬å‘ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§~</p>
</blockquote>
<p>PSï¼šåœ¨æœ¬é¡µæŒ‰F12ï¼Œåœ¨consoleä¸­è¾“å…¥document.getElementsByClassName('panel-btn')[0].click();æœ‰æƒŠå–œå“¦~</p>
<p><code>å¾€æœŸæ–‡ç« </code></p>
<ul>
<li><a href="https://juejin.cn/post/7582808491582619684" target="_blank" title="https://juejin.cn/post/7582808491582619684">Flutterè¾“å…¥æ¡†TextFieldçš„å±æ€§ä¸å®æˆ˜ç”¨æ³•å…¨é¢è§£æ+ç¤ºä¾‹</a></li>
<li><a href="https://juejin.cn/post/7581693431740448831" target="_blank" title="https://juejin.cn/post/7581693431740448831">Flutterè‡ªå®šä¹‰æ—¥å†table_calendarå®Œå…¨æŒ‡å—+æ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-å±å¹•è‡ªé€‚åº”æ’ä»¶flutter_screenutilæ•™ç¨‹å…¨æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-ä½¿ç”¨url_launcheræ‰“å¼€é“¾æ¥/åº”ç”¨/çŸ­ä¿¡/é‚®ä»¶å’Œè¯„åˆ†è·³è½¬ç­‰</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">è§£é”flutterå¼¹çª—æ–°å§¿åŠ¿ï¼šdialog-flutter_smart_dialogæ’ä»¶è§£è¯»+æ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-åˆ‡æ¢çŠ¶æ€æ˜¾ç¤ºä¸åŒç»„ä»¶10ç§å®ç°æ–¹æ¡ˆå…¨è§£æ</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-è¯¦è§£æ§åˆ¶ç»„ä»¶æ˜¾ç¤ºçš„ä¸¤ç§æ–¹å¼Offstageä¸Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-ä½¿ç”¨AnimatedDefaultTextStyleå®ç°æ–‡æœ¬åŠ¨ç”»</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-ä½¿ç”¨SafeAreaç»„ä»¶å¤„ç†å„æœºå‹çš„å®‰å…¨è·ç¦»</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-å®ç°æ¸å˜è‰²è¾¹æ¡†èƒŒæ™¯ä»¥åŠæ¸å˜è‰²æ–‡å­—</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-ä½¿ç”¨confettiåˆ¶ä½œç‚«é…·çº¸å±‘çˆ†ç‚¸ç²’å­åŠ¨ç”»</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¾®å‰ç«¯æ¶æ„ï¼ˆäºŒï¼‰ï¼šå°è£…ä¸å®ç°]]></title>    <link>https://juejin.cn/post/7584059298697216041</link>    <guid>https://juejin.cn/post/7584059298697216041</guid>    <pubDate>2025-12-16T09:53:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584059298697216041" data-draft-id="7584273076645658630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¾®å‰ç«¯æ¶æ„ï¼ˆäºŒï¼‰ï¼šå°è£…ä¸å®ç°"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-16T09:53:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç å†œèƒ–å¤§æµ·"/> <meta itemprop="url" content="https://juejin.cn/user/4195392102086967"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¾®å‰ç«¯æ¶æ„ï¼ˆäºŒï¼‰ï¼šå°è£…ä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4195392102086967/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç å†œèƒ–å¤§æµ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T09:53:19.000Z" title="Tue Dec 16 2025 09:53:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>å¾ˆè£å¹¸ç”±æˆ‘è®¾è®¡å¹¶å®ç°äº†å…¬å¸è‡ªç ”çš„å¾®å‰ç«¯æ¡†æ¶ï¼Œç›®å‰è¯¥æ¡†æ¶å·²åœ¨å¤šä¸ªä¸šåŠ¡é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚</p>
<p>æœ¬æ–‡æ˜¯æˆ‘ç»“åˆå†…éƒ¨åŸ¹è®­ã€äº§å“æ–‡æ¡£åŠç›¸å…³å®è·µæ¢³ç†è€Œæˆçš„æ€»ç»“ï¼Œæ—¨åœ¨å¯¹å¾®å‰ç«¯æŠ€æœ¯ä½“ç³»è¿›è¡Œç³»ç»Ÿæ€§çš„æ•´ç†ä¸æ²‰æ·€ã€‚</p>
<p>æœ¬ç¯‡æ˜¯ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ï¼Œåˆ†äº«ä¸€äº›å…³äºå¾®å‰ç«¯çš„å°è£…å’Œå®è·µã€‚</p>
<h2 data-id="heading-1">äºŒã€äº§å“ç®€ä»‹</h2>
<p>XXå¾®å‰ç«¯æ˜¯åŸºäºqiankunå’Œå…¬å¸æƒé™ç®¡ç†ç³»ç»Ÿå®ç°çš„å¾®å‰ç«¯æ¶æ„è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶èƒ½æ›´ç®€å•ã€æ— ç—›åœ°æ„å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨å¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚</p>
<p>å®ƒåœ¨XXåŸºç¡€æ¨¡æ¿çš„åŸºç¡€ä¸Šï¼Œå…¼å®¹é€‚é…äº†XXå·²æœ‰çš„ç”¨æˆ·è®¤è¯ã€æƒé™æ§åˆ¶ã€åŸ‹ç‚¹åŠŸèƒ½ï¼Œå¹¶é›†æˆäº†ä¸€ç³»åˆ—å¾®å‰ç«¯èƒ½åŠ›ï¼ŒåŒ…æ‹¬åº”ç”¨åŠ è½½ã€åº”ç”¨é€šä¿¡ã€åº”ç”¨éš”ç¦»ã€åº”ç”¨ç¼“å­˜ç­‰ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e50befbb384003b8bef3f838d65c8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5Yac6IOW5aSn5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766483598&amp;x-signature=8HU6uvvSZjKSWFtic1y4ktT865U%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒå°è£…ä¸å®ç°</h2>
<h3 data-id="heading-3">3.1 åº”ç”¨ç¼“å­˜</h3>
<p>åœ¨ä¸»åº”ç”¨ä¸­ä½¿ç”¨<code>Â v-showÂ </code>æŒ‡ä»¤æ§åˆ¶å­åº”ç”¨å®¹å™¨ï¼Œä»¥å®ç°å­åº”ç”¨çš„åˆ‡æ¢ä¸ç¼“å­˜ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- å­åº”ç”¨å®¹å™¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in apps"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"app-container"</span>
    <span class="hljs-attr">v-show</span>=<span class="hljs-string">"currentAppName &amp;&amp; currentAppName === item.name"</span>
    <span class="hljs-attr">:id</span>=<span class="hljs-string">"`container-${item.name}`"</span>
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.name"</span>
  &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">3.2 åº”ç”¨åŠ è½½</h3>
<p>é‡‡ç”¨qiankunçš„loadMicroAppå®ç°å¤šæ ‡ç­¾é¡µåœºæ™¯ä¸‹çš„åº”ç”¨åŠ è½½ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d26fe558168249ea826cb799b21543a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5Yac6IOW5aSn5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766483598&amp;x-signature=kqJvHzuSWkteh5vz7Brv8kSX81Y%3D" alt="image.png" loading="lazy"/></p>
<p>æ ¸å¿ƒé€»è¾‘è¯´æ˜ï¼šç›‘å¬è·¯ç”±å˜åŒ–=ã€‹æ ¹æ®è·¯ç”±åŒ¹é…å­åº”ç”¨=ã€‹loadMicroAppæ‰‹åŠ¨åŠ è½½å­åº”ç”¨ï¼Œç»™æŒ‚è½½åˆ°æŒ‡å®šå®¹å™¨ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">// 1. ç›‘å¬è·¯ç”±å˜åŒ–
watch: {
    $route: {
      immediate: false,
      handler(route) {
        this.openMicroApp(route);
      }
    }
  },
// 2. æ ¹æ®è·¯ç”±ä¿¡æ¯è·å–èœå•æ•°æ®åŠå­åº”ç”¨ä¿¡æ¯
const resource = getMenuByRoute(route);
subApp = resource &amp;&amp; this.getAppById(resource.rootResourceId);
// 2.1 èœå•èµ„æºæ•°æ®æ˜ å°„å…³ç³»
{
  id: item.resourceId, // webåº”ç”¨èµ„æºid
  name: item.resourceCode, // webåº”ç”¨èµ„æºç¼–ç 
  entry: item.resourceUrl // webåº”ç”¨åŸºç¡€è·¯å¾„
}
// 3. è°ƒç”¨loadMicroAppåŠ è½½å­åº”ç”¨
const { name, entry } = subApp;
const appInstances = loadMicroApp({
  name,
  entry,
  container: `#container-${name}`,
  props: {}
});
</code></pre>
<p>ä»¥ä¸Šä»£ç æ˜¯ç®€åŒ–åçš„ç¤ºæ„ä»£ç ï¼Œå®é™…å®ç°ä¸­è¿˜åŒ…å«æœ‰å¯¹å®¹å™¨èŠ‚ç‚¹ã€è·¯ç”±ã€loadingç­‰ç»†èŠ‚çš„å¤„ç†ã€‚</p>
<h3 data-id="heading-5">3.3 åº”ç”¨é€šä¿¡</h3>
<h4 data-id="heading-6">3.3.1 åŸºäºprops</h4>
<p>qiankunçš„<code>loadMicroApp</code>Â æ–¹æ³•æ”¯æŒé€šè¿‡propsé…ç½®é€‰é¡¹ï¼Œä¼ é€’æ•°æ®æˆ–è€…æ–¹æ³•ç»™å­åº”ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. ä¸»åº”ç”¨å®šä¹‰å¹¶é€šè¿‡props.dataä¼ é€’</span>
<span class="hljs-keyword">const</span> mainAppName = <span class="hljs-string">'app-main'</span>
<span class="hljs-keyword">const</span> appInstances = <span class="hljs-title function_">loadMicroApp</span>({
  name,
  entry,
  <span class="hljs-attr">container</span>: <span class="hljs-string">`#container-<span class="hljs-subst">${name}</span>`</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: {
      mainAppName
    }
  }
});

<span class="hljs-comment">// 2. å­åº”ç”¨æ¥æ”¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-title function_">render</span>(props);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { data = {}, container } = props || {};
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">mainAppName</span>)
}
</code></pre>
<h4 data-id="heading-7">3.3.2 åŸºäºwindow</h4>
<p>é€šè¿‡æŒ‚è½½å…¨å±€å±æ€§å’Œæ–¹æ³•ï¼Œä¾›å…¶ä»–åº”ç”¨ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. ä¸»åº”ç”¨å®šä¹‰</span>
window.<span class="hljs-variable">$mainAxxxxxxx</span> = <span class="hljs-built_in">initAxxxxxxx</span>(router);

<span class="hljs-comment">// 2. å­åº”ç”¨é€šè¿‡windowè°ƒç”¨</span>
window.<span class="hljs-variable">$mainAxxxxxxx</span><span class="hljs-selector-class">.xxx</span>();
</code></pre>
<h4 data-id="heading-8">3.3.3 åŸºäºäº‹ä»¶</h4>
<p>æ¡†æ¶é€‰ç”¨Node.jsçš„EventEmitterï¼Œç”±ä¸»åº”ç”¨é›†æˆå¹¶å¯¹å¤–æä¾›event-busåŸºäºäº‹ä»¶æ€»çº¿çš„åº”ç”¨é—´é€šä¿¡èƒ½åŠ›ã€‚åŒ…å«äº‹ä»¶çš„æ³¨å†Œã€æ´¾å‘å’Œç§»é™¤åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. ä¸»åº”ç”¨å®ä¾‹åŒ–äº‹ä»¶å¯¹è±¡</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventEmitter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'events'</span>;
<span class="hljs-keyword">const</span> eventBus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();
<span class="hljs-comment">// 2. ç›‘å¬äº‹ä»¶</span>
eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-function">(<span class="hljs-params">params1, params2</span>) =&gt;</span> {
  <span class="hljs-comment">// ...do some things</span>
});
<span class="hljs-comment">// 3. ä¼ é€’å®ä¾‹ç»™å­åº”ç”¨</span>
<span class="hljs-title function_">loadMicroApp</span>({
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: {
      eventBus
    }
  }
});

<span class="hljs-comment">// 4. å­åº”ç”¨æ¥æ”¶å¹¶æ´¾å‘äº‹ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { data = {}, container } = props || {};
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">eventBus</span>) {
    data.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event1'</span>, params1, params2);
  }
}
<span class="hljs-comment">// 5. å­åº”ç”¨ä¹Ÿå¯ä»¥ ç›‘å¬å…¶ä»–åº”ç”¨æ´¾å‘çš„äº‹ä»¶</span>
data.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'xxx'</span>,xxx)
</code></pre>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸é¼“åŠ±ä½¿ç”¨å…¨å±€çš„äº‹ä»¶æ€»çº¿åœ¨ç»„ä»¶ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚è™½ç„¶åœ¨çŸ­æœŸå†…å¾€å¾€æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œä½†ä»é•¿æœŸæ¥çœ‹ï¼Œå®ƒç»´æŠ¤èµ·æ¥æ€»æ˜¯ä»¤äººå¤´ç–¼ã€‚å¯ä»¥ç”¨ï¼Œä½†ä¸å»ºè®®å¤§é‡ä½¿ç”¨ã€‚</li>
<li>åˆ é™¤åœ¨å…¶ä»–åœ°æ–¹æ·»åŠ çš„ç›‘å¬å™¨æ˜¯ä¸å¥½çš„åšæ³•ï¼Œç‰¹åˆ«æ˜¯å½“Â <code>EventEmitter</code>Â å®ä¾‹æ˜¯ç”±å…¶ä»–ç»„ä»¶æˆ–æ¨¡å—ï¼ˆä¾‹å¦‚å¥—æ¥å­—æˆ–æ–‡ä»¶æµï¼‰åˆ›å»ºæ—¶ã€‚å­˜åœ¨è¾ƒå¤§é£é™©éšæ‚£ã€‚</li>
</ul>
<h4 data-id="heading-9">3.3.4 åŸºäºvuex</h4>
<p>é€šè¿‡å…±äº«ä¸»åº”ç”¨store, å¯ä»¥å¿«é€Ÿå°†åŸºåº§çš„vuexæ³¨å†Œåˆ°å¾®åº”ç”¨è‡ªå·±çš„vuexå®ä¾‹ä¸Šã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ä¸»åº”ç”¨å®šä¹‰å¹¶é€šè¿‡propsä¼ é€’store</span>
<span class="hljs-keyword">import</span> qiankunCommonStore from <span class="hljs-string">'@/store/modules/common'</span>;
loadMicroApp({
  name,
  entry,
  container: `#container-${name}`,
  props: {
    <span class="hljs-keyword">data</span>: {
      store: qiankunCommonStore,
    }
  }
});
<span class="hljs-comment">// 2. å­åº”ç”¨storeæ³¨å†Œåˆ°è‡ªå·±çš„vuexå®ä¾‹ä¸Š</span>
function render(props) {
  <span class="hljs-keyword">const</span> { <span class="hljs-keyword">data</span> = {}, container } = props || {};
  <span class="hljs-keyword">if</span> (store &amp;&amp; store.hasModule &amp;&amp; <span class="hljs-keyword">data</span>.store) {
    store.registerModule(<span class="hljs-string">'mainAppStore'</span>, <span class="hljs-keyword">data</span>.store);
  }
}
<span class="hljs-comment">// 3.1 ä½¿ç”¨ï¼šå–å€¼</span>
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">this</span>.$store.state.mainAppStore.userInfo
<span class="hljs-comment">// 3.2 ä½¿ç”¨ï¼šèµ‹å€¼</span>
<span class="hljs-keyword">this</span>.$store.commit(<span class="hljs-string">'mainAppStore/setUserInfo'</span>, { ...<span class="hljs-keyword">this</span>.userInfo, newData: <span class="hljs-string">'home-new-data'</span> });
</code></pre>
<h4 data-id="heading-10">3.3.5 åŸºäºinitGlobalState</h4>
<p>qiankunæä¾›çš„åŸºäºå…¨å±€çŠ¶æ€çš„é€šä¿¡æ–¹å¼ã€‚æ¨¡æ¿ä¸­æœªé›†æˆï¼Œå¦‚éœ€ä½¿ç”¨ï¼Œå¯å‚çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fapi%23initglobalstatestate" target="_blank" title="https://qiankun.umijs.org/zh/api#initglobalstatestate" ref="nofollow noopener noreferrer">qiankunæ–‡æ¡£</a>è‡ªè¡Œæ‰©å±•ã€‚</p>
<p>æœªé›†æˆçš„åŸå› æ˜¯ï¼Œä½œè€…å¹¶<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Fqiankun%2Fdiscussions%2F1378%23discussioncomment-1475671" target="_blank" title="https://github.com/umijs/qiankun/discussions/1378#discussioncomment-1475671" ref="nofollow noopener noreferrer">ä¸æ¨èè¯¥API</a>å¹¶è®¡åˆ’åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ç§»é™¤ã€‚</p>
<p>globalState ä¸æ˜¯åˆç†çš„å¾®å‰ç«¯é€šä¿¡æ–¹æ¡ˆï¼Œä¼šåŠ å‰§åº”ç”¨ä¹‹é—´çš„è€¦åˆ.ã€‚ -- qiankunå®˜æ–¹issues</p>
<h3 data-id="heading-11">3.4 åº”ç”¨è·³è½¬</h3>
<h4 data-id="heading-12">3.4.1 åº”ç”¨å†…è·³è½¬</h4>
<p>è°ƒç”¨è‡ªèº«è·¯ç”±routerçš„æ–¹æ³•</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onJump</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
    path,
    query
  });
},
</code></pre>
<h4 data-id="heading-13">3.4.2 åº”ç”¨é—´è·³è½¬</h4>
<p>ä½¿ç”¨ä¸»åº”ç”¨è·¯ç”±æ–¹æ³•</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onJumpOther</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$root</span>.<span class="hljs-property">mainAppRouter</span>.<span class="hljs-title function_">push</span>({
    path,
    query
  });
},
</code></pre>
<h3 data-id="heading-14">3.5 åº”ç”¨éš”ç¦»</h3>
<h4 data-id="heading-15">3.5.1 jsæ²™ç®±</h4>
<p>ä¼—æ‰€å‘¨çŸ¥javaScriptçš„å…¨å±€ä½œç”¨åŸŸå­˜åœ¨å‘½åå†²çªã€å˜é‡æ±¡æŸ“ç­‰é£é™©ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œqiankunå€ŸåŠ© ES6 çš„ proxy ï¼Œåˆ›å»ºjsä»£ç†æ²™ç®±ï¼Œå®ç°äº†åº”ç”¨é—´ç¯å¢ƒçš„éš”ç¦»ã€‚</p>
<p>qiankunå·²æœ‰å®ç°ï¼Œé»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/6846687602439897101#heading-21" target="_blank" title="https://juejin.cn/post/6846687602439897101#heading-21">èš‚èšé‡‘æœä½“éªŒæŠ€æœ¯éƒ¨ qiankun çš„æ ¸å¿ƒè´¡çŒ®è€… - æ–¹æ¶£çš„åˆ†äº«</a></li>
</ul>
<h4 data-id="heading-16">3.5.2 æ ·å¼éš”ç¦»</h4>
<p>ä¸ºäº†ç¡®ä¿ä¸åŒç»„ä»¶æˆ–æ¨¡å—ä¹‹é—´çš„æ ·å¼ä¸ä¼šç›¸äº’å½±å“ï¼Œä»è€Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ã€‚qiankunæä¾›æœ‰ä¸¤ç§æ ·å¼éš”ç¦»æ–¹æ¡ˆï¼ŒstrictStyleIsolationå’ŒexperimentalStyleIsolationã€‚</p>
<p>qiankuné»˜è®¤å¼€å¯strictStyleIsolationä¸¥æ ¼çš„æ ·å¼éš”ç¦»æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ qiankun ä¼šä¸ºæ¯ä¸ªå¾®åº”ç”¨çš„å®¹å™¨åŒ…è£¹ä¸Šä¸€ä¸ªÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FWeb_Components%2FUsing_shadow_DOM" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM" ref="nofollow noopener noreferrer">shadow dom</a>Â èŠ‚ç‚¹ï¼Œä»è€Œç¡®ä¿å¾®åº”ç”¨çš„æ ·å¼ä¸ä¼šå¯¹å…¨å±€é€ æˆå½±å“ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fapi%23loadmicroappapp-configuration" target="_blank" title="https://qiankun.umijs.org/zh/api#loadmicroappapp-configuration" ref="nofollow noopener noreferrer">loadMicroApp.sandboxé…ç½®è¯´æ˜</a></li>
</ul>
<h4 data-id="heading-17">3.5.3 æœ¬åœ°å­˜å‚¨éš”ç¦»</h4>
<p>ä¸ºäº†é˜²æ­¢å„å¾®åº”ç”¨é—´æ“ä½œæœ¬åœ°å­˜å‚¨æ—¶ï¼Œæ•°æ®è¦†ç›–ã€è¯¯åˆ é™¤ç­‰é—®é¢˜ï¼Œæ¡†æ¶å°è£…å¹¶é›†æˆäº†æœ¬åœ°å­˜å‚¨åŠŸèƒ½æ¨¡å—ã€‚åŸç†æ˜¯åœ¨åŸºåº§è¿è¡Œæ—¶ï¼Œè¦†å†™localStorageã€sessionStorageæ–¹æ³•ï¼Œç»™æœ¬åœ°å­˜å‚¨çš„<code>key</code>Â ç»Ÿä¸€åŠ ä¸Šå‰ç¼€ã€‚</p>
<p>æˆ‘ä»¬å¯¹æ­¤å°è£…äº†ä¸€ä¸ªç»„ä»¶ï¼Œä»£ç  å’ŒAPIå°±ä¸èµ˜è¿°äº†ï¼Œè¿™é‡Œä»…åˆ†äº«ï¼Œåœ¨å»è¦†å†™çš„æ—¶å€™é‡åˆ°çš„ä¸€ä¸ªå¡ç‚¹é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<p>é—®é¢˜æè¿°ï¼šä¿®æ”¹Storageæ¥å£çš„åŸå‹æ–¹æ³•åï¼Œä¹¾å¤æ— æ³•éš”ç¦»ï¼Œ å¯¼è‡´æ‰€æœ‰åº”ç”¨ï¼ˆåŒ…æ‹¬ä¸»åº”ç”¨ï¼‰çš„ç›¸å…³æ–¹æ³•å‡è¢«ä¿®æ”¹ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šåœ¨å¼•å…¥qiankunä¹‹å‰åˆ é™¤window.localStorageï¼Œéšåå†é‡æ–°å£°æ˜ï¼Œæ­¤æ—¶çš„window.localStorageæ˜¯éš”ç¦»çš„ï¼Œåœ¨ä¸»å­åº”ç”¨åˆ†åˆ«å®šä¹‰ï¼Œäº’ä¸å½±å“ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸»åº”ç”¨</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>;
<span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>;
<span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> = {
Â <span class="hljs-title function_">getItem</span>(<span class="hljs-params">...ags</span>) {
Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"this"</span>, <span class="hljs-variable language_">this</span>);
Â  Â <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span>.<span class="hljs-title function_">getItem</span>(...ags);
},
};

<span class="hljs-comment">// å­åº”ç”¨</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> = {
Â <span class="hljs-title function_">getItem</span>(<span class="hljs-params">key, ...ags</span>) {
Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"insub"</span>);
Â  Â <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`app-vue<span class="hljs-subst">${key}</span>`</span>, ...ags);
},
};
</code></pre>
<p>åŸç†æ˜¯qiankunçš„æ²™ç®±ï¼ˆproxySandBoxï¼‰ï¼Œä¼šä»windowå¯¹è±¡æ‹·è´ä¸å¯é…ç½®çš„å±æ€§å¹¶filteræ‰ï¼Œä¸èµ°proxyä»£ç†ï¼Œæ¯”å¦‚locationã€localStorageç­‰ã€‚ç°åœ¨å’±ä»¬åœ¨qiankunæ²™ç®±é€»è¾‘æ‰§è¡Œå‰ï¼ŒæŠŠlocalStorageå±æ€§ç§»é™¤ï¼Œå®ƒæ‹·è´ä¸åˆ°ï¼Œåé¢å’±ä»¬å†åŠ ä¸Šçš„localStorageå°±ä¼šèµ°proxyç„¶åè¢«éš”ç¦»èµ·æ¥ã€‚</p>
<h3 data-id="heading-18">3.6 æƒé™æ§åˆ¶</h3>
<p>æ•´ä½“ç­–ç•¥æ˜¯ï¼Œå„å¾®åº”ç”¨åˆ†åˆ«è¿›è¡Œæƒé™æ§åˆ¶ï¼Œè°çš„é¡µé¢è°ç®¡æ§ã€‚</p>
<p>åœ¨å¾®å‰ç«¯åœºæ™¯ä¸‹ï¼Œç”±äºå„å¾®åº”ç”¨çš„è·¯ç”±ç›‘å¬çš„æ˜¯åŒä¸€urlï¼Œå½“urlåˆ‡æ¢æ—¶ï¼Œæ‰€æœ‰å¾®åº”ç”¨çš„è·¯ç”±å®ˆå«éƒ½ä¼šè§¦å‘ã€‚éœ€è¦å¯¹ä¸æ˜¯è‡ªå·±åº”ç”¨è·¯ç”±æ”¾è¡Œã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">// å¾®å‰ç«¯è¿è¡Œæ—¶çš„è·¯ç”±å®ˆå«
<span class="hljs-keyword">function</span> microAppHook(<span class="hljs-keyword">to</span>, <span class="hljs-keyword">from</span>, <span class="hljs-keyword">next</span>){
  <span class="hljs-keyword">const</span> isAppNameMatched = <span class="hljs-keyword">to</span>.meta.appName ? <span class="hljs-keyword">to</span>.meta.appName === appName : <span class="hljs-literal">true</span>,
    isNotMyRoute = !<span class="hljs-keyword">to</span>.path || !<span class="hljs-keyword">to</span>.name || !isAppNameMatched;
  <span class="hljs-keyword">if</span> (isNotMyRoute) {
    // éå½“å‰åº”ç”¨è·¯ç”±ï¼Œè·³è¿‡å¤„ç†
    <span class="hljs-keyword">next</span>();
    <span class="hljs-keyword">return</span>;
  }
  // æƒé™æ§åˆ¶ï¼šç™½åå•ã€è§’è‰²èœå•æƒé™åˆ¤æ–­
  <span class="hljs-keyword">if</span> (hasPermission(<span class="hljs-keyword">to</span>) || hasPermission(<span class="hljs-keyword">to</span>, <span class="hljs-literal">false</span>)) {
    <span class="hljs-keyword">next</span>();
  }<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">next</span>({path: <span class="hljs-comment">'/404', replace: true});</span>
  }
}
</code></pre>
<h2 data-id="heading-19">å››ã€åç»­æ”¹è¿›</h2>
<ol>
<li>
<p>æ€§èƒ½æå‡</p>
<ol>
<li>å†…å­˜å ç”¨é«˜ï¼šåœ¨ä½ç‰ˆæœ¬ç«ç‹æµè§ˆå™¨å†…å­˜å ç”¨ç»å¸¸æ€§è¶…è¿‡2Gï¼Œé¡µé¢å¡é¡¿æ˜æ˜¾</li>
<li>åŠ è½½é€Ÿåº¦æ…¢ï¼šè¶…è¿‡5Mçš„å­åº”ç”¨èµ„æºï¼Œè¯·æ±‚å’ŒåŠ è½½é•¿è¾¾3-5ç§’</li>
</ol>
</li>
<li>
<p>ç®€åŒ–è·¯ç”±ã€èœå•èµ„æºçš„å¤„ç†</p>
<ol>
<li>å½“å‰å…³äºèœå•èµ„æºçš„å¤„ç†è¾ƒå¤æ‚ä¸”ä¸çµæ´»ï¼Œæœ‰è¾ƒå¤§æå‡ç©ºé—´</li>
</ol>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é¡¹ç›®dockeråˆ†å±‚é•œåƒæ„å»ºæ¡ˆä¾‹]]></title>    <link>https://juejin.cn/post/7583980250734608447</link>    <guid>https://juejin.cn/post/7583980250734608447</guid>    <pubDate>2025-12-16T06:04:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250734608447" data-draft-id="7583980250734592063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot é¡¹ç›®dockeråˆ†å±‚é•œåƒæ„å»ºæ¡ˆä¾‹"/> <meta itemprop="keywords" content="Spring Boot,Docker,CI/CD"/> <meta itemprop="datePublished" content="2025-12-16T06:04:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜µç§°ä¸ºç©ºC"/> <meta itemprop="url" content="https://juejin.cn/user/1267096172897005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot é¡¹ç›®dockeråˆ†å±‚é•œåƒæ„å»ºæ¡ˆä¾‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1267096172897005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜µç§°ä¸ºç©ºC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T06:04:51.000Z" title="Tue Dec 16 2025 06:04:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ‘˜è¦ï¼šæœ¬æ–‡ä¸»è¦ä»‹ç»<code>Spring Boot</code>é¡¹ç›®çš„<code>docker</code>é•œåƒåˆ†å±‚æ„å»ºï¼Œåˆ†ä¸ºå¤–éƒ¨ä¾èµ–å’Œå†…éƒ¨ä¾èµ–å’Œé¡¹ç›®<code>classes</code>ä¾èµ–ï¼Œè®©<code>docker</code>æ„å»ºçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ç¼“å­˜ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦å’Œæµ‹è¯•ç¯å¢ƒé•œåƒæ‹‰å–é€Ÿåº¦ã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†å±‚ Docker é•œåƒï¼Ÿ</h2>
<p>ä¼ ç»Ÿçš„ Docker é•œåƒæ„å»ºæ–¹å¼ä¼šå°†æ•´ä¸ªåº”ç”¨ç¨‹åº JAR/WAR æ–‡ä»¶å¤åˆ¶åˆ°ä¸€ä¸ªå±‚ä¸­ã€‚å½“ä½ ä¿®æ”¹ä»£ç æ—¶ï¼Œæ•´ä¸ªå±‚éƒ½ä¼šå¤±æ•ˆï¼Œå¯¼è‡´ Docker å¿…é¡»é‡æ–°æ„å»ºæ•´ä¸ªåº”ç”¨ç¨‹åºå±‚ï¼Œå³ä½¿åªæ˜¯åšäº†å¾®å°çš„ä»£ç æ›´æ”¹ã€‚</p>
<p>é€šè¿‡æˆ‘ä»¬çš„åˆ†å±‚æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä»¥ä¸‹å†…å®¹åˆ†ç¦»ï¼š</p>
<ol>
<li>å¤–éƒ¨ä¾èµ–ï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰</li>
<li>å†…éƒ¨ä¾èµ–ï¼ˆå…¬å¸ç‰¹å®šåº“ï¼‰</li>
<li>åº”ç”¨ç¨‹åºä»£ç ï¼ˆå®é™…ä¸šåŠ¡é€»è¾‘ï¼‰</li>
</ol>
<p>è¿™æ ·ï¼Œå½“ä½ ä¿®æ”¹ä»£ç æ—¶ï¼Œåªéœ€è¦é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºä»£ç å±‚ï¼Œè€Œä¾èµ–å±‚å¯ä»¥ä»ç¼“å­˜ä¸­é‡ç”¨ã€‚</p>
<h2 data-id="heading-1">Maven æ’ä»¶é…ç½®è¯¦è§£</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-external-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/external<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-internal-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/internal<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- å¦‚æœä½¿ç”¨é¢„è§ˆç‰¹æ€§ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">compilerArgs</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>--enable-preview<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">compilerArgs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">release</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">release</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">å·¥ä½œåŸç†</h2>
<h3 data-id="heading-3">1. Maven ä¾èµ–åˆ†ç¦»æ’ä»¶é…ç½®è¯¦è§£</h3>
<p>æˆ‘ä»¬çš„ <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">pom.xml</a> ä½¿ç”¨ <code>maven-dependency-plugin</code> åœ¨æ„å»ºè¿‡ç¨‹ä¸­åˆ†ç¦»ä¾èµ–ã€‚è¯¥æ’ä»¶åŒ…å«ä¸¤ä¸ªæ‰§è¡Œé…ç½®ï¼š</p>
<h4 data-id="heading-4">å¤–éƒ¨ä¾èµ–å¤åˆ¶é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-external-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/external<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
</code></pre>
<p>é…ç½®å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>&lt;id&gt;</code>: æ‰§è¡Œçš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li><code>&lt;phase&gt;</code>: ç»‘å®šåˆ° Maven ç”Ÿå‘½å‘¨æœŸçš„ package é˜¶æ®µ</li>
<li><code>&lt;goals&gt;</code>: æ‰§è¡Œçš„ç›®æ ‡æ˜¯ copy-dependencies</li>
<li><code>&lt;configuration&gt;</code>: é…ç½®è¯¦æƒ…</li>
</ul>

<ul>
<li>
<ul>
<li><code>&lt;outputDirectory&gt;</code>: è¾“å‡ºç›®å½•ï¼Œ<code>${project.build.directory}</code> æ˜¯ target ç›®å½•</li>
<li><code>&lt;includeScope&gt;</code>: åŒ…å«ä½œç”¨åŸŸä¸º compile çš„ä¾èµ–</li>
<li><code>&lt;excludeGroupIds&gt;</code>: æ’é™¤ groupId ä¸º cn.hutool çš„ä¾èµ–ï¼ˆå°†å…¶è§†ä¸ºå†…éƒ¨ä¾èµ–ï¼‰</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">å†…éƒ¨ä¾èµ–å¤åˆ¶é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-internal-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/internal<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
</code></pre>
<p>é…ç½®å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>&lt;id&gt;</code>: æ‰§è¡Œçš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li><code>&lt;phase&gt;</code>: åŒæ ·ç»‘å®šåˆ° Maven ç”Ÿå‘½å‘¨æœŸçš„ package é˜¶æ®µ</li>
<li><code>&lt;goals&gt;</code>: æ‰§è¡Œçš„ç›®æ ‡ä¹Ÿæ˜¯ copy-dependencies</li>
<li><code>&lt;configuration&gt;</code>: é…ç½®è¯¦æƒ…</li>
</ul>

<ul>
<li>
<ul>
<li><code>&lt;outputDirectory&gt;</code>: è¾“å‡ºç›®å½•ä¸º target/lib/internal</li>
<li><code>&lt;includeScope&gt;</code>: åŒ…å«ä½œç”¨åŸŸä¸º compile çš„ä¾èµ–</li>
<li><code>&lt;includeGroupIds&gt;</code>: åªåŒ…å« groupId ä¸º cn.hutool çš„ä¾èµ–ï¼ˆä½œä¸ºå†…éƒ¨ä¾èµ–å¤„ç†ï¼‰</li>
</ul>
</li>
</ul>
<p>é€šè¿‡è¿™ä¸¤ä¸ªæ‰§è¡Œé…ç½®ï¼ŒMaven ä¼šåœ¨ package é˜¶æ®µè‡ªåŠ¨å°†ä¾èµ–åˆ†åˆ«å¤åˆ¶åˆ°å¯¹åº”çš„ç›®å½•ä¸­ï¼š</p>
<ul>
<li><code>target/lib/external/</code> - ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆæ’é™¤äº† cn.hutoolï¼‰</li>
<li><code>target/lib/internal/</code> - å†…éƒ¨/å…¬å¸ç‰¹å®šä¾èµ–ï¼ˆåªæœ‰ cn.hutoolï¼‰</li>
<li><code>target/classes/</code> - ç¼–è¯‘åçš„åº”ç”¨ç¨‹åºä»£ç </li>
</ul>
<h3 data-id="heading-6">2. åˆ†å±‚ Dockerfile è¯¦è§£</h3>
<p>æˆ‘ä»¬çš„ <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Dockerfile</a> é€šè¿‡é¦–å…ˆå¤åˆ¶ä¾èµ–æ¥åˆ©ç”¨ Docker å±‚ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">FROM eclipse-temurin:21-jre-alpine
WORKDIR /app

<span class="hljs-comment"># 1. å¤åˆ¶å¤–éƒ¨ä¾èµ–ï¼ˆå¾ˆå°‘æ›´æ”¹ï¼‰</span>
COPY target/lib/external/*.jar ./lib/external/

<span class="hljs-comment"># 2. å¤åˆ¶å†…éƒ¨ä¾èµ–ï¼ˆå¶å°”æ›´æ”¹ï¼‰</span>
COPY target/lib/internal/*.jar ./lib/internal/

<span class="hljs-comment"># 3. å¤åˆ¶åº”ç”¨ç¨‹åºç±»ï¼ˆç»å¸¸æ›´æ”¹ï¼‰</span>
COPY target/classes ./classes

EXPOSE 8080

ENV CUSTOM_OPTS=<span class="hljs-string">"-Xms256m -Xmx768m"</span>
ENV JAVA_OPTS=<span class="hljs-string">"--enable-preview -XX:+UseSerialGC"</span>
ENTRYPOINT [<span class="hljs-string">"sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"java <span class="hljs-variable">$CUSTOM_OPTS</span> <span class="hljs-variable">$JAVA_OPTS</span> -cp /app/classes:/app/lib/external/*:/app/lib/internal/* com.example.layer.Sp3LayerApplication"</span>]
</code></pre>
<p>Dockerfile é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>FROM eclipse-temurin:21-jre-alpine</code>: ä½¿ç”¨è½»é‡çº§çš„ Alpine Linux ä¸Šçš„ Temurin JDK 21 è¿è¡Œæ—¶ç¯å¢ƒ</li>
<li><code>WORKDIR /app</code>: è®¾ç½®å·¥ä½œç›®å½•ä¸º /app</li>
<li><code>COPY target/lib/external/*.jar ./lib/external/</code>: å°†å¤–éƒ¨ä¾èµ–å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¿™æ˜¯æœ€ç¨³å®šçš„å±‚</li>
<li><code>COPY target/lib/internal/*.jar ./lib/internal/</code>: å°†å†…éƒ¨ä¾èµ–å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¿™å±‚æ¯”å¤–éƒ¨ä¾èµ–æ›´å¯èƒ½å˜åŒ–</li>
<li><code>COPY target/classes ./classes</code>: å°†åº”ç”¨ç¨‹åºç±»æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ï¼Œè¿™å±‚æœ€å®¹æ˜“å‘ç”Ÿå˜åŒ–</li>
<li><code>EXPOSE 8080</code>: æš´éœ²åº”ç”¨ç¨‹åºç«¯å£</li>
<li><code>ENV</code> æŒ‡ä»¤è®¾ç½® JVM å‚æ•°ï¼š</li>
</ul>

<ul>
<li>
<ul>
<li><code>CUSTOM_OPTS</code>: è‡ªå®šä¹‰ JVM å‚æ•°ï¼Œè®¾ç½®åˆå§‹å †å†…å­˜å’Œæœ€å¤§å †å†…å­˜</li>
<li><code>JAVA_OPTS</code>: Java è™šæ‹Ÿæœºé€‰é¡¹ï¼Œå¯ç”¨é¢„è§ˆç‰¹æ€§å’Œä½¿ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</li>
</ul>
</li>
</ul>

<ul>
<li><code>ENTRYPOINT</code>: å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½¿ç”¨ç±»è·¯å¾„åŒ…å«æ‰€æœ‰ä¾èµ–å’Œåº”ç”¨ç¨‹åºç±»</li>
</ul>
<p>ç±»è·¯å¾„è¯´æ˜ï¼š<br/>
<code>-cp /app/classes:/app/lib/external/*:/app/lib/internal/*</code> æŒ‡å®šäº†ç±»è·¯å¾„çš„é¡ºåºï¼š</p>
<ol>
<li><code>/app/classes</code>: åº”ç”¨ç¨‹åºç¼–è¯‘åçš„ç±»æ–‡ä»¶ä¼˜å…ˆçº§æœ€é«˜</li>
<li><code>/app/lib/external/*</code>: å¤–éƒ¨ä¾èµ–æ¬¡ä¹‹</li>
<li><code>/app/lib/internal/*</code>: å†…éƒ¨ä¾èµ–æœ€å</li>
</ol>
<p>è¿™ç§é¡ºåºç¡®ä¿äº†åº”ç”¨ç¨‹åºç±»å¯ä»¥è¦†ç›–ä¾èµ–ä¸­çš„åŒåç±»ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ï¼Œå¹¶ä¸”ä¿è¯äº†æ­£ç¡®çš„ç±»åŠ è½½é¡ºåºã€‚</p>
<h3 data-id="heading-7">3. æ„å»ºè¿‡ç¨‹è¯¦è§£</h3>
<h4 data-id="heading-8">Maven æ„å»ºç”Ÿå‘½å‘¨æœŸé›†æˆ</h4>
<p>å½“æ‰§è¡Œ <code>mvn package</code> å‘½ä»¤æ—¶ï¼ŒMaven ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œæ„å»ºé˜¶æ®µï¼š</p>
<ol>
<li><code>validate</code> - éªŒè¯é¡¹ç›®æ­£ç¡®æ€§</li>
<li><code>compile</code> - ç¼–è¯‘æºä»£ç </li>
<li><code>test</code> - è¿è¡Œæµ‹è¯•</li>
<li><code>package</code> - æ‰“åŒ…åº”ç”¨ç¨‹åº</li>
</ol>
<p>åœ¨ <code>package</code> é˜¶æ®µï¼Œ<code>maven-dependency-plugin</code> ä¼šè‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬é…ç½®çš„ä¸¤ä¸ªä¾èµ–å¤åˆ¶ä»»åŠ¡ï¼š</p>
<ol>
<li>é¦–å…ˆæ‰§è¡Œ <code>copy-external-dependencies</code>ï¼Œå°†å¤–éƒ¨ä¾èµ–å¤åˆ¶åˆ° <code>target/lib/external/</code></li>
<li>ç„¶åæ‰§è¡Œ <code>copy-internal-dependencies</code>ï¼Œå°†å†…éƒ¨ä¾èµ–å¤åˆ¶åˆ° <code>target/lib/internal/</code></li>
<li>åŒæ—¶ï¼ŒMaven é»˜è®¤ä¼šå°†ç¼–è¯‘åçš„ç±»æ–‡ä»¶æ”¾åœ¨ <code>target/classes/</code> ç›®å½•ä¸­</li>
</ol>
<h4 data-id="heading-9">å®Œæ•´æ„å»ºæ­¥éª¤</h4>
<ol>
<li>æ¸…ç†å¹¶æ‰“åŒ…åº”ç”¨ç¨‹åºï¼š</li>
</ol>
<pre><code class="hljs language-go" lang="go">mvn clean <span class="hljs-keyword">package</span>
</code></pre>
<p>æ­¤å‘½ä»¤ä¼šè§¦å‘ä¾èµ–åˆ†ç¦»è¿‡ç¨‹ï¼Œç”Ÿæˆä¸‰ä¸ªç›®å½•ï¼š</p>
<ul>
<li>
<ul>
<li><code>target/classes/</code> - åº”ç”¨ç¨‹åºç¼–è¯‘åçš„ç±»æ–‡ä»¶</li>
<li><code>target/lib/external/</code> - å¤–éƒ¨ä¾èµ– JAR æ–‡ä»¶</li>
<li><code>target/lib/internal/</code> - å†…éƒ¨ä¾èµ– JAR æ–‡ä»¶</li>
</ul>
</li>
</ul>
<ol start="2">
<li>æ„å»º Docker é•œåƒï¼š</li>
</ol>
<pre><code class="hljs language-erlang" lang="erlang">docker build -t sp3-layer .
</code></pre>
<p>Docker æ„å»ºè¿‡ç¨‹ä¼šæŒ‰é¡ºåºåˆ›å»ºå››ä¸ªå±‚ï¼š</p>
<ul>
<li>
<ul>
<li>åŸºç¡€é•œåƒå±‚ï¼ˆeclipse-temurin:21-jre-alpineï¼‰</li>
<li>å¤–éƒ¨ä¾èµ–å±‚ï¼ˆCOPY target/lib/external/*.jarï¼‰</li>
<li>å†…éƒ¨ä¾èµ–å±‚ï¼ˆCOPY target/lib/internal/*.jarï¼‰</li>
<li>åº”ç”¨ç¨‹åºç±»å±‚ï¼ˆCOPY target/classesï¼‰</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">æ„å»ºä¼˜åŒ–æ•ˆæœ</h4>
<p>ç”±äº Docker çš„å±‚ç¼“å­˜æœºåˆ¶ï¼š</p>
<ul>
<li>å½“åªä¿®æ”¹åº”ç”¨ç¨‹åºä»£ç æ—¶ï¼Œåªæœ‰æœ€åä¸€å±‚éœ€è¦é‡å»º</li>
<li>å½“æ·»åŠ æ–°çš„å¤–éƒ¨ä¾èµ–æ—¶ï¼Œéœ€è¦é‡å»ºå¤–éƒ¨ä¾èµ–å±‚åŠå…¶åçš„æ‰€æœ‰å±‚</li>
<li>å½“æ·»åŠ æ–°çš„å†…éƒ¨ä¾èµ–æ—¶ï¼Œéœ€è¦é‡å»ºå†…éƒ¨ä¾èµ–å±‚å’Œåº”ç”¨ç¨‹åºç±»å±‚</li>
<li>åªæœ‰åŸºç¡€é•œåƒå˜æ›´æ—¶ï¼Œæ‰éœ€è¦å®Œå…¨é‡å»º</li>
</ul>
<h2 data-id="heading-11">ä¼˜åŠ¿</h2>
<ol>
<li><strong>æ›´å¿«çš„æ„å»ºé€Ÿåº¦</strong>ï¼šä»£ç æ›´æ”¹æ—¶åªéœ€é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºä»£ç å±‚</li>
<li><strong>æ›´å°çš„ä¼ è¾“é‡</strong>ï¼šæ¨é€åˆ°æ³¨å†Œä¸­å¿ƒæ—¶ï¼Œåªä¼ è¾“æ›´æ”¹çš„å±‚</li>
<li><strong>æ›´å¥½çš„ç¼“å­˜æ•ˆæœ</strong>ï¼šä¾èµ–å±‚åœ¨å„ä¸ªæ„å»ºä¹‹é—´ç¼“å­˜å¹¶é‡ç”¨</li>
<li><strong>å‡å°‘å¸¦å®½æ¶ˆè€—</strong>ï¼šåœ¨ CI/CD æµæ°´çº¿ä¸­å‡å°‘æ•°æ®ä¼ è¾“</li>
</ol>
<h2 data-id="heading-12">ç‰ˆæœ¬æ›´æ–°å·¥ä½œæµç¨‹</h2>
<ol>
<li>åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œä»£ç æ›´æ”¹</li>
<li>è¿è¡Œ <code>mvn clean package</code> ä»…é‡æ–°ç¼–è¯‘æ›´æ”¹çš„ä»£ç </li>
<li>è¿è¡Œ <code>docker build -t sp3-layer:v2 .</code> æ„å»ºæ–°é•œåƒ</li>
<li>åªæœ‰ <code>target/classes</code> å±‚ä¼šè¢«é‡æ–°æ„å»º</li>
<li>åªå°†æ›´æ”¹çš„å±‚æ¨é€åˆ°å®¹å™¨æ³¨å†Œä¸­å¿ƒ</li>
</ol>
<h2 data-id="heading-13">é…ç½®è‡ªå®šä¹‰æŒ‡å—</h2>
<p>è¦å°†æ­¤é…ç½®åº”ç”¨äºå…¶ä»–é¡¹ç›®ï¼Œæ‚¨éœ€è¦æ ¹æ®é¡¹ç›®çš„ä¾èµ–ç»“æ„è°ƒæ•´é…ç½®ï¼š</p>
<h3 data-id="heading-14">ä¿®æ”¹ä¾èµ–åˆ†ç»„</h3>
<p>å¦‚æœæ‚¨æœ‰ä¸åŒçš„å†…éƒ¨ä¾èµ–ï¼Œéœ€è¦ä¿®æ”¹ <code>excludeGroupIds</code> å’Œ <code>includeGroupIds</code> é…ç½®ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- å¤–éƒ¨ä¾èµ–é…ç½® --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>com.yourcompany,org.another.internal.group<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
<span class="hljs-comment">&lt;!-- å†…éƒ¨ä¾èµ–é…ç½® --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>com.yourcompany,org.another.internal.group<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
</code></pre>
<h2 data-id="heading-15">æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>é¡ºåºå¾ˆé‡è¦</strong>ï¼šé¦–å…ˆå¤åˆ¶ä¸ç»å¸¸æ›´æ”¹çš„å±‚</li>
<li><strong>æœ€å°åŒ–å±‚æ•°</strong>ï¼šåªåˆ†ç¦»å®é™…åœ¨ä¸åŒé¢‘ç‡ä¸‹æ›´æ”¹çš„å†…å®¹</li>
<li><strong>å¤šé˜¶æ®µæ„å»º</strong>ï¼šè€ƒè™‘ä¸å¤šé˜¶æ®µæ„å»ºç»“åˆä½¿ç”¨ä»¥è·å¾—æ›´å°çš„æœ€ç»ˆé•œåƒ</li>
<li><strong>ç¼“å­˜å¤±æ•ˆ</strong>ï¼šäº†è§£ Docker çš„å±‚ç¼“å­˜æœºåˆ¶ä»¥æœ€å¤§åŒ–æ”¶ç›Š</li>
</ol>
<p>è¿™ç§æ–¹æ³•å¯ä»¥æ˜¾è‘—å‡å°‘ CI/CD æµæ°´çº¿ä¸­çš„æ„å»ºæ—¶é—´ï¼Œå¹¶åœ¨éƒ¨ç½²æ›´æ–°æ—¶æœ€å°åŒ–ç½‘ç»œä¼ è¾“ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¨è 4 ä¸ª yyds çš„ AI æ§åˆ¶å®‰å“æ‰‹æœºçš„ GitHub é¡¹ç›®ã€‚]]></title>    <link>https://juejin.cn/post/7583969283790061622</link>    <guid>https://juejin.cn/post/7583969283790061622</guid>    <pubDate>2025-12-16T02:43:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583969283790061622" data-draft-id="7583984122235027498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¨è 4 ä¸ª yyds çš„ AI æ§åˆ¶å®‰å“æ‰‹æœºçš„ GitHub é¡¹ç›®ã€‚"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-16T02:43:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€›é€›GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¨è 4 ä¸ª yyds çš„ AI æ§åˆ¶å®‰å“æ‰‹æœºçš„ GitHub é¡¹ç›®ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€›é€›GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:43:56.000Z" title="Tue Dec 16 2025 02:43:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é€›é€›åœ¨ 11 æœˆå‘äº†ä¸€ç¯‡æ–‡ç« ï¼Œç›˜ç‚¹äº† GitHub ä¸Š AI æ“çºµæ‰‹æœºçš„å¼€æºé¡¹ç›®ã€‚</p>
<p>è·å¾—äº† 3 ä¸‡å¤šé˜…è¯»ï¼Œ3000 å¤šäººè½¬å‘æ”¶è—ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd8410fb07046d8b8a6f6db0a62988d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=gPXulglpgqrxG9q4eQbYdwXMbEE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ²¡æƒ³åˆ°é‚£ç¯‡æ–‡ç« å‘å¸ƒ 5 å¤©åï¼Œè±†åŒ…å°±å®˜å®£æ¨å‡ºäº† AI æ‰‹æœºï¼Œç´§æ¥ç€æ™ºè°± AI å°±å¼€æºäº† AutoGLM æ¨¡å‹ã€‚</p>
<p>æˆ‘åˆæœç½—äº†å‡ ä¸ª AI æ“ä½œæ‰‹æœºçš„å¼€æºé¡¹ç›®ï¼Œå†åŠ ä¸Šæˆ‘ä¹‹å‰å‘çš„é‚£ç¯‡ã€‚æ•´ä¸ª GitHub ä¸Šå…³äº AI æ§åˆ¶æ‰‹æœºçš„é¡¹ç›®ç®—æ˜¯è¢«é€›é€›æœåˆ®å¹²å‡€äº†ã€‚</p>
<p>æ¬¢è¿æ”¶è—è½¬å‘ğŸ‘</p>
<h2 data-id="heading-0">01ã€æ™ºè°±å¼€æºï¼šOpen-AutoGLM</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da34e068012e4bc0bd7c51154d930bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=WbikuqLDP0%2FID5RLuXWW92pCQrk%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>è¿™ä¸ªå¼€æºé¡¹ç›®å¤ªé¡¶äº†ï¼Œä¸åˆ°ä¸€å‘¨å°± 1.3 ä¸‡çš„ Star äº†ã€‚</p>
<p>åŸºäºè¿™ä¸ªå¼€æºæ¡†æ¶ï¼Œå°±èƒ½è®© AI å¯ä»¥<strong>åƒäººçœ¼ä¸€æ ·çœ‹æ‰‹æœºå±å¹•</strong>ï¼Œç„¶ååƒäººæ‰‹ä¸€æ ·å»ç‚¹å‡»ã€‚</p>
<p>ä½ ç»™å®ƒä¸€ä¸ªä»»åŠ¡ï¼Œæ¯”å¦‚ï¼šå¸®æˆ‘æ€»ç»“ä¸‹é•¿æ˜¥çš„æ™¯ç‚¹ï¼Œåˆ°é«˜å¾·åœ°å›¾ä¸Šæ”¶è—ä¸€ä¸‹è¿™å‡ ä¸ªæ™¯ç‚¹ï¼Œç‰¹åˆ«æ˜¯å…·ä½“çœ‹çœ‹åšç‰©é¦†é—¨ç¥¨ä»·æ ¼ï¼Œå†å»12306ä¸Šè®¢ä¸€å¼ ä¸Šåˆåç‚¹ä»åŒ—äº¬å»é•¿æ˜¥çš„é«˜é“ç¥¨ï¼ŒæŠŠç›¸å…³ä¿¡æ¯æ•´ç†å¥½ç»™æˆ‘ã€‚</p>
<p>AutoGLMÂ ä¼šå…ˆæŠŠæ‰‹æœºå±å¹•æˆªä¸ªå›¾ï¼Œæ¨¡å‹ä¼šåˆ†ææˆªå›¾ï¼Œé€šè¿‡è§†è§‰å®šä½æ‰¾åˆ°å½“å‰è¦ç‚¹å‡»å“ªä¸ªæŒ‰é’®æˆ–è€…åšå•¥æ“ä½œã€‚</p>
<p>å¹¶é€šè¿‡ ADBï¼ˆAndroid Debug Bridgeï¼‰å·¥å…·ï¼Œç›´æ¥å‘æ‰‹æœºå‘é€ç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥æ–‡å­—çš„æŒ‡ä»¤ã€‚</p>
<p>æœ€ç»ˆè¿™æ ·ä¸€æ­¥æ­¥æ¨¡æ‹Ÿäººçœ‹æ‰‹æœºã€æ“çºµæ‰‹æœºçš„è¡Œä¸ºï¼Œå®Œæˆä½ ç»™çš„ä»»åŠ¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64e6aa6b09424c75b4fdaa5772bc82e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=wpzrBWk26HX97tTekzAskgdwF8s%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">å¼€æºåœ°å€ï¼šhttps:<span class="hljs-comment">//github.com/zai-org/Open-AutoGLM</span>
</code></pre>
<p>è€Œä¸”è¿™ä¸ªå¼€æºå¯ä»¥æœ¬åœ°éƒ¨ç½²ï¼Œè€Œä¸”å¦‚æœä½ æœ‰æ˜¾å¡ï¼Œå¤§çº¦éœ€è¦ 24GB+ æ˜¾å­˜ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ª Agent è·‘åœ¨æœ¬åœ°ã€‚</p>
<p>éšç§æ•°æ®ï¼Œæ¯”å¦‚èŠå¤©è®°å½•ã€æ”¯ä»˜ç”»é¢å•¥çš„ä¸ä¸Šä¼ åˆ°äº‘ç«¯ä¹Ÿèƒ½è‡ªåŠ¨åŒ–çš„ä½ çš„å®‰å“æ‰‹æœºäº†ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨</p>
<p>ä½ å¯ä»¥ä½¿ç”¨Claude Codeï¼Œé…ç½® GLM Coding Plan åï¼Œè¾“å…¥ä»¥ä¸‹æç¤ºè¯ï¼Œå¿«é€Ÿéƒ¨ç½²æœ¬é¡¹ç›®ã€‚Â </p>
<pre><code class="hljs language-bash" lang="bash">è®¿é—®æ–‡æ¡£ï¼Œä¸ºæˆ‘å®‰è£… AutoGLM ï¼šhttps://raw.githubusercontent.com/zai-org/Open-AutoGLM/refs/heads/main/README.md
</code></pre>
<h2 data-id="heading-1">02ã€é€šè¿‡ MCP æ§åˆ¶æ‰‹æœºï¼šDroidMind</h2>
<p><strong>DroidMind è¿™ä¸ªå¼€æºé¡¹ç›®çš„çš„æ ¸å¿ƒé€»è¾‘æ˜¯ä¸è‡ªå·±è®­ç»ƒä¸€ä¸ªæ–°æ¨¡å‹ï¼Œè€Œæ˜¯åšä¸€ä¸ª</strong> <strong>è¶…çº§é€‚é…å™¨</strong>ã€‚</p>
<p>å®ƒé€šè¿‡ MCP åè®®ï¼ŒæŠŠä½ çš„Â <strong>Android æ‰‹æœº</strong>ç›´æ¥æŒ‚è½½åˆ°Â <strong>Claude Desktop</strong>ã€<strong>Cursor</strong> æˆ–è€…Â Claude <strong>Code</strong>Â ä¸Šã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b02d0991fb2a43488648ebd3373427ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=ZyI3vsHOF6tLB5rtRPlXnQvddEM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½ ä¸éœ€è¦è¿è¡Œä¸€ä¸ªæ²‰é‡çš„æœ¬åœ°æ¨¡å‹ã€‚</p>
<p>ä½ ç›´æ¥ç”¨æœ€èªæ˜çš„Â <strong>Claude æˆ– Gemini</strong>ï¼Œé€šè¿‡ DroidMind è¿™ä¸ªç¿»è¯‘å®˜ï¼Œç›´æ¥æ“æ§ä½ çš„å®‰å“æ‰‹æœºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8675948f544464986d155332699dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=l4ZxsDMfoe0IMphZqUryM7iUZSI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">å¼€æºåœ°å€ï¼šhttps:<span class="hljs-comment">//github.com/hyperb1iss/DroidMind</span>
</code></pre>
<h2 data-id="heading-2">03ã€å¾®è½¯å¼€æºï¼šUFO</h2>
<p>è¿™ä¸ªå« UFO çš„å¼€æºé¡¹ç›®å…¶å®æ˜¯å¾®è½¯å¼€æºçš„ AI æ“ä½œ Windows ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ã€‚</p>
<p>åªä¸è¿‡Â 11 æœˆæ¨å‡ºçš„Â UFOÂ³Â Galaxy å·²ç»æ¼”å˜æˆäº†ä¸€ä¸ª<strong>è·¨è®¾å¤‡ã€è·¨å¹³å°çš„ç¼–æ’æ¡†æ¶ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b417d760183748f090dae85f029b2531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=xJbKxU1sIV9N1HQhBISkQzbImJA%3D" alt="å›¾ç‰‡" loading="lazy"/><strong>UFOÂ³ Galaxy</strong>Â æ¶‰åŠåˆ°æ“çºµÂ <strong>Android æ‰‹æœºè®¾å¤‡</strong>çš„éƒ¨åˆ†æ˜¯è¿™æ¬¡æ›´æ–°çš„æ ¸å¿ƒäº®ç‚¹ä¹‹ä¸€ã€‚å®ƒä¹Ÿæ˜¯é€šè¿‡å¼•å…¥Â <strong>MCPÂ æ¶æ„æ¥å®ç°çš„ï¼Œè¿™ä½¿å¾— UFO ä¸å†å±€é™äº Windowsï¼Œè€Œæ˜¯èƒ½åƒæŒ‡æŒ¥å®˜ä¸€æ ·æ§åˆ¶å®‰å“æ‰‹æœºã€‚</strong><br/>
<strong><strong><strong><strong>UFOÂ³ Galaxy</strong>Â æ˜¯ä¸€ä¸ª</strong>å¤šè®¾å¤‡ç¼–æ’ç³»ç»Ÿ</strong>ã€‚å®ƒçš„æ ¸å¿ƒç†å¿µåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ã€‚</strong></p>
<ul>
<li>Galaxy (æ˜Ÿç³»)ï¼šæ•´ä¸ªæ§åˆ¶ä¸­æ¢ï¼Œè´Ÿè´£åˆ†å‘ä»»åŠ¡ã€‚</li>
<li>Constellation (æ˜Ÿåº§)ï¼šå®ƒå°†ä¸€ä¸ªå¤æ‚çš„ç”¨æˆ·æŒ‡ä»¤ï¼Œæ¯”å¦‚æŠŠæ‰‹æœºä¸Šçš„åˆšæ‹çš„ç…§ç‰‡ä¼ åˆ°ç”µè„‘å¹¶ç”¨ Photoshop ç¼–è¾‘ï¼Œæ‹†è§£æˆä¸€ä¸ª DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ã€‚</li>
</ul>
<p>Windows ç”µè„‘ã€Linux æœåŠ¡å™¨ã€<strong>Android æ‰‹æœº</strong>Â ç­‰éƒ½ä½œä¸ºç‹¬ç«‹çš„èŠ‚ç‚¹æ¥å…¥è¿™ä¸ªç½‘ç»œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd0c8f3f4526455695729b40dc244788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=9pxL%2FnAnkqzhnRzTDxKoFdSNlZ4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">å¼€æºåœ°å€ï¼šhttps:<span class="hljs-comment">//github.com/microsoft/UFO</span>
</code></pre>
<h2 data-id="heading-3">04ã€å­—èŠ‚å¼€æºï¼šUI-TARS</h2>
<p>å­—èŠ‚è·³åŠ¨å¼€æºçš„ä¸€ä¸ªåŸºäºè§†è§‰-è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰çš„ GUI æ™ºèƒ½ä½“ï¼ˆAgentï¼‰é¡¹ç›®ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯è®© AI åƒäººç±»ä¸€æ ·ï¼Œé€šè¿‡è§†è§‰è¯†åˆ«å±å¹•å’Œæ“ä½œé¼ æ ‡/é”®ç›˜/è§¦æ§ï¼Œç›´æ¥æ§åˆ¶æ‰‹æœºã€è®¡ç®—æœºæˆ–ç½‘é¡µã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b02bf798394c6796467a71a90fecc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=7O9xIgwUtSHFyzxOZb7Vh80wWtI%3D" alt="å›¾ç‰‡" loading="lazy"/><strong>å®‰å“æ‰‹æœºè®¾å¤‡æ“çºµï¼Œ</strong> UI-TARS é‡‡ç”¨äº†ä¸€ç§<strong>ç«¯åˆ°ç«¯ã€çº¯è§†è§‰é©±åŠ¨ã€åŸºäº ADB</strong>Â çš„æ§åˆ¶æ–¹æ¡ˆã€‚</p>
<p>ä¹Ÿæ˜¯æˆªå–æ‰‹æœºå±å¹•ç”»é¢ï¼ŒæŠŠæˆªå›¾è¾“å…¥ç»™è§†è§‰æ¨¡å‹ï¼Œæ¨¡å‹ç»“åˆç”¨æˆ·çš„æŒ‡ä»¤åˆ†æå±å¹•ä¸Šçš„å…ƒç´ ï¼Œå†³å®šä¸‹ä¸€æ­¥åšä»€ä¹ˆã€‚</p>
<p>æœ€åæ¨¡å‹è¾“å‡ºå…·ä½“çš„åŠ¨ä½œæŒ‡ä»¤ï¼Œè½¬åŒ–ä¸ºåº•å±‚çš„ Android ADB å‘½ä»¤å‘é€ç»™æ‰‹æœºæ‰§è¡Œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1610839b4d4f7b88f7c69b7653c7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=PIk7p7%2BqJx7i1I4rR5t9UmhPEPA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">å¼€æºåœ°å€ï¼šhttps:<span class="hljs-comment">//github.com/bytedance/UI-TARS</span>
</code></pre>
<p>å¦å¤–ä¹‹å‰å‘å¸ƒçš„å¦å¤–ä¸€ä¸ªç›˜ç‚¹ AI æ§åˆ¶æ‰‹æœºå¼€æºé¡¹ç›®çš„é“¾æ¥å¦‚ä¸‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxNjg4NDEzNA%3D%3D%26mid%3D2247529132%26idx%3D1%26sn%3D0b45b857cfd67f9144472f2017f46a14%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxNjg4NDEzNA==&amp;mid=2247529132&amp;idx=1&amp;sn=0b45b857cfd67f9144472f2017f46a14&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">5 ä¸ª AI æ“çºµæ‰‹æœºçš„ GitHub é¡¹ç›®ï¼Œç‰›é€¼äº†ã€‚</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¼ä¸šçº§ Vue 3 é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶çš„è®¾è®¡å“²å­¦ä¸å®è·µ]]></title>    <link>https://juejin.cn/post/7584472215975690255</link>    <guid>https://juejin.cn/post/7584472215975690255</guid>    <pubDate>2025-12-17T09:52:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215975690255" data-draft-id="7584408254820384803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¼ä¸šçº§ Vue 3 é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶çš„è®¾è®¡å“²å­¦ä¸å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-17T09:52:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¼ä¸šçº§ Vue 3 é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶çš„è®¾è®¡å“²å­¦ä¸å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 èä¼šè´¯é€š
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 èä¼šè´¯é€š" title="VIP.4 èä¼šè´¯é€š" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:52:27.000Z" title="Wed Dec 17 2025 09:52:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡å°†æ·±å…¥å‰–æä¸€ä¸ªä¼ä¸šçº§ Vue 3 è¡¨æ ¼ç»„ä»¶çš„æ¶æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ä¸å·¥ç¨‹åŒ–å®è·µï¼Œæ¶µç›– Composition API æ·±åº¦åº”ç”¨ã€å“åº”å¼ç³»ç»Ÿä¼˜åŒ–ã€TypeScript ç±»å‹ä½“æ“ç­‰æ ¸å¿ƒæŠ€æœ¯ç‚¹ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ä¼ä¸šçº§ B ç«¯åº”ç”¨å¼€å‘ä¸­ï¼Œè¡¨æ ¼ç»„ä»¶å ªç§°"å…µå®¶å¿…äº‰ä¹‹åœ°"â€”â€”å®ƒæ‰¿è½½ç€æ•°æ®å±•ç¤ºã€äº¤äº’æ“ä½œã€çŠ¶æ€ç®¡ç†ç­‰æ ¸å¿ƒèŒè´£ï¼Œå…¶è®¾è®¡è´¨é‡ç›´æ¥å½±å“ç€æ•´ä¸ªç³»ç»Ÿçš„ç”¨æˆ·ä½“éªŒä¸å¯ç»´æŠ¤æ€§ã€‚</p>
<p>æœ¬æ–‡å°†ä»¥ç¬”è€…ä¸»å¯¼è®¾è®¡çš„ <code>CmcCardTable</code> ç»„ä»¶ä¸ºä¾‹ï¼Œç³»ç»Ÿæ€§åœ°é˜è¿°ï¼š</p>
<ul>
<li>ğŸ¯ <strong>æ¶æ„è®¾è®¡</strong>ï¼šå¦‚ä½•è¿ç”¨ Composition API å®ç°å…³æ³¨ç‚¹åˆ†ç¦»</li>
<li>âš¡ <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå“åº”å¼ç³»ç»Ÿçš„ç²¾ç»†åŒ–è°ƒä¼˜ç­–ç•¥</li>
<li>ğŸ”’ <strong>ç±»å‹å®‰å…¨</strong>ï¼šTypeScript åœ¨å¤æ‚ç»„ä»¶ä¸­çš„æ·±åº¦å®è·µ</li>
<li>ğŸ§ª <strong>å·¥ç¨‹è´¨é‡</strong>ï¼šå¯æµ‹è¯•æ€§è®¾è®¡ä¸å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ</li>
</ul>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ¶æ„è®¾è®¡ï¼šComposables æ¨¡å¼çš„æ·±åº¦å®è·µ</h2>
<h3 data-id="heading-2">1.1 ä»"ä¸Šå¸ç»„ä»¶"åˆ°"å…³æ³¨ç‚¹åˆ†ç¦»"</h3>
<p>ä¼ ç»Ÿçš„è¡¨æ ¼ç»„ä»¶å¾€å¾€ä¼šæ¼”å˜æˆä¸€ä¸ªåºå¤§çš„"ä¸Šå¸ç»„ä»¶"ï¼ˆGod Componentï¼‰ï¼ŒåŠ¨è¾„æ•°åƒè¡Œä»£ç ï¼Œç»´æŠ¤æˆæœ¬æé«˜ã€‚æˆ‘ä»¬é‡‡ç”¨ <strong>Composables æ¨¡å¼</strong> å°†è¡¨æ ¼çš„æ ¸å¿ƒåŠŸèƒ½è§£è€¦ä¸ºç‹¬ç«‹çš„ç»„åˆå¼å‡½æ•°ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">src/components/CmcCardTable/
â”œâ”€â”€ CmcCardTable.vue          <span class="hljs-comment"># ä¸»ç»„ä»¶ï¼ˆè§†å›¾å±‚ï¼‰</span>
â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ useTableSelection.ts  <span class="hljs-comment"># é€‰æ‹©çŠ¶æ€ç®¡ç†</span>
â”‚   â”œâ”€â”€ useTableExpand.ts     <span class="hljs-comment"># å±•å¼€/æŠ˜å é€»è¾‘</span>
â”‚   â”œâ”€â”€ useTableSort.ts       <span class="hljs-comment"># æ’åºåŠŸèƒ½</span>
â”‚   â””â”€â”€ useTableLayout.ts     <span class="hljs-comment"># å¸ƒå±€è®¡ç®—</span>
â”œâ”€â”€ types.ts                  <span class="hljs-comment"># ç±»å‹å®šä¹‰</span>
â””â”€â”€ SubRowGrid.vue            <span class="hljs-comment"># å­è¡Œç½‘æ ¼ç»„ä»¶</span>
</code></pre>
<p>è¿™ç§æ¶æ„å¸¦æ¥çš„æ”¶ç›Šï¼š</p>






























<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ–¹æ¡ˆ</th><th>Composables æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å•æ–‡ä»¶ä»£ç é‡</td><td>3000+ è¡Œ</td><td>ä¸»ç»„ä»¶ &lt; 800 è¡Œ</td></tr><tr><td>å¯æµ‹è¯•æ€§</td><td>éœ€è¦æŒ‚è½½æ•´ä¸ªç»„ä»¶</td><td>å¯ç‹¬ç«‹å•å…ƒæµ‹è¯•</td></tr><tr><td>å¤ç”¨æ€§</td><td>éš¾ä»¥å¤ç”¨</td><td>å¯è·¨ç»„ä»¶å¤ç”¨</td></tr><tr><td>è®¤çŸ¥è´Ÿè½½</td><td>é«˜</td><td>ä½ï¼ˆå•ä¸€èŒè´£ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 Composable çš„è®¾è®¡åŸåˆ™</h3>
<p>ä»¥ <code>useTableSelection</code> ä¸ºä¾‹ï¼Œä¸€ä¸ªä¼˜ç§€çš„ Composable åº”éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSelection.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseTableSelectionOptions</span> {
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">TableRow</span>[]&gt;
  <span class="hljs-attr">rowKey</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">selectionMode</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">SelectionMode</span>&gt;
  <span class="hljs-attr">selectedRowKeys</span>: <span class="hljs-title class_">Ref</span>&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;
  reserveSelection?: <span class="hljs-built_in">boolean</span>
  selectable?: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>  <span class="hljs-comment">// ğŸ†• è¡Œçº§é€‰æ‹©æ§åˆ¶</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseTableSelectionReturn</span> {
  <span class="hljs-attr">internalSelectedKeys</span>: <span class="hljs-title class_">Ref</span>&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;
  <span class="hljs-attr">selectionState</span>: <span class="hljs-title class_">ComputedRef</span>&lt;{
    <span class="hljs-attr">isAllSelected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">isIndeterminate</span>: <span class="hljs-built_in">boolean</span>
  }&gt;
  <span class="hljs-attr">isRowSelected</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">isRowSelectable</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">handleRowSelect</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow, selected: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">handleSingleSelect</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">handleSelectAll</span>: <span class="hljs-function">(<span class="hljs-params">selected: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">clearSelection</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">getAllSelectedRows</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">TableRow</span>[]
}
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>æ˜¾å¼çš„è¾“å…¥/è¾“å‡ºæ¥å£</strong>ï¼šé€šè¿‡ TypeScript æ¥å£æ˜ç¡®å®šä¹‰ Options å’Œ Returnï¼Œæ¶ˆé™¤éšå¼ä¾èµ–</li>
<li><strong>å“åº”å¼æ•°æ®ä½œä¸ºå‚æ•°</strong>ï¼šä¼ å…¥ <code>Ref</code> è€ŒéåŸå§‹å€¼ï¼Œä¿æŒå“åº”å¼é“¾è·¯</li>
<li><strong>çº¯å‡½æ•°å¼è®¾è®¡</strong>ï¼šæ— å‰¯ä½œç”¨ï¼Œæ‰€æœ‰çŠ¶æ€å˜æ›´éƒ½æ˜¯æ˜¾å¼çš„</li>
</ol>
<hr/>
<h2 data-id="heading-4">äºŒã€å“åº”å¼ç³»ç»Ÿçš„ç²¾ç»†åŒ–ä¼˜åŒ–</h2>
<h3 data-id="heading-5">2.1 shallowRef vs refï¼šå†…å­˜ä¸æ€§èƒ½çš„æƒè¡¡</h3>
<p>åœ¨å¤„ç†å¤§æ•°æ®é‡è¡¨æ ¼æ—¶ï¼Œå“åº”å¼ç³»ç»Ÿçš„å¼€é”€ä¸å®¹å¿½è§†ã€‚æˆ‘ä»¬é‡‡ç”¨åˆ†å±‚çš„å“åº”å¼ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ åæ¨¡å¼ï¼šæ·±å±‚å“åº”å¼å¯¼è‡´ä¸å¿…è¦çš„ä¾èµ–è¿½è¸ª</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">ref</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// âœ… ä¼˜åŒ–æ–¹æ¡ˆï¼šä½¿ç”¨ shallowRef å‡å°‘å“åº”å¼å¼€é”€</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// æ›´æ–°æ—¶æ‰‹åŠ¨è§¦å‘å“åº”</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSelection</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, row: TableRow</span>) {
  <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(selectedRowsMap.<span class="hljs-property">value</span>)
  newMap.<span class="hljs-title function_">set</span>(key, row)
  selectedRowsMap.<span class="hljs-property">value</span> = newMap  <span class="hljs-comment">// è§¦å‘å“åº”å¼æ›´æ–°</span>
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼ˆ1000 è¡Œæ•°æ®åœºæ™¯ï¼‰ï¼š</p>




















<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å†…å­˜å ç”¨</th><th>æ‰¹é‡é€‰æ‹©è€—æ—¶</th></tr></thead><tbody><tr><td>ref + Map</td><td>~2.4MB</td><td>~45ms</td></tr><tr><td>shallowRef + Map</td><td>~1.8MB</td><td>~12ms</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 Computed ä¾èµ–çš„ç²¾å‡†æ§åˆ¶</h3>
<p><code>computed</code> çš„ä¾èµ–è¿½è¸ªæ˜¯è‡ªåŠ¨çš„ï¼Œä½†è¿™ä¹Ÿå¯èƒ½å¯¼è‡´"è¿‡åº¦è¿½è¸ª"é—®é¢˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ åæ¨¡å¼ï¼šæ•´ä¸ª data æ•°ç»„å˜åŒ–éƒ½ä¼šè§¦å‘é‡è®¡ç®—</span>
<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> allKeys = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-comment">// ...</span>
})

<span class="hljs-comment">// âœ… ä¼˜åŒ–æ–¹æ¡ˆï¼šåªè¿½è¸ªå¿…è¦çš„ä¾èµ–</span>
<span class="hljs-keyword">const</span> selectableRows = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> 
  data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> <span class="hljs-title function_">isRowSelectable</span>(row, index))
)

<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> selectableKeys = selectableRows.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-keyword">const</span> selectedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(internalSelectedKeys.<span class="hljs-property">value</span>)
  
  <span class="hljs-keyword">const</span> selectedCount = selectableKeys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> selectedSet.<span class="hljs-title function_">has</span>(key)).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> totalSelectable = selectableKeys.<span class="hljs-property">length</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">isAllSelected</span>: totalSelectable &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount === totalSelectable,
    <span class="hljs-attr">isIndeterminate</span>: selectedCount &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount &lt; totalSelectable,
  }
})
</code></pre>
<h3 data-id="heading-7">2.3 Watch çš„é˜²æŠ–ä¸èŠ‚æµç­–ç•¥</h3>
<p>å¯¹äºé«˜é¢‘å˜åŒ–çš„æ•°æ®æºï¼Œç›´æ¥ watch å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableExpand.ts</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> data.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>,  <span class="hljs-comment">// ğŸ‘ˆ åªç›‘å¬é•¿åº¦å˜åŒ–ï¼Œè€Œéæ•´ä¸ªæ•°ç»„</span>
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (defaultExpandAll.<span class="hljs-property">value</span>) {
      <span class="hljs-title function_">initializeExpandedKeys</span>()
    }
  },
  { <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span> }  <span class="hljs-comment">// ğŸ‘ˆ åœ¨ DOM æ›´æ–°åæ‰§è¡Œï¼Œé¿å…é‡å¤è®¡ç®—</span>
)
</code></pre>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€TypeScript ç±»å‹ä½“æ“ï¼šä»"èƒ½ç”¨"åˆ°"å¥½ç”¨"</h2>
<h3 data-id="heading-9">3.1 æ³›å‹çº¦æŸä¸æ¡ä»¶ç±»å‹</h3>
<p>ä¸ºäº†è®© API æ›´åŠ æ™ºèƒ½ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ¡ä»¶ç±»å‹æ¥çº¦æŸå‚æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableColumn</span>&lt;T = <span class="hljs-title class_">TableRow</span>&gt; {
  <span class="hljs-attr">key</span>: keyof T | <span class="hljs-built_in">string</span>
  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>
  width?: <span class="hljs-built_in">string</span>
  flex?: <span class="hljs-built_in">string</span>
  align?: <span class="hljs-string">'left'</span> | <span class="hljs-string">'center'</span> | <span class="hljs-string">'right'</span>
  sortable?: <span class="hljs-built_in">boolean</span>
  
  <span class="hljs-comment">// æ¡ä»¶æ¸²æŸ“å‡½æ•°</span>
  render?: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span>, row: T, column: TableColumn&lt;T&gt;</span>) =&gt;</span> <span class="hljs-built_in">string</span>
  
  <span class="hljs-comment">// è¡Œæ“ä½œé¡¹ï¼ˆæ”¯æŒé™æ€é…ç½®å’ŒåŠ¨æ€å‡½æ•°ï¼‰</span>
  actionItems?: <span class="hljs-title class_">ActionItem</span>[] | (<span class="hljs-function">(<span class="hljs-params">row: T</span>) =&gt;</span> <span class="hljs-title class_">ActionItem</span>[])
}

<span class="hljs-comment">// ä½¿ç”¨æ³›å‹çº¦æŸè¡Œæ•°æ®ç±»å‹</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRow</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">orderNo</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span> | <span class="hljs-string">'confirmed'</span> | <span class="hljs-string">'shipped'</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>&lt;<span class="hljs-title class_">OrderRow</span>&gt;[] = [
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'status'</span>,  <span class="hljs-comment">// âœ… IDE è‡ªåŠ¨è¡¥å…¨ï¼Œç±»å‹å®‰å…¨</span>
    <span class="hljs-attr">label</span>: <span class="hljs-string">'çŠ¶æ€'</span>,
    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> statusMap[value <span class="hljs-keyword">as</span> <span class="hljs-title class_">OrderRow</span>[<span class="hljs-string">'status'</span>]]
  }
]
</code></pre>
<h3 data-id="heading-10">3.2 äº‹ä»¶ç±»å‹çš„å®Œæ•´å®šä¹‰</h3>
<p>ä¸ºç»„ä»¶äº‹ä»¶æä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œè®©ä½¿ç”¨æ–¹è·å¾—æœ€ä½³çš„å¼€å‘ä½“éªŒï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰å¼ºç±»å‹çš„ emit æ¥å£</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableEmits</span> {
  <span class="hljs-string">'update:selectedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]]
  <span class="hljs-string">'update:expandedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]]
  <span class="hljs-string">'selection-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">selectedRowKeys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]
  }]
  <span class="hljs-string">'select'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">row</span>: <span class="hljs-title class_">TableRow</span>
    <span class="hljs-attr">selected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
  <span class="hljs-string">'select-all'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">selected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">selectionChanges</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
  <span class="hljs-string">'sort-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">column</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
    <span class="hljs-attr">order</span>: <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> | <span class="hljs-literal">null</span>
    <span class="hljs-attr">sortState</span>: <span class="hljs-title class_">SortState</span>
  }]
  <span class="hljs-string">'expand-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">row</span>: <span class="hljs-title class_">TableRow</span>
    <span class="hljs-attr">expanded</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">expandedRows</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
}

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;<span class="hljs-title class_">TableEmits</span>&gt;()
</code></pre>
<h3 data-id="heading-11">3.3 Props çš„æ™ºèƒ½é»˜è®¤å€¼</h3>
<p>åˆ©ç”¨ TypeScript çš„ç±»å‹æ¨å¯¼ï¼Œå®ç°å¸¦é»˜è®¤å€¼çš„ Props å®šä¹‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(
  defineProps&lt;{
    data?: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>[]
    rowKey?: <span class="hljs-built_in">string</span>
    selectionMode?: <span class="hljs-title class_">SelectionMode</span>
    selectable?: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
    reserveSelection?: <span class="hljs-built_in">boolean</span>
    defaultExpandAll?: <span class="hljs-built_in">boolean</span>
  }&gt;(),
  {
    <span class="hljs-attr">data</span>: <span class="hljs-function">() =&gt;</span> [],
    <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
    <span class="hljs-attr">selectionMode</span>: <span class="hljs-string">'none'</span>,
    <span class="hljs-attr">selectable</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>,  <span class="hljs-comment">// é»˜è®¤æ‰€æœ‰è¡Œå¯é€‰</span>
    <span class="hljs-attr">reserveSelection</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">defaultExpandAll</span>: <span class="hljs-literal">false</span>,
  }
)
</code></pre>
<hr/>
<h2 data-id="heading-12">å››ã€é«˜çº§ç‰¹æ€§å®ç°å‰–æ</h2>
<h3 data-id="heading-13">4.1 è·¨åˆ†é¡µé€‰æ‹©ä¿æŒï¼ˆReserve Selectionï¼‰</h3>
<p>åœ¨åˆ†é¡µåœºæ™¯ä¸‹ï¼Œå¦‚ä½•ä¿æŒç”¨æˆ·çš„é€‰æ‹©çŠ¶æ€æ˜¯ä¸€ä¸ªç»å…¸é—®é¢˜ã€‚æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä½¿ç”¨ Map å­˜å‚¨é€‰ä¸­è¡Œçš„å®Œæ•´æ•°æ®ï¼Œè€Œéä»…å­˜å‚¨ key</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// æ•°æ®å˜åŒ–æ—¶çš„å¤„ç†ç­–ç•¥</span>
<span class="hljs-title function_">watch</span>(data, <span class="hljs-function">(<span class="hljs-params">newData</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!reserveSelection) {
    <span class="hljs-comment">// éä¿ç•™æ¨¡å¼ï¼šæ¸…é™¤ä¸åœ¨æ–°æ•°æ®ä¸­çš„é€‰ä¸­é¡¹</span>
    <span class="hljs-keyword">const</span> newDataKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(newData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey]))
    <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;()
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, row] <span class="hljs-keyword">of</span> selectedRowsMap.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">if</span> (newDataKeys.<span class="hljs-title function_">has</span>(key)) {
        newMap.<span class="hljs-title function_">set</span>(key, row)
      }
    }
    selectedRowsMap.<span class="hljs-property">value</span> = newMap
  }
  <span class="hljs-comment">// ä¿ç•™æ¨¡å¼ï¼šMap ä¸­çš„æ•°æ®ä¸ä¼šè¢«æ¸…é™¤ï¼Œå³ä½¿è¯¥è¡Œä¸åœ¨å½“å‰é¡µ</span>
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">false</span> })

<span class="hljs-comment">// è·å–æ‰€æœ‰é€‰ä¸­è¡Œæ•°æ®ï¼ˆè·¨åˆ†é¡µï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllSelectedRows</span>(<span class="hljs-params"/>): <span class="hljs-title class_">TableRow</span>[] {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(selectedRowsMap.<span class="hljs-property">value</span>.<span class="hljs-title function_">values</span>())
}
</code></pre>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†é€‰ä¸­è¡Œçš„å®Œæ•´æ•°æ®å­˜å‚¨åœ¨ Map ä¸­ï¼Œè€Œéä»…å­˜å‚¨ keyã€‚è¿™æ ·å³ä½¿æ•°æ®æºï¼ˆå½“å‰é¡µï¼‰ä¸åŒ…å«æŸäº›é€‰ä¸­è¡Œï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥è·å–å…¶å®Œæ•´ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-14">4.2 éƒ¨åˆ†è¡Œç¦ç”¨é€‰æ‹©ï¼ˆSelectableï¼‰</h3>
<p>ä¸šåŠ¡åœºæ™¯ä¸­å¸¸éœ€è¦æ ¹æ®è¡Œæ•°æ®åŠ¨æ€ç¦ç”¨é€‰æ‹©ï¼Œæˆ‘ä»¬é€šè¿‡ <code>selectable</code> å‡½æ•°å®ç°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * åˆ¤æ–­è¡Œæ˜¯å¦å¯é€‰æ‹©
 * <span class="hljs-doctag">@description</span> æ”¯æŒä¸šåŠ¡è‡ªå®šä¹‰ç¦ç”¨é€»è¾‘
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isRowSelectable</span>(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">if</span> (!selectable) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">selectable</span>(row, index)
}

<span class="hljs-comment">// å…¨é€‰é€»è¾‘éœ€è¦æ’é™¤ä¸å¯é€‰è¡Œ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSelectAll</span>(<span class="hljs-params">selected: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> selectableRows = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> 
    <span class="hljs-title function_">isRowSelectable</span>(row, index)
  )
  
  <span class="hljs-keyword">if</span> (selected) {
    <span class="hljs-comment">// åªé€‰ä¸­å¯é€‰çš„è¡Œ</span>
    selectableRows.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = row[rowKey]
      <span class="hljs-keyword">if</span> (!internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(key)) {
        internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(key)
        selectedRowsMap.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(key, row)
      }
    })
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// åªå–æ¶ˆå¯é€‰è¡Œçš„é€‰ä¸­çŠ¶æ€</span>
    <span class="hljs-keyword">const</span> selectableKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(selectableRows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey]))
    internalSelectedKeys.<span class="hljs-property">value</span> = internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> !selectableKeys.<span class="hljs-title function_">has</span>(key)
    )
  }
}

<span class="hljs-comment">// è®¡ç®—å…¨é€‰çŠ¶æ€æ—¶åªè€ƒè™‘å¯é€‰è¡Œ</span>
<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> selectableRows = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> 
    <span class="hljs-title function_">isRowSelectable</span>(row, index)
  )
  <span class="hljs-keyword">const</span> selectableKeys = selectableRows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-keyword">const</span> selectedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(internalSelectedKeys.<span class="hljs-property">value</span>)
  
  <span class="hljs-keyword">const</span> selectedCount = selectableKeys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> selectedSet.<span class="hljs-title function_">has</span>(key)).<span class="hljs-property">length</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">isAllSelected</span>: selectableKeys.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount === selectableKeys.<span class="hljs-property">length</span>,
    <span class="hljs-attr">isIndeterminate</span>: selectedCount &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount &lt; selectableKeys.<span class="hljs-property">length</span>,
  }
})
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;CmcCardTable
    v-model:selected-row-keys="selectedKeys"
    :data="tableData"
    :columns="columns"
    selection-mode="multiple"
    :selectable="(row) =&gt; row.status !== 'locked'"
  /&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-15">4.3 è¿œç¨‹æ’åºä¸æœ¬åœ°æ’åºçš„ç»Ÿä¸€æŠ½è±¡</h3>
<p>æ”¯æŒæœ¬åœ°æ’åºå’Œè¿œç¨‹æ’åºä¸¤ç§æ¨¡å¼ï¼Œé€šè¿‡é…ç½®åˆ‡æ¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSort.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTableSort</span>(<span class="hljs-params">options: UseTableSortOptions</span>) {
  <span class="hljs-keyword">const</span> { data, defaultSort, remoteSort, onSortChange } = options
  
  <span class="hljs-comment">// å½“å‰æ’åºçŠ¶æ€</span>
  <span class="hljs-keyword">const</span> sortState = shallowRef&lt;<span class="hljs-title class_">SortState</span>&gt;({
    <span class="hljs-attr">column</span>: defaultSort?.<span class="hljs-property">column</span> ?? <span class="hljs-literal">null</span>,
    <span class="hljs-attr">order</span>: defaultSort?.<span class="hljs-property">order</span> ?? <span class="hljs-literal">null</span>,
  })
  
  <span class="hljs-comment">// æ’åºåçš„æ•°æ®</span>
  <span class="hljs-keyword">const</span> sortedData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// è¿œç¨‹æ’åºæ¨¡å¼ï¼šç›´æ¥è¿”å›åŸæ•°æ®ï¼Œæ’åºç”±åç«¯å¤„ç†</span>
    <span class="hljs-keyword">if</span> (remoteSort?.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    }
    
    <span class="hljs-comment">// æœ¬åœ°æ’åºæ¨¡å¼</span>
    <span class="hljs-keyword">if</span> (!sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span> || !sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span>) {
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    }
    
    <span class="hljs-keyword">return</span> [...data.<span class="hljs-property">value</span>].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> aVal = a[sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>!]
      <span class="hljs-keyword">const</span> bVal = b[sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>!]
      <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">compareValues</span>(aVal, bVal)
      <span class="hljs-keyword">return</span> sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'desc'</span> ? -result : result
    })
  })
  
  <span class="hljs-comment">// åˆ‡æ¢æ’åº</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleSort</span>(<span class="hljs-params">column: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> newOrder = <span class="hljs-title function_">getNextSortOrder</span>(sortState.<span class="hljs-property">value</span>, column)
    sortState.<span class="hljs-property">value</span> = { <span class="hljs-attr">column</span>: newOrder ? column : <span class="hljs-literal">null</span>, <span class="hljs-attr">order</span>: newOrder }
    
    <span class="hljs-comment">// è§¦å‘äº‹ä»¶ï¼Œäº¤ç”±çˆ¶ç»„ä»¶å¤„ç†ï¼ˆè¿œç¨‹æ’åºæ—¶è°ƒç”¨æ¥å£ï¼‰</span>
    onSortChange?.({
      <span class="hljs-attr">column</span>: sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>,
      <span class="hljs-attr">order</span>: sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span>,
      <span class="hljs-attr">sortState</span>: sortState.<span class="hljs-property">value</span>,
    })
  }
  
  <span class="hljs-keyword">return</span> { sortState, sortedData, toggleSort }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">äº”ã€å·¥ç¨‹åŒ–å®è·µï¼šå¯æµ‹è¯•æ€§è®¾è®¡</h2>
<h3 data-id="heading-17">5.1 Composable çš„å•å…ƒæµ‹è¯•</h3>
<p>å¾—ç›Šäº Composables çš„ç‹¬ç«‹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è„±ç¦»ç»„ä»¶è¿›è¡Œå•å…ƒæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSelection.test.ts</span>
<span class="hljs-keyword">import</span> { describe, it, expect, vi } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useTableSelection } <span class="hljs-keyword">from</span> <span class="hljs-string">'../useTableSelection'</span>

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'useTableSelection'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">createTestData</span> = (<span class="hljs-params"/>) =&gt; [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æå››'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'locked'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'ç‹äº”'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
  ]

  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'selectable éƒ¨åˆ†ç¦ç”¨'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'å…¨é€‰æ—¶åº”åªé€‰ä¸­å¯é€‰è¡Œ'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = ref&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;([])
      
      <span class="hljs-keyword">const</span> { handleSelectAll, internalSelectedKeys } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">selectable</span>: <span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>,  <span class="hljs-comment">// åªæœ‰ active å¯é€‰</span>
      })
      
      <span class="hljs-title function_">handleSelectAll</span>(<span class="hljs-literal">true</span>)
      
      <span class="hljs-comment">// åº”åªé€‰ä¸­ id=1 å’Œ id=3ï¼ˆstatus='active'ï¼‰</span>
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-title function_">toEqual</span>([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>])
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toContain</span>(<span class="hljs-number">2</span>)
    })
    
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'isIndeterminate åº”åªåŸºäºå¯é€‰è¡Œè®¡ç®—'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>])  <span class="hljs-comment">// é€‰ä¸­ä¸€ä¸ªå¯é€‰è¡Œ</span>
      
      <span class="hljs-keyword">const</span> { selectionState } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">selectable</span>: <span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>,
      })
      
      <span class="hljs-comment">// å¯é€‰è¡Œæœ‰ 2 ä¸ªï¼ˆid=1,3ï¼‰ï¼Œé€‰ä¸­äº† 1 ä¸ªï¼Œåº”ä¸ºåŠé€‰çŠ¶æ€</span>
      <span class="hljs-title function_">expect</span>(selectionState.<span class="hljs-property">value</span>.<span class="hljs-property">isIndeterminate</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
      <span class="hljs-title function_">expect</span>(selectionState.<span class="hljs-property">value</span>.<span class="hljs-property">isAllSelected</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    })
  })
  
  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'reserveSelection è·¨åˆ†é¡µä¿ç•™'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'åº”ä¿ç•™ä¸åœ¨å½“å‰é¡µçš„é€‰ä¸­æ•°æ®'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">99</span>])  <span class="hljs-comment">// 99 ä¸åœ¨å½“å‰æ•°æ®ä¸­</span>
      
      <span class="hljs-keyword">const</span> { internalSelectedKeys, getAllSelectedRows } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">reserveSelection</span>: <span class="hljs-literal">true</span>,
      })
      
      <span class="hljs-comment">// key 99 åº”è¢«ä¿ç•™</span>
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-number">99</span>)
    })
  })
})
</code></pre>
<h3 data-id="heading-18">5.2 æµ‹è¯•è¦†ç›–ç‡ä¸è´¨é‡ä¿éšœ</h3>
<p>æˆ‘ä»¬ä¸ºæ ¸å¿ƒ Composables ç¼–å†™äº†å…¨é¢çš„å•å…ƒæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">âœ“ useTableSelection<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span> (<span class="hljs-number">25</span> tests)
âœ“ useTableExpand<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>    (<span class="hljs-number">27</span> tests)
âœ“ useTableSort<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>      (<span class="hljs-number">22</span> tests)
âœ“ useTableLayout<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>    (<span class="hljs-number">31</span> tests)

Total: <span class="hljs-number">105</span> tests passed
</code></pre>
<p>æµ‹è¯•ç”¨ä¾‹è¦†ç›–ï¼š</p>
<ul>
<li>âœ… æ­£å¸¸æµç¨‹</li>
<li>âœ… è¾¹ç•Œæ¡ä»¶ï¼ˆç©ºæ•°æ®ã€é‡å¤æ“ä½œç­‰ï¼‰</li>
<li>âœ… æ¨¡å¼åˆ‡æ¢ï¼ˆå•é€‰/å¤šé€‰/ç¦ç”¨ï¼‰</li>
<li>âœ… å“åº”å¼åŒæ­¥</li>
<li>âœ… äº‹ä»¶è§¦å‘</li>
</ul>
<hr/>
<h2 data-id="heading-19">å…­ã€API è®¾è®¡çš„è‰ºæœ¯ï¼šå‘ Element Plus å­¦ä¹ </h2>
<h3 data-id="heading-20">6.1 Props å‘½åçš„ä¸€è‡´æ€§</h3>
<p>æˆ‘ä»¬åœ¨ API è®¾è®¡ä¸Šå°½é‡ä¸ Element Plus ä¿æŒä¸€è‡´ï¼Œé™ä½ç”¨æˆ·çš„å­¦ä¹ æˆæœ¬ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Element Plus Table --&gt;
&lt;el-table
  :data="tableData"
  :row-key="rowKey"
  :default-sort="{ prop: 'date', order: 'descending' }"
  @selection-change="handleSelectionChange"
  @sort-change="handleSortChange"
&gt;
  &lt;el-table-column type="selection" /&gt;
  &lt;el-table-column type="index" /&gt;
  &lt;el-table-column type="expand" /&gt;
&lt;/el-table&gt;

&lt;!-- CmcCardTableï¼ˆé£æ ¼ä¸€è‡´ï¼‰ --&gt;
&lt;CmcCardTable
  :data="tableData"
  :row-key="rowKey"
  :default-sort="{ column: 'date', order: 'desc' }"
  @selection-change="handleSelectionChange"
  @sort-change="handleSortChange"
  :columns="[
    { key: 'selection', type: 'selection' },
    { key: 'index', type: 'index' },
    { key: 'expand', type: 'expand' },
  ]"
/&gt;
</code></pre>
<h3 data-id="heading-21">6.2 æ¸è¿›å¼çš„åŠŸèƒ½å¯ç”¨</h3>
<p>é€šè¿‡ Props å¼€å…³å¼åœ°å¯ç”¨åŠŸèƒ½ï¼Œä¿æŒ API çš„ç®€æ´æ€§ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- æœ€ç®€ç”¨æ³• --&gt;
&lt;CmcCardTable :data="data" :columns="columns" /&gt;

&lt;!-- å¯ç”¨é€‰æ‹© --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
/&gt;

&lt;!-- å¯ç”¨é€‰æ‹© + éƒ¨åˆ†ç¦ç”¨ --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
  :selectable="row =&gt; row.status === 'active'"
/&gt;

&lt;!-- å¯ç”¨é€‰æ‹© + è·¨åˆ†é¡µä¿ç•™ + éƒ¨åˆ†ç¦ç”¨ --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
  reserve-selection
  :selectable="row =&gt; row.status === 'active'"
/&gt;
</code></pre>
<hr/>
<h2 data-id="heading-22">ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æ¸…å•</h2>



































<table><thead><tr><th>ä¼˜åŒ–ç‚¹</th><th>æŠ€æœ¯æ‰‹æ®µ</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>å‡å°‘å“åº”å¼å¼€é”€</td><td>shallowRef æ›¿ä»£ ref</td><td>å†…å­˜é™ä½ 25%</td></tr><tr><td>é¿å…é‡å¤è®¡ç®—</td><td>computed ç¼“å­˜</td><td>æ¸²æŸ“æ€§èƒ½æå‡ 40%</td></tr><tr><td>ç²¾å‡†ä¾èµ–è¿½è¸ª</td><td>æ‹†åˆ†ç»†ç²’åº¦ computed</td><td>å‡å°‘æ— æ•ˆæ›´æ–°</td></tr><tr><td>å¤§åˆ—è¡¨æ¸²æŸ“</td><td>CSS Grid å¸ƒå±€</td><td>é‡æ’æ€§èƒ½æå‡</td></tr><tr><td>äº‹ä»¶å¤„ç†</td><td>äº‹ä»¶å§”æ‰˜</td><td>å‡å°‘ç›‘å¬å™¨æ•°é‡</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">å…«ã€è¿›é˜¶ä¼˜åŒ–ï¼šçªç ´æ€§èƒ½ç“¶é¢ˆ</h2>
<h3 data-id="heading-24">8.1 è™šæ‹Ÿæ»šåŠ¨æ”¯æŒï¼šçªç ´ä¸‡çº§æ•°æ®æ¸²æŸ“</h3>
<p>å½“è¡¨æ ¼éœ€è¦æ¸²æŸ“æ•°åƒç”šè‡³ä¸Šä¸‡è¡Œæ•°æ®æ—¶ï¼Œä¼ ç»Ÿçš„ v-for æ¸²æŸ“ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚æˆ‘ä»¬å®ç°äº† <code>useVirtualScroll</code> composable æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useVirtualScroll.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useVirtualScroll</span>(<span class="hljs-params">options: UseVirtualScrollOptions</span>) {
  <span class="hljs-keyword">const</span> { data, itemHeight, containerHeight, overscan = <span class="hljs-number">5</span> } = options
  
  <span class="hljs-comment">// å½“å‰æ»šåŠ¨ä½ç½®</span>
  <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
  
  <span class="hljs-comment">// è®¡ç®—å¯è§èŒƒå›´ï¼ˆèµ·å§‹å’Œç»“æŸç´¢å¼•ï¼‰</span>
  <span class="hljs-keyword">const</span> visibleRange = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop.<span class="hljs-property">value</span> / itemHeight)
    <span class="hljs-keyword">const</span> end = start + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight / itemHeight)
    
    <span class="hljs-comment">// åº”ç”¨ overscanï¼ˆé¢„æ¸²æŸ“é¢å¤–è¡Œæ•°ï¼‰</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">start</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, start - overscan),
      <span class="hljs-attr">end</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(data.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>, end + overscan)
    }
  })
  
  <span class="hljs-comment">// åªæ¸²æŸ“å¯è§èŒƒå›´å†…çš„æ•°æ®</span>
  <span class="hljs-keyword">const</span> virtualItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { start, end } = visibleRange.<span class="hljs-property">value</span>
    <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(start, end + <span class="hljs-number">1</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, i</span>) =&gt;</span> ({
      <span class="hljs-attr">data</span>: item,
      <span class="hljs-attr">index</span>: start + i,
      <span class="hljs-attr">offsetTop</span>: (start + i) * itemHeight
    }))
  })
  
  <span class="hljs-keyword">return</span> { virtualItems, visibleRange, onScroll, ... }
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼ˆæ¸²æŸ“ 10,000 è¡Œæ•°æ®ï¼‰ï¼š</p>

























<table><thead><tr><th>æŒ‡æ ‡</th><th>æ™®é€šæ¸²æŸ“</th><th>è™šæ‹Ÿæ»šåŠ¨</th></tr></thead><tbody><tr><td>é¦–å±æ—¶é—´</td><td>~3200ms</td><td>~45ms</td></tr><tr><td>DOM èŠ‚ç‚¹æ•°</td><td>10,000+</td><td>~30</td></tr><tr><td>å†…å­˜å ç”¨</td><td>~50MB</td><td>~2MB</td></tr></tbody></table>
<h3 data-id="heading-25">8.2 WeakMap vs Mapï¼šå†…å­˜ç®¡ç†çš„æ·±å±‚æ€è€ƒ</h3>
<p>åœ¨ <code>selectedRowsMap</code> çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº† <code>Map</code> è€Œé <code>WeakMap</code>ï¼Œè¿™æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„å†³å®šï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… å½“å‰æ–¹æ¡ˆï¼šä½¿ç”¨ shallowRef + Map</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// â“ ä¸ºä»€ä¹ˆä¸ç”¨ WeakMapï¼Ÿ</span>
<span class="hljs-comment">// const selectedRowsMap = shallowRef(new WeakMap&lt;TableRow, boolean&gt;())</span>
</code></pre>
<p><strong>ä¸é€‰æ‹© WeakMap çš„åŸå› </strong>ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>Map</th><th>WeakMap</th></tr></thead><tbody><tr><td>é”®ç±»å‹</td><td>ä»»æ„ç±»å‹</td><td>ä»…å¯¹è±¡</td></tr><tr><td>å¯æšä¸¾</td><td>âœ… æ”¯æŒ</td><td>âœ–ï¸ ä¸æ”¯æŒ</td></tr><tr><td>size å±æ€§</td><td>âœ… æœ‰</td><td>âœ–ï¸ æ— </td></tr><tr><td>GC å›æ”¶</td><td>æ‰‹åŠ¨ç®¡ç†</td><td>è‡ªåŠ¨å›æ”¶</td></tr></tbody></table>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼š</p>
<ol>
<li>æˆ‘ä»¬éœ€è¦ç”¨ <code>rowKey</code>ï¼ˆå­—ç¬¦ä¸²/æ•°å­—ï¼‰ä½œä¸ºé”®ï¼ŒWeakMap åªæ¥å—å¯¹è±¡ä½œä¸ºé”®</li>
<li>æˆ‘ä»¬éœ€è¦éå†æ‰€æœ‰é€‰ä¸­è¡Œï¼ˆ<code>getAllSelectedRows</code>ï¼‰ï¼ŒWeakMap ä¸å¯æšä¸¾</li>
<li>æˆ‘ä»¬éœ€è¦çŸ¥é“é€‰ä¸­æ•°é‡ï¼ŒWeakMap æ²¡æœ‰ <code>size</code> å±æ€§</li>
</ol>
<p><strong>å†…å­˜æ³„æ¼é˜²æŠ¤</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é€šè¿‡ shallowRef åŒ…è£…ï¼Œç¡®ä¿éšç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>())

<span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶ï¼ŒshallowRef çš„å¼•ç”¨é‡Šæ”¾ï¼ŒMap è‡ªç„¶è¢« GC å›æ”¶</span>
<span class="hljs-comment">// æ— éœ€æ‰‹åŠ¨æ¸…ç†</span>
</code></pre>
<h3 data-id="heading-26">8.3 Vue 3.4 defineModelï¼šç®€åŒ–åŒå‘ç»‘å®š</h3>
<p>Vue 3.4 ç¨³å®šç‰ˆå¼•å…¥çš„ <code>defineModel</code> å®å¯ä»¥å¤§å¹…ç®€åŒ–åŒå‘ç»‘å®šçš„ä»£ç ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ Vue 3.4 ä¹‹å‰çš„å†™æ³•</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{ <span class="hljs-attr">selectedRowKeys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[] }&gt;()
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{ <span class="hljs-string">'update:selectedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]] }&gt;()

<span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨åŒæ­¥</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">selectedRowKeys</span>, <span class="hljs-function">(<span class="hljs-params">newKeys</span>) =&gt;</span> {
  internalSelectedKeys.<span class="hljs-property">value</span> = [...newKeys]
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSelection</span>(<span class="hljs-params">keys: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]</span>) {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:selectedRowKeys'</span>, keys)
}

<span class="hljs-comment">// âœ… Vue 3.4+ ä½¿ç”¨ defineModel</span>
<span class="hljs-keyword">const</span> selectedRowKeys = defineModel&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;(<span class="hljs-string">'selectedRowKeys'</span>, {
  <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
})

<span class="hljs-keyword">const</span> expandedRowKeys = defineModel&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;(<span class="hljs-string">'expandedRowKeys'</span>, {
  <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
})

<span class="hljs-comment">// ç›´æ¥ä¿®æ”¹å³å¯è§¦å‘æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨ emit</span>
selectedRowKeys.<span class="hljs-property">value</span> = [...newKeys]
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å‡å°‘çº¦ 60% çš„æ¨¡æ¿ä»£ç </li>
<li>è‡ªåŠ¨å¤„ç† props å’Œ emit çš„åŒæ­¥</li>
<li>æ›´ç›´è§‚çš„åŒå‘ç»‘å®šè¯­ä¹‰</li>
</ul>
<h3 data-id="heading-27">8.4 Vue Vapor Modeï¼šæ— è™šæ‹Ÿ DOM çš„æœªæ¥</h3>
<p>Vue 3.6 alpha å¼•å…¥äº†å®éªŒæ€§çš„ <strong>Vapor Mode</strong>ï¼Œå®ƒå®Œå…¨è·³è¿‡è™šæ‹Ÿ DOMï¼Œç›´æ¥ç”Ÿæˆ DOM æ“ä½œä»£ç ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å¯ç”¨ Vapor Modeï¼šåªéœ€æ·»åŠ  vapor å…³é”®å­— --&gt;
&lt;script setup vapor&gt;
import { ref } from 'vue'
const count = ref(0)
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="count++"&gt;{{ count }}&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p><strong>Vapor Mode çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ğŸš€ æ›´å°çš„åŒ…ä½“ç§¯ï¼ˆæ—  VDOM è¿è¡Œæ—¶ï¼‰</li>
<li>âš¡ æ›´å¿«çš„æ¸²æŸ“ï¼ˆæ—  diff/patch å¼€é”€ï¼‰</li>
<li>ğŸ“Š æ›´ä½çš„å†…å­˜å ç”¨</li>
</ul>
<p><strong>å…¼å®¹æ€§è®¾è®¡</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// CmcCardTable çš„ Vapor Mode å…¼å®¹æ€§è®¾è®¡</span>
<span class="hljs-keyword">import</span> { vaporInteropPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// åœ¨ VDOM åº”ç”¨ä¸­ä½¿ç”¨ Vapor ç»„ä»¶</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-title function_">use</span>(vaporInteropPlugin)  <span class="hljs-comment">// å¯ç”¨äº’æ“ä½œæ’ä»¶</span>
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

<span class="hljs-comment">// CmcCardTable å¯ä»¥æ¸è¿›å¼è¿ç§»åˆ° Vapor Mode</span>
<span class="hljs-comment">// 1. å°†æ€§èƒ½å…³é”®çš„å­ç»„ä»¶è½¬ä¸º Vapor</span>
<span class="hljs-comment">// 2. ä¸ç°æœ‰ VDOM ç»„ä»¶æ— ç¼å…±å­˜</span>
</code></pre>
<p><strong>è¿ç§»æŒ‡å—</strong>ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>æ”¯æŒçŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Composition API</td><td>âœ… å®Œå…¨æ”¯æŒ</td><td>å”¯ä¸€æ”¯æŒçš„ API é£æ ¼</td></tr><tr><td>Options API</td><td>âœ–ï¸ ä¸æ”¯æŒ</td><td>éœ€è¿ç§»åˆ° Composition API</td></tr><tr><td><code>&lt;Transition&gt;</code></td><td>âœ–ï¸ æš‚ä¸æ”¯æŒ</td><td>åç»­ç‰ˆæœ¬æ”¯æŒ</td></tr><tr><td>Element Plus</td><td>âœ… æ”¯æŒ</td><td>éœ€é…åˆ vaporInteropPlugin</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-28">ä¹ã€æ€»ç»“ä¸å±•æœ›</h2>
<p>é€šè¿‡ <code>CmcCardTable</code> ç»„ä»¶çš„è®¾è®¡å®è·µï¼Œæˆ‘ä»¬éªŒè¯äº†ä»¥ä¸‹æŠ€æœ¯æ–¹æ¡ˆçš„å¯è¡Œæ€§ï¼š</p>
<ol>
<li><strong>Composables æ¨¡å¼</strong> æ˜¯ç»„ç»‡å¤æ‚ç»„ä»¶é€»è¾‘çš„æœ€ä½³å®è·µ</li>
<li><strong>åˆ†å±‚å“åº”å¼ç­–ç•¥</strong> èƒ½æ˜¾è‘—æå‡å¤§æ•°æ®é‡åœºæ™¯ä¸‹çš„æ€§èƒ½</li>
<li><strong>å®Œå¤‡çš„ç±»å‹å®šä¹‰</strong> æ˜¯æå‡å¼€å‘ä½“éªŒçš„å…³é”®</li>
<li><strong>å¯æµ‹è¯•æ€§è®¾è®¡</strong> åº”è´¯ç©¿ç»„ä»¶å¼€å‘çš„å§‹ç»ˆ</li>
<li><strong>è™šæ‹Ÿæ»šåŠ¨</strong> æ˜¯çªç ´å¤§æ•°æ®é‡æ¸²æŸ“ç“¶é¢ˆçš„å…³é”®æŠ€æœ¯</li>
</ol>
<p><strong>å·²å®Œæˆçš„ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>âœ… è™šæ‹Ÿæ»šåŠ¨ <code>useVirtualScroll</code> composable</li>
<li>âœ… <code>shallowRef</code> + <code>Map</code> å†…å­˜ç®¡ç†ä¼˜åŒ–</li>
<li>âœ… éƒ¨åˆ†è¡Œç¦ç”¨é€‰æ‹© <code>selectable</code> æ”¯æŒ</li>
</ul>
<p><strong>æœªæ¥è®¡åˆ’</strong>ï¼š</p>
<ul>
<li>ğŸ”® è¿ç§»åˆ° Vue 3.4 <code>defineModel</code> ç®€åŒ–åŒå‘ç»‘å®š</li>
<li>ğŸ”® æ¢ç´¢ Vapor Mode é›¶è™šæ‹Ÿ DOM æ–¹æ¡ˆ</li>
<li>ğŸ”® å®ç°åˆ—çš„æ‹–æ‹½æ’åºä¸å®½åº¦è°ƒæ•´</li>
<li>ğŸ”® æ”¯æŒåŠ¨æ€è¡Œé«˜çš„è™šæ‹Ÿæ»šåŠ¨</li>
</ul>
<hr/>
<h2 data-id="heading-29">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Freusability%2Fcomposables.html" target="_blank" title="https://vuejs.org/guide/reusability/composables.html" ref="nofollow noopener noreferrer">Vue 3 Composition API å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2F" target="_blank" title="https://vueuse.org/" ref="nofollow noopener noreferrer">VueUse - Collection of Vue Composition Utilities</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felement-plus%2Felement-plus" target="_blank" title="https://github.com/element-plus/element-plus" ref="nofollow noopener noreferrer">Element Plus Table æºç </a></li>
</ul>
<hr/>
<blockquote>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è— â­ï¸ï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­è¾“å‡ºçš„åŠ¨åŠ›ï¼</p>
<p>æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®º ğŸ’¬</p>
</blockquote>
<p><strong>å…³äºä½œè€…</strong>ï¼šä¸“æ³¨äºä¼ä¸šçº§ Vue 3 åº”ç”¨å¼€å‘ï¼Œçƒ­è¡·äºç»„ä»¶è®¾è®¡ä¸æ€§èƒ½ä¼˜åŒ–ã€‚</p>
<hr/>
<p><em>æœ¬æ–‡é¦–å‘äºæ˜é‡‘ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ThreadLocal]]></title>    <link>https://juejin.cn/post/7583892482599321615</link>    <guid>https://juejin.cn/post/7583892482599321615</guid>    <pubDate>2025-12-16T01:26:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482599321615" data-draft-id="7583955708317696000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ThreadLocal"/> <meta itemprop="keywords" content="Java,Android,æºç "/> <meta itemprop="datePublished" content="2025-12-16T01:26:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ„¤æ€’çš„ä»£ç "/> <meta itemprop="url" content="https://juejin.cn/user/4125023358426190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ThreadLocal
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023358426190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ„¤æ€’çš„ä»£ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:26:52.000Z" title="Tue Dec 16 2025 01:26:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>ThreadLocal</code> æ˜¯ Java æä¾›çš„ä¸€ä¸ªæœºåˆ¶ï¼Œä½†åœ¨ Android å¼€å‘ï¼Œå°¤å…¶æ˜¯åœ¨ç†è§£ <code>Looper</code> å’Œæ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œå®ƒæ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚</p>
<h3 data-id="heading-0">0x00. <code>ThreadLocal</code> çš„æ ¸å¿ƒä½œç”¨å’Œè®¾è®¡ç›®æ ‡</h3>
<h4 data-id="heading-1">æ ¸å¿ƒä½œç”¨ï¼šçº¿ç¨‹å±€éƒ¨å˜é‡</h4>
<p><code>ThreadLocal</code> é¡¾åæ€ä¹‰ï¼Œæ˜¯<strong>çº¿ç¨‹çš„å±€éƒ¨å˜é‡</strong>ã€‚å®ƒä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹éƒ½æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„ã€éš”ç¦»çš„å˜é‡å‰¯æœ¬ã€‚</p>
<ul>
<li><strong>éš”ç¦»æ€§ï¼š</strong> å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ª <code>ThreadLocal</code> å®ä¾‹æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹çœ‹åˆ°å’Œæ“ä½œçš„éƒ½æ˜¯è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œå½¼æ­¤ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚</li>
<li><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong> ç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬ï¼Œå› æ­¤å¤©ç„¶è§£å†³äº†å¤šçº¿ç¨‹è®¿é—®å…±äº«å˜é‡æ—¶çš„åŒæ­¥é—®é¢˜ï¼Œ<strong>æ— éœ€ä½¿ç”¨ <code>synchronized</code> ç­‰é”æœºåˆ¶</strong>ï¼Œä»è€Œæå‡äº†å¹¶å‘æ€§èƒ½ã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> <code>ThreadLocal</code> æœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè®¿é—®é”®ï¼ˆKeyï¼‰ã€‚æ•°æ®å­˜å‚¨åœ¨æ¯ä¸ªçº¿ç¨‹å†…éƒ¨çš„ä¸€ä¸ªåä¸º <code>ThreadLocalMap</code> çš„ç»“æ„ä¸­ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">0x01. <code>ThreadLocal</code> çš„åº•å±‚åŸç†ï¼š<code>ThreadLocalMap</code></h3>
<p>è¦ç†è§£ <code>ThreadLocal</code> çš„æœºåˆ¶ï¼Œå…³é”®åœ¨äºç†è§£ <code>Thread</code> å¯¹è±¡å†…éƒ¨çš„ä¸€ä¸ªéšç§˜å­—æ®µï¼š</p>
<ol>
<li>
<p><strong>æ•°æ®å­˜å‚¨åœ¨å“ªï¼Ÿ</strong></p>
<ul>
<li>æ¯ä¸ª <code>java.lang.Thread</code> å¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æˆå‘˜å˜é‡ï¼Œå«åš <code>ThreadLocal.ThreadLocalMap</code>ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ª Map æ˜¯ <code>ThreadLocal</code> çš„å†…éƒ¨ç±»ï¼Œä½†å®ƒå±äº <code>Thread</code> å®ä¾‹ï¼‰ã€‚</li>
<li>å½“ä½ è°ƒç”¨ <code>ThreadLocal.set(value)</code> æ—¶ï¼Œæ•°æ®å®é™…ä¸Šæ˜¯ä»¥ <code>(thisThreadLocalInstance, value)</code> çš„å½¢å¼å­˜å…¥äº†å½“å‰çº¿ç¨‹çš„ <code>ThreadLocalMap</code> ä¸­ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>ThreadLocalMap</code> çš„ç»“æ„ï¼š</strong></p>
<ul>
<li><code>ThreadLocalMap</code> å¹¶ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ <code>HashMap</code>ã€‚å®ƒçš„é”®ï¼ˆKeyï¼‰æ˜¯**å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰**æŒ‡å‘ <code>ThreadLocal</code> å¯¹è±¡æœ¬èº«ï¼Œå€¼ï¼ˆValueï¼‰æ˜¯ä½ è¦å­˜å‚¨çš„æ•°æ®ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">0x02. <code>ThreadLocal</code> åœ¨ Android æºç ä¸­çš„åº”ç”¨</h3>
<hr/>
<p><code>ThreadLocal</code> æœ€è‘—åçš„åº”ç”¨å°±æ˜¯å®ç° Android çš„<strong>æ¶ˆæ¯å¾ªç¯æœºåˆ¶</strong>ï¼š</p>
<h4 data-id="heading-4">A. å®ç° <code>Looper</code> çš„å•ä¾‹ç‰¹æ€§</h4>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ª <code>Looper</code>ã€‚<code>ThreadLocal</code> æ˜¯å¦‚ä½•ä¿è¯è¿™ä¸€ç‚¹çš„ï¼Ÿ</p>
<ul>
<li>
<p>åœ¨ <code>Looper</code> ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªé™æ€çš„ <code>ThreadLocal</code> å˜é‡ï¼š</p>
<p><code>Looper</code>ä¸­å®šä¹‰äº† <code>sThreadLocal</code> é™æ€å˜é‡</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;Looper&gt;();
</code></pre>
</li>
<li>
<p><strong><code>Looper.prepare()</code> çš„é€»è¾‘ï¼š</strong></p>
<ol>
<li>è°ƒç”¨ <code>sThreadLocal.get()</code> æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å·²æœ‰ <code>Looper</code>ã€‚</li>
<li>å¦‚æœå‘ç°å½“å‰çº¿ç¨‹å·²ç»æœ‰äº† <code>Looper</code>ï¼ˆå³ <code>get()</code> ä¸ä¸ºç©ºï¼‰ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¼ºåˆ¶ä¿è¯å•ä¾‹ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Looper</code> å®ä¾‹ï¼Œå¹¶é€šè¿‡ <code>sThreadLocal.set(newLooper)</code> å°†å…¶å­˜å…¥å½“å‰çº¿ç¨‹çš„ <code>ThreadLocalMap</code> ä¸­ã€‚</li>
</ol>
</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>Looper</code> æœºåˆ¶å®Œç¾åœ°åˆ©ç”¨äº† <code>ThreadLocal</code> çš„éš”ç¦»æ€§ï¼Œå®ç°äº†<strong>çº¿ç¨‹å†…çš„å•ä¾‹</strong>ã€‚</p>
<p><code>Looper</code> ä»£ç ç‰‡æ®µ</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">()</span> {
    prepare(<span class="hljs-literal">true</span>);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
    <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Only one Looper may be created per thread"</span>);
    }
    sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹å®ä¾‹</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// ä»å½“å‰çº¿ç¨‹ä¸­è·å– ThreadLocalMap</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
        map.set(<span class="hljs-built_in">this</span>, value); <span class="hljs-comment">// ThreadLocal å½“ä½œkey æŠŠvalue ä¿å­˜åœ¨ map ä¸­</span>
    <span class="hljs-keyword">else</span>
        createMap(t, value);
}

</code></pre>
<p><code>ThreadLocal</code>ä»£ç ç‰‡æ®µ</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹å®ä¾‹</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// ä»å½“å‰çº¿ç¨‹ä¸­è·å– ThreadLocalMap å¯¹è±¡</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// this å°±æ˜¯ ThreadLocalï¼Œå®ƒæ˜¯ä¸€ä¸ª Key</span>
        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
            <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
            <span class="hljs-keyword">return</span> result;
        }
    }
    <span class="hljs-keyword">return</span> setInitialValue();
}

<span class="hljs-comment">// ä» Thread å®ä¾‹ä¸­è·å– threadLocals å¯¹è±¡</span>
ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> {
    <span class="hljs-keyword">return</span> t.threadLocals;
}

</code></pre>
<h4 data-id="heading-5">B. æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…å‚æ•°ä¼ é€’</h4>
<p><code>ThreadLocal</code> å¯ä»¥ç”¨æ¥åœ¨åŒä¸€çº¿ç¨‹å†…çš„ä¸åŒæ–¹æ³•æˆ–æ¨¡å—ä¹‹é—´å…±äº«æ•°æ®ï¼Œè€Œæ— éœ€å±‚å±‚ä¼ é€’å‚æ•°ã€‚</p>
<ul>
<li>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¤æ‚çš„ IO æ“ä½œæµç¨‹ä¸­ï¼Œä½ å¯ä»¥æŠŠæ•°æ®åº“è¿æ¥å¯¹è±¡å­˜å…¥ <code>ThreadLocal</code>ï¼Œæµç¨‹ä¸­ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ç›´æ¥ <code>get()</code> æ‹¿åˆ°ï¼Œé¿å…äº†æ–¹æ³•ç­¾åè†¨èƒ€ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">0x03. å†…å­˜æ³„éœ²é£é™©</h3>
<p>ä½¿ç”¨ <code>ThreadLocal</code> <strong>æœ€å±é™©çš„é™·é˜±æ˜¯å†…å­˜æ³„éœ²</strong>ï¼Œå°¤å…¶æ˜¯åœ¨ Android è¿™ç§é•¿ç”Ÿå‘½å‘¨æœŸçš„ç¯å¢ƒï¼ˆå¦‚ä¸»çº¿ç¨‹ï¼‰ä¸­ã€‚</p>
<h4 data-id="heading-7">A. é£é™©åˆ†æ</h4>
<ol>
<li>
<p><strong><code>ThreadLocalMap</code> çš„é”®æ˜¯å¼±å¼•ç”¨ (<code>WeakReference&lt;ThreadLocal&gt;</code>)ã€‚</strong></p>
</li>
<li>
<p><strong><code>ThreadLocalMap</code> çš„å€¼æ˜¯å¼ºå¼•ç”¨ (<code>Value</code>)ã€‚</strong></p>
</li>
<li>
<p>å¦‚æœçº¿ç¨‹ä¸€ç›´å­˜æ´»ï¼ˆä¾‹å¦‚ä¸»çº¿ç¨‹ï¼‰ï¼Œä½†å¤–éƒ¨æ²¡æœ‰å¼•ç”¨æŒ‡å‘ <code>ThreadLocal</code> å®ä¾‹ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>å¤–éƒ¨çš„ <code>ThreadLocal</code> å¯¹è±¡ä¼šè¢« GC å›æ”¶ï¼ˆå› ä¸ºæ˜¯å¼±å¼•ç”¨ï¼‰ã€‚</li>
<li><strong>ä½†å­˜å‚¨åœ¨ <code>ThreadLocalMap</code> é‡Œçš„ Value ä»ç„¶è¢« Map å¼ºå¼•ç”¨ï¼Œæ— æ³•è¢«å›æ”¶ã€‚</strong></li>
<li>é”®ï¼ˆKeyï¼‰å˜æˆäº† <code>null</code>ï¼Œå€¼ï¼ˆValueï¼‰è¿˜åœ¨ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</li>
</ul>
</li>
</ol>
<p><code>ThreadLocalMap</code>æºç ç‰‡æ®µä¸­å¯ä»¥çœ‹åˆ°å®ƒçš„ <code>Entry</code> æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalMap</span> {

    <span class="hljs-comment">/**
     * The entries in this hash map extend WeakReference, using
     * its main ref field as the key (which is always a
     * ThreadLocal object).  Note that null keys (i.e. entry.get()
     * == null) mean that the key is no longer referenced, so the
     * entry can be expunged from table.  Such entries are referred to
     * as "stale entries" in the code that follows.
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; {
        <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span>
        Object value;

        Entry(ThreadLocal&lt;?&gt; k, Object v) {
            <span class="hljs-built_in">super</span>(k);
            value = v;
        }
    }
    ....
}    
</code></pre>
<h4 data-id="heading-8">B. è§£å†³æ–¹æ¡ˆ</h4>
<p>ä¸ºäº†é¿å…å†…å­˜æ³„éœ²ï¼Œ<strong>ä½¿ç”¨å®Œ <code>ThreadLocal</code> åï¼ŒåŠ¡å¿…è°ƒç”¨ <code>ThreadLocal.remove()</code> æ–¹æ³•æ‰‹åŠ¨æ¸…é™¤å­˜å‚¨åœ¨ Map ä¸­çš„ Valueã€‚</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²</span>
<span class="hljs-keyword">val</span> localData = ThreadLocal&lt;HeavyObject&gt;()
localData.<span class="hljs-keyword">set</span>(HeavyObject()) 
<span class="hljs-comment">// ... ä½¿ç”¨ localData ...</span>
<span class="hljs-comment">// å¿˜è®°è°ƒç”¨ remove()</span>

<span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼š</span>
<span class="hljs-keyword">val</span> localData = ThreadLocal&lt;HeavyObject&gt;()
<span class="hljs-keyword">try</span> {
    localData.<span class="hljs-keyword">set</span>(HeavyObject()) 
    <span class="hljs-comment">// ... ä½¿ç”¨ localData ...</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// ä¿è¯åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ‰§è¡Œæ¸…é™¤æ“ä½œ</span>
    localData.remove() 
}
</code></pre>
<h3 data-id="heading-9">0x04. æ€»ç»“</h3>
<ul>
<li><strong>ä½œç”¨ï¼š</strong> ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ç°çº¿ç¨‹å®‰å…¨ã€‚</li>
<li><strong>åŸç†ï¼š</strong> æ•°æ®å­˜å‚¨åœ¨æ¯ä¸ªçº¿ç¨‹å†…éƒ¨çš„ <code>ThreadLocalMap</code> ä¸­ã€‚</li>
<li><strong>åº”ç”¨ï¼š</strong> Android ä¸­ç”¨äºå®ç° <code>Looper</code> çš„çº¿ç¨‹å†…å•ä¾‹ã€‚</li>
<li><strong>é£é™©ï¼š</strong> å¿…é¡»è°ƒç”¨ <code>remove()</code>ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ pnpm + Workspaces æ„å»º Monorepo çš„å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7583970267132821510</link>    <guid>https://juejin.cn/post/7583970267132821510</guid>    <pubDate>2025-12-16T02:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132821510" data-draft-id="7583980250733232191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ pnpm + Workspaces æ„å»º Monorepo çš„å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T02:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ pnpm + Workspaces æ„å»º Monorepo çš„å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:05:01.000Z" title="Tue Dec 16 2025 02:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼špnpm Workspace</h2>
<p>pnpm å†…ç½®äº†å¯¹ Monorepoï¼ˆå•ä¸€ä»£ç ä»“åº“ï¼‰çš„åŸç”Ÿæ”¯æŒï¼Œé€šè¿‡ <strong>Workspaceï¼ˆå·¥ä½œåŒºï¼‰</strong> â€‹ æœºåˆ¶å®ç°ã€‚Workspace å…è®¸ä½ åœ¨ä¸€ä¸ªä»“åº“ä¸­ç®¡ç†å¤šä¸ªç›¸äº’å…³è”ä½†ç‹¬ç«‹çš„é¡¹ç›®ï¼ˆåŒ…ï¼‰ï¼Œå¹¶æ™ºèƒ½åœ°å¤„ç†å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<h2 data-id="heading-1">äºŒã€å°†æ™®é€šä»“åº“è½¬å˜ä¸º Monorepo çš„æ­¥éª¤</h2>
<h3 data-id="heading-2">æ­¥éª¤ 1ï¼šåˆå§‹åŒ–é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-monorepo
cd <span class="hljs-keyword">my</span>-monorepo

<span class="hljs-comment"># åˆå§‹åŒ–æ ¹ç›®å½• package.json</span>
pnpm init
</code></pre>
<h3 data-id="heading-3">æ­¥éª¤ 2ï¼šé…ç½®æ ¹ç›®å½• package.json</h3>
<p>ä¿®æ”¹æ ¹ç›®å½•çš„ <code>package.json</code>ï¼Œå…³é”®é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-monorepo"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-regexp">//</span> å¿…é¡»è®¾ç½®ä¸º <span class="hljs-literal">true</span>ï¼Œé¿å…è¯¯å‘å¸ƒåˆ° npm
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"pnpm -r run dev"</span>,      <span class="hljs-regexp">//</span> -r è¡¨ç¤ºé€’å½’æ‰§è¡Œæ‰€æœ‰å­åŒ…
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"pnpm -r run build"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"pnpm -r run test"</span>
  },
  <span class="hljs-string">"keywords"</span>: [],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>
}
</code></pre>
<p><strong>é‡è¦è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>"private": true</code>æ˜¯å¿…é¡»çš„ï¼Œç¡®ä¿æ•´ä¸ª Monorepo ä¸ä¼šè¢«æ„å¤–å‘å¸ƒ</li>
<li>å¯ä»¥ç§»é™¤ <code>main</code>ã€<code>test</code>ç­‰å­—æ®µï¼Œå› ä¸ºæ ¹ç›®å½•é€šå¸¸ä¸åŒ…å«ä¸šåŠ¡ä»£ç </li>
</ul>
<h3 data-id="heading-4">æ­¥éª¤ 3ï¼šåˆ›å»º pnpm-workspace.yaml é…ç½®æ–‡ä»¶</h3>
<p>åœ¨æ ¹ç›®å½•åˆ›å»º <code>pnpm-workspace.yaml</code>æ–‡ä»¶ï¼Œè¿™æ˜¯ pnpm Workspace çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  <span class="hljs-comment"># packages ç›®å½•ä¸‹çš„æ‰€æœ‰ç›´æ¥å­ç›®å½•</span>
  - <span class="hljs-string">'packages/*'</span>
  
  <span class="hljs-comment"># apps ç›®å½•ä¸‹çš„æ‰€æœ‰ç›´æ¥å­ç›®å½•</span>
  - <span class="hljs-string">'apps/*'</span>
  
  <span class="hljs-comment"># components ç›®å½•ä¸‹çš„æ‰€æœ‰å±‚çº§å­ç›®å½•</span>
  - <span class="hljs-string">'components/**'</span>
  
  <span class="hljs-comment"># æ’é™¤åŒ…å« test çš„ç›®å½•</span>
  - <span class="hljs-string">'!**/test/**'</span>
</code></pre>
<p><strong>é…ç½®è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>packages/*</code>ï¼šåŒ¹é… <code>packages</code>ç›®å½•ä¸‹çš„æ‰€æœ‰ä¸€çº§å­ç›®å½•</li>
<li><code>apps/*</code>ï¼šåŒ¹é… <code>apps</code>ç›®å½•ä¸‹çš„æ‰€æœ‰ä¸€çº§å­ç›®å½•</li>
<li><code>components/**</code>ï¼šåŒ¹é… <code>components</code>ç›®å½•ä¸‹çš„æ‰€æœ‰å±‚çº§å­ç›®å½•</li>
<li><code>!**/test/**</code>ï¼šæ’é™¤æ‰€æœ‰åŒ…å« <code>test</code>çš„ç›®å½•</li>
</ul>
<p>pnpm ä¸­çš„ä¸¤ç§é…ç½®æ–¹å¼</p>
<h4 data-id="heading-5">æ–¹å¼ä¸€ï¼šä½¿ç”¨ <code>package.json</code>çš„ <code>workspaces</code>å­—æ®µ</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"apps/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-6">æ–¹å¼äºŒï¼šä½¿ç”¨ <code>pnpm-workspace.yaml</code>æ–‡ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># æ’é™¤åŒ…å« test çš„ç›®å½•</span>
</code></pre>
<h4 data-id="heading-7">ä¸¤ç§æ–¹å¼çš„ä¼˜å…ˆçº§ä¸å…¼å®¹æ€§</h4>
<ol>
<li>
<p><strong>pnpm çš„è¯»å–é¡ºåº</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆè¯»å– <code>pnpm-workspace.yaml</code></li>
<li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¯»å– <code>package.json</code>ä¸­çš„ <code>workspaces</code>å­—æ®µ</li>
<li>å¦‚æœä¸¤è€…éƒ½å­˜åœ¨ï¼Œ<strong><code>pnpm-workspace.yaml</code>ä¼˜å…ˆçº§æ›´é«˜</strong>â€‹</li>
</ul>
</li>
<li>
<p><strong>æ¨èä½¿ç”¨ <code>pnpm-workspace.yaml</code>çš„åŸå› </strong>ï¼š</p>
<ul>
<li><strong>æ›´ä¸°å¯Œçš„é…ç½®é€‰é¡¹</strong>ï¼šæ”¯æŒæ’é™¤æ¨¡å¼ï¼ˆ<code>!**/test/**</code>ï¼‰</li>
<li><strong>æ›´å¥½çš„å¯è¯»æ€§</strong>ï¼šYAML æ ¼å¼æ›´é€‚åˆå¤æ‚é…ç½®</li>
<li><strong>å·¥å…·å…¼å®¹æ€§</strong>ï¼šæ˜ç¡®æ ‡è¯†ä¸º pnpm å·¥ä½œåŒº</li>
<li><strong>æœªæ¥æ‰©å±•æ€§</strong>ï¼špnpm çš„æ–°åŠŸèƒ½ä¼šä¼˜å…ˆåœ¨ YAML é…ç½®ä¸­æ”¯æŒ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">æ­¥éª¤ 4ï¼šåˆ›å»ºå­é¡¹ç›®ç»“æ„</h3>
<p>å…¸å‹çš„ Monorepo ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">my-monorepo/
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-<span class="hljs-keyword">lock</span>.yaml
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared-utils/     <span class="hljs-meta"># å…±äº«å·¥å…·åº“</span>
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”œâ”€â”€ ui-components/    <span class="hljs-meta"># UI ç»„ä»¶åº“</span>
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ src/
â”‚   â””â”€â”€ core-lib/         <span class="hljs-meta"># æ ¸å¿ƒåº“</span>
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ src/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web-app/          <span class="hljs-meta"># å‰ç«¯åº”ç”¨</span>
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ src/
â”‚   â””â”€â”€ mobile-app/       <span class="hljs-meta"># ç§»åŠ¨åº”ç”¨</span>
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ src/
â””â”€â”€ docs/                 <span class="hljs-meta"># æ–‡æ¡£</span>
</code></pre>
<h3 data-id="heading-9">æ­¥éª¤ 5ï¼šé…ç½®å­é¡¹ç›®çš„ package.json</h3>
<p>æ¯ä¸ªå­é¡¹ç›®éƒ½éœ€è¦æœ‰è‡ªå·±çš„ <code>package.json</code>ï¼Œå…³é”®é…ç½®å¦‚ä¸‹ï¼š <strong>ç¤ºä¾‹ï¼šå…±äº«å·¥å…·åº“ (packages/shared-utils/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@my-monorepo/shared-utils"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/index.d.ts"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc"</span>,
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"tsc --watch"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šå‰ç«¯åº”ç”¨ (apps/web-app/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"web-app"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"preview"</span>: <span class="hljs-string">"vite preview"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,  <span class="hljs-regexp">//</span> å…³é”®ï¼šå¼•ç”¨æœ¬åœ°åŒ…
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"@types/react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-10">ä¸‰ã€å…³é”®é…ç½®è¯¦è§£</h2>
<h3 data-id="heading-11">1. workspace:* åè®®</h3>
<p>è¿™æ˜¯ pnpm Workspace çš„æ ¸å¿ƒç‰¹æ€§ï¼Œç”¨äºå£°æ˜å¯¹æœ¬åœ°å…¶ä»–åŒ…çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,      <span class="hljs-regexp">//</span> ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:^1.0.0"</span>, <span class="hljs-regexp">//</span> æŒ‡å®šç‰ˆæœ¬èŒƒå›´
    <span class="hljs-string">"@my-monorepo/core-lib"</span>: <span class="hljs-string">"workspace:../packages/core-lib"</span> // ç›¸å¯¹è·¯å¾„
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å»ºç«‹æœ¬åœ°åŒ…ä¹‹é—´çš„è½¯é“¾æ¥ï¼Œæ— éœ€å‘å¸ƒåˆ° npm</li>
<li>ä¿®æ”¹æœ¬åœ°åŒ…æ—¶ï¼Œä¾èµ–å®ƒçš„é¡¹ç›®èƒ½ç«‹å³çœ‹åˆ°å˜åŒ–</li>
<li>ç¡®ä¿æ‰€æœ‰åŒ…ä½¿ç”¨åŒä¸€ä»½ä¾èµ–ï¼Œé¿å…é‡å¤å®‰è£…</li>
</ul>
<h3 data-id="heading-12">2. ä¾èµ–å®‰è£…ä¸ç®¡ç†</h3>
<h4 data-id="heading-13">åœ¨æ ¹ç›®å½•å®‰è£…å…¨å±€ä¾èµ–ï¼ˆæ‰€æœ‰åŒ…å…±äº«ï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># å®‰è£…åˆ°æ ¹ç›®å½•ï¼Œæ‰€æœ‰åŒ…å…±äº«</span>
pnpm <span class="hljs-keyword">add</span> typescript -w
<span class="hljs-meta"># æˆ–</span>
pnpm <span class="hljs-keyword">add</span> typescript --workspace-root
</code></pre>
<h4 data-id="heading-14">ä¸ºç‰¹å®šåŒ…å®‰è£…ä¾èµ–</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># ä¸º web-app å®‰è£… react</span>
pnpm <span class="hljs-keyword">add</span> react --filter web-app
<span class="hljs-meta"># æˆ–</span>
pnpm <span class="hljs-keyword">add</span> react -F web-app

<span class="hljs-meta"># ä¸ºå¤šä¸ªåŒ…å®‰è£…ä¾èµ–</span>
pnpm <span class="hljs-keyword">add</span> axios --filter <span class="hljs-string">"web-app"</span> --filter <span class="hljs-string">"mobile-app"</span>
</code></pre>
<h4 data-id="heading-15">å®‰è£…æœ¬åœ°åŒ…ä¾èµ–</h4>
<pre><code class="hljs language-sql" lang="sql"># åœ¨ web<span class="hljs-operator">-</span>app ä¸­å®‰è£… shared<span class="hljs-operator">-</span>utils
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>monorepo<span class="hljs-operator">/</span>shared<span class="hljs-operator">-</span>utils <span class="hljs-comment">--filter web-app</span>
</code></pre>
<h3 data-id="heading-16">3. è„šæœ¬æ‰§è¡Œ</h3>
<h4 data-id="heading-17">åœ¨æ‰€æœ‰åŒ…ä¸­æ‰§è¡Œç›¸åŒè„šæœ¬</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é€’å½’æ‰§è¡Œæ‰€æœ‰åŒ…çš„ build è„šæœ¬</span>
pnpm -r run build

<span class="hljs-comment"># é€’å½’æ‰§è¡Œæ‰€æœ‰åŒ…çš„ test è„šæœ¬</span>
pnpm -r run <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-18">åœ¨ç‰¹å®šåŒ…ä¸­æ‰§è¡Œè„šæœ¬</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä»…åœ¨ web-app ä¸­æ‰§è¡Œ dev è„šæœ¬</span>
pnpm --filter web-app run dev

<span class="hljs-comment"># ä½¿ç”¨åŒ…åï¼ˆpackage.json ä¸­çš„ nameï¼‰</span>
pnpm -F @my-monorepo/shared-utils run build
</code></pre>
<h2 data-id="heading-19">å››ã€å®Œæ•´ç¤ºä¾‹ï¼šVue é¡¹ç›® Monorepo</h2>
<h3 data-id="heading-20">é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-lua" lang="lua">vue-monorepo/
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ <span class="hljs-built_in">package</span>.json
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui-lib/          # UI ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ <span class="hljs-built_in">package</span>.json
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ vite.<span class="hljs-built_in">config</span>.ts
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°åº“
â”‚       â”œâ”€â”€ <span class="hljs-built_in">package</span>.json
â”‚       â””â”€â”€ src/
â””â”€â”€ apps/
    â”œâ”€â”€ admin/           # åå°ç®¡ç†ç³»ç»Ÿ
    â”‚   â”œâ”€â”€ <span class="hljs-built_in">package</span>.json
    â”‚   â””â”€â”€ src/
    â””â”€â”€ portal/          # é—¨æˆ·ç½‘ç«™
        â”œâ”€â”€ <span class="hljs-built_in">package</span>.json
        â””â”€â”€ src/
</code></pre>
<h3 data-id="heading-21">pnpm-workspace.yaml</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">packages:</span>
  - <span class="hljs-comment">'packages/*'</span>
  - <span class="hljs-comment">'apps/*'</span>
</code></pre>
<h3 data-id="heading-22">æ ¹ç›®å½• package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run lint"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-23">åŒ…é—´ä¾èµ–ç¤ºä¾‹ (apps/admin/package.json)</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@vue-monorepo/ui-lib"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"@vue-monorepo/utils"</span>: <span class="hljs-string">"workspace:*"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-24">äº”ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-25">1. å‘½åè§„èŒƒ</h3>
<ul>
<li>æ ¹é¡¹ç›®ï¼šä½¿ç”¨é¡¹ç›®æ€»åç§°ï¼Œå¦‚ <code>my-monorepo</code></li>
<li>å­åŒ…ï¼šä½¿ç”¨ä½œç”¨åŸŸåç§°ï¼Œå¦‚ <code>@my-monorepo/ui-components</code></li>
<li>åº”ç”¨ï¼šä½¿ç”¨æè¿°æ€§åç§°ï¼Œå¦‚ <code>web-app</code>ã€<code>admin-console</code></li>
</ul>
<h3 data-id="heading-26">2. ä¾èµ–ç®¡ç†</h3>
<ul>
<li>å…¬å…±ä¾èµ–ï¼ˆå¦‚ TypeScriptã€ESLintï¼‰å®‰è£…åœ¨æ ¹ç›®å½•</li>
<li>ä¸šåŠ¡ä¾èµ–å®‰è£…åœ¨å„è‡ªåŒ…ä¸­</li>
<li>ä½¿ç”¨ <code>pnpm-lock.yaml</code>ç¡®ä¿ä¾èµ–ä¸€è‡´æ€§</li>
</ul>
<h3 data-id="heading-27">3. ç‰ˆæœ¬æ§åˆ¶</h3>
<ul>
<li>æäº¤ <code>pnpm-lock.yaml</code>åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</li>
<li>è€ƒè™‘ä½¿ç”¨ Changesets æˆ– Lerna è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒ</li>
</ul>
<h3 data-id="heading-28">4. æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li>pnpm ä½¿ç”¨ç¡¬é“¾æ¥å’Œç¬¦å·é“¾æ¥ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´</li>
<li>æ‰€æœ‰åŒ…å…±äº«åŒä¸€ä»½ä¾èµ–ï¼Œå®‰è£…é€Ÿåº¦å¿«</li>
<li>æ”¯æŒè¿‡æ»¤å‘½ä»¤ï¼Œåªæ„å»ºéœ€è¦çš„åŒ…</li>
</ul>
<h3 data-id="heading-29">5. CI/CD é›†æˆ</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions ç¤ºä¾‹</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-30">å…­ã€å¸¸è§é—®é¢˜è§£å†³</h2>
<h3 data-id="heading-31">1. å¹½çµä¾èµ–é—®é¢˜</h3>
<p>ç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½åœ¨ <code>package.json</code>ä¸­æ˜ç¡®å£°æ˜ï¼Œé¿å…ç›´æ¥å¼•ç”¨ <code>node_modules</code>ä¸­çš„æœªå£°æ˜åŒ…ã€‚</p>
<h3 data-id="heading-32">2. å¾ªç¯ä¾èµ–æ£€æµ‹</h3>
<p>ä½¿ç”¨ <code>pnpm why &lt;package-name&gt;</code>æ£€æŸ¥ä¾èµ–å…³ç³»ï¼Œé¿å…åŒ…ä¹‹é—´çš„å¾ªç¯ä¾èµ–ã€‚</p>
<h3 data-id="heading-33">3. åŒ…æ‰¾ä¸åˆ°é”™è¯¯</h3>
<p>å¦‚æœå‡ºç° <code>no matches found</code>é”™è¯¯ï¼Œæ£€æŸ¥ï¼š</p>
<ul>
<li>åŒ…åæ˜¯å¦æ­£ç¡®ï¼ˆåŒ…æ‹¬ä½œç”¨åŸŸï¼‰</li>
<li>åŒ…æ˜¯å¦åœ¨ <code>pnpm-workspace.yaml</code>é…ç½®çš„ç›®å½•ä¸­</li>
<li>åŒ…æ˜¯å¦æœ‰æ­£ç¡®çš„ <code>name</code>å­—æ®µ</li>
</ul>
<h3 data-id="heading-34">4. è·¨åŒ…ç±»å‹å¼•ç”¨</h3>
<p>å¯¹äº TypeScript é¡¹ç›®ï¼Œé…ç½® <code>tsconfig.json</code>ä¸­çš„ <code>paths</code>ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@my-monorepo/*"</span>: [<span class="hljs-string">"packages/*/src"</span>]
    }
  }
}
</code></pre>
<h2 data-id="heading-35">æ€»ç»“</h2>
<p>é€šè¿‡ pnpm + Workspaces æ„å»º Monorepo çš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>ä¾èµ–å…±äº«</strong>ï¼šæ‰€æœ‰åŒ…å…±äº«åŒä¸€ä»½ä¾èµ–ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´å’Œå®‰è£…æ—¶é—´</li>
<li><strong>åŸå­æäº¤</strong>ï¼šè·¨åŒ…å˜æ›´å¯ä»¥ä¸€æ¬¡æ€§æäº¤ï¼Œä¿æŒä¸€è‡´æ€§</li>
<li><strong>æœ¬åœ°é“¾æ¥</strong>ï¼šä½¿ç”¨ <code>workspace:*</code>åè®®ï¼Œæœ¬åœ°å¼€å‘æ— éœ€å‘å¸ƒåˆ° npm</li>
<li><strong>ç²¾ç»†æ§åˆ¶</strong>ï¼šæ”¯æŒæŒ‰åŒ…è¿‡æ»¤çš„å‘½ä»¤æ‰§è¡Œ</li>
<li><strong>ç»Ÿä¸€ç®¡ç†</strong>ï¼šé›†ä¸­çš„ CI/CD å’Œä»£ç è´¨é‡æ£€æŸ¥</li>
</ol>
<p>è¿™ç§æ¶æ„ç‰¹åˆ«é€‚åˆä¸­å¤§å‹é¡¹ç›®ã€å¾®å‰ç«¯æ¶æ„ã€ç»„ä»¶åº“å¼€å‘ç­‰åœºæ™¯ï¼Œèƒ½æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç å¤ç”¨æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ¯ Rect ä¸­é¼ æ ‡ç§»åŠ¨æ‹¾å–å…ƒç´ å¯è¡Œæ€§æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7583952017674190899</link>    <guid>https://juejin.cn/post/7583952017674190899</guid>    <pubDate>2025-12-16T01:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674190899" data-draft-id="7583933107689701439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ¯ Rect ä¸­é¼ æ ‡ç§»åŠ¨æ‹¾å–å…ƒç´ å¯è¡Œæ€§æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„,React.js"/> <meta itemprop="datePublished" content="2025-12-16T01:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ¯ Rect ä¸­é¼ æ ‡ç§»åŠ¨æ‹¾å–å…ƒç´ å¯è¡Œæ€§æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:46:15.000Z" title="Tue Dec 16 2025 01:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ§  ä¸€ã€èƒŒæ™¯ï¼šä»€ä¹ˆæ˜¯æ‹¾å–ï¼ˆPickingï¼‰ï¼Ÿ</h2>
<p>â€œæ‹¾å–â€æ˜¯æŒ‡<strong>ä»ç”¨æˆ·äº¤äº’çš„äºŒç»´è¾“å…¥ï¼ˆé¼ æ ‡ã€è§¦æ§ï¼‰æ˜ å°„åˆ°å›¾å½¢å¯¹è±¡</strong>çš„è¿‡ç¨‹ã€‚</p>
<p>æƒ³è±¡ä½ åœ¨ä¸€ä¸ªå¯è§†åŒ–ç¼–è¾‘å™¨ä¸­ç§»åŠ¨é¼ æ ‡æŒ‡é’ˆâ€”â€”å½“å…‰æ ‡æ‚¬æµ®åœ¨æŸä¸ªçŸ©å½¢ï¼ˆRectï¼‰ä¸Šï¼Œå®ƒé«˜äº®ã€å˜è‰²ã€æç¤ºâ€œæˆ‘è¢«é€‰ä¸­äº†â€ï¼Œè¿™å°±æ˜¯ <em>æ‹¾å–ç³»ç»Ÿ</em> åœ¨èƒŒåæ–½å±•é­”æ³•ã€‚âœ¨</p>
<p>åœ¨äºŒç»´åœºæ™¯ä¸­ï¼Œæ‹¾å–æ–¹æ¡ˆé€šå¸¸åˆ†ä¸‰ç±»ï¼š</p>





























<table><thead><tr><th>æ¨¡å¼</th><th>åŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å‡ ä½•æ‹¾å–</td><td>åœ¨é€»è¾‘å±‚åˆ¤æ–­ <code>(x,y)</code> ä¸å„å¯¹è±¡è¾¹ç•Œå…³ç³»</td><td>ç²¾ç¡®ã€è½»é‡</td><td>å¤§é‡å…ƒç´ æ—¶è€—æ€§èƒ½</td></tr><tr><td>GPUé¢œè‰²æ‹¾å–ï¼ˆColor Pickingï¼‰</td><td>æ¯ä¸ªå¯¹è±¡æ¸²æŸ“å”¯ä¸€é¢œè‰²ï¼Œå¯¹é¼ æ ‡ç‚¹å–è‰²</td><td>å‡†ç¡®ã€ç‹¬ç«‹äºå½¢çŠ¶å¤æ‚åº¦</td><td>éœ€é¢å¤–æ¸²æŸ“ç¼“å†²åŒº</td></tr><tr><td>ç©ºé—´ç´¢å¼•æ‹¾å–ï¼ˆQuadTree / BVHï¼‰</td><td>å»ºç«‹ç©ºé—´æ•°æ®ç»“æ„åŠ é€Ÿå‘½ä¸­æŸ¥æ‰¾</td><td>é«˜æ•ˆã€å¯æ‰©å±•</td><td>å®ç°å¤æ‚åº¦é«˜</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">ğŸ”¬ äºŒã€å¯è¡Œæ€§æ¶æ„æ ¸å¿ƒè¦ç‚¹</h2>
<h3 data-id="heading-2">ï¼ˆ1ï¼‰æ•°æ®å±‚ï¼šç»“æ„åŒ–ç®¡ç† Rect å…ƒç´ </h3>
<p>é¦–å…ˆè¦æœ‰â€œ<strong>å¯ç´¢å¼•ã€å¯å¿«é€Ÿå‘½ä¸­</strong>â€çš„æ•°æ®ç»“æ„ã€‚<br/>
å‡è®¾æ¯ä¸ªçŸ©å½¢å…ƒç´ éƒ½æœ‰å¦‚ä¸‹å±æ€§ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rect</span> {
  <span class="hljs-keyword">constructor</span>(id, x, y, width, height) {
    <span class="hljs-keyword">this</span>.id = id;
    <span class="hljs-keyword">this</span>.bounds = { x, y, width, height };
    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">"normal"</span>; <span class="hljs-comment">// normal, hover, selected</span>
  }

  contains(px, py) {
    <span class="hljs-keyword">return</span> (
      px &gt;= <span class="hljs-keyword">this</span>.bounds.x &amp;&amp;
      px &lt;= <span class="hljs-keyword">this</span>.bounds.x + <span class="hljs-keyword">this</span>.bounds.width &amp;&amp;
      py &gt;= <span class="hljs-keyword">this</span>.bounds.y &amp;&amp;
      py &lt;= <span class="hljs-keyword">this</span>.bounds.y + <span class="hljs-keyword">this</span>.bounds.height
    );
  }
}
</code></pre>
<p>åœ¨å°è§„æ¨¡ä¸‹ï¼Œæˆ‘ä»¬å¯ç›´æ¥çº¿æ€§æ‰«æï¼Œä½†åœ¨æ•°åƒä¸ªRectåœºæ™¯ä¸­ï¼Œè¿™ä¼šè®©GPUå“­æ³£ ğŸ˜­ã€‚</p>
<hr/>
<h3 data-id="heading-3">ï¼ˆ2ï¼‰ç©ºé—´å±‚ï¼šåŒºåŸŸåŠ é€Ÿç»“æ„è®¾è®¡</h3>
<p>ä¸ºè§£å†³æ€§èƒ½é—®é¢˜ï¼Œå¯å¼•å…¥ <strong>QuadTreeï¼ˆå››å‰æ ‘ï¼‰</strong> è¿›è¡Œç©ºé—´åˆ’åˆ†ã€‚</p>
<p><strong>åŸç†</strong>ï¼š</p>
<ul>
<li>å°†ç”»å¸ƒå¹³é¢é€’å½’åˆ’åˆ†ä¸ºå››ä¸ªè±¡é™ï¼Œæ¯ä¸ªè±¡é™å­˜å‚¨çŸ©å½¢å¯¹è±¡é›†åˆã€‚</li>
<li>é¼ æ ‡ç§»åŠ¨æ—¶ï¼ŒåªæŸ¥è¯¢å½“å‰è±¡é™èŠ‚ç‚¹ã€‚</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼ŒæŸ¥è¯¢å¤æ‚åº¦ï¼šå¹³å‡ O(log n)ã€‚</li>
</ul>
<p>ä¼ªä»£ç æ¼”ç¤ºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadTree</span> {
  <span class="hljs-keyword">constructor</span>(boundary, capacity) {
    <span class="hljs-keyword">this</span>.boundary = boundary;  <span class="hljs-comment">// å½“å‰èŠ‚ç‚¹çŸ©å½¢åŒºåŸŸ</span>
    <span class="hljs-keyword">this</span>.capacity = capacity;  <span class="hljs-comment">// ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šçš„å…ƒç´ æ•°</span>
    <span class="hljs-keyword">this</span>.rects = [];
    <span class="hljs-keyword">this</span>.divided = <span class="hljs-literal">false</span>;
  }

  insert(rect) { <span class="hljs-comment">/* ...æ ¹æ®è¾¹ç•Œåˆ†è£‚æ’å…¥é€»è¾‘... */</span> }

  query(point) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.boundary.contains(point)) <span class="hljs-keyword">return</span> [];
    let found = [];
    <span class="hljs-keyword">for</span> (let r of <span class="hljs-keyword">this</span>.rects) {
      <span class="hljs-keyword">if</span> (r.contains(point.x, point.y)) found.push(r);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.divided) {
      found.push(...<span class="hljs-keyword">this</span>.northwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.northeast.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southeast.query(point));
    }
    <span class="hljs-keyword">return</span> found;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">ï¼ˆ3ï¼‰äº‹ä»¶å±‚ï¼šé¼ æ ‡ç§»åŠ¨æ‹¾å–æµé€»è¾‘</h3>
<p>æ ¸å¿ƒé€»è¾‘æ¶æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">mousemove
   â†“
æ‹¾å–ç®¡ç†å™¨ (PickManager)
   â†“
ç©ºé—´æŸ¥è¯¢ (QuadTree.query)
   â†“
æ£€æµ‹å‘½ä¸­å¯¹è±¡ (Rect.contains)
   â†“
çŠ¶æ€åŒæ­¥ (hover / leave / select)
   â†“
æ¸²æŸ“å±‚é‡æ–°ç»˜åˆ¶ç›®æ ‡åŒºåŸŸ
</code></pre>
<p>å®Œæ•´ç®€åŒ–å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">canvas.addEventListener("mousemove", (e) =&gt; {
  const <span class="hljs-attr">mouse</span> = { x: e.<span class="hljs-literal">off</span>setX, y: e.<span class="hljs-literal">off</span>setY }<span class="hljs-comment">;</span>
  const <span class="hljs-attr">hitRects</span> = quadTree.query(mouse)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">newHover</span> = hitRects[<span class="hljs-number">0</span>] || null<span class="hljs-comment">;</span>
  if (currentHover !== newHover) {
    if (currentHover) <span class="hljs-attr">currentHover.state</span> = <span class="hljs-string">"normal"</span><span class="hljs-comment">;</span>
    if (newHover) <span class="hljs-attr">newHover.state</span> = <span class="hljs-string">"hover"</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">currentHover</span> = newHover<span class="hljs-comment">;</span>
    render()<span class="hljs-comment">; // å±€éƒ¨æˆ–å…¨å±€é‡ç»˜</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š</p>
<ul>
<li>âœ… <strong>å®æ—¶æ‹¾å–</strong></li>
<li>âœ… <strong>é«˜æ•ˆåŒºåŸŸæŸ¥è¯¢</strong></li>
<li>âœ… <strong>çŠ¶æ€åˆ†ç¦»ä¸æ¸²æŸ“è§£è€¦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-5">ï¼ˆ4ï¼‰æ¸²æŸ“å±‚ï¼šCanvas / WebGL æ··åˆä¼˜åŒ–</h3>
<p>å¯¹äº Canvas 2D åœºæ™¯ï¼Œé€šå¸¸ç›´æ¥ redrawã€‚<br/>
å¯¹äºå¤æ‚ WebGL åœºæ™¯ï¼Œå¯é‡‡ç”¨åŒé€šé“ï¼š</p>
<ol>
<li>ä¸»é€šé“ç»˜åˆ¶å¯è§†å†…å®¹ï¼›</li>
<li>æ‹¾å–é€šé“ï¼ˆoff-screen bufferï¼‰ç»˜åˆ¶å”¯ä¸€é¢œè‰² IDï¼›</li>
<li>é¼ æ ‡äº‹ä»¶æ—¶ï¼Œé€šè¿‡ <code>gl.readPixels</code> è·å–ç‚¹å‡»åƒç´ é¢œè‰² -&gt; åæŸ¥å¯¹è±¡ IDã€‚</li>
</ol>
<p>è¿™ç§æ–¹æ¡ˆåœ¨å¤§å‹äº¤äº’å¼å›¾å½¢ç³»ç»Ÿï¼ˆå¦‚ Mapboxã€Three.jsï¼‰ä¸­ç”¨é€”æå¹¿ã€‚ğŸŒ</p>
<hr/>
<h2 data-id="heading-6">ğŸ§© ä¸‰ã€æ€§èƒ½å¯è¡Œæ€§åˆ†æ</h2>



































<table><thead><tr><th align="left">æŒ‡æ ‡</th><th align="left">å‡ ä½•æ‹¾å–</th><th align="left">å››å‰æ ‘åŠ é€Ÿ</th><th align="left">GPUé¢œè‰²æ‹¾å–</th></tr></thead><tbody><tr><td align="left">æŸ¥è¯¢å¤æ‚åº¦</td><td align="left">O(n)</td><td align="left">O(log n)</td><td align="left">O(1)</td></tr><tr><td align="left">æ¸²æŸ“æ€§èƒ½</td><td align="left">é«˜CPUå ç”¨</td><td align="left">ä¸­ç­‰</td><td align="left">é«˜GPUå¼€é”€</td></tr><tr><td align="left">å»¶è¿Ÿ</td><td align="left">æä½</td><td align="left">ä½</td><td align="left">å–å†³äºé¢œè‰²ç¼“å†²åŒæ­¥</td></tr><tr><td align="left">é€‚ç”¨åœºæ™¯</td><td align="left">å°‘é‡å¯¹è±¡</td><td align="left">å¤§é‡çŸ©å½¢å…ƒç´ </td><td align="left">å¤æ‚åœºæ™¯ï¼ˆ3D/WebGLï¼‰</td></tr></tbody></table>
<p>ç»“è®ºï¼š</p>
<blockquote>
<p>âœ… å¯¹äº Web ç«¯äºŒç»´ Rect ç¼–è¾‘å™¨æˆ–è®¾è®¡å·¥å…·ï¼Œ<strong>QuadTree + å‡ ä½•æ‹¾å–æ··åˆæ–¹æ¡ˆ</strong> æ˜¯å¯è¡Œä¸”ä¼˜é›…çš„æ¶æ„é€‰æ‹©ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">âš™ï¸ å››ã€å·¥ç¨‹ä¼˜åŒ–å»ºè®® ğŸ§ª</h2>
<ol>
<li><strong>äº‹ä»¶èŠ‚æµï¼ˆthrottleï¼‰</strong><br/>
é¿å…æ¯æ¬¡ <code>mousemove</code> éƒ½è§¦å‘å®Œæ•´æŸ¥è¯¢ï¼Œå¯åœ¨ 16msï¼ˆçº¦60Hzï¼‰èŠ‚æµæ‰§è¡Œã€‚</li>
<li><strong>å±€éƒ¨é‡ç»˜ï¼ˆDirty Rectï¼‰</strong><br/>
åªé‡ç»˜çŠ¶æ€å˜åŒ–åŒºåŸŸï¼Œæå‡æ¸²æŸ“æ€§èƒ½ã€‚</li>
<li><strong>å‘½ä¸­ç¼“å­˜ï¼ˆHover Cacheï¼‰</strong><br/>
è‹¥è¿ç»­å¤šå¸§å‘½ä¸­åŒä¸€å…ƒç´ ï¼Œä¸é‡å¤æŸ¥è¯¢ï¼Œé™ä½å¼€é”€ã€‚</li>
<li><strong>äº¤äº’ä¼˜å…ˆçº§åˆ†å±‚</strong><br/>
é’ˆå¯¹UIå±‚ã€å›¾å½¢å±‚åˆ†åˆ«æ‹¾å–ï¼ŒæŒ‰z-indexæ’åºå‘½ä¸­ç»“æœã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-8">ğŸª¶ äº”ã€å“²å­¦å±‚å°ç»“ï¼šæ‹¾å–ï¼Œä¸åªæ˜¯æ‹¾å–</h2>
<p>â€œæ‹¾å–â€çœ‹ä¼¼ä¸€ä¸ªè®¡ç®—å‡ ä½•é—®é¢˜ï¼Œå®åˆ™æ˜¯ä¸€æ¬¡<strong>äººä¸ç©ºé—´çš„æ˜ å°„å…³ç³»é‡å»º</strong>ã€‚</p>
<p>å½“ä½ ä»ä¸€å—å¹³é¢ä¸­ç²¾å‡†æ•æ‰ä¸€ä¸ªçŸ©å½¢ï¼ŒèƒŒåæ˜¯ï¼š</p>
<ul>
<li>ä¸€é¢—QuadTreeåœ¨é£é€Ÿåˆ¤æ–­åŒºå—ï¼›</li>
<li>ä¸€æ¬¡GPUåœ¨è‰²å½©ä¸–ç•Œç¼–ç IDï¼›</li>
<li>ä¸€ä»½äººæœºäº¤äº’çš„é»˜å¥‘åœ¨é—ªå…‰ã€‚</li>
</ul>
<blockquote>
<p>å·¥ç¨‹çš„æµªæ¼«ï¼Œè—åœ¨æ¯ä¸€æ¬¡ <code>mousemove</code> ä¸­ã€‚ğŸ’«</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">ğŸ§­ æ€»ç»“</h2>






























<table><thead><tr><th>æ¨¡å—</th><th>å…³é”®æŠ€æœ¯</th><th>å·¥ç¨‹è¦ç‚¹</th></tr></thead><tbody><tr><td>æ•°æ®å±‚</td><td>Rect å¯¹è±¡ç»“æ„åŒ–</td><td>å®šä¹‰è¾¹ç•Œä¸çŠ¶æ€</td></tr><tr><td>ç©ºé—´å±‚</td><td>QuadTree or ç½‘æ ¼åˆ’åˆ†</td><td>åŠ é€ŸæŸ¥è¯¢æ€§èƒ½</td></tr><tr><td>äº‹ä»¶å±‚</td><td>MouseMove + çŠ¶æ€æœº</td><td>å¤„ç† hover/leave</td></tr><tr><td>æ¸²æŸ“å±‚</td><td>å±€éƒ¨åˆ·æ–° / GPUè§£ç </td><td>å¹³è¡¡æ€§èƒ½å’Œå‡†ç¡®æ€§</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyi-vue2é›†æˆDMNè§„åˆ™å¼•æ“å®ç°Dishå‡ºé¤å†³ç­–]]></title>    <link>https://juejin.cn/post/7583983152324247578</link>    <guid>https://juejin.cn/post/7583983152324247578</guid>    <pubDate>2025-12-16T04:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152324247578" data-draft-id="7584014975242059786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyi-vue2é›†æˆDMNè§„åˆ™å¼•æ“å®ç°Dishå‡ºé¤å†³ç­–"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-16T04:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç æ¬¡ä½é¢"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyi-vue2é›†æˆDMNè§„åˆ™å¼•æ“å®ç°Dishå‡ºé¤å†³ç­–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç æ¬¡ä½é¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:43:11.000Z" title="Tue Dec 16 2025 04:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>DMNå†³ç­–å¼•æ“çš„æ ¸å¿ƒä»·å€¼åœ¨äºå°†å¤æ‚çš„ä¸šåŠ¡å†³ç­–é€»è¾‘ä»ç¨‹åºä»£ç ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„æ¨¡å‹è¿›è¡Œå¯è§†åŒ–ç®¡ç†å’Œæ‰§è¡Œã€‚å®ƒåœ¨å®æˆ˜ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é¢‘ç¹è°ƒæ•´ä¸šåŠ¡è§„åˆ™ã€è¿½æ±‚æµç¨‹è‡ªåŠ¨åŒ–ä¸æ™ºèƒ½åŒ–çš„åœºæ™¯ä¸­ã€‚<br/>
å…·ä½“åº”ç”¨åœºæ™¯æœ‰:
<strong>é‡‘èä¸é£æ§</strong>â€‹: ä¿¡è´·å®¡æ‰¹ã€é‡‘èé£é™©è¯„ä¼°ã€åæ´—é’±æ£€æŸ¥ã€
<strong>ä¾›åº”é“¾ä¸ç”Ÿäº§â€‹</strong>: ä¿é™©å®šä»·ã€ä¾›åº”é“¾ç®¡ç†ã€ç”Ÿäº§è°ƒåº¦
<strong>è¥é”€ä¸å®¢æˆ·æœåŠ¡â€‹</strong>: å®¢æˆ·åˆ†ç¾¤ã€ç²¾å‡†è¥é”€
<strong>å…¶ä»–åˆ›æ–°åœºæ™¯â€‹</strong>: æ•™è‚²åˆ†ç­ã€æ™ºèƒ½é¤é¥®</p>
<p>ä»Šå¤©æˆ‘ä»¬ä»¥ä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">æ™ºèƒ½é¤é¥®</a>æ¥è®²è§£å®æˆ˜ä¸­çš„ç”¨æ³•ã€‚</p>
<h3 data-id="heading-1">å†³ç­–è§„åˆ™</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895052af95564d8eb2271ef4c89a6d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=3JR18VYKX7I108Jf45SMZ1JZ%2Fxo%3D" alt="dmn-dish.png" loading="lazy"/>
è¯·ç‚¹å‡»è¿™ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">Dish</a>æŸ¥è¯¢è§„åˆ™å»ºæ¨¡ï¼Œä»¥ä¸‹æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹è¿™ä¸ªDMNè§„åˆ™è¡¨çš„å«ä¹‰ã€‚</p>
<pre><code class="hljs language-text" lang="text">è¿™ä¸ªDishå†³ç­–è¡¨è§„åˆ™æ˜¯æ ¹æ®å½“å‰çš„æ°”æ¸©(tempeature)å’Œæ—¥æœŸç±»å‹(dayType)å†³ç­–ä¸Šä»€ä¹ˆé¤é£Ÿã€‚ä¸»è¦æœ‰ä¸‰ä¸ªå†³ç­–è¡¨æ„æˆï¼Œ æ ¸å¿ƒæ˜¯Dish-Decisionè¡¨ã€‚
Season Dicisionå’ŒGuest Count ä»¥è¾“å‡ºç»“æœä¼ é€’ç»™Dish Decisionå†³ç­–è¡¨ã€‚

Season Dicisionè§„åˆ™æè¿°:
tempeature&gt;30, å¾—åˆ°season: Summary
tempeature&lt;10, å¾—åˆ°season: Winter
tempeature=[10..30] å¾—åˆ°season: Spring

Guest Countè§„åˆ™æè¿°:
dayType="Weekday",  å®¢äººæ•°é‡(guestCount): 4 
dayType="Holiday",  å®¢äººæ•°é‡(guestCount): 10
dayType="Weekend",  å®¢äººæ•°é‡(guestCount): 15


Dish-Decisionè§„åˆ™æè¿°: 
season=winter, guestCount&lt;=8, desiredDish='Spareribs'
season=winter, guestCount&gt;8, desiredDish='Pasta'
season=Summer, guestCount&gt;10, desiredDish='Light salad'
season=Summer, guestCount&lt;=10, desiredDish='Beans salad'
season=Spring, guestCount&lt;10, desiredDish='Stew'
season=Spring, guestCount&gt;=10, desiredDish='Steak'

</code></pre>
<h3 data-id="heading-2">æµç¨‹å»ºæ¨¡</h3>
<ul>
<li>éœ€æ±‚æè¿°</li>
</ul>
<pre><code class="hljs language-text" lang="text">æˆ‘ä»¬ç°åœ¨æ¨¡æ‹Ÿä¸€ä¸ªæµç¨‹ï¼Œ ç”¨æˆ·è¾“å…¥å½“å¤©çš„æ°”æ¸©å’Œæ—¥æœŸç±»å‹(å·¥ä½œæ—¥ï¼Œå‡æœŸï¼Œå‘¨æœ«)ï¼Œ ç³»ç»Ÿå†³ç­–æä¾›ä»€ä¹ˆç±»å‹çš„é¤é£Ÿã€‚
</code></pre>
<ul>
<li>æ¨¡å‹ç»“æ„</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b5e4bba9b64ed3a2d5ba644641d5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=HGn2I1TjLQywUdfRu%2F5VzkKOv%2Bg%3D" alt="dmn-model.png" loading="lazy"/></p>
<ul>
<li>æ¨¡å‹å®šä¹‰</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bpmn:definitions</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:bpmn</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:dc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:camunda</span>=<span class="hljs-string">"http://camunda.org/schema/1.0/bpmn"</span> <span class="hljs-attr">xmlns:di</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Definitions_1"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://bpmn.io/schema/bpmn"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Process_8887"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å‡ºé¤å†³ç­–"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_1i7sxll"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:startEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1rzb9vm"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Event_1i7sxll"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å°±é¤ä¿¡æ¯"</span> <span class="hljs-attr">camunda:assignee</span>=<span class="hljs-string">"${startUser}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formData</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temperature"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ°”æ¸©"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"long"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dayType"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ—¥æœŸ"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">camunda:formData</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:userTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0v0zyja"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_08c0387"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:businessRuleTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å†³ç­–è§„åˆ™"</span> <span class="hljs-attr">camunda:resultVariable</span>=<span class="hljs-string">"desiredDish"</span> <span class="hljs-attr">camunda:decisionRef</span>=<span class="hljs-string">"dish-decision"</span> <span class="hljs-attr">camunda:mapDecisionResult</span>=<span class="hljs-string">"singleEntry"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:businessRuleTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1ajvk92"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"å‡ºé¤ç¨‹åº"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${dishTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0x2ftot"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:endEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0r2ykge"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Event_0x2ftot"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:process</span>&gt;</span>
  
<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:definitions</span>&gt;</span>

</code></pre>
<ul>
<li>è¿è¡Œç»“æœ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b57d32b97c49bab66cb8ed12b30c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=0Npis5NkpVMvANRwGD7kQ7tUMYo%3D" alt="dmn-demo.png" loading="lazy"/></p>
<pre><code class="hljs language-text" lang="text">è¿è¡Œç»“æœè§£é‡Šï¼š
ç”¨æˆ·è¾“å…¥çš„æ°”æ¸©15åº¦ï¼Œæ ¹æ®Season Dicisionå¯ä»¥å¾—åˆ°æ˜¯=Spring
ç”¨æˆ·è¾“å…¥çš„æ—¥æœŸç±»å‹weekday, æ ¹æ®Guest Countå¯ä»¥å¾—åˆ°å®¢äººæ•°é‡=4

æ ¹æ®season=spring, guestCount=4ï¼Œæ ¹æ®Dish Decisionå¯ä»¥å¾—åˆ°=stew 

å®Œå…¨ç¬¦åˆé¢„æœŸï¼
</code></pre>
<p>è®¿é—®<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">è‹¥ä¾å·¥ä½œæµ</a>ç‚¹å‡»é¡¶éƒ¨ï¼Œæ¼”ç¤ºç³»ç»Ÿç«‹å³ä½“éªŒ!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VS Code 1.107 æ›´æ–°ï¼šå¤šæ™ºèƒ½ä½“ååŒä¸å¼€å‘ä½“éªŒå‡çº§]]></title>    <link>https://juejin.cn/post/7584307642999537707</link>    <guid>https://juejin.cn/post/7584307642999537707</guid>    <pubDate>2025-12-16T11:13:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584307642999537707" data-draft-id="7584287969214070803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VS Code 1.107 æ›´æ–°ï¼šå¤šæ™ºèƒ½ä½“ååŒä¸å¼€å‘ä½“éªŒå‡çº§"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-16T11:13:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VS Code 1.107 æ›´æ–°ï¼šå¤šæ™ºèƒ½ä½“ååŒä¸å¼€å‘ä½“éªŒå‡çº§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:13:08.000Z" title="Tue Dec 16 2025 11:13:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 å¹´ 12 æœˆ 10 æ—¥ï¼Œå¾®è½¯æ­£å¼å‘å¸ƒäº† VS Code 1.107 ç‰ˆæœ¬ï¼Œè¿™æ¬¡æ›´æ–°å ªç§°å¹´åº¦æœ€é‡ç£…ï¼<strong>å¤šæ™ºèƒ½ä½“ååŒå¼€å‘</strong>æˆä¸ºæ ¸å¿ƒäº®ç‚¹ï¼Œå½»åº•é‡æ„äº†å¼€å‘è€…ä¸ AI åä½œçš„æ¨¡å¼ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å¯ä»¥åŒæ—¶éƒ¨ç½²å¤šä¸ª AI åŠ©æ‰‹åˆ†å·¥åˆä½œï¼šä¸€ä¸ªè´Ÿè´£ä»£ç å®¡æŸ¥ï¼Œä¸€ä¸ªå¤„ç†å•å…ƒæµ‹è¯•ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ¨åå°é»˜é»˜é‡æ„ legacy ä»£ç â€”â€”è¿™ä¸å†æ˜¯ç§‘å¹»åœºæ™¯ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d52455df60c84e1f86b5d74f160b2dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=eNiPuTrnir8zmc9yYe7V5ZexRlY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">å¤šæ™ºèƒ½ä½“ååŒï¼šå¼€å‘æ•ˆç‡çš„é©å‘½æ€§çªç ´</h2>
<h3 data-id="heading-1">Agent HQï¼šä½ çš„ AI å›¢é˜ŸæŒ‡æŒ¥ä¸­å¿ƒ</h3>
<p>VS Code 1.107 å¼•å…¥äº†å…¨æ–°çš„ <strong>Agent HQ</strong> æ¦‚å¿µï¼Œå°†æ‰€æœ‰æ™ºèƒ½ä½“ç»Ÿä¸€ç®¡ç†ã€‚ç°åœ¨ï¼ŒGitHub Copilot ä¸å†æ˜¯å­¤å†›å¥‹æˆ˜ï¼Œä½ å¯ä»¥åˆ›å»ºã€é…ç½®å¤šä¸ªè‡ªå®šä¹‰æ™ºèƒ½ä½“ï¼Œå¹¶è®©å®ƒä»¬ååŒå®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<p>æœ€æƒŠè‰³çš„æ˜¯ <strong>ä¼šè¯ç®¡ç†åŠŸèƒ½</strong>ï¼æ‰€æœ‰æ™ºèƒ½ä½“ä¼šè¯éƒ½æ•´åˆåˆ°èŠå¤©è§†å›¾ä¸­ï¼Œä½ èƒ½ä¸€ç›®äº†ç„¶åœ°çœ‹åˆ°æ¯ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€è¿›åº¦å’Œæ–‡ä»¶æ›´æ”¹ç»Ÿè®¡ã€‚å³é”®ç‚¹å‡»ä¼šè¯ï¼Œè¿˜èƒ½é€‰æ‹©åœ¨ç¼–è¾‘å™¨æ ‡ç­¾é¡µæˆ–æ–°çª—å£ä¸­æ‰“å¼€ï¼Œçµæ´»åº¦æ‹‰æ»¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cf7048587a944f4871619e7940eb0db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=3yONxuXphV23qvW%2F%2FInRYHVFjNo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">èƒŒæ™¯æ™ºèƒ½ä½“ï¼šè®© AI åœ¨åå°é»˜é»˜å¹²æ´»</h3>
<p><strong>èƒŒæ™¯æ™ºèƒ½ä½“</strong> å½»åº•æ”¹å˜äº†å·¥ä½œæµï¼ä»¥å‰ç”¨ Copilot æ—¶ï¼Œä½ å¿…é¡»ç­‰å¾…å®ƒå®Œæˆå½“å‰ä»»åŠ¡æ‰èƒ½ç»§ç»­å·¥ä½œã€‚ç°åœ¨ï¼Œåªéœ€ç‚¹å‡» <strong>Continue in</strong> æŒ‰é’®ï¼Œå°±èƒ½å°†ä»»åŠ¡æ— ç¼è½¬ç§»åˆ°åå°æ™ºèƒ½ä½“ï¼Œè‡ªå·±ç»§ç»­ä¸“æ³¨äºå…¶ä»–ç¼–ç å·¥ä½œã€‚</p>
<p>æ›´å‰å®³çš„æ˜¯ <strong>Git å·¥ä½œæ ‘éš”ç¦»</strong> æŠ€æœ¯ï¼æ¯ä¸ªèƒŒæ™¯æ™ºèƒ½ä½“éƒ½èƒ½åœ¨ç‹¬ç«‹çš„ Git å·¥ä½œæ ‘ä¸­è¿è¡Œï¼Œå¤šä¸ªæ™ºèƒ½ä½“åŒæ—¶ä¿®æ”¹ä»£ç ä¹Ÿä¸ä¼šå†²çªã€‚å®Œæˆåï¼Œä½ å¯ä»¥ä¸€é”®å°†æ›´æ”¹åˆå¹¶å›ä¸»å·¥ä½œåŒºï¼Œç®€ç›´æ˜¯å¤šä»»åŠ¡å¤„ç†çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/597edcc556e942c685e12af746a53c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=ley2Th5PgZStx67vL9F2T8YHUWA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">ç»„ç»‡çº§æ™ºèƒ½ä½“å…±äº«ï¼šå›¢é˜Ÿåä½œæ–°èŒƒå¼</h3>
<p>å¯¹äºä¼ä¸šç”¨æˆ·ï¼Œ1.107 ç‰ˆæœ¬å¸¦æ¥äº† <strong>ç»„ç»‡çº§æ™ºèƒ½ä½“å…±äº«</strong>ï¼ˆå®éªŒæ€§åŠŸèƒ½ï¼‰ã€‚ç®¡ç†å‘˜å¯ä»¥åœ¨ GitHub ç»„ç»‡çº§åˆ«å®šä¹‰æ™ºèƒ½ä½“ï¼Œå›¢é˜Ÿæˆå‘˜æ— éœ€æ‰‹åŠ¨å¯¼å…¥å°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚å¯ç”¨æ–¹æ³•å¾ˆç®€å•ï¼š</p>
<ul>
<li>æ‰“å¼€è®¾ç½® <code>github.copilot.chat.customAgents.showOrganizationAndEnterpriseAgents</code></li>
<li>å°†å…¶è®¾ä¸º <code>true</code></li>
</ul>
<p>ä»æ­¤ï¼Œå›¢é˜ŸçŸ¥è¯†åº“ã€ç¼–ç è§„èŒƒã€æœ€ä½³å®è·µéƒ½èƒ½é€šè¿‡è‡ªå®šä¹‰æ™ºèƒ½ä½“è½»æ¾ä¼ æ‰¿ï¼Œæ–°äººä¸Šæ‰‹é€Ÿåº¦è‡³å°‘æå‡ 50%ï¼</p>
<h2 data-id="heading-4">èŠå¤©ä½“éªŒå‡çº§ï¼šAI äº¤äº’æ›´è‡ªç„¶</h2>
<h3 data-id="heading-5">è¯­è¨€æ¨¡å‹ç®¡ç†ï¼šä¸€é”®åˆ‡æ¢ä½ çš„ "AI å¤§è„‘"</h3>
<p>é¢å¯¹è¶Šæ¥è¶Šå¤šçš„ AI æ¨¡å‹é€‰æ‹©ï¼ŒVS Code æ–°å¢äº† <strong>è¯­è¨€æ¨¡å‹ç¼–è¾‘å™¨</strong>ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ï¼š</p>
<ul>
<li>æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ¨¡å‹çš„èƒ½åŠ›ã€ä¸Šä¸‹æ–‡é•¿åº¦å’Œè®¡è´¹ä¿¡æ¯</li>
<li>æŒ‰æä¾›å•†ã€èƒ½åŠ›ï¼ˆå·¥å…·è°ƒç”¨ã€è§†è§‰ã€æ™ºèƒ½ä½“ï¼‰ç­›é€‰</li>
<li>éšè—ä¸å¸¸ç”¨æ¨¡å‹ï¼Œè®©ç•Œé¢æ›´æ¸…çˆ½</li>
</ul>
<p>åªéœ€æŒ‰ä¸‹ <code>Ctrl+Shift+P</code> å¹¶è¾“å…¥ <strong>Chat: Manage Language Models</strong>ï¼Œå°±èƒ½æ‰“å¼€è¿™ä¸ªå¼ºå¤§çš„ç®¡ç†ä¸­å¿ƒã€‚</p>
<h3 data-id="heading-6">åŠ¨æ€å†…å®¹æŠ“å–ï¼šè¿ SPA ç½‘ç«™ä¹Ÿèƒ½è½»æ¾è§£æ</h3>
<p><code>#fetch</code> å·¥å…·ç°åœ¨æ”¯æŒ <strong>åŠ¨æ€ç½‘é¡µå†…å®¹æŠ“å–</strong>ï¼æ— è®ºæ˜¯ Reactã€Vue æ„å»ºçš„å•é¡µåº”ç”¨ï¼Œè¿˜æ˜¯ Jira è¿™æ ·çš„åŠ¨æ€ç³»ç»Ÿï¼Œéƒ½èƒ½å‡†ç¡®è·å–å†…å®¹ã€‚AI ç°åœ¨èƒ½ç›´æ¥åˆ†æä½ å…¬å¸çš„å†…éƒ¨æ–‡æ¡£ç³»ç»Ÿï¼Œå›ç­”é—®é¢˜ä¸å†å±€é™äºæœ¬åœ°ä»£ç ï¼</p>
<h3 data-id="heading-7">æ•æ„Ÿæ–‡ä»¶ç¼–è¾‘ï¼šå®‰å…¨ä¸ä¾¿æ·çš„å®Œç¾å¹³è¡¡</h3>
<p>ä¿®æ”¹ <code>package.json</code> æˆ– <code>settings.json</code> è¿™ç±»æ•æ„Ÿæ–‡ä»¶æ—¶ï¼ŒVS Code ä¼šè‡ªåŠ¨æ˜¾ç¤º <strong>å·®å¼‚å¯¹æ¯”è§†å›¾</strong>ï¼Œè®©ä½ æ¸…æ™°çœ‹åˆ°æ¯ä¸€å¤„å˜æ›´ã€‚å†ä¹Ÿä¸ç”¨æ‹…å¿ƒ AI è¯¯æ”¹é…ç½®å¯¼è‡´é¡¹ç›®å´©æºƒäº†ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d09085ede19746aba3d4ca78bf7ac859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=Cl9QvjzYaYeW1hVQhVwlO93C3FQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">ç¼–è¾‘å™¨ä½“éªŒä¼˜åŒ–ï¼šç»†èŠ‚ä¹‹å¤„è§çœŸç« </h2>
<h3 data-id="heading-9">æŒ‰éœ€æ‚¬åœæç¤ºï¼šå‘Šåˆ«å¹²æ‰°ï¼Œä¸“æ³¨ç¼–ç </h3>
<p>ç»ˆäºå¯ä»¥å‘Šåˆ«çƒ¦äººçš„è‡ªåŠ¨æ‚¬åœæç¤ºäº†ï¼åœ¨è®¾ç½®ä¸­å°† <code>editor.hover.enabled</code> è®¾ä¸º <code>onKeyboardModifier</code>ï¼Œæ‚¬åœä¿¡æ¯åªä¼šåœ¨æŒ‰ä½ç‰¹å®šä¿®é¥°é”®æ—¶æ‰æ˜¾ç¤ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>å¦‚æœå¤šå…‰æ ‡ä¿®é¥°é”®æ˜¯ <code>Ctrl/Cmd</code>ï¼Œåˆ™æŒ‰ä½ <code>Alt</code> æ˜¾ç¤ºæ‚¬åœ</li>
<li>å¦‚æœå¤šå…‰æ ‡ä¿®é¥°é”®æ˜¯ <code>Alt</code>ï¼Œåˆ™æŒ‰ä½ <code>Ctrl</code> æ˜¾ç¤ºæ‚¬åœ</li>
</ul>
<p>è¿™ä¸ªå°æ”¹è¿›ï¼Œå´èƒ½è®©ç¼–ç ä¸“æ³¨åº¦æå‡ä¸€ä¸ªæ¡£æ¬¡ï¼</p>
<h3 data-id="heading-10">TypeScript 7.0 é¢„è§ˆï¼šåŸç”Ÿé‡æ„ï¼Œæ€§èƒ½é£è·ƒ</h3>
<p>VS Code 1.107 å¸¦æ¥äº† <strong>TypeScript 7.0 é¢„è§ˆæ”¯æŒ</strong>ï¼è¿™ä¸ªå®Œå…¨ç”¨åŸç”Ÿä»£ç é‡å†™çš„ç‰ˆæœ¬ï¼Œæ€§èƒ½æå‡å ªç§°é©å‘½æ€§ã€‚ç›®å‰å·²æ”¯æŒè‡ªåŠ¨å¯¼å…¥ã€é‡å‘½åå’Œå¼•ç”¨ä»£ç é€é•œï¼Œå®‰è£… <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarketplace.visualstudio.com%2Fitems%3FitemName%3DTypeScriptTeam.native-preview" target="_blank" title="https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.native-preview" ref="nofollow noopener noreferrer">TypeScript (Native Preview)</a> æ‰©å±•å³å¯ä½“éªŒã€‚</p>
<p>æ ¹æ®å¾®è½¯å®˜æ–¹æ•°æ®ï¼ŒTypeScript 7.0 çš„ç±»å‹æ£€æŸ¥é€Ÿåº¦æ¯” 5.0 å¿« <strong>3-5 å€</strong>ï¼Œå¤§å‹é¡¹ç›®çš„ç¼–è¯‘æ—¶é—´å°†å¤§å¹…ç¼©çŸ­ï¼</p>
<h2 data-id="heading-11">ç»ˆç«¯å¢å¼ºï¼šå‘½ä»¤è¡Œæ•ˆç‡å€å¢</h2>
<h3 data-id="heading-12">ç»ˆç«¯è¾“å‡ºæ•è·ï¼šå†å²å‘½ä»¤éšæ—¶å›æº¯</h3>
<p>ç°åœ¨ï¼ŒèŠå¤©ä¸­çš„ç»ˆç«¯å‘½ä»¤è¾“å‡ºä¼šå®Œæ•´ä¿å­˜åœ¨ <code>xterm.js</code> ç»ˆç«¯ä¸­ï¼Œå³ä½¿ç»ˆç«¯å·²å…³é—­ä¹Ÿèƒ½éšæ—¶æŸ¥çœ‹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ï¼š</p>
<ul>
<li>å¯¹æ¯”ä¸åŒå‘½ä»¤çš„æ‰§è¡Œç»“æœ</li>
<li>è¿½æº¯æ™ºèƒ½ä½“è¿è¡Œçš„è„šæœ¬è¾“å‡º</li>
<li>åˆ†äº«å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ç»™åŒäº‹</li>
</ul>
<h3 data-id="heading-13">ä¸€é”®å…è®¸æ‰€æœ‰å‘½ä»¤ï¼šä¿¡ä»»æ™ºèƒ½ä½“ï¼Œè§£æ”¾åŒæ‰‹</h3>
<p>åœ¨èŠå¤©ä¸­è¿è¡Œç»ˆç«¯å‘½ä»¤æ—¶ï¼Œæ–°å¢äº† <strong>Allow All Commands in this Session</strong> é€‰é¡¹ã€‚å¯ç”¨åï¼Œå½“å‰ä¼šè¯ä¸­çš„æ‰€æœ‰ç»ˆç«¯å‘½ä»¤éƒ½ä¼šè‡ªåŠ¨æ‰¹å‡†ï¼Œæ— éœ€åå¤ç¡®è®¤ã€‚å¯¹äºä¿¡ä»»çš„æ™ºèƒ½ä½“ï¼Œè¿™èƒ½èŠ‚çœå¤§é‡äº¤äº’æ—¶é—´ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/101390277e4a45e084db64c5abb4fbba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=PHDwOisPS0GAyIAcTOLs9k4%2FqFM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-14">ä¼ä¸šçº§ç‰¹æ€§ï¼šå®‰å…¨ä¸ç®¡ç†å¹¶é‡</h2>
<h3 data-id="heading-15">æ™ºèƒ½ä½“å·¥å…·æƒé™æ§åˆ¶ï¼šç²¾ç»†ç®¡ç† AI èƒ½åŠ›</h3>
<p>ä¼ä¸šç®¡ç†å‘˜ç°åœ¨å¯ä»¥é€šè¿‡ <code>chat.tools.eligibleForAutoApproval</code> è®¾ç½®ï¼Œç²¾ç¡®æ§åˆ¶å“ªäº›æ™ºèƒ½ä½“å·¥å…·å…è®¸è‡ªåŠ¨æ‰¹å‡†ã€‚å¯¹äº <code>runTask</code> è¿™ç±»é«˜å±æ“ä½œï¼Œå¯ä»¥å¼ºåˆ¶è¦æ±‚äººå·¥ç¡®è®¤ï¼Œå®‰å…¨æ€§å¤§å¤§æå‡ï¼</p>
<h3 data-id="heading-16">GitHub ä¼ä¸šç­–ç•¥æ”¯æŒï¼šäº‘ç«¯å¼€å‘æ— ç¼è¡”æ¥</h3>
<p>ä½¿ç”¨ GitHub Codespaces çš„å›¢é˜Ÿï¼Œç°åœ¨èƒ½è‡ªåŠ¨åº”ç”¨ä¼ä¸šç­–ç•¥ã€‚æ— è®ºæ˜¯ MCP æ³¨å†Œè¡¨é…ç½®è¿˜æ˜¯æ™ºèƒ½ä½“æƒé™ï¼Œéƒ½èƒ½åœ¨äº‘ç«¯å¼€å‘ç¯å¢ƒä¸­ä¿æŒä¸€è‡´ï¼Œå¼€å‘ä½“éªŒæ— ç¼è¡”æ¥ã€‚</p>
<h2 data-id="heading-17">æ€»ç»“ï¼šAI é©±åŠ¨å¼€å‘çš„æœªæ¥å·²æ¥</h2>
<p>VS Code 1.107 ç‰ˆæœ¬é€šè¿‡ <strong>å¤šæ™ºèƒ½ä½“ååŒ</strong>ã€<strong>èƒŒæ™¯ä»»åŠ¡å¤„ç†</strong> å’Œ <strong>ç»„ç»‡çº§æ™ºèƒ½ä½“å…±äº«</strong>ï¼Œå°† AI è¾…åŠ©å¼€å‘æ¨å‘äº†æ–°é˜¶æ®µã€‚å®ƒä¸ä»…æ˜¯å·¥å…·çš„å‡çº§ï¼Œæ›´æ˜¯å¼€å‘èŒƒå¼çš„è½¬å˜â€”â€”ä» "å¼€å‘è€…ä½¿ç”¨ AI" åˆ° "å¼€å‘è€…æŒ‡æŒ¥ AI å›¢é˜Ÿ"ã€‚</p>
<p>æœ€ä»¤äººå…´å¥‹çš„æ˜¯ï¼Œè¿™ä»…ä»…æ˜¯å¼€å§‹ã€‚éšç€ TypeScript 7.0 çš„æˆç†Ÿå’Œæ›´å¤š AI èƒ½åŠ›çš„æ•´åˆï¼ŒVS Code æ­£åœ¨æœç€ "å¼€å‘è€…æ€ç»´æ”¾å¤§å™¨" çš„æ–¹å‘å¿«é€Ÿè¿›åŒ–ã€‚</p>
<p>ç«‹å³é€šè¿‡ <strong>å¸®åŠ© &gt; æ£€æŸ¥æ›´æ–°</strong> å‡çº§åˆ° 1.107 ç‰ˆæœ¬ï¼Œæˆ–è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2F" target="_blank" title="https://code.visualstudio.com/" ref="nofollow noopener noreferrer">VS Code å®˜ç½‘</a> ä¸‹è½½æœ€æ–°å®‰è£…åŒ…ï¼Œä½“éªŒè¿™åœºå¼€å‘æ•ˆç‡çš„é©å‘½ï¼</p>
<blockquote>
<p><strong>æç¤º</strong>ï¼šæƒ³æŠ¢å…ˆä½“éªŒæœªæ¥åŠŸèƒ½ï¼Ÿå¯ä»¥å®‰è£… <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Finsiders%2F" target="_blank" title="https://code.visualstudio.com/insiders/" ref="nofollow noopener noreferrer">Insiders ç‰ˆæœ¬</a>ï¼Œæ¯å¤©è·å–æœ€æ–°æ›´æ–°ï¼</p>
</blockquote>
<p>Happy Codingï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ™ºèƒ½å¼€å‘ç¯å¢ƒä¸‹çš„ Diagram-as-Code å®è·µï¼šMCP Mermaid æŠ€æœ¯é“¾è·¯æ‹†è§£]]></title>    <link>https://juejin.cn/post/7584094504630665225</link>    <guid>https://juejin.cn/post/7584094504630665225</guid>    <pubDate>2025-12-16T05:19:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584094504630665225" data-draft-id="7583991680749568027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ™ºèƒ½å¼€å‘ç¯å¢ƒä¸‹çš„ Diagram-as-Code å®è·µï¼šMCP Mermaid æŠ€æœ¯é“¾è·¯æ‹†è§£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-16T05:19:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Undoom"/> <meta itemprop="url" content="https://juejin.cn/user/4158824111150512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ™ºèƒ½å¼€å‘ç¯å¢ƒä¸‹çš„ Diagram-as-Code å®è·µï¼šMCP Mermaid æŠ€æœ¯é“¾è·¯æ‹†è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4158824111150512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Undoom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:19:07.000Z" title="Tue Dec 16 2025 05:19:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨è½¯ä»¶å·¥ç¨‹ã€ç³»ç»Ÿæ¶æ„è®¾è®¡ä»¥åŠæ—¥å¸¸çš„é¡¹ç›®ç®¡ç†ä¸­ï¼Œå›¾è¡¨ï¼ˆDiagramsï¼‰æ˜¯ä¿¡æ¯ä¼ é€’çš„æ ¸å¿ƒè½½ä½“ã€‚ä¼ ç»Ÿçš„ç»˜å›¾æ–¹å¼å¾€å¾€éœ€è¦å€ŸåŠ© Visioã€Draw.io ç­‰å›¾å½¢åŒ–å·¥å…·ï¼Œé€šè¿‡ç¹ççš„æ‹–æ‹½æ“ä½œæ¥å®Œæˆã€‚è€Œ Mermaid.js çš„å‡ºç°ï¼Œå°†â€œç»˜å›¾â€è½¬å˜ä¸ºâ€œç¼–å†™ä»£ç â€ï¼Œå®ç°äº†å›¾è¡¨çš„æ–‡æœ¬åŒ–ä¸ç‰ˆæœ¬æ§åˆ¶åŒ–ã€‚</p>
<p>éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å…´èµ·ï¼ŒModel Context Protocol (MCP) åº”è¿è€Œç”Ÿï¼Œå®ƒä½œä¸ºä¸€ç§é€šç”¨åè®®ï¼Œè¿æ¥äº† AI æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·ã€‚æœ¬æ–‡å°†è¯¦ç»†æ‹†è§£å¦‚ä½•åœ¨è“è€˜ï¼ˆLanyunï¼‰MCP å¹¿åœºä¸­è·å– Mermaid æœåŠ¡ï¼Œå¹¶å°†å…¶é›†æˆåˆ° Trae ç¼–è¾‘å™¨ä¸­ï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€æŒ‡ä»¤è‡ªåŠ¨ç”Ÿæˆä¸“ä¸šçš„ Mermaid å›¾è¡¨ä»£ç ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€é˜¶æ®µï¼šMCP æœåŠ¡çš„å‘ç°ä¸è·å–</h2>
<p>MCP åè®®çš„æ ¸å¿ƒåœ¨äºå°†å·¥å…·æ ‡å‡†åŒ–ã€‚åœ¨å¼€å§‹é›†æˆä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åœ¨æœåŠ¡ä¾›åº”å¹³å°æ‰¾åˆ°å¯¹åº”çš„å·¥å…·æ¨¡å—ã€‚</p>
<h3 data-id="heading-2">1.1 æœåŠ¡æœç´¢ä¸å®šä½</h3>
<p>åœ¨è“è€˜ MCP å¹¿åœºçš„æœç´¢ç•Œé¢ï¼Œé€šè¿‡è¾“å…¥å…³é”®è¯ <code>MCP Mermaid</code>ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°ç›®æ ‡å·¥å…·ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f13cf4ecc614c88a2a0462351efa870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=sScaZnF3S%2BJ3wC9ovFNoyHQ0vl4%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†æœç´¢ç»“æœé¡µé¢ã€‚å¯ä»¥çœ‹åˆ°ç•Œé¢ä¸­å¤®æ¸…æ™°åœ°åˆ—å‡ºäº†æœç´¢åˆ°çš„ <code>MCP Mermaid</code> å¡ç‰‡ã€‚è¿™ä¸€æ­¥æ˜¯æ•´ä¸ªæµç¨‹çš„èµ·ç‚¹ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªç»˜å›¾å·¥å…·ï¼Œè€Œæ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªå¯ä»¥è¢« AI è°ƒç”¨çš„æ ‡å‡†æ¥å£ï¼ˆInterfaceï¼‰ã€‚è¯¥å¡ç‰‡ä¸ä»…æ˜¾ç¤ºäº†åç§°ï¼Œé€šå¸¸è¿˜ä¼šåŒ…å«è¯¥å·¥å…·çš„ç‰ˆæœ¬ä¿¡æ¯ã€ç®€è¦æè¿°ä»¥åŠéƒ¨ç½²çŠ¶æ€ã€‚</p>
<h3 data-id="heading-3">1.2 æ‰˜ç®¡çŠ¶æ€ä¸é…ç½®ç”Ÿæˆ</h3>
<p>ç‚¹å‡»è¿›å…¥å·¥å…·è¯¦æƒ…é¡µåï¼Œä¼šå‘ç°è¯¥ MCP æœåŠ¡å‘ˆç°â€œæ‰˜ç®¡â€çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªå…³é”®çš„æŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f9e962f55d143b19b499a163f369f40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=wPzfgwEt4GrmeodgDqYYcO7ihMg%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç•Œé¢æ˜¾ç¤ºäº†â€œè¿™ä¸€æ¬¾ mcp å·²ç»è¢«è“è€˜ç»™æ‰˜ç®¡äº†â€çš„ä¿¡æ¯ã€‚åœ¨ä¼ ç»Ÿçš„ MCP éƒ¨ç½²ä¸­ï¼Œç”¨æˆ·é€šå¸¸éœ€è¦åœ¨æœ¬åœ°ç¯å¢ƒå®‰è£… Node.js æˆ– Python è¿è¡Œæ—¶ï¼Œå¹¶é€šè¿‡å‘½ä»¤è¡Œï¼ˆCLIï¼‰å¯åŠ¨æœåŠ¡ã€‚è€Œâ€œæ‰˜ç®¡â€æ„å‘³ç€æœåŠ¡è¿è¡Œåœ¨äº‘ç«¯æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·æ— éœ€æ¶ˆè€—æœ¬åœ°è®¡ç®—èµ„æºï¼Œä¹Ÿæ— éœ€å¤„ç†å¤æ‚çš„ä¾èµ–å®‰è£…é—®é¢˜ã€‚</p>
<p>ç•Œé¢å³ä¾§æä¾›äº†â€œç”Ÿæˆä½“éªŒçš„ json ä»£ç â€æŒ‰é’®ã€‚è¿™ä¸ª JSON é…ç½®æ–‡ä»¶æ˜¯è¿æ¥æœ¬åœ°ç¼–è¾‘å™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸äº‘ç«¯ MCP æœåŠ¡ï¼ˆæœåŠ¡ç«¯ï¼‰çš„å‡­è¯ã€‚</p>
<h3 data-id="heading-4">1.3 é…ç½®ä»£ç çš„å¯¹æ¯”ä¸é€‰æ‹©</h3>
<p>åœ¨é…ç½®ç¯èŠ‚ï¼Œé€šå¸¸å­˜åœ¨ä¸¤ç§æ¨¡å¼ï¼šæœ¬åœ°è¿è¡Œæ¨¡å¼å’Œè¿œç¨‹ SSE æ¨¡å¼ã€‚</p>
<p><strong>å®˜æ–¹æä¾›çš„æœ¬åœ°è¿è¡Œ JSON ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mcp-mermaid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"mcp-mermaid"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ®µä»£ç ä½¿ç”¨äº† <code>npx</code> å‘½ä»¤ï¼Œæ„å‘³ç€å®ƒä¾èµ–ç”¨æˆ·æœ¬åœ°çš„ npm ç¯å¢ƒæ¥åŠ¨æ€ä¸‹è½½å¹¶æ‰§è¡Œ <code>mcp-mermaid</code> åŒ…ã€‚è¿™ç§æ–¹å¼è™½ç„¶çµæ´»ï¼Œä½†è¦æ±‚æœ¬åœ°å…·å¤‡ç›¸åº”çš„å¼€å‘ç¯å¢ƒï¼Œä¸”å—é™äºæœ¬åœ°ç½‘ç»œçŠ¶å†µã€‚</p>
<p><strong>è“è€˜æä¾›çš„æ‰˜ç®¡ JSON ä»£ç ï¼ˆæ¨èï¼‰ï¼š</strong></p>
<p>ä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œæˆ‘ä»¬é€‰æ‹©è“è€˜æä¾›çš„åŸºäº SSEï¼ˆServer-Sent Eventsï¼‰çš„é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"MCP Mermaid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sse"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://d885cc9e62854df8b41f70b4caedd399.mcp.lanyun.net:8088/sse/MCP Mermaid"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294da1d190434d3eb678f344cbe83a18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=4oPD0ZeRa5wmvOqhdTE0wVRhGEg%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†å®é™…è·å–åˆ°çš„ JSON é…ç½®å—ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®å­—æ®µéœ€è¦è§£æï¼š</p>
<ol>
<li><strong><code>type</code>: "sse"</strong>ï¼šæŒ‡æ˜äº†é€šä¿¡åè®®é‡‡ç”¨ Server-Sent Eventsã€‚è¿™æ˜¯ä¸€ç§å…è®¸æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„ HTTP è¿æ¥æ–¹å¼ï¼Œéå¸¸é€‚åˆ LLM æµå¼è¾“å‡ºçš„åœºæ™¯ã€‚</li>
<li><strong><code>url</code></strong>ï¼šæŒ‡å‘äº†è“è€˜äº‘å¹³å°çš„å…·ä½“ç«¯å£ï¼ˆ8088ï¼‰å’Œè·¯å¾„ã€‚è¿™ä¸ª URL æ˜¯æœåŠ¡çš„å”¯ä¸€è®¿é—®å…¥å£ï¼ŒåŒ…å«äº†èº«ä»½éªŒè¯æˆ–ä¼šè¯æ ‡è¯†çš„å“ˆå¸Œå­—ç¬¦ä¸²ã€‚</li>
</ol>
<h2 data-id="heading-5">ç¬¬äºŒé˜¶æ®µï¼šTrae ç¼–è¾‘å™¨ä¸­çš„é›†æˆä¸é…ç½®</h2>
<p>è·å–é…ç½®ä¿¡æ¯åï¼Œä¸‹ä¸€æ­¥æ˜¯åœ¨å¼€å‘ç¯å¢ƒ Trae ä¸­è¿›è¡Œæ³¨å†Œã€‚Trae æ˜¯ä¸€æ¬¾æ”¯æŒ MCP åè®®çš„ç°ä»£ IDEï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æ‰©å±• AI çš„èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-6">2.1 æ‰‹åŠ¨æ·»åŠ  MCP æœåŠ¡</h3>
<p>æ‰“å¼€ Trae çš„è®¾ç½®æˆ–é…ç½®æ–‡ä»¶ç¼–è¾‘ç•Œé¢ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac863df8ae1441fea18aad3a1dc04ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=SeeEsZhFq2SXshlvWSCCiFCmzho%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”¨æˆ·å°†ä¹‹å‰å¤åˆ¶çš„ JSON ä»£ç å—ç²¾å‡†åœ°ç²˜è´´åˆ°äº† <code>mcpServers</code> å¯¹è±¡ä¸­ã€‚Trae ä¼šè¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œè§£æå‡ºæœåŠ¡çš„åç§°ï¼ˆMCP Mermaidï¼‰ã€ç±»å‹ï¼ˆsseï¼‰ä»¥åŠè¿æ¥åœ°å€ã€‚è¿™ä¸€æ­¥ç›¸å½“äºä¸º IDE å®‰è£…äº†ä¸€ä¸ªæ–°çš„â€œé©±åŠ¨ç¨‹åºâ€ï¼Œä½¿å…¶å…·å¤‡äº†ç”Ÿæˆå›¾è¡¨çš„èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-7">2.2 æœåŠ¡åŠ è½½çŠ¶æ€éªŒè¯</h3>
<p>é…ç½®ä¿å­˜åï¼ŒIDE ä¼šå°è¯•ä¸è¿œç¨‹æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c9147a410de4423bff69fe70b237020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=CG27N1N6YSUZP0UplCr73Cdo7SE%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†æœåŠ¡åŠ è½½æˆåŠŸçš„çŠ¶æ€ã€‚é€šå¸¸åœ¨ç•Œé¢ä¸Šä¼šæœ‰ä¸€ä¸ªæŒ‡ç¤ºç¯å˜ä¸ºç»¿è‰²ï¼Œæˆ–è€…æ˜¾ç¤ºâ€œConnectedâ€/â€œå·²è¿æ¥â€å­—æ ·ã€‚è¿™è¡¨æ˜ Trae å·²ç»æˆåŠŸé€šè¿‡ HTTP åè®®æ¡æ‰‹è¿æ¥åˆ°äº†è“è€˜æ‰˜ç®¡çš„ Mermaid æœåŠ¡ç«¯ï¼Œéšæ—¶å‡†å¤‡æ¥å—æŒ‡ä»¤ã€‚</p>
<h3 data-id="heading-8">2.3 åˆ›å»ºä¸“å±æ™ºèƒ½ä½“</h3>
<p>ä¸ºäº†æ›´å¥½åœ°ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºç»˜å›¾çš„æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab49bc311b84ea9806218c07d504df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=GTinXF4PesCSFAKwJrZuf%2BISxM8%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ä¸Šå›¾çš„æ“ä½œç•Œé¢ä¸­ï¼Œç”¨æˆ·å‹¾é€‰äº†åˆšåˆšæ·»åŠ çš„ <code>MCP Mermaid</code> æœåŠ¡ã€‚è¿™æ„å‘³ç€è¯¥æ™ºèƒ½ä½“åœ¨å¤„ç†ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæ‹¥æœ‰äº†è°ƒç”¨ Mermaid å·¥å…·çš„æƒé™ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å°†é€šç”¨çš„èŠå¤©åŠŸèƒ½ä¸ä¸“ä¸šçš„ç»˜å›¾åŠŸèƒ½è¿›è¡Œéš”ç¦»ï¼Œç¡®ä¿ç”Ÿæˆçš„ä»£ç æ›´åŠ çº¯ç²¹å’Œä¸“ä¸šã€‚</p>
<h2 data-id="heading-9">ç¬¬ä¸‰é˜¶æ®µï¼šæ ¸å¿ƒåœºæ™¯å®æˆ˜æµ‹è¯•</h2>
<p>ç¯å¢ƒæ­å»ºå®Œæ¯•åï¼Œè¿›å…¥æ ¸å¿ƒçš„å®æˆ˜æµ‹è¯•é˜¶æ®µã€‚æˆ‘ä»¬å°†é€šè¿‡äº”ä¸ªä¸åŒç»´åº¦çš„æµ‹è¯•ç”¨ä¾‹ï¼ŒéªŒè¯ AI å¦‚ä½•å°†è‡ªç„¶è¯­è¨€è½¬åŒ–ä¸ºæ ‡å‡†çš„ Mermaid è¯­æ³•ï¼Œå¹¶è§£ææ¯ä¸€ç±»å›¾è¡¨çš„ç»“æ„é€»è¾‘ã€‚</p>
<h3 data-id="heading-10">3.1 æµç¨‹å›¾ï¼ˆFlowchartï¼‰ï¼šé€»è¾‘åˆ¤æ–­ä¸è·¯å¾„æ§åˆ¶</h3>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼šç”¨æˆ·ç™»å½•ç³»ç»Ÿæµç¨‹ã€‚
<strong>è¾“å…¥æŒ‡ä»¤</strong>ï¼šâ€œè¯·å¸®æˆ‘ç”»ä¸€ä¸ªç”¨æˆ·ç™»å½•ç³»ç»Ÿçš„æµç¨‹å›¾ï¼šç”¨æˆ·è¾“å…¥è´¦å·å¯†ç  -&gt; ç³»ç»ŸéªŒè¯ã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œè·³è½¬é¦–é¡µï¼›å¦‚æœéªŒè¯å¤±è´¥ï¼Œæç¤ºé”™è¯¯å¹¶è¿”å›ç™»å½•é¡µã€‚â€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82e2c8a441094e96a5518809cce17a4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=KSocmNThb1kM%2F5xFnD9D9ZG%2BeNs%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº† Trae æ ¹æ®æŒ‡ä»¤ç”Ÿæˆçš„æµç¨‹å›¾é¢„è§ˆã€‚å¯ä»¥çœ‹åˆ°ï¼Œå›¾è¡¨æ¸…æ™°åœ°è¡¨è¾¾äº†æ¡ä»¶åˆ†æ”¯é€»è¾‘ã€‚</p>
<p><strong>ç”Ÿæˆçš„ä»£ç è§£æ</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD;
    A[ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç ] --&gt; B[ç³»ç»ŸéªŒè¯];
    B --&gt;|éªŒè¯æˆåŠŸ| C[è·³è½¬é¦–é¡µ];
    B --&gt;|éªŒè¯å¤±è´¥| D[æç¤ºé”™è¯¯å¹¶è¿”å›ç™»å½•é¡µ];
</code></pre>
<ul>
<li><strong><code>graph TD;</code></strong>ï¼šå£°æ˜è¿™æ˜¯ä¸€ä¸ªä»ä¸Šåˆ°ä¸‹ï¼ˆTop-Downï¼‰çš„å›¾è¡¨ã€‚</li>
<li><strong>èŠ‚ç‚¹å®šä¹‰</strong>ï¼š<code>A[...]</code> ä½¿ç”¨æ–¹æ‹¬å·å®šä¹‰äº†çŸ©å½¢èŠ‚ç‚¹ã€‚</li>
<li><strong>è¿æ¥çº¿</strong>ï¼š<code>--&gt;</code> è¡¨ç¤ºå¸¦ç®­å¤´çš„å®çº¿ã€‚</li>
<li><strong>æ¡ä»¶æ ‡æ³¨</strong>ï¼š<code>|éªŒè¯æˆåŠŸ|</code> æ˜¯è¿æ¥çº¿ä¸Šçš„æ–‡æœ¬æ ‡ç­¾ï¼Œæ¸…æ™°åœ°å±•ç¤ºäº†é€»è¾‘åˆ¤æ–­çš„ç»“æœå¯¼å‘ã€‚</li>
</ul>
<p>è¯¥å›¾è¡¨å‡†ç¡®åœ°æ•æ‰äº†ä¸šåŠ¡é€»è¾‘ä¸­çš„â€œé¡ºåºæ‰§è¡Œâ€ä¸â€œæ¡ä»¶åˆ†æ”¯â€ä¸¤ä¸ªæ ¸å¿ƒè¦ç´ ã€‚</p>
<h3 data-id="heading-11">3.2 æ—¶åºå›¾ï¼ˆSequence Diagramï¼‰ï¼šå¯¹è±¡äº¤äº’ä¸æ—¶é—´é¡ºåº</h3>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼šç½‘è´­ä¸‹å•å…¨è¿‡ç¨‹ã€‚
<strong>è¾“å…¥æŒ‡ä»¤</strong>ï¼šç”Ÿæˆä¸€ä¸ªç½‘è´­çš„æ—¶åºå›¾ã€‚å‚ä¸è€…åŒ…æ‹¬ç”¨æˆ·ã€å•†åŸå‰ç«¯ã€åç«¯APIã€æ”¯ä»˜ç½‘å…³ã€‚å±•ç¤ºç‚¹å‡»ä¸‹å•åˆ°è¿”å›ç»“æœçš„å…¨è¿‡ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba60e7d65e7d4da8a10de7e7b275cc39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=5EtCGgTDgGODxRMvwmTx8MddCXI%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å‘ˆç°äº†å„ä¸ªç³»ç»Ÿç»„ä»¶ä¹‹é—´çš„å‚ç›´ç”Ÿå‘½çº¿ä»¥åŠæ°´å¹³çš„æ¶ˆæ¯ä¼ é€’ã€‚è¿™ç§å›¾è¡¨å¯¹äºç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è°ƒç”¨é“¾è·¯è‡³å…³é‡è¦ã€‚</p>
<p><strong>ç”Ÿæˆçš„ä»£ç è§£æ</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant ç”¨æˆ·
    participant å•†åŸå‰ç«¯
    participant åç«¯API
    participant æ”¯ä»˜ç½‘å…³

    ç”¨æˆ·-&gt;&gt;å•†åŸå‰ç«¯: ç‚¹å‡»ä¸‹å•
    å•†åŸå‰ç«¯-&gt;&gt;åç«¯API: å‘èµ·ä¸‹å•è¯·æ±‚
    åç«¯API-&gt;&gt;æ”¯ä»˜ç½‘å…³: è°ƒç”¨æ”¯ä»˜æ¥å£
    æ”¯ä»˜ç½‘å…³--&gt;&gt;åç«¯API: è¿”å›æ”¯ä»˜æˆåŠŸç»“æœ
    åç«¯API--&gt;&gt;å•†åŸå‰ç«¯: è¿”å›ä¸‹å•æˆåŠŸç»“æœ
    å•†åŸå‰ç«¯--&gt;&gt;ç”¨æˆ·: æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸ
</code></pre>
<ul>
<li><strong><code>participant</code></strong>ï¼šæ˜¾å¼å£°æ˜äº†å‚ä¸äº¤äº’çš„å¯¹è±¡ï¼Œç¡®ä¿å®ƒä»¬åœ¨å›¾ä¸­æŒ‰é¡ºåºæ’åˆ—ã€‚</li>
<li><strong><code>-&gt;&gt;</code></strong>ï¼šå®çº¿ç®­å¤´ï¼Œè¡¨ç¤ºåŒæ­¥è¯·æ±‚æˆ–å¼‚æ­¥æ¶ˆæ¯çš„å‘é€ã€‚</li>
<li><strong><code>--&gt;&gt;</code></strong>ï¼šè™šçº¿ç®­å¤´ï¼Œè¡¨ç¤ºå“åº”æ¶ˆæ¯çš„è¿”å›ã€‚</li>
</ul>
<p>AI ç”Ÿæˆçš„ä»£ç å®Œç¾éµå¾ªäº†è¯·æ±‚-å“åº”ï¼ˆRequest-Responseï¼‰æ¨¡å¼ï¼Œæ¸…æ™°åœ°å±•ç¤ºäº†æ•°æ®æµå¦‚ä½•åœ¨å‰ç«¯ã€åç«¯ä¸ç¬¬ä¸‰æ–¹æœåŠ¡ä¹‹é—´æµè½¬ã€‚</p>
<h3 data-id="heading-12">3.3 ç”˜ç‰¹å›¾ï¼ˆGantt Chartï¼‰ï¼šé¡¹ç›®è¿›åº¦ä¸æ—¶é—´ç®¡ç†</h3>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼šä¸¤å‘¨å‘¨æœŸçš„é¡¹ç›®å¼€å‘è®¡åˆ’ã€‚
<strong>è¾“å…¥æŒ‡ä»¤</strong>ï¼šåŒ…å«éœ€æ±‚åˆ†æï¼ˆ2å¤©ï¼‰ã€åŸå‹è®¾è®¡ï¼ˆ2å¤©ï¼‰ã€ä»£ç å¼€å‘ï¼ˆ6å¤©ï¼‰ã€æµ‹è¯•ä¸ä¿®å¤ï¼ˆ3å¤©ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f666eee87e842b68b4d625a8683d85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=A94Ie7R%2BS5AsqlztyYQgmX0au0U%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†é¡¹ç›®çš„æ—¶é—´è½´è§†å›¾ã€‚ç”˜ç‰¹å›¾æ˜¯é¡¹ç›®ç»ç†è¿›è¡Œæ’æœŸå’Œèµ„æºå¯è§†åŒ–çš„é¦–é€‰å·¥å…·ã€‚</p>
<p><strong>ç”Ÿæˆçš„ä»£ç è§£æ</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title é¡¹ç›®å¼€å‘ç”˜ç‰¹å›¾
    dateFormat  YYYY-MM-DD
    section é¡¹ç›®é˜¶æ®µ
    éœ€æ±‚åˆ†æ       :done,    des1, 2025-12-07, 2d
    åŸå‹è®¾è®¡       :active,  des2, 2025-12-09, 2d
    ä»£ç å¼€å‘       :         des3, 2025-12-11, 6d
    æµ‹è¯•ä¸ä¿®å¤     :         des4, 2025-12-17, 3d
</code></pre>
<ul>
<li><strong><code>dateFormat</code></strong>ï¼šå®šä¹‰äº†æ—¥æœŸçš„è§£ææ ¼å¼ã€‚</li>
<li><strong><code>section</code></strong>ï¼šå°†ä»»åŠ¡åˆ†ç»„ï¼Œè¿™é‡Œç»Ÿä¸€åœ¨â€œé¡¹ç›®é˜¶æ®µâ€ä¸‹ã€‚</li>
<li><strong>ä»»åŠ¡çŠ¶æ€</strong>ï¼š<code>done</code> è¡¨ç¤ºå·²å®Œæˆï¼Œ<code>active</code> è¡¨ç¤ºè¿›è¡Œä¸­ï¼Œç©ºç™½è¡¨ç¤ºæœªå¼€å§‹ã€‚</li>
<li><strong>æ—¶é—´è·¨åº¦</strong>ï¼š<code>2d</code>ã€<code>6d</code> ç­‰åç¼€å‡†ç¡®å®šä¹‰äº†ä»»åŠ¡æŒç»­çš„æ—¶é•¿ã€‚</li>
</ul>
<p>Mermaid è‡ªåŠ¨è®¡ç®—äº†å„ä¸ªä»»åŠ¡çš„èµ·å§‹å’Œç»“æŸæ—¥æœŸï¼Œç›´è§‚åœ°åæ˜ äº†ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»ï¼ˆè™½ç„¶æ­¤ä¾‹ä¸­ä¸ºçº¿æ€§ä¾èµ–ï¼‰ã€‚</p>
<h3 data-id="heading-13">3.4 ç±»å›¾ï¼ˆClass Diagramï¼‰ï¼šé¢å‘å¯¹è±¡ç»“æ„è®¾è®¡</h3>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼šå­¦æ ¡ç®¡ç†ç³»ç»Ÿçš„æ•°æ®æ¨¡å‹ã€‚
<strong>è¾“å…¥æŒ‡ä»¤</strong>ï¼šåŒ…å«å­¦ç”Ÿã€è€å¸ˆã€è¯¾ç¨‹ä¸‰ä¸ªç±»ï¼Œå®šä¹‰å¤šå¯¹å¤šå’Œä¸€å¯¹å¤šå…³ç³»ï¼Œä»¥åŠåŸºæœ¬å±æ€§å’Œæ–¹æ³•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d66378386be249aaa7153e18f619f776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=WVgGfV6XRLq2Cc97Y7fd6jKCj1s%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†æ ‡å‡†çš„ UML ç±»å›¾ç»“æ„ã€‚æ¯ä¸ªçŸ©å½¢æ¡†ä»£è¡¨ä¸€ä¸ªç±»ï¼Œåˆ†ä¸ºç±»åã€å±æ€§ã€æ–¹æ³•ä¸‰å±‚ç»“æ„ã€‚</p>
<p><strong>ç”Ÿæˆçš„ä»£ç è§£æ</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class å­¦ç”Ÿ {
        +String å§“å
        +int å­¦å·
        +void æ³¨å†Œè¯¾ç¨‹()
        +void æŸ¥çœ‹è¯¾ç¨‹()
    }

    class è€å¸ˆ {
        +String å§“å
        +int å·¥å·
        +void æ·»åŠ è¯¾ç¨‹()
        +void æŸ¥çœ‹è¯¾ç¨‹()
    }

    class è¯¾ç¨‹ {
        +String è¯¾ç¨‹åç§°
        +String è¯¾ç¨‹ç¼–å·
        +void æ·»åŠ å­¦ç”Ÿ()
        +void æŸ¥çœ‹å­¦ç”Ÿ()
    }

    å­¦ç”Ÿ "*" -- "*" è¯¾ç¨‹ : é€‰ä¿®
    è€å¸ˆ "1" -- "*" è¯¾ç¨‹ : æ•™æˆ
</code></pre>
<ul>
<li><strong>å¯è§æ€§ä¿®é¥°ç¬¦</strong>ï¼š<code>+</code> è¡¨ç¤º Publicï¼ˆå…¬å¼€ï¼‰å±æ€§æˆ–æ–¹æ³•ã€‚</li>
<li><strong>æ•°æ®ç±»å‹</strong>ï¼šæ˜ç¡®æ ‡æ³¨äº† <code>String</code>ã€<code>int</code> ç­‰ç±»å‹ã€‚</li>
<li><strong>å…³ç³»åŸºæ•°</strong>ï¼š<code>"*"</code> ä»£è¡¨å¤šï¼ˆManyï¼‰ï¼Œ<code>"1"</code> ä»£è¡¨ä¸€ï¼ˆOneï¼‰ã€‚</li>
<li><strong>å…³è”æè¿°</strong>ï¼š<code>: é€‰ä¿®</code> å’Œ <code>: æ•™æˆ</code> å¯¹ç±»ä¹‹é—´çš„å…³ç³»è¿›è¡Œäº†è¯­ä¹‰åŒ–è¯´æ˜ã€‚</li>
</ul>
<p>è¿™å¼ å›¾ä¸ä»…å±•ç¤ºäº†é™æ€ç»“æ„ï¼Œè¿˜è§„èŒƒäº†ç³»ç»Ÿçš„ä¸šåŠ¡è§„åˆ™ï¼ˆä¾‹å¦‚ä¸€ä¸ªè€å¸ˆå¯ä»¥æ•™æˆå¤šé—¨è¯¾ç¨‹ï¼‰ã€‚</p>
<h3 data-id="heading-14">3.5 æ€ç»´å¯¼å›¾ï¼ˆMindmapï¼‰ï¼šçŸ¥è¯†ç»“æ„ä¸å‘æ•£æ€ç»´</h3>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼šäººå·¥æ™ºèƒ½å­¦ä¹ è·¯å¾„è§„åˆ’ã€‚
<strong>è¾“å…¥æŒ‡ä»¤</strong>ï¼šä¸­å¿ƒèŠ‚ç‚¹ AIï¼Œåˆ†æ”¯åŒ…å«æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€ç¼–ç¨‹è¯­è¨€ã€æ•°å­¦åŸºç¡€åŠå…¶å­èŠ‚ç‚¹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/768f1ec6b406480b845046e3c9da23c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=CNVJ7zNOrBk02XmGcA39%2Bmcv9dI%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸Šå›¾å±•ç¤ºäº†ä»¥ AI ä¸ºæ ¸å¿ƒçš„è¾å°„çŠ¶çŸ¥è¯†å›¾è°±ã€‚æ€ç»´å¯¼å›¾éå¸¸é€‚åˆç”¨äºå¤´è„‘é£æš´ã€çŸ¥è¯†æ¢³ç†å’Œå±‚çº§å±•ç¤ºã€‚</p>
<p><strong>ç”Ÿæˆçš„ä»£ç è§£æ</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
    root((AI))
        æœºå™¨å­¦ä¹ 
            ç›‘ç£å­¦ä¹ 
            æ— ç›‘ç£å­¦ä¹ 
        æ·±åº¦å­¦ä¹ 
            CNN
            RNN
            Transformer
        ç¼–ç¨‹è¯­è¨€
            Python
            C++
        æ•°å­¦åŸºç¡€
</code></pre>
<ul>
<li><strong><code>root((AI))</code></strong>ï¼šå®šä¹‰äº†ä¸­å¿ƒæ ¹èŠ‚ç‚¹ï¼ŒåŒæ‹¬å·ä½¿å…¶å‘ˆç°åœ†å½¢ã€‚</li>
<li><strong>ç¼©è¿›å±‚çº§</strong>ï¼šMermaid çš„æ€ç»´å¯¼å›¾è¯­æ³•ä¾èµ–ç¼©è¿›æ¥è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œæ— éœ€å¤æ‚çš„ç®­å¤´å®šä¹‰ï¼Œè¿™ä½¿å¾—ä»£ç æå…·å¯è¯»æ€§ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§ç»“æ„ï¼Œå¤æ‚çš„çŸ¥è¯†ä½“ç³»è¢«å¯è§†åŒ–ä¸ºå±‚çº§åˆ†æ˜çš„æ ‘çŠ¶ç»“æ„ï¼Œä¾¿äºè®°å¿†å’Œç†è§£ã€‚</p>
<h2 data-id="heading-15">æ€»ç»“ä¸å±•æœ›</h2>
<p>é€šè¿‡ä¸Šè¿°æµç¨‹ï¼Œæˆ‘ä»¬å®Œæ•´ä½“éªŒäº†ä» MCP æœåŠ¡çš„æœç´¢ã€é…ç½®ï¼Œåˆ°åœ¨ IDE ä¸­é€šè¿‡è‡ªç„¶è¯­è¨€ç”Ÿæˆäº”ç§ä¸åŒç±»å‹å›¾è¡¨çš„å…¨è¿‡ç¨‹ã€‚</p>
<p>è¿™ä¸€æ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ol>
<li><strong>ä½é—¨æ§›</strong>ï¼šç”¨æˆ·æ— éœ€å­¦ä¹ ç¹æ‚çš„ Mermaid è¯­æ³•ï¼Œåªéœ€æè¿°éœ€æ±‚ã€‚</li>
<li><strong>é«˜æ•ˆç‡</strong>ï¼šè“è€˜æ‰˜ç®¡æœåŠ¡å…å»äº†æœ¬åœ°ç¯å¢ƒæ­å»ºçš„æˆæœ¬ï¼Œå¼€ç®±å³ç”¨ã€‚</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šç”Ÿæˆçš„å›¾è¡¨æœ¬è´¨ä¸Šæ˜¯æ–‡æœ¬ä»£ç ï¼Œå¯ä»¥éšé¡¹ç›®æºç ä¸€èµ·è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰ï¼Œä¾¿äºåç»­çš„ä¿®æ”¹å’Œè¿­ä»£ã€‚</li>
</ol>
<p>MCP Mermaid ä¸ä»…æ˜¯ä¸€ä¸ªç»˜å›¾å·¥å…·ï¼Œæ›´æ˜¯ AI è¾…åŠ©å·¥ç¨‹åŒ–ï¼ˆAI4SEï¼‰çš„ä¸€ä¸ªå…¸å‹åˆ‡é¢ã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•é€šè¿‡æ ‡å‡†åè®®å°†å¤§æ¨¡å‹çš„ç†è§£èƒ½åŠ›è½¬åŒ–ä¸ºå®é™…çš„ç”Ÿäº§åŠ›å·¥å…·ã€‚å¯¹äºå¼€å‘è€…ã€äº§å“ç»ç†ä»¥åŠç³»ç»Ÿæ¶æ„å¸ˆè€Œè¨€ï¼ŒæŒæ¡è¿™ä¸€å·¥ä½œæµå°†æ˜¾è‘—æå‡æ–‡æ¡£ç¼–å†™ä¸æŠ€æœ¯æ²Ÿé€šçš„æ•ˆç‡ã€‚</p>
<p>å¦‚æœæ‚¨å¯¹è¿™ä¸€æŠ€æœ¯æ ˆæ„Ÿå…´è¶£ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥æ³¨å†Œå¹¶ä½“éªŒè“è€˜å¹³å°æä¾›çš„æœåŠ¡ï¼š
<code>https://console.lanyun.net/#/register?promoterCode=0131</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€TRAE SOLO å®æˆ˜èµ› | æ™ºå¯Coding ç åŠ›å…¨å¼€ | åœ¨TRAE SOLOä¸­ä½¿ç”¨PyeChartåˆ›å»ºä¸€ä¸ªHTMLæ ¼å¼çš„å­æ¯é¥¼å›¾ç½‘ç«™ğŸ§£]]></title>    <link>https://juejin.cn/post/7584243498528227328</link>    <guid>https://juejin.cn/post/7584243498528227328</guid>    <pubDate>2025-12-16T11:54:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584243498528227328" data-draft-id="7584286241487945768" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€TRAE SOLO å®æˆ˜èµ› | æ™ºå¯Coding ç åŠ›å…¨å¼€ | åœ¨TRAE SOLOä¸­ä½¿ç”¨PyeChartåˆ›å»ºä¸€ä¸ªHTMLæ ¼å¼çš„å­æ¯é¥¼å›¾ç½‘ç«™ğŸ§£"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-16T11:54:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›´å·¾å“¥è§å°˜"/> <meta itemprop="url" content="https://juejin.cn/user/1222312659548446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€TRAE SOLO å®æˆ˜èµ› | æ™ºå¯Coding ç åŠ›å…¨å¼€ | åœ¨TRAE SOLOä¸­ä½¿ç”¨PyeChartåˆ›å»ºä¸€ä¸ªHTMLæ ¼å¼çš„å­æ¯é¥¼å›¾ç½‘ç«™ğŸ§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1222312659548446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›´å·¾å“¥è§å°˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:54:52.000Z" title="Tue Dec 16 2025 11:54:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš€TRAE SOLO å®æˆ˜èµ› | æ™ºå¯Coding ç åŠ›å…¨å¼€ | åœ¨TRAE SOLOä¸­ä½¿ç”¨PyeChartåˆ›å»ºä¸€ä¸ªHTMLæ ¼å¼çš„å­æ¯é¥¼å›¾ç½‘ç«™ğŸ§£</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f522bac8244f48a38fa79d6e75159325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=tP7boZEFa9zEoekgbfYDLPum%2BLo%3D" alt="708d8a2df5a594e775fe485ab6d4431568bbd20c.jpg@672w_378h_1c.webp" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftraeb7l0znrj.vercel.app%2F" target="_blank" title="https://traeb7l0znrj.vercel.app/" ref="nofollow noopener noreferrer">traeb7l0znrj.vercel.app/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1fAqhBGErL%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1fAqhBGErL/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">è§†é¢‘æ“ä½œï¼šğŸš€TRAE SOLO å®æˆ˜èµ› | æ™ºå¯Coding ç åŠ›å…¨å¼€ | ä½¿ç”¨PyeChartåˆ›å»ºä¸€ä¸ªHTMLæ ¼å¼çš„å­æ¯é¥¼å›¾æ¡ˆä¾‹ | @å›´å·¾å“¥è§å°˜ğŸ§£</a></p>
<p><strong>æ‘˜è¦</strong></p>
<p>ä»Šå¤©ä¸»è¦åˆ©ç”¨ TRAEçš„å›½å†…ç‰ˆæœ¬ é«˜æ•ˆå®ç°ç‰¹å®šå¯è§†åŒ–éœ€æ±‚ï¼Œå³ä½¿ç”¨Pythonçš„<code>PyeChart</code>åº“ç”ŸæˆTHMLæ ¼å¼å­æ¯å“å›¾çš„å®è·µæµç¨‹ã€‚é€šè¿‡è¾“å…¥ç»“æ„åŒ–çš„éœ€æ±‚æè¿°å’Œå¯¹åº”çš„èŒƒä¾‹ï¼Œæˆ‘ä»¬å®ç°äº†å¿«é€Ÿä»£ç ç”Ÿæˆä¸å›¾æ ·åˆ¶ä½œã€‚å®é™…çš„æ“ä½œå‘ç°ï¼Œæ˜ç¡®çš„éœ€æ±‚æè¿°åŠå…¶èŒƒä¾‹æ˜¯æ˜¾è‘—åŠ é€Ÿå®ç°è¿›ç¨‹çš„å…³é”®å› ç´ ã€‚</p>
<p><strong>å…³é”®è¯ï¼š</strong> å­æ¯å“å›¾, HTML, Python, <code>PyeChart</code>, æç¤ºè¯ä¼˜åŒ–, AIè¾…åŠ©</p>
<h3 data-id="heading-1">1. ç ”ç©¶èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc9dcbd74024126afff561f7f6a1978~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=6bJM0N9vMgeOB8f%2F4%2ByH99kamUw%3D" alt="æˆªå±2025-12-16 19.32.00.png" loading="lazy"/></p>
<p>ä»Šå¤©ä¸€ä¸ªå°ä¼™ä¼´æå‡ºäº†ä¸€ä¸ªæ˜ç¡®çš„å¯è§†åŒ–éœ€æ±‚ï¼Œå³éœ€è¦ç»˜åˆ¶ä¸€å¼ <strong>å­æ¯é¥¼å›¾</strong>ï¼Œè¦æ±‚ä»¥ <strong>HTML æ ¼å¼</strong>è¾“å‡ºï¼Œå¹¶éœ€é€šè¿‡ <strong>Python çš„ PyeChart</strong>å®Œæˆå®ç°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5c515bbbae485fa8eeb5ec99038246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=9wMnxadB%2Bl2Yb7IEmTBoE7XStWY%3D" alt="æˆªå±2025-12-16 19.21.00.png" loading="lazy"/></p>
<p>è¯¥éœ€æ±‚çš„å…³é”®ä¼˜åŠ¿åœ¨äºï¼Œå¥¹ä¸ä»…æä¾›äº†éœ€æ±‚ç‚¹ï¼Œè¿˜æä¾›äº†<strong>å¯¹åº”çš„èŒƒä¾‹</strong>ã€‚è¿™ç§åŒé‡ç¡®è®¤æå¤§åœ°æé«˜äº†åç»­æ“ä½œçš„æ•ˆç‡ï¼Œå› ä¸ºåœ¨æ“ä½œæ—¶å®ƒçš„æ•ˆç‡ä¼šå¾ˆé«˜ä¸€ç‚¹ã€‚</p>
<p>è™½ç„¶åŸºç¡€éœ€æ±‚æ¸…æ™°ï¼Œä½†åœ¨å®é™…æ“ä½œä¸­ï¼Œä»éœ€è¦å¯¹éœ€æ±‚è¿›è¡Œä¼˜åŒ–ï¼Œä»¥ç¡®ä¿æœ€ç»ˆç”Ÿæˆçš„å“å›¾èƒ½å¤Ÿä¸éœ€æ±‚å®Œå…¨ä¸€è‡´ã€‚</p>
<h3 data-id="heading-2">2. AIé©±åŠ¨çš„æ–¹æ³•è®ºä¸æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bac1669f4ed948a6af8e4584adeab18a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=fMVdCwUAcwpHZM5dEPFCpMHCD%2BI%3D" alt="æˆªå±2025-12-16 17.39.00.png" loading="lazy"/></p>
<p>åˆ©ç”¨â€œTRAEçš„å›½å†…ç‰ˆæœ¬â€å·¥å…· ä½œä¸ºAIé©±åŠ¨çš„ä»£ç ç”Ÿæˆå¹³å°ã€‚</p>
<h4 data-id="heading-3">2.1 æç¤ºè¯æ„å»ºä¸å·¥å…·å¯ç”¨</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/202d4a1862f64116af32ce95b5efced5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=vygzvUYuYNkSTSHYmECkwn1Z1Kg%3D" alt="50.gif" loading="lazy"/></p>
<p>æˆ‘å‘TRAEæä¾›äº†<strong>éœ€æ±‚åˆ†æå’ŒèŒƒä¾‹å›¾ç‰‡ï¼Œä»¥åŠæˆ‘çš„åˆ¶ä½œéœ€æ±‚</strong>ï¼Œé€šè¿‡å¯¹åº”çš„æç¤ºè¯ï¼Œå®Œæˆå¯¹åº”çš„ç½‘é¡µåˆ¶ä½œã€‚å¯ç”¨äº† <strong>plan åŠŸèƒ½</strong>ï¼Œå®Œæˆé¡¹ç›®æ¢³ç†ã€‚</p>
<h4 data-id="heading-4">2.2 ç»“æ„åŒ–æ‰§è¡Œæ­¥éª¤çš„è‡ªåŠ¨ç”Ÿæˆ</h4>
<p>TRAEåœ¨æ¥æ”¶åˆ°æç¤ºè¯åï¼Œæ ¹æ®éœ€æ±‚åˆ†æè‡ªåŠ¨ç”Ÿæˆäº†ä¸€å¥—å®ç°æ­¥éª¤ã€‚è¿™äº›æ­¥éª¤è¦†ç›–äº†ä»æ•°æ®å‡†å¤‡åˆ°åŸºç¡€è§†å›¾ç”Ÿæˆçš„å…¨è¿‡ç¨‹ã€‚</p>
<p><strong>è¡¨ 1ï¼šAIå·¥å…·è‡ªåŠ¨ç”Ÿæˆçš„å›¾æ ·å®ç°æ­¥éª¤</strong></p>



































<table><thead><tr><th align="left">åºå·</th><th align="left">æ­¥éª¤ç¯èŠ‚</th><th align="left">å…³é”®æ“ä½œæè¿°</th><th align="left">å¼•ç”¨</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">æ•°æ®ä¸æ–‡æ¡£å‡†å¤‡</td><td align="left">å®Œæˆæ–‡æ¡£çš„ä¸€ä¸ªæ•°æ®å‡†å¤‡å·¥ä½œ</td><td align="left"/></tr><tr><td align="left">2</td><td align="left">åº“å®‰è£…ä¸é…ç½®</td><td align="left">å®‰è£… <code>PyeChart</code> åº“å¹¶é‡å¯è¯¥ <code>PyeChart</code> åº“</td><td align="left"/></tr><tr><td align="left">3</td><td align="left">TODO listæ­¥éª¤</td><td align="left">å·¥å…·æä¾›äº†äº”æ­¥çš„æ“ä½œæ­¥éª¤</td><td align="left"/></tr><tr><td align="left">4</td><td align="left">ç½‘é¡µå¯è§†åŒ–ç”Ÿæˆ</td><td align="left">ç”Ÿæˆæ–‡æ¡£ï¼Œå®ç°å­—æ¯è§†å›¾å¹¶å¯åŠ¨ç½‘é¡µ</td><td align="left"/></tr></tbody></table>
<h4 data-id="heading-5">2.3 ç»“æœéªŒè¯</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acd352c2008342eb918e18106fcf6ea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=SNfpKKsNEhTITA%2Fbgcu8GjbwAzM%3D" alt="æˆªå±2025-12-16 17.39.11.png" loading="lazy"/></p>
<p>ç¨‹åºå¯åŠ¨åï¼Œå³å¯åœ¨æµè§ˆå™¨å½“ä¸­å»å®Œæˆå›¾æ ·çš„åˆ¶ä½œï¼Œå®ç°ç½‘é¡µçš„é€Ÿåº¦éå¸¸å¿«ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f66193105549bb87ae38c147a781ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=MYjOVXSNJFkgzpgRnNs8HVSm0gI%3D" alt="æˆªå±2025-12-16 19.43.54.png" loading="lazy"/></p>
<p>å›½å†…ç‰ˆæœ¬æ²¡æœ‰éƒ¨ç½²æŒ‰é’®ï¼Œä½¿ç”¨å›½é™…ç‰ˆçš„TRAEå®Œæˆç½‘é¡µçš„éƒ¨ç½²ã€‚</p>
<h3 data-id="heading-6">3. ç»“æœã€è®¨è®ºä¸ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-7">3.1 æ•ˆç‡ä¸æ¸…æ™°æ€§</h4>
<p>å®è·µè¯æ˜ï¼Œ<strong>æ‹¥æœ‰æ¸…æ™°çš„éœ€æ±‚ç‚¹å’Œå¯¹åº”çš„èŒƒä¾‹</strong>æ˜¯åŠ é€Ÿå®ç°è¿‡ç¨‹çš„å…³é”®å› ç´ ã€‚å½“éœ€æ±‚æè¿°æ¸…æ™°ã€åˆ†æåˆ°ä½æ—¶ï¼Œå·¥å…·èƒ½å¤Ÿæ›´å¿«åœ°ç”ŸæˆåŸºç¡€è§†çº¿ã€‚</p>
<h4 data-id="heading-8">3.2 å¤æ‚å¸ƒå±€çš„å®ç°æŒ‘æˆ˜</h4>
<p>å°½ç®¡åŸºç¡€å®ç°é€Ÿåº¦å¿«ï¼Œä½†å¦‚æœè¦å®ç°å¦‚â€œå·¦è¾¹å½“å›¾ï¼Œå³è¾¹å½“å›¾ï¼Œä¸­é—´åŠ è¿™ä¸ªçº¿çš„æè¿°çš„å›¾ç‰‡â€çš„å¤æ‚ç²¾ç»†åŒ–å¸ƒå±€ï¼Œåˆ™éœ€è¦å¯¹<strong>æç¤ºè¯å®Œæˆæ›´è¿›ä¸€æ­¥çš„æè¿°ä¼˜åŒ–</strong>ã€‚</p>
<h4 data-id="heading-9">3.3 æç¤ºè¯ä¼˜åŒ–ä¸å¤–éƒ¨å·¥å…·è¾…åŠ©</h4>
<p>ä¸ºäº†è·å¾—æ›´ç†æƒ³çš„æ•ˆæœï¼Œå¦‚æœç”¨æˆ·åœ¨è‡ªæˆ‘è¡¨è¿°æˆ–æè¿°æ‰€éœ€å›¾æ ·æ—¶é‡åˆ°å›°éš¾ï¼Œå¯ä»¥å€Ÿé‰´å¤–éƒ¨å·¥å…·è¿›è¡Œè¾…åŠ©åˆ†æã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ©ç”¨è°·æ­Œçš„ <strong>Gemini</strong>ï¼Œè®©å®ƒå»åˆ†æç›®æ ‡å›¾æ ·ï¼Œè¿›è€Œç»™å‡ºå¯¹åº”çš„<strong>å›¾æè¿°çš„æç¤ºè¯</strong>ï¼Œè¿™èƒ½æœ‰æ•ˆæå‡æè¿°çš„ç²¾ç¡®åº¦å’ŒåŠ å¿«æ•ˆæœã€‚</p>
<h3 data-id="heading-10">4. ç»“è®º</h3>
<p>åˆ©ç”¨â€œTRAEå›½å†…ç‰ˆâ€å·¥å…·å’Œæ¸…æ™°çš„éœ€æ±‚æ–‡æ¡£ï¼ŒæˆåŠŸå®Œæˆäº†åŸºäºPython <code>PyeChart</code>åº“çš„HTMLæ ¼å¼å­—æ¯é¥¼å›¾åˆ¶ä½œå’Œåˆ†äº«ã€‚åœ¨ä»£ç å®ç°åœºæ™¯ä¸­ï¼Œ<strong>ä½ å¯¹é—®é¢˜çš„æ¸…æ™°æè¿°å’Œåˆ†æ</strong>æ˜¯è·å¾—è‰¯å¥½æ•ˆæœçš„åŸºçŸ³ã€‚</p>
<p>å¦‚æœä½ æœ‰ä¸€ä¸ªæ¸…æ™°éœ€æ±‚å¹¶é™„å¸¦ä¸€ä¸ªæ¸…æ™°çš„èŒƒä¾‹ï¼Œé‚£ä¹ˆåœ¨å®ç°éœ€æ±‚çš„è¿‡ç¨‹ä¸­é€Ÿåº¦ä¸Šå°±ä¼šæ›´å¿«ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIè¾…åŠ©å¼€å‘å·¥å…·å®æˆ˜ï¼šä»é›¶åˆ°ä¸€æ„å»ºAIå†™çœŸå°ç¨‹åº]]></title>    <link>https://juejin.cn/post/7584292514959163401</link>    <guid>https://juejin.cn/post/7584292514959163401</guid>    <pubDate>2025-12-16T11:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584292514959163401" data-draft-id="7584276176670752795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIè¾…åŠ©å¼€å‘å·¥å…·å®æˆ˜ï¼šä»é›¶åˆ°ä¸€æ„å»ºAIå†™çœŸå°ç¨‹åº"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-16T11:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ©™åˆæœˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1257497033712414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIè¾…åŠ©å¼€å‘å·¥å…·å®æˆ˜ï¼šä»é›¶åˆ°ä¸€æ„å»ºAIå†™çœŸå°ç¨‹åº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497033712414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ©™åˆæœˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:13:59.000Z" title="Tue Dec 16 2025 11:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"ğŸº";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"ğŸ»";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"ğŸ¥‚";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"ğŸ¥ƒ";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"ğŸ”¸"}.markdown-body ul li li{list-style-type:"â—»ï¸"}.markdown-body ul li li li{list-style-type:"â–«ï¸"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"ğŸŸ©";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"âœ…"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>æœ€è¿‘ç”¨TRAEçš„Soloæ¨¡å¼åšäº†ä¸ªAIå†™çœŸå°ç¨‹åºé¡¹ç›®ï¼Œä»é›¶åˆ°ä¸€èµ°äº†ä¸€éã€‚é¡¹ç›®ç”¨Taro + Reactåšå‰ç«¯ï¼ŒNestJS + MongoDBåšåç«¯ï¼Œæ•´ä½“å®Œæˆåº¦å¤§æ¦‚60%ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦èŠèŠSoloæ¨¡å¼çš„å®é™…è¡¨ç°ï¼Œå“ªäº›åœ°æ–¹çœæ—¶é—´ï¼Œå“ªäº›åœ°æ–¹è¿˜æ˜¯å¾—è‡ªå·±æ¥ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€é¡¹ç›®æ¦‚è¿°</h2>
<h3 data-id="heading-2">1.1 é¡¹ç›®èƒŒæ™¯</h3>
<p>è¿™ä¸ªé¡¹ç›®æ˜¯ä¸ªAIå†™çœŸå°ç¨‹åºï¼Œä¸»è¦åšèŠ‚æ—¥ä¸»é¢˜ï¼ˆåœ£è¯/è·¨å¹´ï¼‰çš„å†™çœŸç”Ÿæˆã€‚éœ€è¦åŒæ—¶æ”¯æŒå¾®ä¿¡å’ŒæŠ–éŸ³ä¸¤ä¸ªå¹³å°ï¼ŒåŠŸèƒ½åŒ…æ‹¬ç”¨æˆ·ç™»å½•ã€å›¾ç‰‡ä¸Šä¼ ã€AIé¢„æ£€ã€é£æ ¼é€‰æ‹©ã€ä»˜è´¹è§£é”ã€AIç”Ÿæˆã€ç»“æœå±•ç¤ºè¿™äº›æ ¸å¿ƒæµç¨‹ã€‚</p>
<h3 data-id="heading-3">1.2 æŠ€æœ¯æ ˆé€‰å‹</h3>
<p>æŠ€æœ¯é€‰å‹æ˜¯åœ¨Soloæ¨¡å¼ä¸‹åšçš„ï¼Œä½“éªŒä¸é”™ã€‚æè¿°äº†é¡¹ç›®éœ€æ±‚ï¼ˆå°ç¨‹åºã€è·¨å¹³å°ã€AIç”Ÿæˆç­‰ï¼‰ï¼ŒSoloæ¨¡å¼æ¨èäº†æŠ€æœ¯æ ˆå¹¶ç»™å‡ºç†ç”±ã€‚æ¯”å¦‚ä¸ºä»€ä¹ˆé€‰Taroè€Œä¸æ˜¯uni-appï¼Œä¸ºä»€ä¹ˆé€‰NestJSè€Œä¸æ˜¯Expressï¼Œè§£é‡Šæ¯”è¾ƒåˆç†ã€‚</p>
<p>æœ€ç»ˆé€‰å®šçš„æŠ€æœ¯æ ˆï¼šå‰ç«¯ç”¨Taro 4.1.9 + React 18.0.0ï¼Œåç«¯ç”¨NestJS 10.0.0 + MongoDB 7.6.3ï¼ŒAIæœåŠ¡ç”¨Google Generative AI 0.24.1ã€‚è¿™ä¸ªé˜¶æ®µçœäº†ä¸å°‘è°ƒç ”æ—¶é—´ã€‚</p>
<h3 data-id="heading-4">1.3 é¡¹ç›®å®Œæˆæƒ…å†µ</h3>
<p>é‡æ–°è¯„ä¼°äº†ä¸€ä¸‹ï¼Œé¡¹ç›®å®Œæˆåº¦ç¡®å®æ²¡æœ‰ä¹‹å‰ä¼°è®¡çš„é‚£ä¹ˆé«˜ã€‚å‰ç«¯å¤§æ¦‚50%ï¼Œåç«¯70%å·¦å³ï¼š</p>
<h4 data-id="heading-5">å‰ç«¯å®Œæˆåº¦ï¼š<strong>50%</strong></h4>








































<table><thead><tr><th>æ¨¡å—</th><th>å®Œæˆåº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŸºç¡€æ¶æ„</td><td>100%</td><td>Taroæ¡†æ¶æ­å»ºå®Œæˆï¼Œé¡¹ç›®ç»“æ„æ¸…æ™°</td></tr><tr><td>UIç»„ä»¶åº“</td><td>70%</td><td>MobileLayoutã€Headerã€Buttonç­‰æ ¸å¿ƒç»„ä»¶å·²å®ç°ï¼Œä½†æ ·å¼ä¸è®¾è®¡è§„èŒƒå·®è·å¤§</td></tr><tr><td>é¡µé¢å®ç°</td><td>60%</td><td>ä¸»è¦é¡µé¢ï¼ˆé¦–é¡µã€ç™»å½•ã€ä¸Šä¼ ã€é£æ ¼é€‰æ‹©ã€ç»“æœé¡µï¼‰å·²å®ç°ï¼Œä½†éƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®</td></tr><tr><td>APIé›†æˆ</td><td>50%</td><td>åŸºç¡€APIè°ƒç”¨å·²å®ç°ï¼Œä½†å¾ˆå¤šæ¥å£æœªå®Œå…¨å¯¹æ¥</td></tr><tr><td>æ ·å¼è®¾è®¡</td><td>40%</td><td>UIæ ·å¼åŸºæœ¬å®ç°ï¼Œä½†è§†è§‰æ•ˆæœä¸è®¾è®¡è§„èŒƒå­˜åœ¨è¾ƒå¤§å·®è·ï¼Œéœ€è¦å¤§é‡æ‰‹åŠ¨è°ƒæ•´</td></tr><tr><td>é”™è¯¯å¤„ç†</td><td>40%</td><td>åŸºç¡€é”™è¯¯å¤„ç†å·²å®ç°ï¼Œä½†ç¼ºå°‘å…¨å±€é”™è¯¯å¤„ç†æœºåˆ¶å’Œè¶…æ—¶æ§åˆ¶</td></tr></tbody></table>
<p><strong>ä¸»è¦æœªå®Œæˆé¡¹</strong>ï¼š</p>
<ul>
<li>éƒ¨åˆ†é¡µé¢ï¼ˆå¦‚æ”¯ä»˜é¡µã€ç”¨æˆ·ä¸­å¿ƒï¼‰åŠŸèƒ½ä¸å®Œæ•´</li>
<li>ç»“æœé¡µä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆï¼Œæœªå®Œå…¨å¯¹æ¥åç«¯API</li>
<li>ç¼ºå°‘å…¨å±€é”™è¯¯å¤„ç†å’Œè¯·æ±‚è¶…æ—¶æ§åˆ¶</li>
<li>UIè§†è§‰æ•ˆæœä¸è®¾è®¡è§„èŒƒå­˜åœ¨è¾ƒå¤§å·®è·ï¼Œéœ€è¦å¤§é‡æ‰‹åŠ¨è°ƒæ•´</li>
</ul>
<h4 data-id="heading-6">åç«¯å®Œæˆåº¦ï¼š<strong>70%</strong></h4>


















































<table><thead><tr><th>æ¨¡å—</th><th>å®Œæˆåº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŸºç¡€æ¶æ„</td><td>100%</td><td>NestJSæ¡†æ¶æ­å»ºå®Œæˆï¼Œæ¨¡å—åŒ–è®¾è®¡æ¸…æ™°</td></tr><tr><td>è®¤è¯æ¨¡å—</td><td>85%</td><td>å¾®ä¿¡/æŠ–éŸ³ç™»å½•å·²å®ç°ï¼ŒJWTè®¤è¯æœºåˆ¶å®Œå–„ï¼Œä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•</td></tr><tr><td>ç”¨æˆ·æ¨¡å—</td><td>80%</td><td>ç”¨æˆ·ç®¡ç†ã€VIPç³»ç»Ÿã€è´­ä¹°å†å²ç­‰åŠŸèƒ½å·²å®ç°ï¼Œä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•</td></tr><tr><td>å›¾ç‰‡æ¨¡å—</td><td>70%</td><td>å›¾ç‰‡ä¸Šä¼ ã€å­˜å‚¨ã€å®¡æ ¸åŠŸèƒ½å·²å®ç°ï¼Œä½†ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼Œæœªé›†æˆäº‘å­˜å‚¨</td></tr><tr><td>AIæ¨¡å—</td><td>80%</td><td>Gemini APIé›†æˆå®Œæˆï¼Œæ”¯æŒå›¾ç‰‡é¢„æ£€ã€ç”Ÿæˆã€æ–‡æ¡ˆæ¨èï¼Œä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•</td></tr><tr><td>ç”Ÿæˆæ¨¡å—</td><td>60%</td><td>ä»»åŠ¡ç®¡ç†ã€çŠ¶æ€è·Ÿè¸ªå·²å®ç°ï¼Œä½†ç¼ºå°‘ä»»åŠ¡é˜Ÿåˆ—å’Œé‡è¯•æœºåˆ¶</td></tr><tr><td>è®¢å•æ¨¡å—</td><td>70%</td><td>è®¢å•åˆ›å»ºã€çŠ¶æ€ç®¡ç†ã€æ”¯ä»˜å›è°ƒå¤„ç†å·²å®ç°ï¼Œä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•</td></tr><tr><td>æ”¯ä»˜æ¨¡å—</td><td>50%</td><td>å¾®ä¿¡/æŠ–éŸ³æ”¯ä»˜æ¡†æ¶å·²æ­å»ºï¼Œä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•å’ŒéªŒè¯</td></tr></tbody></table>
<p><strong>ä¸»è¦æœªå®Œæˆé¡¹</strong>ï¼š</p>
<ul>
<li>äº‘å­˜å‚¨é›†æˆï¼ˆè…¾è®¯äº‘COSï¼‰æœªå®Œæˆï¼Œç›®å‰ä½¿ç”¨æœ¬åœ°å­˜å‚¨</li>
<li>æ”¯ä»˜åŠŸèƒ½å¯èƒ½æœªå®Œå…¨æµ‹è¯•å’ŒéªŒè¯</li>
<li>ç¼ºå°‘ä»»åŠ¡é˜Ÿåˆ—å’Œå¼‚æ­¥å¤„ç†æœºåˆ¶</li>
<li>ç¼ºå°‘å®Œæ•´çš„é”™è¯¯æ—¥å¿—å’Œç›‘æ§ç³»ç»Ÿ</li>
<li>å¾ˆå¤šæ¨¡å—è™½ç„¶ä»£ç å†™å¥½äº†ï¼Œä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•</li>
</ul>
<hr/>
<h2 data-id="heading-7">äºŒã€Soloæ¨¡å¼å®æˆ˜ä½“éªŒ</h2>
<h3 data-id="heading-8">2.0 æŠ€æœ¯é€‰å‹é˜¶æ®µ</h3>
<p>é¡¹ç›®æœ€å¼€å§‹åœ¨Soloæ¨¡å¼ä¸‹åšæŠ€æœ¯é€‰å‹ï¼Œä½“éªŒä¸é”™ã€‚æè¿°äº†éœ€æ±‚ï¼ŒSoloæ¨¡å¼æ¨èäº†æŠ€æœ¯æ ˆå¹¶ç»™å‡ºç†ç”±ï¼Œçœäº†ä¸å°‘è°ƒç ”æ—¶é—´ã€‚</p>
<h3 data-id="heading-9">2.1 æ¶æ„è®¾è®¡é˜¶æ®µ</h3>
<p>æŠ€æœ¯é€‰å‹ç¡®å®šåï¼Œåœ¨Soloæ¨¡å¼ä¸‹ç”Ÿæˆæ¶æ„è®¾è®¡æ–‡æ¡£ã€‚æ ¹æ®æŠ€æœ¯æ ˆè‡ªåŠ¨ç”Ÿæˆç›®å½•ç»“æ„ã€ç»„ä»¶åŒ–æ–¹æ¡ˆã€çŠ¶æ€ç®¡ç†è¿™äº›åŸºç¡€æ¶æ„ã€‚</p>
<p>æ¶æ„è®¾è®¡ä»2-3å¤©ç¼©çŸ­åˆ°1å°æ—¶å†…ï¼Œç”Ÿæˆçš„ç›®å½•ç»“æ„ç¬¦åˆTaroè§„èŒƒï¼ŒWXSSå…¼å®¹æ€§é—®é¢˜ä¹Ÿèƒ½è‡ªåŠ¨å¤„ç†ã€‚ä¸è¿‡æ¶æ„è®¾è®¡æ¯”è¾ƒé€šç”¨ï¼Œè¿˜æ˜¯å¾—æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µè°ƒæ•´ã€‚</p>
<h3 data-id="heading-10">2.2 ç¼–ç å®ç°é˜¶æ®µ</h3>
<p>ç¼–ç é˜¶æ®µç”¨å¾—æœ€å¤šï¼Œä½“éªŒæœ‰ç‚¹ä¸¤æåˆ†åŒ–ã€‚</p>
<p><strong>åšå¾—å¥½çš„åœ°æ–¹</strong>ï¼š</p>
<ul>
<li><strong>çœ‹AIå†™ä»£ç </strong>ï¼šå¼€å¯è‡ªåŠ¨è·Ÿéšæ¨¡å¼åï¼Œæè¿°éœ€æ±‚ï¼ŒAIå¼€å§‹å†™ä»£ç ï¼Œå¯ä»¥çœ‹ç€å®ƒä¸€è¡Œè¡Œç”Ÿæˆã€‚æœ‰æ—¶å€™ä¼šæƒ³"åŸæ¥å¯ä»¥è¿™æ ·å†™"ï¼Œèƒ½å­¦åˆ°ä¸€äº›æ–°å†™æ³•</li>
<li><strong>ç»„ä»¶ä»£ç ç”Ÿæˆ</strong>ï¼šç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼Œå¾ˆå¿«å°±èƒ½ç”Ÿæˆç¬¦åˆTaroè§„èŒƒçš„ä»£ç ï¼Œçœæ—¶é—´</li>
</ul>
<p><strong>æœ€å¤§çš„ç—›ç‚¹ï¼šUIè§„èŒƒç†è§£èƒ½åŠ›ä¸è¶³</strong></p>
<p>è™½ç„¶èƒ½è¯»å–UIè§„èŒƒæ–‡æ¡£ï¼Œä½†å³ä½¿ç»™äº†è®¾è®¡è§„èŒƒï¼Œä¹Ÿæ— æ³•æ ¹æ®è§„èŒƒç”Ÿæˆå¯¹åº”çš„ç»„ä»¶ã€‚</p>
<p>æˆ‘è¯•è¿‡ç»™å®ƒUIè§„èŒƒæ–‡æ¡£ï¼Œç”Ÿæˆçš„ç»„ä»¶æ ·å¼å’Œè§„èŒƒå·®è·å¾ˆå¤§ã€‚è‰²å½©ã€é—´è·ã€å­—ä½“è¿™äº›ç»†èŠ‚éƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´ï¼Œå¸ƒå±€ä¹Ÿä¸å¤Ÿç²¾ç¡®ã€‚ä»£ç è¯­æ³•æ²¡é—®é¢˜ï¼Œä½†è§†è§‰æ•ˆæœå®Œå…¨ä¸ç¬¦åˆè®¾è®¡è§„èŒƒã€‚</p>
<p>ç»“æœå°±æ˜¯ä»£ç ç”Ÿæˆé€Ÿåº¦å¿«ï¼Œä½†UIå®ç°é˜¶æ®µåè€Œè¦èŠ±æ›´å¤šæ—¶é—´æ‰‹åŠ¨è°ƒæ•´ï¼Œæœ‰ç‚¹æ¬²é€Ÿåˆ™ä¸è¾¾ã€‚</p>
<p><strong>å¼€å‘æ•ˆç‡å¯¹æ¯”</strong>ï¼š</p>















































<table><thead><tr><th>å¼€å‘é˜¶æ®µ</th><th>ä¼ ç»Ÿå¼€å‘</th><th>Soloæ¨¡å¼</th><th>æ•ˆç‡æå‡</th></tr></thead><tbody><tr><td>ç»„ä»¶è®¾è®¡</td><td>30åˆ†é’Ÿ</td><td>5åˆ†é’Ÿ</td><td>6å€</td></tr><tr><td>æ ·å¼å®ç°</td><td>20åˆ†é’Ÿ</td><td>15åˆ†é’Ÿ</td><td>1.3å€</td></tr><tr><td>UIè§„èŒƒè°ƒæ•´</td><td>0åˆ†é’Ÿ</td><td>25åˆ†é’Ÿ</td><td>-</td></tr><tr><td>å…¼å®¹æ€§å¤„ç†</td><td>15åˆ†é’Ÿ</td><td>è‡ªåŠ¨</td><td>100%èŠ‚çœ</td></tr><tr><td>ä»£ç è°ƒè¯•</td><td>25åˆ†é’Ÿ</td><td>10åˆ†é’Ÿ</td><td>2.5å€</td></tr><tr><td><strong>æ€»è®¡</strong></td><td><strong>90åˆ†é’Ÿ</strong></td><td><strong>55åˆ†é’Ÿ</strong></td><td><strong>1.6å€</strong></td></tr></tbody></table>
<p>ä»£ç ç”Ÿæˆé€Ÿåº¦å¿«ï¼Œé‡å¤å·¥ä½œå‡å°‘ï¼Œå¹³å°å…¼å®¹æ€§è‡ªåŠ¨å¤„ç†ã€‚ä½†æœ€å¤§é—®é¢˜æ˜¯å³ä½¿ç»™äº†UIè§„èŒƒæ–‡æ¡£ï¼Œä¹Ÿæ— æ³•æ ¹æ®è§„èŒƒç”Ÿæˆå¯¹åº”ç»„ä»¶ï¼Œéœ€è¦å¤§é‡æ‰‹åŠ¨è°ƒæ•´ã€‚å¤æ‚ç»„ä»¶å’ŒåŠ¨ç”»æ•ˆæœè¿˜æ˜¯å¾—è‡ªå·±æ¥ã€‚</p>
<h3 data-id="heading-11">2.3 æµ‹è¯•ä¼˜åŒ–é˜¶æ®µ</h3>
<p>æµ‹è¯•é˜¶æ®µä¸»è¦åšä»£ç è´¨é‡æ£€æŸ¥ï¼Œè¿˜ç®—å®ç”¨ã€‚ä¼šè‡ªåŠ¨æ£€æµ‹ä¸å…¼å®¹çš„CSSç‰¹æ€§ï¼Œæ¯”å¦‚æŠŠ<code>border: 'none'</code>æ”¹æˆ<code>borderWidth: 0</code>ä»¥ç¬¦åˆWXSSè§„èŒƒï¼Œèƒ½çœä¸å°‘è°ƒè¯•æ—¶é—´ã€‚ä¸è¿‡ä¼˜åŒ–å»ºè®®æ¯”è¾ƒé€šç”¨ï¼Œç¼ºä¹é’ˆå¯¹æ€§ã€‚</p>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€å¼€å‘ä¸­é‡åˆ°çš„å‘</h2>
<p>AIå†™ä»£ç å¾ˆå¿«ï¼Œå®¡æ ¸ä»£ç å´éœ€è¦æ—¶é—´ï¼›å°¤å…¶æ˜¯åœ¨é¡¹ç›®è·‘ä¸èµ·æ¥ï¼Œé‡å¤æŠ¥é”™ï¼Œé‡å¤å¾ªç¯ï¼Œè®©äººå¾ˆå´©æºƒã€‚æœ€åè¿˜æ˜¯ä¸å¾—ä¸è‡ªå·±æŸ¥æ–‡æ¡£ï¼Œæ”¹é”™è¯¯ã€‚</p>
<hr/>
<h2 data-id="heading-13">å››ã€ç»™Soloæ¨¡å¼çš„å»ºè®®</h2>
<p>åŸºäºå®é™…å¼€å‘ä½“éªŒï¼Œæå‡ ä¸ªå»ºè®®ï¼š</p>
<p><strong>æ‰§è¡Œæµç¨‹ç¨³å®šæ€§</strong>ï¼šAPIè¯·æ±‚ç¼ºå°‘è¶…æ—¶æœºåˆ¶ï¼Œæœ‰æ—¶å€™ä¼šå¡æ­»ï¼Œéœ€è¦æ‰‹åŠ¨ç»ˆæ­¢ã€‚å»ºè®®åŠ 10ç§’è¶…æ—¶æ§åˆ¶ï¼Œå®Œå–„å…¨å±€é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<p><strong>ä»£ç ç”Ÿæˆè´¨é‡</strong>ï¼šä»£ç ç”Ÿæˆç¼ºä¹å¤šè½®éªŒè¯ï¼Œæœ‰æ—¶å€™ç”Ÿæˆçš„ä»£ç èƒ½è·‘ä½†ä¸å¤Ÿä¼˜é›…ã€‚å»ºè®®å¼•å…¥è¯­æ³•æ£€æŸ¥ã€æ¡†æ¶è§„èŒƒæ£€æŸ¥ã€åŠŸèƒ½æµ‹è¯•ç­‰å¤šè½®éªŒè¯æœºåˆ¶ã€‚</p>
<p><strong>UIè§„èŒƒç†è§£èƒ½åŠ›ï¼ˆæœ€é‡è¦ï¼‰</strong>ï¼šè™½ç„¶èƒ½è¯»å–UIè§„èŒƒæ–‡æ¡£ï¼Œä½†æ— æ³•æ ¹æ®è®¾è®¡è§„èŒƒç”Ÿæˆå¯¹åº”çš„ç»„ä»¶ã€‚è¿™æ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚å»ºè®®å¢å¼ºå¯¹UIè®¾è®¡è§„èŒƒçš„ç†è§£èƒ½åŠ›ï¼Œèƒ½å‡†ç¡®è§£æè®¾è®¡æ–‡æ¡£ä¸­çš„è§†è§‰è¦æ±‚ï¼Œèƒ½æ ¹æ®è®¾è®¡è§„èŒƒç”Ÿæˆç¬¦åˆè§„èŒƒçš„ç»„ä»¶ä»£ç ï¼Œè€Œä¸æ˜¯åªç”Ÿæˆè¯­æ³•æ­£ç¡®çš„ä»£ç ã€‚</p>
<p><strong>ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›</strong>ï¼šå¯¹ä¸šåŠ¡é€»è¾‘ç†è§£ä¸å¤Ÿæ·±å…¥ï¼Œæœ‰æ—¶å€™ç”Ÿæˆçš„ä»£ç è¯­æ³•æ­£ç¡®ä½†ä¸ç¬¦åˆé¡¹ç›®å®é™…éœ€æ±‚ã€‚å»ºè®®å¢å¼ºé¡¹ç›®ä¸Šä¸‹æ–‡ç†è§£ï¼Œæ”¯æŒé¡¹ç›®ç‰¹å®šçš„ä»£ç æ¨¡æ¿ã€‚</p>
<p><strong>ä¸´æ—¶æ–‡æ¡£è¿‡å¤š</strong>ï¼šä¸´æ—¶æ–‡æ¡£è®©AIåœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šèµ·åˆ°å¸®åŠ©ï¼Œä½†è¿™ä¸ªæ–‡æ¡£å¤§éƒ¨åˆ†æ²¡æœ‰ç”¨å¤„ï¼Œè€Œä¸”ä¼šè¶Šæ¥è¶Šå¤šï¼Œå¢åŠ äº†é˜…è¯»çš„è´Ÿæ‹…ã€‚å»ºè®®å®Œæˆä»»åŠ¡ä¹‹åè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡æ¡£ï¼Œæ²¡å¿…è¦å ç”¨å¤ªå¤šç©ºé—´ï¼Œå¢åŠ å¿ƒæ™ºè´Ÿæ‹…ã€‚</p>
<hr/>
<h2 data-id="heading-14">äº”ã€ç»“è®ºä¸å±•æœ›</h2>
<h3 data-id="heading-15">5.1 æ€»ä½“è¯„ä»·</h3>
<p>Soloæ¨¡å¼åœ¨æŠ€æœ¯é€‰å‹å’Œä»£ç ç”Ÿæˆé€Ÿåº¦æ–¹é¢è¡¨ç°ä¸é”™ï¼Œè‡ªåŠ¨è·Ÿéšæ¨¡å¼å’Œçœ‹AIå†™ä»£ç çš„ä½“éªŒå¾ˆæœ‰æ„æ€ã€‚ä½†åœ¨UIå®ç°ä¸Šæ˜¯ä¸ªçŸ­æ¿ï¼Œè™½ç„¶èƒ½è¯»å–UIè§„èŒƒæ–‡æ¡£ï¼Œä½†æ— æ³•æ ¹æ®è®¾è®¡è§„èŒƒç”Ÿæˆå¯¹åº”çš„ç»„ä»¶ï¼Œéœ€è¦å¤§é‡æ‰‹åŠ¨è°ƒæ•´ï¼Œæ‹‰ä½äº†æ•´ä½“æ•ˆç‡ã€‚</p>
<p><strong>è¯„åˆ†</strong>ï¼š72/100</p>
<ul>
<li>å¼€å‘æ•ˆç‡æå‡ï¼š85åˆ†ï¼ˆUIå®ç°éœ€è¦å¤§é‡æ‰‹åŠ¨è°ƒæ•´ï¼Œä½†ä»£ç ç”Ÿæˆå¿«ï¼‰</li>
<li>è‡ªåŠ¨è·Ÿéšæ¨¡å¼ï¼š90åˆ†ï¼ˆçœ‹AIå†™ä»£ç å¾ˆæœ‰æ„æ€ï¼‰</li>
<li>ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ï¼š75åˆ†</li>
<li>ä»£ç è´¨é‡ï¼š70åˆ†</li>
<li><strong>UIè§„èŒƒç†è§£èƒ½åŠ›ï¼š50åˆ†</strong>ï¼ˆå³ä½¿æä¾›è§„èŒƒæ–‡æ¡£ï¼Œä¹Ÿæ— æ³•ç”Ÿæˆå¯¹åº”ç»„ä»¶ï¼‰</li>
<li>æ˜“ç”¨æ€§ï¼š85åˆ†</li>
<li>åŠŸèƒ½å®Œæ•´æ€§ï¼š70åˆ†</li>
</ul>
<h3 data-id="heading-16">5.2 é¡¹ç›®å®Œæˆæƒ…å†µ</h3>
<p>å‰ç«¯50%ï¼šåŸºç¡€æ¶æ„å’Œæ ¸å¿ƒç»„ä»¶å®Œæˆï¼Œä¸»è¦é¡µé¢å’Œä¸šåŠ¡æµç¨‹åŸºæœ¬å®ç°ï¼Œä½†éƒ¨åˆ†åŠŸèƒ½ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ŒUIæ ·å¼ä¸è®¾è®¡è§„èŒƒå·®è·å¤§ï¼Œé”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–éœ€å®Œå–„ã€‚</p>
<p>åç«¯70%ï¼šæ ¸å¿ƒä¸šåŠ¡æ¨¡å—å®ç°ï¼ŒAIæœåŠ¡é›†æˆå’Œè®¤è¯ç³»ç»ŸåŸºæœ¬å®Œæˆï¼Œä½†äº‘å­˜å‚¨é›†æˆæœªå®Œæˆï¼Œæ”¯ä»˜åŠŸèƒ½éœ€è¿›ä¸€æ­¥æµ‹è¯•ï¼Œå¾ˆå¤šæ¨¡å—ä»£ç å†™å¥½äº†ä½†å¯èƒ½æœªå®Œå…¨æµ‹è¯•ã€‚</p>
<p>æ€»ä½“å®Œæˆåº¦çº¦60%ã€‚</p>
<h3 data-id="heading-17">5.3 ç»™å¼€å‘è€…çš„å»ºè®®</h3>
<p>Soloæ¨¡å¼æ˜¯è¾…åŠ©ï¼Œä¸æ˜¯æ›¿ä»£ã€‚æ ¸å¿ƒæŠ€æœ¯è¿˜æ˜¯è¦æŒæ¡ï¼Œä¸è¦è¿‡åº¦ä¾èµ–ã€‚</p>
<p>æŠ€æœ¯é€‰å‹é˜¶æ®µä½“éªŒä¸é”™ï¼Œèƒ½å¿«é€Ÿç»™å‡ºåˆç†çš„æŠ€æœ¯æ ˆå»ºè®®ã€‚è‡ªåŠ¨è·Ÿéšæ¨¡å¼å€¼å¾—è¯•è¯•ï¼Œçœ‹AIå†™ä»£ç çš„è¿‡ç¨‹èƒ½å­¦åˆ°ä¸å°‘ä¸œè¥¿ã€‚</p>
<p>UIå®ç°è¦äººå·¥ä»‹å…¥ï¼Œå³ä½¿ç»™äº†è®¾è®¡è§„èŒƒï¼ŒSoloæ¨¡å¼ä¹Ÿæ— æ³•æ ¹æ®è§„èŒƒç”Ÿæˆç»„ä»¶ï¼Œéœ€è¦å¤§é‡æ‰‹åŠ¨è°ƒæ•´ï¼Œè¿™ä¸ªè¦æœ‰å¿ƒç†å‡†å¤‡ã€‚ç”Ÿæˆçš„ä»£ç è¯­æ³•æ­£ç¡®ï¼Œä½†è§†è§‰æ•ˆæœå’Œç”¨æˆ·ä½“éªŒéœ€è¦äººå·¥å®¡æŸ¥ã€‚</p>
<hr/>
<h2 data-id="heading-18">å…­ã€å†™åœ¨æœ€å</h2>
<p>Soloæ¨¡å¼èƒ½æå‡å¼€å‘æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨æŠ€æœ¯é€‰å‹å’Œä»£ç ç”Ÿæˆæ–¹é¢ã€‚è‡ªåŠ¨è·Ÿéšæ¨¡å¼å’Œçœ‹AIå†™ä»£ç çš„ä½“éªŒä¸é”™ï¼Œæœ‰æ—¶å€™çœ‹ç€å®ƒå†™ä»£ç ï¼Œä¼šæƒ³"åŸæ¥å¯ä»¥è¿™æ ·å†™"ï¼Œèƒ½å­¦åˆ°ä¸€äº›æ–°ä¸œè¥¿ã€‚</p>
<p>ä½†åœ¨UIå®ç°ä¸Šè¿˜æœ‰æ˜æ˜¾çŸ­æ¿â€”â€”å³ä½¿ç»™äº†è®¾è®¡è§„èŒƒæ–‡æ¡£ï¼Œä¹Ÿæ— æ³•æ ¹æ®è§„èŒƒç”Ÿæˆå¯¹åº”ç»„ä»¶ï¼Œéœ€è¦å¤§é‡äººå·¥è°ƒæ•´ã€‚è¿™æ˜¯æœ€å¤§çš„ç—›ç‚¹ã€‚</p>
<p>Soloæ¨¡å¼æ˜¯å¾ˆå¥½çš„è¾…åŠ©ï¼Œä½†è¿˜ä¸èƒ½å®Œå…¨æ›¿ä»£å¼€å‘è€…ã€‚ç‰¹åˆ«æ˜¯åœ¨UIå®ç°è¿™ç§éœ€è¦ç²¾ç¡®ç†è§£è®¾è®¡æ„å›¾çš„åœºæ™¯ï¼Œäººå·¥ä»‹å…¥è¿˜æ˜¯å¿…é¡»çš„ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿåœ¨è€ƒè™‘ç”¨Soloæ¨¡å¼ï¼Œå»ºè®®å…ˆè¯•è¯•æŠ€æœ¯é€‰å‹å’Œè‡ªåŠ¨è·Ÿéšæ¨¡å¼ï¼Œçœ‹çœ‹AIå†™ä»£ç çš„è¿‡ç¨‹ã€‚ä½†UIå®ç°éƒ¨åˆ†ï¼Œè¿˜æ˜¯è¦æœ‰è‡ªå·±åŠ¨æ‰‹çš„å¿ƒç†å‡†å¤‡ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†æ‰‹åŠ¨å¯¹é½çŸ©å½¢äº†ï¼è¿™ä¸ªå¼€æºç¥å™¨è®© AI å¸®ä½ ç”»æ¶æ„å›¾ (Next-AI-Draw-IO ä½“éªŒ)]]></title>    <link>https://juejin.cn/post/7583921477613682723</link>    <guid>https://juejin.cn/post/7583921477613682723</guid>    <pubDate>2025-12-15T16:24:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477613682723" data-draft-id="7583892482598961167" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†æ‰‹åŠ¨å¯¹é½çŸ©å½¢äº†ï¼è¿™ä¸ªå¼€æºç¥å™¨è®© AI å¸®ä½ ç”»æ¶æ„å›¾ (Next-AI-Draw-IO ä½“éªŒ)"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½,Next.js"/> <meta itemprop="datePublished" content="2025-12-15T16:24:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sumAll"/> <meta itemprop="url" content="https://juejin.cn/user/2863547353939175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†æ‰‹åŠ¨å¯¹é½çŸ©å½¢äº†ï¼è¿™ä¸ªå¼€æºç¥å™¨è®© AI å¸®ä½ ç”»æ¶æ„å›¾ (Next-AI-Draw-IO ä½“éªŒ)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2863547353939175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sumAll
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:24:39.000Z" title="Mon Dec 15 2025 16:24:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šä½œä¸ºä¸€ä¸ªå¤©å¤©å’Œæ¶æ„å›¾æ‰“äº¤é“çš„å¼€å‘è€…ï¼Œæˆ‘å—å¤Ÿäº†åœ¨ Draw.io é‡ŒæŠŠæ—¶é—´æµªè´¹åœ¨â€œåƒç´ çº§å¯¹é½â€å’Œâ€œè¿çº¿å¾®è°ƒâ€ä¸Šã€‚ä»Šå¤©æ¨èçš„è¿™ä¸ªå¼€æºé¡¹ç›® <code>next-ai-draw-io</code>ï¼Œç›´æ¥æŠŠ Draw.io å’Œ LLM ç¼åˆåœ¨äº†ä¸€èµ·ã€‚ä¸ä»…èƒ½ä¸€å¥è¯ç”Ÿæˆæ¶æ„å›¾ï¼Œè¿˜èƒ½æŠŠä½ éšæ‰‹ç”»çš„ç™½æ¿è‰å›¾ç›´æ¥å˜æˆå¯ç¼–è¾‘çš„ä¸“ä¸šå›¾è¡¨ã€‚å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿå¥½ç”¨å—ï¼Ÿå¦‚ä½•æœ¬åœ°éƒ¨ç½²ï¼Ÿæœ¬æ–‡å¸¦ä½ ä¸€æ¢ç©¶ç«Ÿã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å¼•è¨€ï¼šé‚£ä¸ªæ·±å¤œï¼Œæˆ‘ä»¬åœ¨ä¸â€œå¯¹é½â€è¾ƒåŠ²</h2>
<p>ä½ æœ‰æ²¡æœ‰è¿‡è¿™æ ·çš„ç»å†ï¼Ÿ</p>
<p>è€æ¿è®©ä½ ç”»ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„å›¾ï¼Œæ ¸å¿ƒé€»è¾‘å…¶å®ä½ è„‘å­é‡Œæ—©å°±æœ‰äº†ï¼šä¸€ä¸ªç½‘å…³ï¼Œåé¢æŒ‚ä¸‰ä¸ªæœåŠ¡ï¼Œå†è¿ä¸ª Redis å’Œ MySQLã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“ä½ æ‰“å¼€ Draw.io (æˆ–è€… Visio/ProcessOn) æ—¶ï¼Œå™©æ¢¦å¼€å§‹äº†ï¼š</p>
<ul>
<li>è¿™ä¸ªçŸ©å½¢æ˜¯ä¸æ˜¯æ¯”é‚£ä¸ªå®½äº† 2pxï¼Ÿ</li>
<li>è¿™æ¡çº¿ä¸ºä»€ä¹ˆæ­»æ´»ä¸èƒ½å˜ç›´ï¼Ÿ</li>
<li>è¦æŠŠæ•´ä¸ªæ¶æ„å¾€å·¦ç§»ä¸€ç‚¹ï¼Œç»“æœé€‰ä¸­æ‰€æœ‰å…ƒç´ ä¸€æ‹–ï¼Œè¿çº¿å…¨ä¹±äº†â€¦â€¦</li>
</ul>
<p>åŸæœ¬ 10 åˆ†é’Ÿèƒ½æƒ³æ¸…æ¥šçš„æ¶æ„ï¼Œæœ€åèŠ±äº† 2 ä¸ªå°æ—¶åœ¨<strong>è°ƒæ•´ UI</strong> ä¸Šã€‚ä½œä¸ºæŠ€æœ¯äººï¼Œæˆ‘ä»¬åº”è¯¥æŠŠæ—¶é—´èŠ±åœ¨<strong>è®¾è®¡ç³»ç»Ÿ</strong>ä¸Šï¼Œè€Œä¸æ˜¯èŠ±åœ¨<strong>æ’ç‰ˆ</strong>ä¸Šã€‚</p>
<p>æœ€è¿‘ï¼Œåœ¨ GitHub ä¸Šå‘ç°äº†ä¸€ä¸ªåä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer"><strong>next-ai-draw-io</strong></a> çš„å¼€æºé¡¹ç›®ï¼Œå®ƒç²¾å‡†åœ°å‡»ä¸­äº†è¿™ä¸ªç—›ç‚¹ã€‚è¯•ç”¨å®Œä¹‹åï¼Œæˆ‘åªæƒ³è¯´ï¼š<strong>ç”Ÿäº§åŠ›å·¥å…·çš„æœªæ¥ï¼ŒçœŸçš„æ¥äº†ã€‚</strong></p>
<hr/>
<h2 data-id="heading-1">ä¸»è§’ç™»åœºï¼šNext-AI-Draw-IO æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ª <strong>Next.js + AI + Draw.io</strong> çš„è¶…çº§ç¼åˆæ€ªã€‚</p>
<p>å¸‚é¢ä¸Šæœ‰å¾ˆå¤šâ€œæ–‡å­—ç”Ÿæˆæµç¨‹å›¾â€çš„å·¥å…·ï¼ˆæ¯”å¦‚ Mermaidï¼‰ï¼Œä½†å®ƒä»¬ç”Ÿæˆçš„å›¾å¾€å¾€<strong>åªè¯»ä¸å¯æ”¹</strong>ï¼Œæˆ–è€…æ ·å¼éå¸¸ç®€é™‹ã€‚</p>
<p><code>next-ai-draw-io</code> çš„æ€æ‰‹é”åœ¨äºï¼š<strong>å®ƒç”Ÿæˆçš„æ˜¯æ ‡å‡†çš„ã€å¯ç¼–è¾‘çš„ Draw.io æºæ–‡ä»¶ (XML)ã€‚</strong></p>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ol>
<li><strong>ä½ å¯ä»¥æ”¹</strong>ï¼šAI ç”»å®Œå¤§æ¦‚ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å¾®è°ƒç»†èŠ‚ï¼Œåˆ©ç”¨ Draw.io å¼ºå¤§çš„ç¼–è¾‘èƒ½åŠ›ã€‚</li>
<li><strong>ä¸æŒ‘æ¨¡å‹</strong>ï¼šå®ƒæ”¯æŒ AWS Bedrock, OpenAI, Anthropic (Claude), Google Gemini, Azure OpenAI, Ollama, OpenRouter, DeepSeek ä»¥åŠ SiliconFlow ç­‰å¤šç§ Providerã€‚</li>
<li><strong>å®Œå…¨å¼€æº</strong>ï¼šä»£ç åœ¨ä½ æ‰‹ä¸­ï¼Œç§æœ‰åŒ–éƒ¨ç½²éå¸¸æ–¹ä¾¿ï¼Œä¸ç”¨æ‹…å¿ƒå…¬å¸æ¶æ„å›¾æ³„éœ²ç»™ç¬¬ä¸‰æ–¹ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">å®æµ‹ï¼šè§è¯å¥‡è¿¹çš„ä¸‰ä¸ªæ—¶åˆ»</h2>
<p>ä¸ºäº†éªŒè¯å®ƒæ˜¯ä¸æ˜¯"PPT éª—å±€"ï¼Œæˆ‘è¿›è¡Œäº†ä¸‰ä¸ªåœºæ™¯çš„æ·±åº¦å®æµ‹ï¼Œå¹¶è®°å½•äº†æ¯æ¬¡æµ‹è¯•çš„è¯¦ç»†è¿‡ç¨‹å’Œç»“æœã€‚</p>
<blockquote>
<p><strong>æµ‹è¯•ç¯å¢ƒè¯´æ˜</strong>ï¼š
æœ¬æ¬¡æµ‹è¯•ä½¿ç”¨ <strong>SiliconFlow (ç¡…åŸºæµåŠ¨)</strong> æä¾›çš„ API æœåŠ¡ï¼Œæ¨¡å‹é€‰ç”¨ <strong>Kimi-K2-Thinking</strong>ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">AI_PROVIDER=siliconflow
OPENAI_BASE_URL=https://api.siliconflow.cn/v1
OPENAI_API_KEY=sk-******
AI_MODEL=moonshotai/Kimi-K2-Thinking
</code></pre>
</blockquote>
<h3 data-id="heading-3">æ—¶åˆ» 1ï¼šä¸€å¥å’’è¯­ï¼Œå¹³åœ°èµ·é«˜æ¥¼ (Text-to-Diagram)</h3>
<p><strong>ğŸ“ æµ‹è¯•æ¡ˆä¾‹ Aï¼šå¤æ‚äº‘æ¶æ„å›¾</strong></p>
<p>æˆ‘è¾“å…¥äº†è¿™æ ·ä¸€æ®µ Promptï¼š</p>
<blockquote>
<p>"å¸®æˆ‘ç”»ä¸€ä¸ªé«˜å¯ç”¨çš„ AWS ç”µå•†ç³»ç»Ÿæ¶æ„å›¾ã€‚åŒ…å« Route53, CloudFront, ALB, ä¸€ä¸ª Auto Scaling Group é‡ŒåŒ…å« 3 ä¸ª EC2 å®ä¾‹ï¼Œåç«¯è¿æ¥ RDS ä¸»ä»æ•°æ®åº“å’Œ ElastiCacheã€‚"</p>
</blockquote>
<p><strong>â±ï¸ ç”Ÿæˆæ—¶é—´</strong>ï¼š12 ç§’
<strong>ğŸ“Š ç”Ÿæˆç»“æœ</strong>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a3f08c193e54fbfb4559d264f2f568d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=DuZjnkv8qIa4wpgpvvzpbDfmFlg%3D" alt="step_01.jpeg" loading="lazy"/></p>
<p><strong>ğŸ¯ å®é™…æ•ˆæœï¼š</strong></p>
<ol>
<li>âœ… <strong>é€»è¾‘æ­£ç¡®æ€§</strong>ï¼šæµé‡è·¯å¾„ Route53 â†’ CloudFront â†’ ALB â†’ EC2 â†’ RDS/ElastiCache æ¸…æ™°å‡†ç¡®ã€‚</li>
<li>âœ… <strong>å¸ƒå±€åˆç†</strong>ï¼šç»„ä»¶æ’åˆ—æœ‰åºï¼Œæ²¡æœ‰æ‚ä¹±çš„è¿çº¿ã€‚</li>
<li>âš ï¸ <strong>å°ç‘•ç–µ</strong>ï¼šé»˜è®¤ç»„ä»¶æ ·å¼è¾ƒä¸ºæœ´ç´ ã€‚</li>
</ol>
<p>æ¥ç€ï¼Œæˆ‘è®©å®ƒè¿›è¡Œç²¾ä¿®ï¼š</p>
<blockquote>
<p>"å¸®æˆ‘ä¼˜åŒ–ç²¾ä¿®è¿™ä¸ªæ¶æ„å›¾ï¼ŒAWS ç»„ä»¶ä½¿ç”¨ AWS çš„ç»„ä»¶ Logoã€‚"</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9b7ff87b3864f2384fa83f0756c5c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=R9pdT3zQX3Tc1pvzwKPctnLEo3o%3D" alt="step_02.png" loading="lazy"/></p>
<p><strong>æ•ˆæœç«‹ç«¿è§å½±</strong>ï¼šæ‰€æœ‰ç»„ä»¶ç¬é—´æ›¿æ¢ä¸ºå®˜æ–¹ AWS å›¾æ ‡ï¼Œä¸“ä¸šåº¦ç›´æ¥æ‹‰æ»¡ã€‚</p>
<hr/>
<p><strong>ğŸ“ æµ‹è¯•æ¡ˆä¾‹ Bï¼šå¾®æœåŠ¡æ¶æ„å›¾</strong></p>
<p>Promptï¼š</p>
<blockquote>
<p>"ç”»ä¸€ä¸ªè®¢å•ç³»ç»Ÿçš„å¾®æœåŠ¡æ¶æ„ï¼šAPI Gateway ä½œä¸ºå…¥å£ï¼Œåé¢è¿æ¥è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ã€é€šçŸ¥æœåŠ¡ã€‚æœåŠ¡é—´é€šè¿‡ Kafka æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„ PostgreSQL æ•°æ®åº“ã€‚"</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0620d46802394a87a515843de72c0a23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=aOhy%2FVe3ee0g6acrpGFKDvBbc%2BA%3D" alt="step_03.png" loading="lazy"/></p>
<p><strong>ğŸ¯ äº®ç‚¹åˆ†æï¼š</strong></p>
<ul>
<li>âœ… <strong>æ¶æ„ç†è§£æ·±åˆ»</strong>ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶å±…ä¸­æ”¾ç½® Kafkaï¼Œä½“ç°äº†"è§£è€¦"çš„æ ¸å¿ƒæ€æƒ³ã€‚</li>
<li>âœ… <strong>å›¾ä¾‹è‡ªåŠ¨ç”Ÿæˆ</strong>ï¼šå®çº¿è¡¨ç¤ºåŒæ­¥è°ƒç”¨ï¼Œè™šçº¿è¡¨ç¤ºå¼‚æ­¥æ¶ˆæ¯ï¼Œç»†èŠ‚æ»¡åˆ†ã€‚</li>
<li>âœ… <strong>æ™ºèƒ½å›¾æ ‡</strong>ï¼šAPI ç½‘å…³ã€ä¸šåŠ¡æœåŠ¡ã€æ•°æ®åº“è‡ªåŠ¨åŒºåˆ†ï¼Œè§†è§‰å±‚æ¬¡ä¸°å¯Œã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-4">æ—¶åˆ» 2ï¼šè‰å›¾å¤æ´»æœ¯ (Image-to-Diagram) ğŸ”¥</h3>
<p>è¿™æ˜¯æˆ‘è§‰å¾—<strong>æœ€ç‚¸è£‚</strong>çš„åŠŸèƒ½ã€‚</p>
<p><strong>ğŸ“ æµ‹è¯•æ¡ˆä¾‹ï¼šæ‰‹ç»˜è‰å›¾è¯†åˆ«</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5397071afe5433fabae3274e435d281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=lINnVNcEVxr59%2BzJbX88yCUimPQ%3D" alt="step_05_draft.png" loading="lazy"/></p>
<p><strong>ğŸ–¼ï¸ åŸå§‹è‰å›¾</strong>ï¼š</p>
<ul>
<li>éšæ‰‹ç”»çš„çŸ©å½¢å’Œè±å½¢ï¼Œçº¿æ¡æ­ªæ­ªæ‰­æ‰­ã€‚</li>
<li>æ‰‹å†™æ–‡å­—æ½¦è‰ã€‚</li>
<li>ç®­å¤´æŒ‡å‘éšæ„ã€‚</li>
</ul>
<p><strong>â±ï¸ è¯†åˆ« + è½¬æ¢æ—¶é—´</strong>ï¼š18 ç§’</p>
<p><strong>ğŸ¯ AI è½¬æ¢ç»“æœï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7068da74c2340ada98f3fd20901bd84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=zvBSWlgc8q59pFCxGbHQyvhkGSQ%3D" alt="step_05.png" loading="lazy"/></p>
<blockquote>
<p>æ³¨æ„ï¼šè¿™è¾¹çš„ AI Model è®¾ç½®ä¸ºäº† <code>stepfun-ai/step3</code>ï¼Œè¯¥æ¨¡å‹æ”¯æŒè§†è§‰å¤„ç†ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">æ—¶åˆ» 3ï¼šä½ å¯ä»¥æ°¸è¿œç›¸ä¿¡"ç”²æ–¹"çš„ä¿®æ”¹æ„è§ (Chat-to-Edit)</h3>
<p>AI ç”Ÿæˆçš„å›¾ä¸å¯èƒ½ä¸€æ­¥åˆ°ä½ã€‚è¿™æ—¶å€™ï¼Œå®ƒçš„<strong>å¯¹è¯ä¿®æ”¹</strong>åŠŸèƒ½å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<p><strong>ğŸ“ æµ‹è¯•æ¡ˆä¾‹ï¼šé€æ­¥è¿­ä»£å®Œå–„æ¶æ„å›¾</strong></p>
<p><strong>åˆå§‹å›¾</strong>ï¼šç®€å•çš„"ç”¨æˆ· â†’ Web æœåŠ¡å™¨ â†’ æ•°æ®åº“"ä¸‰å±‚æ¶æ„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0fd5402c98d42299b865aa725a605da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=pyhZqV5OA9IQJoiATt9fIiQOHQI%3D" alt="step_06.png" loading="lazy"/></p>
<p><strong>è¿­ä»£è¿‡ç¨‹è®°å½•</strong>ï¼š</p>
<ol>
<li><strong>"åœ¨ Web æœåŠ¡å™¨å’Œæ•°æ®åº“ä¹‹é—´åŠ ä¸€å±‚ Redis ç¼“å­˜"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0be204708e8498387857e72a4f60024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=3tG9RgVLSlRjrzWcQKsCSro1sBc%3D" alt="step_06_01.png" loading="lazy"/>
âœ… è‡ªåŠ¨æ’å…¥ Redis èŠ‚ç‚¹ï¼Œå¹¶è°ƒæ•´è¿çº¿å¸ƒå±€ã€‚</p>
<ol start="2">
<li><strong>"æŠŠæ•°æ®åº“æ”¹æˆä¸»ä»æ¶æ„ï¼Œä¸€ä¸»ä¸¤ä»"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffe418f729014143bc2d1555270516dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=6G0kP%2Fu3aghkXupqUDjEr4ctCzc%3D" alt="step_06_02.png" loading="lazy"/>
âœ… æ•°æ®åº“åˆ†è£‚ä¸ºä¸€ä¸»ä¸¤ä»ï¼Œæ ‡æ³¨æ¸…æ™°ã€‚</p>
<ol start="3">
<li><strong>"ç»™ Web æœåŠ¡å™¨åŠ ä¸ªè´Ÿè½½å‡è¡¡å™¨"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ceedfbe9dea430fb970709cf979515f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=jlH%2FYjB6hZEBFTuK7BuWlc23w7Y%3D" alt="step_06_03.jpeg" loading="lazy"/>
âœ… å‰ç½®æ·»åŠ  LBsã€‚</p>
<ol start="4">
<li><strong>"æŠŠæ ¸å¿ƒç»„ä»¶ï¼ˆæ•°æ®åº“å’Œ Redisï¼‰çš„èƒŒæ™¯è‰²æ”¹æˆçº¢è‰²ï¼Œè¡¨ç¤ºå…³é”®èµ„äº§"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f79159ea6d44c7999362e1aed2c0b51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=ejxsdhAfiHMpfi4NuuqiXOivRyk%3D" alt="step_06_04.png" loading="lazy"/>
âœ… ç²¾å‡†è¯†åˆ«"æ ¸å¿ƒç»„ä»¶"ï¼Œé¢œè‰²ä¿®æ”¹æ­£ç¡®ã€‚</p>
<ol start="5">
<li><strong>"åœ¨å›¾çš„å³ä¸Šè§’åŠ ä¸€ä¸ªå›¾ä¾‹ï¼Œè¯´æ˜é¢œè‰²å«ä¹‰"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c96297ccc6ae4721bd172073515d50ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=Pjn98L3IZtlUAu67j8Cm3jspd8w%3D" alt="step_06_05.png" loading="lazy"/>
ğŸ”¥ æ™ºèƒ½ç”Ÿæˆå›¾ä¾‹è¡¨æ ¼ï¼Œè§£é‡Šé¢œè‰²å¯¹åº”å…³ç³»ã€‚</p>
<p><strong>ğŸ’¡ æ ¸å¿ƒä»·å€¼</strong>ï¼š</p>
<ul>
<li><strong>ä¸Šä¸‹æ–‡è®°å¿†</strong>ï¼šå®ƒæ¸…æ¥šè®°å¾—ä¹‹å‰çš„ä¿®æ”¹å†å²ã€‚</li>
<li><strong>æ¨¡ç³ŠæŒ‡ä»¤ç†è§£</strong>ï¼šæ— éœ€ç²¾ç¡®åæ ‡ï¼Œåªéœ€è¯´"åŠ ä¸ªXX"ï¼Œå®ƒè‡ªå·±çŸ¥é“è¯¥æ”¾å“ªã€‚</li>
<li><strong>æ™ºèƒ½é¿è®©</strong>ï¼šæ–°å¢å…ƒç´ æ—¶ä¼šè‡ªåŠ¨è°ƒæ•´å‘¨å›´ç»„ä»¶ï¼Œé¿å…é‡å ã€‚</li>
</ul>
<hr/>
<p><strong>ğŸ¬ å°ç»“ï¼šä¸‰ä¸ªæ—¶åˆ»çš„æ ¸å¿ƒä»·å€¼</strong></p>





























<table><thead><tr><th>åŠŸèƒ½</th><th>ä¼ ç»Ÿæ–¹å¼ç—›ç‚¹</th><th>AI æ–¹æ¡ˆä¼˜åŠ¿</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Text-to-Diagram</td><td>ä»é›¶å¼€å§‹ç”»ï¼Œæ‰¾å›¾æ ‡æ‰¾åŠå¤©</td><td>15 ç§’ç”Ÿæˆåº•ç¨¿ï¼Œ90% å·¥ä½œé‡æ¶ˆå¤±</td><td>å¿«é€ŸåŸå‹ã€æ–‡æ¡£é…å›¾</td></tr><tr><td>Image-to-Diagram</td><td>ç™½æ¿å†…å®¹æ— æ³•ç¼–è¾‘å’Œç‰ˆæœ¬æ§åˆ¶</td><td>è‰å›¾ç§’å˜å¯ç¼–è¾‘æ–‡ä»¶</td><td>ä¼šè®®è®°å½•ã€å¤´è„‘é£æš´</td></tr><tr><td>Chat-to-Edit</td><td>æ¯æ¬¡æ”¹åŠ¨éƒ½è¦æ‰‹åŠ¨æ‹–æ‹½è°ƒæ•´</td><td>è‡ªç„¶è¯­è¨€æ§åˆ¶ï¼ŒAI è‡ªåŠ¨æ’ç‰ˆ</td><td>è¿­ä»£ä¼˜åŒ–ã€å®¢æˆ·åé¦ˆ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">æŠ€æœ¯æå®¢è§†è§’ï¼šå®ƒæ€ä¹ˆåšåˆ°çš„ï¼Ÿ</h2>
<p>ä½œä¸ºæŠ€æœ¯åšä¸»ï¼Œæˆ‘ä»¬ä¸èƒ½åªçœ‹çƒ­é—¹ã€‚æ·±æŒ–ä¸€ä¸‹å®ƒçš„å®ç°åŸç†ï¼Œä½ ä¼šå‘ç°ä½œè€…åœ¨ <strong>Prompt Engineering</strong> å’Œ <strong>å·¥ç¨‹åŒ–è½åœ°</strong> ä¸Šåšäº†å¤§é‡ç²¾ç»†çš„å·¥ä½œã€‚</p>
<h3 data-id="heading-7">1. æ ¸å¿ƒæ¶æ„ï¼šNext.js + AI SDK + Draw.io Embed</h3>
<p>æ•´ä¸ªé¡¹ç›®çš„æ¶æ„éå¸¸æ¸…æ™°ï¼Œå…¸å‹çš„ <strong>RAG (Retrieval-Augmented Generation)</strong> å˜ä½“åº”ç”¨ï¼š</p>
<ul>
<li><strong>Frontend</strong>: åŸºäº <strong>Next.js 15 (App Router)</strong> æ„å»ºï¼Œä½¿ç”¨ <code>react-drawio</code> ç»„ä»¶å°† Draw.io ç¼–è¾‘å™¨åµŒå…¥é¡µé¢ã€‚</li>
<li><strong>State Management</strong>: <code>DiagramContext</code> æ˜¯è¿æ¥ AI å’Œ Draw.io çš„æ¡¥æ¢ã€‚å®ƒè´Ÿè´£ç›‘å¬ Draw.io çš„äº‹ä»¶ï¼ˆå¦‚ XML å˜æ›´ï¼‰ï¼Œå¹¶å°†å½“å‰çš„ XML çŠ¶æ€æ³¨å…¥åˆ° AI çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</li>
<li><strong>Backend</strong>: ä½¿ç”¨ Vercel çš„ <strong>AI SDK</strong> (<code>streamText</code>) ç»Ÿä¸€å°è£…äº† OpenAI, Anthropic, Bedrock, DeepSeek ç­‰åå‡ ç§æ¨¡å‹æ¥å£ã€‚</li>
</ul>
<h3 data-id="heading-8">2. æ ¸å¿ƒåŸç†ï¼šDiagram as Code (XML)</h3>
<p>Draw.io çš„å›¾è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€æ®µå‹ç¼©çš„ XML å­—ç¬¦ä¸² (<code>mxGraphModel</code>)ã€‚AI å¹¶ä¸æ˜¯åœ¨"ç”»ç”»"ï¼Œè€Œæ˜¯åœ¨<strong>å†™ä»£ç </strong>ã€‚</p>
<p>é¡¹ç›®çš„æ ¸å¿ƒåœ¨äºè®© LLM ç†è§£å¹¶ç”Ÿæˆè¿™ç§ç‰¹å®šçš„ XML ç»“æ„ã€‚</p>
<h3 data-id="heading-9">3. Prompt Engineering çš„è‰ºæœ¯ (<code>lib/system-prompts.ts</code>)</h3>
<p>è¿™æ˜¯æ•´ä¸ªé¡¹ç›®æœ€å€¼é’±çš„éƒ¨åˆ†ã€‚ä½œè€…è®¾è®¡äº†ä¸€å¥—å¤æ‚çš„ System Promptï¼Œæ•™ä¼š LLMï¼š</p>
<ol>
<li><strong>åæ ‡ç³»ç»Ÿ</strong>ï¼šå¦‚ä½•è®¡ç®— <code>mxGeometry</code> çš„ x/y åæ ‡ï¼Œé¿å…èŠ‚ç‚¹é‡å ã€‚</li>
<li><strong>XML è§„èŒƒ</strong>ï¼šä¸¥æ ¼é™åˆ¶ <code>mxCell</code> çš„å±‚çº§ç»“æ„ï¼Œå¼ºåˆ¶è¦æ±‚ ID å”¯ä¸€æ€§ã€‚</li>
<li><strong>æ ·å¼å®šä¹‰</strong>ï¼šé¢„è®¾äº† AWSã€Azure ç­‰å›¾æ ‡åº“çš„æ ·å¼ä»£ç ï¼Œè®©ç”Ÿæˆçš„å›¾è¡¨ä¸è‡³äºå¤ªä¸‘ã€‚</li>
</ol>
<h3 data-id="heading-10">4. ç‹¬ç‰¹çš„å·¥å…·è°ƒç”¨æœºåˆ¶ (<code>Tool Calling</code>)</h3>
<p>ä¸ºäº†è§£å†³"å…¨é‡ç”Ÿæˆå¤ªæ…¢"çš„é—®é¢˜ï¼Œé¡¹ç›®å®šä¹‰äº†ä¸¤ä¸ªæ ¸å¿ƒå·¥å…·ï¼š</p>
<ul>
<li>
<p><strong><code>display_diagram</code> (å…¨é‡ç”Ÿæˆ)</strong>ï¼š</p>
<ul>
<li>ç”¨äºä»é›¶åˆ›å»ºæ–°å›¾ï¼Œæˆ–è€…è¿›è¡Œå¤§èŒƒå›´é‡æ„ã€‚</li>
<li>AI ä¼šè¾“å‡ºå®Œæ•´çš„ <code>&lt;mxGraphModel&gt;...&lt;/mxGraphModel&gt;</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>edit_diagram</code> (å¢é‡ä¿®æ”¹)</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯<strong>æœ€ç²¾å½©çš„è®¾è®¡</strong>ã€‚</li>
<li>å½“ä½ è¦æ±‚"æŠŠçº¢è‰²æ”¹æˆè“è‰²"æ—¶ï¼ŒAI <strong>ä¸ä¼š</strong>é‡æ–°ç”Ÿæˆå‡ åƒè¡Œçš„ XMLã€‚</li>
<li>ç›¸åï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ª <code>search</code> å’Œ <code>replace</code> çš„ JSON å¯¹è±¡ã€‚</li>
<li>å‰ç«¯åˆ©ç”¨æ­£åˆ™åŒ¹é…ï¼Œåªæ›¿æ¢ XML ä¸­å˜åŠ¨çš„é‚£å‡ è¡Œã€‚è¿™æå¤§åœ°èŠ‚çœäº† Tokenï¼Œå¹¶æ˜¾è‘—é™ä½äº†å»¶è¿Ÿã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">5. Token ä¼˜åŒ–çš„é»‘ç§‘æŠ€ (<code>Context Pruning</code>)</h3>
<p>Draw.io çš„ XML éå¸¸å•°å—¦ï¼Œä¸€ä¸ªå¤æ‚çš„å›¾è½»æ¾çªç ´ 10k Tokenã€‚å¦‚æœæ¯æ¬¡å¯¹è¯éƒ½æŠŠå†å² XML å¸¦ä¸Šï¼ŒContext Window ç¬é—´å°±ä¼šçˆ†æ»¡ã€‚</p>
<p>åœ¨ <code>app/api/chat/route.ts</code> ä¸­ï¼Œä½œè€…å®ç°äº†ä¸€ä¸ª <code>replaceHistoricalToolInputs</code> å‡½æ•°ï¼š</p>
<ul>
<li>åœ¨å‘é€ç»™ LLM ä¹‹å‰ï¼Œ<strong>å¼ºè¡Œå‰”é™¤</strong>å†å²å¯¹è¯ä¸­ç”Ÿæˆçš„ XML å†…å®¹ã€‚</li>
<li>åªä¿ç•™<strong>å½“å‰æœ€æ–°çš„</strong> XML ä½œä¸º Contextã€‚</li>
<li>è¿™æ ·ï¼Œæ— è®ºå¯¹è¯å¤šå°‘è½®ï¼ŒContext çš„æ¶ˆè€—å§‹ç»ˆç»´æŒåœ¨ä¸€ä¸ªå¯æ§çš„èŒƒå›´å†…ã€‚</li>
</ul>
<h3 data-id="heading-12">6. å¤šæ¨¡å‹é€‚é… (<code>lib/ai-providers.ts</code>)</h3>
<p>é¡¹ç›®æ²¡æœ‰ç»‘å®šæ­»ä»»ä½•ä¸€å®¶æ¨¡å‹å‚å•†ã€‚å®ƒé€šè¿‡ä¸€ä¸ªé€‚é…å±‚ï¼Œç»Ÿä¸€äº†ä¸åŒæ¨¡å‹çš„å‚æ•°å·®å¼‚ï¼š</p>
<ul>
<li>å¯¹äº <strong>Anthropic</strong>ï¼Œå®ƒå¼€å¯äº† <code>thinking</code> æ¨¡å¼ä»¥å¢å¼ºé€»è¾‘èƒ½åŠ›ã€‚</li>
<li>å¯¹äº <strong>DeepSeek</strong>ï¼Œå®ƒé€‚é…äº† caching æœºåˆ¶ã€‚</li>
<li>å¯¹äº <strong>OpenAI o1/o3</strong>ï¼Œå®ƒè‡ªåŠ¨è°ƒæ•´ <code>reasoning_effort</code>ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-13">å¦‚ä½•æ‹¥æœ‰å®ƒï¼Ÿï¼ˆæœ¬åœ°éƒ¨ç½²æŒ‡å—ï¼‰</h2>
<p>ä½œä¸ºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæœ€çˆ½çš„å½“ç„¶æ˜¯<strong>ç§æœ‰åŒ–éƒ¨ç½²</strong>ã€‚æ—¢çœé’±ï¼Œåˆå®‰å…¨ã€‚</p>
<p>ä½œè€…æä¾›äº†ä¸¤ç§ä¸»æµçš„éƒ¨ç½²æ–¹å¼ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½é€‰æ‹©ã€‚</p>
<h3 data-id="heading-14">æ–¹æ¡ˆä¸€ï¼šæºç éƒ¨ç½²ï¼ˆé€‚åˆå‰ç«¯å¼€å‘è€…ï¼‰</h3>
<p>å¦‚æœä½ æƒ³äºŒæ¬¡å¼€å‘ï¼Œæˆ–è€…å•çº¯å–œæ¬¢æŠ˜è…¾ä»£ç ï¼Œå¯ä»¥é€‰æ‹©è¿™ç§æ–¹å¼ã€‚</p>
<ol>
<li>
<p><strong>æ‹‰å–ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/DayuanJiang/next-ai-draw-io
<span class="hljs-built_in">cd</span> next-ai-draw-io
</code></pre>
</li>
<li>
<p><strong>å®‰è£…ä¾èµ–</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install
</code></pre>
</li>
<li>
<p><strong>é…ç½®ç¯å¢ƒå˜é‡</strong>ï¼š
å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> env.example .env.local
</code></pre>
<p>ç¼–è¾‘ <code>.env.local</code>ï¼Œå¡«å…¥ä½ çš„ API Keyã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-env" lang="env">AI_PROVIDER=openai
AI_MODEL=gpt-4o
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_API_KEY=sk-xxxxxx
</code></pre>
</li>
<li>
<p><strong>å¯åŠ¨æœåŠ¡</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm run dev
</code></pre>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>http://localhost:3000</code> å³å¯ã€‚</p>
</li>
</ol>
<h3 data-id="heading-15">æ–¹æ¡ˆäºŒï¼šDocker éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰</h3>
<p>å¦‚æœä½ ä¸æƒ³å®‰è£… Node.js ç¯å¢ƒï¼Œåªæƒ³å¿«é€Ÿç”¨èµ·æ¥ï¼ŒDocker æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p>
<p>ç¡®ä¿ä½ å·²ç»å®‰è£…äº† Dockerï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€è¡Œå‘½ä»¤å¯åŠ¨ (è®°å¾—æ›¿æ¢ä½ çš„ API Key)</span>
docker run -d -p 3000:3000 \
  -e AI_PROVIDER=openai \
  -e AI_MODEL=gpt-4o \
  -e OPENAI_API_KEY=sk-xxxxxx \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>å¦‚æœä½ æƒ³é…åˆ <strong>Ollama</strong> ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼ˆå®Œå…¨å…è´¹ï¼Œé€‚åˆé«˜æ€§èƒ½ç”µè„‘ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…åˆ Ollama æœ¬åœ°è¿è¡Œ</span>
docker run -d -p 3000:3000 \
  -e AI_PROVIDER=ollama \
  -e AI_MODEL=llama3 \
  -e OLLAMA_BASE_URL=http://host.docker.internal:11434 \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p><em>(æ³¨ï¼šæœ¬åœ°æ¨¡å‹ç”Ÿæˆ XML çš„ç¨³å®šæ€§ä¸å¦‚ GPT-4oï¼Œå¯èƒ½éœ€è¦å¤šè¯•å‡ æ¬¡)</em></p>
<hr/>
<h2 data-id="heading-16">å†·é™çš„æ€è€ƒï¼šä¼˜ç¼ºç‚¹åˆ†æ</h2>
<p><strong>âœ… ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æå¤§æå‡èµ·æ­¥é€Ÿåº¦</strong>ï¼šä» 0 åˆ° 1 çš„è¿‡ç¨‹è¢«å‹ç¼©åˆ°äº†å‡ ç§’é’Ÿã€‚</li>
<li><strong>äº¤äº’ä½“éªŒæä½³</strong>ï¼šåŸºäº Next.js çš„ UI å“åº”éå¸¸å¿«ï¼Œæ‹–æ‹½æ‰‹æ„ŸåŸç”Ÿã€‚</li>
<li><strong>ç‰ˆæœ¬æ§åˆ¶ (History)</strong>ï¼šAI æ”¹ä¹±äº†ï¼Ÿæ²¡äº‹ï¼Œå®ƒå†…ç½®äº†ç‰ˆæœ¬å†å²ï¼Œéšæ—¶å›æ»šã€‚</li>
</ul>
<p><strong>âŒ å±€é™æ€§ï¼š</strong></p>
<ul>
<li><strong>å¤æ‚é€»è¾‘æ˜“â€œå¹»è§‰â€</strong>ï¼šå½“èŠ‚ç‚¹è¶…è¿‡ 20+ æ—¶ï¼ŒAI æœ‰æ—¶ä¼šæŠŠçº¿è¿é”™ï¼Œæˆ–è€…é‡å åœ¨ä¸€èµ·ã€‚</li>
<li><strong>Token æ¶ˆè€—å¤§</strong>ï¼šå¦‚æœä½ ç”¨ GPT-4o ç”»è¶…å¤§å›¾ï¼ŒToken è´¹ç”¨åœ¨ç‡ƒçƒ§ã€‚</li>
<li><strong>éè®¾è®¡å¸ˆ</strong>ï¼šå®ƒç”Ÿæˆçš„å›¾åâ€œå·¥ç¨‹å¸ˆå®¡ç¾â€ï¼Œæ•´é½ä½†ä¸å¤Ÿé…·ç‚«ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-17">ç»“è¯­ï¼šæœªæ¥çš„ç»˜å›¾æ–¹å¼</h2>
<p><code>next-ai-draw-io</code> å¹¶ä¸æ˜¯è¦å–ä»£æ¶æ„å¸ˆã€‚ç›¸åï¼Œå®ƒè®©æˆ‘ä»¬ä»ç¹ççš„ç»˜å›¾åŠ³åŠ¨ä¸­è§£è„±å‡ºæ¥ï¼Œå›å½’æ¶æ„è®¾è®¡çš„æœ¬è´¨ã€‚</p>
<p>åœ¨è¿™ä¸ª AI è¾…åŠ©ç¼–ç¨‹ (Copilot) å·²ç»æ™®åŠçš„æ—¶ä»£ï¼Œ<strong>AI è¾…åŠ©ç»˜å›¾</strong> å¿…ç„¶æ˜¯ä¸‹ä¸€ä¸ªçˆ†å‘ç‚¹ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿå—å¤Ÿäº†åœ¨é‚£å¯¹é½åƒç´ ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªé¡¹ç›®ã€‚å“ªæ€•åªæ˜¯ç”¨å®ƒæ¥ç”Ÿæˆä¸€ä¸ªåº•ç¨¿ï¼Œä¹Ÿèƒ½è®©ä½ çš„æ‘¸é±¼æ—¶é—´å¤šå‡ºåŠå°æ—¶ã€‚ğŸ˜‰</p>
<p><strong>ğŸ”— é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer">github.com/DayuanJiangâ€¦</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d5798a536834a69a62933238dedbb75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=47kDXGp%2Ba4HMc1N%2B7v3raiSpet8%3D" alt="4_result.png" loading="lazy"/></p>
<hr/>
<p><em>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€è½¬å‘ï¼Œå¹¶åœ¨è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼šä½ å¹³æ—¶æœ€å¤´ç–¼ç”»å“ªç§å›¾ï¼Ÿ</em></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025OpenTinyæ˜Ÿå…‰ShowTimeï¼å¹´åº¦è´¡çŒ®è€…å¾é›†å¯åŠ¨ï¼]]></title>    <link>https://juejin.cn/post/7584655946086367278</link>    <guid>https://juejin.cn/post/7584655946086367278</guid>    <pubDate>2025-12-17T10:00:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584655946086367278" data-draft-id="7584652662328066098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025OpenTinyæ˜Ÿå…‰ShowTimeï¼å¹´åº¦è´¡çŒ®è€…å¾é›†å¯åŠ¨ï¼"/> <meta itemprop="keywords" content="Vue.js,ä½ä»£ç ,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T10:00:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTinyç¤¾åŒº"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025OpenTinyæ˜Ÿå…‰ShowTimeï¼å¹´åº¦è´¡çŒ®è€…å¾é›†å¯åŠ¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTinyç¤¾åŒº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:00:23.000Z" title="Wed Dec 17 2025 10:00:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æºæ‰‹å…±åˆ›ï¼Œè‡´æ•¬ä¸å‡¡ï¼</p>
<p>2025å¹´ï¼ŒOpenTinyæŒç»­åœ¨å‰ç«¯å¼€æºé¢†åŸŸæ‰æ ¹ï¼Œæ¯ä¸€ä½å¼€å‘è€…éƒ½æ˜¯æ¨åŠ¨é¡¹ç›®å…±åŒå‰è¡Œçš„å®è´µåŠ›é‡ã€‚ä»bugä¿®å¤ï¼Œåˆ°æŠ€æœ¯æ¢è®¨ï¼›ä»å‚ä¸å¼€æºæ´»åŠ¨ï¼Œåˆ°è¾“å‡ºæŠ€æœ¯æ–‡ç« ï¼›ä»ä½¿ç”¨é¡¹ç›®ï¼Œåˆ°å‚ä¸å…±å»ºï¼Œæ¯ä¸€æ­¥è·¨è¶Šï¼Œéƒ½å‡èšäº†å¼€å‘è€…çš„æ™ºæ…§ä¸æ±—æ°´ã€‚è‡´æ•¬æ‰€æœ‰åœ¨OpenTinyç¤¾åŒºé‡Œé»˜é»˜ä»˜å‡ºã€ç§¯æè´¡çŒ®ã€å¼•é¢†åˆ›æ–°çš„æ°å‡ºä¸ªäººï¼Œæˆ‘ä»¬æ­£å¼å¯åŠ¨â€œOpenTinyå¹´åº¦è´¡çŒ®è€…è¯„é€‰â€æ´»åŠ¨ï¼æ¬¢è¿å„ä½å¼€å‘è€…è¸Šè·ƒæŠ¥å~</p>
<h2 data-id="heading-1">æ´»åŠ¨è¯¦æƒ…</h2>
<h3 data-id="heading-2">æ´»åŠ¨ç®€ä»‹ï¼š</h3>
<p>æœ¬æ¬¡æ´»åŠ¨ä¸»è¦æ˜¯é€šè¿‡å¼€å‘è€…ç”³æŠ¥+ç¤¾åŒºè¯„é€‰+å¼€å‘è€…æŠ•ç¥¨å½¢å¼å¼€å±•ï¼Œå…¥é€‰å¼€å‘è€…åç»­å¯è·å¾—ç›¸åº”æ´»åŠ¨ç¤¼å“ã€‚æœ¬æ¬¡æ´»åŠ¨ä¸€å…±è®¾ç½® 4 ç±»å¥–é¡¹ã€‚</p>
<ol>
<li>Â â€œæŠ€æœ¯ç‚¼é‡‘å¸ˆâ€ï¼ˆå‚ä¸å…±å»ºï¼‰ã€â€œå¸ƒé“é­”æ³•å¸ˆâ€ï¼ˆå‚ä¸åˆ†äº«ï¼‰ã€â€œç¤¾åŒºå®è—ç©å®¶â€ï¼ˆå‚ä¸ç¤¾åŒºè®¨è®ºï¼‰ ä¸‰ä¸ªç±»ç›®å¥–é¡¹é€šè¿‡æŠ•ç¥¨è¯„é€‰è·å¥–é€‰æ‰‹ï¼Œæœ¬æ¬¡æŠ•ç¥¨å…±é€‰å‡º5åè·å¥–é€‰æ‰‹ï¼ŒæŒ‰ç…§åæ¬¡é¡ºåˆ©ä¾æ¬¡ç»™äºˆç›¸åº”å¥–åŠ±ã€‚</li>
<li>â€œæŠ€æœ¯ç¡¬æ ¸å¥–â€åˆ™ç”±ç¤¾åŒºè‡ªä¸»æ ¹æ®å®é™…å…±å»ºæƒ…å†µè¯„é€‰ 2 ä½ï¼Œè·å¾—æœºæ¢°é”®ç›˜/è“ç‰™éŸ³å“ï¼ˆ2é€‰1ï¼‰åŠè£èª‰è¯ä¹¦</li>
</ol>
<h3 data-id="heading-3">æ´»åŠ¨å¥–å“ï¼š</h3>
<table>
    <thead>
        <tr>
            <th>è£èª‰</th>
            <th>å¥–é¡¹</th>
            <th>ç¤¼å“</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>ç¬¬ä¸€å</td>
            <td rowspan="4">
                <ul>
                    <li>æŠ€æœ¯ç‚¼é‡‘å¸ˆ</li>
                    <li>å¸ƒé“é­”æ³•å¸ˆ</li>
                    <li>ç¤¾åŒºå®è—ç©å®¶</li>
                </ul>
            </td>
            <td>æœºæ¢°é”®ç›˜ / è“ç‰™éŸ³å“ï¼ˆ2é€‰1ï¼‰ +è£èª‰è¯ä¹¦</td>
        </tr>
        <tr>
            <td>ç¬¬äºŒå</td>
            <td>åä¸º 66W å¿«å……å……ç”µå®+è£èª‰è¯ä¹¦</td>
        </tr>
        <tr>
            <td>ç¬¬ä¸‰å</td>
            <td>BKT æŠ¤è…°åå«æ¤…+è£èª‰è¯ä¹¦</td>
        </tr>
        <tr>
            <td>ç¬¬å››/äº”å</td>
            <td>å±å¹•æŒ‚ç¯+è£èª‰è¯ä¹¦</td>
        </tr>
        <tr>
            <td>ç¤¾åŒºä¼˜ç§€å…±å»ºè€…</td>
            <td>æŠ€æœ¯ç¡¬æ ¸å¥–</td>
            <td>æœºæ¢°é”®ç›˜ / è“ç‰™éŸ³å“ï¼ˆ2é€‰1ï¼‰ +è£èª‰è¯ä¹¦</td>
        </tr>
    </tbody>
</table>
<h3 data-id="heading-4">æ´»åŠ¨æ—¶é—´ï¼š</h3>
<ul>
<li>å¹´åº¦è´¡çŒ®è€…å¾é›†æ—¶é—´ï¼š2025å¹´12æœˆ17æ—¥-2025å¹´12æœˆ24æ—¥</li>
<li>å¹´åº¦è´¡çŒ®è€…æŠ•ç¥¨è¯„é€‰æ—¶é—´ï¼š2025å¹´12æœˆ25æ—¥-2025å¹´12æœˆ31æ—¥</li>
</ul>
<h3 data-id="heading-5">æŠ¥åå…¥å£ï¼š</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fv.wjx.cn%2Fvm%2FtdGJdjR.aspx%23" target="_blank" title="https://v.wjx.cn/vm/tdGJdjR.aspx#" ref="nofollow noopener noreferrer">v.wjx.cn/vm/tdGJdjR.â€¦</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f21447bb06e54855aceb469a8a70b188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570423&amp;x-signature=hthTmpChy%2BzoY9KAaoE3ksLaJSE%3D" alt="é»˜è®¤æ ‡é¢˜__2025-12-17+16_34_23.jpg" loading="lazy"/></p>
<h2 data-id="heading-6">å…³äºOpenTiny</h2>
<p>æ¬¢è¿åŠ å…¥ OpenTiny å¼€æºç¤¾åŒºã€‚æ·»åŠ å¾®ä¿¡å°åŠ©æ‰‹ï¼šopentiny-official ä¸€èµ·å‚ä¸äº¤æµå‰ç«¯æŠ€æœ¯ï½</p>
<p>OpenTiny å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny ä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a><br/>
TinyEngine æºç ï¼šâ€…<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a><br/>
æ¬¢è¿è¿›å…¥ä»£ç ä»“åº“ StarğŸŒŸTinyEngineã€TinyVueã€TinyNGã€TinyCLIã€TinyEditor~
å¦‚æœä½ ä¹Ÿæƒ³è¦å…±å»ºï¼Œå¯ä»¥è¿›å…¥ä»£ç ä»“åº“ï¼Œæ‰¾åˆ° good first issue æ ‡ç­¾ï¼Œä¸€èµ·å‚ä¸å¼€æºè´¡çŒ®~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimonæºç è§£è¯» -- Compaction-9.SortMergeReaderWithLoserTree]]></title>    <link>https://juejin.cn/post/7584262116388470810</link>    <guid>https://juejin.cn/post/7584262116388470810</guid>    <pubDate>2025-12-16T10:45:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584262116388470810" data-draft-id="7581648776303722505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimonæºç è§£è¯» -- Compaction-9.SortMergeReaderWithLoserTree "/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Flink"/> <meta itemprop="datePublished" content="2025-12-16T10:45:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimonæºç è§£è¯» -- Compaction-9.SortMergeReaderWithLoserTree 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T10:45:28.000Z" title="Tue Dec 16 2025 10:45:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šç¯‡æ–‡ç« <a href="https://juejin.cn/post/7577609608828239898" title="https://juejin.cn/post/7577609608828239898" target="_blank">Paimonæºç è§£è¯» -- Compaction-1.MergeTreeCompactTask</a>è§£æäº†Paimon-Compactioné˜¶æ®µçš„å¤§æ¦‚æµç¨‹</p>
<p>å…¶ä¸­Paimonçš„compactionæ“ä½œç”±å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼Œ</p>
<ol>
<li>ç”¨<code>SingleFileWriterå’ŒRollingFileWriter</code>å»æ‰§è¡Œå†™å…¥å’Œæ»šåŠ¨æ–‡ä»¶æ“ä½œ -- è¯¦æƒ…çœ‹æ–‡ç« <a href="https://juejin.cn/spost/7581306080434339891" target="_blank" title="https://juejin.cn/spost/7581306080434339891">Paimonæºç è§£è¯» -- Compaction-2.SingleFileWriterå’ŒRollingFileWriter</a></li>
<li>ç”¨<code>ReducerMergeFunctionWrapper</code>å»æ‰§è¡Œèšåˆé€»è¾‘ -- è¯¦æƒ…çœ‹æ–‡ç« <a href="https://juejin.cn/post/7576838095518793779" title="https://juejin.cn/post/7576838095518793779" target="_blank">Paimonæºç è§£è¯» -- PartialUpdateMerge</a></li>
<li>ç”¨<code>readerForMergeTree()æœ€åç”±SortMergeReader</code>å»æ‰§è¡Œç‰¹å®šçš„åˆå¹¶ç®—æ³•ï¼Œå»å°†æ–‡ä»¶è¿›è¡Œæ’åºåˆå¹¶é‡å†™ -- è°ƒç”¨çš„æµç¨‹è¯·çœ‹æ–‡ç« <a href="https://juejin.cn/editor/drafts/7581470169840959526" target="_blank" title="https://juejin.cn/editor/drafts/7581470169840959526">Paimonæºç è§£è¯» -- Compaction-3.MergeSorter</a></li>
</ol>
<h2 data-id="heading-1">ä¸€.SortMergeReader</h2>
<h3 data-id="heading-2">1.å…¥å£å‡½æ•°</h3>
<p>é¦–å…ˆSortMergeReaderæ˜¯åœ¨MergeSorter.mergeSortNoSpill()ä¸­è°ƒç”¨çš„ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ— æº¢å‡ºåˆå¹¶çš„æ–¹æ³•</span>
<span class="hljs-keyword">public</span> &lt;T&gt; RecordReader&lt;T&gt; <span class="hljs-title function_">mergeSortNoSpill</span><span class="hljs-params">(
        List&lt;? extends ReaderSupplier&lt;KeyValue&gt;&gt; lazyReaders,
        Comparator&lt;InternalRow&gt; keyComparator,
        <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator, // è¿™é‡Œåªå’Œ<span class="hljs-string">'sequence-field'</span>ç»‘å®šï¼Œå†³å®šå…¨å±€çš„æ•°æ®æ–°æ—§æƒ…å†µ
        MergeFunctionWrapper&lt;T&gt; mergeFunction)</span>
        <span class="hljs-keyword">throws</span> IOException {
    List&lt;RecordReader&lt;KeyValue&gt;&gt; readers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(lazyReaders.size());
    <span class="hljs-keyword">for</span> (ReaderSupplier&lt;KeyValue&gt; supplier : lazyReaders) {
        <span class="hljs-keyword">try</span> {
            readers.add(supplier.get()); <span class="hljs-comment">// åº•å±‚è°ƒMergeTreeReaders.readerForRun()è·å–å½“å‰Sorted Runä¸‹æ‰€æœ‰DFæ–‡ä»¶åˆ›å»ºä¸”åˆèµ·æ¥çš„RecordReaderï¼Œå…¶å®å°±æ˜¯è·å–å½“å‰Sorted Runå¯¹åº”çš„RecordReader</span>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-comment">// if one of the readers creating failed, we need to close them all.</span>
            <span class="hljs-comment">// å¦‚æœå½“å‰Sorted Runä¸‹æ‰€æœ‰DFæ–‡ä»¶åˆ›å»ºçš„RecordReaderï¼Œæœ‰ä»»ä½•ä¸€ä¸ªæœ‰é—®é¢˜ï¼Œåˆ™å…¨éƒ¨å…³é—­</span>
            readers.forEach(IOUtils::closeQuietly);
            <span class="hljs-keyword">throw</span> e;
        }
    }
    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ’åºåˆå¹¶è¯»å–å™¨ï¼Œè¿™æ˜¯åˆ›å»ºæ’åºåˆå¹¶ç®—æ³•å™¨çš„å…¥å£</span>
    <span class="hljs-keyword">return</span> SortMergeReader.createSortMergeReader(
            readers, keyComparator, userDefinedSeqComparator, mergeFunction, sortEngine); 
}
</code></pre>
<h3 data-id="heading-3">2.SortMergeReaderæœ¬èº«</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SortMergeReader</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecordReader</span>&lt;T&gt; {

    <span class="hljs-comment">// ç”±MergeSorter.mergeSortNoSpill()è°ƒç”¨ï¼Œè¯¥æ–¹æ³•æ˜¯åˆ›å»ºæ’åºåˆå¹¶ç®—æ³•å™¨çš„å…¥å£</span>
    <span class="hljs-keyword">static</span> &lt;T&gt; SortMergeReader&lt;T&gt; <span class="hljs-title function_">createSortMergeReader</span><span class="hljs-params">(
            List&lt;RecordReader&lt;KeyValue&gt;&gt; readers,
            Comparator&lt;InternalRow&gt; userKeyComparator,
            <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator,
            MergeFunctionWrapper&lt;T&gt; mergeFunctionWrapper,
            SortEngine sortEngine)</span> {
        <span class="hljs-comment">// æ ¹æ®é…ç½®çš„'sort-engine'ï¼Œå»åˆ›å»ºå¯¹åº”çš„ç®—æ³•æ’åºåˆå¹¶å™¨ï¼Œé»˜è®¤æ˜¯loser-tree</span>
        <span class="hljs-keyword">switch</span> (sortEngine) {
            <span class="hljs-keyword">case</span> MIN_HEAP: <span class="hljs-comment">// æœ€å°å †min-heapç®—æ³•</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortMergeReaderWithMinHeap</span>&lt;&gt;(
                        readers, userKeyComparator, userDefinedSeqComparator, mergeFunctionWrapper);
            <span class="hljs-keyword">case</span> LOSER_TREE: <span class="hljs-comment">// è´¥è€…æ ‘loser-treeç®—æ³•</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortMergeReaderWithLoserTree</span>&lt;&gt;(
                        readers, userKeyComparator, userDefinedSeqComparator, mergeFunctionWrapper);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"Unsupported sort engine: "</span> + sortEngine);
        }
    }
}
</code></pre>
<h2 data-id="heading-4">äºŒ.SortMergeReaderWithLoserTree -- è´¥è€…æ ‘SortMergeReader</h2>
<h3 data-id="heading-5">1.æºç æœºåˆ¶</h3>
<h4 data-id="heading-6">(1) æ ¸å¿ƒå±æ€§å’Œæ„é€ å‡½æ•°</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">SortMergeReaderWithLoserTree</span>&lt;<span class="hljs-type">T</span>&gt;
  <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">MergeFunctionWrapper</span>&lt;<span class="hljs-type">T</span>&gt; mergeFunctionWrapper  <span class="hljs-comment">// åˆå¹¶å‡½æ•°åŒ…è£…å™¨</span>
  <span class="hljs-operator">â””â”€â”€</span> <span class="hljs-type">LoserTree</span>&lt;<span class="hljs-type">KeyValue</span>&gt; loserTree                 <span class="hljs-comment">// è´¥è€…æ ‘</span>
       <span class="hljs-operator">â”œâ”€â”€</span> int[] tree                                <span class="hljs-comment">// è´¥è€…ç´¢å¼•æ•°ç»„</span>
       <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">LeafIterator</span>&lt;<span class="hljs-type">KeyValue</span>&gt;&gt; leaves       <span class="hljs-comment">// å¶å­èŠ‚ç‚¹åˆ—è¡¨</span>
       <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">KeyValue</span>&gt; firstComparator      <span class="hljs-comment">// Key æ¯”è¾ƒå™¨</span>
       <span class="hljs-operator">â””â”€â”€</span> <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">KeyValue</span>&gt; secondComparator     <span class="hljs-comment">// Sequence æ¯”è¾ƒå™¨</span>

<span class="hljs-type">SortMergeIterator</span> (å†…éƒ¨ç±»)
  <span class="hljs-operator">â””â”€â”€</span> boolean released                               <span class="hljs-comment">// æ˜¯å¦å·²é‡Šæ”¾</span>

</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MergeFunctionWrapper&lt;T&gt; mergeFunctionWrapper; <span class="hljs-comment">// MergeFunctionçš„åŒ…è£…å™¨ï¼Œç”±'merge-engine'å‚æ•°ç»‘å®š</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LoserTree&lt;KeyValue&gt; loserTree; <span class="hljs-comment">// è´¥è€…æ ‘æ•°æ®ç»“æ„</span>

<span class="hljs-keyword">public</span> <span class="hljs-title function_">SortMergeReaderWithLoserTree</span><span class="hljs-params">(
        List&lt;RecordReader&lt;KeyValue&gt;&gt; readers,
        Comparator&lt;InternalRow&gt; userKeyComparator,
        <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator,
        MergeFunctionWrapper&lt;T&gt; mergeFunctionWrapper)</span> {
    <span class="hljs-built_in">this</span>.mergeFunctionWrapper = mergeFunctionWrapper;
    <span class="hljs-comment">// åˆ›å»ºè´¥è€…æ ‘</span>
    <span class="hljs-built_in">this</span>.loserTree =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoserTree</span>&lt;&gt;(
                    readers, <span class="hljs-comment">// æ‰€æœ‰RecordReaderï¼Œæ¯ä¸ªRecordReaderå¯¹åº”ä¸€ä¸ªè´¥è€…æ ‘èŠ‚ç‚¹</span>
                    (e1, e2) -&gt; userKeyComparator.compare(e2.key(), e1.key()), <span class="hljs-comment">// Keyçš„æ¯”è¾ƒå™¨</span>
                    createSequenceComparator(userDefinedSeqComparator)); <span class="hljs-comment">// Sequenceæ¯”è¾ƒå™¨</span>
}
</code></pre>
<h4 data-id="heading-7">(2) <code>createSequenceComparator()</code> -- åˆ›å»ºsequenceæ¯”è¾ƒå™¨</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// åˆ›å»ºsequnceæ¯”è¾ƒå™¨</span>
<span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">Comparator</span>&lt;<span class="hljs-selector-tag">KeyValue</span>&gt; <span class="hljs-selector-tag">createSequenceComparator</span>(
        <span class="hljs-variable">@Nullable</span> FieldsComparator userDefinedSeqComparator) {
    <span class="hljs-selector-tag">if</span> (userDefinedSeqComparator == null) {
        <span class="hljs-comment">// é»˜è®¤ï¼šæŒ‰ sequenceNumber é™åº</span>
        <span class="hljs-selector-tag">return</span> (e1, e2) <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">Long</span><span class="hljs-selector-class">.compare</span>(e2.<span class="hljs-built_in">sequenceNumber</span>(), e1.<span class="hljs-built_in">sequenceNumber</span>());
    }
    <span class="hljs-comment">// ç”¨æˆ·è‡ªå®šä¹‰sequence-fieldï¼šå…ˆé™åºæ¯”è¾ƒç”¨æˆ·å­—æ®µï¼Œå†æ¯”è¾ƒ sequenceNumber</span>
    <span class="hljs-selector-tag">return</span> (o1, o2) <span class="hljs-selector-tag">-</span>&gt; {
        <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">userDefinedSeqComparator</span><span class="hljs-selector-class">.compare</span>(o2.<span class="hljs-built_in">value</span>(), o1.<span class="hljs-built_in">value</span>());
        <span class="hljs-selector-tag">if</span> (result != <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">result</span>;
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Long</span><span class="hljs-selector-class">.compare</span>(o2.<span class="hljs-built_in">sequenceNumber</span>(), o1.<span class="hljs-built_in">sequenceNumber</span>());
    };
}
</code></pre>
<h4 data-id="heading-8">(3) <code>readeBatch()</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸min-heapç›¸æ¯”ï¼Œloser-treeåªä¼šäº§ç”Ÿä¸€ä¸ªæ‰¹æ¬¡</span>
<span class="hljs-comment">// è¯»å–æ‰¹æ¬¡</span>
<span class="hljs-meta">@Nullable</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> RecordIterator&lt;T&gt; <span class="hljs-title function_">readBatch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    loserTree.initializeIfNeeded(); <span class="hljs-comment">// åˆå§‹åŒ–è´¥è€…æ ‘</span>
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®</span>
    <span class="hljs-comment">// peekWinner() è¿”å›å½“å‰å…¨å±€èµ¢å®¶ï¼Œå¦‚æœä¸º null è¯´æ˜è¿˜æ²¡æœ‰å…¨å±€èµ¢å®¶ï¼Œéœ€è¦è¿”å›SortMergeIterator</span>
    <span class="hljs-keyword">return</span> loserTree.peekWinner() == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortMergeIterator</span>();
}
</code></pre>
<h4 data-id="heading-9">(4) SortMergeIterator -- æ ¸å¿ƒ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SortMergeIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RecordIterator</span>&lt;T&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">released</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// 1.è°ƒæ•´æ ‘å¹¶æ›´æ–°ä¸‹ä¸€ä¸ªwinner</span>
            loserTree.adjustForNextLoop();
            <span class="hljs-comment">// 2.å¼¹å‡ºè¿™ä¸ªwinnerï¼Œå¹¶æ›´æ–°ä¸‹ä¸‹ä¸€ä¸ªwinner</span>
            <span class="hljs-type">KeyValue</span> <span class="hljs-variable">winner</span> <span class="hljs-operator">=</span> loserTree.popWinner();
            <span class="hljs-keyword">if</span> (winner == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
            <span class="hljs-comment">// 3.è°ƒåˆå¹¶å‡½æ•°çš„reset()é‡ç½®ç¼“å­˜</span>
            mergeFunctionWrapper.reset();
            <span class="hljs-comment">// 4.è°ƒåˆå¹¶å‡½æ•°å¯¹winnerè¿›è¡Œåˆå¹¶</span>
            mergeFunctionWrapper.add(winner); <span class="hljs-comment">// è®°ä½ï¼šKeyå°çš„å…ˆå¼¹å‡ºï¼ŒKeyå¤§çš„åå¼¹å‡ºï¼›æ—§çš„æ•°æ®ä¼šå…ˆå¼¹å‡ºï¼Œæ–°çš„æ•°æ®ä¼šåå¼¹å‡ºï¼›</span>
            <span class="hljs-comment">// 5.åˆå¹¶æ‰€æœ‰ç›¸åŒçš„Keyï¼Œå¹¶è¿”å›åˆå¹¶ç»“æœ</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> merge();
            <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> result;
            }
        }
    }

    <span class="hljs-keyword">private</span> T <span class="hljs-title function_">merge</span><span class="hljs-params">()</span> {
        Preconditions.checkState(
                !released, <span class="hljs-string">"SortMergeIterator#nextImpl is called after release"</span>);
        <span class="hljs-comment">// æŒç»­å¼¹å‡ºç›¸åŒKeyçš„winnerï¼Œå¹¶é‡æ–°è°ƒæ•´æ ‘</span>
        <span class="hljs-keyword">while</span> (loserTree.peekWinner() != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// è¿›è¡Œåˆå¹¶</span>
            mergeFunctionWrapper.add(loserTree.popWinner());
        }
        <span class="hljs-comment">// è¿”å›åˆå¹¶ç»“æœ</span>
        <span class="hljs-keyword">return</span> mergeFunctionWrapper.getResult();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseBatch</span><span class="hljs-params">()</span> {
        released = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-10">2.LoserTree -- è´¥è€…æ ‘</h3>
<p>æ ¸å¿ƒç‚¹å°±æ˜¯Keyå°çš„ã€Sequneceå°çš„ä¼˜å…ˆå¼¹å‡ºè¿›è¡Œä¼˜å…ˆèšåˆï¼›Keyå¤§çš„ã€Sequenceå¤§çš„æœ€åå¼¹å‡ºï¼Œå†è¿›è¡Œèšåˆ</p>
<h4 data-id="heading-11">(1) æ ¸å¿ƒå±æ€§ã€æšä¸¾ç±»ç­‰</h4>
<h5 data-id="heading-12">&lt;1&gt; å±æ€§</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] tree; <span class="hljs-comment">// å­˜å‚¨è´¥è€…ç´¢å¼•çš„æ•°ç»„ï¼Œtree[0]çš„å€¼è¡¨ç¤ºå½“å‰winnerçš„ç´¢å¼•ä½ç½®</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> size; <span class="hljs-comment">// å¶å­èŠ‚ç‚¹æ•°é‡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;LeafIterator&lt;T&gt;&gt; leaves; <span class="hljs-comment">// å¶å­èŠ‚ç‚¹åˆ—è¡¨</span>

<span class="hljs-comment">// è¡¥å……ï¼šå¦‚æœcomparator.compare('a', 'b') &gt; 0 åˆ™è®¤ä¸ºaæ˜¯èƒœè€…ï¼Œé‚£ä¹ˆaä¼šä½œä¸ºçˆ¶èŠ‚ç‚¹ï¼Œbä½œä¸ºå¶å­èŠ‚ç‚¹</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Comparator&lt;T&gt; firstComparator; <span class="hljs-comment">// Key æ¯”è¾ƒå™¨ï¼Œä¼˜å…ˆæ¯”è¾ƒ</span>

<span class="hljs-comment">/** same as firstComparator, but mainly used to compare sequenceNumber. */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Comparator&lt;T&gt; secondComparator; <span class="hljs-comment">// Sequence æ¯”è¾ƒå™¨ï¼Œå…¶æ¬¡æ¯”è¾ƒ</span>

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> initialized; <span class="hljs-comment">// æ˜¯å¦å·²åˆå§‹åŒ–</span>
</code></pre>
<h5 data-id="heading-13">&lt;2&gt; æ„é€ å‡½æ•°</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">LoserTree</span><span class="hljs-params">(
        List&lt;RecordReader&lt;T&gt;&gt; nextBatchReaders,  // æ‰€æœ‰å¾…åˆå¹¶çš„ RecordReader
        Comparator&lt;T&gt; firstComparator,           // Key æ¯”è¾ƒå™¨
        Comparator&lt;T&gt; secondComparator)</span> {        <span class="hljs-comment">// Sequence æ¯”è¾ƒå™¨</span>
    <span class="hljs-built_in">this</span>.size = nextBatchReaders.size();
    <span class="hljs-built_in">this</span>.leaves = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(size);
    <span class="hljs-built_in">this</span>.tree = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[size]; <span class="hljs-comment">// æ ‘æ•°ç»„å¤§å°ç­‰äºå¶å­æ•°é‡</span>
    
    <span class="hljs-comment">// å¦‚æœ compare(a, b) &gt; 0ï¼Œåˆ™ a æ˜¯èµ¢å®¶ï¼ˆa æ›´ä¼˜ï¼‰</span>
    <span class="hljs-comment">// å¦‚æœ compare(a, b) &lt; 0ï¼Œåˆ™ b æ˜¯èµ¢å®¶ï¼ˆb æ›´ä¼˜ï¼‰</span>
    <span class="hljs-comment">// å¦‚æœ compare(a, b) = 0ï¼Œåˆ™éœ€è¦ä½¿ç”¨ secondComparator ç»§ç»­æ¯”è¾ƒ</span>
    
    <span class="hljs-comment">// null å€¼å¤„ç†ï¼š</span>
    <span class="hljs-comment">// e1 == null =&gt; è¿”å› -1ï¼ˆe1 æ˜¯è´¥è€…ï¼‰</span>
    <span class="hljs-comment">// e2 == null =&gt; è¿”å› 1ï¼ˆe1 æ˜¯èµ¢å®¶ï¼‰</span>
    <span class="hljs-built_in">this</span>.firstComparator =
            (e1, e2) -&gt; e1 == <span class="hljs-literal">null</span> ? -<span class="hljs-number">1</span> : (e2 == <span class="hljs-literal">null</span> ? <span class="hljs-number">1</span> : firstComparator.compare(e1, e2));
    <span class="hljs-built_in">this</span>.secondComparator =
            (e1, e2) -&gt; e1 == <span class="hljs-literal">null</span> ? -<span class="hljs-number">1</span> : (e2 == <span class="hljs-literal">null</span> ? <span class="hljs-number">1</span> : secondComparator.compare(e1, e2));
    <span class="hljs-built_in">this</span>.initialized = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// ä¸ºæ¯ä¸ª RecordReader åˆ›å»º LeafIterator åŒ…è£…å™¨</span>
    <span class="hljs-keyword">for</span> (RecordReader&lt;T&gt; reader : nextBatchReaders) {
        LeafIterator&lt;T&gt; iterator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeafIterator</span>&lt;&gt;(reader);
        <span class="hljs-built_in">this</span>.leaves.add(iterator);
    }
}
</code></pre>
<h5 data-id="heading-14">&lt;3&gt; Stateæšä¸¾ç±» -- æ ¸å¿ƒ</h5>
<p>æ•´ä¸ªç®—æ³•çš„æ ¸å¿ƒæ˜¯æ ¹æ®è¿™ä¸ªçŠ¶æ€å»åˆ¤æ–­æ˜¯èµ¢å®¶è¿˜æ˜¯è¾“å®¶ï¼Œç„¶åè¿›è¡Œè°ƒæ•´çˆ¶å­èŠ‚ç‚¹ä½ç½®çš„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">State</span> {
    LOSER_WITH_NEW_KEY(<span class="hljs-literal">false</span>),  <span class="hljs-comment">// è´¥è€…ï¼Œæ–°Key</span>
    LOSER_WITH_SAME_KEY(<span class="hljs-literal">false</span>), <span class="hljs-comment">// è´¥è€…ï¼Œç›¸åŒKey</span>
    LOSER_POPPED(<span class="hljs-literal">false</span>),        <span class="hljs-comment">// è´¥è€…ï¼Œå·²å¼¹å‡º</span>
    WINNER_WITH_NEW_KEY(<span class="hljs-literal">true</span>),  <span class="hljs-comment">// èƒœè€…ï¼Œæ–°Key</span>
    WINNER_WITH_SAME_KEY(<span class="hljs-literal">true</span>), <span class="hljs-comment">// èƒœè€…ï¼Œç›¸åŒKey</span>
    WINNER_POPPED(<span class="hljs-literal">true</span>);        <span class="hljs-comment">// èƒœè€…ï¼Œå·²å¼¹å‡º</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> winner;

    State(<span class="hljs-type">boolean</span> winner) {
        <span class="hljs-built_in">this</span>.winner = winner;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isWinner</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> winner;
    }
}
</code></pre>
<h5 data-id="heading-15">&lt;4&gt; LeafIteratorå¶å­èŠ‚ç‚¹è¿­ä»£å™¨</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¶å­èŠ‚ç‚¹è¿­ä»£å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeafIterator</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RecordReader&lt;T&gt; reader; <span class="hljs-comment">// åº•å±‚RecordReader</span>

    <span class="hljs-keyword">private</span> RecordReader.RecordIterator&lt;T&gt; iterator; <span class="hljs-comment">// å½“å‰æ‰¹æ¬¡è¿­ä»£å™¨</span>

    <span class="hljs-keyword">private</span> T kv; <span class="hljs-comment">// å½“å‰KeyValue</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> endOfInput; <span class="hljs-comment">// æ˜¯å¦è¯»å–å®Œæ¯•</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> firstSameKeyIndex; <span class="hljs-comment">// ç¬¬ä¸€ä¸ªç›¸åŒKeyçš„ç´¢å¼•ï¼Œè¿™ä¸ªæ˜¯ä»ä¸Šå¾€ä¸‹ç®—çš„</span>

    <span class="hljs-keyword">private</span> State state; <span class="hljs-comment">// èŠ‚ç‚¹çŠ¶æ€</span>

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LeafIterator</span><span class="hljs-params">(RecordReader&lt;T&gt; reader)</span> {
        <span class="hljs-built_in">this</span>.reader = reader;
        <span class="hljs-built_in">this</span>.endOfInput = <span class="hljs-literal">false</span>;
        <span class="hljs-built_in">this</span>.firstSameKeyIndex = -<span class="hljs-number">1</span>;
        <span class="hljs-built_in">this</span>.state = State.WINNER_WITH_NEW_KEY; <span class="hljs-comment">// é»˜è®¤æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯æ–°Keyçš„èƒœè€…ï¼Œåç»­ä¼šå’Œçˆ¶èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ</span>
    }
    <span class="hljs-comment">// è¿”å›å½“å‰å¶å­èŠ‚ç‚¹çš„KeyValue</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">peek</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> kv;
    }
    <span class="hljs-comment">// å¼¹å‡ºå½“å‰å¶å­èŠ‚ç‚¹çš„KeyValueï¼Œå¹¶æ ‡è®°è¯¥èŠ‚ç‚¹çš„stateä¸ºèƒœè€…å·²å¼¹å‡º</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.state = State.WINNER_POPPED;
        <span class="hljs-keyword">return</span> kv;
    }
    <span class="hljs-comment">// æ›´æ–°ç¬¬ä¸€ä¸ªç›¸åŒKeyèŠ‚ç‚¹çš„ç´¢å¼•ä½ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFirstSameKeyIndex</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
        <span class="hljs-keyword">if</span> (firstSameKeyIndex == -<span class="hljs-number">1</span>) {
            firstSameKeyIndex = index;
        }
    }

    <span class="hljs-comment">// æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªè®°å½•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">advanceIfAvailable</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
        <span class="hljs-built_in">this</span>.firstSameKeyIndex = -<span class="hljs-number">1</span>;
        <span class="hljs-built_in">this</span>.state = State.WINNER_WITH_NEW_KEY;
        <span class="hljs-comment">// å°è¯•ä»å½“å‰è¿­ä»£å™¨è¯»å–ä¸‹ä¸€ä¸ªè®°å½•</span>
        <span class="hljs-keyword">if</span> (iterator == <span class="hljs-literal">null</span> || (kv = iterator.next()) == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å½“å‰æ‰¹æ¬¡å·²ç»è¯»å®Œï¼Œéœ€è¦è¯»å–æ–°çš„æ‰¹æ¬¡</span>
            <span class="hljs-keyword">while</span> (!endOfInput) {
                <span class="hljs-keyword">if</span> (iterator != <span class="hljs-literal">null</span>) {
                    iterator.releaseBatch(); <span class="hljs-comment">// é‡Šæ”¾å½“å‰æ‰¹æ¬¡å†…å­˜</span>
                    iterator = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-comment">// è¯»å–ä¸‹ä¸€æ‰¹æ¬¡</span>
                iterator = reader.readBatch();
                <span class="hljs-keyword">if</span> (iterator == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// æ‰€æœ‰æ•°æ®å·²è¯»å®Œï¼Œé‡ç½®å±æ€§</span>
                    endOfInput = <span class="hljs-literal">true</span>;
                    kv = <span class="hljs-literal">null</span>;
                    reader.close();
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((kv = iterator.next()) != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// æˆåŠŸè¯»å–åˆ°æ•°æ®ï¼Œåˆ™break</span>
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.iterator != <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">this</span>.iterator.releaseBatch();
            <span class="hljs-built_in">this</span>.iterator = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-built_in">this</span>.reader.close();
    }
}
</code></pre>
<h4 data-id="heading-16">(2) <code>initializeIfNeeded()</code> -- åˆå§‹åŒ–è´¥è€…æ ‘</h4>
<p>æ¡ˆä¾‹</p>
<pre><code class="hljs language-ini" lang="ini">åˆå§‹æ•°æ®:
Leaf 0: <span class="hljs-attr">key</span>=<span class="hljs-number">5</span>, seq=<span class="hljs-number">100</span>
Leaf 1: <span class="hljs-attr">key</span>=<span class="hljs-number">3</span>, seq=<span class="hljs-number">200</span>
Leaf 2: <span class="hljs-attr">key</span>=<span class="hljs-number">7</span>, seq=<span class="hljs-number">150</span>

æ‰§è¡Œè¿‡ç¨‹:
<span class="hljs-attr">1. i</span>=<span class="hljs-number">2</span>: advanceIfAvailable() â†’ key=<span class="hljs-number">7</span>
        adjust(2) â†’ tree<span class="hljs-section">[æŸä½ç½®]</span> = 2 (è´¥è€…)
        
<span class="hljs-attr">2. i</span>=<span class="hljs-number">1</span>: advanceIfAvailable() â†’ key=<span class="hljs-number">3</span>
        adjust(1) â†’ ä¸ Leaf 2 æ¯”è¾ƒ
        <span class="hljs-attr">key</span>=<span class="hljs-number">3</span> &lt; key=<span class="hljs-number">7</span> â†’ Leaf <span class="hljs-number">1</span> æ›´ä¼˜ï¼ˆèµ¢å®¶ï¼‰
        
<span class="hljs-attr">3. i</span>=<span class="hljs-number">0</span>: advanceIfAvailable() â†’ key=<span class="hljs-number">5</span>
        adjust(0) â†’ ä¸å½“å‰èµ¢å®¶æ¯”è¾ƒ
        <span class="hljs-attr">key</span>=<span class="hljs-number">3</span> &lt; key=<span class="hljs-number">5</span> â†’ Leaf <span class="hljs-number">1</span> ä»æ˜¯èµ¢å®¶

æœ€ç»ˆç»“æœ:
tree<span class="hljs-section">[0]</span> = 1 (Leaf 1 æ˜¯å…¨å±€èµ¢å®¶ï¼Œ<span class="hljs-attr">key</span>=<span class="hljs-number">3</span> æœ€å°ï¼Œå…ˆå¼¹å‡º)
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeIfNeeded</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">if</span> (!initialized) {
        Arrays.fill(tree, -<span class="hljs-number">1</span>); <span class="hljs-comment">// åˆå§‹åŒ–è´¥è€…æ•°ç»„ä¸º-1ï¼Œæœ€å¼€å§‹æ²¡æœ‰è´¥è€…å’Œèƒœè€…</span>
        <span class="hljs-comment">// ä»æœ€åä¸€ä¸ªå¶å­å¼€å§‹ï¼Œé€ä¸ªè¯»å–æ•°æ®å¹¶æ„å»ºè´¥è€…æ ‘</span>
        <span class="hljs-comment">// ä¸ºä»€ä¹ˆä»åå‘å‰ï¼Ÿå› ä¸ºè´¥è€…æ ‘æ˜¯ä»å¶å­å‘æ ¹æ„å»ºçš„</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> size - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            leaves.get(i).advanceIfAvailable(); <span class="hljs-comment">// è¯»å–è¯¥èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªKeyValueï¼Œå¹¶æ›´æ–°state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-1</span>
            adjust(i); <span class="hljs-comment">// è°ƒæ•´æ ‘ç»“æ„ï¼Œè®©è¯¥èŠ‚ç‚¹å‚ä¸æ¯”è¾ƒ</span>
        }
        initialized = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h4 data-id="heading-17">(3) <code>adjustForNextLoop()</code> -- è°ƒæ•´å¹¶è·å–ä¸‹ä¸€ä¸ªwinner</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustForNextLoop</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-comment">// æŒç»­è°ƒæ•´ç›´åˆ°èµ¢å®¶çŠ¶æ€ä¸æ˜¯ WINNER_POPPED</span>
    <span class="hljs-keyword">while</span> (winner.state == State.WINNER_POPPED) {
        winner.advanceIfAvailable();             <span class="hljs-comment">// è¯»å–ä¸‹ä¸€ä¸ª KV</span>
        adjust(tree[<span class="hljs-number">0</span>]);                         <span class="hljs-comment">// é‡æ–°è°ƒæ•´æ ‘ï¼Œå°è¯•å°†winnerç›¸åŒKeyçš„èŠ‚ç‚¹æåˆ°ä¸‹ä¸€æ¬¡çš„winnerNodeä¸­</span>
        winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    }
}
</code></pre>
<h4 data-id="heading-18">(4) <code>popWinner()</code> -- å¼¹å‡ºå½“å‰çš„èµ¢å®¶ï¼Œå¹¶ä¸”æ ‡è®°å…¶ä¸ºWINNER_POPPED</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¼¹å‡ºå½“å‰çš„èµ¢å®¶ï¼Œå¹¶ä¸”æ ‡è®°å…¶ä¸ºWINNER_POPPED</span>
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">popWinner</span><span class="hljs-params">()</span> {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-comment">// å¦‚æœå½“å‰winnerå·²ç»å¼¹å‡ºè¿‡ï¼Œè¿”å› null</span>
    <span class="hljs-keyword">if</span> (winner.state == State.WINNER_POPPED) {
        <span class="hljs-comment">// if the winner has already been popped, it means that all the same key has been</span>
        <span class="hljs-comment">// processed.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-comment">// å¦‚æœå½“å‰winneræ²¡æœ‰å¼¹å‡ºè¿‡ï¼Œå°†winnerå¼¹å‡ºï¼Œå¹¶æ ‡è®°ä¸ºWINNER_POPEDï¼Œé‡æ–°è°ƒæ•´æ ‘</span>
    <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> winner.pop();
    adjust(tree[<span class="hljs-number">0</span>]); <span class="hljs-comment">// é‡æ–°è°ƒæ•´æ ‘ç»“æ„ï¼Œå°†è¯¥winnerç›¸åŒçš„Keyçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æåˆ°winnerä½ç½®ï¼Œä»¥ä¾¿åç»­ç»§ç»­å¼¹å‡ºè¯¥keyçš„æ•°æ®</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-19">(5) <code>peekWinner()</code> -- æ‰¾åˆ°å½“å‰çš„èµ¢å®¶</h4>
<p>è¿”å›å½“å‰çš„èµ¢å®¶ï¼Œä¸å¯ä»¥æ˜¯å·²ç»å¤„ç†è¿‡çš„èµ¢å®¶ï¼›å¦åˆ™ï¼Œè¿”å›nullã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">peekWinner</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è¿”å›å½“å‰çš„èµ¢å®¶ï¼Œä¸å¯ä»¥æ˜¯å·²ç»å¤„ç†è¿‡çš„èµ¢å®¶</span>
    <span class="hljs-keyword">return</span> leaves.get(tree[<span class="hljs-number">0</span>]).state != State.WINNER_POPPED ? leaves.get(tree[<span class="hljs-number">0</span>]).peek() : <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-20">(6) <code>adjust()</code> -- ç®—æ³•æ ¸å¿ƒ</h4>
<blockquote>
<p>è¡¥å……ï¼š<code>adjust(tree[0])</code>ï¼šé‡æ–°è°ƒæ•´æ ‘ï¼Œå°è¯•å°†å½“å‰tree[0]å¯¹åº”winnerçš„ç›¸åŒKeyçš„èŠ‚ç‚¹æåˆ°ä¸‹ä¸€æ¬¡çš„winnerNodeä¸­ï¼Œè¿›è¡Œäº¤æ¢ä½ç½®ï¼›å¦‚æœæ²¡æœ‰è¿™ç›¸åŒçš„Keyï¼Œåˆ™è¿›è¡Œæ¯”è¾ƒå…¶parentä½ç½®èŠ‚ç‚¹ï¼Œè¿›è¡Œæ›´æ–°winner</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjust</span><span class="hljs-params">(<span class="hljs-type">int</span> winner)</span> {
    <span class="hljs-comment">// æ ¸å¿ƒå¾ªç¯ï¼šä»å¶å­èŠ‚ç‚¹å‘ä¸Šéå†åˆ°æ ¹èŠ‚ç‚¹ï¼Œè¿™é‡Œçš„winneræœ€å¼€å§‹æ˜¯å½“å‰èŠ‚ç‚¹</span>
    <span class="hljs-comment">// parent è®¡ç®—å…¬å¼ï¼š(winner + size) / 2</span>
    <span class="hljs-comment">// è¿™æ˜¯å®Œå…¨äºŒå‰æ ‘çš„çˆ¶èŠ‚ç‚¹ç´¢å¼•è®¡ç®—å…¬å¼ï¼ˆæ•°ç»„ä» 0 å¼€å§‹ï¼‰</span>
    <span class="hljs-comment">// ä»å¶å­èŠ‚ç‚¹å‘ä¸Šéå†åˆ°æ ¹èŠ‚ç‚¹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> (winner + <span class="hljs-built_in">this</span>.size) / <span class="hljs-number">2</span>; parent &gt; <span class="hljs-number">0</span> &amp;&amp; winner &gt;= <span class="hljs-number">0</span>; parent /= <span class="hljs-number">2</span>) {
        LeafIterator&lt;T&gt; winnerNode = leaves.get(winner);
        LeafIterator&lt;T&gt; parentNode;
        <span class="hljs-comment">// CASE-1: åˆå§‹åŒ–é˜¶æ®µï¼Œéƒ½è¿˜æ²¡æœ‰è´¥è€…å’Œèƒœè€…ï¼Œé‚£ä¹ˆå°†å½“å‰çš„winneræ ‡è®°ä¸ºæ–°keyè´¥è€…ï¼Œä»¥ä¾¿åç»­æ¯”è¾ƒ</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.tree[parent] == -<span class="hljs-number">1</span>) {
            <span class="hljs-comment">// é‡æ–°è®¾ç½®winnerèŠ‚ç‚¹çŠ¶æ€ä¸ºLOSER_WITH_NEW_KEY</span>
            winnerNode.state = State.LOSER_WITH_NEW_KEY;
        }
        <span class="hljs-comment">// CASE-2: æ­£å¸¸è°ƒæ•´ï¼Œå·²ç»æœ‰è´¥è€…äº†</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// è·å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span>
            parentNode = leaves.get(<span class="hljs-built_in">this</span>.tree[parent]);
            <span class="hljs-comment">// æ ¹æ® winner çš„å½“å‰çŠ¶æ€ï¼Œé€‰æ‹©ä¸åŒçš„è°ƒæ•´ç­–ç•¥</span>
            <span class="hljs-keyword">switch</span> (winnerNode.state) {
                <span class="hljs-keyword">case</span> WINNER_WITH_NEW_KEY:
                    <span class="hljs-comment">// winner æŒæœ‰æ–° Keyï¼Œéœ€è¦å®Œæ•´æ¯”è¾ƒï¼Œè°ƒadjustWithNewWinnerKey()å»å¤„ç†</span>
                    adjustWithNewWinnerKey(parent, parentNode, winnerNode);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> WINNER_WITH_SAME_KEY:
                    <span class="hljs-comment">// winner æŒæœ‰ç›¸åŒ Keyï¼Œåªéœ€æ¯”è¾ƒ Sequenceï¼Œè°ƒadjustWithSameWinnerKey()å»å¤„ç†</span>
                    adjustWithSameWinnerKey(parent, parentNode, winnerNode);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> WINNER_POPPED:
                    <span class="hljs-comment">// winner å·²è¢«å¼¹å‡ºï¼Œå¿«é€Ÿè·¯å¾„ä¼˜åŒ–</span>
                    <span class="hljs-keyword">if</span> (winnerNode.firstSameKeyIndex &lt; <span class="hljs-number">0</span>) {
                        <span class="hljs-comment">// æ²¡æœ‰æ›´å¤šç›¸åŒ Key äº†ï¼Œåœæ­¢è°ƒæ•´</span>
                        parent = -<span class="hljs-number">1</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„ï¼šæ ¹æ®winnerèŠ‚ç‚¹è®°å½•çš„firstSameKeyIndexï¼Œç›´æ¥è·³è½¬åˆ°ç¬¬ä¸€ä¸ªç›¸åŒ Key çš„ä½ç½®</span>
                        <span class="hljs-comment">// æ›´æ–°winnerèŠ‚ç‚¹çš„stateä¸ºLOSER_POPPEDï¼Œå¹¶æ›´æ–°parentNodeå’Œå…¶çŠ¶æ€ï¼Œåç»­ä¼šäº¤æ¢</span>
                        parent = winnerNode.firstSameKeyIndex;
                        parentNode = leaves.get(<span class="hljs-built_in">this</span>.tree[parent]);
                        winnerNode.state = State.LOSER_POPPED;
                        parentNode.state = State.WINNER_WITH_SAME_KEY;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                            <span class="hljs-string">"unknown state for "</span> + winnerNode.state.name());
            }
        }

        <span class="hljs-comment">// if the winner loses, exchange nodes.</span>
        <span class="hljs-comment">// å¦‚æœå¤„ç†å®Œï¼Œæœ€å¼€å§‹çš„èƒœè€…èŠ‚ç‚¹çŠ¶æ€å˜äº†ï¼Œä¸å†æ˜¯èƒœè€…äº†ï¼Œé‚£ä¹ˆè°ƒæ•´èƒœè€…èŠ‚ç‚¹</span>
        <span class="hljs-comment">// åŸ parent ä¸­çš„è´¥è€…æˆä¸ºæ–° winnerï¼Œç»§ç»­å‘ä¸Šæ¯”è¾ƒ</span>
        <span class="hljs-keyword">if</span> (!winnerNode.state.isWinner()) {
            <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> winner;
            winner = <span class="hljs-built_in">this</span>.tree[parent];
            <span class="hljs-built_in">this</span>.tree[parent] = tmp;
        }
    }
    <span class="hljs-comment">// å¾ªç¯ç»“æŸï¼Œæœ€ç»ˆ winner åˆ°è¾¾æ ¹èŠ‚ç‚¹</span>
    <span class="hljs-built_in">this</span>.tree[<span class="hljs-number">0</span>] = winner;
}
</code></pre>
<h4 data-id="heading-21">(7) <code>adjustWithNewWinnerKey()</code> -- æ–°Keyèµ¢å®¶çš„å¤„ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustWithNewWinnerKey</span><span class="hljs-params">(
        <span class="hljs-type">int</span> index, LeafIterator&lt;T&gt; parentNode, LeafIterator&lt;T&gt; winnerNode)</span> {
    <span class="hljs-comment">// å¤„ç†åœºæ™¯ï¼šå½“å‰ winner æŒæœ‰çš„æ˜¯æ–° Keyï¼ˆä¸å…¨å±€èµ¢å®¶ä¸åŒï¼‰</span>
    <span class="hljs-comment">// åˆ¤æ–­çˆ¶èŠ‚ç‚¹æƒ…å†µ</span>
    <span class="hljs-keyword">switch</span> (parentNode.state) {
        <span class="hljs-comment">// CASE-1: parentNode ä¹Ÿæ˜¯æ–° Keyï¼Œéœ€è¦å®Œæ•´æ¯”è¾ƒ</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_NEW_KEY:
            <span class="hljs-comment">// when the new winner is also a new key, it needs to be compared.</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">parentKey</span> <span class="hljs-operator">=</span> parentNode.peek();
            <span class="hljs-type">T</span> <span class="hljs-variable">childKey</span> <span class="hljs-operator">=</span> winnerNode.peek();
            <span class="hljs-comment">/* 1.å…ˆæ¯”è¾ƒKeyï¼Œ
            æ³¨æ„ï¼šSortMergeReaderWithLoserTreeä¼ å…¥çš„Keyæ¯”è¾ƒå™¨æ˜¯(e1, e2) -&gt; userKeyComparator.compare(e2.key(), e1.key())
            firstComparator.compare(parentKey, childKey)
                è¿”å›&gt;0ï¼Œè¡¨ç¤ºchildçš„keyå¤§ï¼Œparentæ˜¯èµ¢å®¶
                è¿”å›&lt;0ï¼Œè¡¨ç¤ºparentçš„keyå¤§ï¼Œchildæ˜¯èµ¢å®¶
                è¿”å›=0ï¼Œè¡¨ç¤ºä¸€æ ·å¤§ï¼Œéœ€è¦å†è¿›è¡ŒSequenceæ¯”è¾ƒ
             */</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">firstResult</span> <span class="hljs-operator">=</span> firstComparator.compare(parentKey, childKey);
            <span class="hljs-comment">// SUB-CASE-1: Keyä¸€æ ·ï¼Œå†è¿›è¡ŒSequenceæ¯”è¾ƒ</span>
            <span class="hljs-keyword">if</span> (firstResult == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// æ³¨æ„ï¼šsecondComparatorå…¶å®æ˜¯(e1, e2) -&gt; Long.compare(e2.sequenceNumber(), e1.sequenceNumber());</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">secondResult</span> <span class="hljs-operator">=</span> secondComparator.compare(parentKey, childKey);

                <span class="hljs-comment">// parentçš„Sequenceæ›´å¤§ï¼Œchildæ˜¯æ—§çš„æ•°æ®ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯èµ¢å®¶ï¼Œä¼˜å…ˆå¼¹å‡º</span>
                <span class="hljs-keyword">if</span> (secondResult &lt; <span class="hljs-number">0</span>) {
                    parentNode.state = State.LOSER_WITH_SAME_KEY;
                    winnerNode.setFirstSameKeyIndex(index); <span class="hljs-comment">// è®°å½•ç›¸åŒ Key çš„ä½ç½®</span>
                }
                <span class="hljs-comment">// child çš„ Sequence æ›´å¤§æˆ–ç›¸ç­‰ï¼Œparentæ˜¯æ—§çš„æ•°æ®ï¼Œåˆ™parentæ˜¯èµ¢å®¶ï¼Œä¼˜å…ˆå¼¹å‡º</span>
                <span class="hljs-keyword">else</span> {
                    winnerNode.state = State.LOSER_WITH_SAME_KEY;
                    parentNode.state = State.WINNER_WITH_NEW_KEY;
                    parentNode.setFirstSameKeyIndex(index);
                }
            }
            <span class="hljs-comment">// SUB-CASE-2: childçš„Keyå¤§ï¼Œåˆ™ parentæ˜¯èµ¢å®¶ï¼Œéœ€æ›´æ–°ä¿©èŠ‚ç‚¹çŠ¶æ€</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (firstResult &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// the two keys are completely different and just need to update the state.</span>
                parentNode.state = State.WINNER_WITH_NEW_KEY;
                winnerNode.state = State.LOSER_WITH_NEW_KEY;
            }
            <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// CASE-2: ä¸å¯èƒ½çš„æƒ…å†µï¼Œå› ä¸ºç›¸åŒçš„keyä¼šèµ°adjustWithSameWinnerKeyè¿™ä¸ªæ–¹æ³•ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_SAME_KEY:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                    <span class="hljs-string">"This is a bug. Please file an issue. A node in the WINNER_WITH_NEW_KEY "</span>
                            + <span class="hljs-string">"state cannot encounter a node in the LOSER_WITH_SAME_KEY state."</span>);
        <span class="hljs-comment">// CASE-3: ä»…å‘ç”Ÿåœ¨ adjustForNextLoop ä¸­</span>
        <span class="hljs-comment">// parent å·²ç»è¢«å¼¹å‡ºå¤„ç†è¿‡ï¼Œç°åœ¨æœ‰æ–°æ•°æ®è¿›æ¥</span>
        <span class="hljs-keyword">case</span> LOSER_POPPED:
            parentNode.state = State.WINNER_POPPED;
            parentNode.firstSameKeyIndex = -<span class="hljs-number">1</span>;
            winnerNode.state = State.LOSER_WITH_NEW_KEY;
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                    <span class="hljs-string">"unknown state for "</span> + parentNode.state.name());
    }
}
</code></pre>
<h4 data-id="heading-22">(8) <code>adjustWithSameWinnerKey()</code> -- ç›¸åŒkeyèµ¢å®¶çš„å¤„ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustWithSameWinnerKey</span><span class="hljs-params">(
        <span class="hljs-type">int</span> index, LeafIterator&lt;T&gt; parentNode, LeafIterator&lt;T&gt; winnerNode)</span> {
    <span class="hljs-keyword">switch</span> (parentNode.state) {
        <span class="hljs-comment">// CASE-1: parentæœ‰ç›¸åŒçš„Keyï¼Œåˆ™åªéœ€è¦å†æ¯”è¾ƒSequneceå³å¯</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_SAME_KEY:
            <span class="hljs-comment">// the key of the previous loser is the same as the key of the current winner,</span>
            <span class="hljs-comment">// only the sequence needs to be compared.</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">parentKey</span> <span class="hljs-operator">=</span> parentNode.peek();
            <span class="hljs-type">T</span> <span class="hljs-variable">childKey</span> <span class="hljs-operator">=</span> winnerNode.peek();
            <span class="hljs-comment">// æ¯”è¾ƒSequence</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">secondResult</span> <span class="hljs-operator">=</span> secondComparator.compare(parentKey, childKey);
            <span class="hljs-comment">// child çš„ Sequence æ›´å¤§ï¼Œparent æ˜¯æ—§çš„ï¼Œéœ€è¦å…ˆå¼¹å‡ºï¼Œè°ƒæ•´ä¸¤èŠ‚ç‚¹çš„çŠ¶æ€</span>
            <span class="hljs-keyword">if</span> (secondResult &gt; <span class="hljs-number">0</span>) {
                parentNode.state = State.WINNER_WITH_SAME_KEY;
                winnerNode.state = State.LOSER_WITH_SAME_KEY;
                parentNode.setFirstSameKeyIndex(index);
            }
            <span class="hljs-comment">// parent çš„ Sequence æ›´å¤§ï¼Œchild æ˜¯æ—§çš„ï¼Œéœ€è¦å…ˆå¼¹å‡ºï¼Œä¸éœ€è¦è°ƒæ•´çŠ¶æ€ï¼Œåªéœ€è¦è®°å½•indexå³å¯</span>
            <span class="hljs-keyword">else</span> {
                winnerNode.setFirstSameKeyIndex(index);
            }
            <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// CASE-2: å…¶ä»–æƒ…å†µï¼Œéƒ½ä¸åœ¨è¿™ä¸ªæ–¹æ³•å¤„ç†ï¼Œä¼šåœ¨adjustWithNewWinnerKey()ä¸­å¤„ç†</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_NEW_KEY:
        <span class="hljs-keyword">case</span> LOSER_POPPED:
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                    <span class="hljs-string">"unknown state for "</span> + parentNode.state.name());
    }
}
</code></pre>
<h3 data-id="heading-23">3.æµç¨‹æ€»ç»“</h3>
<h4 data-id="heading-24">(1) åˆå§‹çŠ¶æ€</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>]
<span class="hljs-attr">size</span> = <span class="hljs-number">3</span>

æ‰€æœ‰ Leaf åˆå§‹çŠ¶æ€ï¼š
Leaf 0: <span class="hljs-attr">kv</span>=null, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">kv</span>=null, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">kv</span>=null, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-25">(2) initializeIfNeededé˜¶æ®µ</h4>
<h5 data-id="heading-26">&lt;1&gt; æ­¥éª¤ 1ï¼ši=2, adjust(2)</h5>
<p><code>advanceIfAvailable()</code></p>
<pre><code class="hljs language-ini" lang="ini">Leaf 2 è¯»å–ç¬¬ä¸€æ¡è®°å½•
Leaf 2: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<p><code>adjust(2)</code></p>
<pre><code class="hljs language-java" lang="java">winner = <span class="hljs-number">2</span>
parent = (<span class="hljs-number">2</span> + <span class="hljs-number">3</span>) / <span class="hljs-number">2</span> = <span class="hljs-number">2</span>

å¾ªç¯ç¬¬ <span class="hljs-number">1</span> è½®ï¼šparent=<span class="hljs-number">2</span>, winner=<span class="hljs-number">2</span>
  winnerNode = Leaf <span class="hljs-number">2</span>
  tree[<span class="hljs-number">2</span>] == -<span class="hljs-number">1</span>  <span class="hljs-comment">// åˆå§‹åŒ–åˆ†æ”¯</span>
  â†’ winnerNode.state = LOSER_WITH_NEW_KEY
  
  !winnerNode.state.isWinner() = <span class="hljs-literal">true</span>ï¼ˆæ˜¯ LOSERï¼‰
  â†’ äº¤æ¢ï¼š
     tmp = <span class="hljs-number">2</span>
     winner = tree[<span class="hljs-number">2</span>] = -<span class="hljs-number">1</span>
     tree[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>
  
  winner = -<span class="hljs-number">1</span>
  parent /= <span class="hljs-number">2</span> â†’ parent = <span class="hljs-number">1</span>
  å¾ªç¯æ¡ä»¶ï¼š<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span> &amp;&amp; -<span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> â†’ <span class="hljs-literal">false</span>

tree[<span class="hljs-number">0</span>] = -<span class="hljs-number">1</span>
</code></pre>
<p><strong>ç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]
Leaf 2: <span class="hljs-attr">state</span>=LOSER_WITH_NEW_KEY
</code></pre>
<h5 data-id="heading-27">&lt;2&gt; æ­¥éª¤ 2ï¼ši=1, adjust(1)</h5>
<p><code>advanceIfAvailable()</code></p>
<pre><code class="hljs language-ini" lang="ini">Leaf 1: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<p><code>adjust(1)</code></p>
<pre><code class="hljs language-java" lang="java">winner = <span class="hljs-number">1</span>
parent = (<span class="hljs-number">1</span> + <span class="hljs-number">3</span>) / <span class="hljs-number">2</span> = <span class="hljs-number">2</span>

å¾ªç¯ç¬¬ <span class="hljs-number">1</span> è½®ï¼šparent=<span class="hljs-number">2</span>, winner=<span class="hljs-number">1</span>
  winnerNode = Leaf <span class="hljs-number">1</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, state=WINNER_WITH_NEW_KEY)
  tree[<span class="hljs-number">2</span>] == <span class="hljs-number">2</span>
  parentNode = Leaf <span class="hljs-number">2</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, state=LOSER_WITH_NEW_KEY)
  
  winnerNode.state = WINNER_WITH_NEW_KEY
  â†’ è°ƒç”¨ adjustWithNewWinnerKey(<span class="hljs-number">2</span>, Leaf <span class="hljs-number">2</span>, Leaf <span class="hljs-number">1</span>)
  
  adjustWithNewWinnerKey():
    parentNode.state = <span class="hljs-type">LOSER_WITH_NEW_KEY</span>
    <span class="hljs-variable">parentKey</span> <span class="hljs-operator">=</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>}
    childKey = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>}
    
    firstResult = firstComparator.compare(parentKey, childKey)
                = userKeyComparator.compare(childKey, parentKey)
                = userKeyComparator.compare({key=<span class="hljs-number">1</span>}, {key=<span class="hljs-number">1</span>})
                = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// Key ç›¸åŒï¼Œæ¯”è¾ƒ Sequence</span>
    secondResult = secondComparator.compare(parentKey, childKey)
                 = Long.compare(childKey.seq, parentKey.seq)
                 = Long.compare(<span class="hljs-number">200</span>, <span class="hljs-number">150</span>)
                 = <span class="hljs-number">50</span> &gt; <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// secondResult &gt; 0ï¼Œè¿›å…¥ else åˆ†æ”¯</span>
    <span class="hljs-comment">// parent çš„ seq æ›´å°ï¼Œparent æ˜¯èµ¢å®¶</span>
    winnerNode.state = LOSER_WITH_SAME_KEY
    parentNode.state = WINNER_WITH_NEW_KEY
    parentNode.setFirstSameKeyIndex(<span class="hljs-number">2</span>)  <span class="hljs-comment">// è®°å½• index=2</span>
    
    <span class="hljs-comment">// Leaf 2.firstSameKeyIndex == -1ï¼Œè®¾ç½®ä¸º 2</span>
    Leaf <span class="hljs-number">2.</span>firstSameKeyIndex = <span class="hljs-number">2</span>
  
  <span class="hljs-comment">// è¿”å›åæ£€æŸ¥</span>
  !winnerNode.state.isWinner() = <span class="hljs-literal">true</span>ï¼ˆLeaf <span class="hljs-number">1</span> æ˜¯ LOSERï¼‰
  â†’ äº¤æ¢ï¼š
     tmp = <span class="hljs-number">1</span>
     winner = tree[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>
     tree[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
  
  winner = <span class="hljs-number">2</span>
  parent /= <span class="hljs-number">2</span> â†’ parent = <span class="hljs-number">1</span>

å¾ªç¯ç¬¬ <span class="hljs-number">2</span> è½®ï¼šparent=<span class="hljs-number">1</span>, winner=<span class="hljs-number">2</span>
  winnerNode = Leaf <span class="hljs-number">2</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, state=WINNER_WITH_NEW_KEY)
  tree[<span class="hljs-number">1</span>] == -<span class="hljs-number">1</span>  <span class="hljs-comment">// åˆå§‹åŒ–åˆ†æ”¯</span>
  â†’ winnerNode.state = LOSER_WITH_NEW_KEY
  
  !isWinner() = <span class="hljs-literal">true</span>
  â†’ äº¤æ¢ï¼š
     tmp = <span class="hljs-number">2</span>
     winner = tree[<span class="hljs-number">1</span>] = -<span class="hljs-number">1</span>
     tree[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
  
  winner = -<span class="hljs-number">1</span>
  parent = <span class="hljs-number">0</span>
  å¾ªç¯æ¡ä»¶ï¼š<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> â†’ <span class="hljs-literal">false</span>

tree[<span class="hljs-number">0</span>] = -<span class="hljs-number">1</span>
</code></pre>
<p><strong>ç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]
Leaf 1: <span class="hljs-attr">state</span>=LOSER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=LOSER_WITH_NEW_KEY, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h5 data-id="heading-28">&lt;3&gt; æ­¥éª¤ 3ï¼ši=0, adjust(0)</h5>
<p><code>advanceIfAvailable()</code></p>
<pre><code class="hljs language-ini" lang="ini">Leaf 0: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<p><code>adjust(0)</code></p>
<pre><code class="hljs language-java" lang="java">winner = <span class="hljs-number">0</span>
parent = (<span class="hljs-number">0</span> + <span class="hljs-number">3</span>) / <span class="hljs-number">2</span> = <span class="hljs-number">1</span>

å¾ªç¯ç¬¬ <span class="hljs-number">1</span> è½®ï¼šparent=<span class="hljs-number">1</span>, winner=<span class="hljs-number">0</span>
  winnerNode = Leaf <span class="hljs-number">0</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, state=WINNER_WITH_NEW_KEY)
  tree[<span class="hljs-number">1</span>] == <span class="hljs-number">2</span>
  parentNode = Leaf <span class="hljs-number">2</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, state=LOSER_WITH_NEW_KEY)
  
  è°ƒç”¨ adjustWithNewWinnerKey(<span class="hljs-number">1</span>, Leaf <span class="hljs-number">2</span>, Leaf <span class="hljs-number">0</span>):
    parentKey = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>}
    childKey = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>}
    
    firstResult = compare({key=<span class="hljs-number">1</span>}, {key=<span class="hljs-number">1</span>}) = <span class="hljs-number">0</span>
    
    secondResult = Long.compare(<span class="hljs-number">100</span>, <span class="hljs-number">150</span>) = -<span class="hljs-number">50</span> &lt; <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// secondResult &lt; 0ï¼Œè¿›å…¥ if åˆ†æ”¯</span>
    <span class="hljs-comment">// child çš„ seq æ›´å°ï¼Œchild æ˜¯èµ¢å®¶</span>
    parentNode.state = LOSER_WITH_SAME_KEY
    winnerNode.setFirstSameKeyIndex(<span class="hljs-number">1</span>)
    
    Leaf <span class="hljs-number">0.</span>firstSameKeyIndex = <span class="hljs-number">1</span>
  
  <span class="hljs-comment">// winnerNode è¿˜æ˜¯ WINNER</span>
  !isWinner() = <span class="hljs-literal">false</span>
  â†’ ä¸äº¤æ¢
  
  winner = <span class="hljs-number">0</span>
  parent = <span class="hljs-number">0</span>
  å¾ªç¯æ¡ä»¶ï¼š<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> â†’ <span class="hljs-literal">false</span>

tree[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>
</code></pre>
<h5 data-id="heading-29">&lt;4&gt; åˆå§‹åŒ–å®Œæˆ</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]
- tree<span class="hljs-section">[0]</span> = 0 â†’ å…¨å±€èµ¢å®¶ Leaf 0 (<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>)
- tree<span class="hljs-section">[1]</span> = 2 â†’ è´¥è€… Leaf 2 (<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>)
- tree<span class="hljs-section">[2]</span> = 1 â†’ è´¥è€… Leaf 1 (<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>)

Leaf 0: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>}, state=LOSER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>}, state=LOSER_WITH_SAME_KEY, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h4 data-id="heading-30">(3) SortMergeIterator.next() æ‰§è¡Œ</h4>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ next()</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        loserTree.adjustForNextLoop();       <span class="hljs-comment">// æ­¥éª¤ 1</span>
        <span class="hljs-type">KeyValue</span> <span class="hljs-variable">winner</span> <span class="hljs-operator">=</span> loserTree.popWinner(); <span class="hljs-comment">// æ­¥éª¤ 2</span>
        <span class="hljs-keyword">if</span> (winner == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        
        mergeFunctionWrapper.reset();        <span class="hljs-comment">// æ­¥éª¤ 3</span>
        mergeFunctionWrapper.add(winner);    <span class="hljs-comment">// æ­¥éª¤ 4</span>
        
        <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> merge();                  <span class="hljs-comment">// æ­¥éª¤ 5</span>
        <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h5 data-id="heading-31">&lt;1&gt; æ­¥éª¤ 1ï¼šadjustForNextLoop()</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustForNextLoop</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">while</span> (winner.state == State.WINNER_POPPED) {
        winner.advanceIfAvailable();
        adjust(tree[<span class="hljs-number">0</span>]);
        winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    }
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">winner</span> = leaves.get(<span class="hljs-number">0</span>) = Leaf <span class="hljs-number">0</span>
Leaf <span class="hljs-attr">0.state</span> = WINNER_WITH_NEW_KEY â‰  WINNER_POPPED
â†’ å¾ªç¯æ¡ä»¶ä¸æ»¡è¶³ï¼Œç›´æ¥è¿”å›
</code></pre>
<h5 data-id="heading-32">&lt;2&gt; æ­¥éª¤ 2ï¼špopWinner()</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">popWinner</span><span class="hljs-params">()</span> {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">if</span> (winner.state == State.WINNER_POPPED) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> winner.pop();
    adjust(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<pre><code class="hljs language-java" lang="java">winner = Leaf <span class="hljs-number">0</span>
Leaf <span class="hljs-number">0.</span>state = WINNER_WITH_NEW_KEY â‰  <span class="hljs-type">WINNER_POPPED</span>

<span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Leaf <span class="hljs-number">0.</span>pop()
  Leaf <span class="hljs-number">0.</span>state = WINNER_POPPED
  <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}

è°ƒç”¨ adjust(<span class="hljs-number">0</span>):
  winner = <span class="hljs-number">0</span>
  parent = <span class="hljs-number">1</span>
  
  å¾ªç¯ç¬¬ <span class="hljs-number">1</span> è½®ï¼š
    winnerNode = Leaf <span class="hljs-number">0</span> (state=WINNER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>)
    tree[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
    parentNode = Leaf <span class="hljs-number">2</span>
    
    <span class="hljs-comment">// WINNER_POPPED åˆ†æ”¯</span>
    firstSameKeyIndex = <span class="hljs-number">1</span> â‰¥ <span class="hljs-number">0</span>
    â†’ å¿«é€Ÿè·¯å¾„
    parent = <span class="hljs-number">1</span>
    parentNode = Leaf <span class="hljs-number">2</span> (tree[<span class="hljs-number">1</span>])
    
    Leaf <span class="hljs-number">0.</span>state = LOSER_POPPED
    Leaf <span class="hljs-number">2.</span>state = WINNER_WITH_SAME_KEY
    
    <span class="hljs-comment">// æ£€æŸ¥ !winnerNode.state.isWinner()</span>
    <span class="hljs-comment">// Leaf 0 ç°åœ¨æ˜¯ LOSER_POPPED (ä¸æ˜¯èµ¢å®¶)</span>
    !isWinner() = <span class="hljs-literal">true</span>
    â†’ äº¤æ¢ï¼š
       tmp = <span class="hljs-number">0</span>
       winner = tree[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
       tree[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>
    
    winner = <span class="hljs-number">2</span>
    parent = <span class="hljs-number">0</span>
    å¾ªç¯æ¡ä»¶ï¼š<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> â†’ <span class="hljs-literal">false</span>
  
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">2</span>

è¿”å›ï¼š{key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}
</code></pre>
<p><strong>å½“å‰çŠ¶æ€</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
- tree<span class="hljs-section">[0]</span> = 2 â†’ Leaf 2 æ˜¯æ–°çš„å…¨å±€èµ¢å®¶

Leaf 0: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">state</span>=LOSER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=WINNER_WITH_SAME_KEY, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h5 data-id="heading-33">&lt;3&gt; æ­¥éª¤ 3-4ï¼šreset() å’Œ add()</h5>
<pre><code class="hljs language-ini" lang="ini">mergeFunctionWrapper.reset()<span class="hljs-comment">;</span>
  <span class="hljs-attr">latestKv</span> = null

mergeFunctionWrapper.add({<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>})<span class="hljs-comment">;</span>
  <span class="hljs-attr">latestKv</span> = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}
</code></pre>
<h5 data-id="heading-34">&lt;4&gt; æ­¥éª¤ 5ï¼šmerge()</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> T <span class="hljs-title function_">merge</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">while</span> (loserTree.peekWinner() != <span class="hljs-literal">null</span>) {
        mergeFunctionWrapper.add(loserTree.popWinner());
    }
    <span class="hljs-keyword">return</span> mergeFunctionWrapper.getResult();
}
</code></pre>
<h6 data-id="heading-35">ã€Š1ã€‹ç¬¬ 1 æ¬¡å¾ªç¯</h6>
<pre><code class="hljs language-java" lang="java">peekWinner():
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">2</span>
  Leaf <span class="hljs-number">2.</span>state = WINNER_WITH_SAME_KEY â‰  WINNER_POPPED
  <span class="hljs-keyword">return</span> Leaf <span class="hljs-number">2.</span>peek() = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}  âœ…

popWinner():
  winner = Leaf <span class="hljs-number">2</span>
  Leaf <span class="hljs-number">2.</span>state â‰  <span class="hljs-type">WINNER_POPPED</span>
  
  <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Leaf <span class="hljs-number">2.</span>pop()
    Leaf <span class="hljs-number">2.</span>state = WINNER_POPPED
    <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}
  
  adjust(<span class="hljs-number">2</span>):
    winner = <span class="hljs-number">2</span>
    parent = <span class="hljs-number">2</span>
    
    winnerNode = Leaf <span class="hljs-number">2</span> (WINNER_POPPED, firstSameKeyIndex=<span class="hljs-number">2</span>)
    tree[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
    parentNode = Leaf <span class="hljs-number">1</span>
    
    firstSameKeyIndex = <span class="hljs-number">2</span> â‰¥ <span class="hljs-number">0</span>
    parent = <span class="hljs-number">2</span>
    parentNode = Leaf <span class="hljs-number">1</span> (tree[<span class="hljs-number">2</span>])
    
    Leaf <span class="hljs-number">2.</span>state = LOSER_POPPED
    Leaf <span class="hljs-number">1.</span>state = WINNER_WITH_SAME_KEY
    
    !isWinner() = <span class="hljs-literal">true</span>
    â†’ äº¤æ¢ï¼š
       tmp = <span class="hljs-number">2</span>
       winner = tree[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
       tree[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>
    
    winner = <span class="hljs-number">1</span>
    parent = <span class="hljs-number">1</span>
    
    å¾ªç¯ç¬¬ <span class="hljs-number">2</span> è½®ï¼š
      winnerNode = Leaf <span class="hljs-number">1</span> (WINNER_WITH_SAME_KEY)
      tree[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>
      parentNode = Leaf <span class="hljs-number">0</span> (LOSER_POPPED)
      
      <span class="hljs-comment">// adjustWithSameWinnerKey</span>
      parentNode.state = LOSER_POPPED
      â†’ <span class="hljs-keyword">return</span>ï¼ˆä¸å¤„ç†ï¼‰
      
      !isWinner() = <span class="hljs-literal">false</span>ï¼ˆLeaf <span class="hljs-number">1</span> æ˜¯ WINNERï¼‰
      â†’ ä¸äº¤æ¢
      
      parent = <span class="hljs-number">0</span>
      å¾ªç¯æ¡ä»¶ï¼š<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> â†’ <span class="hljs-literal">false</span>
    
    tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>

add({key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}):
  latestKv = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>} <span class="hljs-comment">// å¼¹å‡º</span>
</code></pre>
<p><strong>å½“å‰çŠ¶æ€</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>]

Leaf 0: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">state</span>=WINNER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h6 data-id="heading-36">ã€Š2ã€‹ç¬¬ 2 æ¬¡å¾ªç¯</h6>
<pre><code class="hljs language-java" lang="java">peekWinner():
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>
  Leaf <span class="hljs-number">1.</span>state = WINNER_WITH_SAME_KEY â‰  WINNER_POPPED
  <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}  âœ…

popWinner():
  result = Leaf <span class="hljs-number">1.</span>pop()
    Leaf <span class="hljs-number">1.</span>state = WINNER_POPPED
    <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}
  
  adjust(<span class="hljs-number">1</span>):
    winner = <span class="hljs-number">1</span>
    parent = <span class="hljs-number">2</span>
    
    winnerNode = Leaf <span class="hljs-number">1</span> (WINNER_POPPED, firstSameKeyIndex=-<span class="hljs-number">1</span>)
    
    firstSameKeyIndex = -<span class="hljs-number">1</span> &lt; <span class="hljs-number">0</span>
    â†’ parent = -<span class="hljs-number">1</span>ï¼ˆåœæ­¢è°ƒæ•´ï¼‰
    
    !isWinner() = <span class="hljs-literal">false</span> â†’ ä¸å¤„ç†
    
    å¾ªç¯æ¡ä»¶ï¼š-<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span> â†’ <span class="hljs-literal">false</span>
    
    tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>

add({key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}):
  latestKv = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}  <span class="hljs-comment">// å¼¹å‡º</span>
</code></pre>
<p><strong>å½“å‰çŠ¶æ€</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>]

Leaf 0: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">state</span>=WINNER_POPPED, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h6 data-id="heading-37">ã€Š3ã€‹ç¬¬ 3 æ¬¡å¾ªç¯</h6>
<pre><code class="hljs language-java" lang="java">peekWinner():
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>
  Leaf <span class="hljs-number">1.</span>state = WINNER_POPPED
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>  âŒ

å¾ªç¯ç»“æŸ

getResult():
  <span class="hljs-type">return</span> <span class="hljs-variable">latestKv</span> <span class="hljs-operator">=</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}
</code></pre>
<hr/>
<h4 data-id="heading-38">(4) æœ€ç»ˆç»“æœ</h4>
<pre><code class="hljs language-ini" lang="ini">ä»¥deduplicateè¦†ç›–ä¸ºä¾‹å­
next() è¿”å›ï¼š{<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}

æ‰€æœ‰ç›¸åŒ Key çš„è®°å½•éƒ½è¢«æ”¶é›†ï¼š
<span class="hljs-attr">1. seq</span>=<span class="hljs-number">100</span> å…ˆæ·»åŠ 
<span class="hljs-attr">2. seq</span>=<span class="hljs-number">150</span> è¦†ç›–
<span class="hljs-attr">3. seq</span>=<span class="hljs-number">200</span> æœ€ç»ˆè¦†ç›–

ä¿ç•™çš„æ˜¯ Sequence æœ€å¤§ï¼ˆæœ€æ–°ï¼‰çš„æ•°æ®
</code></pre>
<p>å®˜æ–¹æ¡ˆä¾‹è¯·çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcwiki.apache.org%2Fconfluence%2Fdisplay%2FPAIMON%2FPIP-2%253A%2BOptimize%2BSortMergeReader%2Bwith%2BLoserTree" target="_blank" title="https://cwiki.apache.org/confluence/display/PAIMON/PIP-2%3A+Optimize+SortMergeReader+with+LoserTree" ref="nofollow noopener noreferrer">PIP-2: Optimize SortMergeReader with LoserTree - Paimon - Apache Software Foundation</a></p>
<p>è¡¥å……:<code>sequence-field</code>å’Œ<code>sequence-group</code>çš„åŒºåˆ«
åˆ†å·¥å¦‚ä¸‹</p>
<pre><code class="hljs language-vbnet" lang="vbnet">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€å±‚ï¼šLoserTreeï¼ˆå…¨å±€æ’åºå±‚ï¼‰                      â”‚
â”‚  - èŒè´£ï¼šæŒ‰ <span class="hljs-keyword">Key</span> + sequence.field å…¨å±€æ’åº             â”‚
â”‚  - ç›®æ ‡ï¼šç¡®ä¿ç›¸åŒ <span class="hljs-keyword">Key</span> çš„è®°å½•æŒ‰sequence-fieldçš„é¡ºåºå¼¹å‡º  â”‚
â”‚  - æ¯”è¾ƒå™¨ï¼šuserDefinedSeqComparatorï¼ˆè¡¨çº§å…¨å±€ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ æŒ‰åºå¼¹å‡ºè®°å½•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬äºŒå±‚ï¼šMergeFunctionï¼ˆå­—æ®µçº§åˆå¹¶å±‚ï¼‰                â”‚
â”‚  - èŒè´£ï¼šå­—æ®µçº§åˆ«çš„ç»†ç²’åº¦åˆå¹¶æ§åˆ¶                      â”‚
â”‚  - ç›®æ ‡ï¼šä¸åŒå­—æ®µå¯ä»¥æœ‰ç‹¬ç«‹çš„æ›´æ–°ç­–ç•¥                   â”‚
â”‚  - æ¯”è¾ƒå™¨ï¼šsequence-<span class="hljs-keyword">group</span>ï¼ˆå­—æ®µçº§å±€éƒ¨ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
<ol>
<li><code>sequence-field</code>æ˜¯å…¨å±€ç»‘å®šï¼Œåœ¨loser-treeä¸­å†³å®šå“ªäº›æ•°æ®å…ˆå¼¹å‡º</li>
<li><code>sequence-group</code>æ˜¯å­—æ®µç»‘å®šï¼Œåœ¨mergefunctionçš„æ—¶å€™ä¼šå»è¿›è¡Œç›¸åº”çš„èšåˆåˆ¤æ–­</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è€é¡¹ç›®æ”¹é€  vue-cli 2.6 å‡çº§ rsbuild æå‡å¼€å‘æ•ˆç‡300% upupupï¼ï¼ï¼]]></title>    <link>https://juejin.cn/post/7584633505105215540</link>    <guid>https://juejin.cn/post/7584633505105215540</guid>    <pubDate>2025-12-17T10:01:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105215540" data-draft-id="7584472215975477263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è€é¡¹ç›®æ”¹é€  vue-cli 2.6 å‡çº§ rsbuild æå‡å¼€å‘æ•ˆç‡300% upupupï¼ï¼ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-17T10:01:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¿˜å¥½è¿˜å¥½ä¸æ˜¯å—"/> <meta itemprop="url" content="https://juejin.cn/user/1781663850575198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è€é¡¹ç›®æ”¹é€  vue-cli 2.6 å‡çº§ rsbuild æå‡å¼€å‘æ•ˆç‡300% upupupï¼ï¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1781663850575198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¿˜å¥½è¿˜å¥½ä¸æ˜¯å—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:01:13.000Z" title="Wed Dec 17 2025 10:01:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å…ˆä¸Šå›¾æ‰“åŒ… 100må¤§å°å’Œæ—¶é—´37ç§’</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e58782afde845138d711501b5401518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=PFzECq%2BWAsGw%2FmOfowfOIN%2FFjnQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/335f37d763f44668bd1988238d8e2092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=e4iAzSSz5TQNxh%2FD%2FxIQI3LW5jc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8849ce8212642ae9e99bf17a3314834~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=AqiTB1lWtFDqHy5lPS9SetVO20M%3D" alt="image.png" loading="lazy"/></p>
<p>å‡çº§åæ‰“åŒ…37ç§’</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52c6fdc204d944c4ac7dab0aaa609273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=50kLNk5SzZ6nDEIV0yyf2VJSh3U%3D" alt="image.png" loading="lazy"/></p>
<p>å¯åŠ¨é¡¹ç›®2ç§’å·¦å³
æ‰“å¼€ç¬¬ä¸€æ¬¡é¡µé¢7ç§’å·¦å³åç»­æ­£å¸¸è®¿é—® æ€»çš„9ç§’å·¦å³ å’Œviteå·®ä¸å¤šé¡¹ç›®å¾ˆå¤§</p>
<p>å…ˆä¸Švue-cli å‡çº§ç¤ºä¾‹é¡¹ç›®
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1438343098%2Frsbuild-less-module-bug" target="_blank" title="https://github.com/1438343098/rsbuild-less-module-bug" ref="nofollow noopener noreferrer">github.com/1438343098/â€¦</a></p>
<p>è´´é…ç½®</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/core'</span>
<span class="hljs-keyword">import</span> { pluginVue2 } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-vue2'</span>
<span class="hljs-keyword">import</span> { pluginBabel } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-babel'</span>
<span class="hljs-keyword">import</span> { pluginVue2Jsx } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-vue2-jsx'</span>
<span class="hljs-keyword">import</span> { pluginNodePolyfill } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-node-polyfill'</span>
<span class="hljs-keyword">import</span> { pluginBasicSsl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-basic-ssl'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = dir =&gt; path.<span class="hljs-title function_">resolve</span>(__dirname, dir)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">pluginNodePolyfill</span>(),
    <span class="hljs-title function_">pluginBabel</span>({
      <span class="hljs-comment">// å¤„ç†å­åŒ…</span>
      <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/src/</span>, <span class="hljs-regexp">/@kuaizi\/saas-components/</span>],
      <span class="hljs-attr">babelLoaderOptions</span>: {
        <span class="hljs-attr">presets</span>: [[<span class="hljs-string">'@babel/preset-env'</span>, { <span class="hljs-attr">targets</span>: <span class="hljs-string">'defaults'</span> }]]
      }
    }),
    <span class="hljs-title function_">pluginVue2</span>(),
    <span class="hljs-comment">// jsx</span>
    <span class="hljs-title function_">pluginVue2Jsx</span>(),
    <span class="hljs-comment">// ssl</span>
    <span class="hljs-title function_">pluginBasicSsl</span>()
  ],
  <span class="hljs-attr">source</span>: {
    <span class="hljs-attr">entry</span>: {
      <span class="hljs-attr">index</span>: <span class="hljs-string">'./src/main.js'</span>
    },
    <span class="hljs-comment">// å¯¹é½process.env</span>
    <span class="hljs-attr">define</span>: {
      ...(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(process.<span class="hljs-property">env</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> [
            <span class="hljs-string">`process.env.<span class="hljs-subst">${key}</span>`</span>,
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)
          ])
        )
      })()
    }
  },
  <span class="hljs-comment">// @ç¬¦å·</span>
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
      <span class="hljs-comment">// å…¼å®¹vue cdnæ³¨å…¥å’Œ</span>
      <span class="hljs-attr">vue$</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'vue/dist/vue.runtime.esm.js'</span>)
      <span class="hljs-comment">// vuex$: require.resolve('vuex')</span>
    }
  },
  <span class="hljs-attr">html</span>: {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'./public/index.html'</span>,
    <span class="hljs-comment">// æ³¨å…¥ç¯å¢ƒå˜é‡</span>
    <span class="hljs-attr">templateParameters</span>: <span class="hljs-function">(<span class="hljs-params">compilation, assets, assetTags</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-comment">// å…¼å®¹ Vue CLI çš„ htmlWebpackPlugin è¯­æ³• ä¹‹å‰webpack çš„htmlç›´æ¥å†™è¿™é‡Œå°±ä¸éœ€è¦ä¿®æ”¹htmläº†</span>
        <span class="hljs-attr">htmlWebpackPlugin</span>: {
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">title</span>: <span class="hljs-string">'test'</span>,
            <span class="hljs-attr">assetPrefix</span>: assets.<span class="hljs-property">publicPath</span>
          }
        },
        <span class="hljs-attr">autoprefixer</span>: {
          <span class="hljs-attr">browsers</span>: [<span class="hljs-string">'&gt; 1%'</span>, <span class="hljs-string">'last 2 versions'</span>, <span class="hljs-string">'not dead'</span>]
        }
      }
    }
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">cssModules</span>: {
      <span class="hljs-attr">auto</span>: <span class="hljs-regexp">/\.module\.(css|less|scss|sass)$/</span>,
      <span class="hljs-attr">localIdentName</span>: <span class="hljs-string">'[local]--[hash:base64:5]'</span>
    }
  },
  <span class="hljs-comment">// Vue 2 é¡¹ç›®éœ€è¦å…³é—­ experiments.css</span>
  <span class="hljs-attr">experiments</span>: {
    <span class="hljs-attr">css</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-comment">// å…³é—­æ€§èƒ½æç¤º ä¸€äº›æ—¥å¿—å¯ä»¥ç‚¹å¼€æŸ¥çœ‹</span>
  <span class="hljs-attr">performance</span>: {
    <span class="hljs-attr">hints</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-attr">server</span>: {
    <span class="hljs-comment">// https: true å¦‚æœéœ€è¦https</span>
  },
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-title function_">rspack</span>(<span class="hljs-params">config, { addRules }</span>) {
      <span class="hljs-comment">// externals å…¼å®¹cdnæ³¨å…¥</span>
      <span class="hljs-comment">// config.externals = {</span>
      <span class="hljs-comment">//   vue: 'Vue',</span>
      <span class="hljs-comment">//   vuex: 'Vuex',</span>
      <span class="hljs-comment">//   'vue-router': 'VueRouter',</span>
      <span class="hljs-comment">//   'vue-i18n': 'VueI18n',</span>
      <span class="hljs-comment">//   'element-ui': 'ELEMENT',</span>
      <span class="hljs-comment">//   axios: 'axios'</span>
      <span class="hljs-comment">// }</span>

      config.<span class="hljs-property">module</span>.<span class="hljs-property">rules</span> = (config.<span class="hljs-property">module</span>.<span class="hljs-property">rules</span> || []).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">rule</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> !(rule.<span class="hljs-property">test</span> &amp;&amp; rule.<span class="hljs-property">test</span>.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'less'</span>))
      })

      <span class="hljs-comment">// å…¨å±€csså˜é‡æ³¨å…¥</span>
      <span class="hljs-keyword">const</span> lessVars = {
        <span class="hljs-attr">colorPrimary</span>: <span class="hljs-string">'#0066ff'</span>,
        <span class="hljs-attr">colorPrimaryLight8</span>: <span class="hljs-string">'#d4e7ff'</span>,
        <span class="hljs-attr">colorSuccess</span>: <span class="hljs-string">'#3ec07d'</span>,
        <span class="hljs-attr">colorWarning</span>: <span class="hljs-string">'#f97c56'</span>,
        <span class="hljs-attr">colorDanger</span>: <span class="hljs-string">'#f56c6c'</span>,
        <span class="hljs-attr">colorBg</span>: <span class="hljs-string">'white'</span>,
        <span class="hljs-attr">colorBorder</span>: <span class="hljs-string">'#999'</span>,
        <span class="hljs-attr">colorText</span>: <span class="hljs-string">'#777b7e'</span>,
        <span class="hljs-attr">colorTitle</span>: <span class="hljs-string">'#1d2328'</span>,
        <span class="hljs-attr">colorDark</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.75)'</span>,
        <span class="hljs-attr">headerHeight</span>: <span class="hljs-string">'64px'</span>,
        <span class="hljs-attr">minWidth</span>: <span class="hljs-string">'1200px'</span>,
        <span class="hljs-attr">sideBarWidth</span>: <span class="hljs-string">'210px'</span>,
        <span class="hljs-attr">font</span>: <span class="hljs-string">'14px'</span>,
        <span class="hljs-attr">fontSmall</span>: <span class="hljs-string">'12px'</span>,
        <span class="hljs-attr">bg</span>: <span class="hljs-string">'white'</span>
      }
      <span class="hljs-comment">// svg + rules å’Œlesså¤„ç†</span>
      <span class="hljs-title function_">addRules</span>([
        {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.less$/</span>,
          <span class="hljs-attr">oneOf</span>: [
            {
              <span class="hljs-comment">// å¤„ç† &lt;style module lang="less"&gt;</span>
              <span class="hljs-attr">resourceQuery</span>: <span class="hljs-regexp">/module/</span>,
              <span class="hljs-attr">use</span>: [
                <span class="hljs-string">'vue-style-loader'</span>,
                {
                  <span class="hljs-attr">loader</span>: <span class="hljs-string">'css-loader'</span>,
                  <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">modules</span>: {
                      <span class="hljs-attr">localIdentName</span>: <span class="hljs-string">'[local]--[hash:base64:5]'</span>
                    }
                  }
                },
                <span class="hljs-string">'postcss-loader'</span>,
                {
                  <span class="hljs-attr">loader</span>: <span class="hljs-string">'less-loader'</span>,
                  <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">lessOptions</span>: {
                      <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>,
                      <span class="hljs-attr">globalVars</span>: lessVars
                    }
                    <span class="hljs-comment">// additionalData: sharedLessImports</span>
                  }
                }
              ]
            },
            {
              <span class="hljs-comment">// æ™®é€š less</span>
              <span class="hljs-attr">use</span>: [
                <span class="hljs-string">'vue-style-loader'</span>,
                <span class="hljs-string">'css-loader'</span>,
                <span class="hljs-comment">// éœ€è¦æœ‰postcss.config.js</span>
                <span class="hljs-string">'postcss-loader'</span>,
                {
                  <span class="hljs-attr">loader</span>: <span class="hljs-string">'less-loader'</span>,
                  <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">lessOptions</span>: {
                      <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>,
                      <span class="hljs-attr">globalVars</span>: lessVars
                    }
                    <span class="hljs-comment">// æ³¨å…¥æ‰€æœ‰style é¡¶éƒ¨çš„ cssä»£ç ä¾‹å¦‚ @import "${resolve('src/style/theme.less')}";</span>
                    <span class="hljs-comment">// additionalData: sharedLessImports</span>
                  }
                }
              ]
            }
          ]
        },
        {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.svg$/</span>,
          <span class="hljs-attr">include</span>: [<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'src/asset/icons/svg'</span>)],
          <span class="hljs-attr">use</span>: [
            {
              <span class="hljs-attr">loader</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'svg-sprite-loader'</span>),
              <span class="hljs-attr">options</span>: {
                <span class="hljs-attr">symbolId</span>: <span class="hljs-string">'icon-[name]'</span>
              }
            }
          ]
        }
      ])
    }
  }
})
</code></pre>
<p>å‡çº§é‡åˆ°çš„å‘è¯¦è§£</p>
<ol>
<li>
 moduleä¸é€šè¿‡é—®é¢˜


</li></ol>

<pre><code class="hljs language-javascript" lang="javascript">    å»é™¤å®˜æ–¹çš„<span class="hljs-keyword">import</span> { pluginLess } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-less'</span>
     <span class="hljs-comment">//pluginLess()</span>
    æ”¹æˆ<span class="hljs-string">'vue-style-loader'</span>,<span class="hljs-string">'vue-style-loader'</span>, <span class="hljs-string">'css-loader'</span>, <span class="hljs-string">'postcss-loader'</span>,
    è¿™å‡ ä¸ªéƒ½é›†åˆ
    è¿™ä¸ªä¹Ÿéœ€è¦ å…³é—­
     <span class="hljs-comment">// Vue 2 é¡¹ç›®éœ€è¦å…³é—­ experiments.css</span>
  <span class="hljs-attr">experiments</span>: {
    <span class="hljs-attr">css</span>: <span class="hljs-literal">false</span>
  },
</code></pre>
<p>2.  jsx ç¼–è¯‘é—®é¢˜ å®‰è£…
import { pluginVue2Jsx } from '@rsbuild/plugin-vue2-jsx'</p>
<p>3.ä¸æƒ³æ”¹åŸæ¥çš„webpacké¡µé¢å°±è¿™æ ·å­ä¿®æ”¹</p>
<pre><code class="hljs language-css" lang="css">    // å…¼å®¹ Vue CLI çš„ htmlWebpackPlugin è¯­æ³•
        htmlWebpackPlugin: {
          options: {
            title: <span class="hljs-string">'Kuaiziâ„¢ - å†…å®¹å•†ä¸šä¸€ç«™å¼AIåº”ç”¨å¹³å°'</span>,
            cdn,
            kzCDN: process.env.VUE_APP_CDN_URL,
            npsId: process.env.VUE_APP_NPS_ID || <span class="hljs-string">''</span>,
            personalNpsId: process.env.VUE_APP_PERSONAL_NPS_ID || <span class="hljs-string">''</span>,
            kzENVScript,
            assetPrefix: process.env.VUE_APP_CDN_URL
              ? `${process<span class="hljs-selector-class">.env</span><span class="hljs-selector-class">.VUE_APP_CDN_URL</span>}/plus`
              : <span class="hljs-string">'/'</span>,
            content: <span class="hljs-string">''</span>
          }
        }
</code></pre>
<p>4.å¤„ç†é¡¹ç›®é‡Œé¢å¤§é‡çš„process é—®é¢˜</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-attr">source</span>: {
    <span class="hljs-attr">entry</span>: {
      <span class="hljs-attr">index</span>: <span class="hljs-string">'./src/main.js'</span>
    },
    <span class="hljs-comment">// å¯¹é½process.env</span>
    <span class="hljs-attr">define</span>: {
      ...(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(process.<span class="hljs-property">env</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> [
            <span class="hljs-string">`process.env.<span class="hljs-subst">${key}</span>`</span>,
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)
          ])
        )
      })()
    }
  },
</code></pre>
<h2 data-id="heading-0">å¦‚æœå¤§å®¶é‡åˆ°é—®é¢˜å¯ä»¥ä¸‹é¢ç•™è¨€é—®æˆ‘</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3ä¸­åŠ¨æ€æ ·å¼æ•°ç»„çš„åé¡¹è¦†ç›–è§„åˆ™å¦‚ä½•ä¸è®¡ç®—å±æ€§ç»“åˆå®ç°å¤æ‚çŠ¶æ€æ ·å¼ç®¡ç†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7584370833705189391</link>    <guid>https://juejin.cn/post/7584370833705189391</guid>    <pubDate>2025-12-17T07:26:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584370833705189391" data-draft-id="7584370833705173007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue3ä¸­åŠ¨æ€æ ·å¼æ•°ç»„çš„åé¡¹è¦†ç›–è§„åˆ™å¦‚ä½•ä¸è®¡ç®—å±æ€§ç»“åˆå®ç°å¤æ‚çŠ¶æ€æ ·å¼ç®¡ç†ï¼Ÿ    "/> <meta itemprop="keywords" content="å‰ç«¯,Trae,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-17T07:26:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue3ä¸­åŠ¨æ€æ ·å¼æ•°ç»„çš„åé¡¹è¦†ç›–è§„åˆ™å¦‚ä½•ä¸è®¡ç®—å±æ€§ç»“åˆå®ç°å¤æ‚çŠ¶æ€æ ·å¼ç®¡ç†ï¼Ÿ    
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:26:35.000Z" title="Wed Dec 17 2025 07:26:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€Styleç»‘å®šçš„æ•°ç»„è¯­æ³•ï¼šç»„åˆå¤šä¸ªæ ·å¼å¯¹è±¡</h2>
<p>åœ¨Vue3ä¸­ï¼Œ<code>v-bind:style</code>ï¼ˆç®€å†™ä¸º<code>:style</code>ï¼‰é™¤äº†æ”¯æŒ<strong>å¯¹è±¡è¯­æ³•</strong>ï¼Œè¿˜å¯ä»¥ç”¨<strong>æ•°ç»„è¯­æ³•</strong>ç»„åˆå¤šä¸ªæ ·å¼å¯¹è±¡ã€‚è¿™ç§æ–¹å¼ç‰¹åˆ«é€‚åˆéœ€è¦<strong>åˆå¹¶åŸºç¡€æ ·å¼ä¸åŠ¨æ€æ ·å¼</strong>çš„åœºæ™¯â€”â€”æ¯”å¦‚ä¸€ä¸ªæŒ‰é’®æ—¢è¦ä¿ç•™é»˜è®¤çš„ paddingã€border æ ·å¼ï¼Œåˆè¦æ ¹æ®â€œç¦ç”¨çŠ¶æ€â€åŠ¨æ€åˆ‡æ¢èƒŒæ™¯è‰²ã€‚</p>
<h3 data-id="heading-1">1.1 åŸºæœ¬ç”¨æ³•ï¼šæ•°ç»„é‡Œçš„æ ·å¼åˆå¹¶è§„åˆ™</h3>
<p>æ•°ç»„è¯­æ³•çš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š<strong>æ•°ç»„ä¸­çš„æ¯ä¸ªæ ·å¼å¯¹è±¡ä¼šè¢«åˆå¹¶ï¼Œåé¢çš„å¯¹è±¡ä¼šè¦†ç›–å‰é¢å¯¹è±¡çš„åŒåå±æ€§</strong>ï¼ˆç±»ä¼¼CSSçš„å±‚å è§„åˆ™ï¼‰ã€‚</p>
<p>ä¸¾ä¸ªç®€å•ä¾‹å­ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œåŸºç¡€æ–‡æœ¬æ ·å¼ + åŠ¨æ€èƒŒæ™¯è‰²â€çš„divï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- æ•°ç»„ç»„åˆbaseStylesï¼ˆåŸºç¡€ï¼‰å’ŒdynamicStylesï¼ˆåŠ¨æ€ï¼‰ --&gt;
  &lt;div :style="[baseStyles, dynamicStyles]"&gt;
    æˆ‘æ˜¯æ•°ç»„è¯­æ³•çš„ç¤ºä¾‹
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// åŸºç¡€æ ·å¼ï¼šå›ºå®šçš„å­—ä½“ã€é¢œè‰²
const baseStyles = ref({
  fontSize: '18px',  // é©¼å³°å‘½åï¼ˆVueæ¨èï¼‰
  color: '#333',
  padding: '10px'
})

// åŠ¨æ€æ ·å¼ï¼šç‚¹å‡»ååˆ‡æ¢èƒŒæ™¯è‰²
const dynamicStyles = ref({
  backgroundColor: 'lightblue'  // åˆå§‹ä¸ºæµ…è“è‰²
})

// æ¨¡æ‹ŸåŠ¨æ€ä¿®æ”¹ï¼šç‚¹å‡»divåˆ‡æ¢èƒŒæ™¯è‰²
const toggleBg = () =&gt; {
  dynamicStyles.value.backgroundColor = 
    dynamicStyles.value.backgroundColor === 'lightblue' 
      ? 'lightcoral' 
      : 'lightblue'
}
&lt;/script&gt;
</code></pre>
<p><strong>æ•ˆæœè¯´æ˜</strong>ï¼š</p>
<ul>
<li>åˆå§‹æ—¶ï¼Œdivçš„æ ·å¼æ˜¯<code>baseStyles</code>ï¼ˆå­—ä½“18pxã€æ·±ç°ï¼‰ + <code>dynamicStyles</code>ï¼ˆæµ…è“èƒŒæ™¯ï¼‰çš„åˆå¹¶ç»“æœã€‚</li>
<li>ç‚¹å‡»divåï¼Œ<code>dynamicStyles</code>çš„<code>backgroundColor</code>å˜ä¸ºæµ…çº¢ï¼Œdivçš„èƒŒæ™¯è‰²ä¼š<strong>è‡ªåŠ¨æ›´æ–°</strong>ï¼ˆå› ä¸º<code>dynamicStyles</code>æ˜¯å“åº”å¼refï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 å…³é”®è§„åˆ™ï¼šåé¡¹è¦†ç›–å‰é¡¹</h3>
<p>å¦‚æœæ•°ç»„ä¸­çš„å¤šä¸ªå¯¹è±¡æœ‰<strong>åŒåå±æ€§</strong>ï¼Œåé¢çš„å¯¹è±¡ä¼šè¦†ç›–å‰é¢çš„ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> base = { <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'16px'</span> }
<span class="hljs-keyword">const</span> dynamic = { <span class="hljs-attr">color</span>: <span class="hljs-string">'blue'</span> }
<span class="hljs-keyword">const</span> styles = [base, dynamic]  <span class="hljs-comment">// æœ€ç»ˆcoloræ˜¯blueï¼ŒfontSizeæ˜¯16px</span>
</code></pre>
<p>è¿™æ„å‘³ç€ä½ å¯ä»¥æŠŠ<strong>å›ºå®šæ ·å¼æ”¾åœ¨å‰é¢</strong>ï¼Œ<strong>åŠ¨æ€æ ·å¼æ”¾åœ¨åé¢</strong>â€”â€”åŠ¨æ€æ ·å¼ä¼šâ€œè¦†ç›–â€åŸºç¡€æ ·å¼çš„åŒåå±æ€§ï¼Œå®ç°çµæ´»çš„æ ·å¼è°ƒæ•´ã€‚</p>
<h2 data-id="heading-3">äºŒã€è®¡ç®—å±æ€§ï¼šè®©å¤æ‚æ ·å¼ç»„åˆæ›´ä¼˜é›…</h2>
<p>å½“æ ·å¼éœ€è¦ä¾èµ–<strong>å¤šä¸ªçŠ¶æ€</strong>æ—¶ï¼ˆæ¯”å¦‚â€œç¦ç”¨+ hoverâ€çš„æŒ‰é’®ï¼‰ï¼Œç›´æ¥åœ¨æ¨¡æ¿é‡Œå†™æ•°ç»„ä¼šè®©ä»£ç å˜å¾—å†—é•¿ã€‚è¿™æ—¶å€™**è®¡ç®—å±æ€§ï¼ˆcomputedï¼‰**æ˜¯æ›´å¥½çš„é€‰æ‹©â€”â€”å®ƒèƒ½æŠŠå¤æ‚çš„æ ·å¼é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œè®©æ¨¡æ¿æ›´ç®€æ´ã€‚</p>
<h3 data-id="heading-4">2.1 ä¸ºä»€ä¹ˆç”¨è®¡ç®—å±æ€§ï¼Ÿ</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œéœ€è¦æ ¹æ®ä¸‰ä¸ªçŠ¶æ€åˆ‡æ¢æ ·å¼ï¼š</p>
<ul>
<li>åŸºç¡€æ ·å¼ï¼ˆå›ºå®šï¼‰ï¼›</li>
<li>ç¦ç”¨çŠ¶æ€ï¼ˆç°è‰²èƒŒæ™¯ã€ä¸å¯ç‚¹å‡»ï¼‰ï¼›</li>
<li>HoverçŠ¶æ€ï¼ˆç»¿è‰²èƒŒæ™¯ã€ç™½è‰²æ–‡å­—ï¼‰ã€‚</li>
</ul>
<p>å¦‚æœä¸ç”¨è®¡ç®—å±æ€§ï¼Œæ¨¡æ¿ä¼šå†™æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- æ¨¡æ¿é‡Œçš„æ ·å¼æ•°ç»„ä¼šéå¸¸é•¿ï¼Œéš¾ä»¥ç»´æŠ¤ --&gt;
&lt;button :style="[
  { padding: '8px 16px', border: 'none' },
  isDisabled ? { backgroundColor: '#ccc' } : {},
  isHovered &amp;&amp; !isDisabled ? { backgroundColor: '#42b983' } : {}
]"&gt;
  ç‚¹å‡»æˆ‘
&lt;/button&gt;
</code></pre>
<p>è€Œç”¨è®¡ç®—å±æ€§ï¼Œå¯ä»¥æŠŠæ ·å¼é€»è¾‘ç§»åˆ°<code>&lt;script&gt;</code>é‡Œï¼Œæ¨¡æ¿åªéœ€è¦ç»‘å®šä¸€ä¸ª<code>buttonStyles</code>ï¼š</p>
<h3 data-id="heading-5">2.2 ç¤ºä¾‹ï¼šå¸¦çŠ¶æ€çš„æŒ‰é’®æ ·å¼</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;button 
    :style="buttonStyles" 
    @click="toggleDisabled"
    @mouseenter="isHovered = true"
    @mouseleave="isHovered = false"
  &gt;
    {{ isDisabled ? 'ç¦ç”¨' : 'ç‚¹å‡»' }}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue'

// 1. å®šä¹‰å“åº”å¼çŠ¶æ€
const isDisabled = ref(false)  // æ˜¯å¦ç¦ç”¨
const isHovered = ref(false)   // æ˜¯å¦hover

// 2. è®¡ç®—å±æ€§ï¼šæ ¹æ®çŠ¶æ€ç”Ÿæˆæ ·å¼æ•°ç»„
const buttonStyles = computed(() =&gt; [
  // â‘  åŸºç¡€æ ·å¼ï¼ˆå›ºå®šï¼‰
  {
    padding: '8px 16px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    transition: 'background-color 0.2s'  // è¿‡æ¸¡åŠ¨ç”»
  },
  // â‘¡ ç¦ç”¨çŠ¶æ€æ ·å¼ï¼ˆä»…å½“isDisabledä¸ºtrueæ—¶ç”Ÿæ•ˆï¼‰
  isDisabled.value ? {
    backgroundColor: '#ccc',
    color: '#999',
    cursor: 'not-allowed'  // ç¦ç”¨æ—¶çš„é¼ æ ‡æ ·å¼
  } : {},
  // â‘¢ HoverçŠ¶æ€æ ·å¼ï¼ˆä»…å½“hoverä¸”æœªç¦ç”¨æ—¶ç”Ÿæ•ˆï¼‰
  isHovered.value &amp;&amp; !isDisabled.value ? {
    backgroundColor: '#42b983',
    color: 'white'
  } : {}
])

// 3. æ¨¡æ‹Ÿç¦ç”¨çŠ¶æ€åˆ‡æ¢
const toggleDisabled = () =&gt; {
  isDisabled.value = !isDisabled.value
}
&lt;/script&gt;
</code></pre>
<p><strong>ä»£ç è§£é‡Š</strong>ï¼š</p>
<ul>
<li><code>buttonStyles</code>æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œä¾èµ–<code>isDisabled</code>å’Œ<code>isHovered</code>çš„å˜åŒ–ï¼›</li>
<li>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯<strong>æ¡ä»¶æ ·å¼å¯¹è±¡</strong>ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œè¿”å›å¯¹åº”çš„æ ·å¼ï¼›å¦åˆ™è¿”å›ç©ºå¯¹è±¡<code>{}</code>ï¼ˆä¸å½±å“å…¶ä»–æ ·å¼ï¼‰ï¼›</li>
<li>è®¡ç®—å±æ€§ä¼šè‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–â€”â€”æ¯”å¦‚<code>isDisabled</code>ä»<code>false</code>å˜<code>true</code>æ—¶ï¼Œ<code>buttonStyles</code>ä¼šé‡æ–°è®¡ç®—ï¼ŒæŒ‰é’®æ ·å¼éšä¹‹æ›´æ–°ã€‚</li>
</ul>
<h2 data-id="heading-6">ä¸‰ã€åŠ¨æ€å†…è”æ ·å¼ï¼šä¸æ•°æ®è”åŠ¨çš„åˆ‡æ¢æŠ€å·§</h2>
<p>æ•°ç»„è¯­æ³•çš„å¦ä¸€ä¸ªå¸¸ç”¨åœºæ™¯æ˜¯<strong>åŠ¨æ€ä¿®æ”¹å•ä¸ªæ ·å¼å±æ€§</strong>ï¼ˆæ¯”å¦‚è¿›åº¦æ¡çš„å®½åº¦ã€æ–‡æœ¬æ¡†çš„èƒŒæ™¯è‰²ï¼‰ã€‚è¿™ç±»åœºæ™¯é€šå¸¸éœ€è¦å°†æ ·å¼å±æ€§ä¸<strong>å“åº”å¼æ•°æ®</strong>ç»‘å®šï¼Œå®ç°â€œæ•°æ®å˜â†’æ ·å¼å˜â€çš„æ•ˆæœã€‚</p>
<h3 data-id="heading-7">3.1 ç¤ºä¾‹1ï¼šåŠ¨æ€è¿›åº¦æ¡</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œç‚¹å‡»å¢åŠ è¿›åº¦â€çš„è¿›åº¦æ¡ï¼Œæ ¸å¿ƒæ˜¯<strong>åŠ¨æ€ä¿®æ”¹<code>width</code>å±æ€§</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="progress-container"&gt;
    &lt;!-- åŠ¨æ€ç»‘å®šwidthï¼šè¿›åº¦å€¼ï¼ˆ0-100ï¼‰+ % --&gt;
    &lt;div class="progress-bar" :style="{ width: progress + '%' }"&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;button @click="increaseProgress"&gt;å¢åŠ è¿›åº¦&lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

const progress = ref(0)  // è¿›åº¦å€¼ï¼ˆå“åº”å¼ï¼‰

// ç‚¹å‡»æŒ‰é’®å¢åŠ è¿›åº¦ï¼ˆæœ€å¤š100%ï¼‰
const increaseProgress = () =&gt; {
  if (progress.value &lt; 100) {
    progress.value += 10
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.progress-container {
  width: 300px;
  height: 20px;
  border: 1px solid #eee;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 10px;
}
.progress-bar {
  height: 100%;
  background-color: #42b983;
  transition: width 0.3s ease;  // å¹³æ»‘è¿‡æ¸¡
}
&lt;/style&gt;
</code></pre>
<p><strong>æ•ˆæœè¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>progress</code>æ˜¯å“åº”å¼æ•°æ®ï¼Œåˆå§‹ä¸º0ï¼›</li>
<li>ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œ<code>progress</code>å¢åŠ 10ï¼Œ<code>width</code>å±æ€§ä¼šè‡ªåŠ¨æ›´æ–°ä¸º<code>progress + '%'</code>ï¼ˆæ¯”å¦‚10% â†’ 20%ï¼‰ï¼›</li>
<li>é€šè¿‡<code>transition</code>å®ç°è¿›åº¦æ¡çš„å¹³æ»‘åŠ¨ç”»ã€‚</li>
</ul>
<h3 data-id="heading-8">3.2 ç¤ºä¾‹2ï¼šæ ¹æ®è¾“å…¥é•¿åº¦åŠ¨æ€æ”¹èƒŒæ™¯è‰²</h3>
<p>æˆ‘ä»¬å¯ä»¥æ‰©å±•æ•°ç»„è¯­æ³•ï¼Œç»“åˆ<strong>è®¡ç®—å±æ€§</strong>å®ç°æ›´å¤æ‚çš„è”åŠ¨ï¼šæ¯”å¦‚æ–‡æœ¬æ¡†æ ¹æ®è¾“å…¥é•¿åº¦åˆ‡æ¢èƒŒæ™¯è‰²ï¼ˆçŸ­â†’ç™½ã€ä¸­â†’é»„ã€é•¿â†’çº¢ï¼‰ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;input 
    type="text" 
    v-model="inputText" 
    :style="inputStyles"
    placeholder="è¾“å…¥å†…å®¹..."
  &gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue'

const inputText = ref('')  // ç»‘å®šè¾“å…¥æ¡†å†…å®¹

// è®¡ç®—å±æ€§ï¼šæ ¹æ®è¾“å…¥é•¿åº¦ç”Ÿæˆæ ·å¼æ•°ç»„
const inputStyles = computed(() =&gt; [
  // åŸºç¡€æ ·å¼ï¼ˆå›ºå®šï¼‰
  {
    padding: '8px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    width: '300px'
  },
  // åŠ¨æ€èƒŒæ™¯è‰²ï¼šæ ¹æ®è¾“å…¥é•¿åº¦åˆ‡æ¢
  {
    backgroundColor: 
      inputText.value.length &lt; 10 ? 'white' :  // çŸ­ï¼šç™½
      inputText.value.length &lt;= 20 ? 'lightyellow' :  // ä¸­ï¼šé»„
      'lightcoral'  // é•¿ï¼šçº¢
  }
])
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-9">å››ã€è¯¾åQuizï¼šå·©å›ºä½ çš„æ ·å¼ç»‘å®šæŠ€èƒ½</h2>
<p><strong>é—®é¢˜</strong>ï¼šè¯·ç”¨<strong>æ•°ç»„è¯­æ³• + è®¡ç®—å±æ€§</strong>å®ç°ä¸€ä¸ªâ€œåŠ¨æ€æ ‡ç­¾â€ç»„ä»¶â€”â€”æ ‡ç­¾çš„èƒŒæ™¯è‰²æ ¹æ®<code>type</code>å±æ€§åˆ‡æ¢ï¼ˆ<code>type="success"</code>ä¸ºç»¿è‰²ï¼Œ<code>type="warning"</code>ä¸ºé»„è‰²ï¼Œ<code>type="error"</code>ä¸ºçº¢è‰²ï¼‰ï¼ŒåŒæ—¶ä¿æŒåŸºç¡€æ ·å¼ï¼ˆåœ†è§’ã€paddingï¼‰ã€‚</p>
<p><strong>è¦æ±‚</strong>ï¼š</p>
<ol>
<li>åŸºç¡€æ ·å¼åŒ…å«ï¼š<code>padding: '4px 8px'</code>ã€<code>border-radius: '4px'</code>ã€<code>color: 'white'</code>ï¼›</li>
<li>åŠ¨æ€æ ·å¼æ ¹æ®<code>type</code>åˆ‡æ¢<code>backgroundColor</code>ï¼›</li>
<li>ç”¨è®¡ç®—å±æ€§è¿”å›æ ·å¼æ•°ç»„ã€‚</li>
</ol>
<h3 data-id="heading-10">ç­”æ¡ˆä¸è§£æ</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;span :style="tagStyles"&gt;{{ text }}&lt;/span&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed, defineProps } from 'vue'

// æ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„typeå’Œtext
const props = defineProps({
  type: {
    type: String,
    default: 'success'  // é»˜è®¤æˆåŠŸæ€
  },
  text: String
})

// è®¡ç®—å±æ€§ï¼šç”Ÿæˆæ ·å¼æ•°ç»„
const tagStyles = computed(() =&gt; [
  // â‘  åŸºç¡€æ ·å¼
  {
    padding: '4px 8px',
    borderRadius: '4px',
    color: 'white',
    fontSize: '12px'
  },
  // â‘¡ åŠ¨æ€èƒŒæ™¯è‰²ï¼ˆæ ¹æ®typeï¼‰
  {
    backgroundColor: {
      success: '#42b983',
      warning: '#f1c40f',
      error: '#e74c3c'
    }[props.type]  // æ ¹æ®typeå–å¯¹åº”é¢œè‰²
  }
])
&lt;/script&gt;
</code></pre>
<p><strong>è§£æ</strong>ï¼š</p>
<ol>
<li>ç”¨<code>defineProps</code>æ¥æ”¶çˆ¶ç»„ä»¶çš„<code>type</code>å’Œ<code>text</code>ï¼›</li>
<li>è®¡ç®—å±æ€§<code>tagStyles</code>è¿”å›æ•°ç»„ï¼šåŸºç¡€æ ·å¼ + åŠ¨æ€èƒŒæ™¯è‰²ï¼›</li>
<li>åŠ¨æ€èƒŒæ™¯è‰²ç”¨<strong>å¯¹è±¡æ˜ å°„</strong>ï¼ˆ<code>{ success: '#42b983', ... }[props.type]</code>ï¼‰ï¼Œæ¯”<code>if-else</code>æ›´ç®€æ´ã€‚</li>
</ol>
<details>
<summary>å¾€æœŸæ–‡ç« å½’æ¡£</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vueæµ…å“åº”å¼å¦‚ä½•è§£å†³æ·±å±‚å“åº”å¼çš„æ€§èƒ½é—®é¢˜ï¼Ÿé€‚ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3ç»„åˆå¼APIä¸­refä¸reactiveçš„æ ¸å¿ƒå“åº”å¼å·®å¼‚åŠä½¿ç”¨æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3ç»„åˆå¼APIä¸­refä¸reactiveçš„æ ¸å¿ƒå“åº”å¼å·®å¼‚åŠä½¿ç”¨æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3å“åº”å¼ç³»ç»Ÿä¸­ï¼Œå¯¹è±¡æ–°å¢å±æ€§ã€æ•°ç»„æ”¹ç´¢å¼•ã€åŸå§‹å€¼ä»£ç†çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3ä¸­watchä¾¦å¬å™¨çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ä½ æŒæ¡äº†å—ï¼Ÿæ·±åº¦ç›‘å¬ã€ä¸watchEffectçš„å·®å¼‚åŠå¸¸è§æŠ¥é”™è§£æ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vueå“åº”å¼å£°æ˜çš„APIå·®å¼‚ã€åº•å±‚åŸç†ä¸å¸¸è§é™·é˜±ä½ éƒ½ææ‡‚äº†å— - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vueå“åº”å¼å£°æ˜çš„APIå·®å¼‚ã€åº•å±‚åŸç†ä¸å¸¸è§é™·é˜±ä½ éƒ½ææ‡‚äº†å— - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">ä¸ºä»€ä¹ˆVue 3éœ€è¦refå‡½æ•°ï¼Ÿå®ƒçš„å“åº”å¼åŸç†ä¸æ­£ç¡®ç”¨æ³•æ˜¯ä»€ä¹ˆï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3ä¸­reactiveå‡½æ•°å¦‚ä½•é€šè¿‡Proxyå®ç°å“åº”å¼ï¼Ÿä½¿ç”¨æ—¶è¦é¿å¼€å“ªäº›è¯¯åŒºï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3å“åº”å¼ç³»ç»Ÿçš„åº•å±‚åŸç†ä¸å®è·µè¦ç‚¹ä½ çœŸçš„æ‡‚å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3æ¨¡æ¿å¦‚ä½•é€šè¿‡ç¼–è¯‘ä¸‰é˜¶æ®µå®ç°ä»å£°æ˜å¼è¯­æ³•åˆ°é«˜æ•ˆæ¸²æŸ“çš„è·¨è¶Š - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vueæ¨¡æ¿å¼•ç”¨ï¼šä»æ”¶DOMâ€œå¿«é€’â€åˆ°è°ƒå­ç»„ä»¶æ–¹æ³•ï¼Œä½ ç©æ˜ç™½äº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vueæ¨¡æ¿é‡Œçš„JSè¡¨è¾¾å¼æœ‰å•¥ä¸èƒ½ç¢°ï¼Ÿè®¡ç®—å±æ€§ä¸ºå•¥æ¯”æ–¹æ³•æ›´èƒ½æ‰“ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vueçš„v-modelè¡¨å•ç»‘å®šï¼šè¯­æ³•ç³–ã€åŠ¨æ€å€¼ã€ä¿®é¥°ç¬¦çš„å°æŠ€å·§ä½ éƒ½æŒæ¡äº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vue3äº‹ä»¶å¤„ç†çš„æŒ‘æˆ˜é¢˜ï¼šv-onã€ä¿®é¥°ç¬¦ã€è‡ªå®šä¹‰äº‹ä»¶ä½ èƒ½é€šå…³å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vue3çš„v-æŒ‡ä»¤ï¼šæ•°æ®å’ŒDOMçš„â€œç¿»è¯‘å®˜â€åˆ°åº•æœ‰å¤šå°‘æœ¬äº‹ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vue3ï¼Œæ’å€¼ã€åŠ¨æ€ç»‘å®šå’Œé¿å‘æŠ€å·§ä½ éƒ½ææ‡‚äº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">æƒ³è®©PostgreSQLå¿«åˆ°é£èµ·ï¼Ÿå…ˆæ‰¾å¥åº·å¯†ç è¿˜æ˜¯å…ˆæ¢å¼•æ“ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">æƒ³è®©PostgreSQLæŸ¥è¯¢å¿«åˆ°é£èµ·ï¼Ÿåˆ†åŒºè¡¨ã€ç‰©åŒ–è§†å›¾ã€å¹¶è¡ŒæŸ¥è¯¢è¿™ä¸‰æ‹›çµä¸çµï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">å­æŸ¥è¯¢æ€»æ‹–æ…¢æŸ¥è¯¢ï¼ŸæŠŠå®ƒå˜æˆè¿æ¥å°±èƒ½è§£å†³ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQLå…¨è¡¨æ‰«ææ…¢åˆ°å´©æºƒï¼Ÿå»ºç´¢å¼•+æ”¹æŸ¥è¯¢+æ›´ç»Ÿè®¡ä¿¡æ¯ä¸‰æ‹›èƒ½ç ´ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">å¤æ‚æŸ¥è¯¢æ€»æ‹–åè…¿ï¼ŸPostgreSQLå¤šåˆ—ç´¢å¼•+è¦†ç›–ç´¢å¼•çš„ç¥ä»™æŠ€å·§ä½ getæ²¡ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">åªç»™è¡¨å­é›†å»ºç´¢å¼•ï¼Ÿç”¨å‡½æ•°ç»“æœå»ºç´¢å¼•ï¼ŸPostgreSQLè¿™ä¿©æ“ä½œå‡­å•¥èƒ½çœç©ºé—´åˆåŠ é€Ÿï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-treeç´¢å¼•åƒå­—å…¸æŸ¥è¯ä¸€æ ·å·¥ä½œï¼Ÿé‚£å“ªäº›æ•°æ®åº“æŸ¥è¯¢å®ƒèƒ½åŠ é€Ÿï¼Œå“ªäº›ä¸èƒ½ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">æƒ³æŠ“PostgreSQLé‡Œçš„æ…¢SQLï¼Ÿpg_stat_statementsåŸºç¡€é»‘åŒ£å­å’Œpg_stat_monitoræ—¶é—´çª—ï¼Œè°èƒ½å¸®ä½ æ›´å‡†æªå‡ºæ€§èƒ½å°å·ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQLçš„â€œæ—¶å…‰æœºâ€MVCCå’Œé”æœºåˆ¶æ˜¯æ€ä¹ˆæå®šé«˜å¹¶å‘çš„ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQLæ€§èƒ½æš´æ¶¨çš„å…³é”®ï¼Ÿå†…å­˜IOå¹¶å‘å‚æ•°å±…ç„¶è¦è¿™ä¹ˆè®¾ç½®ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">å¤§è¡¨æŸ¥è¯¢æ…¢åˆ°ç¿»éæ•´ä¸ªä¹¦æ¶ï¼ŸPostgreSQLåˆ†åŒºè¡¨æ•™ä½ æ€ä¹ˆâ€œåˆ†ç±»â€æ‰é«˜æ•ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL æŸ¥è¯¢æ…¢ï¼Ÿæ˜¯ä¸æ˜¯å¿˜äº†ä¼˜åŒ– GROUP BYã€ORDER BY å’Œçª—å£å‡½æ•°ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQLé‡Œçš„å­æŸ¥è¯¢å’ŒCTEå±…ç„¶åœ¨æ€§èƒ½ä¸Šâ€œææ¶â€ï¼Ÿåˆ°åº•è¯¥ç«™å“ªè¾¹ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQLé€‰Joinç­–ç•¥æœ‰å•¥å°ä¹ä¹ï¼ŸNested Loop/Merge/Hashè°æ˜¯å®ƒçš„èœï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQLæ–°æ‰‹SQLæ€»ç¿»è½¦ï¼Ÿè¿™7ä¸ªæ€§èƒ½é™·é˜±ä½ è¸©è¿‡æ²¡ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQLç´¢å¼•é€‰B-Treeè¿˜æ˜¯GiSTï¼Ÿâ€œç‘å£«å†›åˆ€â€å’Œâ€œå¤šé¢æ‰‹â€çš„å·®åˆ«ä½ å±…ç„¶è¿˜ä¸çŸ¥é“ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">æƒ³çŸ¥é“æ•°æ®åº“æ€ä¹ˆç»™æŸ¥è¯¢â€œç®—æˆæœ¬é€‰è·¯çº¿â€ï¼ŸEXPLAINèƒ½å¸®ä½ çœ‹æ˜ç™½ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQLå¤„ç†SQLå±…ç„¶åƒåšè›‹ç³•ï¼Ÿè§£æåˆ°æ‰§è¡Œçš„4æ­¥é‡Œè—ç€å¤šå°‘æŸ¥è¯¢ä¼˜åŒ–çš„å°å¿ƒæœºï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQLå¤‡ä»½ä¸æ˜¯å¤åˆ¶æ–‡ä»¶ï¼Ÿç‰©ç†vsé€»è¾‘å’‹é€‰ï¼Ÿè¯¯åˆ è¿˜èƒ½ç²¾å‡†æ¢å¤åˆ°1åˆ†é’Ÿå‰ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">è½¬è´¦ä¸ç¿»è½¦ã€å¹¶å‘ä¸å¹²æ‰°ï¼ŒPostgreSQLçš„ACIDç‰¹æ€§åˆ°åº•æœ‰å•¥é­”æ³•ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">é“¶è¡Œè½¬è´¦ä¸ç™½æ‰£é’±ã€ç”µå•†ä¸‹å•ä¸è¶…å–ï¼ŒPostgreSQLäº‹åŠ¡çš„è¯€çªæ˜¯å•¥ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQLé‡Œçš„PL/pgSQLåˆ°åº•æ˜¯å•¥ï¼Ÿèƒ½è®©SQLä»â€œè¯´ç›®æ ‡â€å˜â€œè®²æ­¥éª¤â€ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQLè§†å›¾ä¸å­˜æ•°æ®ï¼Ÿé‚£å®ƒæ€ä¹ˆç®€åŒ–æŸ¥è¯¢è¿˜èƒ½é€’å½’ç”Ÿæˆåºåˆ—å’Œæ§åˆ¶æƒé™ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQLç´¢å¼•è¿™ä¹ˆç©ï¼Œæ‰èƒ½è®©ä½ çš„æŸ¥è¯¢çœŸçš„â€œé£â€èµ·æ¥ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQLçš„è¡¨å…³ç³»å’Œçº¦æŸï¼Œå’‹å¸®ä½ æå®šç”¨æˆ·è®¢å•ä¸æ··ä¹±ã€å­¦ç”Ÿé€‰è¯¾ä¸é‡å¤ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQLæŸ¥è¯¢çš„ç­›å­ã€æ’åºã€èšåˆã€åˆ†ç»„ï¼Ÿä½ ä¼šç”¨å®ƒä»¬æå®šæ•°æ®å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQLæ•°æ®ç±»å‹æ€ä¹ˆé€‰æ‰é«˜æ•ˆä¸è¸©å‘ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">æƒ³è§£é”PostgreSQLæŸ¥è¯¢ä»åŸºç¡€åˆ°è¿›é˜¶çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Ÿä½ éƒ½getäº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETEå±…ç„¶æœ‰è¿™äº›æ“ä½œï¼Ÿè¿”å›æ•°æ®ã€è¿è¡¨åˆ ä½ è¯•è¿‡æ²¡ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATEè¯­å¥æ€ä¹ˆç©ï¼Ÿä»æ”¹é‚®ç®±åˆ°æ‰¹é‡æ›´æ–°çš„é¿å‘æŠ€å·§ä½ éƒ½ä¼šå—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQLæ’å…¥æ•°æ®è¿˜åœ¨é€æ¡æ•²ï¼Ÿæ‰¹é‡ã€å†²çªå¤„ç†ã€è¿”å›è‡ªå¢IDçš„æŠ€å·§ä½ ä¼šå—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQLçš„â€œä»“åº“-æˆ¿é—´-è´§æ¶â€æ¸¸æˆï¼Œä½ èƒ½å»ºå‡ºç”µå•†æ•°æ®åº“å’Œè¡¨å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17å®‰è£…æ€»ç¿»è½¦ï¼ŸWindows/macOS/Linuxé¿å‘æŒ‡å—å¸®ä½ æå®šï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">èƒ½å½“å…³ç³»å‹æ•°æ®åº“è¿˜èƒ½ç©å¯¹è±¡ç‰¹æ€§ï¼Œèƒ½æ‹†å¤æ‚æŸ¥è¯¢è¿˜èƒ½è‡ªåŠ¨ç®¡åº“å­˜ï¼ŒPostgreSQLå‡­ä»€ä¹ˆè¿™ä¹ˆé¦™ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">ç»™æ¥å£åŠ æ–°å­—æ®µåˆä¸æå´©è€å®¢æˆ·ç«¯ï¼ŸFastAPIçš„å¤šç‰ˆæœ¬APIé å“ªä¸‰æ‹›å®ç°ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">æµé‡çªå¢è¦æå´©FastAPIï¼Ÿç†”æ–­æµ‹è¯•æ˜¯æ€ä¹ˆé˜²ç³»ç»Ÿé›ªå´©çš„ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPIç§’æ€åº“å­˜æ€»å˜è´Ÿæ•°ï¼ŸRedisåˆ†å¸ƒå¼é”èƒ½å¸®ä½ å®ˆä½åº•çº¿å— - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPIçš„CIæµæ°´çº¿æ€ä¹ˆè‡ªåŠ¨æµ‹ç«¯ç‚¹ï¼Œè¿˜èƒ½è®©AllureæŠ¥å‘Šç¾åˆ°çŠ¯è§„ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">å¦‚ä½•ç”¨GitHub Actionsä¸ºFastAPIé¡¹ç›®æ‰“é€ è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">å¦‚ä½•ç”¨Git Hookå’ŒCIæµæ°´çº¿ä¸ºFastAPIé¡¹ç›®ä¿é©¾æŠ¤èˆªï¼Ÿ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>å…è´¹å¥½ç”¨çš„çƒ­é—¨åœ¨çº¿å·¥å…·</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID è®¡ç®—å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">åœ¨çº¿PS - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid åœ¨çº¿ç¼–è¾‘å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">æ•°å­¦æ±‚è§£è®¡ç®—å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">æ™ºèƒ½æè¯å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">é­”æ³•ç®€å† - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - å›¾ç‰‡æ‹¼å›¾å·¥å…· | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">å­—å¹•ä¸‹è½½å·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">æ­Œè¯ç”Ÿæˆå·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">ç½‘ç›˜èµ„æºèšåˆæœç´¢ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCIIå­—ç¬¦ç”»ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens å·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt å¯†ç å·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF åˆæˆå™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF åˆ†è§£å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">æ–‡æœ¬éšå†™æœ¯ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon åœ¨çº¿å·¥å…· - é«˜çº§AIå·¥å…·ç®±ä¸å¼€å‘è€…å¥—ä»¶ | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">åº”ç”¨å•†åº— - å‘ç°1000+æå‡æ•ˆç‡ä¸å¼€å‘çš„AIå·¥å…·å’Œå®ç”¨ç¨‹åº | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon æ›´æ–°æ—¥å¿— - æœ€æ–°æ›´æ–°ã€åŠŸèƒ½ä¸æ”¹è¿› | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">æ”¯æŒæˆ‘ä»¬ - æˆä¸ºèµåŠ©è€… | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AIæ–‡æœ¬ç”Ÿæˆå›¾åƒ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">ä¸´æ—¶é‚®ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">äºŒç»´ç è§£æå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">æ–‡æœ¬è½¬æ€ç»´å¯¼å›¾ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">æ­£åˆ™è¡¨è¾¾å¼å¯è§†åŒ–å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">æ–‡ä»¶éšå†™å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV é¢‘é“æ¢ç´¢å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">å¿«ä¼  - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">éšæœºæŠ½å¥–å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">åŠ¨æ¼«åœºæ™¯æŸ¥æ‰¾å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">æ—¶é—´å·¥å…·ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">ç½‘é€Ÿæµ‹è¯• - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI æ™ºèƒ½æŠ å›¾å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">èƒŒæ™¯æ›¿æ¢å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">è‰ºæœ¯äºŒç»´ç ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph å…ƒæ ‡ç­¾ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">å›¾åƒå¯¹æ¯”å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">å›¾ç‰‡å‹ç¼©ä¸“ä¸šç‰ˆ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">å¯†ç ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVGä¼˜åŒ–å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">è°ƒè‰²æ¿ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">åœ¨çº¿èŠ‚æ‹å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IPå½’å±åœ°æŸ¥è¯¢ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSSç½‘æ ¼å¸ƒå±€ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">é‚®ç®±éªŒè¯å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">ä¹¦æ³•ç»ƒä¹ å­—å¸– - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">é‡‘èè®¡ç®—å™¨å¥—ä»¶ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">ä¸­å›½äº²æˆšå…³ç³»è®¡ç®—å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer å·¥å…·ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IPå½’å±åœ°æŸ¥è¯¢ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">å›¾ç‰‡æ— æŸæ”¾å¤§ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">æ–‡æœ¬æ¯”è¾ƒå·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IPæ‰¹é‡æŸ¥è¯¢å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">åŸŸåæŸ¥è¯¢å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNSå·¥å…·ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">ç½‘ç«™å›¾æ ‡ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<h2 data-id="heading-11">äº”ã€å¸¸è§æŠ¥é”™ä¸è§£å†³æ–¹æ¡ˆ</h2>
<p>åœ¨Styleç»‘å®šä¸­ï¼Œä»¥ä¸‹é”™è¯¯æ˜¯æ–°æ‰‹å¸¸çŠ¯çš„ï¼Œæå‰é¿å‘ï¼</p>
<h3 data-id="heading-12">æŠ¥é”™1ï¼šæ ·å¼é”®åç”¨â€œçŸ­æ¨ªçº¿â€å¯¼è‡´ä¸ç”Ÿæ•ˆ</h3>
<p><strong>é”™è¯¯ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dynamicStyles = <span class="hljs-title function_">ref</span>({
  background-<span class="hljs-attr">color</span>: <span class="hljs-string">'lightblue'</span>  <span class="hljs-comment">// é”™è¯¯ï¼šçŸ­æ¨ªçº¿ä¸èƒ½ç›´æ¥ä½œä¸ºå¯¹è±¡é”®å</span>
})
</code></pre>
<p><strong>åŸå› </strong>ï¼šJavaScriptå¯¹è±¡çš„é”®åå¦‚æœåŒ…å«çŸ­æ¨ªçº¿ï¼ˆæ¯”å¦‚<code>background-color</code>ï¼‰ï¼Œå¿…é¡»ç”¨<strong>å­—ç¬¦ä¸²å¼•å·</strong>åŒ…è£¹ï¼Œå¦åˆ™ä¼šè¢«è§£æä¸ºâ€œå‡æ³•è¡¨è¾¾å¼â€ï¼ˆ<code>background - color</code>ï¼‰ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>ç”¨<strong>é©¼å³°å‘½å</strong>ï¼ˆVueæ¨èï¼‰ï¼š<code>backgroundColor</code>ï¼›</li>
<li>ç”¨<strong>å­—ç¬¦ä¸²é”®å</strong>ï¼š<code>'background-color'</code>ã€‚</li>
</ul>
<p><strong>æ­£ç¡®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dynamicStyles = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'lightblue'</span>  <span class="hljs-comment">// æ¨è</span>
  <span class="hljs-comment">// æˆ–</span>
  <span class="hljs-comment">// 'background-color': 'lightblue'</span>
})
</code></pre>
<h3 data-id="heading-13">æŠ¥é”™2ï¼šæ•°ç»„ä¸­çš„æ ·å¼å¯¹è±¡ä¸º<code>undefined</code></h3>
<p><strong>é”™è¯¯ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> buttonStyles = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> [
  baseStyles,
  isDisabled.<span class="hljs-property">value</span> ? disabledStyles : <span class="hljs-literal">undefined</span>  <span class="hljs-comment">// é”™è¯¯ï¼šè¿”å›undefined</span>
])
</code></pre>
<p><strong>åŸå› </strong>ï¼šVueä¼šå¿½ç•¥æ•°ç»„ä¸­çš„<code>undefined</code>æˆ–<code>null</code>ï¼Œä½†å¦‚æœæ•°ç»„ä¸­æœ‰<code>undefined</code>ï¼Œåé¢çš„æ ·å¼å¯èƒ½æ— æ³•æ­£ç¡®åˆå¹¶ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šç¡®ä¿æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯<strong>æœ‰æ•ˆå¯¹è±¡</strong>ï¼ˆç©ºå¯¹è±¡<code>{}</code>ä¹Ÿå¯ä»¥ï¼‰ã€‚</p>
<p><strong>æ­£ç¡®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> buttonStyles = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> [
  baseStyles,
  isDisabled.<span class="hljs-property">value</span> ? disabledStyles : {}  <span class="hljs-comment">// ç©ºå¯¹è±¡ä¸å½±å“åˆå¹¶</span>
])
</code></pre>
<h3 data-id="heading-14">æŠ¥é”™3ï¼šåŠ¨æ€æ ·å¼æ²¡æœ‰å“åº”å¼æ›´æ–°</h3>
<p><strong>é”™è¯¯ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ™®é€šå¯¹è±¡ï¼Œéå“åº”å¼</span>
<span class="hljs-keyword">const</span> dynamicStyles = {
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'lightblue'</span>
}

<span class="hljs-comment">// ä¿®æ”¹æ—¶æ ·å¼ä¸æ›´æ–°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeColor</span> = (<span class="hljs-params"/>) =&gt; {
  dynamicStyles.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'lightcoral'</span>
}
</code></pre>
<p><strong>åŸå› </strong>ï¼šæ™®é€šå¯¹è±¡ä¸æ˜¯å“åº”å¼çš„ï¼ŒVueæ— æ³•æ£€æµ‹åˆ°å®ƒçš„å˜åŒ–ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>ç”¨<code>ref</code>åŒ…è£¹æ ·å¼å¯¹è±¡ï¼ˆæ¨èï¼‰ï¼›</li>
<li>ç”¨<code>computed</code>è¿”å›æ ·å¼ï¼ˆä¾èµ–å“åº”å¼æ•°æ®ï¼‰ã€‚</li>
</ul>
<p><strong>æ­£ç¡®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dynamicStyles = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'lightblue'</span>
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeColor</span> = (<span class="hljs-params"/>) =&gt; {
  dynamicStyles.<span class="hljs-property">value</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'lightcoral'</span>  <span class="hljs-comment">// å“åº”å¼ä¿®æ”¹</span>
}
</code></pre>
<h2 data-id="heading-15">å‚è€ƒé“¾æ¥</h2>
<p>Vueå®˜ç½‘Styleç»‘å®šæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fclass-and-style.html%23array-syntax-1" target="_blank" title="https://vuejs.org/guide/essentials/class-and-style.html#array-syntax-1" ref="nofollow noopener noreferrer">vuejs.org/guide/essenâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é˜²æŠ–èŠ‚æµé‡Œçš„thisä¼ é€’]]></title>    <link>https://juejin.cn/post/7584346983136804916</link>    <guid>https://juejin.cn/post/7584346983136804916</guid>    <pubDate>2025-12-17T07:29:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584346983136804916" data-draft-id="7584370833704976399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜²æŠ–èŠ‚æµé‡Œçš„thisä¼ é€’"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-17T07:29:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‚¸åœŸè±†"/> <meta itemprop="url" content="https://juejin.cn/user/457011401614381"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜²æŠ–èŠ‚æµé‡Œçš„thisä¼ é€’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/457011401614381/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‚¸åœŸè±†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:29:40.000Z" title="Wed Dec 17 2025 07:29:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¤©å¿ƒè¡€æ¥æ½®é‡å†™é˜²æŠ–èŠ‚æµï¼Œå†™ç€å†™ç€çªç„¶å†’å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ‰§è¡Œå‡½æ•°çš„æ—¶å€™è¦ç”¨applyå‘¢ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å†™fn(...args)å‘¢ï¼Ÿ</p>
<pre><code class="hljs language-js" lang="js">        <span class="hljs-comment">//é˜²æŠ–</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, wait, immediate = <span class="hljs-literal">false</span></span>) {
            <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
                <span class="hljs-keyword">if</span> (immediate &amp;&amp; timer === <span class="hljs-literal">null</span>) {
                    fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
                }

                <span class="hljs-built_in">clearTimeout</span>(timer);
                timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    timer = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">if</span> (!immediate) {
                        fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);  <span class="hljs-comment">//ä¸ºä»€ä¹ˆè¦ç”¨applyï¼Ÿ</span>
                    }
                }, wait)
            }
        }
        
        <span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">onClick</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>)
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a++)
        }
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-title function_">debounce</span>(onClick, <span class="hljs-number">1000</span>, <span class="hljs-literal">true</span>))
</code></pre>
<p>è™½ç„¶å…³äºthisçš„æŒ‡å‘ä¹ŸèƒŒçš„ä¸ƒä¸ƒå…«å…«ï¼Œä½†ä¸å¾—ä¸è¯´ï¼Œåœ¨çœŸå®çš„å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™è¿˜æ˜¯ä¼šè¢«ç»•è¿›å»ã€‚é‚£ä¹ˆä»Šå¤©å°±æ¥æ‰«è¡ä¸€ä¸‹è¿·é›¾å§ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨è¿™ä¸ªä¾‹å­å½“ä¸­ï¼Œç»™documentç»‘å®šäº†ä¸€ä¸ªclickäº‹ä»¶ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°æ˜¯debounce(onClick, 1000, true)ï¼Œä¹Ÿå°±æ˜¯é˜²æŠ–å‡½æ•°è¿™ä¸ªé«˜é˜¶å‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p>å¦‚æœè¿™é‡Œæ²¡æœ‰é˜²æŠ–ï¼Œè€Œæ˜¯ç›´æ¥è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-title function_">debounce</span>(onClick, <span class="hljs-number">1000</span>, <span class="hljs-literal">true</span>))
</code></pre>
<p>é‚£ä¹ˆonClickå†…éƒ¨çš„thisä¼šæŒ‡å‘è°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æŒ‡å‘documentã€‚å› ä¸ºæµè§ˆå™¨çš„äº‹ä»¶ç»‘å®šæœºåˆ¶æ˜¯ï¼Œåœ¨å“ªä¸ªå…ƒç´ ä¸Šç»‘å®šäº†äº‹ä»¶å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„thiså°±æŒ‡å‘è¿™ä¸ªå…ƒç´ ã€‚ç›¸å½“äºæµè§ˆå™¨æ‰§è¡Œäº†onClick.call(document, event)ã€‚</p>
<p>ç»è¿‡debounceåŒ…è£…äº†onClickåï¼Œå®ƒå†…éƒ¨çš„thisåº”è¯¥ä¸æ²¡åŒ…è£…çš„æ—¶å€™ä¸€æ ·ï¼ŒæŒ‡å‘documentã€‚</p>
<p>ä½†æ˜¯ï¼Œç°åœ¨onClickä¸documentä¹‹é—´çš„ç›´æ¥è”ç³»å·²ç»è¢«åˆ‡æ–­äº†ï¼Œç›¸å½“äºä¹‹å‰æ˜¯æ‰‹æ‹‰æ‰‹ï¼Œç°åœ¨ä¸­é—´ç¡¬æ’äº†ä¸€ä¸ªäººè¿›æ¥ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// document--onClick  ä¹‹å‰</span>
<span class="hljs-comment">// document--debounce--onClick  ç°åœ¨</span>
</code></pre>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±åªèƒ½é€šè¿‡æ’å…¥çš„è¿™ä¸ªäººæ¥è¿›è¡Œä¸€ä¸ªä¼ é€’ã€‚ç°åœ¨ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä»onClickå˜æˆäº†debounce(onClick, 1000, true)ï¼Œè€Œåè€…å°±ç­‰åŒäºdebounceå‡½æ•°è¿”å›çš„é‚£ä¸ªå‡½æ•°ï¼Œå› æ­¤è¿™ä¸ªè¿”å›å‡½æ•°çš„thisæŒ‡å‘äº†documentï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b03d090578435b9e5efe16332b9613~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54K45Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766561379&amp;x-signature=0K%2FHBwaNHTdrmYY4CzCozb9JMlo%3D" alt="image.png" loading="lazy"/></p>
<p>æ‰€ä»¥ç°åœ¨äº‹æƒ…å°±å¥½åŠäº†ï¼Œåªéœ€è¦åœ¨è¿™ä¸ªè¿”å›å‡½æ•°é‡Œé¢è°ƒç”¨fnçš„æ—¶å€™ï¼ŒæŠŠthisæŒ‡å‘ä¼ é€’è¿›å»å°±å¯ä»¥äº†ã€‚å¯ä»¥ç”¨applyï¼Œä¹Ÿå¯ä»¥ç”¨callã€‚è€Œå¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œå°±ä¼šå‡ºç°ä¸‹å›¾çš„æƒ…å†µï¼Œthisæ²¡æœ‰æ­£ç¡®ä¼ é€’ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d3c4e6297ec4018882f2a3a4299d01c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54K45Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766561379&amp;x-signature=UFKTZShIuYl2bmlNczRQxDjnLl4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18d46139e33a4a479e84fba40eed67b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54K45Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766561379&amp;x-signature=Um16chuQFFBtsCuTFElKjukHEvY%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter3.32 ä¸­ä½¿ç”¨ webview4.13 ä¸ vue3 é¡¹ç›®çš„ h5 é¡µé¢é€šä¿¡ï¼Œä»¥åŠå¦‚ä½•è°ƒè¯•]]></title>    <link>https://juejin.cn/post/7584475608220139571</link>    <guid>https://juejin.cn/post/7584475608220139571</guid>    <pubDate>2025-12-17T06:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584475608220139571" data-draft-id="7584362317002883099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter3.32 ä¸­ä½¿ç”¨ webview4.13 ä¸ vue3 é¡¹ç›®çš„ h5 é¡µé¢é€šä¿¡ï¼Œä»¥åŠå¦‚ä½•è°ƒè¯•"/> <meta itemprop="keywords" content="å‰ç«¯,Flutter"/> <meta itemprop="datePublished" content="2025-12-17T06:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å±±ç’"/> <meta itemprop="url" content="https://juejin.cn/user/2089515413410056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter3.32 ä¸­ä½¿ç”¨ webview4.13 ä¸ vue3 é¡¹ç›®çš„ h5 é¡µé¢é€šä¿¡ï¼Œä»¥åŠå¦‚ä½•è°ƒè¯•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2089515413410056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å±±ç’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:42:23.000Z" title="Wed Dec 17 2025 06:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€Appæ··åˆå¼€å‘è¶Šæ¥è¶Šå¤šï¼Œå¦‚ä½•ä¸h5é€šä¿¡æˆä¸ºä¸€ä¸ªåŸºç¡€æŠ€èƒ½ï¼Œæ ¹æ®æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå®ç°ä¸€ä¸ª demo å’Œä¸€ä»½æ–‡æ¡£ã€‚</p>
<blockquote>
<p>github åœ°å€flutter ç«¯(åªå®ç°äº† android)ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSuiShanpu%2Fhybrid-app-message-flutter" target="_blank" title="https://github.com/SuiShanpu/hybrid-app-message-flutter" ref="nofollow noopener noreferrer">github.com/SuiShanpu/hâ€¦</a><br/>
github åœ°å€ h5 ç«¯ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSuiShanpu%2Fhybrid-app-message-h5" target="_blank" title="https://github.com/SuiShanpu/hybrid-app-message-h5" ref="nofollow noopener noreferrer">github.com/SuiShanpu/hâ€¦</a></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€å‡†å¤‡å·¥ä½œ</h2>
<h3 data-id="heading-1">1ã€å·¥å…·ä¸ç‰ˆæœ¬</h3>
<p>App ç«¯å¼€å‘ç¯å¢ƒ</p>
<ul>
<li>Flutter 3.32.5</li>
<li>Dart 3.8.1</li>
<li>webview_flutter 4.13.0</li>
</ul>
<p>Web ç«¯å¼€å‘ç¯å¢ƒ</p>
<ul>
<li>node: 22.13.0</li>
<li>node: 10.9.2</li>
<li>vue 3.5.25</li>
<li>vite 7.2.4</li>
</ul>
<p>å¼€å‘å·¥å…·:</p>
<ul>
<li>App ç«¯: Android Studio Narwhal 3 Feature Drop | 2025.1.3</li>
<li>Web ç«¯: Visual Studio Code (1.106.3)</li>
</ul>
<h3 data-id="heading-2">2ã€åˆ†åˆ«åˆ›å»ºæ–°çš„ App é¡¹ç›®å’Œ Web é¡¹ç›®ï¼Œå¹¶å®ç°åŸºæœ¬åŠŸèƒ½</h3>
<blockquote>
<p>Flutter å·¥ç¨‹åˆ›å»ºå‚è€ƒ:  <a href="https://link.juejin.cn?target=https%3A%2F%2Fcodelabs.developers.google.cn%2Fcodelabs%2Fflutter-codelab-first%3Fhl%3Dzh-cn%232" target="_blank" title="https://codelabs.developers.google.cn/codelabs/flutter-codelab-first?hl=zh-cn#2" ref="nofollow noopener noreferrer">åˆ›å»ºç¬¬ä¸€ä¸ª Flutter é¡¹ç›®</a><br/>
Vue3 å·¥ç¨‹åˆ›å»ºå‚è€ƒ:  <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fquick-start.html%23creating-a-vue-application" target="_blank" title="https://cn.vuejs.org/guide/quick-start.html#creating-a-vue-application" ref="nofollow noopener noreferrer">åˆ›å»ºä¸€ä¸ª Vue åº”ç”¨</a></p>
</blockquote>
<p>Appç«¯: å¯ä»¥ä»é¦–é¡µé¢ è·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢(WebviewPage)</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ca025f25464c3ebdf20871700de163~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=tcjQ%2FkdgE2D4bzOaWLu3C%2B0JBU4%3D" alt="image.png" width="70%" loading="lazy"/>
<p>Webç«¯: é¡µé¢å†…åŒ…å«2ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åæ›´æ”¹æ–‡æœ¬å†…å®¹ã€‚</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee3400f32cdd478fadca7c6020c04943~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=IpiSO6fFQQcGKhy%2FcFSYax4yeZA%3D" alt="image.png" width="70%" loading="lazy"/>
<h2 data-id="heading-3">äºŒã€é€šä¿¡</h2>
<p>webview ç»„ä»¶åªèƒ½ä¸è¦æ¸²æŸ“ html é¦–é¡µé¢è¿›è¡Œé€šä¿¡ï¼›å› ä¸ºç”¨çš„æ˜¯ vue ç»„ä»¶ï¼Œå› æ­¤å¤šäº†ä¸€å±‚é€šä¿¡ã€‚<br/>
æ•´ä¸ªé€šä¿¡ï¼Œç”¨çš„æ˜¯<strong>å…¨å±€çš„ window å¯¹è±¡</strong>ã€‚</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0422c8ec584497b0d4f3ece0da5977~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=yCWB%2FmOkv6ACLV%2Fn5UMdgL7O7xs%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-4">1ã€vueç»„ä»¶ --&gt; webview</h3>
<p>åœ¨ vue ç»„ä»¶éœ€è¦çš„åœ°æ–¹è§¦å‘ï¼Œä¼ é€’å‚æ•°</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¼ é€’ string æ ¼å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onUseFlutter</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">flutterBridge</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'æ¥è‡ª h5 Home é¡µé¢çš„æ¶ˆæ¯'</span>);
}

<span class="hljs-comment">// ä¼ é€’ json æ ¼å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onUseJsonFlutter</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">jsonBridge</span>.<span class="hljs-title function_">postMessage</span>(
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'æ¥è‡ª h5 Home é¡µé¢çš„æ¶ˆæ¯'</span> })
  );
}
</code></pre>
<p>åœ¨ webview ä¸­æ³¨å†Œäº‹ä»¶ï¼Œæ·»åŠ å¤„ç†å‡½æ•°: åœ¨ web é¡µé¢ä¸­å°±ä¼šæ³¨å†Œä¸€ä¸ª window.xxxx å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¸H5é¡µé¢è¿›è¡Œé€šä¿¡çš„æ¡¥æ¢</span>
_webViewController.addJavaScriptChannel(
  <span class="hljs-comment">// ä¼šåœ¨H5çš„windowä¸ŠæŒ‚è½½ä¸€ä¸ªFlutterBridgeå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ªpostMessageæ–¹æ³•å‘é€æ•°æ®ç»™flutter</span>
  <span class="hljs-string">"flutterBridge"</span>,
  onMessageReceived: (JavaScriptMessage jsMsg) {
    <span class="hljs-comment">// æ ¹æ® h5 ä¼ é€’çš„æ•°æ®ç±»å‹è¿›è¡Œæ¥æ”¶</span>
    <span class="hljs-built_in">String</span> message = jsMsg.message; 

    <span class="hljs-comment">// todo something</span>
  }
);

<span class="hljs-comment">// æ¥æ”¶ json å¯¹è±¡æ•°æ®</span>
_webViewController.addJavaScriptChannel(
  <span class="hljs-comment">// ä¼šåœ¨H5çš„windowä¸ŠæŒ‚è½½ä¸€ä¸ªFlutterBridgeå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ªpostMessageæ–¹æ³•å‘é€æ•°æ®ç»™flutter</span>
  <span class="hljs-string">"jsonBridge"</span>,
  onMessageReceived: (JavaScriptMessage jsMsg) {
    <span class="hljs-comment">// å¦‚æœæ˜¯ json å¯¹è±¡ï¼Œåˆ™éœ€è¦ä½¿ç”¨ jsonDecode è§£æ</span>
    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; message = jsonDecode(jsMsg.message);

    <span class="hljs-comment">// todo something</span>
  }
);
</code></pre>
<p>æ³¨æ„: â€˜flutterBridgeâ€™ åç§°æ˜¯è‡ªå®šä¹‰çš„ï¼Œéœ€è¦å¯¹åº”ä¸€è‡´ã€‚</p>
<h3 data-id="heading-5">2ã€webview --&gt; htmlé¦–é¡µé¢</h3>
<p>åœ¨ webview ä¸­è§¦å‘è„šæœ¬</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä»flutter å‘é€ä¿¡æ¯</span>
_sendFlutterTestMessage() <span class="hljs-keyword">async</span> {
  <span class="hljs-comment">// æ„é€ è¦ä¼ é€’çš„å‚æ•°ï¼ˆæ”¯æŒä»»æ„ç±»å‹ï¼šå¯¹è±¡ã€æ•°ç»„ã€å­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼‰</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; msgFlutter = {
    <span class="hljs-string">"msg"</span>: <span class="hljs-string">"è¿™æ˜¯ flutter ä¸­çš„ä¼ é€’è¿‡æ¥çš„å€¼"</span>,
  };

  <span class="hljs-comment">// è°ƒç”¨ h5 é¡µé¢ä¸­è„šæœ¬æ–¹æ³•</span>
  _webViewController.runJavaScript(<span class="hljs-string">'''
    receiveFromFlutter(<span class="hljs-subst">${jsonEncode(msgFlutter)}</span>);
  '''</span>);
}
</code></pre>
<p>åœ¨ html é¦–é¡µé¢ä¸­æ·»åŠ å‡½æ•°è„šæœ¬</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">receiveFromFlutter</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"receiveFromFlutter data:"</span>, data);
}
</code></pre>
<h3 data-id="heading-6">3ã€htmlé¦–é¡µé¢ --&gt; vueç»„ä»¶</h3>
<p>åœ¨ html é¦–é¡µé¢ä¸­è§¦å‘ window è‡ªå®šä¹‰äº‹ä»¶ï¼ˆå®šä¹‰è‡ªå®šä¹‰äº‹ä»¶ï¼‰</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">receiveFromFlutter</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-comment">// åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶å¹¶æºå¸¦æ•°æ®</span>
  <span class="hljs-keyword">const</span> flutterEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">"flutter-to-home"</span>, { <span class="hljs-attr">detail</span>: data }); 
  <span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(flutterEvent); 
}
</code></pre>
<p>åœ¨ vue ç»„ä»¶éœ€è¦çš„åœ°æ–¹ç»‘å®š window äº‹ä»¶ (ç»„ä»¶é”€æ¯æ—¶ç§»é™¤äº‹ä»¶)</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'flutter-to-home'</span>, useFlutterMessage);
});

<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'flutter-to-home'</span>, useFlutterMessage);
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useFlutterMessage</span>(<span class="hljs-params">ev</span>) {
  <span class="hljs-keyword">const</span> data = ev.<span class="hljs-property">detail</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ä½¿ç”¨ fluter ä¸­çš„å€¼ data:"</span>, data);
}
</code></pre>
<p>3æ¬¡é€šä¿¡éƒ½å®Œæˆåï¼Œä¸€ä¸ªå®Œæ•´çš„é€šä¿¡å®Œæˆï¼Œä¸€æ¬¡æ“ä½œç»“æŸã€‚</p>
<h2 data-id="heading-7">ä¸‰ã€è°ƒè¯•</h2>
<p>ä½¿ç”¨ vConsole æ’ä»¶ã€‚åœ¨ htmlé¦–é¡µé¢ æ·»åŠ å¦‚ä¸‹è„šæœ¬å†…å®¹ã€‚</p>
<pre><code class="hljs language-js" lang="js">&lt;script src=<span class="hljs-string">"https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"</span>&gt;&lt;/script&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">VConsole</span>();</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/840549bdc9af4ac5a49352609cc207f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=BMOr9NuCqha5Yfve2euG2VyJLOU%3D" alt="image.png" width="70%" loading="lazy"/>
<h2 data-id="heading-8">å››ã€ç»“è¯­</h2>
<p>ä¸h5é€šä¿¡è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„å†…å®¹ï¼Œæ¯”å¦‚å¤šè¯­è¨€ã€æƒé™ç­‰ã€‚åé¢å¾ˆæœ‰å¾ˆé•¿çš„è·¯è¦èµ°ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutteré¡¹ç›®å¤§é‡ä½¿ç”¨.obsä¼šå¯¼è‡´é¡¹ç›®æ€§èƒ½æåº¦ä¸‹é™å—]]></title>    <link>https://juejin.cn/post/7584408254819500067</link>    <guid>https://juejin.cn/post/7584408254819500067</guid>    <pubDate>2025-12-17T07:26:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254819500067" data-draft-id="7584377629707092003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutteré¡¹ç›®å¤§é‡ä½¿ç”¨.obsä¼šå¯¼è‡´é¡¹ç›®æ€§èƒ½æåº¦ä¸‹é™å—"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-17T07:26:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yfmingo"/> <meta itemprop="url" content="https://juejin.cn/user/4037062425588136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutteré¡¹ç›®å¤§é‡ä½¿ç”¨.obsä¼šå¯¼è‡´é¡¹ç›®æ€§èƒ½æåº¦ä¸‹é™å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062425588136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yfmingo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:26:38.000Z" title="Wed Dec 17 2025 07:26:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç®€çŸ­çš„å›ç­”æ˜¯ï¼š<strong>ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šï¼Œç”šè‡³åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œå¤§é‡ä½¿ç”¨ <code>.obs</code> åè€Œæ¯”ä¼ ç»Ÿçš„ <code>setState</code> æ€§èƒ½æ›´å¥½ã€‚</strong></p>
<p>ä½†å‡¡äº‹éƒ½æœ‰â€œä½†æ˜¯â€ã€‚å¦‚æœä½¿ç”¨å§¿åŠ¿ä¸å¯¹ï¼Œç¡®å®ä¼šå¯¼è‡´å†…å­˜å ç”¨å¢åŠ æˆ–å¸§ç‡ä¸‹é™ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä»**å†…å­˜ï¼ˆMemoryï¼‰<strong>å’Œ</strong>CPU/æ¸²æŸ“ï¼ˆRenderingï¼‰**ä¸¤ä¸ªç»´åº¦æ¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 data-id="heading-0">1. å†…å­˜ç»´åº¦ï¼šä¼šæœ‰é¢å¤–å¼€é”€ï¼Œä½†é€šå¸¸å¯å¿½ç•¥</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šä¸€ä¸ªæ™®é€šçš„ <code>int a = 0</code> åœ¨å†…å­˜ä¸­å ç”¨æå°ã€‚ä½†æ˜¯ <code>var a = 0.obs</code> å®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ª <code>RxInt</code> å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª <code>Stream</code>ï¼ˆæµï¼‰å’Œç›‘å¬å™¨åˆ—è¡¨ã€‚</li>
<li><strong>å½±å“</strong>ï¼š<code>Rx</code> ç±»å‹çš„å¯¹è±¡ç¡®å®æ¯”åŸå§‹ç±»å‹ï¼ˆPrimitive typesï¼‰é‡ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šé™¤éä½ åˆ›å»ºäº†<strong>æ•°ç™¾ä¸‡ä¸ª</strong> <code>.obs</code> å¯¹è±¡ï¼ˆä¾‹å¦‚åœ¨ä¸€ä¸ªå·¨å¤§çš„å¾ªç¯ä¸­ä¸ºæ¯ä¸ªæ•°æ®ç‚¹éƒ½åˆ›å»ºç‹¬ç«‹çš„ <code>Rx</code> å˜é‡ï¼‰ï¼Œå¦åˆ™ç°ä»£æ‰‹æœºçš„å†…å­˜ï¼ˆ6GB+ï¼‰å®Œå…¨å¯ä»¥å¿½ç•¥è¿™ç‚¹å¼€é”€ã€‚å¯¹äºå¸¸è§„ App çš„å‡ ç™¾ä¸Šåƒä¸ªçŠ¶æ€å˜é‡ï¼Œå‡ ä¹æ²¡æœ‰å½±å“ã€‚</li>
</ul>
<h3 data-id="heading-1">2. CPU/æ¸²æŸ“ç»´åº¦ï¼šè¿™æ˜¯å…³é”®ï¼ˆåŒåˆƒå‰‘ï¼‰</h3>
<p>GetX çš„ <code>.obs</code> + <code>Obx</code> æœºåˆ¶æ˜¯<strong>ç»†ç²’åº¦æ›´æ–°</strong>ã€‚</p>
<h4 data-id="heading-2">âœ… ä¼˜åŠ¿ï¼šå®ƒä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h4>
<p>å½“ä½ ä½¿ç”¨ <code>setState</code> æ—¶ï¼ŒFlutter ä¼šé‡å»º<strong>å½“å‰ Widget åŠå…¶å­æ ‘</strong>ã€‚
å½“ä½ ä½¿ç”¨ <code>Obx</code> æ—¶ï¼ŒGetX åªä¼šé‡å»º<strong>åŒ…è£¹åœ¨ <code>Obx</code> å†…éƒ¨çš„é‚£ä¸ªå°ç»„ä»¶</strong>ã€‚</p>
<ul>
<li><strong>ä¾‹å­</strong>ï¼šé¡µé¢æœ‰ä¸€ä¸ªå¤æ‚çš„åˆ—è¡¨ï¼Œé¡¶éƒ¨æœ‰ä¸€ä¸ªè®¡æ•°å™¨ã€‚</li>
<li><strong><code>setState</code></strong>ï¼šè®¡æ•°å™¨å˜äº† -&gt; æ•´ä¸ªé¡µé¢ <code>build</code> æ–¹æ³•é‡è·‘ -&gt; åˆ—è¡¨ä¹Ÿè¦åš diffï¼ˆè™½ç„¶ Element æ ‘å¯èƒ½ä¸é‡ç»˜ï¼Œä½† diff ä¹Ÿè¦è€— CPUï¼‰ã€‚</li>
<li><strong><code>.obs</code></strong>ï¼šè®¡æ•°å™¨å˜äº† -&gt; åªæœ‰ <code>Obx(() =&gt; Text(...))</code> è¿™ä¸€è¡Œä»£ç é‡è·‘ -&gt; åˆ—è¡¨å®Œå…¨ä¸å—å½±å“ã€‚</li>
<li><strong>ç»“è®º</strong>ï¼šåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤§é‡ä½¿ç”¨ <code>.obs</code> åè€Œ<strong>æå‡</strong>äº†æ€§èƒ½ã€‚</li>
</ul>
<h4 data-id="heading-3">âŒ é™·é˜±ï¼šä»€ä¹ˆæ—¶å€™ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Ÿ</h4>
<p>å¦‚æœä½ é‡åˆ°äº†æ€§èƒ½ä¸‹é™ï¼Œé€šå¸¸æ˜¯å› ä¸ºçŠ¯äº†ä»¥ä¸‹é”™è¯¯ï¼š</p>
<p><strong>1. æ»¥ç”¨ <code>Obx</code> åŒ…è£¹èŒƒå›´è¿‡å¤§ï¼ˆæœ€å¸¸è§ï¼‰</strong>
é”™è¯¯åšæ³•ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šåªè¦ count å˜äº†ï¼Œæ•´ä¸ª Column é‡Œçš„æ‰€æœ‰ä¸œè¥¿ï¼ˆåŒ…æ‹¬å¤æ‚çš„ ChartViewï¼‰éƒ½ä¼šè¢«é‡å»º</span>
Obx(() =&gt; Column(
  children: [
    Text(<span class="hljs-string">"Count: <span class="hljs-subst">${controller.count}</span>"</span>),
    SuperComplexChartView(), <span class="hljs-comment">// æåº¦æ¶ˆè€—æ€§èƒ½çš„ç»„ä»¶</span>
    AnotherHeavyWidget(),
  ],
));

</code></pre>
<p>æ­£ç¡®åšæ³•ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šcount å˜äº†ï¼Œåªæœ‰ Text é‡å»ºï¼Œä¸‹é¢çš„å¤æ‚ç»„ä»¶çº¹ä¸ä¸åŠ¨</span>
Column(
  children: [
    Obx(() =&gt; Text(<span class="hljs-string">"Count: <span class="hljs-subst">${controller.count}</span>"</span>)),
    SuperComplexChartView(),
    AnotherHeavyWidget(),
  ],
);

</code></pre>
<p>**2. åœ¨é«˜é¢‘æ›´æ–°ä¸­ä½¿ç”¨ <code>.obs**</code>
å¦‚æœä½ æœ‰ä¸€ä¸ª <code>.obs</code> å˜é‡ç»‘å®šåœ¨ <code>AnimationController</code> çš„å›è°ƒé‡Œï¼Œæˆ–è€…ç”¨äºç›‘å¬æ»šåŠ¨ä½ç½®ï¼ˆScrollPositionï¼‰ï¼Œæ¯ç§’æ›´æ–° 60-120 æ¬¡ã€‚</p>
<ul>
<li>å¦‚æœåœ¨ <code>Obx</code> é‡Œåšäº†å¤æ‚çš„é€»è¾‘è¿ç®—ï¼Œä¼šå¯¼è‡´ UI çº¿ç¨‹æ‰å¸§ã€‚</li>
<li><strong>å»ºè®®</strong>ï¼šå¯¹äºæé«˜é¢‘çš„æ›´æ–°ï¼Œè€ƒè™‘ä½¿ç”¨ <code>GetBuilder</code>ï¼ˆæ‰‹åŠ¨ <code>update()</code>ï¼‰æˆ–è€…ç›´æ¥æ“ä½œ <code>RenderObject</code>ï¼Œä¸è¿‡é€šå¸¸ <code>Obx</code> ä¹Ÿæ‰›å¾—ä½ï¼Œåªè¦åˆ«åœ¨é‡Œé¢åšè€—æ—¶æ“ä½œã€‚</li>
</ul>
<p><strong>3. å¤§åˆ—è¡¨çš„ <code>RxList</code> é™·é˜±</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> list = &lt;Item&gt;[].obs;

</code></pre>
<p>å½“ä½ è°ƒç”¨ <code>list.add()</code> æˆ– <code>list.refresh()</code> æ—¶ï¼Œæ‰€æœ‰ç›‘å¬ <code>list</code> çš„ <code>Obx</code> éƒ½ä¼šé‡å»ºã€‚
å¦‚æœä½ çš„ <code>ListView</code> æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Obx(() =&gt; ListView.builder(
  itemCount: controller.list.length,
  itemBuilder: (context, index) {
     <span class="hljs-comment">// ...</span>
  }
))

</code></pre>
<p>è¿™é€šå¸¸æ²¡é—®é¢˜ï¼Œå› ä¸º <code>ListView.builder</code> åªæœ‰è§†å£å†…çš„ item ä¼šæ¸²æŸ“ã€‚ä½†å¦‚æœä½ åœ¨ <code>Obx</code> é‡Œç›´æ¥ç”¨äº† <code>Column</code> æ¸²æŸ“ä¸€ä¸ªé•¿åˆ—è¡¨ï¼Œé‚£å°±ä¼šå¡é¡¿ã€‚</p>
<p><strong>4. æ»¥ç”¨ Workers (ever, debounce, interval)</strong>
å¦‚æœä½ å®šä¹‰äº†å¤§é‡çš„ <code>.obs</code> å˜é‡ï¼Œå¹¶ä¸”ç»™æ¯ä¸€ä¸ªéƒ½ç»‘å®šäº† <code>ever</code> ç›‘å¬å™¨ï¼ˆæ¯æ¬¡å˜åŒ–éƒ½æ‰§è¡Œå›è°ƒï¼‰ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„ CPU èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨æ‰¹é‡æ›´æ–°æ•°æ®çš„æ—¶å€™ã€‚</p>
<h3 data-id="heading-4">æ€»ç»“ä¸å»ºè®®</h3>
<p><strong>å¤§é‡ä½¿ç”¨ <code>.obs</code> ä¸ä¼šè®©é¡¹ç›®å˜å¡ï¼Œå‰ææ˜¯ä½ éµå¾ªâ€œæœ€å°æ›´æ–°åŸåˆ™â€ã€‚</strong></p>
<ul>
<li><strong>æ”¾å¿ƒç”¨</strong>ï¼šåœ¨ ViewModel (Controller) ä¸­å®šä¹‰å‡ åä¸Šç™¾ä¸ª <code>.obs</code> å˜é‡å®Œå…¨æ²¡é—®é¢˜ã€‚</li>
<li><strong>å°å¿ƒç”¨</strong>ï¼šåœ¨ View å±‚å†™ <code>Obx(() =&gt; ...)</code> æ—¶ï¼Œ<strong>èŒƒå›´è¶Šå°è¶Šå¥½</strong>ã€‚åªåŒ…è£¹é‚£ä¸ªå˜åŒ–çš„ Text æˆ– Iconï¼Œä¸è¦åŒ…è£¹æ•´ä¸ª Scaffold æˆ– Columnã€‚</li>
<li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šå¦‚æœä½ éå¸¸åœ¨æ„å†…å­˜ï¼ˆä¾‹å¦‚åœ¨ä½ç«¯ IoT è®¾å¤‡ä¸Šè·‘ Flutterï¼‰ï¼Œæˆ–è€…çŠ¶æ€æ›´æ–°ä¸éœ€è¦å“åº”å¼æµçš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨ **<code>GetBuilder</code> + <code>update()**</code> æ¨¡å¼ã€‚å®ƒæ˜¯æœ€è½»é‡çº§çš„ï¼Œå‡ ä¹ç­‰åŒäºåŸç”Ÿçš„æ€§èƒ½ï¼Œå†…å­˜å ç”¨æ¯” <code>.obs</code> å°‘ï¼Œä½†å†™èµ·æ¥ç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼ˆéœ€è¦æ‰‹åŠ¨è§¦å‘æ›´æ–°ï¼‰ã€‚</li>
</ul>
<p><strong>ä¸€å¥è¯å»ºè®®</strong>ï¼šç»§ç»­ç”¨ <code>.obs</code>ï¼Œä½†è¦å…»æˆæŠŠ <code>Obx</code> æ”¾åœ¨ Widget æ ‘<strong>å¶å­èŠ‚ç‚¹</strong>ï¼ˆæœ€åº•å±‚ï¼‰çš„å¥½ä¹ æƒ¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰Java SDK æŒ‡å—]]></title>    <link>https://juejin.cn/post/7584379805899538484</link>    <guid>https://juejin.cn/post/7584379805899538484</guid>    <pubDate>2025-12-17T06:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805899538484" data-draft-id="7584346983136542772" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰Java SDK æŒ‡å—"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-17T06:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰Java SDK æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:54:59.000Z" title="Wed Dec 17 2025 06:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“æˆ‘ä»¬æŠŠå„ç§å†…éƒ¨ç³»ç»Ÿã€æ•°æ®æºã€å·¥å…·æ¥å…¥å¤§è¯­è¨€æ¨¡å‹æ—¶ï¼Œå¾€å¾€ä¼šé‡åˆ°ä¸€ä¸ªå°´å°¬çš„é—®é¢˜ï¼šæ¯ä¸ªå›¢é˜Ÿã€æ¯å¥—ç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„ä¸€å¥—â€œæ¥å…¥è§„èŒƒâ€ã€‚æœ‰çš„ç”¨ HTTP APIï¼Œæœ‰çš„ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ‰çš„ç›´æ¥è¿æ•°æ®åº“ï¼Œæœ€åä¸€åœˆä¸²ä¸‹æ¥ï¼Œæ—¢éš¾ä»¥ç»Ÿä¸€æ²»ç†ï¼Œåˆå¾ˆéš¾åœ¨ä¸åŒåº”ç”¨ä¹‹é—´å¤ç”¨ã€‚è¿™æ—¶ï¼Œä½ å¯èƒ½ä¼šé—®ï¼šæœ‰æ²¡æœ‰ä¸€ç§é€šç”¨çš„åè®®ï¼Œæ—¢èƒ½è®© AI æ¨¡å‹æ–¹ä¾¿åœ°è°ƒç”¨å¤–éƒ¨å·¥å…·ã€è®¿é—®æ•°æ®ï¼Œåˆèƒ½è®©åç«¯æœåŠ¡æ–¹ç”¨æ ‡å‡†æ–¹å¼æš´éœ²èƒ½åŠ›ï¼Ÿ</p>
<p>Model Context Protocolï¼ˆMCPï¼‰å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„æ ‡å‡†ä¹‹ä¸€ï¼Œè€Œæœ¬æ–‡è¦ä»‹ç»çš„ Java SDKï¼Œåˆ™ä¸º Java å¼€å‘è€…æä¾›äº†ä¸€æ¡ç›´æ¥æ¥å…¥ MCP ç”Ÿæ€çš„é€šè·¯ã€‚é€šè¿‡å®ƒï¼Œä½ å¯ä»¥ç”¨ç»Ÿä¸€çš„æ¨¡å‹ï¼Œåœ¨ Java åº”ç”¨é‡Œæš´éœ²å·¥å…·ã€èµ„æºã€æç¤ºæ¨¡ç‰ˆï¼Œä¹Ÿå¯ä»¥è½»æ¾ä½œä¸ºå®¢æˆ·ç«¯å»è°ƒç”¨è¿™äº›èƒ½åŠ›ã€‚æœ¬æ–‡å°†ä»æ•´ä½“æ¶æ„è®²èµ·ï¼Œä¸€æ­¥æ­¥å¸¦ä½ ç”¨ä¸€ä¸ªå¯è¿è¡Œçš„ç¤ºä¾‹ï¼Œæ­å»ºèµ·è‡ªå·±çš„ MCP æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ã€‚</p>
<h2 data-id="heading-0">1. æ¦‚è§ˆ</h2>
<p>éšç€è¿‘å¹´æ¥ AI çš„å¿«é€Ÿå‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„å·¥å…·å’Œç³»ç»Ÿå¼€å§‹ä¸ AI æ¨¡å‹é›†æˆã€‚ä½†éšä¹‹è€Œæ¥çš„ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼šæ¯ç§é›†æˆéƒ½å¯èƒ½é‡‡ç”¨å®Œå…¨ä¸åŒçš„æ ‡å‡†å’Œæ–¹å¼ï¼Œå°†å¤–éƒ¨å·¥å…·ã€èµ„æºå’Œç³»ç»Ÿæ¥å…¥åˆ° AI æ¨¡å‹ä¸­ã€‚</p>
<p>Model Context Protocolï¼ˆMCPï¼‰æ˜¯ä¸€ä¸ªå¼€æºæ ‡å‡†ï¼Œå®ƒå®šä¹‰äº† AI åº”ç”¨ï¼ˆå¦‚å¤§è¯­è¨€æ¨¡å‹ã€å›¾åƒç”Ÿæˆæ¨¡å‹ç­‰ï¼‰ä¸å·¥å…·ã€æ•°æ®æºä»¥åŠå…¶ä»–èµ„æºä¹‹é—´çš„é›†æˆæ–¹å¼ã€‚å€ŸåŠ© MCPï¼ŒAI åº”ç”¨å¯ä»¥æŒ‰å¤–éƒ¨ç³»ç»Ÿçº¦å®šçš„æ–¹å¼è®¿é—®æ•°æ®ã€è°ƒç”¨å·¥å…·å¹¶æ‰§è¡Œå·¥ä½œæµã€‚</p>
<p>MCP çš„ Java SDK ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç»„åº“ï¼Œæ”¯æŒå¤šç§åè®®å’Œé€šä¿¡æœºåˆ¶ï¼Œç”¨äºæŠŠ Java åº”ç”¨ä¸ AI åº”ç”¨è¿æ¥èµ·æ¥ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€èµ·äº†è§£è¿™ä¸ª SDKï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹æ¥ä½“éªŒ MCP çš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<h2 data-id="heading-1">2. æ¶æ„</h2>
<p>MCP æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>MCP Hostï¼šè´Ÿè´£ç®¡ç†å¤šä¸ª MCP Client</strong></li>
<li><strong>MCP Clientï¼šä» MCP Server è·å–ä¸Šä¸‹æ–‡ï¼Œä¾› MCP Host ä½¿ç”¨</strong></li>
<li><strong>MCP Serverï¼šå‘ MCP Client æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå¯è°ƒç”¨èƒ½åŠ›</strong></li>
</ul>
<p>MCP å°†é€šä¿¡åˆ’åˆ†ä¸ºä¸¤ä¸ªæ¦‚å¿µå±‚æ¬¡ï¼š<strong>æ•°æ®å±‚ï¼ˆData Layerï¼‰ï¼Œç”¨äºå®šä¹‰å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡åè®®å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼›ä»¥åŠÂ <strong>ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰ï¼Œç”¨äºå®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„å…·ä½“ä¼ è¾“é€šé“å’Œæœºåˆ¶</strong>ã€‚</p>
<p>Java ç‰ˆçš„ MCP SDK å°†è¿™äº›æ¦‚å¿µæ˜ å°„ä¸ºå¦‚ä¸‹å‡ ä¸ªå±‚æ¬¡ï¼š</p>
<ul>
<li>Client/Server å±‚ï¼šé€šè¿‡Â <code>McpClient</code>Â /Â <code>McpServer</code>Â å®ç°å¹¶ç®¡ç†å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„å…·ä½“æ“ä½œ</li>
<li>Session å±‚ï¼šé€šè¿‡Â <code>McpSession</code>Â ç®¡ç†é€šä¿¡æ¨¡å¼å’Œä¼šè¯çŠ¶æ€</li>
<li>Transport å±‚ï¼šé€šè¿‡Â <code>McpTransport</code>Â å¤„ç†æ¶ˆæ¯çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</li>
</ul>
<p>å®¢æˆ·ç«¯ä¼šè°ƒç”¨ MCP æœåŠ¡ç«¯æš´éœ²çš„ä¸€åˆ°å¤šä¸ªå·¥å…·ï¼ˆtoolï¼‰ï¼Œè€Œåº•å±‚çš„é€šä¿¡åˆ™ç”±ä¼ è¾“å±‚è´Ÿè´£ã€‚</p>
<p>åœ¨ MCP ä¸­ï¼Œ<strong>Primitiveï¼ˆåŸè¯­ï¼‰</strong> Â æ˜¯æœ€åŸºç¡€çš„æ„å»ºå•å…ƒï¼Œç”¨æ¥å®šä¹‰å¯ç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ç±»å‹ä»¥åŠå¯æ‰§è¡Œçš„æ“ä½œèŒƒå›´ã€‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½æä¾›äº†ä¸€äº›åŸè¯­ã€‚</p>
<p>æœåŠ¡ç«¯ä¾§çš„åŸè¯­åŒ…æ‹¬å·¥å…·ï¼ˆtoolsï¼‰ã€èµ„æºï¼ˆresourcesï¼‰å’Œæç¤ºæ¨¡ç‰ˆï¼ˆpromptsï¼‰ã€‚<strong>å·¥å…·æ˜¯ AI åº”ç”¨å¯ä»¥è°ƒç”¨çš„å¯æ‰§è¡Œå‡½æ•°</strong>ï¼Œä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“ã€æ–‡ä»¶æ“ä½œç­‰ã€‚<strong>èµ„æºæ˜¯æä¾›ç»™å®¢æˆ·ç«¯çš„ä¸Šä¸‹æ–‡æ•°æ®æº</strong>ï¼Œä¾‹å¦‚æ•°æ®åº“ç»“æ„ã€æ–‡ä»¶å†…å®¹ç­‰ã€‚<strong>æç¤ºæ¨¡ç‰ˆæ˜¯å¯å¤ç”¨çš„æ¨¡ç‰ˆï¼Œç”¨äºä¸è¯­è¨€æ¨¡å‹è¿›è¡Œäº¤äº’</strong>ã€‚</p>
<p>å®¢æˆ·ç«¯ä¾§çš„åŸè¯­åˆ™å¸®åŠ©Â <code>McpServer</code>Â çš„å®ç°è€…æ„å»ºæ›´ä¸°å¯Œçš„äº¤äº’èƒ½åŠ›ï¼ŒåŒ…æ‹¬é‡‡æ ·ï¼ˆsamplingï¼‰ã€ä¿¡æ¯è¡¥å……ï¼ˆelicitationï¼‰å’Œæ—¥å¿—ï¼ˆloggingï¼‰ã€‚<strong>é‡‡æ ·å…è®¸æœåŠ¡ç«¯åœ¨ä¸é›†æˆæ¨¡å‹ SDK çš„æƒ…å†µä¸‹ï¼Œå‘å®¢æˆ·ç«¯è¯·æ±‚è¯­è¨€æ¨¡å‹è¡¥å…¨ç»“æœã€‚</strong> Â <strong>ä¿¡æ¯è¡¥å……è®©æœåŠ¡ç«¯èƒ½å¤Ÿå‘ç”¨æˆ·è¯·æ±‚é¢å¤–ä¿¡æ¯æˆ–ç¡®è®¤æ“ä½œã€‚</strong> Â <strong>æ—¥å¿—åˆ™å…è®¸æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ—¥å¿—æ¶ˆæ¯ï¼Œç”¨äºè°ƒè¯•å’Œç›‘æ§ã€‚</strong></p>
<h2 data-id="heading-2">3. ç¯å¢ƒå‡†å¤‡</h2>
<p>è¦ä½¿ç”¨ MCP Java SDKï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­åŠ å…¥Â <code>mcp</code>Â ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.modelcontextprotocol.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mcp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">3.1 å®šä¹‰ä¸€ä¸ª MCP å·¥å…·</h3>
<p>æˆ‘ä»¬å…ˆé€šè¿‡Â <code>LoggingTool</code>Â è¿™ä¸ªç±»ï¼Œå®šä¹‰ä¸€ä¸ªéå¸¸ç®€å•çš„ MCP å·¥å…·ï¼Œç”¨æ¥æ‰“å°æ”¶åˆ°çš„æç¤ºè¯ï¼ˆpromptï¼‰ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªÂ <code>SyncToolSpecification</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingTool</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">McpServerFeatures</span>.<span class="hljs-property">SyncToolSpecification</span> <span class="hljs-title function_">logPromptTool</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">McpSchema</span>.<span class="hljs-property">JsonSchema</span> inputSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-title class_">JsonSchema</span>(<span class="hljs-string">"object"</span>,
            <span class="hljs-title class_">Map</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">"prompt"</span>, <span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>), <span class="hljs-title class_">List</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">"prompt"</span>), <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerFeatures</span>.<span class="hljs-title class_">SyncToolSpecification</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-title class_">Tool</span>(
              <span class="hljs-string">"logPrompt"</span>, <span class="hljs-string">"Log Prompt"</span>,<span class="hljs-string">"Logs a provided prompt"</span>, inputSchema, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),
                (exchange, args) -&gt; {
                    <span class="hljs-title class_">String</span> prompt = (<span class="hljs-title class_">String</span>) args.<span class="hljs-title function_">get</span>(<span class="hljs-string">"prompt"</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-property">CallToolResult</span>.<span class="hljs-title function_">builder</span>()
                      .<span class="hljs-title function_">content</span>(<span class="hljs-title class_">List</span>.<span class="hljs-title function_">of</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-title class_">TextContent</span>(<span class="hljs-string">"Input Prompt: "</span> + prompt)))
                      .<span class="hljs-title function_">isError</span>(<span class="hljs-literal">false</span>)
                      .<span class="hljs-title function_">build</span>();
                });
    }
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†è¾“å…¥çš„ JSON Schemaï¼Œç”¨æ¥ä¸ºç”¨æˆ·è¾“å…¥å»ºç«‹ä¸€ä¸ªæ¸…æ™°çš„å¥‘çº¦ã€‚æ¥ç€ï¼Œä½¿ç”¨è¯¥è¾“å…¥ Schema æ¥å®ä¾‹åŒ–ä¸€ä¸ªÂ <code>Tool</code>ï¼Œåœ¨å¤„ç†é€»è¾‘ä¸­æå–å‡ºÂ <code>prompt</code>Â å‚æ•°ï¼Œå¹¶æœ€ç»ˆè¿”å›åŒ…å«è¯¥Â <code>prompt</code>Â çš„Â <code>TextContent</code>Â ç»“æœã€‚</p>
<h2 data-id="heading-4">4. MCP å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ­å»º</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª MCP æœåŠ¡ç«¯æ¥æš´éœ²è‡ªå®šä¹‰å·¥å…·ï¼Œä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ª MCP å®¢æˆ·ç«¯ï¼Œç”¨äºè¿æ¥è¯¥æœåŠ¡ç«¯å¹¶è°ƒç”¨å…¶ä¸­çš„å·¥å…·ã€‚</p>
<h3 data-id="heading-5">4.1 MCP æœåŠ¡ç«¯å®ç°</h3>
<p><code>McpServer</code>Â å…·æœ‰ä¸€ç»„èƒ½åŠ›ï¼ˆcapabilitiesï¼‰ï¼Œç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯å½“å‰æœåŠ¡å™¨æ”¯æŒå“ªäº›ç±»åˆ«çš„åè®®æ“ä½œï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€æç¤ºè¯è¡¥å…¨ã€èµ„æºè®¿é—®ç­‰ã€‚æ­¤å¤–ï¼Œå·¥å…·ï¼ˆtoolsï¼‰åˆ™æä¾›ç»™å®¢æˆ·ç«¯å¯è°ƒç”¨çš„å…·ä½“å‡½æ•°ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªÂ <code>McpServer</code>Â çš„å®ç°ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">public class McpServerApp {

    public static McpSyncServer <span class="hljs-built_in">createServer</span>() {
        JacksonMcpJsonMapper jsonMapper = new <span class="hljs-built_in">JacksonMcpJsonMapper</span>(new ObjectMapper());
        StdioServerTransportProvider transportProvider = new <span class="hljs-built_in">StdioServerTransportProvider</span>(
            jsonMapper);

        return McpServer<span class="hljs-selector-class">.sync</span>(transportProvider)
          <span class="hljs-selector-class">.serverInfo</span>("baeldung-demo-server", "<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>")
          <span class="hljs-selector-class">.capabilities</span>(McpSchema.ServerCapabilities.builder()
            <span class="hljs-selector-class">.tools</span>(true)
            <span class="hljs-selector-class">.logging</span>()
            <span class="hljs-selector-class">.build</span>())
          <span class="hljs-selector-class">.tools</span>(LoggingTool.logPromptTool())
          <span class="hljs-selector-class">.build</span>();
    }

    public static void <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-built_in">createServer</span>();
    }
}
</code></pre>
<p>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªåŒæ­¥çš„Â <code>McpServer</code>ï¼Œé€šè¿‡æ ‡å‡†è¾“å…¥/è¾“å‡ºæµå¹¶ä½¿ç”¨ JSON æ¶ˆæ¯æ ¼å¼è¿›è¡Œé€šä¿¡ã€‚éšåæˆ‘ä»¬å£°æ˜äº†æœåŠ¡å™¨çš„èƒ½åŠ›ï¼šå¼€å¯å·¥å…·ä»¥åŠæ—¥å¿—åŠŸèƒ½ï¼ˆåŸºäº SLF4J æ—¥å¿—æ¡†æ¶ï¼‰ï¼Œæœ€åæŠŠè‡ªå®šä¹‰çš„Â <code>logPromptTool</code>Â æ³¨å†Œåˆ°æœåŠ¡å™¨ä¸Šã€‚</p>
<h3 data-id="heading-6">4.3 MCP å®¢æˆ·ç«¯å®ç°</h3>
<p>ä¸‹é¢å†å®šä¹‰ä¸€ä¸ªç®€å•çš„Â <code>McpClient</code>ï¼Œç”¨äºè¿æ¥åˆ°æœåŠ¡ç«¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientApp</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> McpSyncClient <span class="hljs-title function_">getClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ServerParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> ServerParameters
          .builder(<span class="hljs-string">"npx"</span>)
          .args(<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@modelcontextprotocol/server-everything"</span>)
          .build();

        <span class="hljs-type">JacksonMcpJsonMapper</span> <span class="hljs-variable">jsonMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonMcpJsonMapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>());
        <span class="hljs-type">McpClientTransport</span> <span class="hljs-variable">transport</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioClientTransport</span>(params, jsonMapper);

        <span class="hljs-keyword">return</span> io.modelcontextprotocol.client.McpClient.sync(transport)
         .build();

    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">McpSyncClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> getClient();
        client.initialize();
    }
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ MCP æä¾›çš„ç¤ºä¾‹æœåŠ¡ç«¯ï¼Œå¹¶é€šè¿‡Â <code>ServerParameters</code>Â è¿›è¡Œé…ç½®ã€‚å®¢æˆ·ç«¯åŒæ ·é€šè¿‡æ ‡å‡†è¾“å…¥/è¾“å‡ºæµä»¥åŠ JSON æ¶ˆæ¯æ ¼å¼ä¸æœåŠ¡ç«¯è¿›è¡ŒåŒæ­¥é€šä¿¡ã€‚</p>
<h2 data-id="heading-7">5. æµ‹è¯•</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å…·å¤‡äº†æµ‹è¯• MCP äº¤äº’å’Œæ ¸å¿ƒæ¦‚å¿µæ‰€éœ€çš„å…¨éƒ¨ç»„ä»¶ã€‚</p>
<h3 data-id="heading-8">5.1 æµ‹è¯• MCP å·¥å…·ä¸å®¢æˆ·ç«¯å®ç°</h3>
<p>æˆ‘ä»¬å…ˆä»æµ‹è¯•Â <code>LoggingTool</code>Â å¼€å§‹ï¼ŒéªŒè¯å…¶è¾“å‡ºæ˜¯å¦æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
void whenLogPromptToolCalled_thenReturnsResult() {
    McpSchema<span class="hljs-selector-class">.CallToolRequest</span> request = new McpSchema<span class="hljs-selector-class">.CallToolRequest</span>("",
        Map.of("prompt", "Unit test message"));

    McpServerFeatures<span class="hljs-selector-class">.SyncToolSpecification</span> toolSpec = LoggingTool<span class="hljs-selector-class">.logPromptTool</span>();
    McpSchema<span class="hljs-selector-class">.CallToolResult</span> result 
        = toolSpec<span class="hljs-selector-class">.callHandler</span>()<span class="hljs-selector-class">.apply</span>(null, request);
    <span class="hljs-built_in">assertNotNull</span>(result);
    <span class="hljs-built_in">assertFalse</span>(result.isError());
    <span class="hljs-built_in">assertEquals</span>(
        "Input Prompt: Unit test message",((McpSchema.TextContent) (result.content()
        <span class="hljs-selector-class">.getFirst</span>()))
        <span class="hljs-selector-class">.text</span>());
}
</code></pre>
<p>åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰Â <code>prompt</code>Â çš„Â <code>CallToolRequest</code>ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™Â <code>LoggingTool</code>Â çš„Â <code>SyncToolSpecification</code>ã€‚éšåï¼Œæˆ‘ä»¬æ–­è¨€è¿”å›ç»“æœéç©ºã€æ— é”™è¯¯ï¼Œå¹¶ä¸”è¿”å›çš„æ–‡æœ¬å†…å®¹ä¸é¢„æœŸç›¸åŒã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†é€šè¿‡ MCP æä¾›çš„ç¤ºä¾‹æœåŠ¡ç«¯æ¥æµ‹è¯•Â <code>McpClient</code>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
void whenCalledViaClient_thenReturnsLoggedResult() {
    McpSchema<span class="hljs-selector-class">.CallToolRequest</span> request = new McpSchema<span class="hljs-selector-class">.CallToolRequest</span>(
        "echo", Map.of("message", "Client-server test message"));
    McpSchema<span class="hljs-selector-class">.CallToolResult</span> result = client<span class="hljs-selector-class">.callTool</span>(request);

    <span class="hljs-built_in">assertNotNull</span>(result);
    <span class="hljs-built_in">assertNull</span>(result.isError());
    <span class="hljs-built_in">assertEquals</span>("Echo: Client-server test message",
        ((McpSchema.TextContent) (result.content()
        <span class="hljs-selector-class">.getFirst</span>()))<span class="hljs-selector-class">.text</span>());
}
</code></pre>
<p>MCP ç¤ºä¾‹æœåŠ¡ç«¯æš´éœ²äº†ä¸€ä¸ªåä¸ºÂ <code>echo</code>Â çš„å·¥å…·ï¼Œå®ƒä¼šæŠŠè¾“å…¥æ¶ˆæ¯åŸæ ·è¿”å›ï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹å‰å®ç°çš„Â <code>LoggingTool</code>Â çš„è¡Œä¸ºç±»ä¼¼ã€‚</p>
<h3 data-id="heading-9">5.2 æµ‹è¯•æœ¬åœ°æœåŠ¡ç«¯</h3>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥æµ‹è¯•è‡ªå·±ç¼–å†™çš„æœ¬åœ°æœåŠ¡ç«¯ã€‚ä¸ºæ­¤éœ€è¦å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„Â <code>McpClient</code>ï¼Œå¹¶ä½¿ç”¨æŒ‡å‘æœ¬åœ° JAR çš„ä¸åŒæœåŠ¡ç«¯å‚æ•°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">public class McpClientApp2 {

    private static final Logger <span class="hljs-attr">log</span> = LoggerFactory.getLogger(McpClientApp2.class)<span class="hljs-comment">;</span>

    public static void main(String<span class="hljs-section">[]</span> args) {
        String <span class="hljs-attr">jarPath</span> = new java.io.File(<span class="hljs-string">"java-mcp/target/java-mcp-1.0.0-SNAPSHOT.jar"</span>)
                             .getAbsolutePath()<span class="hljs-comment">;</span>
        ServerParameters <span class="hljs-attr">params</span> = ServerParameters.builder(<span class="hljs-string">"java"</span>)
            .args("-jar", jarPath)
            .build()<span class="hljs-comment">;</span>

        JacksonMcpJsonMapper <span class="hljs-attr">jsonMapper</span> = new JacksonMcpJsonMapper(new ObjectMapper())<span class="hljs-comment">;</span>
        McpClientTransport <span class="hljs-attr">transport</span> = new StdioClientTransport(params, jsonMapper)<span class="hljs-comment">;</span>

        McpSyncClient <span class="hljs-attr">client</span> = McpClient.sync(transport)
            .build()<span class="hljs-comment">;</span>

        client.initialize()<span class="hljs-comment">;</span>

        ListToolsResult <span class="hljs-attr">tools</span> = client.listTools()<span class="hljs-comment">;</span>
        McpClientApp2.log.info("Tools exposed by the server:")<span class="hljs-comment">;</span>
        tools
          .tools()
          .forEach(tool -&gt; System.out.println(" - " + tool.name()))<span class="hljs-comment">;</span>

        McpClientApp2.log.info("\nCalling 'logPrompt' tool...")<span class="hljs-comment">;</span>
        CallToolResult <span class="hljs-attr">result</span> = client.callTool(
          new CallToolRequest("logPrompt", Map.of("prompt", "Hello from MCP client!")))<span class="hljs-comment">;</span>
        McpClientApp2.log.info("Result: " + result.content())<span class="hljs-comment">;</span>

        client.closeGracefully()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>è¿è¡Œè¯¥å®¢æˆ·ç«¯åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æ¥éªŒè¯å®ƒæ˜¯å¦æˆåŠŸè¿æ¥åˆ°äº†æœ¬åœ° JAR ä¸­å®šä¹‰çš„æœåŠ¡ç«¯ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">27.879</span> [boundedElastic<span class="hljs-number">-1</span>] INFO  i.m.c.transport.StdioClientTransport - MCP <span class="hljs-built_in">server</span> starting.
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">27.920</span> [boundedElastic<span class="hljs-number">-1</span>] INFO  i.m.c.transport.StdioClientTransport - MCP <span class="hljs-built_in">server</span> started
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.517</span> [pool<span class="hljs-number">-4</span>-thread<span class="hljs-number">-1</span>] INFO  i.m.c.transport.StdioClientTransport - STDERR Message received: <span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.504</span> [pool<span class="hljs-number">-1</span>-thread<span class="hljs-number">-1</span>] INFO  i.m.<span class="hljs-built_in">server</span>.McpAsyncServer - Client initialize <span class="hljs-built_in">request</span> - Protocol: <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span>, Capabilities: ClientCapabilities[experimental=<span class="hljs-literal">null</span>, roots=<span class="hljs-literal">null</span>, sampling=<span class="hljs-literal">null</span>, elicitation=<span class="hljs-literal">null</span>], Info: Implementation[name=Java SDK MCP Client, title=<span class="hljs-literal">null</span>, version=<span class="hljs-number">0.15</span><span class="hljs-number">.0</span>]
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.575</span> [pool<span class="hljs-number">-1</span>-thread<span class="hljs-number">-1</span>] INFO  i.m.client.LifecycleInitializer - <span class="hljs-built_in">Server</span> <span class="hljs-built_in">response</span> <span class="hljs-keyword">with</span> Protocol: <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span>, Capabilities: ServerCapabilities[completions=<span class="hljs-literal">null</span>, experimental=<span class="hljs-literal">null</span>, logging=LoggingCapabilities[], prompts=<span class="hljs-literal">null</span>, resources=<span class="hljs-literal">null</span>, tools=ToolCapabilities[listChanged=<span class="hljs-literal">true</span>]], Info: Implementation[name=baeldung-demo-<span class="hljs-built_in">server</span>, title=<span class="hljs-literal">null</span>, version=<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>] <span class="hljs-keyword">and</span> Instructions <span class="hljs-literal">null</span>
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.626</span> [main] INFO  mcp.McpClientApp2 - Tools exposed by the <span class="hljs-built_in">server</span>:
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.626</span> [main] INFO  mcp.McpClientApp2 - 
Calling <span class="hljs-comment">'logPrompt' tool...</span>
 - logPrompt
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.671</span> [main] INFO  mcp.McpClientApp2 - Result: [TextContent[annotations=<span class="hljs-literal">null</span>, text=Input Prompt: Hello from MCP client!, meta=<span class="hljs-literal">null</span>]]
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.784</span> [ForkJoinPool.commonPool-worker<span class="hljs-number">-1</span>] WARN  i.m.c.transport.StdioClientTransport - Process terminated <span class="hljs-keyword">with</span> code <span class="hljs-number">143</span>

Process finished <span class="hljs-keyword">with</span> <span class="hljs-keyword">exit</span> code <span class="hljs-number">0</span>
</code></pre>
<p>ä»æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆÂ <code>McpServer</code>Â å¯åŠ¨æˆåŠŸï¼Œéšåå®¢æˆ·ç«¯å®Œæˆåˆå§‹åŒ–å¹¶ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€‚æ¥ç€å®¢æˆ·ç«¯è¯·æ±‚åˆ—å‡ºæœåŠ¡ç«¯æš´éœ²çš„å·¥å…·ï¼Œæœ€ååœ¨è°ƒç”¨Â <code>logPrompt</code>Â å·¥å…·ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†æ¥è‡ªæœåŠ¡ç«¯çš„è¿”å›ç»“æœã€‚</p>
<h2 data-id="heading-10">6. æ€»ç»“</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå›é¡¾äº† MCP åŠå…¶ Java SDK çš„æ•´ä½“æ¶æ„ï¼Œé‡ç‚¹ä»‹ç»äº†Â <code>McpServer</code>ã€<code>McpClient</code>Â å’ŒÂ <code>McpHost</code>Â ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠç”±Â <code>McpTransport</code>Â è´Ÿè´£çš„ä¼ è¾“å±‚ç»†èŠ‚ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬äº†è§£äº† MCP ä¸­çš„å„ç§åŸè¯­ï¼ˆprimitivesï¼‰ï¼Œä»¥åŠåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¾§åˆ†åˆ«å¯ç”¨çš„ç±»å‹å’Œèƒ½åŠ›ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„ MCP å·¥å…·ï¼Œå¹¶é€šè¿‡ MCP ç¤ºä¾‹æœåŠ¡ç«¯å’Œæœ¬åœ°è‡ªå»ºæœåŠ¡ç«¯ï¼ŒéªŒè¯äº†Â <code>McpClient</code>Â çš„è¿æ¥ä¸è°ƒç”¨æµç¨‹ã€‚å€ŸåŠ© MCP æ ‡å‡†å’Œ Java SDKï¼Œä½ å¯ä»¥æ›´æ–¹ä¾¿åœ°æŠŠç°æœ‰ç³»ç»Ÿèƒ½åŠ›ä»¥ç»Ÿä¸€çš„æ–¹å¼æš´éœ²ç»™ AI åº”ç”¨ï¼Œä¹Ÿèƒ½åœ¨ä¸åŒé¡¹ç›®ä¹‹é—´å¤ç”¨è¿™å¥—é›†æˆæ¨¡å¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Appiumå®ç°Androidåº”ç”¨æ•°æ®çˆ¬å–ï¼šä»ç¯å¢ƒæ­å»ºåˆ°å®æˆ˜ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7584443518162255908</link>    <guid>https://juejin.cn/post/7584443518162255908</guid>    <pubDate>2025-12-17T06:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518162255908" data-draft-id="7584358227612221482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Appiumå®ç°Androidåº”ç”¨æ•°æ®çˆ¬å–ï¼šä»ç¯å¢ƒæ­å»ºåˆ°å®æˆ˜ä¼˜åŒ–"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-17T06:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«™å¤§çˆ·IP"/> <meta itemprop="url" content="https://juejin.cn/user/2905353241759261"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Appiumå®ç°Androidåº”ç”¨æ•°æ®çˆ¬å–ï¼šä»ç¯å¢ƒæ­å»ºåˆ°å®æˆ˜ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2905353241759261/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«™å¤§çˆ·IP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:56:58.000Z" title="Wed Dec 17 2025 06:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼ŒAndroidåº”ç”¨æ•°æ®çˆ¬å–å·²æˆä¸ºç”µå•†æ¯”ä»·ã€èˆ†æƒ…ç›‘æµ‹ã€é‡‘èé£æ§ç­‰åœºæ™¯çš„æ ¸å¿ƒéœ€æ±‚ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçˆ¬è™«å·¥å…·åœ¨åº”å¯¹åŠ¨æ€åŠ å¯†å‚æ•°ã€åçˆ¬ç­–ç•¥æ—¶å¾€å¾€åŠ›ä¸ä»å¿ƒã€‚Appiumä½œä¸ºè·¨å¹³å°è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œå‡­å€Ÿå…¶éä¾µå…¥å¼æ“ä½œå’Œçµæ´»çš„å…ƒç´ å®šä½èƒ½åŠ›ï¼Œæˆä¸ºç§»åŠ¨ç«¯æ•°æ®çˆ¬å–çš„åˆ©å™¨ã€‚æœ¬æ–‡å°†ä»¥å®æˆ˜æ¡ˆä¾‹ä¸ºä¸»çº¿ï¼Œæ‹†è§£Appiumçˆ¬å–Androidåº”ç”¨çš„å…¨æµç¨‹ï¼Œå¹¶æä¾›å¯è½åœ°çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç¯å¢ƒæ­å»ºï¼šå››æ­¥æ„å»ºçˆ¬å–åŸºç¡€</h2>
<h3 data-id="heading-1">1. æ ¸å¿ƒç»„ä»¶å®‰è£…</h3>
<ul>
<li><strong>Appium Desktop</strong>ï¼šé€‰æ‹©v1.13.0ç¨³å®šç‰ˆï¼Œé¿å…æ–°ç‰ˆå…¼å®¹æ€§é—®é¢˜ã€‚å®‰è£…åé…ç½®<code>ANDROID_HOME</code>å’Œ<code>JAVA_HOME</code>è·¯å¾„ï¼Œç¡®ä¿èƒ½è¯†åˆ«Android SDKå’ŒJavaç¯å¢ƒã€‚</li>
<li><strong>Android SDK</strong>ï¼šé€šè¿‡Android Studioå®‰è£…ï¼Œé‡ç‚¹é…ç½®<code>platform-tools</code>å’Œ<code>tools</code>ç›®å½•åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚éªŒè¯å‘½ä»¤<code>adb devices</code>åº”æ˜¾ç¤ºå·²è¿æ¥è®¾å¤‡ã€‚</li>
<li><strong>Pythonä¾èµ–</strong>ï¼šä½¿ç”¨<code>pip install Appium-Python-Client</code>å®‰è£…å®¢æˆ·ç«¯åº“ï¼Œå»ºè®®Pythonç‰ˆæœ¬â‰¥3.7ä»¥å…¼å®¹æœ€æ–°åè®®ã€‚</li>
</ul>
<h3 data-id="heading-2">2. æ¨¡æ‹Ÿå™¨é€‰æ‹©ä¸é…ç½®</h3>
<p>ä»¥å¤œç¥æ¨¡æ‹Ÿå™¨ä¸ºä¾‹ï¼š</p>
<ul>
<li>å®‰è£…åè¿›å…¥å¼€å‘è€…æ¨¡å¼ï¼šè¿ç»­ç‚¹å‡»â€œè®¾ç½®â†’å…³äºå¹³æ¿ç”µè„‘â†’ç‰ˆæœ¬å·â€7æ¬¡ã€‚</li>
<li>å¼€å¯USBè°ƒè¯•ï¼šåœ¨â€œå¼€å‘è€…é€‰é¡¹â€ä¸­å‹¾é€‰â€œUSBè°ƒè¯•â€å’Œâ€œæ¨¡æ‹Ÿä½ç½®â€ã€‚</li>
<li>è§£å†³ADBç‰ˆæœ¬å†²çªï¼šè‹¥å‡ºç°<code>adb server version doesn't match</code>é”™è¯¯ï¼Œæ›¿æ¢æ¨¡æ‹Ÿå™¨ç›®å½•ä¸‹çš„<code>nox_adb.exe</code>ä¸ºAndroid SDKä¸­çš„åŒåæ–‡ä»¶ã€‚</li>
</ul>
<h3 data-id="heading-3">3. å…³é”®å‚æ•°è·å–</h3>
<p>é€šè¿‡ADBå‘½ä»¤å®šä½ç›®æ ‡åº”ç”¨çš„åŒ…åå’Œå…¥å£Activityï¼š</p>
<pre><code class="hljs language-shell" lang="shell">adb shell dumpsys window windows | findstr mFocusedApp
<span class="hljs-meta prompt_"># </span><span class="bash">è¾“å‡ºç¤ºä¾‹ï¼šmFocusedApp=AppWindowToken{... com.example.app/.MainActivity}</span>
<span class="hljs-meta prompt_"># </span><span class="bash">åŒ…åï¼šcom.example.app</span>
<span class="hljs-meta prompt_"># </span><span class="bash">å…¥å£Activityï¼š.MainActivity</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h2 data-id="heading-4">äºŒã€åŸºç¡€çˆ¬å–ï¼šä»å¯åŠ¨åˆ°å…ƒç´ å®šä½</h2>
<h3 data-id="heading-5">1. åˆå§‹åŒ–Appiumä¼šè¯</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> appium <span class="hljs-keyword">import</span> webdriver

desired_caps = {
    <span class="hljs-string">"platformName"</span>: <span class="hljs-string">"Android"</span>,
    <span class="hljs-string">"platformVersion"</span>: <span class="hljs-string">"11.0"</span>,
    <span class="hljs-string">"deviceName"</span>: <span class="hljs-string">"127.0.0.1:62001"</span>,  <span class="hljs-comment"># å¤œç¥æ¨¡æ‹Ÿå™¨é»˜è®¤ç«¯å£</span>
    <span class="hljs-string">"appPackage"</span>: <span class="hljs-string">"com.example.app"</span>,
    <span class="hljs-string">"appActivity"</span>: <span class="hljs-string">".MainActivity"</span>,
    <span class="hljs-string">"noReset"</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># ä¿ç•™åº”ç”¨çŠ¶æ€</span>
    <span class="hljs-string">"unicodeKeyboard"</span>: <span class="hljs-literal">True</span>  <span class="hljs-comment"># æ”¯æŒä¸­æ–‡è¾“å…¥</span>
}

driver = webdriver.Remote(<span class="hljs-string">"http://localhost:4723/wd/hub"</span>, desired_caps)
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-6">2. å…ƒç´ å®šä½ä¸æ“ä½œ</h3>
<p>Appiumæ”¯æŒå¤šç§å®šä½ç­–ç•¥ï¼Œæ¨èç»„åˆä½¿ç”¨ä»¥æé«˜ç¨³å®šæ€§ï¼š</p>
<ul>
<li>
<p><strong>IDå®šä½</strong>ï¼šé€‚ç”¨äºå”¯ä¸€æ ‡è¯†å…ƒç´ ï¼Œå¦‚ç™»å½•æŒ‰é’®ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">driver<span class="hljs-selector-class">.find_element_by_id</span>("com.example.app:id/btn_login")<span class="hljs-selector-class">.click</span>()
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
<li>
<p><strong>XPathå®šä½</strong>ï¼šå¤„ç†åŠ¨æ€å…ƒç´ æ—¶æ›´çµæ´»ï¼Œå¦‚å•†å“åˆ—è¡¨é¡¹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å®šä½ç¬¬3ä¸ªå•†å“çš„ä»·æ ¼</span>
<span class="hljs-attr">price</span> = driver.find_element_by_xpath(<span class="hljs-string">"//androidx.recyclerview.widget.RecyclerView/android.view.ViewGroup[3]/android.widget.TextView[2]"</span>).text
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
<li>
<p><strong>æ»šåŠ¨æ“ä½œ</strong>ï¼šæ¨¡æ‹Ÿç”¨æˆ·æ»‘åŠ¨å±å¹•åŠ è½½æ›´å¤šæ•°æ®ã€‚</p>
<pre><code class="hljs language-css" lang="css"># å‘ä¸‹æ»‘åŠ¨ï¼ˆåæ ‡åŸºäºå±å¹•åˆ†è¾¨ç‡ï¼‰
<span class="hljs-attribute">width</span> = driver<span class="hljs-selector-class">.get_window_size</span>()<span class="hljs-selector-attr">[<span class="hljs-string">"width"</span>]</span>
<span class="hljs-attribute">height</span> = driver<span class="hljs-selector-class">.get_window_size</span>()<span class="hljs-selector-attr">[<span class="hljs-string">"height"</span>]</span>
driver<span class="hljs-selector-class">.swipe</span>(<span class="hljs-attribute">width</span>*<span class="hljs-number">0.5</span>, <span class="hljs-attribute">height</span>*<span class="hljs-number">0.7</span>, <span class="hljs-attribute">width</span>*<span class="hljs-number">0.5</span>, <span class="hljs-attribute">height</span>*<span class="hljs-number">0.3</span>, <span class="hljs-number">500</span>)  # <span class="hljs-number">500ms</span>æ»‘åŠ¨æ—¶é•¿
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-7">ä¸‰ã€åçˆ¬åº”å¯¹ï¼šä»IPå°ç¦åˆ°å‚æ•°ç ´è§£</h2>
<h3 data-id="heading-8">1. IPå°ç¦è§£å†³æ–¹æ¡ˆ</h3>
<ul>
<li>
<p><strong>ä»£ç†æ± è½®æ¢</strong>ï¼šé›†æˆç«™å¤§çˆ·éš§é“ä»£ç†ï¼Œå®ç°æ¯è¯·æ±‚æ›´æ¢IPã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> <span class="hljs-type">requests</span>
<span class="hljs-variable">proxies</span> <span class="hljs-operator">=</span> {
    <span class="hljs-string">"http"</span>: <span class="hljs-string">"http://user:pass@proxy_ip:port"</span>,
    <span class="hljs-string">"https"</span>: <span class="hljs-string">"https://user:pass@proxy_ip:port"</span>
}
response = requests.get(<span class="hljs-string">"https://target-site.com"</span>, proxies=proxies)
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
<li>
<p><strong>é™ä½è¯·æ±‚é¢‘ç‡</strong>ï¼šé€šè¿‡éšæœºå»¶è¿Ÿæ¨¡æ‹Ÿäººç±»æ“ä½œã€‚</p>
<pre><code class="hljs language-lua" lang="lua">import <span class="hljs-built_in">time</span>
import <span class="hljs-built_in">random</span>

def random_delay(min_sec=<span class="hljs-number">1</span>, max_sec=<span class="hljs-number">3</span>):
    <span class="hljs-built_in">time</span>.sleep(<span class="hljs-built_in">random</span>.uniform(min_sec, max_sec))
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-9">2. åŠ å¯†å‚æ•°ç ´è§£</h3>
<ul>
<li>
<p><strong>åŠ¨æ€è°ƒè¯•åˆ†æ</strong>ï¼šä½¿ç”¨JADXåç¼–è¯‘APKï¼Œå®šä½åŠ å¯†é€»è¾‘ã€‚ä¾‹å¦‚æŸç”µå•†APPçš„ç­¾åå‚æ•°ç”Ÿæˆï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åç¼–è¯‘åå‘ç°çš„ç­¾åç®—æ³•</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">generateSign</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> params</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">MD5Utils</span>.<span class="hljs-title function_">md5</span>(params + <span class="hljs-string">"salt_value"</span>);
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
<li>
<p><strong>Hookæ³¨å…¥</strong>ï¼šé€šè¿‡Xposedæ¡†æ¶ä¿®æ”¹åŠ å¯†é€»è¾‘ï¼ˆéœ€Rootè®¾å¤‡ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Xposedæ¨¡å—ç¤ºä¾‹ï¼šç»•è¿‡SSLè¯ä¹¦æ ¡éªŒ</span>
XposedHelpers.findAndHookMethod(SSLContext.class, <span class="hljs-string">"init"</span>, <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">XC_MethodHook</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterHookedMethod</span><span class="hljs-params">(MethodHookParam param)</span> <span class="hljs-keyword">throws</span> Throwable {
        param.setResult(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å¼ºåˆ¶è¿”å›ç©ºï¼Œè·³è¿‡æ ¡éªŒ</span>
    }
});
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-10">å››ã€å®æˆ˜æ¡ˆä¾‹ï¼šçˆ¬å–æŸç”µå•†APPå•†å“æ•°æ®</h2>
<h3 data-id="heading-11">1. ç›®æ ‡åˆ†æ</h3>
<ul>
<li><strong>æ•°æ®å­—æ®µ</strong>ï¼šå•†å“åç§°ã€ä»·æ ¼ã€é”€é‡ã€è¯„è®ºæ•°ã€‚</li>
<li><strong>åçˆ¬æœºåˆ¶</strong>ï¼šIPé¢‘ç‡é™åˆ¶ã€ç­¾åå‚æ•°ã€WebViewåŠ å¯†ã€‚</li>
</ul>
<h3 data-id="heading-12">2. çˆ¬å–æµç¨‹</h3>
<ol>
<li>
<p><strong>åˆå§‹åŒ–ä¼šè¯</strong>ï¼šé…ç½®ä»£ç†å’Œè®¾å¤‡å‚æ•°ã€‚</p>
</li>
<li>
<p><strong>è¿›å…¥æœç´¢é¡µ</strong>ï¼šè¾“å…¥å…³é”®è¯å¹¶ç‚¹å‡»æœç´¢ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">driver<span class="hljs-selector-class">.find_element_by_id</span>("com.example.app:id/et_search")<span class="hljs-selector-class">.send_keys</span>("æ‰‹æœº")
driver<span class="hljs-selector-class">.find_element_by_id</span>("com.example.app:id/btn_search")<span class="hljs-selector-class">.click</span>()
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
<li>
<p><strong>æ»šåŠ¨åŠ è½½å•†å“</strong>ï¼šå¾ªç¯æ»‘åŠ¨å±å¹•ç›´è‡³åŠ è½½å®Œå…¨éƒ¨å•†å“ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">items</span> = []
for _ in range(5): <span class="hljs-comment"># å‡è®¾åŠ è½½5é¡µ</span>
    <span class="hljs-comment"># æå–å½“å‰é¡µå•†å“ä¿¡æ¯</span>
    <span class="hljs-attr">products</span> =     driver.find_elements_by_xpath(<span class="hljs-string">"//androidx.recyclerview.widget.RecyclerView/android.view.ViewGroup"</span>)
        for product in products:
            <span class="hljs-attr">name</span> = product.find_element_by_id(<span class="hljs-string">"com.example.app:id/tv_name"</span>).text
            <span class="hljs-attr">price</span> = product.find_element_by_id(<span class="hljs-string">"com.example.app:id/tv_price"</span>).text
            items.append({"name": name, "price": price})
            <span class="hljs-comment"># æ»‘åŠ¨åˆ°ä¸‹ä¸€é¡µ</span>
    random_delay()
    driver.swipe(width0.5, height0.7, width0.5, height0.3, 800)
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>4. æ•°æ®å­˜å‚¨ï¼š</strong> ä¿å­˜ä¸ºCSVæ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">import pandas as pd
<span class="hljs-attr">df</span> = pd.DataFrame(items)
df.to_csv("products.csv", <span class="hljs-attr">index</span>=<span class="hljs-literal">False</span>)
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-13">äº”ã€æ€§èƒ½ä¼˜åŒ–ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼</h2>
<h3 data-id="heading-14">1. å¤šè®¾å¤‡å¹¶è¡Œçˆ¬å–</h3>
<p>ä½¿ç”¨Pythonçš„<code>multiprocessing</code>æ¨¡å—å¯åŠ¨å¤šä¸ªAppiumä¼šè¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">from multiprocessing import Process

def run_on_device(device_name):
    desired_caps<span class="hljs-section">["deviceName"]</span> = device_name
    <span class="hljs-attr">driver</span> = webdriver.Remote(<span class="hljs-string">"http://localhost:4723/wd/hub"</span>, desired_caps)
    <span class="hljs-comment"># æ‰§è¡Œçˆ¬å–é€»è¾‘</span>
    driver.quit()

if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-attr">devices</span> = [<span class="hljs-string">"127.0.0.1:62001"</span>, <span class="hljs-string">"127.0.0.1:62025"</span>]  <span class="hljs-comment"># ä¸¤ä¸ªæ¨¡æ‹Ÿå™¨ç«¯å£</span>
    for device in devices:
        <span class="hljs-attr">p</span> = Process(target=run_on_device, args=(device,))
        p.start()
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-15">2. åˆ†å¸ƒå¼çˆ¬å–æ¶æ„</h3>
<ul>
<li><strong>ä¸»èŠ‚ç‚¹</strong>ï¼šåˆ†å‘ä»»åŠ¡å¹¶åˆå¹¶æ•°æ®ã€‚</li>
<li><strong>å·¥ä½œèŠ‚ç‚¹</strong>ï¼šè¿è¡ŒAppiumå®ä¾‹æ‰§è¡Œå…·ä½“çˆ¬å–ã€‚</li>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šä½¿ç”¨RabbitMQæˆ–Kafkaä¼ é€’ä»»åŠ¡å’Œç»“æœã€‚</li>
</ul>
<h2 data-id="heading-16">å…­ã€å¸¸è§é—®é¢˜Q&amp;A</h2>
<p><strong>Q1ï¼šè¢«ç½‘ç«™å°IPæ€ä¹ˆåŠï¼Ÿ</strong><br/>
Aï¼šç«‹å³å¯ç”¨å¤‡ç”¨ä»£ç†æ± ï¼Œå»ºè®®ä½¿ç”¨ä½å®…ä»£ç†ï¼ˆå¦‚ç«™å¤§çˆ·IPä»£ç†ï¼‰ï¼Œé…åˆæ¯è¯·æ±‚æ›´æ¢IPç­–ç•¥ã€‚åŒæ—¶é™ä½è¯·æ±‚é¢‘ç‡ï¼Œå¢åŠ éšæœºå»¶è¿Ÿã€‚</p>
<p><strong>Q2ï¼šAppiumæ— æ³•å®šä½å…ƒç´ æ€ä¹ˆåŠï¼Ÿ</strong><br/>
Aï¼šä¼˜å…ˆæ£€æŸ¥å…ƒç´ å®šä½ç­–ç•¥æ˜¯å¦æ­£ç¡®ã€‚è‹¥ä»å¤±è´¥ï¼Œä½¿ç”¨<code>uiautomatorviewer</code>å·¥å…·æŸ¥çœ‹å…ƒç´ å±æ€§ï¼Œæˆ–é€šè¿‡XPathçš„<code>contains()</code>å‡½æ•°æ¨¡ç³ŠåŒ¹é…ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">driver.find_element_by_xpath(<span class="hljs-string">"//*[contains(@text, 'ç™»å½•')]"</span>).click()
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>Q3ï¼šå¦‚ä½•å¤„ç†WebViewå†…å®¹ï¼Ÿ</strong><br/>
Aï¼šåˆ‡æ¢åˆ°WebViewä¸Šä¸‹æ–‡ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">contexts</span> = driver.contexts
driver.switch_to.context(contexts<span class="hljs-section">[-1]</span>)  <span class="hljs-comment"># åˆ‡æ¢åˆ°æœ€åä¸€ä¸ªWebView</span>
<span class="hljs-comment"># æ“ä½œWebViewå†…çš„å…ƒç´ ï¼ˆéœ€ä½¿ç”¨Seleniumè¯­æ³•ï¼‰</span>
driver.find_element_by_css_selector(".btn-submit").click()
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>Q4ï¼šæ¨¡æ‹Ÿå™¨æ€§èƒ½ä¸è¶³å¯¼è‡´çˆ¬å–ç¼“æ…¢ï¼Ÿ</strong><br/>
Aï¼šä¼˜åŒ–æ¨¡æ‹Ÿå™¨é…ç½®ï¼š</p>
<ul>
<li>åˆ†é…æ›´å¤šCPUå’Œå†…å­˜ï¼ˆå¤œç¥æ¨¡æ‹Ÿå™¨è®¾ç½®ä¸­è°ƒæ•´ï¼‰ã€‚</li>
<li>å¯ç”¨OpenGLç¡¬ä»¶åŠ é€Ÿã€‚</li>
<li>ä½¿ç”¨çœŸæœºæµ‹è¯•ï¼ˆéœ€å¼€å¯USBè°ƒè¯•å’Œæˆæƒï¼‰ã€‚</li>
</ul>
<p><strong>Q5ï¼šå¦‚ä½•ç»•è¿‡APPçš„SSLè¯ä¹¦æ ¡éªŒï¼Ÿ</strong><br/>
Aï¼šæ–¹æ³•ä¸€ï¼šä½¿ç”¨Xposedæ¡†æ¶å®‰è£…<code>JustTrustMe</code>æ¨¡å—ã€‚<br/>
æ–¹æ³•äºŒï¼šé€šè¿‡Appiumçš„<code>capabilities</code>ç¦ç”¨è¯ä¹¦éªŒè¯ï¼ˆéœ€Rootï¼‰ï¼š</p>
<pre><code class="hljs language-css" lang="css">desired_caps<span class="hljs-selector-attr">[<span class="hljs-string">"skipDeviceInitialization"</span>]</span> = True
desired_caps<span class="hljs-selector-attr">[<span class="hljs-string">"skipServerInstallation"</span>]</span> = True
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h2 data-id="heading-17">ç»“è¯­</h2>
<p>Appiumçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶éä¾µå…¥å¼æ“ä½œå’Œè·¨å¹³å°èƒ½åŠ›ï¼Œä½†çœŸæ­£å‘æŒ¥å…¶ä»·å€¼éœ€ç»“åˆåçˆ¬ç­–ç•¥åˆ†æã€æ€§èƒ½ä¼˜åŒ–å’Œåˆ†å¸ƒå¼æ¶æ„ã€‚é€šè¿‡æœ¬æ–‡çš„å®æˆ˜æ¡ˆä¾‹å’Œä¼˜åŒ–æ–¹æ¡ˆï¼Œè¯»è€…å¯å¿«é€Ÿæ„å»ºç¨³å®šé«˜æ•ˆçš„Androidåº”ç”¨çˆ¬å–ç³»ç»Ÿã€‚æœªæ¥ï¼Œéšç€AIæŠ€æœ¯çš„èå…¥ï¼ŒAppiumæœ‰æœ›å®ç°è‡ªåŠ¨åŒ–åçˆ¬ç­–ç•¥è¯†åˆ«å’ŒåŠ¨æ€å‚æ•°ç”Ÿæˆï¼Œè¿›ä¸€æ­¥é™ä½äººå·¥å¹²é¢„æˆæœ¬ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI é©±åŠ¨çš„å¼‚æ„ ETL ç¯å¢ƒæ•°æ®è¡€ç¼˜ç®¡ç†ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7584379805900013620</link>    <guid>https://juejin.cn/post/7584379805900013620</guid>    <pubDate>2025-12-17T07:52:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805900013620" data-draft-id="7584377629707255843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI é©±åŠ¨çš„å¼‚æ„ ETL ç¯å¢ƒæ•°æ®è¡€ç¼˜ç®¡ç†ç³»ç»Ÿ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-17T07:52:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å—æ–¹è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2840793779295133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI é©±åŠ¨çš„å¼‚æ„ ETL ç¯å¢ƒæ•°æ®è¡€ç¼˜ç®¡ç†ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793779295133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å—æ–¹è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:52:47.000Z" title="Wed Dec 17 2025 07:52:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ“– ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-1">1.1 æ•´ä½“æ¶æ„æ¦‚è¿°</h3>
<p>è¯¥ç³»ç»Ÿæ˜¯é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡ AI æŠ€æœ¯è‡ªåŠ¨å‘ç°å’Œè¿½è¸ªæ•°æ®åœ¨å¼‚æ„ETLç¯å¢ƒä¸­çš„è¡€ç¼˜å…³ç³»ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb44e80378b4d90855344b496e1e5d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=htz13FOREdVAgmRQVLz8E02k9bs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">ğŸ“– æ•°æ®è¡€ç¼˜å‘ç°æµç¨‹</h2>
<h3 data-id="heading-3">2.1 è‡ªåŠ¨åŒ–è¡€ç¼˜å‘ç°æµç¨‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/997a9554884148e79490b83b0cbbc1b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=7YRMiDTLj7XwAzY53wnHfT8LWdk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.2 SQL è§£æä¸è¡€ç¼˜æå–</h3>
<p><strong>åŸºäº AI çš„</strong> <strong>SQL</strong> <strong>è§£æå¼•æ“ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AISQLLineageExtractor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.nlp = spacy.load(<span class="hljs-string">"en_core_web_sm"</span>)
        self.classifier = pipeline(<span class="hljs-string">"text-classification"</span>, 
                                   model=<span class="hljs-string">"distilbert-base-uncased"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_lineage_from_sql</span>(<span class="hljs-params">self, sql_query, context=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        ä»SQLæŸ¥è¯¢ä¸­æå–æ•°æ®è¡€ç¼˜å…³ç³»
        """</span>
        <span class="hljs-comment"># è§£æSQLç»“æ„</span>
        parsed = sqlparse.parse(sql_query)[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># ä½¿ç”¨sql_metadataè¿›è¡ŒåŸºç¡€è§£æ</span>
        parser = Parser(sql_query)

        <span class="hljs-comment"># AIå¢å¼ºçš„è¯­ä¹‰åˆ†æ</span>
        ai_insights = self.analyze_sql_semantics(sql_query, context)

        <span class="hljs-comment"># æ„å»ºè¡€ç¼˜å…³ç³»</span>
        lineage_data = {
            <span class="hljs-string">'input_tables'</span>: parser.tables,
            <span class="hljs-string">'input_columns'</span>: parser.columns,
            <span class="hljs-string">'output_columns'</span>: self.extract_output_columns(parsed),
            <span class="hljs-string">'transformations'</span>: self.extract_transformations(parsed, ai_insights),
            <span class="hljs-string">'confidence_score'</span>: ai_insights.get(<span class="hljs-string">'confidence'</span>, <span class="hljs-number">0.8</span>),
            <span class="hljs-string">'parsing_metadata'</span>: {
                <span class="hljs-string">'query_type'</span>: self.classify_query_type(sql_query),
                <span class="hljs-string">'complexity_score'</span>: self.calculate_complexity(sql_query),
                <span class="hljs-string">'ai_analysis'</span>: ai_insights
            }
        }

        <span class="hljs-keyword">return</span> lineage_data

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_sql_semantics</span>(<span class="hljs-params">self, sql_query, context</span>):
        <span class="hljs-string">"""ä½¿ç”¨AIåˆ†æSQLè¯­ä¹‰"""</span>
        <span class="hljs-comment"># æ„å»ºåˆ†ææç¤º</span>
        analysis_prompt = <span class="hljs-string">f"""
        Analyze the following SQL query and extract data lineage information:
        
        SQL: <span class="hljs-subst">{sql_query}</span>
        Context: <span class="hljs-subst">{context}</span>
        
        Please identify:
        1. Source tables and columns
        2. Transformation logic
        3. Target tables and columns
        4. Any data quality operations
        """</span>

        <span class="hljs-comment"># ä½¿ç”¨NLPæ¨¡å‹è¿›è¡Œåˆ†æ</span>
        analysis_result = self.nlp(analysis_prompt)

        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'entities'</span>: [(ent.text, ent.label_) <span class="hljs-keyword">for</span> ent <span class="hljs-keyword">in</span> analysis_result.ents],
            <span class="hljs-string">'dependencies'</span>: self.extract_semantic_dependencies(analysis_result),
            <span class="hljs-string">'confidence'</span>: self.calculate_semantic_confidence(analysis_result)
        }

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
extractor = AISQLLineageExtractor()
sql = <span class="hljs-string">"""
SELECT 
    customer_id,
    SUM(order_amount) as total_spent,
    COUNT(DISTINCT order_id) as order_count
FROM orders 
WHERE order_date &gt;= '2024-01-01'
GROUP BY customer_id
"""</span>

lineage = extractor.extract_lineage_from_sql(sql)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‘ç°çš„è¾“å…¥è¡¨: <span class="hljs-subst">{lineage[<span class="hljs-string">'input_tables'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¾“å‡ºåˆ—: <span class="hljs-subst">{[col[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> lineage[<span class="hljs-string">'output_columns'</span>]]}</span>"</span>)
</code></pre>
<h2 data-id="heading-5">ğŸ“– è¡€ç¼˜å…³ç³»å­˜å‚¨è®¾è®¡</h2>
<h3 data-id="heading-6">3.1 å›¾æ•°æ®åº“ Schema è®¾è®¡</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLineageGraph</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, neptune_client</span>):
        self.client = neptune_client

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_lineage_graph</span>(<span class="hljs-params">self, lineage_data</span>):
        <span class="hljs-string">"""åˆ›å»ºè¡€ç¼˜å…³ç³»å›¾"""</span>

        <span class="hljs-comment"># åˆ›å»ºè¡¨èŠ‚ç‚¹</span>
        table_nodes = {}
        <span class="hljs-keyword">for</span> table <span class="hljs-keyword">in</span> lineage_data[<span class="hljs-string">'input_tables'</span>] + [lineage_data.get(<span class="hljs-string">'output_table'</span>)]:
            <span class="hljs-keyword">if</span> table:
                table_id = self.create_table_node(table)
                table_nodes[table] = table_id

        <span class="hljs-comment"># åˆ›å»ºåˆ—èŠ‚ç‚¹å’Œå…³ç³»</span>
        <span class="hljs-keyword">for</span> col_info <span class="hljs-keyword">in</span> lineage_data.get(<span class="hljs-string">'columns'</span>, []):
            col_id = self.create_column_node(col_info)

            <span class="hljs-comment"># åˆ›å»ºåˆ—åˆ°è¡¨çš„å…³ç³»</span>
            self.client.add_edge(
                col_id, 
                table_nodes[col_info[<span class="hljs-string">'table'</span>]], 
                <span class="hljs-string">'BELONGS_TO'</span>
            )

            <span class="hljs-comment"># åˆ›å»ºè¡€ç¼˜å…³ç³»</span>
            <span class="hljs-keyword">for</span> source_col <span class="hljs-keyword">in</span> col_info.get(<span class="hljs-string">'source_columns'</span>, []):
                source_col_id = self.get_column_id(source_col)
                <span class="hljs-keyword">if</span> source_col_id:
                    self.client.add_edge(
                        source_col_id, 
                        col_id, 
                        <span class="hljs-string">'LINEAGE'</span>, 
                        properties={
                            <span class="hljs-string">'transformation'</span>: col_info.get(<span class="hljs-string">'transformation'</span>),
                            <span class="hljs-string">'confidence'</span>: lineage_data.get(<span class="hljs-string">'confidence_score'</span>, <span class="hljs-number">0.8</span>)
                        }
                    )
</code></pre>
<h3 data-id="heading-7">3.2 è¡€ç¼˜æŸ¥è¯¢ API è®¾è®¡</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LineageAPI</span>(<span class="hljs-title class_ inherited__">Resource</span>):
<span class="hljs-meta">    @api.expect(<span class="hljs-params">lineage_model</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æŸ¥è¯¢æ•°æ®è¡€ç¼˜å…³ç³»"""</span>
        data = request.json

        source_type = data.get(<span class="hljs-string">'source_type'</span>)
        source_name = data.get(<span class="hljs-string">'source_name'</span>) 
        depth = data.get(<span class="hljs-string">'depth'</span>, <span class="hljs-number">3</span>)

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ‰§è¡Œè¡€ç¼˜æŸ¥è¯¢</span>
            <span class="hljs-keyword">if</span> source_type == <span class="hljs-string">'table'</span>:
                result = self.get_table_lineage(source_name, depth)
            <span class="hljs-keyword">elif</span> source_type == <span class="hljs-string">'column'</span>:
                result = self.get_column_lineage(source_name, depth)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'ä¸æ”¯æŒçš„æºç±»å‹'</span>}, <span class="hljs-number">400</span>

            <span class="hljs-keyword">return</span> jsonify({
                <span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>,
                <span class="hljs-string">'data'</span>: result,
                <span class="hljs-string">'query'</span>: {
                    <span class="hljs-string">'source'</span>: source_name,
                    <span class="hljs-string">'depth'</span>: depth,
                    <span class="hljs-string">'timestamp'</span>: datetime.utcnow().isoformat()
                }
            })

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-built_in">str</span>(e)}, <span class="hljs-number">500</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_table_lineage</span>(<span class="hljs-params">self, table_name, depth</span>):
        <span class="hljs-string">"""è·å–è¡¨çº§åˆ«è¡€ç¼˜å…³ç³»"""</span>
        graph = DataLineageGraph(neptune_client)

        <span class="hljs-comment"># è·å–ä¸‹æ¸¸å½±å“</span>
        downstream = graph.query_impact_analysis(table_name)

        <span class="hljs-comment"># è·å–ä¸Šæ¸¸ä¾èµ–</span>
        upstream = graph.query_root_cause(table_name, <span class="hljs-literal">None</span>)

        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'table'</span>: table_name,
            <span class="hljs-string">'downstream_impact'</span>: self.format_paths(downstream),
            <span class="hljs-string">'upstream_dependencies'</span>: self.format_paths(upstream),
            <span class="hljs-string">'summary'</span>: {
                <span class="hljs-string">'total_downstream'</span>: <span class="hljs-built_in">len</span>(downstream),
                <span class="hljs-string">'total_upstream'</span>: <span class="hljs-built_in">len</span>(upstream),
                <span class="hljs-string">'max_depth'</span>: depth
            }
        }
</code></pre>
<h2 data-id="heading-8">ğŸ“– è¡€ç¼˜è´¨é‡è¯„ä¼°æµç¨‹</h2>
<h3 data-id="heading-9">4.1 è´¨é‡è¯„ä¼°æµç¨‹å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23df8c7c44a84b52a38d63eedce6d7b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=o4oLRmIybD5oUy7HCNaWDWP%2FTp0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">4.2 è´¨é‡è¯„ä¼°ç®—æ³•å®ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LineageQualityAssessor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.scaler = StandardScaler()
        self.classifier = RandomForestClassifier(n_estimators=<span class="hljs-number">100</span>)
        self.quality_metrics = []

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">assess_lineage_quality</span>(<span class="hljs-params">self, lineage_data</span>):
        <span class="hljs-string">"""è¯„ä¼°è¡€ç¼˜å…³ç³»è´¨é‡"""</span>

        <span class="hljs-comment"># è®¡ç®—è´¨é‡æŒ‡æ ‡</span>
        metrics = self.calculate_quality_metrics(lineage_data)

        <span class="hljs-comment"># AIè´¨é‡åˆ†ç±»</span>
        quality_score = self.ai_quality_classification(metrics)

        <span class="hljs-comment"># é—®é¢˜æ£€æµ‹</span>
        issues = self.detect_quality_issues(lineage_data, metrics)

        assessment_result = {
            <span class="hljs-string">'overall_score'</span>: quality_score,
            <span class="hljs-string">'quality_level'</span>: self.get_quality_level(quality_score),
            <span class="hljs-string">'metrics'</span>: metrics,
            <span class="hljs-string">'issues'</span>: issues,
            <span class="hljs-string">'recommendations'</span>: self.generate_recommendations(issues, metrics),
            <span class="hljs-string">'confidence'</span>: self.calculate_confidence(metrics, issues)
        }

        <span class="hljs-keyword">return</span> assessment_result

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_quality_metrics</span>(<span class="hljs-params">self, lineage_data</span>):
        <span class="hljs-string">"""è®¡ç®—è¡€ç¼˜è´¨é‡æŒ‡æ ‡"""</span>
        metrics = {}

        <span class="hljs-comment"># å®Œæ•´æ€§æŒ‡æ ‡</span>
        metrics[<span class="hljs-string">'completeness'</span>] = self.calculate_completeness(lineage_data)

        <span class="hljs-comment"># å‡†ç¡®æ€§æŒ‡æ ‡</span>
        metrics[<span class="hljs-string">'accuracy'</span>] = self.calculate_accuracy(lineage_data)

        <span class="hljs-comment"># ä¸€è‡´æ€§æŒ‡æ ‡</span>
        metrics[<span class="hljs-string">'consistency'</span>] = self.calculate_consistency(lineage_data)

        <span class="hljs-comment"># æ—¶æ•ˆæ€§æŒ‡æ ‡</span>
        metrics[<span class="hljs-string">'freshness'</span>] = self.calculate_freshness(lineage_data)

        <span class="hljs-comment"># å¤æ‚æ€§æŒ‡æ ‡</span>
        metrics[<span class="hljs-string">'complexity'</span>] = self.calculate_complexity(lineage_data)

        <span class="hljs-keyword">return</span> metrics

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ai_quality_classification</span>(<span class="hljs-params">self, metrics</span>):
        <span class="hljs-string">"""ä½¿ç”¨AIè¿›è¡Œè´¨é‡åˆ†ç±»"""</span>
        <span class="hljs-comment"># å‡†å¤‡ç‰¹å¾æ•°æ®</span>
        features = np.array([[
            metrics[<span class="hljs-string">'completeness'</span>],
            metrics[<span class="hljs-string">'accuracy'</span>], 
            metrics[<span class="hljs-string">'consistency'</span>],
            metrics[<span class="hljs-string">'freshness'</span>],
            metrics[<span class="hljs-string">'complexity'</span>]
        ]])

        <span class="hljs-comment"># æ ‡å‡†åŒ–ç‰¹å¾</span>
        features_scaled = self.scaler.transform(features)

        <span class="hljs-comment"># é¢„æµ‹è´¨é‡åˆ†æ•°</span>
        quality_score = self.classifier.predict_proba(features_scaled)[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]

        <span class="hljs-keyword">return</span> quality_score

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
assessor = LineageQualityAssessor()
quality_result = assessor.assess_lineage_quality(lineage_data)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è´¨é‡è¯„åˆ†: <span class="hljs-subst">{quality_result[<span class="hljs-string">'overall_score'</span>]:<span class="hljs-number">.2</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è´¨é‡ç­‰çº§: <span class="hljs-subst">{quality_result[<span class="hljs-string">'quality_level'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‘ç°çš„é—®é¢˜: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(quality_result[<span class="hljs-string">'issues'</span>])}</span>ä¸ª"</span>)
</code></pre>
<h2 data-id="heading-11">ğŸ“– å®æ—¶ç›‘æ§ä¸å‘Šè­¦</h2>
<h3 data-id="heading-12">5.1 ç›‘æ§å‘Šè­¦æµç¨‹å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bde5203f5f5471c95adcf6656773edf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=rudNjZUTdMStmAo%2BVk7N77smBAA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">5.2 å®æ—¶ç›‘æ§å®ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RealTimeLineageMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, kafka_config, lineage_graph, alert_service</span>):
        self.consumer = KafkaConsumer(
            kafka_config[<span class="hljs-string">'topic'</span>],
            bootstrap_servers=kafka_config[<span class="hljs-string">'bootstrap_servers'</span>],
            value_deserializer=<span class="hljs-keyword">lambda</span> m: json.loads(m.decode(<span class="hljs-string">'utf-8'</span>))
        )
        self.graph = lineage_graph
        self.alert_service = alert_service
        self.monitoring_rules = self.load_monitoring_rules()

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_monitoring</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¯åŠ¨å®æ—¶ç›‘æ§"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯åŠ¨è¡€ç¼˜å…³ç³»å®æ—¶ç›‘æ§..."</span>)

        <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> self.consumer:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># å¤„ç†å˜æ›´äº‹ä»¶</span>
                <span class="hljs-keyword">await</span> self.process_change_event(message.value)

            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤„ç†ç›‘æ§äº‹ä»¶å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-comment"># å‘é€ç›‘æ§é”™è¯¯å‘Šè­¦</span>
                <span class="hljs-keyword">await</span> self.send_monitoring_alert(
                    <span class="hljs-string">"MONITORING_ERROR"</span>,
                    <span class="hljs-string">f"å¤„ç†å˜æ›´äº‹ä»¶æ—¶å‘ç”Ÿé”™è¯¯: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
                    <span class="hljs-string">"HIGH"</span>
                )

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_change_event</span>(<span class="hljs-params">self, event</span>):
        <span class="hljs-string">"""å¤„ç†æ•°æ®å˜æ›´äº‹ä»¶"""</span>
        event_type = event.get(<span class="hljs-string">'event_type'</span>)
        resource_type = event.get(<span class="hljs-string">'resource_type'</span>)
        resource_name = event.get(<span class="hljs-string">'resource_name'</span>)

        <span class="hljs-comment"># åˆ†æå˜æ›´å½±å“</span>
        impact_analysis = <span class="hljs-keyword">await</span> self.analyze_change_impact(
            event_type, resource_type, resource_name
        )

        <span class="hljs-comment"># è¯„ä¼°é£é™©</span>
        risk_assessment = self.assess_change_risk(impact_analysis, event)

        <span class="hljs-comment"># è§¦å‘ç›¸åº”åŠ¨ä½œ</span>
        <span class="hljs-keyword">await</span> self.trigger_actions(risk_assessment, event)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_change_impact</span>(<span class="hljs-params">self, event_type, resource_type, resource_name</span>):
        <span class="hljs-string">"""åˆ†æå˜æ›´å½±å“èŒƒå›´"""</span>

        <span class="hljs-keyword">if</span> resource_type == <span class="hljs-string">'TABLE'</span>:
            <span class="hljs-comment"># è¡¨çº§åˆ«å½±å“åˆ†æ</span>
            impact_paths = self.graph.query_impact_analysis(resource_name)

            <span class="hljs-comment"># è®¡ç®—å½±å“èŒƒå›´</span>
            impact_scope = {
                <span class="hljs-string">'direct_impact'</span>: self.get_direct_dependencies(resource_name),
                <span class="hljs-string">'indirect_impact'</span>: self.get_indirect_dependencies(resource_name, depth=<span class="hljs-number">3</span>),
                <span class="hljs-string">'critical_assets'</span>: self.identify_critical_assets(impact_paths),
                <span class="hljs-string">'business_impact'</span>: self.assess_business_impact(impact_paths)
            }

            <span class="hljs-keyword">return</span> impact_scope

        <span class="hljs-keyword">elif</span> resource_type == <span class="hljs-string">'COLUMN'</span>:
            <span class="hljs-comment"># åˆ—çº§åˆ«å½±å“åˆ†æ</span>
            impact_paths = self.graph.query_impact_analysis(<span class="hljs-literal">None</span>, resource_name)

            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'column_impact'</span>: impact_paths,
                <span class="hljs-string">'affected_reports'</span>: self.find_affected_reports(resource_name),
                <span class="hljs-string">'data_quality_impact'</span>: self.assess_data_quality_impact(resource_name)
            }

<span class="hljs-comment"># å¯åŠ¨ç›‘æ§æœåŠ¡</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    monitor = RealTimeLineageMonitor(
        kafka_config={<span class="hljs-string">'bootstrap_servers'</span>: <span class="hljs-string">'localhost:9092'</span>, <span class="hljs-string">'topic'</span>: <span class="hljs-string">'data-changes'</span>},
        lineage_graph=lineage_graph,
        alert_service=alert_service
    )

    <span class="hljs-keyword">await</span> monitor.start_monitoring()
</code></pre>
<h2 data-id="heading-14">ğŸ“– å½±å“åˆ†æä¸æ ¹å› è¿½è¸ª</h2>
<h3 data-id="heading-15">6.1 å½±å“åˆ†ææµç¨‹å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8fe88592d594d6d8dcbe4c922cceca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=57bCoNRzmHHwNaKjGR0Nj2a1kxA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">6.2 æ ¹å› åˆ†ææµç¨‹å›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2008cbb658db4a789fcffd0fac466269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=SEvHoPY48qekwLguzWAIBgbJVl0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17">æœ€å</h2>
<p><strong>è¿™ä¸ªå¢å¼ºç‰ˆæ–¹æ¡ˆçš„æ ¸å¿ƒåœ¨äºåˆ©ç”¨ AI æŠ€æœ¯ï¼ˆå¦‚</strong> <strong>Amazon</strong> <strong>Bedrock çš„</strong> <strong>LLM</strong> <strong>æ¨¡å‹ï¼‰æå‡è¡€ç¼˜åˆ†æçš„è‡ªåŠ¨åŒ–ä¸æ™ºèƒ½åŒ–æ°´å¹³ï¼Œå‡†ç¡®è§£æå¤æ‚çš„æ•°æ®é€»è¾‘ï¼ŒåŒæ—¶å€ŸåŠ©å›¾æ•°æ®åº“ï¼ˆNeptuneï¼‰å®ç°é«˜æ•ˆçš„è¡€ç¼˜å…³ç³»ç®¡ç†å’Œåˆ†æã€‚æ•°æ®è¡€ç¼˜ç³»ç»Ÿé€šè¿‡æ„å»ºé€æ˜ã€å¯ä¿¡çš„æ•°æ®é“¾è·¯ï¼Œæœ‰æ•ˆæå‡æ•°æ®é©±åŠ¨å†³ç­–çš„ä¿¡å¿ƒã€‚</strong></p>
<p>â˜â˜<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Ffree%3Ftrk%3Db5edeb0e-6438-44ef-a5b7-5fd7f1145fed%26sc_channel%3Dsm" target="_blank" title="https://aws.amazon.com/cn/free?trk=b5edeb0e-6438-44ef-a5b7-5fd7f1145fed&amp;sc_channel=sm" ref="nofollow noopener noreferrer">ã€ä¼ é€é—¨ã€‘</a></p>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹å•¦ã€‚æœ€åæé†’ä¸€ä¸‹å„ä½å·¥å‹ï¼Œå¦‚æœåç»­ä¸å†ä½¿ç”¨ç›¸å…³æœåŠ¡ï¼Œåˆ«å¿˜äº†åœ¨æ§åˆ¶å°å…³é—­ï¼Œé¿å…è¶…å‡ºå…è´¹é¢åº¦äº§ç”Ÿè´¹ç”¨ï½</p>
<ul>
<li>GitHub ä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faws-samples%2Fsample-agentic-data-lineage" target="_blank" title="https://github.com/aws-samples/sample-agentic-data-lineage" ref="nofollow noopener noreferrer">sample-agentic-data-lineage</a></li>
<li>æ ·ä¾‹æ•°æ®æ¨¡å‹ä¸æ¨¡å¼ç»“æ„ï¼Œæ¥æºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdbt-labs%2Fjaffle-shop-classic" target="_blank" title="https://github.com/dbt-labs/jaffle-shop-classic" ref="nofollow noopener noreferrer">dbt-labs/jaffle-shop-classic</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fb-ned.github.io%2Fdbt-colibri%2F" target="_blank" title="https://b-ned.github.io/dbt-colibri/" ref="nofollow noopener noreferrer">Dbt-colibri</a>: A lightweight, developer-friendly CLI tool and self-hostable dashboard for extracting and visualizing column-level lineage from your dbt projects.</li>
<li>ä»…ä¾›æ¦‚å¿µéªŒè¯ï¼ˆPOCï¼‰ä½¿ç”¨ï¼Œä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•åœ¨ Spring Boot ä¸­æ¥å…¥ Amazon ElastiCache]]></title>    <link>https://juejin.cn/post/7584370833705418767</link>    <guid>https://juejin.cn/post/7584370833705418767</guid>    <pubDate>2025-12-17T08:01:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584370833705418767" data-draft-id="7584377629707452451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•åœ¨ Spring Boot ä¸­æ¥å…¥ Amazon ElastiCache"/> <meta itemprop="keywords" content="Java,Redis,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-17T08:01:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ†"/> <meta itemprop="url" content="https://juejin.cn/user/4182956056773160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•åœ¨ Spring Boot ä¸­æ¥å…¥ Amazon ElastiCache
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4182956056773160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:01:01.000Z" title="Wed Dec 17 2025 08:01:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç¼“å­˜åœ¨æœåŠ¡ç«¯æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠæ€ä¹ˆæŠŠ <strong>Amazon ElastiCacheåº”ç”¨æ•´åˆåˆ° Spring Boot</strong> ä¸Šï¼Œè®©æœåŠ¡å“åº”æé€Ÿã€ç³»ç»Ÿæ•´ä½“è½»ç›ˆèµ·æ¥ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆä½ è¿Ÿæ—©è¦ä¸Šç¼“å­˜</h2>
<p>ä½ æœ‰å¤šå°‘æ¬¡åœ¨æ—¥å¿—é‡Œçœ‹ç€é‚£å‡ ç™¾æ¯«ç§’çš„ SQL å»¶è¿Ÿå¹æ°”ï¼Ÿå°¤å…¶å½“ç³»ç»Ÿè®¿é—®é‡ä¸Šå»ä¹‹åï¼Œæ¯æ¬¡éƒ½å»æŸ¥æ•°æ®åº“ï¼Œå°±åƒè®©äººæ¯æ¬¡åƒé¥­éƒ½å»æ€çŒªã€‚æ•°æ®åº“ä¸æ˜¯ä¸ç»™ä½ å¹²æ´»ï¼Œå®ƒåªæ˜¯ç´¯ã€‚</p>
<p>ç¼“å­˜å°±æ˜¯é‚£åªâ€œæå‰å¤‡å¥½çš„çŒªâ€ã€‚Â Â  ç®€å•è¯´ï¼Œå®ƒåœ¨å†…å­˜é‡Œå¸®ä½ ç•™å­˜ä¸€ä»½çƒ­æ•°æ®ï¼Œä¸‹æ¬¡è¯·æ±‚ç›´æ¥å–ï¼Œä¸å†æŸ¥æ•°æ®åº“ã€‚äºæ˜¯æ€§èƒ½æš´æ¶¨ã€å»¶è¿Ÿéª¤é™ã€‚</p>
<p>è€ŒÂ  <strong>ElastiCache</strong> æ˜¯ä¸€å¥—æ‰˜ç®¡çš„ç¼“å­˜æœåŠ¡ï¼Œ<strong>å…¼å®¹ Redis æˆ– Valkey å¼•æ“</strong>ï¼Œæ€§èƒ½å¯ç›´æ¥èµ·é£ã€‚å®˜æ–¹è¯´å®ƒèƒ½æ”¯æŒâ€œç™¾ä¸‡çº§æ¯ç§’æ“ä½œã€å¾®ç§’çº§å“åº”â€ï¼Œå¯¹ Spring Boot åº”ç”¨æ¥è¯´ç®€ç›´æ˜¯æ’ä¸Šç¿…è†€ã€‚</p>
<hr/>
<p>å¦‚æœä½ æ²¡æœ‰äºšé©¬é€Šäº‘è´¦å·ï¼Œå¯ä»¥å…ˆå» <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Ffree%3Ftrk%3D7d27709e-0bfa-419d-808b-7b9e24f4f9d9%26sc_channel%3Dsm" target="_blank" title="https://aws.amazon.com/cn/free?trk=7d27709e-0bfa-419d-808b-7b9e24f4f9d9&amp;sc_channel=sm" ref="nofollow noopener noreferrer">äºšé©¬é€Šäº‘ç§‘æŠ€å®˜ç½‘</a> æ³¨å†Œä¸€ä¸ªï¼Œæ³¨å†Œå®Œæˆåå¯ä»¥é¢†å–æœ€å°‘6ä¸ªæœˆçš„ ElastiCache å…è´¹å¥—é¤ã€‚</p>
<h2 data-id="heading-1">äºŒã€Spring Boot + ElastiCache çš„ç»„åˆæ€è·¯</h2>
<p>æ•´åˆæ€è·¯å…¶å®ç‰¹åˆ«ç›´æ¥ï¼Œåˆ†å‡ å±‚æ¥çœ‹ï¼š</p>
<ol>
<li><strong>åº”ç”¨å±‚</strong>ï¼šSpring Boot æä¾›äº†ç¼“å­˜æŠ½è±¡ï¼ˆ<code>@EnableCaching</code>ã€<code>@Cacheable</code> ç­‰ï¼‰ã€‚</li>
<li><strong>ç¼“å­˜å±‚</strong>ï¼šElastiCache è´Ÿè´£æ‰˜ç®¡ Redis æœåŠ¡ï¼Œè‡ªåŠ¨ä¼¸ç¼©ã€è‡ªåŠ¨å¤‡ä»½ã€è‡ªåŠ¨ä¿®å¤ã€‚</li>
<li><strong>è¿è¡Œé€»è¾‘</strong>ï¼š
<ul>
<li>å…ˆæŸ¥ç¼“å­˜</li>
<li>
<ul>
<li>æœ‰ â†’ ç›´æ¥è¿”å›ï¼› Â  Â </li>
</ul>
</li>
<li>
<ul>
<li>æ²¡ â†’ æŸ¥æ•°æ®åº“ï¼Œå†æŠŠç»“æœæ”¾è¿›ç¼“å­˜ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>é…ç½®å±‚</strong>ï¼šSpring Boot é… Redis å®¢æˆ·ç«¯ã€è¿æ¥ä¿¡æ¯ã€TTLã€SSL ç­‰ã€‚</li>
</ol>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ•°æ®åº“çš„å‹åŠ›èƒ½è¢«æ˜æ˜¾å‰Šå‡ï¼ŒæœåŠ¡çš„å“åº”é€Ÿåº¦ä¹Ÿæ›´ç¨³å®šã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€åŠ¨æ‰‹æ•´åˆï¼šSpring Boot ç«¯é…ç½®</h2>
<p>æˆ‘ä»¬ç›´æ¥æ¥å®æ“ä¸‹ï¼Œä¸€æ­¥æ­¥æèµ·æ¥ã€‚</p>
<h3 data-id="heading-3">1. åŠ ä¾èµ–</h3>
<p>åœ¨ <code>pom.xml</code> é‡ŒåŠ å…¥ä¸¤è¡Œä¾èµ–å°±è¡Œï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ç¬¬ä¸€ä¸ªæ˜¯ç¼“å­˜æŠ½è±¡å±‚ï¼Œç¬¬äºŒä¸ªæ˜¯ Redis å®ç°å±‚ã€‚å®ƒä¿©æ­é…ï¼Œå°±æ˜¯å®˜æ–¹æ ‡å‡†å¥—è·¯ã€‚</p>
<h3 data-id="heading-4">2. å¯ç”¨ç¼“å­˜åŠŸèƒ½</h3>
<p>åœ¨ä¸»ç±»æˆ–è€…é…ç½®ç±»ä¸Šæ ‡æ³¨ <code>@EnableCaching</code>ï¼Œå°±èƒ½è®© Spring Boot è¯†åˆ«ç¼“å­˜æ³¨è§£ã€‚</p>
<p>ç„¶ååœ¨ä½ çš„ä¸šåŠ¡æ–¹æ³•ä¸ŠåŠ ä¸ª <code>@Cacheable</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheableComponent</span> {
Â  <span class="hljs-meta">@Cacheable</span>(<span class="hljs-string">"userCache"</span>)
Â  <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> uid</span>) {
Â  Â  Â  <span class="hljs-comment">// æ¨¡æ‹Ÿä¸€æ¬¡æ•°æ®åº“è°ƒç”¨</span>
Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryUserFromDB</span>(uid);
Â  }
}
</code></pre>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šè§¦å‘å®é™…é€»è¾‘ï¼Œä¹‹åçš„è°ƒç”¨ç›´æ¥ä»ç¼“å­˜è¿”å›ã€‚Â Â  Spring Boot ä¼šè‡ªåŠ¨å¸®ä½ å¤„ç† key ç”Ÿæˆå’Œç¼“å­˜å†™å…¥ï¼Œéå¸¸çœå¿ƒã€‚</p>
<h3 data-id="heading-5">3. é…ç½® Redis è¿æ¥</h3>
<p>åœ¨ <code>application.yml</code> ä¸­é…ç½® ElastiCache çš„è¿æ¥åœ°å€å’Œ TTLï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
Â  <span class="hljs-attr">data:</span>
Â  Â  <span class="hljs-attr">redis:</span>
Â  Â  Â  <span class="hljs-attr">host:</span> <span class="hljs-string">my-elasticache-endpoint.amazonaws.com</span>
Â  Â  Â  <span class="hljs-attr">ssl:</span>
Â  Â  Â  Â  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
Â  <span class="hljs-attr">cache:</span>
Â  Â  <span class="hljs-attr">redis:</span>
Â  Â  Â  <span class="hljs-attr">time-to-live:</span> <span class="hljs-string">10m</span>
</code></pre>
<p>è§£é‡Šä¸€ä¸‹ï¼š</p>
<ul>
<li><code>host</code> å°±æ˜¯ä½ çš„ ElastiCache å®ä¾‹åœ°å€ï¼›</li>
<li><code>ssl.enabled</code> å¦‚æœä½ å¯ç”¨äº†åŠ å¯†ï¼›</li>
<li><code>time-to-live</code> æ§åˆ¶ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ 10 åˆ†é’Ÿã€‚</li>
</ul>
<p>è¿™å‡ è¡Œé…ç½®åŸºæœ¬èƒ½è®©ç¼“å­˜ç³»ç»Ÿè·‘èµ·æ¥ï¼Œå’±ä»¬å°±å…ˆç”¨è¿™ä¸ªç®€å•çš„é¡¹ç›®ä½œä¸ºç¤ºä¾‹ã€‚</p>
<h2 data-id="heading-6">å››ã€Amazon ç«¯å‡†å¤‡ï¼šå»ºä¸ª ElastiCache å®ä¾‹</h2>
<p>å¦‚æœä½ è¿˜æ²¡åœ¨ Amazon ä¸Šå¼€ç¼“å­˜æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥ç”¨ â€œServerless ElastiCache for Redisâ€ ç‰ˆæœ¬ã€‚Â Â  å®˜æ–¹æä¾›äº†å‘½ä»¤è¡Œç¤ºä¾‹ï¼Œå¤§è‡´æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">aws elasticache <span class="hljs-built_in">create</span>-serverless-cache \
Â  <span class="hljs-comment">--serverless-cache-name spring-demo \</span>
Â  <span class="hljs-comment">--engine redis \</span>
Â  <span class="hljs-comment">--subnet-ids subnet-xxxx subnet-yyyy</span>
</code></pre>
<p>åˆ›å»ºå®Œä¹‹åï¼Œå†æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-css" lang="css">aws elasticache describe-serverless-caches \
Â  <span class="hljs-attr">--serverless-cache-name</span> spring-demo \
Â  <span class="hljs-attr">--query</span> "ServerlessCaches<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-class">.Endpoint</span><span class="hljs-selector-class">.Address</span>"
</code></pre>
<p>è¿™ä¸€æ­¥ä¼šè¿”å›ç¼“å­˜çš„ endpointï¼ŒæŠŠå®ƒè´´åˆ°ä½ çš„ <code>application.yml</code> é‡Œå°±è¡Œã€‚Â Â  åˆ«å¿˜äº†æ‰“å¼€å®‰å…¨ç»„è®¿é—®è§„åˆ™ï¼Œè®©ä½ çš„åº”ç”¨ä¸»æœºèƒ½è®¿é—®ç¼“å­˜çš„ 6379 ç«¯å£ã€‚</p>
<h2 data-id="heading-7">äº”ã€è·‘èµ·æ¥è¯•è¯•</h2>
<p>æ¥ä¸‹æ¥å°±æ˜¯éªŒè¯ç¼“å­˜æ•ˆæœäº†ã€‚è¿è¡Œåº”ç”¨åï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚æ¥å£æ—¶æ—¥å¿—ä¼šæ˜¾ç¤ºå®é™…æ–¹æ³•è¢«æ‰§è¡Œï¼›</p>
<p>ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œä½ ä¼šå‘ç°æ–¹æ³•ä½“ä¸å†æ‰§è¡Œï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ã€‚</p>
<p>è¿™æ—¶å€™ä½ å°±çŸ¥é“ï¼Œå®ƒå·²ç»æˆåŠŸè·‘èµ·æ¥äº†ã€‚</p>
<p>å¤šè¯´ä¸€å¥ï¼ŒElastiCache ç°åœ¨è¿˜æ”¯æŒä¸€ä¸ªå« <strong>Valkey</strong> çš„ Redis å…¼å®¹å¼•æ“ã€‚</p>
<p>å®ƒçš„å¥½å¤„æ˜¯å¼€æºã€å…¼å®¹ã€å¯ç›´æ¥æ›¿æ¢ã€‚å¦‚æœä½ æƒ³è¯•è¯•æ›´å¼€æ”¾çš„æ–¹æ¡ˆï¼Œåªéœ€è¦åœ¨åˆ›å»ºå®ä¾‹æ—¶æŠŠå¼•æ“å‚æ•°ä» <code>redis</code> æ”¹æˆ <code>valkey</code> å³å¯ã€‚Spring Boot è¿™è¾¹çš„ä»£ç å®Œå…¨ä¸ç”¨æ”¹ã€‚</p>
<h2 data-id="heading-8">å…­ã€è¸©å‘è­¦ç¤º</h2>
<p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„æ³¨æ„äº‹é¡¹ï¼Œæ¯ä¸€ä½æœåŠ¡ç«¯ç¨‹åºå‘˜éƒ½åº”è¯¥äº†è§£ï¼š</p>
<ol>
<li><strong>åºåˆ—åŒ–æ ¼å¼</strong>ï¼šé»˜è®¤ JDK åºåˆ—åŒ–æ•ˆç‡ä¸é«˜ï¼Œå»ºè®®æ”¹æˆ JSON æˆ– Kryoã€‚</li>
<li><strong>ç¼“å­˜å¤±æ•ˆç­–ç•¥</strong>ï¼šTTL è®¾ç½®è¦åˆç†ï¼Œé¿å…ç¼“å­˜é›ªå´©ã€‚</li>
<li><strong>ç›‘æ§</strong>ï¼šç”¨ CloudWatch ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ã€å»¶è¿Ÿã€Eviction æƒ…å†µã€‚</li>
<li><strong>å®‰å…¨é…ç½®</strong>ï¼šç”Ÿäº§ç¯å¢ƒä¸€å®šè¦å¼€ SSL å’Œè®¿é—®æ§åˆ¶ã€‚</li>
</ol>
<p>è¿™äº›éƒ½æ˜¯ç¼“å­˜è½åœ°åå¿…é¡»è€ƒè™‘çš„ç»†èŠ‚ï¼Œä¸ç„¶ä½ å°±ç­‰ç€åŠå¤œè¢«å«é†’ä¿® bug å§ã€‚</p>
<h2 data-id="heading-9">ä¸ƒã€é¡¹ç›®å®è·µå»ºè®®</h2>
<p>å¦‚æœä½ ç°åœ¨æ‰‹å¤´æ­£å¥½æœ‰ä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œå¯ä»¥æŒ‰è¿™ä¸ªæµç¨‹åŠ¨æ‰‹ï¼š</p>
<ol>
<li>å…ˆåˆ†æç³»ç»Ÿçš„çƒ­ç‚¹æ¥å£ï¼ŒæŒ‘æœ€è€—æ—¶çš„åœ°æ–¹åŠ ç¼“å­˜ï¼›</li>
<li>è®¾è®¡åˆç†çš„ key ç»“æ„ï¼Œæ¯”å¦‚ <code>user:id</code>ã€<code>product:sku</code>ï¼›</li>
<li>åœ¨ä»£ç é‡Œå¯ç”¨ <code>@Cacheable</code>ï¼›</li>
<li>æœ¬åœ°ç”¨ Redis æ¨¡æ‹Ÿï¼ŒéªŒè¯é€»è¾‘ï¼›</li>
<li>æµ‹è¯•ç¯å¢ƒåˆ‡æ¢åˆ° ElastiCacheï¼›</li>
<li>éƒ¨ç½²ä¸Šçº¿åç›‘æ§å‘½ä¸­ç‡ï¼›</li>
<li>å®šæœŸæ¸…ç†æ— æ•ˆæ•°æ®å’Œä¼˜åŒ– TTLã€‚</li>
</ol>
<p>æå®Œè¿™å¥—ä¸‹æ¥ï¼Œä½ çš„ç³»ç»Ÿæ€§èƒ½ä¼šç¨³å¾—åƒåŠ äº†æ°®æ°”åŠ é€Ÿå™¨ã€‚</p>
<h2 data-id="heading-10">å…«ã€ç»“è¯­</h2>
<p>ç¼“å­˜è¿™ç©æ„ï¼Œè¯´ç™½äº†å°±æ˜¯â€œç”¨ç©ºé—´æ¢æ—¶é—´â€çš„è‰ºæœ¯ã€‚</p>
<p>Spring Boot ç»™äº†ä½ æŠ½è±¡å±‚ï¼ŒElastiCache ç»™äº†ä½ åŸºç¡€è®¾æ–½ï¼Œå‰©ä¸‹çš„å°±çœ‹ä½ ä¼šä¸ä¼šç”¨ã€‚</p>
<p>åˆ«ç­‰åˆ°çº¿ä¸ŠæœåŠ¡å¡å¾—åƒ PPT æ‰æƒ³èµ·ç¼“å­˜ã€‚æ—©ç‚¹åŠ ï¼Œæ—©ç‚¹è½»æ¾ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹å•¦ã€‚æœ€åæé†’ä¸€ä¸‹å„ä½å·¥å‹ï¼Œå¦‚æœåç»­ä¸å†ä½¿ç”¨ç›¸å…³æœåŠ¡ï¼Œåˆ«å¿˜äº†åœ¨æ§åˆ¶å°å…³é—­ï¼Œé¿å…è¶…å‡ºå…è´¹é¢åº¦äº§ç”Ÿè´¹ç”¨ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS åº”ç”¨å‘å¸ƒæµç¨‹ä¸­å¸¸è¢«å¿½è§†çš„å…³é”®ç¯èŠ‚]]></title>    <link>https://juejin.cn/post/7584567736186880038</link>    <guid>https://juejin.cn/post/7584567736186880038</guid>    <pubDate>2025-12-17T08:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584567736186880038" data-draft-id="7584567736186863654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS åº”ç”¨å‘å¸ƒæµç¨‹ä¸­å¸¸è¢«å¿½è§†çš„å…³é”®ç¯èŠ‚"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-17T08:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒçŒ´çˆ·"/> <meta itemprop="url" content="https://juejin.cn/user/2179705232165364"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS åº”ç”¨å‘å¸ƒæµç¨‹ä¸­å¸¸è¢«å¿½è§†çš„å…³é”®ç¯èŠ‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2179705232165364/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒçŒ´çˆ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:03:34.000Z" title="Wed Dec 17 2025 08:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¾ˆå¤šé¡¹ç›®é‡Œï¼Œâ€œå‘å¸ƒ iOS åº”ç”¨â€ç»å¸¸è¢«è§†ä¸ºå¼€å‘ç»“æŸåçš„è‡ªç„¶å»¶ä¼¸ã€‚ä½†å½“ä½ çœŸæ­£è´Ÿè´£ä¸€æ¬¡å®Œæ•´å‘å¸ƒæ—¶ï¼Œå¾ˆå¿«ä¼šæ„è¯†åˆ°ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå•ç‚¹æ“ä½œï¼Œè€Œæ˜¯ä¸€æ®µæ¨ªè·¨å¤šä¸ªå·¥å…·ã€å¤šä¸ªç³»ç»Ÿã€å¤šä¸ªè§’è‰²çš„å·¥ç¨‹è¿‡ç¨‹ã€‚</p>
<p>æˆ‘ç¬¬ä¸€æ¬¡å®Œæ•´è·‘å®Œ iOS å‘å¸ƒå…¨æµç¨‹æ—¶ï¼Œä»£ç å…¶å®æ—©å·²ç¨³å®šï¼ŒåŠŸèƒ½ä¹Ÿç»è¿‡éªŒè¯ï¼Œä½†å‘å¸ƒé˜¶æ®µä»ç„¶åå¤è¢«æ‰“æ–­ã€‚é—®é¢˜å¹¶ä¸é›†ä¸­åœ¨æŸä¸€ä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯å‡ºç°åœ¨ <strong>æ­¥éª¤ä¹‹é—´çš„è¡”æ¥</strong>ï¼šè¯ä¹¦ä»å“ªé‡Œæ¥ã€Bundle ID æ˜¯å¦ä¸€è‡´ã€IPA æ˜¯å¦çœŸçš„ç¬¦åˆä¸Šæ¶è¦æ±‚ã€ä¸Šä¼ ç”±è°æ¥å®Œæˆã€‚</p>
<p>è¿™äº›é—®é¢˜å•ç‹¬çœ‹éƒ½ä¸å¤æ‚ï¼Œä½†ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±ä¼šä¸æ–­æ”¾å¤§ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>å‘å¸ƒçš„èµ·ç‚¹ï¼Œå…¶å®æ—©äºæ„å»ºé‚£ä¸€æ­¥</strong></h2>
<p>å¾ˆå¤šäººä¼šæŠŠ iOS å‘å¸ƒçš„èµ·ç‚¹æ”¾åœ¨â€œç”Ÿæˆ IPAâ€ï¼Œä½†ä»å·¥ç¨‹è§’åº¦çœ‹ï¼ŒçœŸæ­£çš„èµ·ç‚¹æ˜¯ <strong>åº”ç”¨èº«ä»½æ˜¯å¦å·²ç»ç¡®å®š</strong>ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå‘å¸ƒå‰æˆ‘é€šå¸¸ä¼šå…ˆç¡®è®¤ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>å½“å‰è´¦å·ä¸‹æ˜¯å¦å·²ç»å­˜åœ¨å¯ç”¨çš„ Bundle ID</li>
<li>è¿™ä¸ª Bundle ID æ˜¯å¦å·²ç»è¢«å…¶ä»–é¡¹ç›®æˆ–å†å²ç‰ˆæœ¬ä½¿ç”¨</li>
</ul>
<p>è¿™ä¸€æ­¥å¦‚æœè·³è¿‡ï¼Œåé¢æ‰€æœ‰ç¯èŠ‚éƒ½å¯èƒ½éœ€è¦è¿”å·¥ã€‚</p>
<p>åœ¨ Windows æˆ–é Xcode ç¯å¢ƒä¸‹ï¼Œæˆ‘ä¼šç”¨ <strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰æŸ¥çœ‹ Apple å¼€å‘è€…è´¦å·ä¸­çš„ Bundle ID åˆ—è¡¨</strong>ï¼Œç›®çš„å¹¶ä¸æ˜¯åˆ›å»ºï¼Œè€Œæ˜¯ç¡®è®¤ç°çŠ¶ã€‚
è¿™è®©å‘å¸ƒæµç¨‹ä»ä¸€å¼€å§‹å°±åŸºäºâ€œå·²çŸ¥äº‹å®â€ï¼Œè€Œä¸æ˜¯å‡è®¾ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e3034525db54c2bacdfd440ff0e5717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=QJEKaVYC1nh0BxrFmVfuIr%2FTZm8%3D" alt="æŸ¥çœ‹bid" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1"><strong>è¯ä¹¦å¹¶ä¸æ˜¯å‘å¸ƒå½“å¤©æ‰è¯¥å…³å¿ƒçš„ä¸œè¥¿</strong></h2>
<p>è¯ä¹¦é—®é¢˜å‡ ä¹æ˜¯æ‰€æœ‰ iOS å‘å¸ƒæµç¨‹é‡Œçš„é«˜é¢‘é£é™©ç‚¹ã€‚
çœŸæ­£çš„é—®é¢˜é€šå¸¸ä¸æ˜¯â€œä¸ä¼šç”Ÿæˆè¯ä¹¦â€ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>ä¸æ¸…æ¥šå½“å‰é¡¹ç›®åœ¨ç”¨å“ªä¸€ä»½</li>
<li>è¯ä¹¦åªå­˜åœ¨æŸä¸€å° Mac ä¸Š</li>
<li>æ„å»ºèŠ‚ç‚¹å’Œä¸Šä¼ èŠ‚ç‚¹ä½¿ç”¨çš„è¯ä¹¦ä¸ä¸€è‡´</li>
</ul>
<p>åœ¨ä¸€äº›é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æŠŠè¯ä¹¦ç®¡ç†ä» Xcode è‡ªåŠ¨æµç¨‹ä¸­æ‹†å‡ºæ¥ï¼Œè½¬è€Œä½¿ç”¨æ›´æ˜ç¡®çš„æ–¹å¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œé€šè¿‡ <strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰åˆ›å»º iOS è¯ä¹¦</strong>ï¼Œç›´æ¥ç”Ÿæˆå¯å¤ç”¨çš„è¯ä¹¦æ–‡ä»¶ï¼Œç”¨äºæ„å»ºå’Œå‘å¸ƒã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>è¯ä¹¦æ¥æºæ¸…æ™°</li>
<li>ä¸ä¾èµ–é’¥åŒ™ä¸²çŠ¶æ€</li>
<li>å¯ä»¥åœ¨ CI æˆ–ä¸åŒç³»ç»Ÿä¸­ä½¿ç”¨</li>
</ul>
<p>è¿™ä¸€æ­¥å¹¶ä¸ä¼šæ›¿ä»£ Xcode çš„æ„å»ºèƒ½åŠ›ï¼Œä½†èƒ½æ˜¾è‘—é™ä½å‘å¸ƒé˜¶æ®µçš„ä¸ç¡®å®šæ€§ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e5449909714c73bdf3557a001ba469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=YRtU1HA36xsuH3KQo%2BjMYZmFRiw%3D" alt="åˆ›å»ºè¯ä¹¦" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2"><strong>æè¿°æ–‡ä»¶çš„é—®é¢˜ï¼Œé€šå¸¸ä¸æ˜¯â€œæ²¡æœ‰â€ï¼Œè€Œæ˜¯â€œç”¨é”™äº†â€</strong></h2>
<p>åœ¨å‘å¸ƒé˜¶æ®µï¼Œæè¿°æ–‡ä»¶ï¼ˆmobileprovisionï¼‰æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½è§†çš„å¯¹è±¡ã€‚
å¾ˆå¤šæ„å»ºå¤±è´¥æˆ–ä¸Šä¼ å¤±è´¥çš„æƒ…å†µï¼Œæœ¬è´¨ä¸Šå¹¶ä¸æ˜¯è¯ä¹¦é”™è¯¯ï¼Œè€Œæ˜¯æè¿°æ–‡ä»¶ä¸å½“å‰å‘å¸ƒç›®æ ‡ä¸åŒ¹é…ã€‚</p>
<p>æˆ‘è§è¿‡çš„æƒ…å†µåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä½¿ç”¨äº†å¼€å‘æè¿°æ–‡ä»¶è¿›è¡Œå‘å¸ƒ</li>
<li>æè¿°æ–‡ä»¶ç»‘å®šçš„ Bundle ID ä¸å½“å‰ IPA ä¸ä¸€è‡´</li>
<li>æè¿°æ–‡ä»¶æƒé™ä¸å®é™…åŠŸèƒ½ä¸åŒ¹é…</li>
</ul>
<p>åœ¨å‘å¸ƒå‰ï¼Œæˆ‘é€šå¸¸ä¼šç›´æ¥æ£€æŸ¥æè¿°æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯åªçœ‹æ–‡ä»¶åã€‚
åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œè¿™ä¸€æ­¥å¯ä»¥é€šè¿‡ <strong>Appuploader æŸ¥çœ‹ mobileprovision æ–‡ä»¶ä¿¡æ¯</strong> å®Œæˆï¼Œç¡®è®¤ï¼š</p>
<ul>
<li>ç±»å‹æ˜¯å¦ä¸º App Store</li>
<li>ç»‘å®šçš„ Bundle ID</li>
<li>ä½¿ç”¨çš„è¯ä¹¦æŒ‡çº¹</li>
</ul>
<p>è¿™ä¸ªåŠ¨ä½œè™½ç„¶ç®€å•ï¼Œä½†å®ƒèƒ½æå‰æ’é™¤å¤§é‡éšè”½é—®é¢˜ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3059a0a6f09a418c96aede86859fa18e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=RoOg2S%2FppiCmwZVGhcEXkad85a0%3D" alt="æŸ¥çœ‹æ–‡ä»¶" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3"><strong>æ„å»ºåªæ˜¯ç”Ÿæˆ IPAï¼Œä¸ç­‰äºâ€œå¯ä»¥å‘å¸ƒâ€</strong></h2>
<p>æ— è®ºæ˜¯ Xcodeã€æœ¬åœ°æ„å»ºï¼Œè¿˜æ˜¯ Fastlaneã€CI ç”Ÿæˆçš„ IPAï¼Œæ„å»ºæˆåŠŸéƒ½ä¸ä»£è¡¨è¿™ä¸ªåŒ…å·²ç»å…·å¤‡å‘å¸ƒæ¡ä»¶ã€‚</p>
<p>åœ¨å¤šä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘é‡åˆ°è¿‡ï¼š</p>
<ul>
<li>IPA å†… Bundle ID ä¸é¢„æœŸä¸ä¸€è‡´</li>
<li>ä½¿ç”¨äº†è°ƒè¯•ç­¾å</li>
<li>ç¼ºå°‘å›¾æ ‡èµ„æºæˆ– Assets</li>
<li>Info.plist æƒé™è¯´æ˜ä¸å®Œæ•´</li>
</ul>
<p>è¿™äº›é—®é¢˜å¦‚æœç­‰åˆ°ä¸Šä¼ æˆ–å®¡æ ¸é˜¶æ®µæ‰æš´éœ²ï¼Œå¤„ç†æˆæœ¬ä¼šæ˜æ˜¾å¢åŠ ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨å‘å¸ƒå‰ï¼Œæˆ‘ä¼šæŠŠ IPA å½“æˆä¸€ä¸ªéœ€è¦è¢«æ£€æŸ¥çš„å·¥ç¨‹äº§ç‰©ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªâ€œç”Ÿæˆå³ç”¨â€çš„æ–‡ä»¶ã€‚
é€šè¿‡ å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰æŸ¥çœ‹ IPA å†…å®¹ï¼Œå¯ä»¥åœ¨ä¸ä¾èµ– Xcode çš„æƒ…å†µä¸‹ç¡®è®¤è¿™äº›å…³é”®ä¿¡æ¯ã€‚</p>
<hr/>
<h2 data-id="heading-4"><strong>ä¸Šä¼ å¹¶ä¸åªæ˜¯â€œç‚¹ä¸€ä¸‹æŒ‰é’®â€</strong></h2>
<p>åœ¨å•äººå¼€å‘æ—¶ï¼Œç”¨ Xcode æˆ– Transporter ä¸Šä¼  IPA å¾ˆè‡ªç„¶ã€‚ä½†åœ¨å›¢é˜Ÿç¯å¢ƒä¸­ï¼Œä¸Šä¼ å¾€å¾€æ¶‰åŠï¼š</p>
<ul>
<li>è°è´Ÿè´£ä¸Šä¼ </li>
<li>ä¸Šä¼ æ˜¯å¦å¯é‡å¤</li>
<li>æ˜¯å¦èƒ½è‡ªåŠ¨åŒ–</li>
<li>æ˜¯å¦ä¾èµ–ç‰¹å®šç³»ç»Ÿ</li>
</ul>
<p>å½“æ„å»ºå‘ç”Ÿåœ¨ CI æˆ–äº‘ç«¯ï¼Œè€Œä¸Šä¼ ä»ç„¶åªèƒ½åœ¨æŸä¸€å° Mac ä¸Šå®Œæˆæ—¶ï¼Œå‘å¸ƒæµç¨‹å°±ä¼šå˜å¾—è„†å¼±ã€‚</p>
<p>åœ¨ä¸€äº›é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ <strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰çš„å‘½ä»¤è¡Œä¸Šä¼ æ–¹å¼</strong>ï¼ŒåŸå› å¾ˆç›´æ¥ï¼š</p>
<ul>
<li>å¯ä»¥åœ¨ Windowsã€Linux æˆ– macOS ä¸Šæ‰§è¡Œ</li>
<li>æ”¯æŒå‘½ä»¤è¡Œï¼Œä¾¿äºè„šæœ¬åŒ–</li>
<li>æ„å»ºå’Œä¸Šä¼ å¯ä»¥æ‹†åˆ†ä¸ºç‹¬ç«‹é˜¶æ®µ</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u appleid@example.com -p xxxx-xxxx -c 1 -f app.ipa
</code></pre>
<p>è¿™å¹¶ä¸ä¼šæ”¹å˜è‹¹æœçš„å®¡æ ¸è§„åˆ™ï¼Œä½†å®ƒæ”¹å˜äº†å‘å¸ƒæµç¨‹çš„ç»„ç»‡æ–¹å¼ã€‚
GUIç•Œé¢ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fbea7ef78f4589b294f1d31dd80dba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=MpDh0TcuBxBUoZx7KphAAlQed1s%3D" alt="ipaä¸Šä¼ " loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5"><strong>å‘å¸ƒä¹‹åï¼Œæµç¨‹å¹¶æ²¡æœ‰çœŸæ­£ç»“æŸ</strong></h2>
<p>IPA ä¸Šä¼ åªæ˜¯å‘å¸ƒè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚
åç»­è¿˜åŒ…æ‹¬ï¼š</p>
<ul>
<li>App Store Connect ä¸­çš„å…ƒæ•°æ®é…ç½®</li>
<li>TestFlight éªŒè¯</li>
<li>å®¡æ ¸æ²Ÿé€š</li>
</ul>
<p>è¿™äº›æ­¥éª¤å¤§å¤šæ˜¯ Web æ“ä½œï¼Œä½†å®ƒä»¬æ˜¯å¦é¡ºåˆ©ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå‰é¢å·¥ç¨‹æ­¥éª¤æ˜¯å¦å¹²å‡€ã€‚</p>
<p>å¦‚æœè¯ä¹¦ã€Bundle IDã€IPA æœ¬èº«éƒ½æ²¡æœ‰é—®é¢˜ï¼Œå‘å¸ƒé˜¶æ®µé€šå¸¸ä¸ä¼šå†å‡ºç°æŠ€æœ¯å±‚é¢çš„é˜»æ–­ã€‚</p>
<hr/>
<h2 data-id="heading-6"><strong>å›å¤´çœ‹ï¼ŒiOS å‘å¸ƒæ›´åƒä¸€æ¡æµæ°´çº¿ä¸€æ ·</strong></h2>
<p>åœ¨ç»å†è¿‡å¤šæ¬¡å‘å¸ƒä¹‹åï¼Œæˆ‘å¯¹ iOS å‘å¸ƒå…¨æµç¨‹çš„ç†è§£é€æ¸å‘ç”Ÿå˜åŒ–ï¼š</p>
<ul>
<li>å®ƒä¸æ˜¯ä¸€ä¸ªå·¥å…·èƒ½è§£å†³çš„äº‹æƒ…</li>
<li>å®ƒä¸æ˜¯å¼€å‘ç»“æŸåçš„é™„å±åŠ¨ä½œ</li>
<li>å®ƒæ›´åƒä¸€æ¡éœ€è¦è¢«è®¾è®¡å’Œç»´æŠ¤çš„å·¥ç¨‹æµæ°´çº¿</li>
</ul>
<p>Xcodeã€Fastlaneã€CIã€æ„å»ºå·¥å…·å’Œå¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰å„è‡ªè´Ÿè´£ä¸åŒé˜¶æ®µ</p>
<p>å½“æ¯ä¸€æ­¥éƒ½æ¸…æ¥šè‡ªå·±åœ¨å¤„ç†ä»€ä¹ˆå¯¹è±¡ï¼Œå‘å¸ƒæµç¨‹æ‰çœŸæ­£å˜å¾—ç¨³å®šã€‚</p>
<hr/>
<p>iOS å‘å¸ƒå…¨æµç¨‹çš„éš¾ç‚¹ï¼Œå¾ˆå°‘ä½“ç°åœ¨æŸä¸€ä¸ªå…·ä½“æ“ä½œä¸Šï¼Œè€Œæ˜¯ä½“ç°åœ¨å¤šä¸ªç¯èŠ‚ä¹‹é—´çš„è¡”æ¥è´¨é‡ã€‚
å½“æˆ‘å¼€å§‹ç”¨å·¥ç¨‹çš„è§†è§’çœ‹å¾…è¯ä¹¦ã€Bundle IDã€æè¿°æ–‡ä»¶ã€IPA å’Œä¸Šä¼ è¡Œä¸ºæ—¶ï¼Œå‘å¸ƒè¿™ä»¶äº‹æ‰ä¸å†å……æ»¡ä¸ç¡®å®šæ€§ã€‚</p>
<p>ä»£ç åªæ˜¯äº¤ä»˜çš„ä¸€éƒ¨åˆ†ï¼Œå‘å¸ƒæµç¨‹æœ¬èº«ï¼ŒåŒæ ·éœ€è¦è¢«è®¤çœŸå¯¹å¾…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é‡ç£…ï¼å°ç±³åˆšåˆšå‘å¸ƒæ–°æ¨¡å‹MiMo-V2-Flashå¼€æºäº†ï¼]]></title>    <link>https://juejin.cn/post/7584680708125687854</link>    <guid>https://juejin.cn/post/7584680708125687854</guid>    <pubDate>2025-12-17T08:07:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708125687854" data-draft-id="7584725608866545690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡ç£…ï¼å°ç±³åˆšåˆšå‘å¸ƒæ–°æ¨¡å‹MiMo-V2-Flashå¼€æºäº†ï¼"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-17T08:07:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæ³ŠAI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡ç£…ï¼å°ç±³åˆšåˆšå‘å¸ƒæ–°æ¨¡å‹MiMo-V2-Flashå¼€æºäº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæ³ŠAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:07:54.000Z" title="Wed Dec 17 2025 08:07:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¼€æºç•Œåˆæ¥äº†ä¸€ä½é‡é‡çº§æ–°æˆå‘˜ï¼å°ç±³ä»Šå¤©æ­£å¼æ¨å‡ºå¹¶å¼€æºå…¶æœ€æ–°æ¨¡å‹ â€ŒMiMo-V2-Flashâ€Œã€‚</p>
<p>è¯¥æ¨¡å‹é‡‡ç”¨ä¸“å®¶æ··åˆæ¶æ„ï¼ˆMoEï¼‰ï¼Œæ€»å‚æ•°é‡è¾¾ â€Œ3090 äº¿â€Œï¼Œæ´»è·ƒå‚æ•°ä¸º â€Œ150 äº¿â€Œï¼Œæ€§èƒ½è¡¨ç°è¶³ä»¥ä¸å½“å‰é¡¶å°–å¼€æºæ¨¡å‹ â€ŒDeepSeek-V3.2â€Œã€â€ŒKimi-K2â€Œ ç­‰åª²ç¾ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cfceae5f2ce4b74a1943655fb261697~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=0Zmx2wmgmyNe83dqCqUezYQjnFk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ­¤å¤–ï¼ŒMiMo-V2-Flash çš„ä»£ç éµå¾ª MIT å¼€æºåè®®ï¼ŒåŸºç¡€æ¨¡å‹æƒé‡å·²åŒæ­¥ä¸Šä¼ è‡³ Hugging Face å¹³å°ä¾›å…¬å¼€ä½¿ç”¨ã€‚</p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b9124d1b4c245c299b4b24144a94091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=ZUi8b2XvAdocnUF4DcFVDwYW9O4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æŠ›å¼€"å¼€æº"ä¸è°ˆï¼Œæ–°æ¨¡å‹çš„æ ¸å¿ƒçªç ´å°±æ˜¯æ¶æ„è®¾è®¡çš„é¢ è¦†æ€§é©æ–°ï¼Œå®ç°â€Œ150 tokens/ç§’â€Œçš„æ¨ç†é€Ÿåº¦ï¼Œå¹¶å°†æˆæœ¬æ§åˆ¶åœ¨æ¯ç™¾ä¸‡tokenè¾“å…¥â€Œ0.1ç¾å…ƒâ€Œã€è¾“å‡ºâ€Œ0.3ç¾å…ƒâ€Œï¼Œä»¥æè‡´æ€§ä»·æ¯”ä¸ºæœ€å¤§å–ç‚¹ã€‚ï¼ˆè¿˜å¾—æ˜¯å°ç±³ï¼ï¼‰</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0f0b57e51b9405ea386e4e6d0815d78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=m77pLBHJWbHWxPdP3rZf3IEizys%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ ¹æ®å®˜æ–¹ä½“éªŒé¡µé¢ä¿¡æ¯ï¼ŒMiMo-V2-Flash è¿˜å…·å¤‡æ·±åº¦æ€è€ƒå’Œè”ç½‘æœç´¢èƒ½åŠ›ï¼Œä¸ä»…å¯ç”¨äºæ—¥å¸¸å¯¹è¯äº¤æµï¼Œè¿˜èƒ½åœ¨è·å–å®æ—¶æ•°æ®ã€è¿½è¸ªæœ€æ–°åŠ¨æ€æˆ–éªŒè¯èµ„æ–™æ—¶å‘æŒ¥ä½œç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a114bd352cab4260a008d72ed216f2ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=nVxtFUySgwqOWgBTMIoQFczMhvk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>å¼€æºæ¨¡å‹æ–°æ ‡æ†ï¼ŒMiMo-V2-Flash è·‘åˆ†å…¨çº¿å¼€èŠ±</strong></p>
<p>â€Œæ€§èƒ½è¡¨ç°æ–¹é¢â€Œï¼ŒMiMo-V2-Flashçš„æµ‹è¯•æ•°æ®å¦‚ä¸‹ï¼š</p>
<p>åœ¨AIME 2025æ•°å­¦ç«èµ›ä¸GPQA-Diamondç§‘å­¦çŸ¥è¯†æµ‹è¯•ä¸­ï¼Œè¯¥æ¨¡å‹å‡ä½åˆ—å¼€æºæ¨¡å‹â€Œå‰ä¸¤åâ€Œã€‚</p>
<p>è€Œä¸”ç¼–ç¨‹èƒ½åŠ›å¾ˆçªå‡ºï¼SWE-bench Verifiedæµ‹è¯•ä»¥â€Œ73.4%â€Œçš„å¾—åˆ†ç‡ç¢¾å‹æ‰€æœ‰å¼€æºæ¨¡å‹ï¼Œé€¼è¿‘GPT-5-Highæ°´å¹³ã€‚è¯¥æµ‹è¯•è¦æ±‚AIä¿®å¤çœŸå®è½¯ä»¶æ¼æ´ï¼Œâ€Œ73.4%çš„æˆåŠŸç‡â€Œå……åˆ†è¯æ˜å…¶å¯åº”å¯¹ç»å¤§å¤šæ•°å®é™…ç¼–ç¨‹æŒ‘æˆ˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d22f89b37350463ea05d4bc324534c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=0RixEO5oYQI7j7WiNO2rHka%2BFRY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>å¤šè¯­è¨€ç¼–ç¨‹åŸºå‡†æµ‹è¯•è¡¨ç°â€Œ</strong></p>
<p>åœ¨SWE-Bench Multilingualçš„è¯„ä¼°ä¸­ï¼ŒMiMo-V2-Flashå±•ç°å‡º71.7%çš„ä»£ç é—®é¢˜è§£å†³ç‡ã€‚</p>
<p><strong>â€Œæ™ºèƒ½ä½“ä»»åŠ¡æ€§èƒ½åˆ†æâ€Œ</strong></p>
<p>â€ŒÏ„Â²-Benchåˆ†ç±»å¾—åˆ†â€Œï¼š</p>
<p>é€šä¿¡é¢†åŸŸä»¥95.3åˆ†é¢†å…ˆï¼Œé›¶å”®ç±»è¾¾79.5åˆ†ï¼Œèˆªç©ºç±»ä¸º66.0åˆ†ã€‚</p>
<p>â€Œæœç´¢ä»£ç†èƒ½åŠ›â€Œï¼š</p>
<p>BrowseCompåˆå§‹å¾—åˆ†45.4ï¼Œé€šè¿‡ä¸Šä¸‹æ–‡ç®¡ç†ä¼˜åŒ–åæ˜¾è‘—æå‡è‡³58.3åˆ†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c157274166bc479697b6bc8f5f313540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=%2B%2BzN3L%2FXi1mM5beCpMy3dNw2y98%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®éªŒæ•°æ®è¡¨æ˜ï¼ŒMiMo-V2-Flash ä¸ä»…å…·å¤‡ä»£ç ç”Ÿæˆèƒ½åŠ›ï¼Œæ›´èƒ½æ·±å…¥è§£æå¤æ‚ä»»åŠ¡é€»è¾‘ï¼Œå®ç°å¤šè½®æ™ºèƒ½ä½“ååŒäº¤äº’ã€‚å…¶å†™ä½œè´¨é‡åª²ç¾é¡¶å°–é—­æºæ¨¡å‹ï¼Œè¿›ä¸€æ­¥éªŒè¯äº†è¯¥æ¨¡å‹ä¸ä»…æ˜¯é«˜æ•ˆå·¥å…·ï¼Œæ›´èƒ½èƒœä»»æ—¥å¸¸è¾…åŠ©è§’è‰²ã€‚</p>
<p>åœ¨ç»´æŒé•¿æ–‡æœ¬å¤„ç†æ€§èƒ½çš„å‰æä¸‹ï¼ŒMiMo-V2-Flash æ˜¾è‘—é™ä½äº†æˆæœ¬ï¼Œè¿™ä¸€çªç ´æºäºä¸¤é¡¹å…³é”®æŠ€æœ¯é©æ–°ï¼š</p>
<p>â€Œæ··åˆæ»‘åŠ¨çª—å£æ³¨æ„åŠ›æœºåˆ¶â€Œï¼šä¼ ç»Ÿå¤§æ¨¡å‹é‡‡ç”¨å…¨å±€æ³¨æ„åŠ›æœºåˆ¶æ—¶ï¼Œè®¡ç®—å¤æ‚åº¦å‘ˆäºŒæ¬¡å¢é•¿ï¼ŒKV ç¼“å­˜å­˜å‚¨éœ€æ±‚ä¹Ÿéšä¹‹æ¿€å¢ã€‚</p>
<p>â€Œåˆ›æ–°æ¶æ„è®¾è®¡â€Œï¼šé€šè¿‡é‡‡ç”¨5:1çš„æ¿€è¿›åˆ†å±‚ç­–ç•¥ï¼ˆ5å±‚æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ä¸1å±‚å…¨å±€æ³¨æ„åŠ›äº¤æ›¿è¿è¡Œï¼‰ï¼Œæ»‘åŠ¨çª—å£ä»…èšç„¦128ä¸ªtokenã€‚è¯¥æ–¹æ¡ˆä½¿KVç¼“å­˜å­˜å‚¨é‡ç¼©å‡çº¦6å€ï¼ŒåŒæ—¶å®Œæ•´ä¿ç•™äº†256kä¸Šä¸‹æ–‡çª—å£çš„é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3f8e9520be14ebb904ee291e8a24278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=x0YfFAss%2BpwaPz13rZgiWsQxvuI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å°½ç®¡é‡‡ç”¨å¦‚æ­¤æ¿€è¿›çš„çª—å£é…ç½®ï¼Œæ¨¡å‹ä»èƒ½ä¿æŒé•¿æ–‡æœ¬å¤„ç†çš„ç¨³å®šæ€§ã€‚ç½—ç¦è‰åœ¨ç¤¾äº¤åª’ä½“ä¸Šæ­ç¤ºäº†ä¸€ä¸ªè¿åç›´è§‰çš„ç»“è®ºï¼šçª—å£å°ºå¯¸128è¢«éªŒè¯ä¸º"æœ€ä¼˜ç”œç‚¹å€¼"ã€‚</p>
<p>å®éªŒæ•°æ®æ˜¾ç¤ºï¼Œè¿‡åº¦æ‰©å±•çª—å£ï¼ˆä¾‹å¦‚æå‡è‡³512ï¼‰å°†ç›´æ¥å¼•å‘æ€§èƒ½è¡°å‡ã€‚æ­¤å¤–ï¼Œå¥¹æ˜ç¡®å¼ºè°ƒï¼Œåœ¨è¯¥æœºåˆ¶çš„åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œâ€Œsink valuesâ€Œçš„ä¿ç•™å¯¹æ€§èƒ½ç»´æŒè‡³å…³é‡è¦ï¼Œä»»ä½•æƒ…å†µä¸‹å‡ä¸å¯çœç•¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/025822c39872482680025932b6af9272~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=imGDrmlErbdQjgtlHT68n83S4YQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™é¡¹åˆ›æ–°æŠ€æœ¯åä¸ºè½»é‡çº§å¤šTokené¢„æµ‹ï¼ˆMTPï¼‰ã€‚ä¼ ç»Ÿæ–‡æœ¬ç”Ÿæˆæ¨¡å‹æ¯æ¬¡ä»…èƒ½è¾“å‡ºä¸€ä¸ªTokenï¼Œå¦‚åŒé€å­—è¾“å…¥çš„æ‰“å­—æœºã€‚è€ŒMiMo-V2-Flashå‡­å€Ÿå…¶å†…ç½®çš„MTPæ¨¡å—ï¼Œå¯åŒæ­¥é¢„æµ‹åç»­å¤šä¸ªTokenï¼Œå®ç°"ä¸€çŒœå¤šè¯"çš„é«˜æ•ˆè¾“å‡ºã€‚</p>
<p>å®é™…æµ‹è¯•æ˜¾ç¤ºï¼Œè¯¥æŠ€æœ¯å¹³å‡æ¯æ¬¡å¯å¤„ç†2.8è‡³3.6ä¸ªTokenï¼Œæ¨ç†æ•ˆç‡æå‡è¾¾2è‡³2.6å€ã€‚å…¶ä¼˜åŠ¿ä¸ä»…ä½“ç°åœ¨æ¨ç†ç¯èŠ‚ï¼Œè¿˜èƒ½ä¼˜åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„é‡‡æ ·é€Ÿåº¦ï¼Œé™ä½GPUé—²ç½®ç‡ï¼Œè¾¾æˆè®­ç»ƒä¸æ¨ç†çš„åŒé‡åŠ é€Ÿæ•ˆæœã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87870e4927084770a562d2dfecaa17a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=G46m7ohoKV5nweL4HhAiQV5dBCw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç½—ç¦è‰æŒ‡å‡ºï¼Œé‡‡ç”¨ä¸‰å±‚MTPæ¶æ„æ—¶ï¼Œå®éªŒæ•°æ®æ˜¾ç¤ºå¹³å‡æ¥å—é•¿åº¦çªç ´3ï¼Œç¼–ç æ•ˆç‡æå‡è‡³åŸæœ‰æ°´å¹³çš„2.5å€ã€‚è¯¥æ–¹æ³•æ˜¾è‘—æ”¹å–„äº†å°æ‰¹é‡On-Policyå¼ºåŒ–å­¦ä¹ åœºæ™¯ä¸­å› "é•¿å°¾æ ·æœ¬"å¯¼è‡´çš„GPUèµ„æºé—²ç½®é—®é¢˜ã€‚</p>
<p>æ‰€è°“é•¿å°¾æ ·æœ¬ï¼Œå³é‚£äº›å¤æ‚åº¦é«˜ã€è€—æ—¶é•¿çš„ä»»åŠ¡ï¼Œä¼šé˜»å¡åç»­ä»»åŠ¡æ‰§è¡Œï¼Œå¯¼è‡´GPUå¤„äºç­‰å¾…çŠ¶æ€ã€‚MTPæŠ€æœ¯é€šè¿‡åˆ›æ–°æœºåˆ¶è§£å†³äº†è¿™ä¸€ç“¶é¢ˆï¼Œå®ç°èµ„æºåˆ©ç”¨ç‡çš„å¤§å¹…æå‡ã€‚</p>
<p>åŒæ—¶ç½—ç¦è‰è¯´æ˜ï¼Œç”±äºé¡¹ç›®å‘¨æœŸé™åˆ¶ï¼Œå½“å‰å°šæœªå®ŒæˆMTPä¸RLè®­ç»ƒå¾ªç¯çš„å…¨é¢æ•´åˆï¼Œä½†ä¸¤è€…åœ¨æ¶æ„è®¾è®¡ä¸Šå…·æœ‰é«˜åº¦å…¼å®¹æ€§ã€‚å°ç±³å·²å¼€æ”¾ä¸‰å±‚MTPçš„æºä»£ç ï¼Œå¼€å‘è€…å¯å°†å…¶ç›´æ¥åº”ç”¨äºå®é™…é¡¹ç›®ä¸­è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p>
<p><strong>ç®—åŠ›åªç”¨ 1/50ï¼Œæ€§èƒ½å¦‚ä½•ä¸æ‰“æŠ˜ï¼Ÿ</strong></p>
<p><strong>â€Œé¢„è®­ç»ƒé˜¶æ®µâ€Œ</strong></p>
<p>æ–°æ¨¡å‹é‡‡ç”¨FP8æ··åˆç²¾åº¦è®­ç»ƒæ¡†æ¶ï¼Œåœ¨è§„æ¨¡è¾¾27ä¸‡äº¿tokençš„æ•°æ®é›†ä¸Šå®Œæˆè®­ç»ƒï¼Œå¹¶åŸç”Ÿæ”¯æŒ32kè¶…é•¿åºåˆ—å¤„ç†ã€‚FP8æ··åˆç²¾åº¦é€šè¿‡å‹ç¼©æ•°å€¼ä½å®½å®ç°é«˜æ•ˆè®¡ç®—ï¼Œåœ¨æ˜¾è‘—é™ä½æ˜¾å­˜å ç”¨çš„åŒæ—¶ç»´æŒæ¨¡å‹ç²¾åº¦ï¼Œå½“å‰è¡Œä¸šåº”ç”¨è¾ƒå°‘ï¼Œéœ€å¯¹åº•å±‚è®¡ç®—æ¶æ„è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚</p>
<p><strong>â€Œåè®­ç»ƒé˜¶æ®µâ€Œ</strong></p>
<p>å°ç±³å›¢é˜Ÿåˆ›æ–°æ€§åœ°å¼€å‘äº†å¤šæ•™å¸ˆåœ¨çº¿ç­–ç•¥è’¸é¦ï¼ˆMOPDï¼‰æ–¹æ³•ã€‚ä¼ ç»Ÿç›‘ç£å¾®è°ƒç»“åˆå¼ºåŒ–å­¦ä¹ çš„è®­ç»ƒç®¡çº¿å­˜åœ¨è®­ç»ƒæ³¢åŠ¨å¤§ã€è®¡ç®—èµ„æºæ¶ˆè€—é«˜ç­‰ç¼ºé™·ã€‚MOPDçš„æ ¸å¿ƒæœºåˆ¶æ˜¯ï¼šé€šè¿‡å­¦ç”Ÿæ¨¡å‹è‡ªä¸»é‡‡æ ·ç­–ç•¥åˆ†å¸ƒï¼Œç”±å¤šä¸“å®¶æ•™å¸ˆç½‘ç»œå¯¹æ¯ä¸ªtokenå®æ–½é«˜å¯†åº¦å¥–åŠ±åé¦ˆï¼Œä»è€Œæå‡è®­ç»ƒæ•ˆç‡ä¸ç¨³å®šæ€§ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63317782b59a4474b520d4483b85065b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=VLplEaL8y8ey3sRIoOMJGyG%2F%2FNg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é€šä¿—æ¥è®²ï¼Œå­¦ç”Ÿæ¨¡å‹å°±åƒåœ¨å®æ—¶å®Œæˆä½œä¸šï¼Œæ•™å¸ˆæ¨¡å‹ä¼šå¯¹æ¯ä¸ªå­—å³æ—¶æ‰“åˆ†ï¼Œæ— éœ€ç­‰å¾…æ•´ç¯‡ä½œä¸šæäº¤ã€‚è¿™ç§æœºåˆ¶è®©å­¦ç”Ÿæ¨¡å‹èƒ½å¿«é€Ÿå¸æ”¶æ•™å¸ˆæ¨¡å‹çš„ç²¾åï¼ŒåŒæ—¶è®­ç»ƒè¿‡ç¨‹æ›´åŠ ç¨³å®šã€‚</p>
<p>æœ€æƒŠäººçš„æ˜¯æ•ˆç‡çªç ´ã€‚MOPDä»…éœ€ä¼ ç»Ÿæ–¹æ³•1/50çš„ç®—åŠ›ï¼Œå°±èƒ½è®©å­¦ç”Ÿæ¨¡å‹è¾¾åˆ°æ•™å¸ˆæ¨¡å‹çš„æ€§èƒ½å·…å³°ã€‚è¿™ä½¿å¾—å°ç±³èƒ½å¤Ÿä»¥æ›´ä½çš„èµ„æºæ¶ˆè€—å®ç°æ›´å¿«é€Ÿçš„æ¨¡å‹è¿­ä»£ã€‚</p>
<p>æ­¤å¤–ï¼ŒMOPDå…·å¤‡åŠ¨æ€æ¥å…¥æ–°æ•™å¸ˆçš„èƒ½åŠ›ï¼Œæˆé•¿åçš„å­¦ç”Ÿæ¨¡å‹å¯åå‘æ‹…ä»»æ•™å¸ˆè§’è‰²ï¼Œæ„å»º"æ•™å­¦ç›¸é•¿"çš„é—­ç¯è¿›åŒ–ç³»ç»Ÿã€‚ä»Šå¤©çš„å­¦å‘˜ã€æ˜å¤©çš„å¯¼å¸ˆã€åå¤©åŸ¹å…»å‡ºæ›´ä¼˜ç§€çš„å­¦ç”Ÿï¼Œè¿™ç§å±‚å±‚é€’è¿›çš„å¼ºåŒ–æœºåˆ¶ç¡®å®é¢‡å…·åˆ›æ–°æ€§ã€‚</p>
<p>æ­£å¦‚ç½—ç¦è‰æ‰€è¿°ï¼Œå›¢é˜ŸåŸºäºThinking Machineçš„On-Policy Distillationæ–¹æ³•è®ºï¼Œé€šè¿‡èåˆå¤šä¸ªå¼ºåŒ–å­¦ä¹ æ¨¡å‹ï¼Œå®ç°äº†æ•ˆç‡çš„æ˜¾è‘—æå‡ã€‚è¿™ä¸ä»…å»ºç«‹äº†è‡ªæˆ‘å¼ºåŒ–çš„å¾ªç¯ç³»ç»ŸåŸºç¡€ï¼Œæ›´ä½¿å¾—å­¦ç”Ÿæ¨¡å‹èƒ½æŒç»­è¿›åŒ–ï¼Œæœ€ç»ˆè¶…è¶Šæ•™å¸ˆæ¨¡å‹çš„èƒ½åŠ›è¾¹ç•Œã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e9d1873b5c24a46920a1e2335fc607b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=3OP4AsbE%2F2s0WRQUuuiGEb2x22E%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨æ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ é¢†åŸŸæ‰©å±•æ–¹é¢ï¼Œå°ç±³MiMo-V2-Flashç ”ç©¶å›¢é˜Ÿé€šè¿‡çœŸå®GitHub issueæ„å»ºäº†è§„æ¨¡è¾¾10ä¸‡+çš„å¯éªŒè¯ä»»åŠ¡ä½“ç³»ã€‚å…¶è‡ªåŠ¨åŒ–æµæ°´çº¿éƒ¨ç½²äºKubernetesé›†ç¾¤ç¯å¢ƒï¼Œæ”¯æŒæœ€é«˜10000+ Podå¹¶å‘è¿è¡Œï¼Œå®ç°70%çš„ç¯å¢ƒéƒ¨ç½²æˆåŠŸç‡ã€‚</p>
<p>é’ˆå¯¹ç½‘é¡µå¼€å‘åœºæ™¯çš„åˆ›æ–°è®¾è®¡ä½“ç°åœ¨å¤šæ¨¡æ€éªŒè¯æœºåˆ¶ä¸Šï¼Œé‡‡ç”¨åŠ¨æ€è§†é¢‘å½•åˆ¶æ›¿ä»£ä¼ ç»Ÿé™æ€æˆªå›¾éªŒè¯ï¼Œæœ‰æ•ˆè§„é¿è§†è§‰è¯¯å·®é—®é¢˜ï¼Œç²¾å‡†ä¿éšœä»£ç æ‰§è¡Œå‡†ç¡®æ€§ã€‚è¯¥æ¨¡å‹ä¸å¼€å‘è€…ç”Ÿæ€çš„å…¼å®¹æ€§è¡¨ç°çªå‡ºï¼Œå¯æ— ç¼é›†æˆClaude Codeã€Cursorã€Clineç­‰ä¸»æµå¼€å‘å·¥å…·ï¼Œå‡­å€Ÿ256Kè¶…é•¿ä¸Šä¸‹æ–‡çª—å£å®¹é‡ï¼ˆç›¸å½“äºä¸€éƒ¨ä¸­ç¯‡å°è¯´æˆ–æ•°åé¡µæŠ€æœ¯æ–‡æ¡£çš„æ–‡æœ¬é‡ï¼‰ï¼Œæ”¯æŒæ•°ç™¾è½®æ™ºèƒ½ä½“äº¤äº’ä¸å¤æ‚å·¥å…·è°ƒç”¨æµç¨‹çš„ç¨³å®šæ‰§è¡Œã€‚</p>
<p>æŠ€æœ¯å¼€æºæ–¹é¢ï¼Œå°ç±³ä¸ä»…å°†å®Œæ•´æ¨ç†ä»£ç è´¡çŒ®è‡³SGLangé¡¹ç›®ï¼Œè¿˜é€šè¿‡LMSYSåšå®¢å…¬å¼€äº†æ·±åº¦ä¼˜åŒ–ç»éªŒã€‚æŠ€æœ¯æŠ¥å‘ŠæŠ«éœ²äº†å…¨é‡æ¨¡å‹å‚æ•°ç»†èŠ‚ï¼ŒåŒ…å«MiMo-V2-Flash-Baseåœ¨å†…çš„æ‰€æœ‰æ¨¡å‹æƒé‡å‡é€šè¿‡Hugging Faceå¹³å°ä»¥MITåè®®å¼€æ”¾ã€‚è¿™ç§ç¨‹åº¦çš„å¼€æºå®è·µåœ¨å›½å†…å¤´éƒ¨ç§‘æŠ€ä¼ä¸šä¸­å…·æœ‰æ˜¾è‘—çªç ´æ€§ã€‚å½“å‰è¯¥æ¨¡å‹å·²åœ¨API Platformæä¾›é™æ—¶å…è´¹æœåŠ¡ï¼Œå¼€å‘è€…å¯ç«‹å³æ¥å…¥å®é™…å¼€å‘ç¯å¢ƒè¿›è¡Œä½“éªŒéªŒè¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0990129288cc44baac6fb1985bbc359f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=sb%2BEJmj6cqLPQe0XSxrRO%2F0G8hY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>å°ç±³çš„ AI é‡å¿ƒï¼Œä¸æ­¢äºæ‰‹æœºåŠ©æ‰‹</strong></p>
<p>MiMo-V2-Flashçš„æ¨å‡ºï¼Œå±•ç°äº†å°ç±³åœ¨AIé¢†åŸŸçš„æˆ˜ç•¥å¸ƒå±€å…¨é¢å‡çº§ã€‚</p>
<p>æ®ç½—ç¦è‰åœ¨ç¤¾äº¤åª’ä½“æŠ«éœ²çš„æœ€æ–°åŠ¨æ€ï¼Œ"MiMo-V2-Flashç°å·²å¼€æ”¾ä½¿ç”¨ã€‚è¿™ä»…æ˜¯æˆ‘ä»¬åœ¨AGIå‘å±•è·¯å¾„ä¸­çš„ç¬¬äºŒä¸ªé‡Œç¨‹ç¢‘ã€‚" ä»…ç¬¬äºŒæ­¥ä¾¿å·²å…·å¤‡å¦‚æ­¤çªç ´æ€§ï¼Œåç»­çš„æŠ€æœ¯æ¼”è¿›æ›´ä»¤äººå……æ»¡æƒ³è±¡ç©ºé—´ã€‚</p>
<p>å°ç±³çš„æŠ€æœ¯æ–‡æ¡£åŒæ—¶æŒ‡å‡ºï¼Œå½“å‰MiMo-V2-Flashæ€§èƒ½ä»é¢†å…ˆé—­æºæ¨¡å‹å­˜åœ¨æå‡ç©ºé—´ã€‚ä½†ä¼ä¸šæˆ˜ç•¥æ¸…æ™°å¯è§ï¼šå°†é€šè¿‡æ‰©å±•æ¨¡å‹å‚æ•°ä¸è®¡ç®—èµ„æºæŠ•å…¥æŒç»­ä¼˜åŒ–æ€§èƒ½è¾¹ç•Œï¼ŒåŒæ­¥æ¨è¿›æ›´å¯é ã€æ›´æ•æ·çš„æ™ºèƒ½ä½“æ¡†æ¶ç ”å‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41af4cb3417b4a359d2cbd8c77994d1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=Yr6yiDi0rhFVaama%2Fl6eHQAA0%2F0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨MOPDæ¡†æ¶ä¸­ï¼Œæ•™å¸ˆæ¨¡å‹ä¸å­¦ç”Ÿæ¨¡å‹é€šè¿‡åŒå‘è¿­ä»£å®ç°ååŒè¿›åŒ–ï¼Œä¸ºåç»­çš„æ€§èƒ½æ‹“å±•ä¿ç•™äº†å……åˆ†æ½œåŠ›ã€‚ä»æˆ˜ç•¥å±‚é¢å®¡è§†ï¼Œè¿™æ ‡å¿—ç€å°ç±³å¯¹AIç”Ÿæ€ä½“ç³»çš„ä¸€æ¬¡å…³é”®å¸ƒå±€ã€‚é¢å¯¹æ‰‹æœºã€IoTè®¾å¤‡ä¸æ™ºèƒ½æ±½è½¦æ„æˆçš„ç¡¬ä»¶çŸ©é˜µï¼Œå°ç±³äºŸéœ€ä¸€ä¸ªæ”¯æ’‘å…¨åŸŸçš„AIæ ¸å¿ƒæ¶æ„ï¼Œè€ŒMiMo-V2-Flashæ­£æ˜¯ä¸ºæ­¤æˆ˜ç•¥éœ€æ±‚æ‰“é€ çš„åŸºåº§å‹è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ­£å¦‚2011å¹´å°ç±³æ‰‹æœºä»¥1999å…ƒé¢ è¦†æ——èˆ°æœºå®šä»·ä½“ç³»ï¼Œå½“å‰MiMo-V2-Flashå‡­å€Ÿæè‡´çš„æˆæœ¬æ§åˆ¶ä¸73.4%çš„SWE-BenchåŸºå‡†è¡¨ç°ï¼Œæ­£åœ¨é‡å¡‘å¼€æºå¤§æ¨¡å‹çš„ä»·å€¼æ ‡æ†ã€‚è¿™åœºæŠ€æœ¯ä¸Šçš„é©æ–°ï¼Œæ— ç–‘è¿æ¥äº†å¼€æºé¢†åŸŸå°ç±³çš„çˆ†å‘æ—¶åˆ»ã€‚</p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¸¿è’™HarmonyOSå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜ï¼šAIè¯­éŸ³]]></title>    <link>https://juejin.cn/post/7584443518035968063</link>    <guid>https://juejin.cn/post/7584443518035968063</guid>    <pubDate>2025-12-17T08:04:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518035968063" data-draft-id="7584439538312871999" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¸¿è’™HarmonyOSå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜ï¼šAIè¯­éŸ³ "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-17T08:04:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·859968167769"/> <meta itemprop="url" content="https://juejin.cn/user/2086203644184827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¸¿è’™HarmonyOSå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜ï¼šAIè¯­éŸ³ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2086203644184827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·859968167769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:04:35.000Z" title="Wed Dec 17 2025 08:04:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>é¸¿è’™HarmonyOSå¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜ï¼šAIè¯­éŸ³---xingkeit.top/8704/</strong></p>
<h2 data-id="heading-0">äº²å†é¸¿è’™AIè¯­éŸ³å¤šçº¿ç¨‹å¼€å‘ï¼šæ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹çš„å®æˆ˜ç»éªŒè°ˆ</h2>
<h3 data-id="heading-1">ä»é›¶åˆ°ä¸€çš„é¸¿è’™AIè¯­éŸ³åˆä½“éªŒ</h3>
<p>åˆæ¬¡æ¥è§¦é¸¿è’™ç³»ç»Ÿçš„AIè¯­éŸ³å¼€å‘æ—¶ï¼Œæˆ‘è¢«å…¶å¤šçº¿ç¨‹æ¶æ„ä¸åˆ†å¸ƒå¼èƒ½åŠ›æ‰€éœ‡æ’¼ã€‚ä¸ä¼ ç»Ÿå®‰å“å¼€å‘ç›¸æ¯”ï¼Œé¸¿è’™çš„"ä¸€æ¬¡å¼€å‘ï¼Œå¤šç«¯éƒ¨ç½²"ç‰¹æ€§è®©è¯­éŸ³äº¤äº’å¼€å‘æ•ˆç‡å¤§å¹…æå‡ï¼š</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// åŸºç¡€è¯­éŸ³è¯†åˆ«åˆå§‹åŒ–ï¼ˆHarmonyOSç‰ˆï¼‰</span>
private void <span class="hljs-built_in">initSpeechRecognizer</span>() {
    <span class="hljs-comment">// åˆ›å»ºè¯­éŸ³è¯†åˆ«æ’ä»¶å¯¹è±¡</span>
    mSpeechRecognizer = AudioCaptor<span class="hljs-selector-class">.create</span>(AudioCaptor.AudioCaptorType.TYPE_VOICE_RECOGNITION);
    
    <span class="hljs-comment">// è®¾ç½®ç›‘å¬å™¨</span>
    mSpeechRecognizer<span class="hljs-selector-class">.setCaptorListener</span>(new AudioCaptorListener() {
        <span class="hljs-keyword">@Override</span>
        public void onCaptorDataAvailable(AudioCaptor captor, byte[] bytes) {
            <span class="hljs-comment">// è¯­éŸ³æ•°æ®å¤„ç†çº¿ç¨‹</span>
            new <span class="hljs-built_in">Thread</span>(() -&gt; <span class="hljs-built_in">processVoiceData</span>(bytes))<span class="hljs-selector-class">.start</span>();
        }
    });
}
</code></pre>
<h3 data-id="heading-2">å¤šçº¿ç¨‹å¼€å‘çš„ä¸‰å¤§æ ¸å¿ƒæŒ‘æˆ˜</h3>
<h4 data-id="heading-3">1. çº¿ç¨‹å®‰å…¨ä¸èµ„æºç«äº‰</h4>
<p>è¯­éŸ³å¤„ç†æ¶‰åŠå¤šä¸ªå¹¶è¡Œçº¿ç¨‹ï¼š</p>
<ul>
<li>éŸ³é¢‘é‡‡é›†çº¿ç¨‹</li>
<li>ç‰¹å¾æå–çº¿ç¨‹</li>
<li>ç½‘ç»œè¯·æ±‚çº¿ç¨‹</li>
<li>UIæ›´æ–°çº¿ç¨‹</li>
</ul>
<p>Java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// çº¿ç¨‹å®‰å…¨çš„æ•°æ®å…±äº«æ–¹æ¡ˆ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">VoiceDataBuffer</span> {
    <span class="hljs-keyword">private</span> final ReentrantLock <span class="hljs-keyword">lock</span> = <span class="hljs-keyword">new</span> ReentrantLock();
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span>[] buffer;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateBuffer</span>(<span class="hljs-params"><span class="hljs-built_in">byte</span>[] newData</span>)</span> {
        <span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">this</span>.buffer = newData.clone();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">lock</span>.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-4">2. å®æ—¶æ€§ä¸å»¶è¿Ÿçš„å¹³è¡¡</h4>
<p>è¯­éŸ³äº¤äº’å¯¹å®æ—¶æ€§è¦æ±‚æé«˜ï¼Œæˆ‘ä»¬çš„ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// åŒç¼“å†²é˜Ÿåˆ—å®ç°ä½å»¶è¿Ÿå¤„ç†</span>
ArrayBlockingQueue&lt;byte<span class="hljs-selector-attr">[]</span>&gt; audioQueue = new ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">2</span>); <span class="hljs-comment">// å®¹é‡2çš„é˜Ÿåˆ—</span>

void <span class="hljs-built_in">onAudioData</span>(byte[] data) {
    if (!audioQueue.offer(data)) {  <span class="hljs-comment">// éé˜»å¡å†™å…¥</span>
        audioQueue<span class="hljs-selector-class">.poll</span>();          <span class="hljs-comment">// ä¸¢å¼ƒæ—§æ•°æ®</span>
        audioQueue<span class="hljs-selector-class">.offer</span>(data);
    }
}
</code></pre>
<h4 data-id="heading-5">3. å¤šè®¾å¤‡ååŒçš„åˆ†å¸ƒå¼å¤„ç†</h4>
<p>é¸¿è’™çš„åˆ†å¸ƒå¼èƒ½åŠ›è®©è¯­éŸ³å¤„ç†å¯ä»¥è·¨è®¾å¤‡ï¼š</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å‘ç°é™„è¿‘è®¾å¤‡</span>
List&lt;DeviceInfo&gt; devices = DeviceManager<span class="hljs-selector-class">.getDeviceList</span>(DeviceFilter.ALL);

<span class="hljs-comment">// åˆ†å¸ƒå¼ä»»åŠ¡åˆ†å‘</span>
if (devices.size() &gt; <span class="hljs-number">0</span>) {
    DistributedTaskDispatcher dispatcher = 
        DistributedTaskDispatcher<span class="hljs-selector-class">.getInstance</span>(context);
    dispatcher<span class="hljs-selector-class">.syncDispatch</span>(devices.get(<span class="hljs-number">0</span>), 
        new <span class="hljs-built_in">VoiceProcessTask</span>(rawAudioData));
}
</code></pre>
<h3 data-id="heading-6">è¯­éŸ³å¤„ç†æµæ°´çº¿å®æˆ˜</h3>
<p>æˆ‘ä»¬æ„å»ºçš„é«˜æ•ˆå¤„ç†æµæ°´çº¿ï¼š</p>
<p>PlainText</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[éº¦å…‹é£é‡‡é›†]</span> â†’ <span class="hljs-selector-attr">[ç¯å½¢ç¼“å†²åŒº]</span> â†’ <span class="hljs-selector-attr">[ç‰¹å¾æå–çº¿ç¨‹]</span> 
    â†’ <span class="hljs-selector-attr">[AIæ¨ç†çº¿ç¨‹]</span> â†’ <span class="hljs-selector-attr">[ç»“æœåˆ†å‘çº¿ç¨‹]</span>
</code></pre>
<p>å…³é”®ä»£ç å®ç°ï¼š</p>
<p>Java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç‰¹å¾æå–çº¿ç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FeatureExtractor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (isRunning) {
            <span class="hljs-type">byte</span>[] data = audioQueue.take();
            <span class="hljs-type">float</span>[] features = AudioProcessor.extractMFCC(data);
            featureQueue.put(features);  <span class="hljs-comment">// ä¼ é€’ç»™ä¸‹ä¸€é˜¶æ®µ</span>
        }
    }
}

<span class="hljs-comment">// AIæ¨ç†çº¿ç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AIPredictor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (isRunning) {
            <span class="hljs-type">float</span>[] features = featureQueue.take();
            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Model.predict(features);
            EventBus.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultEvent</span>(result));
        }
    }
}
</code></pre>
<h3 data-id="heading-7">æ–°æ‰‹å¿…çŸ¥çš„äº”ä¸ªè°ƒè¯•æŠ€å·§</h3>
<ol>
<li>
<p><strong>æ—¶é—´æˆ³æ ‡è®°æ³•</strong>ï¼šè·Ÿè¸ªæ•°æ®åœ¨å„çº¿ç¨‹çš„æµè½¬</p>
<p>Java</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"TIMESTAMP"</span>, <span class="hljs-string">"ç‰¹å¾æå–å¼€å§‹: "</span> + 
    System.<span class="hljs-built_in">currentTimeMillis</span>());
</code></pre>
</li>
<li>
<p><strong>çº¿ç¨‹å¯è§†åŒ–å·¥å…·</strong>ï¼šä½¿ç”¨DevEco Studioçš„Thread Analyzer</p>
</li>
<li>
<p><strong>æ¨¡æ‹Ÿå»¶è¿Ÿæµ‹è¯•</strong>ï¼šäººä¸ºæ·»åŠ å»¶è¿ŸéªŒè¯å¥å£®æ€§</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss">Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿå¤„ç†å»¶è¿Ÿ</span>
</code></pre>
</li>
<li>
<p><strong>å†…å­˜å¿«ç…§åˆ†æ</strong>ï¼šæ£€æŸ¥éŸ³é¢‘æ•°æ®çš„å†…å­˜å ç”¨</p>
</li>
<li>
<p><strong>åˆ†å¸ƒå¼è°ƒè¯•æ¨¡å¼</strong>ï¼šé€šè¿‡hilogå‘½ä»¤æŸ¥çœ‹è·¨è®¾å¤‡æ—¥å¿—</p>
<p>Shell</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-perl" lang="perl">hilog | <span class="hljs-keyword">grep</span> VoiceService
</code></pre>
</li>
</ol>
<h3 data-id="heading-8">æ€§èƒ½ä¼˜åŒ–å…³é”®æŒ‡æ ‡</h3>
<p>æˆ‘ä»¬å»ºç«‹çš„ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼š</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>ç›®æ ‡å€¼</th><th>æµ‹é‡æ–¹æ³•</th></tr></thead><tbody><tr><td>ç«¯åˆ°ç«¯å»¶è¿Ÿ</td><td>&lt;300ms</td><td>ä»è¯­éŸ³è¾“å…¥åˆ°å“åº”è¾“å‡ºçš„æ—¶é—´å·®</td></tr><tr><td>CPUå ç”¨ç‡</td><td>&lt;30%</td><td>ä½¿ç”¨PerformanceMonitorç›‘æ§</td></tr><tr><td>å†…å­˜æ³¢åŠ¨</td><td>&lt;50MB</td><td>å†…å­˜å¿«ç…§å¯¹æ¯”</td></tr><tr><td>çº¿ç¨‹åˆ‡æ¢è€—æ—¶</td><td>&lt;5ms</td><td>Systraceå·¥å…·åˆ†æ</td></tr></tbody></table>
<p>ä¼˜åŒ–åçš„çº¿ç¨‹è°ƒåº¦æ–¹æ¡ˆï¼š</p>
<p>Java</p>
<pre><code class="hljs language-ini" lang="ini">// ä½¿ç”¨é¸¿è’™çš„ä¼˜å…ˆçº§çº¿ç¨‹æ± 
TaskDispatcher <span class="hljs-attr">dispatcher</span> = 
    TaskDispatcherFactory.getPriorityDispatcher(
        TaskPriority.HIGH)<span class="hljs-comment">;</span>
        
dispatcher.asyncDispatch(new CriticalTask())<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-9">è¸©å‘è®°å½•ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>å‘1ï¼šéŸ³é¢‘æ•°æ®ä¸¢å¤±</strong></p>
<ul>
<li>
<p>ç°è±¡ï¼šéƒ¨åˆ†è¯­éŸ³ç‰‡æ®µæœªè¢«å¤„ç†</p>
</li>
<li>
<p>åŸå› ï¼šç¼“å†²åŒºæº¢å‡º</p>
</li>
<li>
<p>è§£å†³ï¼šå®ç°åŠ¨æ€ç¼“å†²æ± </p>
<p>Java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AdaptiveBuffer</span> <span class="hljs-variable">audioBuffer</span> <span class="hljs-operator">=</span> 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdaptiveBuffer</span>(<span class="hljs-number">1024</span>, <span class="hljs-number">0.75f</span>);
</code></pre>
</li>
</ul>
<p><strong>å‘2ï¼šè·¨è®¾å¤‡å“åº”ä¸åŒæ­¥</strong></p>
<ul>
<li>
<p>ç°è±¡ï¼šå¤šè®¾å¤‡å“åº”æ—¶é—´å·®å¼‚å¤§</p>
</li>
<li>
<p>è§£å†³ï¼šæ·»åŠ æ—¶é—´åŒæ­¥åè®®</p>
<p>Java</p>
<pre><code class="hljs language-ini" lang="ini">long <span class="hljs-attr">baseTime</span> = DistributedTimeManager.getSyncTime()<span class="hljs-comment">;</span>
</code></pre>
</li>
</ul>
<p><strong>å‘3ï¼šå”¤é†’è¯è¯¯è§¦å‘</strong></p>
<ul>
<li>
<p>ç°è±¡ï¼šç¯å¢ƒå™ªå£°å¯¼è‡´è¯¯å”¤é†’</p>
</li>
<li>
<p>è§£å†³ï¼šäºŒçº§éªŒè¯æœºåˆ¶</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss">if (WakeWordDetector.check(rawAudio)) {
    if (NoiseFilter.verify(rawAudio)) {
        <span class="hljs-built_in">triggerWake</span>();
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-10">ç»™é¸¿è’™æ–°æ‰‹çš„å»ºè®®</h3>
<ol>
<li><strong>å…ˆç†è§£Abilityæ¡†æ¶</strong>ï¼šæŒæ¡Page Abilityå’ŒService Abilityçš„åŒºåˆ«</li>
<li><strong>å–„ç”¨DevEcoå·¥å…·é“¾</strong>ï¼šç‰¹åˆ«æ˜¯åˆ†å¸ƒå¼è°ƒè¯•åŠŸèƒ½</li>
<li><strong>ä»å®˜æ–¹Demoå…¥æ‰‹</strong>ï¼šé‡ç‚¹ç ”ç©¶AIå­ç³»ç»Ÿç¤ºä¾‹</li>
<li><strong>åŠ å…¥é¸¿è’™ç¤¾åŒº</strong>ï¼šåŠæ—¶è·å–æœ€æ–°çš„APIå˜æ›´ä¿¡æ¯</li>
<li><strong>ä¿æŒåŸå­åŒ–è®¾è®¡</strong>ï¼šæ¯ä¸ªAbilityä¿æŒå•ä¸€èŒè´£</li>
</ol>
<p>é¸¿è’™çš„AIè¯­éŸ³å¼€å‘å°±åƒæŒ‡æŒ¥ä¸€æ”¯äº¤å“ä¹å›¢ï¼Œå¤šçº¿ç¨‹æ˜¯å„ç§ä¹å™¨ï¼Œåˆ†å¸ƒå¼èƒ½åŠ›æ˜¯æ¼”å¥å…çš„å£°å­¦è®¾è®¡ã€‚ç»è¿‡è¿™ä¸ªé¡¹ç›®çš„é”¤ç‚¼ï¼Œæˆ‘æ€»ç»“å‡ºé¸¿è’™å¼€å‘çš„é»„é‡‘æ³•åˆ™ï¼š<strong>ç†è§£çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œæ‹¥æŠ±åˆ†å¸ƒå¼æ€ç»´ï¼Œä¸¥æ ¼ç›‘æ§æ€§èƒ½æŒ‡æ ‡</strong>ã€‚è®°ä½ï¼Œä¼˜ç§€çš„é¸¿è’™å¼€å‘è€…ä¸ä»…æ˜¯ç¨‹åºå‘˜ï¼Œæ›´æ˜¯å¤šè®¾å¤‡ååŒäº¤å“ä¹çš„æŒ‡æŒ¥å®¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UE5è™šå¹»å¼•æ“æ±½è½¦HMIè®¾è®¡é«˜çº§ç ”ä¿®è¯¾]]></title>    <link>https://juejin.cn/post/7584439538313052223</link>    <guid>https://juejin.cn/post/7584439538313052223</guid>    <pubDate>2025-12-17T08:14:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584439538313052223" data-draft-id="7584443518036082751" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UE5è™šå¹»å¼•æ“æ±½è½¦HMIè®¾è®¡é«˜çº§ç ”ä¿®è¯¾"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-17T08:14:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·859968167769"/> <meta itemprop="url" content="https://juejin.cn/user/2086203644184827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UE5è™šå¹»å¼•æ“æ±½è½¦HMIè®¾è®¡é«˜çº§ç ”ä¿®è¯¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2086203644184827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·859968167769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:14:04.000Z" title="Wed Dec 17 2025 08:14:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>UE5è™šå¹»å¼•æ“æ±½è½¦HMIè®¾è®¡é«˜çº§ç ”ä¿®è¯¾---xingkeit.top/8657/</strong></p>
<h2 data-id="heading-0">UE5æ±½è½¦HMIè®¾è®¡é¿å‘æŒ‡å—ï¼šé«˜çº§ç ”ä¿®è¯¾æ€»ç»“çš„å¸¸è§æ¸²æŸ“é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-1">HMIæ¸²æŸ“çš„ä¸‰å¤§æ ¸å¿ƒæŒ‘æˆ˜</h3>
<p>åœ¨UE5æ±½è½¦HMIå¼€å‘ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ç€ç‹¬ç‰¹çš„æ¸²æŸ“æŒ‘æˆ˜ï¼Œç ”ä¿®è¯¾å°†è¿™äº›æŒ‘æˆ˜ç³»ç»Ÿå½’çº³ä¸ºï¼š</p>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// HMIæ¸²æŸ“è´¨é‡è¯„ä¼°æŒ‡æ ‡ï¼ˆæ¦‚å¿µä»£ç ï¼‰</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">HMIRenderingMetrics</span> {
    <span class="hljs-type">float</span> frameRate;         <span class="hljs-comment">// å¿…é¡»ç¨³å®šåœ¨60fpsä»¥ä¸Š</span>
    <span class="hljs-type">float</span> latency;           <span class="hljs-comment">// è¾“å…¥å»¶è¿Ÿ&lt;50ms</span>
    <span class="hljs-type">float</span> colorAccuracy;     <span class="hljs-comment">// è‰²å·®Î”E&lt;3</span>
    <span class="hljs-type">bool</span> temporalStability;  <span class="hljs-comment">// æ—¶é—´ç¨³å®šæ€§ï¼ˆæ— é—ªçƒï¼‰</span>
};
</code></pre>
<h3 data-id="heading-2">æè´¨ç³»ç»Ÿå¸¸è§é™·é˜±ä¸ä¿®å¤</h3>
<h4 data-id="heading-3">1. ä»ªè¡¨ç›˜åå…‰å¤±æ§é—®é¢˜</h4>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// é”™è¯¯çš„æè´¨è®¾ç½®å¯¼è‡´è¿‡åº¦åå…‰</span>
Material<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetScalarParameterValue</span>(<span class="hljs-string">"Roughness"</span>, <span class="hljs-number">0.1</span>f); <span class="hljs-comment">// ç²—ç³™åº¦è¿‡ä½</span>

<span class="hljs-comment">// è¯¾ç¨‹æ¨èçš„æ±½è½¦HMIæè´¨å‚æ•°</span>
MaterialInstance<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetScalarParameterValue</span>(<span class="hljs-string">"Roughness"</span>, <span class="hljs-number">0.6</span>f);
MaterialInstance<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetScalarParameterValue</span>(<span class="hljs-string">"Metallic"</span>, <span class="hljs-number">0.3</span>f);
MaterialInstance<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetVectorParameterValue</span>(<span class="hljs-string">"BaseColor"</span>, <span class="hljs-title function_ invoke__">FLinearColor</span>(<span class="hljs-number">0.05</span>f, <span class="hljs-number">0.05</span>f, <span class="hljs-number">0.1</span>f));
</code></pre>
<h4 data-id="heading-4">2. å¤œé—´æ¨¡å¼è‰²åé—®é¢˜</h4>
<p>è¯¾ç¨‹æä¾›çš„<strong>è‰²å½©æ ¡æ­£æ–¹æ¡ˆ</strong>ï¼š</p>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-ini" lang="ini">// åœ¨PostProcessVolumeä¸­è®¾ç½®
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_ColorGamma</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.ColorGamma</span> = FVector4(<span class="hljs-number">2.2</span>f, <span class="hljs-number">2.2</span>f, <span class="hljs-number">2.2</span>f, <span class="hljs-number">0.0</span>f)<span class="hljs-comment">; </span>
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_ColorGain</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.ColorGain</span> = FVector4(<span class="hljs-number">0.9</span>f, <span class="hljs-number">0.95</span>f, <span class="hljs-number">1.0</span>f, <span class="hljs-number">0.0</span>f)<span class="hljs-comment">; // å‡å°‘è“å…‰</span>
</code></pre>
<h3 data-id="heading-5">å…‰ç…§ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ</h3>
<h4 data-id="heading-6">1. åŠ¨æ€å…‰ç…§æ€§èƒ½æ¶ˆè€—</h4>
<p><strong>è¯¾ç¨‹è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨Lumençš„è½¯é˜´å½±æ›¿ä»£ä¼ ç»ŸåŠ¨æ€é˜´å½±</li>
<li>å¯¹HMIå…ƒç´ å¯ç”¨"Static Lighting"æ ‡è®°</li>
<li>ä¼˜åŒ–å…‰ç…§å›¾åˆ†è¾¨ç‡ï¼ˆå»ºè®®128-256px/mï¼‰</li>
</ul>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// å…‰ç…§ä¼˜åŒ–é…ç½®ä»£ç </span>
PrimaryLight<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetShadowResolution</span>(<span class="hljs-number">512</span>); <span class="hljs-comment">// é™ä½é˜´å½±åˆ†è¾¨ç‡</span>
HMI_Mesh<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetLightingChannels</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// ä½¿ç”¨ä¸“ç”¨å…‰ç…§é€šé“</span>
</code></pre>
<h4 data-id="heading-7">2. ç¯å¢ƒå…‰é®è”½(SSAO)é—®é¢˜</h4>
<p><strong>å‚æ•°è°ƒä¼˜æ–¹æ¡ˆ</strong>ï¼š</p>
<p>Ini</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">; DefaultEngine.inié…ç½®</span>
<span class="hljs-section">[/Script/Engine.RendererSettings]</span>
<span class="hljs-attr">r.SSAO.Quality</span>=<span class="hljs-number">2</span>
<span class="hljs-attr">r.SSAO.Radius</span>=<span class="hljs-number">50.0</span>
<span class="hljs-attr">r.SSAO.FadeRadius</span>=<span class="hljs-number">50.0</span>
<span class="hljs-attr">r.SSAO.Power</span>=<span class="hljs-number">2.0</span>
<span class="hljs-attr">r.SSAO.Bias</span>=<span class="hljs-number">0.1</span>
</code></pre>
<h3 data-id="heading-8">UIæ¸²æŸ“å…³é”®æŠ€å·§</h3>
<h4 data-id="heading-9">1. å­—ä½“è¾¹ç¼˜é”¯é½¿ä¿®å¤</h4>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-ini" lang="ini">// Slateå­—ä½“æ¸²æŸ“è®¾ç½®
FSlateFontInfo <span class="hljs-attr">FontInfo</span> = FCoreStyle::GetDefaultFontStyle(<span class="hljs-string">"Regular"</span>, <span class="hljs-number">24</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">FontInfo.OutlineSettings.OutlineSize</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
<span class="hljs-attr">FontInfo.OutlineSettings.OutlineColor</span> = FLinearColor::Black<span class="hljs-comment">;</span>
<span class="hljs-attr">FontInfo.FontMaterial</span> = LoadObject&lt;UMaterialInterface&gt;(...)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-10">2. åŠ¨æ€UIå…ƒç´ é—ªçƒé—®é¢˜</h4>
<p><strong>è¯¾ç¨‹æ¨èçš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// åœ¨Widgetè“å›¾ä¸­è®¾ç½®</span>
Widget-&gt;<span class="hljs-built_in">SetClipping</span>(EWidgetClipping::ClipToBounds);
Widget-&gt;<span class="hljs-built_in">SetVisibility</span>(ESlateVisibility::Visible);
Widget-&gt;<span class="hljs-built_in">SetRenderTransformPivot</span>(FVector2D(<span class="hljs-number">0.5</span>f, <span class="hljs-number">0.5</span>f));

<span class="hljs-comment">// å¼•æ“çº§ä¿®å¤ï¼ˆ4.27+ç‰ˆæœ¬æœ‰æ•ˆï¼‰</span>
static FAutoConsoleVariableRef <span class="hljs-built_in">CVar</span>(
    TEXT("r.VSync"),
    GVsyncEnabled,
    TEXT("Enable VSync to avoid tearing"),
    ECVF_RenderThreadSafe
);
</code></pre>
<h3 data-id="heading-11">åå¤„ç†ç‰¹æ•ˆä¼˜åŒ–</h3>
<h4 data-id="heading-12">1. æŠ—é”¯é½¿é€‰æ‹©ç­–ç•¥</h4>





























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>æ€§èƒ½æ¶ˆè€—</th><th>æ¨èå‚æ•°</th></tr></thead><tbody><tr><td>TAA</td><td>é«˜åŠ¨æ€åœºæ™¯</td><td>ä¸­</td><td>TemporalSampleCount=8</td></tr><tr><td>FXAA</td><td>é™æ€HMI</td><td>ä½</td><td>Quality=3</td></tr><tr><td>MSAA</td><td>çŸ¢é‡UIå…ƒç´ </td><td>é«˜</td><td>Samples=4</td></tr></tbody></table>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// åŠ¨æ€åˆ‡æ¢æŠ—é”¯é½¿æ–¹æ¡ˆ</span>
void <span class="hljs-built_in">SetAAMethod</span>(EHMIState CurrentState) {
    if (CurrentState == EHMIState::Driving) {
        Engine-&gt;<span class="hljs-built_in">SetAAMethod</span>(ETAAMethod::TAA);
    } else {
        Engine-&gt;<span class="hljs-built_in">SetAAMethod</span>(ETAAMethod::FXAA);
    }
}
</code></pre>
<h4 data-id="heading-13">2. Bloomè¿‡æ›æ§åˆ¶</h4>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-ini" lang="ini">// ä»ªè¡¨ç›˜ä¸“ç”¨Bloomè®¾ç½®
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_BloomIntensity</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.BloomIntensity</span> = <span class="hljs-number">0.8</span>f<span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_BloomThreshold</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.BloomThreshold</span> = <span class="hljs-number">5.0</span>f<span class="hljs-comment">; // æé«˜é˜ˆå€¼é¿å…UIå…ƒç´ è¿‡äº®</span>
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_BloomDirtMaskIntensity</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.BloomDirtMaskIntensity</span> = <span class="hljs-number">0.3</span>f<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-14">å¹³å°ç‰¹å®šä¼˜åŒ–æ–¹æ¡ˆ</h3>
<h4 data-id="heading-15">1. è½¦è½½èŠ¯ç‰‡é€‚é…é—®é¢˜</h4>
<p><strong>è¯¾ç¨‹æ€»ç»“çš„ä¼˜åŒ–æ¸…å•</strong>ï¼š</p>
<ul>
<li>ç¦ç”¨åŠ¨æ€åˆ†è¾¨ç‡</li>
<li>ä½¿ç”¨Mobile HDRæ¸²æŸ“è·¯å¾„</li>
<li>ç®€åŒ–ç²’å­ç³»ç»Ÿ</li>
<li>é™åˆ¶éª¨éª¼ç½‘æ ¼ä½“æ•°é‡</li>
</ul>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// æ£€æµ‹ç¡¬ä»¶æ€§èƒ½è‡ªåŠ¨é™çº§</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ApplyQualityPreset</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (GPUBenchmarkScore &lt; <span class="hljs-number">500</span>) {
        Scalability::<span class="hljs-built_in">SetQualityLevel</span>(<span class="hljs-number">1</span>);
        PostProcess-&gt;Settings.bOverride_MobileHQGaussian = <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h4 data-id="heading-16">2. å¤šå±åŒæ­¥æ¸²æŸ“</h4>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å¤šè§†å£åŒæ­¥æ–¹æ¡ˆ</span>
for (UMGDisplay* Display : Displays) {
    <span class="hljs-attribute">Display</span>-&gt;<span class="hljs-built_in">GetViewportClient</span>()-&gt;bLockToVsync = true;
    <span class="hljs-attribute">Display</span>-&gt;<span class="hljs-built_in">GetViewportClient</span>()-&gt;<span class="hljs-built_in">SetTickGroup</span>(TG_PostUpdateWork);
    <span class="hljs-attribute">Display</span>-&gt;<span class="hljs-built_in">GetViewportClient</span>()-&gt;<span class="hljs-built_in">SetTickMode</span>(ETickMode::Enabled);
}
</code></pre>
<h3 data-id="heading-17">æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•</h3>
<p>è¯¾ç¨‹æ¨èçš„<strong>å®æ—¶ç›‘æ§æ–¹æ¡ˆ</strong>ï¼š</p>
<p>Cpp</p>
<p><em>î¦Œ</em></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å†…ç½®æ€§èƒ½HUDè®¾ç½®</span>
UHUD::AddStatOverride(
    TEXT(<span class="hljs-string">"HMI"</span>), 
    TEXT(<span class="hljs-string">"60FPS"</span>), 
    FLinearColor::Green,
    [<span class="hljs-keyword">this</span>](){ <span class="hljs-keyword">return</span> IsRunningAtTargetFrameRate(); }
);

<span class="hljs-comment">// è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡</span>
FEnginePerformanceTargets Targets;
Targets.SetPerformanceTargets(
    <span class="hljs-number">60.0f</span>,    <span class="hljs-comment">// å¸§ç‡</span>
    <span class="hljs-number">15.0f</span>,    <span class="hljs-comment">// å¸§æ—¶é—´(ms)</span>
    <span class="hljs-number">50.0f</span>,    <span class="hljs-comment">// æ¸²æŸ“çº¿ç¨‹æ—¶é—´(ms)</span>
    <span class="hljs-number">50.0f</span>     <span class="hljs-comment">// æ¸¸æˆçº¿ç¨‹æ—¶é—´(ms)</span>
);
</code></pre>
<h3 data-id="heading-18">è¯¾ç¨‹ç²¾åï¼šHMIæ¸²æŸ“é»„é‡‘æ³•åˆ™</h3>
<ol>
<li><strong>ç¨³å®šæ€§ä¼˜å…ˆ</strong>ï¼šä»»ä½•ç‰¹æ•ˆéƒ½ä¸èƒ½ä»¥ç‰ºç‰²å¸§ç¨³å®šæ€§ä¸ºä»£ä»·</li>
<li><strong>ç‰©ç†å‡†ç¡®æ€§</strong>ï¼šå…‰ç…§å’Œæè´¨å¿…é¡»ç¬¦åˆçœŸå®ç‰©ç†å‚æ•°</li>
<li><strong>äººå› å·¥ç¨‹</strong>ï¼šæ‰€æœ‰è§†è§‰å…ƒç´ å¿…é¡»é€šè¿‡ISO-9241å¯ç”¨æ€§æµ‹è¯•</li>
<li><strong>å¹³å°é€‚é…</strong>ï¼šé’ˆå¯¹ä¸åŒç¡¬ä»¶æä¾›3çº§è´¨é‡é¢„è®¾</li>
<li><strong>æ•°æ®é©±åŠ¨</strong>ï¼šå»ºç«‹è‡ªåŠ¨åŒ–è§†è§‰è´¨é‡è¯„ä¼°ä½“ç³»</li>
</ol>
<p>è¿™å¥—é«˜çº§ç ”ä¿®è¯¾æœ€å®è´µçš„ä¸æ˜¯å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œè€Œæ˜¯åŸ¹å…»äº†å¯¹æ±½è½¦HMIæ¸²æŸ“çš„<strong>ç³»ç»Ÿçº§æ€è€ƒæ¡†æ¶</strong>ã€‚è®°ä½è¯¾ç¨‹çš„æ ¸å¿ƒè§‚ç‚¹ï¼šä¼˜ç§€çš„è½¦è½½HMI=50%æŠ€æœ¯ç²¾åº¦+30%äººå› å·¥ç¨‹+20%ç¾å­¦è®¾è®¡ã€‚ç°åœ¨å°±å¼€å§‹ç”¨è¯¾ç¨‹ä¸­çš„"æ¸²æŸ“é—®é¢˜è¯Šæ–­æ ‘"æ¥æ£€æŸ¥ä½ çš„é¡¹ç›®ï¼Œä½ ä¼šå‘ç°90%çš„è§†è§‰é—®é¢˜éƒ½æœ‰è¿¹å¯å¾ªï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ClassLoaderï¼šä»åŒäº²å§”æ´¾åˆ°SPI]]></title>    <link>https://juejin.cn/post/7584408254819827747</link>    <guid>https://juejin.cn/post/7584408254819827747</guid>    <pubDate>2025-12-17T08:14:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254819827747" data-draft-id="7582783931164147747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ClassLoaderï¼šä»åŒäº²å§”æ´¾åˆ°SPI"/> <meta itemprop="keywords" content="JVM"/> <meta itemprop="datePublished" content="2025-12-17T08:14:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›äºŒè›‹"/> <meta itemprop="url" content="https://juejin.cn/user/3562073405268862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ClassLoaderï¼šä»åŒäº²å§”æ´¾åˆ°SPI
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562073405268862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›äºŒè›‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:14:05.000Z" title="Wed Dec 17 2025 08:14:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¯»æ‡‚äº†classæ–‡ä»¶ä¹‹å, ä»Šå¤©æ¥èŠä¸€èŠåŠ è½½classçš„é‚£äº›äº‹å„¿ï¼ˆåŸºäºJava SE 8ï¼‰</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€ç±»åŠ è½½å™¨</h2>
<p>åœ¨jvmä¸­ä¸»è¦æœ‰ä¸‰å¤§å†…ç½®ç±»åŠ è½½å™¨</p>





























<table><thead><tr><th>åŠ è½½å™¨ç±»å‹</th><th>å®ç°ç±»</th><th>åŠ è½½è·¯å¾„</th><th>æºç ä½ç½®</th></tr></thead><tbody><tr><td>Bootstrap</td><td>C/C++å®ç°</td><td><code>sun.boot.class.path</code></td><td><code>hotspot/src/share/vm/...</code></td></tr><tr><td>Extension</td><td><code>ExtClassLoader</code></td><td><code>java.ext.dirs</code></td><td><code>sun.misc.Launcher$ExtClassLoader</code></td></tr><tr><td>Application</td><td><code>AppClassLoader</code></td><td><code>java.class.path</code></td><td><code>sun.misc.Launcher$AppClassLoader</code></td></tr></tbody></table>
<h3 data-id="heading-1">Bootstrapç±»åŠ è½½å™¨</h3>
<p>ä½œä¸ºjvmæœ€é¡¶å±‚ç±»åŠ è½½å™¨ï¼Œjvmå®ç°çš„ä¸€éƒ¨åˆ†ï¼Œç”±C/C++å®ç°ï¼ˆHotspotVMæ˜¯C++ï¼‰ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªéClassLoaderå­ç±»çš„åŠ è½½å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹è´Ÿè´£åŠ è½½%JAVA_HOME%/jre/libç›®å½•,ä¹Ÿå¯ä»¥é€šè¿‡<code>-Xbootclasspath</code>æŒ‡å®šåŠ è½½è·¯å¾„(ä½†è¿™ä¸€æ­¥æœ‰è¾ƒé«˜çš„é£é™©æ€§ï¼Œå¦‚æœæŒ‡å®šåŠ è½½äº†ä¸æ ¸å¿ƒjaråŒ…åŒååŒè·¯å¾„çš„classï¼Œä¼šé€ æˆé€»è¾‘ç ´åï¼‰</p>
<p>å¯ä»¥é€šè¿‡getClassLoader()æŸ¥çœ‹ç±»è¢«å“ªä¸ªåŠ è½½å™¨åŠ è½½</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/453dfe9fc3d64cadb71afead659838f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=tJNe1NSHfZ4W7hy4aMzIGgQiqd8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f782648351db448a96fda196264ebb05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=4DlJfMczwpgTzNYzY8Gid7kdPxg%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ®µç¤ºä¾‹ä»£ç ä¸­è¾“å‡ºäº†ä¸¤ä¸ªä¿¡æ¯ï¼Œä¸€æ˜¯Firstç±»æœ¬èº«çš„ç±»åŠ è½½å™¨ä½äºrt.jarä¸­çš„<code>sum.misc.Launcher$AppClassLoader</code>ï¼ŒäºŒåˆ™æ˜¯è´Ÿè´£åŠ è½½æ ¸å¿ƒjaråŒ…çš„<code>BootstrapClassLoader</code>, ä½†å› ä¸ºBootstrapæ˜¯ç”±æœ¬åœ°è¯­è¨€å®ç°ï¼Œæ‰€ä»¥åœ¨javaç¨‹åºä¸­é€šè¿‡getClassLoader()è·å–å…¶ç»“æœæ˜¾ç¤ºä¸º<code>null</code></p>
<h3 data-id="heading-2">Extensionç±»åŠ è½½å™¨</h3>
<p>è¯¥ç±»åŠ è½½å™¨æ˜¯ç”±javaä»£ç å®ç°ï¼Œä½äºrt.jarä¸­<code>sun.misc.Launcher$ExtClassloader</code>ä»è¿™é‡Œå¯ä»¥å‘ç°ï¼Œä»–ä¸AppClassLoaderåŒä¸ºLauncherçš„å†…éƒ¨ç±»ï¼Œä¸”éƒ½ç»§æ‰¿è‡ª<code>java.net.URLClassLoader</code>è¿™é‡Œæš‚ä¸å±•å¼€ï¼Œ<code>ExtClassLoader</code>ä¸»è¦è´Ÿè´£åŠ è½½%JAVA_HOME%/jre/lib/ext/ç›®å½•</p>
<p>æ¯”å¦‚éšä¾¿æ‰¾ä¸€ä¸ªextä¸‹çš„jaccess.jarä¸­çš„ButtonTranslatorç±»ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a83e43bde954baaa8df9f9616c36fab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=TWjI8wq5M85fucNV6o0YqADn19A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e47968ee941c4e7e8e2aee70d67c9f24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=JdMQp8FnXLysBlczCeue%2BWMFjCI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">Applicationç±»åŠ è½½å™¨</h3>
<p>è¯¥ç±»åŠ è½½å™¨ä¹Ÿæ˜¯javaä»£ç å®ç°ï¼Œä¸»è¦è´Ÿè´£åŠ è½½classpathç›®å½•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¼€å‘çš„åº”ç”¨ä»£ç çš„ç±»åŠ è½½å™¨ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªdemoä¸­çš„Firstç±»ï¼Œå…¶åŠ è½½å™¨å°±æ˜¯<code>AppClassLoader</code></p>
<h3 data-id="heading-4">ç±»åŠ è½½å™¨å±‚çº§(å®ç°å±‚é¢ï¼‰</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/383a54bc18394a9396ea423406b73bfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=dwyYg7uPHgVR20Id8OF0lKIr6xs%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ˜¯ä»å®ç°çš„è§’åº¦ä¸ŠExt/AppåŠ è½½å™¨çš„å…³ç³»ï¼Œä»æŠ½è±¡çš„è§’åº¦ï¼ŒClassLoaderå®šä¹‰äº†åŠ è½½å™¨çš„è§„èŒƒï¼ŒSecureClassLoaderæ‰©å±•äº†å®‰å…¨æ€§ï¼ŒURLClassLoaderæ‰©å±•äº†é€šè¿‡urlåŠ è½½çš„èƒ½åŠ›ï¼Œè€ŒExtå’ŒAppåˆ™å„è‡ªåˆ†å·¥ï¼Œé‚£ä¹ˆä»é€»è¾‘è§’åº¦ï¼ŒExtå’ŒAppåŒ…æ‹¬Bootstrapæ˜¯å¦‚ä½•åšåˆ°å„è‡ªåˆ†å·¥çš„å‘¢ï¼Ÿ</p>
<h2 data-id="heading-5">äºŒã€åŒäº²å§”æ´¾æ¨¡å‹ Parent Delegation Model</h2>
<h4 data-id="heading-6">åŸºç¡€æ¦‚å¿µ</h4>
<p>åŒäº²å§”æ´¾æ¨¡å‹æ˜¯JVMå®šä¹‰çš„ä¸€å¥—é»˜è®¤çš„ç±»åŠ è½½æœºåˆ¶ï¼Œå½“ä¸€ä¸ªç±»è¢«ç±»åŠ è½½å™¨åŠ è½½æ—¶ï¼Œä»–é¦–å…ˆä¸ä¼šè‡ªèº«å°è¯•åŠ è½½è¯¥ç±»ï¼Œè€Œæ˜¯æŠŠåŠ è½½è¯·æ±‚å§”æ‰˜ç»™<code>çˆ¶åŠ è½½å™¨</code>å»å®Œæˆï¼Œå±‚å±‚å¾€ä¸Šï¼Œåªæœ‰å½“æ‰€æœ‰çˆ¶åŠ è½½å™¨éƒ½æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•å»åŠ è½½ï¼Œå…¶æ ¸å¿ƒæ¦‚å¿µæ€»ç»“ä¸ºï¼š<code>è‡ªåº•å‘ä¸Šå§”æ‰˜ï¼Œè‡ªé¡¶å‘ä¸‹åŠ è½½</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5bb276164a4b90877d7376cef705e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=zzR1WOlXp%2FcoI0mb8iqYBjo2UGg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">æºç åˆ†æ</h4>
<h3 data-id="heading-8">ä¸€ã€æ ¸å¿ƒåˆå§‹åŒ–æµç¨‹</h3>
<h4 data-id="heading-9"><strong>1.1 Launcheræ„å»ºåŠ è½½å™¨å±‚æ¬¡</strong></h4>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">public Launcher() {
    // 1. åˆ›å»ºExtClassLoaderï¼ˆçˆ¶åŠ è½½å™¨ï¼‰
    ClassLoader <span class="hljs-attr">extcl</span> = ExtClassLoader.getExtClassLoader()<span class="hljs-comment">;</span>
    
    // 2. åˆ›å»ºAppClassLoaderï¼Œä¼ å…¥extclä½œä¸ºparent
    <span class="hljs-attr">loader</span> = AppClassLoader.getAppClassLoader(extcl)<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>å…³é”®</strong>ï¼šå¿…é¡»å…ˆåˆ›å»ºçˆ¶åŠ è½½å™¨ï¼Œå†åˆ›å»ºå­åŠ è½½å™¨ï¼Œæ„å»ºå®Œæ•´çš„å§”æ‰˜é“¾ã€‚</p>
<hr/>
<h3 data-id="heading-10">äºŒã€ExtClassLoaderåˆ›å»ºè¿‡ç¨‹</h3>
<h4 data-id="heading-11"><strong>2.1 å•ä¾‹æ¨¡å¼è·å–å®ä¾‹</strong></h4>
<pre><code class="hljs language-scss" lang="scss">public static ExtClassLoader <span class="hljs-built_in">getExtClassLoader</span>() throws IOException {
    if (instance == null) {
        <span class="hljs-built_in">synchronized</span>(ExtClassLoader.class) {
            if (instance == null) {
                instance = <span class="hljs-built_in">createExtClassLoader</span>();  <span class="hljs-comment">// åŒé‡æ£€æŸ¥é”</span>
            }
        }
    }
    return instance;
}
</code></pre>
<h4 data-id="heading-12"><strong>2.2 ç¡®å®šæ‰©å±•åŠ è½½è·¯å¾„</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ExtClassLoader <span class="hljs-title function_">createExtClassLoader</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">return</span> AccessController.doPrivileged(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivilegedExceptionAction</span>&lt;ExtClassLoader&gt;() {
            <span class="hljs-keyword">public</span> ExtClassLoader <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
                <span class="hljs-comment">// è·å–æ‰©å±•ç›®å½•ï¼šjava.ext.dirsç³»ç»Ÿå±æ€§</span>
                <span class="hljs-keyword">final</span> File[] dirs = getExtDirs();
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExtClassLoader</span>(dirs);  <span class="hljs-comment">// åˆ›å»ºå®ä¾‹</span>
            }
        });
}
</code></pre>
<h4 data-id="heading-13"><strong>2.3 ExtClassLoaderæ„é€ å‡½æ•°</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ExtClassLoader</span><span class="hljs-params">(File[] dirs)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// å…³é”®ï¼šparent=nullï¼Œè¡¨ç¤ºçˆ¶åŠ è½½å™¨æ˜¯BootstrapClassLoader</span>
    <span class="hljs-built_in">super</span>(getExtURLs(dirs), <span class="hljs-literal">null</span>, factory);
}
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹</strong>ï¼š<code>parent=null</code>è¡¨ç¤ºå§”æ‰˜é“¾é¡¶ç«¯ï¼Œç”±BootstrapClassLoaderåŠ è½½ã€‚</p>
<hr/>
<h3 data-id="heading-14">ä¸‰ã€AppClassLoaderåˆ›å»ºè¿‡ç¨‹</h3>
<h4 data-id="heading-15"><strong>3.1 è·å–ç±»è·¯å¾„å¹¶åˆ›å»ºå®ä¾‹</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClassLoader <span class="hljs-title function_">getAppClassLoader</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ClassLoader extcl)</span> 
        <span class="hljs-keyword">throws</span> IOException {
    
    <span class="hljs-comment">// è·å–åº”ç”¨ç±»è·¯å¾„ï¼šjava.class.pathç³»ç»Ÿå±æ€§</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">"java.class.path"</span>);
    <span class="hljs-keyword">final</span> File[] path = getClassPath(s);
    
    <span class="hljs-keyword">return</span> AccessController.doPrivileged(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivilegedAction</span>&lt;AppClassLoader&gt;() {
            <span class="hljs-keyword">public</span> AppClassLoader <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                URL[] urls = pathToURLs(path);
                <span class="hljs-comment">// å…³é”®ï¼šä¼ å…¥extclä½œä¸ºparentå‚æ•°</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppClassLoader</span>(urls, extcl);
            }
        });
}
</code></pre>
<h4 data-id="heading-16"><strong>3.2 AppClassLoaderæ„é€ å‡½æ•°</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">AppClassLoader</span>(URL[] urls, ClassLoader parent) {
    <span class="hljs-comment">// å…³é”®ï¼šparentå‚æ•°æ˜¯ExtClassLoaderå®ä¾‹</span>
    super(urls, parent, factory);
}
</code></pre>
<hr/>
<h3 data-id="heading-17">å››ã€æ ¸å¿ƒè®¾è®¡è¦ç‚¹</h3>
<h4 data-id="heading-18"><strong>4.1 å§”æ‰˜é“¾å®Œæ•´æ„å»º</strong></h4>
<pre><code class="hljs">å¯åŠ¨é¡ºåºï¼šExtClassLoader â†’ AppClassLoader
å§”æ‰˜é“¾ï¼šAppClassLoader â†’ ExtClassLoader â†’ BootstrapClassLoader
</code></pre>
<h4 data-id="heading-19"><strong>4.2 åŠ è½½èŒƒå›´é…ç½®</strong></h4>




















<table><thead><tr><th>åŠ è½½å™¨</th><th>ç³»ç»Ÿå±æ€§</th><th>èŒè´£èŒƒå›´</th></tr></thead><tbody><tr><td>ExtClassLoader</td><td><code>java.ext.dirs</code></td><td>æ‰©å±•JARåŒ…</td></tr><tr><td>AppClassLoader</td><td><code>java.class.path</code></td><td>åº”ç”¨ç±»è·¯å¾„</td></tr></tbody></table>
<h4 data-id="heading-20"><strong>4.3 å…³é”®è®¾è®¡å†³ç­–</strong></h4>
<ol>
<li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼šExtClassLoaderå…¨å±€å”¯ä¸€</li>
<li><strong>parent=null</strong>ï¼šExtClassLoaderçˆ¶åŠ è½½å™¨ä¸ºBootstrap</li>
<li><strong>å±‚æ¬¡ä¼ é€’</strong>ï¼šAppClassLoaderä»¥ExtClassLoaderä¸ºparent</li>
<li><strong>å®‰å…¨ä¸Šä¸‹æ–‡</strong>ï¼šé€šè¿‡<code>AccessController.doPrivileged</code>æ‰§è¡Œ</li>
</ol>
<hr/>
<h3 data-id="heading-21">äº”ã€éªŒè¯å§”æ‰˜é“¾</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// è¿è¡Œæ—¶éªŒè¯å§”æ‰˜é“¾</span>
ClassLoader appLoader = ClassLoader<span class="hljs-selector-class">.getSystemClassLoader</span>();
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(appLoader);  <span class="hljs-comment">// AppClassLoader</span>
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(appLoader.getParent());  <span class="hljs-comment">// ExtClassLoader  </span>
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(appLoader.getParent()<span class="hljs-selector-class">.getParent</span>());  <span class="hljs-comment">// null (Bootstrap)</span>
</code></pre>
<p><strong>æ€»ç»“</strong>ï¼šLauncheré€šè¿‡ç²¾ç¡®çš„åˆå§‹åŒ–é¡ºåºå’Œå‚æ•°ä¼ é€’ï¼Œæ„å»ºäº†ä¸å¯å˜çš„ä¸‰å±‚ç±»åŠ è½½å™¨å§”æ‰˜é“¾ï¼Œè¿™æ˜¯åŒäº²å§”æ´¾æœºåˆ¶èƒ½å¤Ÿç¨³å®šè¿è¡Œçš„åŸºçŸ³ã€‚</p>
<h3 data-id="heading-22">å…­ã€æ ¸å¿ƒåŠ è½½è¿‡ç¨‹</h3>
<p>åŒäº²å§”æ´¾æœºåˆ¶çš„æ‰§è¡Œåˆ†ä¸ºä¸¤ä¸ªæ˜ç¡®é˜¶æ®µï¼š</p>
<p><strong>1. å§”æ´¾é˜¶æ®µï¼ˆé€’å½’å‘ä¸ŠæŸ¥è¯¢ï¼‰</strong><br/>
è¯·æ±‚ä»å­åŠ è½½å™¨å‘èµ·ï¼Œé€šè¿‡<code>parent.loadClass()</code>é€’å½’è°ƒç”¨ï¼Œæ²¿åŠ è½½å™¨å±‚æ¬¡ç»“æ„å‘ä¸Šä¼ é€’ï¼Œç›´è‡³<code>parent</code>ä¸º<code>null</code>çš„BootstrapClassLoaderã€‚è¿™ä¸€é˜¶æ®µä»…è¿›è¡Œ<strong>ç±»æŸ¥è¯¢</strong>ï¼Œä¸æ‰§è¡Œå®é™…åŠ è½½ã€‚</p>
<p><strong>2. åŠ è½½é˜¶æ®µï¼ˆé€çº§å‘ä¸‹å°è¯•ï¼‰</strong><br/>
ä»BootstrapClassLoaderå¼€å§‹ï¼Œæ¯å±‚åŠ è½½å™¨ä¾æ¬¡å°è¯•ï¼š</p>
<ul>
<li><code>findBootstrapClassOrNull()</code>Â /Â <code>findClass()</code>ï¼šåœ¨è‡ªèº«è´£ä»»èŒƒå›´å†…æŸ¥æ‰¾ç±»èµ„æº</li>
<li>è‹¥æ‰¾åˆ°èµ„æºï¼Œåˆ™é€šè¿‡<code>defineClass()</code>Â â†’Â <code>defineClass0()</code>æœ¬åœ°æ–¹æ³•ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºClasså¯¹è±¡</li>
<li>è‹¥æœªæ‰¾åˆ°ï¼Œåˆ™è¿”å›<code>null</code>æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œæ§åˆ¶æƒä¼ é€’åˆ°ä¸‹ä¸€çº§åŠ è½½å™¨</li>
</ul>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š</p>
<ul>
<li><strong>é€’å½’å‘ç”Ÿåœ¨å§”æ´¾é˜¶æ®µ</strong>ï¼Œæ˜¯æ–¹æ³•è°ƒç”¨å±‚é¢çš„é€’å½’</li>
<li><strong>å®é™…åŠ è½½å‘ç”Ÿåœ¨è¿”å›é˜¶æ®µ</strong>ï¼Œæ˜¯è´£ä»»é“¾æ¨¡å¼çš„é€çº§å°è¯•</li>
<li>æ¯ä¸€å±‚åŠ è½½å™¨éƒ½æ˜¯å…ˆä¾èµ–çˆ¶åŠ è½½å™¨ï¼Œå¤±è´¥åæ‰è‡ªä¸»åŠ è½½ï¼Œç¡®ä¿æ ¸å¿ƒç±»ä¼˜å…ˆç”±é«˜å±‚åŠ è½½å™¨åŠ è½½</li>
</ul>
<p>è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†Javaæ ¸å¿ƒåº“çš„å®‰å…¨æ€§ï¼ˆé˜²æ­¢ç”¨æˆ·æ›¿æ¢æ ¸å¿ƒç±»ï¼‰ï¼Œåˆé€šè¿‡é€çº§å›é€€æœºåˆ¶å®ç°äº†ç±»åŠ è½½çš„çµæ´»æ‰©å±•ã€‚</p>
<h2 data-id="heading-23">ä¸‰ã€SPI Service Provider Interface</h2>
<h3 data-id="heading-24">ä¸€ã€SPIæ ¸å¿ƒæ¦‚å¿µ</h3>
<h4 data-id="heading-25"><strong>1.1 ä»€ä¹ˆæ˜¯SPIï¼Ÿ</strong></h4>
<p>SPIæ˜¯Javaæä¾›çš„ä¸€ç§<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>ï¼Œé€šè¿‡è§£è€¦æ¥å£ä¸å®ç°ï¼Œå®ç°<strong>å¯æ’æ‹”çš„ç»„ä»¶æ‰©å±•</strong>ã€‚</p>
<h4 data-id="heading-26"><strong>1.2 æ ¸å¿ƒæ€æƒ³</strong></h4>
<pre><code class="hljs language-markdown" lang="markdown">æ¥å£å®šä¹‰ï¼ˆæ ‡å‡†ï¼‰ â† é…ç½®æ–‡ä»¶ â†’ å…·ä½“å®ç°ï¼ˆæ‰©å±•ï¼‰
<span class="hljs-code">     â†‘                          â†‘
    JDK                       å¼€å‘è€…
</span></code></pre>
<hr/>
<h3 data-id="heading-27">äºŒã€SPIæ‰“ç ´åŒäº²å§”æ´¾çš„åŸç†</h3>
<h4 data-id="heading-28"><strong>2.1 ç»å…¸é—®é¢˜ï¼šJDBCé©±åŠ¨åŠ è½½</strong></h4>
<pre><code class="hljs language-ini" lang="ini">// ä¼ ç»Ÿæ–¹å¼éœ€è¦æ˜¾å¼åŠ è½½é©±åŠ¨,ç¡¬ç¼–ç ä¸”ä¸å¤Ÿçµæ´»
Connection <span class="hljs-attr">conn</span> = DriverManager.getConnection(new com.mysql.Driver())<span class="hljs-comment">;</span>

// SPIæ–¹å¼ï¼šè‡ªåŠ¨å‘ç°å¹¶åŠ è½½é©±åŠ¨
Connection <span class="hljs-attr">conn</span> = DriverManager.getConnection(url)<span class="hljs-comment">;</span>
//DriverManageré€šè¿‡SPIè‡ªåŠ¨å‘ç°
</code></pre>
<h4 data-id="heading-29"><strong>2.2 å…³é”®ç±»ï¼šServiceLoader</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SPIçš„æ ¸å¿ƒåŠ è½½å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceLoader</span>&lt;S&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;S&gt; {
    <span class="hljs-comment">// é…ç½®æ–‡ä»¶è·¯å¾„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"META-INF/services/"</span>;
    
    <span class="hljs-comment">// åŠ è½½æœåŠ¡å®ç°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;S&gt; ServiceLoader&lt;S&gt; <span class="hljs-title function_">load</span><span class="hljs-params">(Class&lt;S&gt; service)</span> {
        <span class="hljs-comment">// ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</span>
        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();
        <span class="hljs-keyword">return</span> ServiceLoader.load(service, cl);
    }
}
</code></pre>
<h4 data-id="heading-30"><strong>2.3 æ‰“ç ´åŒäº²å§”æ´¾çš„å…³é”®</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// DriverManagerçš„é™æ€åˆå§‹åŒ–å—</span>
static {
    <span class="hljs-built_in">loadInitialDrivers</span>();  <span class="hljs-comment">// é©±åŠ¨åŠ è½½</span>
    <span class="hljs-built_in">println</span>("JDBC DriverManager initialized");
}

private static void <span class="hljs-built_in">loadInitialDrivers</span>() {
    <span class="hljs-comment">// é€šè¿‡ServiceLoaderåŠ è½½é©±åŠ¨ï¼Œloadä¸­ä¼ é€’å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ClassLoaderè¿›è¡Œå¤„ç†</span>
    ServiceLoader&lt;Driver&gt; loadedDrivers = 
        ServiceLoader<span class="hljs-selector-class">.load</span>(Driver.class);
    
    Iterator&lt;Driver&gt; driversIterator = loadedDrivers<span class="hljs-selector-class">.iterator</span>();
    while (driversIterator.hasNext()) {
        driversIterator<span class="hljs-selector-class">.next</span>();  <span class="hljs-comment">// è§¦å‘é©±åŠ¨åŠ è½½å’Œæ³¨å†Œ</span>
    }
}
</code></pre>
<p>"SPIæœºåˆ¶çš„æ ¸å¿ƒç±»<code>ServiceLoader</code>åœ¨è®¾è®¡æ—¶å°±å›ºå®šä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥åŠ è½½æœåŠ¡å®ç°ã€‚å½“ç”±BootstrapClassLoaderåŠ è½½çš„<code>DriverManager</code>è°ƒç”¨<code>ServiceLoader.load(Driver.class)</code>æ—¶ï¼Œ<code>ServiceLoader</code>è·å–å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆé€šå¸¸æ˜¯AppClassLoaderï¼Œæˆ–å…¶ä»–è‡ªå®šä¹‰åŠ è½½å™¨ï¼‰ï¼Œç„¶ååœ¨åç»­çš„<code>Class.forName(className, false, loader)</code>ä¸­æ˜ç¡®æŒ‡å®šä½¿ç”¨è¿™ä¸ªåŠ è½½å™¨æ¥åŠ è½½é©±åŠ¨ç±»ã€‚è¿™æ ·å°±ç»•è¿‡äº†åŒäº²å§”æ´¾æ¨¡å‹ä¸­'çˆ¶åŠ è½½å™¨åŠ è½½çš„ä»£ç ä¸èƒ½ç›´æ¥è®¿é—®å­åŠ è½½å™¨ä¸­çš„ç±»'çš„é™åˆ¶ã€‚"</p>
<h3 data-id="heading-31">æ€»ç»“</h3>
<p><strong>Javaç±»åŠ è½½ä½“ç³»æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„å±‚æ¬¡åŒ–å®‰å…¨æ¨¡å‹ï¼ŒåŒäº²å§”æ´¾æ˜¯å…¶åŸºçŸ³ï¼Œä¿éšœäº†Javaå¹³å°çš„æ ¸å¿ƒç¨³å®šæ€§ã€‚SPIæœºåˆ¶åˆ™æ˜¯è¿™ä¸€æ¨¡å‹çš„æ™ºæ…§æ‰©å±•ï¼Œé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è¿™ä¸€"æ¡¥æ¢"ï¼Œåœ¨ä¿æŒå®‰å…¨çš„å‰æä¸‹å®ç°äº†çˆ¶åŠ è½½å™¨å¯¹å­åŠ è½½å™¨æœåŠ¡çš„å‘ç°ã€‚è¿™ç§"è§„èŒƒä¸­çš„çµæ´»"è®¾è®¡å“²å­¦ï¼Œä½¿å¾—Javaæ—¢èƒ½åšå®ˆç±»å‹å®‰å…¨çš„æ ¸å¿ƒåŸåˆ™ï¼Œåˆèƒ½æ”¯æ’‘èµ·åºå¤§çš„ç”Ÿæ€ç³»ç»Ÿï¼Œæˆä¸ºä¼ä¸šçº§åº”ç”¨çš„é¦–é€‰å¹³å°ã€‚</strong></p>
<p>ç†è§£è¿™ä¸€æœºåˆ¶ä¸ä»…æœ‰åŠ©äºè§£å†³ç±»åŠ è½½ç›¸å…³é—®é¢˜ï¼Œæ›´æ˜¯æ·±å…¥ç†è§£Javaå¹³å°è®¾è®¡æ€æƒ³ã€ç¼–å†™é«˜è´¨é‡å¯æ‰©å±•ä»£ç çš„å…³é”®ã€‚ä»<code>Class.forName</code>çš„ç¡¬ç¼–ç åˆ°SPIçš„è‡ªåŠ¨å‘ç°ï¼Œä»ä¸¥æ ¼å§”æ´¾åˆ°æœ‰æ§åˆ¶æ‰“ç ´ï¼ŒJavaç±»åŠ è½½æœºåˆ¶çš„æ¼”è¿›æ­£æ˜¯è½¯ä»¶å·¥ç¨‹"å…³æ³¨ç‚¹åˆ†ç¦»"ã€"çº¦å®šä¼˜äºé…ç½®"ç­‰åŸåˆ™çš„å®Œç¾ä½“ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºå¤§æ¨¡å‹LLMçš„å¼€å‘ä¸ç¼–ç¨‹æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7584443518035935295</link>    <guid>https://juejin.cn/post/7584443518035935295</guid>    <pubDate>2025-12-17T08:02:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518035935295" data-draft-id="7584443518035918911" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºå¤§æ¨¡å‹LLMçš„å¼€å‘ä¸ç¼–ç¨‹æ•™ç¨‹ "/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-17T08:02:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·859968167769"/> <meta itemprop="url" content="https://juejin.cn/user/2086203644184827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºå¤§æ¨¡å‹LLMçš„å¼€å‘ä¸ç¼–ç¨‹æ•™ç¨‹ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2086203644184827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·859968167769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:02:47.000Z" title="Wed Dec 17 2025 08:02:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>åŸºäºå¤§æ¨¡å‹LLMçš„å¼€å‘ä¸ç¼–ç¨‹æ•™ç¨‹---xingkeit.top/8708/</strong></p>
<h2 data-id="heading-0">å¤§æ¨¡å‹LLMå¼€å‘é¿å‘æŒ‡å—ï¼šç¼–ç¨‹ä¸­å¸¸è§çš„å‚æ•°è°ƒä¼˜ä¸æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-1">æ¸©åº¦å‚æ•°(Temperature)ï¼šåˆ›é€ åŠ›ä¸ç¨³å®šæ€§çš„å¹³è¡¡</h3>
<p>æ¸©åº¦å‚æ•°æ˜¯æ§åˆ¶ç”Ÿæˆå¤šæ ·æ€§çš„å…³é”®å¼€å…³ï¼Œä½†å¼€å‘è€…å¸¸é™·å…¥ä¸¤ä¸ªæç«¯ï¼š</p>
<p>Python</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># é”™è¯¯ç¤ºèŒƒï¼šæç«¯æ¸©åº¦è®¾ç½®</span>
output = llm.generate(prompt, temperature=<span class="hljs-number">0</span>)  <span class="hljs-meta"># å®Œå…¨ç¡®å®šæ€§è¾“å‡º</span>
output = llm.generate(prompt, temperature=<span class="hljs-number">1</span>)  <span class="hljs-meta"># è¿‡åº¦éšæœºæ€§</span>

<span class="hljs-meta"># æ¨èè®¾ç½®åŒºé—´</span>
<span class="hljs-function">def <span class="hljs-title">get_optimal_temperature</span>(<span class="hljs-params">task_type</span>):
    settings</span> = {
        <span class="hljs-string">'factual_qa'</span>: <span class="hljs-number">0.3</span>,    <span class="hljs-meta"># äº‹å®æ€§é—®é¢˜éœ€è¦ç¨³å®šæ€§</span>
        <span class="hljs-string">'creative_writing'</span>: <span class="hljs-number">0.7</span>,  <span class="hljs-meta"># åˆ›æ„å†™ä½œéœ€è¦å¤šæ ·æ€§</span>
        <span class="hljs-string">'code_generation'</span>: <span class="hljs-number">0.5</span>    <span class="hljs-meta"># ä»£ç ç”Ÿæˆéœ€è¦å¹³è¡¡</span>
    }
    <span class="hljs-keyword">return</span> settings.<span class="hljs-keyword">get</span>(task_type, <span class="hljs-number">0.5</span>)
</code></pre>
<h3 data-id="heading-2">Top-pé‡‡æ ·(Nucleus Sampling)çš„é™·é˜±</h3>
<p>Top-pé‡‡æ ·è™½èƒ½æé«˜ç”Ÿæˆè´¨é‡ï¼Œä½†å‚æ•°è®¾ç½®ä¸å½“ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li><strong>på€¼è¿‡å¤§</strong>ï¼šåŒ…å«ä½æ¦‚ç‡è¯å…ƒï¼Œè¾“å‡ºä¸ç¨³å®š</li>
<li><strong>på€¼è¿‡å°</strong>ï¼šé™åˆ¶åˆ›é€ åŠ›ï¼Œè¾“å‡ºé‡å¤</li>
</ol>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å…¸å‹é—®é¢˜åœºæ™¯</span>
<span class="hljs-attr">problem_output</span> = llm.generate(
    prompt,
    <span class="hljs-attr">top_p</span>=<span class="hljs-number">0.99</span>,  <span class="hljs-comment"># å‡ ä¹åŒ…å«æ‰€æœ‰è¯å…ƒ</span>
    <span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>
)

<span class="hljs-comment"># æ¨èè°ƒè¯•æ–¹æ³•</span>
for p in <span class="hljs-section">[0.3, 0.5, 0.7, 0.9]</span>:  <span class="hljs-comment"># é˜¶æ¢¯å¼æµ‹è¯•</span>
    test_output(p, p)
</code></pre>
<h3 data-id="heading-3">æœ€å¤§é•¿åº¦(max_length)ä¸é‡å¤æƒ©ç½š(repetition_penalty)</h3>
<h4 data-id="heading-4">å¸¸è§é—®é¢˜ç—‡çŠ¶ï¼š</h4>
<ul>
<li><strong>è¾“å‡ºæˆªæ–­</strong>ï¼šmax_lengthè®¾ç½®è¿‡å°</li>
<li><strong>æ— é™å¾ªç¯</strong>ï¼šç¼ºä¹é‡å¤æƒ©ç½šæœºåˆ¶</li>
<li><strong>è¯­ä¹‰ä¸å®Œæ•´</strong>ï¼šæœªè€ƒè™‘tokenåˆ†æ®µ</li>
</ul>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æ™ºèƒ½é•¿åº¦è°ƒæ•´æ–¹æ¡ˆ</span>
def dynamic_max_length(prompt):
    <span class="hljs-attr">base_length</span> = len(tokenizer.encode(prompt))
    return min(
        base_length + 256,  <span class="hljs-comment"># æ ¹æ®è¾“å…¥åŠ¨æ€è°ƒæ•´</span>
        2048  <span class="hljs-comment"># æ¨¡å‹ä¸Šé™</span>
    )

<span class="hljs-comment"># é‡å¤æƒ©ç½šå¢å¼º</span>
<span class="hljs-attr">response</span> = llm.generate(
    prompt,
    <span class="hljs-attr">repetition_penalty</span>=<span class="hljs-number">1.2</span>,  <span class="hljs-comment"># é€‚åº¦æƒ©ç½š</span>
    <span class="hljs-attr">no_repeat_ngram_size</span>=<span class="hljs-number">3</span>   <span class="hljs-comment"># é˜²æ­¢3-gramé‡å¤</span>
)
</code></pre>
<h3 data-id="heading-5">å†…å­˜æº¢å‡º(OOM)é—®é¢˜è¯Šæ–­æµç¨‹</h3>
<p>å½“é‡åˆ°CUDA out of memoryæ—¶ï¼Œç³»ç»ŸåŒ–æ’æŸ¥ï¼š</p>
<ol>
<li>
<p><strong>æ£€æŸ¥æ˜¾å­˜å ç”¨åŸºçº¿</strong></p>
<p>Python</p>
<pre><code class="hljs language-bash" lang="bash">torch.cuda.memory_summary()  <span class="hljs-comment"># æ˜¾å­˜åˆ†æ</span>
</code></pre>
</li>
<li>
<p><strong>æ‰¹é‡å¤„ç†(Batch Size)è°ƒä¼˜</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªåŠ¨å¯»æ‰¾æœ€å¤§batch size</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_max_batch</span>(<span class="hljs-params">model, input_size</span>):
    <span class="hljs-keyword">for</span> bs <span class="hljs-keyword">in</span> [<span class="hljs-number">32</span>, <span class="hljs-number">16</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]:
        <span class="hljs-keyword">try</span>:
            test_memory_usage(model, bs, input_size)
            <span class="hljs-keyword">return</span> bs
        <span class="hljs-keyword">except</span> RuntimeError:
            <span class="hljs-keyword">continue</span>
</code></pre>
</li>
<li>
<p><strong>ç²¾åº¦ä¼˜åŒ–æ–¹æ¡ˆ</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æ··åˆç²¾åº¦è®­ç»ƒ</span>
<span class="hljs-attr">scaler</span> = torch.cuda.amp.GradScaler()
with torch.cuda.amp.autocast():
    <span class="hljs-attr">outputs</span> = model(inputs)
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">æ¢¯åº¦å¼‚å¸¸ä¸è®­ç»ƒä¸ç¨³å®šçš„åº”å¯¹</h3>
<h4 data-id="heading-7">å…¸å‹ç—‡çŠ¶ï¼š</h4>
<ul>
<li>Losså‡ºç°NaN/INF</li>
<li>æ¢¯åº¦çˆ†ç‚¸(&gt;1e5)</li>
<li>æ¨¡å‹è¾“å‡ºæ— æ„ä¹‰å†…å®¹</li>
</ul>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æ¢¯åº¦è£å‰ªå®ç°</span>
torch.nn.utils.clip_grad_norm_(
    model.parameters(),
    <span class="hljs-attr">max_norm</span>=<span class="hljs-number">1.0</span>  <span class="hljs-comment"># æ¨è0.5-2.0</span>
)

<span class="hljs-comment"># æŸå¤±å€¼ç›‘æ§</span>
if torch.isnan(loss).any():
    logger.warning("NaN detected in loss!")
    adjust_learning_rate(optimizer, <span class="hljs-attr">factor</span>=<span class="hljs-number">0.5</span>)
</code></pre>
<h3 data-id="heading-8">æç¤ºå·¥ç¨‹(Prompt Engineering)çš„é»„é‡‘æ³•åˆ™</h3>
<ol>
<li>
<p><strong>æŒ‡ä»¤æ˜ç¡®æ€§æµ‹è¯•</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æµ‹è¯•ä¸åŒæŒ‡ä»¤æ ¼å¼</span>
<span class="hljs-attr">prompts</span> = [
    <span class="hljs-string">"è§£é‡Šæœºå™¨å­¦ä¹ "</span>,  <span class="hljs-comment"># æ¨¡ç³Š</span>
    <span class="hljs-string">"ç”¨200å­—é€šä¿—è§£é‡Šæœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µï¼Œé¢å‘é«˜ä¸­ç”Ÿ"</span>,  <span class="hljs-comment"># æ˜ç¡®</span>
    <span class="hljs-string">"åˆ—å‡ºæœºå™¨å­¦ä¹ çš„ä¸‰ä¸ªä¸»è¦ç±»å‹ï¼Œæ¯ä¸ªç±»å‹ç”¨ä¸€å¥è¯è¯´æ˜"</span>  <span class="hljs-comment"># ç»“æ„åŒ–</span>
]
compare_responses(prompts)
</code></pre>
</li>
<li>
<p><strong>å°‘æ ·æœ¬å­¦ä¹ (Few-shot)æ¨¡æ¿</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">few_shot_prompt</span> = <span class="hljs-string">"""
ç¤ºä¾‹1:
è¾“å…¥: æ³•å›½çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ
è¾“å‡º: æ³•å›½çš„é¦–éƒ½æ˜¯å·´é»

ç¤ºä¾‹2:
è¾“å…¥: æ—¥æœ¬çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ
è¾“å‡º: æ—¥æœ¬çš„é¦–éƒ½æ˜¯ä¸œäº¬

ç°åœ¨å›ç­”:
è¾“å…¥: æ„å¤§åˆ©çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ
è¾“å‡º:"""</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">æ¨¡å‹æœåŠ¡åŒ–ä¸­çš„æ€§èƒ½é™·é˜±</h3>
<h4 data-id="heading-10">é«˜é¢‘é”™è¯¯åŠè§£å†³æ–¹æ¡ˆï¼š</h4>
<ol>
<li>
<p><strong>å†·å¯åŠ¨å»¶è¿Ÿ</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># é¢„çƒ­æ¨¡å‹</span>
<span class="hljs-attr">warmup_inputs</span> = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>).to(device)
for _ in range(3):
    <span class="hljs-attr">_</span> = model(warmup_inputs)
</code></pre>
</li>
<li>
<p><strong>é•¿æ–‡æœ¬å¤„ç†ä¼˜åŒ–</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åˆ†å—å¤„ç†é•¿æ–‡æ¡£</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_process</span>(<span class="hljs-params">text, chunk_size=<span class="hljs-number">512</span></span>):
    <span class="hljs-keyword">return</span> [text[i:i+chunk_size] 
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(text), chunk_size)]
</code></pre>
</li>
<li>
<p><strong>å¹¶å‘è¯·æ±‚ç®¡ç†</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶å¹¶å‘</span>
semaphore = asyncio.Semaphore(<span class="hljs-number">5</span>)  <span class="hljs-comment"># æœ€å¤§5å¹¶å‘</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">limited_generate</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> semaphore:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> generate(prompt)
</code></pre>
</li>
</ol>
<h3 data-id="heading-11">ç›‘æ§ä¸è¯„ä¼°ä½“ç³»å»ºç«‹</h3>
<p>å¿…é¡»å»ºç«‹çš„<strong>ä¸‰å¤§çœ‹æ¿</strong>ï¼š</p>
<ol>
<li>
<p><strong>è´¨é‡çœ‹æ¿</strong></p>
<p>Python</p>
<pre><code class="hljs language-arduino" lang="arduino">monitor_metrics = {
    <span class="hljs-string">'bleu_score'</span>: calculate_bleu,
    <span class="hljs-string">'toxicity'</span>: check_toxicity_level,
    <span class="hljs-string">'fact_accuracy'</span>: verify_against_kb
}
</code></pre>
</li>
<li>
<p><strong>æ€§èƒ½çœ‹æ¿</strong></p>
<p>Python</p>
<pre><code class="hljs language-css" lang="css">performance_stats = {
    'latency_p99': <span class="hljs-built_in">get_latency_percentile</span>(<span class="hljs-number">0.99</span>),
    <span class="hljs-string">'throughput'</span>: <span class="hljs-built_in">count_requests_per_minute</span>(),
    <span class="hljs-string">'error_rate'</span>: <span class="hljs-built_in">calculate_error_percentage</span>()
}
</code></pre>
</li>
<li>
<p><strong>æˆæœ¬çœ‹æ¿</strong></p>
<p>Python</p>
<pre><code class="hljs language-css" lang="css">cost_analysis = {
    'tokens_per_request': <span class="hljs-built_in">count_output_tokens</span>(),
    <span class="hljs-string">'api_cost'</span>: <span class="hljs-built_in">estimate_api_expense</span>(),
    <span class="hljs-string">'infra_cost'</span>: <span class="hljs-built_in">calculate_cloud_bill</span>()
}
</code></pre>
</li>
</ol>
<p>å¤§æ¨¡å‹å¼€å‘å¦‚åŒé©¾é©­ä¸€å¤´å·¨å…½ï¼Œå‚æ•°è°ƒä¼˜æ˜¯æ‰‹ä¸­çš„ç¼°ç»³ã€‚æœ¬æ–‡æ€»ç»“çš„é¿å‘æŒ‡å—æ¥è‡ªæ•°ç™¾å°æ—¶çš„å®æˆ˜æ•™è®­ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>ç†è§£æ¯ä¸ªå‚æ•°èƒŒåçš„æ•°å­¦åŸç†ï¼Œå»ºç«‹ç³»ç»ŸåŒ–çš„ç›‘æ§æœºåˆ¶ï¼Œå§‹ç»ˆä¿æŒå¯¹æ¨¡å‹è¡Œä¸ºçš„å¯è§£é‡Šæ€§æ§åˆ¶</strong>ã€‚è®°ä½ï¼Œä¼˜ç§€çš„LLMå¼€å‘è€…ä¸æ˜¯è°ƒå‚é­”æœ¯å¸ˆï¼Œè€Œæ˜¯ç†è§£æ¨¡å‹è¡Œä¸ºåŸç†çš„å·¥ç¨‹å¸ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Viteä¸­resolve.aliasåŸç†]]></title>    <link>https://juejin.cn/post/7584466603809800230</link>    <guid>https://juejin.cn/post/7584466603809800230</guid>    <pubDate>2025-12-17T08:05:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584466603809800230" data-draft-id="7584466603809194022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Viteä¸­resolve.aliasåŸç†"/> <meta itemprop="keywords" content="Vite"/> <meta itemprop="datePublished" content="2025-12-17T08:05:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fightingä¸æƒ³è¯´è¯"/> <meta itemprop="url" content="https://juejin.cn/user/1116759545614173"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Viteä¸­resolve.aliasåŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759545614173/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fightingä¸æƒ³è¯´è¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:05:26.000Z" title="Wed Dec 17 2025 08:05:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Vite çš„ resolve.alias æ˜¯ç°ä»£å‰ç«¯é¡¹ç›®ä¸­å‡ ä¹å¿…å¤‡çš„é…ç½®ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ç”¨ç®€æ´çš„è·¯å¾„åˆ«åï¼ˆå¦‚ @/components/Button.vueï¼‰å–ä»£ç¹ççš„ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ ../../../components/Button.vueï¼‰ã€‚</p>
<h3 data-id="heading-0">é…ç½®æ–¹å¼</h3>
<h5 data-id="heading-1">å¯¹è±¡å½¢å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./src'</span>),
      <span class="hljs-string">'@components'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./src/components'</span>),
      <span class="hljs-string">'@utils'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./src/utils'</span>),
    },
  },
})
</code></pre>
<h5 data-id="heading-2">æ•°ç»„å½¢å¼ï¼ˆæ”¯æŒæ­£åˆ™ï¼Œæ›´çµæ´»ï¼‰</h5>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-attr">resolve</span>: { 
    <span class="hljs-attr">alias</span>: [ 
        { <span class="hljs-attr">find</span>: <span class="hljs-string">'@'</span>, <span class="hljs-attr">replacement</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./src'</span>) }, 
        { <span class="hljs-attr">find</span>: <span class="hljs-regexp">/^~/</span>, <span class="hljs-attr">replacement</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./public'</span>) }
    ]
}
</code></pre>
<p>é…ç½®å®Œæˆåï¼Œå¯¼å…¥è·¯å¾„å˜å¾—éå¸¸æ¸…æ™°ï¼š</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/Button.vue'</span>
<span class="hljs-keyword">import</span> helper <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/helper.ts'</span>
</code></pre>
<h3 data-id="heading-3">æ‰‹å†™alias</h3>
<p>alias çš„æœ¬è´¨å°±æ˜¯<strong>éå†é…ç½®è§„åˆ™ï¼ŒåŒ¹é…è·¯å¾„åè¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveAlias</span>(<span class="hljs-params">importPath, aliasConfig = {}</span>) {
  <span class="hljs-comment">// å°†å¯¹è±¡è½¬ä¸ºæ•°ç»„å¹¶é€†åºéå†ï¼Œç¡®ä¿å…·ä½“åˆ«åä¼˜å…ˆåŒ¹é…</span>
  <span class="hljs-keyword">const</span> entries = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(aliasConfig).<span class="hljs-title function_">reverse</span>();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [alias, replacement] <span class="hljs-keyword">of</span> entries) {
    <span class="hljs-keyword">const</span> prefix = alias + <span class="hljs-string">'/'</span>;
    <span class="hljs-comment">// åŒ¹é… alias/ å¼€å¤´çš„è·¯å¾„ï¼ˆå¦‚ '@/xxx'ï¼‰</span>
    <span class="hljs-keyword">if</span> (importPath.<span class="hljs-title function_">startsWith</span>(prefix)) {
      <span class="hljs-keyword">return</span> importPath.<span class="hljs-title function_">replace</span>(alias, replacement);
    }
    <span class="hljs-comment">// åŒ¹é…çº¯åˆ«åï¼ˆå¦‚ '@'ï¼‰</span>
    <span class="hljs-keyword">if</span> (importPath === alias) {
      <span class="hljs-keyword">return</span> replacement;
    }
  }

  <span class="hljs-comment">// æœªåŒ¹é…ï¼Œè¿”å›åŸè·¯å¾„</span>
  <span class="hljs-keyword">return</span> importPath;
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> config = {
  <span class="hljs-string">'@'</span>: <span class="hljs-string">'/Users/project/src'</span>,
  <span class="hljs-string">'@components'</span>: <span class="hljs-string">'/Users/project/src/components'</span>,
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">resolveAlias</span>(<span class="hljs-string">'@/utils/tool.js'</span>));         
<span class="hljs-comment">// â†’ /Users/project/src/utils/tool.js</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">resolveAlias</span>(<span class="hljs-string">'@components/Header.vue'</span>));  
<span class="hljs-comment">// â†’ /Users/project/src/components/Header.vue</span>
</code></pre>
<h3 data-id="heading-4">åº•å±‚å®ç°ï¼š@rollup/plugin-alias</h3>
<p>Vite æ²¡æœ‰è‡ªå·±å®ç° alias åŠŸèƒ½ï¼Œè€Œæ˜¯ç›´æ¥å°†é…ç½®ä¼ é€’ç»™ Rollup çš„å®˜æ–¹æ’ä»¶ @rollup/plugin-aliasã€‚</p>
<ul>
<li><strong>å¼€å‘é˜¶æ®µï¼ˆvite devï¼‰</strong>ï¼šé€šè¿‡ Rollup æ’ä»¶é’©å­è°ƒç”¨ alias æ’ä»¶ã€‚</li>
<li><strong>æ„å»ºé˜¶æ®µï¼ˆvite buildï¼‰</strong>ï¼šå®Œå…¨äº¤ç»™ Rollup å¤„ç†ã€‚</li>
</ul>
<p><strong>æ ¸å¿ƒå‘ç”Ÿåœ¨ Rollup çš„ resolveId æ’ä»¶é’©å­ä¸­ï¼š</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// @rollup/plugin-alias ç®€åŒ–ä¼ªä»£ç </span>
<span class="hljs-title function_">plugin</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'alias'</span>,
    <span class="hljs-comment">// sourceï¼ˆimport è¯­å¥ä¸­çš„åŸå§‹è·¯å¾„å­—ç¬¦ä¸²ï¼Œimport Button from '@/components/Button.vue'ï¼‰</span>
    <span class="hljs-comment">// importerï¼ˆç›¸å¯¹è·¯å¾„ï¼‰</span>
    <span class="hljs-title function_">resolveId</span>(<span class="hljs-params">source, importer</span>) {
      <span class="hljs-comment">// éå†ç”¨æˆ·åœ¨ vite.config.js ä¸­é…ç½®çš„æ‰€æœ‰ alias è§„åˆ™</span>
      <span class="hljs-comment">// findï¼ˆ@ï¼‰, replacementï¼ˆ/Users/ä½ çš„é¡¹ç›®/srcï¼‰ï¼ˆalias: { '@': '/Users/ä½ çš„é¡¹ç›®/src' }ï¼‰</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { find, replacement } <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">entries</span>) {
        <span class="hljs-comment">// æƒ…å†µ 1ï¼šfind æ˜¯æ™®é€šå­—ç¬¦ä¸²ï¼ˆå¦‚ '@'ï¼‰</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> find === <span class="hljs-string">'string'</span>) {
          <span class="hljs-comment">// å¸¸è§åŒ¹é…æ¨¡å¼ï¼šè·¯å¾„ä»¥ "åˆ«å/" å¼€å¤´ï¼ˆå¦‚ '@/xxx'ï¼‰ </span>
          <span class="hljs-comment">// æˆ–è€…è·¯å¾„å®Œå…¨ç­‰äºåˆ«åï¼ˆå¦‚ import '@'ï¼Œè™½ç„¶å¾ˆå°‘è§ï¼‰</span>
          <span class="hljs-keyword">if</span> (source.<span class="hljs-title function_">startsWith</span>(find + <span class="hljs-string">'/'</span>) || source === find) {
            <span class="hljs-comment">// ç›´æ¥è¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢ï¼Œè¿”å›æ–°çš„ç»å¯¹è·¯å¾„ </span>
            <span class="hljs-comment">// ä¾‹å¦‚ï¼š'@/utils/tool.js' â†’ '/project/src/utils/tool.js'</span>
            <span class="hljs-keyword">return</span> source.<span class="hljs-title function_">replace</span>(find, replacement);
          }
        <span class="hljs-comment">// æƒ…å†µ 2ï¼šfind æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¦‚ /^~\/(.*)/ï¼‰</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (find <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span> &amp;&amp; find.<span class="hljs-title function_">test</span>(source)) {
          <span class="hljs-comment">// æ­£åˆ™åŒ¹é…æˆåŠŸåï¼ŒåŒæ ·ä½¿ç”¨ replace è¿›è¡Œæ›¿æ¢ </span>
          <span class="hljs-comment">// replacement ä¸­å¯ä»¥ä½¿ç”¨ $1ã€$2 ç­‰æ•è·ç»„ </span>
          <span class="hljs-comment">// ä¾‹å¦‚ï¼š'~/images/logo.png' â†’ '/project/public/images/logo.png'</span>
          <span class="hljs-keyword">return</span> source.<span class="hljs-title function_">replace</span>(find, replacement);
        }
        <span class="hljs-comment">// å¦‚æœå½“å‰è§„åˆ™ä¸åŒ¹é…ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€æ¡è§„åˆ™</span>
      }
      <span class="hljs-comment">// æ‰€æœ‰ alias è§„åˆ™éƒ½æœªåŒ¹é…ï¼Œè¿”å› null </span>
      <span class="hljs-comment">// è¡¨ç¤ºæœ¬æ’ä»¶ä¸å¤„ç†æ­¤è·¯å¾„ï¼Œè®© Rollup ç»§ç»­ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿè§£ææˆ–å…¶å®ƒæ’ä»¶</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; 
    }
  };
}
</code></pre>
<p>æ ¸å¿ƒåœ¨ Rollup çš„ resolveId é’©å­ï¼ˆæ’ä»¶æœ€å…³é”®çš„é’©å­ï¼‰ï¼š</p>
<ol>
<li>å½“é‡åˆ° import '@/xxx' æ—¶ï¼ŒRollup è°ƒç”¨æ‰€æœ‰æ’ä»¶çš„ resolveId(source, importer)ã€‚</li>
<li>@rollup/plugin-alias éå†ä½ çš„ alias entriesã€‚</li>
<li>å¦‚æœ source åŒ¹é… findï¼ˆå­—ç¬¦ä¸²æˆ–æ­£åˆ™ï¼‰ï¼Œè¿”å›æ›¿æ¢åçš„ replacement ä½œä¸ºæ–° IDã€‚</li>
<li>Rollup ç»§ç»­ç”¨æ–° ID æŸ¥æ‰¾æ–‡ä»¶ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux ä¼‘çœ å”¤é†’æœºåˆ¶è¯¦è§£ï¼ˆä¸Šï¼‰]]></title>    <link>https://juejin.cn/post/7584426949864947755</link>    <guid>https://juejin.cn/post/7584426949864947755</guid>    <pubDate>2025-12-17T08:05:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584426949864947755" data-draft-id="7584432435591446582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux ä¼‘çœ å”¤é†’æœºåˆ¶è¯¦è§£ï¼ˆä¸Šï¼‰"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-17T08:05:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_CH"/> <meta itemprop="url" content="https://juejin.cn/user/4074114702122217"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux ä¼‘çœ å”¤é†’æœºåˆ¶è¯¦è§£ï¼ˆä¸Šï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4074114702122217/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_CH
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:05:02.000Z" title="Wed Dec 17 2025 08:05:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. æ¦‚è¿°</h2>
<h3 data-id="heading-1">1.1 ä»€ä¹ˆæ˜¯ä¼‘çœ å’Œå”¤é†’ï¼Ÿ</h3>
<p><strong>ä¼‘çœ ï¼ˆSuspendï¼‰çš„å®šä¹‰</strong>ï¼š</p>
<p>ä¼‘çœ æ˜¯ Linux ç³»ç»Ÿçš„ä¸€ç§ç”µæºç®¡ç†åŠŸèƒ½ï¼Œå…è®¸ç³»ç»Ÿè¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼ŒåŒæ—¶ä¿æŒç³»ç»ŸçŠ¶æ€ï¼Œä»¥ä¾¿å¿«é€Ÿæ¢å¤ã€‚åœ¨ä¼‘çœ çŠ¶æ€ä¸‹ï¼Œç³»ç»Ÿçš„å¤§éƒ¨åˆ†ç¡¬ä»¶è¢«å…³é—­æˆ–è¿›å…¥ä½åŠŸè€—æ¨¡å¼ï¼Œåªæœ‰å¿…è¦çš„ç¡¬ä»¶ä¿æŒè¿è¡Œä»¥æ”¯æŒå”¤é†’ã€‚</p>
<p><strong>å”¤é†’ï¼ˆResumeï¼‰çš„å®šä¹‰</strong>ï¼š</p>
<p>å”¤é†’æ˜¯ä»ä¼‘çœ çŠ¶æ€æ¢å¤åˆ°æ­£å¸¸å·¥ä½œçŠ¶æ€çš„è¿‡ç¨‹ã€‚å½“ç³»ç»Ÿæ¥æ”¶åˆ°å”¤é†’äº‹ä»¶ï¼ˆå¦‚æŒ‰é”®ã€ç½‘ç»œæ•°æ®åŒ…ã€å®šæ—¶å™¨ç­‰ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šä»ä¼‘çœ çŠ¶æ€æ¢å¤ï¼Œæ¢å¤åˆ°ä¼‘çœ å‰çš„çŠ¶æ€ã€‚</p>
<p><strong>ä¼‘çœ å’Œå”¤é†’çš„ç›®çš„</strong>ï¼š</p>
<ol>
<li><strong>èŠ‚çœåŠŸè€—</strong>ï¼šåœ¨ç³»ç»Ÿä¸ä½¿ç”¨æ—¶é™ä½åŠŸè€—</li>
<li><strong>å¿«é€Ÿæ¢å¤</strong>ï¼šå¿«é€Ÿæ¢å¤åˆ°å·¥ä½œçŠ¶æ€</li>
<li><strong>ä¿æŒçŠ¶æ€</strong>ï¼šä¿æŒç³»ç»ŸçŠ¶æ€ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨</li>
</ol>
<h3 data-id="heading-2">1.2 Linux ä¼‘çœ çŠ¶æ€</h3>
<p><strong>ACPI ä¼‘çœ çŠ¶æ€</strong>ï¼š</p>
<p>Linux æ”¯æŒ ACPIï¼ˆAdvanced Configuration and Power Interfaceï¼‰å®šä¹‰çš„ä¼‘çœ çŠ¶æ€ï¼š</p>






















































<table><thead><tr><th>çŠ¶æ€</th><th>åç§°</th><th>åŠŸè€—</th><th>æ¢å¤æ—¶é—´</th><th>çŠ¶æ€ä¿å­˜ä½ç½®</th></tr></thead><tbody><tr><td>S0</td><td>Working</td><td>æ­£å¸¸</td><td>-</td><td>-</td></tr><tr><td>S1</td><td>Standby</td><td>ä½</td><td>å¾ˆå¿«</td><td>RAM</td></tr><tr><td>S2</td><td>Standby</td><td>æ›´ä½</td><td>å¾ˆå¿«</td><td>RAM</td></tr><tr><td>S3</td><td>Suspend to RAM (STR)</td><td>å¾ˆä½</td><td>å¿«</td><td>RAM</td></tr><tr><td>S4</td><td>Suspend to Disk (STD/Hibernate)</td><td>æä½</td><td>æ…¢</td><td>ç£ç›˜</td></tr><tr><td>S5</td><td>Shutdown</td><td>æ— </td><td>å¾ˆæ…¢</td><td>-</td></tr></tbody></table>
<p><strong>Linux ä¸­çš„ä¼‘çœ çŠ¶æ€</strong>ï¼š</p>
<p>Linux ä¸»è¦æ”¯æŒä»¥ä¸‹ä¼‘çœ çŠ¶æ€ï¼š</p>
<ol>
<li>
<p><strong>mem (Suspend to RAM / S3)</strong>ï¼š</p>
<ul>
<li>ç³»ç»ŸçŠ¶æ€ä¿å­˜åœ¨ RAM ä¸­</li>
<li>å¤§éƒ¨åˆ†ç¡¬ä»¶å…³é—­</li>
<li>æ¢å¤æ—¶é—´å¿«ï¼ˆå‡ ç§’ï¼‰</li>
<li>åŠŸè€—ä½</li>
</ul>
</li>
<li>
<p><strong>disk (Suspend to Disk / Hibernate / S4)</strong>ï¼š</p>
<ul>
<li>ç³»ç»ŸçŠ¶æ€ä¿å­˜åˆ°ç£ç›˜</li>
<li>æ‰€æœ‰ç¡¬ä»¶å…³é—­</li>
<li>æ¢å¤æ—¶é—´æ…¢ï¼ˆå‡ åç§’ï¼‰</li>
<li>åŠŸè€—æä½ï¼ˆå‡ ä¹ä¸ºé›¶ï¼‰</li>
</ul>
</li>
<li>
<p><strong>standby (S1)</strong>ï¼š</p>
<ul>
<li>ç³»ç»ŸçŠ¶æ€ä¿å­˜åœ¨ RAM ä¸­</li>
<li>éƒ¨åˆ†ç¡¬ä»¶å…³é—­</li>
<li>æ¢å¤æ—¶é—´å¾ˆå¿«</li>
<li>åŠŸè€—è¾ƒä½</li>
</ul>
</li>
<li>
<p><strong>freeze (Suspend to Idle)</strong>ï¼š</p>
<ul>
<li>ç³»ç»Ÿè¿›å…¥ç©ºé—²çŠ¶æ€</li>
<li>æ‰€æœ‰ç”¨æˆ·ç©ºé—´è¿›ç¨‹å†»ç»“</li>
<li>CPU è¿›å…¥ç©ºé—²çŠ¶æ€</li>
<li>åŠŸè€—æœ€ä½ï¼ˆä½†ä¿æŒè¿è¡Œï¼‰</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">1.3 ä¼‘çœ å”¤é†’çš„æµç¨‹</h3>
<p><strong>ä¼‘çœ æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç”¨æˆ·è§¦å‘ä¼‘çœ ï¼ˆecho mem &gt; /sys/power/stateï¼‰
   â†“
<span class="hljs-bullet">2.</span> å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹
   â†“
<span class="hljs-bullet">3.</span> å†»ç»“å†…æ ¸çº¿ç¨‹
   â†“
<span class="hljs-bullet">4.</span> è°ƒç”¨è®¾å¤‡é©±åŠ¨çš„ suspend å›è°ƒ
   â†“
<span class="hljs-bullet">5.</span> ä¿å­˜ç³»ç»ŸçŠ¶æ€
   â†“
<span class="hljs-bullet">6.</span> è¿›å…¥ä¼‘çœ çŠ¶æ€
</code></pre>
<p><strong>å”¤é†’æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> å”¤é†’äº‹ä»¶å‘ç”Ÿï¼ˆæŒ‰é”®ã€ç½‘ç»œæ•°æ®åŒ…ç­‰ï¼‰
   â†“
<span class="hljs-bullet">2.</span> ç¡¬ä»¶ä¸­æ–­è§¦å‘
   â†“
<span class="hljs-bullet">3.</span> ä»ä¼‘çœ çŠ¶æ€æ¢å¤
   â†“
<span class="hljs-bullet">4.</span> æ¢å¤ç³»ç»ŸçŠ¶æ€
   â†“
<span class="hljs-bullet">5.</span> è°ƒç”¨è®¾å¤‡é©±åŠ¨çš„ resume å›è°ƒ
   â†“
<span class="hljs-bullet">6.</span> è§£å†»å†…æ ¸çº¿ç¨‹
   â†“
<span class="hljs-bullet">7.</span> è§£å†»ç”¨æˆ·ç©ºé—´è¿›ç¨‹
   â†“
<span class="hljs-bullet">8.</span> ç³»ç»Ÿæ¢å¤æ­£å¸¸è¿è¡Œ
</code></pre>
<hr/>
<h2 data-id="heading-4">2. ä¼‘çœ æµç¨‹è¯¦è§£</h2>
<h3 data-id="heading-5">2.1 ç”¨æˆ·ç©ºé—´è§¦å‘ä¼‘çœ </h3>
<p><strong>é€šè¿‡ sysfs è§¦å‘ä¼‘çœ </strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥ Suspend to RAM</span>
<span class="hljs-built_in">echo</span> mem &gt; /sys/power/state

<span class="hljs-comment"># è¿›å…¥ Suspend to Disk (Hibernate)</span>
<span class="hljs-built_in">echo</span> disk &gt; /sys/power/state

<span class="hljs-comment"># è¿›å…¥ Suspend to Idle</span>
<span class="hljs-built_in">echo</span> freeze &gt; /sys/power/state
</code></pre>
<p><strong>sysfs æ¥å£çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/main.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">ssize_t</span> <span class="hljs-title function_">state_store</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> kobject *kobj, <span class="hljs-keyword">struct</span> kobj_attribute *attr,
                           <span class="hljs-type">const</span> <span class="hljs-type">char</span> *buf, <span class="hljs-type">size_t</span> n)</span>
{
    <span class="hljs-type">suspend_state_t</span> state;
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. è§£æçŠ¶æ€å­—ç¬¦ä¸²</span>
    error = pm_autosleep_lock();
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-keyword">if</span> (pm_autosleep_state() &gt; PM_SUSPEND_ON) {
        error = -EBUSY;
        <span class="hljs-keyword">goto</span> out;
    }
    
    <span class="hljs-comment">// 2. è½¬æ¢çŠ¶æ€å­—ç¬¦ä¸²åˆ°çŠ¶æ€å€¼</span>
    state = decode_state(buf, n);
    <span class="hljs-keyword">if</span> (state &lt; PM_SUSPEND_MAX) {
        <span class="hljs-keyword">if</span> (state == PM_SUSPEND_MEM)
            state = mem_sleep_current;
        
        <span class="hljs-comment">// 3. è°ƒç”¨ä¼‘çœ å‡½æ•°</span>
        error = pm_suspend(state);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state == PM_SUSPEND_MAX) {
        error = hibernate();
    } <span class="hljs-keyword">else</span> {
        error = -EINVAL;
    }
    
out:
    pm_autosleep_unlock();
    <span class="hljs-keyword">return</span> error ? error : n;
}
</code></pre>
<h3 data-id="heading-6">2.2 è¿›ç¨‹å†»ç»“ï¼ˆFreezeï¼‰</h3>
<p><strong>å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/process.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">freeze_processes</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. è®¾ç½®ç³»ç»Ÿå†»ç»“æ ‡å¿—</span>
    error = __usermodehelper_disable(UMH_FREEZING);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// 2. å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</span>
    error = try_to_freeze_tasks(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">if</span> (!error) {
        __usermodehelper_set_disable_depth(UMH_DISABLED);
        pr_info(<span class="hljs-string">"Freezing user space processes ... "</span>);
        error = try_to_freeze_tasks(<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (error)
            <span class="hljs-keyword">goto</span> <span class="hljs-built_in">exit</span>;
        pr_cont(<span class="hljs-string">"done.\n"</span>);
    }
    
<span class="hljs-built_in">exit</span>:
    __usermodehelper_thaw();
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>try_to_freeze_tasks() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/process.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">try_to_freeze_tasks</span><span class="hljs-params">(<span class="hljs-type">bool</span> user_only)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> *<span class="hljs-title">g</span>, *<span class="hljs-title">p</span>;</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> end_time;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> todo;
    <span class="hljs-type">bool</span> wq_busy = <span class="hljs-literal">false</span>;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">start</span>, <span class="hljs-title">end</span>;</span>
    u64 elapsed_msecs64;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> elapsed_msecs;
    <span class="hljs-type">bool</span> wakeup = <span class="hljs-literal">false</span>;
    <span class="hljs-type">int</span> sleep_usecs = USEC_PER_MSEC;
    
    end_time = jiffies + msecs_to_jiffies(freeze_timeout_msecs);
    
    <span class="hljs-keyword">do</span> {
        todo = <span class="hljs-number">0</span>;
        wq_busy = <span class="hljs-literal">false</span>;
        
        <span class="hljs-comment">// éå†æ‰€æœ‰è¿›ç¨‹</span>
        read_lock(&amp;tasklist_lock);
        for_each_process_thread(g, p) {
            <span class="hljs-keyword">if</span> (p == current || !freeze_task(p))
                <span class="hljs-keyword">continue</span>;
            
            <span class="hljs-keyword">if</span> (!freezer_should_skip(p))
                todo++;
        }
        read_unlock(&amp;tasklist_lock);
        
        <span class="hljs-comment">// æ£€æŸ¥å·¥ä½œé˜Ÿåˆ—</span>
        <span class="hljs-keyword">if</span> (todo &amp;&amp; has_wake_lock(WAKE_LOCK_SUSPEND)) {
            wq_busy = <span class="hljs-literal">true</span>;
            todo = <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-keyword">if</span> (!todo || time_after(jiffies, end_time))
            <span class="hljs-keyword">break</span>;
        
        <span class="hljs-comment">// ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•</span>
        usleep_range(sleep_usecs, sleep_usecs + sleep_usecs / <span class="hljs-number">2</span>);
        sleep_usecs *= <span class="hljs-number">2</span>;
    } <span class="hljs-keyword">while</span> (todo);
    
    <span class="hljs-keyword">return</span> todo ? -EBUSY : <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>freeze_task() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/freezer.c</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">freeze_task</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> task_struct *p)</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    spin_lock_irqsave(&amp;freezer_lock, flags);
    
    <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦å¯ä»¥å†»ç»“</span>
    <span class="hljs-keyword">if</span> (!freezing(p) || frozen(p) || __refrigerator(p)) {
        spin_unlock_irqrestore(&amp;freezer_lock, flags);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. è®¾ç½®å†»ç»“æ ‡å¿—</span>
    set_freeze_flag(p);
    
    <span class="hljs-comment">// 3. å‘é€å†»ç»“ä¿¡å·</span>
    signal_wake_up(p, <span class="hljs-literal">false</span>);
    
    spin_unlock_irqrestore(&amp;freezer_lock, flags);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h3 data-id="heading-7">2.3 è®¾å¤‡é©±åŠ¨çš„ suspend å›è°ƒ</h3>
<p><strong>è®¾å¤‡é©±åŠ¨çš„ suspend å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/main.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">dpm_suspend</span><span class="hljs-params">(<span class="hljs-type">pm_message_t</span> state)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">dev</span>;</span>
    <span class="hljs-type">int</span> error = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 1. æŒ‰é¡ºåºè°ƒç”¨æ‰€æœ‰è®¾å¤‡çš„ suspend å›è°ƒ</span>
    list_for_each_entry_reverse(dev, &amp;dpm_list, power.entry) {
        error = device_suspend(dev, state);
        <span class="hljs-keyword">if</span> (error) {
            pm_dev_err(dev, state, <span class="hljs-string">""</span>, error);
            <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-keyword">return</span> error;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">device_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-type">pm_message_t</span> state)</span>
{
    <span class="hljs-type">pm_callback_t</span> callback = <span class="hljs-literal">NULL</span>;
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *info = <span class="hljs-literal">NULL</span>;
    <span class="hljs-type">int</span> error = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 1. è°ƒç”¨é©±åŠ¨çš„ suspend å›è°ƒ</span>
    <span class="hljs-keyword">if</span> (dev-&gt;driver &amp;&amp; dev-&gt;driver-&gt;pm &amp;&amp; dev-&gt;driver-&gt;pm-&gt;suspend) {
        info = <span class="hljs-string">"legacy PM "</span>;
        callback = pm_late_early_op(dev-&gt;driver-&gt;pm-&gt;suspend, state);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dev-&gt;type &amp;&amp; dev-&gt;type-&gt;pm) {
        info = <span class="hljs-string">"legacy type PM "</span>;
        callback = pm_late_early_op(dev-&gt;type-&gt;pm-&gt;suspend, state);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dev-&gt;class &amp;&amp; dev-&gt;class-&gt;pm) {
        info = <span class="hljs-string">"legacy class PM "</span>;
        callback = pm_late_early_op(dev-&gt;class-&gt;pm-&gt;suspend, state);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dev-&gt;bus &amp;&amp; dev-&gt;bus-&gt;pm) {
        info = <span class="hljs-string">"legacy bus PM "</span>;
        callback = pm_late_early_op(dev-&gt;bus-&gt;pm-&gt;suspend, state);
    }
    
    <span class="hljs-keyword">if</span> (callback)
        error = callback(dev);
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šç½‘å¡é©±åŠ¨çš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/net/ethernet/example.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">net_device</span> *<span class="hljs-title">netdev</span> =</span> dev_get_drvdata(dev);
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_private</span> *<span class="hljs-title">priv</span> =</span> netdev_priv(netdev);
    
    <span class="hljs-comment">// 1. åœæ­¢ç½‘ç»œæ¥å£</span>
    netif_device_detach(netdev);
    
    <span class="hljs-comment">// 2. åœæ­¢æ¥æ”¶å’Œå‘é€</span>
    napi_disable(&amp;priv-&gt;napi);
    
    <span class="hljs-comment">// 3. å…³é—­ç½‘å¡</span>
    example_stop(netdev);
    
    <span class="hljs-comment">// 4. ä¿å­˜å¯„å­˜å™¨çŠ¶æ€</span>
    priv-&gt;saved_regs = ioread32(priv-&gt;base + REG_CONFIG);
    
    <span class="hljs-comment">// 5. è¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    iowrite32(priv-&gt;saved_regs | POWER_DOWN, priv-&gt;base + REG_CONFIG);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-8">2.4 è¿›å…¥ä¼‘çœ çŠ¶æ€</h3>
<p><strong>Suspend to RAM çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state, <span class="hljs-type">bool</span> *wakeup)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. ç¦ç”¨ä¸­æ–­</span>
    local_irq_disable();
    
    <span class="hljs-comment">// 2. åˆ·æ–°ç¼“å­˜</span>
    syscore_suspend();
    
    <span class="hljs-comment">// 3. è°ƒç”¨å¹³å°ç‰¹å®šçš„ suspend å‡½æ•°</span>
    error = suspend_ops-&gt;enter(state);
    
    <span class="hljs-comment">// 4. å¦‚æœè¿”å›ï¼Œè¯´æ˜è¢«å”¤é†’</span>
    syscore_resume();
    
    local_irq_enable();
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>å¹³å°ç‰¹å®šçš„ suspend å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">cpu_suspend</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg, <span class="hljs-type">int</span> (*fn)(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>))</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sleep_stack_data</span> <span class="hljs-title">state</span>;</span>
    
    <span class="hljs-comment">// 1. ä¿å­˜ CPU çŠ¶æ€</span>
    __cpu_suspend_enter(&amp;state);
    
    <span class="hljs-comment">// 2. è°ƒç”¨å¹³å°ç‰¹å®šçš„ suspend å‡½æ•°</span>
    ret = fn(arg);
    
    <span class="hljs-comment">// 3. å¦‚æœè¿”å›ï¼Œæ¢å¤ CPU çŠ¶æ€</span>
    __cpu_suspend_exit(&amp;state);
    
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<hr/>
<h2 data-id="heading-9">3. å”¤é†’æµç¨‹è¯¦è§£</h2>
<h3 data-id="heading-10">3.1 å”¤é†’äº‹ä»¶</h3>
<p><strong>å”¤é†’æºï¼ˆWakeup Sourceï¼‰</strong>ï¼š</p>
<p>å”¤é†’æºæ˜¯å¯ä»¥å”¤é†’ç³»ç»Ÿçš„ç¡¬ä»¶æˆ–è½¯ä»¶äº‹ä»¶ï¼š</p>
<ol>
<li>
<p><strong>ç¡¬ä»¶å”¤é†’æº</strong>ï¼š</p>
<ul>
<li>æŒ‰é”®ï¼ˆé”®ç›˜ã€ç”µæºé”®ï¼‰</li>
<li>ç½‘ç»œæ•°æ®åŒ…ï¼ˆWake-on-LANï¼‰</li>
<li>USB è®¾å¤‡æ’å…¥</li>
<li>RTC å®šæ—¶å™¨</li>
<li>ä¼ æ„Ÿå™¨äº‹ä»¶</li>
</ul>
</li>
<li>
<p><strong>è½¯ä»¶å”¤é†’æº</strong>ï¼š</p>
<ul>
<li>å®šæ—¶å™¨åˆ°æœŸ</li>
<li>å·¥ä½œé˜Ÿåˆ—ä»»åŠ¡</li>
<li>å†…æ ¸çº¿ç¨‹</li>
</ul>
</li>
</ol>
<p><strong>å”¤é†’æºçš„æ³¨å†Œ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-keyword">struct</span> wakeup_source *<span class="hljs-title function_">wakeup_source_register</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev,
                                              <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wakeup_source</span> *<span class="hljs-title">ws</span>;</span>
    
    <span class="hljs-comment">// 1. åˆ†é…å”¤é†’æºç»“æ„</span>
    ws = kzalloc(<span class="hljs-keyword">sizeof</span>(*ws), GFP_KERNEL);
    <span class="hljs-keyword">if</span> (!ws)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    
    <span class="hljs-comment">// 2. åˆå§‹åŒ–å”¤é†’æº</span>
    wakeup_source_init(ws, name);
    
    <span class="hljs-comment">// 3. æ·»åŠ åˆ°å”¤é†’æºåˆ—è¡¨</span>
    list_add_rcu(&amp;ws-&gt;entry, &amp;wakeup_sources);
    
    <span class="hljs-keyword">return</span> ws;
}
</code></pre>
<h3 data-id="heading-11">3.2 å”¤é†’ä¸­æ–­å¤„ç†</h3>
<p><strong>å”¤é†’ä¸­æ–­çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ç¤ºä¾‹ï¼šæŒ‰é”®å”¤é†’ä¸­æ–­å¤„ç†</span>
<span class="hljs-type">static</span> <span class="hljs-type">irqreturn_t</span> <span class="hljs-title function_">power_button_irq</span><span class="hljs-params">(<span class="hljs-type">int</span> irq, <span class="hljs-type">void</span> *dev_id)</span>
{
    <span class="hljs-comment">// 1. æ ‡è®°å”¤é†’äº‹ä»¶</span>
    pm_wakeup_event(dev, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 2. å”¤é†’ç³»ç»Ÿ</span>
    pm_system_wakeup();
    
    <span class="hljs-keyword">return</span> IRQ_HANDLED;
}
</code></pre>
<p><strong>pm_wakeup_event() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">pm_wakeup_event</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> msec)</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    <span class="hljs-keyword">if</span> (!dev)
        <span class="hljs-keyword">return</span>;
    
    spin_lock_irqsave(&amp;dev-&gt;power.lock, flags);
    
    <span class="hljs-comment">// 1. æ›´æ–°å”¤é†’æºæ—¶é—´</span>
    __pm_wakeup_event(dev-&gt;power.wakeup, msec);
    
    spin_unlock_irqrestore(&amp;dev-&gt;power.lock, flags);
}
</code></pre>
<h3 data-id="heading-12">3.3 ä»ä¼‘çœ çŠ¶æ€æ¢å¤</h3>
<p><strong>å¹³å°ç‰¹å®šçš„ resume å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">cpu_resume</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. æ¢å¤ CPU çŠ¶æ€</span>
    cpu_suspend_exit();
    
    <span class="hljs-comment">// 2. æ¢å¤ MMU</span>
    cpu_do_resume(<span class="hljs-literal">NULL</span>);
    
    <span class="hljs-comment">// 3. æ¢å¤ä¸­æ–­</span>
    local_irq_enable();
}
</code></pre>
<p><strong>è®¾å¤‡é©±åŠ¨çš„ resume å›è°ƒ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/main.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">dpm_resume</span><span class="hljs-params">(<span class="hljs-type">pm_message_t</span> state)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">dev</span>;</span>
    <span class="hljs-type">int</span> error = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 1. æŒ‰é¡ºåºè°ƒç”¨æ‰€æœ‰è®¾å¤‡çš„ resume å›è°ƒ</span>
    list_for_each_entry(dev, &amp;dpm_list, power.entry) {
        error = device_resume(dev, state, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (error) {
            pm_dev_err(dev, state, <span class="hljs-string">" async"</span>, error);
            <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šç½‘å¡é©±åŠ¨çš„ resume</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/net/ethernet/example.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_resume</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">net_device</span> *<span class="hljs-title">netdev</span> =</span> dev_get_drvdata(dev);
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_private</span> *<span class="hljs-title">priv</span> =</span> netdev_priv(netdev);
    
    <span class="hljs-comment">// 1. é€€å‡ºä½åŠŸè€—æ¨¡å¼</span>
    iowrite32(priv-&gt;saved_regs, priv-&gt;base + REG_CONFIG);
    
    <span class="hljs-comment">// 2. æ¢å¤å¯„å­˜å™¨çŠ¶æ€</span>
    iowrite32(priv-&gt;saved_regs, priv-&gt;base + REG_CONFIG);
    
    <span class="hljs-comment">// 3. é‡æ–°åˆå§‹åŒ–ç½‘å¡</span>
    example_init(netdev);
    
    <span class="hljs-comment">// 4. å¯åŠ¨æ¥æ”¶å’Œå‘é€</span>
    napi_enable(&amp;priv-&gt;napi);
    
    <span class="hljs-comment">// 5. æ¢å¤ç½‘ç»œæ¥å£</span>
    netif_device_attach(netdev);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-13">3.4 è§£å†»è¿›ç¨‹</h3>
<p><strong>è§£å†»ç”¨æˆ·ç©ºé—´è¿›ç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/process.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">thaw_processes</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> *<span class="hljs-title">g</span>, *<span class="hljs-title">p</span>;</span>
    
    pr_info(<span class="hljs-string">"Restarting tasks ... "</span>);
    
    <span class="hljs-comment">// 1. æ¸…é™¤å†»ç»“æ ‡å¿—</span>
    __usermodehelper_set_disable_depth(UMH_FREEZING);
    
    <span class="hljs-comment">// 2. è§£å†»æ‰€æœ‰è¿›ç¨‹</span>
    read_lock(&amp;tasklist_lock);
    for_each_process_thread(g, p) {
        __thaw_task(p);
    }
    read_unlock(&amp;tasklist_lock);
    
    <span class="hljs-comment">// 3. ç­‰å¾…æ‰€æœ‰è¿›ç¨‹è§£å†»</span>
    schedule();
    
    pr_cont(<span class="hljs-string">"done.\n"</span>);
}
</code></pre>
<p><strong>__thaw_task() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/freezer.c</span>
<span class="hljs-type">void</span> __thaw_task(<span class="hljs-keyword">struct</span> task_struct *p)
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    spin_lock_irqsave(&amp;freezer_lock, flags);
    
    <span class="hljs-comment">// 1. æ¸…é™¤å†»ç»“æ ‡å¿—</span>
    <span class="hljs-keyword">if</span> (frozen(p)) {
        clear_frozen(p);
    } <span class="hljs-keyword">else</span> {
        WARN_ON(!frozen(p));
    }
    
    <span class="hljs-comment">// 2. å”¤é†’è¿›ç¨‹</span>
    wake_up_process(p);
    
    spin_unlock_irqrestore(&amp;freezer_lock, flags);
}
</code></pre>
<hr/>
<h2 data-id="heading-14">4. åº•å±‚å®ç°åŸç†</h2>
<h3 data-id="heading-15">4.1 CPU çŠ¶æ€ä¿å­˜å’Œæ¢å¤</h3>
<p><strong>CPU å¯„å­˜å™¨ä¿å­˜</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sleep_stack_data</span> {</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cpu_suspend_ctx</span>    <span class="hljs-title">cpu_context</span>;</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>              <span class="hljs-built_in">stack</span>[THREAD_SIZE / <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">long</span>)];
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cpu_suspend_ctx</span> {</span>
    u64    tpidr_el0;
    u64    tpidrro_el0;
    u64    contextidr_el1;
    u64    sp_el0;
    u64    sp_el1;
    u64    elr_el1;
    u64    spsr_el1;
    u64    x19;
    u64    x20;
    u64    x21;
    u64    x22;
    u64    x23;
    u64    x24;
    u64    x25;
    u64    x26;
    u64    x27;
    u64    x28;
    u64    fp;
    u64    lr;
};

<span class="hljs-type">static</span> <span class="hljs-type">void</span> notrace __cpu_suspend_enter(<span class="hljs-keyword">struct</span> sleep_stack_data *state)
{
    <span class="hljs-comment">// ä¿å­˜ CPU å¯„å­˜å™¨</span>
    state-&gt;cpu_context = *cpu_suspend_ctx;
}
</code></pre>
<p><strong>CPU å¯„å­˜å™¨æ¢å¤</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">void</span> notrace __cpu_suspend_exit(<span class="hljs-keyword">struct</span> sleep_stack_data *state)
{
    <span class="hljs-comment">// æ¢å¤ CPU å¯„å­˜å™¨</span>
    *cpu_suspend_ctx = state-&gt;cpu_context;
}
</code></pre>
<h3 data-id="heading-16">4.2 å†…å­˜çŠ¶æ€ä¿å­˜</h3>
<p><strong>Suspend to RAM çš„å†…å­˜çŠ¶æ€</strong>ï¼š</p>
<p>åœ¨ Suspend to RAM ä¸­ï¼Œå†…å­˜çŠ¶æ€ä¿å­˜åœ¨ RAM ä¸­ï¼Œä¸éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚ç³»ç»Ÿåªéœ€è¦ï¼š</p>
<ol>
<li>ä¿æŒ RAM ä¾›ç”µ</li>
<li>åˆ·æ–°ç¼“å­˜åˆ°å†…å­˜</li>
<li>è¿›å…¥ä½åŠŸè€—æ¨¡å¼</li>
</ol>
<p><strong>Suspend to Disk çš„å†…å­˜çŠ¶æ€ä¿å­˜</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/swap.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">swsusp_write</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">snapshot_handle</span> <span class="hljs-title">handle</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">swap_map_handle</span> <span class="hljs-title">swap</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">swsusp_info</span> *<span class="hljs-title">header</span>;</span>
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. åˆ†é…äº¤æ¢é¡µé¢</span>
    error = get_swap_writer(&amp;swap);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// 2. å†™å…¥å¤´éƒ¨ä¿¡æ¯</span>
    header = (<span class="hljs-keyword">struct</span> swsusp_info *)get_image_page(GFP_ATOMIC, PG_ANY);
    <span class="hljs-keyword">if</span> (!header) {
        error = -ENOMEM;
        <span class="hljs-keyword">goto</span> out_finish;
    }
    
    <span class="hljs-comment">// 3. ä¿å­˜å†…å­˜é¡µé¢</span>
    error = save_image(&amp;swap, &amp;handle, nr_pages);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> out_finish;
    
    <span class="hljs-comment">// 4. å†™å…¥ç»“æŸæ ‡è®°</span>
    error = flush_swap_writer(&amp;swap);
    
out_finish:
    put_swap_writer(&amp;swap);
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-17">4.3 ä¸­æ–­å’Œå®šæ—¶å™¨å¤„ç†</h3>
<p><strong>ä¸­æ–­çš„ç¦ç”¨å’Œæ¢å¤</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state, <span class="hljs-type">bool</span> *wakeup)</span>
{
    <span class="hljs-comment">// 1. ç¦ç”¨ä¸­æ–­</span>
    local_irq_disable();
    
    <span class="hljs-comment">// 2. åˆ·æ–°ä¸­æ–­å¤„ç†</span>
    syscore_suspend();
    
    <span class="hljs-comment">// 3. è¿›å…¥ä¼‘çœ </span>
    error = suspend_ops-&gt;enter(state);
    
    <span class="hljs-comment">// 4. æ¢å¤ä¸­æ–­å¤„ç†</span>
    syscore_resume();
    
    <span class="hljs-comment">// 5. æ¢å¤ä¸­æ–­</span>
    local_irq_enable();
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>å®šæ—¶å™¨çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/time/tick-common.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">tick_suspend</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tick_device</span> *<span class="hljs-title">td</span> =</span> this_cpu_ptr(&amp;tick_cpu_device);
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    local_irq_save(flags);
    
    <span class="hljs-comment">// 1. åœæ­¢å®šæ—¶å™¨</span>
    clockevents_shutdown(td-&gt;evtdev);
    
    local_irq_restore(flags);
}

<span class="hljs-type">void</span> <span class="hljs-title function_">tick_resume</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tick_device</span> *<span class="hljs-title">td</span> =</span> this_cpu_ptr(&amp;tick_cpu_device);
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    <span class="hljs-type">int</span> broadcast = tick_resume_broadcast();
    
    local_irq_save(flags);
    
    <span class="hljs-comment">// 1. æ¢å¤å®šæ—¶å™¨</span>
    clockevents_tick_resume(td-&gt;evtdev);
    
    local_irq_restore(flags);
}
</code></pre>
<hr/>
<h2 data-id="heading-18">5. è®¾å¤‡é©±åŠ¨æ”¯æŒ</h2>
<h3 data-id="heading-19">5.1 PM æ“ä½œç»“æ„</h3>
<p><strong>struct dev_pm_ops</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// include/linux/pm.h</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dev_pm_ops</span> {</span>
    <span class="hljs-type">int</span> (*prepare)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">void</span> (*complete)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*suspend)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*resume)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*freeze)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*thaw)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*poweroff)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*restore)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*suspend_late)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*resume_early)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*freeze_late)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*thaw_early)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*poweroff_late)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*restore_early)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*suspend_noirq)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*resume_noirq)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*freeze_noirq)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*thaw_noirq)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*poweroff_noirq)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*restore_noirq)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*runtime_suspend)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*runtime_resume)(<span class="hljs-keyword">struct</span> device *dev);
    <span class="hljs-type">int</span> (*runtime_idle)(<span class="hljs-keyword">struct</span> device *dev);
};
</code></pre>
<p><strong>PM å›è°ƒçš„æ‰§è¡Œé¡ºåº</strong>ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">Suspend:
<span class="hljs-number">1</span>. prepare()
<span class="hljs-number">2</span>. suspend()
<span class="hljs-number">3</span>. suspend_late()
<span class="hljs-number">4</span>. suspend_noir<span class="hljs-string">q()</span>

Resume:
<span class="hljs-number">1</span>. resume_noir<span class="hljs-string">q()</span>
<span class="hljs-number">2</span>. resume_early()
<span class="hljs-number">3</span>. resume()
<span class="hljs-number">4</span>. complete()
</code></pre>
<h3 data-id="heading-20">5.2 å”¤é†’æºç®¡ç†</h3>
<p><strong>å”¤é†’æºçš„å¯ç”¨å’Œç¦ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">device_set_wakeup_capable</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-type">bool</span> capable)</span>
{
    <span class="hljs-keyword">if</span> (capable) {
        <span class="hljs-keyword">if</span> (!dev-&gt;power.can_wakeup) {
            dev-&gt;power.can_wakeup = <span class="hljs-literal">true</span>;
            device_wakeup_attach(dev);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (dev-&gt;power.can_wakeup) {
            device_wakeup_detach(dev);
            dev-&gt;power.can_wakeup = <span class="hljs-literal">false</span>;
        }
    }
}

<span class="hljs-type">void</span> <span class="hljs-title function_">device_set_wakeup_enable</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-type">bool</span> enable)</span>
{
    <span class="hljs-keyword">if</span> (enable) {
        <span class="hljs-keyword">if</span> (dev-&gt;power.can_wakeup &amp;&amp; !dev-&gt;power.wakeup) {
            dev-&gt;power.wakeup = wakeup_source_register(dev, dev_name(dev));
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (dev-&gt;power.wakeup) {
            wakeup_source_unregister(dev-&gt;power.wakeup);
            dev-&gt;power.wakeup = <span class="hljs-literal">NULL</span>;
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-21">6. ä½¿ç”¨æ–¹å¼</h2>
<h3 data-id="heading-22">6.1 é€šè¿‡ sysfs æ§åˆ¶ä¼‘çœ </h3>
<p><strong>åŸºæœ¬ç”¨æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ”¯æŒçš„ä¼‘çœ çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/power/state

<span class="hljs-comment"># è¿›å…¥ Suspend to RAM</span>
<span class="hljs-built_in">echo</span> mem &gt; /sys/power/state

<span class="hljs-comment"># è¿›å…¥ Suspend to Disk</span>
<span class="hljs-built_in">echo</span> disk &gt; /sys/power/state

<span class="hljs-comment"># è¿›å…¥ Suspend to Idle</span>
<span class="hljs-built_in">echo</span> freeze &gt; /sys/power/state
</code></pre>
<p><strong>é€šè¿‡ systemd æ§åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥ä¼‘çœ </span>
systemctl <span class="hljs-built_in">suspend</span>

<span class="hljs-comment"># è¿›å…¥ä¼‘çœ åˆ°ç£ç›˜</span>
systemctl hibernate

<span class="hljs-comment"># è¿›å…¥æ··åˆä¼‘çœ ï¼ˆå…ˆä¼‘çœ åˆ°ç£ç›˜ï¼Œç„¶åè¿›å…¥ RAMï¼‰</span>
systemctl hybrid-sleep
</code></pre>
<h3 data-id="heading-23">6.2 é€šè¿‡ç¨‹åºæ§åˆ¶ä¼‘çœ </h3>
<p><strong>C è¯­è¨€ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">suspend_to_ram</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">int</span> fd;
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *state = <span class="hljs-string">"mem"</span>;
    
    <span class="hljs-comment">// æ‰“å¼€ sysfs æ¥å£</span>
    fd = open(<span class="hljs-string">"/sys/power/state"</span>, O_WRONLY);
    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"open"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    <span class="hljs-comment">// å†™å…¥çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (write(fd, state, <span class="hljs-built_in">strlen</span>(state)) &lt; <span class="hljs-number">0</span>) {
        perror(<span class="hljs-string">"write"</span>);
        close(fd);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
    
    close(fd);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>Python ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">suspend_to_ram</span>():
    <span class="hljs-string">"""è¿›å…¥ Suspend to RAM"""</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'/sys/power/state'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">'mem'</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    suspend_to_ram()
</code></pre>
<h3 data-id="heading-24">6.3 é…ç½®ä¼‘çœ å‚æ•°</h3>
<p><strong>é…ç½®å”¤é†’æº</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å”¤é†’æº</span>
<span class="hljs-built_in">cat</span> /sys/power/wake_lock
<span class="hljs-built_in">cat</span> /sys/power/wake_unlock

<span class="hljs-comment"># å¯ç”¨/ç¦ç”¨å”¤é†’æº</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PowerButton"</span> &gt; /sys/power/wake_lock
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PowerButton"</span> &gt; /sys/power/wake_unlock
</code></pre>
<p><strong>é…ç½®ä¼‘çœ è¶…æ—¶</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®è‡ªåŠ¨ä¼‘çœ è¶…æ—¶ï¼ˆç§’ï¼‰</span>
<span class="hljs-built_in">echo</span> 300 &gt; /sys/power/autosleep
</code></pre>
<hr/>
<h2 data-id="heading-25">7. è°ƒè¯•å’Œæ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-26">7.1 æŸ¥çœ‹ä¼‘çœ çŠ¶æ€</h3>
<p><strong>æŸ¥çœ‹æ”¯æŒçš„ä¼‘çœ çŠ¶æ€</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ”¯æŒçš„ä¼‘çœ çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/power/state

<span class="hljs-comment"># æŸ¥çœ‹å½“å‰ä¼‘çœ çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/power/mem_sleep
</code></pre>
<p><strong>æŸ¥çœ‹å”¤é†’æº</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å”¤é†’æº</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/wakeup_sources

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šè®¾å¤‡çš„å”¤é†’æº</span>
<span class="hljs-built_in">cat</span> /sys/devices/.../power/wakeup
</code></pre>
<h3 data-id="heading-27">7.2 è°ƒè¯•ä¼‘çœ é—®é¢˜</h3>
<p><strong>å¯ç”¨è°ƒè¯•æ—¥å¿—</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ PM è°ƒè¯•</span>
<span class="hljs-built_in">echo</span> 1 &gt; /sys/power/pm_debug_messages

<span class="hljs-comment"># æŸ¥çœ‹å†…æ ¸æ—¥å¿—</span>
dmesg | grep -i <span class="hljs-built_in">suspend</span>
dmesg | grep -i resume
</code></pre>
<p><strong>å¸¸è§é—®é¢˜</strong>ï¼š</p>
<ol>
<li>
<p><strong>è®¾å¤‡æ— æ³•ä¼‘çœ </strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥æ˜¯å¦æœ‰é˜»æ­¢ä¼‘çœ çš„å”¤é†’æº</li>
<li>æ£€æŸ¥è®¾å¤‡é©±åŠ¨çš„ suspend å›è°ƒæ˜¯å¦å®ç°</li>
<li>æŸ¥çœ‹å†…æ ¸æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>æ— æ³•å”¤é†’</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥å”¤é†’æºæ˜¯å¦å¯ç”¨</li>
<li>æ£€æŸ¥ç¡¬ä»¶æ˜¯å¦æ”¯æŒå”¤é†’</li>
<li>æŸ¥çœ‹å†…æ ¸æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>å”¤é†’åç³»ç»Ÿå¼‚å¸¸</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥è®¾å¤‡é©±åŠ¨çš„ resume å›è°ƒæ˜¯å¦æ­£ç¡®å®ç°</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰è®¾å¤‡çŠ¶æ€æœªæ­£ç¡®æ¢å¤</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-28">8. ä¼‘çœ å”¤é†’çš„å®Œæ•´æºç è§£æ</h2>
<h3 data-id="heading-29">8.1 pm_suspend() å®Œæ•´æµç¨‹</h3>
<p><strong>pm_suspend() å‡½æ•°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">pm_suspend</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-keyword">if</span> (state &lt;= PM_SUSPEND_ON || state &gt;= PM_SUSPEND_MAX)
        <span class="hljs-keyword">return</span> -EINVAL;
    
    pr_info(<span class="hljs-string">"suspend entry (%s)\n"</span>, mem_sleep_labels[state]);
    
    <span class="hljs-comment">// 1. åŒæ­¥æ–‡ä»¶ç³»ç»Ÿ</span>
    error = enter_state(state);
    
    <span class="hljs-keyword">if</span> (error) {
        suspend_stats.fail++;
        dpm_save_failed_errno(error);
    } <span class="hljs-keyword">else</span> {
        suspend_stats.success++;
    }
    
    pr_info(<span class="hljs-string">"suspend exit\n"</span>);
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>enter_state() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">enter_state</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. æ£€æŸ¥å¹³å°æ˜¯å¦æ”¯æŒè¯¥çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (!valid_state(state))
        <span class="hljs-keyword">return</span> -ENODEV;
    
    <span class="hljs-comment">// 2. æ£€æŸ¥æ˜¯å¦æœ‰é˜»æ­¢ä¼‘çœ çš„å”¤é†’æº</span>
    <span class="hljs-keyword">if</span> (!mutex_trylock(&amp;pm_mutex))
        <span class="hljs-keyword">return</span> -EBUSY;
    
    <span class="hljs-comment">// 3. åŒæ­¥æ–‡ä»¶ç³»ç»Ÿ</span>
    <span class="hljs-keyword">if</span> (state == PM_SUSPEND_FREEZE) {
        freeze_enter();
    } <span class="hljs-keyword">else</span> {
        error = sync_filesystems(<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (error)
            <span class="hljs-keyword">goto</span> Unlock;
    }
    
    <span class="hljs-comment">// 4. å†»ç»“è¿›ç¨‹</span>
    pm_prepare_console();
    suspend_console();
    pm_restrict_gfp_mask();
    error = pm_suspend_freeze(state);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Finish;
    
    <span class="hljs-comment">// 5. è®¾å¤‡ suspend</span>
    error = pm_suspend_devices_and_enter(state);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Thaw;
    
    <span class="hljs-comment">// 6. æ¢å¤</span>
    pm_restore_gfp_mask();
    thaw_console();
    pm_restore_console();
    pm_notifier_call_chain(PM_POST_SUSPEND);
    complete_all(&amp;pm_suspend_completion);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    
Thaw:
    pm_suspend_thaw();
Finish:
    pm_restore_gfp_mask();
    thaw_console();
    pm_restore_console();
Unlock:
    mutex_unlock(&amp;pm_mutex);
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>pm_suspend_devices_and_enter() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">pm_suspend_devices_and_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">int</span> error;
    <span class="hljs-type">bool</span> wakeup = <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 1. å‡†å¤‡è®¾å¤‡</span>
    error = dpm_suspend_start(PMSG_SUSPEND);
    <span class="hljs-keyword">if</span> (error) {
        log_suspend_abort_reason(<span class="hljs-string">"Device suspend failed"</span>);
        <span class="hljs-keyword">goto</span> Out;
    }
    
    <span class="hljs-comment">// 2. æš‚åœè®¾å¤‡</span>
    suspend_console();
    error = dpm_suspend_noirq(PMSG_SUSPEND);
    <span class="hljs-keyword">if</span> (error) {
        log_suspend_abort_reason(<span class="hljs-string">"Device suspend noirq failed"</span>);
        <span class="hljs-keyword">goto</span> Resume_console;
    }
    
    <span class="hljs-comment">// 3. ç¦ç”¨ä¸­æ–­</span>
    error = suspend_enter(state, &amp;wakeup);
    
    <span class="hljs-comment">// 4. æ¢å¤è®¾å¤‡</span>
    dpm_resume_noirq(wakeup ? PMSG_RESUME : PMSG_RESTORE);
Resume_console:
    resume_console();
    dpm_resume_end(PMSG_RESUME);
Out:
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-30">8.2 suspend_enter() è¯¦ç»†å®ç°</h3>
<p><strong>suspend_enter() å‡½æ•°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state, <span class="hljs-type">bool</span> *wakeup)</span>
{
    <span class="hljs-type">int</span> error, last_dev;
    
    <span class="hljs-comment">// 1. ç¦ç”¨ä¸­æ–­</span>
    error = platform_suspend_begin(state);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Close;
    
    <span class="hljs-comment">// 2. æš‚åœç³»ç»Ÿæ ¸å¿ƒæœåŠ¡</span>
    suspend_console();
    suspend_test_start();
    error = dpm_suspend_late(PMSG_SUSPEND);
    <span class="hljs-keyword">if</span> (error) {
        pr_err(<span class="hljs-string">"late suspend of devices failed\n"</span>);
        <span class="hljs-keyword">goto</span> Recover_platform;
    }
    
    <span class="hljs-comment">// 3. æš‚åœè®¾å¤‡ï¼ˆnoirq é˜¶æ®µï¼‰</span>
    error = dpm_suspend_noirq(PMSG_SUSPEND);
    <span class="hljs-keyword">if</span> (error) {
        pr_err(<span class="hljs-string">"noirq suspend of devices failed\n"</span>);
        <span class="hljs-keyword">goto</span> Recover_platform;
    }
    
    <span class="hljs-comment">// 4. ç¦ç”¨ä¸­æ–­</span>
    error = platform_suspend_prepare(state);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Recover_platform;
    
    <span class="hljs-comment">// 5. åŒæ­¥æ‰€æœ‰ CPU</span>
    error = suspend_disable_secondary_cpus();
    <span class="hljs-keyword">if</span> (error || suspend_test(TEST_CPUS))
        <span class="hljs-keyword">goto</span> Enable_cpus;
    
    <span class="hljs-comment">// 6. åˆ·æ–°ç¼“å­˜</span>
    local_irq_disable();
    syscore_suspend();
    
    <span class="hljs-comment">// 7. è¿›å…¥ä¼‘çœ çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (!suspend_test(TEST_CORE) &amp;&amp; pm_wakeup_pending())
        <span class="hljs-keyword">goto</span> Exit;
    
    error = suspend_ops-&gt;enter(state);
    
    <span class="hljs-comment">// 8. ä»ä¼‘çœ çŠ¶æ€æ¢å¤</span>
Exit:
    syscore_resume();
    local_irq_enable();
    
Enable_cpus:
    suspend_enable_secondary_cpus();
    
Recover_platform:
    platform_resume(state);
    dpm_resume_noirq(PMSG_RESUME);
    dpm_resume_early(PMSG_RESUME);
    suspend_test_finish(<span class="hljs-string">"resume"</span>);
    resume_console();
    
Close:
    platform_resume_end(state);
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-31">8.3 å¹³å°ç‰¹å®šçš„ suspend å®ç°</h3>
<p><strong>ARM64 å¹³å°çš„ suspend å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">cpu_suspend</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg, <span class="hljs-type">int</span> (*fn)(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>))</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span> =</span> current-&gt;mm;
    <span class="hljs-type">int</span> ret;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    <span class="hljs-comment">// 1. ä¿å­˜å½“å‰è¿›ç¨‹çš„é¡µè¡¨</span>
    <span class="hljs-keyword">if</span> (idmap_pgd) {
        cpu_set_reserved_ttbr0();
        local_flush_tlb_all();
    }
    
    <span class="hljs-comment">// 2. ä¿å­˜ CPU çŠ¶æ€</span>
    ret = __cpu_suspend_enter(arg, fn);
    
    <span class="hljs-comment">// 3. æ¢å¤é¡µè¡¨</span>
    <span class="hljs-keyword">if</span> (idmap_pgd) {
        cpu_unset_reserved_ttbr0();
        local_flush_tlb_all();
    }
    
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<p><strong>__cpu_suspend_enter() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">int</span> __cpu_suspend_enter(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg, <span class="hljs-type">int</span> (*fn)(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>))
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sleep_stack_data</span> <span class="hljs-title">state</span>;</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    <span class="hljs-comment">// 1. ä¿å­˜ CPU å¯„å­˜å™¨</span>
    flags = local_daif_save();
    
    <span class="hljs-comment">// 2. ä¿å­˜æ ˆæŒ‡é’ˆ</span>
    state.<span class="hljs-built_in">stack</span> = (<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>)__builtin_frame_address(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 3. ä¿å­˜ CPU ä¸Šä¸‹æ–‡</span>
    __cpu_suspend_enter_save(&amp;state.cpu_context);
    
    <span class="hljs-comment">// 4. è°ƒç”¨å¹³å°ç‰¹å®šçš„ suspend å‡½æ•°</span>
    ret = fn(arg);
    
    <span class="hljs-comment">// 5. å¦‚æœè¿”å›ï¼Œæ¢å¤ CPU ä¸Šä¸‹æ–‡</span>
    __cpu_suspend_exit(&amp;state.cpu_context);
    
    local_daif_restore(flags);
    
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h3 data-id="heading-32">8.4 å”¤é†’æµç¨‹çš„å®Œæ•´å®ç°</h3>
<p><strong>å”¤é†’ä¸­æ–­å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ç¤ºä¾‹ï¼šæŒ‰é”®å”¤é†’ä¸­æ–­</span>
<span class="hljs-type">static</span> <span class="hljs-type">irqreturn_t</span> <span class="hljs-title function_">power_button_irq</span><span class="hljs-params">(<span class="hljs-type">int</span> irq, <span class="hljs-type">void</span> *dev_id)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">dev</span> =</span> dev_id;
    
    <span class="hljs-comment">// 1. æ ‡è®°å”¤é†’äº‹ä»¶</span>
    pm_wakeup_event(dev, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 2. å¦‚æœç³»ç»Ÿæ­£åœ¨ä¼‘çœ ï¼Œå”¤é†’ç³»ç»Ÿ</span>
    <span class="hljs-keyword">if</span> (pm_suspend_state())
        pm_system_wakeup();
    
    <span class="hljs-keyword">return</span> IRQ_HANDLED;
}
</code></pre>
<p><strong>pm_system_wakeup() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/main.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">pm_system_wakeup</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    spin_lock_irqsave(&amp;pm_wakeup_lock, flags);
    
    <span class="hljs-comment">// 1. è®¾ç½®å”¤é†’æ ‡å¿—</span>
    pm_wakeup_irq = <span class="hljs-literal">true</span>;
    
    <span class="hljs-comment">// 2. å¦‚æœç³»ç»Ÿæ­£åœ¨ä¼‘çœ ï¼Œä¸­æ–­ä¼‘çœ æµç¨‹</span>
    <span class="hljs-keyword">if</span> (pm_suspend_state()) {
        pm_suspend_abort();
    }
    
    spin_unlock_irqrestore(&amp;pm_wakeup_lock, flags);
}
</code></pre>
<p><strong>å¹³å°ç‰¹å®šçš„ resume å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">cpu_resume</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. æ¢å¤ CPU ä¸Šä¸‹æ–‡</span>
    cpu_suspend_exit();
    
    <span class="hljs-comment">// 2. æ¢å¤ MMU</span>
    cpu_do_resume(<span class="hljs-literal">NULL</span>);
    
    <span class="hljs-comment">// 3. æ¢å¤ä¸­æ–­</span>
    local_irq_enable();
}
</code></pre>
<h3 data-id="heading-33">8.5 è®¾å¤‡é©±åŠ¨çš„å®Œæ•´ PM å®ç°ç¤ºä¾‹</h3>
<p><strong>å®Œæ•´çš„è®¾å¤‡é©±åŠ¨ PM å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/example/example_driver.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// 1. åœæ­¢è®¾å¤‡æ“ä½œ</span>
    example_stop(edev);
    
    <span class="hljs-comment">// 2. ä¿å­˜å¯„å­˜å™¨çŠ¶æ€</span>
    edev-&gt;saved_regs.config = ioread32(edev-&gt;base + REG_CONFIG);
    edev-&gt;saved_regs.control = ioread32(edev-&gt;base + REG_CONTROL);
    
    <span class="hljs-comment">// 3. è¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    iowrite32(edev-&gt;saved_regs.config | POWER_DOWN, edev-&gt;base + REG_CONFIG);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_suspend_late</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// åœ¨ä¸­æ–­ç¦ç”¨å‰æ‰§è¡Œçš„æ“ä½œ</span>
    <span class="hljs-comment">// ä¾‹å¦‚ï¼šå…³é—­æ—¶é’Ÿã€å…³é—­ç”µæºç­‰</span>
    
    clk_disable(edev-&gt;clk);
    regulator_disable(edev-&gt;reg);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_suspend_noirq</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// ä¸­æ–­å·²ç¦ç”¨ï¼Œæ‰§è¡Œæœ€åçš„æ“ä½œ</span>
    <span class="hljs-comment">// ä¾‹å¦‚ï¼šä¿å­˜æœ€åçš„å¯„å­˜å™¨çŠ¶æ€</span>
    
    edev-&gt;saved_regs.status = ioread32(edev-&gt;base + REG_STATUS);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_resume_noirq</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// ä¸­æ–­ä»ç¦ç”¨ï¼Œæ¢å¤æœ€åŸºæœ¬çš„æ“ä½œ</span>
    <span class="hljs-comment">// ä¾‹å¦‚ï¼šæ¢å¤å¯„å­˜å™¨çŠ¶æ€</span>
    
    iowrite32(edev-&gt;saved_regs.status, edev-&gt;base + REG_STATUS);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_resume_early</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// åœ¨ä¸­æ–­æ¢å¤å‰æ‰§è¡Œçš„æ“ä½œ</span>
    <span class="hljs-comment">// ä¾‹å¦‚ï¼šæ‰“å¼€æ—¶é’Ÿã€æ‰“å¼€ç”µæºç­‰</span>
    
    regulator_enable(edev-&gt;reg);
    clk_enable(edev-&gt;clk);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_resume</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// 1. é€€å‡ºä½åŠŸè€—æ¨¡å¼</span>
    iowrite32(edev-&gt;saved_regs.config, edev-&gt;base + REG_CONFIG);
    
    <span class="hljs-comment">// 2. æ¢å¤å¯„å­˜å™¨çŠ¶æ€</span>
    iowrite32(edev-&gt;saved_regs.control, edev-&gt;base + REG_CONTROL);
    
    <span class="hljs-comment">// 3. é‡æ–°åˆå§‹åŒ–è®¾å¤‡</span>
    example_init(edev);
    
    <span class="hljs-comment">// 4. å¯åŠ¨è®¾å¤‡</span>
    example_start(edev);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dev_pm_ops</span> <span class="hljs-title">example_pm_ops</span> =</span> {
    .suspend = example_suspend,
    .suspend_late = example_suspend_late,
    .suspend_noirq = example_suspend_noirq,
    .resume_noirq = example_resume_noirq,
    .resume_early = example_resume_early,
    .resume = example_resume,
};
</code></pre>
<hr/>
<h2 data-id="heading-34">9. å”¤é†’æºï¼ˆWakeup Sourceï¼‰è¯¦è§£</h2>
<h3 data-id="heading-35">9.1 å”¤é†’æºçš„æ•°æ®ç»“æ„</h3>
<p><strong>struct wakeup_source</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wakeup_source</span> {</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">entry</span>;</span>
    <span class="hljs-type">spinlock_t</span> lock;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wake_irq</span> *<span class="hljs-title">wakeirq</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timer_list</span> <span class="hljs-title">timer</span>;</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> timer_expires;
    <span class="hljs-type">ktime_t</span> total_time;
    <span class="hljs-type">ktime_t</span> max_time;
    <span class="hljs-type">ktime_t</span> last_time;
    <span class="hljs-type">ktime_t</span> start_prevent_time;
    <span class="hljs-type">ktime_t</span> prevent_sleep_time;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> event_count;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> active_count;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> relax_count;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> expire_count;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> wakeup_count;
    <span class="hljs-type">bool</span> active:<span class="hljs-number">1</span>;
    <span class="hljs-type">bool</span> autosleep_enabled:<span class="hljs-number">1</span>;
};
</code></pre>
<p><strong>å”¤é†’æºçš„æ³¨å†Œ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-keyword">struct</span> wakeup_source *<span class="hljs-title function_">wakeup_source_register</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev,
                                              <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wakeup_source</span> *<span class="hljs-title">ws</span>;</span>
    <span class="hljs-type">int</span> ret;
    
    <span class="hljs-comment">// 1. åˆ†é…å”¤é†’æºç»“æ„</span>
    ws = kzalloc(<span class="hljs-keyword">sizeof</span>(*ws), GFP_KERNEL);
    <span class="hljs-keyword">if</span> (!ws)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    
    <span class="hljs-comment">// 2. åˆå§‹åŒ–å”¤é†’æº</span>
    wakeup_source_init(ws, name);
    
    <span class="hljs-comment">// 3. å¦‚æœæä¾›äº†è®¾å¤‡ï¼Œå…³è”è®¾å¤‡</span>
    <span class="hljs-keyword">if</span> (dev) {
        ret = device_wakeup_attach(dev, ws);
        <span class="hljs-keyword">if</span> (ret) {
            wakeup_source_destroy(ws);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
        }
    }
    
    <span class="hljs-comment">// 4. æ·»åŠ åˆ°å”¤é†’æºåˆ—è¡¨</span>
    list_add_rcu(&amp;ws-&gt;entry, &amp;wakeup_sources);
    
    <span class="hljs-keyword">return</span> ws;
}
</code></pre>
<h3 data-id="heading-36">9.2 å”¤é†’æºçš„æ¿€æ´»å’Œåœç”¨</h3>
<p><strong>æ¿€æ´»å”¤é†’æº</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-type">void</span> __pm_stay_awake(<span class="hljs-keyword">struct</span> wakeup_source *ws)
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    <span class="hljs-keyword">if</span> (!ws)
        <span class="hljs-keyword">return</span>;
    
    spin_lock_irqsave(&amp;ws-&gt;lock, flags);
    
    <span class="hljs-comment">// 1. æ›´æ–°å”¤é†’æºæ—¶é—´</span>
    wakeup_source_report_event(ws, <span class="hljs-literal">false</span>);
    
    <span class="hljs-comment">// 2. æ¿€æ´»å”¤é†’æº</span>
    <span class="hljs-keyword">if</span> (!ws-&gt;active) {
        ws-&gt;active = <span class="hljs-literal">true</span>;
        ws-&gt;active_count++;
        ws-&gt;last_time = ktime_get();
    }
    
    del_timer(&amp;ws-&gt;timer);
    ws-&gt;timer_expires = <span class="hljs-number">0</span>;
    
    spin_unlock_irqrestore(&amp;ws-&gt;lock, flags);
}
</code></pre>
<p><strong>åœç”¨å”¤é†’æº</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-type">void</span> __pm_relax(<span class="hljs-keyword">struct</span> wakeup_source *ws)
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    <span class="hljs-keyword">if</span> (!ws)
        <span class="hljs-keyword">return</span>;
    
    spin_lock_irqsave(&amp;ws-&gt;lock, flags);
    
    <span class="hljs-comment">// 1. æ›´æ–°æ€»æ—¶é—´</span>
    <span class="hljs-keyword">if</span> (ws-&gt;active) {
        <span class="hljs-type">ktime_t</span> now = ktime_get();
        <span class="hljs-type">ktime_t</span> delta = ktime_sub(now, ws-&gt;last_time);
        ws-&gt;total_time = ktime_add(ws-&gt;total_time, delta);
        <span class="hljs-keyword">if</span> (ktime_to_ns(delta) &gt; ktime_to_ns(ws-&gt;max_time))
            ws-&gt;max_time = delta;
        ws-&gt;active = <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. åœç”¨å”¤é†’æº</span>
    del_timer(&amp;ws-&gt;timer);
    ws-&gt;timer_expires = <span class="hljs-number">0</span>;
    
    spin_unlock_irqrestore(&amp;ws-&gt;lock, flags);
}
</code></pre>
<h3 data-id="heading-37">9.3 å”¤é†’æºé˜»æ­¢ä¼‘çœ æ£€æŸ¥</h3>
<p><strong>æ£€æŸ¥æ˜¯å¦æœ‰æ´»åŠ¨çš„å”¤é†’æº</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">pm_get_wakeup_count</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *count, <span class="hljs-type">bool</span> block)</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cnt, inpr;
    
    <span class="hljs-keyword">if</span> (block) {
        DEFINE_WAIT(wait);
        
        <span class="hljs-keyword">for</span> (;;) {
            prepare_to_wait(&amp;wakeup_count_wait_queue, &amp;wait,
                          TASK_INTERRUPTIBLE);
            cnt = <span class="hljs-type">atomic_read</span>(&amp;combined_event_count);
            inpr = get_nr_in_progress();
            <span class="hljs-keyword">if</span> (inpr == <span class="hljs-number">0</span> || signal_pending(current))
                <span class="hljs-keyword">break</span>;
            pm_print_active_wakeup_sources();
            schedule();
        }
        finish_wait(&amp;wakeup_count_wait_queue, &amp;wait);
    }
    
    split_counters(&amp;cnt, &amp;inpr);
    *count = cnt;
    <span class="hljs-keyword">return</span> !inpr;
}
</code></pre>
<hr/>
<h2 data-id="heading-38">10. Suspend to Disk (Hibernate) è¯¦è§£</h2>
<h3 data-id="heading-39">10.1 Hibernate çš„æµç¨‹</h3>
<p><strong>hibernate() å‡½æ•°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/hibernate.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">hibernate</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦æ”¯æŒ hibernate</span>
    <span class="hljs-keyword">if</span> (!hibernation_available()) {
        pr_debug(<span class="hljs-string">"PM: Hibernation not available.\n"</span>);
        <span class="hljs-keyword">return</span> -EPERM;
    }
    
    <span class="hljs-comment">// 2. é”å®šç³»ç»Ÿ</span>
    lock_system_sleep();
    
    <span class="hljs-comment">// 3. åŒæ­¥æ–‡ä»¶ç³»ç»Ÿ</span>
    pr_info(<span class="hljs-string">"PM: Syncing filesystems ... "</span>);
    sys_sync();
    pr_cont(<span class="hljs-string">"done.\n"</span>);
    
    <span class="hljs-comment">// 4. å†»ç»“è¿›ç¨‹</span>
    error = freeze_processes();
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Unlock;
    
    <span class="hljs-comment">// 5. å†»ç»“å†…æ ¸çº¿ç¨‹</span>
    error = freeze_kernel_threads();
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Thaw_processes;
    
    <span class="hljs-comment">// 6. ä¿å­˜ç³»ç»ŸçŠ¶æ€åˆ°ç£ç›˜</span>
    error = hibernation_snapshot(hibernation_mode == HIBERNATION_PLATFORM);
    <span class="hljs-keyword">if</span> (error || freezer_test_done)
        <span class="hljs-keyword">goto</span> Thaw_kernel;
    
    <span class="hljs-comment">// 7. è¿›å…¥ä¼‘çœ çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (hibernation_mode == HIBERNATION_TEST) {
        pr_info(<span class="hljs-string">"PM: Hibernation test mode.\n"</span>);
        <span class="hljs-keyword">goto</span> Thaw_kernel;
    }
    
    error = hibernation_platform_enter();
    
Thaw_kernel:
    thaw_kernel_threads();
Thaw_processes:
    thaw_processes();
Unlock:
    unlock_system_sleep();
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-40">10.2 å†…å­˜å¿«ç…§çš„ä¿å­˜</h3>
<p><strong>hibernation_snapshot() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/hibernate.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">hibernation_snapshot</span><span class="hljs-params">(<span class="hljs-type">int</span> platform_mode)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. åˆ†é…äº¤æ¢ç©ºé—´</span>
    error = swsusp_alloc();
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// 2. å‡†å¤‡å¿«ç…§</span>
    error = snapshot_read_next(snapshot);
    <span class="hljs-keyword">if</span> (error &lt; PAGE_SIZE)
        <span class="hljs-keyword">return</span> error &lt; <span class="hljs-number">0</span> ? error : -EFAULT;
    
    <span class="hljs-comment">// 3. ä¿å­˜å†…å­˜é¡µé¢</span>
    error = swsusp_write(flags);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// 4. æ ‡è®°äº¤æ¢åˆ†åŒº</span>
    error = swsusp_check();
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>swsusp_write() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/swap.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">swsusp_write</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">snapshot_handle</span> <span class="hljs-title">handle</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">swap_map_handle</span> <span class="hljs-title">swap</span>;</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">swsusp_info</span> *<span class="hljs-title">header</span>;</span>
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. åˆ†é…äº¤æ¢å†™å…¥å™¨</span>
    error = get_swap_writer(&amp;swap);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// 2. åˆ†é…å¤´éƒ¨é¡µé¢</span>
    header = (<span class="hljs-keyword">struct</span> swsusp_info *)get_image_page(GFP_ATOMIC, PG_ANY);
    <span class="hljs-keyword">if</span> (!header) {
        error = -ENOMEM;
        <span class="hljs-keyword">goto</span> out_finish;
    }
    
    <span class="hljs-comment">// 3. åˆå§‹åŒ–å¿«ç…§å¥æŸ„</span>
    <span class="hljs-built_in">memset</span>(&amp;handle, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> snapshot_handle));
    error = snapshot_read_next(&amp;handle);
    <span class="hljs-keyword">if</span> (error &lt; PAGE_SIZE)
        <span class="hljs-keyword">goto</span> out_finish;
    
    <span class="hljs-comment">// 4. å†™å…¥å¤´éƒ¨ä¿¡æ¯</span>
    prepare_header(&amp;header-&gt;orig_info);
    error = swap_write_page(&amp;swap, header, <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> out_finish;
    
    <span class="hljs-comment">// 5. ä¿å­˜å†…å­˜é¡µé¢</span>
    error = save_image(&amp;swap, &amp;handle, nr_pages);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> out_finish;
    
    <span class="hljs-comment">// 6. å†™å…¥ç»“æŸæ ‡è®°</span>
    error = flush_swap_writer(&amp;swap);
    
out_finish:
    put_swap_writer(&amp;swap);
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-41">10.3 ä»ç£ç›˜æ¢å¤</h3>
<p><strong>hibernation_restore() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/hibernate.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">hibernation_restore</span><span class="hljs-params">(<span class="hljs-type">int</span> platform_mode)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. å‡†å¤‡æ¢å¤</span>
    pm_prepare_console();
    suspend_console();
    pm_restrict_gfp_mask();
    error = pm_suspend_freeze(PM_SUSPEND_FREEZE);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Restore;
    
    <span class="hljs-comment">// 2. ä»ç£ç›˜æ¢å¤å†…å­˜çŠ¶æ€</span>
    error = load_image_and_restore();
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">goto</span> Restore;
    
Restore:
    pm_restore_gfp_mask();
    thaw_console();
    pm_restore_console();
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux ä¼‘çœ å”¤é†’æœºåˆ¶è¯¦è§£ï¼ˆä¸­ï¼‰]]></title>    <link>https://juejin.cn/post/7584439538312970303</link>    <guid>https://juejin.cn/post/7584439538312970303</guid>    <pubDate>2025-12-17T08:06:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584439538312970303" data-draft-id="7584426949864964139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux ä¼‘çœ å”¤é†’æœºåˆ¶è¯¦è§£ï¼ˆä¸­ï¼‰"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-17T08:06:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_CH"/> <meta itemprop="url" content="https://juejin.cn/user/4074114702122217"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux ä¼‘çœ å”¤é†’æœºåˆ¶è¯¦è§£ï¼ˆä¸­ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4074114702122217/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_CH
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:06:50.000Z" title="Wed Dec 17 2025 08:06:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»59åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11. æ€§èƒ½åˆ†æå’Œä¼˜åŒ–</h2>
<h3 data-id="heading-1">11.1 ä¼‘çœ æ—¶é—´åˆ†æ</h3>
<p><strong>ä¼‘çœ æ—¶é—´æµ‹é‡</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">enter_state</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">ktime_t</span> start, end;
    <span class="hljs-type">int</span> error;
    
    start = ktime_get();
    
    <span class="hljs-comment">// ... ä¼‘çœ æµç¨‹ ...</span>
    
    end = ktime_get();
    pr_info(<span class="hljs-string">"PM: suspend took %lld ms\n"</span>, ktime_to_ms(ktime_sub(end, start)));
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>å„é˜¶æ®µæ—¶é—´åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">æ€»ä¼‘çœ æ—¶é—´ = è¿›ç¨‹å†»ç»“æ—¶é—´ + è®¾å¤‡ suspend æ—¶é—´ + å¹³å° suspend æ—¶é—´

è¿›ç¨‹å†»ç»“æ—¶é—´ï¼š
<span class="hljs-deletion">- å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼šé€šå¸¸ 100-500ms</span>
<span class="hljs-deletion">- å†»ç»“å†…æ ¸çº¿ç¨‹ï¼šé€šå¸¸ 10-50ms</span>

è®¾å¤‡ suspend æ—¶é—´ï¼š
<span class="hljs-deletion">- è®¾å¤‡ suspend å›è°ƒï¼šå–å†³äºè®¾å¤‡æ•°é‡ï¼Œé€šå¸¸ 50-200ms</span>
<span class="hljs-deletion">- è®¾å¤‡ suspend_lateï¼šé€šå¸¸ 10-50ms</span>
<span class="hljs-deletion">- è®¾å¤‡ suspend_noirqï¼šé€šå¸¸ 10-50ms</span>

å¹³å° suspend æ—¶é—´ï¼š
<span class="hljs-deletion">- å¹³å° suspend_prepareï¼šé€šå¸¸ 10-50ms</span>
<span class="hljs-deletion">- è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼šé€šå¸¸ 10-100ms</span>
</code></pre>
<h3 data-id="heading-2">11.2 å”¤é†’æ—¶é—´åˆ†æ</h3>
<p><strong>å”¤é†’æ—¶é—´æµ‹é‡</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state, <span class="hljs-type">bool</span> *wakeup)</span>
{
    <span class="hljs-type">ktime_t</span> start, end;
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// è¿›å…¥ä¼‘çœ </span>
    start = ktime_get();
    error = suspend_ops-&gt;enter(state);
    end = ktime_get();
    
    pr_info(<span class="hljs-string">"PM: suspend_enter took %lld ms\n"</span>, 
            ktime_to_ms(ktime_sub(end, start)));
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>å„é˜¶æ®µæ—¶é—´åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">æ€»å”¤é†’æ—¶é—´ = å¹³å° resume æ—¶é—´ + è®¾å¤‡ resume æ—¶é—´ + è¿›ç¨‹è§£å†»æ—¶é—´

å¹³å° resume æ—¶é—´ï¼š
<span class="hljs-deletion">- ä»ä¼‘çœ çŠ¶æ€æ¢å¤ï¼šé€šå¸¸ 10-100ms</span>
<span class="hljs-deletion">- å¹³å° resume_prepareï¼šé€šå¸¸ 10-50ms</span>

è®¾å¤‡ resume æ—¶é—´ï¼š
<span class="hljs-deletion">- è®¾å¤‡ resume_noirqï¼šé€šå¸¸ 10-50ms</span>
<span class="hljs-deletion">- è®¾å¤‡ resume_earlyï¼šé€šå¸¸ 10-50ms</span>
<span class="hljs-deletion">- è®¾å¤‡ resumeï¼šå–å†³äºè®¾å¤‡æ•°é‡ï¼Œé€šå¸¸ 50-200ms</span>

è¿›ç¨‹è§£å†»æ—¶é—´ï¼š
<span class="hljs-deletion">- è§£å†»å†…æ ¸çº¿ç¨‹ï¼šé€šå¸¸ 10-50ms</span>
<span class="hljs-deletion">- è§£å†»ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼šé€šå¸¸ 100-500ms</span>
</code></pre>
<h3 data-id="heading-3">11.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<p><strong>å‡å°‘ä¼‘çœ æ—¶é—´</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä¼˜åŒ–è¿›ç¨‹å†»ç»“</strong>ï¼š</p>
<ul>
<li>å‡å°‘éœ€è¦å†»ç»“çš„è¿›ç¨‹æ•°é‡</li>
<li>ä¼˜åŒ–è¿›ç¨‹å†»ç»“è¶…æ—¶æ—¶é—´</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–è®¾å¤‡ suspend</strong>ï¼š</p>
<ul>
<li>å‡å°‘è®¾å¤‡æ•°é‡</li>
<li>ä¼˜åŒ–è®¾å¤‡ suspend å›è°ƒ</li>
<li>å¹¶è¡Œæ‰§è¡Œè®¾å¤‡ suspend</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–å¹³å° suspend</strong>ï¼š</p>
<ul>
<li>ä¼˜åŒ–å¹³å°ç‰¹å®šçš„ suspend å®ç°</li>
<li>å‡å°‘ä¸å¿…è¦çš„æ“ä½œ</li>
</ul>
</li>
</ol>
<p><strong>å‡å°‘å”¤é†’æ—¶é—´</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä¼˜åŒ–è®¾å¤‡ resume</strong>ï¼š</p>
<ul>
<li>ä¼˜åŒ–è®¾å¤‡ resume å›è°ƒ</li>
<li>å¹¶è¡Œæ‰§è¡Œè®¾å¤‡ resume</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–è¿›ç¨‹è§£å†»</strong>ï¼š</p>
<ul>
<li>å‡å°‘éœ€è¦è§£å†»çš„è¿›ç¨‹æ•°é‡</li>
<li>ä¼˜åŒ–è¿›ç¨‹è§£å†»é¡ºåº</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-4">12. æ•…éšœæ’æŸ¥å’Œè°ƒè¯•</h2>
<h3 data-id="heading-5">12.1 è°ƒè¯•å·¥å…·</h3>
<p><strong>æŸ¥çœ‹ä¼‘çœ æ—¥å¿—</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å†…æ ¸æ—¥å¿—</span>
dmesg | grep -i <span class="hljs-built_in">suspend</span>
dmesg | grep -i resume

<span class="hljs-comment"># æŸ¥çœ‹ PM è°ƒè¯•ä¿¡æ¯</span>
dmesg | grep -i <span class="hljs-string">"PM:"</span>

<span class="hljs-comment"># æŸ¥çœ‹è®¾å¤‡ suspend/resume æ—¥å¿—</span>
dmesg | grep -i <span class="hljs-string">"device.*suspend"</span>
dmesg | grep -i <span class="hljs-string">"device.*resume"</span>
</code></pre>
<p><strong>æŸ¥çœ‹å”¤é†’æº</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å”¤é†’æº</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/wakeup_sources

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šè®¾å¤‡çš„å”¤é†’æº</span>
<span class="hljs-built_in">cat</span> /sys/devices/.../power/wakeup

<span class="hljs-comment"># å¯ç”¨/ç¦ç”¨å”¤é†’æº</span>
<span class="hljs-built_in">echo</span> enabled &gt; /sys/devices/.../power/wakeup
<span class="hljs-built_in">echo</span> disabled &gt; /sys/devices/.../power/wakeup
</code></pre>
<p><strong>ä½¿ç”¨ ftrace è·Ÿè¸ª</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ PM è·Ÿè¸ª</span>
<span class="hljs-built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/events/power/enable

<span class="hljs-comment"># æŸ¥çœ‹è·Ÿè¸ªç»“æœ</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/tracing/trace
</code></pre>
<h3 data-id="heading-6">12.2 å¸¸è§é—®é¢˜æ’æŸ¥</h3>
<p><strong>é—®é¢˜ 1ï¼šç³»ç»Ÿæ— æ³•è¿›å…¥ä¼‘çœ </strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦æœ‰æ´»åŠ¨çš„å”¤é†’æºï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /sys/kernel/debug/wakeup_sources | grep active
</code></pre>
<ol start="2">
<li>æ£€æŸ¥è®¾å¤‡æ˜¯å¦é˜»æ­¢ä¼‘çœ ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">dmesg | grep -i <span class="hljs-string">"device.*prevent.*suspend"</span>
</code></pre>
<ol start="3">
<li>æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æ— æ³•å†»ç»“ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">dmesg | grep -i <span class="hljs-string">"freeze.*failed"</span>
</code></pre>
<p><strong>é—®é¢˜ 2ï¼šç³»ç»Ÿæ— æ³•å”¤é†’</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥å”¤é†’æºæ˜¯å¦å¯ç”¨ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /sys/devices/.../power/wakeup
</code></pre>
<ol start="2">
<li>æ£€æŸ¥ç¡¬ä»¶æ˜¯å¦æ”¯æŒå”¤é†’ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /proc/acpi/wakeup
</code></pre>
<ol start="3">
<li>æ£€æŸ¥ä¸­æ–­æ˜¯å¦æ­£å¸¸ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /proc/interrupts
</code></pre>
<p><strong>é—®é¢˜ 3ï¼šå”¤é†’åç³»ç»Ÿå¼‚å¸¸</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥è®¾å¤‡ resume æ˜¯å¦å¤±è´¥ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">dmesg | grep -i <span class="hljs-string">"device.*resume.*failed"</span>
</code></pre>
<ol start="2">
<li>æ£€æŸ¥è®¾å¤‡çŠ¶æ€æ˜¯å¦æ­£ç¡®æ¢å¤ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹è®¾å¤‡çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/devices/.../power/state
</code></pre>
<ol start="3">
<li>æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æ­£å¸¸è§£å†»ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">dmesg | grep -i <span class="hljs-string">"thaw.*failed"</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">13. æ€»ç»“</h2>
<h3 data-id="heading-8">13.1 å…³é”®ç‚¹æ€»ç»“</h3>
<ol>
<li>
<p><strong>ä¼‘çœ çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>Linux æ”¯æŒå¤šç§ä¼‘çœ çŠ¶æ€ï¼ˆmemã€diskã€freeze ç­‰ï¼‰</li>
<li>æ¯ç§çŠ¶æ€æœ‰ä¸åŒçš„åŠŸè€—å’Œæ¢å¤æ—¶é—´</li>
</ul>
</li>
<li>
<p><strong>ä¼‘çœ æµç¨‹</strong>ï¼š</p>
<ul>
<li>å†»ç»“è¿›ç¨‹ â†’ è®¾å¤‡ suspend â†’ ä¿å­˜çŠ¶æ€ â†’ è¿›å…¥ä¼‘çœ </li>
<li>å„é˜¶æ®µéƒ½æœ‰è¯¦ç»†çš„å®ç°å’Œå›è°ƒ</li>
</ul>
</li>
<li>
<p><strong>å”¤é†’æµç¨‹</strong>ï¼š</p>
<ul>
<li>å”¤é†’äº‹ä»¶ â†’ æ¢å¤çŠ¶æ€ â†’ è®¾å¤‡ resume â†’ è§£å†»è¿›ç¨‹</li>
<li>éœ€è¦æ­£ç¡®å¤„ç†å„ç§å”¤é†’æº</li>
</ul>
</li>
<li>
<p><strong>è®¾å¤‡æ”¯æŒ</strong>ï¼š</p>
<ul>
<li>è®¾å¤‡é©±åŠ¨éœ€è¦å®ç°å®Œæ•´çš„ PM å›è°ƒ</li>
<li>éœ€è¦æ­£ç¡®ç®¡ç†å”¤é†’æº</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">13.2 æœ€ä½³å®è·µ</h3>
<ol>
<li>
<p><strong>è®¾å¤‡é©±åŠ¨å¼€å‘</strong>ï¼š</p>
<ul>
<li>æ­£ç¡®å®ç°æ‰€æœ‰ PM å›è°ƒå‡½æ•°</li>
<li>æ­£ç¡®ä¿å­˜å’Œæ¢å¤è®¾å¤‡çŠ¶æ€</li>
<li>æ­£ç¡®ç®¡ç†å”¤é†’æº</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>å‡å°‘ä¼‘çœ å’Œå”¤é†’æ—¶é—´</li>
<li>ä¼˜åŒ–è®¾å¤‡ suspend/resume æµç¨‹</li>
<li>ä¼˜åŒ–è¿›ç¨‹å†»ç»“å’Œè§£å†»</li>
</ul>
</li>
<li>
<p><strong>è°ƒè¯•å’Œæ’æŸ¥</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è°ƒè¯•å·¥å…·æŸ¥çœ‹æ—¥å¿—</li>
<li>æ£€æŸ¥å”¤é†’æºçŠ¶æ€</li>
<li>æ£€æŸ¥è®¾å¤‡ PM çŠ¶æ€</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-10">14. å¹³å°ç‰¹å®šçš„ Suspend å®ç°</h2>
<h3 data-id="heading-11">14.1 platform_suspend_ops ç»“æ„</h3>
<p><strong>platform_suspend_ops å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// include/linux/suspend.h</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">platform_suspend_ops</span> {</span>
    <span class="hljs-type">int</span> (*valid)(<span class="hljs-type">suspend_state_t</span> state);
    <span class="hljs-type">int</span> (*begin)(<span class="hljs-type">suspend_state_t</span> state);
    <span class="hljs-type">int</span> (*prepare)(<span class="hljs-type">void</span>);
    <span class="hljs-type">int</span> (*prepare_late)(<span class="hljs-type">void</span>);
    <span class="hljs-type">bool</span> (*wake)(<span class="hljs-type">void</span>);
    <span class="hljs-type">void</span> (*finish)(<span class="hljs-type">void</span>);
    <span class="hljs-type">void</span> (*end)(<span class="hljs-type">void</span>);
    <span class="hljs-type">void</span> (*recover)(<span class="hljs-type">void</span>);
    <span class="hljs-type">bool</span> (*suspend_again)(<span class="hljs-type">void</span>);
    <span class="hljs-type">int</span> (*enter)(<span class="hljs-type">suspend_state_t</span> state);
};
</code></pre>
<p><strong>suspend_ops çš„æ³¨å†Œ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">suspend_set_ops</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> platform_suspend_ops *ops)</span>
{
    lock_system_sleep();
    suspend_ops = ops;
    <span class="hljs-keyword">if</span> (valid_state(PM_SUSPEND_STANDBY)) {
        mem_sleep_default = PM_SUSPEND_STANDBY;
        mem_sleep_current = PM_SUSPEND_STANDBY;
    }
    unlock_system_sleep();
}
</code></pre>
<h3 data-id="heading-12">14.2 ARM64 å¹³å°çš„ Suspend å®ç°ç¤ºä¾‹</h3>
<p><strong>ARM64 å¹³å°çš„ suspend_ops</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">platform_suspend_ops</span> <span class="hljs-title">arm64_suspend_ops</span> =</span> {
    .valid = arm64_suspend_valid,
    .begin = arm64_suspend_begin,
    .prepare = arm64_suspend_prepare,
    .prepare_late = arm64_suspend_prepare_late,
    .enter = arm64_suspend_enter,
    .wake = arm64_suspend_wake,
    .finish = arm64_suspend_finish,
    .end = arm64_suspend_end,
    .recover = arm64_suspend_recover,
};

<span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">arm64_pm_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    suspend_set_ops(&amp;arm64_suspend_ops);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>arm64_suspend_enter() å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arm64_suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">int</span> ret;
    
    <span class="hljs-comment">// 1. ç¦ç”¨ä¸­æ–­</span>
    local_irq_disable();
    
    <span class="hljs-comment">// 2. åˆ·æ–°ç¼“å­˜</span>
    cpu_suspend(<span class="hljs-number">0</span>, arm64_suspend_finisher);
    
    <span class="hljs-comment">// 3. æ¢å¤ä¸­æ–­</span>
    local_irq_enable();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arm64_suspend_finisher</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span>
{
    <span class="hljs-comment">// 1. ä¿å­˜ CPU çŠ¶æ€</span>
    cpu_suspend_save();
    
    <span class="hljs-comment">// 2. è°ƒç”¨å¹³å°ç‰¹å®šçš„ suspend å‡½æ•°</span>
    ret = cpu_do_suspend(arg);
    
    <span class="hljs-comment">// 3. å¦‚æœè¿”å›ï¼Œæ¢å¤ CPU çŠ¶æ€</span>
    cpu_suspend_restore();
    
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h3 data-id="heading-13">14.3 å”¤é†’æœºåˆ¶æ·±åº¦è§£æ</h3>
<p><strong>å”¤é†’ä¸­æ–­çš„å®Œæ•´æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç¡¬ä»¶å”¤é†’äº‹ä»¶ï¼ˆæŒ‰é”®ã€ç½‘ç»œæ•°æ®åŒ…ç­‰ï¼‰
    â†“
ç¡¬ä»¶ä¸­æ–­æ§åˆ¶å™¨
    â†“
CPU ä¸­æ–­å¤„ç†
    â†“
å”¤é†’ä¸­æ–­å¤„ç†å‡½æ•°
    â†“
<span class="hljs-built_in">pm_wakeup_event</span>()
    â†“
<span class="hljs-built_in">pm_system_wakeup</span>()
    â†“
ä»ä¼‘çœ çŠ¶æ€æ¢å¤
</code></pre>
<p><strong>Wake-on-LAN å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/net/ethernet/example.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">net_device</span> *<span class="hljs-title">netdev</span> =</span> dev_get_drvdata(dev);
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_private</span> *<span class="hljs-title">priv</span> =</span> netdev_priv(netdev);
    
    <span class="hljs-comment">// 1. åœæ­¢ç½‘ç»œæ¥å£</span>
    netif_device_detach(netdev);
    
    <span class="hljs-comment">// 2. é…ç½® Wake-on-LAN</span>
    <span class="hljs-keyword">if</span> (priv-&gt;wol_enabled) {
        <span class="hljs-comment">// å¯ç”¨ Magic Packet å”¤é†’</span>
        iowrite32(REG_WOL_ENABLE | REG_WOL_MAGIC_PACKET, 
                  priv-&gt;base + REG_WOL_CTRL);
        
        <span class="hljs-comment">// å¯ç”¨ç½‘å¡å”¤é†’ä¸­æ–­</span>
        enable_irq_wake(priv-&gt;irq);
    }
    
    <span class="hljs-comment">// 3. è¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    example_enter_low_power(priv);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-14">14.4 å®é™…åº”ç”¨æ¡ˆä¾‹</h3>
<p><strong>ç§»åŠ¨è®¾å¤‡çš„ä¼‘çœ å”¤é†’</strong>ï¼š</p>
<p>Android ç³»ç»Ÿçš„ä¼‘çœ æµç¨‹ï¼š</p>
<ol>
<li>ç”¨æˆ·æŒ‰ä¸‹ç”µæºé”®æˆ–å±å¹•è¶…æ—¶</li>
<li>Android Framework è°ƒç”¨ PowerManager.goToSleep()</li>
<li>é€šè¿‡ sysfs è§¦å‘ä¼‘çœ ï¼š<code>echo mem &gt; /sys/power/state</code></li>
<li>Linux å†…æ ¸æ‰§è¡Œä¼‘çœ æµç¨‹</li>
<li>ç³»ç»Ÿè¿›å…¥ Suspend to RAM</li>
</ol>
<p><strong>æœåŠ¡å™¨ Wake-on-LAN é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¯ç”¨ç½‘å¡çš„ Wake-on-LAN</span>
ethtool -s eth0 wol g

<span class="hljs-comment"># 2. æŸ¥çœ‹ Wake-on-LAN çŠ¶æ€</span>
ethtool eth0 | grep Wake-on

<span class="hljs-comment"># 3. è¿›å…¥ä¼‘çœ </span>
<span class="hljs-built_in">echo</span> mem &gt; /sys/power/state

<span class="hljs-comment"># 4. ä»è¿œç¨‹å‘é€ Magic Packet å”¤é†’</span>
wakeonlan &lt;MACåœ°å€&gt;
</code></pre>
<p><strong>æœåŠ¡å™¨å®šæ—¶å”¤é†’</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. è®¾ç½® RTC é—¹é’Ÿ</span>
rtcwake -m mem -s 3600  <span class="hljs-comment"># 1å°æ—¶åå”¤é†’</span>

<span class="hljs-comment"># 2. æŸ¥çœ‹ RTC çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/class/rtc/rtc0/wakealarm

<span class="hljs-comment"># 3. è¿›å…¥ä¼‘çœ </span>
<span class="hljs-built_in">echo</span> mem &gt; /sys/power/state
</code></pre>
<hr/>
<h2 data-id="heading-15">15. é«˜çº§ä¸»é¢˜</h2>
<h3 data-id="heading-16">15.1 æ··åˆä¼‘çœ ï¼ˆHybrid Sleepï¼‰</h3>
<p><strong>æ··åˆä¼‘çœ çš„å®šä¹‰</strong>ï¼š</p>
<p>æ··åˆä¼‘çœ æ˜¯åŒæ—¶æ‰§è¡Œ Suspend to RAM å’Œ Suspend to Diskï¼Œè¿™æ ·å³ä½¿æ–­ç”µä¹Ÿèƒ½ä»ç£ç›˜æ¢å¤ã€‚</p>
<p><strong>æ··åˆä¼‘çœ çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/hibernate.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">hibernate</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// 1. ä¿å­˜åˆ°ç£ç›˜</span>
    error = hibernation_snapshot(hibernation_mode == HIBERNATION_PLATFORM);
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// 2. å¦‚æœæ”¯æŒï¼ŒåŒæ—¶è¿›å…¥ RAM ä¼‘çœ </span>
    <span class="hljs-keyword">if</span> (hibernation_mode == HIBERNATION_PLATFORM) {
        error = hibernation_platform_enter();
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 3. å¦åˆ™åªè¿›å…¥ RAM ä¼‘çœ </span>
        error = pm_suspend(PM_SUSPEND_MEM);
    }
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-17">15.2 è‡ªåŠ¨ä¼‘çœ ï¼ˆAutosleepï¼‰</h3>
<p><strong>è‡ªåŠ¨ä¼‘çœ çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/autosleep.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">autosleep_thread</span><span class="hljs-params">(<span class="hljs-type">void</span> *dummy)</span>
{
    <span class="hljs-keyword">while</span> (!kthread_should_stop()) {
        <span class="hljs-comment">// 1. ç­‰å¾…è¶…æ—¶æˆ–å”¤é†’äº‹ä»¶</span>
        <span class="hljs-keyword">if</span> (autosleep_state == PM_AUTOSLEEP_ON) {
            schedule_timeout_interruptible(
                msecs_to_jiffies(pm_autosleep_timeout));
            
            <span class="hljs-comment">// 2. æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¼‘çœ </span>
            <span class="hljs-keyword">if</span> (pm_get_wakeup_count(&amp;count, <span class="hljs-literal">false</span>)) {
                <span class="hljs-comment">// 3. è¿›å…¥ä¼‘çœ </span>
                pm_suspend(PM_SUSPEND_MEM);
            }
        } <span class="hljs-keyword">else</span> {
            wait_event_interruptible(autosleep_wait_queue,
                autosleep_state != PM_AUTOSLEEP_DISABLED);
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-18">15.3 è¿è¡Œæ—¶ç”µæºç®¡ç†ï¼ˆRuntime PMï¼‰</h3>
<p><strong>Runtime PM ä¸ Suspend çš„å…³ç³»</strong>ï¼š</p>
<p>Runtime PM æ˜¯è®¾å¤‡çº§åˆ«çš„ç”µæºç®¡ç†ï¼Œè€Œ Suspend æ˜¯ç³»ç»Ÿçº§åˆ«çš„ç”µæºç®¡ç†ã€‚</p>
<p><strong>Runtime PM çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/runtime.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">pm_runtime_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-type">int</span> retval;
    
    <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦å¯ä»¥ suspend</span>
    retval = rpm_check_suspend_allowed(dev);
    <span class="hljs-keyword">if</span> (retval &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">return</span> retval;
    
    <span class="hljs-comment">// 2. è°ƒç”¨è®¾å¤‡çš„ runtime_suspend å›è°ƒ</span>
    <span class="hljs-keyword">if</span> (dev-&gt;driver &amp;&amp; dev-&gt;driver-&gt;pm &amp;&amp; dev-&gt;driver-&gt;pm-&gt;runtime_suspend) {
        retval = dev-&gt;driver-&gt;pm-&gt;runtime_suspend(dev);
    }
    
    <span class="hljs-keyword">return</span> retval;
}
</code></pre>
<hr/>
<h2 data-id="heading-19">16. åº•å±‚åŸç†æ·±åº¦è§£æ</h2>
<h3 data-id="heading-20">16.1 CPU å¯„å­˜å™¨ä¿å­˜å’Œæ¢å¤çš„æ±‡ç¼–å®ç°</h3>
<p><strong>ARM64 æ¶æ„çš„å¯„å­˜å™¨ä¿å­˜</strong>ï¼š</p>
<pre><code class="hljs language-assembly" lang="assembly">// arch/arm64/kernel/sleep.S
/*
 * cpu_suspend_enter - ä¿å­˜ CPU å¯„å­˜å™¨å¹¶è¿›å…¥ä¼‘çœ 
 * 
 * å‚æ•°ï¼š
 *   x0: å‚æ•°
 *   x1: suspend_finisher å‡½æ•°æŒ‡é’ˆ
 */
ENTRY(__cpu_suspend_enter)
    // 1. ä¿å­˜é€šç”¨å¯„å­˜å™¨ï¼ˆx19-x28 æ˜¯ callee-savedï¼‰
    stp     x19, x20, [x0, #CPU_CTX_X19]
    stp     x21, x22, [x0, #CPU_CTX_X21]
    stp     x23, x24, [x0, #CPU_CTX_X23]
    stp     x25, x26, [x0, #CPU_CTX_X25]
    stp     x27, x28, [x0, #CPU_CTX_X27]
    stp     x29, lr, [x0, #CPU_CTX_X29]
    
    // 2. ä¿å­˜æ ˆæŒ‡é’ˆ
    mov     x2, sp
    str     x2, [x0, #CPU_CTX_SP]
    
    // 3. ä¿å­˜ç³»ç»Ÿå¯„å­˜å™¨
    mrs     x2, tpidr_el0
    str     x2, [x0, #CPU_CTX_TPIDR_EL0]
    mrs     x2, tpidrro_el0
    str     x2, [x0, #CPU_CTX_TPIDRRO_EL0]
    mrs     x2, contextidr_el1
    str     x2, [x0, #CPU_CTX_CONTEXTIDR_EL1]
    
    // 4. ä¿å­˜å¼‚å¸¸é“¾æ¥å¯„å­˜å™¨
    mrs     x2, elr_el1
    str     x2, [x0, #CPU_CTX_ELR_EL1]
    mrs     x2, spsr_el1
    str     x2, [x0, #CPU_CTX_SPSR_EL1]
    
    // 5. ä¿å­˜æ ˆæŒ‡é’ˆï¼ˆEL0 å’Œ EL1ï¼‰
    mrs     x2, sp_el0
    str     x2, [x0, #CPU_CTX_SP_EL0]
    mrs     x2, sp_el1
    str     x2, [x0, #CPU_CTX_SP_EL1]
    
    // 6. è°ƒç”¨ suspend_finisher å‡½æ•°
    mov     x0, x1
    bl      cpu_do_suspend
    
    // 7. å¦‚æœè¿”å›ï¼Œæ¢å¤å¯„å­˜å™¨
    b       __cpu_suspend_exit
ENDPROC(__cpu_suspend_enter)
</code></pre>
<p><strong>ARM64 æ¶æ„çš„å¯„å­˜å™¨æ¢å¤</strong>ï¼š</p>
<pre><code class="hljs language-assembly" lang="assembly">// arch/arm64/kernel/sleep.S
/*
 * __cpu_suspend_exit - æ¢å¤ CPU å¯„å­˜å™¨
 * 
 * å‚æ•°ï¼š
 *   x0: CPU ä¸Šä¸‹æ–‡ç»“æ„æŒ‡é’ˆ
 */
ENTRY(__cpu_suspend_exit)
    // 1. æ¢å¤ç³»ç»Ÿå¯„å­˜å™¨
    ldr     x2, [x0, #CPU_CTX_TPIDR_EL0]
    msr     tpidr_el0, x2
    ldr     x2, [x0, #CPU_CTX_TPIDRRO_EL0]
    msr     tpidrro_el0, x2
    ldr     x2, [x0, #CPU_CTX_CONTEXTIDR_EL1]
    msr     contextidr_el1, x2
    
    // 2. æ¢å¤å¼‚å¸¸é“¾æ¥å¯„å­˜å™¨
    ldr     x2, [x0, #CPU_CTX_ELR_EL1]
    msr     elr_el1, x2
    ldr     x2, [x0, #CPU_CTX_SPSR_EL1]
    msr     spsr_el1, x2
    
    // 3. æ¢å¤æ ˆæŒ‡é’ˆ
    ldr     x2, [x0, #CPU_CTX_SP_EL0]
    msr     sp_el0, x2
    ldr     x2, [x0, #CPU_CTX_SP_EL1]
    msr     sp_el1, x2
    
    // 4. æ¢å¤é€šç”¨å¯„å­˜å™¨
    ldp     x19, x20, [x0, #CPU_CTX_X19]
    ldp     x21, x22, [x0, #CPU_CTX_X21]
    ldp     x23, x24, [x0, #CPU_CTX_X23]
    ldp     x25, x26, [x0, #CPU_CTX_X25]
    ldp     x27, x28, [x0, #CPU_CTX_X27]
    ldp     x29, lr, [x0, #CPU_CTX_X29]
    
    // 5. æ¢å¤æ ˆæŒ‡é’ˆ
    ldr     x2, [x0, #CPU_CTX_SP]
    mov     sp, x2
    
    // 6. è¿”å›
    ret
ENDPROC(__cpu_suspend_exit)
</code></pre>
<p><strong>x86_64 æ¶æ„çš„å¯„å­˜å™¨ä¿å­˜</strong>ï¼š</p>
<pre><code class="hljs language-assembly" lang="assembly">// arch/x86/power/hibernate_asm_64.S
/*
 * save_processor_state - ä¿å­˜ x86_64 CPU çŠ¶æ€
 */
ENTRY(save_processor_state)
    // 1. ä¿å­˜é€šç”¨å¯„å­˜å™¨
    pushq   %rbp
    pushq   %rbx
    pushq   %r12
    pushq   %r13
    pushq   %r14
    pushq   %r15
    
    // 2. ä¿å­˜æ®µå¯„å­˜å™¨
    movq    %ds, %rax
    movq    %rax, saved_context_ds(%rip)
    movq    %es, %rax
    movq    %rax, saved_context_es(%rip)
    movq    %fs, %rax
    movq    %rax, saved_context_fs(%rip)
    movq    %gs, %rax
    movq    %rax, saved_context_gs(%rip)
    
    // 3. ä¿å­˜æ§åˆ¶å¯„å­˜å™¨
    movq    %cr0, %rax
    movq    %rax, saved_context_cr0(%rip)
    movq    %cr2, %rax
    movq    %rax, saved_context_cr2(%rip)
    movq    %cr3, %rax
    movq    %rax, saved_context_cr3(%rip)
    movq    %cr4, %rax
    movq    %rax, saved_context_cr4(%rip)
    
    // 4. ä¿å­˜æµ®ç‚¹å¯„å­˜å™¨
    fxsave  saved_context_fxstate(%rip)
    
    ret
ENDPROC(save_processor_state)
</code></pre>
<h3 data-id="heading-21">16.2 MMU å’Œé¡µè¡¨çš„å¤„ç†</h3>
<p><strong>é¡µè¡¨åœ¨ä¼‘çœ ä¸­çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mm/mmu.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">cpu_suspend_set_direct_map</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. åˆ›å»ºä¸´æ—¶é¡µè¡¨ï¼ˆidentity mappingï¼‰</span>
    <span class="hljs-comment">// è¿™æ ·åœ¨ MMU å…³é—­å’Œé‡æ–°å¼€å¯æ—¶ï¼Œç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€ç›¸åŒ</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span> =</span> current-&gt;mm;
    <span class="hljs-type">pgd_t</span> *pgd = pgd_offset(mm, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 2. åˆ›å»º identity mapping</span>
    create_identity_mapping(pgd, __pa(_text), __pa(_end));
}

<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">cpu_resume_set_direct_map</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. æ¢å¤æ­£å¸¸çš„é¡µè¡¨æ˜ å°„</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span> =</span> current-&gt;mm;
    <span class="hljs-type">pgd_t</span> *pgd = pgd_offset(mm, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 2. æ¢å¤é¡µè¡¨</span>
    restore_page_table(pgd);
}
</code></pre>
<p><strong>MMU çš„ç¦ç”¨å’Œå¯ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">cpu_suspend</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg, <span class="hljs-type">int</span> (*fn)(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>))</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span> =</span> current-&gt;mm;
    <span class="hljs-type">int</span> ret;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    <span class="hljs-comment">// 1. ä¿å­˜å½“å‰é¡µè¡¨</span>
    <span class="hljs-keyword">if</span> (idmap_pgd) {
        cpu_set_reserved_ttbr0();
        local_flush_tlb_all();
    }
    
    <span class="hljs-comment">// 2. æ‰§è¡Œ suspend</span>
    ret = __cpu_suspend_enter(arg, fn);
    
    <span class="hljs-comment">// 3. æ¢å¤é¡µè¡¨</span>
    <span class="hljs-keyword">if</span> (idmap_pgd) {
        cpu_unset_reserved_ttbr0();
        local_flush_tlb_all();
    }
    
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<p><strong>TLB çš„åˆ·æ–°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mm/tlbflush.c</span>
<span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title function_">local_flush_tlb_all</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;
    
    local_irq_save(flags);
    
    <span class="hljs-comment">// 1. åˆ·æ–°æœ¬åœ° TLB</span>
    __flush_tlb_all();
    
    <span class="hljs-comment">// 2. åŒæ­¥æ‰€æœ‰ CPU</span>
    dsb(nsh);
    isb();
    
    local_irq_restore(flags);
}
</code></pre>
<h3 data-id="heading-22">16.3 ç¼“å­˜ä¸€è‡´æ€§å’Œå†…å­˜å±éšœ</h3>
<p><strong>ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜</strong>ï¼š</p>
<p>åœ¨ä¼‘çœ å’Œå”¤é†’è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å¯èƒ½å­˜åœ¨äºå¤šä¸ªä½ç½®ï¼š</p>
<ol>
<li><strong>CPU ç¼“å­˜</strong>ï¼ˆL1ã€L2ã€L3ï¼‰</li>
<li><strong>å†…å­˜</strong>ï¼ˆRAMï¼‰</li>
<li><strong>è®¾å¤‡ç¼“å†²åŒº</strong>ï¼ˆDMA ç¼“å†²åŒºï¼‰</li>
</ol>
<p>éœ€è¦ç¡®ä¿è¿™äº›ä½ç½®çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p><strong>ç¼“å­˜åˆ·æ–°çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mm/cache.S</span>
<span class="hljs-comment">/*
 * __flush_dcache_all - åˆ·æ–°æ‰€æœ‰æ•°æ®ç¼“å­˜
 */</span>
ENTRY(__flush_dcache_all)
    <span class="hljs-comment">// 1. è·å–ç¼“å­˜ä¿¡æ¯</span>
    mrs     x0, clidr_el1
    and     x3, x0, #<span class="hljs-number">0x7000000</span>
    lsr     x3, x3, #<span class="hljs-number">23</span>
    
    <span class="hljs-comment">// 2. éå†æ‰€æœ‰ç¼“å­˜çº§åˆ«</span>
    mov     x10, #<span class="hljs-number">0</span>
loop1:
    add     x2, x10, x10, lsr #<span class="hljs-number">1</span>
    lsr     x1, x0, x2
    and     x1, x1, #<span class="hljs-number">0x7</span>
    cmp     x1, #<span class="hljs-number">2</span>
    b.lt    skip
    
    <span class="hljs-comment">// 3. åˆ·æ–°ç¼“å­˜çº§åˆ«</span>
    mov     x9, x10
    lsl     x9, x9, #<span class="hljs-number">1</span>
    add     x17, x16, x9, lsl #<span class="hljs-number">2</span>
    ldr     x17, [x17]
    mov     x1, x17
    lsr     x1, x1, #<span class="hljs-number">13</span>
    and     x1, x1, #<span class="hljs-number">0x7fffff</span>
    mov     x2, x17
    ubfx    x7, x17, #<span class="hljs-number">3</span>, #<span class="hljs-number">10</span>
    ubfx    x8, x17, #<span class="hljs-number">13</span>, #<span class="hljs-number">15</span>
    
loop2:
    mov     x3, x7
loop3:
    lsl     x6, x3, x8
    orr     x11, x10, x6
    lsl     x6, x2, x1
    orr     x11, x11, x6
    dc      cisw, x11
    subs    x3, x3, #<span class="hljs-number">1</span>
    b.ge    loop3
    subs    x2, x2, #<span class="hljs-number">1</span>
    b.ge    loop2
    
skip:
    add     x10, x10, #<span class="hljs-number">2</span>
    cmp     x3, x10
    b.gt    loop1
    
    <span class="hljs-comment">// 4. åŒæ­¥</span>
    dsb     sy
    isb
    ret
<span class="hljs-title function_">ENDPROC</span><span class="hljs-params">(__flush_dcache_all)</span>
</code></pre>
<p><strong>å†…å­˜å±éšœçš„ä½¿ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// include/asm-generic/barrier.h</span>
<span class="hljs-comment">/*
 * å†…å­˜å±éšœç¡®ä¿å†…å­˜æ“ä½œçš„é¡ºåº
 */</span>

<span class="hljs-comment">// 1. å†™å±éšœï¼šç¡®ä¿ä¹‹å‰çš„å†™å…¥æ“ä½œå®Œæˆ</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> wmb()    asm volatile(<span class="hljs-string">"dmb ishst"</span> ::: <span class="hljs-string">"memory"</span>)</span>

<span class="hljs-comment">// 2. è¯»å±éšœï¼šç¡®ä¿ä¹‹å‰çš„è¯»å–æ“ä½œå®Œæˆ</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> rmb()    asm volatile(<span class="hljs-string">"dmb ishld"</span> ::: <span class="hljs-string">"memory"</span>)</span>

<span class="hljs-comment">// 3. å®Œæ•´å±éšœï¼šç¡®ä¿æ‰€æœ‰å†…å­˜æ“ä½œå®Œæˆ</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> mb()     asm volatile(<span class="hljs-string">"dmb ish"</span> ::: <span class="hljs-string">"memory"</span>)</span>

<span class="hljs-comment">// 4. æ•°æ®åŒæ­¥å±éšœï¼šç¡®ä¿æ‰€æœ‰æ•°æ®è®¿é—®å®Œæˆ</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> dsb(opt) asm volatile(<span class="hljs-string">"dsb "</span> #opt ::: <span class="hljs-string">"memory"</span>)</span>

<span class="hljs-comment">// 5. æŒ‡ä»¤åŒæ­¥å±éšœï¼šç¡®ä¿æ‰€æœ‰æŒ‡ä»¤å®Œæˆ</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> isb()    asm volatile(<span class="hljs-string">"isb"</span> ::: <span class="hljs-string">"memory"</span>)</span>
</code></pre>
<p><strong>ä¼‘çœ ä¸­çš„ç¼“å­˜å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">cpu_suspend</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg, <span class="hljs-type">int</span> (*fn)(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>))</span>
{
    <span class="hljs-comment">// 1. åˆ·æ–°æ•°æ®ç¼“å­˜åˆ°å†…å­˜</span>
    flush_cache_all();
    
    <span class="hljs-comment">// 2. å†…å­˜å±éšœï¼Œç¡®ä¿ç¼“å­˜åˆ·æ–°å®Œæˆ</span>
    dsb(sy);
    
    <span class="hljs-comment">// 3. æ‰§è¡Œ suspend</span>
    ret = __cpu_suspend_enter(arg, fn);
    
    <span class="hljs-comment">// 4. å¦‚æœè¿”å›ï¼Œä½¿ç¼“å­˜å¤±æ•ˆ</span>
    invalidate_icache_all();
    
    <span class="hljs-comment">// 5. å†…å­˜å±éšœï¼Œç¡®ä¿ç¼“å­˜å¤±æ•ˆå®Œæˆ</span>
    isb();
    
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h3 data-id="heading-23">16.4 ä¸­æ–­æ§åˆ¶å™¨çš„å¤„ç†</h3>
<p><strong>ä¸­æ–­æ§åˆ¶å™¨çš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/irqchip/irq-gic-v3.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">gic_suspend</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">void</span> __iomem *dist_base;
    u32 val;
    <span class="hljs-type">int</span> i;
    
    dist_base = gic_data.dist_base;
    
    <span class="hljs-comment">// 1. ä¿å­˜ä¸­æ–­æ§åˆ¶å™¨çš„å¯„å­˜å™¨çŠ¶æ€</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; GIC_DIST_REG_NUM; i++) {
        gic_saved_regs[i] = readl_relaxed(dist_base + i * <span class="hljs-number">4</span>);
    }
    
    <span class="hljs-comment">// 2. ç¦ç”¨æ‰€æœ‰ä¸­æ–­</span>
    writel_relaxed(<span class="hljs-number">0</span>, dist_base + GIC_DIST_ENABLE_SET);
    
    <span class="hljs-comment">// 3. é…ç½®å”¤é†’ä¸­æ–­</span>
    <span class="hljs-comment">// åªä¿ç•™å”¤é†’æºçš„ä¸­æ–­å¯ç”¨</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; wakeup_irqs_num; i++) {
        writel_relaxed(<span class="hljs-number">1</span> &lt;&lt; wakeup_irqs[i], 
                      dist_base + GIC_DIST_ENABLE_SET);
    }
    
    <span class="hljs-comment">// 4. è¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    val = readl_relaxed(dist_base + GIC_DIST_CTRL);
    val |= GIC_DIST_CTRL_DISABLE;
    writel_relaxed(val, dist_base + GIC_DIST_CTRL);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>ä¸­æ–­æ§åˆ¶å™¨çš„ resume</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/irqchip/irq-gic-v3.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">gic_resume</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">void</span> __iomem *dist_base;
    u32 val;
    <span class="hljs-type">int</span> i;
    
    dist_base = gic_data.dist_base;
    
    <span class="hljs-comment">// 1. é€€å‡ºä½åŠŸè€—æ¨¡å¼</span>
    val = readl_relaxed(dist_base + GIC_DIST_CTRL);
    val &amp;= ~GIC_DIST_CTRL_DISABLE;
    writel_relaxed(val, dist_base + GIC_DIST_CTRL);
    
    <span class="hljs-comment">// 2. æ¢å¤ä¸­æ–­æ§åˆ¶å™¨çš„å¯„å­˜å™¨çŠ¶æ€</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; GIC_DIST_REG_NUM; i++) {
        writel_relaxed(gic_saved_regs[i], dist_base + i * <span class="hljs-number">4</span>);
    }
    
    <span class="hljs-comment">// 3. é‡æ–°åˆå§‹åŒ–ä¸­æ–­æ§åˆ¶å™¨</span>
    gic_dist_init();
    gic_cpu_init();
}
</code></pre>
<h3 data-id="heading-24">16.5 æ—¶é’Ÿæºçš„å¤„ç†</h3>
<p><strong>æ—¶é’Ÿæºçš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/clocksource/arm_arch_timer.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arch_timer_suspend</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. ä¿å­˜æ—¶é’ŸæºçŠ¶æ€</span>
    arch_timer_saved_regs.cntv_ctl = arch_timer_get_cntv_ctl();
    arch_timer_saved_regs.cntv_cval = arch_timer_get_cntv_cval();
    arch_timer_saved_regs.cntvct = arch_timer_get_cntvct();
    
    <span class="hljs-comment">// 2. ç¦ç”¨è™šæ‹Ÿå®šæ—¶å™¨</span>
    arch_timer_set_cntv_ctl(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 3. å¦‚æœæ”¯æŒï¼Œè¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    <span class="hljs-keyword">if</span> (arch_timer_has_power_management()) {
        arch_timer_power_down();
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>æ—¶é’Ÿæºçš„ resume</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/clocksource/arm_arch_timer.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">arch_timer_resume</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    u64 cval;
    u32 ctl;
    
    <span class="hljs-comment">// 1. å¦‚æœæ”¯æŒï¼Œé€€å‡ºä½åŠŸè€—æ¨¡å¼</span>
    <span class="hljs-keyword">if</span> (arch_timer_has_power_management()) {
        arch_timer_power_up();
    }
    
    <span class="hljs-comment">// 2. æ¢å¤æ—¶é’ŸæºçŠ¶æ€</span>
    cval = arch_timer_saved_regs.cntv_cval;
    ctl = arch_timer_saved_regs.cntv_ctl;
    
    <span class="hljs-comment">// 3. è®¾ç½®æ¯”è¾ƒå€¼</span>
    arch_timer_set_cntv_cval(cval);
    
    <span class="hljs-comment">// 4. æ¢å¤æ§åˆ¶å¯„å­˜å™¨</span>
    arch_timer_set_cntv_ctl(ctl);
    
    <span class="hljs-comment">// 5. é‡æ–°åˆå§‹åŒ–æ—¶é’Ÿæº</span>
    arch_timer_init();
}
</code></pre>
<h3 data-id="heading-25">16.6 å¹³å°ç‰¹å®šçš„ç¡¬ä»¶æ“ä½œ</h3>
<p><strong>å¹³å°ç”µæºç®¡ç†å•å…ƒï¼ˆPMUï¼‰çš„æ“ä½œ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mach-xxx/pm.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">platform_suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">void</span> __iomem *pmu_base = ioremap(PMU_BASE, SZ_4K);
    u32 val;
    
    <span class="hljs-comment">// 1. ä¿å­˜ PMU å¯„å­˜å™¨çŠ¶æ€</span>
    platform_pmu_saved_regs.ctrl = readl(pmu_base + PMU_CTRL);
    platform_pmu_saved_regs.status = readl(pmu_base + PMU_STATUS);
    platform_pmu_saved_regs.wakeup_mask = readl(pmu_base + PMU_WAKEUP_MASK);
    
    <span class="hljs-comment">// 2. é…ç½®å”¤é†’æº</span>
    val = readl(pmu_base + PMU_WAKEUP_MASK);
    val |= (<span class="hljs-number">1</span> &lt;&lt; WAKEUP_SOURCE_POWER_BUTTON);
    val |= (<span class="hljs-number">1</span> &lt;&lt; WAKEUP_SOURCE_RTC);
    writel(val, pmu_base + PMU_WAKEUP_MASK);
    
    <span class="hljs-comment">// 3. é…ç½®ä¼‘çœ æ¨¡å¼</span>
    val = readl(pmu_base + PMU_CTRL);
    val &amp;= ~PMU_CTRL_SUSPEND_MODE_MASK;
    val |= (state == PM_SUSPEND_MEM ? PMU_CTRL_SUSPEND_MODE_MEM : 
            PMU_CTRL_SUSPEND_MODE_STANDBY);
    writel(val, pmu_base + PMU_CTRL);
    
    <span class="hljs-comment">// 4. åˆ·æ–°ç¼“å­˜</span>
    flush_cache_all();
    dsb(sy);
    
    <span class="hljs-comment">// 5. è¿›å…¥ä¼‘çœ </span>
    val = readl(pmu_base + PMU_CTRL);
    val |= PMU_CTRL_SUSPEND_ENABLE;
    writel(val, pmu_base + PMU_CTRL);
    
    <span class="hljs-comment">// 6. ç­‰å¾…è¿›å…¥ä¼‘çœ ï¼ˆCPU ä¼šåœ¨è¿™é‡Œåœæ­¢ï¼‰</span>
    wfi();  <span class="hljs-comment">// Wait For Interrupt</span>
    
    <span class="hljs-comment">// 7. å¦‚æœè¿”å›ï¼Œè¯´æ˜è¢«å”¤é†’</span>
    iounmap(pmu_base);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>WFIï¼ˆWait For Interruptï¼‰æŒ‡ä»¤</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/include/asm/suspend.h</span>
<span class="hljs-comment">/*
 * WFI (Wait For Interrupt) æ˜¯ ARM æ¶æ„çš„æŒ‡ä»¤
 * ä½¿ CPU è¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼Œç­‰å¾…ä¸­æ–­å”¤é†’
 */</span>
<span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title function_">cpu_do_idle</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(
        <span class="hljs-string">"wfi\n"</span>
        :
        :
        : <span class="hljs-string">"memory"</span>
    )</span>;
}
</code></pre>
<h3 data-id="heading-26">16.7 å†…å­˜æ˜ å°„å’Œè™šæ‹Ÿåœ°å€çš„å¤„ç†</h3>
<p><strong>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mm/mmu.c</span>
<span class="hljs-comment">/*
 * åœ¨ä¼‘çœ è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¤„ç†è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„
 * å› ä¸º MMU å¯èƒ½ä¼šè¢«ç¦ç”¨å’Œé‡æ–°å¯ç”¨
 */</span>

<span class="hljs-comment">// 1. åˆ›å»º identity mappingï¼ˆç‰©ç†åœ°å€ = è™šæ‹Ÿåœ°å€ï¼‰</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">create_identity_mapping</span><span class="hljs-params">(<span class="hljs-type">pgd_t</span> *pgd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start, 
                                     <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> end)</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> addr;
    <span class="hljs-type">pgd_t</span> *pgdp;
    <span class="hljs-type">pud_t</span> *pudp;
    <span class="hljs-type">pmd_t</span> *pmdp;
    <span class="hljs-type">pte_t</span> *ptep;
    
    <span class="hljs-keyword">for</span> (addr = start; addr &lt; end; addr += PAGE_SIZE) {
        <span class="hljs-comment">// è·å–é¡µè¡¨é¡¹</span>
        pgdp = pgd_offset_raw(pgd, addr);
        pudp = pud_offset(pgdp, addr);
        pmdp = pmd_offset(pudp, addr);
        ptep = pte_offset_kernel(pmdp, addr);
        
        <span class="hljs-comment">// åˆ›å»ºæ˜ å°„ï¼ˆç‰©ç†åœ°å€ = è™šæ‹Ÿåœ°å€ï¼‰</span>
        set_pte(ptep, pfn_pte(__phys_to_pfn(addr), PAGE_KERNEL_EXEC));
    }
    
    <span class="hljs-comment">// åˆ·æ–° TLB</span>
    flush_tlb_all();
}
</code></pre>
<p><strong>é¡µè¡¨åˆ‡æ¢çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">cpu_suspend_switch_mm</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span> =</span> current-&gt;mm;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">idmap_mm</span> =</span> &amp;init_mm;
    
    <span class="hljs-comment">// 1. åˆ‡æ¢åˆ° identity mapping çš„é¡µè¡¨</span>
    cpu_switch_mm(idmap_mm-&gt;pgd, idmap_mm);
    
    <span class="hljs-comment">// 2. åˆ·æ–° TLB</span>
    local_flush_tlb_all();
}
</code></pre>
<h3 data-id="heading-27">16.8 å¤šæ ¸ CPU çš„åè°ƒ</h3>
<p><strong>ä¸» CPU å’Œä» CPU çš„åè°ƒ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_disable_secondary_cpus</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">int</span> cpu, error = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 1. ç¦ç”¨æ‰€æœ‰ä» CPU</span>
    for_each_online_cpu(cpu) {
        <span class="hljs-keyword">if</span> (cpu == smp_processor_id())
            <span class="hljs-keyword">continue</span>;
        
        error = cpu_down(cpu);
        <span class="hljs-keyword">if</span> (error) {
            pr_err(<span class="hljs-string">"Failed to disable CPU %d: %d\n"</span>, cpu, error);
            <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-comment">// 2. ç­‰å¾…æ‰€æœ‰ä» CPU è¿›å…¥ç¦»çº¿çŠ¶æ€</span>
    for_each_online_cpu(cpu) {
        <span class="hljs-keyword">if</span> (cpu == smp_processor_id())
            <span class="hljs-keyword">continue</span>;
        
        wait_for_completion(&amp;cpu_hotplug_done);
    }
    
    <span class="hljs-keyword">return</span> error;
}

<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">suspend_enable_secondary_cpus</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">int</span> cpu;
    
    <span class="hljs-comment">// 1. å¯ç”¨æ‰€æœ‰ä» CPU</span>
    for_each_possible_cpu(cpu) {
        <span class="hljs-keyword">if</span> (cpu == smp_processor_id())
            <span class="hljs-keyword">continue</span>;
        
        cpu_up(cpu);
    }
}
</code></pre>
<p><strong>ä» CPU çš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/smp.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">cpu_suspend_cpu</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span>
{
    <span class="hljs-comment">// 1. ä» CPU è¿›å…¥ WFI çŠ¶æ€</span>
    cpu_do_idle();
    
    <span class="hljs-comment">// 2. å¦‚æœè¢«å”¤é†’ï¼Œæ¢å¤æ‰§è¡Œ</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-28">16.9 è®¾å¤‡ DMA å’Œç¼“å­˜ä¸€è‡´æ€§</h3>
<p><strong>DMA ç¼“å­˜ä¸€è‡´æ€§çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mm/dma-mapping.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">dma_cache_maint_page</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> page *page, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> offset,
                                  <span class="hljs-type">size_t</span> size, <span class="hljs-keyword">enum</span> dma_data_direction dir,
                                  <span class="hljs-type">void</span> (*op)(<span class="hljs-type">const</span> <span class="hljs-type">void</span> *, <span class="hljs-type">size_t</span>))</span>
{
    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> pfn = page_to_pfn(page) + offset / PAGE_SIZE;
    <span class="hljs-type">void</span> *vaddr = page_address(page) + offset;
    
    <span class="hljs-comment">// 1. å¦‚æœæ˜¯ DMA_TO_DEVICEï¼Œåˆ·æ–°ç¼“å­˜åˆ°å†…å­˜</span>
    <span class="hljs-keyword">if</span> (dir == DMA_TO_DEVICE) {
        __dma_map_area(vaddr, size, DMA_TO_DEVICE);
    }
    <span class="hljs-comment">// 2. å¦‚æœæ˜¯ DMA_FROM_DEVICEï¼Œä½¿ç¼“å­˜å¤±æ•ˆ</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dir == DMA_FROM_DEVICE) {
        __dma_unmap_area(vaddr, size, DMA_FROM_DEVICE);
    }
    <span class="hljs-comment">// 3. å¦‚æœæ˜¯ DMA_BIDIRECTIONALï¼Œåˆ·æ–°å¹¶å¤±æ•ˆ</span>
    <span class="hljs-keyword">else</span> {
        __dma_map_area(vaddr, size, DMA_BIDIRECTIONAL);
    }
}
</code></pre>
<p><strong>è®¾å¤‡ suspend ä¸­çš„ DMA å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/example/example_driver.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">example_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">example_device</span> *<span class="hljs-title">edev</span> =</span> dev_get_drvdata(dev);
    
    <span class="hljs-comment">// 1. åœæ­¢ DMA ä¼ è¾“</span>
    example_stop_dma(edev);
    
    <span class="hljs-comment">// 2. åŒæ­¥ DMA ç¼“å†²åŒº</span>
    dma_sync_single_for_cpu(dev, edev-&gt;dma_addr, edev-&gt;dma_size, 
                            DMA_BIDIRECTIONAL);
    
    <span class="hljs-comment">// 3. ä¿å­˜ DMA çŠ¶æ€</span>
    edev-&gt;saved_dma_state = ioread32(edev-&gt;base + REG_DMA_CTRL);
    
    <span class="hljs-comment">// 4. è¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    example_enter_low_power(edev);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-29">16.10 ä¸­æ–­åµŒå¥—å’Œä¼˜å…ˆçº§</h3>
<p><strong>ä¸­æ–­ä¼˜å…ˆçº§çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/irq.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">suspend_disable_irqs</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. ç¦ç”¨æ‰€æœ‰ä¸­æ–­ï¼ˆé™¤äº†å”¤é†’ä¸­æ–­ï¼‰</span>
    local_irq_disable();
    
    <span class="hljs-comment">// 2. è®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§æ©ç </span>
    <span class="hljs-comment">// åªå…è®¸é«˜ä¼˜å…ˆçº§çš„ä¸­æ–­ï¼ˆå”¤é†’ä¸­æ–­ï¼‰</span>
    gic_set_irq_priority_mask(<span class="hljs-number">0xf0</span>);  <span class="hljs-comment">// åªå…è®¸ä¼˜å…ˆçº§ 0-15 çš„ä¸­æ–­</span>
}

<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">resume_enable_irqs</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// 1. æ¢å¤ä¸­æ–­ä¼˜å…ˆçº§æ©ç </span>
    gic_set_irq_priority_mask(<span class="hljs-number">0x00</span>);  <span class="hljs-comment">// å…è®¸æ‰€æœ‰ä¸­æ–­</span>
    
    <span class="hljs-comment">// 2. å¯ç”¨ä¸­æ–­</span>
    local_irq_enable();
}
</code></pre>
<p><strong>å”¤é†’ä¸­æ–­çš„ç‰¹æ®Šå¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/wakeup.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">irqreturn_t</span> <span class="hljs-title function_">wakeup_irq_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> irq, <span class="hljs-type">void</span> *dev_id)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wakeup_source</span> *<span class="hljs-title">ws</span> =</span> dev_id;
    
    <span class="hljs-comment">// 1. æ ‡è®°å”¤é†’äº‹ä»¶</span>
    __pm_stay_awake(ws);
    
    <span class="hljs-comment">// 2. å¦‚æœç³»ç»Ÿæ­£åœ¨ä¼‘çœ ï¼Œç«‹å³å”¤é†’</span>
    <span class="hljs-keyword">if</span> (pm_suspend_state()) {
        <span class="hljs-comment">// 3. è®¾ç½®å”¤é†’æ ‡å¿—</span>
        pm_wakeup_irq = <span class="hljs-literal">true</span>;
        
        <span class="hljs-comment">// 4. ä¸­æ–­ä¼‘çœ æµç¨‹</span>
        pm_suspend_abort();
    }
    
    <span class="hljs-keyword">return</span> IRQ_HANDLED;
}
</code></pre>
<h3 data-id="heading-30">16.11 ç¡¬ä»¶å¯„å­˜å™¨çš„ä¿å­˜å’Œæ¢å¤</h3>
<p><strong>å¹³å°å¯„å­˜å™¨çš„ä¿å­˜</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mach-xxx/pm.c</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">platform_suspend_regs</span> {</span>
    u32 pmu_ctrl;
    u32 pmu_status;
    u32 pmu_wakeup_mask;
    u32 clk_ctrl;
    u32 clk_status;
    u32 gpio_ctrl[<span class="hljs-number">32</span>];
    u32 uart_ctrl;
    u32 i2c_ctrl[<span class="hljs-number">4</span>];
    <span class="hljs-comment">// ... æ›´å¤šå¯„å­˜å™¨</span>
};

<span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">platform_suspend_regs</span> <span class="hljs-title">saved_regs</span>;</span>

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">platform_suspend_save_regs</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">void</span> __iomem *pmu_base = ioremap(PMU_BASE, SZ_4K);
    <span class="hljs-type">void</span> __iomem *clk_base = ioremap(CLK_BASE, SZ_4K);
    <span class="hljs-type">int</span> i;
    
    <span class="hljs-comment">// 1. ä¿å­˜ PMU å¯„å­˜å™¨</span>
    saved_regs.pmu_ctrl = readl(pmu_base + PMU_CTRL);
    saved_regs.pmu_status = readl(pmu_base + PMU_STATUS);
    saved_regs.pmu_wakeup_mask = readl(pmu_base + PMU_WAKEUP_MASK);
    
    <span class="hljs-comment">// 2. ä¿å­˜æ—¶é’Ÿå¯„å­˜å™¨</span>
    saved_regs.clk_ctrl = readl(clk_base + CLK_CTRL);
    saved_regs.clk_status = readl(clk_base + CLK_STATUS);
    
    <span class="hljs-comment">// 3. ä¿å­˜ GPIO å¯„å­˜å™¨</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
        saved_regs.gpio_ctrl[i] = readl(GPIO_BASE + i * <span class="hljs-number">4</span>);
    }
    
    <span class="hljs-comment">// 4. ä¿å­˜ UART å¯„å­˜å™¨</span>
    saved_regs.uart_ctrl = readl(UART_BASE + UART_CTRL);
    
    <span class="hljs-comment">// 5. ä¿å­˜ I2C å¯„å­˜å™¨</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
        saved_regs.i2c_ctrl[i] = readl(I2C_BASE(i) + I2C_CTRL);
    }
    
    iounmap(pmu_base);
    iounmap(clk_base);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">platform_resume_restore_regs</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-type">void</span> __iomem *pmu_base = ioremap(PMU_BASE, SZ_4K);
    <span class="hljs-type">void</span> __iomem *clk_base = ioremap(CLK_BASE, SZ_4K);
    <span class="hljs-type">int</span> i;
    
    <span class="hljs-comment">// 1. æ¢å¤ PMU å¯„å­˜å™¨</span>
    writel(saved_regs.pmu_ctrl, pmu_base + PMU_CTRL);
    writel(saved_regs.pmu_status, pmu_base + PMU_STATUS);
    writel(saved_regs.pmu_wakeup_mask, pmu_base + PMU_WAKEUP_MASK);
    
    <span class="hljs-comment">// 2. æ¢å¤æ—¶é’Ÿå¯„å­˜å™¨</span>
    writel(saved_regs.clk_ctrl, clk_base + CLK_CTRL);
    writel(saved_regs.clk_status, clk_base + CLK_STATUS);
    
    <span class="hljs-comment">// 3. æ¢å¤ GPIO å¯„å­˜å™¨</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
        writel(saved_regs.gpio_ctrl[i], GPIO_BASE + i * <span class="hljs-number">4</span>);
    }
    
    <span class="hljs-comment">// 4. æ¢å¤ UART å¯„å­˜å™¨</span>
    writel(saved_regs.uart_ctrl, UART_BASE + UART_CTRL);
    
    <span class="hljs-comment">// 5. æ¢å¤ I2C å¯„å­˜å™¨</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
        writel(saved_regs.i2c_ctrl[i], I2C_BASE(i) + I2C_CTRL);
    }
    
    iounmap(pmu_base);
    iounmap(clk_base);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-31">16.12 ç”µæºåŸŸï¼ˆPower Domainï¼‰çš„ç®¡ç†</h3>
<p><strong>ç”µæºåŸŸçš„å®šä¹‰</strong>ï¼š</p>
<p>ç”µæºåŸŸæ˜¯ä¸€ç»„å…±äº«ç”µæºçš„ç¡¬ä»¶æ¨¡å—ã€‚åœ¨ä¼‘çœ æ—¶ï¼Œå¯ä»¥å…³é—­æ•´ä¸ªç”µæºåŸŸä»¥èŠ‚çœåŠŸè€—ã€‚</p>
<p><strong>ç”µæºåŸŸçš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/domain.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">genpd_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">generic_pm_domain</span> *<span class="hljs-title">genpd</span> =</span> dev_to_genpd(dev);
    <span class="hljs-type">int</span> ret;
    
    <span class="hljs-comment">// 1. æ£€æŸ¥ç”µæºåŸŸæ˜¯å¦å¯ä»¥ suspend</span>
    <span class="hljs-keyword">if</span> (genpd-&gt;status == GPD_STATE_POWER_OFF)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 2. è°ƒç”¨ç”µæºåŸŸçš„ suspend å›è°ƒ</span>
    <span class="hljs-keyword">if</span> (genpd-&gt;suspend) {
        ret = genpd-&gt;suspend(genpd);
        <span class="hljs-keyword">if</span> (ret)
            <span class="hljs-keyword">return</span> ret;
    }
    
    <span class="hljs-comment">// 3. å…³é—­ç”µæºåŸŸ</span>
    ret = genpd_power_off(genpd);
    <span class="hljs-keyword">if</span> (ret) {
        <span class="hljs-comment">// å¦‚æœå¤±è´¥ï¼Œæ¢å¤ç”µæºåŸŸ</span>
        <span class="hljs-keyword">if</span> (genpd-&gt;resume)
            genpd-&gt;resume(genpd);
        <span class="hljs-keyword">return</span> ret;
    }
    
    genpd-&gt;status = GPD_STATE_POWER_OFF;
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">genpd_power_off</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> generic_pm_domain *genpd)</span>
{
    <span class="hljs-comment">// 1. å…³é—­ç”µæºåŸŸçš„æ—¶é’Ÿ</span>
    clk_disable_unprepare(genpd-&gt;clk);
    
    <span class="hljs-comment">// 2. å…³é—­ç”µæºåŸŸçš„ç”µæº</span>
    <span class="hljs-keyword">if</span> (genpd-&gt;regulator) {
        regulator_disable(genpd-&gt;regulator);
    }
    
    <span class="hljs-comment">// 3. ç­‰å¾…ç”µæºç¨³å®š</span>
    udelay(genpd-&gt;power_off_delay);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>ç”µæºåŸŸçš„ resume</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/domain.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">genpd_resume</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">generic_pm_domain</span> *<span class="hljs-title">genpd</span> =</span> dev_to_genpd(dev);
    <span class="hljs-type">int</span> ret;
    
    <span class="hljs-comment">// 1. æ£€æŸ¥ç”µæºåŸŸæ˜¯å¦å·²ç»å¼€å¯</span>
    <span class="hljs-keyword">if</span> (genpd-&gt;status != GPD_STATE_POWER_OFF)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 2. å¼€å¯ç”µæºåŸŸ</span>
    ret = genpd_power_on(genpd);
    <span class="hljs-keyword">if</span> (ret)
        <span class="hljs-keyword">return</span> ret;
    
    <span class="hljs-comment">// 3. è°ƒç”¨ç”µæºåŸŸçš„ resume å›è°ƒ</span>
    <span class="hljs-keyword">if</span> (genpd-&gt;resume) {
        ret = genpd-&gt;resume(genpd);
        <span class="hljs-keyword">if</span> (ret) {
            genpd_power_off(genpd);
            <span class="hljs-keyword">return</span> ret;
        }
    }
    
    genpd-&gt;status = GPD_STATE_ACTIVE;
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">genpd_power_on</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> generic_pm_domain *genpd)</span>
{
    <span class="hljs-comment">// 1. å¼€å¯ç”µæºåŸŸçš„ç”µæº</span>
    <span class="hljs-keyword">if</span> (genpd-&gt;regulator) {
        ret = regulator_enable(genpd-&gt;regulator);
        <span class="hljs-keyword">if</span> (ret)
            <span class="hljs-keyword">return</span> ret;
    }
    
    <span class="hljs-comment">// 2. ç­‰å¾…ç”µæºç¨³å®š</span>
    udelay(genpd-&gt;power_on_delay);
    
    <span class="hljs-comment">// 3. å¼€å¯ç”µæºåŸŸçš„æ—¶é’Ÿ</span>
    ret = clk_prepare_enable(genpd-&gt;clk);
    <span class="hljs-keyword">if</span> (ret) {
        <span class="hljs-keyword">if</span> (genpd-&gt;regulator)
            regulator_disable(genpd-&gt;regulator);
        <span class="hljs-keyword">return</span> ret;
    }
    
    <span class="hljs-comment">// 4. ç­‰å¾…æ—¶é’Ÿç¨³å®š</span>
    udelay(genpd-&gt;clock_latency);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-32">16.13 æ—¶é’Ÿå’Œå¤ä½ç®¡ç†</h3>
<p><strong>æ—¶é’Ÿçš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/clk/clk.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">clk_suspend</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clk_core</span> *<span class="hljs-title">clk</span>;</span>
    
    <span class="hljs-comment">// 1. éå†æ‰€æœ‰æ—¶é’Ÿ</span>
    clk_prepare_lock();
    hlist_for_each_entry(clk, &amp;clk_root_list, child_node) {
        <span class="hljs-comment">// 2. ä¿å­˜æ—¶é’ŸçŠ¶æ€</span>
        clk-&gt;saved_rate = clk-&gt;rate;
        clk-&gt;saved_parent = clk-&gt;parent;
        clk-&gt;saved_flags = clk-&gt;flags;
        
        <span class="hljs-comment">// 3. å¦‚æœæ—¶é’Ÿå¯ä»¥å…³é—­ï¼Œå…³é—­æ—¶é’Ÿ</span>
        <span class="hljs-keyword">if</span> (clk-&gt;flags &amp; CLK_IS_CRITICAL)
            <span class="hljs-keyword">continue</span>;
        
        <span class="hljs-keyword">if</span> (clk-&gt;enable_count &gt; <span class="hljs-number">0</span>) {
            clk_core_disable(clk);
        }
    }
    clk_prepare_unlock();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>å¤ä½çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/reset/core.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">reset_controller_suspend</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">reset_controller_dev</span> *<span class="hljs-title">rcdev</span>;</span>
    
    <span class="hljs-comment">// 1. éå†æ‰€æœ‰å¤ä½æ§åˆ¶å™¨</span>
    mutex_lock(&amp;reset_list_mutex);
    list_for_each_entry(rcdev, &amp;reset_controller_list, <span class="hljs-built_in">list</span>) {
        <span class="hljs-comment">// 2. ä¿å­˜å¤ä½çŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (rcdev-&gt;ops-&gt;save_context) {
            rcdev-&gt;ops-&gt;save_context(rcdev);
        }
    }
    mutex_unlock(&amp;reset_list_mutex);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-33">16.14 å†…å­˜æ§åˆ¶å™¨çš„å¤„ç†</h3>
<p><strong>å†…å­˜æ§åˆ¶å™¨çš„ suspend</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/memory/example-memory-controller.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">memory_controller_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memory_controller</span> *<span class="hljs-title">mc</span> =</span> dev_get_drvdata(dev);
    <span class="hljs-type">void</span> __iomem *base = mc-&gt;base;
    u32 val;
    
    <span class="hljs-comment">// 1. ä¿å­˜å†…å­˜æ§åˆ¶å™¨å¯„å­˜å™¨</span>
    mc-&gt;saved_regs.ctrl = readl(base + MC_CTRL);
    mc-&gt;saved_regs.timing = readl(base + MC_TIMING);
    mc-&gt;saved_regs.power = readl(base + MC_POWER);
    
    <span class="hljs-comment">// 2. é…ç½®å†…å­˜è¿›å…¥è‡ªåˆ·æ–°æ¨¡å¼ï¼ˆSelf-Refreshï¼‰</span>
    val = readl(base + MC_CTRL);
    val |= MC_CTRL_SELF_REFRESH_ENABLE;
    writel(val, base + MC_CTRL);
    
    <span class="hljs-comment">// 3. ç­‰å¾…è¿›å…¥è‡ªåˆ·æ–°æ¨¡å¼</span>
    <span class="hljs-keyword">while</span> (!(readl(base + MC_STATUS) &amp; MC_STATUS_SELF_REFRESH_ACTIVE)) {
        cpu_relax();
    }
    
    <span class="hljs-comment">// 4. é™ä½å†…å­˜é¢‘ç‡</span>
    val = readl(base + MC_POWER);
    val |= MC_POWER_LOW_FREQ;
    writel(val, base + MC_POWER);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>å†…å­˜æ§åˆ¶å™¨çš„ resume</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/memory/example-memory-controller.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">memory_controller_resume</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">memory_controller</span> *<span class="hljs-title">mc</span> =</span> dev_get_drvdata(dev);
    <span class="hljs-type">void</span> __iomem *base = mc-&gt;base;
    u32 val;
    
    <span class="hljs-comment">// 1. æ¢å¤å†…å­˜é¢‘ç‡</span>
    val = readl(base + MC_POWER);
    val &amp;= ~MC_POWER_LOW_FREQ;
    writel(val, base + MC_POWER);
    
    <span class="hljs-comment">// 2. é€€å‡ºè‡ªåˆ·æ–°æ¨¡å¼</span>
    val = readl(base + MC_CTRL);
    val &amp;= ~MC_CTRL_SELF_REFRESH_ENABLE;
    writel(val, base + MC_CTRL);
    
    <span class="hljs-comment">// 3. ç­‰å¾…é€€å‡ºè‡ªåˆ·æ–°æ¨¡å¼</span>
    <span class="hljs-keyword">while</span> (readl(base + MC_STATUS) &amp; MC_STATUS_SELF_REFRESH_ACTIVE) {
        cpu_relax();
    }
    
    <span class="hljs-comment">// 4. æ¢å¤å†…å­˜æ§åˆ¶å™¨å¯„å­˜å™¨</span>
    writel(mc-&gt;saved_regs.ctrl, base + MC_CTRL);
    writel(mc-&gt;saved_regs.timing, base + MC_TIMING);
    writel(mc-&gt;saved_regs.power, base + MC_POWER);
    
    <span class="hljs-comment">// 5. åˆå§‹åŒ–å†…å­˜</span>
    memory_controller_init(mc);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-34">16.15 å¹³å°ç‰¹å®šçš„ä½åŠŸè€—æ¨¡å¼</h3>
<p><strong>CPU ä½åŠŸè€—æ¨¡å¼çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/kernel/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">cpu_do_suspend</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span>
{
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sleep_stack_data</span> *<span class="hljs-title">ctx</span> =</span> (<span class="hljs-keyword">struct</span> sleep_stack_data *)arg;
    u32 tmp;
    
    <span class="hljs-comment">// 1. ä¿å­˜é€šç”¨å¯„å­˜å™¨</span>
    cpu_suspend_save(&amp;ctx-&gt;cpu_context);
    
    <span class="hljs-comment">// 2. ä¿å­˜ç³»ç»Ÿå¯„å­˜å™¨</span>
    mrs(tmp, tpidr_el0);
    ctx-&gt;cpu_context.tpidr_el0 = tmp;
    mrs(tmp, tpidrro_el0);
    ctx-&gt;cpu_context.tpidrro_el0 = tmp;
    mrs(tmp, contextidr_el1);
    ctx-&gt;cpu_context.contextidr_el1 = tmp;
    
    <span class="hljs-comment">// 3. ä¿å­˜å¼‚å¸¸å¯„å­˜å™¨</span>
    mrs(tmp, elr_el1);
    ctx-&gt;cpu_context.elr_el1 = tmp;
    mrs(tmp, spsr_el1);
    ctx-&gt;cpu_context.spsr_el1 = tmp;
    
    <span class="hljs-comment">// 4. ä¿å­˜æ ˆæŒ‡é’ˆ</span>
    mrs(tmp, sp_el0);
    ctx-&gt;cpu_context.sp_el0 = tmp;
    mrs(tmp, sp_el1);
    ctx-&gt;cpu_context.sp_el1 = tmp;
    
    <span class="hljs-comment">// 5. é…ç½® CPU è¿›å…¥ä½åŠŸè€—æ¨¡å¼</span>
    <span class="hljs-comment">// è®¾ç½® CPU è¿›å…¥ WFI çŠ¶æ€</span>
    <span class="hljs-comment">// é…ç½®å”¤é†’æº</span>
    
    <span class="hljs-comment">// 6. è¿›å…¥ WFIï¼ˆWait For Interruptï¼‰</span>
    <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(<span class="hljs-string">"wfi"</span> ::: <span class="hljs-string">"memory"</span>)</span>;
    
    <span class="hljs-comment">// 7. å¦‚æœè¿”å›ï¼Œæ¢å¤å¯„å­˜å™¨</span>
    cpu_suspend_restore(&amp;ctx-&gt;cpu_context);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>å¹³å°ç”µæºç®¡ç†å•å…ƒçš„è¯¦ç»†æ“ä½œ</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mach-xxx/pm.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">platform_suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">void</span> __iomem *pmu_base = ioremap(PMU_BASE, SZ_4K);
    u32 val;
    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 1. é…ç½®ä¼‘çœ æ¨¡å¼</span>
    val = readl(pmu_base + PMU_CTRL);
    val &amp;= ~PMU_CTRL_SUSPEND_MODE_MASK;
    
    <span class="hljs-keyword">switch</span> (state) {
    <span class="hljs-keyword">case</span> PM_SUSPEND_STANDBY:
        val |= PMU_CTRL_SUSPEND_MODE_STANDBY;
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> PM_SUSPEND_MEM:
        val |= PMU_CTRL_SUSPEND_MODE_MEM;
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
        ret = -EINVAL;
        <span class="hljs-keyword">goto</span> out;
    }
    writel(val, pmu_base + PMU_CTRL);
    
    <span class="hljs-comment">// 2. é…ç½®å”¤é†’æº</span>
    val = readl(pmu_base + PMU_WAKEUP_MASK);
    val |= (<span class="hljs-number">1</span> &lt;&lt; WAKEUP_SOURCE_POWER_BUTTON);
    val |= (<span class="hljs-number">1</span> &lt;&lt; WAKEUP_SOURCE_RTC);
    val |= (<span class="hljs-number">1</span> &lt;&lt; WAKEUP_SOURCE_GPIO);
    writel(val, pmu_base + PMU_WAKEUP_MASK);
    
    <span class="hljs-comment">// 3. é…ç½®ç”µå‹å’Œé¢‘ç‡</span>
    val = readl(pmu_base + PMU_VOLTAGE_CTRL);
    val &amp;= ~PMU_VOLTAGE_CTRL_VOLTAGE_MASK;
    val |= PMU_VOLTAGE_CTRL_VOLTAGE_LOW;
    writel(val, pmu_base + PMU_VOLTAGE_CTRL);
    
    val = readl(pmu_base + PMU_FREQ_CTRL);
    val &amp;= ~PMU_FREQ_CTRL_FREQ_MASK;
    val |= PMU_FREQ_CTRL_FREQ_LOW;
    writel(val, pmu_base + PMU_FREQ_CTRL);
    
    <span class="hljs-comment">// 4. åˆ·æ–°ç¼“å­˜</span>
    flush_cache_all();
    dsb(sy);
    isb();
    
    <span class="hljs-comment">// 5. ç¦ç”¨ä¸­æ–­ï¼ˆé™¤äº†å”¤é†’ä¸­æ–­ï¼‰</span>
    local_irq_disable();
    
    <span class="hljs-comment">// 6. è¿›å…¥ä¼‘çœ </span>
    val = readl(pmu_base + PMU_CTRL);
    val |= PMU_CTRL_SUSPEND_ENABLE;
    writel(val, pmu_base + PMU_CTRL);
    
    <span class="hljs-comment">// 7. æ‰§è¡Œ WFI</span>
    <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(<span class="hljs-string">"wfi"</span> ::: <span class="hljs-string">"memory"</span>)</span>;
    
    <span class="hljs-comment">// 8. å¦‚æœè¿”å›ï¼Œæ¢å¤ç”µå‹å’Œé¢‘ç‡</span>
    val = readl(pmu_base + PMU_VOLTAGE_CTRL);
    val &amp;= ~PMU_VOLTAGE_CTRL_VOLTAGE_MASK;
    val |= PMU_VOLTAGE_CTRL_VOLTAGE_NORMAL;
    writel(val, pmu_base + PMU_VOLTAGE_CTRL);
    
    val = readl(pmu_base + PMU_FREQ_CTRL);
    val &amp;= ~PMU_FREQ_CTRL_FREQ_MASK;
    val |= PMU_FREQ_CTRL_FREQ_NORMAL;
    writel(val, pmu_base + PMU_FREQ_CTRL);
    
    <span class="hljs-comment">// 9. æ¢å¤ä¸­æ–­</span>
    local_irq_enable();
    
out:
    iounmap(pmu_base);
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h3 data-id="heading-35">16.16 å”¤é†’åçš„ç³»ç»Ÿæ¢å¤é¡ºåº</h3>
<p><strong>ç³»ç»Ÿæ¢å¤çš„è¯¦ç»†é¡ºåº</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_enter</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state, <span class="hljs-type">bool</span> *wakeup)</span>
{
    <span class="hljs-comment">// ... suspend æµç¨‹ ...</span>
    
    <span class="hljs-comment">// ä»ä¼‘çœ çŠ¶æ€è¿”å›åï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ¢å¤ï¼š</span>
    
    <span class="hljs-comment">// 1. å¹³å°ç‰¹å®šçš„æ¢å¤ï¼ˆnoirq é˜¶æ®µï¼Œä¸­æ–­ä»ç¦ç”¨ï¼‰</span>
    platform_resume_noirq(state);
    
    <span class="hljs-comment">// 2. è®¾å¤‡æ¢å¤ï¼ˆnoirq é˜¶æ®µï¼‰</span>
    dpm_resume_noirq(*wakeup ? PMSG_RESUME : PMSG_RESTORE);
    
    <span class="hljs-comment">// 3. å¹³å°ç‰¹å®šçš„æ¢å¤ï¼ˆearly é˜¶æ®µï¼‰</span>
    platform_resume_early(state);
    
    <span class="hljs-comment">// 4. è®¾å¤‡æ¢å¤ï¼ˆearly é˜¶æ®µï¼‰</span>
    dpm_resume_early(*wakeup ? PMSG_RESUME : PMSG_RESTORE);
    
    <span class="hljs-comment">// 5. å¹³å°ç‰¹å®šçš„æ¢å¤ï¼ˆfinish é˜¶æ®µï¼‰</span>
    platform_resume_finish(state);
    
    <span class="hljs-comment">// 6. æ¢å¤ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡</span>
    syscore_resume();
    
    <span class="hljs-comment">// 7. æ¢å¤ä¸­æ–­</span>
    arch_suspend_enable_irqs();
    
    <span class="hljs-comment">// 8. å¯ç”¨ä» CPU</span>
    suspend_enable_secondary_cpus();
    
    <span class="hljs-comment">// 9. æ¢å¤æ§åˆ¶å°</span>
    resume_console();
    
    <span class="hljs-comment">// 10. è§£å†»è¿›ç¨‹</span>
    pm_suspend_thaw();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>å¹³å° resume_noirq çš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// arch/arm64/mach-xxx/pm.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">platform_resume_noirq</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">void</span> __iomem *pmu_base = ioremap(PMU_BASE, SZ_4K);
    u32 val;
    
    <span class="hljs-comment">// 1. é€€å‡ºä½åŠŸè€—æ¨¡å¼</span>
    val = readl(pmu_base + PMU_CTRL);
    val &amp;= ~PMU_CTRL_SUSPEND_ENABLE;
    writel(val, pmu_base + PMU_CTRL);
    
    <span class="hljs-comment">// 2. æ¢å¤åŸºæœ¬æ—¶é’Ÿ</span>
    clk_prepare_enable(cpu_clk);
    clk_prepare_enable(system_clk);
    
    <span class="hljs-comment">// 3. æ¢å¤åŸºæœ¬ç”µæº</span>
    regulator_enable(core_regulator);
    
    <span class="hljs-comment">// 4. æ¢å¤ä¸­æ–­æ§åˆ¶å™¨</span>
    gic_resume();
    
    iounmap(pmu_base);
}
</code></pre>
<h3 data-id="heading-36">16.17 è°ƒè¯•å’Œè·Ÿè¸ªæœºåˆ¶</h3>
<p><strong>ä¼‘çœ å”¤é†’çš„è·Ÿè¸ªç‚¹</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// include/trace/events/power.h</span>
TRACE_EVENT(suspend_resume,
    TP_PROTO(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *action, <span class="hljs-type">int</span> val, <span class="hljs-type">bool</span> start),
    TP_ARGS(action, val, start),
    TP_STRUCT__entry(
        __field(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *, action)
        __field(<span class="hljs-type">int</span>, val)
        __field(<span class="hljs-type">bool</span>, start)
    ),
    TP_fast_assign(
        __entry-&gt;action = action;
        __entry-&gt;val = val;
        __entry-&gt;start = start;
    ),
    TP_printk(<span class="hljs-string">"%s[%d] %s"</span>, __entry-&gt;action, __entry-&gt;val,
              __entry-&gt;start ? <span class="hljs-string">"begin"</span> : <span class="hljs-string">"end"</span>)
);
</code></pre>
<p><strong>ä½¿ç”¨ ftrace è·Ÿè¸ªä¼‘çœ æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¯ç”¨ PM è·Ÿè¸ª</span>
<span class="hljs-built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/events/power/enable

<span class="hljs-comment"># 2. å¯ç”¨å‡½æ•°è·Ÿè¸ª</span>
<span class="hljs-built_in">echo</span> <span class="hljs-keyword">function</span> &gt; /sys/kernel/debug/tracing/current_tracer
<span class="hljs-built_in">echo</span> pm_suspend &gt; /sys/kernel/debug/tracing/set_ftrace_filter
<span class="hljs-built_in">echo</span> suspend_enter &gt;&gt; /sys/kernel/debug/tracing/set_ftrace_filter

<span class="hljs-comment"># 3. å¼€å§‹è·Ÿè¸ª</span>
<span class="hljs-built_in">echo</span> 1 &gt; /sys/kernel/debug/tracing/tracing_on

<span class="hljs-comment"># 4. è§¦å‘ä¼‘çœ </span>
<span class="hljs-built_in">echo</span> mem &gt; /sys/power/state

<span class="hljs-comment"># 5. æŸ¥çœ‹è·Ÿè¸ªç»“æœ</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/tracing/trace
</code></pre>
<h3 data-id="heading-37">16.18 é”™è¯¯æ¢å¤æœºåˆ¶</h3>
<p><strong>ä¼‘çœ å¤±è´¥æ—¶çš„æ¢å¤</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel/power/suspend.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">enter_state</span><span class="hljs-params">(<span class="hljs-type">suspend_state_t</span> state)</span>
{
    <span class="hljs-type">int</span> error;
    
    <span class="hljs-comment">// ... ä¼‘çœ æµç¨‹ ...</span>
    
    <span class="hljs-comment">// å¦‚æœä»»ä½•é˜¶æ®µå¤±è´¥ï¼Œæ‰§è¡Œæ¢å¤</span>
    <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-comment">// 1. æ¢å¤è®¾å¤‡</span>
        dpm_resume_noirq(PMSG_RESTORE);
        dpm_resume_early(PMSG_RESTORE);
        dpm_resume(PMSG_RESTORE);
        
        <span class="hljs-comment">// 2. è§£å†»è¿›ç¨‹</span>
        pm_suspend_thaw();
        
        <span class="hljs-comment">// 3. æ¢å¤æ§åˆ¶å°</span>
        resume_console();
        
        <span class="hljs-comment">// 4. æ¢å¤å¹³å°</span>
        <span class="hljs-keyword">if</span> (suspend_ops &amp;&amp; suspend_ops-&gt;recover)
            suspend_ops-&gt;recover();
    }
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<p><strong>è®¾å¤‡ suspend å¤±è´¥çš„å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// drivers/base/power/main.c</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">device_suspend</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-type">pm_message_t</span> state)</span>
{
    <span class="hljs-type">int</span> error = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 1. è°ƒç”¨è®¾å¤‡çš„ suspend å›è°ƒ</span>
    error = dpm_run_callback(callback, dev, state, info);
    
    <span class="hljs-comment">// 2. å¦‚æœå¤±è´¥ï¼Œè®°å½•é”™è¯¯å¹¶æ¢å¤</span>
    <span class="hljs-keyword">if</span> (error) {
        pm_dev_err(dev, state, info, error);
        dpm_save_failed_dev(dev_name(dev));
        
        <span class="hljs-comment">// 3. æ¢å¤å·² suspend çš„è®¾å¤‡</span>
        device_resume(dev, state, <span class="hljs-literal">true</span>);
    }
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue ç»„ä»¶ä¸åŸå‹é“¾ï¼šVueComponent ä¸ Vue çš„å…³ç³»è§£æ]]></title>    <link>https://juejin.cn/post/7584472215975133199</link>    <guid>https://juejin.cn/post/7584472215975133199</guid>    <pubDate>2025-12-17T08:22:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215975133199" data-draft-id="7584639987212206114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue ç»„ä»¶ä¸åŸå‹é“¾ï¼šVueComponent ä¸ Vue çš„å…³ç³»è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Vue.js"/> <meta itemprop="datePublished" content="2025-12-17T08:22:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¿›å‡»çš„é‡äºº"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue ç»„ä»¶ä¸åŸå‹é“¾ï¼šVueComponent ä¸ Vue çš„å…³ç³»è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¿›å‡»çš„é‡äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:22:03.000Z" title="Wed Dec 17 2025 08:22:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€VueComponent çš„æœ¬è´¨</h2>
<p>ä»Â <code>4.VueComponent.html</code>Â ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Vue ç»„ä»¶çš„æ ¸å¿ƒæ¦‚å¿µï¼š</p>
<h3 data-id="heading-1">1. VueComponent çš„æ„é€ å‡½æ•°</h3>
<p>ç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåä¸ºÂ <code>VueComponent</code>Â çš„æ„é€ å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸æ˜¯ç”±ç¨‹åºå‘˜ç›´æ¥å®šä¹‰çš„ï¼Œè€Œæ˜¯é€šè¿‡Â <code>Vue.extend()</code>Â æ–¹æ³•ç”Ÿæˆçš„ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ Vue æ¡†æ¶å†…éƒ¨å®Œæˆçš„ï¼Œå¼€å‘è€…åªéœ€å…³æ³¨ç»„ä»¶çš„é…ç½®ã€‚</p>
<h3 data-id="heading-2">2. ç»„ä»¶çš„å®ä¾‹åŒ–è¿‡ç¨‹</h3>
<p>å½“æˆ‘ä»¬ä½¿ç”¨Â <code>&lt;school&gt;&lt;/school&gt;</code>Â è¿™æ ·çš„æ ‡ç­¾æ—¶ï¼ŒVue åœ¨è§£ææ¨¡æ¿æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥ç»„ä»¶çš„å®ä¾‹å¯¹è±¡ã€‚å®é™…ä¸Šï¼ŒVue åœ¨èƒŒåæ‰§è¡Œäº†Â <code>new VueComponent(options)</code>Â çš„æ“ä½œã€‚</p>
<h3 data-id="heading-3">3. æ¯æ¬¡éƒ½æ˜¯å…¨æ–°çš„ç»„ä»¶</h3>
<p>ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚æ˜¯ï¼š<strong>æ¯æ¬¡è°ƒç”¨Â <code>Vue.extend()</code>Â è¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªå…¨æ–°çš„Â <code>VueComponent</code>Â æ„é€ å‡½æ•°</strong>ã€‚è¿™æ„å‘³ç€å³ä½¿ä½¿ç”¨ç›¸åŒçš„é…ç½®å¤šæ¬¡è°ƒç”¨Â <code>Vue.extend()</code>ï¼Œä¹Ÿä¼šå¾—åˆ°ä¸åŒçš„ç»„ä»¶æ„é€ å‡½æ•°ã€‚</p>
<h3 data-id="heading-4">4. this æŒ‡å‘çš„å·®å¼‚</h3>
<p>Vue ä¸­æœ‰ä¸¤ç§ä¸åŒçš„ this ä¸Šä¸‹æ–‡ï¼š</p>
<ul>
<li>
<p><strong>ç»„ä»¶é…ç½®ä¸­</strong>ï¼ˆé€šè¿‡Â <code>Vue.extend</code>Â åˆ›å»ºçš„ç»„ä»¶ï¼‰ï¼š</p>
<ul>
<li><code>data()</code>Â å‡½æ•°ã€<code>methods</code>Â ä¸­çš„å‡½æ•°ã€<code>watch</code>Â ä¸­çš„å‡½æ•°</li>
<li>å®ƒä»¬çš„ this å‡æŒ‡å‘Â <strong>VueComponent å®ä¾‹å¯¹è±¡ï¼ˆvcï¼‰</strong></li>
</ul>
</li>
<li>
<p><strong>Vue æ ¹å®ä¾‹é…ç½®ä¸­</strong>ï¼ˆé€šè¿‡Â <code>new Vue()</code>Â åˆ›å»ºçš„å®ä¾‹ï¼‰ï¼š</p>
<ul>
<li><code>render</code>Â å‡½æ•°ã€<code>computed</code>Â ä¸­çš„å‡½æ•°ã€<code>watch</code>Â ä¸­çš„å‡½æ•°</li>
<li>å®ƒä»¬çš„ this å‡æŒ‡å‘Â <strong>Vue å®ä¾‹å¯¹è±¡ï¼ˆvmï¼‰</strong></li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">5. æœ¯è¯­è¯´æ˜</h3>
<ul>
<li><strong>VueComponent å®ä¾‹å¯¹è±¡</strong>ï¼šç®€ç§°ä¸ºÂ <strong>vc</strong>ï¼ˆç»„ä»¶å®ä¾‹å¯¹è±¡ï¼‰</li>
<li><strong>Vue å®ä¾‹å¯¹è±¡</strong>ï¼šç®€ç§°ä¸ºÂ <strong>vm</strong>ï¼ˆVue æ ¹å®ä¾‹ï¼‰</li>
</ul>
<h2 data-id="heading-6">äºŒã€åŸå‹é“¾çš„é‡è¦å…³ç³»</h2>
<p><code>5.ä¸€ä¸ªé‡è¦çš„å†…ç½®å…³ç³».html</code>Â æ­ç¤ºäº† Vue ç»„ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ï¼š</p>
<h3 data-id="heading-7">1. å…³é”®çš„åŸå‹é“¾å…³ç³»</h3>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">VueComponent.prototype.__proto__</span> === Vue.prototype
</code></pre>
<p>è¿™ä¸ªå…³ç³»æ˜¯ Vue ç»„ä»¶ç³»ç»Ÿçš„åŸºçŸ³ï¼Œå®ƒå»ºç«‹äº†ç»„ä»¶æ„é€ å‡½æ•°ä¸ Vue æ ¹æ„é€ å‡½æ•°ä¹‹é—´çš„åŸå‹é“¾è¿æ¥ã€‚</p>
<h3 data-id="heading-8">2. ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå…³ç³»ï¼Ÿ</h3>
<p>è¿™ä¸ªåŸå‹é“¾å…³ç³»çš„å­˜åœ¨æœ‰é‡è¦æ„ä¹‰ï¼š</p>
<ul>
<li><strong>å…±äº«å±æ€§å’Œæ–¹æ³•</strong>ï¼šè®©æ‰€æœ‰ç»„ä»¶å®ä¾‹å¯¹è±¡ï¼ˆvcï¼‰éƒ½èƒ½è®¿é—®åˆ° Vue åŸå‹ä¸Šå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•</li>
<li><strong>å®ç°ç»§æ‰¿æœºåˆ¶</strong>ï¼šç»„ä»¶å¯ä»¥ç»§æ‰¿ Vue åŸå‹ä¸Šçš„åŠŸèƒ½ï¼Œå¦‚Â <code>$on</code>,Â <code>$emit</code>,Â <code>$nextTick</code>Â ç­‰æ–¹æ³•</li>
<li><strong>ç»Ÿä¸€ API æ¥å£</strong>ï¼šä¿è¯äº†ç»„ä»¶å®ä¾‹ä¸ Vue æ ¹å®ä¾‹åœ¨ä½¿ç”¨ä½“éªŒä¸Šçš„ä¸€è‡´æ€§</li>
</ul>
<h3 data-id="heading-9">3. å®é™…åº”ç”¨ç¤ºä¾‹</h3>
<p>åœ¨ä»£ç ç¤ºä¾‹ä¸­ï¼š</p>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-css" lang="css">const school = Vue<span class="hljs-selector-class">.extend</span>({
  template: `
    &lt;div&gt;
      &lt;h2&gt;å­¦æ ¡åç§°ï¼š{{name}}&lt;/<span class="hljs-selector-tag">h2</span>&gt;
      &lt;<span class="hljs-selector-tag">h2</span>&gt;å­¦æ ¡åœ°å€ï¼š{{<span class="hljs-selector-tag">address</span>}}&lt;/<span class="hljs-selector-tag">h2</span>&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
  `,
  data() {
    return {
      name: <span class="hljs-string">'èŒ¶å•ŠäºŒä¸­'</span>,
      address: <span class="hljs-string">'æ±Ÿè¥¿'</span>
    }
  }
});
</code></pre>
<p>å½“æˆ‘ä»¬ä½¿ç”¨Â <code>&lt;school&gt;&lt;/school&gt;</code>Â ç»„ä»¶æ—¶ï¼š</p>
<ol>
<li>Vue åˆ›å»ºÂ <code>school</code>Â ç»„ä»¶çš„å®ä¾‹ï¼ˆvcï¼‰</li>
<li>é€šè¿‡åŸå‹é“¾Â <code>vc.__proto__.__proto__</code>Â å¯ä»¥è®¿é—®åˆ°Â <code>Vue.prototype</code>Â ä¸Šçš„æ–¹æ³•</li>
<li>å› æ­¤ç»„ä»¶å®ä¾‹ä¹Ÿèƒ½ä½¿ç”¨Â <code>$emit</code>,Â <code>$on</code>Â ç­‰ Vue æä¾›çš„æ–¹æ³•</li>
</ol>
<h2 data-id="heading-10">ä¸‰ã€ç»„ä»¶ç³»ç»Ÿçš„æ•´ä½“æ¶æ„</h2>
<h3 data-id="heading-11">1. æ„é€ å‡½æ•°å…³ç³»å›¾</h3>
<p>text</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">VueComponent</span> (ç»„ä»¶æ„é€ å‡½æ•°)
    â”‚
    â”‚ é€šè¿‡ <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>() åˆ›å»º
    â”‚
    â–¼
<span class="hljs-title class_">VueComponent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
    â”‚
    â”‚ __proto__ æŒ‡å‘
    â”‚
    â–¼
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
    â”‚
    â”‚ __proto__ æŒ‡å‘
    â”‚
    â–¼
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
</code></pre>
<h3 data-id="heading-12">2. å®ä¾‹å¯¹è±¡å…³ç³»å›¾</h3>
<p>text</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-javascript" lang="javascript">vc (ç»„ä»¶å®ä¾‹)
    â”‚
    â”‚ __proto__ æŒ‡å‘
    â”‚
    â–¼
<span class="hljs-title class_">VueComponent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
    â”‚
    â”‚ __proto__ æŒ‡å‘
    â”‚
    â–¼
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
    â”‚
    â”‚ __proto__ æŒ‡å‘
    â”‚
    â–¼
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
</code></pre>
<h2 data-id="heading-13">å››ã€å¼€å‘å®è·µå¯ç¤º</h2>
<h3 data-id="heading-14">1. å…¨å±€æ–¹æ³•çš„å…±äº«</h3>
<p>ç”±äºåŸå‹é“¾å…³ç³»çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å…¬å…±æ–¹æ³•æ·»åŠ åˆ° Vue åŸå‹ä¸Šï¼Œè¿™æ ·æ‰€æœ‰ç»„ä»¶éƒ½èƒ½è®¿é—®ï¼š</p>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Vue æ ¹å®ä¾‹åˆ›å»ºå‰</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$myMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿™æ˜¯ä¸€ä¸ªå…¨å±€æ–¹æ³•'</span>);
}

<span class="hljs-comment">// åœ¨ä»»ä½•ç»„ä»¶ä¸­éƒ½å¯ä»¥ä½¿ç”¨</span>
<span class="hljs-comment">// this.$myMethod()</span>
</code></pre>
<h3 data-id="heading-15">2. ç†è§£ç»„ä»¶çš„ç‹¬ç«‹æ€§</h3>
<p>è™½ç„¶ç»„ä»¶å¯ä»¥é€šè¿‡åŸå‹é“¾è®¿é—® Vue çš„åŸå‹æ–¹æ³•ï¼Œä½†æ¯ä¸ªç»„ä»¶å®ä¾‹ä»ç„¶æ˜¯ç‹¬ç«‹çš„ï¼š</p>
<ul>
<li>æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„æ•°æ®ï¼ˆé€šè¿‡Â <code>data()</code>Â è¿”å›ï¼‰</li>
<li>æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>ç»„ä»¶é—´çš„æ•°æ®é»˜è®¤æ˜¯éš”ç¦»çš„</li>
</ul>
<h3 data-id="heading-16">3. é¿å…æ··æ·† this ä¸Šä¸‹æ–‡</h3>
<p>åœ¨å¼€å‘ä¸­éœ€è¦æ³¨æ„ä¸åŒä¸Šä¸‹æ–‡ä¸­ this çš„æŒ‡å‘ï¼š</p>
<ul>
<li>åœ¨ç»„ä»¶æ–¹æ³•ä¸­ï¼Œthis æŒ‡å‘å½“å‰ç»„ä»¶å®ä¾‹ï¼ˆvcï¼‰</li>
<li>åœ¨æ ¹å®ä¾‹æ–¹æ³•ä¸­ï¼Œthis æŒ‡å‘ Vue æ ¹å®ä¾‹ï¼ˆvmï¼‰</li>
<li>ç®­å¤´å‡½æ•°ä¼šæ”¹å˜ this çš„ç»‘å®šï¼Œéœ€è¦è°¨æ…ä½¿ç”¨</li>
</ul>
<h2 data-id="heading-17">äº”ã€æ€»ç»“</h2>
<p>Vue çš„ç»„ä»¶ç³»ç»Ÿé€šè¿‡å·§å¦™çš„åŸå‹é“¾è®¾è®¡ï¼Œå®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<ol>
<li><strong>ç»„ä»¶å¤ç”¨æ€§</strong>ï¼šé€šè¿‡Â <code>Vue.extend()</code>Â å¯ä»¥è½»æ¾åˆ›å»ºå¯å¤ç”¨çš„ç»„ä»¶</li>
<li><strong>åŠŸèƒ½ç»§æ‰¿æ€§</strong>ï¼šç»„ä»¶å¯ä»¥ç»§æ‰¿ Vue åŸå‹ä¸Šçš„åŠŸèƒ½ï¼Œå‡å°‘ä»£ç é‡å¤</li>
<li><strong>æ¶æ„ä¸€è‡´æ€§</strong>ï¼šä¿æŒäº†ç»„ä»¶å®ä¾‹ä¸æ ¹å®ä¾‹åœ¨ä½¿ç”¨ä¸Šçš„ä¸€è‡´æ€§</li>
<li><strong>ç³»ç»Ÿæ‰©å±•æ€§</strong>ï¼šä¾¿äºæ·»åŠ å…¨å±€åŠŸèƒ½å’Œæ–¹æ³•</li>
</ol>
<p>ç†è§£Â <code>VueComponent.prototype.__proto__ === Vue.prototype</code>Â è¿™ä¸€å…³ç³»ï¼Œæ˜¯æ·±å…¥æŒæ¡ Vue ç»„ä»¶æœºåˆ¶çš„å…³é”®ã€‚è¿™ä¸ä»…å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨ Vueï¼Œä¹Ÿä¸ºç†è§£å…¶ä»–ç±»ä¼¼æ¡†æ¶çš„è®¾è®¡åŸç†æä¾›äº†æ€è·¯ã€‚</p>
<p>è¿™ç§åŸå‹é“¾è®¾è®¡æ¨¡å¼ä½“ç°äº† JavaScript åŸå‹ç»§æ‰¿çš„ä¼˜é›…ä¹‹å¤„ï¼Œä¹Ÿæ˜¯ Vue æ¡†æ¶è®¾è®¡ç²¾å¦™çš„ä¸€ä¸ªä¾‹è¯ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒVue åœ¨ä¿æŒç»„ä»¶ç‹¬ç«‹æ€§çš„åŒæ—¶ï¼Œå®ç°äº†åŠŸèƒ½çš„å…±äº«å’Œç»§æ‰¿ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ç»„ä»¶ç³»ç»Ÿã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰‹å†™ Linux å¹¶å‘æœåŠ¡å™¨ï¼Œforkï¼Œ pthreadä¸ epoll æ¨¡å‹å®æˆ˜ï¼ˆåŒ…å«æ·±å±‚åŸç†å‰–æï¼‰]]></title>    <link>https://juejin.cn/post/7584567736186929190</link>    <guid>https://juejin.cn/post/7584567736186929190</guid>    <pubDate>2025-12-17T08:11:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584567736186929190" data-draft-id="7584725608866578458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰‹å†™ Linux å¹¶å‘æœåŠ¡å™¨ï¼Œforkï¼Œ pthreadä¸ epoll æ¨¡å‹å®æˆ˜ï¼ˆåŒ…å«æ·±å±‚åŸç†å‰–æï¼‰"/> <meta itemprop="keywords" content="GitHub,C"/> <meta itemprop="datePublished" content="2025-12-17T08:11:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰‹å†™ Linux å¹¶å‘æœåŠ¡å™¨ï¼Œforkï¼Œ pthreadä¸ epoll æ¨¡å‹å®æˆ˜ï¼ˆåŒ…å«æ·±å±‚åŸç†å‰–æï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:11:21.000Z" title="Wed Dec 17 2025 08:11:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»30åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. æœ€ç®€å•çš„æœåŠ¡å™¨æ¨¡å‹</h2>
<p>åœ¨å­¦ä¹  Linux ç½‘ç»œç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ¥è§¦çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨æ¨¡å‹ï¼Œå°±æ˜¯<strong>å•çº¿ç¨‹é˜»å¡æ¨¡å‹</strong>ã€‚åªçœ‹å®ƒçš„åå­—å…¶å®å·²ç»èƒ½å¤Ÿæ˜ç™½è¿™ä¸ªæ¨¡å‹çš„åŸç†äº†ï¼Œå®ƒçš„é€»è¾‘ç®€å•æ¸…æ™°ï¼šå…ˆåˆ›å»ºä¸€ä¸ª <code>socket</code>ï¼Œå†ç»‘å®šç«¯å£ï¼Œç„¶åç›‘å¬ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­»å¾ªç¯é‡Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚</p>
<h3 data-id="heading-1">1.1 å•çº¿ç¨‹é˜»å¡<code>echo</code>æœåŠ¡å™¨</h3>
<p>æˆ‘ä»¬å…ˆæ¥å†™ä¸€ä¸ªæœ€æœ€åŸºç¡€çš„ echo æœåŠ¡å™¨ï¼Œå®ƒçš„åŠŸèƒ½éå¸¸ç®€å•ï¼šå°±æ˜¯æŠŠå®¢æˆ·ç«¯å‘æ¥çš„ä»»ä½•æ¶ˆæ¯åŸå°ä¸åŠ¨åœ°å†å‘å›å»ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå«ä»–<strong>echoæœåŠ¡å™¨</strong>çš„åŸå› ã€‚</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PORT 8080</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span>
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
 Â  Â <span class="hljs-type">int</span> listen_fd, conn_fd;
 Â  Â <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">serv_addr</span>;</span>
 Â  Â <span class="hljs-type">char</span> buffer[BUFFER_SIZE];
â€‹
 Â  Â listen_fd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
 Â  Â <span class="hljs-keyword">if</span>(listen_fd == <span class="hljs-number">-1</span>)
 Â   {
 Â  Â  Â  Â perror(<span class="hljs-string">"socket listen"</span>);
 Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-type">int</span> opt = <span class="hljs-number">1</span>;
 Â  Â setsockopt(listen_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, <span class="hljs-keyword">sizeof</span>(opt));<span class="hljs-comment">//è®¾ç½®ç«¯å£å¯å¤ç”¨</span>
 Â  Â 
 Â  Â <span class="hljs-built_in">memset</span>(&amp;serv_addr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(serv_addr));
 Â  Â serv_addr.sin_family = AF_INET;
 Â  Â serv_addr.sin_addr.s_addr = htonl(INADDR_ANY);
 Â  Â serv_addr.sin_port = htons(PORT);
 Â  Â 
 Â  Â <span class="hljs-keyword">if</span>(bind(listen_fd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;serv_addr, <span class="hljs-keyword">sizeof</span>(serv_addr)) == <span class="hljs-number">-1</span>)
 Â   {
 Â  Â  Â  Â perror(<span class="hljs-string">"bind"</span>);
 Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-keyword">if</span>(listen(listen_fd, <span class="hljs-number">5</span>) == <span class="hljs-number">-1</span>)
 Â   {
 Â  Â  Â  Â perror(<span class="hljs-string">"listen"</span>);
 Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥...\n"</span>);
â€‹
 Â  Â conn_fd = accept(listen_fd, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<span class="hljs-comment">//é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯é“¾æ¥</span>
 Â  Â <span class="hljs-keyword">if</span>(conn_fd == <span class="hljs-number">-1</span>)
 Â   {
 Â  Â  Â  Â perror(<span class="hljs-string">"accept"</span>);
 Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
 Â   }
 Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å®¢æˆ·ç«¯å·²è¿æ¥\n"</span>);
â€‹
 Â  Â <span class="hljs-type">ssize_t</span> n;
 Â  Â <span class="hljs-keyword">while</span> ((n = read(conn_fd, buffer, BUFFER_SIZE)) &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">//è¿™é‡Œæ˜¯é˜»å¡çš„</span>
 Â   {
 Â  Â  Â  Â write(conn_fd, buffer, n);<span class="hljs-comment">//å›å†™</span>
 Â   }
â€‹
 Â  Â close(conn_fd);
 Â  Â close(listen_fd);
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>è¿™æ®µä»£ç è™½ç„¶ç®€å•ï¼Œä½†å®ƒå®Œæ•´åœ°å±•ç¤ºäº† Linux TCP æœåŠ¡å™¨çš„ç»å…¸çš„äº”ä¸ªæ­¥éª¤ï¼š<code>socket</code> -&gt; <code>bind</code> -&gt; <code>listen</code> -&gt; <code>accept</code> -&gt; <code>read/write</code>ã€‚</p>
<p>å…¶ä¸­è¿˜æœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„ç»†èŠ‚ï¼Œæˆ‘ç®€å•è¯´ä¸€ä¸‹ï¼š</p>
<p>ç¬¬ä¸€ä¸ªç»†èŠ‚ï¼š<strong>ç«¯å£å¤ç”¨</strong>ã€‚åœ¨<code>socket</code>ä¹‹åï¼Œæˆ‘åŠ å…¥äº†<code>setsockopt(listen_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, sizeof(opt));</code> ã€‚è¿™ä¸€æ­¥è‡³å…³é‡è¦ï¼Œå®ƒå…è®¸æˆ‘ä»¬çš„æœåŠ¡å™¨åœ¨å¼‚å¸¸é€€å‡ºåï¼Œèƒ½å¤Ÿ<strong>ç«‹å³é‡å¯</strong>å¹¶é‡æ–°ç»‘å®š 8080 ç«¯å£ï¼Œè€Œä¸ä¼šé‡åˆ° <code>"Address already in use"</code> çš„é”™è¯¯ã€‚è¿™æ˜¯æ‰€æœ‰æœåŠ¡å™¨çš„<strong>å¿…å¤‡é…ç½®</strong>ã€‚</p>
<p>ç¬¬äºŒä¸ªç»†èŠ‚ï¼šç½‘ç»œå­—èŠ‚åºã€‚åœ¨å¡«å……åœ°å€ç»“æ„ä½“<code>serv_addr</code>æ—¶ï¼Œ<code>PORT</code> å’Œ <code>INADDR_ANY</code> éƒ½è¦è¢« <code>htons/htonl</code> å‡½æ•°å¤„ç†ã€‚è¿™æ˜¯ä¸ºäº†è§£å†³<strong>å¤§å°ç«¯</strong>é—®é¢˜ã€‚ä¸åŒæ¶æ„çš„ CPU å­˜å‚¨å¤šå­—èŠ‚æ•´æ•°çš„é¡ºåºå¯èƒ½ä¸åŒã€‚TCP/IP åè®®æ ˆè§„å®šäº†ç»Ÿä¸€çš„<strong>ç½‘ç»œå­—èŠ‚åºï¼ˆå¤§ç«¯ï¼‰</strong> ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥ä¿è¯æˆ‘ä»¬çš„æ•°æ®ç¬¦åˆæ ‡å‡†ï¼Œé¿å…è·¨å¹³å°é€šä¿¡æ—¶å‡ºç°æ•°æ®è§£æé”™è¯¯ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªç»†èŠ‚ï¼šè¿™ä¸ªæ¨¡å‹æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯<strong>é˜»å¡</strong>ã€‚ç¨‹åºé¦–å…ˆä¼šé˜»å¡åœ¨ <code>accept()</code>ï¼Œç­‰å¾…ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚è¿æ¥æˆåŠŸåï¼Œç¨‹åºä¼šè¿›å…¥ <code>while</code> å¾ªç¯ï¼Œé˜»å¡åœ¨ <code>read()</code>ï¼Œç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚æ­£æ˜¯è¿™ä¸¤ä¸ªé˜»å¡ç‚¹ï¼Œå¯¼è‡´äº†å®ƒ<strong>ä¸€æ¬¡åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ç«¯</strong>çš„è‡´å‘½ç¼ºé™·ï¼Œä¹Ÿä¸ºæˆ‘ä»¬åç»­çš„å¹¶å‘æ¨¡å‹æ–¹å‘åŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p>
<p>æ­¤å¤–ï¼Œä¸ºäº†å±•ç¤ºæœ€ç®€å•çš„æœåŠ¡å™¨çš„åŠŸèƒ½åˆ°åº•æœ‰å¤šä¹ˆç²—ç³™ï¼Œæˆ‘ç‰¹æ„å°† <code>accept()</code> å‡½æ•°æ”¾åœ¨å¾ªç¯å¤–é¢ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œè¿™ä¸ªæœåŠ¡å™¨ä¸€ç”Ÿåªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå½“è¿™ä¸ªå®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨çš„è¿è¡Œä¹Ÿä¼šç»“æŸã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæœ€ç®€å•çš„æœåŠ¡å™¨åˆ°åº•éƒ½æœ‰å“ªäº›ç¼ºé™·ã€‚</p>
<h3 data-id="heading-2">1.2 å®éªŒï¼šè‡´å‘½çš„ç“¶é¢ˆ</h3>
<p>è¿™ä¸ªæœåŠ¡å™¨çœ‹èµ·æ¥æ˜¯èƒ½è·‘çš„ï¼Œä½†ä»–æœ‰ä¸€ä¸ªè‡´å‘½çš„<strong>ç¼ºé™·</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„å®éªŒæ¥çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17bff1bfabcc4f3a9fb80c74a9ec40ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=pO9DvC2vkuVZQLVyfd9lIJ9iB0Y%3D" alt="1. å•çº¿ç¨‹é˜»å¡è¿è¡Œç»“æœ.png" loading="lazy"/></p>
<p>å…ˆè¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ç¨‹åºï¼Œå°±ä¼šæ˜¾ç¤º â€œæœåŠ¡å™¨å·²å¯åŠ¨.....â€ è¿™äº›å­—ï¼Œç„¶åå†å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">telnet localhost 8080
</code></pre>
<p>å°±ä¼šæ˜¾ç¤º â€œå®¢æˆ·ç«¯å·²è¿æ¥â€ ã€‚æ­¤æ—¶æˆ‘åœ¨å®¢æˆ·ç«¯è¾“å…¥ä¸€ä¸ª â€œhelloâ€ ï¼Œç„¶åæŒ‰å›è½¦ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ° â€œhelloâ€ ä¹‹ååˆæŠŠä»–<strong>åŸå°ä¸åŠ¨çš„å‘å›ç»™å®¢æˆ·ç«¯</strong>äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9633c8fc51af4047a5ba06959e3c9b79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=UdsmjdL1oVlN04YNy%2BEsWd0RXAc%3D" alt="2. å•çº¿ç¨‹é˜»å¡è¿è¡Œç»“æœï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<p>åˆ°è¿™é‡Œï¼Œå•çº¿ç¨‹é˜»å¡<code>echo</code>æœåŠ¡å™¨çš„åŠŸèƒ½å°±å·²ç»çœ‹åˆ°äº†ã€‚ä½†å¦‚æœæˆ‘ä»¬å†å¼€ä¸€ä¸ªç»ˆç«¯å°è¯•è¿æ¥æœåŠ¡å™¨å‘¢ï¼Ÿä¼šå‘ç”Ÿä»€ä¹ˆäº‹ï¼Ÿ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf7c75df3bcd41a0a5e7f34fb65c8a53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=3hz9LD2KXHwob1vlTkhP4FkJF78%3D" alt="3. å•çº¿ç¨‹é˜»å¡è¿è¡Œç»“æœï¼ˆ3ï¼‰.png" loading="lazy"/></p>
<p>è¿™é‡Œï¼Œæˆ‘åˆå¼€äº†ä¸€ä¸ªç»ˆç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå¦‚æœå°è¯•è¿‡çš„è¯»è€…ä¼šå‘ç°è¿™æ¬¡æœåŠ¡å™¨çš„é‚£ä¸ªç»ˆç«¯<strong>å¹¶æ²¡æœ‰å¼¹å‡º â€œå®¢æˆ·ç«¯å·²è¿æ¥â€</strong> è¿™ä¸ªè¡¨ç¤ºé“¾æ¥æˆåŠŸçš„æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œè¿˜èƒ½å‘ç°åœ¨è¿™ä¸ªæ–°å¼€çš„ç»ˆç«¯è¿æ¥æœåŠ¡å™¨ï¼Œçœ‹ä¼¼å’Œå‰é¢é‚£ä¸ªå®¢æˆ·ç«¯æ˜¯ç›¸åŒçš„åœºæ™¯ï¼Œä½†æˆ‘ä»¬åœ¨è¾“å…¥ â€œhelloâ€ å¹¶æŒ‰ä¸‹å›è½¦åï¼ŒæœåŠ¡å™¨å¹¶æ²¡æœ‰è¿”å›æ¶ˆæ¯ã€‚è¿™å·²ç»èƒ½å¤Ÿè¯æ˜æˆ‘ä»¬åœ¨è¿™ä¸ªç»ˆç«¯ä¸Šå…¶å®å¹¶<strong>æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡å™¨</strong>ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</strong></p>
<p>è¿™é‡Œæš´éœ²äº†ä¸¤ä¸ª<strong>è‡´å‘½é—®é¢˜</strong>ï¼š</p>
<p>ç¬¬ä¸€æ˜¯<strong>æ— æ³•å¹¶å‘</strong>ï¼šæœåŠ¡å™¨çš„ä¸»çº¿ç¨‹åœ¨ <code>accept</code> ä¹‹åï¼Œå°±ä¸€å¤´æ‰è¿›äº†ä¸<strong>ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯</strong>é€šä¿¡çš„ <code>while</code> å¾ªç¯é‡Œã€‚åªè¦è¿™ä¸ªå®¢æˆ·ç«¯ä¸ä¸»åŠ¨æ–­å¼€ï¼Œç¨‹åºå°±æ°¸è¿œæ²¡æœ‰æœºä¼šå»å¤„ç†æ–°çš„è¿æ¥è¯·æ±‚ã€‚</p>
<p>ç¬¬äºŒæ˜¯<strong>ä¸€æ¬¡æ€§æœåŠ¡</strong>ï¼šæ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¸€æ—¦ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œ<code>while</code> å¾ªç¯ç»“æŸï¼Œæ•´ä¸ªæœåŠ¡å™¨ç¨‹åºä¹Ÿä¼šè·Ÿç€é€€å‡ºã€‚</p>
<p>è¿™ç§<strong>å•çº¿ç¨‹ã€å•ä»»åŠ¡ã€ä¸€æ¬¡æ€§</strong>çš„æ¨¡å‹ï¼Œåœ¨ä»»ä½•å®é™…åº”ç”¨ä¸­éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚æˆ‘ä»¬éœ€è¦è®©æœåŠ¡å™¨ï¼š<strong>èƒ½åŒæ—¶æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ (å¹¶å‘)</strong> ï¼Œ<strong>è¿˜èƒ½ 7x24 å°æ—¶è¿è¡Œï¼Œè€Œä¸æ˜¯æœåŠ¡å®Œä¸€ä¸ªå°±é€€å‡º</strong>ã€‚</p>
<h2 data-id="heading-3">2. å¤šè¿›ç¨‹æ¨¡å‹</h2>
<p>ä¸ºäº†è§£å†³å•çº¿ç¨‹æ¨¡å‹çš„<strong>ä¸¤å¤§ç¼ºé™·</strong>ï¼Œæˆ‘ä»¬è‡ªç„¶è€Œç„¶åœ°æƒ³åˆ°äº† Linux æä¾›çš„å¤šä»»åŠ¡æœºåˆ¶ã€‚æœ€ç»å…¸ã€æœ€ç®€å•çš„å°±æ˜¯<strong>å¤šè¿›ç¨‹</strong>ã€‚</p>
<h3 data-id="heading-4">2.1 æ”¹è¿›æ€è·¯</h3>
<p>å‰é¢çš„<strong>å•çº¿ç¨‹é˜»å¡</strong>æ¨¡å‹é—®é¢˜ä¸»è¦å‡ºåœ¨<strong>æ— æ³•å¹¶å‘</strong>å’Œ<strong>æ— æ³•å¤šæ¬¡æœåŠ¡</strong>ï¼Œå› æ­¤æˆ‘ä»¬ä¸»è¦é’ˆå¯¹è¿™ä¸¤ç‚¹è¿›è¡Œæ”¹è¿›ã€‚</p>
<p>çˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸»è¿›ç¨‹ï¼Œå®ƒåœ¨ä¸€ä¸ª<code>while</code>å¾ªç¯é‡Œé¢ï¼Œä¸»è¦è´Ÿè´£æ¥æ”¶ <code>accept()</code> ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ã€‚</p>
<p>å­è¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯ã€‚</p>
<p>ä»–ä»¬çš„åˆ†å·¥ï¼Œæˆ‘åœ¨è¿™é‡Œç®€è¦æ€»ç»“ä¸€ä¸‹ï¼šçˆ¶è¿›ç¨‹ä¸€æ—¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œç«‹åˆ»<code>fork</code>å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åæŠŠè¿™ä¸ªå®¢æˆ·ç«¯äº¤ç»™å­è¿›ç¨‹å»å¤„ç†ï¼Œçˆ¶è¿›ç¨‹è‡ªå·±ç»§ç»­å»ç­‰å¾…å…¶ä»–å®¢æˆ·ç«¯äº†è¿æ¥ã€‚</p>
<p>ä»è¿™ä¸ªæ”¹è¿›æ€è·¯ä¸Šæ¥çœ‹ï¼Œå·²ç»å®ç°äº†<strong>å¹¶å‘</strong>å’Œ<strong>å¤šæ¬¡æœåŠ¡</strong>çš„ä¸¤ä¸ªç›®æ ‡ã€‚ä¸‹é¢æˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸‹è¿™ä¸ªæ¨¡å‹çš„å®ç°ã€‚</p>
<h3 data-id="heading-5">2.2 å¤šè¿›ç¨‹ echo æœåŠ¡å™¨</h3>
<p>ä¸Šé¢å·²ç»è®²äº†æ”¹è¿›æ€è·¯ï¼Œæˆ‘ä»¬åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è´´å‡ºä»£ç ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PORT 8080</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span>
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> 
{
 Â  Â <span class="hljs-type">int</span> listen_fd, conn_fd;
 Â  Â <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">serv_addr</span>;</span>
 Â  Â <span class="hljs-type">char</span> buffer[BUFFER_SIZE];
 Â  Â <span class="hljs-type">pid_t</span> pid;
â€‹
 Â  Â listen_fd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(listen_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"socket listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
    <span class="hljs-built_in">memset</span>(&amp;serv_addr,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(serv_addr));
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(PORT);
    serv_addr.sin_addr.s_addr = htonl(INADDR_ANY);
 Â  Â 
    <span class="hljs-keyword">if</span>(bind(listen_fd,(<span class="hljs-keyword">struct</span> sockaddr *)&amp;serv_addr,<span class="hljs-keyword">sizeof</span>(serv_addr)) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"bind"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
 Â  Â <span class="hljs-keyword">if</span>(listen(listen_fd, <span class="hljs-number">5</span>) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
 Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥...\n"</span>);
â€‹
 Â  Â <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) 
 Â   { 
 Â  Â  Â  Â conn_fd = accept(listen_fd, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (conn_fd &lt; <span class="hljs-number">0</span>) 
        {
 Â  Â  Â  Â  Â  Â perror(<span class="hljs-string">"accept"</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">continue</span>; <span class="hljs-comment">//å‡ºé”™äº†æ²¡äº‹ï¼Œç»§ç»­ç­‰ä¸‹ä¸€ä¸ª</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â pid = fork();
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">if</span>(pid &lt; <span class="hljs-number">0</span>) 
        {
 Â  Â  Â  Â  Â  Â perror(<span class="hljs-string">"fork"</span>);
 Â  Â  Â  Â  Â  Â close(conn_fd);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">continue</span>;
 Â  Â  Â   }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>) <span class="hljs-comment">//å­è¿›ç¨‹</span>
        {
 Â  Â  Â  Â  Â  Â close(listen_fd); 
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å­è¿›ç¨‹%dä¸ºæ–°å®¢æˆ·ç«¯æœåŠ¡(fd=%d)...\n"</span>, getpid(), conn_fd);
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ssize_t</span> n;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">while</span> (((n = read(conn_fd, buffer, BUFFER_SIZE))) &gt; <span class="hljs-number">0</span>) 
            {
 Â  Â  Â  Â  Â  Â  Â  Â write(conn_fd, buffer, n);<span class="hljs-comment">//å›å†™çš„å­—èŠ‚æ•°ä¸€å®šè¦æ˜¯readè¯»åˆ°çš„å­—èŠ‚æ•°</span>
 Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å®¢æˆ·ç«¯æ–­å¼€ï¼Œå­è¿›ç¨‹%dé€€å‡ºã€‚\n"</span>, getpid());
 Â  Â  Â  Â  Â  Â close(conn_fd);
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); 
 Â  Â  Â   } 
        <span class="hljs-keyword">else</span> 
        {
 Â  Â  Â  Â  Â  Â close(conn_fd); 
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â close(listen_fd); <span class="hljs-comment">// ç†è®ºä¸Šèµ°ä¸åˆ°è¿™é‡Œ,å› ä¸ºçˆ¶è¿›ç¨‹ä¸€ç›´åœ¨å¾ªç¯é‡Œé¢</span>
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
â€‹
</code></pre>
<p>è¿è¡Œä»£ç ï¼Œçœ‹çœ‹æ•ˆæœæ€ä¹ˆæ ·ï¼š</p>
<p>è¿™æ¬¡æˆ‘è¿è¡ŒæœåŠ¡å™¨åï¼Œç›´æ¥å¼€äº†<strong>ä¸‰ä¸ª</strong>ç»ˆç«¯è¿æ¥ä¸ŠæœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨æ‰€åœ¨ç»ˆç«¯å·²ç»å¼¹å‡ºäº†å®¢æˆ·ç«¯<strong>å·²è¿æ¥æˆåŠŸ</strong>çš„æ¶ˆæ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f69ab5c0e3e247f2a35e6872cde93308~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=rpBPqXb7V5Vm6dbxN8zojiEF7C0%3D" alt="4. å¤šè¿›ç¨‹æ¨¡å‹ï¼ˆ1ï¼‰.png" loading="lazy"/></p>
<p>æˆ‘ä»¬åœ¨æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå®¢æˆ·ç«¯çš„æƒ…å†µï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1989bedeaa9249db9ceabbc0713b3547~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=eMfe8IZ2oMWa6ieN%2FMNwVGe5dgM%3D" alt="5. å¤šè¿›ç¨‹æ¨¡å‹ï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b5107009edc4b8c9798a96d78a3d122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=DxIXYyn0k6rs4m%2FfyummWzhv7F0%3D" alt="6. å¤šè¿›ç¨‹æ¨¡å‹ï¼ˆ3ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3a54b4d01f41979ae3634480d64db8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=NbCHOsOtO6bkOSEFRvHtWp4GgTQ%3D" alt="7. å¤šè¿›ç¨‹æ¨¡å‹ï¼ˆ4ï¼‰.png" loading="lazy"/></p>
<p>é€šè¿‡è¿è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸‰ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥æ”¶åˆ°æœåŠ¡å™¨å›ä¼ çš„æ¶ˆæ¯ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»è¾¾åˆ°äº†å¼€å§‹çš„ç›®æ ‡ã€‚</p>
<p>åˆ°è¿™å„¿ï¼Œå¯èƒ½æœ‰äººä¼šæå‡ºé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæœåŠ¡å™¨ç«¯æ˜¾ç¤ºè¿æ¥ä¸Šçš„ä¸‰ä¸ªå®¢æˆ·ç«¯çš„æ–‡ä»¶æè¿°ç¬¦ <code>fd</code> éƒ½æ˜¯ 4 å‘¢ï¼Ÿå…¶å®è¿™å¹¶ä¸æ˜¯å‘ç”Ÿäº†é”™è¯¯ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>æ­£å¸¸ç°è±¡</strong>ï¼Œæ¥å¬æˆ‘è¯¦ç»†è§£é‡Šï¼š</p>
<p>æ ¸ä¼šä¸ºå­è¿›ç¨‹åˆ›å»ºä¸€ä¸ªå‡ ä¹ä¸€æ¨¡ä¸€æ ·çš„å†…å­˜ç©ºé—´å’Œä¸Šä¸‹æ–‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨äºæ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œåœ¨ <code>fork</code> çš„é‚£ä¸€ç¬é—´ï¼Œ<strong>å­è¿›ç¨‹ä¹Ÿå¾—åˆ°äº†å’Œçˆ¶è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</strong>ã€‚</p>
<p>å¥½ï¼Œç†è®ºè®²å®Œäº†ï¼Œæˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸‹è¿‡ç¨‹ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´äº†ä¸‰ä¸ªç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œåœ¨è¿›ç¨‹ä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦çš„ 0ï¼Œ1ï¼Œ2 å·²ç»é»˜è®¤è¢«<strong>æ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯</strong>å æ®äº†ï¼Œè¿™æ—¶ï¼Œè¿›ç¨‹è¿›è¡Œ <code>socket</code> ï¼ŒæŠŠè¿”å›çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯3ï¼‰èµ‹ç»™ <code>listen_fd</code> ã€‚</p>
<p>ç„¶åï¼Œå½“ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨ <code>accept</code> ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ <code>conn_fd</code> ï¼Œç”±äº 3 å·²ç»è¢«å ç”¨äº†ï¼Œæ‰€ä»¥ <code>conn_fd</code> åªèƒ½ä¸º 4ã€‚</p>
<p>ä¹‹åï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨<code>fork</code>åˆ›å»ºç¬¬ä¸€ä¸ªå­è¿›ç¨‹ï¼ˆPIDï¼š11375ï¼‰ï¼Œè¿™ä¸ªå­è¿›ç¨‹<strong>å¾—åˆ°äº†çˆ¶è¿›ç¨‹å®Œæ•´çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</strong>ï¼Œå­è¿›ç¨‹çš„<code>fd=4</code>ä¹ŸæŒ‡å‘äº†<strong>å’Œçˆ¶è¿›ç¨‹ç›¸åŒçš„ TCP è¿æ¥</strong>ã€‚</p>
<p>æ¥ç€ï¼Œ<code>printf("å­è¿›ç¨‹%dä¸ºæ–°å®¢æˆ·ç«¯æœåŠ¡(fd=%d)...\n", getpid(), conn_fd);</code>æ‰“å°å‡ºçš„<code>fd</code>è‡ªç„¶å°±æ˜¯ 4 äº†ï¼Œå› ä¸ºåœ¨çˆ¶è¿›ç¨‹é‚£å°±æ˜¯ 4ï¼Œä»æ¥æ²¡å˜è¿‡ã€‚</p>
<p>å†ç„¶åï¼Œçˆ¶è¿›ç¨‹å…³é—­äº†è‡ªå·±çš„ <code>fd=4</code> ï¼Œå› ä¸ºè¿™å¯¹ä»–æ²¡ç”¨ï¼ŒåŒæ · <code>listen_fd</code>å¯¹å­è¿›ç¨‹ä¹Ÿæ²¡ç”¨ï¼Œæ‰€ä»¥å­è¿›ç¨‹å…³äº† <code>listen_fd</code> ã€‚</p>
<p>è¿™æ—¶ï¼Œå½“ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ï¼ˆPID = 11422ï¼‰è¯·æ±‚è¿æ¥æ—¶ï¼Œçˆ¶è¿›ç¨‹çš„<code>fd=4</code>åˆç©ºå‡ºæ¥äº†ï¼Œäºæ˜¯åœ¨çˆ¶è¿›ç¨‹è¿™é‡Œï¼Œç¬¬äºŒä¸ªå®¢æˆ·ç«¯æœ‰æ‹¿åˆ°äº† <code>fd=4</code> è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åå†æ¬¡<code>fork</code>ï¼Œå­è¿›ç¨‹æ‹¿åˆ°çš„ä¹Ÿæ˜¯æ–‡ä»¶æè¿°ç¬¦<code>fd=4</code>å¯¹åº”çš„ç¬¬äºŒä¸ªå®¢æˆ·ç«¯......</p>
<p>æ‰€ä»¥è¯´ï¼Œçˆ¶è¿›ç¨‹æ¯æ¬¡å°†å®¢æˆ·ç«¯äº¤ç»™å­è¿›ç¨‹åï¼Œå°±ä¼šå…³é—­æ–‡ä»¶æè¿°ç¬¦ 4 ï¼Œè¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ 4 ç©ºé—²å‡ºæ¥ï¼Œä¸‹ä¸€æ¬¡æœ‰å®¢æˆ·ç«¯è¿æ¥ç”¨çš„åˆæ˜¯æ–‡ä»¶æè¿°ç¬¦ 4 ï¼Œå› æ­¤æ‰å¯¼è‡´äº†ä¸Šé¢çš„æƒ…å†µã€‚æ‰€ä»¥è¯´ï¼Œè¿™å…¶å®æ˜¯æ­£å¸¸ç°è±¡ã€‚</p>
<h3 data-id="heading-6">2.3 åƒµå°¸è¿›ç¨‹</h3>
<p>å¤šè¿›ç¨‹æ¨¡å‹å®Œç¾è§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ— æ‡ˆå¯å‡»ã€‚ä½†å®ƒå¼•å…¥äº†ä¸€ä¸ªæ–°çš„ã€æ›´éšè”½çš„ã€å¯èƒ½å¯¼è‡´ä¸¥é‡åæœçš„ä¸œè¥¿â€”â€”<strong>åƒµå°¸è¿›ç¨‹</strong> ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„ç¨‹åºï¼Œå¦‚æœå®¢æˆ·ç«¯æ­£å¸¸æ–­å¼€è¿æ¥ï¼Œé‚£ä¹ˆå¯¹åº”çš„å­è¿›ç¨‹ä¼šæ‰§è¡Œ<code>exit(0)</code>ï¼Œå­è¿›ç¨‹é€€å‡ºåï¼Œå†…æ ¸ä¼šä¿ç•™å®ƒçš„ <strong>PID å’Œé€€å‡ºçŠ¶æ€</strong>ç­‰ä¿¡æ¯ï¼Œç­‰å¾…çˆ¶è¿›ç¨‹è¿‡æ¥æ”¶å°¸ï¼Œä½†æ˜¯ï¼Œçˆ¶è¿›ç¨‹æ­¤æ—¶æ­£å¿™ç€åœ¨<code>while</code>å¾ªç¯é‡Œé¢<code>accept</code>æ–°çš„è¿æ¥ï¼Œå‹æ ¹å°±æ²¡æœ‰æ—¶é—´ã€‚</p>
<p>æœ€åï¼Œè¿™äº›æ— äººè®¤é¢†çš„å°¸ä½“ä¼šè¶Šæ¥è¶Šå¤šï¼Œå †ç§¯åœ¨å†…æ ¸çš„è¿›ç¨‹è¡¨é‡Œã€‚è™½ç„¶å®ƒä»¬ä¸å å¾ˆå¤šå†…å­˜ï¼Œä½†ä¼š<strong>è€—å°½ PID èµ„æº</strong>ã€‚å½“ PID ç”¨å®Œï¼Œç³»ç»Ÿå°†æ— æ³•åˆ›å»ºä»»ä½•æ–°è¿›ç¨‹ï¼Œæœ€ç»ˆåªèƒ½é‡å¯ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹åƒµå°¸è¿›ç¨‹çš„å­˜åœ¨ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/139f323200f143a88cde677e5b7b9f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=G2IXGO7v2zDAoPZsMPIGThTywFU%3D" alt="8. åƒµå°¸è¿›ç¨‹ï¼ˆ1ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30b05ebd7bce4cd08a25099d264f4de5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=Sjjq31ROBhp3j0sD0qFeqZHchf4%3D" alt="9. åƒµå°¸è¿›ç¨‹ï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d20f53a147c4885b2e0b64cb57a843a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=HXIkh%2FZlguFUgue1iU0lCC1k0Cw%3D" alt="10. åƒµå°¸è¿›ç¨‹ï¼ˆ3ï¼‰.png" loading="lazy"/></p>
<p>æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸‰å¼ å›¾ï¼Œç¬¬ä¸€å¼ å›¾ä¸­æˆ‘é€€å‡ºäº† PID ä¸º 11375 çš„å­è¿›ç¨‹è´Ÿè´£çš„å®¢æˆ·ç«¯ï¼Œç„¶ååˆä»¥ç›¸åŒçš„æ–¹å¼é€€å‡ºäº†å…¶ä½™çš„ä¸¤ä¸ªå­è¿›ç¨‹è´Ÿè´£çš„å®¢æˆ·ç«¯ã€‚</p>
<p>ç¬¬äºŒå¼ å›¾æ˜¾ç¤ºäº†ä¸‰ä¸ªå­è¿›ç¨‹å·²ç»æ‰§è¡Œ<code>exit(0);</code>é€€å‡ºäº†ã€‚è€Œçˆ¶è¿›ç¨‹è¿˜åœ¨ç»§ç»­è¿è¡Œï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹åœ¨<code>accept</code>ç­‰å¾…æ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶<strong>æ²¡æœ‰ä¸ºå­è¿›ç¨‹æ”¶å°¸</strong>ï¼Œå› æ­¤ä»–ä»¬å˜æˆäº†åƒµå°¸è¿›ç¨‹ã€‚</p>
<p>ç¬¬ä¸‰å¼ å›¾æ˜¯æˆ‘æŸ¥è¯¢åƒµå°¸è¿›ç¨‹çš„ç»“æœï¼Œå›¾ä¸­æ˜¾ç¤ºï¼ŒPIDä¸º 11375 ï¼Œ 11422 ï¼Œ 11490 çš„ä¸‰ä¸ªè¿›ç¨‹æ­¤æ—¶çš„<strong>çŠ¶æ€ï¼ˆSTATï¼‰ä¸º Z+</strong> ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹çš„çŠ¶æ€ä¸ºZï¼Œè¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹æ˜¯åƒµå°¸è¿›ç¨‹ï¼Œå¦‚æœæ˜¯Z+ï¼Œè¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªå±äºå‰å°è¿›ç¨‹ç»„çš„åƒµå°¸è¿›ç¨‹ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæƒ³è¦æ¸…ç†ä¸€ä¸ªåƒµå°¸è¿›ç¨‹ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯<strong>æ€æ­»å®ƒçš„çˆ¶è¿›ç¨‹</strong>ã€‚ä½†è¿™ç§æ–¹æ³•åœ¨è¿™é‡Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œä¸€å°æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œç”±äºå…¶ä¸­çš„å‡ ä¸ªè¿›ç¨‹é€€å‡ºåæ²¡æœ‰åŠæ—¶æ¸…ç†ï¼Œäº§ç”Ÿäº†åƒµå°¸è¿›ç¨‹ï¼Œè€Œæ­¤æ—¶ä½ æƒ³å…³é—­è¿™å°æœåŠ¡å™¨æ¥è¿›è¡Œæ¸…ç†åƒµå°¸è¿›ç¨‹ï¼Œè¿™ç­‰äºç›´æ¥æ–­å¼€æ­£åœ¨ä¸æœåŠ¡å™¨é€šä¿¡çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡çš„ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»‹ç»ä¸€ç§æ¯”è¾ƒä¼˜é›…çš„æ–¹æ³•ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä¸é€€å‡ºçš„æƒ…å†µä¸‹å›æ”¶å­è¿›ç¨‹ã€‚</p>
<h3 data-id="heading-7">2.4 SIGCHLD ä¿¡å·</h3>
<p>å¦‚ä½•è®©çˆ¶è¿›ç¨‹åœ¨ä¸é˜»å¡ accept çš„æƒ…å†µä¸‹ï¼ŒåŠæ—¶å›æ”¶å­è¿›ç¨‹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>ä¿¡å·</strong>ã€‚</p>
<p>å½“ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸ä¼šç»™å…¶<strong>çˆ¶è¿›ç¨‹</strong>å‘é€ä¸€ä¸ª <strong>SIGCHLD</strong> ä¿¡å·ã€‚æˆ‘ä»¬åªéœ€è¦ä¸ºçˆ¶è¿›ç¨‹æ³¨å†Œä¸€ä¸ªå¤„ç†è¿™ä¸ªä¿¡å·çš„å‡½æ•°å³å¯ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å¼•å…¥<code>&lt;signal.h&gt;</code>å¤´æ–‡ä»¶ï¼Œç„¶ååœ¨<code>main</code>å‡½æ•°çš„å‰é¢å†™ä¸€ä¸ª<code>sigchld_handler</code>å‡½æ•°ï¼Œæ­¤å¤–ï¼Œè¿˜è¦åœ¨<code>main</code>å‡½æ•°é‡Œé¢æ³¨å†Œè¿™ä¸ªä¿¡å·ï¼Œæ”¾åœ¨<code>main</code>å‡½æ•°ç¬¬ä¸€è¡Œå°±è¡Œã€‚å…¶ä»–éƒ¨åˆ†ä¸éœ€è¦æ”¹å˜ã€‚</p>
<p>ä¸ºäº†ç®€ä¾¿ï¼Œæˆ‘è¿™é‡Œåªç»™å‡ºæœ€å…³é”®çš„éƒ¨åˆ†ï¼Œè¡¥å…¨åˆ°ä¸Šé¢<strong>å¤šè¿›ç¨‹</strong>æ¨¡å‹çš„ä»£ç é‡Œé¢å°±è¡Œäº†ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span> </span>
â€‹
<span class="hljs-type">void</span> <span class="hljs-title function_">sigchld_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span> 
{
 Â  Â <span class="hljs-keyword">while</span> (waitpid(<span class="hljs-number">-1</span>, <span class="hljs-literal">NULL</span>, WNOHANG) &gt; <span class="hljs-number">0</span>);<span class="hljs-comment">//éé˜»å¡ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹</span>
}
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
 Â  Â signal(SIGCHLD, sigchld_handler);
 Â  Â 
 Â  Â <span class="hljs-comment">//........ä¸­é—´éƒ¨åˆ†ä¸å˜........</span>
 Â  Â 
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>ä»£ç ä¿®æ”¹ä¹‹åï¼Œæˆ‘åˆé‡æ–°è¿è¡Œäº†ä¸€æ¬¡ã€‚è¿™æ¬¡æˆ‘ç›´æ¥åˆ›å»ºäº†ä¸‰ä¸ªå®¢æˆ·ç«¯ç„¶åé€€å‡ºã€‚æ­¤æ—¶çˆ¶è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå»æŸ¥ä¸€ä¸‹å‘ç°å¹¶æ²¡æœ‰åƒµå°¸è¿›ç¨‹ï¼Œè¿™å°±è¯´æ˜æˆ‘ä»¬çš„ä¿¡å·å¤„ç†æ–¹æ³•å·²ç»ç”Ÿæ•ˆäº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e161dccce8b4da895b650eaa201171f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=n5Ko2%2FBrIWxTRM7O%2BPV2HFd4s7c%3D" alt="11. signalä¹‹åï¼ˆ1ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e22cac9d60a4f8fa2c98aa1f3533ae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=zK6g57CTCNfTGydugAjWHSeX6gk%3D" alt="12. signalä¹‹åï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<h3 data-id="heading-8">2.5 è¡¥å……çŸ¥è¯†</h3>
<p>è€ƒè™‘åˆ°å¯èƒ½ä¼šæœ‰äººå¥½å¥‡ï¼Œä»å†…æ ¸å‘çˆ¶è¿›ç¨‹å‘é€<code>SIGCHLD</code>ä¿¡å·åˆ°çˆ¶è¿›ç¨‹å›æ”¶åƒµå°¸è¿›ç¨‹ï¼Œè¿™ä¸­é—´åˆ°åº•æ˜¯æ€æ ·è¿è½¬çš„ã€‚æˆ‘å¢åŠ äº†è¿™ä¸€èŠ‚ï¼Œä¸‹é¢è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>å°†å…¶æ ‡è®°ä¸º<strong>åƒµå°¸è¿›ç¨‹</strong>ï¼Œç„¶åå†…æ ¸å»æŸ¥æ‰¾è¯¥å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå¹¶å‘çˆ¶è¿›ç¨‹å‘é€<code>SIGCHLD</code>ä¿¡å·ã€‚</p>
<p>çˆ¶è¿›ç¨‹æ­¤æ—¶å¤§æ¦‚ç‡é˜»å¡åœ¨ <code>accept()</code> ä¸Šï¼Œå½“<code>SIGCHLD</code>ä¿¡å·åˆ°è¾¾æ—¶ï¼Œå†…æ ¸ä¼šä¸­æ–­çˆ¶è¿›ç¨‹çš„è¡Œä¸ºï¼Œ<code>accept()</code> ä¼šç«‹å³è¿”å› <strong>-1</strong>ï¼Œå¹¶å°† <code>errno</code> è®¾ç½®ä¸º <strong>EINTR</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå†…æ ¸è¿˜ä¼šä¿®æ”¹çˆ¶è¿›ç¨‹çš„<strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong> å’Œ<strong>æ ˆï¼ˆSTACKï¼‰</strong> ï¼Œä½¿å¾—çˆ¶è¿›ç¨‹é†’æ¥åèƒ½ä»æˆ‘ä»¬çš„ä¿¡å·å¤„ç†å‡½æ•°<code>sigchld_handler</code>å¼€å§‹æ‰§è¡Œã€‚å½“ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œ return æ—¶ï¼Œå®é™…ä¸Šæ˜¯è·³åˆ°äº†<strong>å†…æ ¸é¢„è®¾çš„ä¸€æ®µè·³æ¿ä»£ç </strong>ï¼Œè¿™æ®µä»£ç ä¼šè°ƒç”¨ <code>sys_sigreturn</code> ç³»ç»Ÿè°ƒç”¨ï¼Œé€šçŸ¥å†…æ ¸æ¢å¤çˆ¶è¿›ç¨‹ä¹‹å‰çš„ä¸Šä¸‹æ–‡ï¼Œä»è€Œè®©è¿›ç¨‹é†’æ¥åç»§ç»­ä»è¢«<code>SIGCHLD</code>ä¿¡å·ä¸­æ–­çš„åœ°æ–¹æ‰§è¡Œã€‚</p>
<p>è€Œåœ¨ä¿¡å·å¤„ç†å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>waitpid(-1, NULL, WNOHANG)</code>ã€‚-1è¡¨ç¤ºå›æ”¶ä»»ä½•ä¸€ä¸ªå·²ç»ç»ˆæ­¢çš„å­è¿›ç¨‹ï¼Œ<code>WNOHANG</code>è¡¨ç¤ºéé˜»å¡ï¼Œæ²¡æœ‰åƒµå°¸è¿›ç¨‹å›æ”¶çš„è¯å°±ç›´æ¥è¿”å›ï¼Œé˜²æ­¢çˆ¶è¿›ç¨‹çš„<code>main</code>å‡½æ•°é‚£è¾¹ç­‰å¤ªé•¿æ—¶é—´ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‰é¢ä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨<code>perror</code>ä¸Šé¢åŠ äº†ä¸€ä¸ª<code>if</code>åˆ¤æ–­ï¼š</p>
<pre><code class="hljs language-c" lang="c"> Â  Â  Â  Â  conn_fd = accept(listen_fd, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
        <span class="hljs-keyword">if</span> (conn_fd &lt; <span class="hljs-number">0</span>) 
        {
            <span class="hljs-keyword">if</span>(errno == EINTR)
            {
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"acceptè¢«SIGCHLDä¿¡å·ä¸­æ–­äº†ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œç¨‹åºç»§ç»­è¿è¡Œ...\n"</span>);
            }
            perror(<span class="hljs-string">"accept"</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">continue</span>; <span class="hljs-comment">//å‡ºé”™äº†æ²¡äº‹ï¼Œç»§ç»­ç­‰ä¸‹ä¸€ä¸ª</span>
 Â  Â  Â   }
â€‹
</code></pre>
<p>ä½†æ˜¯å°±è¿™æ ·<code>printf</code>çš„å†…å®¹æ˜¯ä¸ä¼šæŒ‰ç…§æˆ‘ä»¬é¢„æƒ³çš„é‚£æ ·æ‰“å°å‡ºæ¥çš„ã€‚å› ä¸ºåœ¨é»˜è®¤çš„<code>signal</code>æƒ…å†µä¸‹ï¼Œå†…æ ¸ä¼šè®©çˆ¶è¿›ç¨‹å›åˆ°<code>accept</code>æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€ï¼Œç›¸å½“äºé‡æ–°è¿è¡Œ<code>accept</code>ï¼Œå¦‚æœè¿™æ¬¡æ²¡æœ‰è¢«<code>SIGCHLD</code>ä¿¡å·ä¸­æ–­çš„è¯ï¼Œ<code>accept</code>ä¹Ÿä¸ä¼šè¿”å›-1ï¼Œ<code>errno</code>ä¹Ÿä¸ä¼šè¢«ç½®ä¸º<code>EINTR</code>ï¼Œé€€ä¸€ä¸‡æ­¥è¯´ï¼Œå°±ç®—å†æ¬¡è¢«<code>SIGCHLD</code>ä¿¡å·ä¸­æ–­ï¼Œä¸‹æ¬¡çˆ¶è¿›ç¨‹é†’æ¥è¿˜æ˜¯è¦é‡æ–°æ‰§è¡Œ<code>accept</code>ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ç§æ¨¡å¼ä¸‹<code>printf</code>çš„å†…å®¹æ˜¯æ°¸è¿œä¸ä¼šè¢«æ‰“å°å‡ºæ¥çš„ã€‚</p>
<p>è¦æƒ³çœ‹åˆ°<code>printf</code>çš„å†…å®¹ï¼Œè¯æ˜<code>errno</code>ç¡®å®è¢«ç½®ä¸º<code>EINTR</code>äº†ï¼Œæˆ‘ä»¬å¿…é¡»é‡‡ç”¨æ›´é«˜çº§çš„ä¿¡å·å¤„ç†æ–¹å¼ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶å¤ç°ï¼Œè¿™æ¬¡ç»™å‡ºå®Œæ•´ä»£ç å§ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PORT 8080</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span>
â€‹
<span class="hljs-type">void</span> <span class="hljs-title function_">sigchld_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span>
{
    <span class="hljs-keyword">while</span>(waitpid(<span class="hljs-number">-1</span>,<span class="hljs-literal">NULL</span>,WNOHANG)&gt;<span class="hljs-number">0</span>);
}
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> 
{
 Â  Â <span class="hljs-comment">//--------------------é‡ç‚¹å…³æ³¨è¿™é‡Œ-----------------//</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigaction</span> <span class="hljs-title">sa</span>;</span>
    sa.sa_handler = sigchld_handler;
    sigemptyset(&amp;sa.sa_mask);
    sa.sa_flags = <span class="hljs-number">0</span>;
â€‹
    <span class="hljs-keyword">if</span> (sigaction(SIGCHLD, &amp;sa, <span class="hljs-literal">NULL</span>) == <span class="hljs-number">-1</span>) 
    {
 Â  Â  Â  Â perror(<span class="hljs-string">"sigaction error"</span>);
 Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
 Â   }
 Â  Â <span class="hljs-comment">//------------------------------------------------//</span>
â€‹
 Â  Â <span class="hljs-type">int</span> listen_fd, conn_fd;
 Â  Â <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">serv_addr</span>;</span>
 Â  Â <span class="hljs-type">char</span> buffer[BUFFER_SIZE];
 Â  Â <span class="hljs-type">pid_t</span> pid;
â€‹
 Â  Â listen_fd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(listen_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"socket listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
    <span class="hljs-built_in">memset</span>(&amp;serv_addr,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(serv_addr));
    serv_addr.sin_family = AF_INET;
    serv_addr.sin_port = htons(PORT);
    serv_addr.sin_addr.s_addr = htonl(INADDR_ANY);
 Â  Â 
    <span class="hljs-keyword">if</span>(bind(listen_fd,(<span class="hljs-keyword">struct</span> sockaddr *)&amp;serv_addr,<span class="hljs-keyword">sizeof</span>(serv_addr)) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"bind"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
 Â  Â <span class="hljs-keyword">if</span>(listen(listen_fd, <span class="hljs-number">5</span>) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
 Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥...\n"</span>);
â€‹
 Â  Â <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) { 
 Â  Â  Â  Â conn_fd = accept(listen_fd, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (conn_fd &lt; <span class="hljs-number">0</span>) 
        {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//-------------------------------è¿˜æœ‰è¿™é‡Œ-----------------</span>
            <span class="hljs-keyword">if</span>(errno == EINTR)
            {
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"acceptè¢«SIGCHLDä¿¡å·ä¸­æ–­äº†ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œç¨‹åºç»§ç»­è¿è¡Œ...\n"</span>);
            }
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//--------------------------------------------------------</span>
            perror(<span class="hljs-string">"accept"</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">continue</span>; <span class="hljs-comment">//å‡ºé”™äº†æ²¡äº‹ï¼Œç»§ç»­ç­‰ä¸‹ä¸€ä¸ª</span>
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â pid = fork();
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">if</span>(pid &lt; <span class="hljs-number">0</span>) 
        {
 Â  Â  Â  Â  Â  Â perror(<span class="hljs-string">"fork"</span>);
 Â  Â  Â  Â  Â  Â close(conn_fd);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">continue</span>;
 Â  Â  Â   }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>) 
        {
 Â  Â  Â  Â  Â  Â close(listen_fd); 
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å­è¿›ç¨‹%dä¸ºæ–°å®¢æˆ·ç«¯æœåŠ¡(fd=%d)...\n"</span>, getpid(), conn_fd);
â€‹
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ssize_t</span> n;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">while</span> (((n = read(conn_fd, buffer, BUFFER_SIZE))) &gt; <span class="hljs-number">0</span>) 
            {
 Â  Â  Â  Â  Â  Â  Â  Â write(conn_fd, buffer, n);
 Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å®¢æˆ·ç«¯æ–­å¼€ï¼Œå­è¿›ç¨‹%dé€€å‡ºã€‚\n"</span>, getpid());
 Â  Â  Â  Â  Â  Â close(conn_fd);
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); 
 Â  Â  Â   } 
        <span class="hljs-keyword">else</span> 
        {
 Â  Â  Â  Â  Â  Â close(conn_fd); 
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â close(listen_fd); <span class="hljs-comment">// ç†è®ºä¸Šèµ°ä¸åˆ°è¿™é‡Œ</span>
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
â€‹
</code></pre>
<p>è¿è¡Œåç»“æœå¦‚ä¸‹ï¼Œè¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>printf</code>çš„å†…å®¹å’Œ<code>perror</code>çš„å†…å®¹éƒ½è¢«æ‰“å°å‡ºæ¥äº†ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ <code>signal()</code> ä¼šéšå« <code>SA_RESTART</code> æ ‡å¿—ï¼Œå¯¼è‡´<strong>ç³»ç»Ÿè°ƒç”¨è‡ªåŠ¨é‡å¯</strong>ã€‚æˆ‘ä»¬æŠŠ<code>sa.sa_flags</code>è®¾ä¸º 0 è¡¨ç¤ºä¸è‡ªåŠ¨é‡å¯ï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨ <code>accept</code> è¿”å›å¤„æ•è· <code>EINTR</code>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61a47a3d7e904ac9a4df02676fdc346e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=Br0Hhuh%2FP5vhUj9%2F1DG3ZBDmfuI%3D" alt="13. acceptè¢«ä¸­æ–­.png" loading="lazy"/></p>
<h2 data-id="heading-9">3. å¤šçº¿ç¨‹æ¨¡å‹</h2>
<p>åœ¨è§£å†³äº†åƒµå°¸è¿›ç¨‹åï¼Œæˆ‘ä»¬çš„å¤šè¿›ç¨‹æœåŠ¡å™¨å·²ç»<strong>éå¸¸å¥å£®</strong>äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦é¢å¯¹æˆåƒä¸Šä¸‡ä¸ªå¹¶å‘è¿æ¥ï¼Œæ¯æ¥ä¸€ä¸ªè¿æ¥å°± <code>fork()</code> ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ç§æ–¹æ³•<strong>å¼€é”€å®åœ¨å¤ªå¤§äº†</strong>ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´è½»é‡çš„æ–¹æ¡ˆâ€”â€”<strong>å¤šçº¿ç¨‹</strong>ã€‚</p>
<h3 data-id="heading-10">3.1 æ”¹è¿›æ€è·¯</h3>
<p><strong>è¿›ç¨‹</strong>æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼ˆå †ã€æ ˆã€ä»£ç æ®µï¼‰ã€‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œå†…æ ¸éœ€è¦å¤åˆ¶<strong>é¡µè¡¨ã€æ–‡ä»¶æè¿°ç¬¦è¡¨</strong>ç­‰ï¼Œæˆæœ¬æ˜‚è´µã€‚</p>
<p><strong>çº¿ç¨‹</strong>å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåªéœ€è¦åˆ†é…ä¸€ä¸ªå°å°çš„æ ˆç©ºé—´ï¼Œæˆæœ¬æä½ã€‚</p>
<p>äº†è§£äº†è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Œæˆ‘ä»¬çš„æ”¹è¿›æ€è·¯å°±éå¸¸æ˜ç¡®äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<p>ä¸»çº¿ç¨‹è´Ÿè´£<code>accept()</code>ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚æ¯å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ä¸Šï¼Œå°±<code>pthread_create()</code>ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å»è´Ÿè´£ã€‚</p>
<p>å·¥ä½œçº¿ç¨‹è´Ÿè´£å¤„ç†å¯¹åº”å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-11">3.2 çº¿ç¨‹æ¨¡å‹çš„ä¼˜ç¼ºç‚¹</h3>
<p>çº¿ç¨‹æ¨¡å‹çš„ä¼˜ç‚¹ï¼š</p>
<p>çº¿ç¨‹<strong>åˆ›å»ºé€Ÿåº¦</strong>æ¯”è¿›ç¨‹å¿« 10~100 å€ã€‚</p>
<p>çº¿ç¨‹é—´<strong>å…±äº«å…¨å±€å˜é‡å’Œå †å†…å­˜</strong>ï¼Œä¸éœ€è¦å¤æ‚çš„ IPCï¼ˆç®¡é“ã€å…±äº«å†…å­˜ç­‰ï¼‰ã€‚</p>
<p>çº¿ç¨‹æ¨¡å‹çš„ç¼ºç‚¹ï¼š</p>
<p>ä¸€ä¸ª<strong>çº¿ç¨‹å´©æºƒ</strong>ï¼Œæ•´ä¸ªè¿›ç¨‹ï¼ˆåŒ…æ‹¬æ‰€æœ‰å…¶ä»–çº¿ç¨‹ï¼‰éƒ½ä¼šæŒ‚æ‰ã€‚è€Œå¤šè¿›ç¨‹æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªå­è¿›ç¨‹å´©äº†ï¼Œä¸å½±å“çˆ¶è¿›ç¨‹å’Œå…¶ä»–å­è¿›ç¨‹ã€‚</p>
<p>å…±äº«èµ„æºï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰éœ€è¦<strong>åŠ é”</strong>ï¼Œå†™ä¸å¥½å®¹æ˜“æ­»é”æˆ–æ•°æ®ç«äº‰ã€‚</p>
<p>è™½ç„¶æ¯”è¿›ç¨‹è½»ï¼Œä½†å¦‚æœæ˜¯ 1 ä¸‡ä¸ªè¿æ¥ï¼Œä¾ç„¶éœ€è¦ 1 ä¸‡ä¸ªçº¿ç¨‹ã€‚æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ä¼šè¢«ç´¯æ­»ï¼Œå†…å­˜ä¹Ÿä¼šè¢«æ’‘çˆ†ã€‚åœ¨ Linux ä¸­ï¼Œ<strong>æ¯ä¸ªæ–°çº¿ç¨‹çš„é»˜è®¤æ ˆå¤§å°é€šå¸¸ä¸º 8 MB</strong>ï¼Œ1ä¸‡ä¸ªçº¿ç¨‹æ ˆå°±æ˜¯ 80 GBã€‚</p>
<h3 data-id="heading-12">3.3 å°æ€»ç»“</h3>
<p>æ•´ä½“ä¸Šæ¥çœ‹ï¼Œå¤šçº¿ç¨‹æ¨¡å‹å’Œå¤šè¿›ç¨‹æ¨¡å‹çš„æ€è·¯å…¶å®æ˜¯ç›¸åŒçš„ï¼Œå¤šçº¿ç¨‹æ¨¡å‹è™½ç„¶å‡è½»äº†åˆ›å»ºå¼€é”€ï¼Œä½†<strong>ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹</strong> çš„æœ¬è´¨æ²¡æœ‰å˜ã€‚é¢å¯¹æµ·é‡å¹¶å‘ï¼Œæˆ‘ä»¬å¿…é¡»<strong>å½»åº•æŠ›å¼ƒ</strong>è¿™ç§æ–¹å¼ï¼Œè½¬å‘ä¸€ç§<strong>å…¨æ–°çš„æ€ç»´æ¨¡å¼</strong>ã€‚</p>
<p>ä¸‹ä¸€ç« è¦ä»‹ç»çš„å°±æ˜¯ Linux ç½‘ç»œç¼–ç¨‹çš„<strong>ç»ˆææ­¦å™¨</strong>â€”â€”<strong>I/O å¤šè·¯å¤ç”¨ (epoll)</strong> ã€‚</p>
<h2 data-id="heading-13">4. I/Oå¤šè·¯å¤ç”¨</h2>
<p>è™½ç„¶å¤šçº¿ç¨‹æ¨¡å‹å‡è½»äº†åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œä½†æœ¬è´¨ä¸Šå®ƒä¾ç„¶éµå¾ªä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹çš„æ€è·¯ã€‚å½“å¹¶å‘è¿æ¥æ•°ä¸Šå‡åˆ° 1 ä¸‡ç”šè‡³ 100 ä¸‡æ—¶ï¼Œè¿™ç§æ¨¡å‹ä¼šé¢ä¸´ä¸¤ä¸ªæ— æ³•é€¾è¶Šçš„éšœç¢ï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯å†…å­˜çˆ†ç‚¸ï¼Œ1 ä¸‡ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ ˆ 8MBï¼Œå…‰æ ˆç©ºé—´å°±éœ€è¦ 80GB å†…å­˜ã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯è°ƒåº¦å´©æºƒï¼Œæ“ä½œç³»ç»Ÿåœ¨æˆåƒä¸Šä¸‡ä¸ªçº¿ç¨‹ä¹‹é—´è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒCPU çš„æ—¶é—´å…¨èŠ±åœ¨åˆ‡æ¢ä¸Šï¼Œè€Œä¸æ˜¯å¹²æ­£äº‹å„¿ä¸Šã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿ<strong>ç”¨ä¸€ä¸ªçº¿ç¨‹ç›‘æ§æˆåƒä¸Šä¸‡ä¸ªè¿æ¥</strong>ã€‚è¿™å°±æ˜¯ <strong>I/O å¤šè·¯å¤ç”¨</strong>ã€‚</p>
<h3 data-id="heading-14">4.1 ä»çº¿æ€§è½®è¯¢åˆ°äº‹ä»¶é©±åŠ¨</h3>
<p>åœ¨ <code>epoll</code> å‡ºç°<strong>ä¹‹å‰</strong>ï¼ŒLinux ä½¿ç”¨ <code>select</code> å’Œ <code>poll</code>ã€‚å®ƒä»¬è™½ç„¶èƒ½å®ç°å¤šè·¯å¤ç”¨ï¼Œä½†åœ¨å†…æ ¸å®ç°ä¸Šå­˜åœ¨æœ¬è´¨çš„ç¼ºé™·ã€‚</p>
<p><code>select</code> å’Œ <code>poll</code> çš„å·¥ä½œæœºåˆ¶éå¸¸<strong>åŸå§‹</strong>ã€‚æ¯æ¬¡è°ƒç”¨å®ƒä»¬ï¼Œéƒ½éœ€è¦å°†æ‰€æœ‰è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆ<strong>ä»ç”¨æˆ·æ€å®Œæ•´æ‹·è´åˆ°å†…æ ¸æ€</strong>ã€‚</p>
<p>å†…æ ¸åœ¨æ£€æµ‹æ—¶ï¼Œä¼š<strong>éå†</strong>æ•´ä¸ªé›†åˆ <strong>ï¼ˆO(N) å¤æ‚åº¦ï¼‰</strong> ã€‚å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå†…æ ¸åªæ˜¯ç®€å•åœ°æ ‡è®°æœ‰äº‹ä»¶å·²ç»å°±ç»ªï¼Œä½†ä¸ä¼šå‘Šè¯‰è¯´æ˜åˆ°åº•æ˜¯å“ªä¸€ä¸ªã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>select</code> è¿”å›åï¼Œç”¨æˆ·æ€ç¨‹åºè¿˜éœ€è¦<strong>å†éå†ä¸€é</strong>æ•´ä¸ªé›†åˆï¼Œæ‰èƒ½æ‰¾åˆ°çœŸæ­£éœ€è¦å¤„ç†çš„é‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p>å½“è¿æ¥æ•°è¾¾åˆ° 10ä¸‡ï¼Œä½†æ´»è·ƒè¿æ¥åªæœ‰ 1 ä¸ªæ—¶ï¼Œ<code>select</code> ä¾ç„¶è¦<strong>ç©ºè½¬ 10ä¸‡æ¬¡</strong>ï¼Œè¿™é€ æˆäº†å¤§é‡çš„æ€§èƒ½æµªè´¹ã€‚å¹¶ä¸”<code>select</code> å—é™äº <code>FD_SETSIZE</code> (é»˜è®¤æ˜¯ 1024)ï¼Œæ˜¯æ— æ³•å¤„ç†æµ·é‡è¿æ¥çš„ã€‚</p>
<p>è€Œ<code>epoll</code>çš„å‡ºç°å®Œç¾è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚<code>epoll</code>åœ¨å†…æ ¸è®¾è®¡äº†<strong>ä¸¤ä¸ªæ ¸å¿ƒçš„æ•°æ®ç»“æ„</strong>ï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯<strong>çº¢é»‘æ ‘</strong>ï¼Œ<code>epoll_create</code> ä¼šåœ¨å†…æ ¸å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>epoll_ctl</code> æ·»åŠ  <code>socket</code> æ—¶ï¼Œå†…æ ¸ä¼šå°†è¿™ä¸ª <code>socket</code> èŠ‚ç‚¹æ’å…¥åˆ°ä¸€æ£µ<strong>çº¢é»‘æ ‘</strong>ä¸­ã€‚çº¢é»‘æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤å¤æ‚åº¦å‡ä¸º <strong>O(logN)</strong> ï¼Œå³ä½¿ç®¡ç†ç™¾ä¸‡çº§è¿æ¥ï¼Œæ•ˆç‡ä¾ç„¶æé«˜ã€‚ä¸”è¿™æ£µæ ‘ä¸€ç›´åœ¨å†…æ ¸é‡Œé¢ï¼Œæ— éœ€åƒ <code>select</code> é‚£æ ·æ¯æ¬¡éƒ½è¦<strong>é‡å¤æ‹·è´</strong>æ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯<strong>å°±ç»ªé“¾è¡¨</strong>ï¼Œå†…æ ¸ä¸ºçº¢é»‘æ ‘ä¸­çš„æ¯ä¸ª <code>socket</code> æ³¨å†Œäº†ä¸€ä¸ª<strong>å›è°ƒå‡½æ•°</strong>ã€‚å½“ç½‘å¡æ”¶åˆ°æ•°æ®ï¼Œä¸­æ–­å¤„ç†ç¨‹åºè§¦å‘å›è°ƒï¼Œ<strong>è‡ªåŠ¨</strong>å°†è¯¥ <code>socket</code> èŠ‚ç‚¹æ‹·è´åˆ°ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨ï¼ˆä¹Ÿå°±æ˜¯å°±ç»ªé“¾è¡¨ï¼‰</strong> ä¸­ã€‚</p>
<p>è€Œ**<code>epoll_wait</code><strong>è¦å¹²ä»€ä¹ˆå‘¢ï¼Ÿå®ƒåªéœ€è¦æ£€æŸ¥é‚£ä¸ª</strong>å°±ç»ªé“¾è¡¨æ˜¯å¦ä¸ºç©º**ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œç›´æ¥æŠŠé“¾è¡¨é‡Œçš„èŠ‚ç‚¹å¤åˆ¶å›ç”¨æˆ·æ€ã€‚</p>
<p>ä¸‹é¢æˆ‘åˆ—ä¸ªè¡¨æ ¼å¯¹æ¯”ä¸€ä¸‹ï¼Œè¿™å‡ ç§I/Oå¤šè·¯å¤ç”¨çš„æ–¹å¼ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5866aad4387450f8e062b2dd7455c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=8z61gv0vWRTuniMg64COgRVioYM%3D" alt="14. IOå¤šè·¯å¤ç”¨å¯¹æ¯”.png" loading="lazy"/></p>
<h3 data-id="heading-15">4.2 æ ¸å¿ƒä»£ç å®ç°</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäº <code>epoll</code> çš„<strong>å•çº¿ç¨‹å¹¶å‘æœåŠ¡å™¨</strong>ã€‚è¯·æ³¨æ„è§‚å¯Ÿï¼Œä»£ç ä¸­<strong>ä¸å†æœ‰</strong> <code>fork</code> æˆ– <code>pthread_create</code>ï¼Œæ‰€æœ‰çš„è¿æ¥éƒ½åœ¨åŒä¸€ä¸ª <code>while(1)</code> å¾ªç¯ä¸­è¢«<strong>ä¸²è¡Œ</strong>å¤„ç†ã€‚</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PORT 8080</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENTS 10</span>
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
    <span class="hljs-type">int</span> listen_fd,conn_fd,epoll_fd,n_read;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">server_addr</span>;</span>
    <span class="hljs-type">char</span> buffer[BUFFER_SIZE];
â€‹
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">epoll_event</span> <span class="hljs-title">ev</span>,<span class="hljs-title">events</span>[<span class="hljs-title">MAX_EVENTS</span>];</span>
â€‹
    listen_fd = socket(AF_INET,SOCK_STREAM,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(listen_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"socket listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ç›‘å¬socketåˆ›å»ºæˆåŠŸ\n"</span>);
â€‹
    <span class="hljs-type">int</span> opt = <span class="hljs-number">1</span>;
 Â  Â setsockopt(listen_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, <span class="hljs-keyword">sizeof</span>(opt));<span class="hljs-comment">//è®¾ç½®ç«¯å£å¯å¤ç”¨</span>
â€‹
    <span class="hljs-built_in">memset</span>(&amp;server_addr,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(PORT);
    server_addr.sin_addr.s_addr = htonl(INADDR_ANY);
â€‹
    <span class="hljs-keyword">if</span>(bind(listen_fd,(<span class="hljs-keyword">struct</span> sockaddr *)&amp;server_addr,<span class="hljs-keyword">sizeof</span>(server_addr)) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"bind"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ç»‘å®šæˆåŠŸ\n"</span>);
â€‹
    <span class="hljs-keyword">if</span>(listen(listen_fd,<span class="hljs-number">5</span>) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
    epoll_fd = epoll_create1(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(epoll_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"epoll_create"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"epollå®ä¾‹åˆ›å»ºæˆåŠŸ\n"</span>);
â€‹
    ev.events = EPOLLIN;
    ev.data.fd = listen_fd;
    <span class="hljs-keyword">if</span>(epoll_ctl(epoll_fd,EPOLL_CTL_ADD,listen_fd,&amp;ev) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"epoll_ctl"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"listen_fdæ·»åŠ æˆåŠŸ\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æœåŠ¡å™¨æ­£åœ¨ç›‘å¬%dç«¯å£....\n"</span>,PORT);
â€‹
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        n_read = epoll_wait(epoll_fd,events,MAX_EVENTS,<span class="hljs-number">-1</span>);<span class="hljs-comment">//é˜»å¡ç­‰å¾…</span>
        <span class="hljs-keyword">if</span>(n_read == <span class="hljs-number">-1</span>)
        {
            perror(<span class="hljs-string">"epoll_wait"</span>);
            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
        }
â€‹
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n_read;i++)
        {
            <span class="hljs-keyword">if</span>(events[i].data.fd == listen_fd)<span class="hljs-comment">//æœ‰æ–°çš„è¿æ¥åˆ°æ¥</span>
            {
                conn_fd = accept(listen_fd,(<span class="hljs-keyword">struct</span> sockaddr *)<span class="hljs-literal">NULL</span>,<span class="hljs-literal">NULL</span>);
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ¥å—æ–°çš„è¿æ¥ï¼Œfd = %d\n"</span>,conn_fd);
                ev.events = EPOLLIN;
                ev.data.fd = conn_fd;
                epoll_ctl(epoll_fd,EPOLL_CTL_ADD,conn_fd,&amp;ev);
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-type">int</span> client_fd = events[i].data.fd;
                <span class="hljs-type">ssize_t</span> n = read(client_fd,buffer,BUFFER_SIZE);
â€‹
                <span class="hljs-keyword">if</span>(n == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å®¢æˆ·ç«¯fd = %då…³é—­äº†è¿æ¥\n"</span>,client_fd);
                    epoll_ctl(epoll_fd,EPOLL_CTL_DEL,client_fd,<span class="hljs-literal">NULL</span>);
                    close(client_fd);
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n &gt; <span class="hljs-number">0</span>)
                {
                    write(client_fd,buffer,n);
                }
                <span class="hljs-keyword">else</span>
                {
                    perror(<span class="hljs-string">"read"</span>);
                    close(client_fd);
                }
            }
        }
    }
    close(listen_fd);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
â€‹
</code></pre>
<p>è¿™æ®µä»£ç æ‰ç”¨çš„æ˜¯<strong>LTï¼ˆæ°´å¹³è§¦å‘ï¼‰</strong> æ¨¡å¼ï¼Œåœ¨<code>while</code>å¾ªç¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç›‘å¬<code>socketï¼ˆlisten_fdï¼‰</code>æ·»åŠ åˆ°æˆ‘ä»¬éœ€è¦å…³æ³¨çš„äº‹ä»¶ä¸­ã€‚</p>
<p>ä¸‹é¢ç®€è¦è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç çš„æ ¸å¿ƒé€»è¾‘ã€‚</p>
<p>è¿›å…¥<code>while</code>å¾ªç¯åï¼Œ<code>epoll_wait</code>å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œå½“å®ƒè¿”å›æ—¶ï¼Œ<code>events</code>æ•°ç»„ä¸­å°±å­˜æ”¾ç€<strong>çœŸæ­£æœ‰äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦</strong>ã€‚ç›¸æ¯”äº <code>select</code> éœ€è¦éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œ<code>epoll</code> ç›´æ¥æŠŠéœ€è¦å¤„ç†çš„æ–‡ä»¶æè¿°ç¬¦å•ç‹¬æ‹å‡ºæ¥ç»™æˆ‘ä»¬ï¼Œè¿™å°±æ˜¯å®ƒåœ¨æµ·é‡è¿æ¥ä¸‹æ€§èƒ½ä¸è¡°å‡çš„åŸå› ã€‚</p>
<p>ç„¶åæˆ‘ä»¬ä¼šè¿›å…¥<code>for</code>å¾ªç¯ï¼Œå®ƒä¼šæŠŠ<code>events</code>æ•°ç»„ä¸­éœ€è¦å¤„ç†çš„æ–‡ä»¶æè¿°ç¬¦ä¸€ä¸ªä¸€ä¸ªæ‹¿å‡ºæ¥ï¼Œåˆ¤æ–­ä»–ä»¬<strong>åˆ°åº•æ˜¯å“ªç§ç±»å‹</strong>çš„ï¼Œæ˜¯æœ‰æ–°çš„è¿æ¥åˆ°æ¥ï¼Œè¿˜æ˜¯è¯´æ—§çš„è¿æ¥å‘æ¶ˆæ¯äº†ï¼Œè¿™ä¸ªåˆ¤æ–­è¿‡ç¨‹ä½“ç°åœ¨ifåˆ¤æ–­ä¸­ã€‚</p>
<p>å¦‚æœæœ‰æ–°çš„è¿æ¥åˆ°æ¥ï¼Œé‚£æˆ‘ä»¬å°±<code>accept</code>ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–°é“¾æ¥ä¸Šçš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°æˆ‘ä»¬éœ€è¦å…³æ³¨çš„äº‹ä»¶ä¸­ã€‚</p>
<p>å¦‚æœæ˜¯æ—§çš„è¿æ¥åœ¨å‘æ¶ˆæ¯ï¼Œé‚£æˆ‘ä»¬å°±å…ˆ<code>read</code>ï¼ŒæŠŠè¿™ä¸ªæ¶ˆæ¯å­˜æ”¾åœ¨<code>buffer</code>ä¸­ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»è¦åˆ¤æ–­ä¸€ä¸‹<code>read</code>çš„è¿”å›å€¼ï¼Œå› ä¸ºå®¢æˆ·ç«¯é€€å‡ºä¼šä½“ç°åœ¨è¿™é‡Œã€‚å¦‚æœå®¢æˆ·ç«¯é€€å‡ºï¼Œ<code>read</code>ä¼šè¿”å› 0ï¼Œè¿™æ—¶æˆ‘ä»¬è¦æŠŠç›¸åº”çš„æ–‡ä»¶æè¿°ç¬¦ä»æˆ‘ä»¬éœ€è¦å…³æ³¨çš„äº‹ä»¶ä¸­åˆ é™¤ï¼Œç„¶åå…³é—­è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æœæ˜¯æ­£å¸¸è¯»å†™ï¼Œé‚£æˆ‘ä»¬å°±å†ç»™ä»–å›å†™è¿‡å»ã€‚å¦‚æœçœŸçš„å‡ºé”™ï¼Œé‚£å°±æç¤ºå°±å®Œäº‹å„¿äº†ã€‚</p>
<h3 data-id="heading-16">4.3 æ•ˆæœå±•ç¤ºä¸æ–°çš„ç“¶é¢ˆ</h3>
<p>ä¸ºäº†å±•ç¤ºè¿™ä¸ªå•çº¿ç¨‹epollçš„æ•ˆæœæ€ä¹ˆæ ·ï¼Œæˆ‘ç›´æ¥å¼€äº†ä¸‰ä¸ªå®¢æˆ·ç«¯è¿æ¥å®ƒï¼Œå¹¶ä¸”å‘é€helloéƒ½å¯ä»¥æ­£å¸¸å›å†™ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f24332fbf654c2bb627769158832894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=FGMjJLI4wAXPNLNAcwp%2BXXGt9gI%3D" alt="15. å•çº¿ç¨‹epoll.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f52992fd95441a292961f8091b208bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=ntoZ89oJm%2B45rNbuvlHIIeeZkis%3D" alt="16. å•çº¿ç¨‹epollï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df6e51ac059845c6b93a76e0a1b9ff7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=wgAru2aXWXlgcWeiWyZBswAo1yk%3D" alt="17. å•çº¿ç¨‹epollï¼ˆ3ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ed32b5ace2483cb430b91e363a8ab6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=P26c1Lbt305%2FUVuH2hQ52cuwo0M%3D" alt="18. å•çº¿ç¨‹epollï¼ˆ4ï¼‰.png" loading="lazy"/></p>
<p>ä½†æ˜¯è¯·çœ‹è¿™é‡Œï¼š</p>
<pre><code class="hljs language-c" lang="c">                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n &gt; <span class="hljs-number">0</span>)
                {
                    write(client_fd,buffer,n);
                }
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè¿›è¡Œçš„å¤„ç†ï¼Œåªæœ‰ä¸€æ¡ç®€å•çš„<code>write</code>ç³»ç»Ÿè°ƒç”¨ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¿™é‡Œçš„ä¸šåŠ¡é€»è¾‘å˜æˆäº†è§†é¢‘è§£ç ï¼Œæˆ–è€…å¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œéœ€è¦æ¶ˆè€— 1 ç§’ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p>
<p>å› ä¸ºæˆ‘ä»¬<strong>åªæœ‰ä¸€ä¸ªçº¿ç¨‹</strong>åœ¨æ­»å¾ªç¯é‡Œå¤„ç†ä»»åŠ¡ã€‚å½“å®ƒæ­£åœ¨å¤„ç†é‚£ä¸ªè€—æ—¶ 1 ç§’çš„ä»»åŠ¡æ—¶ï¼Œ<code>epoll_wait</code> æ— æ³•è¢«è°ƒç”¨ï¼Œæ–°çš„è¿æ¥è¿›ä¸æ¥ï¼Œå…¶ä»–å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¹Ÿ<strong>å¡åœ¨ç¼“å†²åŒº</strong>é‡Œæ— æ³•å¤„ç†ã€‚æ•´ä¸ªæœåŠ¡å™¨åœ¨è¿™ä¸€ç§’æ—¶é—´é‡Œä¼šå¤„äº <strong>â€œå‡æ­»â€</strong> çŠ¶æ€ã€‚</p>
<p>å•çº¿ç¨‹ <code>epoll</code> è™½ç„¶è§£å†³äº† I/O çš„å¹¶å‘ï¼Œä½†æ— æ³•åˆ©ç”¨å¤šæ ¸ CPU å¤„ç†<strong>è®¡ç®—å¯†é›†å‹</strong>ä»»åŠ¡ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°† <strong>epoll (åªè´Ÿè´£ I/O)</strong> ä¸ <strong>çº¿ç¨‹æ±  (åªè´Ÿè´£å¤„ç†)</strong> ç»“åˆèµ·æ¥ã€‚è¿™å°±æ˜¯æœ€ç»ˆå½¢æ€â€”â€”<strong>Reactor æ¨¡å‹</strong>ã€‚</p>
<h2 data-id="heading-17">5. epoll + çº¿ç¨‹æ± </h2>
<p>ä¸ºäº†è§£å†³å•çº¿ç¨‹ <code>epoll</code> æ— æ³•åˆ©ç”¨å¤šæ ¸ CPUï¼Œä¸”è®¡ç®—ä»»åŠ¡ä¼šé˜»å¡ I/O è¿™ä¸ªç—›ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°† <strong>I/O å¤„ç†</strong> å’Œ <strong>ä¸šåŠ¡é€»è¾‘</strong> å½»åº•åˆ†ç¦»ã€‚è¿™ä¹Ÿæ˜¯ç°ä»£é«˜æ€§èƒ½æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼ŒNettyï¼‰é€šç”¨çš„ <strong>Reactor æ¨¡å‹</strong>ã€‚</p>
<h3 data-id="heading-18">5.1 æ¨¡å‹è®¾è®¡</h3>
<p>æˆ‘ä»¬å¼•å…¥<strong>çº¿ç¨‹æ± </strong> æ¥è´Ÿè´£å…·ä½“çš„ä¸šåŠ¡è®¡ç®—ï¼Œä¸»çº¿ç¨‹åªè´Ÿè´£ <strong>I/O è°ƒåº¦</strong>ã€‚</p>
<p>ä¸»çº¿ç¨‹ï¼šè´Ÿè´£ <code>epoll_wait</code>ã€<code>accept</code> æ–°è¿æ¥ã€<code>read</code> æ•°æ®ã€‚æ”¶åˆ°æ•°æ®åï¼Œç«‹åˆ»å°è£…æˆä¸€ä¸ªä»»åŠ¡ï¼Œæ‰”è¿›ä»»åŠ¡é˜Ÿåˆ—ã€‚</p>
<p>ä»»åŠ¡é˜Ÿåˆ—ï¼šè¿æ¥ä¸»çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹çš„æ¡¥æ¢ã€‚è¿™é‡Œæˆ‘ä»¬å¤ç”¨äº†ä¹‹å‰é¡¹ç›®ä¸­æ‰‹æ“çš„é«˜æ€§èƒ½ <strong><code>RingBuffer</code></strong>ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å»æˆ‘å‰é¢å‘çš„æ–‡ç« çœ‹ä¸€ä¸‹è¿™ä¸ª<code>RingBuffer</code>çš„å…·ä½“å®ç°ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†è¯¦ç»†æè¿°äº†ã€‚</p>
<p>å·¥ä½œçº¿ç¨‹ï¼šå…ˆä»é˜Ÿåˆ—å–ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„é€»è¾‘ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€åŠ å¯†è§£å¯†ï¼‰ï¼Œæœ€åå°†ç»“æœ<code>write</code> å›å®¢æˆ·ç«¯ã€‚å®ƒèƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU è¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚</p>
<p>ä¸‹é¢è¿™å¼ å›¾æ˜¯æˆ‘ç”»çš„ä¸€å¼ ç¤ºæ„å›¾ï¼Œä¸»çº¿ç¨‹è´Ÿè´£å°†ä»»åŠ¡<code>push</code>åˆ° <code>RingBuffer</code>ï¼Œå·¥ä½œçº¿ç¨‹è·å–ä»»åŠ¡å¹¶å¤„ç†å®Œæ¯•åï¼Œ<strong>ç›´æ¥å°†å“åº”ç»“æœå†™å…¥å®¢æˆ·ç«¯ Socket</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd2f0b48666a42f68fb9737766dc00e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=sHHvl2CDvaRgx8uE8%2FL70UCdY0s%3D" alt="19. æ¡†å›¾.png" loading="lazy"/></p>
<h3 data-id="heading-19">5.2 Ring Buffer å®ç°</h3>
<p>æˆ‘ç›´æ¥å°†å‰é¢é‚£ç¯‡ã€Šé«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ã€‹çš„ <code>RingBuffer</code> è¿›è¡Œç®€å•çš„ä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> RING_BUFFER_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> RING_BUFFER_H</span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BUFFER_SIZE 1024</span>
â€‹
<span class="hljs-comment">//ä»»åŠ¡ç»“æ„ä½“</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
 Â  Â <span class="hljs-type">int</span> client_fd; Â  Â  Â  Â  Â  <span class="hljs-comment">// è®°å½•æ˜¯è°å‘çš„è¯·æ±‚</span>
 Â  Â <span class="hljs-type">char</span> data[BUFFER_SIZE]; Â <span class="hljs-comment">// å…·ä½“æ•°æ®</span>
} Task;
â€‹
<span class="hljs-comment">// ç¯å½¢ç¼“å†²åŒºç®¡ç†å™¨</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
 Â  Â Task *entries; Â <span class="hljs-comment">// æŒ‡å‘ malloc çš„å¤§æ•°ç»„</span>
 Â  Â <span class="hljs-type">int</span> capacity; Â  <span class="hljs-comment">// æ€»å®¹é‡</span>
 Â  Â 
 Â  Â <span class="hljs-type">int</span> head;
 Â  Â <span class="hljs-type">int</span> tail;
 Â  Â <span class="hljs-type">int</span> count;
â€‹
 Â  Â <span class="hljs-type">pthread_mutex_t</span> mutex;
 Â  Â <span class="hljs-type">pthread_cond_t</span> cond_producer;
 Â  Â <span class="hljs-type">pthread_cond_t</span> cond_consumer;
â€‹
 Â  Â <span class="hljs-type">bool</span> is_running; <span class="hljs-comment">// ä¼˜é›…é€€å‡º</span>
} RingBuffer;
â€‹
<span class="hljs-type">void</span> <span class="hljs-title function_">rb_init</span><span class="hljs-params">(RingBuffer *rb, <span class="hljs-type">int</span> capacity)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">rb_push</span><span class="hljs-params">(RingBuffer *rb, <span class="hljs-type">const</span> Task *entry)</span>;
<span class="hljs-type">int</span> Â <span class="hljs-title function_">rb_pop</span><span class="hljs-params">(RingBuffer *rb, Task *entry)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">rb_stop</span><span class="hljs-params">(RingBuffer *rb)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">rb_destroy</span><span class="hljs-params">(RingBuffer *rb)</span>;
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<p><code>ring_buffer.c</code>æ–‡ä»¶é‡Œé¢çš„<code>LOG</code>ä¹Ÿè¦æ”¹ä¸º<code>TASK</code>ï¼Œä½†ä»£ç é€»è¾‘ä¸éœ€è¦æ”¹å˜ã€‚</p>
<h3 data-id="heading-20">5.3 æ ¸å¿ƒä»£ç å®ç°</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ctype.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ring_buffer.h"</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PORT 8080</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EVENTS 10</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> THREADS_NUM 4 Â <span class="hljs-comment">//å››ä¸ªçº¿ç¨‹å¤„ç†ä»»åŠ¡</span></span>
â€‹
<span class="hljs-keyword">volatile</span> <span class="hljs-type">sig_atomic_t</span> Â g_is_running = <span class="hljs-number">1</span>;
RingBuffer *g_rb = <span class="hljs-literal">NULL</span>;
â€‹
<span class="hljs-type">void</span> <span class="hljs-title function_">sig_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> sig)</span>
{
    g_is_running = <span class="hljs-number">0</span>;
â€‹
    <span class="hljs-keyword">if</span>(g_rb)
    {
        rb_stop(g_rb);
    }
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">work_thread</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
    Task task;
â€‹
    <span class="hljs-keyword">while</span>(rb_pop(rb,&amp;task))<span class="hljs-comment">//ä¼˜é›…é€€å‡º</span>
    {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å·¥ä½œçº¿ç¨‹%ldæ‹¿åˆ°ä»»åŠ¡ï¼Œå¤„ç†fd = %d\n"</span>,pthread_self(),task.client_fd);
â€‹
        sleep(<span class="hljs-number">5</span>);<span class="hljs-comment">//æ¨¡æ‹Ÿè€—æ—¶çš„è¿ç®—</span>
â€‹
 Â  Â  Â  Â <span class="hljs-type">int</span> len = <span class="hljs-built_in">strlen</span>(task.data);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;len;i++) 
        {
            task.data[i] = <span class="hljs-built_in">toupper</span>(task.data[i]);
        }
        write(task.client_fd,task.data,<span class="hljs-built_in">strlen</span>(task.data));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
 Â  Â signal(SIGPIPE, SIG_IGN);
    signal(SIGINT,sig_handler);
â€‹
    RingBuffer rb;
    rb_init(&amp;rb,<span class="hljs-number">10</span>);
    g_rb = &amp;rb; Â  Â <span class="hljs-comment">//è®©å…¨å±€æŒ‡é’ˆæŒ‡å‘mainçš„rb</span>
â€‹
    <span class="hljs-type">pthread_t</span> threads[THREADS_NUM];
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;THREADS_NUM;i++)
    {
        pthread_create(&amp;threads[i],<span class="hljs-literal">NULL</span>,work_thread,(<span class="hljs-type">void</span> *)&amp;rb);
    }
â€‹
    <span class="hljs-type">int</span> listen_fd,conn_fd,epoll_fd,n_read;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">server_addr</span>;</span>
â€‹
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">epoll_event</span> <span class="hljs-title">ev</span>,<span class="hljs-title">events</span>[<span class="hljs-title">MAX_EVENTS</span>];</span>
â€‹
    listen_fd = socket(AF_INET,SOCK_STREAM,<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(listen_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"socket listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ç›‘å¬socketåˆ›å»ºæˆåŠŸ\n"</span>);
 Â  Â 
 Â  Â <span class="hljs-type">int</span> opt = <span class="hljs-number">1</span>;
    setsockopt(listen_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, <span class="hljs-keyword">sizeof</span>(opt));
â€‹
    <span class="hljs-built_in">memset</span>(&amp;server_addr,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(PORT);
    server_addr.sin_addr.s_addr = htonl(INADDR_ANY);
â€‹
    <span class="hljs-keyword">if</span>(bind(listen_fd,(<span class="hljs-keyword">struct</span> sockaddr *)&amp;server_addr,<span class="hljs-keyword">sizeof</span>(server_addr)) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"bind"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ç»‘å®šæˆåŠŸ\n"</span>);
â€‹
    <span class="hljs-keyword">if</span>(listen(listen_fd,<span class="hljs-number">5</span>) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"listen"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
â€‹
    epoll_fd = epoll_create1(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span>(epoll_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"epoll_create"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"epollå®ä¾‹åˆ›å»ºæˆåŠŸ\n"</span>);
â€‹
    ev.events = EPOLLIN;
    ev.data.fd = listen_fd;
    <span class="hljs-keyword">if</span>(epoll_ctl(epoll_fd,EPOLL_CTL_ADD,listen_fd,&amp;ev) == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"epoll_ctl"</span>);
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"listen_fdæ·»åŠ æˆåŠŸ\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æœåŠ¡å™¨æ­£åœ¨ç›‘å¬%dç«¯å£....\n"</span>,PORT);
â€‹
    <span class="hljs-keyword">while</span>(g_is_running)
    {
        n_read = epoll_wait(epoll_fd,events,MAX_EVENTS,<span class="hljs-number">500</span>);<span class="hljs-comment">//500msè¶…æ—¶</span>
        <span class="hljs-keyword">if</span>(n_read &lt; <span class="hljs-number">0</span>)
        {
            <span class="hljs-keyword">continue</span>;
        }
â€‹
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n_read;i++)
        {
            <span class="hljs-keyword">if</span>(events[i].data.fd == listen_fd)<span class="hljs-comment">//æœ‰æ–°çš„è¿æ¥åˆ°æ¥</span>
            {
                conn_fd = accept(listen_fd,(<span class="hljs-keyword">struct</span> sockaddr *)<span class="hljs-literal">NULL</span>,<span class="hljs-literal">NULL</span>);
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ¥å—æ–°çš„è¿æ¥ï¼Œfd = %d\n"</span>,conn_fd);
                ev.events = EPOLLIN;
                ev.data.fd = conn_fd;
                epoll_ctl(epoll_fd,EPOLL_CTL_ADD,conn_fd,&amp;ev);
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-type">int</span> client_fd = events[i].data.fd;
                Task new_task;
                new_task.client_fd = client_fd;
â€‹
                <span class="hljs-type">ssize_t</span> n = read(new_task.client_fd,new_task.data,BUFFER_SIZE<span class="hljs-number">-1</span>);
â€‹
                <span class="hljs-keyword">if</span>(n == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"å®¢æˆ·ç«¯fd = %d å…³é—­äº†è¿æ¥\n"</span>,client_fd);
                    epoll_ctl(epoll_fd,EPOLL_CTL_DEL,client_fd,<span class="hljs-literal">NULL</span>);
                    close(client_fd);
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n &gt; <span class="hljs-number">0</span>)
                {
                    new_task.data[n] = <span class="hljs-string">'\0'</span>;
                    rb_push(&amp;rb,&amp;new_task);
                }
                <span class="hljs-keyword">else</span>
                {
                    perror(<span class="hljs-string">"read"</span>);
                    close(client_fd);
                }
            }
        }
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ä¸»å¾ªç¯é€€å‡ºï¼Œå‡†å¤‡å…³é—­æœåŠ¡å™¨\n"</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;THREADS_NUM;i++)
    {
        pthread_join(threads[i],<span class="hljs-literal">NULL</span>);
    }
â€‹
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ‰€æœ‰çº¿ç¨‹å·²ç»å…¨éƒ¨é€€å‡º\n"</span>);
    close(listen_fd);
    rb_destroy(&amp;rb);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æœåŠ¡å™¨å·²ç»å…³é—­\n"</span>);
â€‹
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
â€‹
</code></pre>
<p>è¿™æ®µæ ¸å¿ƒä»£ç è™½ç„¶ä¸é•¿ï¼Œä½†å®ƒè¯ é‡Šäº† Reactor æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³ã€‚ä¸‹é¢æˆ‘è¦è§£è¯»ä¸€ä¸‹å…³é”®çš„éƒ¨åˆ†ï¼š</p>
<p>ä¸»çº¿ç¨‹è¿è¡Œåœ¨ <code>epoll</code> äº‹ä»¶å¾ªç¯ä¸­ï¼Œå½“ <code>epoll</code> é€šçŸ¥æœ‰æ•°æ®æ—¶ï¼Œä¸»çº¿ç¨‹è°ƒç”¨ <code>read</code> å°†æ•°æ®ä»å†…æ ¸è¯»åˆ°ç”¨æˆ·æ€å†…å­˜ã€‚ä½†å®ƒè‡ªå·±<strong>ä¸è¿›è¡Œä»»ä½•ä¸šåŠ¡å¤„ç†</strong>ï¼Œè€Œæ˜¯ç«‹åˆ»å°† <code>client_fd</code> å’Œæ•°æ®å°è£…æˆä¸€ä¸ª <code>Task</code>ï¼Œ<code>push</code>è¿› <code>RingBuffer</code>ã€‚</p>
<p>4 ä¸ªå·¥ä½œçº¿ç¨‹ä» <code>RingBuffer</code> ä¸­è·å–ä»»åŠ¡ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œå®ƒä»¬ä¼šæŒ‚èµ·ï¼Œä¸å ç”¨ CPUï¼Œç­‰å¾…<strong>æ¡ä»¶å˜é‡å”¤é†’</strong>ã€‚è¿™é‡Œæˆ‘ç‰¹æ„ç”¨ <code>sleep(5)</code> æ¨¡æ‹Ÿäº†è€—æ—¶çš„ä¸šåŠ¡é€»è¾‘ã€‚åœ¨å‰é¢çš„å•çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œè¿™ä¼šå¯¼è‡´æœåŠ¡å™¨å¡æ­» 5 ç§’ã€‚ä½†åœ¨æœ¬æ¨¡å‹ä¸­ï¼Œè¿™åªæ˜¯<strong>å…¶ä¸­ä¸€ä¸ªå·¥ä½œçº¿ç¨‹</strong>åœ¨ç¡è§‰ï¼Œä¸»çº¿ç¨‹ä¾ç„¶åœ¨é£å¿«åœ°æ¥æ”¶æ–°è¯·æ±‚ï¼Œå…¶ä»–å·¥ä½œçº¿ç¨‹ä¾ç„¶åœ¨å¿™è‡ªå·±çš„äº‹æƒ…ã€‚ä¸šåŠ¡å¤„ç†å®Œæ¯•åï¼Œå·¥ä½œçº¿ç¨‹ç›´æ¥è°ƒç”¨ <code>write</code> å°†ç»“æœå‘å›ç»™å®¢æˆ·ç«¯ï¼Œåˆ°è¿™é‡Œå®Œæˆäº†é—­ç¯ã€‚</p>
<p>è¿˜æœ‰ï¼Œå¯èƒ½æœ‰äººæ³¨æ„åˆ°äº†ï¼Œåœ¨ <code>read</code> æ—¶ï¼Œæˆ‘ä½¿ç”¨äº† <code>BUFFER_SIZE - 1</code>ï¼Œé¢„ç•™äº†ä¸€ä¸ªå­—èŠ‚ç»™å­—ç¬¦ä¸²ç»“æŸç¬¦ <code>\0</code>ï¼Œ<strong>é˜²æ­¢ç¼“å†²åŒºæº¢å‡º</strong>ã€‚</p>
<p>å¦‚æœå®¢æˆ·ç«¯çªç„¶æ–­å¼€ï¼Œå·¥ä½œçº¿ç¨‹è¿˜å¾€é‡Œå†™æ•°æ®ï¼Œå†…æ ¸ä¼šç›´æ¥å‘ä¿¡å·æ€æ‰è¿›ç¨‹ã€‚å› æ­¤æˆ‘è¿˜åœ¨<code>main</code> å‡½æ•°å¼€å¤´æ·»åŠ äº† <code>signal(SIGPIPE, SIG_IGN)</code>ï¼Œé˜²æ­¢å› å®¢æˆ·ç«¯æ„å¤–æ–­å¼€å¯¼è‡´æœåŠ¡å™¨å†™å…¥æ—¶å´©æºƒã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘è¿˜å®ç°äº†ä¼˜é›…é€€å‡ºï¼Œå½“ä½ åœ¨æœåŠ¡å™¨ç«¯æŒ‰ä¸‹<code>Ctrl+C</code>æ—¶ï¼Œç¨‹åºå¹¶ä¸ä¼šç«‹åˆ»é€€å‡ºï¼Œè€Œæ˜¯å»æ‰§è¡Œ<code>sig_handler</code>ä¿¡å·å¤„ç†å‡½æ•°ã€‚è¿”å›åä¸»çº¿ç¨‹ä¼šè·³å‡º<code>while</code>å¾ªç¯ï¼Œå› ä¸ºåœ¨å‡½æ•°<code>rb_stop</code>ä¸­å·²ç»é€šçŸ¥å·¥ä½œçº¿ç¨‹ç»“æŸäº†ï¼Œå› æ­¤ä¸»çº¿ç¨‹åœ¨<code>main</code>å‡½æ•°ä¸­è¦è¿›è¡Œå›æ”¶ï¼Œå›æ”¶å®Œä¹‹åå…³é—­ã€‚</p>
<h3 data-id="heading-21">5.4 æ•ˆæœéªŒè¯</h3>
<p>ä¸ºäº†éªŒè¯è¿™ä¸ªæ¨¡å‹çš„æ•ˆæœï¼Œè¿è¡ŒæœåŠ¡å™¨ç«¯åï¼Œæˆ‘è¿˜æ˜¯åƒå‰é¢ä¸€æ ·å¼€äº†ä¸‰ä¸ªå®¢æˆ·ç«¯å¹¶è¿æ¥ä¸ŠæœåŠ¡å™¨ã€‚ç„¶åæˆ‘å…ˆç»™è¿™ä¸‰ä¸ªå®¢æˆ·ç«¯æ¯ä¸ªéƒ½åˆ†åˆ«è¾“å…¥ä¸€æ®µå†…å®¹ï¼Œä½†æ˜¯å…ˆä¸æŒ‰å›è½¦ï¼Œç­‰è¾“å…¥å®Œäº†ï¼Œé£å¿«çš„åˆ‡æ¢å®¢æˆ·ç«¯å¹¶æŒ‰ä¸‹å›è½¦ã€‚æœ€ç»ˆä¼šå‘ç°ï¼Œå¤§çº¦5ç§’åï¼Œè¿™ä¸‰ä¸ªå®¢æˆ·ç«¯æ˜¯åŒæ—¶æ”¶åˆ°å›å¤çš„ï¼Œè¿™å®Œå…¨è¯´æ˜äº†è¿™ä¸ªæ¨¡å‹çš„å¹¶å‘æ€§ã€‚</p>
<p>å°½ç®¡æ¯ä¸ªä»»åŠ¡éƒ½è¦ç¡ 5 ç§’ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹ä¾ç„¶èƒ½æµç•…åœ°æ¥å—æ–°çš„è¿æ¥è¯·æ±‚ï¼Œæ²¡æœ‰ä¸æ¯«å¡é¡¿ã€‚</p>
<p>è§‚å¯ŸæœåŠ¡å™¨ç«¯çš„æ—¥å¿—ï¼Œå¤„ç† fd=5, fd=6, fd=7 çš„æ˜¯<strong>ä¸åŒçš„å·¥ä½œçº¿ç¨‹</strong>ã€‚è¿™è¯´æ˜çº¿ç¨‹æ± æ­£åœ¨å…¨é€Ÿè¿è½¬ï¼Œæ­£åœ¨è¿›è¡ŒçœŸæ­£çš„å¹¶è¡Œå·¥ä½œã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1956e41a026449ab8a7b572b9c39f6a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=qm1z9CcNsusgLUo6jueFiE4b86I%3D" alt="20. æœ€ç»ˆï¼ˆ1ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/390d6727639c4b54a9a45364c1fa4bc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=Kh9NG0aGhslbIuangNYku50DLYk%3D" alt="21. æœ€ç»ˆï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1ef72ab29b47f48d9321cd1a4654f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=QO2swBqt4KoSkbirQfreJEU1t4U%3D" alt="22. æœ€ç»ˆï¼ˆ3ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f44c6f217fe741848edbd19587f2076e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=L2RjJcSnCn0XJESg8dogEEKRnzI%3D" alt="22. æœ€ç»ˆï¼ˆ3ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c165fa459ac94b358515e49f5de89580~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=RfYfFeEkYoCyxuNABTzURgRPJ0E%3D" alt="23. æœ€ç»ˆï¼ˆ4ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/492fc58f63fd4bf8bc89bc0069a9004a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563880&amp;x-signature=mRt8eK%2B9oTAmnNd9nRQ3Lf3UfLc%3D" alt="24. æœ€ç»ˆï¼ˆ5ï¼‰.png" loading="lazy"/></p>
<p>æœ€åç›´æ¥åœ¨æœåŠ¡å™¨ç«¯æŒ‰ä¸‹Ctrl+Cï¼Œå¯ä»¥çœ‹åˆ°ä¼˜é›…é€€å‡ºçš„ä¿¡æ¯ï¼Œå·¥ä½œçº¿ç¨‹ä¹Ÿä¼šéšä¹‹ç»“æŸã€‚</p>
<h2 data-id="heading-22">6. æ ‡é¢˜æœ‰å…­ä¸ªå­—</h2>
<p>æœ€åå†å›çœ‹æ­£ç¯‡æ–‡ç« ã€‚å¦‚æœç”¨çš„æ˜¯ <code>fork</code> ï¼Œ1 ä¸‡ä¸ªè¿æ¥å°±æ˜¯ 1 ä¸‡ä¸ªè¿›ç¨‹ï¼Œå…‰æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢å°±å¤Ÿ CPU åƒä¸€å£¶å¾—äº†ã€‚è€Œç”¨æˆ‘ä»¬ç°åœ¨çš„ Reactor æ¨¡å‹ï¼Œ1 ä¸‡ä¸ªè¿æ¥åœ¨ <code>epoll</code> çœ¼é‡Œä¸è¿‡æ˜¯çº¢é»‘æ ‘ä¸Šçš„ 1 ä¸‡ä¸ªèŠ‚ç‚¹ï¼Œåªæœ‰çœŸæ­£æ´»è·ƒçš„é‚£å‡ åä¸ªè¿æ¥æ‰ä¼šè§¦å‘å›è°ƒã€‚</p>
<p>æˆ‘æŠŠå®Œæ•´çš„ Reactor æ¨¡å‹çš„æºç æ”¾åœ¨ github é‡Œé¢äº†ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è‡ªå–ï¼Œæ„Ÿè§‰æœ‰å¸®åŠ©çš„æœ‹å‹ä¹Ÿå¯ä»¥ç‚¹ä¸Šä¸€æ‰‹å…³æ³¨</p>
<p>ğŸ‘‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxlp666hub%2FRing-Buffer-and-epoll-used-in-network-code.git" target="_blank" title="https://github.com/xlp666hub/Ring-Buffer-and-epoll-used-in-network-code.git" ref="nofollow noopener noreferrer">æºç ç‚¹å‡»è¿™é‡Œ</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’]]></title>    <link>https://juejin.cn/post/7584379805900210228</link>    <guid>https://juejin.cn/post/7584379805900210228</guid>    <pubDate>2025-12-17T08:27:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805900210228" data-draft-id="7584472215975165967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-17T08:27:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°å‡"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°å‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:27:44.000Z" title="Wed Dec 17 2025 08:27:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<h3 data-id="heading-0">1.Â <strong>æ ¸å¿ƒæ¦‚å¿µ</strong></h3>
<p>å¯é æ€§æŠ•é€’ï¼ˆReliable Deliveryï¼‰æ˜¯æŒ‡ç¡®ä¿æ¶ˆæ¯ä»ç”Ÿäº§è€…æˆåŠŸåˆ°è¾¾æ¶ˆè´¹è€…ï¼Œå³ä½¿é¢å¯¹ç½‘ç»œæ•…éšœã€ç³»ç»Ÿå´©æºƒç­‰å¼‚å¸¸æƒ…å†µä¹Ÿèƒ½ä¿è¯<strong>ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€æŒ‰é¡ºåº</strong>ï¼ˆéƒ¨åˆ†åœºæ™¯ï¼‰ä¼ é€’ã€‚</p>
<h3 data-id="heading-1">2.Â <strong>é¢ä¸´çš„æŒ‘æˆ˜</strong></h3>
<ul>
<li><strong>ç½‘ç»œä¸å¯é </strong>ï¼šä¸¢åŒ…ã€å»¶è¿Ÿã€åˆ†åŒº</li>
<li><strong>èŠ‚ç‚¹æ•…éšœ</strong>ï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…/ä¸­é—´ä»¶å®•æœº</li>
<li><strong>é‡å¤æ¶ˆè´¹</strong>ï¼šç¡®è®¤æœºåˆ¶å¯èƒ½å¼•å‘é‡å¤</li>
<li><strong>é¡ºåºä¿è¯</strong>ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ¶ˆæ¯ä¹±åº</li>
</ul>
<h3 data-id="heading-2">3.Â <strong>å…³é”®å®ç°æœºåˆ¶</strong></h3>
<h4 data-id="heading-3">3.1Â <strong>ç”Ÿäº§ç«¯ä¿è¯</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä¼ªä»£ç ç¤ºä¾‹ï¼šç”Ÿäº§ç«¯ç¡®è®¤æ¨¡å¼</span>
public void <span class="hljs-built_in">sendWithConfirm</span>(Message msg) {
    <span class="hljs-comment">// 1. æŒä¹…åŒ–åˆ°æœ¬åœ°æ•°æ®åº“ï¼ˆé˜²ä¸¢å¤±ï¼‰</span>
    messageDao<span class="hljs-selector-class">.save</span>(msg);
    
    <span class="hljs-comment">// 2. å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—</span>
    String msgId = rabbitTemplate<span class="hljs-selector-class">.convertAndSend</span>(msg);
    
    <span class="hljs-comment">// 3. ç­‰å¾…Brokerç¡®è®¤</span>
    boolean ack = <span class="hljs-built_in">waitForAck</span>(msgId, TIMEOUT);
    
    <span class="hljs-comment">// 4. å¤±è´¥é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰</span>
    if (!ack) {
        <span class="hljs-built_in">retryWithBackoff</span>(msg);
    }
    
    <span class="hljs-comment">// 5. æœ€ç»ˆè®°å½•æŠ•é€’çŠ¶æ€</span>
    <span class="hljs-built_in">updateDeliveryStatus</span>(msgId, ack);
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>
<p><strong>äº‹åŠ¡æœºåˆ¶</strong>ï¼šåŒæ­¥æ–¹å¼ï¼Œæ€§èƒ½å·®ï¼ˆä¸æ¨èï¼‰</p>
</li>
<li>
<p><strong>ç¡®è®¤æœºåˆ¶ï¼ˆConfirmï¼‰</strong> ï¼š</p>
<ul>
<li>æ™®é€šç¡®è®¤ï¼ˆæ¯æ¶ˆæ¯ç¡®è®¤ï¼‰</li>
<li>æ‰¹é‡ç¡®è®¤ï¼ˆæé«˜ååï¼‰</li>
<li>å¼‚æ­¥ç›‘å¬ï¼ˆæœ€ä½³å®è·µï¼‰</li>
</ul>
</li>
<li>
<p><strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong>ï¼šäº‹åŠ¡æ¶ˆæ¯çš„æ›¿ä»£æ–¹æ¡ˆ</p>
</li>
<li>
<p><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šè®¾ç½®<code>delivery_mode=2</code></p>
</li>
</ul>
<h4 data-id="heading-4">3.2Â <strong>Brokerç«¯ä¿è¯</strong></h4>
<pre><code class="hljs">æ¶ˆæ¯å¤„ç†æµç¨‹ï¼š
Producer â†’ Brokeræ¥æ”¶ â†’ æŒä¹…åŒ–å­˜å‚¨ â†’ æ¨é€ç»™Consumer â†’ ç­‰å¾…ACK â†’ åˆ é™¤/é‡æŠ•
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æŒä¹…åŒ–ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>é˜Ÿåˆ—æŒä¹…åŒ–</strong>ï¼š<code>durable=true</code></li>
<li><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼š<code>delivery_mode=2</code></li>
<li><strong>é•œåƒé˜Ÿåˆ—</strong>ï¼šå¤šå‰¯æœ¬å†—ä½™ï¼ˆRabbitMQï¼‰</li>
<li><strong>é«˜å¯ç”¨é›†ç¾¤</strong>ï¼šä¸»ä»åˆ‡æ¢æ—¶ä¸ä¸¢æ¶ˆæ¯</li>
</ul>
<h4 data-id="heading-5">3.3Â <strong>æ¶ˆè´¹ç«¯ä¿è¯</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¶ˆè´¹ç«¯ä¿è¯ç¤ºä¾‹</span>
<span class="hljs-meta">@RabbitListener(queues = "order.queue")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrder</span><span class="hljs-params">(OrderMessage order, Channel channel, 
                       <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> tag)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. ä¸šåŠ¡å¤„ç†</span>
        orderService.process(order);
        
        <span class="hljs-comment">// 2. æ‰‹åŠ¨ç¡®è®¤ï¼ˆæˆåŠŸæ‰ACKï¼‰</span>
        channel.basicAck(tag, <span class="hljs-literal">false</span>);
        
        <span class="hljs-comment">// 3. æ›´æ–°æ¶ˆè´¹è®°å½•</span>
        consumeRecordService.markConsumed(order.getId());
        
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 4. å¤±è´¥å¤„ç†ï¼šé‡è¯•æˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
        <span class="hljs-keyword">if</span> (retryCount &lt; MAX_RETRY) {
            channel.basicNack(tag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// é‡å…¥é˜Ÿåˆ—</span>
        } <span class="hljs-keyword">else</span> {
            channel.basicNack(tag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
            alarmService.notifyAdmin(order, e);
        }
    }
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æ¶ˆè´¹ç«¯å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ‰‹åŠ¨ACK</strong>ï¼šé¿å…è‡ªåŠ¨ç¡®è®¤å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±</li>
<li><strong>å¹‚ç­‰æ€§è®¾è®¡</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">processWithIdempotent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> msgId</span>) {
    <span class="hljs-comment">// åŸºäºæ¶ˆæ¯IDå»é‡</span>
    <span class="hljs-keyword">if</span> (redis.<span class="hljs-title function_">exists</span>(<span class="hljs-string">"processed:"</span> + msgId)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å·²å¤„ç†è¿‡</span>
    }
    
    <span class="hljs-comment">// ä¸šåŠ¡å¤„ç†</span>
    <span class="hljs-built_in">boolean</span> success = <span class="hljs-title function_">doBusinessLogic</span>();
    
    <span class="hljs-comment">// è®°å½•å¤„ç†çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (success) {
        redis.<span class="hljs-title function_">setex</span>(<span class="hljs-string">"processed:"</span> + msgId, 24h, <span class="hljs-string">"1"</span>);
    }
    
    <span class="hljs-keyword">return</span> success;
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>
<p><strong>æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰</strong> ï¼šå¤„ç†æ— æ³•æ¶ˆè´¹çš„æ¶ˆæ¯</p>
</li>
<li>
<p><strong>æ¶ˆè´¹é‡è¯•ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>ç«‹å³é‡è¯•ï¼ˆç¬æ—¶æ•…éšœï¼‰</li>
<li>å»¶è¿Ÿé‡è¯•ï¼ˆä¸šåŠ¡ä¾èµ–ï¼‰</li>
<li>æŒ‡æ•°é€€é¿ï¼ˆé˜²æ­¢é›ªå´©ï¼‰</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">4.Â <strong>å®Œæ•´å¯é æ€§æ–¹æ¡ˆ</strong></h3>
<h4 data-id="heading-7">4.1Â <strong>äº‹åŠ¡æ¶ˆæ¯æ–¹æ¡ˆï¼ˆå¦‚RocketMQï¼‰</strong></h4>
<pre><code class="hljs language-markdown" lang="markdown">ä¸¤é˜¶æ®µæäº¤ï¼š
<span class="hljs-bullet">1.</span> å‘é€Half Messageï¼ˆé¢„å¤‡æ¶ˆæ¯ï¼‰
<span class="hljs-bullet">2.</span> æ‰§è¡Œæœ¬åœ°äº‹åŠ¡
<span class="hljs-bullet">3.</span> æ ¹æ®æœ¬åœ°äº‹åŠ¡ç»“æœCommit/Rollback
<span class="hljs-bullet">4.</span> Brokeræ£€æŸ¥äº‹åŠ¡çŠ¶æ€å¹¶æŠ•é€’/ä¸¢å¼ƒ
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h4 data-id="heading-8">4.2Â <strong>æœ€å¤§åŠªåŠ›æŠ•é€’æ–¹æ¡ˆ</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¡¥å¿æœºåˆ¶å®ç°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">reliable_delivery</span>(<span class="hljs-params">message</span>):
    max_retries = <span class="hljs-number">5</span>
    <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_retries):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># å°è¯•æŠ•é€’</span>
            result = mq_client.send(message)
            
            <span class="hljs-keyword">if</span> result.confirmed:
                log_delivery_success(message.<span class="hljs-built_in">id</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            log_failure(attempt, e)
            
            <span class="hljs-keyword">if</span> attempt == max_retries - <span class="hljs-number">1</span>:
                <span class="hljs-comment"># æœ€ç»ˆå¤±è´¥ï¼Œäººå·¥ä»‹å…¥</span>
                send_alert_to_admin(message)
                save_to_compensation_table(message)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                
            <span class="hljs-comment"># ç­‰å¾…åé‡è¯•</span>
            sleep(backoff_time(attempt))
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h4 data-id="heading-9">4.3Â <strong>æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆï¼ˆç»å…¸ï¼‰</strong></h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æœ¬åœ°æ¶ˆæ¯è¡¨ç»“æ„</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> local_message (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    biz_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>),      <span class="hljs-comment">-- ä¸šåŠ¡ID</span>
    content TEXT,           <span class="hljs-comment">-- æ¶ˆæ¯å†…å®¹</span>
    status TINYINT,         <span class="hljs-comment">-- 0:å¾…å‘é€, 1:å·²å‘é€, 2:å·²ç¡®è®¤</span>
    retry_count <span class="hljs-type">INT</span>,
    next_retry_time DATETIME,
    created_at <span class="hljs-type">TIMESTAMP</span>
);
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li>ä¸šåŠ¡æ•°æ®+æ¶ˆæ¯è®°å½•<strong>åŸå­æ€§</strong>å†™å…¥æœ¬åœ°DB</li>
<li>å®šæ—¶ä»»åŠ¡æ‰«æå¾…å‘é€æ¶ˆæ¯</li>
<li>è°ƒç”¨MQå‘é€ï¼ŒæˆåŠŸåæ›´æ–°çŠ¶æ€</li>
<li>æ¶ˆè´¹è€…å¤„ç†å®Œæˆååå‘ç¡®è®¤</li>
<li>å¯¹è´¦ç¨‹åºå®šæœŸæ ¡éªŒæ•°æ®ä¸€è‡´æ€§</li>
</ol>
<h3 data-id="heading-10">5.Â <strong>é«˜çº§ç‰¹æ€§ä¸ä¼˜åŒ–</strong></h3>
<h4 data-id="heading-11">5.1Â <strong>é¡ºåºæ€§ä¿è¯</strong></h4>
<ul>
<li><strong>å…¨å±€æœ‰åº</strong>ï¼šå•é˜Ÿåˆ—å•æ¶ˆè´¹è€…ï¼ˆæ€§èƒ½ä½ï¼‰</li>
<li><strong>å±€éƒ¨æœ‰åº</strong>ï¼šç›¸åŒsharding keyçš„æ¶ˆæ¯å‘åˆ°åŒä¸€é˜Ÿåˆ—</li>
<li><strong>ç‰ºç‰²åœºæ™¯</strong>ï¼šé‡è¯•é˜Ÿåˆ—å¯èƒ½ç ´åé¡ºåº</li>
</ul>
<h4 data-id="heading-12">5.2Â <strong>æ‰¹é‡æ¶ˆæ¯å¯é æ€§</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ‰¹é‡æ¶ˆæ¯çš„å¯é æ€§å¤„ç†</span>
public class BatchMessageReliableSender {
    
    public void <span class="hljs-built_in">sendBatch</span>(List&lt;Message&gt; batch) {
        <span class="hljs-comment">// 1. æ‰¹é‡æŒä¹…åŒ–åˆ°æœ¬åœ°</span>
        batchMessageDao<span class="hljs-selector-class">.saveAll</span>(batch);
        
        <span class="hljs-comment">// 2. è®¾ç½®æ‰¹æ¬¡ID</span>
        String batchId = <span class="hljs-built_in">generateBatchId</span>();
        
        <span class="hljs-comment">// 3. å‘é€æ‰¹æ¬¡æ¶ˆæ¯</span>
        boolean success = mqTemplate<span class="hljs-selector-class">.sendBatch</span>(batchId, batch);
        
        <span class="hljs-comment">// 4. æ‰¹æ¬¡ç¡®è®¤ï¼ˆæˆ–å•æ¡è¡¥å¿ï¼‰</span>
        if (success) {
            <span class="hljs-built_in">markBatchDelivered</span>(batchId);
        } else {
            <span class="hljs-comment">// é€æ¡é‡è¯•æˆ–è®°å½•å¼‚å¸¸</span>
            <span class="hljs-built_in">compensateFailedMessages</span>(batch);
        }
    }
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h4 data-id="heading-13">5.3Â <strong>ç›‘æ§ä¸å¯¹è´¦</strong></h4>
<ul>
<li>
<p><strong>å®æ—¶ç›‘æ§</strong>ï¼š</p>
<ul>
<li>å †ç§¯æƒ…å†µç›‘æ§</li>
<li>æ¶ˆè´¹å»¶è¿ŸæŠ¥è­¦</li>
<li>å¤±è´¥ç‡ç»Ÿè®¡</li>
</ul>
</li>
<li>
<p>å®šæœŸå¯¹è´¦ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ¶ˆæ¯å¯¹è´¦SQLç¤ºä¾‹</span>
<span class="hljs-keyword">SELECT</span> 
  <span class="hljs-type">DATE</span>(create_time) <span class="hljs-keyword">as</span> <span class="hljs-keyword">day</span>,
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> total_sent,
  <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> status<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> confirmed,
  <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> status<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> pending
<span class="hljs-keyword">FROM</span> message_record
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-type">DATE</span>(create_time)
<span class="hljs-keyword">HAVING</span> total_sent <span class="hljs-operator">!=</span> confirmed;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-14">6.Â <strong>ä¸åŒMQçš„å®ç°å·®å¼‚</strong></h3>



































<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>RabbitMQ</strong></th><th><strong>Kafka</strong></th><th><strong>RocketMQ</strong></th></tr></thead><tbody><tr><td><strong>å¯é æ€§æœºåˆ¶</strong></td><td>ç¡®è®¤+æŒä¹…åŒ–+é•œåƒé˜Ÿåˆ—</td><td>å‰¯æœ¬æœºåˆ¶+ACK+Exactly-Once</td><td>äº‹åŠ¡æ¶ˆæ¯+æœ¬åœ°å­˜å‚¨</td></tr><tr><td><strong>é¡ºåºæ€§</strong></td><td>å•é˜Ÿåˆ—ä¿è¯</td><td>Partitionå†…æœ‰åº</td><td>Queueå†…æœ‰åº</td></tr><tr><td><strong>äº‹åŠ¡æ”¯æŒ</strong></td><td>è½»é‡çº§äº‹åŠ¡ï¼ˆæ€§èƒ½å·®ï¼‰</td><td>æ”¯æŒExactly-Onceè¯­ä¹‰</td><td>å®Œæ•´äº‹åŠ¡æ¶ˆæ¯</td></tr><tr><td><strong>æœ€ä½³é€‚ç”¨åœºæ™¯</strong></td><td>ä¸šåŠ¡æ¶ˆæ¯ã€é«˜å¯é è¦æ±‚</td><td>æ—¥å¿—æµã€å¤§æ•°æ®åœºæ™¯</td><td>é‡‘èäº¤æ˜“ã€è®¢å•ä¸šåŠ¡</td></tr></tbody></table>
<h3 data-id="heading-15">7.Â <strong>å®è·µå»ºè®®</strong></h3>
<ol>
<li>
<p><strong>åˆ†çº§å¯é æ€§ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å…³é”®ä¸šåŠ¡ï¼šäº‹åŠ¡æ¶ˆæ¯+æœ¬åœ°è¡¨+å¯¹è´¦</li>
<li>æ™®é€šä¸šåŠ¡ï¼šç¡®è®¤æœºåˆ¶+é‡è¯•+æ­»ä¿¡é˜Ÿåˆ—</li>
<li>æ—¥å¿—ç±»ï¼šæœ€å¤šä¸€æ¬¡æŠ•é€’å³å¯</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¸å¯é æ€§çš„å¹³è¡¡</strong>ï¼š</p>
<ul>
<li>åŒæ­¥åˆ·ç›˜ vs å¼‚æ­¥åˆ·ç›˜</li>
<li>åŒæ­¥å¤åˆ¶ vs å¼‚æ­¥å¤åˆ¶</li>
<li>æ ¹æ®ä¸šåŠ¡é‡è¦æ€§é€‰æ‹©é…ç½®</li>
</ul>
</li>
<li>
<p><strong>ç¾éš¾æ¢å¤è®¾è®¡ï¼š</strong></p>
</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># é…ç½®ç¤ºä¾‹ï¼šå¤šçº§é™çº§</span>
<span class="hljs-attr">mq:</span>
  <span class="hljs-attr">primary:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">"amqp://primary"</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">1000ms</span>
  <span class="hljs-attr">secondary:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">"amqp://secondary"</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">2000ms</span>
  <span class="hljs-attr">fallback-to-db:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># æœ€ç»ˆé™çº§åˆ°æ•°æ®åº“</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-16">æ€»ç»“</h3>
<p>æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦åœ¨<strong>ç”Ÿäº§ç«¯ã€Brokerç«¯ã€æ¶ˆè´¹ç«¯</strong>ååŒè®¾è®¡ï¼Œç»“åˆ<strong>ä¸šåŠ¡åœºæ™¯ã€æ€§èƒ½è¦æ±‚ã€æˆæœ¬çº¦æŸ</strong>åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚æ²¡æœ‰"é“¶å¼¹"æ–¹æ¡ˆï¼Œåªæœ‰æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚å»ºè®®ä»ç®€å•æ–¹æ¡ˆå¼€å§‹ï¼Œéšç€ä¸šåŠ¡å¤æ‚åº¦å¢åŠ é€æ­¥å¼•å…¥æ›´å®Œå–„çš„å¯é æ€§æœºåˆ¶ã€‚</p>
<h3 data-id="heading-17">é¢è¯•å›ç­”</h3>
<p><strong>é¦–å…ˆï¼Œæ¶ˆæ¯å¯é æ€§æŠ•é€’æŒ‡çš„æ˜¯ï¼š</strong><br/>
ä¸€ä¸ªæ¶ˆæ¯ä»å‘é€åˆ°è¢«æ¶ˆè´¹è€…æˆåŠŸå¤„ç†ï¼Œè¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±æˆ–é‡å¤ï¼Œä¿è¯æœ€ç»ˆæ•°æ®çš„ä¸€è‡´æ€§ã€‚åœ¨å®é™…ç³»ç»Ÿé‡Œï¼Œæ¶ˆæ¯å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜ã€æœåŠ¡é‡å¯ç­‰åŸå› ä¸¢å¤±æˆ–é‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€å¥—æœºåˆ¶æ¥ç¡®ä¿å¯é ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒå‘¢ï¼Ÿ</strong><br/>
æ¯”å¦‚åœ¨è®¢å•ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ”¯ä»˜æˆåŠŸåè¦é€šçŸ¥ç‰©æµç³»ç»Ÿï¼Œå¦‚æœæ¶ˆæ¯ä¸¢äº†ï¼Œç‰©æµå°±ä¸ä¼šè§¦å‘ï¼Œç”¨æˆ·ä½“éªŒå°±å—æŸï¼›å¦‚æœæ¶ˆæ¯é‡å¤ï¼Œå¯èƒ½é‡å¤å‘è´§ï¼Œé€ æˆæŸå¤±ã€‚æ‰€ä»¥åƒé‡‘èã€äº¤æ˜“è¿™äº›åœºæ™¯ï¼Œå¯é æ€§ç‰¹åˆ«é‡è¦ã€‚</p>
<p><strong>å¸¸è§çš„å®ç°æ–¹å¼ï¼Œæˆ‘äº†è§£çš„æœ‰å‡ ç§ï¼š</strong></p>
<ol>
<li><strong>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</strong><br/>
ç”Ÿäº§è€…å‘æ¶ˆæ¯åï¼ŒMQï¼ˆæ¯”å¦‚RabbitMQï¼‰ä¼šè¿”å›ä¸€ä¸ªç¡®è®¤ï¼ˆACKï¼‰ï¼Œå¦‚æœæ²¡æ”¶åˆ°ACKï¼Œç”Ÿäº§è€…å¯ä»¥é‡å‘ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ¶ˆæ¯åœ¨å‘é€é˜¶æ®µä¸¢å¤±ã€‚</li>
<li><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong><br/>
æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ï¼Œè€Œä¸æ˜¯åªæ”¾åœ¨å†…å­˜ã€‚è¿™æ ·å³ä½¿MQé‡å¯ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢ã€‚</li>
<li><strong>æ¶ˆè´¹è€…æ‰‹åŠ¨ACK</strong><br/>
æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œæ‰‹åŠ¨å‘Šè¯‰MQâ€œæˆ‘å·²ç»å¤„ç†å®Œäº†â€ï¼ŒMQæ‰åˆ é™¤æ¶ˆæ¯ï¼›å¦‚æœå¤„ç†å¤±è´¥ï¼ŒMQå¯ä»¥æŠŠæ¶ˆæ¯é‡æ–°æŠ•é€’ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚é¿å…æ¶ˆæ¯åœ¨å¤„ç†é˜¶æ®µä¸¢å¤±ã€‚</li>
<li><strong>äº‹åŠ¡æ¶ˆæ¯ï¼ˆæ¯”å¦‚RocketMQï¼‰</strong><br/>
å…ˆå‘ä¸€ä¸ªâ€œåŠæ¶ˆæ¯â€ï¼Œç­‰æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œå†ç¡®è®¤æŠ•é€’ï¼›å¦‚æœå¤±è´¥ï¼Œå°±å›æ»šã€‚è¿™é€‚ç”¨äºåˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ã€‚</li>
<li><strong>æ¶ˆæ¯å»é‡</strong><br/>
ä¸ºäº†é¿å…é‡å¤æ¶ˆè´¹ï¼Œå¯ä»¥åœ¨æ¶ˆè´¹ç«¯åšå¹‚ç­‰æ€§è®¾è®¡ã€‚æ¯”å¦‚åœ¨æ•°æ®åº“é‡Œè®°å½•æ¶ˆæ¯IDï¼Œæ¯æ¬¡å¤„ç†å‰å…ˆæŸ¥ä¸€ä¸‹æ˜¯å¦å·²ç»å¤„ç†è¿‡ã€‚</li>
</ol>
<p><strong>å®é™…ä¸­æˆ‘ä»¬ä¸€èˆ¬ä¼šç»“åˆä¸šåŠ¡æ¥è®¾è®¡ã€‚</strong><br/>
æ¯”å¦‚ä¸€ä¸ªè®¢å•çŠ¶æ€åŒæ­¥çš„åœºæ™¯ï¼Œæˆ‘å¯èƒ½ä¼šç”¨ï¼šç”Ÿäº§è€…ç¡®è®¤ + æ¶ˆæ¯æŒä¹…åŒ– + æ¶ˆè´¹è€…æ‰‹åŠ¨ACK + æ¶ˆè´¹ç«¯å¹‚ç­‰æ€§ã€‚è¿™æ ·åŸºæœ¬èƒ½è¦†ç›–å‘é€ã€å­˜å‚¨ã€æ¶ˆè´¹å„ä¸ªç¯èŠ‚çš„å¯é æ€§ã€‚</p>
<p><strong>å½“ç„¶ï¼Œå¯é æ€§å’Œæ€§èƒ½ä¹‹é—´éœ€è¦æƒè¡¡</strong>ï¼Œæ¯”å¦‚æŒä¹…åŒ–ä¼šé™ä½ååé‡ï¼Œæ‰‹åŠ¨ACKä¼šå¢åŠ å»¶è¿Ÿã€‚æ‰€ä»¥è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>è¿½åŠ ï¼šé‡åˆ°è¿‡æ¶ˆæ¯ä¸¢å¤±æˆ–é‡å¤çš„é—®é¢˜ï¼Œä½ æ˜¯æ€ä¹ˆæ’æŸ¥å’Œè§£å†³çš„ï¼Ÿ</p>
</blockquote>
<blockquote>
<p>è¿½åŠ ï¼šæ˜¯å¦äº†è§£æœ€ç»ˆä¸€è‡´æ€§ã€æœ€å¤§åŠªåŠ›é€šçŸ¥ç­‰æ¨¡å¼ ï¼Ÿ</p>
</blockquote>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿™ä¸ª GitHub ç¥å™¨è®© Gemini å†™çš„ç½‘ç«™ 3 ç§’ä¸Šçº¿ï¼Œç´¯è®¡éƒ¨ç½² 67 ä¸‡ä¸ªç½‘ç«™ã€‚]]></title>    <link>https://juejin.cn/post/7584357116435267625</link>    <guid>https://juejin.cn/post/7584357116435267625</guid>    <pubDate>2025-12-17T06:07:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584357116435267625" data-draft-id="7584358227611156522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿™ä¸ª GitHub ç¥å™¨è®© Gemini å†™çš„ç½‘ç«™ 3 ç§’ä¸Šçº¿ï¼Œç´¯è®¡éƒ¨ç½² 67 ä¸‡ä¸ªç½‘ç«™ã€‚"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-17T06:07:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€›é€›GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿™ä¸ª GitHub ç¥å™¨è®© Gemini å†™çš„ç½‘ç«™ 3 ç§’ä¸Šçº¿ï¼Œç´¯è®¡éƒ¨ç½² 67 ä¸‡ä¸ªç½‘ç«™ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€›é€›GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:07:31.000Z" title="Wed Dec 17 2025 06:07:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Gemini 3 å‘å¸ƒåä»¤äººæƒŠè‰³çš„æ•ˆæœè¿˜åœ¨æŒç»­å‘é…µã€‚</p>
<p>ç°åœ¨çš„ Gemini 3 å†™å‰ç«¯ä»£ç ï¼Œå°¤å…¶æ˜¯ HTML/Tailwind/JS è¿™ä¸€å¥—å·²ç»å¾ˆå“äººäº†ã€‚ä½ ç»™ä¸ªè‰å›¾æˆ–å‡ å¥äººè¯ï¼Œå®ƒå°±èƒ½ç»™ä½ åå‡ºä¸€å †èƒ½è·‘çš„ä»£ç ã€‚</p>
<p>ç›¸ä¿¡ä½ ä¹Ÿåˆ·åˆ°è¿‡ç±»ä¼¼ä¸‹é¢è¿™ç§ç‚«é…·çš„ Vibe Coding ç½‘ç«™ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d42711765581494aad2ad8da1bb3a05c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=SDddhHlx5k1rcdMqiDPXdUGwMS4%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b53dd27e72e14846a67bf07635a15748~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=2d5V6g3sN0Ei2GMVpcCefRwYydw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¯”å¦‚ä¸Šé¢è¿™ä¸¤ä¸ªï¼Œåƒè´¾ç»´æ–¯ä¸€æ ·æ‰‹åŠ¿æ“æ§ä»ªè¡¨çƒï¼›è¿˜æœ‰æ‰‹åŠ¿æ§åˆ¶ 3D ç²’å­æ—‹è½¬ï¼Œé…·æ¯™äº†ã€‚</p>
<p>æœ¬æ–‡æ•™ä½  3 åˆ†é’Ÿä½¿ç”¨å¼€æºé¡¹ç›® PinMe æŠŠ Gemini ç”Ÿæˆçš„åº”ç”¨éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œå‘ç»™ä½ çš„å¥½æœ‹å‹ï¼Œä»–ä»¬ä¹Ÿèƒ½è®¿é—®ï¼Œä¹Ÿèƒ½ç©ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bdc0c8e7be44979bcc97bbc4afed681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=bWnAkHessgVGELqMApRRAByFRk4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-0">01ã€Gemini ç”Ÿæˆç½‘ç«™</h2>
<p>ä½ å¯ä»¥æ‰“å¼€ aistudio.google.comï¼Œæ‰¾åˆ°ä¾§è¾¹æ çš„ build æ¨¡å¼ã€‚</p>
<p>ç„¶åè¾“å…¥ä½ æƒ³ç”Ÿæˆåº”ç”¨çš„æç¤ºè¯ï¼Œæ¯”å¦‚ï¼šç”Ÿæˆä¸€ä¸ªå¹´ä¼šæŠ½å¥–ç¨‹åºï¼Œè¦æ±‚éå¸¸ç‚«é…·ï¼Œæ”¯æŒåå°ä¸Šä¼  excel å¯¼å…¥äººå‘˜åå•ã€é…ç½®å¥–å“ã€é…ç½®é»˜è®¤ä¸­å¥–äººã€‚ä½ å¯ä»¥æŠŠ AI ç”Ÿæˆçš„ä»£ç ä¸‹è½½ä¸‹æ¥ï¼Œåœ¨ä½ æœ¬åœ°å°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4643daedac049a8911f5ae8bc4575d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=P1jHxkqnQ11EYjGR7h2ha%2FSWhXQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä»¥å‰ä½ æ‹¿åˆ° AI ç”Ÿæˆçš„ä»£ç ï¼Œè¿˜å¾—æŠ˜è…¾ Vercelã€ä¹°æœåŠ¡å™¨ã€é… Nginx æˆ–è€…æ˜¯æ GitHub Pagesï¼ŒæŒºçƒ¦çš„ã€‚</p>
<p>ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨å¼€æºé¡¹ç›® PinMeï¼Œä¸€ä¸ªå‘½ä»¤æŠŠé™æ€ç½‘ç«™å˜æˆä»»ä½•äººå¯è®¿é—®çš„é“¾æ¥ã€‚</p>
<h2 data-id="heading-1">02ã€éƒ¨ç½²ç½‘ç«™</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1acab6a646714bee921e81873457bfa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=LHdb7txMqTP%2Fa4qCGraeAes0E6c%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>PinMe æ˜¯ä¸€ä¸ªä¸€é”®éƒ¨ç½²å·¥å…·ï¼Œå¦‚æœä½ æƒ³æŠŠ AI ç”Ÿæˆçš„ç½‘ç«™éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œå¯ä»¥è€ƒè™‘ç”¨å®ƒã€‚é¦–å…ˆå®‰è£… PinMeï¼š</p>
<pre><code class="hljs">npm install -gÂ pinme
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b4927a97206436894c564a563f13605~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=joN0EnfiVnPYqJ%2B3i2bmfH%2BJIwI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠæœ¬åœ°ç½‘ç«™æ–‡ä»¶éƒ¨ç½²åˆ°çº¿ä¸Šã€‚</p>
<pre><code class="hljs language-bash" lang="bash">pinme upload /path/to/file-or-directory
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421f1f934d434444b1600ea04d44c1f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=OmPsLrsKCZkQD0On1xa3Q5RP%2BsQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™ä¸ªå‘½ä»¤æ•²å‡ºå»ï¼ŒPinMe ä¼šå¼€å§‹å¹²æ´»ï¼ŒæŠŠä½ çš„æ–‡ä»¶ä¸Šä¼ åˆ° IPFS ç½‘ç»œã€‚å‡ ç§’é’Ÿåï¼Œå®ƒä¼šåç»™ä½ ä¸€ä¸ªé“¾æ¥ï¼Œé€šå¸¸æ˜¯Â .eth.limoÂ æˆ–è€… IPFS ç½‘å…³çš„é“¾æ¥ã€‚</p>
<p><strong>è¿™å°±å®Œäº‹äº†ï¼Œä½ çš„ç½‘ç«™å·²ç»åœ¨çº¿ä¸Šäº†ï¼Œå…¨çƒå¯è®¿é—®ã€‚</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/719f646d32ea4abc872a73d944b9fdf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=yykm%2FHzaefRGa%2F%2BXGzrFev3TO8c%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™ç©æ„å„¿ä¸ä»…æ˜¯å¿«ï¼Œè€Œä¸”å¾ˆå¤šæ—¶å€™æ˜¯åŸºäº IPFS çš„ï¼Œè¿™æ„å‘³ç€ä½ çš„ç½‘ç«™æ˜¯é’‰åœ¨ç½‘ç»œä¸Šçš„ï¼Œå¾ˆéš¾è¢«å•ç‚¹å…³åœã€‚</p>
<p>æ²¡æœ‰ä¹±ä¸ƒå…«ç³Ÿçš„å¸¦å®½è´¦å•ï¼Œç‰¹åˆ«é€‚åˆåš Landing Pageã€ä¸ªäººåç‰‡ã€æˆ–è€…ä¸´æ—¶è·‘ä¸ª Demo ç»™å®¢æˆ·çœ‹ã€‚</p>
<p>Gemini 3 å‡ ç§’é’Ÿç”Ÿæˆï¼ŒPinMe å‡ ç§’é’Ÿä¸Šçº¿ï¼Œè¿™æ•ˆç‡è¿™è°å—å¾—äº†ã€‚</p>
<h2 data-id="heading-2">03ã€é¡¹ç›®åŸç†</h2>
<p><strong>PinMe</strong>Â å¯ä»¥ç®€åŒ–å»ä¸­å¿ƒåŒ–å‰ç«¯ï¼ˆDecentralized Frontendï¼‰çš„å‘å¸ƒæµç¨‹ã€‚</p>
<p>ä¸€è¡Œå‘½ä»¤æŠŠè§†é¢‘ã€éŸ³é¢‘ã€å›¾ç‰‡ã€ä»£ç ã€æ–‡ä»¶å¤¹å‘å¸ƒæˆä»»ä½•äººéƒ½èƒ½è®¿é—®çš„é“¾æ¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2df51b90088a4b03976621c782f970e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556450&amp;x-signature=kSYrHgPX2SPgUFvEuE%2BJxv6e674%3D" alt="å›¾ç‰‡" loading="lazy"/>æ„Ÿå…´è¶£çš„å¯ä»¥å»è¿™ä¸ªå¼€æºé¡¹ç›®ä¸»é¡µçœ‹çœ‹ï¼Œæœ‰ç”¨ç‚¹ä¸ª Starã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">å¼€æºåœ°å€ï¼šhttps:<span class="hljs-comment">//github.com/glitternetwork/pinme</span>
</code></pre>
<p>PinMe ä¾èµ–äº Glitter Protocol çš„åŸºç¡€è®¾æ–½æ¥è¿è¡Œï¼šå½“ä½ åœ¨æœ¬åœ°è¿è¡Œå‘½ä»¤æ—¶ï¼ŒPinMe ä¼šè‡ªåŠ¨æ£€æµ‹ä½ çš„é™æ€æ–‡ä»¶ç›®å½•ï¼Œå°†å…¶æ‰“åŒ…å‹ç¼©ã€‚</p>
<p>æ–‡ä»¶ä¼šè¢«ä¸Šä¼ åˆ° IPFS ç½‘ç»œï¼Œå¹¶é€šè¿‡ Glitter Protocol çš„èŠ‚ç‚¹è¿›è¡Œ Pinningï¼ˆé’‰ä½ï¼‰ï¼Œé˜²æ­¢æ•°æ®å› é•¿æ—¶é—´æ— äººè®¿é—®è€Œè¢«ç½‘ç»œåƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤ã€‚</p>
<p>ä¸Šä¼ æˆåŠŸåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª IPFS CIDï¼ˆå†…å®¹æ ‡è¯†ç¬¦ï¼‰ï¼Œä»¥åŠä¸€ä¸ªåŸºäºç½‘å…³çš„å¯è®¿é—® URL</p>
<p>ä¾‹å¦‚Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fipfs.io%2Fipfs%2F" target="_blank" title="https://ipfs.io/ipfs/" ref="nofollow noopener noreferrer">ipfs.io/ipfs/</a>Â æˆ–ç‰¹å®šçš„ç½‘å…³é“¾æ¥ã€‚</p>
<p>é¡¹ç›®æ„¿æ™¯ä¸­åŒ…å«è‡ªåŠ¨æ›´æ–° ENS è®°å½•çš„åŠŸèƒ½ï¼Œè¿™ä½¿å¾—ä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåƒÂ myapp.ethÂ è¿™æ ·æ˜“è¯»çš„å»ä¸­å¿ƒåŒ–åœ°å€ï¼Œè€Œä¸æ˜¯ä¸€é•¿ä¸²ä¹±ç å“ˆå¸Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†æ¬¡ç´§æ€¥ä¿®å¤ï¼ŒFlutter é’ˆå¯¹ WebView æ— æ³•ç‚¹å‡»é—®é¢˜å¢åŠ æ–°çš„å¿«é€Ÿä¿®å¤]]></title>    <link>https://juejin.cn/post/7584443518162141220</link>    <guid>https://juejin.cn/post/7584443518162141220</guid>    <pubDate>2025-12-17T06:42:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518162141220" data-draft-id="7584439538311987263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†æ¬¡ç´§æ€¥ä¿®å¤ï¼ŒFlutter  é’ˆå¯¹ WebView æ— æ³•ç‚¹å‡»é—®é¢˜å¢åŠ æ–°çš„å¿«é€Ÿä¿®å¤"/> <meta itemprop="keywords" content="å‰ç«¯,Android,Flutter"/> <meta itemprop="datePublished" content="2025-12-17T06:42:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹çŒ«deå°éƒ­"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†æ¬¡ç´§æ€¥ä¿®å¤ï¼ŒFlutter  é’ˆå¯¹ WebView æ— æ³•ç‚¹å‡»é—®é¢˜å¢åŠ æ–°çš„å¿«é€Ÿä¿®å¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹çŒ«deå°éƒ­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:42:17.000Z" title="Wed Dec 17 2025 06:42:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰å‡ å¤©æˆ‘ä»¬åˆšèŠäº† <a href="https://juejin.cn/post/7583577045578907674" target="_blank" title="https://juejin.cn/post/7583577045578907674">ã€ŠFlutter å®˜æ–¹æ­£å¼è§£å†³ WebView åœ¨ iOS 26 ä¸Šæœ‰ç‚¹å‡»é—®é¢˜ã€‹</a> ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„åº•å±‚é‡æ„ä¿®å¤ï¼Œæ•´ä¸ªä¿®å¤å‘¨æœŸå®¡æ ¸å ªæ¯”â€œåšå£«è®ºæ–‡â€ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å®ƒåªä¿®å¤äº† Engine å’Œ Framework å±‚é¢é—®é¢˜ï¼Œé‚£æ’ä»¶ç«¯è¿˜éœ€è¦ç­‰å‡çº§é€‚é…ä¿®å¤ï¼Œè¿™é“¾è·¯å°±åˆå†ä¸€æ¬¡æ‹‰é•¿äº†</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e324dc21a954236ae4dab8c75f0fd5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558537&amp;x-signature=6Q5%2BZuyCxRPszbFi4QUp3%2FMgUpg%3D" alt="" loading="lazy"/></p>
<p>æ‰€ä»¥é’ˆå¯¹è¿™ä¸ªåœºæ™¯ï¼Œä½œè€…åˆæäº¤äº†ä¸€ä¸ªâ€œ<strong>éªšæ“ä½œ</strong>â€çš„å¿«é€Ÿä¿®å¤ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F179908" target="_blank" title="https://github.com/flutter/flutter/pull/179908" ref="nofollow noopener noreferrer">#179908 </a>è¿™ä¸ª PR çš„ä¿®å¤æ–¹æ¡ˆéå¸¸â€œæš´åŠ›â€ä½†ä¹Ÿæœ‰æ•ˆï¼š<strong>æ‰¾åˆ°é‚£äº›ç‰¹å®šçš„æ‰‹åŠ¿è¯†åˆ«å™¨ï¼Œå…ˆç¦ç”¨å®ƒä»¬ï¼Œç„¶åç«‹å³é‡æ–°å¯ç”¨</strong>ï¼Œ è¿™ç›¸å½“äºé‡ç½®äº†è¯†åˆ«å™¨çš„çŠ¶æ€ã€‚</p>
<blockquote>
<p>æ˜¯ä¸æ˜¯åˆæœ‰ç†Ÿæ‚‰çš„å‘³é“ï¼Ÿä¸ç†è§£çš„å¯ä»¥çœ‹<a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">ä¸Šä¸Šç¯‡</a>è®²è¿™ä¸ªç‚¹å‡»é—®é¢˜çš„å†…å®¹ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ–°çš„ PR ï¼Ÿ<strong>å› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ— éœ€ä»»ä½•æ’ä»¶æ›´æ–°çš„å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ</strong>ï¼Œå¹¶ä¸”ä¹Ÿå·²ç»åˆå¹¶åˆ°äº† master ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bcf1d65d7b84c0da7c22d12177c5fcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558537&amp;x-signature=hNVWtKC5A1%2BuV1QmyBWPdN0K%2B78%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸ª PR å…·ä½“çš„ä»£ç ä¿®æ”¹å°±æ˜¯ï¼šåœ¨ <code>FlutterTouchInterceptingView</code> ä¸­æ·»åŠ äº†ä¸¤ä¸ªæ ¸å¿ƒçš„è¾…åŠ©æ–¹æ³•ï¼Œå¹¶åœ¨ <code>blockGesture</code> ä¸­è°ƒç”¨ï¼š</p>
<ul>
<li>
<p><code>searchAndFixWebView</code> : ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå®ƒä¼šéå†è§†å›¾å±‚çº§ï¼Œå¦‚æœé‡åˆ°çš„è§†å›¾æ˜¯ <code>WKWebView</code> ç±»å‹ï¼Œå®ƒå°±ä¼šè°ƒç”¨ä¿®å¤æ‰‹åŠ¿çš„æ–¹æ³•ï¼Œæ‰§è¡Œ <code>searchAndFixWebViewGestureRecognzier</code> ï¼Œç¡®ä¿å³ä½¿ <code>WKWebView</code> è¢«åµŒå¥—åœ¨å…¶ä»– <code>UIView</code> ä¸­ä¹Ÿèƒ½è¢«æ‰¾åˆ°</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc18dd77e90488c92f7ec2a06854a4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558537&amp;x-signature=KXN4NrgBcXXK%2Fp7SB0ThTzJIRDc%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><code>searchAndFixWebViewGestureRecognzier</code> : ä¹Ÿæ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œéå†å½“å‰è§†å›¾çš„æ‰€æœ‰ <code>gestureRecognizers</code> ï¼Œæ£€æŸ¥è¯†åˆ«å™¨æ˜¯å¦å¯ç”¨ï¼Œå¹¶ä¸”ç±»åæ˜¯å¦ç”¨ <code>"TouchEventsGestureRecognizer"</code> ç»“å°¾ (é€šå¸¸å¯¹åº” <code>WKTouchEventsGestureRecognizer</code>) ï¼Œç„¶åæ‰§è¡Œ <code>recognizer.enabled</code> çš„å…³é—­å’Œæ‰“å¼€æ“ä½œï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64d358d0000246d98068fbd89e1009f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558537&amp;x-signature=tCHO1n3ZG%2BaUfyFENIE3lnAVSt4%3D" alt="" loading="lazy"/></p>
</li>
</ul>

<ul>
<li>ä¿®æ”¹äº† <code>blockGesture </code>, å½“æ‰‹åŠ¿æ‹¦æˆªç­–ç•¥ä¸º <code>FlutterPlatformViewGestureRecognizersBlockingPolicyEager</code>æ—¶ï¼Œåœ¨ iOS 26 æ”¹ä¸ºç›´æ¥è°ƒç”¨ <code>[self searchAndFixWebView:self.embeddedView];</code> æ¥æ‰§è¡Œä¸Šè¿°ä¿®å¤é€»è¾‘ï¼š<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09d9d5d146954ddb8fabb8ecf3b1245a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558537&amp;x-signature=n%2FzfCk48%2BMe91qQLBU0FYPf1Ab0%3D" alt="" loading="lazy"/></li>
</ul>
<p>æœ€åï¼Œæ–¹æ¡ˆè¿˜å¢åŠ äº†ä¸€ä¸ª <strong><code>FLTDisableWebViewGestureReset</code></strong> ï¼Œç»™å¼€å‘è€…æ·»åŠ äº†ä¸€ä¸ªå®‰å…¨é˜€ï¼Œé€šè¿‡è¯»å– <code>Info.plist</code> ä¸­çš„ <code>FLTDisableWebViewGestureReset</code> ï¼Œå¦‚æœè¿™ä¸ªä¿®å¤æ–¹æ¡ˆä¸Šçº¿åå‡ºç°ä¸¥é‡é—®é¢˜ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡é…ç½®è¿™ä¸ª flag æ¥ç¦ç”¨è¿™ä¸ªâ€œé‡ç½®æ‰‹åŠ¿â€çš„é€»è¾‘ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿä¸”ç²—æš´çš„æ”¹åŠ¨ï¼Œå°±æ˜¯åœ¨ <code>FlutterPlatformViews.mm</code> ä¸­å®ç°äº†é’ˆå¯¹ <code>WKWebView</code> æ‰‹åŠ¿è¯†åˆ«å™¨çš„é€’å½’æœç´¢å’Œâ€œé‡å¯â€æœºåˆ¶ï¼Œå¹¶åœ¨ <code>blockGesture</code> ä¸­é’ˆå¯¹ iOS 26+ å¯ç”¨äº†è¿™ä¸ªæœºåˆ¶</strong>ã€‚</p>
<p>ä½†æ˜¯å¥½å¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¯ä»¥ä»€ä¹ˆæ’ä»¶éƒ½ä¸æ”¹å°±ç”Ÿæ•ˆï¼Œå½“ç„¶ä¸»è¦æ˜¯ä¸€ä¸ªä¸´æ—¶ä¿®å¤ï¼Œä¸ºçš„æ˜¯æ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿè§£å†³é—®é¢˜ï¼ŒçœŸæ­£ fix çš„é€”å¾„è¿˜æ˜¯æ¨èèµ°ä¹‹å‰çš„ hitTest ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8263b6a3dea428c9cb7e869eff6d4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558537&amp;x-signature=13Cm%2BrCf1CKbCLeNKP2nF%2BuIeZk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">å‚è€ƒé“¾æ¥</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F179908" target="_blank" title="https://github.com/flutter/flutter/pull/179908" ref="nofollow noopener noreferrer">github.com/flutter/fluâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµè§ˆå™¨å­˜å‚¨ APIï¼šå…¨é¢è§£æä¸é«˜çº§å®è·µ]]></title>    <link>https://juejin.cn/post/7584439538312052799</link>    <guid>https://juejin.cn/post/7584439538312052799</guid>    <pubDate>2025-12-17T06:45:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584439538312052799" data-draft-id="7584439538312036415" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµè§ˆå™¨å­˜å‚¨ APIï¼šå…¨é¢è§£æä¸é«˜çº§å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-17T06:45:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024è‚¥å®…"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµè§ˆå™¨å­˜å‚¨ APIï¼šå…¨é¢è§£æä¸é«˜çº§å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024è‚¥å®…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:45:27.000Z" title="Wed Dec 17 2025 06:45:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æµè§ˆå™¨å­˜å‚¨ APIï¼šå…¨é¢è§£æä¸é«˜çº§å®è·µ</p>
<h4 data-id="heading-0">å¼•è¨€</h4>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œæµè§ˆå™¨å­˜å‚¨æ˜¯æ„å»ºä¸°å¯Œã€ç¦»çº¿å¯ç”¨ã€é«˜æ€§èƒ½åº”ç”¨çš„å…³é”®æŠ€æœ¯ã€‚ä»ç®€å•çš„é”®å€¼å¯¹å­˜å‚¨åˆ°å¤æ‚çš„æ•°æ®åº“æ“ä½œï¼Œæµè§ˆå™¨æä¾›äº†å¤šç§å­˜å‚¨æ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å„ç§æµè§ˆå™¨å­˜å‚¨APIï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç‰¹æ€§ã€ä½¿ç”¨åœºæ™¯ã€æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µã€‚</p>
<h4 data-id="heading-1">ä¸€ã€æœ¬åœ°å­˜å‚¨çš„ç°ä»£å°è£…</h4>
<h5 data-id="heading-2">1.1 å¢å¼ºå‹ localStorage/sessionStorage å°è£…</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">storageType = <span class="hljs-string">'localStorage'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span> = <span class="hljs-variable language_">window</span>[storageType];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span> = <span class="hljs-string">'app_'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupInterval</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// åˆå§‹åŒ–å­˜å‚¨ç®¡ç†å™¨</span>
  <span class="hljs-title function_">init</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-keyword">const</span> {
      prefix = <span class="hljs-string">'app_'</span>,
      encryptionKey = <span class="hljs-literal">null</span>,
      compressionThreshold = <span class="hljs-number">1024</span>, <span class="hljs-comment">// 1KB</span>
      cleanupInterval = <span class="hljs-number">60000</span> <span class="hljs-comment">// 1åˆ†é’Ÿ</span>
    } = options;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span> = prefix;
    
    <span class="hljs-keyword">if</span> (encryptionKey) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">enableEncryption</span>(encryptionKey);
    }
    
    <span class="hljs-keyword">if</span> (compressionThreshold &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionThreshold</span> = compressionThreshold;
    }

    <span class="hljs-comment">// å¯åŠ¨è¿‡æœŸæ•°æ®æ¸…ç†</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startCleanupInterval</span>(cleanupInterval);

    <span class="hljs-comment">// ç›‘å¬storageäº‹ä»¶å®ç°è·¨æ ‡ç­¾é¡µåŒæ­¥</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStorageEvent</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// ç”Ÿæˆå¸¦å‰ç¼€çš„é”®å</span>
  <span class="hljs-title function_">getPrefixedKey</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.prefix}</span><span class="hljs-subst">${key}</span>`</span>;
  }

  <span class="hljs-comment">// åºåˆ—åŒ–æ•°æ®</span>
  <span class="hljs-title function_">serialize</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> serialized = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      data,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0'</span>
    });

    <span class="hljs-comment">// å‹ç¼©å¤§æ–‡æœ¬æ•°æ®</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span> &amp;&amp; serialized.<span class="hljs-property">length</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionThreshold</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compress</span>(serialized);
    }

    <span class="hljs-keyword">return</span> serialized;
  }

  <span class="hljs-comment">// ååºåˆ—åŒ–æ•°æ®</span>
  <span class="hljs-title function_">deserialize</span>(<span class="hljs-params">serialized</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> data = serialized;
      
      <span class="hljs-comment">// è§£å‹ç¼©ï¼ˆå¦‚æœæœ‰å‹ç¼©ï¼‰</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCompressed</span>(serialized)) {
        data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decompress</span>(serialized);
      }

      <span class="hljs-keyword">const</span> parsed = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
      
      <span class="hljs-comment">// éªŒè¯æ•°æ®å®Œæ•´æ€§</span>
      <span class="hljs-keyword">if</span> (!parsed.<span class="hljs-property">data</span> || !parsed.<span class="hljs-property">timestamp</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid data format'</span>);
      }

      <span class="hljs-keyword">return</span> parsed.<span class="hljs-property">data</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Failed to deserialize data:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// æ•°æ®å‹ç¼©</span>
  <span class="hljs-title function_">compress</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ç®€å•çš„å‹ç¼©ç®—æ³•ï¼Œå®é™…é¡¹ç›®ä¸­å¯ä½¿ç”¨pakoç­‰åº“</span>
      <span class="hljs-keyword">const</span> base64 = <span class="hljs-title function_">btoa</span>(<span class="hljs-built_in">encodeURIComponent</span>(text));
      <span class="hljs-keyword">return</span> <span class="hljs-string">`compressed:<span class="hljs-subst">${base64}</span>`</span>;
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-keyword">return</span> text;
    }
  }

  <span class="hljs-comment">// æ•°æ®è§£å‹ç¼©</span>
  <span class="hljs-title function_">decompress</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">if</span> (!text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'compressed:'</span>)) <span class="hljs-keyword">return</span> text;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> base64 = text.<span class="hljs-title function_">slice</span>(<span class="hljs-number">11</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-title function_">atob</span>(base64));
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-keyword">return</span> text;
    }
  }

  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å‹ç¼©</span>
  <span class="hljs-title function_">isCompressed</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'compressed:'</span>);
  }

  <span class="hljs-comment">// è®¾ç½®æ•°æ®</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value, options = {}</span>) {
    <span class="hljs-keyword">const</span> {
      ttl = <span class="hljs-literal">null</span>, <span class="hljs-comment">// è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
      encrypt = <span class="hljs-literal">false</span>
    } = options;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> prefixedKey = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPrefixedKey</span>(key);
      <span class="hljs-keyword">let</span> processedValue = value;

      <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">if</span> (encrypt &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span>) {
        processedValue = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encryptData</span>(value);
      }

      <span class="hljs-keyword">const</span> serialized = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">serialize</span>(processedValue);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">setItem</span>(prefixedKey, serialized);

      <span class="hljs-comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span>
      <span class="hljs-keyword">if</span> (ttl) {
        <span class="hljs-keyword">const</span> expiryTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + ttl;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span>.<span class="hljs-title function_">set</span>(prefixedKey, expiryTime);
      }

      <span class="hljs-comment">// é€šçŸ¥è§‚å¯Ÿè€…</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(key, value, <span class="hljs-string">'set'</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set storage item:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-comment">// è·å–æ•°æ®</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">key, defaultValue = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> prefixedKey = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPrefixedKey</span>(key);
      <span class="hljs-keyword">const</span> serialized = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">getItem</span>(prefixedKey);

      <span class="hljs-keyword">if</span> (serialized === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> defaultValue;
      }

      <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isExpired</span>(prefixedKey)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>(key);
        <span class="hljs-keyword">return</span> defaultValue;
      }

      <span class="hljs-keyword">let</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deserialize</span>(serialized);

      <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">'string'</span> &amp;&amp; data.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'encrypted:'</span>)) {
        data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decryptData</span>(data);
      }

      <span class="hljs-keyword">return</span> data;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get storage item:'</span>, error);
      <span class="hljs-keyword">return</span> defaultValue;
    }
  }

  <span class="hljs-comment">// åˆ é™¤æ•°æ®</span>
  <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">const</span> prefixedKey = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPrefixedKey</span>(key);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">removeItem</span>(prefixedKey);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span>.<span class="hljs-title function_">delete</span>(prefixedKey);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(key, <span class="hljs-literal">null</span>, <span class="hljs-string">'remove'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆä¿ç•™å‰ç¼€ï¼‰</span>
  <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> keysToRemove = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> key = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">key</span>(i);
      <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>)) {
        keysToRemove.<span class="hljs-title function_">push</span>(key);
      }
    }

    keysToRemove.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">removeItem</span>(key);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span>.<span class="hljs-title function_">delete</span>(key);
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(<span class="hljs-string">'*'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'clear'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// æ£€æŸ¥æ•°æ®æ˜¯å¦è¿‡æœŸ</span>
  <span class="hljs-title function_">isExpired</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">const</span> expiryTime = <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span>.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (!expiryTime) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt; expiryTime;
  }

  <span class="hljs-comment">// å¯ç”¨åŠ å¯†</span>
  <span class="hljs-title function_">enableEncryption</span>(<span class="hljs-params">encryptionKey</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span> === <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Web Crypto API not available, encryption disabled'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionKey</span> = encryptionKey;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">encryptData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> textEncoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
      <span class="hljs-keyword">const</span> dataBuffer = textEncoder.<span class="hljs-title function_">encode</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
      
      <span class="hljs-comment">// ç”Ÿæˆéšæœºçš„åˆå§‹åŒ–å‘é‡</span>
      <span class="hljs-keyword">const</span> iv = <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-title function_">getRandomValues</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">12</span>));
      
      <span class="hljs-comment">// å¯¼å…¥å¯†é’¥</span>
      <span class="hljs-keyword">const</span> keyMaterial = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span>.importKey(
        <span class="hljs-string">'raw'</span>,
        textEncoder.<span class="hljs-title function_">encode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionKey</span>),
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'PBKDF2'</span> },
        <span class="hljs-literal">false</span>,
        [<span class="hljs-string">'deriveKey'</span>]
      );
      
      <span class="hljs-comment">// æ´¾ç”Ÿå¯†é’¥</span>
      <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">deriveKey</span>(
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'PBKDF2'</span>,
          <span class="hljs-attr">salt</span>: textEncoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">'storage-salt'</span>),
          <span class="hljs-attr">iterations</span>: <span class="hljs-number">100000</span>,
          <span class="hljs-attr">hash</span>: <span class="hljs-string">'SHA-256'</span>
        },
        keyMaterial,
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>, <span class="hljs-attr">length</span>: <span class="hljs-number">256</span> },
        <span class="hljs-literal">false</span>,
        [<span class="hljs-string">'encrypt'</span>, <span class="hljs-string">'decrypt'</span>]
      );
      
      <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> encryptedBuffer = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">encrypt</span>(
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>,
          <span class="hljs-attr">iv</span>: iv
        },
        key,
        dataBuffer
      );
      
      <span class="hljs-comment">// ç»„åˆIVå’ŒåŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> combinedBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(iv.<span class="hljs-property">length</span> + encryptedBuffer.<span class="hljs-property">byteLength</span>);
      combinedBuffer.<span class="hljs-title function_">set</span>(iv, <span class="hljs-number">0</span>);
      combinedBuffer.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(encryptedBuffer), iv.<span class="hljs-property">length</span>);
      
      <span class="hljs-comment">// è½¬æ¢ä¸ºbase64å­—ç¬¦ä¸²</span>
      <span class="hljs-keyword">const</span> base64String = <span class="hljs-title function_">btoa</span>(<span class="hljs-title class_">String</span>.<span class="hljs-property">fromCharCode</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, combinedBuffer));
      <span class="hljs-keyword">return</span> <span class="hljs-string">`encrypted:<span class="hljs-subst">${base64String}</span>`</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Encryption failed:'</span>, error);
      <span class="hljs-keyword">return</span> data;
    }
  }

  <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">decryptData</span>(<span class="hljs-params">encryptedString</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!encryptedString.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'encrypted:'</span>)) {
        <span class="hljs-keyword">return</span> encryptedString;
      }
      
      <span class="hljs-keyword">const</span> base64String = encryptedString.<span class="hljs-title function_">slice</span>(<span class="hljs-number">10</span>);
      <span class="hljs-keyword">const</span> combinedBuffer = <span class="hljs-title class_">Uint8Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title function_">atob</span>(base64String), <span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>));
      
      <span class="hljs-comment">// æå–IVå’ŒåŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> iv = combinedBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">12</span>);
      <span class="hljs-keyword">const</span> encryptedBuffer = combinedBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">12</span>);
      
      <span class="hljs-keyword">const</span> textEncoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
      <span class="hljs-keyword">const</span> keyMaterial = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span>.importKey(
        <span class="hljs-string">'raw'</span>,
        textEncoder.<span class="hljs-title function_">encode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionKey</span>),
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'PBKDF2'</span> },
        <span class="hljs-literal">false</span>,
        [<span class="hljs-string">'deriveKey'</span>]
      );
      
      <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">deriveKey</span>(
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'PBKDF2'</span>,
          <span class="hljs-attr">salt</span>: textEncoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">'storage-salt'</span>),
          <span class="hljs-attr">iterations</span>: <span class="hljs-number">100000</span>,
          <span class="hljs-attr">hash</span>: <span class="hljs-string">'SHA-256'</span>
        },
        keyMaterial,
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>, <span class="hljs-attr">length</span>: <span class="hljs-number">256</span> },
        <span class="hljs-literal">false</span>,
        [<span class="hljs-string">'encrypt'</span>, <span class="hljs-string">'decrypt'</span>]
      );
      
      <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> decryptedBuffer = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">decrypt</span>(
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>,
          <span class="hljs-attr">iv</span>: iv
        },
        key,
        encryptedBuffer
      );
      
      <span class="hljs-keyword">const</span> textDecoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
      <span class="hljs-keyword">const</span> decryptedString = textDecoder.<span class="hljs-title function_">decode</span>(decryptedBuffer);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(decryptedString);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Decryption failed:'</span>, error);
      <span class="hljs-keyword">return</span> encryptedString;
    }
  }

  <span class="hljs-comment">// æ·»åŠ è§‚å¯Ÿè€…</span>
  <span class="hljs-title function_">observe</span>(<span class="hljs-params">key, callback</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">has</span>(key)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">set</span>(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(key).<span class="hljs-title function_">add</span>(callback);
    
    <span class="hljs-comment">// è¿”å›å–æ¶ˆè§‚å¯Ÿçš„å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> observers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(key);
      <span class="hljs-keyword">if</span> (observers) {
        observers.<span class="hljs-title function_">delete</span>(callback);
        <span class="hljs-keyword">if</span> (observers.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">delete</span>(key);
        }
      }
    };
  }

  <span class="hljs-comment">// é€šçŸ¥è§‚å¯Ÿè€…</span>
  <span class="hljs-title function_">notifyObservers</span>(<span class="hljs-params">key, value, action</span>) {
    <span class="hljs-comment">// é€šçŸ¥ç‰¹å®šé”®çš„è§‚å¯Ÿè€…</span>
    <span class="hljs-keyword">const</span> keyObservers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (keyObservers) {
      keyObservers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
        <span class="hljs-title function_">callback</span>(value, action, key);
      });
    }

    <span class="hljs-comment">// é€šçŸ¥å…¨å±€è§‚å¯Ÿè€…</span>
    <span class="hljs-keyword">const</span> globalObservers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'*'</span>);
    <span class="hljs-keyword">if</span> (globalObservers) {
      globalObservers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
        <span class="hljs-title function_">callback</span>(value, action, key);
      });
    }
  }

  <span class="hljs-comment">// å¤„ç†storageäº‹ä»¶</span>
  <span class="hljs-title function_">handleStorageEvent</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">storageArea</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> key = event.<span class="hljs-property">key</span>;
    <span class="hljs-keyword">if</span> (key &amp;&amp; key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>)) {
      <span class="hljs-keyword">const</span> unprefixedKey = key.<span class="hljs-title function_">slice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>.<span class="hljs-property">length</span>);
      <span class="hljs-keyword">const</span> value = event.<span class="hljs-property">newValue</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(unprefixedKey) : <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">const</span> action = event.<span class="hljs-property">newValue</span> ? <span class="hljs-string">'set'</span> : <span class="hljs-string">'remove'</span>;
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(unprefixedKey, value, action);
    }
  }

  <span class="hljs-comment">// å¯åŠ¨æ¸…ç†å®šæ—¶å™¨</span>
  <span class="hljs-title function_">startCleanupInterval</span>(<span class="hljs-params">interval</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupInterval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanupExpired</span>();
    }, interval);
  }

  <span class="hljs-comment">// æ¸…ç†è¿‡æœŸæ•°æ®</span>
  <span class="hljs-title function_">cleanupExpired</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> expiredKeys = [];
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">expiryTime, key</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (now &gt; expiryTime) {
        expiredKeys.<span class="hljs-title function_">push</span>(key);
      }
    });
    
    expiredKeys.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> unprefixedKey = key.<span class="hljs-title function_">slice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>.<span class="hljs-property">length</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>(unprefixedKey);
    });
    
    <span class="hljs-keyword">if</span> (expiredKeys.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Cleaned up <span class="hljs-subst">${expiredKeys.length}</span> expired items`</span>);
    }
  }

  <span class="hljs-comment">// è·å–å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯</span>
  <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> totalSize = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> itemCount = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> key = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">key</span>(i);
      <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>)) {
        <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">getItem</span>(key);
        totalSize += (key.<span class="hljs-property">length</span> + value.<span class="hljs-property">length</span>) * <span class="hljs-number">2</span>; <span class="hljs-comment">// UTF-16å­—ç¬¦å 2å­—èŠ‚</span>
        itemCount++;
      }
    }
    
    <span class="hljs-keyword">return</span> {
      totalSize,
      itemCount,
      <span class="hljs-attr">estimatedRemaining</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> - totalSize, <span class="hljs-comment">// å‡è®¾5MBé™åˆ¶</span>
      <span class="hljs-attr">usagePercentage</span>: (totalSize / (<span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)) * <span class="hljs-number">100</span>
    };
  }

  <span class="hljs-comment">// æ‰¹é‡æ“ä½œ</span>
  <span class="hljs-title function_">batch</span>(<span class="hljs-params">operations</span>) {
    <span class="hljs-keyword">return</span> operations.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">results, operation</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { type, key, value, options } = operation;
      <span class="hljs-keyword">let</span> result;
      
      <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'set'</span>:
          result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(key, value, options);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'get'</span>:
          result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(key);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'remove'</span>:
          result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>(key);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          result = <span class="hljs-literal">null</span>;
      }
      
      results.<span class="hljs-title function_">push</span>({ key, result });
      <span class="hljs-keyword">return</span> results;
    }, []);
  }

  <span class="hljs-comment">// è·å–æ‰€æœ‰é”®</span>
  <span class="hljs-title function_">keys</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> keys = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> key = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-title function_">key</span>(i);
      <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>)) {
        keys.<span class="hljs-title function_">push</span>(key.<span class="hljs-title function_">slice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>.<span class="hljs-property">length</span>));
      }
    }
    <span class="hljs-keyword">return</span> keys;
  }

  <span class="hljs-comment">// å¯¼å‡ºæ‰€æœ‰æ•°æ®</span>
  <span class="hljs-title function_">export</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = {};
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">keys</span>()) {
      data[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(key);
    }
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0'</span>,
      <span class="hljs-attr">prefix</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">prefix</span>,
      data
    };
  }

  <span class="hljs-comment">// å¯¼å…¥æ•°æ®</span>
  <span class="hljs-title function_">import</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">if</span> (!data || !data.<span class="hljs-property">data</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid import data'</span>);
    }
    
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(data.<span class="hljs-property">data</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(key, value);
    });
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// é”€æ¯å®ä¾‹</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupInterval</span>) {
      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupInterval</span>);
    }
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStorageEvent</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">expiryTimes</span>.<span class="hljs-title function_">clear</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºå­˜å‚¨ç®¡ç†å™¨</span>
    <span class="hljs-keyword">const</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StorageManager</span>(<span class="hljs-string">'localStorage'</span>);
    
    <span class="hljs-comment">// åˆå§‹åŒ–</span>
    storage.<span class="hljs-title function_">init</span>({
      <span class="hljs-attr">prefix</span>: <span class="hljs-string">'myapp_'</span>,
      <span class="hljs-attr">encryptionKey</span>: <span class="hljs-string">'my-secret-key-123'</span>,
      <span class="hljs-attr">compressionThreshold</span>: <span class="hljs-number">500</span>,
      <span class="hljs-attr">cleanupInterval</span>: <span class="hljs-number">30000</span>
    });
    
    <span class="hljs-comment">// è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„æ•°æ®</span>
    storage.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user'</span>, {
      <span class="hljs-attr">id</span>: <span class="hljs-number">123</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>
    }, { <span class="hljs-attr">ttl</span>: <span class="hljs-number">3600000</span> }); <span class="hljs-comment">// 1å°æ—¶åè¿‡æœŸ</span>
    
    <span class="hljs-comment">// è®¾ç½®åŠ å¯†æ•°æ®</span>
    storage.<span class="hljs-title function_">set</span>(<span class="hljs-string">'token'</span>, <span class="hljs-string">'secret-token-abc'</span>, { <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">true</span> });
    
    <span class="hljs-comment">// è·å–æ•°æ®</span>
    <span class="hljs-keyword">const</span> user = storage.<span class="hljs-title function_">get</span>(<span class="hljs-string">'user'</span>);
    <span class="hljs-keyword">const</span> token = storage.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User:'</span>, user);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Token:'</span>, token);
    
    <span class="hljs-comment">// è§‚å¯Ÿæ•°æ®å˜åŒ–</span>
    <span class="hljs-keyword">const</span> unsubscribe = storage.<span class="hljs-title function_">observe</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">(<span class="hljs-params">value, action</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User data <span class="hljs-subst">${action}</span>:`</span>, value);
    });
    
    <span class="hljs-comment">// æ‰¹é‡æ“ä½œ</span>
    <span class="hljs-keyword">const</span> results = storage.<span class="hljs-title function_">batch</span>([
      { <span class="hljs-attr">type</span>: <span class="hljs-string">'set'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'setting1'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'value1'</span> },
      { <span class="hljs-attr">type</span>: <span class="hljs-string">'set'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'setting2'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'value2'</span> },
      { <span class="hljs-attr">type</span>: <span class="hljs-string">'get'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'setting1'</span> },
      { <span class="hljs-attr">type</span>: <span class="hljs-string">'remove'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'setting2'</span> }
    ]);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Batch results:'</span>, results);
    
    <span class="hljs-comment">// è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> stats = storage.<span class="hljs-title function_">getStats</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Storage stats:'</span>, stats);
    
    <span class="hljs-comment">// å¯¼å‡ºæ•°æ®</span>
    <span class="hljs-keyword">const</span> exported = storage.<span class="hljs-title function_">export</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Exported data:'</span>, exported);
    
    <span class="hljs-comment">// å–æ¶ˆè§‚å¯Ÿ</span>
    <span class="hljs-title function_">unsubscribe</span>();
    
    <span class="hljs-keyword">return</span> storage;
  }
}
</code></pre>
<h5 data-id="heading-3">1.2 å­˜å‚¨ç±»å‹è‡ªåŠ¨é€‰æ‹©å™¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartStorage</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = {
      <span class="hljs-attr">memoryLimit</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// å†…å­˜ç¼“å­˜é¡¹æ•°é™åˆ¶</span>
      <span class="hljs-attr">fallbackOrder</span>: [<span class="hljs-string">'memory'</span>, <span class="hljs-string">'localStorage'</span>, <span class="hljs-string">'sessionStorage'</span>, <span class="hljs-string">'cookie'</span>],
      <span class="hljs-attr">defaultTTL</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// é»˜è®¤24å°æ—¶è¿‡æœŸ</span>
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span> = {
      <span class="hljs-attr">memory</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
      <span class="hljs-attr">localStorage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>,
      <span class="hljs-attr">sessionStorage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>,
      <span class="hljs-attr">cookie</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createCookieHandler</span>()
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span> = {
      <span class="hljs-attr">hits</span>: { <span class="hljs-attr">memory</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">localStorage</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">sessionStorage</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">cookie</span>: <span class="hljs-number">0</span> },
      <span class="hljs-attr">misses</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">writes</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">deletes</span>: <span class="hljs-number">0</span>
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }
  
  <span class="hljs-title function_">createCookieHandler</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">setItem</span>: <span class="hljs-function">(<span class="hljs-params">key, value, days = <span class="hljs-number">7</span></span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> expires = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + days * <span class="hljs-number">864e5</span>).<span class="hljs-title function_">toUTCString</span>();
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(key)}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(value)}</span>; expires=<span class="hljs-subst">${expires}</span>; path=/`</span>;
      },
      <span class="hljs-attr">getItem</span>: <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> match = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">match</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">'(^| )'</span> + key + <span class="hljs-string">'=([^;]+)'</span>));
        <span class="hljs-keyword">return</span> match ? <span class="hljs-built_in">decodeURIComponent</span>(match[<span class="hljs-number">2</span>]) : <span class="hljs-literal">null</span>;
      },
      <span class="hljs-attr">removeItem</span>: <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">`<span class="hljs-subst">${key}</span>=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`</span>;
      }
    };
  }
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å°è¯•æ£€æµ‹å­˜å‚¨å¯ç”¨æ€§</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">detectStorageAvailability</span>();
    
    <span class="hljs-comment">// è®¾ç½®å†…å­˜ç¼“å­˜æ¸…ç†å®šæ—¶å™¨</span>
    <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanupMemoryCache</span>(), <span class="hljs-number">60000</span>);
  }
  
  <span class="hljs-title function_">detectStorageAvailability</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> results = {};
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> testKey = <span class="hljs-string">'__storage_test__'</span>;
      results.<span class="hljs-property">localStorage</span> = (<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(testKey, testKey);
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">removeItem</span>(testKey);
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      })();
      
      results.<span class="hljs-property">sessionStorage</span> = (<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(testKey, testKey);
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">removeItem</span>(testKey);
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      })();
      
      results.<span class="hljs-property">cookie</span> = navigator.<span class="hljs-property">cookieEnabled</span>;
      
      <span class="hljs-keyword">return</span> results;
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">localStorage</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">sessionStorage</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">cookie</span>: <span class="hljs-literal">false</span>
      };
    }
  }
  
  <span class="hljs-comment">// æ™ºèƒ½è®¾ç½®æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value, options = {}</span>) {
    <span class="hljs-keyword">const</span> {
      ttl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">defaultTTL</span>,
      priority = <span class="hljs-string">'normal'</span>, <span class="hljs-comment">// 'low', 'normal', 'high', 'critical'</span>
      persist = <span class="hljs-literal">true</span>,
      compress = <span class="hljs-literal">false</span>
    } = options;
    
    <span class="hljs-keyword">const</span> storageMeta = {
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">expiry</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + ttl,
      priority,
      persist,
      compress,
      value
    };
    
    <span class="hljs-comment">// æ€»æ˜¯æ›´æ–°å†…å­˜ç¼“å­˜</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateMemoryCache</span>(key, storageMeta);
    
    <span class="hljs-comment">// æ ¹æ®ä¼˜å…ˆçº§å’ŒæŒä¹…åŒ–é€‰é¡¹é€‰æ‹©å­˜å‚¨åç«¯</span>
    <span class="hljs-keyword">if</span> (persist) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">persistToStorage</span>(key, storageMeta);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">writes</span>++;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-title function_">updateMemoryCache</span>(<span class="hljs-params">key, meta</span>) {
    <span class="hljs-comment">// æ£€æŸ¥å†…å­˜é™åˆ¶</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">memoryLimit</span>) {
      <span class="hljs-keyword">const</span> oldestKey = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">shift</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">delete</span>(oldestKey);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">set</span>(key, meta);
    
    <span class="hljs-comment">// æ›´æ–°é˜Ÿåˆ—é¡ºåº</span>
    <span class="hljs-keyword">const</span> existingIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">indexOf</span>(key);
    <span class="hljs-keyword">if</span> (existingIndex &gt; -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">splice</span>(existingIndex, <span class="hljs-number">1</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">push</span>(key);
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">persistToStorage</span>(<span class="hljs-params">key, meta</span>) {
    <span class="hljs-keyword">const</span> storageValue = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">data</span>: meta.<span class="hljs-property">value</span>,
      <span class="hljs-attr">meta</span>: {
        <span class="hljs-attr">timestamp</span>: meta.<span class="hljs-property">timestamp</span>,
        <span class="hljs-attr">expiry</span>: meta.<span class="hljs-property">expiry</span>,
        <span class="hljs-attr">priority</span>: meta.<span class="hljs-property">priority</span>,
        <span class="hljs-attr">compress</span>: meta.<span class="hljs-property">compress</span>
      }
    });
    
    <span class="hljs-comment">// æ ¹æ®ä¼˜å…ˆçº§é€‰æ‹©å­˜å‚¨åç«¯</span>
    <span class="hljs-keyword">let</span> storageBackend = <span class="hljs-string">'localStorage'</span>;
    
    <span class="hljs-keyword">if</span> (meta.<span class="hljs-property">priority</span> === <span class="hljs-string">'critical'</span>) {
      <span class="hljs-comment">// å…³é”®æ•°æ®å­˜å‚¨åˆ°å¤šä¸ªåç«¯</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">localStorage</span>) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(key, storageValue);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'localStorage full, trying sessionStorage'</span>);
        }
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">sessionStorage</span>) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(key, storageValue);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'sessionStorage full, trying cookies'</span>);
        }
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">cookie</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">setItem</span>(key, storageValue, <span class="hljs-number">7</span>); <span class="hljs-comment">// 7å¤©</span>
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (meta.<span class="hljs-property">priority</span> === <span class="hljs-string">'high'</span>) {
      storageBackend = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">localStorage</span> ? <span class="hljs-string">'localStorage'</span> : 
                       <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">sessionStorage</span> ? <span class="hljs-string">'sessionStorage'</span> : <span class="hljs-string">'cookie'</span>;
    } <span class="hljs-keyword">else</span> {
      storageBackend = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">fallbackOrder</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">backend</span> =&gt;</span> 
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>[backend] !== <span class="hljs-literal">false</span>
      ) || <span class="hljs-string">'memory'</span>;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (storageBackend === <span class="hljs-string">'cookie'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">setItem</span>(key, storageValue, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>((meta.<span class="hljs-property">expiry</span> - <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()) / <span class="hljs-number">86400000</span>));
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (storageBackend === <span class="hljs-string">'localStorage'</span> || storageBackend === <span class="hljs-string">'sessionStorage'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>[storageBackend].<span class="hljs-title function_">setItem</span>(key, storageValue);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Failed to persist to <span class="hljs-subst">${storageBackend}</span>:`</span>, error);
      
      <span class="hljs-comment">// å°è¯•ä¸‹ä¸€ä¸ªåå¤‡å­˜å‚¨</span>
      <span class="hljs-keyword">const</span> nextBackend = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">fallbackOrder</span>[
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">fallbackOrder</span>.<span class="hljs-title function_">indexOf</span>(storageBackend) + <span class="hljs-number">1</span>
      ];
      <span class="hljs-keyword">if</span> (nextBackend) {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">persistToStorage</span>(key, { ...meta, <span class="hljs-attr">storageBackend</span>: nextBackend });
      }
    }
  }
  
  <span class="hljs-comment">// æ™ºèƒ½è·å–æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">key, options = {}</span>) {
    <span class="hljs-keyword">const</span> { forceFresh = <span class="hljs-literal">false</span> } = options;
    
    <span class="hljs-comment">// é¦–å…ˆæ£€æŸ¥å†…å­˜ç¼“å­˜</span>
    <span class="hljs-keyword">if</span> (!forceFresh &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">has</span>(key)) {
      <span class="hljs-keyword">const</span> cached = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">get</span>(key);
      
      <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt; cached.<span class="hljs-property">expiry</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">delete</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">misses</span>++;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ›´æ–°è®¿é—®æ—¶é—´</span>
        cached.<span class="hljs-property">lastAccessed</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">hits</span>.<span class="hljs-property">memory</span>++;
        
        <span class="hljs-comment">// ç§»åŠ¨åˆ°æœ€åï¼ˆLRUï¼‰</span>
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">indexOf</span>(key);
        <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">push</span>(key);
        }
        
        <span class="hljs-keyword">return</span> cached.<span class="hljs-property">value</span>;
      }
    }
    
    <span class="hljs-comment">// ä»æŒä¹…åŒ–å­˜å‚¨ä¸­æŸ¥æ‰¾</span>
    <span class="hljs-keyword">let</span> result = <span class="hljs-literal">null</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> backend <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">fallbackOrder</span>) {
      <span class="hljs-keyword">if</span> (backend === <span class="hljs-string">'memory'</span>) <span class="hljs-keyword">continue</span>;
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">let</span> storedValue = <span class="hljs-literal">null</span>;
        
        <span class="hljs-keyword">if</span> (backend === <span class="hljs-string">'cookie'</span>) {
          storedValue = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">getItem</span>(key);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (backend === <span class="hljs-string">'localStorage'</span> || backend === <span class="hljs-string">'sessionStorage'</span>) {
          storedValue = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>[backend].<span class="hljs-title function_">getItem</span>(key);
        }
        
        <span class="hljs-keyword">if</span> (storedValue) {
          <span class="hljs-keyword">const</span> parsed = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(storedValue);
          
          <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt; parsed.<span class="hljs-property">meta</span>.<span class="hljs-property">expiry</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>(key); <span class="hljs-comment">// åˆ é™¤è¿‡æœŸæ•°æ®</span>
            <span class="hljs-keyword">continue</span>;
          }
          
          result = parsed.<span class="hljs-property">data</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">hits</span>[backend]++;
          
          <span class="hljs-comment">// æ›´æ–°åˆ°å†…å­˜ç¼“å­˜</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateMemoryCache</span>(key, {
            <span class="hljs-attr">value</span>: result,
            <span class="hljs-attr">timestamp</span>: parsed.<span class="hljs-property">meta</span>.<span class="hljs-property">timestamp</span>,
            <span class="hljs-attr">expiry</span>: parsed.<span class="hljs-property">meta</span>.<span class="hljs-property">expiry</span>,
            <span class="hljs-attr">priority</span>: parsed.<span class="hljs-property">meta</span>.<span class="hljs-property">priority</span>,
            <span class="hljs-attr">persist</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">compress</span>: parsed.<span class="hljs-property">meta</span>.<span class="hljs-property">compress</span>
          });
          
          <span class="hljs-keyword">break</span>;
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Error reading from <span class="hljs-subst">${backend}</span>:`</span>, error);
        <span class="hljs-keyword">continue</span>;
      }
    }
    
    <span class="hljs-keyword">if</span> (result === <span class="hljs-literal">null</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">misses</span>++;
    }
    
    <span class="hljs-keyword">return</span> result;
  }
  
  <span class="hljs-comment">// åˆ é™¤æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-comment">// ä»æ‰€æœ‰å­˜å‚¨åç«¯åˆ é™¤</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">delete</span>(key);
    
    <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">indexOf</span>(key);
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">localStorage</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">removeItem</span>(key);
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">sessionStorage</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">removeItem</span>(key);
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">cookie</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">removeItem</span>(key);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">deletes</span>++;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// æ¸…ç†å†…å­˜ç¼“å­˜</span>
  <span class="hljs-title function_">cleanupMemoryCache</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">let</span> cleaned = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, meta] <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">entries</span>()) {
      <span class="hljs-keyword">if</span> (now &gt; meta.<span class="hljs-property">expiry</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">delete</span>(key);
        cleaned++;
      }
    }
    
    <span class="hljs-comment">// å¦‚æœä»ç„¶è¶…è¿‡é™åˆ¶ï¼Œç§»é™¤æœ€æ—§çš„é¡¹</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">memoryLimit</span>) {
      <span class="hljs-keyword">const</span> toRemove = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-property">length</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">memoryLimit</span>);
      toRemove.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">delete</span>(key);
      });
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">memoryLimit</span>);
      cleaned += toRemove.<span class="hljs-property">length</span>;
    }
    
    <span class="hljs-keyword">if</span> (cleaned &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Cleaned <span class="hljs-subst">${cleaned}</span> items from memory cache`</span>);
    }
  }
  
  <span class="hljs-comment">// è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯</span>
  <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> memoryItems = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">entries</span>());
    
    <span class="hljs-keyword">return</span> {
      ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>,
      <span class="hljs-attr">memory</span>: {
        <span class="hljs-attr">items</span>: memoryItems.<span class="hljs-property">length</span>,
        <span class="hljs-attr">hits</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">hits</span>.<span class="hljs-property">memory</span>,
        <span class="hljs-attr">oldest</span>: memoryItems.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? 
          <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((now - memoryItems[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>].<span class="hljs-property">timestamp</span>) / <span class="hljs-number">1000</span>) : <span class="hljs-number">0</span>,
        <span class="hljs-attr">newest</span>: memoryItems.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? 
          <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((now - memoryItems[memoryItems.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>].<span class="hljs-property">timestamp</span>) / <span class="hljs-number">1000</span>) : <span class="hljs-number">0</span>
      },
      <span class="hljs-attr">localStorage</span>: {
        <span class="hljs-attr">available</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">localStorage</span>,
        <span class="hljs-attr">hits</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">hits</span>.<span class="hljs-property">localStorage</span>
      },
      <span class="hljs-attr">sessionStorage</span>: {
        <span class="hljs-attr">available</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">sessionStorage</span>,
        <span class="hljs-attr">hits</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">hits</span>.<span class="hljs-property">sessionStorage</span>
      },
      <span class="hljs-attr">cookie</span>: {
        <span class="hljs-attr">available</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">cookie</span>,
        <span class="hljs-attr">hits</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-property">hits</span>.<span class="hljs-property">cookie</span>
      }
    };
  }
  
  <span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰å­˜å‚¨</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">memory</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryQueue</span> = [];
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">localStorage</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">clear</span>();
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">sessionStorage</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">storages</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">clear</span>();
    }
    
    <span class="hljs-comment">// æ¸…é™¤cookieéœ€è¦ç‰¹æ®Šå¤„ç†</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageAvailable</span>.<span class="hljs-property">cookie</span>) {
      <span class="hljs-keyword">const</span> cookies = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">';'</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> cookie <span class="hljs-keyword">of</span> cookies) {
        <span class="hljs-keyword">const</span> eqPos = cookie.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'='</span>);
        <span class="hljs-keyword">const</span> name = eqPos &gt; -<span class="hljs-number">1</span> ? cookie.<span class="hljs-title function_">substr</span>(<span class="hljs-number">0</span>, eqPos).<span class="hljs-title function_">trim</span>() : cookie.<span class="hljs-title function_">trim</span>();
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">`<span class="hljs-subst">${name}</span>=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`</span>;
      }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
}
</code></pre>
<h4 data-id="heading-4">äºŒã€IndexedDB é«˜çº§å°è£…</h4>
<h5 data-id="heading-5">2.1 å®Œæ•´çš„ IndexedDB åŒ…è£…å™¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexedDBManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">dbName, version = <span class="hljs-number">1</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbName</span> = dbName;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">version</span> = version;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transactions</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">processingQueue</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">autoIncrementCounters</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">migrationRegistry</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    
    <span class="hljs-comment">// æ³¨å†Œäº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = {
      <span class="hljs-attr">onUpgradeNeeded</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
      <span class="hljs-attr">onSuccess</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
      <span class="hljs-attr">onError</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
      <span class="hljs-attr">onVersionChange</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    };
  }
  
  <span class="hljs-comment">// æ³¨å†Œæ•°æ®åº“è¿ç§»</span>
  <span class="hljs-title function_">registerMigration</span>(<span class="hljs-params">fromVersion, toVersion, migration</span>) {
    <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${fromVersion}</span>_<span class="hljs-subst">${toVersion}</span>`</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">migrationRegistry</span>.<span class="hljs-title function_">set</span>(key, migration);
  }
  
  <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®åº“</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">schema = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dbName</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">version</span>);
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'IndexedDB opening error:'</span>, event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-property">onError</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>));
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span> = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`IndexedDB <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dbName}</span> opened successfully`</span>);
        
        <span class="hljs-comment">// ç›‘å¬ç‰ˆæœ¬å˜åŒ–</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">onversionchange</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Database version changed, closing connections'</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-property">onVersionChange</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(event));
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">close</span>();
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-property">onSuccess</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>));
        <span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>);
      };
      
      request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">const</span> oldVersion = event.<span class="hljs-property">oldVersion</span>;
        <span class="hljs-keyword">const</span> newVersion = event.<span class="hljs-property">newVersion</span>;
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Upgrading database from <span class="hljs-subst">${oldVersion}</span> to <span class="hljs-subst">${newVersion}</span>`</span>);
        
        <span class="hljs-comment">// æ‰§è¡Œæ³¨å†Œçš„è¿ç§»</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeMigrations</span>(db, oldVersion, newVersion);
        
        <span class="hljs-comment">// åº”ç”¨æ–°æ¨¡å¼</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applySchema</span>(db, schema);
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>.<span class="hljs-property">onUpgradeNeeded</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(event));
      };
    });
  }
  
  <span class="hljs-comment">// æ‰§è¡Œè¿ç§»</span>
  <span class="hljs-title function_">executeMigrations</span>(<span class="hljs-params">db, oldVersion, newVersion</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> version = oldVersion; version &lt; newVersion; version++) {
      <span class="hljs-keyword">const</span> migrationKey = <span class="hljs-string">`<span class="hljs-subst">${version}</span>_<span class="hljs-subst">${version + <span class="hljs-number">1</span>}</span>`</span>;
      <span class="hljs-keyword">const</span> migration = <span class="hljs-variable language_">this</span>.<span class="hljs-property">migrationRegistry</span>.<span class="hljs-title function_">get</span>(migrationKey);
      
      <span class="hljs-keyword">if</span> (migration) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Executing migration <span class="hljs-subst">${migrationKey}</span>`</span>);
        <span class="hljs-keyword">try</span> {
          <span class="hljs-title function_">migration</span>(db, version, version + <span class="hljs-number">1</span>);
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Migration <span class="hljs-subst">${migrationKey}</span> failed:`</span>, error);
          <span class="hljs-keyword">throw</span> error;
        }
      }
    }
  }
  
  <span class="hljs-comment">// åº”ç”¨æ•°æ®åº“æ¨¡å¼</span>
  <span class="hljs-title function_">applySchema</span>(<span class="hljs-params">db, schema</span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(schema).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[storeName, storeConfig]</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!db.<span class="hljs-property">objectStoreNames</span>.<span class="hljs-title function_">contains</span>(storeName)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Creating object store: <span class="hljs-subst">${storeName}</span>`</span>);
        
        <span class="hljs-keyword">const</span> { keyPath = <span class="hljs-string">'id'</span>, autoIncrement = <span class="hljs-literal">true</span>, indices = [] } = storeConfig;
        <span class="hljs-keyword">const</span> store = db.<span class="hljs-title function_">createObjectStore</span>(storeName, { keyPath, autoIncrement });
        
        <span class="hljs-comment">// åˆ›å»ºç´¢å¼•</span>
        indices.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">indexConfig</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> { name, keyPath, unique = <span class="hljs-literal">false</span>, multiEntry = <span class="hljs-literal">false</span> } = indexConfig;
          store.<span class="hljs-title function_">createIndex</span>(name, keyPath, { unique, multiEntry });
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span>.<span class="hljs-title function_">set</span>(storeName, { ...storeConfig, store });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ›´æ–°ç°æœ‰å­˜å‚¨</span>
        <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readwrite'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
        
        <span class="hljs-keyword">const</span> existingIndices = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(store.<span class="hljs-property">indexNames</span>);
        <span class="hljs-keyword">const</span> { indices = [] } = storeConfig;
        
        <span class="hljs-comment">// æ·»åŠ æ–°ç´¢å¼•</span>
        indices.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">indexConfig</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (!existingIndices.<span class="hljs-title function_">includes</span>(indexConfig.<span class="hljs-property">name</span>)) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Creating index <span class="hljs-subst">${indexConfig.name}</span> on <span class="hljs-subst">${storeName}</span>`</span>);
            store.<span class="hljs-title function_">createIndex</span>(
              indexConfig.<span class="hljs-property">name</span>,
              indexConfig.<span class="hljs-property">keyPath</span>,
              { <span class="hljs-attr">unique</span>: indexConfig.<span class="hljs-property">unique</span> || <span class="hljs-literal">false</span>, <span class="hljs-attr">multiEntry</span>: indexConfig.<span class="hljs-property">multiEntry</span> || <span class="hljs-literal">false</span> }
            );
          }
        });
      }
    });
  }
  
  <span class="hljs-comment">// æ·»åŠ æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">storeName, data</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readwrite'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      
      <span class="hljs-comment">// ç”ŸæˆIDï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
      <span class="hljs-keyword">let</span> processedData = { ...data };
      <span class="hljs-keyword">const</span> storeConfig = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span>.<span class="hljs-title function_">get</span>(storeName);
      
      <span class="hljs-keyword">if</span> (storeConfig.<span class="hljs-property">autoIncrement</span> &amp;&amp; !processedData[storeConfig.<span class="hljs-property">keyPath</span>]) {
        <span class="hljs-keyword">const</span> counter = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAutoIncrementCounter</span>(storeName);
        processedData[storeConfig.<span class="hljs-property">keyPath</span>] = counter;
      }
      
      <span class="hljs-keyword">const</span> request = store.<span class="hljs-title function_">add</span>(processedData);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">id</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>, <span class="hljs-attr">data</span>: processedData });
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// æ‰¹é‡æ·»åŠ æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">addBulk</span>(<span class="hljs-params">storeName, items</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readwrite'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">const</span> results = [];
      
      items.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> processedItem = { ...item };
        <span class="hljs-keyword">const</span> storeConfig = <span class="hljs-variable language_">this</span>.<span class="hljs-property">stores</span>.<span class="hljs-title function_">get</span>(storeName);
        
        <span class="hljs-keyword">if</span> (storeConfig.<span class="hljs-property">autoIncrement</span> &amp;&amp; !processedItem[storeConfig.<span class="hljs-property">keyPath</span>]) {
          <span class="hljs-keyword">const</span> counter = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAutoIncrementCounter</span>(storeName, index);
          processedItem[storeConfig.<span class="hljs-property">keyPath</span>] = counter;
        }
        
        <span class="hljs-keyword">const</span> request = store.<span class="hljs-title function_">add</span>(processedItem);
        
        request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          results.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">id</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>, <span class="hljs-attr">data</span>: processedItem });
          
          <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === items.<span class="hljs-property">length</span>) {
            <span class="hljs-title function_">resolve</span>(results);
          }
        };
        
        request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
        };
      });
    });
  }
  
  <span class="hljs-comment">// è·å–æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">storeName, key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readonly'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">const</span> request = store.<span class="hljs-title function_">get</span>(key);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// é€šè¿‡ç´¢å¼•æŸ¥è¯¢</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getByIndex</span>(<span class="hljs-params">storeName, indexName, value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readonly'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">const</span> index = store.<span class="hljs-title function_">index</span>(indexName);
      <span class="hljs-keyword">const</span> request = index.<span class="hljs-title function_">get</span>(value);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAll</span>(<span class="hljs-params">storeName, query = <span class="hljs-literal">null</span>, count = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readonly'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">let</span> request;
      
      <span class="hljs-keyword">if</span> (query) {
        <span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createRange</span>(query);
        request = store.<span class="hljs-title function_">getAll</span>(range, count);
      } <span class="hljs-keyword">else</span> {
        request = store.<span class="hljs-title function_">getAll</span>();
      }
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// åˆ›å»ºIDBKeyRange</span>
  <span class="hljs-title function_">createRange</span>(<span class="hljs-params">query</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> query === <span class="hljs-string">'object'</span>) {
      <span class="hljs-keyword">if</span> (query.<span class="hljs-property">lower</span> &amp;&amp; query.<span class="hljs-property">upper</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">bound</span>(query.<span class="hljs-property">lower</span>, query.<span class="hljs-property">upper</span>, query.<span class="hljs-property">lowerOpen</span>, query.<span class="hljs-property">upperOpen</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (query.<span class="hljs-property">lower</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">lowerBound</span>(query.<span class="hljs-property">lower</span>, query.<span class="hljs-property">open</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (query.<span class="hljs-property">upper</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">upperBound</span>(query.<span class="hljs-property">upper</span>, query.<span class="hljs-property">open</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (query.<span class="hljs-property">only</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">only</span>(query.<span class="hljs-property">only</span>);
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">only</span>(query);
  }
  
  <span class="hljs-comment">// æ›´æ–°æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">storeName, key, updates</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// å…ˆè·å–ç°æœ‰æ•°æ®</span>
        <span class="hljs-keyword">const</span> existing = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(storeName, key);
        <span class="hljs-keyword">if</span> (!existing) {
          <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Record with key <span class="hljs-subst">${key}</span> not found`</span>));
          <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readwrite'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
        <span class="hljs-keyword">const</span> updatedData = { ...existing, ...updates, <span class="hljs-attr">_updatedAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
        
        <span class="hljs-keyword">const</span> request = store.<span class="hljs-title function_">put</span>(updatedData);
        
        request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          <span class="hljs-title function_">resolve</span>(updatedData);
        };
        
        request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
        };
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-title function_">reject</span>(error);
      }
    });
  }
  
  <span class="hljs-comment">// åˆ é™¤æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">storeName, key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readwrite'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">const</span> request = store.<span class="hljs-title function_">delete</span>(key);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// æ¸…ç©ºå­˜å‚¨</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">clearStore</span>(<span class="hljs-params">storeName</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readwrite'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">const</span> request = store.<span class="hljs-title function_">clear</span>();
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// è®¡æ•°</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">storeName, query = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readonly'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">let</span> request;
      
      <span class="hljs-keyword">if</span> (query) {
        <span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createRange</span>(query);
        request = store.<span class="hljs-title function_">count</span>(range);
      } <span class="hljs-keyword">else</span> {
        request = store.<span class="hljs-title function_">count</span>();
      }
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// æ¸¸æ ‡éå†</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">cursor</span>(<span class="hljs-params">storeName, callback, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> { direction = <span class="hljs-string">'next'</span>, range = <span class="hljs-literal">null</span>, indexName = <span class="hljs-literal">null</span> } = options;
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>([storeName], <span class="hljs-string">'readonly'</span>);
      <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(storeName);
      <span class="hljs-keyword">let</span> source = store;
      
      <span class="hljs-keyword">if</span> (indexName) {
        source = store.<span class="hljs-title function_">index</span>(indexName);
      }
      
      <span class="hljs-keyword">const</span> rangeObj = range ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createRange</span>(range) : <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">const</span> request = source.<span class="hljs-title function_">openCursor</span>(rangeObj, direction);
      <span class="hljs-keyword">const</span> results = [];
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> cursor = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">if</span> (cursor) {
          <span class="hljs-keyword">const</span> shouldContinue = <span class="hljs-title function_">callback</span>(cursor.<span class="hljs-property">value</span>, cursor);
          results.<span class="hljs-title function_">push</span>(cursor.<span class="hljs-property">value</span>);
          
          <span class="hljs-keyword">if</span> (shouldContinue !== <span class="hljs-literal">false</span>) {
            cursor.<span class="hljs-title function_">continue</span>();
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">resolve</span>(results);
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>(results);
        }
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
    });
  }
  
  <span class="hljs-comment">// æ‰¹é‡æ“ä½œäº‹åŠ¡</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">transaction</span>(<span class="hljs-params">operations</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-comment">// è·å–æ‰€æœ‰æ¶‰åŠçš„å­˜å‚¨åç§°</span>
      <span class="hljs-keyword">const</span> storeNames = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(operations.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">op</span> =&gt;</span> op.<span class="hljs-property">store</span>))];
      
      <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">transaction</span>(storeNames, <span class="hljs-string">'readwrite'</span>);
      <span class="hljs-keyword">const</span> results = [];
      <span class="hljs-keyword">let</span> errorOccurred = <span class="hljs-literal">false</span>;
      
      transaction.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        errorOccurred = <span class="hljs-literal">true</span>;
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
      
      transaction.<span class="hljs-property">oncomplete</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!errorOccurred) {
          <span class="hljs-title function_">resolve</span>(results);
        }
      };
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> operation <span class="hljs-keyword">of</span> operations) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> { store, type, data, key, updates } = operation;
          <span class="hljs-keyword">const</span> objectStore = transaction.<span class="hljs-title function_">objectStore</span>(store);
          <span class="hljs-keyword">let</span> request;
          
          <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'add'</span>:
              request = objectStore.<span class="hljs-title function_">add</span>(data);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'put'</span>:
              request = objectStore.<span class="hljs-title function_">put</span>(data);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'get'</span>:
              request = objectStore.<span class="hljs-title function_">get</span>(key);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'delete'</span>:
              request = objectStore.<span class="hljs-title function_">delete</span>(key);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'update'</span>:
              <span class="hljs-comment">// å¯¹äºæ›´æ–°ï¼Œéœ€è¦å…ˆè·å–å†æ›´æ–°</span>
              <span class="hljs-keyword">const</span> getRequest = objectStore.<span class="hljs-title function_">get</span>(key);
              getRequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> existing = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
                <span class="hljs-keyword">if</span> (existing) {
                  <span class="hljs-keyword">const</span> updated = { ...existing, ...updates };
                  objectStore.<span class="hljs-title function_">put</span>(updated);
                }
              };
              <span class="hljs-keyword">continue</span>;
            <span class="hljs-attr">default</span>:
              <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unknown operation type: <span class="hljs-subst">${type}</span>`</span>);
          }
          
          request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            results.<span class="hljs-title function_">push</span>({
              store,
              type,
              <span class="hljs-attr">result</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>,
              <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>
            });
          };
          
          request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            results.<span class="hljs-title function_">push</span>({
              store,
              type,
              <span class="hljs-attr">error</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>,
              <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>
            });
          };
        } <span class="hljs-keyword">catch</span> (error) {
          results.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">store</span>: operation.<span class="hljs-property">store</span>,
            <span class="hljs-attr">type</span>: operation.<span class="hljs-property">type</span>,
            error,
            <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>
          });
        }
      }
    });
  }
  
  <span class="hljs-comment">// è·å–è‡ªå¢è®¡æ•°å™¨</span>
  <span class="hljs-title function_">getAutoIncrementCounter</span>(<span class="hljs-params">storeName, offset = <span class="hljs-number">0</span></span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">autoIncrementCounters</span>.<span class="hljs-title function_">has</span>(storeName)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">autoIncrementCounters</span>.<span class="hljs-title function_">set</span>(storeName, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-keyword">const</span> current = <span class="hljs-variable language_">this</span>.<span class="hljs-property">autoIncrementCounters</span>.<span class="hljs-title function_">get</span>(storeName);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">autoIncrementCounters</span>.<span class="hljs-title function_">set</span>(storeName, current + <span class="hljs-number">1</span> + offset);
    <span class="hljs-keyword">return</span> current + offset;
  }
  
  <span class="hljs-comment">// æ•°æ®åº“å¤‡ä»½</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">backup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>);
    }
    
    <span class="hljs-keyword">const</span> backup = {
      <span class="hljs-attr">dbName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbName</span>,
      <span class="hljs-attr">version</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">version</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">stores</span>: {}
    };
    
    <span class="hljs-keyword">const</span> storeNames = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">objectStoreNames</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> storeName <span class="hljs-keyword">of</span> storeNames) {
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAll</span>(storeName);
      backup.<span class="hljs-property">stores</span>[storeName] = data;
    }
    
    <span class="hljs-keyword">return</span> backup;
  }
  
  <span class="hljs-comment">// ä»å¤‡ä»½æ¢å¤</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">restore</span>(<span class="hljs-params">backup</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>);
    }
    
    <span class="hljs-comment">// æ¸…ç©ºç°æœ‰æ•°æ®</span>
    <span class="hljs-keyword">const</span> storeNames = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">objectStoreNames</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> storeName <span class="hljs-keyword">of</span> storeNames) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearStore</span>(storeName);
    }
    
    <span class="hljs-comment">// æ¢å¤æ•°æ®</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [storeName, data] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(backup.<span class="hljs-property">stores</span>)) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">objectStoreNames</span>.<span class="hljs-title function_">contains</span>(storeName)) {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addBulk</span>(storeName, data);
      }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// è·å–æ•°æ®åº“ä¿¡æ¯</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database not initialized'</span>);
    }
    
    <span class="hljs-keyword">const</span> info = {
      <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">name</span>,
      <span class="hljs-attr">version</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">version</span>,
      <span class="hljs-attr">objectStores</span>: [],
      <span class="hljs-attr">estimatedSize</span>: <span class="hljs-number">0</span>
    };
    
    <span class="hljs-keyword">const</span> storeNames = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-property">objectStoreNames</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> storeName <span class="hljs-keyword">of</span> storeNames) {
      <span class="hljs-keyword">const</span> count = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">count</span>(storeName);
      info.<span class="hljs-property">objectStores</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">name</span>: storeName,
        count
      });
    }
    
    <span class="hljs-comment">// å°è¯•ä¼°ç®—å¤§å°ï¼ˆé€šè¿‡è¯»å–æ‰€æœ‰æ•°æ®ï¼‰</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> totalSize = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> storeName <span class="hljs-keyword">of</span> storeNames) {
        <span class="hljs-keyword">const</span> allData = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAll</span>(storeName);
        <span class="hljs-keyword">const</span> jsonString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(allData);
        totalSize += <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([jsonString]).<span class="hljs-property">size</span>;
      }
      info.<span class="hljs-property">estimatedSize</span> = totalSize;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Could not estimate database size:'</span>, error);
    }
    
    <span class="hljs-keyword">return</span> info;
  }
  
  <span class="hljs-comment">// å…³é—­æ•°æ®åº“</span>
  <span class="hljs-title function_">close</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">close</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Database <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dbName}</span> closed`</span>);
    }
  }
  
  <span class="hljs-comment">// åˆ é™¤æ•°æ®åº“</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">deleteDatabase</span>(<span class="hljs-params">dbName</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">deleteDatabase</span>(dbName);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Database <span class="hljs-subst">${dbName}</span> deleted`</span>);
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">error</span>);
      };
      
      request.<span class="hljs-property">onblocked</span> = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Database <span class="hljs-subst">${dbName}</span> deletion blocked`</span>);
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Database deletion blocked by open connections'</span>));
      };
    });
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexedDBExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºæ•°æ®åº“ç®¡ç†å™¨</span>
    <span class="hljs-keyword">const</span> dbManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexedDBManager</span>(<span class="hljs-string">'MyAppDB'</span>, <span class="hljs-number">2</span>);
    
    <span class="hljs-comment">// æ³¨å†Œè¿ç§»</span>
    dbManager.<span class="hljs-title function_">registerMigration</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-function">(<span class="hljs-params">db, oldVersion, newVersion</span>) =&gt;</span> {
      <span class="hljs-comment">// ä»ç‰ˆæœ¬1è¿ç§»åˆ°ç‰ˆæœ¬2</span>
      <span class="hljs-keyword">if</span> (!db.<span class="hljs-property">objectStoreNames</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'users'</span>)) {
        <span class="hljs-keyword">const</span> store = db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'users'</span>, { <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'id'</span>, <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span> });
        store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'email'</span>, <span class="hljs-string">'email'</span>, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> });
      }
    });
    
    <span class="hljs-comment">// å®šä¹‰æ•°æ®åº“æ¨¡å¼</span>
    <span class="hljs-keyword">const</span> schema = {
      <span class="hljs-attr">users</span>: {
        <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">indices</span>: [
          { <span class="hljs-attr">name</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> },
          { <span class="hljs-attr">name</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> }
        ]
      },
      <span class="hljs-attr">products</span>: {
        <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'sku'</span>,
        <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">indices</span>: [
          { <span class="hljs-attr">name</span>: <span class="hljs-string">'category'</span>, <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'category'</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> },
          { <span class="hljs-attr">name</span>: <span class="hljs-string">'price'</span>, <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'price'</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> }
        ]
      }
    };
    
    <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®åº“</span>
    <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">init</span>(schema);
    
    <span class="hljs-comment">// æ·»åŠ ç”¨æˆ·</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">add</span>(<span class="hljs-string">'users'</span>, {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>,
      <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
    });
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Added user:'</span>, user);
    
    <span class="hljs-comment">// æ‰¹é‡æ·»åŠ äº§å“</span>
    <span class="hljs-keyword">const</span> products = <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">addBulk</span>(<span class="hljs-string">'products'</span>, [
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'P001'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 1'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'electronics'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">99.99</span> },
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'P002'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 2'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'clothing'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">49.99</span> },
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'P003'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Product 3'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'electronics'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">199.99</span> }
    ]);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Added products:'</span>, products);
    
    <span class="hljs-comment">// é€šè¿‡ç´¢å¼•æŸ¥è¯¢</span>
    <span class="hljs-keyword">const</span> userByEmail = <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">getByIndex</span>(<span class="hljs-string">'users'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'john@example.com'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User by email:'</span>, userByEmail);
    
    <span class="hljs-comment">// æ¸¸æ ‡éå†</span>
    <span class="hljs-keyword">const</span> expensiveProducts = <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">cursor</span>(<span class="hljs-string">'products'</span>, <span class="hljs-function">(<span class="hljs-params">product, cursor</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Product:'</span>, product);
      <span class="hljs-comment">// è¿”å›falseåœæ­¢éå†</span>
      <span class="hljs-keyword">return</span> product.<span class="hljs-property">price</span> &lt; <span class="hljs-number">150</span>;
    }, { <span class="hljs-attr">indexName</span>: <span class="hljs-string">'price'</span>, <span class="hljs-attr">direction</span>: <span class="hljs-string">'next'</span> });
    
    <span class="hljs-comment">// è·å–æ•°æ®åº“ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> info = <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">getInfo</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Database info:'</span>, info);
    
    <span class="hljs-comment">// å¤‡ä»½æ•°æ®åº“</span>
    <span class="hljs-keyword">const</span> backup = <span class="hljs-keyword">await</span> dbManager.<span class="hljs-title function_">backup</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Backup created:'</span>, backup);
    
    <span class="hljs-keyword">return</span> dbManager;
  }
}
</code></pre>
<h5 data-id="heading-6">2.2 IndexedDB æŸ¥è¯¢æ„å»ºå™¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexedDBQueryBuilder</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">dbManager, storeName</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span> = dbManager;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span> = storeName;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = {
      <span class="hljs-attr">filters</span>: [],
      <span class="hljs-attr">sort</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">limit</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">indexes</span>: []
    };
  }
  
  <span class="hljs-comment">// ç­‰äºæ¡ä»¶</span>
  <span class="hljs-title function_">where</span>(<span class="hljs-params">field, value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'='</span>, value });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// ä¸ç­‰äºæ¡ä»¶</span>
  <span class="hljs-title function_">whereNot</span>(<span class="hljs-params">field, value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'!='</span>, value });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å¤§äºæ¡ä»¶</span>
  <span class="hljs-title function_">whereGreaterThan</span>(<span class="hljs-params">field, value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&gt;'</span>, value });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å°äºæ¡ä»¶</span>
  <span class="hljs-title function_">whereLessThan</span>(<span class="hljs-params">field, value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&lt;'</span>, value });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å¤§äºç­‰äºæ¡ä»¶</span>
  <span class="hljs-title function_">whereGreaterOrEqual</span>(<span class="hljs-params">field, value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&gt;='</span>, value });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å°äºç­‰äºæ¡ä»¶</span>
  <span class="hljs-title function_">whereLessOrEqual</span>(<span class="hljs-params">field, value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'&lt;='</span>, value });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// åŒ…å«æ¡ä»¶</span>
  <span class="hljs-title function_">whereIn</span>(<span class="hljs-params">field, values</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'in'</span>, <span class="hljs-attr">value</span>: values });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// èŒƒå›´æ¡ä»¶</span>
  <span class="hljs-title function_">whereBetween</span>(<span class="hljs-params">field, min, max</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'between'</span>, <span class="hljs-attr">value</span>: { min, max } });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å­—ç¬¦ä¸²åŒ…å«</span>
  <span class="hljs-title function_">whereContains</span>(<span class="hljs-params">field, substring</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'contains'</span>, <span class="hljs-attr">value</span>: substring });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å­—ç¬¦ä¸²å¼€å¤´</span>
  <span class="hljs-title function_">whereStartsWith</span>(<span class="hljs-params">field, prefix</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'startsWith'</span>, <span class="hljs-attr">value</span>: prefix });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// å­—ç¬¦ä¸²ç»“å°¾</span>
  <span class="hljs-title function_">whereEndsWith</span>(<span class="hljs-params">field, suffix</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">push</span>({ field, <span class="hljs-attr">operator</span>: <span class="hljs-string">'endsWith'</span>, <span class="hljs-attr">value</span>: suffix });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// æ’åº</span>
  <span class="hljs-title function_">orderBy</span>(<span class="hljs-params">field, direction = <span class="hljs-string">'asc'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">sort</span> = { field, direction };
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// é™åˆ¶æ•°é‡</span>
  <span class="hljs-title function_">limit</span>(<span class="hljs-params">count</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span> = count;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// åç§»é‡</span>
  <span class="hljs-title function_">offset</span>(<span class="hljs-params">count</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">offset</span> = count;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// ä½¿ç”¨ç´¢å¼•</span>
  <span class="hljs-title function_">useIndex</span>(<span class="hljs-params">indexName</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">indexes</span>.<span class="hljs-title function_">push</span>(indexName);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-comment">// æ‰§è¡ŒæŸ¥è¯¢</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// æ— è¿‡æ»¤å™¨ï¼Œç›´æ¥è·å–æ‰€æœ‰æ•°æ®</span>
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span>.<span class="hljs-title function_">getAll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>, <span class="hljs-literal">null</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span>);
    }
    
    <span class="hljs-comment">// ä½¿ç”¨æ¸¸æ ‡è¿›è¡Œå¤æ‚æŸ¥è¯¢</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span>.<span class="hljs-title function_">cursor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>, <span class="hljs-function">(<span class="hljs-params">record, cursor</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> results = [];
        <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> skipped = <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">processRecord</span> = (<span class="hljs-params">record</span>) =&gt; {
          <span class="hljs-comment">// æ£€æŸ¥åç§»é‡</span>
          <span class="hljs-keyword">if</span> (skipped &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">offset</span>) {
            skipped++;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
          
          <span class="hljs-comment">// æ£€æŸ¥é™åˆ¶</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span> &amp;&amp; count &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
          
          <span class="hljs-comment">// åº”ç”¨è¿‡æ»¤å™¨</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">matchesFilters</span>(record)) {
            results.<span class="hljs-title function_">push</span>(record);
            count++;
          }
          
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        };
        
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">processRecord</span>(record)) {
          cursor.<span class="hljs-title function_">continue</span>();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolve</span>(results);
        }
      }, {
        <span class="hljs-attr">indexName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">indexes</span>[<span class="hljs-number">0</span>] || <span class="hljs-literal">null</span>,
        <span class="hljs-attr">direction</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">sort</span>?.<span class="hljs-property">direction</span> === <span class="hljs-string">'desc'</span> ? <span class="hljs-string">'prev'</span> : <span class="hljs-string">'next'</span>
      }).<span class="hljs-title function_">then</span>(resolve).<span class="hljs-title function_">catch</span>(reject);
    });
  }
  
  <span class="hljs-comment">// æ£€æŸ¥è®°å½•æ˜¯å¦åŒ¹é…æ‰€æœ‰è¿‡æ»¤å™¨</span>
  <span class="hljs-title function_">matchesFilters</span>(<span class="hljs-params">record</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">filters</span>.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">filter</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> value = record[filter.<span class="hljs-property">field</span>];
      
      <span class="hljs-keyword">switch</span> (filter.<span class="hljs-property">operator</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'='</span>:
          <span class="hljs-keyword">return</span> value === filter.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'!='</span>:
          <span class="hljs-keyword">return</span> value !== filter.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;'</span>:
          <span class="hljs-keyword">return</span> value &gt; filter.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;'</span>:
          <span class="hljs-keyword">return</span> value &lt; filter.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'&gt;='</span>:
          <span class="hljs-keyword">return</span> value &gt;= filter.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'&lt;='</span>:
          <span class="hljs-keyword">return</span> value &lt;= filter.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'in'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(filter.<span class="hljs-property">value</span>) &amp;&amp; filter.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(value);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'between'</span>:
          <span class="hljs-keyword">return</span> value &gt;= filter.<span class="hljs-property">value</span>.<span class="hljs-property">min</span> &amp;&amp; value &lt;= filter.<span class="hljs-property">value</span>.<span class="hljs-property">max</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'contains'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span> &amp;&amp; value.<span class="hljs-title function_">includes</span>(filter.<span class="hljs-property">value</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'startsWith'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span> &amp;&amp; value.<span class="hljs-title function_">startsWith</span>(filter.<span class="hljs-property">value</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'endsWith'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span> &amp;&amp; value.<span class="hljs-title function_">endsWith</span>(filter.<span class="hljs-property">value</span>);
        <span class="hljs-attr">default</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
    });
  }
  
  <span class="hljs-comment">// è®¡æ•°</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">count</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">return</span> results.<span class="hljs-property">length</span>;
  }
  
  <span class="hljs-comment">// è·å–ç¬¬ä¸€æ¡è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">first</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">limit</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">return</span> results[<span class="hljs-number">0</span>] || <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-comment">// è·å–æœ€åä¸€æ¡è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">last</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">return</span> results[results.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">exists</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">first</span>();
    <span class="hljs-keyword">return</span> result !== <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-comment">// æ›´æ–°åŒ¹é…çš„è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">updates</span>) {
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">const</span> updatePromises = results.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = record.<span class="hljs-property">id</span> || record[<span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span>.<span class="hljs-property">stores</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>).<span class="hljs-property">keyPath</span>];
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span>.<span class="hljs-title function_">update</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>, key, updates);
    });
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(updatePromises);
  }
  
  <span class="hljs-comment">// åˆ é™¤åŒ¹é…çš„è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">const</span> deletePromises = results.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = record.<span class="hljs-property">id</span> || record[<span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span>.<span class="hljs-property">stores</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>).<span class="hljs-property">keyPath</span>];
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dbManager</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>, key);
    });
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(deletePromises);
  }
  
  <span class="hljs-comment">// åˆ†é¡µæŸ¥è¯¢</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">paginate</span>(<span class="hljs-params">page = <span class="hljs-number">1</span>, perPage = <span class="hljs-number">20</span></span>) {
    <span class="hljs-keyword">const</span> offset = (page - <span class="hljs-number">1</span>) * perPage;
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">offset</span>(offset).<span class="hljs-title function_">limit</span>(perPage).<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">const</span> total = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">count</span>();
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">data</span>: results,
      <span class="hljs-attr">pagination</span>: {
        page,
        perPage,
        total,
        <span class="hljs-attr">totalPages</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(total / perPage),
        <span class="hljs-attr">hasNext</span>: page * perPage &lt; total,
        <span class="hljs-attr">hasPrev</span>: page &gt; <span class="hljs-number">1</span>
      }
    };
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryBuilderExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params">dbManager</span>) {
    <span class="hljs-keyword">const</span> queryBuilder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexedDBQueryBuilder</span>(dbManager, <span class="hljs-string">'products'</span>);
    
    <span class="hljs-comment">// å¤æ‚æŸ¥è¯¢</span>
    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> queryBuilder
      .<span class="hljs-title function_">where</span>(<span class="hljs-string">'category'</span>, <span class="hljs-string">'electronics'</span>)
      .<span class="hljs-title function_">whereGreaterThan</span>(<span class="hljs-string">'price'</span>, <span class="hljs-number">50</span>)
      .<span class="hljs-title function_">whereLessThan</span>(<span class="hljs-string">'price'</span>, <span class="hljs-number">200</span>)
      .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'price'</span>, <span class="hljs-string">'desc'</span>)
      .<span class="hljs-title function_">limit</span>(<span class="hljs-number">10</span>)
      .<span class="hljs-title function_">execute</span>();
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Query results:'</span>, results);
    
    <span class="hljs-comment">// åˆ†é¡µæŸ¥è¯¢</span>
    <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> queryBuilder
      .<span class="hljs-title function_">where</span>(<span class="hljs-string">'category'</span>, <span class="hljs-string">'electronics'</span>)
      .<span class="hljs-title function_">paginate</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Pagination:'</span>, page);
    
    <span class="hljs-keyword">return</span> results;
  }
}
</code></pre>
<h4 data-id="heading-7">ä¸‰ã€Cookie æ“ä½œåº“å®Œæ•´å®ç°</h4>
<h5 data-id="heading-8">3.1 å®Œæ•´çš„ Cookie ç®¡ç†å™¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CookieManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaults</span> = {
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">domain</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hostname</span>,
      <span class="hljs-attr">secure</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">protocol</span> === <span class="hljs-string">'https:'</span>,
      <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'Lax'</span>,
      <span class="hljs-attr">expires</span>: <span class="hljs-number">7</span>, <span class="hljs-comment">// é»˜è®¤7å¤©</span>
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span> = <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// ç›‘å¬ cookie å˜åŒ–</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupMutationObserver</span>();
  }
  
  <span class="hljs-comment">// è®¾ç½® Cookie</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">name, value, options = {}</span>) {
    <span class="hljs-keyword">const</span> config = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaults</span>, ...options };
    
    <span class="hljs-keyword">let</span> cookieValue = value;
    
    <span class="hljs-comment">// åºåˆ—åŒ–éå­—ç¬¦ä¸²å€¼</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'string'</span>) {
      cookieValue = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value);
    }
    
    <span class="hljs-comment">// åŠ å¯†</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">encrypt</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span>) {
      cookieValue = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encrypt</span>(cookieValue, config.<span class="hljs-property">encryptionKey</span>);
    }
    
    <span class="hljs-comment">// å‹ç¼©</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">compress</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span> &amp;&amp; cookieValue.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100</span>) {
      cookieValue = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compress</span>(cookieValue);
    }
    
    <span class="hljs-comment">// æ„å»º cookie å­—ç¬¦ä¸²</span>
    <span class="hljs-keyword">let</span> cookieString = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(name)}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(cookieValue)}</span>`</span>;
    
    <span class="hljs-comment">// æ·»åŠ è¿‡æœŸæ—¶é—´</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">expires</span>) {
      <span class="hljs-keyword">let</span> expires = config.<span class="hljs-property">expires</span>;
      
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> expires === <span class="hljs-string">'number'</span>) {
        <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
        date.<span class="hljs-title function_">setTime</span>(date.<span class="hljs-title function_">getTime</span>() + expires * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);
        expires = date.<span class="hljs-title function_">toUTCString</span>();
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (expires <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) {
        expires = expires.<span class="hljs-title function_">toUTCString</span>();
      }
      
      cookieString += <span class="hljs-string">`; expires=<span class="hljs-subst">${expires}</span>`</span>;
    }
    
    <span class="hljs-comment">// æ·»åŠ è·¯å¾„</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">path</span>) {
      cookieString += <span class="hljs-string">`; path=<span class="hljs-subst">${config.path}</span>`</span>;
    }
    
    <span class="hljs-comment">// æ·»åŠ åŸŸå</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">domain</span>) {
      cookieString += <span class="hljs-string">`; domain=<span class="hljs-subst">${config.domain}</span>`</span>;
    }
    
    <span class="hljs-comment">// æ·»åŠ å®‰å…¨æ ‡å¿—</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">secure</span>) {
      cookieString += <span class="hljs-string">'; secure'</span>;
    }
    
    <span class="hljs-comment">// æ·»åŠ  SameSite</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">sameSite</span>) {
      cookieString += <span class="hljs-string">`; samesite=<span class="hljs-subst">${config.sameSite}</span>`</span>;
    }
    
    <span class="hljs-comment">// è®¾ç½® cookie</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = cookieString;
    
    <span class="hljs-comment">// é€šçŸ¥è§‚å¯Ÿè€…</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(name, value, <span class="hljs-string">'set'</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// è·å– Cookie</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">name, defaultValue = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> cookies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAll</span>();
    
    <span class="hljs-keyword">if</span> (!(name <span class="hljs-keyword">in</span> cookies)) {
      <span class="hljs-keyword">return</span> defaultValue;
    }
    
    <span class="hljs-keyword">let</span> value = cookies[name];
    
    <span class="hljs-comment">// è§£å‹ç¼©</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCompressed</span>(value)) {
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decompress</span>(value);
    }
    
    <span class="hljs-comment">// è§£å¯†</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isEncrypted</span>(value)) {
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decrypt</span>(value);
    }
    
    <span class="hljs-comment">// å°è¯•è§£æ JSON</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value);
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-keyword">return</span> value;
    }
  }
  
  <span class="hljs-comment">// è·å–æ‰€æœ‰ Cookie</span>
  <span class="hljs-title function_">getAll</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cookies = {};
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>) {
      <span class="hljs-keyword">return</span> cookies;
    }
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">';'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cookie</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> [name, ...valueParts] = cookie.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'='</span>);
      <span class="hljs-keyword">const</span> value = valueParts.<span class="hljs-title function_">join</span>(<span class="hljs-string">'='</span>); <span class="hljs-comment">// å¤„ç†å€¼ä¸­åŒ…å«ç­‰å·çš„æƒ…å†µ</span>
      
      <span class="hljs-keyword">try</span> {
        cookies[<span class="hljs-built_in">decodeURIComponent</span>(name)] = <span class="hljs-built_in">decodeURIComponent</span>(value);
      } <span class="hljs-keyword">catch</span> {
        cookies[name] = value;
      }
    });
    
    <span class="hljs-keyword">return</span> cookies;
  }
  
  <span class="hljs-comment">// åˆ é™¤ Cookie</span>
  <span class="hljs-title function_">remove</span>(<span class="hljs-params">name, options = {}</span>) {
    <span class="hljs-keyword">const</span> config = {
      <span class="hljs-attr">path</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaults</span>.<span class="hljs-property">path</span>,
      <span class="hljs-attr">domain</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaults</span>.<span class="hljs-property">domain</span>,
      ...options
    };
    
    <span class="hljs-comment">// è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºè¿‡å»çš„æ—¶é—´</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(name, <span class="hljs-string">''</span>, {
      ...config,
      <span class="hljs-attr">expires</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">0</span>)
    });
    
    <span class="hljs-comment">// é€šçŸ¥è§‚å¯Ÿè€…</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(name, <span class="hljs-literal">null</span>, <span class="hljs-string">'remove'</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// æ£€æŸ¥ Cookie æ˜¯å¦å­˜åœ¨</span>
  <span class="hljs-title function_">has</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">return</span> name <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAll</span>();
  }
  
  <span class="hljs-comment">// å¯ç”¨åŠ å¯†</span>
  <span class="hljs-title function_">enableEncryption</span>(<span class="hljs-params">encryptionKey</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span> === <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Web Crypto API not available, encryption disabled'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionKey</span> = encryptionKey;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// å¯ç”¨å‹ç¼©</span>
  <span class="hljs-title function_">enableCompression</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
  <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">text, key = <span class="hljs-variable language_">this</span>.encryptionKey</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionEnabled</span>) <span class="hljs-keyword">return</span> text;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ç®€å•çš„ XOR åŠ å¯†ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„ç®—æ³•ï¼‰</span>
      <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; text.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> charCode = text.<span class="hljs-title function_">charCodeAt</span>(i) ^ key.<span class="hljs-title function_">charCodeAt</span>(i % key.<span class="hljs-property">length</span>);
        result += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(charCode);
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-string">`encrypted:<span class="hljs-subst">${btoa(result)}</span>`</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Encryption failed:'</span>, error);
      <span class="hljs-keyword">return</span> text;
    }
  }
  
  <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
  <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">text, key = <span class="hljs-variable language_">this</span>.encryptionKey</span>) {
    <span class="hljs-keyword">if</span> (!text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'encrypted:'</span>)) <span class="hljs-keyword">return</span> text;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> encrypted = <span class="hljs-title function_">atob</span>(text.<span class="hljs-title function_">slice</span>(<span class="hljs-number">10</span>));
      <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>;
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; encrypted.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> charCode = encrypted.<span class="hljs-title function_">charCodeAt</span>(i) ^ key.<span class="hljs-title function_">charCodeAt</span>(i % key.<span class="hljs-property">length</span>);
        result += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(charCode);
      }
      
      <span class="hljs-keyword">return</span> result;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Decryption failed:'</span>, error);
      <span class="hljs-keyword">return</span> text;
    }
  }
  
  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦åŠ å¯†</span>
  <span class="hljs-title function_">isEncrypted</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'encrypted:'</span>);
  }
  
  <span class="hljs-comment">// å‹ç¼©æ•°æ®</span>
  <span class="hljs-title function_">compress</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">compressionEnabled</span>) <span class="hljs-keyword">return</span> text;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ç®€å•çš„å‹ç¼©ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä½¿ç”¨ pako ç­‰åº“ï¼‰</span>
      <span class="hljs-keyword">const</span> compressed = <span class="hljs-title function_">btoa</span>(<span class="hljs-built_in">encodeURIComponent</span>(text).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/%[0-9A-F]{2}/g</span>, <span class="hljs-string">''</span>));
      <span class="hljs-keyword">return</span> <span class="hljs-string">`compressed:<span class="hljs-subst">${compressed}</span>`</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Compression failed:'</span>, error);
      <span class="hljs-keyword">return</span> text;
    }
  }
  
  <span class="hljs-comment">// è§£å‹ç¼©æ•°æ®</span>
  <span class="hljs-title function_">decompress</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">if</span> (!text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'compressed:'</span>)) <span class="hljs-keyword">return</span> text;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> compressed = text.<span class="hljs-title function_">slice</span>(<span class="hljs-number">11</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-title function_">atob</span>(compressed));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Decompression failed:'</span>, error);
      <span class="hljs-keyword">return</span> text;
    }
  }
  
  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å‹ç¼©</span>
  <span class="hljs-title function_">isCompressed</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'compressed:'</span>);
  }
  
  <span class="hljs-comment">// æ·»åŠ è§‚å¯Ÿè€…</span>
  <span class="hljs-title function_">observe</span>(<span class="hljs-params">name, callback</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">has</span>(name)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">set</span>(name, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(name).<span class="hljs-title function_">add</span>(callback);
    
    <span class="hljs-comment">// è¿”å›å–æ¶ˆè§‚å¯Ÿçš„å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> observers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(name);
      <span class="hljs-keyword">if</span> (observers) {
        observers.<span class="hljs-title function_">delete</span>(callback);
        <span class="hljs-keyword">if</span> (observers.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">delete</span>(name);
        }
      }
    };
  }
  
  <span class="hljs-comment">// é€šçŸ¥è§‚å¯Ÿè€…</span>
  <span class="hljs-title function_">notifyObservers</span>(<span class="hljs-params">name, value, action</span>) {
    <span class="hljs-keyword">const</span> observers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(name);
    <span class="hljs-keyword">if</span> (observers) {
      observers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
        <span class="hljs-title function_">callback</span>(value, action, name);
      });
    }
    
    <span class="hljs-comment">// é€šçŸ¥å…¨å±€è§‚å¯Ÿè€…</span>
    <span class="hljs-keyword">const</span> globalObservers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'*'</span>);
    <span class="hljs-keyword">if</span> (globalObservers) {
      globalObservers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
        <span class="hljs-title function_">callback</span>(value, action, name);
      });
    }
  }
  
  <span class="hljs-comment">// è®¾ç½® MutationObserver ç›‘å¬ cookie å˜åŒ–</span>
  <span class="hljs-title function_">setupMutationObserver</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç”±äº cookie å˜åŒ–ä¸ä¼šè§¦å‘ DOM äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è½®è¯¢æ£€æŸ¥å˜åŒ–</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCookieString</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollingInterval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> currentCookieString = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;
      
      <span class="hljs-keyword">if</span> (currentCookieString !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCookieString</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">detectCookieChanges</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCookieString</span>, currentCookieString);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCookieString</span> = currentCookieString;
      }
    }, <span class="hljs-number">1000</span>); <span class="hljs-comment">// æ¯ç§’æ£€æŸ¥ä¸€æ¬¡</span>
  }
  
  <span class="hljs-comment">// æ£€æµ‹ cookie å˜åŒ–</span>
  <span class="hljs-title function_">detectCookieChanges</span>(<span class="hljs-params">oldCookieString, newCookieString</span>) {
    <span class="hljs-keyword">const</span> oldCookies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseCookieString</span>(oldCookieString);
    <span class="hljs-keyword">const</span> newCookies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseCookieString</span>(newCookieString);
    
    <span class="hljs-comment">// æ£€æµ‹æ–°å¢æˆ–ä¿®æ”¹çš„ cookie</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(newCookies).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (!oldCookies[name] || oldCookies[name] !== newCookies[name]) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(name, newCookies[name], oldCookies[name] ? <span class="hljs-string">'update'</span> : <span class="hljs-string">'set'</span>);
      }
    });
    
    <span class="hljs-comment">// æ£€æµ‹åˆ é™¤çš„ cookie</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(oldCookies).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (!newCookies[name]) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyObservers</span>(name, <span class="hljs-literal">null</span>, <span class="hljs-string">'remove'</span>);
      }
    });
  }
  
  <span class="hljs-comment">// è§£æ cookie å­—ç¬¦ä¸²</span>
  <span class="hljs-title function_">parseCookieString</span>(<span class="hljs-params">cookieString</span>) {
    <span class="hljs-keyword">const</span> cookies = {};
    
    <span class="hljs-keyword">if</span> (!cookieString) <span class="hljs-keyword">return</span> cookies;
    
    cookieString.<span class="hljs-title function_">split</span>(<span class="hljs-string">';'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cookie</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> [name, ...valueParts] = cookie.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'='</span>);
      <span class="hljs-keyword">const</span> value = valueParts.<span class="hljs-title function_">join</span>(<span class="hljs-string">'='</span>);
      
      <span class="hljs-keyword">if</span> (name) {
        <span class="hljs-keyword">try</span> {
          cookies[<span class="hljs-built_in">decodeURIComponent</span>(name)] = <span class="hljs-built_in">decodeURIComponent</span>(value);
        } <span class="hljs-keyword">catch</span> {
          cookies[name] = value;
        }
      }
    });
    
    <span class="hljs-keyword">return</span> cookies;
  }
  
  <span class="hljs-comment">// æ‰¹é‡è®¾ç½® cookie</span>
  <span class="hljs-title function_">batchSet</span>(<span class="hljs-params">cookies, commonOptions = {}</span>) {
    <span class="hljs-keyword">const</span> results = {};
    
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(cookies).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[name, value]</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> options = commonOptions;
      <span class="hljs-keyword">let</span> actualValue = value;
      
      <span class="hljs-comment">// å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œå¯èƒ½åŒ…å«é€‰é¡¹</span>
      <span class="hljs-keyword">if</span> (value &amp;&amp; <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        <span class="hljs-keyword">if</span> (value.<span class="hljs-property">value</span> !== <span class="hljs-literal">undefined</span>) {
          actualValue = value.<span class="hljs-property">value</span>;
          options = { ...commonOptions, ...value.<span class="hljs-property">options</span> };
        }
      }
      
      results[name] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(name, actualValue, options);
    });
    
    <span class="hljs-keyword">return</span> results;
  }
  
  <span class="hljs-comment">// è·å– cookie å¤§å°ä¿¡æ¯</span>
  <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cookies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAll</span>();
    <span class="hljs-keyword">let</span> totalSize = <span class="hljs-number">0</span>;
    
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(cookies).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[name, value]</span>) =&gt;</span> {
      <span class="hljs-comment">// æ¯ä¸ªå­—ç¬¦åœ¨ cookie ä¸­é€šå¸¸å ç”¨ 1-4 å­—èŠ‚ï¼Œè¿™é‡Œä¼°ç®—ä¸º 2 å­—èŠ‚</span>
      totalSize += (name.<span class="hljs-property">length</span> + value.<span class="hljs-property">length</span>) * <span class="hljs-number">2</span>;
    });
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cookies).<span class="hljs-property">length</span>,
      totalSize,
      <span class="hljs-attr">estimatedRemaining</span>: <span class="hljs-number">4096</span> - totalSize, <span class="hljs-comment">// cookie é€šå¸¸æœ‰ 4KB é™åˆ¶</span>
      <span class="hljs-attr">usagePercentage</span>: (totalSize / <span class="hljs-number">4096</span>) * <span class="hljs-number">100</span>
    };
  }
  
  <span class="hljs-comment">// å¯¼å‡ºæ‰€æœ‰ cookie</span>
  <span class="hljs-title function_">export</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cookies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAll</span>();
    <span class="hljs-keyword">const</span> exported = {};
    
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(cookies).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[name, value]</span>) =&gt;</span> {
      exported[name] = value;
    });
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">count</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cookies).<span class="hljs-property">length</span>,
      <span class="hljs-attr">cookies</span>: exported
    };
  }
  
  <span class="hljs-comment">// ä»å¤‡ä»½å¯¼å…¥ cookie</span>
  <span class="hljs-title function_">import</span>(<span class="hljs-params">backup</span>) {
    <span class="hljs-keyword">if</span> (!backup || !backup.<span class="hljs-property">cookies</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid backup data'</span>);
    }
    
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(backup.<span class="hljs-property">cookies</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[name, value]</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(name, value);
    });
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// é”€æ¯å®ä¾‹</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollingInterval</span>) {
      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollingInterval</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">clear</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CookieExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»º cookie ç®¡ç†å™¨</span>
    <span class="hljs-keyword">const</span> cookieManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CookieManager</span>({
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">expires</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 30 å¤©</span>
      <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'Strict'</span>
    });
    
    <span class="hljs-comment">// å¯ç”¨åŠ å¯†</span>
    cookieManager.<span class="hljs-title function_">enableEncryption</span>(<span class="hljs-string">'my-secret-key'</span>);
    
    <span class="hljs-comment">// å¯ç”¨å‹ç¼©</span>
    cookieManager.<span class="hljs-title function_">enableCompression</span>();
    
    <span class="hljs-comment">// è®¾ç½® cookie</span>
    cookieManager.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user'</span>, {
      <span class="hljs-attr">id</span>: <span class="hljs-number">123</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
      <span class="hljs-attr">preferences</span>: { <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>, <span class="hljs-attr">language</span>: <span class="hljs-string">'en'</span> }
    }, { <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">true</span> });
    
    cookieManager.<span class="hljs-title function_">set</span>(<span class="hljs-string">'session_token'</span>, <span class="hljs-string">'abc123def456'</span>, {
      <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">expires</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// 1 å¤©</span>
    });
    
    <span class="hljs-comment">// æ‰¹é‡è®¾ç½®</span>
    cookieManager.<span class="hljs-title function_">batchSet</span>({
      <span class="hljs-string">'theme'</span>: <span class="hljs-string">'dark'</span>,
      <span class="hljs-string">'language'</span>: <span class="hljs-string">'en-US'</span>,
      <span class="hljs-string">'notifications'</span>: <span class="hljs-literal">true</span>
    }, { <span class="hljs-attr">expires</span>: <span class="hljs-number">7</span> });
    
    <span class="hljs-comment">// è·å– cookie</span>
    <span class="hljs-keyword">const</span> user = cookieManager.<span class="hljs-title function_">get</span>(<span class="hljs-string">'user'</span>);
    <span class="hljs-keyword">const</span> theme = cookieManager.<span class="hljs-title function_">get</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-string">'light'</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User:'</span>, user);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Theme:'</span>, theme);
    
    <span class="hljs-comment">// è§‚å¯Ÿ cookie å˜åŒ–</span>
    <span class="hljs-keyword">const</span> unsubscribe = cookieManager.<span class="hljs-title function_">observe</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-function">(<span class="hljs-params">value, action</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Theme cookie <span class="hljs-subst">${action}</span>:`</span>, value);
    });
    
    <span class="hljs-comment">// è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> stats = cookieManager.<span class="hljs-title function_">getStats</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cookie stats:'</span>, stats);
    
    <span class="hljs-comment">// å¯¼å‡ºæ‰€æœ‰ cookie</span>
    <span class="hljs-keyword">const</span> backup = cookieManager.<span class="hljs-title function_">export</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cookie backup:'</span>, backup);
    
    <span class="hljs-comment">// å–æ¶ˆè§‚å¯Ÿ</span>
    <span class="hljs-title function_">unsubscribe</span>();
    
    <span class="hljs-keyword">return</span> cookieManager;
  }
}
</code></pre>
<h5 data-id="heading-9">3.2 Cookie åŒæºå’Œè·¨åŸŸå¤„ç†</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossDomainCookieManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ready</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOrigin</span> = <span class="hljs-string">'*'</span>;
    
    <span class="hljs-comment">// è®¾ç½®æ¶ˆæ¯ç›‘å¬</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMessage</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-literal">false</span>);
  }
  
  <span class="hljs-comment">// åˆå§‹åŒ–è·¨åŸŸé€šä¿¡</span>
  <span class="hljs-title function_">init</span>(<span class="hljs-params">targetDomain, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOrigin</span> = targetDomain;
      
      <span class="hljs-comment">// åˆ›å»ºéšè—çš„ iframe</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">src</span> = <span class="hljs-string">`<span class="hljs-subst">${targetDomain}</span>/cookie-proxy.html`</span>;
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ready</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cookie proxy iframe loaded'</span>);
        <span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>);
      };
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Failed to load cookie proxy iframe'</span>));
      };
      
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>);
    });
  }
  
  <span class="hljs-comment">// å¤„ç†æ¶ˆæ¯</span>
  <span class="hljs-title function_">handleMessage</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-comment">// éªŒè¯æ¥æº</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOrigin</span> !== <span class="hljs-string">'*'</span> &amp;&amp; event.<span class="hljs-property">origin</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOrigin</span>) {
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">const</span> { type, id, data, error } = event.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (!type || !id) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> handler = <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-title function_">get</span>(id);
    <span class="hljs-keyword">if</span> (handler) {
      <span class="hljs-keyword">if</span> (error) {
        handler.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(error));
      } <span class="hljs-keyword">else</span> {
        handler.<span class="hljs-title function_">resolve</span>(data);
      }
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-title function_">delete</span>(id);
    }
  }
  
  <span class="hljs-comment">// å‘é€æ¶ˆæ¯åˆ° iframe</span>
  <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">type, data</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">ready</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>) {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Cookie proxy not ready'</span>));
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> id = <span class="hljs-string">`msg_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>_<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).substr(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>)}</span>`</span>;
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-title function_">set</span>(id, { resolve, reject });
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>({
        type,
        id,
        data
      }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOrigin</span>);
      
      <span class="hljs-comment">// è®¾ç½®è¶…æ—¶</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-title function_">has</span>(id)) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-title function_">delete</span>(id);
          <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Request timeout'</span>));
        }
      }, <span class="hljs-number">5000</span>);
    });
  }
  
  <span class="hljs-comment">// è®¾ç½®è·¨åŸŸ cookie</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setCookie</span>(<span class="hljs-params">name, value, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">'SET_COOKIE'</span>, { name, value, options });
  }
  
  <span class="hljs-comment">// è·å–è·¨åŸŸ cookie</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-params">name, defaultValue = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> value = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">'GET_COOKIE'</span>, { name });
      <span class="hljs-keyword">return</span> value || defaultValue;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get cross-domain cookie:'</span>, error);
      <span class="hljs-keyword">return</span> defaultValue;
    }
  }
  
  <span class="hljs-comment">// åˆ é™¤è·¨åŸŸ cookie</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">removeCookie</span>(<span class="hljs-params">name, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">'REMOVE_COOKIE'</span>, { name, options });
  }
  
  <span class="hljs-comment">// è·å–æ‰€æœ‰è·¨åŸŸ cookie</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllCookies</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">'GET_ALL_COOKIES'</span>, {});
  }
  
  <span class="hljs-comment">// é”€æ¯</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">iframe</span> = <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMessage</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandlers</span>.<span class="hljs-title function_">clear</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ready</span> = <span class="hljs-literal">false</span>;
  }
}

<span class="hljs-comment">// Cookie ä»£ç†é¡µé¢ä»£ç ï¼ˆéœ€è¦éƒ¨ç½²åœ¨ç›®æ ‡åŸŸï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CookieProxy</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initMessageHandler</span>();
  }
  
  <span class="hljs-title function_">initMessageHandler</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
      <span class="hljs-keyword">const</span> { type, id, data } = event.<span class="hljs-property">data</span>;
      
      <span class="hljs-keyword">if</span> (!type || !id) <span class="hljs-keyword">return</span>;
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">let</span> result;
        
        <span class="hljs-keyword">switch</span> (type) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">'SET_COOKIE'</span>:
            result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(data.<span class="hljs-property">name</span>, data.<span class="hljs-property">value</span>, data.<span class="hljs-property">options</span>);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'GET_COOKIE'</span>:
            result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCookie</span>(data.<span class="hljs-property">name</span>);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'REMOVE_COOKIE'</span>:
            result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeCookie</span>(data.<span class="hljs-property">name</span>, data.<span class="hljs-property">options</span>);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'GET_ALL_COOKIES'</span>:
            result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAllCookies</span>();
            <span class="hljs-keyword">break</span>;
          <span class="hljs-attr">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unknown message type: <span class="hljs-subst">${type}</span>`</span>);
        }
        
        <span class="hljs-comment">// å‘é€å“åº”</span>
        event.<span class="hljs-property">source</span>.<span class="hljs-title function_">postMessage</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'RESPONSE'</span>,
          id,
          <span class="hljs-attr">data</span>: <span class="hljs-keyword">await</span> result
        }, event.<span class="hljs-property">origin</span>);
      } <span class="hljs-keyword">catch</span> (error) {
        event.<span class="hljs-property">source</span>.<span class="hljs-title function_">postMessage</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'ERROR'</span>,
          id,
          <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
        }, event.<span class="hljs-property">origin</span>);
      }
    }, <span class="hljs-literal">false</span>);
  }
  
  <span class="hljs-comment">// è®¾ç½® cookieï¼ˆæœ¬åœ°ï¼‰</span>
  <span class="hljs-title function_">setCookie</span>(<span class="hljs-params">name, value, options = {}</span>) {
    <span class="hljs-keyword">const</span> cookieManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CookieManager</span>();
    <span class="hljs-keyword">return</span> cookieManager.<span class="hljs-title function_">set</span>(name, value, options);
  }
  
  <span class="hljs-comment">// è·å– cookieï¼ˆæœ¬åœ°ï¼‰</span>
  <span class="hljs-title function_">getCookie</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">const</span> cookieManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CookieManager</span>();
    <span class="hljs-keyword">return</span> cookieManager.<span class="hljs-title function_">get</span>(name);
  }
  
  <span class="hljs-comment">// åˆ é™¤ cookieï¼ˆæœ¬åœ°ï¼‰</span>
  <span class="hljs-title function_">removeCookie</span>(<span class="hljs-params">name, options = {}</span>) {
    <span class="hljs-keyword">const</span> cookieManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CookieManager</span>();
    <span class="hljs-keyword">return</span> cookieManager.<span class="hljs-title function_">remove</span>(name, options);
  }
  
  <span class="hljs-comment">// è·å–æ‰€æœ‰ cookieï¼ˆæœ¬åœ°ï¼‰</span>
  <span class="hljs-title function_">getAllCookies</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cookieManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CookieManager</span>();
    <span class="hljs-keyword">return</span> cookieManager.<span class="hljs-title function_">getAll</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossDomainExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ä¸»åŸŸä¸­çš„ä»£ç </span>
    <span class="hljs-keyword">const</span> crossDomainManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CrossDomainCookieManager</span>();
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// åˆå§‹åŒ–è¿æ¥ï¼ˆå‡è®¾å­åŸŸä¸º https://api.example.comï¼‰</span>
      <span class="hljs-keyword">await</span> crossDomainManager.<span class="hljs-title function_">init</span>(<span class="hljs-string">'https://api.example.com'</span>);
      
      <span class="hljs-comment">// åœ¨å­åŸŸä¸­è®¾ç½® cookie</span>
      <span class="hljs-keyword">await</span> crossDomainManager.<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">'api_token'</span>, <span class="hljs-string">'secret_token_123'</span>, {
        <span class="hljs-attr">expires</span>: <span class="hljs-number">7</span>,
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>
      });
      
      <span class="hljs-comment">// ä»å­åŸŸè·å– cookie</span>
      <span class="hljs-keyword">const</span> token = <span class="hljs-keyword">await</span> crossDomainManager.<span class="hljs-title function_">getCookie</span>(<span class="hljs-string">'api_token'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'API token from subdomain:'</span>, token);
      
      <span class="hljs-comment">// è·å–å­åŸŸä¸­çš„æ‰€æœ‰ cookie</span>
      <span class="hljs-keyword">const</span> allCookies = <span class="hljs-keyword">await</span> crossDomainManager.<span class="hljs-title function_">getAllCookies</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'All cookies from subdomain:'</span>, allCookies);
      
      <span class="hljs-keyword">return</span> crossDomainManager;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Cross-domain cookie operation failed:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }
}
</code></pre>
<h4 data-id="heading-10">å››ã€å­˜å‚¨å®‰å…¨æ€§ä¸æœ€ä½³å®è·µ</h4>
<h5 data-id="heading-11">4.1 å®‰å…¨å­˜å‚¨åŒ…è£…å™¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureStorage</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = {
      <span class="hljs-attr">encryptionAlgorithm</span>: <span class="hljs-string">'AES-GCM'</span>,
      <span class="hljs-attr">keyDerivationIterations</span>: <span class="hljs-number">100000</span>,
      <span class="hljs-attr">storageBackend</span>: <span class="hljs-string">'auto'</span>, <span class="hljs-comment">// 'localStorage', 'sessionStorage', 'indexedDB', 'auto'</span>
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">keyCache</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">detectCryptoSupport</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectStorageBackend</span>();
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initCryptoKeys</span>();
    }
  }
  
  <span class="hljs-comment">// æ£€æµ‹åŠ å¯†æ”¯æŒ</span>
  <span class="hljs-title function_">detectCryptoSupport</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; 
           <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">crypto</span>.<span class="hljs-property">subtle</span> !== <span class="hljs-string">'undefined'</span>;
  }
  
  <span class="hljs-comment">// é€‰æ‹©å­˜å‚¨åç«¯</span>
  <span class="hljs-title function_">selectStorageBackend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">storageBackend</span> !== <span class="hljs-string">'auto'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">storageBackend</span>;
    }
    
    <span class="hljs-comment">// è‡ªåŠ¨é€‰æ‹©æœ€ä½³å­˜å‚¨åç«¯</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">indexedDB</span> !== <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'indexedDB'</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> !== <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-comment">// æµ‹è¯• localStorage æ˜¯å¦å¯ç”¨</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'test'</span>, <span class="hljs-string">'test'</span>);
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'test'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">'localStorage'</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span> !== <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'sessionStorage'</span>;
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Storage detection failed:'</span>, error);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">'memory'</span>;
  }
  
  <span class="hljs-comment">// åˆå§‹åŒ–åŠ å¯†å¯†é’¥</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initCryptoKeys</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ä»å®‰å…¨æ¥æºè·å–æˆ–ç”Ÿæˆå¯†é’¥</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">masterKey</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deriveKeyFromPassword</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">encryptionPassword</span> || <span class="hljs-string">'default-password'</span>,
        <span class="hljs-string">'master-key'</span>
      );
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Crypto keys initialized'</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to initialize crypto keys:'</span>, error);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span> = <span class="hljs-literal">false</span>;
    }
  }
  
  <span class="hljs-comment">// ä»å¯†ç æ´¾ç”Ÿå¯†é’¥</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">deriveKeyFromPassword</span>(<span class="hljs-params">password, salt</span>) {
    <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
    <span class="hljs-keyword">const</span> passwordBuffer = encoder.<span class="hljs-title function_">encode</span>(password);
    <span class="hljs-keyword">const</span> saltBuffer = encoder.<span class="hljs-title function_">encode</span>(salt);
    
    <span class="hljs-comment">// å¯¼å…¥å¯†ç ä½œä¸ºå¯†é’¥ææ–™</span>
    <span class="hljs-keyword">const</span> keyMaterial = <span class="hljs-keyword">await</span> crypto.<span class="hljs-property">subtle</span>.importKey(
      <span class="hljs-string">'raw'</span>,
      passwordBuffer,
      <span class="hljs-string">'PBKDF2'</span>,
      <span class="hljs-literal">false</span>,
      [<span class="hljs-string">'deriveKey'</span>]
    );
    
    <span class="hljs-comment">// æ´¾ç”Ÿå¯†é’¥</span>
    <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> crypto.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">deriveKey</span>(
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'PBKDF2'</span>,
        <span class="hljs-attr">salt</span>: saltBuffer,
        <span class="hljs-attr">iterations</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">keyDerivationIterations</span>,
        <span class="hljs-attr">hash</span>: <span class="hljs-string">'SHA-256'</span>
      },
      keyMaterial,
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>, <span class="hljs-attr">length</span>: <span class="hljs-number">256</span> },
      <span class="hljs-literal">false</span>,
      [<span class="hljs-string">'encrypt'</span>, <span class="hljs-string">'decrypt'</span>]
    );
    
    <span class="hljs-keyword">return</span> key;
  }
  
  <span class="hljs-comment">// ç”Ÿæˆæ•°æ®ç‰¹å®šå¯†é’¥</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getDataKey</span>(<span class="hljs-params">keyName</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">keyCache</span>.<span class="hljs-title function_">has</span>(keyName)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">keyCache</span>.<span class="hljs-title function_">get</span>(keyName);
    }
    
    <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deriveKeyFromPassword</span>(
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">encryptionPassword</span> || <span class="hljs-string">'default-password'</span>,
      <span class="hljs-string">`data-key-<span class="hljs-subst">${keyName}</span>`</span>
    );
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">keyCache</span>.<span class="hljs-title function_">set</span>(keyName, key);
    <span class="hljs-keyword">return</span> key;
  }
  
  <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">encryptData</span>(<span class="hljs-params">data, keyName = <span class="hljs-string">'default'</span></span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span>) {
      <span class="hljs-keyword">return</span> data;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDataKey</span>(keyName);
      <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
      <span class="hljs-keyword">const</span> dataBuffer = encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
      
      <span class="hljs-comment">// ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡</span>
      <span class="hljs-keyword">const</span> iv = crypto.<span class="hljs-title function_">getRandomValues</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">12</span>));
      
      <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> encryptedBuffer = <span class="hljs-keyword">await</span> crypto.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">encrypt</span>(
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>,
          <span class="hljs-attr">iv</span>: iv
        },
        key,
        dataBuffer
      );
      
      <span class="hljs-comment">// ç»„åˆ IV å’ŒåŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> combinedBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(iv.<span class="hljs-property">length</span> + encryptedBuffer.<span class="hljs-property">byteLength</span>);
      combinedBuffer.<span class="hljs-title function_">set</span>(iv, <span class="hljs-number">0</span>);
      combinedBuffer.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(encryptedBuffer), iv.<span class="hljs-property">length</span>);
      
      <span class="hljs-comment">// è½¬æ¢ä¸º base64</span>
      <span class="hljs-keyword">const</span> base64String = <span class="hljs-title function_">btoa</span>(<span class="hljs-title class_">String</span>.<span class="hljs-property">fromCharCode</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, combinedBuffer));
      
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">encrypted</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">algorithm</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">encryptionAlgorithm</span>,
        <span class="hljs-attr">data</span>: base64String,
        keyName
      };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Encryption failed:'</span>, error);
      <span class="hljs-keyword">return</span> data;
    }
  }
  
  <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">decryptData</span>(<span class="hljs-params">encryptedData, keyName = <span class="hljs-string">'default'</span></span>) {
    <span class="hljs-keyword">if</span> (!encryptedData.<span class="hljs-property">encrypted</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span>) {
      <span class="hljs-keyword">return</span> encryptedData;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDataKey</span>(keyName);
      
      <span class="hljs-comment">// ä» base64 è§£ç </span>
      <span class="hljs-keyword">const</span> combinedBuffer = <span class="hljs-title class_">Uint8Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title function_">atob</span>(encryptedData.<span class="hljs-property">data</span>), <span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>));
      
      <span class="hljs-comment">// æå– IV å’ŒåŠ å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> iv = combinedBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">12</span>);
      <span class="hljs-keyword">const</span> encryptedBuffer = combinedBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">12</span>);
      
      <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
      <span class="hljs-keyword">const</span> decryptedBuffer = <span class="hljs-keyword">await</span> crypto.<span class="hljs-property">subtle</span>.<span class="hljs-title function_">decrypt</span>(
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">'AES-GCM'</span>,
          <span class="hljs-attr">iv</span>: iv
        },
        key,
        encryptedBuffer
      );
      
      <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
      <span class="hljs-keyword">const</span> decryptedString = decoder.<span class="hljs-title function_">decode</span>(decryptedBuffer);
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(decryptedString);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Decryption failed:'</span>, error);
      <span class="hljs-keyword">return</span> encryptedData;
    }
  }
  
  <span class="hljs-comment">// å®‰å…¨å­˜å‚¨æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value, options = {}</span>) {
    <span class="hljs-keyword">const</span> {
      encrypt = <span class="hljs-literal">true</span>,
      ttl = <span class="hljs-literal">null</span>,
      keyName = <span class="hljs-string">'default'</span>,
      ...storageOptions
    } = options;
    
    <span class="hljs-keyword">let</span> processedValue = value;
    
    <span class="hljs-comment">// åŠ å¯†æ•°æ®</span>
    <span class="hljs-keyword">if</span> (encrypt &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span>) {
      processedValue = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encryptData</span>(value, keyName);
    }
    
    <span class="hljs-comment">// æ·»åŠ å…ƒæ•°æ®</span>
    <span class="hljs-keyword">const</span> storageItem = {
      <span class="hljs-attr">value</span>: processedValue,
      <span class="hljs-attr">meta</span>: {
        <span class="hljs-attr">encrypted</span>: encrypt,
        keyName,
        <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">expiresAt</span>: ttl ? <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + ttl : <span class="hljs-literal">null</span>,
        <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0'</span>
      }
    };
    
    <span class="hljs-comment">// å­˜å‚¨åˆ°åç«¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">storeToBackend</span>(key, storageItem, storageOptions);
  }
  
  <span class="hljs-comment">// ä»åç«¯å­˜å‚¨æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">storeToBackend</span>(<span class="hljs-params">key, value, options</span>) {
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'indexedDB'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">storeToIndexedDB</span>(key, value, options);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'localStorage'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">'sessionStorage'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">storeToWebStorage</span>(key, value, options);
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">storeToMemory</span>(key, value, options);
    }
  }
  
  <span class="hljs-comment">// å­˜å‚¨åˆ° IndexedDB</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">storeToIndexedDB</span>(<span class="hljs-params">key, value, options</span>) {
    <span class="hljs-comment">// ç®€åŒ–çš„ IndexedDB å­˜å‚¨</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'SecureStorageDB'</span>, <span class="hljs-number">1</span>);
      
      request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">if</span> (!db.<span class="hljs-property">objectStoreNames</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'secureData'</span>)) {
          db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'secureData'</span>, { <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'key'</span> });
        }
      };
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'secureData'</span>], <span class="hljs-string">'readwrite'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'secureData'</span>);
        
        <span class="hljs-keyword">const</span> item = { key, ...value };
        <span class="hljs-keyword">const</span> putRequest = store.<span class="hljs-title function_">put</span>(item);
        
        putRequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
        putRequest.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
    });
  }
  
  <span class="hljs-comment">// å­˜å‚¨åˆ° Web Storage</span>
  <span class="hljs-title function_">storeToWebStorage</span>(<span class="hljs-params">key, value, options</span>) {
    <span class="hljs-keyword">const</span> storage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span> === <span class="hljs-string">'localStorage'</span> ? 
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> : <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>;
    
    <span class="hljs-keyword">try</span> {
      storage.<span class="hljs-title function_">setItem</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Web storage failed:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
  
  <span class="hljs-comment">// å­˜å‚¨åˆ°å†…å­˜</span>
  <span class="hljs-title function_">storeToMemory</span>(<span class="hljs-params">key, value, options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span> || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>.<span class="hljs-title function_">set</span>(key, value);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// å®‰å…¨è·å–æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">key, defaultValue = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-comment">// ä»åç«¯è·å–æ•°æ®</span>
    <span class="hljs-keyword">const</span> storageItem = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFromBackend</span>(key);
    
    <span class="hljs-keyword">if</span> (!storageItem) {
      <span class="hljs-keyword">return</span> defaultValue;
    }
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</span>
    <span class="hljs-keyword">if</span> (storageItem.<span class="hljs-property">meta</span>.<span class="hljs-property">expiresAt</span> &amp;&amp; <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt; storageItem.<span class="hljs-property">meta</span>.<span class="hljs-property">expiresAt</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>(key);
      <span class="hljs-keyword">return</span> defaultValue;
    }
    
    <span class="hljs-keyword">let</span> value = storageItem.<span class="hljs-property">value</span>;
    
    <span class="hljs-comment">// è§£å¯†æ•°æ®</span>
    <span class="hljs-keyword">if</span> (storageItem.<span class="hljs-property">meta</span>.<span class="hljs-property">encrypted</span>) {
      value = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decryptData</span>(value, storageItem.<span class="hljs-property">meta</span>.<span class="hljs-property">keyName</span>);
    }
    
    <span class="hljs-keyword">return</span> value;
  }
  
  <span class="hljs-comment">// ä»åç«¯è·å–æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getFromBackend</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'indexedDB'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFromIndexedDB</span>(key);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'localStorage'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">'sessionStorage'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFromWebStorage</span>(key);
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFromMemory</span>(key);
    }
  }
  
  <span class="hljs-comment">// ä» IndexedDB è·å–</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getFromIndexedDB</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'SecureStorageDB'</span>, <span class="hljs-number">1</span>);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'secureData'</span>], <span class="hljs-string">'readonly'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'secureData'</span>);
        <span class="hljs-keyword">const</span> getRequest = store.<span class="hljs-title function_">get</span>(key);
        
        getRequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          <span class="hljs-title function_">resolve</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
        };
        
        getRequest.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
    });
  }
  
  <span class="hljs-comment">// ä» Web Storage è·å–</span>
  <span class="hljs-title function_">getFromWebStorage</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">const</span> storage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span> === <span class="hljs-string">'localStorage'</span> ? 
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> : <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> item = storage.<span class="hljs-title function_">getItem</span>(key);
      <span class="hljs-keyword">return</span> item ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(item) : <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Web storage read failed:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }
  
  <span class="hljs-comment">// ä»å†…å­˜è·å–</span>
  <span class="hljs-title function_">getFromMemory</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>.<span class="hljs-title function_">get</span>(key) || <span class="hljs-literal">null</span> : <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-comment">// åˆ é™¤æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'indexedDB'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeFromIndexedDB</span>(key);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'localStorage'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">'sessionStorage'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeFromWebStorage</span>(key);
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeFromMemory</span>(key);
    }
  }
  
  <span class="hljs-comment">// ä» IndexedDB åˆ é™¤</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">removeFromIndexedDB</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'SecureStorageDB'</span>, <span class="hljs-number">1</span>);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'secureData'</span>], <span class="hljs-string">'readwrite'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'secureData'</span>);
        <span class="hljs-keyword">const</span> deleteRequest = store.<span class="hljs-title function_">delete</span>(key);
        
        deleteRequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
        deleteRequest.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
    });
  }
  
  <span class="hljs-comment">// ä» Web Storage åˆ é™¤</span>
  <span class="hljs-title function_">removeFromWebStorage</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">const</span> storage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span> === <span class="hljs-string">'localStorage'</span> ? 
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> : <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>;
    
    <span class="hljs-keyword">try</span> {
      storage.<span class="hljs-title function_">removeItem</span>(key);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Web storage delete failed:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
  
  <span class="hljs-comment">// ä»å†…å­˜åˆ é™¤</span>
  <span class="hljs-title function_">removeFromMemory</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>.<span class="hljs-title function_">delete</span>(key);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰æ•°æ®</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'indexedDB'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearIndexedDB</span>();
      <span class="hljs-keyword">case</span> <span class="hljs-string">'localStorage'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">'sessionStorage'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearWebStorage</span>();
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearMemory</span>();
    }
  }
  
  <span class="hljs-comment">// æ¸…ç©º IndexedDB</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">clearIndexedDB</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'SecureStorageDB'</span>, <span class="hljs-number">1</span>);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'secureData'</span>], <span class="hljs-string">'readwrite'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'secureData'</span>);
        <span class="hljs-keyword">const</span> clearRequest = store.<span class="hljs-title function_">clear</span>();
        
        clearRequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
        clearRequest.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
    });
  }
  
  <span class="hljs-comment">// æ¸…ç©º Web Storage</span>
  <span class="hljs-title function_">clearWebStorage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> storage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span> === <span class="hljs-string">'localStorage'</span> ? 
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> : <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>;
    
    <span class="hljs-keyword">try</span> {
      storage.<span class="hljs-title function_">clear</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Web storage clear failed:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
  
  <span class="hljs-comment">// æ¸…ç©ºå†…å­˜</span>
  <span class="hljs-title function_">clearMemory</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>.<span class="hljs-title function_">clear</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  
  <span class="hljs-comment">// è·å–å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> stats = {
      <span class="hljs-attr">backend</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span>,
      <span class="hljs-attr">encryptionSupported</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">encryptionSupported</span>,
      <span class="hljs-attr">items</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-number">0</span>
    };
    
    <span class="hljs-comment">// æ ¹æ®åç«¯è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-keyword">switch</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'indexedDB'</span>:
        <span class="hljs-keyword">const</span> dbItems = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getIndexedDBStats</span>();
        stats.<span class="hljs-property">items</span> = dbItems.<span class="hljs-property">count</span>;
        stats.<span class="hljs-property">size</span> = dbItems.<span class="hljs-property">size</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'localStorage'</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">'sessionStorage'</span>:
        <span class="hljs-keyword">const</span> wsStats = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getWebStorageStats</span>();
        stats.<span class="hljs-property">items</span> = wsStats.<span class="hljs-property">items</span>;
        stats.<span class="hljs-property">size</span> = wsStats.<span class="hljs-property">size</span>;
        <span class="hljs-keyword">break</span>;
      <span class="hljs-attr">default</span>:
        stats.<span class="hljs-property">items</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryStorage</span>.<span class="hljs-property">size</span> : <span class="hljs-number">0</span>;
        stats.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// å†…å­˜å¤§å°éš¾ä»¥å‡†ç¡®è®¡ç®—</span>
    }
    
    <span class="hljs-keyword">return</span> stats;
  }
  
  <span class="hljs-comment">// è·å– IndexedDB ç»Ÿè®¡ä¿¡æ¯</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getIndexedDBStats</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'SecureStorageDB'</span>, <span class="hljs-number">1</span>);
      
      request.<span class="hljs-property">onsuccess</span> = <span class="hljs-keyword">async</span> (event) =&gt; {
        <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
        <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'secureData'</span>], <span class="hljs-string">'readonly'</span>);
        <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'secureData'</span>);
        <span class="hljs-keyword">const</span> countRequest = store.<span class="hljs-title function_">count</span>();
        
        countRequest.<span class="hljs-property">onsuccess</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
          <span class="hljs-title function_">resolve</span>({
            <span class="hljs-attr">count</span>: event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>,
            <span class="hljs-attr">size</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// å®é™…é¡¹ç›®ä¸­å¯ä»¥éå†è®¡ç®—å¤§å°</span>
          });
        };
        
        countRequest.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
      };
      
      request.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(error);
    });
  }
  
  <span class="hljs-comment">// è·å– Web Storage ç»Ÿè®¡ä¿¡æ¯</span>
  <span class="hljs-title function_">getWebStorageStats</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> storage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageBackend</span> === <span class="hljs-string">'localStorage'</span> ? 
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> : <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>;
    
    <span class="hljs-keyword">let</span> items = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> size = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; storage.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> key = storage.<span class="hljs-title function_">key</span>(i);
      <span class="hljs-keyword">const</span> value = storage.<span class="hljs-title function_">getItem</span>(key);
      items++;
      size += (key.<span class="hljs-property">length</span> + value.<span class="hljs-property">length</span>) * <span class="hljs-number">2</span>; <span class="hljs-comment">// UTF-16 ä¼°ç®—</span>
    }
    
    <span class="hljs-keyword">return</span> { items, size };
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureStorageExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºå®‰å…¨å­˜å‚¨å®ä¾‹</span>
    <span class="hljs-keyword">const</span> secureStorage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureStorage</span>({
      <span class="hljs-attr">encryptionPassword</span>: <span class="hljs-string">'strong-password-123'</span>,
      <span class="hljs-attr">storageBackend</span>: <span class="hljs-string">'auto'</span>
    });
    
    <span class="hljs-comment">// å­˜å‚¨æ•æ„Ÿæ•°æ®</span>
    <span class="hljs-keyword">await</span> secureStorage.<span class="hljs-title function_">set</span>(<span class="hljs-string">'credit_card'</span>, {
      <span class="hljs-attr">number</span>: <span class="hljs-string">'4111111111111111'</span>,
      <span class="hljs-attr">expiry</span>: <span class="hljs-string">'12/25'</span>,
      <span class="hljs-attr">cvv</span>: <span class="hljs-string">'123'</span>
    }, {
      <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">ttl</span>: <span class="hljs-number">3600000</span>, <span class="hljs-comment">// 1å°æ—¶è¿‡æœŸ</span>
      <span class="hljs-attr">keyName</span>: <span class="hljs-string">'financial'</span>
    });
    
    <span class="hljs-comment">// å­˜å‚¨éæ•æ„Ÿæ•°æ®</span>
    <span class="hljs-keyword">await</span> secureStorage.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user_preferences'</span>, {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
      <span class="hljs-attr">language</span>: <span class="hljs-string">'en-US'</span>,
      <span class="hljs-attr">notifications</span>: <span class="hljs-literal">true</span>
    }, { <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">false</span> });
    
    <span class="hljs-comment">// è·å–æ•°æ®</span>
    <span class="hljs-keyword">const</span> cardData = <span class="hljs-keyword">await</span> secureStorage.<span class="hljs-title function_">get</span>(<span class="hljs-string">'credit_card'</span>);
    <span class="hljs-keyword">const</span> preferences = <span class="hljs-keyword">await</span> secureStorage.<span class="hljs-title function_">get</span>(<span class="hljs-string">'user_preferences'</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Credit card data:'</span>, cardData);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User preferences:'</span>, preferences);
    
    <span class="hljs-comment">// è·å–ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> secureStorage.<span class="hljs-title function_">getStats</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Storage stats:'</span>, stats);
    
    <span class="hljs-keyword">return</span> secureStorage;
  }
}
</code></pre>
<h4 data-id="heading-12">äº”ã€å­˜å‚¨æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜</h4>
<h5 data-id="heading-13">5.1 å­˜å‚¨æ€§èƒ½ç›‘æ§å™¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StoragePerformanceMonitor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = {
      <span class="hljs-attr">operations</span>: {
        <span class="hljs-attr">read</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">failures</span>: <span class="hljs-number">0</span> },
        <span class="hljs-attr">write</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">failures</span>: <span class="hljs-number">0</span> },
        <span class="hljs-attr">delete</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">failures</span>: <span class="hljs-number">0</span> }
      },
      <span class="hljs-attr">sizes</span>: {
        <span class="hljs-attr">localStorage</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">sessionStorage</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">cookies</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">indexedDB</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-attr">limits</span>: {
        <span class="hljs-attr">localStorage</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>, <span class="hljs-comment">// 5MB</span>
        <span class="hljs-attr">sessionStorage</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>, <span class="hljs-comment">// 5MB</span>
        <span class="hljs-attr">cookies</span>: <span class="hljs-number">4096</span>, <span class="hljs-comment">// 4KB</span>
        <span class="hljs-attr">indexedDB</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// æ— æ˜ç¡®é™åˆ¶</span>
      }
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sampleInterval</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxHistorySize</span> = <span class="hljs-number">1000</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startMonitoring</span>();
  }
  
  <span class="hljs-comment">// å¼€å§‹ç›‘æ§</span>
  <span class="hljs-title function_">startMonitoring</span>(<span class="hljs-params">interval = <span class="hljs-number">5000</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sampleInterval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">captureSnapshot</span>();
    }, interval);
    
    <span class="hljs-comment">// åˆå§‹å¿«ç…§</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">captureSnapshot</span>();
    
    <span class="hljs-comment">// ç›‘å¬å­˜å‚¨äº‹ä»¶</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStorageEvent</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    
    <span class="hljs-comment">// ç›‘å¬ beforeunload ä»¥ä¿å­˜æœ€ç»ˆçŠ¶æ€</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveMetricsToLocalStorage</span>();
    });
  }
  
  <span class="hljs-comment">// åœæ­¢ç›‘æ§</span>
  <span class="hljs-title function_">stopMonitoring</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sampleInterval</span>) {
      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sampleInterval</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">sampleInterval</span> = <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStorageEvent</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveMetricsToLocalStorage</span>);
  }
  
  <span class="hljs-comment">// å¤„ç†å­˜å‚¨äº‹ä»¶</span>
  <span class="hljs-title function_">handleStorageEvent</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-keyword">const</span> metricType = event.<span class="hljs-property">newValue</span> ? <span class="hljs-string">'write'</span> : <span class="hljs-string">'delete'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">recordOperation</span>(metricType, event.<span class="hljs-property">key</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
  }
  
  <span class="hljs-comment">// è®°å½•æ“ä½œ</span>
  <span class="hljs-title function_">recordOperation</span>(<span class="hljs-params">type, key, duration, success = <span class="hljs-literal">true</span></span>) {
    <span class="hljs-keyword">const</span> operation = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>[type];
    
    <span class="hljs-keyword">if</span> (operation) {
      operation.<span class="hljs-property">count</span>++;
      operation.<span class="hljs-property">totalTime</span> += duration;
      
      <span class="hljs-keyword">if</span> (!success) {
        operation.<span class="hljs-property">failures</span>++;
      }
    }
    
    <span class="hljs-comment">// æ·»åŠ åˆ°å†å²è®°å½•</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addToHistory</span>({
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      type,
      key,
      duration,
      success
    });
  }
  
  <span class="hljs-comment">// æ·»åŠ åˆ°å†å²è®°å½•</span>
  <span class="hljs-title function_">addToHistory</span>(<span class="hljs-params">entry</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(entry);
    
    <span class="hljs-comment">// é™åˆ¶å†å²è®°å½•å¤§å°</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxHistorySize</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxHistorySize</span>);
    }
  }
  
  <span class="hljs-comment">// æ•è·å¿«ç…§</span>
  <span class="hljs-title function_">captureSnapshot</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> snapshot = {
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">metrics</span>: { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> },
      <span class="hljs-attr">sizes</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateSizes</span>(),
      <span class="hljs-attr">performance</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculatePerformance</span>()
    };
    
    <span class="hljs-comment">// æ›´æ–°å½“å‰å¤§å°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">sizes</span> = snapshot.<span class="hljs-property">sizes</span>;
    
    <span class="hljs-comment">// ä¿å­˜åˆ°å†å²</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(snapshot);
    
    <span class="hljs-comment">// é™åˆ¶å†å²è®°å½•å¤§å°</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxHistorySize</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxHistorySize</span>);
    }
    
    <span class="hljs-keyword">return</span> snapshot;
  }
  
  <span class="hljs-comment">// è®¡ç®—å­˜å‚¨å¤§å°</span>
  <span class="hljs-title function_">calculateSizes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> sizes = {
      <span class="hljs-attr">localStorage</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">sessionStorage</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">cookies</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">indexedDB</span>: <span class="hljs-number">0</span>
    };
    
    <span class="hljs-comment">// è®¡ç®— localStorage å¤§å°</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> localStorageSize = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">localStorage</span>.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> key = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">key</span>(i);
        <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(key);
        localStorageSize += (key.<span class="hljs-property">length</span> + value.<span class="hljs-property">length</span>) * <span class="hljs-number">2</span>;
      }
      sizes.<span class="hljs-property">localStorage</span> = localStorageSize;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Failed to calculate localStorage size:'</span>, error);
    }
    
    <span class="hljs-comment">// è®¡ç®— sessionStorage å¤§å°</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> sessionStorageSize = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; sessionStorage.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> key = sessionStorage.<span class="hljs-title function_">key</span>(i);
        <span class="hljs-keyword">const</span> value = sessionStorage.<span class="hljs-title function_">getItem</span>(key);
        sessionStorageSize += (key.<span class="hljs-property">length</span> + value.<span class="hljs-property">length</span>) * <span class="hljs-number">2</span>;
      }
      sizes.<span class="hljs-property">sessionStorage</span> = sessionStorageSize;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Failed to calculate sessionStorage size:'</span>, error);
    }
    
    <span class="hljs-comment">// è®¡ç®— cookies å¤§å°</span>
    <span class="hljs-keyword">try</span> {
      sizes.<span class="hljs-property">cookies</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-property">length</span> * <span class="hljs-number">2</span>; <span class="hljs-comment">// ç®€å•ä¼°ç®—</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Failed to calculate cookies size:'</span>, error);
    }
    
    <span class="hljs-keyword">return</span> sizes;
  }
  
  <span class="hljs-comment">// è®¡ç®—æ€§èƒ½æŒ‡æ ‡</span>
  <span class="hljs-title function_">calculatePerformance</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> perf = {
      <span class="hljs-attr">averageReadTime</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">averageWriteTime</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">readSuccessRate</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">writeSuccessRate</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">storageUsage</span>: {}
    };
    
    <span class="hljs-keyword">const</span> readOps = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>.<span class="hljs-property">read</span>;
    <span class="hljs-keyword">const</span> writeOps = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>.<span class="hljs-property">write</span>;
    
    <span class="hljs-keyword">if</span> (readOps.<span class="hljs-property">count</span> &gt; <span class="hljs-number">0</span>) {
      perf.<span class="hljs-property">averageReadTime</span> = readOps.<span class="hljs-property">totalTime</span> / readOps.<span class="hljs-property">count</span>;
      perf.<span class="hljs-property">readSuccessRate</span> = (readOps.<span class="hljs-property">count</span> - readOps.<span class="hljs-property">failures</span>) / readOps.<span class="hljs-property">count</span>;
    }
    
    <span class="hljs-keyword">if</span> (writeOps.<span class="hljs-property">count</span> &gt; <span class="hljs-number">0</span>) {
      perf.<span class="hljs-property">averageWriteTime</span> = writeOps.<span class="hljs-property">totalTime</span> / writeOps.<span class="hljs-property">count</span>;
      perf.<span class="hljs-property">writeSuccessRate</span> = (writeOps.<span class="hljs-property">count</span> - writeOps.<span class="hljs-property">failures</span>) / writeOps.<span class="hljs-property">count</span>;
    }
    
    <span class="hljs-comment">// è®¡ç®—å­˜å‚¨ä½¿ç”¨ç‡</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">sizes</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">storageType</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> size = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">sizes</span>[storageType];
      <span class="hljs-keyword">const</span> limit = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">limits</span>[storageType];
      
      <span class="hljs-keyword">if</span> (limit &gt; <span class="hljs-number">0</span>) {
        perf.<span class="hljs-property">storageUsage</span>[storageType] = {
          size,
          limit,
          <span class="hljs-attr">percentage</span>: (size / limit) * <span class="hljs-number">100</span>,
          <span class="hljs-attr">remaining</span>: limit - size
        };
      } <span class="hljs-keyword">else</span> {
        perf.<span class="hljs-property">storageUsage</span>[storageType] = {
          size,
          <span class="hljs-attr">limit</span>: <span class="hljs-string">'unlimited'</span>,
          <span class="hljs-attr">percentage</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">remaining</span>: <span class="hljs-title class_">Infinity</span>
        };
      }
    });
    
    <span class="hljs-keyword">return</span> perf;
  }
  
  <span class="hljs-comment">// è·å–æ€§èƒ½æŠ¥å‘Š</span>
  <span class="hljs-title function_">getReport</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> snapshot = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">captureSnapshot</span>();
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">summary</span>: {
        <span class="hljs-attr">totalOperations</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>).<span class="hljs-title function_">reduce</span>(
          <span class="hljs-function">(<span class="hljs-params">sum, op</span>) =&gt;</span> sum + op.<span class="hljs-property">count</span>, <span class="hljs-number">0</span>
        ),
        <span class="hljs-attr">totalFailures</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>).<span class="hljs-title function_">reduce</span>(
          <span class="hljs-function">(<span class="hljs-params">sum, op</span>) =&gt;</span> sum + op.<span class="hljs-property">failures</span>, <span class="hljs-number">0</span>
        ),
        <span class="hljs-attr">overallSuccessRate</span>: <span class="hljs-number">1</span> - (
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>).<span class="hljs-title function_">reduce</span>(
            <span class="hljs-function">(<span class="hljs-params">sum, op</span>) =&gt;</span> sum + op.<span class="hljs-property">failures</span>, <span class="hljs-number">0</span>
          ) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>).<span class="hljs-title function_">reduce</span>(
            <span class="hljs-function">(<span class="hljs-params">sum, op</span>) =&gt;</span> sum + op.<span class="hljs-property">count</span>, <span class="hljs-number">0</span>
          ))
        ),
        <span class="hljs-attr">monitoringDuration</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? 
          <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>[<span class="hljs-number">0</span>].<span class="hljs-property">timestamp</span> : <span class="hljs-number">0</span>
      },
      <span class="hljs-attr">current</span>: snapshot,
      <span class="hljs-attr">trends</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateTrends</span>(),
      <span class="hljs-attr">recommendations</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateRecommendations</span>()
    };
  }
  
  <span class="hljs-comment">// è®¡ç®—è¶‹åŠ¿</span>
  <span class="hljs-title function_">calculateTrends</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> {};
    
    <span class="hljs-keyword">const</span> recent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">10</span>); <span class="hljs-comment">// æœ€è¿‘10ä¸ªæ ·æœ¬</span>
    <span class="hljs-keyword">const</span> trends = {};
    
    <span class="hljs-comment">// è®¡ç®—æ“ä½œè¶‹åŠ¿</span>
    [<span class="hljs-string">'read'</span>, <span class="hljs-string">'write'</span>, <span class="hljs-string">'delete'</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">opType</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> counts = recent.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">metrics</span>.<span class="hljs-property">operations</span>[opType].<span class="hljs-property">count</span>);
      <span class="hljs-keyword">const</span> avgCount = counts.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / counts.<span class="hljs-property">length</span>;
      
      trends[opType] = {
        <span class="hljs-attr">averagePerSample</span>: avgCount,
        <span class="hljs-attr">trend</span>: counts.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? 
          (counts[counts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] - counts[<span class="hljs-number">0</span>]) / counts[<span class="hljs-number">0</span>] : <span class="hljs-number">0</span>
      };
    });
    
    <span class="hljs-comment">// è®¡ç®—å¤§å°è¶‹åŠ¿</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-property">sizes</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">storageType</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> sizes = recent.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">sizes</span>[storageType]);
      trends[storageType] = {
        <span class="hljs-attr">averageSize</span>: sizes.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / sizes.<span class="hljs-property">length</span>,
        <span class="hljs-attr">growthRate</span>: sizes.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? 
          (sizes[sizes.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] - sizes[<span class="hljs-number">0</span>]) / sizes[<span class="hljs-number">0</span>] : <span class="hljs-number">0</span>
      };
    });
    
    <span class="hljs-keyword">return</span> trends;
  }
  
  <span class="hljs-comment">// ç”Ÿæˆä¼˜åŒ–å»ºè®®</span>
  <span class="hljs-title function_">generateRecommendations</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> recommendations = [];
    <span class="hljs-keyword">const</span> perf = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculatePerformance</span>();
    
    <span class="hljs-comment">// æ£€æŸ¥å­˜å‚¨ä½¿ç”¨ç‡</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(perf.<span class="hljs-property">storageUsage</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[storageType, usage]</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (usage.<span class="hljs-property">percentage</span> &gt; <span class="hljs-number">80</span>) {
        recommendations.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">`<span class="hljs-subst">${storageType}</span> usage is at <span class="hljs-subst">${usage.percentage.toFixed(<span class="hljs-number">1</span>)}</span>%`</span>,
          <span class="hljs-attr">suggestion</span>: <span class="hljs-string">'Consider cleaning up unused data or migrating to IndexedDB'</span>,
          <span class="hljs-attr">priority</span>: <span class="hljs-string">'high'</span>
        });
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (usage.<span class="hljs-property">percentage</span> &gt; <span class="hljs-number">50</span>) {
        recommendations.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'info'</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">`<span class="hljs-subst">${storageType}</span> usage is at <span class="hljs-subst">${usage.percentage.toFixed(<span class="hljs-number">1</span>)}</span>%`</span>,
          <span class="hljs-attr">suggestion</span>: <span class="hljs-string">'Monitor storage usage and consider optimization'</span>,
          <span class="hljs-attr">priority</span>: <span class="hljs-string">'medium'</span>
        });
      }
    });
    
    <span class="hljs-comment">// æ£€æŸ¥æ“ä½œå¤±è´¥ç‡</span>
    <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">readSuccessRate</span> &lt; <span class="hljs-number">0.95</span>) {
      recommendations.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">`Read operation success rate is low: <span class="hljs-subst">${(perf.readSuccessRate * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">1</span>)}</span>%`</span>,
        <span class="hljs-attr">suggestion</span>: <span class="hljs-string">'Check storage availability and error handling'</span>,
        <span class="hljs-attr">priority</span>: <span class="hljs-string">'high'</span>
      });
    }
    
    <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">writeSuccessRate</span> &lt; <span class="hljs-number">0.95</span>) {
      recommendations.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">`Write operation success rate is low: <span class="hljs-subst">${(perf.writeSuccessRate * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">1</span>)}</span>%`</span>,
        <span class="hljs-attr">suggestion</span>: <span class="hljs-string">'Storage may be full or corrupted. Consider cleanup.'</span>,
        <span class="hljs-attr">priority</span>: <span class="hljs-string">'high'</span>
      });
    }
    
    <span class="hljs-comment">// æ£€æŸ¥æ€§èƒ½</span>
    <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">averageReadTime</span> &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// è¶…è¿‡100ms</span>
      recommendations.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">`Average read time is high: <span class="hljs-subst">${perf.averageReadTime.toFixed(<span class="hljs-number">1</span>)}</span>ms`</span>,
        <span class="hljs-attr">suggestion</span>: <span class="hljs-string">'Consider using IndexedDB for large datasets'</span>,
        <span class="hljs-attr">priority</span>: <span class="hljs-string">'medium'</span>
      });
    }
    
    <span class="hljs-keyword">if</span> (perf.<span class="hljs-property">averageWriteTime</span> &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// è¶…è¿‡100ms</span>
      recommendations.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">`Average write time is high: <span class="hljs-subst">${perf.averageWriteTime.toFixed(<span class="hljs-number">1</span>)}</span>ms`</span>,
        <span class="hljs-attr">suggestion</span>: <span class="hljs-string">'Batch write operations or use web workers'</span>,
        <span class="hljs-attr">priority</span>: <span class="hljs-string">'medium'</span>
      });
    }
    
    <span class="hljs-keyword">return</span> recommendations;
  }
  
  <span class="hljs-comment">// ä¿å­˜æŒ‡æ ‡åˆ°æœ¬åœ°å­˜å‚¨</span>
  <span class="hljs-title function_">saveMetricsToLocalStorage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> report = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getReport</span>();
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'storage_performance_metrics'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(report));
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'storage_performance_history'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Failed to save metrics:'</span>, error);
    }
  }
  
  <span class="hljs-comment">// ä»æœ¬åœ°å­˜å‚¨åŠ è½½æŒ‡æ ‡</span>
  <span class="hljs-title function_">loadMetricsFromLocalStorage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> savedReport = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'storage_performance_metrics'</span>);
      <span class="hljs-keyword">const</span> savedHistory = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'storage_performance_history'</span>);
      
      <span class="hljs-keyword">if</span> (savedReport) {
        <span class="hljs-keyword">const</span> report = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(savedReport);
        <span class="hljs-comment">// åˆå¹¶æŒ‡æ ‡</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>, report.<span class="hljs-property">current</span>.<span class="hljs-property">metrics</span>);
      }
      
      <span class="hljs-keyword">if</span> (savedHistory) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(savedHistory);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Failed to load metrics:'</span>, error);
    }
  }
  
  <span class="hljs-comment">// é‡ç½®æŒ‡æ ‡</span>
  <span class="hljs-title function_">resetMetrics</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = {
      <span class="hljs-attr">operations</span>: {
        <span class="hljs-attr">read</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">failures</span>: <span class="hljs-number">0</span> },
        <span class="hljs-attr">write</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">failures</span>: <span class="hljs-number">0</span> },
        <span class="hljs-attr">delete</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">totalTime</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">failures</span>: <span class="hljs-number">0</span> }
      },
      <span class="hljs-attr">sizes</span>: {
        <span class="hljs-attr">localStorage</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">sessionStorage</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">cookies</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">indexedDB</span>: <span class="hljs-number">0</span>
      },
      <span class="hljs-attr">limits</span>: {
        <span class="hljs-attr">localStorage</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
        <span class="hljs-attr">sessionStorage</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
        <span class="hljs-attr">cookies</span>: <span class="hljs-number">4096</span>,
        <span class="hljs-attr">indexedDB</span>: <span class="hljs-number">0</span>
      }
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = [];
  }
  
  <span class="hljs-comment">// å¯¼å‡ºæ•°æ®</span>
  <span class="hljs-title function_">exportData</span>(<span class="hljs-params">format = <span class="hljs-string">'json'</span></span>) {
    <span class="hljs-keyword">const</span> report = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getReport</span>();
    
    <span class="hljs-keyword">switch</span> (format) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'json'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(report, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'csv'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">convertToCSV</span>(report);
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> report;
    }
  }
  
  <span class="hljs-comment">// è½¬æ¢ä¸ºCSV</span>
  <span class="hljs-title function_">convertToCSV</span>(<span class="hljs-params">report</span>) {
    <span class="hljs-keyword">const</span> rows = [];
    
    <span class="hljs-comment">// æ·»åŠ æ‘˜è¦è¡Œ</span>
    rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">'Section,Key,Value'</span>);
    rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Summary,Total Operations,<span class="hljs-subst">${report.summary.totalOperations}</span>`</span>);
    rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Summary,Total Failures,<span class="hljs-subst">${report.summary.totalFailures}</span>`</span>);
    rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Summary,Success Rate,<span class="hljs-subst">${report.summary.overallSuccessRate}</span>`</span>);
    
    <span class="hljs-comment">// æ·»åŠ æ€§èƒ½è¡Œ</span>
    rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">'Performance,Average Read Time,${report.current.performance.averageReadTime}'</span>);
    rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">'Performance,Average Write Time,${report.current.performance.averageWriteTime}'</span>);
    
    <span class="hljs-comment">// æ·»åŠ å­˜å‚¨ä½¿ç”¨è¡Œ</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(report.<span class="hljs-property">current</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">storageUsage</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[storage, usage]</span>) =&gt;</span> {
      rows.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Storage Usage,<span class="hljs-subst">${storage}</span>,<span class="hljs-subst">${usage.percentage.toFixed(<span class="hljs-number">1</span>)}</span>%`</span>);
    });
    
    <span class="hljs-keyword">return</span> rows.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageMonitorExample</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">demonstrate</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// åˆ›å»ºæ€§èƒ½ç›‘æ§å™¨</span>
    <span class="hljs-keyword">const</span> monitor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoragePerformanceMonitor</span>();
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸€äº›å­˜å‚¨æ“ä½œ</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// è®°å½•è¯»å–æ“ä½œ</span>
      <span class="hljs-keyword">const</span> readStart = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'test_key'</span>);
      <span class="hljs-keyword">const</span> readDuration = performance.<span class="hljs-title function_">now</span>() - readStart;
      monitor.<span class="hljs-title function_">recordOperation</span>(<span class="hljs-string">'read'</span>, <span class="hljs-string">'test_key'</span>, readDuration, <span class="hljs-literal">true</span>);
      
      <span class="hljs-comment">// è®°å½•å†™å…¥æ“ä½œ</span>
      <span class="hljs-keyword">const</span> writeStart = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'test_key'</span>, <span class="hljs-string">'test_value'</span>);
      <span class="hljs-keyword">const</span> writeDuration = performance.<span class="hljs-title function_">now</span>() - writeStart;
      monitor.<span class="hljs-title function_">recordOperation</span>(<span class="hljs-string">'write'</span>, <span class="hljs-string">'test_key'</span>, writeDuration, <span class="hljs-literal">true</span>);
    }, <span class="hljs-number">1000</span>);
    
    <span class="hljs-comment">// è·å–æŠ¥å‘Š</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> report = monitor.<span class="hljs-title function_">getReport</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Storage Performance Report:'</span>, report);
      
      <span class="hljs-comment">// å¯¼å‡ºæ•°æ®</span>
      <span class="hljs-keyword">const</span> jsonExport = monitor.<span class="hljs-title function_">exportData</span>(<span class="hljs-string">'json'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'JSON Export:'</span>, jsonExport);
      
      <span class="hljs-comment">// åœæ­¢ç›‘æ§</span>
      monitor.<span class="hljs-title function_">stopMonitoring</span>();
    }, <span class="hljs-number">5000</span>);
    
    <span class="hljs-keyword">return</span> monitor;
  }
}
</code></pre>
<h4 data-id="heading-14">æ€»ç»“</h4>
<p>æœ¬æ–‡å…¨é¢æ¢è®¨äº†æµè§ˆå™¨å­˜å‚¨ç›¸å…³çš„APIå’ŒæŠ€æœ¯ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æœ¬åœ°å­˜å‚¨å°è£…:</strong> å¢å¼ºçš„localStorage/sessionStorageå°è£…ï¼Œæ”¯æŒåŠ å¯†ã€å‹ç¼©ã€è¿‡æœŸæ—¶é—´ç­‰é«˜çº§åŠŸèƒ½</li>
<li><strong>IndexedDBé«˜çº§å°è£…:</strong> å®Œæ•´çš„æ•°æ®åº“æ“ä½œåŒ…è£…å™¨ï¼Œæ”¯æŒè¿ç§»ã€äº‹åŠ¡ã€æŸ¥è¯¢æ„å»ºç­‰</li>
<li><strong>Cookieæ“ä½œåº“:</strong> å®Œæ•´çš„Cookieç®¡ç†å™¨ï¼Œæ”¯æŒè·¨åŸŸæ“ä½œå’Œå®‰å…¨æ€§å¢å¼º</li>
<li><strong>å®‰å…¨å­˜å‚¨å®è·µ:</strong> æ•°æ®åŠ å¯†ã€å¯†é’¥ç®¡ç†ã€å®‰å…¨æœ€ä½³å®è·µ</li>
<li><strong>å­˜å‚¨æ€§èƒ½ç›‘æ§:</strong> å®æ—¶ç›‘æ§å­˜å‚¨ä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡</li>
<li><strong>æ™ºèƒ½å­˜å‚¨é€‰æ‹©å™¨:</strong> æ ¹æ®åœºæ™¯è‡ªåŠ¨é€‰æ‹©æœ€ä½³å­˜å‚¨æ–¹æ¡ˆ</li>
</ol>
<h4 data-id="heading-15">å…³é”®è¦ç‚¹</h4>
<ol>
<li><strong>å®‰å…¨æ€§ä¼˜å…ˆ:</strong> å§‹ç»ˆå¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé¿å…åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ•æ„Ÿä¿¡æ¯</li>
<li><strong>å®¹é‡ç®¡ç†:</strong> ç›‘æ§å­˜å‚¨ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶æ¸…ç†è¿‡æœŸæ•°æ®</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–:</strong> æ‰¹é‡æ“ä½œã€å»¶è¿Ÿå†™å…¥ã€åˆç†é€‰æ‹©å­˜å‚¨åç«¯</li>
<li><strong>å…¼å®¹æ€§è€ƒè™‘:</strong> æä¾›é™çº§æ–¹æ¡ˆï¼Œç¡®ä¿åœ¨ä¸æ”¯æŒæŸäº›APIçš„æµè§ˆå™¨ä¸­æ­£å¸¸è¿ä½œ</li>
<li><strong>ç”¨æˆ·ä½“éªŒ:</strong> å¼‚æ­¥æ“ä½œé¿å…é˜»å¡UIï¼Œæä¾›é€‚å½“çš„åŠ è½½çŠ¶æ€</li>
<li><strong>æ•°æ®å®Œæ•´æ€§:</strong> å®ç°æ•°æ®éªŒè¯ã€ç‰ˆæœ¬æ§åˆ¶å’Œè¿ç§»ç­–ç•¥</li>
</ol>
<h4 data-id="heading-16">æœ€ä½³å®è·µå»ºè®®</h4>
<ol>
<li><strong>åˆ†å±‚å­˜å‚¨ç­–ç•¥:</strong></li>
</ol>
<ul>
<li>é¢‘ç¹è®¿é—®çš„å°æ•°æ®ï¼šä½¿ç”¨å†…å­˜ç¼“å­˜</li>
<li>ç”¨æˆ·ä¼šè¯æ•°æ®ï¼šä½¿ç”¨sessionStorage</li>
<li>é•¿æœŸåå¥½è®¾ç½®ï¼šä½¿ç”¨localStorage</li>
<li>å¤§é‡ç»“æ„åŒ–æ•°æ®ï¼šä½¿ç”¨IndexedDB</li>
<li>èº«ä»½éªŒè¯ä»¤ç‰Œï¼šä½¿ç”¨HttpOnly Cookie</li>
</ul>
<ol start="2">
<li><strong>æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†:</strong></li>
</ol>
<ul>
<li>ä¸ºæ‰€æœ‰å­˜å‚¨æ•°æ®è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</li>
<li>å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶</li>
<li>æä¾›æ•°æ®å¯¼å‡º/å¯¼å…¥åŠŸèƒ½</li>
</ul>
<ol start="3">
<li><strong>é”™è¯¯å¤„ç†å’Œé™çº§:</strong></li>
</ol>
<ul>
<li>æ•è·æ‰€æœ‰å­˜å‚¨æ“ä½œå¼‚å¸¸</li>
<li>æä¾›å‹å¥½çš„é”™è¯¯æç¤º</li>
<li>å®ç°é™çº§åˆ°æ›´ç®€å•çš„å­˜å‚¨æ–¹æ¡ˆ</li>
</ul>
<ol start="4">
<li><strong>éšç§åˆè§„:</strong></li>
</ol>
<ul>
<li>éµå¾ªGDPRã€CCPAç­‰éšç§æ³•è§„</li>
<li>æä¾›ç”¨æˆ·æ•°æ®æ¸…é™¤åŠŸèƒ½</li>
<li>æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ•°æ®ä½¿ç”¨æ–¹å¼</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›æŠ€æœ¯å’Œç­–ç•¥ï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºå‡ºæ—¢å®‰å…¨åˆé«˜æ•ˆçš„Webåº”ç”¨å­˜å‚¨ç³»ç»Ÿï¼Œæä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å°ç™½ä¹Ÿèƒ½å­¦ä¼šï¼šAIåˆ†ç¦»äººå£° + FFmpegæ›¿æ¢éŸ³è½¨å…¨æµç¨‹]]></title>    <link>https://juejin.cn/post/7584475608220205107</link>    <guid>https://juejin.cn/post/7584475608220205107</guid>    <pubDate>2025-12-17T06:48:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584475608220205107" data-draft-id="7584466603808981030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å°ç™½ä¹Ÿèƒ½å­¦ä¼šï¼šAIåˆ†ç¦»äººå£° + FFmpegæ›¿æ¢éŸ³è½¨å…¨æµç¨‹"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-17T06:48:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å°ç™½ä¹Ÿèƒ½å­¦ä¼šï¼šAIåˆ†ç¦»äººå£° + FFmpegæ›¿æ¢éŸ³è½¨å…¨æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:48:30.000Z" title="Wed Dec 17 2025 06:48:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‡†å¤‡å·¥ä½œï¼ˆä½ éœ€è¦çš„å·¥å…·ï¼‰</h2>
<p>æœ¬æ•™ç¨‹åªç”¨ä¸¤æ ·ä¸œè¥¿ï¼švocal-separateï¼ˆæœ¬åœ°åˆ†ç¦»äººå£°/ä¼´å¥ï¼‰å’ŒFFmpegï¼ˆæŠŠä¼´å¥æ›¿æ¢å›è§†é¢‘ï¼‰ã€‚
vocal-separateæ˜¯æœ¬åœ°ç½‘é¡µæ“ä½œï¼šWindowsè§£å‹ååŒå‡»start.exeå³å¯è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨é¡µé¢ä¸Šä¼ æ–‡ä»¶åˆ†ç¦»ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šç”¨vocal-separateåˆ†ç¦»ä¼´å¥</h2>
<ol>
<li>ä¸‹è½½å¹¶è§£å‹vocal-separateåˆ°ä»»æ„ç›®å½•ï¼ˆä¾‹å¦‚E:/vocal-separateï¼‰ï¼Œç„¶ååŒå‡»start.exeå¯åŠ¨ã€‚</li>
<li>æµè§ˆå™¨é¡µé¢æ‰“å¼€åï¼ŒæŠŠè§†é¢‘æ–‡ä»¶ç›´æ¥æ‹–æ‹½åˆ°ä¸Šä¼ åŒºåŸŸï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ åŒºåŸŸé€‰æ‹©æ–‡ä»¶ï¼Œç„¶åç‚¹â€œç«‹å³åˆ†ç¦»â€ã€‚</li>
<li>é€‰æ‹©æ¨¡å‹æ—¶ï¼Œå°ç™½ä¼˜å…ˆç”¨2stemsï¼ˆæ›´ç®€å•ï¼šè¾“å‡ºvocalå’Œaccompanimentä¸¤æ¡éŸ³è½¨ï¼‰ï¼Œç­‰å¾…å¤„ç†å®Œæˆååœ¨é¡µé¢åº•éƒ¨ä¸‹è½½accompaniment.wavï¼ˆä¼´å¥ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šå®‰è£…FFmpegï¼ˆä»¥Windowsä¸ºä¾‹ï¼‰</h2>
<p>Windowsæœ€å¸¸è§çš„åšæ³•æ˜¯ä¸‹è½½å·²ç¼–è¯‘çš„FFmpegäºŒè¿›åˆ¶åŒ…ï¼ˆä¾‹å¦‚gyan.devæä¾›çš„buildï¼‰ï¼Œè§£å‹åæŠŠbinç›®å½•åŠ å…¥ç³»ç»ŸPATHï¼Œè¿™æ ·åœ¨å‘½ä»¤è¡Œå¯ç›´æ¥è¿è¡Œffmpegã€‚
å®‰è£…å®Œæˆåï¼Œæ‰“å¼€â€œå‘½ä»¤æç¤ºç¬¦/PowerShellâ€è¾“å…¥<code>ffmpeg -version</code>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼ˆèƒ½æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å°±å¯¹äº†ï¼‰ã€‚</p>
<h2 data-id="heading-3">ç¬¬ä¸‰æ­¥ï¼šæ›¿æ¢è§†é¢‘éŸ³è½¨ï¼ˆæ ¸å¿ƒå‘½ä»¤ï¼‰</h2>
<p>æŠŠâ€œåŸè§†é¢‘çš„ç”»é¢â€ä¿ç•™ï¼ŒåŒæ—¶æŠŠâ€œéŸ³é¢‘â€æ¢æˆåˆšåˆšå¯¼å‡ºçš„ä¼´å¥ï¼Œæ¨èç”¨è¿™ä¸€æ¡å‘½ä»¤ï¼ˆæŠŠæ–‡ä»¶åæŒ‰ä½ è‡ªå·±çš„æ”¹æ‰ï¼‰ï¼š
<code>ffmpeg -i input_video.mp4 -i accompaniment.wav -map 0:v:0 -map 1:a:0 -c:v copy -c:a aac -shortest output_no_vocals.mp4</code></p>
<p>å‡ ä¸ªå‚æ•°æ€ä¹ˆç†è§£ï¼š</p>
<ul>
<li><code>-map 0:v:0</code>é€‰ç¬¬1ä¸ªè¾“å…¥ï¼ˆåŸè§†é¢‘ï¼‰çš„ç¬¬1æ¡è§†é¢‘æµï¼Œ<code>-map 1:a:0</code>é€‰ç¬¬2ä¸ªè¾“å…¥ï¼ˆä¼´å¥ï¼‰çš„ç¬¬1æ¡éŸ³é¢‘æµã€‚</li>
<li><code>-c:v copy</code>è¡¨ç¤ºè§†é¢‘ä¸é‡æ–°ç¼–ç ï¼Œé€Ÿåº¦å¿«ä¸”ç”»è´¨ä¸å˜ï¼›<code>-shortest</code>è®©è¾“å‡ºæ—¶é•¿æŒ‰è¾ƒçŸ­çš„ä¸€è·¯å¯¹é½ï¼Œé¿å…â€œé»‘å±ä½†è¿˜åœ¨æ”¾éŸ³é¢‘â€ç­‰æƒ…å†µã€‚</li>
</ul>
<p>å¦‚æœæ–°éŸ³é¢‘å’Œè§†é¢‘æ—¶é•¿ä¸ä¸€è‡´ï¼Œå¯ä»¥å…ˆè£å‰ªéŸ³é¢‘åˆ°è§†é¢‘æ—¶é•¿å†æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š<br/>
<code>ffmpeg -i accompaniment.wav -t 00:01:30 trimmed.wav</code>ï¼Œå†ç”¨trimmed.wavå»æ›¿æ¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¹¶å‘äº‹åŠ¡ A/B å¦‚ä½•é¿å…äº’ç›¸å½±å“ï¼ˆUPDATE æœ‰äº¤é›†]]></title>    <link>https://juejin.cn/post/7584339190035382312</link>    <guid>https://juejin.cn/post/7584339190035382312</guid>    <pubDate>2025-12-17T06:02:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584339190035382312" data-draft-id="7584370833704648719" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹¶å‘äº‹åŠ¡ A/B å¦‚ä½•é¿å…äº’ç›¸å½±å“ï¼ˆUPDATE æœ‰äº¤é›†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T06:02:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†å‡ºå‘Start"/> <meta itemprop="url" content="https://juejin.cn/user/4242362707223661"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹¶å‘äº‹åŠ¡ A/B å¦‚ä½•é¿å…äº’ç›¸å½±å“ï¼ˆUPDATE æœ‰äº¤é›†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4242362707223661/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†å‡ºå‘Start
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:02:56.000Z" title="Wed Dec 17 2025 06:02:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¹¶å‘äº‹åŠ¡ A/B å¦‚ä½•é¿å…äº’ç›¸å½±å“ï¼ˆUPDATE æœ‰äº¤é›†ï¼‰</h2>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒæœºåˆ¶</h3>
<p>å½“äº‹åŠ¡ Aã€B çš„ <code>UPDATE</code> æ“ä½œæ¶‰åŠåŒä¸€æ‰¹æ•°æ®æ—¶ï¼ŒMySQLï¼ˆInnoDBï¼‰ä¸»è¦é ä¸‰ç±»æœºåˆ¶ä¿è¯â€œä¸ä¼šäº’ç›¸æŠŠæ•°æ®å†™ä¹±â€ï¼š</p>
<ol>
<li><strong>é”ï¼ˆLockingï¼‰</strong> ï¼šå†™æ“ä½œå¯¹ç›®æ ‡è®°å½•åŠ  <strong>æ’ä»–é” X é”</strong>ï¼ŒåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªäº‹åŠ¡æ”¹åŒä¸€è¡Œã€‚</li>
<li><strong>éš”ç¦»çº§åˆ«ï¼ˆIsolationï¼‰</strong> ï¼šå¸¸è§é»˜è®¤æ˜¯ <strong>RRï¼ˆå¯é‡å¤è¯»ï¼‰</strong> ï¼Œé…åˆ <strong>MVCC</strong> å¤„ç†è¯»ä¸€è‡´æ€§ï¼›å†™å†²çªåˆ™é é”ä¸²è¡ŒåŒ–ã€‚</li>
<li><strong>äº‹åŠ¡åŸå­æ€§ä¸æäº¤ï¼ˆACIDï¼‰</strong> ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸæäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼›é”é€šå¸¸åœ¨ <strong>COMMIT/ROLLBACK</strong> æ‰é‡Šæ”¾ï¼ˆåœ¨äº‹åŠ¡è¯­å¥å—å†…ï¼‰ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-2">äºŒã€å…·ä½“åœºæ™¯ï¼šä¸¤ä¸ªäº‹åŠ¡åŒæ—¶è½¬è´¦ï¼ˆåŒä¸€è´¦æˆ·è¡Œå‘ç”Ÿäº¤é›†ï¼‰</h3>
<h4 data-id="heading-3">2.1æ­£ç¡®å†™æ³•</h4>
<p>å‡è®¾è¡¨ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> account (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  balance <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB;
</code></pre>
<h4 data-id="heading-4">åœºæ™¯ 1ï¼šç›´æ¥ UPDATEï¼ˆæ¨èå†™æ³•ï¼Œå¤©ç„¶åŠ  X é”ï¼‰</h4>
<p><strong>äº‹åŠ¡ Aï¼šç»™ id=1 æ‰£ 80</strong></p>
<pre><code class="hljs language-ini" lang="ini">START TRANSACTION<span class="hljs-comment">;</span>
UPDATE account SET <span class="hljs-attr">balance</span> = balance - <span class="hljs-number">80</span> WHERE id = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
COMMIT<span class="hljs-comment">;</span>
</code></pre>
<p><strong>äº‹åŠ¡ Bï¼šåŒæ—¶ç»™ id=1 æ‰£ 50</strong></p>
<pre><code class="hljs language-ini" lang="ini">START TRANSACTION<span class="hljs-comment">;</span>
UPDATE account SET <span class="hljs-attr">balance</span> = balance - <span class="hljs-number">50</span> WHERE id = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
COMMIT<span class="hljs-comment">;</span>
</code></pre>
<p><strong>å¹¶å‘æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼ˆæœ¬è´¨ï¼‰</strong></p>
<ul>
<li>A æ‰§è¡Œåˆ° <code>UPDATE ... WHERE id=1</code> æ—¶ï¼ŒInnoDB ä¼šå¯¹ <strong>id=1 è¿™ä¸€è¡Œ</strong>åŠ  <strong>X é”</strong>ã€‚</li>
<li>B ä¹Ÿè¦æ›´æ–° id=1ï¼Œå› æ­¤å®ƒä¹Ÿè¦æ‹¿ id=1 çš„ X é”ï¼Œä½†æ‹¿ä¸åˆ°ï¼Œåªèƒ½ <strong>ç­‰å¾…</strong>ï¼ˆæˆ–è¶…æ—¶å¤±è´¥ï¼‰ã€‚</li>
<li>A <code>COMMIT</code> åé‡Šæ”¾é”ï¼ŒB æ‰èƒ½ç»§ç»­ã€‚</li>
</ul>
<p><strong>ç»“æœï¼šä¸ä¼šå‡ºç°â€œä¸¤ä¸ªäº‹åŠ¡äº’ç›¸è¦†ç›–å†™â€çš„é—®é¢˜</strong>ã€‚å†™å…¥é¡ºåºè¢«é”å¼ºåˆ¶ä¸²è¡ŒåŒ–ã€‚</p>
<hr/>
<h4 data-id="heading-5">2.1â€œçœ‹ä¼¼æ­£ç¡®ä½†ä¼šå‡ºé”™â€çš„å†™æ³•ï¼šå…ˆ SELECT å† UPDATE</h4>
<h4 data-id="heading-6">1ï¼‰é”™è¯¯çš„åŸå› ï¼ˆä¸åŠ é”çš„ SELECT åªæ˜¯å¿«ç…§è¯»ï¼‰</h4>
<p>ä¾‹å­ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>åŠ ä¸€ä¸ª<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>ä¼šå®ç°åŠ Xé”
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p>é—®é¢˜åœ¨äºï¼šå¦‚æœ <code>SELECT balance ...</code> <strong>ä¸å¸¦ <code>FOR UPDATE</code> / <code>LOCK IN SHARE MODE</code></strong>ï¼Œå®ƒé€šå¸¸æ˜¯ <strong>MVCC ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»ï¼‰</strong> ï¼š</p>
<ul>
<li>ä¸ä¼šå¯¹æ•°æ®è¡ŒåŠ è¡Œé”</li>
<li>è¯»åˆ°çš„ balance å¯èƒ½æ˜¯ä¸€ä¸ªâ€œå½“æ—¶çš„ç‰ˆæœ¬â€</li>
<li>ä¹‹åå† <code>UPDATE</code>ï¼Œå¹¶ä¸èƒ½ä¿è¯ä½ åŸºäºåˆšæ‰è¯»åˆ°çš„å€¼åšå†³ç­–æ—¶ï¼Œä¸­é—´æ²¡è¢«åˆ«äººæ”¹è¿‡</li>
</ul>
<p>å…¸å‹é”™è¯¯ï¼š<strong>ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰/ è¯»-æ”¹-å†™ç«äº‰</strong>ã€‚</p>
<h4 data-id="heading-7">2ï¼‰æ­£ç¡®åšæ³•ï¼šè¯»å‰é”å®šï¼ˆSELECT ... FOR UPDATEï¼‰</h4>
<p>æŠŠè¯»æ”¹æˆåŠ é”è¯»ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŸºäº balance åšä¸šåŠ¡åˆ¤æ–­</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">80</span> <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p>è¿™æ—¶ï¼š</p>
<ul>
<li><code>FOR UPDATE</code> ä¼šå¯¹åŒ¹é…è¡ŒåŠ  <strong>X é”</strong>ï¼ˆæ›´å‡†ç¡®è¯´ï¼šå¯¹è®¿é—®åˆ°çš„è®°å½•åŠ é”ï¼‰</li>
<li>å…¶ä»–äº‹åŠ¡æƒ³æ”¹åŒä¸€è¡Œä¼šè¢«é˜»å¡</li>
<li>ä½ åç»­çš„ä¸šåŠ¡åˆ¤æ–­å’Œæ›´æ–°æ˜¯â€œåœ¨é”ä¿æŠ¤ä¸‹å®Œæˆâ€çš„</li>
</ul>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€ä¸€æ¡sqlè¯­å¥æ‰§è¡Œæ—¶ï¼ŒMysqlåšäº†ä»€ä¹ˆ</h3>
<h4 data-id="heading-9">1ï¼‰é»˜è®¤è¡Œä¸º</h4>
<ul>
<li>
<p>é€šå¸¸ MySQL é»˜è®¤ <code>autocommit=1</code></p>
</li>
<li>
<p>è¿™æ„å‘³ç€ï¼š<strong>æ¯æ¡è¯­å¥æœ¬èº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹äº‹åŠ¡</strong></p>
<ul>
<li>è¯­å¥å¼€å§‹ï¼šéšå¼ <code>BEGIN</code></li>
<li>è¯­å¥ç»“æŸï¼šéšå¼ <code>COMMIT</code></li>
</ul>
</li>
<li>
<p>å› æ­¤é”çš„ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬æ˜¯ï¼š<strong>è¯­å¥æ‰§è¡ŒæœŸé—´æŒæœ‰ï¼Œè¯­å¥ç»“æŸç«‹å³é‡Šæ”¾</strong>ï¼ˆå•æ¡è¯­å¥åœºæ™¯ï¼‰</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">å››ã€ä¸æ˜¾å¼å¼€å¯äº‹åŠ¡ï¼Œåªæ‰§è¡Œæ™®é€š SELECTï¼Œä¼šåšä»€ä¹ˆï¼Ÿ</h3>
<h4 data-id="heading-11">Q1ï¼š</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id
<span class="hljs-keyword">FROM</span> user_score
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span>;
</code></pre>
<h4 data-id="heading-12">æœ€å¸¸è§æƒ…å†µï¼ˆInnoDB + RR + æ™®é€š SELECTï¼‰</h4>
<ol>
<li>
<p><strong>ä¸€è‡´æ€§è¯»ï¼ˆMVCC/å¿«ç…§è¯»ï¼‰</strong></p>
<ul>
<li>ä¸åŠ è¡Œé”</li>
<li>ä¸ä¼šé”ä½ <code>score &gt;= 60</code> çš„èŒƒå›´</li>
<li>ä¸é˜»å¡å¹¶å‘ UPDATE/INSERTï¼Œä¸€èˆ¬ä¹Ÿä¸è¢«å¹¶å‘å†™é˜»å¡</li>
</ul>
</li>
<li>
<p><strong>ä»ç„¶ä¼šåŠ  MDLï¼ˆå…ƒæ•°æ®é”ï¼‰è¯»é”</strong></p>
<ul>
<li>æ‰€æœ‰è®¿é—®è¡¨çš„è¯­å¥éƒ½ä¼šæ‹¿ MDLï¼ˆç»“æ„å±‚é¢çš„é”ï¼‰</li>
<li>é˜²æ­¢ä½ åœ¨è¯»çš„æ—¶å€™åˆ«äºº <code>ALTER TABLE</code> æ”¹ç»“æ„</li>
<li>åœ¨ autocommit ä¸‹ï¼Œè¯­å¥ç»“æŸé‡Šæ”¾</li>
</ul>
</li>
</ol>
<p><strong>ç»“è®º</strong>ï¼šæ™®é€š SELECT ä¸ä¼šé”ä½ score&gt;=60 çš„æ•°æ®è¡ŒèŒƒå›´ã€‚</p>
<hr/>
<h3 data-id="heading-13">äº”ã€Q2ï¼šUPDATE èŒƒå›´æ¡ä»¶æ—¶ï¼Œæ˜¯â€œåŒæ—¶é”ä½æ‰€æœ‰è¡Œâ€è¿˜æ˜¯â€œè¾¹æ‰«è¾¹é”â€ï¼Ÿé”æ˜¯è¡Œçº§è¿˜æ˜¯é¡µçº§ï¼Ÿ</h3>
<h4 data-id="heading-14">Q2ï¼š</h4>
<pre><code class="hljs language-ini" lang="ini">UPDATE user_score SET <span class="hljs-attr">level</span> = level + <span class="hljs-number">1</span> WHERE score &gt;= <span class="hljs-number">60</span><span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-15">ç»“è®ºï¼šè¾¹æ‰«æè¾¹åŠ é”ï¼ˆé€æ¡/é€æ®µï¼‰</h4>
<p>æ›´ç»†çš„æ‰§è¡ŒèŠ‚å¥é€šå¸¸æ˜¯ï¼š</p>
<ol>
<li>è¯­å¥å¼€å§‹ï¼ˆéšå¼äº‹åŠ¡å¼€å§‹ï¼‰</li>
<li>åˆ©ç”¨ <code>idx_score</code>ï¼ˆå‡è®¾å­˜åœ¨ï¼‰å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ <code>score &gt;= 60</code> çš„ç´¢å¼•ä½ç½®</li>
<li><strong>é”ä½å½“å‰ç´¢å¼•è®°å½•ï¼ˆrecord/next-keyï¼‰</strong></li>
<li>æ ¹æ®ç´¢å¼•é¡¹å®šä½åˆ°èšç°‡ç´¢å¼•è®°å½•ï¼Œå¯¹æ•°æ®è¡ŒåŠ  <strong>X é”</strong>ï¼Œæ‰§è¡Œæ›´æ–°</li>
<li>ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡ç´¢å¼•è®°å½•ï¼Œé‡å¤ 3~4</li>
<li>æ‰«æç»“æŸï¼Œè¯­å¥ç»“æŸï¼ˆéšå¼ COMMITï¼‰ï¼Œé‡Šæ”¾é”</li>
</ol>
<h4 data-id="heading-16">é”çš„ç²’åº¦ï¼šä¸»è¦æ˜¯è¡Œçº§/ç´¢å¼•è®°å½•çº§ï¼Œä¸æ˜¯ç²—ç³™é¡µé”</h4>
<ul>
<li>InnoDB çš„æ ¸å¿ƒæ˜¯ <strong>è®°å½•é”ï¼ˆrecord lockï¼‰</strong> ã€<strong>é—´éš™é”ï¼ˆgap lockï¼‰</strong> ã€<strong>Next-Key é”</strong>ï¼ˆrecord+gapï¼‰</li>
<li>åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹ï¼ŒèŒƒå›´æ›´æ–°é€šå¸¸ä¼šæ¶‰åŠ <strong>Next-Key é”</strong> æ¥é˜²æ­¢å¹»è¯»ï¼ˆå°¤å…¶æ˜¯åŸºäºäºŒçº§ç´¢å¼•çš„èŒƒå›´æ¡ä»¶ï¼‰</li>
<li>è¿™ä¸æ˜¯â€œæ•´é¡µé”ä½â€ï¼Œè€Œæ˜¯â€œå¯¹ç´¢å¼•è®°å½•åŠå…¶é—´éš™åšé”å®šâ€ï¼Œç²’åº¦ä¾ç„¶æ˜¯ç´¢å¼•/è®°å½•å±‚é¢</li>
</ul>
<hr/>
<h3 data-id="heading-17">å…­ã€è¡¥å……ï¼šä¸¤ä¸ª UPDATE æœ‰äº¤é›†æ—¶çš„å…¸å‹é£é™©ä¸å¤„ç†</h3>
<h4 data-id="heading-18">1ï¼‰æ­»é”ï¼ˆDeadlockï¼‰</h4>
<p>å¦‚æœ A æ›´æ–°è¡Œé¡ºåºæ˜¯ï¼šå…ˆ id=1 å† id=2<br/>
B æ›´æ–°é¡ºåºæ˜¯ï¼šå…ˆ id=2 å† id=1<br/>
å°±å¯èƒ½äº’ç›¸ç­‰å¾…å½¢æˆæ­»é”ã€‚InnoDB ä¼šæ£€æµ‹å¹¶å›æ»šå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ã€‚</p>
<h4 data-id="heading-19">2ï¼‰å®åŠ¡å»ºè®®ï¼ˆä»…æ•´ç†ï¼Œä¸æ”¹ä½ çš„ç»“è®ºé£æ ¼ï¼‰</h4>
<ul>
<li>å¯¹åŒä¸€æ‰¹è¡Œçš„æ›´æ–°å°½é‡ä¿æŒä¸€è‡´çš„è®¿é—®é¡ºåºï¼ˆä¾‹å¦‚æŒ‰ä¸»é”®å‡åºï¼‰</li>
<li>â€œå…ˆè¯»åæ”¹â€çš„é€»è¾‘å°½é‡ç”¨ <code>SELECT ... FOR UPDATE</code> æˆ–ç›´æ¥ç”¨å•æ¡åŸå­ UPDATE è¡¨è¾¾</li>
<li>çˆ¶è¡¨è¢«å¼•ç”¨åˆ—é€šå¸¸è®¾è®¡ä¸º <code>PRIMARY</code> æˆ– <code>UNIQUE</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue+javaåˆ†ç¦»é¡¹ç›®å®ç°å¾®ä¿¡å…¬ä¼—å·å¼€å‘å…¨æµç¨‹æ¢³ç†]]></title>    <link>https://juejin.cn/post/7584379805899145268</link>    <guid>https://juejin.cn/post/7584379805899145268</guid>    <pubDate>2025-12-17T06:05:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805899145268" data-draft-id="7584286241489076264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue+javaåˆ†ç¦»é¡¹ç›®å®ç°å¾®ä¿¡å…¬ä¼—å·å¼€å‘å…¨æµç¨‹æ¢³ç†"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-17T06:05:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LaughingDangZi"/> <meta itemprop="url" content="https://juejin.cn/user/3034307822374733"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue+javaåˆ†ç¦»é¡¹ç›®å®ç°å¾®ä¿¡å…¬ä¼—å·å¼€å‘å…¨æµç¨‹æ¢³ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307822374733/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LaughingDangZi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:05:07.000Z" title="Wed Dec 17 2025 06:05:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#36ace1;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{color:#36ace1}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"";display:block;position:absolute;left:0;top:0;bottom:0;margin:auto;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAF8UlEQVRIS71Wa2wUVRT+7r0zu9t2t/RBaSioPCpYbIUfaEIQUogSAwZDAlUSGwgg/CBATExMCJH1D2hIfOEjFEUEhViCgBgIUCH44OkjPAMGBVqhpUCfW3Zn5z7MuQOE0hYxMdxJdmd25s53vnO+851leMCLPWA8/CfA2TsvL8n7q+nTFfNLG+4VqInHOeJLDQMzdz/3r4DGGDb9lxu+aPcE7U61JHDMDePcuv0O21ShugOefqDdtBie3Dk6K/O+Ab+qOjJiz7Ahv6c8hbDDwRiQlgYGDOcaWyEcjg8On+j71IpJndjGt9XO+jM7+pkywNvbazIfercieSdoJ4bE5sWjyZqMpDdeaQNXMNC34ME3LV8B56+1w3AOgk+EXe/Ub6uiLB6XdH/G/mYjeBCcFwnt3zQqWt4t4NjjnhzQ1CGkBhwOCMFAB71U0qsYgRlwBtQ1tiEJAy44OBdQUmFK3aWS06NLT+ukZAQoKCCjsfbDmk6p78RwX3ncWffmIj8U4kh6GpEwh+9rGy23LDU4GBrrm9DsuDYIGMAYIC/EUNQ7Cq1hn+WM2TI8f+jEyCmvjfn1FssuojHx6tDkyZOaCzr8TNpASzDAk8amlRIrEylcSGsYrcGIstIYWhgDDIM2BiGH3ywFkGAC1U9n38bpVqWGdk6r4HMWrZZaG1D5KLn0qYyBEAKnG1otAxLR8L7Z9nfP13CJHQ/ST4vK8sVHe8JsU0U6uO5hlexo8PI7vNDQomwoBRAwpSmtgJAAztS3QLsOsmBQlBtFJMQhlbbPUBBUR7o2hqHVddLbRsfCPQJ+u3TPw8uGl1yklAlHIJZKo3//XEhlLCtifPFyM7xwCI/lZ8IKTTBbS7pPLIggZZsSQ+zXbT4UYSsnet3UMM5HPT5LGbrDGYQroClyT2Jwnyj9aN949e8mDCwuRFoqKxRHUJ21BSDRELuQYGhvbMVV32Dp2RuxcfHSRBfAYTsbU9nJdFj5EiLkglHkRInC1xoxKbH9hQJIaTDvxxTCUddWl4wg0dCCtqSPDmoVx4Eitpxh64ZtsT6b5ie6pPRkfF90TllxOzEwmipMKRRgHODGgCuJkqIcvDdC2BZ5Y+tlHHMzkAKghbAxcQqQDiKrFBxhqg5MHTivS1tQ+sdsvaQl5Yd6yfdRXNQLsQwXnq/AQFLXEIIjzBSuNaaR0SuEtkQKl9IKjAsbJaWfzo1USDsM6zceDJfeVGgnhhN2N7YOyo5kJz1pa2AbgfrO1gRwXW6vSRQNtddR+EhvKGmseskgTtY2Q7kucYWWgToPHzyUyXry0iXfnBtfl5f/PaWPvPNW/zkOAQegJHltFE5dSaCskHqPVEnqpMAMEgkPtR1pKxyh/N0/vTToubtH1G3RmLjhM8ubKXfWB2mRa9ySOaWS2uT8lTZ0cI6I52Ngv7zAbW9mQVm1cpytu441P38XeXTlQu+e46nyh+bjLkMZRU0MCYTCJWZSG1y7cBWNURpxBlxqFBfEwGnGGhaYPSNwhpSv4DK+/vPynBk9MqRIiOWs8a2WJTm9a+cgh6SaMIMz9W1WjYHHMtv0wSmZdWB9gdsya/rcYVg7JoffCdqlD6ceTpiY59tM0PhJp5WNvra+BQkejCMyBarr8KKYDcZi8sDaCDKYFIGRk+FnSVXzyTO9JxBwF8DLc1dlLn65ooNEYN0fBsu21fTvL6PXnhxXlnLIqqhYYBian4lQ2Lk9ogiALsimiLC1QYfhlV1Hnxh7JfcMqxrpd7U2GFa5t9nOd7Kr+kg4uWvnCpromlJeXlq3Os3ZLOlrZBmNQf1ybVqpxhbA7mRIOCy1+esDOWhIyDv/+3Q7LRbsqH+rKRJ+nba+/+WW7II1s9vvVBuNr7KNF1WUM1bSt5f1Vq01jUVkKfnx8uoti3Or5rbd9782M61azJz/rFywYU/OyKqK1p5G2MS1Z18tGFDwTkvIxcK9RwaMP3a9/tbc62lPj/Nw5B9ey9Ehy/MY4oEqelgNleuyCgdXJlmc3fO5Ll56r5f+n/f+AWFf9jvBgaHpAAAAAElFTkSuQmCC);animation:spin 2s linear 1s infinite}.markdown-body h1{position:relative;font-size:30px;padding:12px 38px;margin:30px 0}.markdown-body h1:before{width:30px;height:30px;background-size:30px 30px}.markdown-body h2{position:relative;font-size:24px;padding:12px 36px;margin:28px 0}.markdown-body h2:before{width:28px;height:28px;background-size:28px 28px}.markdown-body h3{position:relative;font-size:18px;padding:4px 32px;margin:26px 0}.markdown-body h3:before{width:24px;height:24px;background-size:24px 24px}.markdown-body h4{position:relative;padding:4px 28px;font-size:16px;margin:22px 0}.markdown-body h4:before{width:20px;height:20px;background-size:20px 20px}.markdown-body h5{position:relative;padding:4px 26px;font-size:15px;margin:20px 0}.markdown-body h5:before{width:18px;height:18px;background-size:18px 18px}.markdown-body h6{position:relative;padding:4px 22px;font-size:14px;margin:16px 0}.markdown-body h6:before{width:16px;height:16px;background-size:16px 16px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#36ace1,#dff0fe,#36ace1);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:50px;height:24px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAEgElEQVRIS72Va0xbZRjH/z2FcimbchEQFDYRCIRAAWFQ2MaCXBwmUxYDLGGEcRFkH9wmk04zG0Bo2dwNIisERANqhjqdEmhd4nRbuwpsXDYWLLoRgeG4Chu9QHvMOQ0dpTAKH3y/tDnv8/5/z/Oc//scBv6nxdgoJ14gVYPEuITHdTdHY12gRIH0T0KljlqwthqUFHGtzAEsxqwLtPvkdc+FeeI3BgMeAMEhdOqR1mM7xswBrgmKE8pfIUhtm7fbZsft/i7wc98MtrUFxmbU6ByYgFwxjtFp5Q+WpF1mCy9wajXoqqD4E91saOf603e+5B7t99xTkyZJEiKJAl2DE9Xio1HvrBS8IuhVwVUP503swdJ9QWAw1izaoDs6pQT/655BMS9yy3KYiUoM/7adu7NmtnQfx5zWm8Q8Ui3gyGcddyU8rv/STRNQouDGP5/mhTubX4dpPv3DMzh1qS9LwuPWr+i63WVyn5QYj/4d/i4bqmbpoQ+auvBlQYghX6PE4wTSOzV5EUYlb5Q4MDqLk9/3cMRF27spDSNQamUnWZ4ebNB+OKNCyYVeFCZ5wZ5tiePN/UiP2YoQL0cUX+iFt4sNUiLdcaVvHJLecQiWnKVE8s5LvxAXRWeYgHLre0hecgAN0sxr0XBZgbJUP6OiLnaM4ivZCBrzOWBZEIY9rY5E8pl2nM0KMzzLq5aPiXmRzgbQm2VyR8KGGK/ICAFB6IusbvsDwhRf+n/jtSHc/nsGgjR9V6/1TyLa1wGU+FtnO1CbHQTHTSzIFJOYJ1jwcGLTccMTcyhp7oW4KFJ/SV4/IScrc55kQj07WNuOn94Lpw8kCm/Qv3W5HLjbWxsyfuNUO1TzWjAJBloKt2FBS+Jz6ShiA12NupBdLWugQcmn28lPMkONNql3U5cTSD9Lq+qEUqPFt++G0aKL687wDAqb+pAU7IKCuK2493AOPQ9UCNpib6T1tkg+RZ9KKJcNn8sJc1vac8o16jklLWLuOiDqwvHUIKPw7vtTON+iCDKkl/Cx9FeSYET5um1mHt6jN0Dz9ftwYjORudNjTdaBmi7kxvvA1d6Gjs0X/Q5Sp3tMEMSHre9HnDEZAPFCWUNVdliGJVPvqEP1Hbh4yPj9LadSY6fu6gPsCX+B3mq7NYLv2od8fj4aoViMNQGFijos/XVMTXGavgUisQIle71hwVx9KFEutLVjw8GORTuxoEbeJS7iPrmQyy/sIj2hQpqYHO7ZGs95nnZS4y8K8Pfqrb58UZ+IlKqbqNgfQm8da+pC9xjLqo8foFkau2qaCeXSyvzXfA9SDrp1bxJ/DU/jSJKXEWdBR2J/9U0UpwXTFZ/+8S76h/71FvO4A8sTeuqQThDKalOiPLN3BbhiYlaNsm964elkCztrC4xMqeDqYIus2JdB3cbS5l4MTag44qJt9GxbF4gKThRKY59lW13+KCUQ1pZMEwHKviKx4pFSqXzxCn/X9Gr2NO+zw+cTiTbxmUyCqH3GlsWg2kRNhOnHmhlrFkIvHTZt1borWvMCmRnwH4usn58STiycAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body del{color:#36ace1}.markdown-body code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#282c34;color:#4ec9b0;padding:.24em .46em;margin:0 4px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:12px;border-radius:10px;padding:15px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#4ec9b0;background:#282c34}.markdown-body a{text-decoration:none;color:#409eff;border-bottom:1px solid #409eff}.markdown-body a:active,.markdown-body a:hover{color:#007bff;border-bottom:1px solid #007bff}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;padding:8px 26px;background-color:rgba(54,172,225,.75);margin:16px 0;border-left:4px solid #409eff;border-radius:5px}.markdown-body blockquote:before{content:"â";top:10px;left:8px;color:#409eff;font-size:20px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:20px;position:absolute;right:8px;bottom:0;color:#409eff;opacity:.7}.markdown-body blockquote&gt;p{color:#fff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>ç”±äºå…¬å¸å¤šä¸ªé¡¹ç›®éƒ½æ˜¯å¾®ä¿¡å…¬ä¼—å·å¼€å‘çš„é¡¹ç›®ï¼Œä»¥å‰å¯¹å…¬ä¼—å·è¿™å—å„¿æ‡µæ‡µæ‡‚æ‡‚çš„ï¼Œäºæ˜¯èŠ±äº†ä¸¤å¤©çš„æ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹å¾®ä¿¡å…¬ä¼—å·å¼€å‘çš„æµç¨‹ç‰¹æ­¤è®°å½•ä¸‹æ¥ã€‚</p>
<h2 data-id="heading-1">è¦å®ç°çš„åŠŸèƒ½</h2>
<ol>
<li><strong>åˆ›å»ºèœå•</strong></li>
<li><strong>æˆæƒç™»å½•</strong></li>
<li><strong>æ¶ˆæ¯æ¥æ”¶ä¸å›å¤</strong></li>
<li><strong>æ¨¡æ¿æ¶ˆæ¯å‘é€</strong></li>
</ol>
<h2 data-id="heading-2">é¡¹ç›®æŠ€æœ¯</h2>
<ol>
<li>åç«¯SpringBootä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fy_project%2FRuoYi-Vue" target="_blank" title="https://gitee.com/y_project/RuoYi-Vue" ref="nofollow noopener noreferrer">ruoyiæ¡†æ¶</a>+<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinarywang%2FWxJava" target="_blank" title="https://github.com/binarywang/WxJava" ref="nofollow noopener noreferrer">wx-java</a>(å¯¹å¾®ä¿¡APIçš„å°è£…æ–¹ä¾¿è°ƒç”¨)</li>
<li>å‰ç«¯Vue3ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvue-zone%2Fvue3-vant-mobile" target="_blank" title="https://github.com/vue-zone/vue3-vant-mobile" ref="nofollow noopener noreferrer">vue3-vant-mobile</a>æ¡†æ¶</li>
</ol>
<h2 data-id="heading-3">å‡†å¤‡å·¥ä½œ</h2>
<h3 data-id="heading-4">å‡†å¤‡åŸŸå</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ngrokè·å–ä¸€ä¸ªåŸŸåã€‚</p>
<ol>
<li>è®¿é—®ç½‘å€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ngrok.cc%2F" target="_blank" title="https://www.ngrok.cc/" ref="nofollow noopener noreferrer">www.ngrok.cc/</a> æ³¨å†Œä¸€ä¸ªè´¦å·</li>
<li>æ³¨å†Œç™»å½•åç‚¹å‡»å®åè®¤è¯å»è®¤è¯ï¼Œéœ€è¦æ”¯ä»˜2å…ƒã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8c64ae16c142288375873d4a4b8423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=WnVqYTb8SLOID8yeC3mf%2F7Y7eEg%3D" alt="image.png" loading="lazy"/></li>
<li>ç‚¹å‡»éš§é“ç®¡ç†çš„å¼€é€šéš§é“æ‹‰åˆ°æœ€åº•éƒ¨æœ‰ä¸ªå…è´¹çš„æœåŠ¡å™¨ç‚¹å‡»è´­ä¹°
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aed5401643c4a96afdea679d541526b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=%2BkZB3rDWez98x8Kzp4tbR63yJxA%3D" alt="image.png" loading="lazy"/></li>
<li>åŸŸåé…ç½®å¦‚å›¾æœ€åç‚¹å‡»ç¡®å®š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/980e05ef857449f1a9f86543575f45a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=DGM4vsu3AL7pKZcuQhrW3L7kN0o%3D" alt="image.png" loading="lazy"/></li>
<li>ä¸‹è½½ngrokçš„å®¢æˆ·ç«¯<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ngrok.cc%2Fdownload.html" target="_blank" title="https://www.ngrok.cc/download.html" ref="nofollow noopener noreferrer">www.ngrok.cc/download.htâ€¦</a></li>
<li>å¯åŠ¨ngrokåŒå‡»Sunny-Ngrok å¯åŠ¨å·¥å…·.batå¹¶å°†åå°çš„éš§é“idç²˜è´´åˆ°æ§åˆ¶å°å¹¶å›è½¦</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/153b4bc436eb4e3ab909e0f24934e34c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=hQG%2BOo4ZqPeypY6Jm4SzoU%2B1OAM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">ç”³è¯·å…¬ä¼—æµ‹è¯•å·</h3>
<ol>
<li>ç”³è¯·åœ°å€<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fdebug%2Fcgi-bin%2Fsandbox%3Ft%3Dsandbox%2Flogin" target="_blank" title="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login" ref="nofollow noopener noreferrer">mp.weixin.qq.com/debug/cgi-bâ€¦</a>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19d0270599745ec90fe5affb621af44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=ibaqw1ynE8R5SfH8bfrqyPzj7ug%3D" alt="image.png" loading="lazy"/></li>
<li>é…ç½®jså®‰å…¨åŸŸå(å°±æ˜¯ä½ ç”³è¯·çš„åŸŸåï¼Œjså®‰å…¨åŸŸåé…ç½®ä¸ºå¿…é¡»å¾®ä¿¡æ‰€æœ‰æ¥å£éƒ½ä¾èµ–è¿™ä¸ªæ¥å£)
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e9eca074864b2f9a1a9ae014469901~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=4%2BrnyPJIAXQGM04TEMZ5y%2FPGwQM%3D" alt="image.png" loading="lazy"/></li>
</ol>
<h3 data-id="heading-6">å‡†å¤‡nginx</h3>
<ol>
<li>å®‰è£…nginxè¿™é‡Œä¸åšä»‹ç»å¯ä»¥è‡ªè¡Œç™¾åº¦å®‰è£…æ­¥éª¤</li>
<li>cmdåˆ‡æ¢åˆ°nginxå®‰è£…çš„binç›®å½•
<ul>
<li>å¯åŠ¨å‘½ä»¤ start nginx.exe</li>
<li>åœæ­¢å‘½ä»¤ nginx.exe -s stop</li>
<li>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å‘½ä»¤ nginx.exe -s reload</li>
</ul>
</li>
<li>è¿™æ—¶å€™é€šè¿‡åˆ†é…ç»™ä½ çš„åŸŸåè®¿é—®åº”è¯¥ä¼šè¿”å›nginxçš„é»˜è®¤é¡µé¢ï¼Œå› ä¸ºnginxé»˜è®¤å°±æ˜¯80ç«¯å£ã€‚<strong>å¦‚æœçœ‹åˆ°å¦‚ä¸‹é¡µé¢è¯´æ˜åŸŸåæ˜ å°„è®¿é—®æˆåŠŸ</strong>ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fffaa0a06da4c2aae5acf0c1492dcd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=Ak4NCvuXOH8js9XvXEZ5EdnWpbM%3D" alt="image.png" loading="lazy"/></li>
</ol>
<h2 data-id="heading-7">åŠŸèƒ½å®ç°</h2>
<h3 data-id="heading-8">åˆ›å»ºèœå•</h3>
<ol>
<li>pom.xmlä¾èµ–wx-java
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d63b876c53cf404c9ac490c5df210ef0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=H2aTTfCL6pJlCUQy7P9br01hfhs%3D" alt="image.png" loading="lazy"/></li>
<li>åœ¨application.ymlé…ç½®æµ‹è¯•å·çš„appidå’Œsecret
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e732001b088458b95cdde9c217c760f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=njb%2FMrP1TvTSkgTVYjRNS6q%2FGXE%3D" alt="image.png" loading="lazy"/></li>
<li>å¯åŠ¨åç«¯è‹¥ä¾é¡¹ç›®(å¯åŠ¨æµç¨‹å¯ä»¥ç™»å½•è‹¥ä¾å®˜ç½‘æŸ¥çœ‹)
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/536b42bc7ad74be680cb0163e3a17bd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=ojxMb3hxiHwcZAWAIQHJQkzffzE%3D" alt="image.png" loading="lazy"/></li>
<li>ç¼–å†™åˆ›å»ºèœå•çš„æ¥å£</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/oauth")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OauthController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpService wxMpService;

    <span class="hljs-meta">@GetMapping("/menu")</span>
    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">createMenu</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">menuJsonStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"{\n"</span> +
                <span class="hljs-string">"  "</span>button<span class="hljs-string">": [\n"</span> +
                <span class="hljs-string">"    {\n"</span> +
                <span class="hljs-string">"      "</span>type<span class="hljs-string">": "</span>view<span class="hljs-string">",\n"</span> +
                <span class="hljs-string">"      "</span>name<span class="hljs-string">": "</span>çŸ¥è¯†å¹²è´§<span class="hljs-string">",\n"</span> +
                <span class="hljs-string">"      "</span>url<span class="hljs-string">": "</span>http:<span class="hljs-comment">//gzh.free.idcfengye.com"\n" +</span>
                <span class="hljs-string">"    }\n"</span> +
                <span class="hljs-string">"  ]\n"</span> +
                <span class="hljs-string">"}"</span>;
        <span class="hljs-keyword">try</span> {
            wxMpService.getMenuService().menuCreate(menuJsonStr);
            <span class="hljs-keyword">return</span> R.ok(<span class="hljs-string">"èœå•åˆ›å»ºæˆåŠŸ"</span>);
        } <span class="hljs-keyword">catch</span> (WxErrorException e) {
            logger.error(<span class="hljs-string">"èœå•åˆ›å»ºå¤±è´¥:{}"</span>,e.getMessage());
        }
        <span class="hljs-keyword">return</span> R.ok(<span class="hljs-string">"èœå•åˆ›å»ºå¤±è´¥"</span>);

    }

}
</code></pre>
<ol start="5">
<li>æ”¾è¡Œæ¥å£
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a7821c7f7654a55a279ecb8da23af7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=rUYlwVPEWPPYo1aoIoQQNZzu1CU%3D" alt="image.png" loading="lazy"/></li>
<li>ä¿®æ”¹nginxé…ç½®å¹¶é‡å¯</li>
</ol>
<p>ç”±äºåŸŸåæ˜ å°„åˆ°äº†nginxçš„80ç«¯å£ï¼Œæˆ‘ä»¬åç«¯å¯åŠ¨çš„ç«¯å£æ˜¯8080æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©ngixnä»£ç†å¹¶è½¬å‘åˆ°æˆ‘ä»¬çš„åç«¯é¡¹ç›®ä¸­
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43661a4b1cb942eb82081c7f7d4e2696~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=YPFVioLX3GyklxffF0FxXctxRdg%3D" alt="image.png" loading="lazy"/></p>
<ol start="7">
<li>æµ‹è¯•éªŒè¯</li>
</ol>
<p>é€šè¿‡è®¿é—®  åŸŸå/backend/oauth/menu å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æµ‹è¯•å·çš„èœå•åˆ›å»ºæˆåŠŸäº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfc61f1221e8447eb3b58969de8e9bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=mUCGkbg2vtgfg2BSXRYJ8nTpgZg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">æˆæƒç™»å½•å¹¶è·å–ç”¨æˆ·ä¿¡æ¯</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/531a49caefb6408a869e67f5421c7282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=HG03la9CsG84GF2uM0ZGFjc7wrU%3D" alt="æœªå‘½åç»˜å›¾.png" loading="lazy"/></p>
<ol>
<li>å‰ç«¯ä»£ç æ”¹é€ </li>
</ol>
<p>è¿™é‡Œæˆ‘ç®€å•æ”¹äº†ä¸€ä¸‹å°±åˆ¤æ–­æœ¬åœ°æ˜¯å¦å­˜å‚¨openIdæœ‰çš„è¯å¯ä»¥æ”¾è¡Œï¼Œæ²¡æœ‰çš„è¯è°ƒç”¨æ¥å£è·å–openIdä¹Ÿå°±æ˜¯è·å–æˆæƒã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dab06500002473d967262deacc86980~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=jQaR03rEq3c%2FphWJEZyhcEy2eXQ%3D" alt="image.png" loading="lazy"/>
2. æ‰“åŒ…éƒ¨ç½²åˆ°nginxä¸­</p>
<ul>
<li>å°†æ‰“åŒ…å¥½çš„diståŒ…é‡å‘½åä¸ºgzhå¹¶éƒ¨ç½²åˆ°nginxä¸­html</li>
<li>ä¿®æ”¹nginx.confé…ç½®å¹¶é‡å¯
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4625a3ee23fa4c3295d5bd7a2b86843d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=%2FHYQ%2F3qzVUyUPWhYgxVZZ9gbpVo%3D" alt="image.png" loading="lazy"/></li>
</ul>
<ol start="3">
<li>æµ‹è¯•å·é…ç½®ä¸Šç”¨æˆ·æˆæƒçš„åŸŸåä¸jså®‰å…¨åŸŸååœ°å€ä¿æŒä¸€è‡´</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29d0a8ec0bb5438f831a70f8b7989dee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=rGEXTQqirDHFRLRUFy48c9KVb9s%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ffe721585f49ad93bd61b76cf11343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=ckR38FdhF9bxfDWykgwGZCwps9o%3D" alt="image.png" loading="lazy"/>
4. åç«¯æ¥å£</p>
<ul>
<li><strong>/index</strong>æ¥å£ä¸ºæ„å»ºæˆæƒé“¾æ¥ï¼šå‚æ•°ä¸€ä¸ºå¾®ä¿¡æˆæƒæˆåŠŸåå›è°ƒçš„æˆ‘ä»¬çš„åœ°å€ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„resultæ¥å£åœ¨è¿™ä¸ªæ¥å£ä¸­å¯ä»¥é€šè¿‡requestè·å–å¾®ä¿¡çš„codeï¼Œé€šè¿‡codeå¯ä»¥è·å–accesstokenï¼Œé€šè¿‡tokenå¯ä»¥è·å–ç”¨æˆ·ä¿¡æ¯å’Œopenidã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºæˆæƒçš„æ–¹å¼æ€»å…±ä¸¤ç§ä¸€ç§USERINFOè¿™ç§å¯ä»¥æ‹¿åˆ°ç”¨æˆ·çš„å¤´åƒã€æ˜µç§°ã€openIdä½†æ˜¯å¯ä»¥å›éœ€è¦ç”¨æˆ·ç‚¹å‡»æˆæƒçš„ç¡®è®¤æŒ‰é’®ï¼Œç¬¬äºŒç§æ˜¯BASEåªå¯ä»¥æ‹¿åˆ°openIdä¸éœ€è¦ç”¨æˆ·åŒæ„ä¿—ç§°é™é»˜æˆæƒã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯urlæ˜¯ä¸Šé¢å‰ç«¯è°ƒç”¨æˆ‘ä»¬æ¥å£ä¼ è¿‡æ¥çš„ï¼Œæ„æ€æ˜¯æˆæƒæˆåŠŸåè¦è·³è½¬åˆ°å‰ç«¯çš„å“ªä¸ªé¡µé¢ã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">RestController</span>
@<span class="hljs-title class_">RequestMapping</span>(<span class="hljs-string">"/oauth"</span>)
public <span class="hljs-keyword">class</span> <span class="hljs-title class_">OauthController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseController</span> {

    @<span class="hljs-title class_">Autowired</span>
    private <span class="hljs-title class_">WxMpService</span> wxMpService;

    @<span class="hljs-title class_">GetMapping</span>(<span class="hljs-string">"/index"</span>)
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">auth</span>(<span class="hljs-params">@RequestParam <span class="hljs-built_in">String</span> url,HttpServletResponse response</span>)  {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">String</span> authUrl = wxMpService.<span class="hljs-title function_">getOAuth2Service</span>().<span class="hljs-title function_">buildAuthorizationUrl</span>(
                    <span class="hljs-string">"http://xxxx.com/backend/oauth/result"</span>,
                    <span class="hljs-title class_">WxConsts</span>.<span class="hljs-property">OAuth2Scope</span>.<span class="hljs-property">SNSAPI_USERINFO</span>, url);
            logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"æ„å»ºçš„æˆæƒé“¾æ¥:"</span> + authUrl);
            response.<span class="hljs-title function_">sendRedirect</span>(authUrl);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IOException</span> e) {
            logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ„å»ºæˆæƒurlå¼‚å¸¸:{}"</span>,e.<span class="hljs-title function_">getMessage</span>());
        }
    }
    @<span class="hljs-title class_">GetMapping</span>(<span class="hljs-string">"/result"</span>)
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">authResult</span>(<span class="hljs-title class_">HttpServletRequest</span> request, <span class="hljs-title class_">HttpServletResponse</span> response) throws <span class="hljs-title class_">WxErrorException</span>, <span class="hljs-title class_">IOException</span> {
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>[]&gt; parameterMap = request.<span class="hljs-title function_">getParameterMap</span>();
        parameterMap.<span class="hljs-title function_">forEach</span>((k, v) -&gt; {
            logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"å¾®ä¿¡æˆæƒå›è°ƒçš„è¿”å›çš„å‚æ•°:{}----{}"</span>,k,v);
        });
        <span class="hljs-comment">// æ ¹æ®codeæ¢å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†openId</span>
        <span class="hljs-title class_">String</span> code = request.<span class="hljs-title function_">getParameter</span>(<span class="hljs-string">"code"</span>);
        <span class="hljs-comment">// ä¼ é€’è¿‡æ¥è¦é‡å®šå‘åˆ°çš„å‰ç«¯é¡µé¢</span>
        <span class="hljs-title class_">String</span> state = request.<span class="hljs-title function_">getParameter</span>(<span class="hljs-string">"state"</span>);
        <span class="hljs-comment">// è·å–token</span>
        <span class="hljs-title class_">WxOAuth2AccessToken</span> accessToken = wxMpService.<span class="hljs-title function_">getOAuth2Service</span>().<span class="hljs-title function_">getAccessToken</span>(code);
        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"token:{}"</span>,accessToken);
        <span class="hljs-comment">// è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯</span>
        <span class="hljs-title class_">WxOAuth2UserInfo</span> userInfo = wxMpService.<span class="hljs-title function_">getOAuth2Service</span>().<span class="hljs-title function_">getUserInfo</span>(accessToken,<span class="hljs-literal">null</span>);
        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"ç”¨æˆ·ä¿¡æ¯:{}"</span>,userInfo);

        response.<span class="hljs-title function_">sendRedirect</span>(<span class="hljs-string">"http://gzh.free.idcfengye.com?openId="</span>+userInfo.<span class="hljs-title function_">getOpenid</span>());
    }
 }
</code></pre>
<ol start="5">
<li>æµ‹è¯•</li>
</ol>
<p>æˆ‘ä»¬é€šè¿‡ç‚¹å‡»å…¬ä¼—å·çš„çš„èœå•å¯ä»¥çœ‹åˆ°æˆæƒä¿¡æ¯å·²ç»æ‹¿åˆ°äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcca59f713e04d6fb33578dbc30ed8af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=v%2BAngANjeG3agcQmmrnIz39wml4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eff68aa0ad3645ed8e1fa8b4f4ef912b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=bob%2Bq6gZyV%2BnzdAjjXLZC%2BFIpaU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">æ¶ˆæ¯æ¥æ”¶å’Œè‡ªåŠ¨å›å¤</h3>
<ol>
<li>ç¼–å†™æ¶ˆæ¯éªŒè¯çš„æ¥å£</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.qmc.web.controller.message;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/message")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpService wxMpService;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpMessageRouter wxMpMessageRouter;

    <span class="hljs-comment">/**
     * æ¥é€šå¾®ä¿¡æ¶ˆæ¯ï¼Œå¾®ä¿¡ä¼šå‘é€éªŒè¯åˆ°è¿™ä¸ªæ¥å£ï¼Œæ¥å£è¦å›å¤éªŒè¯é€šè¿‡çš„å›æ‰§ä¿¡æ¯ã€‚ä¸ç„¶æµ‹è¯•å·çš„æ¶ˆæ¯åŸŸååœ°å€é…ç½®ä¼šæç¤ºé…ç½®å¤±è´¥
     * */</span>
    <span class="hljs-meta">@GetMapping("/index")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">messageYz</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException {
        logger.info(<span class="hljs-string">"è¿›æ¥äº†"</span>);
        response.setContentType(<span class="hljs-string">"text/html;charset=utf-8"</span>);
        response.setStatus(HttpServletResponse.SC_OK);

        <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"signature"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">nonce</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"nonce"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"timestamp"</span>);
        logger.info(<span class="hljs-string">"å‚æ•°:{},{},{}"</span>,signature,nonce,timestamp);
        <span class="hljs-keyword">if</span> (!wxMpService.checkSignature(timestamp, nonce, signature)) {
            <span class="hljs-comment">// æ¶ˆæ¯ç­¾åä¸æ­£ç¡®ï¼Œè¯´æ˜ä¸æ˜¯å…¬ä¼—å¹³å°å‘è¿‡æ¥çš„æ¶ˆæ¯</span>
            response.getWriter().println(<span class="hljs-string">"éæ³•è¯·æ±‚"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">echostr</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"echostr"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(echostr)) {
            <span class="hljs-comment">// è¯´æ˜æ˜¯ä¸€ä¸ªä»…ä»…ç”¨æ¥éªŒè¯çš„è¯·æ±‚ï¼Œå›æ˜¾echostr</span>
            response.getWriter().println(echostr);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">encryptType</span> <span class="hljs-operator">=</span> StringUtils.isBlank(request.getParameter(<span class="hljs-string">"encrypt_type"</span>)) ?
                <span class="hljs-string">"raw"</span> :
                request.getParameter(<span class="hljs-string">"encrypt_type"</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-string">"raw"</span>.equals(encryptType)) {
            <span class="hljs-comment">// æ˜æ–‡ä¼ è¾“çš„æ¶ˆæ¯</span>
            <span class="hljs-type">WxMpXmlMessage</span> <span class="hljs-variable">inMessage</span> <span class="hljs-operator">=</span> WxMpXmlMessage.fromXml(request.getInputStream());
            wxMpMessageRouter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpMessageRouter</span>(wxMpService);
            <span class="hljs-type">WxMpXmlOutMessage</span> <span class="hljs-variable">outMessage</span> <span class="hljs-operator">=</span> wxMpMessageRouter.route(inMessage);
            <span class="hljs-keyword">if</span> (outMessage == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">//ä¸ºnullï¼Œè¯´æ˜è·¯ç”±é…ç½®æœ‰é—®é¢˜ï¼Œéœ€è¦æ³¨æ„</span>
                response.getWriter().write(<span class="hljs-string">""</span>);
            }
            response.getWriter().write(outMessage.toXml());
        }

    }
</code></pre>
<ol start="2">
<li>æµ‹è¯•å·é…ç½®æ¶ˆæ¯åŸŸåå’Œtoken(è¿™ä¸ªtokenéšä¾¿å†™)ï¼Œ<strong>ç‚¹å‡»ä¿å­˜ä¼šå‘é€è¯·æ±‚åˆ°ä½ é…ç½®çš„è¿™ä¸ªurlä¸­åªæœ‰æ­£ç¡®å“åº”æ‰èƒ½é…ç½®æˆåŠŸ</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10731b6c22664d13b017c071aec09cee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=i14LB8XiVHjMZkMFUK27RaJ3cqg%3D" alt="image.png" loading="lazy"/></li>
<li>application.ymlä¸­é…ç½®token
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e121c1010cb42d7a04c06de5da331e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=ASe3ZIdm80acHmSkVwQbq06s5H8%3D" alt="image.png" loading="lazy"/></li>
<li>ç¼–å†™å›å¤æ¶ˆæ¯</li>
</ol>
<ul>
<li>ç¼–å†™æ¥å£ï¼Œå¾®ä¿¡æ‰€æœ‰ç›‘å¬åˆ°çš„ç”¨æˆ·äº‹ä»¶éƒ½ä¼šå›è°ƒåˆ°è¿™ä¸ªæ¥å£ä¸­ï¼Œæ³¨æ„ï¼š<strong>æµ‹è¯•å·é…ç½®çš„æ¶ˆæ¯urlã€éªŒè¯æ¶ˆæ¯çš„æ¥å£ä»¥åŠæ¥æ”¶æ¶ˆæ¯çš„æ¥å£åœ°å€è¦ä¸€è‡´ï¼ŒéªŒè¯çš„æ˜¯getè¯·æ±‚ï¼Œæ¥æ”¶æ¶ˆæ¯çš„æ˜¯postè¯·æ±‚ã€‚</strong></li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.qmc.web.controller.message;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/message")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpService wxMpService;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpMessageRouter wxMpMessageRouter;

    <span class="hljs-comment">/**
     * æ¥é€šå¾®ä¿¡æ¶ˆæ¯ï¼Œå¾®ä¿¡ä¼šå‘é€éªŒè¯åˆ°è¿™ä¸ªæ¥å£ï¼Œæ¥å£è¦å›å¤éªŒè¯é€šè¿‡çš„å›æ‰§ä¿¡æ¯ã€‚ä¸ç„¶æµ‹è¯•å·çš„æ¶ˆæ¯åŸŸååœ°å€é…ç½®ä¼šæç¤ºé…ç½®å¤±è´¥
     * */</span>
    <span class="hljs-meta">@GetMapping("/index")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">messageYz</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException {
        logger.info(<span class="hljs-string">"è¿›æ¥äº†"</span>);
        response.setContentType(<span class="hljs-string">"text/html;charset=utf-8"</span>);
        response.setStatus(HttpServletResponse.SC_OK);

        <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"signature"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">nonce</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"nonce"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"timestamp"</span>);
        logger.info(<span class="hljs-string">"å‚æ•°:{},{},{}"</span>,signature,nonce,timestamp);
        <span class="hljs-keyword">if</span> (!wxMpService.checkSignature(timestamp, nonce, signature)) {
            <span class="hljs-comment">// æ¶ˆæ¯ç­¾åä¸æ­£ç¡®ï¼Œè¯´æ˜ä¸æ˜¯å…¬ä¼—å¹³å°å‘è¿‡æ¥çš„æ¶ˆæ¯</span>
            response.getWriter().println(<span class="hljs-string">"éæ³•è¯·æ±‚"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">echostr</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"echostr"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(echostr)) {
            <span class="hljs-comment">// è¯´æ˜æ˜¯ä¸€ä¸ªä»…ä»…ç”¨æ¥éªŒè¯çš„è¯·æ±‚ï¼Œå›æ˜¾echostr</span>
            response.getWriter().println(echostr);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">encryptType</span> <span class="hljs-operator">=</span> StringUtils.isBlank(request.getParameter(<span class="hljs-string">"encrypt_type"</span>)) ?
                <span class="hljs-string">"raw"</span> :
                request.getParameter(<span class="hljs-string">"encrypt_type"</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-string">"raw"</span>.equals(encryptType)) {
            <span class="hljs-comment">// æ˜æ–‡ä¼ è¾“çš„æ¶ˆæ¯</span>
            <span class="hljs-type">WxMpXmlMessage</span> <span class="hljs-variable">inMessage</span> <span class="hljs-operator">=</span> WxMpXmlMessage.fromXml(request.getInputStream());
            wxMpMessageRouter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpMessageRouter</span>(wxMpService);
            <span class="hljs-type">WxMpXmlOutMessage</span> <span class="hljs-variable">outMessage</span> <span class="hljs-operator">=</span> wxMpMessageRouter.route(inMessage);
            <span class="hljs-keyword">if</span> (outMessage == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">//ä¸ºnullï¼Œè¯´æ˜è·¯ç”±é…ç½®æœ‰é—®é¢˜ï¼Œéœ€è¦æ³¨æ„</span>
                response.getWriter().write(<span class="hljs-string">""</span>);
            }
            response.getWriter().write(outMessage.toXml());
        }

    }

    <span class="hljs-comment">/**
     * æ¥æ”¶å¾®ä¿¡äº‹ä»¶å¦‚ï¼šç”¨æˆ·å…³æ³¨ã€ç”¨æˆ·å‘é€æ¶ˆæ¯ç»™å…¬ä¼—å·å¹¶å›å¤æ¶ˆæ¯ç»™ç”¨æˆ·
     * */</span>
    <span class="hljs-meta">@PostMapping("/index")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">receiveMsg</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"signature"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">nonce</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"nonce"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"timestamp"</span>);
        logger.info(<span class="hljs-string">"å‚æ•°æ ¡éªŒ:{},{},{}"</span>,signature,nonce,timestamp);
        <span class="hljs-keyword">if</span> (!wxMpService.checkSignature(timestamp, nonce, signature)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"éæ³•è¯·æ±‚ï¼Œå¯èƒ½ä¸ºä¼ªé€ çš„è¯·æ±‚ï¼"</span>);
        }
        <span class="hljs-type">ServletInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> request.getInputStream();
        <span class="hljs-type">WxMpXmlMessage</span> <span class="hljs-variable">wxMpXmlMessage</span> <span class="hljs-operator">=</span> WxMpXmlMessage.fromXml(inputStream);
        logger.info(wxMpXmlMessage.toString());
        <span class="hljs-type">WxMpXmlOutMessage</span> <span class="hljs-variable">outMessage</span>  <span class="hljs-operator">=</span> wxMpMessageRouter.route(wxMpXmlMessage);
        <span class="hljs-keyword">if</span> (outMessage == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        logger.info(<span class="hljs-string">"ç»„è£…å›å¤çš„æ¶ˆæ¯:{}"</span>,outMessage.toXml());
        <span class="hljs-keyword">return</span> outMessage.toXml();
    }
}
</code></pre>
<ul>
<li>ç¼–å†™è·¯ç”±è¿™é‡Œçš„æ„æ€æ˜¯å°†å¾®ä¿¡ä¸‹å‘çš„æ‰€æœ‰æ¶ˆæ¯ä¼ è¾“åˆ°handlerï¼Œå…·ä½“æ›´å¤šé…ç½®è¯¦è§wx-java</li>
</ul>
<pre><code class="hljs language-js" lang="js">package com.<span class="hljs-property">qmc</span>.<span class="hljs-property">web</span>.<span class="hljs-property">config</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">qmc</span>.<span class="hljs-property">web</span>.<span class="hljs-property">handler</span>.<span class="hljs-property">MessageHandler</span>;
<span class="hljs-keyword">import</span> me.<span class="hljs-property">chanjar</span>.<span class="hljs-property">weixin</span>.<span class="hljs-property">mp</span>.<span class="hljs-property">api</span>.<span class="hljs-property">WxMpMessageRouter</span>;
<span class="hljs-keyword">import</span> me.<span class="hljs-property">chanjar</span>.<span class="hljs-property">weixin</span>.<span class="hljs-property">mp</span>.<span class="hljs-property">api</span>.<span class="hljs-property">WxMpService</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Bean</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;


@<span class="hljs-title class_">Configuration</span>
public <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxMpConfiguration</span> {

    @<span class="hljs-title class_">Autowired</span>
    private final <span class="hljs-title class_">MessageHandler</span> messageHandler;

    public <span class="hljs-title class_">WxMpConfiguration</span>(<span class="hljs-title class_">MessageHandler</span> messageHandler) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageHandler</span> = messageHandler;
    }

    @<span class="hljs-title class_">Bean</span>
    public <span class="hljs-title class_">WxMpMessageRouter</span> <span class="hljs-title function_">messageRouter</span>(<span class="hljs-params">WxMpService wxMpService</span>) {
        <span class="hljs-title class_">WxMpMessageRouter</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpMessageRouter</span>(wxMpService);
        <span class="hljs-comment">// æ‰€æœ‰æ¶ˆæ¯éƒ½äº¤ç»™åŒä¸€ä¸ª handler å¤„ç†</span>
        router.<span class="hljs-title function_">rule</span>().<span class="hljs-title function_">async</span>(<span class="hljs-literal">false</span>).<span class="hljs-title function_">handler</span>(messageHandler).<span class="hljs-title function_">end</span>();
        
        <span class="hljs-keyword">return</span> router;
    }
}
</code></pre>
<ul>
<li>æ¶ˆæ¯å…·ä½“å¤„ç†çš„handlerï¼Œè¿™é‡Œæœ‰å„ç§æ¶ˆæ¯å…³æ³¨ã€æ–‡æœ¬ã€å›¾ç‰‡ç­‰è¿™é‡Œæˆ‘ä»¬åªæµ‹è¯•æ–‡æœ¬æ¶ˆæ¯ï¼Œç”¨æˆ·è¾“å…¥javaå…³é”®å­—æˆ‘ä»¬å›å¤ä¸€ä¸ªä½ å¥½å‘€ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.qmc.web.handler;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WxMpMessageHandler</span> {
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(<span class="hljs-built_in">this</span>.getClass());
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> WxMpXmlOutMessage <span class="hljs-title function_">handle</span><span class="hljs-params">(WxMpXmlMessage wxMessage,
                                    Map&lt;String, Object&gt; context,
                                    WxMpService wxMpService,
                                    WxSessionManager sessionManager)</span> {

        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> wxMessage.getContent(); <span class="hljs-comment">// ç”¨æˆ·å‘é€çš„å†…å®¹</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> wxMessage.getEvent();     <span class="hljs-comment">// äº‹ä»¶ç±»å‹ï¼ˆå¦‚ subscribeï¼‰</span>
        logger.info(<span class="hljs-string">"æ¥æ”¶åˆ°æ¶ˆæ¯:{},{}"</span>,content,event);
        <span class="hljs-comment">// 1. å¤„ç†å…³æ³¨äº‹ä»¶</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"subscribe"</span>.equals(event)) {
            <span class="hljs-keyword">return</span> WxMpXmlOutMessage.TEXT()
                    .content(<span class="hljs-string">"æ¬¢è¿å…³æ³¨ï¼ğŸ˜Š"</span>)
                    .fromUser(wxMessage.getToUser())
                    .toUser(wxMessage.getFromUser())
                    .build();
        }

        <span class="hljs-comment">// 2. å¤„ç†æ–‡æœ¬æ¶ˆæ¯</span>
        <span class="hljs-keyword">if</span> (wxMessage.getMsgType().equals(<span class="hljs-string">"text"</span>) &amp;&amp; content != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"java"</span>.equalsIgnoreCase(content.trim())) {
                <span class="hljs-keyword">return</span> WxMpXmlOutMessage.TEXT()
                        .content(<span class="hljs-string">"ä½ å¥½å‘€ï¼"</span>)
                        .fromUser(wxMessage.getToUser())
                        .toUser(wxMessage.getFromUser())
                        .build();
            }
        }

        <span class="hljs-comment">// 3. é»˜è®¤å›å¤ï¼ˆå¯é€‰ï¼‰</span>
        <span class="hljs-keyword">return</span> WxMpXmlOutMessage.TEXT()
                .content(<span class="hljs-string">"æ„Ÿè°¢æ‚¨çš„æ¶ˆæ¯ï¼Œä½†æˆ‘ä¸æ‡‚å‘¢~"</span>)
                .fromUser(wxMessage.getToUser())
                .toUser(wxMessage.getFromUser())
                .build();
    }
}
</code></pre>
<ol start="5">
<li>æµ‹è¯•ï¼Œå‘é€javaæˆ‘ä»¬æ”¶åˆ°äº†ä½ å¥½å‘€ï¼çš„å›å¤ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c25308797b2b40fa9e83cce8040ff0e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=qeKzGkzwj76by22LZS6LRPoCiZ0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">æ¨¡æ¿æ¶ˆæ¯</h3>
<ol>
<li>æµ‹è¯•å·é…ç½®æ¨¡æ¿æ¶ˆæ¯
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efae20dcbce04320820a4f5e04042c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=%2Bxawh5urCIyjj2%2BJJCmlO4yS%2BVs%3D" alt="image.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ae2c1212fb64c81855d49d8faacd7cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=F%2FI28q%2FC2zRoZu%2FNrM8kIOfefL0%3D" alt="image.png" loading="lazy"/></li>
<li>ç¼–å†™å‘é€æ¨¡æ¿çš„æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥é€šè¿‡æ¥å£å‘é€ï¼Œä¸»è¦éœ€è¦æ¨¡æ¿idå’Œæ¥æ”¶äººçš„openIdã€‚è¿™ä¸¤ä¸ªéƒ½æœ‰çš„ä¸€ä¸ªæ˜¯æµ‹è¯•å·åˆšé…ç½®æ¨¡æ¿æ¶ˆæ¯åç”Ÿæˆçš„idï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ä¹‹å‰æˆæƒåæ‹¿åˆ°çš„openIdã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.qmc.web.controller.message;
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/message")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpService wxMpService;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> WxMpMessageRouter wxMpMessageRouter;

    <span class="hljs-comment">/**
     * å‘é€æ¨¡æ¿æ¶ˆæ¯
     * */</span>
    <span class="hljs-meta">@GetMapping("/template")</span>
    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">sendTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">WxMpTemplateMessage</span> <span class="hljs-variable">wxMpTemplateMessage</span> <span class="hljs-operator">=</span> WxMpTemplateMessage.builder()
                .toUser(<span class="hljs-string">"oqK7e7bvZZAYx7JAztSuILhLTuFA"</span>)
                .templateId(<span class="hljs-string">"PfQbB7sS2pL6gAL8MNlaMkLxqEhw-Zj12jKzqRCZrLY"</span>)
                .url(<span class="hljs-string">"https://www.baidu.com"</span>)
                .build();
        wxMpTemplateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">"first"</span>,
                <span class="hljs-string">"æ‚¨å¥½ï¼Œæ‚¨æè¯·çš„ææ–™ä¸é½å…¨æˆ–ä¸å‡†ç¡®ï¼Œéœ€è¡¥å……å®Œå–„ï¼Œè¯·åˆ°â€œæˆ‘çš„ä¸­å¿ƒâ€é‡æ–°æäº¤ç›¸å…³ææ–™ã€‚"</span>,<span class="hljs-string">"#FF00FF"</span>));
        wxMpTemplateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">"keyword1"</span>,
                <span class="hljs-string">"2014å¹´05æœˆ02æ—¥"</span>,<span class="hljs-string">"#FF00FF"</span>));
        wxMpTemplateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">"keyword2"</span>,
                <span class="hljs-string">"å§“åå˜æ›´"</span>,<span class="hljs-string">"#FF00FF"</span>));
        wxMpTemplateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">"keyword3"</span>,
                <span class="hljs-string">"å¾…å—ç†"</span>,<span class="hljs-string">"#FF00FF"</span>));
        wxMpTemplateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">"remark"</span>,
                <span class="hljs-string">"æˆ‘ä»¬å°†åœ¨ä¸‰ä¸ªå·¥ä½œæ—¥å†…ç»™ä½ åé¦ˆï¼Œåé¦ˆçš„å½¢å¼å°†é€šè¿‡å¾®ä¿¡å…¬ä¼—å·å‘é€æ¶ˆæ¯ç»™æ‚¨ï¼Œè¯·æ³¨æ„æŸ¥æ”¶ï¼"</span>,<span class="hljs-string">"#FF00FF"</span>));
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">responseContent</span> <span class="hljs-operator">=</span> wxMpService.post(MESSAGE_TEMPLATE_SEND, wxMpTemplateMessage.toJson());
            <span class="hljs-keyword">final</span> <span class="hljs-type">JsonObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> GsonParser.parse(responseContent);
            <span class="hljs-keyword">return</span> R.ok(jsonObject.toString());
        } <span class="hljs-keyword">catch</span> (WxErrorException e) {
            <span class="hljs-keyword">return</span> R.fail(e.getError().getErrorCode(), e.getError().getErrorMsg());
        }
    }
}
</code></pre>
<ol start="3">
<li>æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æ¨¡æ¿æ¶ˆæ¯æ­£å¸¸å‘é€äº†ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c25308797b2b40fa9e83cce8040ff0e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGF1Z2hpbmdEYW5nWmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766556460&amp;x-signature=qeKzGkzwj76by22LZS6LRPoCiZ0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">ç»“è¯­</h2>
<p>ä»¥ä¸Šå°±æ˜¯å‰åç«¯åˆ†ç¦»å¾®ä¿¡å…¬ä¼—å·é¡¹ç›®å¼€å‘çš„æµç¨‹å’ŒåŠŸèƒ½å®ç°ï¼Œå…¶ä¸­è·å–çš„ç”¨æˆ·ä¿¡æ¯å¯ä»¥å­˜å…¥æ•°æ®åº“ä¸­åšæ›´å¤šçš„äº‹æƒ…ã€‚openIdæ˜¯å¯¹æ­¤å…¬ä¼—å·çš„å”¯ä¸€æ ‡è¯†ï¼ŒåæœŸå®ç°çš„è¯¸å¤šåŠŸèƒ½éƒ½éœ€è¦ç”¨åˆ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GROUP BYè¿›é˜¶ç”¨æ³•]]></title>    <link>https://juejin.cn/post/7584432435590512694</link>    <guid>https://juejin.cn/post/7584432435590512694</guid>    <pubDate>2025-12-17T06:15:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584432435590512694" data-draft-id="7584357116434038825" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GROUP BYè¿›é˜¶ç”¨æ³•"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-12-17T06:15:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hyinglin"/> <meta itemprop="url" content="https://juejin.cn/user/2362231708723822"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GROUP BYè¿›é˜¶ç”¨æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2362231708723822/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hyinglin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:15:09.000Z" title="Wed Dec 17 2025 06:15:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é—®é¢˜é‡æ–°:<br/>
sqlè¯­å¥ä¸­ä½¿ç”¨äº†GROUP BY wf_cur.REQUESTID, wf_cur.NODEID,ä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºç”¨ä¸¤è¡Œç›¸åŒREQUESTIDçš„è®°å½•å‘¢ï¼ŒGROUP BYä¸å°±æ˜¯æ‹¿æŸä¸ªå­—æ®µæ¥åˆ†ç»„å—ï¼Ÿ</p>
</blockquote>
<p><strong>GROUP BY æ˜¯æŒ‰ä½ æŒ‡å®šçš„å­—æ®µç»„åˆè¿›è¡Œåˆ†ç»„çš„</strong>ï¼Œä¸æ˜¯æŒ‰å•ä¸ªå­—æ®µã€‚</p>
<h3 data-id="heading-0">ä½ çš„ä¾‹å­ï¼š</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> wf_cur.REQUESTID, wf_cur.NODEID
</code></pre>
<p>è¿™æ„å‘³ç€ï¼š<strong>åªæœ‰ REQUESTID å’Œ NODEID éƒ½ç›¸åŒçš„è®°å½•æ‰ä¼šè¢«åˆ†åˆ°åŒä¸€ç»„</strong>ã€‚</p>
<h2 data-id="heading-1">å®é™…ç¤ºä¾‹</h2>
<p>å‡è®¾åŸå§‹æ•°æ®ï¼š</p>
<p>text</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">REQUESTID</span>  <span class="hljs-string">NODEID</span>  <span class="hljs-string">USERID</span>  <span class="hljs-string">LASTNAME</span>
<span class="hljs-number">1001       </span><span class="hljs-number">10</span>      <span class="hljs-number">1</span>       <span class="hljs-string">å¼ ä¸‰</span>
<span class="hljs-number">1001       </span><span class="hljs-number">10</span>      <span class="hljs-number">2</span>       <span class="hljs-string">æå››</span>    <span class="hljs-string">&lt;-</span> <span class="hljs-string">åŒä¸€ç»„ï¼ˆREQUESTIDå’ŒNODEIDéƒ½ç›¸åŒï¼‰</span>
<span class="hljs-number">1001       </span><span class="hljs-number">20</span>      <span class="hljs-number">3</span>       <span class="hljs-string">ç‹äº”</span>    <span class="hljs-string">&lt;-</span> <span class="hljs-string">ä¸åŒç»„ï¼ˆNODEIDä¸åŒï¼‰</span>
<span class="hljs-number">1001       </span><span class="hljs-number">20</span>      <span class="hljs-number">4</span>       <span class="hljs-string">èµµå…­</span>    <span class="hljs-string">&lt;-</span> <span class="hljs-string">åŒä¸€ç»„</span>
<span class="hljs-number">1002       </span><span class="hljs-number">10</span>      <span class="hljs-number">5</span>       <span class="hljs-string">é’±ä¸ƒ</span>    <span class="hljs-string">&lt;-</span> <span class="hljs-string">ä¸åŒç»„ï¼ˆREQUESTIDä¸åŒï¼‰</span>
</code></pre>
<h3 data-id="heading-2">åˆ†ç»„ç»“æœï¼š</h3>
<ol>
<li>
<p><strong>ç»„1</strong>ï¼šREQUESTID=1001, NODEID=10</p>
<ul>
<li>åŒ…å«ï¼šå¼ ä¸‰ã€æå››</li>
<li>GROUP_CONCATç»“æœï¼š"å¼ ä¸‰, æå››"</li>
</ul>
</li>
<li>
<p><strong>ç»„2</strong>ï¼šREQUESTID=1001, NODEID=20</p>
<ul>
<li>åŒ…å«ï¼šç‹äº”ã€èµµå…­</li>
<li>GROUP_CONCATç»“æœï¼š"ç‹äº”, èµµå…­"</li>
</ul>
</li>
<li>
<p><strong>ç»„3</strong>ï¼šREQUESTID=1002, NODEID=10</p>
<ul>
<li>åŒ…å«ï¼šé’±ä¸ƒ</li>
<li>GROUP_CONCATç»“æœï¼š"é’±ä¸ƒ"</li>
</ul>
</li>
</ol>
<h2 data-id="heading-3">ä¸ºä»€ä¹ˆä¼šå‡ºç°å¤šè¡Œç›¸åŒREQUESTIDï¼Ÿ</h2>
<p><strong>å› ä¸ºåŒä¸€ä¸ªREQUESTIDå¯èƒ½æœ‰ä¸åŒçš„NODEIDï¼</strong></p>
<p>åœ¨ä½ çš„å·¥ä½œæµç³»ç»Ÿä¸­ï¼š</p>
<ul>
<li>ä¸€ä¸ªæµç¨‹ï¼ˆREQUESTIDï¼‰ä¼šç»è¿‡å¤šä¸ªèŠ‚ç‚¹ï¼ˆNODEIDï¼‰</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½æœ‰ä¸åŒçš„å¤„ç†äºº</li>
<li>æ‰€ä»¥åŒä¸€ä¸ªREQUESTIDä¼šå‡ºç°åœ¨å¤šä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸­</li>
</ul>
<h3 data-id="heading-4">ä½ çš„æ•°æ®ç¤ºä¾‹ï¼š</h3>
<p>text</p>
<pre><code class="hljs">REQUESTID  NODEID  å¤„ç†äºº
303364     371     ä½•æ°¸åˆš
303364     372     ä½•æ°¸åˆš, è°¢é›¨èŠ¯  &lt;- èŠ‚ç‚¹372
303364     374     éŸ¦ä¸¹å¦®, è°¢é›¨èŠ¯  &lt;- èŠ‚ç‚¹374ï¼ˆä¸åŒèŠ‚ç‚¹ï¼ï¼‰
303364     377     æåå¦¹         &lt;- èŠ‚ç‚¹377ï¼ˆä¸åŒèŠ‚ç‚¹ï¼ï¼‰
</code></pre>
<p><strong>GROUP BY REQUESTID, NODEID åï¼Œæ¯ä¸ª(REQUESTID, NODEID)ç»„åˆæˆä¸ºä¸€è¡Œï¼š</strong></p>
<p>text</p>
<pre><code class="hljs language-r" lang="r">REQUESTID  NODEID  <span class="hljs-built_in">names</span>
<span class="hljs-number">303364</span>     <span class="hljs-number">371</span>     ä½•æ°¸åˆš
<span class="hljs-number">303364</span>     <span class="hljs-number">372</span>     ä½•æ°¸åˆš<span class="hljs-punctuation">,</span> è°¢é›¨èŠ¯
<span class="hljs-number">303364</span>     <span class="hljs-number">374</span>     éŸ¦ä¸¹å¦®<span class="hljs-punctuation">,</span> è°¢é›¨èŠ¯
<span class="hljs-number">303364</span>     <span class="hljs-number">377</span>     æåå¦¹
</code></pre>
<h2 data-id="heading-5">å¯¹æ¯”ä¸åŒçš„GROUP BYæ–¹å¼</h2>
<h3 data-id="heading-6">1. æŒ‰REQUESTIDå’ŒNODEIDåˆ†ç»„ï¼ˆä½ çš„æ–¹å¼ï¼‰</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> REQUESTID, NODEID
</code></pre>
<p>ç»“æœï¼š<strong>ä¸€ä¸ªREQUESTIDåœ¨ä¸åŒèŠ‚ç‚¹ä¼šæœ‰å¤šè¡Œè®°å½•</strong></p>
<h3 data-id="heading-7">2. åªæŒ‰REQUESTIDåˆ†ç»„</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> REQUESTID
</code></pre>
<p>ç»“æœï¼š<strong>ä¸€ä¸ªREQUESTIDåªæœ‰ä¸€è¡Œè®°å½•ï¼Œåˆå¹¶æ‰€æœ‰èŠ‚ç‚¹çš„äººå‘˜</strong></p>
<p>text</p>
<pre><code class="hljs language-r" lang="r">REQUESTID  <span class="hljs-built_in">names</span>
<span class="hljs-number">303364</span>     ä½•æ°¸åˆš<span class="hljs-punctuation">,</span> ä½•æ°¸åˆš<span class="hljs-punctuation">,</span> è°¢é›¨èŠ¯<span class="hljs-punctuation">,</span> è°¢é›¨èŠ¯<span class="hljs-punctuation">,</span> éŸ¦ä¸¹å¦®<span class="hljs-punctuation">,</span> æåå¦¹...
</code></pre>
<h3 data-id="heading-8">3. åªæŒ‰NODEIDåˆ†ç»„</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> NODEID
</code></pre>
<p>ç»“æœï¼š<strong>åŒä¸€ä¸ªèŠ‚ç‚¹æ¥è‡ªä¸åŒæµç¨‹çš„äººå‘˜åˆå¹¶</strong></p>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss">NODEID  names
<span class="hljs-number">372</span>     ä½•æ°¸åˆš(<span class="hljs-number">303364</span>), è°¢é›¨èŠ¯(<span class="hljs-number">303364</span>), å¼ ä¸‰(å…¶ä»–æµç¨‹), æå››(å…¶ä»–æµç¨‹)...
</code></pre>
<h2 data-id="heading-9">éªŒè¯SQL</h2>
<p>è¿è¡Œè¿™ä¸ªæ¥æŸ¥çœ‹å®é™…çš„åˆ†ç»„æƒ…å†µï¼š</p>
<p>sql</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹æ¯ä¸ªREQUESTIDæœ‰å¤šå°‘ä¸ªä¸åŒçš„NODEID</span>
<span class="hljs-keyword">SELECT</span> 
    REQUESTID,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> NODEID) <span class="hljs-keyword">AS</span> node_count,
    GROUP_CONCAT(<span class="hljs-keyword">DISTINCT</span> NODEID <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> NODEID) <span class="hljs-keyword">AS</span> node_list,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> USERID) <span class="hljs-keyword">AS</span> user_count
<span class="hljs-keyword">FROM</span> workflow_currentoperator
<span class="hljs-keyword">WHERE</span> ISREMARK <span class="hljs-keyword">IN</span> (<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)
    <span class="hljs-keyword">AND</span> REQUESTID <span class="hljs-keyword">IN</span> (<span class="hljs-string">'303364'</span>, <span class="hljs-string">'303365'</span>, <span class="hljs-string">'303366'</span>)  <span class="hljs-comment">-- ä½ çš„ç¤ºä¾‹REQUESTID</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> REQUESTID
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> REQUESTID;
</code></pre>
<h2 data-id="heading-10">æ ¹æ®éœ€æ±‚é€‰æ‹©æ­£ç¡®çš„GROUP BY</h2>
<h3 data-id="heading-11">åœºæ™¯1ï¼šæƒ³è¦æ¯ä¸ªæµç¨‹æ¯ä¸ªèŠ‚ç‚¹çš„å¤„ç†äººåˆ—è¡¨ï¼ˆä½ ç°åœ¨çš„éœ€æ±‚ï¼‰</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet">-- æ­£ç¡®ï¼šæ˜¾ç¤ºæµç¨‹åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å¤„ç†äºº
<span class="hljs-keyword">SELECT</span>
    REQUESTID,
    NODEID,
    GROUP_CONCAT(<span class="hljs-keyword">DISTINCT</span> LASTNAME <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> LASTNAME SEPARATOR <span class="hljs-comment">', ') AS node_handlers</span>
<span class="hljs-keyword">FROM</span> workflow_currentoperator wf_cur
INNER <span class="hljs-keyword">JOIN</span> hrmresource zper <span class="hljs-keyword">ON</span> wf_cur.USERID = zper.ID
<span class="hljs-keyword">WHERE</span> wf_cur.ISREMARK <span class="hljs-keyword">IN</span> (<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> REQUESTID, NODEID;
</code></pre>
<h3 data-id="heading-12">åœºæ™¯2ï¼šæƒ³è¦æ¯ä¸ªæµç¨‹çš„æ‰€æœ‰å¤„ç†äººï¼ˆåˆå¹¶æ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet">-- åˆå¹¶æµç¨‹çš„æ‰€æœ‰å¤„ç†äººï¼ˆä¸ç®¡åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼‰
<span class="hljs-keyword">SELECT</span>
    REQUESTID,
    GROUP_CONCAT(<span class="hljs-keyword">DISTINCT</span> LASTNAME <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> LASTNAME SEPARATOR <span class="hljs-comment">', ') AS all_handlers,</span>
    COUNT(<span class="hljs-keyword">DISTINCT</span> NODEID) <span class="hljs-keyword">AS</span> total_nodes
<span class="hljs-keyword">FROM</span> workflow_currentoperator wf_cur
INNER <span class="hljs-keyword">JOIN</span> hrmresource zper <span class="hljs-keyword">ON</span> wf_cur.USERID = zper.ID
<span class="hljs-keyword">WHERE</span> wf_cur.ISREMARK <span class="hljs-keyword">IN</span> (<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> REQUESTID;
</code></pre>
<h3 data-id="heading-13">åœºæ™¯3ï¼šæƒ³è¦æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å¤„ç†äººï¼ˆåˆå¹¶æ‰€æœ‰æµç¨‹ï¼‰</h3>
<p>sql</p>
<pre><code class="hljs language-vbnet" lang="vbnet">-- æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹æœ‰å“ªäº›äººåœ¨å¤„ç†ï¼ˆæ¥è‡ªä¸åŒæµç¨‹ï¼‰
<span class="hljs-keyword">SELECT</span>
    NODEID,
    GROUP_CONCAT(
        <span class="hljs-keyword">DISTINCT</span> CONCAT(LASTNAME, <span class="hljs-comment">'(', REQUESTID, ')')</span>
        <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> LASTNAME
        SEPARATOR <span class="hljs-comment">', '</span>
    ) <span class="hljs-keyword">AS</span> handlers_by_process,
    COUNT(<span class="hljs-keyword">DISTINCT</span> REQUESTID) <span class="hljs-keyword">AS</span> process_count
<span class="hljs-keyword">FROM</span> workflow_currentoperator wf_cur
INNER <span class="hljs-keyword">JOIN</span> hrmresource zper <span class="hljs-keyword">ON</span> wf_cur.USERID = zper.ID
<span class="hljs-keyword">WHERE</span> wf_cur.ISREMARK <span class="hljs-keyword">IN</span> (<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> NODEID;
</code></pre>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p><strong>GROUP BY REQUESTID, NODEID çš„ç»“æœæ˜¯æ­£å¸¸çš„ï¼</strong></p>
<ul>
<li>åŒä¸€ä¸ªREQUESTID + ä¸åŒçš„NODEID = ä¸åŒçš„åˆ†ç»„</li>
<li>è¿™åæ˜ äº†å·¥ä½œæµçš„çœŸå®æƒ…å†µï¼šä¸€ä¸ªæµç¨‹ä¼šç»è¿‡å¤šä¸ªèŠ‚ç‚¹</li>
<li>æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½æœ‰ä¸åŒçš„å¤„ç†äºº</li>
</ul>
<p>å¦‚æœä½ æƒ³è¦<strong>æ¯ä¸ªREQUESTIDåªæ˜¾ç¤ºä¸€è¡Œ</strong>ï¼Œåº”è¯¥ç”¨Â <code>GROUP BY REQUESTID</code>ã€‚<br/>
ä½†æ ¹æ®ä½ çš„æ•°æ®ï¼ŒåŒä¸€ä¸ªREQUESTIDåœ¨ä¸åŒèŠ‚ç‚¹ç¡®å®æœ‰ä¸åŒçš„å¤„ç†äººï¼Œæ‰€ä»¥æ˜¾ç¤ºå¤šè¡Œæ˜¯æ­£ç¡®çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Batfish Dashboard é¡¹ç›®è¯´æ˜æ–‡æ¡£]]></title>    <link>https://juejin.cn/post/7584357116435464233</link>    <guid>https://juejin.cn/post/7584357116435464233</guid>    <pubDate>2025-12-17T06:28:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584357116435464233" data-draft-id="7584357116435431465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Batfish Dashboard é¡¹ç›®è¯´æ˜æ–‡æ¡£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-17T06:28:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="leeggco"/> <meta itemprop="url" content="https://juejin.cn/user/96412752952189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Batfish Dashboard é¡¹ç›®è¯´æ˜æ–‡æ¡£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752952189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    leeggco
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:28:14.000Z" title="Wed Dec 17 2025 06:28:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Batfish Dashboard é¡¹ç›®è¯´æ˜æ–‡æ¡£</h2>
<h3 data-id="heading-1">1. é¡¹ç›®æ¦‚è¿°</h3>
<p><strong>Batfish Dashboard</strong> æ˜¯ä¸€ä¸ªåŸºäº Python Dash æ¡†æ¶æ„å»ºçš„ Web åº”ç”¨ç¨‹åºï¼Œæ—¨åœ¨ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.batfish.org%2F" target="_blank" title="https://www.batfish.org/" ref="nofollow noopener noreferrer">Batfish</a> ç½‘ç»œé…ç½®åˆ†æå·¥å…·æä¾›å›¾å½¢åŒ–ç”¨æˆ·ç•Œé¢ (GUI)ã€‚</p>
<p>Batfish æ˜¯ä¸€ä¸ªå¼€æºçš„ç½‘ç»œé…ç½®åˆ†æå·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå°†ç½‘ç»œè®¾å¤‡çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ Cisco, Juniper, Arista ç­‰å‚å•†çš„é…ç½®ï¼‰è§£æä¸ºç‹¬ç«‹äºå‚å•†çš„æ¨¡å‹ï¼Œå¹¶è¿›è¡Œç¦»çº¿çš„ç½‘ç»œæ¨¡æ‹Ÿå’Œæ­£ç¡®æ€§éªŒè¯ã€‚</p>
<p>æœ¬é¡¹ç›®é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼ï¼Œé™ä½äº†ä½¿ç”¨ Batfish çš„é—¨æ§›ï¼Œè®©ç½‘ç»œå·¥ç¨‹å¸ˆæ— éœ€ç¼–å†™ Python è„šæœ¬å³å¯è¿›è¡Œç½‘ç»œæ‹“æ‰‘æŸ¥çœ‹ã€æµé‡è·¯å¾„æ¨¡æ‹Ÿã€ACL éªŒè¯ä»¥åŠæ•…éšœæ¼”ç»ƒã€‚</p>
<hr/>
<h3 data-id="heading-2">2. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</h3>
<p>æœ¬é¡¹ç›®çš„æ ¸å¿ƒé€»è¾‘éµå¾ª <strong>"é…ç½® -&gt; è§£æ -&gt; å»ºæ¨¡ -&gt; åˆ†æ -&gt; å¯è§†åŒ–"</strong> çš„æµç¨‹ï¼š</p>
<ol>
<li>
<p><strong>è¿æ¥ Batfish æœåŠ¡</strong>ï¼š</p>
<ul>
<li>å‰ç«¯é€šè¿‡ Pybatfish å®¢æˆ·ç«¯è¿æ¥åˆ°è¿è¡Œåœ¨ Docker å®¹å™¨æˆ–è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ Batfish æœåŠ¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®ç»„ç»‡ (Network &amp; Snapshot)</strong>ï¼š</p>
<ul>
<li><strong>Network (ç½‘ç»œ)</strong>ï¼šä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œé€šå¸¸ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„æ•°æ®ä¸­å¿ƒæˆ–ç½‘ç»œç¯å¢ƒã€‚</li>
<li><strong>Snapshot (å¿«ç…§)</strong>ï¼šä»£è¡¨ç½‘ç»œåœ¨æŸä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚ç”¨æˆ·ä¸Šä¼ ä¸€ç»„é…ç½®æ–‡ä»¶ï¼ˆè·¯ç”±å™¨é…ç½®ã€é˜²ç«å¢™è§„åˆ™ã€ä¸»æœºå®šä¹‰ç­‰ï¼‰ï¼ŒBatfish è§£æè¿™äº›æ–‡ä»¶å¹¶å»ºç«‹ç½‘ç»œæ¨¡å‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>åˆ†æä¸æŸ¥è¯¢</strong>ï¼š</p>
<ul>
<li>ä¸€æ—¦å¿«ç…§åˆå§‹åŒ–å®Œæˆï¼Œç”¨æˆ·åœ¨ç•Œé¢ä¸Šçš„æ“ä½œï¼ˆå¦‚ç‚¹å‡»"Trace"æˆ–åˆ‡æ¢æ ‡ç­¾é¡µï¼‰ä¼šè§¦å‘åç«¯è°ƒç”¨ Pybatfish APIã€‚</li>
<li>åç«¯å‘ Batfish æœåŠ¡å‘é€æŸ¥è¯¢è¯·æ±‚ï¼ˆQuestionsï¼‰ï¼Œä¾‹å¦‚è¯¢é—®"æ‰€æœ‰ BGP ä¼šè¯çš„çŠ¶æ€"æˆ–"ä» A åˆ° B çš„æµé‡è·¯å¾„"ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç»“æœæ¸²æŸ“</strong>ï¼š</p>
<ul>
<li>Batfish è¿”å›ç»“æ„åŒ–çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯ Pandas DataFrameï¼‰ã€‚</li>
<li>Dash åº”ç”¨å°†è¿™äº›æ•°æ®è½¬æ¢ä¸ºå‰ç«¯ç»„ä»¶ï¼š
<ul>
<li><strong>Cytoscape å›¾è¡¨</strong>ï¼šç”¨äºå±•ç¤ºç½‘ç»œæ‹“æ‰‘ã€‚</li>
<li><strong>æ•°æ®è¡¨æ ¼</strong>ï¼šç”¨äºå±•ç¤ºè¯¦ç»†çš„é…ç½®ä¿¡æ¯ã€‚</li>
<li><strong>äº¤äº’å¼ç»„ä»¶</strong>ï¼šç”¨äºå±•ç¤º Traceroute çš„é€è·³ç»†èŠ‚ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">3. é¡µé¢åŠŸèƒ½è¯¦è§£</h3>
<h4 data-id="heading-4">3.1 é¡¶éƒ¨å¯¼èˆªä¸è®¾ç½®</h4>
<ul>
<li><strong>Set Batfish Host</strong>ï¼šé…ç½® Batfish åç«¯æœåŠ¡çš„åœ°å€ï¼ˆé»˜è®¤ä¸ºæœ¬åœ°ï¼Œä½†æ”¯æŒè¿æ¥è¿œç¨‹æœåŠ¡ï¼‰ã€‚</li>
<li><strong>Networks / Snapshots</strong>ï¼šå¿«æ·è·³è½¬åˆ°ç®¡ç†æ¨¡æ€æ¡†ã€‚</li>
<li><strong>Ask Question</strong>ï¼šæ‰“å¼€é€šç”¨æŸ¥è¯¢çª—å£ã€‚</li>
</ul>
<h4 data-id="heading-5">3.2 æ§åˆ¶æ  (Control Bar)</h4>
<p>ä½äºé¡µé¢é¡¶éƒ¨ï¼Œç”¨äºé€‰æ‹©å½“å‰å·¥ä½œçš„ä¸Šä¸‹æ–‡ï¼š</p>
<ul>
<li><strong>Select Network</strong>ï¼šé€‰æ‹©å½“å‰è¦åˆ†æçš„ç½‘ç»œç¯å¢ƒã€‚</li>
<li><strong>Select Snapshot</strong>ï¼šé€‰æ‹©è¯¥ç½‘ç»œä¸‹çš„å…·ä½“é…ç½®å¿«ç…§ï¼ˆä¾‹å¦‚ "Initial_Config" æˆ– "Post_Change_Config"ï¼‰ã€‚</li>
<li><strong>åˆ›å»º/åˆ é™¤åŠŸèƒ½</strong>ï¼šæ”¯æŒåˆ›å»ºæ–°ç½‘ç»œã€ä¸Šä¼ é…ç½®æ–‡ä»¶åŒ…ç”Ÿæˆæ–°å¿«ç…§ã€ä»¥åŠåˆ é™¤æ—§çš„æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-6">3.3 æ ¸å¿ƒåŠŸèƒ½æ ‡ç­¾é¡µ (Main Tabs)</h4>
<h5 data-id="heading-7">A. æ‹“æ‰‘è§†å›¾ (Layer 3, OSPF, BGP)</h5>
<p>è¿™ä¸‰ä¸ªæ ‡ç­¾é¡µæä¾›äº†ä¸åŒå±‚é¢çš„ç½‘ç»œå¯è§†åŒ–ï¼Œä½¿ç”¨ Cytoscape åº“æ¸²æŸ“ï¼š</p>
<ul>
<li><strong>Layer 3</strong>ï¼šå±•ç¤ºåŸºäº IP åœ°å€å’Œå­ç½‘æ„å»ºçš„ä¸‰å±‚è¿æ¥å›¾ã€‚</li>
<li><strong>OSPF</strong>ï¼šå±•ç¤º OSPF é‚»å±…å…³ç³»ï¼Œå¸®åŠ©ç†è§£å†…éƒ¨ç½‘å…³åè®®çš„è·¯ç”±åŸŸã€‚</li>
<li><strong>BGP</strong>ï¼šå±•ç¤º BGP å¯¹ç­‰ä½“å…³ç³»ï¼ˆIBGP/EBGPï¼‰ï¼Œé€šè¿‡çˆ¶èŠ‚ç‚¹åˆ†ç»„å±•ç¤ºè‡ªæ²»ç³»ç»Ÿ (AS)ã€‚
<ul>
<li><em>äº¤äº’</em>ï¼šæ”¯æŒæ‹–æ‹½èŠ‚ç‚¹ã€ç¼©æ”¾è§†å›¾ã€é¼ æ ‡æ‚¬åœæŸ¥çœ‹èŠ‚ç‚¹/é“¾è·¯è¯¦æƒ…ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-8">B. è·¯å¾„è¿½è¸ª (Trace Route)</h5>
<p>è¿™æ˜¯é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œç”¨äºæ¨¡æ‹Ÿæµé‡åœ¨ç½‘ç»œä¸­çš„è½¬å‘è·¯å¾„ã€‚</p>
<ul>
<li><strong>åŸºæœ¬é…ç½®</strong>ï¼š
<ul>
<li><strong>Source (æº)</strong>ï¼šé€‰æ‹©èµ·å§‹è®¾å¤‡å’Œæ¥å£ã€‚</li>
<li><strong>Destination (ç›®çš„)</strong>ï¼šé€‰æ‹©ç›®çš„ IP æˆ–ç›®çš„æ¥å£ã€‚</li>
</ul>
</li>
<li><strong>é«˜çº§é€‰é¡¹ (Advanced)</strong>ï¼š
<ul>
<li>æ”¯æŒè®¾ç½®æºç«¯å£ã€ç›®çš„ç«¯å£ã€IP åè®®ï¼ˆTCP/UDP/ICMPï¼‰ã€åº”ç”¨ç±»å‹ç­‰ï¼Œä»¥æµ‹è¯•é˜²ç«å¢™è§„åˆ™æˆ–ç­–ç•¥è·¯ç”±ã€‚</li>
</ul>
</li>
<li><strong>åŒå‘è¿½è¸ª (Bidirectional)</strong>ï¼šåŒæ—¶æ¨¡æ‹Ÿå›ç¨‹æµé‡ï¼Œæ£€æµ‹éå¯¹ç§°è·¯ç”±é—®é¢˜ã€‚</li>
<li><strong>æ··æ²Œæ¨¡å¼ (Chaos Mode)</strong>ï¼š
<ul>
<li><strong>æ•…éšœæ¨¡æ‹Ÿ</strong>ï¼šå…è®¸ç”¨æˆ·åœ¨ä¸ä¿®æ”¹çœŸå®é…ç½®çš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹ŸæŸä¸ªèŠ‚ç‚¹æˆ–æ¥å£å®•æœºï¼Œè§‚å¯Ÿè·¯å¾„æ˜¯å¦ä¼šè‡ªåŠ¨åˆ‡æ¢ï¼ˆéªŒè¯é«˜å¯ç”¨æ€§ï¼‰ã€‚</li>
<li><strong>é…ç½®å˜æ›´æ¨¡æ‹Ÿ</strong>ï¼šå…è®¸ç”¨æˆ·ä¸´æ—¶ä¿®æ”¹æŸä¸ªè®¾å¤‡çš„é…ç½®æ–‡æœ¬ï¼Œé‡æ–°è®¡ç®—è·¯å¾„ï¼ŒéªŒè¯å˜æ›´æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-9">C. ACL åˆ†æ (All Things ACL)</h5>
<p>ç”¨äºéªŒè¯è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL) çš„ç­‰ä»·æ€§ï¼Œå¸¸ç”¨äº ACL é‡æ„åœºæ™¯ã€‚</p>
<ul>
<li><strong>Original ACL</strong>ï¼šè¾“å…¥é‡æ„å‰çš„ ACL é…ç½®ã€‚</li>
<li><strong>Refactored ACL</strong>ï¼šè¾“å…¥é‡æ„åçš„ ACL é…ç½®ã€‚</li>
<li><strong>Analyze</strong>ï¼šç³»ç»Ÿä¼šå¯¹æ¯”ä¸¤ä¸ª ACL å¯¹æµé‡çš„è¿‡æ»¤è¡Œä¸ºæ˜¯å¦å®Œå…¨ä¸€è‡´ã€‚å¦‚æœå­˜åœ¨å·®å¼‚ï¼ˆä¾‹å¦‚æŸä¸ªæµé‡åœ¨æ—§ ACL å…è®¸ä½†åœ¨æ–° ACL è¢«æ‹’ç»ï¼‰ï¼Œç³»ç»Ÿä¼šåˆ—å‡ºå…·ä½“çš„æµé‡åŒ…ç¤ºä¾‹ã€‚</li>
</ul>
<h4 data-id="heading-10">3.4 é€šç”¨é—®ç­” (Ask a Question)</h4>
<p>ä½äºå¯¼èˆªæ çš„ "Ask Question" æŒ‰é’®ã€‚</p>
<ul>
<li>æä¾›äº†ä¸€ä¸ªé€šç”¨çš„æŸ¥è¯¢æ¥å£ï¼Œç”¨æˆ·å¯ä»¥ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© Batfish æ”¯æŒçš„ä»»æ„é—®é¢˜ï¼ˆå¦‚ <code>ipOwners</code>, <code>routes</code>, <code>definedStructures</code> ç­‰ï¼‰ã€‚</li>
<li>ç»“æœä»¥å¯æœç´¢ã€å¯æ’åºçš„æ•°æ®è¡¨æ ¼å½¢å¼å±•ç¤ºï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œç‰¹å®šçš„å®¡è®¡æˆ–èµ„äº§ç›˜ç‚¹ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-11">4. æŠ€æœ¯æ ˆ</h3>
<ul>
<li><strong>å‰ç«¯/åº”ç”¨æ¡†æ¶</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdash.plotly.com%2F" target="_blank" title="https://dash.plotly.com/" ref="nofollow noopener noreferrer">Dash</a> (åŸºäº Flask, Plotly.js, React.js)</li>
<li><strong>UI ç»„ä»¶åº“</strong>: Dash Bootstrap Components (DBC), Dash Cytoscape (ç½‘ç»œå›¾)</li>
<li><strong>åç«¯é€»è¾‘</strong>: Python, Pandas</li>
<li><strong>ç½‘ç»œåˆ†æå¼•æ“</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbatfish%2Fpybatfish" target="_blank" title="https://github.com/batfish/pybatfish" ref="nofollow noopener noreferrer">Pybatfish</a> (Python å®¢æˆ·ç«¯) -&gt; Batfish Service (Java)</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RabbitMQå‘å¸ƒè®¢é˜…æ¨¡å¼åŒä¸€æ¶ˆè´¹è€…å¤šä¸ªå®ä¾‹å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7584408254819205155</link>    <guid>https://juejin.cn/post/7584408254819205155</guid>    <pubDate>2025-12-17T06:43:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254819205155" data-draft-id="7584379805899423796" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RabbitMQå‘å¸ƒè®¢é˜…æ¨¡å¼åŒä¸€æ¶ˆè´¹è€…å¤šä¸ªå®ä¾‹å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-17T06:43:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RabbitMQå‘å¸ƒè®¢é˜…æ¨¡å¼åŒä¸€æ¶ˆè´¹è€…å¤šä¸ªå®ä¾‹å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:43:18.000Z" title="Wed Dec 17 2025 06:43:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¾®æœåŠ¡æ¶æ„æ¨¡å¼ä¸­ï¼ŒæœåŠ¡é—´çš„é€šä¿¡ä¸€èˆ¬é‡‡ç”¨HTTPã€RPCæˆ–è€…MQï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€‚åœ¨è¿™ä¸‰ç§æ–¹æ¡ˆä¸­ï¼ŒHTTPå’ŒRPCæ˜¯ä¸€å¯¹ä¸€çš„æ–¹å¼ï¼Œé€šå¸¸ç”¨æ¥è¿›è¡ŒæŸ¥è¯¢æˆ–è€…å‘½ä»¤å¼çš„æ“ä½œï¼ŒMQåˆ™å¤šç”¨äºäº‹ä»¶çš„å‘å¸ƒå’Œå¤„ç†ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°ä¸€ç§æƒ…å†µï¼š</p>
<blockquote>
<p>äº‹ä»¶æœ‰å¤šä¸ªè®¢é˜…è€…ï¼Œæœ‰çš„è®¢é˜…è€…éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œè¦æ±‚æ¯ä¸ªäº‹ä»¶åªéœ€è¦å‘å¸ƒä¸€æ¬¡ï¼Œæ¯ä¸ªè®¢é˜…è€…éƒ½è¦èƒ½æ”¶åˆ°ä¸”ä»…èƒ½æœ‰å…¶ä¸­ä¸€ä¸ªå®ä¾‹æ”¶åˆ°å¹¶è¿›è¡Œå¤„ç†ã€‚</p>
</blockquote>
<p>ç®€å•è¯´å°±æ˜¯æ—¢è¦æ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆè¦ä¿è¯æ¯ä¸ªè®¢é˜…è€…åªèƒ½æ¶ˆè´¹ä¸€æ¬¡ï¼Œ<strong>ä¸èƒ½é‡å¤æ¶ˆè´¹</strong>ã€‚é‚£ä¹ˆåœ¨ä½¿ç”¨RabbitMQä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶æ—¶åº”è¯¥å¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<h3 data-id="heading-0">éœ€æ±‚</h3>
<p>å¾®æœåŠ¡æ¶æ„ä¸‹ä½¿ç”¨RabbitMQä½œä¸ºæœåŠ¡æ€»çº¿ä¸­é—´ä»¶ï¼Œæœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œè®¢å•æœåŠ¡åœ¨ç”¨æˆ·æäº¤è®¢å•åä¼šå‘é€OrderCreatedEventäº‹ä»¶ï¼Œéœ€è¦æ¥æ”¶æ­¤äº‹ä»¶çš„æœåŠ¡æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š<br/>
1ã€æ—¥å¿—æœåŠ¡ï¼ˆå•ç‚¹éƒ¨ç½²ï¼‰ï¼›<br/>
2ã€æ¶ˆæ¯ç³»ç»Ÿï¼Œç»™ç”¨æˆ·å‘é€çŸ­ä¿¡ã€é‚®ä»¶ï¼ˆå•ç‚¹éƒ¨ç½²ï¼‰ï¼›<br/>
3ã€ä»“å‚¨ç³»ç»Ÿï¼Œæ¥æ”¶é€šçŸ¥å¤‡è´§ï¼Œæ‰£å‡åº“å­˜ç­‰ï¼ˆå¤šå®ä¾‹ï¼Œæœ‰è´Ÿè½½å‡è¡¡ï¼‰ï¼ŒåŒä¸€æ¡æ¶ˆæ¯ä»…å…è®¸ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹ï¼›<br/>
4ã€è´¢åŠ¡ç³»ç»Ÿï¼Œè®°å½•æ”¶å…¥æµæ°´ï¼ˆå¤šå®ä¾‹ï¼Œæœ‰è´Ÿè½½å‡è¡¡ï¼‰ï¼ŒåŒä¸€æ¡æ¶ˆæ¯ä»…å…è®¸ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹ï¼›<br/>
5ã€BIç³»ç»Ÿï¼Œåšé”€å”®ç»Ÿè®¡ç­‰ï¼›</p>
<h3 data-id="heading-1">é—®é¢˜</h3>
<p>OrderCreatedEventå‘å‡ºåï¼Œ5ä¸ªæœåŠ¡å‡å¯ä»¥æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯ä»“å‚¨å’Œè´¢åŠ¡éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œä¹Ÿå°±æ„å‘³ç€æ¯ä¸ªå®ä¾‹éƒ½èƒ½æ”¶åˆ°ç›¸åŒçš„æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚ä½•é¿å…é‡å¤æ¶ˆè´¹ï¼Ÿ</p>
<h3 data-id="heading-2">æ–¹æ¡ˆ</h3>
<ol>
<li>ä¸º<code>OrderCreatedEvent</code>äº‹ä»¶å»ºç«‹ä¸€ä¸ª<code>fanout exchange</code>ï¼Œ</li>
<li>æ¯ä¸ªéœ€è¦å¤„ç†<code>OrderCreatedEvent</code>çš„è®¢é˜…è€…å•ç‹¬å»ºç«‹ä¸€ä¸ª<code>queue</code>ï¼Œè®¢é˜…è€…çš„æ‰€æœ‰å®ä¾‹éƒ½æ¶ˆè´¹è¿™ä¸€ä¸ª<code>queue</code>çš„æ¶ˆæ¯ã€‚</li>
<li>å°†æ‰€æœ‰<code>OrderCreatedEvent</code>è®¢é˜…è€…çš„<code>queue</code>éƒ½bindåˆ°ç¬¬ä¸€æ­¥å»ºç«‹çš„<code>exchange</code>ä¸Šã€‚</li>
<li>äº‹ä»¶å‘å¸ƒè€…å°†<code>OrderCreatedEvent</code>æ¶ˆæ¯å‘å¸ƒåˆ°<code>exchange</code>ï¼Œç”±<code>exchange</code>å°†æ¶ˆæ¯è·¯ç”±åˆ°å¯¹åº”çš„<code>queue</code>ï¼Œæœ€åç”±<code>queue</code>é”å®šä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹å¹¶è¿›è¡ŒæŠ•é€’ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ç¤ºæ„å›¾</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c44a502a582a4d8d8f073b70ea5bdc1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766558597&amp;x-signature=TlrTQPCBUsmjGBkfubp8ZXuKWLc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">å››ç§ä¸»è¦ Exchange ç±»å‹</h3>
<p>RabbitMQä¸»è¦æœ‰å››ç§æ ¸å¿ƒçš„Exchangeç±»å‹ï¼š<code>Fanout</code>ï¼ˆå¹¿æ’­ï¼‰ã€<code>Direct</code>ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ã€<code>Topic</code>ï¼ˆæ¨¡å¼åŒ¹é…ï¼‰å’Œ<code>Headers</code>ï¼ˆæŒ‰å¤´åŒ¹é…ï¼‰ï¼Œå®ƒä»¬å†³å®šäº†æ¶ˆæ¯å¦‚ä½•ä»äº¤æ¢æœºè·¯ç”±åˆ°é˜Ÿåˆ—ï¼Œå…¶ä¸­Directã€Topicã€Fanoutæœ€å¸¸ç”¨ï¼Œè€ŒHeaderså’Œä¸€äº›æ’ä»¶ç±»å‹ï¼ˆå¦‚<code>x-delayed-message</code>ï¼‰æä¾›æ›´çµæ´»çš„è·¯ç”±åŠŸèƒ½ã€‚</p>
<ol>
<li>
<p><strong>Fanout (æ‰‡å‡º)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šåˆ°å®ƒçš„é˜Ÿåˆ—ã€‚</li>
<li><strong>è·¯ç”±è§„åˆ™</strong>ï¼šå¿½ç•¥è·¯ç”±é”® (Routing Key)ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ—¥å¿—ç³»ç»Ÿã€é€šçŸ¥å¹¿æ’­ç­‰éœ€è¦æ¶ˆæ¯åˆ†å‘åˆ°å¤šä¸ªæ¶ˆè´¹è€…çš„åœºæ™¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>Direct (ç›´è¿)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ¶ˆæ¯æ ¹æ®ä¸é˜Ÿåˆ—ç»‘å®šçš„ç²¾ç¡®è·¯ç”±é”®æ¥è·¯ç”±ã€‚</li>
<li><strong>è·¯ç”±è§„åˆ™</strong>ï¼š<code>æ¶ˆæ¯çš„ Routing Key</code>Â å¿…é¡»<strong>å®Œå…¨</strong>åŒ¹é…Â <code>é˜Ÿåˆ—ç»‘å®šçš„ Routing Key</code>ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ç‰¹å®šç±»å‹çš„ä»»åŠ¡ï¼Œå¦‚å¤„ç†â€œç”¨æˆ·æ³¨å†Œâ€æ¶ˆæ¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>Topic (ä¸»é¢˜)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šä½¿ç”¨é€šé…ç¬¦ï¼ˆ<code>*</code>Â åŒ¹é…ä¸€ä¸ªè¯ï¼Œ<code>#</code>Â åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰è¿›è¡Œæ¨¡å¼åŒ¹é…è·¯ç”±ã€‚</li>
<li><strong>è·¯ç”±è§„åˆ™</strong>ï¼š<code>æ¶ˆæ¯çš„ Routing Key</code>Â æ¨¡å¼éœ€è¦ä¸Â <code>é˜Ÿåˆ—ç»‘å®šçš„æ¨¡å¼</code>Â åŒ¹é…ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šæ—¥å¿—çº§åˆ«è¿‡æ»¤ï¼Œå¦‚<code>logs.info.*</code>Â åŒ¹é…æ‰€æœ‰ info çº§åˆ«çš„æ—¥å¿—ï¼Œ<code>logs.#</code>Â åŒ¹é…æ‰€æœ‰æ—¥å¿—.</li>
</ul>
</li>
<li>
<p><strong>Headers (å¤´éƒ¨)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ ¹æ®æ¶ˆæ¯çš„ Headers å±æ€§ï¼ˆé”®å€¼å¯¹ï¼‰è¿›è¡Œè·¯ç”±ï¼Œè€Œä¸æ˜¯ Routing Keyã€‚</li>
<li><strong>è·¯ç”±è§„åˆ™</strong>ï¼šåŒ¹é…æ¶ˆæ¯ Headers ä¸­çš„é”®å€¼å¯¹ä¸ç»‘å®šæ—¶è®¾ç½®çš„é”®å€¼å¯¹ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šå½“éœ€è¦æ ¹æ®å¤æ‚å±æ€§åŒ¹é…æ—¶ï¼Œè¾ƒå°‘ä½¿ç”¨ï¼Œå› ä¸ºæ€§èƒ½ä¸å¦‚å‰ä¸‰è€…ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-4">Demo</h3>
<p>åé¢æˆ‘å°†ä¼šæä¾›ä»¥ä¸Šæ–¹æ¡ˆçš„å…·ä½“å®ç°ï¼ŒåŒ…å«<code>Java</code>å’Œ<code>.net</code>ä¸¤ç§ç‰ˆæœ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>