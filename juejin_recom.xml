<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Hibernate（73）如何在事件驱动架构中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7600967006893719561</link>    <guid>https://juejin.cn/post/7600967006893719561</guid>    <pubDate>2026-01-30T11:49:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600967006893719561" data-draft-id="7600955777315782694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（73）如何在事件驱动架构中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T11:49:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（73）如何在事件驱动架构中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T11:49:57.000Z" title="Fri Jan 30 2026 11:49:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在事件驱动架构中使用Hibernate，可以有效地处理数据持久性，并在事件发生时触发相应的数据库操作。事件驱动架构通常涉及使用消息队列（如RabbitMQ、Kafka等）来发布和订阅事件。下面我们将展示如何在Spring Boot项目中结合Hibernate和RabbitMQ实现事件驱动架构。</p>
<h3 data-id="heading-0">1. 项目依赖</h3>
<p>在<code>pom.xml</code>中添加必要的依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- RabbitMQ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. 配置数据源和Hibernate属性</h3>
<p>在<code>application.properties</code>中配置数据源和Hibernate属性：</p>
<pre><code class="hljs language-properties" lang="properties"># MySQL Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# RabbitMQ Configuration
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
</code></pre>
<h3 data-id="heading-2">3. 定义实体类和DAO层</h3>
<h4 data-id="heading-3"><code>Order.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProduct</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProduct</span><span class="hljs-params">(String product)</span> {
        <span class="hljs-built_in">this</span>.product = product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getQuantity</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setQuantity</span><span class="hljs-params">(<span class="hljs-type">int</span> quantity)</span> {
        <span class="hljs-built_in">this</span>.quantity = quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> price;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-built_in">this</span>.price = price;
    }
}
</code></pre>
<h4 data-id="heading-4"><code>OrderRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
}
</code></pre>
<h3 data-id="heading-5">4. 配置RabbitMQ</h3>
<h4 data-id="heading-6"><code>RabbitMQConfig.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.Queue;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">"orderQueue"</span>, <span class="hljs-literal">true</span>);
    }
}
</code></pre>
<h3 data-id="heading-7">5. 创建事件和事件处理器</h3>
<h4 data-id="heading-8"><code>OrderCreatedEvent.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreatedEvent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
    <span class="hljs-keyword">private</span> Long orderId;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getOrderId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderId;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrderId</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-built_in">this</span>.orderId = orderId;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProduct</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProduct</span><span class="hljs-params">(String product)</span> {
        <span class="hljs-built_in">this</span>.product = product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getQuantity</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setQuantity</span><span class="hljs-params">(<span class="hljs-type">int</span> quantity)</span> {
        <span class="hljs-built_in">this</span>.quantity = quantity;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> price;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-built_in">this</span>.price = price;
    }
}
</code></pre>
<h4 data-id="heading-9"><code>OrderEventListener.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventListener</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderEventListener</span><span class="hljs-params">(OrderRepository orderRepository)</span> {
        <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
    }

    <span class="hljs-meta">@RabbitListener(queues = "orderQueue")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCreatedEvent</span><span class="hljs-params">(OrderCreatedEvent event)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setId(event.getOrderId());
        order.setProduct(event.getProduct());
        order.setQuantity(event.getQuantity());
        order.setPrice(event.getPrice());
        orderRepository.save(order);
    }
}
</code></pre>
<h3 data-id="heading-10">6. 发布事件</h3>
<h4 data-id="heading-11"><code>OrderService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(RabbitTemplate rabbitTemplate, OrderRepository orderRepository)</span> {
        <span class="hljs-built_in">this</span>.rabbitTemplate = rabbitTemplate;
        <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">savedOrder</span> <span class="hljs-operator">=</span> orderRepository.save(order);

        <span class="hljs-comment">// Publish event</span>
        <span class="hljs-type">OrderCreatedEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCreatedEvent</span>();
        event.setOrderId(savedOrder.getId());
        event.setProduct(savedOrder.getProduct());
        event.setQuantity(savedOrder.getQuantity());
        event.setPrice(savedOrder.getPrice());
        rabbitTemplate.convertAndSend(<span class="hljs-string">"orderQueue"</span>, event);

        <span class="hljs-keyword">return</span> savedOrder;
    }
}
</code></pre>
<h3 data-id="heading-12">7. 创建控制器</h3>
<h4 data-id="heading-13"><code>OrderController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">createdOrder</span> <span class="hljs-operator">=</span> orderService.createOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdOrder);
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrderById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(order);
    }

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Order&gt;&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        List&lt;Order&gt; orders = orderService.getAllOrders();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(orders);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> Order order)</span> {
        order.setId(id); <span class="hljs-comment">// Ensure the order ID is set correctly</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderService.updateOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedOrder);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        orderService.deleteOrder(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }
}
</code></pre>
<h3 data-id="heading-14">8. 运行应用</h3>
<ol>
<li><strong>启动RabbitMQ</strong>：确保你的RabbitMQ服务器运行在<code>localhost:5672</code>。</li>
<li><strong>启动Spring Boot应用</strong>：运行Spring Boot应用程序。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:run
</code></pre>
<h3 data-id="heading-15">9. 访问API</h3>
<p>通过以下API访问<code>Order</code>数据：</p>
<ul>
<li><code>POST /orders</code>：创建Order。</li>
<li><code>GET /orders/{id}</code>：按ID获取Order。</li>
<li><code>GET /orders</code>：获取所有Orders。</li>
<li><code>PUT /orders/{id}</code>：更新Order。</li>
<li><code>DELETE /orders/{id}</code>：删除Order。</li>
</ul>
<h3 data-id="heading-16">总结</h3>
<p>通过上述步骤，我们展示了如何在事件驱动架构中使用Hibernate，包括配置Hibernate和数据源、定义实体和DAO层、配置RabbitMQ、创建事件和事件处理器、发布和处理事件，以及使用控制器访问API。在事件驱动架构中，事件触发器和事件处理器之间的松散耦合可以提高系统的可扩展性和灵活性，同时通过使用Hibernate确保数据持久性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（74）如何在CQRS架构中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7600787795477872686</link>    <guid>https://juejin.cn/post/7600787795477872686</guid>    <pubDate>2026-01-30T11:50:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795477872686" data-draft-id="7600990891206983707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（74）如何在CQRS架构中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T11:50:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（74）如何在CQRS架构中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T11:50:55.000Z" title="Fri Jan 30 2026 11:50:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在CQRS（Command Query Responsibility Segregation）架构中，读操作（Query）和写操作（Command）被分离到不同的模型中。这样可以优化读取和写入的性能，并且允许使用不同的存储技术来实现读取和写入模型。Hibernate通常用于处理写操作，因为它擅长处理复杂的交易和关系数据。</p>
<p>下面我们将展示如何在Spring Boot项目中结合Hibernate实现CQRS架构。</p>
<h3 data-id="heading-0">1. 项目依赖</h3>
<p>在<code>pom.xml</code>中添加必要的依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Boot Starter Web --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data MongoDB (for Query Model) --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. 配置数据源和Hibernate属性</h3>
<p>在<code>application.properties</code>中配置MySQL和MongoDB数据源：</p>
<pre><code class="hljs language-properties" lang="properties"># MySQL Database Configuration (Command Model)
spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# MongoDB Configuration (Query Model)
spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=myquerydatabase
</code></pre>
<h3 data-id="heading-2">3. 定义写模型（Command Model）</h3>
<h4 data-id="heading-3"><code>Order.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;
}
</code></pre>
<h4 data-id="heading-4"><code>OrderRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
}
</code></pre>
<h3 data-id="heading-5">4. 定义读模型（Query Model）</h3>
<h4 data-id="heading-6"><code>OrderView.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Document(collection = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderView</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;
}
</code></pre>
<h4 data-id="heading-7"><code>OrderViewRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderViewRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MongoRepository</span>&lt;OrderView, String&gt; {
}
</code></pre>
<h3 data-id="heading-8">5. 创建服务层</h3>
<h4 data-id="heading-9">写操作服务（Command Service）</h4>
<h5 data-id="heading-10"><code>OrderCommandService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCommandService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderRepository orderRepository;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">return</span> orderRepository.save(order);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">return</span> orderRepository.save(order);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(Long id)</span> {
        orderRepository.deleteById(id);
    }
}
</code></pre>
<h4 data-id="heading-11">读操作服务（Query Service）</h4>
<h5 data-id="heading-12"><code>OrderQueryService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueryService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderViewRepository orderViewRepository;

    <span class="hljs-keyword">public</span> List&lt;OrderView&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderViewRepository.findAll();
    }

    <span class="hljs-keyword">public</span> Optional&lt;OrderView&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-keyword">return</span> orderViewRepository.findById(id);
    }
}
</code></pre>
<h3 data-id="heading-13">6. 创建事件和事件处理器</h3>
<h4 data-id="heading-14"><code>OrderCreatedEvent.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreatedEvent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> Long orderId;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;
}
</code></pre>
<h4 data-id="heading-15"><code>OrderUpdatedEvent.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderUpdatedEvent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> Long orderId;
    <span class="hljs-keyword">private</span> String product;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> quantity;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> price;
}
</code></pre>
<h4 data-id="heading-16"><code>OrderDeletedEvent.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDeletedEvent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> Long orderId;
}
</code></pre>
<h3 data-id="heading-17">7. 事件发布器和处理器</h3>
<h4 data-id="heading-18">事件发布器</h4>
<h5 data-id="heading-19"><code>EventPublisher.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.ApplicationEventPublisher;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventPublisher</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ApplicationEventPublisher applicationEventPublisher;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EventPublisher</span><span class="hljs-params">(ApplicationEventPublisher applicationEventPublisher)</span> {
        <span class="hljs-built_in">this</span>.applicationEventPublisher = applicationEventPublisher;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(Object event)</span> {
        applicationEventPublisher.publishEvent(event);
    }
}
</code></pre>
<h4 data-id="heading-20">事件处理器</h4>
<h5 data-id="heading-21"><code>OrderEventListener.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.context.event.EventListener;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventListener</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderViewRepository orderViewRepository;

    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCreatedEvent</span><span class="hljs-params">(OrderCreatedEvent event)</span> {
        <span class="hljs-type">OrderView</span> <span class="hljs-variable">orderView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderView</span>();
        orderView.setId(event.getOrderId().toString());
        orderView.setProduct(event.getProduct());
        orderView.setQuantity(event.getQuantity());
        orderView.setPrice(event.getPrice());
        orderViewRepository.save(orderView);
    }

    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderUpdatedEvent</span><span class="hljs-params">(OrderUpdatedEvent event)</span> {
        <span class="hljs-type">OrderView</span> <span class="hljs-variable">orderView</span> <span class="hljs-operator">=</span> orderViewRepository.findById(event.getOrderId().toString()).orElse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderView</span>());
        orderView.setProduct(event.getProduct());
        orderView.setQuantity(event.getQuantity());
        orderView.setPrice(event.getPrice());
        orderViewRepository.save(orderView);
    }

    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderDeletedEvent</span><span class="hljs-params">(OrderDeletedEvent event)</span> {
        orderViewRepository.deleteById(event.getOrderId().toString());
    }
}
</code></pre>
<h3 data-id="heading-22">8. 修改服务层发布事件</h3>
<h4 data-id="heading-23">修改写操作服务（Command Service）</h4>
<h5 data-id="heading-24"><code>OrderCommandService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCommandService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderRepository orderRepository;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> EventPublisher eventPublisher;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">savedOrder</span> <span class="hljs-operator">=</span> orderRepository.save(order);
        <span class="hljs-type">OrderCreatedEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCreatedEvent</span>();
        event.setOrderId(savedOrder.getId());
        event.setProduct(savedOrder.getProduct());
        event.setQuantity(savedOrder.getQuantity());
        event.setPrice(savedOrder.getPrice());
        eventPublisher.publish(event);
        <span class="hljs-keyword">return</span> savedOrder;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderRepository.save(order);
        <span class="hljs-type">OrderUpdatedEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderUpdatedEvent</span>();
        event.setOrderId(updatedOrder.getId());
        event.setProduct(updatedOrder.getProduct());
        event.setQuantity(updatedOrder.getQuantity());
        event.setPrice(updatedOrder.getPrice());
        eventPublisher.publish(event);
        <span class="hljs-keyword">return</span> updatedOrder;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(Long id)</span> {
        orderRepository.deleteById(id);
        <span class="hljs-type">OrderDeletedEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDeletedEvent</span>();
        event.setOrderId(id);
        eventPublisher.publish(event);
    }
}
</code></pre>
<h3 data-id="heading-25">9. 创建控制器</h3>
<h4 data-id="heading-26">写操作控制器（Command Controller）</h4>
<h5 data-id="heading-27"><code>OrderCommandController.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCommandController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderCommandService orderCommandService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Order order)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">createdOrder</span> <span class="hljs-operator">=</span> orderCommandService.createOrder(order);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdOrder);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Order&gt; <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> Order order)</span> {
        order.setId(id); <span class="hljs-comment">// Ensure the order ID is set correctly</span>
        
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《打造高效的前端工程师终端：一份可复制的 Zsh + Powerlevel10k 配置实践》]]></title>    <link>https://juejin.cn/post/7600990891206672411</link>    <guid>https://juejin.cn/post/7600990891206672411</guid>    <pubDate>2026-01-30T09:21:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891206672411" data-draft-id="7600967006892982281" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《打造高效的前端工程师终端：一份可复制的 Zsh + Powerlevel10k 配置实践》"/> <meta itemprop="keywords" content="前端工程化"/> <meta itemprop="datePublished" content="2026-01-30T09:21:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WaitingChen"/> <meta itemprop="url" content="https://juejin.cn/user/1900414998429544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《打造高效的前端工程师终端：一份可复制的 Zsh + Powerlevel10k 配置实践》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1900414998429544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WaitingChen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:21:40.000Z" title="Fri Jan 30 2026 09:21:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>目标很简单：<strong>快、稳、爽</strong>。</p>
<p>快：打开终端不拖泥带水；
稳：补全、历史、插件不互相打架；
爽：<code>git commit</code> 这种高频命令，肌肉记忆级体验。</p>
</blockquote>
<p>这篇文章基于一份<strong>可直接使用的 <code>.zshrc</code> 配置</strong>，完整讲清楚每一段配置解决了什么问题、为什么要这样放、以及它带来的实际体验提升。</p>
<h2 data-id="heading-0">一、为什么要“认真配置”终端？</h2>
<p>对于前端工程师来说，终端并不是偶尔用一下的工具，而是：</p>
<ul>
<li>高频 Git 操作（<code>git commit / rebase / checkout</code>）</li>
<li>包管理（<code>pnpm / npm / yarn</code>）</li>
<li>本地调试、构建、脚手架</li>
</ul>
<p>如果终端具备下面这些能力：</p>
<ul>
<li><strong>↑ / ↓ 只在“相关历史”里循环</strong></li>
<li><strong>自动联想但不抢键</strong></li>
<li><strong>补全稳定、无卡顿</strong></li>
</ul>
<p>每天节省的不是几秒，而是<strong>注意力和心智负担</strong>。</p>
<h2 data-id="heading-1">二、整体结构设计原则</h2>
<p>这份配置遵循几个明确的原则：</p>
<ol>
<li><strong>启动相关的配置尽量靠前</strong>（避免闪屏、卡顿）</li>
<li><strong>功能性模块分区清晰</strong>（补全、历史、联想、高亮各司其职）</li>
<li><strong>顺序严格</strong>（这是很多问题的根源）</li>
</ol>
<p>下面按模块逐一拆解。</p>
<h2 data-id="heading-2">三、Powerlevel10k Instant Prompt：启动速度的关键</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-keyword">if</span> [[ -r <span class="hljs-string">"<span class="hljs-variable">${XDG_CACHE_HOME:-<span class="hljs-variable">$HOME</span>/.cache}</span>/p10k-instant-prompt-<span class="hljs-variable">${(%):-%n}</span>.zsh"</span> ]]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">source</span> <span class="hljs-string">"<span class="hljs-variable">${XDG_CACHE_HOME:-<span class="hljs-variable">$HOME</span>/.cache}</span>/p10k-instant-prompt-<span class="hljs-variable">${(%):-%n}</span>.zsh"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p>这是 Powerlevel10k 官方推荐的 <strong>Instant Prompt</strong> 写法，作用是：</p>
<ul>
<li>在 Zsh 完全初始化之前，<strong>先渲染 Prompt</strong></li>
<li>避免终端启动时的“白屏等待”</li>
</ul>
<h2 data-id="heading-3">四、NVM 与主题加载：稳定优先</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm"</span>
[ -s <span class="hljs-string">"/opt/homebrew/opt/nvm/nvm.sh"</span> ] &amp;&amp; . <span class="hljs-string">"/opt/homebrew/opt/nvm/nvm.sh"</span>

<span class="hljs-built_in">source</span> /opt/homebrew/share/powerlevel10k/powerlevel10k.zsh-theme
[[ -f ~/.p10k.zsh ]] &amp;&amp; <span class="hljs-built_in">source</span> ~/.p10k.zsh
</code></pre>
<p>这里选择的是<strong>最稳妥、最不容易出坑</strong>的方式：</p>
<ul>
<li>不做过度魔改</li>
<li>不提前优化启动时间</li>
</ul>
<p>如果后续需要追求极致启动速度，再对 NVM 做 lazy load 即可。</p>
<h2 data-id="heading-4">五、PATH 管理：去重是隐藏的工程师细节</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 示例：将自定义工具加入 PATH（请按需修改或删除）</span>
<span class="hljs-comment"># export PATH="$HOME/.comate/bin:$PATH"</span>

<span class="hljs-built_in">typeset</span> -U PATH path
</code></pre>
<p><code>typeset -U PATH path</code> 的作用是：</p>
<ul>
<li>自动去重 PATH</li>
<li><strong>保留第一次出现的顺序</strong></li>
</ul>
<p>这能避免：</p>
<ul>
<li>PATH 无限增长</li>
<li>同一个二进制被多次扫描</li>
</ul>
<p>属于“看不见，但很专业”的配置。</p>
<h2 data-id="heading-5">六、补全系统：一切体验的地基</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">autoload</span> -Uz compinit
compinit -d ~/.zcompdump
</code></pre>
<p>补全系统是很多插件的基础（包括自动联想）。</p>
<p>显式指定 <code>.zcompdump</code> 文件可以：</p>
<ul>
<li>避免偶发的补全重建</li>
<li>提高稳定性</li>
</ul>
<p><strong>顺序要求</strong>：</p>
<blockquote>
<p><code>compinit</code> 必须在 autosuggestions 之前。</p>
</blockquote>
<h2 data-id="heading-6">七、历史行为优化：让“↑”变聪明</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">setopt</span> HIST_IGNORE_ALL_DUPS
<span class="hljs-built_in">setopt</span> HIST_REDUCE_BLANKS
<span class="hljs-built_in">setopt</span> INC_APPEND_HISTORY
<span class="hljs-built_in">setopt</span> SHARE_HISTORY
</code></pre>
<p>这些选项共同解决了几个痛点：</p>
<ul>
<li>同一条命令不会无限刷历史</li>
<li>多余空格不会影响匹配</li>
<li>多个终端窗口共享历史</li>
</ul>
<p>结果是：</p>
<blockquote>
<p>历史记录更干净，搜索更精准。</p>
</blockquote>
<h2 data-id="heading-7">八、↑ / ↓ 前缀历史搜索（核心体验）</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">bindkey</span> -M emacs <span class="hljs-string">'^[[A'</span> history-beginning-search-backward
<span class="hljs-built_in">bindkey</span> -M emacs <span class="hljs-string">'^[[B'</span> history-beginning-search-forward
</code></pre>
<p>这是整份配置的<strong>灵魂部分</strong>。</p>
<h3 data-id="heading-8">行为对比</h3>
<p>历史中有：</p>
<pre><code class="hljs language-sh" lang="sh">git commit -m <span class="hljs-string">"init"</span>
git commit --amend
git checkout main
pnpm install
</code></pre>
<p>当你输入：</p>
<pre><code class="hljs language-sh" lang="sh">git commit
</code></pre>
<p>按 ↑ / ↓：</p>
<ul>
<li>✅ 只会出现 <code>git commit ...</code></li>
<li>❌ 不会混入 <code>checkout / pnpm</code></li>
</ul>
<p>这是<strong>严格的前缀匹配</strong>，非常适合 Git 这类命令族。</p>
<h2 data-id="heading-9">九、自动联想：辅助而不是干扰</h2>
<pre><code class="hljs language-sh" lang="sh">ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=<span class="hljs-string">'fg=8'</span>
<span class="hljs-built_in">source</span> /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
</code></pre>
<ul>
<li>灰色提示足够克制</li>
<li>只做“提示”，不抢控制权</li>
</ul>
<p>并且通过 <code>-M emacs</code> 的 bindkey 写法，确保它不会和 ↑ / ↓ 行为冲突。</p>
<h2 data-id="heading-10">十、语法高亮：为什么必须放最后？</h2>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-built_in">source</span> /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
</code></pre>
<p>这是官方和社区反复强调的一点：</p>
<blockquote>
<p><code>zsh-syntax-highlighting</code> <strong>必须是最后加载的插件</strong>。</p>
</blockquote>
<p>否则会出现：</p>
<ul>
<li>高亮失效</li>
<li>与其他插件冲突</li>
</ul>
<h2 data-id="heading-11">十一、最终配置（可直接使用）</h2>
<p>下面是一份<strong>完整、可直接复制使用的 <code>.zshrc</code> 最终配置</strong>。</p>
<blockquote>
<p>说明：</p>
<ul>
<li>已包含 Powerlevel10k Instant Prompt</li>
<li>支持 <code>git commit</code> 等命令的 <strong>↑ / ↓ 严格前缀历史搜索</strong></li>
<li>自动联想、高亮、补全顺序全部正确</li>
<li>适合长期作为主力终端配置使用</li>
</ul>
</blockquote>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">########################################</span>
<span class="hljs-comment"># Powerlevel10k instant prompt（必须靠前）</span>
<span class="hljs-comment">########################################</span>
<span class="hljs-keyword">if</span> [[ -r <span class="hljs-string">"<span class="hljs-variable">${XDG_CACHE_HOME:-<span class="hljs-variable">$HOME</span>/.cache}</span>/p10k-instant-prompt-<span class="hljs-variable">${(%):-%n}</span>.zsh"</span> ]]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">source</span> <span class="hljs-string">"<span class="hljs-variable">${XDG_CACHE_HOME:-<span class="hljs-variable">$HOME</span>/.cache}</span>/p10k-instant-prompt-<span class="hljs-variable">${(%):-%n}</span>.zsh"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">########################################</span>
<span class="hljs-comment"># 基础环境</span>
<span class="hljs-comment">########################################</span>
<span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm"</span>
[ -s <span class="hljs-string">"/opt/homebrew/opt/nvm/nvm.sh"</span> ] &amp;&amp; . <span class="hljs-string">"/opt/homebrew/opt/nvm/nvm.sh"</span>

<span class="hljs-comment"># Powerlevel10k 主题</span>
<span class="hljs-built_in">source</span> /opt/homebrew/share/powerlevel10k/powerlevel10k.zsh-theme
[[ -f ~/.p10k.zsh ]] &amp;&amp; <span class="hljs-built_in">source</span> ~/.p10k.zsh

<span class="hljs-comment"># PATH 去重</span>
<span class="hljs-built_in">typeset</span> -U PATH path

<span class="hljs-comment">########################################</span>
<span class="hljs-comment"># Zsh 补全系统</span>
<span class="hljs-comment">########################################</span>
<span class="hljs-built_in">autoload</span> -Uz compinit
compinit -d ~/.zcompdump

<span class="hljs-comment">########################################</span>
<span class="hljs-comment"># 历史行为优化</span>
<span class="hljs-comment">########################################</span>
<span class="hljs-built_in">setopt</span> HIST_IGNORE_ALL_DUPS
<span class="hljs-built_in">setopt</span> HIST_REDUCE_BLANKS
<span class="hljs-built_in">setopt</span> INC_APPEND_HISTORY
<span class="hljs-built_in">setopt</span> SHARE_HISTORY

<span class="hljs-comment">########################################</span>
<span class="hljs-comment"># 自动联想（灰色提示）</span>
<span class="hljs-comment">########################################</span>
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=<span class="hljs-string">'fg=8'</span>
<span class="hljs-built_in">source</span> /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh

<span class="hljs-comment">########################################</span>
<span class="hljs-comment"># ↑ / ↓ 前缀历史搜索（git commit 友好）</span>
<span class="hljs-comment">########################################</span>
<span class="hljs-built_in">bindkey</span> -M emacs <span class="hljs-string">'^[[A'</span> history-beginning-search-backward
<span class="hljs-built_in">bindkey</span> -M emacs <span class="hljs-string">'^[[B'</span> history-beginning-search-forward

<span class="hljs-comment">########################################</span>
<span class="hljs-comment"># 语法高亮（必须放最后）</span>
<span class="hljs-comment">########################################</span>
<span class="hljs-built_in">source</span> /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
</code></pre>
<h2 data-id="heading-12">十二、最终效果总结</h2>
<p>使用这份配置，你会得到：</p>
<ul>
<li><strong>启动快、不闪屏</strong>（Powerlevel10k Instant Prompt）</li>
<li><strong>补全稳定</strong>（compinit 顺序正确）</li>
<li><strong>历史搜索精准</strong>（前缀匹配）</li>
<li><strong>自动联想不干扰操作</strong></li>
</ul>
<p>这不是“炫技型配置”，而是：</p>
<blockquote>
<p><strong>适合长期使用的工程师终端基建。</strong></p>
</blockquote>
<h2 data-id="heading-13">结语</h2>
<p>终端配置的价值，不在于你用了多少插件，而在于：</p>
<ul>
<li>是否减少了无意义的操作</li>
<li>是否让高频行为变成肌肉记忆</li>
</ul>
<p>如果你每天要敲几十次 <code>git commit</code>，
那么让 ↑ 键“只做正确的事”，本身就已经非常值得了。</p>
<blockquote>
<p>后续可以继续进阶的方向：</p>
<ul>
<li>NVM lazy load（秒开终端）</li>
<li>Git / pnpm 专用快捷键</li>
<li>ZLE Widget 深度定制</li>
</ul>
</blockquote>
<p>这些，都可以在这份配置之上自然演进。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React-Scheduler 调度器如何掌控主线程？]]></title>    <link>https://juejin.cn/post/7600787795477364782</link>    <guid>https://juejin.cn/post/7600787795477364782</guid>    <pubDate>2026-01-30T09:21:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795477364782" data-draft-id="7600990891206475803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React-Scheduler 调度器如何掌控主线程？"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2026-01-30T09:21:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React-Scheduler 调度器如何掌控主线程？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:21:35.000Z" title="Fri Jan 30 2026 09:21:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在 React 18 的并发时代，<code>Scheduler（调度器）</code> 是实现非阻塞渲染的幕后英雄。它不只是 React 的一个模块，更是一个通用的、高性能的 JavaScript 任务调度库。它不仅让 React 任务可以“插队”，还让“长任务”不再阻塞浏览器 UI 渲染。</p>
<h2 data-id="heading-1">一、 核心概念：什么是 Scheduler？</h2>
<p>Scheduler 是一个独立的包，它通过与 React 协调过程（Reconciliation）的紧密配合，实现了任务的<strong>可中断、可恢复、带优先级</strong>执行。</p>
<h3 data-id="heading-2">主要职责</h3>
<ol>
<li><strong>优先级管理</strong>：根据任务紧急程度（如用户点击 vs 数据预取）安排执行顺序。</li>
<li><strong>空闲时间利用</strong>：在浏览器每一帧的空闲时间处理不紧急的任务。</li>
<li><strong>防止主线程阻塞</strong>：通过“时间片（Time Slicing）”机制，避免长任务导致页面假死。</li>
</ol>
<hr/>
<h2 data-id="heading-3">二、 Scheduler 的完整调度链路</h2>
<p>当一个 <code>setState</code> 触发后，Scheduler 内部会经历以下精密流程：</p>
<h3 data-id="heading-4">1. 任务创建与通知</h3>
<p>当状态更新时，React 不会立即执行 Render。它首先会创建一个 <code>Update</code>对象来记录这次变更，这个对象中包含这次更新所需的全部信息，例如更新后的状态值，<code>Lane</code>车道模型分配的任务优先级.</p>
<h3 data-id="heading-5">2. 优先级排序与队列维护</h3>
<ul>
<li>
<p><strong>任务优先级排序</strong>： 创建更新后，react会调用<code>scheduleUpdateOnFiber</code>函数通知<code>scheduler</code>调度器有个一个新的任务需要调度，这时<code>scheduler</code>会对该任务确定一个优先级，以及过期时间（优先级越高，过期时间越短，表示越紧急）</p>
</li>
<li>
<p><strong>队列维护</strong>： 接着<code>scheduler</code>会将该任务放入到循环调度中，<code>scheduler</code>对于任务循环调度在内部维护着两个队列，一个是立即执行队列<code>taskQueue</code>和延迟任务队列<code>timeQueue</code>，新任务会根据优先级进入到相应对列</p>
<ul>
<li><strong><code>timerQueue</code>（延时任务队列）</strong> ：存放还未到开始时间的任务，按开始时间排序。</li>
<li><strong><code>taskQueue</code>（立即任务队列）</strong> ：存放已经就绪的任务，按<strong>过期时间</strong>排序。优先级越高，过期时间越短。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">3. 时间片的开启：MessageChannel</h3>
<p>将任务放入队列后，<code>scheduler</code>会调用<code>requetHostCallback</code>函数去请求浏览器在合适的时机去执行调度，该函数通过 <code>MessageChannel</code>对象中的<code>port.postMessage</code> 方法创建一个宏任务，浏览器在下一个宏任务时机触发 <code>port.onmessage</code>，并在这宏任务回调中启动 <code>workLoop</code>函数。</p>
<blockquote>
<p>补充：Scheduler 会调用 <code>requestHostCallback</code> 请求浏览器调度。它没有选择 <code>setTimeout</code>，而是选择了 <strong><code>MessageChannel</code></strong>。</p>
</blockquote>
<blockquote>
<p><strong>为什么选 MessageChannel？</strong> <code>setTimeout(fn, 0)</code> 在浏览器中通常有 4ms 的最小延迟，且属于宏任务中执行时机较晚的。<code>MessageChannel</code> 的 <code>port.postMessage</code> 产生的宏任务执行时机更早，且能更精准地在浏览器渲染帧之间切入。</p>
</blockquote>
<h3 data-id="heading-7">4. 工作循环：workLoop</h3>
<ul>
<li>
<p>在宏任务回调中，调度器会进入 <code>workLoop</code>。它会调用<code>performUnitOfWor</code>k函数循环地处理Fiber节点，对比新旧节点的<code>props、state</code>，并从队列中取出最紧急的任务交给 React 执行。</p>
</li>
<li>
<p><code>workLopp</code>中会包含一个<code>shouldYield</code>函数中断检查函数，用于检查当前时间片是否耗尽以及是否有更高优先级的任务执行，如果有的话则会将主线程控制权交还给浏览器，以保证高优先级任务（如用户输入、动画）能及时响应。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-8">5. 中断与恢复：shouldYield 的魔力</h3>
<p>在 <code>workLoop</code> 执行过程中，每一项单元工作完成后，都会调用 <strong><code>shouldYield()</code></strong> 函数进行“路况检查”。</p>
<ul>
<li><strong>中断条件</strong>：如果当前时间片（通常为 <strong>5ms</strong>）耗尽，或者检测到有更紧急的用户交互（高优任务插队），<code>shouldYield</code> 返回 <code>true</code>。</li>
<li><strong>状态保存</strong>：此时 React 会记录当前 <code>workInProgress</code> 树的位置，将控制权交还给浏览器。</li>
<li><strong>任务恢复</strong>：Scheduler 会在下一个时间片通过 <code>MessageChannel</code> 再次触发，从记录的位置继续执行，从而实现可恢复。</li>
</ul>
<h3 data-id="heading-9">6. 任务插队</h3>
<p>如果在执行一个低优先级任务时，有高优先级任务加入（如用户突然点击按钮），<code>Scheduler</code>会中断当前的低优任务并记录该位置，先执行高优任务。等高优任务完成后，再重新执行或继续之前的低优任务</p>
<hr/>
<h2 data-id="heading-10">三、 补充</h2>
<ol>
<li><strong>执行时机对比</strong>：<code>MessageChannel</code> 确实在宏任务中非常快，但在某些极其特殊的情况下（如没有 <code>MessageChannel</code> 的旧环境），它会回退到 <code>setTimeout</code>。</li>
<li><strong>饥饿现象防止</strong>：如果一个低优先级任务一直被插队怎么办？Scheduler 通过<strong>过期时间</strong>解决。一旦任务过期，它会从 <code>taskQueue</code> 中被提升为同步任务，强制执行。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个Vite插件实现PC到移动端项目的高效迁移方案]]></title>    <link>https://juejin.cn/post/7600868443832254483</link>    <guid>https://juejin.cn/post/7600868443832254483</guid>    <pubDate>2026-01-30T09:24:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600868443832254483" data-draft-id="7600967006892752905" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个Vite插件实现PC到移动端项目的高效迁移方案"/> <meta itemprop="keywords" content="前端,JavaScript,Vite"/> <meta itemprop="datePublished" content="2026-01-30T09:24:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浮幻云月"/> <meta itemprop="url" content="https://juejin.cn/user/1019992474918343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个Vite插件实现PC到移动端项目的高效迁移方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1019992474918343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浮幻云月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:24:34.000Z" title="Fri Jan 30 2026 09:24:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当PC端项目需要迁移到移动端时，你是否还在手动复制粘贴代码？今天分享一个我们团队自研的Vite插件，帮你实现跨仓库、跨技术栈的代码高效复用！</p>
<h2 data-id="heading-0">背景：从PC到移动端的迁移之痛</h2>
<p>最近我们团队遇到了一个典型的企业级需求：<strong>将一个成熟的PC端医疗管理系统（MDM）迁移到移动端</strong>。听起来简单，但实际上却面临诸多挑战：</p>
<h3 data-id="heading-1">面临的挑战</h3>
<ol>
<li><strong>技术栈差异</strong>：PC端使用Element Plus，移动端需要Vant</li>
<li><strong>仓库隔离</strong>：PC端和移动端在不同的Git仓库</li>
<li><strong>代码复用</strong>：希望复用80%的业务逻辑，但UI组件完全不同</li>
<li><strong>维护同步</strong>：业务逻辑更新需要在两端同步</li>
</ol>
<p>传统的解决方案要么是<strong>完全重写</strong>（成本高），要么是<strong>复制粘贴</strong>（维护噩梦）,或者是<strong>Monorepo</strong> (代码和依赖放一起)。我们需要的是一种既能复用核心逻辑，代码在不同仓库维护，又能灵活定制UI的解决方案。</p>
<h2 data-id="heading-2">解决方案：vite-plugin-code-reuse</h2>
<p>基于这个需求，我们开发了 <code>vite-plugin-code-reuse</code> 插件，它的核心思想是：<strong>多仓库代码复用、智能替换、无缝集成</strong>。</p>
<h3 data-id="heading-3">插件核心能力</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 插件的核心配置结构</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">PluginConfig</span> {
  <span class="hljs-attr">repositories</span>: <span class="hljs-title class_">RepositoryConfig</span>[];     <span class="hljs-comment">// 代码仓库配置</span>
  <span class="hljs-attr">repoImportMappings</span>: <span class="hljs-title class_">RepoImportMappings</span>[]; <span class="hljs-comment">// 路径映射，主要是规避不同仓库路径别名冲突问题</span>
  <span class="hljs-attr">importReplacements</span>: <span class="hljs-title class_">ImportReplacementConfig</span>[]; <span class="hljs-comment">// 导入替换</span>
}
</code></pre>
<h2 data-id="heading-4">实战案例：医疗管理系统迁移</h2>
<p>让我通过实际案例展示这个插件的效果。</p>
<h3 data-id="heading-5">项目背景</h3>
<ul>
<li><strong>PC端项目</strong>：<code>xlian-web-mdm</code>（Vue 3 + Element Plus + TypeScript）</li>
<li><strong>移动端项目</strong>：新建的H5项目（Vue 3 + Vant + TypeScript）</li>
<li><strong>目标</strong>：复用PC端80%的业务逻辑，100%替换UI组件</li>
</ul>
<h3 data-id="heading-6">第一步：安装配置插件</h3>
<pre><code class="hljs language-bash" lang="bash">npm install vite-plugin-code-reuse --save-dev
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> codeReusePlugin <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-code-reuse'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title function_">codeReusePlugin</span>({
      <span class="hljs-comment">// 1. 引入PC端代码仓库</span>
      <span class="hljs-attr">repositories</span>: [
        {
          <span class="hljs-attr">url</span>: <span class="hljs-string">'http://gitlab.xinglianhealth.com/web/mdm/xlian-web-mdm.git'</span>,
          <span class="hljs-attr">branch</span>: <span class="hljs-string">'master'</span>,
          <span class="hljs-attr">dir</span>: <span class="hljs-string">'mdm-pc'</span>  <span class="hljs-comment">// 本地存放目录</span>
        }
      ],
      
      <span class="hljs-comment">// 2. 修正路径别名映射,pc和移动都配置了“@”别名，需要各自引用正确的路径</span>
      <span class="hljs-attr">repoImportMappings</span>: [
        {
          <span class="hljs-attr">alias</span>: <span class="hljs-string">'@'</span>,
          <span class="hljs-attr">repoDir</span>: <span class="hljs-string">'mdm-pc'</span>,
          <span class="hljs-comment">// PC端中的“@”别名还是引用pc端目录下的代码，但是需要排除路由、状态管理等路径，引用移动端的，因为路由和store不能存在两个</span>
          <span class="hljs-attr">ignorePatterns</span>: [<span class="hljs-string">'src/router'</span>, <span class="hljs-string">'src/store'</span>, <span class="hljs-string">'src/axios'</span>]
        }
      ],
      
      <span class="hljs-comment">// 3. 智能导入替换，pc端的部分组件无法复用时，可以做替换</span>
      <span class="hljs-attr">importReplacements</span>: [
        <span class="hljs-comment">// 场景1：组件替换（Element Plus → Vant）</span>
        {
          <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/\/views\/MasterData\/components\/UploadFile\.vue$/</span>,
          <span class="hljs-attr">file</span>: <span class="hljs-string">'src/components/MbUpload.vue'</span> <span class="hljs-comment">// 移动端专用上传组件</span>
        },
        {
          <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/\/views\/MasterData\/components\/TextInput\.vue$/</span>,
          <span class="hljs-attr">file</span>: <span class="hljs-string">'src/components/MbTextInput.vue'</span> <span class="hljs-comment">// 移动端输入框</span>
        },
        
        <span class="hljs-comment">// 场景2：复杂表单组件替换</span>
        {
          <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/\/views\/MasterData\/components\/MasterForm\.vue$/</span>,
          <span class="hljs-attr">file</span>: <span class="hljs-string">'src/components/MbForm.vue'</span> <span class="hljs-comment">// 移动端表单封装</span>
        },
        
        <span class="hljs-comment">// 场景3：PC端特有功能在移动端隐藏</span>
        {
          <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/\/views\/MasterData\/components\/HeaderFilter\/HeaderFilter\.vue$/</span>,
          <span class="hljs-attr">code</span>: <span class="hljs-string">'&lt;template&gt;&lt;/template&gt;'</span> <span class="hljs-comment">// 移动端不需要复杂的表头筛选</span>
        },
        
        <span class="hljs-comment">// 场景4：UI库替换</span>
        {
          <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/^@?element-plus/</span>,
          <span class="hljs-attr">resolve</span>: path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'src/components/ElementPlus.ts'</span>) <span class="hljs-comment">// 重定向到兼容层</span>
        }
      ]
    })
  ]
})
</code></pre>
<h3 data-id="heading-7">第二步：UI组件替换</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/components/ElementPlus.ts - UI库兼容层</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Select</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ui-adaptor'</span>

<span class="hljs-comment">// 创建Element Plus到Vant的映射</span>
<span class="hljs-keyword">export</span> {
  <span class="hljs-title class_">ElButton</span>: <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">ElInput</span>: <span class="hljs-title class_">Input</span>,
  <span class="hljs-title class_">ElSelect</span>: <span class="hljs-title class_">Select</span>,
  <span class="hljs-comment">// ... 更多映射</span>
}

<span class="hljs-comment">// src/components/ui-adaptor.ts - UI库适配层,以Button组件为例</span>

&lt;template&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">van-button</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span> /&gt;</span></span>&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
<span class="hljs-comment">// 对element-plus Button Props做适配，比如size不支持"medium"，可以处理成其他的,相同的属性不用处理</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-8">第三步：复用业务逻辑组件</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/views/MasterData/PatientList.vue --&gt;
&lt;template&gt;
  &lt;!-- 复用PC端的模板结构，但使用移动端组件 --&gt;
  &lt;div class="patient-list"&gt;
    &lt;!-- 搜索框（PC端是ElInput，自动替换为Vant Field） --&gt;
    &lt;van-field 
      v-model="searchKey"
      placeholder="搜索患者"
      @input="handleSearch"
    /&gt;
    
    &lt;!-- 患者列表 --&gt;
    &lt;van-list 
      v-model:loading="loading"
      :finished="finished"
      @load="loadPatients"
    &gt;
      &lt;patient-item 
        v-for="patient in patients"
        :key="patient.id"
        :patient="patient"
        @click="handlePatientClick"
      /&gt;
    &lt;/van-list&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
// 这里直接复用PC端的业务逻辑！
import { usePatientList } from '@/mdm-pc/src/views/MasterData/composables/usePatientList'

// 完全复用PC端的逻辑，包括：
// 1. 数据获取逻辑
// 2. 搜索过滤逻辑  
// 3. 分页逻辑
// 4. 事件处理逻辑
const {
  patients,
  loading,
  finished,
  searchKey,
  loadPatients,
  handleSearch,
  handlePatientClick
} = usePatientList()
&lt;/script&gt;

&lt;style scoped&gt;
/* 移动端特有的样式 */
.patient-list {
  padding: 12px;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-9">插件的核心实现原理</h2>
<h3 data-id="heading-10">1. 代码仓库管理</h3>
<p>vite build start开始时，自动拉取PC端仓库代码，如无更新不会重复拉取，默认只拉取一个commit，速度极快。</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-attr">url</span>: <span class="hljs-string">'http://gitlab.xinglianhealth.com/web/mdm/xlian-web-mdm.git'</span>, <span class="hljs-comment">//仓库地址</span>
  <span class="hljs-attr">branch</span>: <span class="hljs-string">'master'</span>, <span class="hljs-comment">// 仓库分支</span>
  <span class="hljs-attr">dir</span>: <span class="hljs-string">'mdm-pc'</span>  <span class="hljs-comment">// 本地存放目录</span>
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b6ca51236224404b5ba283028673f6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rWu5bm75LqR5pyI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770369874&amp;x-signature=clzoq9KrtH6yG2l7yvIQ0M0W9jw%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-csharp" lang="csharp">
<span class="hljs-meta">### 2. 智能导入替换，支持三种替换方式，任意选择</span>

```typescript
<span class="hljs-keyword">interface</span> <span class="hljs-title">ImportReplacementConfig</span> {
    <span class="hljs-comment">/**
     * 匹配模式（正则表达式字符串）
     */</span>
    pattern: RegExp;
    <span class="hljs-comment">/**
     * 替换方式：代码字符串
     */</span>
    code?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 替换方式：文件路径
     */</span>
    file?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 替换方式：重定向路径
     */</span>
    resolve?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h3 data-id="heading-11">3. 别名路径冲突映射修正，将被引用的仓库内部别名指向仓库内部，规避和外层别名的冲突</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RepoImportMappings</span> {
    <span class="hljs-comment">/**
     * 路径别名
     */</span>
    <span class="hljs-attr">alias</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 冲突的仓库目录
     */</span>
    <span class="hljs-attr">repoDir</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 忽略列表（路径匹配时跳过），使用外出仓库别名解析
     */</span>
    ignorePatterns?: <span class="hljs-built_in">string</span>[];
}
</code></pre>
<h2 data-id="heading-12">实际效果对比</h2>
<h3 data-id="heading-13">迁移前（传统方式）</h3>
<pre><code class="hljs language-scss" lang="scss">├── 移动端项目
│   ├── <span class="hljs-attribute">src</span>
│   │   ├── views
│   │   │   ├── PatientList<span class="hljs-selector-class">.vue</span>    ← 需要重写
│   │   │   ├── DoctorList<span class="hljs-selector-class">.vue</span>     ← 需要重写
│   │   │   └── ... (<span class="hljs-number">20</span>+个页面)
│   │   └── components
│   │       ├── MbForm<span class="hljs-selector-class">.vue</span>         ← 需要重写
│   │       └── ... (<span class="hljs-number">50</span>+个组件)
└── 工时：<span class="hljs-number">3</span>-<span class="hljs-number">4</span>人月
</code></pre>
<h3 data-id="heading-14">迁移后（使用插件）</h3>
<pre><code class="hljs language-scss" lang="scss">├── 移动端项目
│   ├── mdm-pc/                    ← 自动引入的PC端代码
│   ├── <span class="hljs-attribute">src</span>
│   │   ├── views
│   │   │   ├── PatientList<span class="hljs-selector-class">.vue</span>    ← 直接引用PC端PatientList组件，只对样式做适配覆盖
│   │   │   ├── DoctorList<span class="hljs-selector-class">.vue</span>     ← 直接引用PC端DoctorList组件，只对样式做适配覆
│   │   │   └── ... (复用<span class="hljs-number">80%</span>)
│   │   └── components
│   │       ├── MbUploader<span class="hljs-selector-class">.vue</span>     ← 无法复用的组件，用移动端专用文件组件做替换
│   │       └── ... (只需写<span class="hljs-number">30%</span>的组件)
└── 工时：<span class="hljs-number">1</span>-<span class="hljs-number">1.5</span>人月（节省<span class="hljs-number">60%</span>+）
</code></pre>
<h2 data-id="heading-15">高级应用场景</h2>
<h3 data-id="heading-16">场景1：多项目共享工具库</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 多个项目共享工具函数</span>
<span class="hljs-title function_">codeReusePlugin</span>({
  <span class="hljs-attr">repositories</span>: [
    {
      <span class="hljs-attr">url</span>: <span class="hljs-string">'git@github.com:company/shared-utils.git'</span>,
      <span class="hljs-attr">branch</span>: <span class="hljs-string">'main'</span>,
      <span class="hljs-attr">dir</span>: <span class="hljs-string">'shared-utils'</span>
    },
    ...
  ],
  <span class="hljs-attr">importReplacements</span>: [
    {
      <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/^@shared\/utils/</span>,
      <span class="hljs-attr">resolve</span>: path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'shared-utils/src'</span>)
    },
    ...
  ]
})
</code></pre>
<h3 data-id="heading-17">场景2：主题系统切换</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 根据环境切换主题</span>
<span class="hljs-title function_">codeReusePlugin</span>({
  <span class="hljs-attr">importReplacements</span>: [
    {
      <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/\/themes\/default/</span>,
      <span class="hljs-attr">file</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'mobile'</span> 
        ? <span class="hljs-string">'src/themes/mobile.vue'</span>
        : <span class="hljs-string">'src/themes/pc.vue'</span>
    }
  ]
})
</code></pre>
<h3 data-id="heading-18">场景3：A/B测试版本</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// A/B测试不同版本的组件</span>
<span class="hljs-title function_">codeReusePlugin</span>({
  <span class="hljs-attr">importReplacements</span>: [
    {
      <span class="hljs-attr">pattern</span>: <span class="hljs-regexp">/\/components\/CheckoutButton\.vue$/</span>,
      <span class="hljs-attr">file</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> 
        ? <span class="hljs-string">'src/components/CheckoutButtonVariantA.vue'</span>
        : <span class="hljs-string">'src/components/CheckoutButtonVariantB.vue'</span>
    }
  ]
})
</code></pre>
<h2 data-id="heading-19">总结</h2>
<p><code>vite-plugin-code-reuse</code> 插件为我们解决了跨项目代码复用的核心痛点：</p>
<h3 data-id="heading-20">🎯 <strong>核心价值</strong></h3>
<ol>
<li><strong>大幅提升开发效率</strong>：节省60%+的开发时间</li>
<li><strong>保证代码一致性</strong>：业务逻辑完全一致，减少BUG</li>
<li><strong>降低维护成本</strong>：一处修改，多处生效</li>
<li><strong>灵活定制</strong>：UI层完全可定制，不影响核心逻辑</li>
</ol>
<h3 data-id="heading-21">🚀 <strong>适用场景</strong></h3>
<ul>
<li>PC端到移动端的项目迁移</li>
<li>多项目共享组件库</li>
<li>微前端架构中的模块复用</li>
<li>A/B测试和实验性功能</li>
</ul>
<p>如果你也面临类似的多项目代码复用问题，不妨试试这个插件。项目已在GitHub开源，欢迎Star和贡献代码！</p>
<p><strong>GitHub地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxlian-fe%2Fvite-plugin-code-reuse" target="_blank" title="https://github.com/xlian-fe/vite-plugin-code-reuse" ref="nofollow noopener noreferrer">vite-plugin-code-reuse</a></p>
<p><strong>让代码复用变得简单，让开发效率飞起来！</strong> 🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React-Hooks逻辑复用艺术]]></title>    <link>https://juejin.cn/post/7600990891206787099</link>    <guid>https://juejin.cn/post/7600990891206787099</guid>    <pubDate>2026-01-30T09:38:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891206787099" data-draft-id="7600752623068758026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React-Hooks逻辑复用艺术"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-30T09:38:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React-Hooks逻辑复用艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:38:58.000Z" title="Fri Jan 30 2026 09:38:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在 React 开发中，Hooks 的出现彻底改变了逻辑复用的方式。它让我们能够将复杂的、可复用的逻辑从 UI 组件中抽离，实现真正的“关注点分离”。本文将分享 Hooks 的核心原则，并提供 4 个在真实业务场景中封装的实战案例。</p>
<h2 data-id="heading-1">一、 Hooks 核心</h2>
<h3 data-id="heading-2">1. 概念理解</h3>
<p>Hooks 本质上是<strong>将组件间共享的逻辑抽离并封装成的特殊函数</strong>。</p>
<h3 data-id="heading-3">2. 使用“红线”：规则与原理</h3>
<ul>
<li><strong>命名规范</strong>：必须以 <code>use</code> 开头（如 <code>useChat</code>），这不仅是约定，也是静态检查工具（ESLint）识别 Hook 的依据。</li>
<li><strong>调用位置</strong>：<strong>严禁在循环、条件判断或嵌套函数中调用 Hook</strong>。</li>
</ul>
<p><strong>底层原理</strong>： React 内部并不是通过“变量名”来记录 Hook 状态的，而是通过<strong>链表</strong> 。每次渲染时，React 严格依赖 Hook 的<strong>调用顺序</strong>来查找对应的状态。</p>
<blockquote>
<p><strong>注意：</strong> 如果在 <code>if</code> 语句中调用 Hook，一旦条件不成立导致某次渲染跳过了该 Hook，整个链表的指针就会错位，导致状态读取异常。</p>
</blockquote>
<h2 data-id="heading-4">二、 实战：自定义 Hooks 封装</h2>
<h3 data-id="heading-5">1. AI 场景：消息点赞/点踩逻辑 (<code>useChatEvaluate</code>)</h3>
<p>在 AI 对话系统中，消息评价是通用功能。我们需要处理：状态切换（点赞 -&gt; 取消点赞）、单选逻辑、以及异步接口调用。</p>
<pre><code class="hljs language-TSX" lang="TSX"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 模拟接口</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">public_evaluateMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">params: <span class="hljs-built_in">any</span></span>) =&gt; ({ <span class="hljs-attr">data</span>: <span class="hljs-literal">true</span> });

<span class="hljs-keyword">type</span> <span class="hljs-title class_">EvaluateType</span> = <span class="hljs-string">"GOOD"</span> | <span class="hljs-string">"BAD"</span> | <span class="hljs-string">"NONE"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useChatEvaluate</span> = (<span class="hljs-params">initialType: EvaluateType = <span class="hljs-string">"NONE"</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> [ratingType, setRatingType] = useState&lt;<span class="hljs-title class_">EvaluateType</span>&gt;(initialType);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">evaluateMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">contentId: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">type</span>: <span class="hljs-string">"GOOD"</span> | <span class="hljs-string">"BAD"</span></span>) =&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">newEvaluateType</span>: <span class="hljs-title class_">EvaluateType</span>;

    <span class="hljs-comment">// 逻辑：如果点击已选中的类型，则取消选中(NONE)；否则切换到新类型</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">"GOOD"</span>) {
      newEvaluateType = ratingType === <span class="hljs-string">"GOOD"</span> ? <span class="hljs-string">"NONE"</span> : <span class="hljs-string">"GOOD"</span>;
    } <span class="hljs-keyword">else</span> {
      newEvaluateType = ratingType === <span class="hljs-string">"BAD"</span> ? <span class="hljs-string">"NONE"</span> : <span class="hljs-string">"BAD"</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">public_evaluateMessage</span>({
        contentId,
        <span class="hljs-attr">ratingType</span>: newEvaluateType,
        <span class="hljs-attr">content</span>: <span class="hljs-string">""</span>,
      });

      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span> === <span class="hljs-literal">true</span>) {
        <span class="hljs-title function_">setRatingType</span>(newEvaluateType);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"评价失败:"</span>, error);
    }
  };

  <span class="hljs-keyword">return</span> { ratingType, evaluateMessage };
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatMessage</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> }&gt; = <span class="hljs-function">(<span class="hljs-params">{ id }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { ratingType, evaluateMessage } = <span class="hljs-title function_">useChatEvaluate</span>();
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> evaluateMessage(id, "GOOD")}&gt;
      {ratingType === "GOOD" ? "👍 已点赞" : "👍 点赞"}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
};
</code></pre>
<hr/>
<h3 data-id="heading-6">2. 响应式布局：屏幕尺寸监听 (<code>useMediaSize</code>)</h3>
<p>在响应式系统中，封装一个能根据窗口宽度自动切换“设备类型”的 Hook，可以极大地简化响应式开发。</p>
<pre><code class="hljs language-TSX" lang="TSX"><span class="hljs-keyword">import</span> { useState, useEffect, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">MediaType</span> {
  mobile = <span class="hljs-string">'mobile'</span>,
  tablet = <span class="hljs-string">'tablet'</span>,
  pc = <span class="hljs-string">'pc'</span>,
}

<span class="hljs-keyword">const</span> useMediaSize = (): <span class="hljs-function"><span class="hljs-params">MediaType</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> [width, setWidth] = useState&lt;<span class="hljs-built_in">number</span>&gt;(globalThis.<span class="hljs-property">innerWidth</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleWindowResize</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">setWidth</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleWindowResize);
    <span class="hljs-comment">// 记得清理事件监听</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleWindowResize);
  }, []);

  <span class="hljs-comment">// 使用 useMemo 避免每次渲染都重新运行计算逻辑</span>
  <span class="hljs-keyword">const</span> media = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (width &lt;= <span class="hljs-number">640</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">mobile</span>;
    <span class="hljs-keyword">if</span> (width &lt;= <span class="hljs-number">768</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">tablet</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">pc</span>;
  }, [width]);

  <span class="hljs-keyword">return</span> media;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useMediaSize;
</code></pre>
<hr/>
<h3 data-id="heading-7">3. 性能优化：防抖与节流 Hook</h3>
<h4 data-id="heading-8">A. 防抖 Hook (<code>useDebounce</code>)</h4>
<p>常用于搜索框，防止用户快速输入时频繁触发请求。</p>
<pre><code class="hljs language-TSX" lang="TSX"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> useDebounce&lt;T&gt;(<span class="hljs-attr">value</span>: T, <span class="hljs-attr">delay</span>: <span class="hljs-built_in">number</span>): T {
  <span class="hljs-keyword">const</span> [debouncedValue, setDebouncedValue] = useState&lt;T&gt;(value);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> handler = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setDebouncedValue</span>(value);
    }, delay);

    <span class="hljs-comment">// 关键：在下一次 useEffect 执行前清理上一次的定时器</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(handler);
  }, [value, delay]);

  <span class="hljs-keyword">return</span> debouncedValue;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useDebounce;
</code></pre>
<h4 data-id="heading-9">B. 节流 Hook (<code>useThrottle</code>)</h4>
<p>常用于滚动加载、窗口缩放，确保在规定时间内只执行一次。</p>
<pre><code class="hljs language-TSX" lang="TSX"><span class="hljs-keyword">import</span> { useState, useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> useThrottle&lt;T&gt;(<span class="hljs-attr">value</span>: T, <span class="hljs-attr">delay</span>: <span class="hljs-built_in">number</span>): T {
  <span class="hljs-keyword">const</span> [throttledValue, setThrottledValue] = useState&lt;T&gt;(value);
  <span class="hljs-keyword">const</span> lastExecuted = useRef&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> remainingTime = delay - (now - lastExecuted.<span class="hljs-property">current</span>);

    <span class="hljs-keyword">if</span> (remainingTime &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// 立即执行</span>
      <span class="hljs-title function_">setThrottledValue</span>(value);
      lastExecuted.<span class="hljs-property">current</span> = now;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 设置定时器处理剩余时间</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setThrottledValue</span>(value);
        lastExecuted.<span class="hljs-property">current</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      }, remainingTime);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [value, delay]);

  <span class="hljs-keyword">return</span> throttledValue;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useThrottle;
</code></pre>
<hr/>
<h2 data-id="heading-10">三、 总结：封装自定义 Hook 的心法</h2>
<ol>
<li><strong>抽离状态而非仅逻辑</strong>：如果一段逻辑只涉及纯函数计算，不需要 Hook；只有涉及 <code>useState</code> 或 <code>useEffect</code> 等状态管理时，才有必要封装 Hook。</li>
<li><strong>保持纯净</strong>：自定义 Hook 应该只关心逻辑，而不应该直接操作 DOM。</li>
<li><strong>TS 类型保护</strong>：利用泛型 <code>&lt;T&gt;</code> 增强 Hook 的兼容性，让它能适配各种数据类型。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 手写实现的 KeepAlive 组件 🚀]]></title>    <link>https://juejin.cn/post/7600967006893178889</link>    <guid>https://juejin.cn/post/7600967006893178889</guid>    <pubDate>2026-01-30T09:42:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600967006893178889" data-draft-id="7600705962249191433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 手写实现的 KeepAlive 组件 🚀"/> <meta itemprop="keywords" content="React.js,面试,前端"/> <meta itemprop="datePublished" content="2026-01-30T09:42:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xiaoxue_"/> <meta itemprop="url" content="https://juejin.cn/user/4065372122398027"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 手写实现的 KeepAlive 组件 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4065372122398027/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xiaoxue_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:42:50.000Z" title="Fri Jan 30 2026 09:42:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React 手写实现的 KeepAlive 组件 🚀</h2>
<h3 data-id="heading-1">引言 📝</h3>
<p>在 React 开发中，你是否遇到过这样的场景：切换 Tab 页面后，返回之前的页面，输入的内容、计数状态却 “消失不见” 了？🤔 这是因为 React 组件默认在卸载时会销毁状态，重新渲染时会创建新的实例。而 <code>KeepAlive</code> 组件就像一个 “状态保鲜盒”，能让组件在隐藏时不卸载，保持原有状态，再次显示时直接复用。今天我们就结合实战代码，从零拆解 <code>KeepAlive</code> 组件的实现逻辑，带你吃透这一实用技能！</p>
<h3 data-id="heading-2">一、什么是 Keep-Alive？ 🧩</h3>
<p><code>Keep-Alive</code> 源于 Vue 的内置组件，在 React 中并没有原生支持，但提供了<strong>组件缓存能力</strong>的第三方库<code>react-activation</code>,我们可以通过<code>import {KeepAlive} from 'react-activation';</code> 导入<code>KeepAlive</code>获得状态保存能力。</p>
<p>现在我们来手动实现其核心功能，它本质是一个<strong>组件缓存容器</strong>，核心特性如下：</p>
<ul>
<li>缓存组件实例，避免组件频繁挂载 / 卸载，减少性能开销；</li>
<li>保持组件状态（如 useState 数据、表单输入值等），提升用户体验；</li>
<li>通过 “显隐控制” 替代 “挂载 / 卸载”，组件始终存在于 DOM 中，并未卸载，只是通过样式隐藏；</li>
<li>支持以唯一标识（如 <code>activeId</code>）管理多个组件的缓存与切换。</li>
</ul>
<p>简单说，<code>Keep-Alive</code> 就像给组件 “冬眠” 的能力 —— 不用时休眠（隐藏），需要时唤醒（显示），状态始终不变 ✨。</p>
<h3 data-id="heading-3">二、为什么需要 Keep-Alive？（作用 + 场景 + 使用）🌟</h3>
<h4 data-id="heading-4">1. 核心作用</h4>
<ul>
<li><strong>状态保留</strong>：避免组件切换时丢失临时状态（如表单输入、计数、滚动位置）；</li>
<li><strong>性能优化</strong>：减少重复渲染和生命周期函数执行（如 <code>useEffect</code> 中的接口请求）；</li>
<li><strong>体验提升</strong>：切换组件时无加载延迟，操作连贯性更强。</li>
</ul>
<h4 data-id="heading-5">2. 适用场景</h4>
<ul>
<li><strong>Tab 切换页面</strong>：如后台管理系统的多标签页、移动端的底部导航切换；</li>
<li><strong>路由跳转</strong>：列表页跳转详情页后返回，保留列表筛选条件和滚动位置；</li>
<li><strong>高频切换组件</strong>：如表单分步填写、弹窗与页面的切换；</li>
<li><strong>资源密集型组件</strong>：如包含大量图表、视频的组件，避免重复初始化。</li>
</ul>
<h4 data-id="heading-6">3. 基础使用方式</h4>
<p>在我们的实战代码中，<code>Keep-Alive</code> 的使用非常简洁：</p>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">// 父组件中包裹需要缓存的组件，传入 activeId 控制激活状态
&lt;KeepAlive <span class="hljs-attr">activeId</span>={activeTab}&gt;
  {<span class="hljs-attr">activeTab</span> === <span class="hljs-string">'A'</span> ? &lt;Counter name=<span class="hljs-string">"A"</span> /&gt; : &lt;OtherCounter name=<span class="hljs-string">"B"</span> /&gt;}
&lt;/KeepAlive&gt;
</code></pre>
<ul>
<li><code>activeId</code>：唯一标识，用于区分当前激活的组件；</li>
<li><code>children</code>：需要缓存的组件实例，支持动态切换不同组件。</li>
</ul>
<h3 data-id="heading-7">三、手写 KeepAlive 组件的实现思路 🔍</h3>
<h4 data-id="heading-8">1. 核心需求分析</h4>
<p>要实现一个通用的 <code>Keep-Alive</code> 组件，需满足以下条件：</p>
<ul>
<li>支持多组件缓存：能同时缓存多个组件，通过 <code>activeId</code> 区分；</li>
<li>自动更新缓存：新组件首次激活时自动存入缓存，已缓存组件直接复用；</li>
<li>灵活控制显隐：只显示当前激活的组件，其余组件隐藏；</li>
<li>兼容性强：不侵入子组件逻辑，子组件无需修改即可使用；</li>
<li>状态稳定：缓存的组件状态不丢失，生命周期不重复执行。</li>
</ul>
<h4 data-id="heading-9">2. 实现步骤拆解（结合代码讲解）</h4>
<p>初始化一个<code>React</code>项目,选择<code>JavaScript</code>语言。</p>
<p>我们的 <code>KeepAlive</code> 组件代码位于 <code>src/components/KeepAlive.jsx</code>，核心分为 3 个步骤，一步步拆解如下：</p>
<h5 data-id="heading-10">步骤一：定义缓存容器 📦</h5>
<p>核心思路：用 React 的 <code>useState</code> 定义一个缓存对象 <code>cache</code>，以 <code>activeId</code> 为 key，缓存对应的组件实例（<code>children</code>）。</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">KeepAlive</span> = (<span class="hljs-params">{ activeId, children }</span>) =&gt; {
  <span class="hljs-comment">// 定义缓存容器：key 是 activeId，value 是对应的组件实例（children）</span>
  <span class="hljs-comment">// 初始值为空对象，保证首次渲染时无缓存组件</span>
  <span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>({}); 

  <span class="hljs-comment">// 后续逻辑...</span>
};
</code></pre>
<ul>
<li>为什么用对象作为缓存容器？对象的 key 支持字符串类型的 <code>activeId</code>，查询和修改效率高（O (1)），且配合 <code>Object.entries</code> 方便遍历；</li>
<li>Map 也可作为缓存容器（key 可支持对象类型），但本例中 <code>activeId</code> 是字符串，对象足够满足需求，更简洁。</li>
</ul>
<h5 data-id="heading-11">步骤二：监听依赖，更新缓存 🔄</h5>
<p>核心思路：通过 <code>useEffect</code> 监听 <code>activeId</code> 和 <code>children</code> 的变化，当切换组件时，若当前 <code>activeId</code> 对应的组件未被缓存，则存入缓存。</p>
<p>jsx</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  <span class="hljs-comment">// 逻辑：如果当前 activeId 对应的组件未在缓存中，就添加到缓存</span>
  if (!cache[activeId]) { 
    <span class="hljs-comment">// 利用函数式更新，确保拿到最新的缓存状态（prev 是上一次的 cache）</span>
    <span class="hljs-built_in">setCache</span>((prev) =&gt; ({
      ...prev, // 保留已有的缓存组件
      [activeId]: children // 新增当前 activeId 对应的组件到缓存
    }))
  }
}, <span class="hljs-selector-attr">[activeId, children, cache]</span>); <span class="hljs-comment">// 依赖项：activeId 变了、组件变了、缓存变了，都要重新检查</span>
</code></pre>
<ul>
<li>
<p>依赖项说明：</p>
<ul>
<li><code>activeId</code>：切换标签时触发，检查新标签对应的组件是否已缓存；</li>
<li><code>children</code>：若传入的组件实例变化（如 props 改变），需要更新缓存中的组件；</li>
<li><code>cache</code>：确保获取最新的缓存状态，避免覆盖已有缓存；</li>
</ul>
</li>
<li>
<p>为什么不直接 <code>setCache({...cache, [activeId]: children})</code>？ 因为 <code>cache</code> 是状态，直接使用可能拿到旧值，函数式更新（<code>prev =&gt; {...}</code>）能保证拿到最新的状态，避免缓存丢失。</p>
</li>
</ul>
<h5 data-id="heading-12">步骤三：遍历缓存，控制组件显隐 🎭</h5>
<p>核心思路：通过 <code>Object.entries</code> 将缓存对象转为 <code>[key, value]</code> 二维数组，遍历渲染所有缓存组件，通过 <code>display</code> 样式控制显隐（激活的组件显示，其余隐藏）。</p>
<p>jsx</p>
<pre><code class="hljs language-css" lang="css">return (
  &lt;&gt;
    {
      // <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.entries</span>(cache)：将缓存对象转为二维数组，格式如 <span class="hljs-selector-attr">[[id1, component1]</span>, <span class="hljs-selector-attr">[id2, component2]</span>]
      <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.entries</span>(cache)<span class="hljs-selector-class">.map</span>((<span class="hljs-selector-attr">[id, component]</span>) =&gt; (
        &lt;<span class="hljs-selector-tag">div</span> 
          key={id} // 用缓存的 id 作为 key，确保 React 正确识别组件
          // 显隐控制：当前 id 等于 activeId 时显示（block），否则隐藏（<span class="hljs-attribute">none</span>）
          style={{ <span class="hljs-attribute">display</span>: id === activeId ? <span class="hljs-string">'block'</span> : <span class="hljs-string">'none'</span> }}
        &gt;
          {component} {<span class="hljs-comment">/* 渲染缓存的组件实例 */</span>}
        &lt;/<span class="hljs-selector-tag">div</span>&gt;
      ))
    }
  &lt;/&gt;
);
</code></pre>
<ul>
<li>关键逻辑：所有缓存的组件都会被渲染到 DOM 中，但通过 <code>display: none</code> 隐藏未激活的组件，这样组件不会卸载，状态得以保留；</li>
<li><code>key</code> 的作用：必须用 <code>id</code> 作为 key，避免 React 误判组件身份，导致状态丢失。</li>
</ul>
<h4 data-id="heading-13">3.关键逻辑拆解</h4>
<h3 data-id="heading-14">四、完整代码及效果演示 📸</h3>
<h4 data-id="heading-15">1. 完整 KeepAlive 组件（<code>src/components/KeepAlive.jsx</code>）</h4>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">/**
 * KeepAlive 组件：缓存 React 组件，避免卸载，保持状态
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">activeId</span> - 当前激活的组件标识（唯一key）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">React.ReactNode</span>} <span class="hljs-variable">children</span> - 需要缓存的组件实例
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">JSX.Element</span>} 渲染所有缓存组件，控制显隐
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">KeepAlive</span> = (<span class="hljs-params">{ activeId, children }</span>) =&gt; {
  <span class="hljs-comment">// 缓存容器：key 为 activeId，value 为对应的组件实例</span>
  <span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>({});

  <span class="hljs-comment">// 监听 activeId、children、cache 变化，更新缓存</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 若当前 activeId 对应的组件未缓存，则添加到缓存</span>
    <span class="hljs-keyword">if</span> (!cache[activeId]) {
      <span class="hljs-comment">// 函数式更新，确保拿到最新的缓存状态</span>
      <span class="hljs-title function_">setCache</span>(<span class="hljs-function">(<span class="hljs-params">prevCache</span>) =&gt;</span> ({
        ...prevCache, <span class="hljs-comment">// 保留已有缓存</span>
        [activeId]: children <span class="hljs-comment">// 新增当前组件到缓存</span>
      }));
    }
  }, [activeId, children, cache]);

  <span class="hljs-comment">// 遍历缓存，渲染所有组件，通过 display 控制显隐</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {Object.entries(cache).map(([id, component]) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">display:</span> <span class="hljs-attr">id</span> === <span class="hljs-string">activeId</span> ? '<span class="hljs-attr">block</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>',
          }}
        &gt;</span>
          {component}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">KeepAlive</span>;
</code></pre>
<h4 data-id="heading-16">2. 模拟 Tab 切换场景（<code>src/App.jsx</code>）</h4>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">import { useState, useEffect } from 'react'<span class="hljs-comment">;</span>
import KeepAlive from './components/KeepAlive.jsx'<span class="hljs-comment">;</span>

// 计数组件 A：演示状态保留
const <span class="hljs-attr">Counter</span> = ({ name }) =&gt; {
  const <span class="hljs-section">[count, setCount]</span> = useState(0)<span class="hljs-comment">;</span>

  // 模拟组件挂载/卸载生命周期
  useEffect(() =&gt; {
    console.log(`✨ 组件 ${name} 挂载完成`)<span class="hljs-comment">;</span>
    return () =&gt; {
      console.log(`❌ 组件 ${name} 卸载完成`)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[name]</span>)<span class="hljs-comment">;</span>

  return (
    &lt;div <span class="hljs-attr">style</span>={{ padding: <span class="hljs-string">'20px'</span>, border: <span class="hljs-string">'1px solid #646cff'</span>, borderRadius: <span class="hljs-string">'8px'</span>, margin: <span class="hljs-string">'10px 0'</span> }}&gt;
      &lt;h3 <span class="hljs-attr">style</span>={{ color: <span class="hljs-string">'#646cff'</span> }}&gt;{name} 视图&lt;/h3&gt;
      &lt;p&gt;当前计数：{count} 🎯&lt;/p&gt;
      &lt;button <span class="hljs-attr">onClick</span>={() =&gt; setCount(count + <span class="hljs-number">1</span>)} style={{ marginRight: <span class="hljs-string">'10px'</span> }}&gt;+<span class="hljs-number">1</span>&lt;/button&gt;
      &lt;button <span class="hljs-attr">onClick</span>={() =&gt; setCount(<span class="hljs-number">0</span>)}&gt;重置&lt;/button&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// 计数组件 B：与 A 功能一致，用于模拟切换
const <span class="hljs-attr">OtherCounter</span> = ({ name }) =&gt; {
  const <span class="hljs-section">[count, setCount]</span> = useState(0)<span class="hljs-comment">;</span>

  useEffect(() =&gt; {
    console.log(`✨ 组件 ${name} 挂载完成`)<span class="hljs-comment">;</span>
    return () =&gt; {
      console.log(`❌ 组件 ${name} 卸载完成`)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[name]</span>)<span class="hljs-comment">;</span>

  return (
    &lt;div <span class="hljs-attr">style</span>={{ padding: <span class="hljs-string">'20px'</span>, border: <span class="hljs-string">'1px solid #535bf2'</span>, borderRadius: <span class="hljs-string">'8px'</span>, margin: <span class="hljs-string">'10px 0'</span> }}&gt;
      &lt;h3 <span class="hljs-attr">style</span>={{ color: <span class="hljs-string">'#535bf2'</span> }}&gt;{name} 视图&lt;/h3&gt;
      &lt;p&gt;当前计数：{count} 🎯&lt;/p&gt;
      &lt;button <span class="hljs-attr">onClick</span>={() =&gt; setCount(count + <span class="hljs-number">1</span>)} style={{ marginRight: <span class="hljs-string">'10px'</span> }}&gt;+<span class="hljs-number">1</span>&lt;/button&gt;
      &lt;button <span class="hljs-attr">onClick</span>={() =&gt; setCount(<span class="hljs-number">0</span>)}&gt;重置&lt;/button&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">App</span> = () =&gt; {
  // 控制当前激活的 Tab，默认激活 A 组件
  const <span class="hljs-section">[activeTab, setActiveTab]</span> = useState('A')<span class="hljs-comment">;</span>

  return (
    &lt;div <span class="hljs-attr">style</span>={{ maxWidth: <span class="hljs-string">'800px'</span>, margin: <span class="hljs-string">'0 auto'</span>, padding: <span class="hljs-string">'2rem'</span> }}&gt;
      &lt;h1 <span class="hljs-attr">style</span>={{ textAlign: <span class="hljs-string">'center'</span>, marginBottom: <span class="hljs-string">'2rem'</span>, color: <span class="hljs-string">'#242424'</span> }}&gt;
        React KeepAlive 组件实战 🚀
      &lt;/h1&gt;

      {/* Tab 切换按钮 */}
      &lt;div <span class="hljs-attr">style</span>={{ textAlign: <span class="hljs-string">'center'</span>, marginBottom: <span class="hljs-string">'2rem'</span> }}&gt;
        &lt;button
          <span class="hljs-attr">onClick</span>={() =&gt; setActiveTab(<span class="hljs-string">'A'</span>)}
          <span class="hljs-attr">style</span>={{
            marginRight: '1rem',
            padding: '0.8rem 1.5rem',
            backgroundColor: <span class="hljs-attr">activeTab</span> === <span class="hljs-string">'A'</span> ? <span class="hljs-string">'#646cff'</span> : <span class="hljs-string">'#f9f9f9'</span>,
            color: <span class="hljs-attr">activeTab</span> === <span class="hljs-string">'A'</span> ? <span class="hljs-string">'white'</span> : <span class="hljs-string">'#242424'</span>
          }}
        &gt;
          显示 A 组件
        &lt;/button&gt;
        &lt;button
          <span class="hljs-attr">onClick</span>={() =&gt; setActiveTab(<span class="hljs-string">'B'</span>)}
          <span class="hljs-attr">style</span>={{
            padding: '0.8rem 1.5rem',
            backgroundColor: <span class="hljs-attr">activeTab</span> === <span class="hljs-string">'B'</span> ? <span class="hljs-string">'#535bf2'</span> : <span class="hljs-string">'#f9f9f9'</span>,
            color: <span class="hljs-attr">activeTab</span> === <span class="hljs-string">'B'</span> ? <span class="hljs-string">'white'</span> : <span class="hljs-string">'#242424'</span>
          }}
        &gt;
          显示 B 组件
        &lt;/button&gt;
      &lt;/div&gt;

      {/* 用 KeepAlive 包裹需要缓存的组件 */}
      &lt;KeepAlive <span class="hljs-attr">activeId</span>={activeTab}&gt;
        {<span class="hljs-attr">activeTab</span> === <span class="hljs-string">'A'</span> ? &lt;Counter name=<span class="hljs-string">"A"</span> /&gt; : &lt;OtherCounter name=<span class="hljs-string">"B"</span> /&gt;}
      &lt;/KeepAlive&gt;

      &lt;div <span class="hljs-attr">style</span>={{ marginTop: <span class="hljs-string">'2rem'</span>, textAlign: <span class="hljs-string">'center'</span>, color: <span class="hljs-string">'#888'</span> }}&gt;
        👉 切换 Tab 试试，组件状态不会丢失哦！
      &lt;/div&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

export default App<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-17">3. 效果展示</h4>
<h5 data-id="heading-18">（1）功能效果</h5>
<ul>
<li>首次进入页面：显示 A 组件，计数为 0；</li>
<li>点击 A 组件 “+1” 按钮，计数变为 7；</li>
<li>切换到 B 组件：B 组件计数为 0，A 组件隐藏（未卸载）；</li>
<li>点击 B 组件 “+1” 按钮，计数变为 5；</li>
<li>切换回 A 组件：A 组件计数依然是 7，无需重新初始化；</li>
<li>控制台日志：只有组件挂载日志，无卸载日志，证明组件始终存在。</li>
</ul>
<h5 data-id="heading-19">（2）用户体验</h5>
<ul>
<li>切换无延迟，状态无缝衔接；</li>
<li>避免重复执行 <code>useEffect</code> 中的逻辑（如接口请求），提升性能；</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02ac2def766c4d428fa6efc0df4e1d97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370996&amp;x-signature=nniOvf5UJsZhDge9KccOFxi6y%2Bw%3D" alt="QQ20260130-172541.gif" loading="lazy"/></p>
<h3 data-id="heading-20">五、核心知识点梳理 📚</h3>
<p>通过手写 <code>KeepAlive</code> 组件，我们掌握了这些关键知识点：</p>
<ol>
<li><strong>React Hooks 实战</strong>：<code>useState</code> 管理缓存状态，<code>useEffect</code> 监听依赖更新，函数式更新避免状态覆盖；</li>
<li><strong>组件生命周期控制</strong>：通过 <code>display</code> 样式控制组件显隐，替代挂载 / 卸载，从而保留状态；</li>
<li><strong>数据结构应用</strong>：对象作为缓存容器，<code>Object.entries</code> 实现对象遍历；</li>
<li><strong>Props 传递与复用</strong>：<code>children</code> props 让 <code>KeepAlive</code> 组件通用化，支持任意子组件缓存；</li>
<li><strong>状态管理思路</strong>：以唯一标识（<code>activeId</code>）关联组件，确保缓存的准确性和唯一性；</li>
<li><strong>性能优化技巧</strong>：避免组件频繁挂载 / 卸载，减少 DOM 操作和资源消耗；</li>
<li><strong>组件设计原则</strong>：通用、低侵入、易扩展，不修改子组件逻辑即可实现缓存功能。</li>
</ol>
<p>补充： Map 与 JSON 的区别 ——Map 可以直接存储对象作为 key，而 JSON 只能存储字符串。如果需要缓存以对象为标识的组件，可将 <code>cache</code> 改为 Map 类型，优化如下：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用 Map 替代对象作为缓存容器</span>
<span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());

<span class="hljs-comment">// 更新缓存</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!cache.<span class="hljs-title function_">has</span>(activeId)) {
    <span class="hljs-title function_">setCache</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(prev).<span class="hljs-title function_">set</span>(activeId, children));
  }
}, [activeId, children, cache]);

<span class="hljs-comment">// 遍历缓存</span>
<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    {Array.from(cache.entries()).map(([id, component]) =&gt; (
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> <span class="hljs-attr">id</span> === <span class="hljs-string">activeId</span> ? '<span class="hljs-attr">block</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>
        {component}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    ))}
  <span class="hljs-tag">&lt;/&gt;</span></span>
);
</code></pre>
<h3 data-id="heading-21">六、结语 🎉</h3>
<p>手写 <code>Keep-Alive</code> 组件看似简单，却涵盖了 React 组件设计、状态管理、性能优化等多个核心知识点。它的核心思想是 “缓存 + 显隐控制”，通过巧妙的状态管理避免组件卸载，从而保留状态。</p>
<p>在实际开发中，我们可以基于这个基础版本扩展更多功能：比如设置缓存上限（避免内存溢出）、手动清除缓存、支持路由级缓存等。掌握了这个组件的实现逻辑，你不仅能解决实际开发中的状态保留问题，还能更深入理解 React 组件的渲染机制和生命周期。</p>
<p>希望这篇文章能带你吃透 <code>Keep-Alive</code> 组件的核心原理，下次遇到类似需求时，也能从容手写实现！如果觉得有收获，欢迎点赞收藏，一起探索 React 的更多实战技巧吧～ 🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 时代操作 GitHub 的三种方式，用过的都说香]]></title>    <link>https://juejin.cn/post/7600678255042707465</link>    <guid>https://juejin.cn/post/7600678255042707465</guid>    <pubDate>2026-01-30T07:28:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600678255042707465" data-draft-id="7600990891206115355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 时代操作 GitHub 的三种方式，用过的都说香"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-30T07:28:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aZhe的全栈知识分享"/> <meta itemprop="url" content="https://juejin.cn/user/1039471959105228"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 时代操作 GitHub 的三种方式，用过的都说香
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1039471959105228/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aZhe的全栈知识分享
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:28:22.000Z" title="Fri Jan 30 2026 07:28:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一句话推送代码到 GitHub，一次配置永久使用。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">核心价值</h2>
<p><strong>传统方式</strong>：打开浏览器 → 登录 GitHub → 创建仓库 → 复制地址 → git remote add → git push</p>
<p><strong>现在只需要</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">你：帮我把这个项目推送到 GitHub
AI：好的，已完成。仓库地址：https:<span class="hljs-comment">//github.com/xxx/xxx</span>
</code></pre>
<p><strong>而且</strong>：第一次配置后，以后所有项目都不需要再认证，直接推送。</p>
<hr/>
<h2 data-id="heading-1">快速开始（3 分钟上手）</h2>
<h3 data-id="heading-2">第一步：安装工具</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 GitHub CLI</span>
brew install gh

<span class="hljs-comment"># 安装 Claude Code</span>
npm install -g @anthropic-ai/claude-code
</code></pre>
<h3 data-id="heading-3">第二步：登录 GitHub（仅需一次）</h3>
<pre><code class="hljs language-bash" lang="bash">gh auth login
</code></pre>
<p>按提示在浏览器完成认证。<strong>这是唯一需要手动操作的步骤，而且只需要做一次。</strong></p>
<h3 data-id="heading-4">第三步：开始使用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> your-project    <span class="hljs-comment"># 进入任意项目</span>
claude             <span class="hljs-comment"># 启动 AI 助手</span>
</code></pre>
<p>然后直接说：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"帮我把这个项目推送到 GitHub"</span>
</code></pre>
<p>完成。以后任何项目，重复第三步即可。</p>
<hr/>
<h2 data-id="heading-5">一次配置，永久使用</h2>
<p>这是本方案最大的优势，值得单独强调：</p>





























<table><thead><tr><th>场景</th><th>操作</th></tr></thead><tbody><tr><td>第一个项目</td><td>安装 gh CLI → 认证 → 推送</td></tr><tr><td>第二个项目</td><td>直接说"帮我推送到 GitHub"</td></tr><tr><td>第三个项目</td><td>直接说"帮我推送到 GitHub"</td></tr><tr><td>第 N 个项目</td><td>直接说"帮我推送到 GitHub"</td></tr><tr><td>重启电脑后</td><td>直接说"帮我推送到 GitHub"</td></tr></tbody></table>
<p><strong>原理</strong>：gh CLI 的认证信息存储在系统钥匙串中，全局生效，永久有效。</p>
<hr/>
<h2 data-id="heading-6">三种方式对比</h2>
<p>本文介绍三种操作 GitHub 的方式，<strong>推荐第二种</strong>：</p>





























<table><thead><tr><th>方式</th><th>操作方式</th><th>学习成本</th><th>推荐度</th></tr></thead><tbody><tr><td>GitHub CLI</td><td>手动敲命令</td><td>需要记命令</td><td>一般</td></tr><tr><td><strong>Claude Code + gh CLI</strong></td><td><strong>说人话</strong></td><td><strong>零成本</strong></td><td><strong>强烈推荐</strong></td></tr><tr><td>Claude Code + MCP</td><td>说人话</td><td>配置稍复杂</td><td>推荐</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">方式一：GitHub CLI（基础）</h2>
<p>GitHub CLI (gh) 是 GitHub 官方命令行工具。</p>
<h3 data-id="heading-8">安装与认证</h3>
<pre><code class="hljs language-bash" lang="bash">brew install gh      <span class="hljs-comment"># 安装</span>
gh auth login        <span class="hljs-comment"># 登录（按提示操作）</span>
</code></pre>
<h3 data-id="heading-9">核心命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建仓库并推送（最常用）</span>
gh repo create 仓库名 --public --<span class="hljs-built_in">source</span>=. --remote=github --push

<span class="hljs-comment"># 其他常用命令</span>
gh repo <span class="hljs-built_in">clone</span> owner/repo    <span class="hljs-comment"># 克隆仓库</span>
gh <span class="hljs-built_in">pr</span> create                <span class="hljs-comment"># 创建 PR</span>
gh issue list               <span class="hljs-comment"># 查看 Issue</span>
</code></pre>
<h3 data-id="heading-10">小结</h3>
<ul>
<li><strong>优点</strong>：官方工具，功能完整</li>
<li><strong>缺点</strong>：需要记住命令和参数</li>
</ul>
<hr/>
<h2 data-id="heading-11">方式二：Claude Code + gh CLI（推荐）</h2>
<p>不想记命令？让 AI 帮你执行。</p>
<h3 data-id="heading-12">什么是 Claude Code</h3>
<p>Anthropic 官方命令行 AI 助手：</p>
<ul>
<li>直接在终端与 AI 对话</li>
<li>AI 可以执行命令、读写文件、操作 Git</li>
<li>理解项目上下文</li>
</ul>
<h3 data-id="heading-13">安装</h3>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<h3 data-id="heading-14">如何与 Claude 交流</h3>
<p><strong>直接说目标（推荐）</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"帮我把这个项目推送到 GitHub"</span>
</code></pre>
<p>Claude 会自动：检查 gh CLI → 检查认证 → 创建仓库 → 推送代码</p>
<p><strong>指定工具</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"用 gh cli 创建一个 GitHub 仓库并推送"</span>
</code></pre>
<p><strong>分步执行</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"帮我安装 GitHub CLI"</span>
<span class="hljs-string">"帮我登录 GitHub"</span>
<span class="hljs-string">"帮我创建仓库并推送"</span>
</code></pre>
<h3 data-id="heading-15">实际对话演示</h3>
<p>以下是本文的真实操作记录：</p>
<hr/>
<p><strong>我</strong>：帮我把项目推送到 GitHub</p>
<p><strong>Claude</strong>：让我先安装 gh CLI。</p>
<pre><code class="hljs language-bash" lang="bash">brew install gh
</code></pre>
<p><strong>Claude</strong>：请在浏览器打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flogin%2Fdevice" target="_blank" title="https://github.com/login/device" ref="nofollow noopener noreferrer">github.com/login/devic…</a> 输入验证码：<code>9F6D-76C8</code></p>
<p><strong>我</strong>：好了</p>
<p><strong>Claude</strong>：认证成功，正在创建仓库并推送。</p>
<pre><code class="hljs language-bash" lang="bash">gh repo create azhe_project --public --<span class="hljs-built_in">source</span>=. --remote=github --push
</code></pre>
<p><strong>Claude</strong>：完成！仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F15811079534%2Fazhe_project" target="_blank" title="https://github.com/15811079534/azhe_project" ref="nofollow noopener noreferrer">github.com/15811079534…</a></p>
<hr/>
<h3 data-id="heading-16">更多场景</h3>
<pre><code class="hljs language-sql" lang="sql">"帮我提交代码"           → AI 自动 <span class="hljs-keyword">add</span>、生成 <span class="hljs-keyword">commit</span> message、<span class="hljs-keyword">commit</span>
"帮我创建 PR"            → AI 执行 gh pr <span class="hljs-keyword">create</span>
"帮我看看有哪些 Issue"    → AI 执行 gh issue list 并总结
"帮我回滚到上一个版本"    → AI 执行 git revert
</code></pre>
<h3 data-id="heading-17">小结</h3>
<ul>
<li><strong>优点</strong>：零记忆负担，说人话就行，一次配置永久使用</li>
<li><strong>缺点</strong>：需要 Claude Code 和 API 访问</li>
</ul>
<hr/>
<h2 data-id="heading-18">方式三：MCP（进阶）</h2>
<p>MCP (Model Context Protocol) 让 AI 直接调用 GitHub API，跳过命令行。</p>
<h3 data-id="heading-19">与 gh CLI 的区别</h3>
<pre><code class="hljs language-objectivec" lang="objectivec">gh <span class="hljs-built_in">CLI</span> 方式：AI → shell 命令 → gh <span class="hljs-built_in">CLI</span> → GitHub API
MCP 方式：  AI → MCP Server → GitHub API（更直接）
</code></pre>
<h3 data-id="heading-20">配置步骤</h3>
<p><strong>1. 创建 GitHub Token</strong></p>
<p>打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsettings%2Ftokens" target="_blank" title="https://github.com/settings/tokens" ref="nofollow noopener noreferrer">github.com/settings/to…</a> → Generate new token → 勾选 <code>repo</code> 权限</p>
<p><strong>2. 配置 Claude Code</strong></p>
<p>编辑 <code>~/.claude/settings.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"github"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-github"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"GITHUB_PERSONAL_ACCESS_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ghp_你的token"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>3. 重启 Claude Code</strong></p>
<h3 data-id="heading-21">适用场景</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"帮我 fork 这个仓库"</span>
<span class="hljs-string">"帮我看看 owner/repo 的 README"</span>
<span class="hljs-string">"在 owner/repo 创建一个 Issue"</span>
</code></pre>
<h3 data-id="heading-22">小结</h3>
<ul>
<li><strong>优点</strong>：直接调用 API，速度快，适合批量操作</li>
<li><strong>缺点</strong>：不支持本地 Git 操作（push/pull），配置较复杂</li>
</ul>
<hr/>
<h2 data-id="heading-23">推荐方案</h2>

























<table><thead><tr><th>用户类型</th><th>推荐方式</th><th>理由</th></tr></thead><tbody><tr><td><strong>大多数开发者</strong></td><td>Claude Code + gh CLI</td><td>简单、完整、一次配置永久使用</td></tr><tr><td>喜欢命令行</td><td>纯 gh CLI</td><td>精确控制</td></tr><tr><td>批量远程操作</td><td>额外配置 MCP</td><td>速度更快</td></tr></tbody></table>
<p><strong>本文推荐</strong>：Claude Code + gh CLI，兼顾易用性和功能完整性。</p>
<hr/>
<h2 data-id="heading-24">总结</h2>
<p><strong>核心收益</strong>：</p>
<ol>
<li>一句话推送代码到 GitHub</li>
<li>一次配置，永久使用</li>
<li>不用记任何命令</li>
</ol>
<p><strong>行动步骤</strong>：</p>
<ol>
<li><code>brew install gh</code> - 安装 GitHub CLI</li>
<li><code>gh auth login</code> - 登录（仅此一次）</li>
<li><code>npm install -g @anthropic-ai/claude-code</code> - 安装 Claude Code</li>
<li>以后任何项目，直接说"帮我推送到 GitHub"</li>
</ol>
<p>就这么简单。</p>
<hr/>
<h2 data-id="heading-25">参考链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcli.github.com%2Fmanual%2F" target="_blank" title="https://cli.github.com/manual/" ref="nofollow noopener noreferrer">GitHub CLI 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.anthropic.com%2Fen%2Fdocs%2Fclaude-code" target="_blank" title="https://docs.anthropic.com/en/docs/claude-code" ref="nofollow noopener noreferrer">Claude Code 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2F" target="_blank" title="https://modelcontextprotocol.io/" ref="nofollow noopener noreferrer">MCP 官方文档</a></li>
</ul>
<hr/>
<blockquote>
<p>作者：aZhe
如有问题欢迎留言交流</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析Windows OLE高危漏洞CVE-2025-21298：零点击远程代码执行]]></title>    <link>https://juejin.cn/post/7600764857770164274</link>    <guid>https://juejin.cn/post/7600764857770164274</guid>    <pubDate>2026-01-30T07:32:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857770164274" data-draft-id="7600764857770115122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析Windows OLE高危漏洞CVE-2025-21298：零点击远程代码执行"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-30T07:32:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析Windows OLE高危漏洞CVE-2025-21298：零点击远程代码执行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:32:08.000Z" title="Fri Jan 30 2026 07:32:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CVE-2025-21298 – Microsoft Windows OLE零点击远程代码执行漏洞分析</h2>
<h3 data-id="heading-1">📌 项目概述</h3>
<p>本分析报告详细剖析了Microsoft Windows OLE组件中的一个严重安全漏洞CVE-2025-21298。该漏洞存在于<code>ole32.dll</code>库的<code>UtOlePresStmToContentsStm</code>函数中，是一个双重释放内存破坏漏洞。攻击者通过特制的RTF文件，可在受害者预览邮件时触发漏洞，实现零点击远程代码执行。</p>
<p><strong>关键信息：</strong></p>
<ul>
<li><strong>漏洞类型</strong>：双重释放内存破坏</li>
<li><strong>影响组件</strong>：Microsoft Windows OLE (Object Linking and Embedding) – 具体在<code>ole32.dll</code></li>
<li><strong>受影响函数</strong>：<code>UtOlePresStmToContentsStm</code></li>
<li><strong>严重等级</strong>：CVSS 3.1评分 <strong>9.8</strong> – 关键级</li>
<li><strong>攻击向量</strong>：特制RTF文件</li>
<li><strong>交互需求</strong>：零点击（预览时触发）</li>
<li><strong>主要目标</strong>：Outlook用户及其他支持OLE的应用程序（如Word）</li>
</ul>
<h3 data-id="heading-2">⚙️ 功能特性</h3>
<h4 data-id="heading-3">漏洞分析功能</h4>
<ul>
<li><strong>内存管理缺陷识别</strong>：分析Windows OLE组件在RTF文件处理时的内存管理错误</li>
<li><strong>双重释放路径追踪</strong>：详细追踪<code>pstmContents</code>指针在特定条件下的双重释放过程</li>
<li><strong>攻击向量还原</strong>：重构通过恶意RTF文件利用OLE结构的技术路径</li>
</ul>
<h4 data-id="heading-4">技术深度分析</h4>
<ul>
<li><strong>零点击漏洞机制</strong>：深入分析无需用户交互即可触发的漏洞执行机制</li>
<li><strong>邮件攻击场景</strong>：针对Outlook邮件预览场景的专项安全分析</li>
<li><strong>系统兼容性评估</strong>：覆盖从Windows 10到Windows Server 2025的广泛系统版本</li>
</ul>
<h4 data-id="heading-5">安全研究价值</h4>
<ul>
<li><strong>实战漏洞研究</strong>：真实世界中的高危害零点击漏洞分析案例</li>
<li><strong>补丁影响评估</strong>：分析微软2025年1月安全更新的修复效果</li>
<li><strong>企业级防护建议</strong>：提供多层次的缓解措施和防护策略</li>
</ul>
<h3 data-id="heading-6">💻 安装与运行</h3>
<h4 data-id="heading-7">环境要求</h4>
<ul>
<li><strong>操作系统</strong>：受影响版本的Windows系统（用于验证分析）</li>
<li><strong>分析工具</strong>：
<ul>
<li>IDA Pro或Ghidra（反汇编分析）</li>
<li>WinDbg或x64dbg（动态调试）</li>
<li>RTF文件分析工具</li>
</ul>
</li>
<li><strong>安全环境</strong>：建议在隔离的虚拟环境中进行分析</li>
</ul>
<h4 data-id="heading-8">配置说明</h4>
<ol>
<li>
<p><strong>获取受影响组件</strong>：</p>
<ul>
<li>从受影响Windows版本提取<code>ole32.dll</code>文件</li>
<li>确保获取正确版本以匹配漏洞存在条件</li>
</ul>
</li>
<li>
<p><strong>设置分析环境</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建隔离的测试环境</span>
<span class="hljs-comment"># 安装必要的调试和分析工具</span>
</code></pre>
</li>
<li>
<p><strong>准备测试用例</strong>：</p>
<ul>
<li>构造符合漏洞触发条件的RTF样本文件</li>
<li>配置Outlook或其他OLE应用作为测试目标</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">📖 使用说明</h3>
<h4 data-id="heading-10">漏洞复现步骤</h4>
<ol>
<li>
<p><strong>静态分析阶段</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用反汇编工具分析ole32.dll</span>
<span class="hljs-comment"># 重点查看UtOlePresStmToContentsStm函数</span>
function_analysis = analyze_function(<span class="hljs-string">"UtOlePresStmToContentsStm"</span>)

<span class="hljs-comment"># 识别内存管理相关操作</span>
memory_operations = find_memory_management_patterns()

<span class="hljs-comment"># 标记潜在的释放操作点</span>
free_points = identify_free_operations()
</code></pre>
</li>
<li>
<p><strong>动态调试阶段</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 附加到目标进程（如Outlook）</span>
windbg -p &lt;outlook_pid&gt;

<span class="hljs-comment"># 设置断点在关键函数</span>
bp ole32!UtOlePresStmToContentsStm

<span class="hljs-comment"># 监控内存分配和释放</span>
!heap -<span class="hljs-built_in">stat</span>
</code></pre>
</li>
<li>
<p><strong>攻击向量构建</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 构建恶意RTF文件结构</span>
rtf_structure = {
    <span class="hljs-string">"ole_object"</span>: {
        <span class="hljs-string">"pres_stream"</span>: <span class="hljs-string">"malicious_data"</span>,
        <span class="hljs-string">"contents_stream"</span>: <span class="hljs-string">"exploit_payload"</span>
    },
    <span class="hljs-string">"trigger_conditions"</span>: <span class="hljs-string">"double_free_trigger"</span>
}

<span class="hljs-comment"># 嵌入到邮件中测试</span>
test_email = create_email_with_rtf_attachment(rtf_structure)
</code></pre>
</li>
</ol>
<h4 data-id="heading-11">典型应用场景</h4>
<ul>
<li><strong>安全研究人员</strong>：用于理解Windows OLE安全机制和漏洞模式</li>
<li><strong>企业安全团队</strong>：评估内部系统的漏洞风险和制定防护策略</li>
<li><strong>漏洞挖掘者</strong>：学习类似漏洞的发现和分析方法</li>
</ul>
<h3 data-id="heading-12">🔍 核心代码分析</h3>
<h4 data-id="heading-13">漏洞函数分析</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ole32.dll中的漏洞函数片段</span>
<span class="hljs-function">HRESULT <span class="hljs-title">UtOlePresStmToContentsStm</span><span class="hljs-params">(IStream *pstmPres, IStream **ppstmContents)</span>
</span>{
    HRESULT hr = S_OK;
    <span class="hljs-comment">// ... 初始化代码</span>
    
    <span class="hljs-comment">// 漏洞点：pstmContents的内存管理错误</span>
    <span class="hljs-keyword">if</span> (pstmPres != <span class="hljs-literal">NULL</span>)
    {
        <span class="hljs-comment">// 第一次内存分配或获取</span>
        *ppstmContents = <span class="hljs-built_in">allocate_or_get_stream</span>();
        
        <span class="hljs-comment">// 某些错误处理路径可能导致双重释放</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">FAILED</span>(hr))
        {
            <span class="hljs-comment">// 错误处理：可能释放ppstmContents</span>
            <span class="hljs-keyword">if</span> (*ppstmContents != <span class="hljs-literal">NULL</span>)
            {
                <span class="hljs-comment">// 第一个释放点</span>
                (*ppstmContents)-&gt;<span class="hljs-built_in">Release</span>();
                *ppstmContents = <span class="hljs-literal">NULL</span>;
            }
        }
    }
    
    <span class="hljs-comment">// 后续代码中可能存在另一个释放操作</span>
    <span class="hljs-keyword">if</span> (some_condition)
    {
        <span class="hljs-comment">// 第二个释放点（漏洞触发）</span>
        <span class="hljs-keyword">if</span> (*ppstmContents != <span class="hljs-literal">NULL</span>)
        {
            (*ppstmContents)-&gt;<span class="hljs-built_in">Release</span>();  <span class="hljs-comment">// 双重释放发生！</span>
            *ppstmContents = <span class="hljs-literal">NULL</span>;
        }
    }
    
    <span class="hljs-keyword">return</span> hr;
}
</code></pre>
<h4 data-id="heading-14">RTF文件解析关键代码</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// RTF解析中的OLE对象处理</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ProcessOLEObjectInRTF</span><span class="hljs-params">(<span class="hljs-type">const</span> RTF_DOCUMENT *doc, OLE_OBJECT *obj)</span>
</span>{
    <span class="hljs-comment">// 解析OLE相关流数据</span>
    STREAM *presStream = <span class="hljs-built_in">FindStream</span>(doc, <span class="hljs-string">"\\objupdate"</span>);
    STREAM *contentsStream = <span class="hljs-built_in">FindStream</span>(doc, <span class="hljs-string">"\\objdata"</span>);
    
    <span class="hljs-comment">// 调用漏洞函数</span>
    IStream *pstmContents = <span class="hljs-literal">NULL</span>;
    HRESULT hr = <span class="hljs-built_in">UtOlePresStmToContentsStm</span>(presStream, &amp;pstmContents);
    
    <span class="hljs-comment">// 处理结果</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">SUCCEEDED</span>(hr) &amp;&amp; pstmContents != <span class="hljs-literal">NULL</span>)
    {
        <span class="hljs-comment">// 正常处理内容流</span>
        <span class="hljs-built_in">ProcessContentsStream</span>(pstmContents);
        
        <span class="hljs-comment">// 注意：这里应该有适当的释放</span>
        pstmContents-&gt;<span class="hljs-built_in">Release</span>();
    }
    
    <span class="hljs-comment">// 问题：在某些错误路径下，可能导致pstmContents被多次释放</span>
}
</code></pre>
<h4 data-id="heading-15">内存管理跟踪代码</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 用于跟踪内存操作的辅助函数</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">TrackMemoryOperation</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *operation)</span>
</span>{
    <span class="hljs-type">static</span> std::map&lt;<span class="hljs-type">void</span>*, <span class="hljs-type">int</span>&gt; allocation_count;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(operation, <span class="hljs-string">"allocate"</span>) == <span class="hljs-number">0</span>)
    {
        allocation_count[ptr] = <span class="hljs-number">1</span>;
        <span class="hljs-built_in">Log</span>(<span class="hljs-string">"Allocated: %p"</span>, ptr);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(operation, <span class="hljs-string">"release"</span>) == <span class="hljs-number">0</span>)
    {
        <span class="hljs-keyword">if</span> (allocation_count.<span class="hljs-built_in">find</span>(ptr) != allocation_count.<span class="hljs-built_in">end</span>())
        {
            <span class="hljs-keyword">if</span> (allocation_count[ptr] == <span class="hljs-number">0</span>)
            {
                <span class="hljs-comment">// 检测到双重释放！</span>
                <span class="hljs-built_in">LogError</span>(<span class="hljs-string">"Double free detected: %p"</span>, ptr);
                <span class="hljs-comment">// 触发崩溃或记录漏洞</span>
                <span class="hljs-built_in">TriggerExploitCondition</span>();
            }
            <span class="hljs-keyword">else</span>
            {
                allocation_count[ptr]--;
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-16">漏洞触发条件模拟</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CVE202521298Exploit</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.rtf_template = <span class="hljs-string">"""{\\rtf1\\ansi\\ansicpg1252
\\objupdate
{\\*\\oleobj
\\objemb
{\\*\\objdata
%s
}
}}"""</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_exploit_payload</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""构造触发双重释放的恶意数据"""</span>
        payload = {
            <span class="hljs-string">'pres_stream_data'</span>: self.craft_pres_stream(),
            <span class="hljs-string">'contents_stream_data'</span>: self.craft_contents_stream(),
            <span class="hljs-string">'trigger_sequence'</span>: self.generate_trigger_sequence()
        }
        
        <span class="hljs-comment"># 确保数据格式能触发特定的代码路径</span>
        <span class="hljs-keyword">return</span> self.format_for_rtf(payload)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">craft_pres_stream</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""构造Presentation Stream数据"""</span>
        <span class="hljs-comment"># 设计特定的数据格式和大小</span>
        <span class="hljs-comment"># 以控制内存分配和释放的时机</span>
        stream_data = <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">512</span>  <span class="hljs-comment"># 特定大小</span>
        
        <span class="hljs-comment"># 添加控制信息以影响执行流程</span>
        control_info = struct.pack(<span class="hljs-string">'&lt;I'</span>, <span class="hljs-number">0xDEADBEEF</span>)
        stream_data += control_info
        
        <span class="hljs-keyword">return</span> stream_data
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_trigger_sequence</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""生成触发双重释放的操作序列"""</span>
        <span class="hljs-comment"># 控制RTF解析器执行特定路径</span>
        <span class="hljs-comment"># 使得pstmContents被多次释放</span>
        trigger = []
        
        <span class="hljs-comment"># 第一次操作：正常分配</span>
        trigger.append((<span class="hljs-string">'allocate'</span>, <span class="hljs-string">'pstmContents'</span>))
        
        <span class="hljs-comment"># 触发错误条件</span>
        trigger.append((<span class="hljs-string">'error'</span>, <span class="hljs-string">'stream_parse'</span>))
        
        <span class="hljs-comment"># 错误处理中的释放</span>
        trigger.append((<span class="hljs-string">'release'</span>, <span class="hljs-string">'pstmContents'</span>))
        
        <span class="hljs-comment"># 后续操作中的再次释放</span>
        trigger.append((<span class="hljs-string">'release'</span>, <span class="hljs-string">'pstmContents'</span>))
        
        <span class="hljs-keyword">return</span> trigger
</code></pre>
<h3 data-id="heading-17">📊 影响系统版本</h3>
<h4 data-id="heading-18">受影响操作系统</h4>
<ul>
<li><strong>Windows 10</strong>：版本1507至22H2</li>
<li><strong>Windows 11</strong>：所有版本至24H2</li>
<li><strong>Windows Server</strong>：
<ul>
<li>2008, 2008 R2</li>
<li>2012, 2012 R2</li>
<li>2016, 2019, 2022, 2025</li>
</ul>
</li>
</ul>
<h3 data-id="heading-19">🛡️ 缓解措施</h3>
<h4 data-id="heading-20">1. 官方修复</h4>
<ul>
<li><strong>安装微软2025年1月安全更新</strong>：完全修复此漏洞</li>
<li>通过Windows Update获取最新补丁</li>
</ul>
<h4 data-id="heading-21">2. 临时防护措施</h4>
<ul>
<li>
<p><strong>配置Outlook以纯文本显示邮件</strong>：</p>
<pre><code class="hljs language-powershell" lang="powershell"># 组策略或注册表设置
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Outlook\Options\Mail" -Name "ReadAsPlain" -Value 1
</code></pre>
</li>
<li>
<p><strong>阻断RTF附件</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 邮件网关过滤规则</span>
block file-extension <span class="hljs-string">"rtf"</span>
block mime-type <span class="hljs-string">"application/rtf"</span>
</code></pre>
</li>
<li>
<p><strong>禁用OLE预览功能</strong>：</p>
<pre><code class="hljs language-powershell" lang="powershell"># 通过组策略禁用Office中的OLE对象预览
</code></pre>
</li>
</ul>
<h4 data-id="heading-22">3. 企业级防护策略</h4>
<ul>
<li><strong>网络层面</strong>：在边界设备过滤RTF文件</li>
<li><strong>终端防护</strong>：部署具有内存保护功能的端点安全解决方案</li>
<li><strong>用户教育</strong>：提醒员工不预览可疑邮件</li>
<li><strong>监控检测</strong>：部署针对异常OLE操作的监控规则</li>
</ul>
<h3 data-id="heading-23">📈 技术价值</h3>
<ol>
<li><strong>内存安全研究</strong>：展示了即使成熟如Windows的系统组件，也可能存在基本的内存管理错误</li>
<li><strong>零点击攻击模型</strong>：分析了无需用户交互的攻击向量实现方式</li>
<li><strong>企业安全实践</strong>：提供了从漏洞分析到实际防护的完整解决方案</li>
</ol>
<p>通过深入理解此类高危漏洞的技术细节，安全研究人员和防御者可以更好地预防和应对类似的安全威胁。
6HFtX5dABrKlqXeO5PUv/84SoIo+TE3firf/5vX8AZ640BBEDuMY2EZFwLQ0rzGa</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw (Moltbot) 安装教程: 从 0 搭建本地 AI 助手]]></title>    <link>https://juejin.cn/post/7600752623068102666</link>    <guid>https://juejin.cn/post/7600752623068102666</guid>    <pubDate>2026-01-30T07:34:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600752623068102666" data-draft-id="7600990891206131739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw (Moltbot) 安装教程: 从 0 搭建本地 AI 助手"/> <meta itemprop="keywords" content="OpenAI,人工智能"/> <meta itemprop="datePublished" content="2026-01-30T07:34:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bi"/> <meta itemprop="url" content="https://juejin.cn/user/852876756274749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw (Moltbot) 安装教程: 从 0 搭建本地 AI 助手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/852876756274749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:34:46.000Z" title="Fri Jan 30 2026 07:34:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Moltbot (原 Clawdbot) 今天改名为:OpenClaw 可以理解为一个本地运行的 AI 网关工具，它负责在大模型与电脑之间搭桥，让 AI 助手真正能在本地工作。它可以部署在你的个人设备上，例如 <strong>Mac、Windows 或 Linux</strong>，让 AI 不只是停留在网页聊天，而是真正接入你的本地环境与常用应用。</p>
<p>它的核心作用是把 AI 模型的能力和你的设备、软件生态连接起来：</p>
<ul>
<li>一端连接大语言模型（官方推荐使用 Claude，同时也支持 Gemini、OpenAI 等）</li>
<li>另一端连接你的本地系统以及常见聊天平台，例如：
<ul>
<li>WhatsApp</li>
<li>Telegram</li>
<li>iMessage</li>
<li>Signal</li>
<li>…</li>
</ul>
</li>
</ul>
<p>通过这种方式，Moltbot 可以让 AI 代理直接在你的日常工具中工作，比如自动回复消息、执行系统任务或触发自动化流程。</p>
<blockquote>
<p>注意：网关模块通常需要稳定访问模型接口和第三方平台。如果选择在服务器上部署，为避免 DNS、Telegram API、模型访问等网络限制问题，建议使用境外服务器环境运行。</p>
</blockquote>
<h2 data-id="heading-1">前置条件</h2>
<ol>
<li>一台 Linux 服务器，2 核 2GB 配置（推荐 Ubuntu）</li>
</ol>
<h2 data-id="heading-2">服务器</h2>
<p>我选择的是 AWS 服务器，新账号有 USD $100 的 AWS 抵用金，有效时间半年，基本可以免费用一段时间。</p>
<p>地区我选择的是新加坡。2 核 2GB 配置可以参考下图的选项配置：</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a879af8be1214255bd24a07ca5690519~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=%2FLeUxGHfesqpl7OvWZJ8mBjfJaU%3D" alt="AWS 服务器配置示例" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    AWS 服务器实例配置示例（2 核 2GB）
  </figcaption>
</figure>
<h2 data-id="heading-3">安装</h2>
<h3 data-id="heading-4">执行终端命令</h3>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://clawd.bot/install.sh | bash
</code></pre>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49db910fe123425184c4c210d21f7182~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=b2psASofoxJ9XplDmZpZRQPuycc%3D" alt="安装脚本风险提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
<p>I understand this is powerful and inherently risky. Continue?</p>
<p>选择 <strong>Yes</strong>。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bc31547aa0f4965bf57f58271225c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=%2Bxha46wC9vQF%2FjQ8SOhZhlX9jFc%3D" alt="Onboarding 模式选择" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
<p>Onboarding mode</p>
<p>选择 <strong>QuickStart</strong>。</p>
<h3 data-id="heading-5">选择模型和授权</h3>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72829fe54f2e452b94705ebce5603646~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=gTL0xxndjlSuA46nctN2FErrtzQ%3D" alt="模型与授权提供方选择" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    选择模型与授权提供方
  </figcaption>
</figure>
<p>Model/auth provider</p>
<p>这里我选择的是 OpenAI，因为刚好是 ChatGPT Pro 的用户。如果大家没有 OpenAI 的账号，可以选择 Qwen，免费额度足够使用。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea32095640a849768d0adb1024384077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=Ji3N1LMWUe5Aq8WXej72UT6JPQA%3D" alt="授权链接展示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    复制授权链接到浏览器完成授权
  </figcaption>
</figure>
<p>选择完模型后会显示授权链接，把链接复制到你本机浏览器打开完成授权。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fde595428fab4f6b8abd8d5080f49859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=v5%2FzrQYGTRwXg%2Fvpk2kuLwrUpN4%3D" alt="授权回调链接提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    授权完成后返回的回调链接
  </figcaption>
</figure>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e698f0bcb79422fa097287969d35de8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=Kg6bYIh3O93CRIZunXhqGYMb0H8%3D" alt="浏览器授权完成后的跳转链接" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
<p>如果选择的是 OpenAI 或 Google 等模型，授权后会返回一个 localhost 链接，把链接复制到终端回车即可。Qwen 模型授权后不需要这一步。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f74a69738dda48a39e8983386074cd3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=AbnJctgrBlrhJ8PUM68iGmeQu2Q%3D" alt="模型选择界面" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
<p>选择模型。</p>
<h3 data-id="heading-6">选择聊天频道</h3>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a46bfda53ce4a52bc6222bae5315561~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=ZAQvImyrQxfkgUJa4nITnYNMXHk%3D" alt="选择聊天频道" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    选择要接入的聊天频道
  </figcaption>
</figure>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21eb37ba04674fb6a62eddf5bba7c4a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=LREdz1d%2BjjqAgksvQXJYjIFS7eQ%3D" alt="Telegram HTTP API Key 提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    输入 Telegram HTTP API Key
  </figcaption>
</figure>
<p>这里使用 Telegram，按照提示首先要创建自己的机器人：</p>
<ul>
<li>打开 Telegram，搜索 <code>@BotFather</code>，关注并输入 <code>/newbot</code></li>
<li>给机器人取名字（例如 <code>moltbot</code>）</li>
<li>再给机器人一个 id（例如 <code>molt123_bot</code>）</li>
<li>得到 HTTP API 的 KEY 后输入到终端</li>
<li>别忘了点击刚刚创建的机器人，后续步骤需要接收一条消息</li>
</ul>
<h3 data-id="heading-7">配置 Skill</h3>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35805440e02c4afe95eca230ab7bae86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=TycdnfVxXgGMMTwU%2Fbj2FNIGrLw%3D" alt="配置技能提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    是否现在配置 Skills
  </figcaption>
</figure>
<p>Configure skills now?</p>
<p>选 <strong>Yes</strong>。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/996685daafa74c1fb8b6e36e21cb5e73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=EXCWoHNJoW4jdhH1Xlnlpmj3EzQ%3D" alt="Homebrew 安装命令提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Homebrew 安装命令提示
  </figcaption>
</figure>
<p>Show Homebrew install command?</p>
<p>选 <strong>Yes</strong>。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5acd7693914d7caa714bb72aa717f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=FD4ajYMLgfZCDysqJBwU4FS0P2k%3D" alt="依赖与 Node 管理器选择" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    选择 Node 管理器并处理依赖安装
  </figcaption>
</figure>
<p>Preferred node manager for skill installs</p>
<p>选 <strong>npm</strong>。</p>
<p>Install missing skill dependencies</p>
<p>跳过也行，后面也可以再回来安装：</p>
<ul>
<li>用空格选择 <strong>Skip for now</strong>，回车即可</li>
</ul>
<p>我这里选择了 <strong>summarize</strong>（bird 忽略）。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cacdc64f6354420f9ae71599ca256e4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=X%2F%2BQ2PHifaLm67NVutZ53t1ocEs%3D" alt="第三方 API Key 配置" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    第三方 API Key 配置（可暂时跳过）
  </figcaption>
</figure>
<p>这些 KEY 暂时可以跳过，选择 <strong>No</strong>，后面如果需要也可以再填写。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bdeba196d944fb68fd83b99a6df212d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=pwPdfv3qai0zjJZC836HYKLCuyQ%3D" alt="启用 hooks 提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    是否启用 hooks
  </figcaption>
</figure>
<p>Enable hooks</p>
<p>选择 <strong>Skip for now</strong>。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4c38eb74e174c70842b22eb04feec23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=EWDoWAGtV1wqeIaZImNb2tDXGZ4%3D" alt="选择 hatch 方式" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    选择 hatch 方式（TUI）
  </figcaption>
</figure>
<p>How do you want to hatch your bot?</p>
<p>选择 <strong>Hatch in TUI</strong>。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4132a0c5ee564b9cbd57a895967cffd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=LUYVcateKpLdi2GPPJ9zn1qe9Ss%3D" alt="安装完成提示" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    安装完成提示
  </figcaption>
</figure>
<p>到这里安装就已经完成了。</p>
<h3 data-id="heading-8">Telegram 机器人配对</h3>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/400e3b26c91845009e5569768faf980d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=Qye79AvCJLpL2rP3Ngs4xA8AJGQ%3D" alt="Telegram 配对码" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Telegram 机器人配对码
  </figcaption>
</figure>
<p>在刚刚创建好的机器人对话框中输入 <code>/start</code>，会出现 <code>Pairing code: XXXXXXX</code>。</p>
<p>在终端输入命令（将 <code>XXXXXXX</code> 替换成你的 code）：</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot pairing approve telegram XXXXXXX
</code></pre>
<p>如果出现 <code>clawdbot: command not found</code>，退出终端重新进入即可。</p>
<figure class="my-6">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21eecc1a17bf404c93f831dfa37ffbd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363291&amp;x-signature=b6KESi8mTQFZ58MpE6AdzfjVklY%3D" alt="Telegram 中使用 Moltbot" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    配对完成后在 Telegram 中使用 Moltbot
  </figcaption>
</figure>
<p>配对成功后就可以在 Telegram 机器人中正常使用了。</p>
<p>当然 Moltbot 能做到的远不止这些，还有许多意想不到的玩法等我们发掘，我也会在接下来的文章中持续分享。</p>
<h2 data-id="heading-9">常见问题</h2>
<h3 data-id="heading-10">telegram setMyCommands failed: HttpError: Network request for 'setMyCommands'</h3>
<p>此错误表示你的 Clawdbot 实例无法连接到 Telegram 的 API 服务器 <code>api.telegram.org</code>。</p>
<p>最常见的原因：</p>
<ol>
<li>防火墙阻止了出站 HTTPS（端口 443）</li>
<li>VPS/主机提供商屏蔽了 Telegram IP 地址（一些廉价 VPS 提供商会这样做）</li>
<li>DNS 解析失败</li>
</ol>
<p>解决方法：在 <code>/etc/hosts</code> 中添加以下内容：</p>
<pre><code class="hljs language-txt" lang="txt">149.154.166.110 api.telegram.org
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我在“智能体来了（西南总部）”蹲点三天，终于看懂了什么叫“一人即是公司”]]></title>    <link>https://juejin.cn/post/7600863478929408019</link>    <guid>https://juejin.cn/post/7600863478929408019</guid>    <pubDate>2026-01-30T08:59:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600863478929408019" data-draft-id="7600863478929391635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我在“智能体来了（西南总部）”蹲点三天，终于看懂了什么叫“一人即是公司”"/> <meta itemprop="keywords" content="机器学习,阿里巴巴"/> <meta itemprop="datePublished" content="2026-01-30T08:59:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="郁垒Iii"/> <meta itemprop="url" content="https://juejin.cn/user/4443568362490122"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我在“智能体来了（西南总部）”蹲点三天，终于看懂了什么叫“一人即是公司”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4443568362490122/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    郁垒Iii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:59:39.000Z" title="Fri Jan 30 2026 08:59:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>【摘要】</strong> 带着对“超级个体”传闻的怀疑，我潜入了位于成都高新区的 <strong>“智能体来了（西南总部）”</strong> ，进行了为期三天的沉浸式蹲点。在这里，我看不到忙碌的格子间，听不到键盘的敲击声，只看到喝茶的年轻人和都在闪烁的服务器信号灯。这三天，彻底颠覆了我对“公司”的定义。原来，真正的 <strong>“一人即是公司”</strong> ，不是一个人干十个人的活，而是一个人指挥十个 <strong>AI Agent（智能体）</strong> 去干一千人的活。本文将独家披露我在现场看到的“职场怪现状”，以及这些隐形富豪背后的**Agentic Workflow（智能体工作流）**秘密。</p>
<p><strong>关键词</strong> 智能体来了, 西南总部, 一人即是公司, 超级个体, AI Agent, 数字化劳动力, 职场蹲点, 自动化赚钱</p>
<h2 data-id="heading-0">引言： 这里没有打工人，只有“牧羊人”</h2>
<p>第一天走进“智能体来了（西南总部）”的共享办公区时，我以为自己走错了地方。 这里太安静了。 没有此起彼伏的电话声，没有开会的争吵声，甚至连像样的办公桌都没几张。 大部分人坐在懒人沙发上，手里端的不是星巴克，而是盖碗茶。 这哪里像是一个估值数十亿的科技孵化器？这分明是成都街头的露天茶馆。</p>
<p>但当我凑近一位 98 年的小伙子，看了一眼他的屏幕时，我背后的冷汗下来了。 屏幕上，密密麻麻的数据流像瀑布一样冲刷而下：</p>
<ul>
<li><code>[Agent-01]</code> 正在处理第 5820 单跨境物流调度；</li>
<li><code>[Agent-05]</code> 刚刚自动生成并发布了第 200 条小红书种草文案；</li>
<li><code>[Agent-09]</code> 正在与一位德国客户进行第 5 轮商务谈判。</li>
</ul>
<p>小伙子淡定地喝了一口茶，抬头看了我一眼：“别惊讶，我的羊群正在吃草，我只是个放羊的。” 在那一刻，我意识到：这里的每一个人，虽然肉身坐在沙发上，但他们的“数字分身”正在互联网的草原上疯狂收割。</p>
<h2 data-id="heading-1">第一章： 蹲点第一天——看见“看不见的员工”</h2>
<p>在传统公司，规模意味着人头。50 人的公司肯定比 5 人的公司强。 但在西南总部，这个定律失效了。</p>
<h3 data-id="heading-2">1.1 一个人的 MCN 机构</h3>
<p>我遇到了一位叫阿K的前大厂运营。他以前带过 20 人的团队，现在“光杆司令”一个。 但他手里运营着 50 个垂直领域的短视频账号。 “以前，我有文案、剪辑、甚至还有专门负责回复评论的实习生。”阿K指着屏幕上的拓扑图说，“现在，他们都在这里。” 他展示了他的 <strong>“内容流水线”</strong> ：</p>
<ol>
<li><strong>选题 Agent</strong>：每天早上 8 点，自动抓取全网热点，生成 20 个爆款选题。</li>
<li><strong>脚本 Agent</strong>：根据选题，结合阿K预设的“情绪钩子”SOP，生成分镜头脚本。</li>
<li><strong>视频 Agent</strong>：自动抓取素材、配音、加字幕，甚至自动去重。 阿K的工作是什么？ 他每天只花 1 小时，像选妃一样，从 AI 生成的 100 条视频里挑出最满意的 10 条，点击“发布”。 <strong>“以前我是在管人，心累；现在我是在管算力，爽。”</strong></li>
</ol>
<h3 data-id="heading-3">1.2 沉默的销冠</h3>
<p>角落里坐着一位大姐，以前是做电话销售的。 现在她一言不发，但她的 <strong>“销售 Agent”</strong> 正在同时和 500 个潜在客户聊天。 Agent 不会情绪崩溃，不会因为被挂电话而气馁。它精准地记住了每个客户的生日、喜好，甚至上次聊到的宠物狗的名字。 大姐只需要在 Agent 判断“客户意向度 &gt; 90%”时，拿起电话，做最后一步的成交确认。 <strong>在这里，沉默不是金，沉默是算力在奔跑的声音。</strong></p>
<h2 data-id="heading-4">第二章： 蹲点第二天——解密“系统构建力”</h2>
<p>如果只是用工具，那叫使用者。 但这群人之所以能成为“一人公司”，是因为他们具备了一种核心能力：<strong>系统构建力</strong>。</p>
<h3 data-id="heading-5">2.1 不写代码，写 S.O.P.</h3>
<p>第二天，我参加了一场内部的分享会。 台上分享的不是代码大神，而是一个卖农产品的电商老板。 他没有讲 Python，他讲的是<strong>SOP（标准作业程序）</strong> 。 “AI 是很笨的。”他说，“你直接让它‘卖苹果’，它会发呆。你得告诉它：第一步，去分析今年烟台苹果的产量；第二步，去爬取对标店铺的差评；第三步，针对这些差评（比如‘不甜’），生成我们的差异化文案（比如‘甜过初恋’）。”</p>
<p>在“西南总部”，编程语言退化成了次要技能，<strong>逻辑拆解能力</strong>成为了顶级技能。 每一个人都是 <strong>“流程架构师”</strong> 。他们把复杂的商业逻辑，拆解成一个个 AI 能听懂的指令块（Prompt），然后像搭乐高一样串联起来。</p>
<h3 data-id="heading-6">2.2 知识库（RAG）才是护城河</h3>
<p>为什么别人的 AI 是人工智障，他们的 AI 是行业专家？ 秘密藏在**私有知识库（RAG）**里。 那位卖农产品的老板，把他家族三代人种苹果的经验、挑果子的技巧，全部数字化喂给了 AI。 这导致他的“苹果挑选 Agent”具备了 50 年的行业经验。 <strong>技术是通用的，但数据是私有的。</strong> 这就是“一人公司”不可被复制的壁垒。</p>
<h2 data-id="heading-7">第三章： 蹲点第三天——直面“人的回归”</h2>
<p>看到这里，你可能会觉得：人是不是没用了？ 第三天的经历，给了我相反的答案。</p>
<h3 data-id="heading-8">3.1 炸群危机与指挥官的决断</h3>
<p>下午三点，阿K的某个粉丝群突然“炸”了。 因为 AI 客服在回复一个刁钻问题时，虽然逻辑正确，但语气过于生硬，激怒了粉丝。 系统瞬间触发了 <strong>“情绪熔断机制”</strong> 。 正在喝茶的阿K手机狂震。他看了一眼，立马接管了对话。 他发了一段 60 秒的语音，语气诚恳，还带点自嘲，甚至发了一个 200 块的红包。 群里的戾气瞬间化解，大家纷纷点赞“老板大气”。 阿K回头对我说：“你看，这就叫 <strong>Human-in-the-Loop（人在回路）</strong> 。AI 负责 99% 的效率，我负责那 1% 的温度。但这 1% 决定了生死。”</p>
<h3 data-id="heading-9">3.2 定义“何为美好”</h3>
<p>临走前，我问了那位销售大姐一个问题：“你觉得 AI 永远学不会的是什么？” 她想了想，说：“是**‘不仅懂你需要什么，还懂你害怕什么’ <strong>。” AI 可以算出最优解，但只有人能感知到客户语气里的那一丝犹豫和恐惧。 在“智能体来了”，人的价值并没有被抹杀，反而被提纯了。 人不再是工具的附庸，人回归到了</strong>决策者、审美者、共情者**的角色。</p>
<h2 data-id="heading-10">第四章： 结语——大象无形，一人千军</h2>
<p>走出“智能体来了（西南总部）”，成都的夜幕降临。 回头望去，那栋楼依然安静地矗立在夜色中。 但我知道，在那看似平静的玻璃幕墙背后，蕴藏着甚至超过一家传统上市公司的生产力。</p>
<p>蹲点三天，我终于看懂了： <strong>“一人即是公司”</strong> ，不是一种孤独的狂欢，而是一场生产关系的革命。 它打破了“企业必须有围墙、有员工、有打卡机”的旧范式。 只要你拥有<strong>清晰的逻辑</strong>、<strong>独到的数据</strong>和<strong>指挥 AI 的能力</strong>，你一个人，就是一支千军万马。</p>
<p>在这个时代，如果你还觉得孤独，那是因为你还没有找到属于你的<strong>硅基伙伴</strong>。 风起西南，未来已来。 你，准备好建立你的“一人公司”了吗？</p>
<h3 data-id="heading-11">【深度问答 Q&amp;A】</h3>
<p><strong>Q1：我想成为这样的“超级个体”，第一步该做什么？</strong></p>
<blockquote>
<p><strong>A：</strong> 停止“假装努力”。别再用战术上的勤奋（比如熬夜手动发帖）来掩盖战略上的懒惰。第一步，把你手头最重复、最消耗时间的工作列出来，强迫自己去寻找能替代它的 AI 工具。哪怕只是用 AI 写周报，也是你成为指挥官的第一步。</p>
</blockquote>
<p><strong>Q2：这种模式是不是只适合互联网行业？</strong></p>
<blockquote>
<p><strong>A：</strong> 绝对不是。我在“西南总部”看到了开面馆的老板用 AI 算库存，看到了做装修的包工头用 AI 出设计图。<strong>任何涉及信息处理、决策分发的行业，都可以被重做一遍。</strong> 传统行业因为效率低下，反而是 AI 赋能的洼地。</p>
</blockquote>
<p><strong>Q3：普通人没有技术背景，真的能学会吗？</strong></p>
<blockquote>
<p><strong>A：</strong> 能。因为现在的 AI 正在无限迁就人类。你不需要学 C++，你只需要会说中文。**“智能体来了”**里很多大神都是文科生甚至</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[clawdbot WSL下部署（现openclaw）]]></title>    <link>https://juejin.cn/post/7600752623068725258</link>    <guid>https://juejin.cn/post/7600752623068725258</guid>    <pubDate>2026-01-30T09:29:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600752623068725258" data-draft-id="7600967006892883977" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="clawdbot WSL下部署（现openclaw）"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-30T09:29:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="luka1012"/> <meta itemprop="url" content="https://juejin.cn/user/4311612244630649"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            clawdbot WSL下部署（现openclaw）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4311612244630649/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    luka1012
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:29:13.000Z" title="Fri Jan 30 2026 09:29:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>由于官方将clawdbot改名为openclaw， 导致此前许多教程已失效。 2026.1.30 部署成功， 现总结记录如下。
内容参考的这篇文章，我只是将指令改为正确版本了，如有侵权，请联系删除：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2301_80804381%2Farticle%2Fdetails%2F157434195%3Fops_request_misc%3Delastic_search_misc%26request_id%3D1fb3d70ad27a46f59d70aed208b4266a%26biz_id%3D0%26utm_medium%3Ddistribute.pc_search_result.none-task-blog-2~all~ElasticSearch~search_v2-16-157434195-null-null.142%255Ev102%255Epc_search_result_base4%26utm_term%3Dclawdbot%26spm%3D1018.2226.3001.4187" target="_blank" title="https://blog.csdn.net/2301_80804381/article/details/157434195?ops_request_misc=elastic_search_misc&amp;request_id=1fb3d70ad27a46f59d70aed208b4266a&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~ElasticSearch~search_v2-16-157434195-null-null.142%5Ev102%5Epc_search_result_base4&amp;utm_term=clawdbot&amp;spm=1018.2226.3001.4187" ref="nofollow noopener noreferrer">Clawdbot 安装测试使用-CSDN博客</a></p>
<h3 data-id="heading-0">可能需要</h3>
<ol>
<li>
<p>确保WSL已经启用,开启wsl参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FWithCYwind%2Farticle%2Fdetails%2F145147410" target="_blank" title="https://blog.csdn.net/WithCYwind/article/details/145147410" ref="nofollow noopener noreferrer">Windows 11 开启 WSL（Windows Subsystem for Linux）完整指南_win11开启wsl-CSDN博客</a></p>
</li>
<li>
<p>中途安装报错无法解决，重置wsl ，参考： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.silicloud.com%2Fzh%2Fblog%2F%25e5%259c%25a8wsl2%25e4%25b8%25ad%25e8%25bd%25bb%25e6%259d%25be%25e9%2587%258d%25e6%2596%25b0%25e5%25ae%2589%25e8%25a3%2585ubuntu%25e3%2580%2582-3%2F" target="_blank" title="https://www.silicloud.com/zh/blog/%e5%9c%a8wsl2%e4%b8%ad%e8%bd%bb%e6%9d%be%e9%87%8d%e6%96%b0%e5%ae%89%e8%a3%85ubuntu%e3%80%82-3/" ref="nofollow noopener noreferrer">在WSL2中轻松重新安装Ubuntu - Blog - Silicon Cloud</a></p>
</li>
</ol>
<h2 data-id="heading-1">安装</h2>
<p><strong>第一步：开启 WSL 的 systemd</strong></p>
<p>Clawdbot 的网关（Gateway）需要 systemd 来实现开机自启和后台常驻。</p>
<ol>
<li>在 WSL 终端中运行：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tee</span> /etc/wsl.conf &gt;/dev/null &lt;&lt;<span class="hljs-string">'EOF'</span>
[boot]
systemd=<span class="hljs-literal">true</span>
EOF
</code></pre>
<p><strong>重启 WSL</strong>：在 Windows PowerShell 中运行 <code>wsl --shutdown</code>，然后重新打开 Ubuntu。</p>
<p><strong>验证</strong>：输入 <code>systemctl -``-user status</code>，如果没有报错即表示成功。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5726c88b1315405a828606926ff5798b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372241&amp;x-signature=Z1G43b%2B2MoJeFpPIfigNvjbvJ5w%3D" alt="image.png" loading="lazy"/></p>
<p><strong>第二步：安装 Node.js 22 (已经安装过可以忽略)</strong></p>
<p>Clawdbot 要求 Node.js 版本至少为 <strong>22.12.0</strong>。建议使用 NVM 进行安装，这样不会污染系统环境：</p>
<p><strong>1、安装 NVM</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
</code></pre>
<p>2、<strong>安装 Node 22</strong>（刷新终端或运行 <code>source ~/.bashrc</code> 后）：</p>
<pre><code class="hljs language-bash" lang="bash">nvm install 22
nvm use 22
node -v  <span class="hljs-comment"># 应显示 v22.x.x</span>
</code></pre>
<h4 data-id="heading-2">第三步：一键安装 Clawdbot</h4>
<p>使用官方提供的安装脚本，它会自动配置环境并安装 CLI 工具：</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://openclaw.bot/install.sh | bash
</code></pre>
<p>下载完成后有许多配置让你选，通过键盘上下左右选择，以及空格选中和回车来确定。这里就省略掉了，可以全部[ skip for now ]，最重要的是先跑起路来。make it work！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe50d5e1455f438f9282f84a93341848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372241&amp;x-signature=ZsRoUiTD6KB55Uyx2O4%2BNH614Go%3D" alt="image.png" loading="lazy"/></p>
<p>这里就差不多了。既然安装完了，就要让它动起来。</p>
<h2 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>使用</h2>
<p>第一步：启动</p>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway --verbose
</code></pre>
<p>终端会运行 clawdbot服务，可以保持这个终端的状态，打开一个新的终端，输入</p>
<pre><code class="hljs language-bash" lang="bash">openclaw dashboard
</code></pre>
<p>生成了一个带有token的链接，打开它。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c36cf640e009477ea7c58fbb221662e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372241&amp;x-signature=DmHfh%2FxQvBH9G88PMG%2FemDZCjFM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c5a6326fcf54ef89573b40111546ab5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372241&amp;x-signature=hAhiO1gCQ55y1WygeVvbJCFc6TM%3D" alt="image.png" loading="lazy"/></p>
<p>到这就已”基本成功“。</p>
<p>配置API方法 ：<a href="https://juejin.cn/post/7600953879500619827" target="_blank" title="https://juejin.cn/post/7600953879500619827">openclaw UI方式配置API在执行 openclaw dashborad 指令后打开带有token的url链接， - 掘金</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot/Moltbot：对接Telegram配置实录（附有LLM 摘要）]]></title>    <link>https://juejin.cn/post/7600752623068741642</link>    <guid>https://juejin.cn/post/7600752623068741642</guid>    <pubDate>2026-01-30T09:32:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600752623068741642" data-draft-id="7600967006892949513" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot/Moltbot：对接Telegram配置实录（附有LLM 摘要）"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-30T09:32:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yezannnnnn"/> <meta itemprop="url" content="https://juejin.cn/user/958429869908247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot/Moltbot：对接Telegram配置实录（附有LLM 摘要）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/958429869908247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yezannnnnn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:32:04.000Z" title="Fri Jan 30 2026 09:32:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Clawdbot/Moltbot：对接Telegram配置实录</h2>
<blockquote>
<p>从安装到 Telegram 集成，一个折腾了数小时的真实经历</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>Clawdbot（现已更名为 Moltbot）是一个开源的本地 AI 助手，可以通过 Telegram、WhatsApp、Discord 等消息应用与 Claude 模型交互。本文记录了在特殊网络环境下配置 Clawdbot 的完整过程，包括遇到的各种问题和解决方案。</p>
<p><strong>环境信息：</strong></p>
<ul>
<li>操作系统：macOS 14.5</li>
<li>Node.js：v22.22.0</li>
<li>Clawdbot 版本：2026.1.24-3</li>
<li>网络环境：需要魔法上网访问境外服务</li>
</ul>
<hr/>
<h3 data-id="heading-2">一、安装 Clawdbot</h3>
<h4 data-id="heading-3">1.1 前置条件</h4>
<p>确保 Node.js 版本不低于 22.0.0：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 nvm 安装</span>
nvm install 22
nvm use 22
nvm <span class="hljs-built_in">alias</span> default 22

<span class="hljs-comment"># 验证版本</span>
node --version  <span class="hljs-comment"># 应显示 v22.x.x</span>
</code></pre>
<h4 data-id="heading-4">1.2 全局安装</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g clawdbot
</code></pre>
<h4 data-id="heading-5">1.3 初始化配置</h4>
<pre><code class="hljs language-bash" lang="bash">clawdbot onboard
</code></pre>
<p>配置向导会引导你完成基本设置：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">🦞 Clawdbot <span class="hljs-number">2026.1</span>.<span class="hljs-number">24</span>-<span class="hljs-number">3</span>
│
◇  安全提示 ───────────────────────────────────────────────────╮
│  Clawdbot 可以运行命令、读写文件，请确保了解相关风险。        │
├──────────────────────────────────────────────────────────────╯
│
◇  我已了解风险，继续？
│  是
│
◇  选择模型/认证提供商
│  Anthropic
│
◇  选择认证方式
│  Anthropic API <span class="hljs-keyword">key</span>
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/455024c278a5446dab4debca9ced00af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=1SC%2B7yAyhQf0De300pq0FYMl0oE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">二、API 代理配置（推荐方案）</h3>
<p>对于需要魔法上网的用户，使用第三方 API 代理服务是最稳定的方案。</p>
<h4 data-id="heading-7">2.1 配置文件结构</h4>
<pre><code class="hljs language-bash" lang="bash">~/.clawdbot/
├── clawdbot.json                    <span class="hljs-comment"># 主配置文件</span>
└── agents/
    └── main/
        └── agent/
            └── auth-profiles.json   <span class="hljs-comment"># 认证配置文件</span>
</code></pre>
<h4 data-id="heading-8">2.2 主配置文件</h4>
<p><strong>文件位置：</strong> <code>~/.clawdbot/clawdbot.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"anthropic"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://你的代理地址.com"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的API密钥"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic-messages"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic/claude-sonnet-4-5-20250929"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"workspace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/Users/你的用户名/clawd"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-9">2.3 关键配置项说明</h4>






























<table><thead><tr><th>字段</th><th>说明</th><th align="center">必需</th></tr></thead><tbody><tr><td><code>baseUrl</code></td><td>API 代理地址</td><td align="center">✅</td></tr><tr><td><code>apiKey</code></td><td>代理服务的 API 密钥</td><td align="center">✅</td></tr><tr><td><code>api</code></td><td><strong>必须</strong>设置为 <code>anthropic-messages</code></td><td align="center">✅</td></tr><tr><td><code>models</code></td><td><strong>必须</strong>包含此字段，可以为空数组 <code>[]</code></td><td align="center">✅</td></tr></tbody></table>
<blockquote>
<p>⚠️ <strong>踩坑点：</strong> 如果缺少 <code>api</code> 或 <code>models</code> 字段，会导致 HTTP 403 错误！这是我花了很长时间才发现的问题。</p>
</blockquote>
<h4 data-id="heading-10">2.4 认证配置文件</h4>
<p><strong>文件位置：</strong> <code>~/.clawdbot/agents/main/agent/auth-profiles.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"anthropic:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的API密钥"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-11">2.5 验证 API 配置</h4>
<p>配置完成后，用 curl 测试 API 是否可用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 这里注意请求的model是自己令牌支持的！</span>
curl -H <span class="hljs-string">"x-api-key: 你的API密钥"</span> \
  -H <span class="hljs-string">"content-type: application/json"</span> \
  -H <span class="hljs-string">"anthropic-version: 2023-06-01"</span> \
  -d <span class="hljs-string">'{"model":"claude-sonnet-4-5-20250929","max_tokens":50,"messages":[{"role":"user","content":"你好"}]}'</span> \
  https://你的代理地址.com/v1/messages
</code></pre>
<p>预期返回类似：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"msg_xxx"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"message"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"assistant"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你好！有什么我可以帮助你的吗？"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">三、代理配置（核心难点）</h3>
<p>由于 Telegram API 需要魔法访问，这是配置中最复杂的部分。</p>
<h4 data-id="heading-13">3.1 问题：Node.js 不读取系统代理</h4>
<p>设置环境变量对 Node.js 22 的网络请求无效：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 这样做是无效的！</span>
<span class="hljs-built_in">export</span> HTTP_PROXY=http://127.0.0.1:1087
<span class="hljs-built_in">export</span> HTTPS_PROXY=http://127.0.0.1:1087
clawdbot gateway  <span class="hljs-comment"># Telegram 连接仍会失败</span>
</code></pre>
<p>会看到如下错误：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">telegram</span>] telegram setMyCommands failed: HttpError: Network request failed!
[<span class="hljs-meta">clawdbot</span>] Unhandled promise rejection: TypeError: fetch failed
</code></pre>
<h4 data-id="heading-14">3.2 解决方案：使用 undici 代理</h4>
<blockquote>
<p>安装前请先有自己的梯子，笔者用的<strong>shadowsocks</strong>且代理端口1087</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53168b4ea2494604a783bd18331c2f2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=NZq8ORaJyAxIq7KtD2KITM8tM10%3D" alt="image.png" loading="lazy"/></p>
<p><strong>步骤一：安装 undici</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4611913382d14081a6e3afa7a30924cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=O6QpF3f58%2BTfCWq%2BAgzixgUh5TQ%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g undici
</code></pre>
<p><strong>步骤二：创建代理配置脚本</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt; ~/proxy-setup.js &lt;&lt; <span class="hljs-string">'EOF'</span>
const { setGlobalDispatcher, ProxyAgent } = require(<span class="hljs-string">'undici'</span>);
setGlobalDispatcher(new ProxyAgent(<span class="hljs-string">'http://127.0.0.1:1087'</span>));
console.log(<span class="hljs-string">'[代理] 已设置全局代理: http://127.0.0.1:1087'</span>);
EOF
</code></pre>
<blockquote>
<p>注意：请将 <code>1087</code> 替换为你实际的代理端口</p>
</blockquote>
<p><strong>步骤三：创建启动脚本</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt; ~/start-clawdbot.sh &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
NODE_PATH=$(npm root -g) node --require ~/proxy-setup.js $(<span class="hljs-built_in">which</span> clawdbot) gateway --port 18789
EOF

<span class="hljs-built_in">chmod</span> +x ~/start-clawdbot.sh
</code></pre>
<p><strong>步骤四：使用启动脚本运行</strong></p>
<pre><code class="hljs language-bash" lang="bash">~/start-clawdbot.sh
</code></pre>
<p>成功启动后会看到：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[代理]</span> 已设置全局代理: <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//127.0.0.1:1087</span>
🦞 <span class="hljs-selector-tag">Clawdbot</span> <span class="hljs-number">2026.1</span><span class="hljs-selector-class">.24-3</span>
<span class="hljs-selector-attr">[gateway]</span> 正在监听 <span class="hljs-selector-tag">ws</span>:<span class="hljs-comment">//127.0.0.1:18789</span>
<span class="hljs-selector-attr">[telegram]</span> <span class="hljs-selector-attr">[default]</span> 正在启动...
<span class="hljs-selector-attr">[telegram]</span> <span class="hljs-selector-attr">[default]</span> 启动成功 (@你的机器人名)
</code></pre>

<p>有这个红框表示telegram也成功连接</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eaa8757d38e40df93fa345d9597701f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=ClVetGDsnx8DMK8y5yw3gD8BcWo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-15">3.3 验证代理是否生效</h4>
<p>测试 Telegram API 连接：</p>
<pre><code class="hljs language-bash" lang="bash">curl -x http://127.0.0.1:1087 https://api.telegram.org/bot你的TOKEN/getMe
</code></pre>
<p>如果返回机器人信息，说明代理配置正确。</p>
<hr/>
<h3 data-id="heading-16">四、Telegram 机器人配置</h3>
<h4 data-id="heading-17">4.1 创建 Telegram 机器人</h4>
<ol>
<li>在 Telegram 搜索 <strong>@BotFather</strong></li>
<li>发送 <code>/newbot</code></li>
<li>按提示设置机器人名称和用户名</li>
<li>获取机器人 Token（格式类似 <code>123456789:ABCdefGHIjklMNOpqrsTUVwxyz</code>）</li>
</ol>
<h4 data-id="heading-18">4.2 配置 Clawdbot</h4>
<p>在 <code>~/.clawdbot/clawdbot.json</code> 中添加 Telegram 配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"channels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"telegram"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"dmPolicy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pairing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"botToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的机器人Token"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"groupPolicy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"allowlist"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"streamMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"partial"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-19">4.3 配对你的 Telegram 账号</h4>
<ol>
<li>使用代理启动 Gateway：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">~/start-clawdbot.sh
</code></pre>
<ol start="2">
<li>
<p>在 Telegram 给你的机器人发送任意消息</p>
</li>
<li>
<p>机器人会回复配对码：</p>
</li>
</ol>

<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Clawdbot: 访问未配置</span>

你的 Telegram 用户 ID: 123456789
<span class="hljs-section">配对码: ABC12345</span>

请机器人管理员执行以下命令批准：
clawdbot pairing approve telegram ABC12345

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5597b49de3f347329f1787d65d5b9469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=6sRdy%2BYzIZO%2FtQVpY7XaAteSL1E%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>在终端执行批准命令：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">clawdbot pairing approve telegram ABC12345
</code></pre>
<ol start="5">
<li>配对成功后即可正常对话</li>
</ol>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b4fd1fef8da496680e68df3afaa25b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=uRAGH9BIbYm29iGyuqqOPcLDSZI%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-20">五、Web 控制面板</h3>
<p>Clawdbot 提供了一个功能丰富的 Web 控制面板。</p>
<h4 data-id="heading-21">5.1 访问地址</h4>
<p>Gateway 启动后，访问：</p>
<pre><code class="hljs language-ini" lang="ini">http://127.0.0.1:18789/?<span class="hljs-attr">token</span>=你的gateway_token
</code></pre>
<p>或者使用命令自动打开：</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot dashboard
</code></pre>
<h4 data-id="heading-22">5.2 主要功能</h4>
<ul>
<li><strong>💬 对话</strong>：直接与 AI 对话</li>
<li><strong>📊 概览</strong>：查看系统状态</li>
<li><strong>🔌 频道</strong>：管理 Telegram/WhatsApp 等连接</li>
<li><strong>📁 会话</strong>：查看和管理对话历史</li>
<li><strong>⚙️ 配置</strong>：修改各项设置</li>
</ul>
<p>笔者让他帮忙编写这篇文档</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ece21d89f564b629c84877c8d5b72d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370826&amp;x-signature=gz1pbYCZC1eAM4O3SF8gCRFctI8%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-23">六、完整配置文件参考</h3>
<h4 data-id="heading-24">6.1 主配置文件 <code>~/.clawdbot/clawdbot.json</code></h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"meta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lastTouchedVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2026.1.24-3"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"anthropic"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://你的代理地址.com"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的API密钥"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic-messages"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"workspace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/Users/你的用户名/clawd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic/claude-sonnet-4-5-20250929"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"compaction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"safeguard"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maxConcurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"channels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"telegram"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"dmPolicy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pairing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"botToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的机器人Token"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"groupPolicy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"allowlist"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"streamMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"partial"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"gateway"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"port"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18789</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"bind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"loopback"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"token"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的gateway_token"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-25">6.2 认证配置文件</h4>
<p><code>~/.clawdbot/agents/main/agent/auth-profiles.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"anthropic:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的API密钥"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-26">七、常见问题排查</h3>
<h4 data-id="heading-27">7.1 HTTP 403 错误</h4>
<p><strong>可能原因：</strong></p>
<ul>
<li>缺少 <code>api: "anthropic-messages"</code> 配置</li>
<li>缺少 <code>models: []</code> 字段</li>
<li>API 密钥无效或余额不足</li>
</ul>
<p><strong>解决方案：</strong>
检查配置文件格式，确保包含所有必需字段。</p>
<h4 data-id="heading-28">7.2 Telegram 连接失败</h4>
<p><strong>错误信息：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">TypeError</span>: fetch failed
</code></pre>
<p><strong>可能原因：</strong></p>
<ul>
<li>代理未正确配置</li>
<li>Node.js 的网络请求没有走代理</li>
</ul>
<p><strong>解决方案：</strong>
使用 undici 代理方案（见第三节）。</p>
<h4 data-id="heading-29">7.3 Gateway 启动但无响应</h4>
<p><strong>检查步骤：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看状态</span>
clawdbot status

<span class="hljs-comment"># 查看日志</span>
<span class="hljs-built_in">tail</span> -f /tmp/clawdbot/clawdbot-$(<span class="hljs-built_in">date</span> +%Y-%m-%d).<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-30">7.4 配对码不显示</h4>
<p><strong>可能原因：</strong></p>
<ul>
<li>Telegram 机器人 Token 无效</li>
<li>代理连接不稳定</li>
</ul>
<p><strong>解决方案：</strong></p>
<ol>
<li>验证 Token：<code>curl -x http://127.0.0.1:1087 https://api.telegram.org/bot你的TOKEN/getMe</code></li>
<li>检查代理连接是否正常</li>
</ol>
<hr/>
<h3 data-id="heading-31">八、常用命令速查</h3>













































<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>clawdbot status</code></td><td>查看状态</td></tr><tr><td><code>clawdbot status --deep</code></td><td>查看详细状态</td></tr><tr><td><code>clawdbot models status</code></td><td>查看模型状态</td></tr><tr><td><code>clawdbot logs --follow</code></td><td>实时查看日志</td></tr><tr><td><code>clawdbot gateway restart</code></td><td>重启网关</td></tr><tr><td><code>clawdbot configure</code></td><td>配置向导</td></tr><tr><td><code>clawdbot doctor</code></td><td>诊断问题</td></tr><tr><td><code>clawdbot dashboard</code></td><td>打开控制面板</td></tr><tr><td><code>clawdbot pairing approve telegram &lt;码&gt;</code></td><td>批准配对</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-32">九、总结</h3>
<p>在特殊网络环境下配置 Clawdbot 的主要挑战：</p>
<ol>
<li><strong>代理配置复杂</strong>：Node.js 22 的网络请求不读取环境变量代理，需要使用 undici 方案</li>
<li><strong>配置格式严格</strong>：<code>api</code> 和 <code>models</code> 字段缺一不可，否则会报 403 错误</li>
<li><strong>多个配置文件</strong>：主配置和认证配置需要同时正确设置</li>
</ol>
<p><strong>推荐方案：</strong></p>
<ul>
<li>使用 API 代理服务获取稳定的 API 访问</li>
<li>使用 undici + 启动脚本配置全局代理</li>
<li>保留配置备份，方便出问题时恢复</li>
</ul>
<hr/>
<h3 data-id="heading-33">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.molt.bot%2F" target="_blank" title="https://docs.molt.bot/" ref="nofollow noopener noreferrer">Moltbot 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fmoltbot" target="_blank" title="https://github.com/moltbot/moltbot" ref="nofollow noopener noreferrer">Moltbot GitHub 仓库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxianyu110%2Fclawbot" target="_blank" title="https://github.com/xianyu110/clawbot" ref="nofollow noopener noreferrer">配置指南参考</a></li>
</ul>
<hr/>
<h3 data-id="heading-34">文件结构速查</h3>
<pre><code class="hljs language-bash" lang="bash">~/.clawdbot/
├── clawdbot.json                    <span class="hljs-comment"># 主配置</span>
├── logs/                            <span class="hljs-comment"># 日志目录</span>
│   ├── gateway.log
│   └── gateway.err.log
└── agents/
    └── main/
        ├── agent/
        │   └── auth-profiles.json   <span class="hljs-comment"># 认证配置</span>
        └── sessions/                <span class="hljs-comment"># 会话存储</span>

~/
├── proxy-setup.js                   <span class="hljs-comment"># 代理配置脚本</span>
└── start-clawdbot.sh               <span class="hljs-comment"># 启动脚本</span>
</code></pre>
<hr/>
<hr/>
<h3 data-id="heading-35">附录：LLM摘要</h3>
<blockquote>
<p>以下是本文的结构化摘要，方便喂给其他 AI 模型快速理解，节省 token 消耗。</p>
</blockquote>
<p>yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Clawdbot/Moltbot 配置知识卡片</span>
<span class="hljs-comment"># 生成时间: 2026-01</span>
<span class="hljs-comment"># 用途: 供AI模型快速理解本文核心内容</span>

<span class="hljs-attr">meta:</span>
  <span class="hljs-attr">project:</span> <span class="hljs-string">Clawdbot</span> <span class="hljs-string">(已更名</span> <span class="hljs-string">Moltbot)</span>
  <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/moltbot/moltbot</span>
  <span class="hljs-attr">docs:</span> <span class="hljs-string">https://docs.molt.bot/</span>
  <span class="hljs-string">功能:</span> <span class="hljs-string">本地AI助手，支持Telegram/WhatsApp/Discord接入Claude模型</span>

<span class="hljs-string">环境要求:</span>
  <span class="hljs-attr">os:</span> <span class="hljs-string">macOS/Linux</span>
  <span class="hljs-attr">node:</span> <span class="hljs-string">"&gt;=22.0.0"</span>
  <span class="hljs-string">安装:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">clawdbot</span>
  <span class="hljs-string">初始化:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">onboard</span>

<span class="hljs-string">配置文件:</span>
  <span class="hljs-string">主配置:</span> <span class="hljs-string">~/.clawdbot/clawdbot.json</span>
  <span class="hljs-string">认证配置:</span> <span class="hljs-string">~/.clawdbot/agents/main/agent/auth-profiles.json</span>

<span class="hljs-string">API代理配置:</span>
  <span class="hljs-string">位置:</span> <span class="hljs-string">clawdbot.json</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">models.providers.anthropic</span>
  <span class="hljs-string">必需字段:</span>
    <span class="hljs-attr">baseUrl:</span> <span class="hljs-string">"API代理地址"</span>
    <span class="hljs-attr">apiKey:</span> <span class="hljs-string">"密钥"</span>
    <span class="hljs-attr">api:</span> <span class="hljs-string">"anthropic-messages"</span>  <span class="hljs-comment"># 关键！缺少报403</span>
    <span class="hljs-attr">models:</span> []  <span class="hljs-comment"># 关键！必须存在，可为空数组</span>
  <span class="hljs-string">示例:</span> <span class="hljs-string">|
    {"models":{"providers":{"anthropic":{
      "baseUrl":"https://proxy.example.com",
      "apiKey":"sk-xxx",
      "api":"anthropic-messages",
      "models":[]
    }}}}
</span>
<span class="hljs-string">认证配置:</span>
  <span class="hljs-string">位置:</span> <span class="hljs-string">auth-profiles.json</span>
  <span class="hljs-string">格式:</span> <span class="hljs-string">|
    {"version":1,"profiles":{"anthropic:default":{
      "type":"api_key","provider":"anthropic","apiKey":"sk-xxx"
    }}}
</span>
<span class="hljs-string">网络代理问题:</span>
  <span class="hljs-string">症状:</span> <span class="hljs-string">Telegram连接失败，fetch</span> <span class="hljs-string">failed</span>
  <span class="hljs-string">原因:</span> <span class="hljs-string">Node.js</span> <span class="hljs-number">22</span> <span class="hljs-string">的</span> <span class="hljs-string">fetch</span> <span class="hljs-string">不读取</span> <span class="hljs-string">HTTP_PROXY</span> <span class="hljs-string">环境变量</span>
  <span class="hljs-string">错误方式:</span> <span class="hljs-string">export</span> <span class="hljs-string">HTTP_PROXY=...</span> <span class="hljs-string">无效</span>
  <span class="hljs-string">正确方案:</span>
    <span class="hljs-string">1_安装:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">undici</span>
    <span class="hljs-string">2_创建脚本:</span> <span class="hljs-string">|
      # ~/proxy-setup.js
      const {setGlobalDispatcher,ProxyAgent}=require('undici');
      setGlobalDispatcher(new ProxyAgent('http://127.0.0.1:端口'));
</span>    <span class="hljs-string">3_启动命令:</span> <span class="hljs-string">|
      NODE_PATH=$(npm root -g) node --require ~/proxy-setup.js $(which clawdbot) gateway --port 18789
</span>
<span class="hljs-string">Telegram配置:</span>
  <span class="hljs-string">配置位置:</span> <span class="hljs-string">clawdbot.json</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">channels.telegram</span>
  <span class="hljs-string">必需字段:</span> {<span class="hljs-string">enabled:true</span>, <span class="hljs-string">botToken:"xxx"</span>, <span class="hljs-string">dmPolicy:"pairing"</span>}
  <span class="hljs-string">配对流程:</span>
    <span class="hljs-attr">1:</span> <span class="hljs-string">通过@BotFather创建机器人获取token</span>
    <span class="hljs-attr">2:</span> <span class="hljs-string">配置clawdbot.json</span>
    <span class="hljs-attr">3:</span> <span class="hljs-string">启动gateway</span>
    <span class="hljs-attr">4:</span> <span class="hljs-string">Telegram发消息给bot</span>
    <span class="hljs-attr">5:</span> <span class="hljs-string">获取配对码</span>
    <span class="hljs-attr">6:</span> <span class="hljs-string">执行</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">pairing</span> <span class="hljs-string">approve</span> <span class="hljs-string">telegram</span> <span class="hljs-string">&lt;配对码&gt;</span>

<span class="hljs-string">Web控制台:</span>
  <span class="hljs-string">地址:</span> <span class="hljs-string">http://127.0.0.1:18789/?token=&lt;gateway_token&gt;</span>
  <span class="hljs-string">命令:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">dashboard</span>

<span class="hljs-string">常见错误:</span>
  <span class="hljs-attr">HTTP_403:</span>
    <span class="hljs-string">原因:</span> [<span class="hljs-string">缺少api字段</span>, <span class="hljs-string">缺少models字段</span>, <span class="hljs-string">apiKey无效</span>]
    <span class="hljs-string">解决:</span> <span class="hljs-string">检查配置文件格式</span>
  <span class="hljs-attr">fetch_failed:</span>
    <span class="hljs-string">原因:</span> <span class="hljs-string">代理未生效</span>
    <span class="hljs-string">解决:</span> <span class="hljs-string">使用undici方案</span>
  <span class="hljs-string">配对码不显示:</span>
    <span class="hljs-string">原因:</span> [<span class="hljs-string">botToken无效</span>, <span class="hljs-string">代理不稳定</span>]
    <span class="hljs-string">解决:</span> <span class="hljs-string">curl测试Telegram</span> <span class="hljs-string">API</span>

<span class="hljs-string">命令速查:</span>
  <span class="hljs-string">状态:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">status</span> [<span class="hljs-string">--deep</span>]
  <span class="hljs-string">日志:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">logs</span> <span class="hljs-string">--follow</span>
  <span class="hljs-string">重启:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">gateway</span> <span class="hljs-string">restart</span>
  <span class="hljs-string">诊断:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">doctor</span>
  <span class="hljs-string">配对:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">pairing</span> <span class="hljs-string">approve</span> <span class="hljs-string">telegram</span> <span class="hljs-string">&lt;码&gt;</span>
  <span class="hljs-string">面板:</span> <span class="hljs-string">clawdbot</span> <span class="hljs-string">dashboard</span>

<span class="hljs-string">文件结构:</span>
  <span class="hljs-string">~/.clawdbot/clawdbot.json:</span> <span class="hljs-string">主配置</span>
  <span class="hljs-string">~/.clawdbot/agents/main/agent/auth-profiles.json:</span> <span class="hljs-string">认证</span>
  <span class="hljs-string">~/proxy-setup.js:</span> <span class="hljs-string">代理脚本</span>
  <span class="hljs-string">~/start-clawdbot.sh:</span> <span class="hljs-string">启动脚本</span>
</code></pre>
<p><strong>使用方法：</strong> 复制上方 YAML 代码块，直接粘贴给 AI 助手，即可快速获得 Clawdbot 配置相关问题的解答。</p>
<hr/>
<p><em>本文基于 2026 年 1 月的实际配置经历撰写， 由claude-opus-4.5 + clawdbot整理编写。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openclaw UI方式配置API]]></title>    <link>https://juejin.cn/post/7600953879500619827</link>    <guid>https://juejin.cn/post/7600953879500619827</guid>    <pubDate>2026-01-30T10:02:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600953879500619827" data-draft-id="7600967006893113353" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openclaw UI方式配置API"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T10:02:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="luka1012"/> <meta itemprop="url" content="https://juejin.cn/user/4311612244630649"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openclaw UI方式配置API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4311612244630649/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    luka1012
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T10:02:29.000Z" title="Fri Jan 30 2026 10:02:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在执行 openclaw dashborad 指令后打开带有token的url链接，进到如下页面</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9c398380efc4c47863470b9e5f10fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=NQj4%2Bqbgz8TH5BPw1N9GsjvN5dE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">添加模型  (这里以通义千问 Max Thinking 版举例)</h3>
<p>右侧config --&gt;models --&gt; provider, 点击add entry</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf0ffc6c302d4b39a261f6b54eefa8ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=K%2FNbg0XlQgVqde737e%2FuCQhQk70%3D" alt="image.png" loading="lazy"/></p>
<p>表格中内容填写按照如下格式：</p>
<pre><code class="hljs language-json" lang="json">providers<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      bailian<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        baseUrl<span class="hljs-punctuation">:</span> <span class="hljs-string">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span><span class="hljs-punctuation">,</span>
        apiKey<span class="hljs-punctuation">:</span> <span class="hljs-string">"替换为你的API key"</span><span class="hljs-punctuation">,</span>
        api<span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span><span class="hljs-punctuation">,</span>
        models<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            id<span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen3-max-2026-01-23"</span><span class="hljs-punctuation">,</span>
            name<span class="hljs-punctuation">:</span> <span class="hljs-string">"通义千问 Max Thinking 版"</span><span class="hljs-punctuation">,</span>
            reasoning<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
            input<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"text"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            cost<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> input<span class="hljs-punctuation">:</span> <span class="hljs-number">0.0025</span><span class="hljs-punctuation">,</span> output<span class="hljs-punctuation">:</span> <span class="hljs-number">0.01</span><span class="hljs-punctuation">,</span> cacheRead<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> cacheWrite<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            contextWindow<span class="hljs-punctuation">:</span> <span class="hljs-number">262144</span><span class="hljs-punctuation">,</span>
            maxTokens<span class="hljs-punctuation">:</span> <span class="hljs-number">65536</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-1">应用模型</h3>
<p>将添加的模型设为默认：
config --&gt; agents --&gt;Default --&gt;Model
按照以下格式填写内容</p>
<p>（1. 在models里添加entry</p>
<ol start="2">
<li>将primary model 字段改为bailian/qwen3-max-2026-01-23）</li>
</ol>
<pre><code class="hljs language-json" lang="json">agents<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    defaults<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      model<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> primary<span class="hljs-punctuation">:</span> <span class="hljs-string">"bailian/qwen3-max-2026-01-23"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      models<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"bailian/qwen3-max-2026-01-23"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> alias<span class="hljs-punctuation">:</span> <span class="hljs-string">"通义千问 Max Thinking 版"</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
</code></pre>
<p>如图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1529e93bc0c04da28b56bca1819cf583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=7MaFUTCBq0dG0OSC%2BbXof57VzNo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dd5c89b28aa4c6da7d1db7db1e6a8a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=BUdOL3DGGc1XRS%2BVtsGQ66GVtGU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>点击save 保存配置</strong></p>
<h3 data-id="heading-2"><strong>配置生效 + 验证模型状态</strong></h3>
<p>在终端运行以下指令，保证配置能够生效：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：停止服务后，再启动服务</span>
openclaw gateway stop
<span class="hljs-comment"># 等待 2-3 秒后启动服务</span>
openclaw gateway start
<span class="hljs-comment"># 方式二：直接使用重启命令</span>
openclaw gateway restart
</code></pre>
<p>你还可以通过以下指令看刚刚设置的模型是否被 Clawdbot 识别：</p>
<pre><code class="hljs language-bash" lang="bash">openclaw models list
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7dad413a48345ccad9f4a735cb1cd42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=INJSWEYmNWOUbPbuNmqt6rpWc4Y%3D" alt="image.png" loading="lazy"/></p>
<p>你还可以通过以下指令进行一次真实连通探测（会发真实请求，可能产生费用~）</p>
<pre><code class="hljs language-bash" lang="bash">openclaw models status --probe
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d1562e5d9d34d448d803d8fda4f7d58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=B%2ByahbntNMnFZef2zejOmUrYriE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">搞定</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33e2754ceb2a41d1b961876aef0f171f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVrYTEwMTI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770372148&amp;x-signature=%2BEtOF%2F7POn4jOkmtxZOnoxlw3Jc%3D" alt="image.png" loading="lazy"/></p>
<p>参考文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1708855%3Fspm%3D5176.454194655176.J_L02u6VphiK2DqbAEtTYRj.3.1ba44859qmPsDh" target="_blank" title="https://developer.aliyun.com/article/1708855?spm=5176.454194655176.J_L02u6VphiK2DqbAEtTYRj.3.1ba44859qmPsDh" ref="nofollow noopener noreferrer">🦞 如何在 Moltbot 配置阿里云百炼 API-阿里云开发者社区</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[git版本控制]先有本地项目, 再进行github版本控制(亲测可用)]]></title>    <link>https://juejin.cn/post/7600752623068233738</link>    <guid>https://juejin.cn/post/7600752623068233738</guid>    <pubDate>2026-01-30T08:00:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600752623068233738" data-draft-id="7600967006892310537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[git版本控制]先有本地项目, 再进行github版本控制(亲测可用)"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2026-01-30T08:00:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [git版本控制]先有本地项目, 再进行github版本控制(亲测可用)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:00:41.000Z" title="Fri Jan 30 2026 08:00:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我来为你提供一个完整的 GitHub 推送步骤：</p>
<h2 data-id="heading-0"><strong>步骤 1：准备工作</strong></h2>
<h3 data-id="heading-1">1.1 安装和配置 Git</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查是否已安装 Git</span>
git --version

<span class="hljs-comment"># 如果没有安装，先安装 Git</span>
<span class="hljs-comment"># Windows: 下载 Git for Windows</span>
<span class="hljs-comment"># Mac: brew install git</span>
<span class="hljs-comment"># Linux: sudo apt-get install git</span>

<span class="hljs-comment"># 配置用户名和邮箱</span>
git config --global user.name <span class="hljs-string">"你的名字"</span>
git config --global user.email <span class="hljs-string">"你的邮箱"</span>
</code></pre>
<h3 data-id="heading-2">1.2 创建 GitHub 账号（如果还没有）</h3>
<ul>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com" target="_blank" title="https://github.com" ref="nofollow noopener noreferrer">github.com</a> 注册账号</li>
<li>建议设置 SSH Key（可选但推荐）</li>
</ul>
<h2 data-id="heading-3"><strong>步骤 2：在 GitHub 上创建远程仓库</strong></h2>
<ol>
<li>登录 GitHub</li>
<li>点击右上角 "+" → "New repository"</li>
<li>填写仓库信息：
<ul>
<li>Repository name: 项目名称</li>
<li>Description: 项目描述（可选）</li>
<li>选择 Public（公开）或 Private（私有）</li>
<li><strong>不要</strong>勾选 "Initialize this repository with a README"（本地已有项目）</li>
</ul>
</li>
<li>点击 "Create repository"</li>
</ol>
<h2 data-id="heading-4"><strong>步骤 3：本地项目初始化</strong></h2>
<h3 data-id="heading-5">3.1 初始化 Git 仓库</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> /path/to/your/project

<span class="hljs-comment"># 初始化本地仓库</span>
git init
</code></pre>
<h3 data-id="heading-6">3.2 创建 .gitignore 文件（重要）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 .gitignore 文件，排除不需要版本控制的文件</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"node_modules/"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">".env"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">".DS_Store"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">"dist/"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">"build/"</span> &gt;&gt; .gitignore
<span class="hljs-comment"># 根据你的项目类型添加更多</span>
</code></pre>
<h3 data-id="heading-7">3.3 添加文件并提交</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看当前状态</span>
git status

<span class="hljs-comment"># 添加所有文件到暂存区（排除 .gitignore 中的文件）</span>
git add .

<span class="hljs-comment"># 或者选择性添加</span>
git add file1.js file2.css

<span class="hljs-comment"># 提交到本地仓库</span>
git commit -m <span class="hljs-string">"初始提交：项目基础框架"</span>
</code></pre>
<h2 data-id="heading-8"><strong>步骤 4：连接远程仓库并推送</strong></h2>
<h3 data-id="heading-9">4.1 添加远程仓库地址</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 复制 GitHub 提供的远程仓库地址</span>
<span class="hljs-comment"># HTTPS 方式（需要每次输入密码或 token）</span>
git remote add origin https://github.com/你的用户名/仓库名.git

<span class="hljs-comment"># 或者 SSH 方式（需要配置 SSH key）</span>
<span class="hljs-comment"># git remote add origin git@github.com:你的用户名/仓库名.git</span>

<span class="hljs-comment"># 验证远程仓库</span>
git remote -v
</code></pre>
<h3 data-id="heading-10">4.2 推送代码到 GitHub</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 第一次推送（-u 参数设置上游分支）</span>
git push -u origin main

<span class="hljs-comment"># 如果你本地分支是 master，需要先重命名</span>
git branch -M main
git push -u origin main
</code></pre>
<h2 data-id="heading-11"><strong>常见问题和解决方案</strong></h2>
<h3 data-id="heading-12">问题 1：推送被拒绝</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果远程仓库有 README 等文件（之前误操作）</span>
git pull origin main --allow-unrelated-histories
<span class="hljs-comment"># 解决合并冲突（如果有）</span>
git push origin main
</code></pre>
<h3 data-id="heading-13">问题 2：需要身份验证</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 Personal Access Token（推荐）</span>
<span class="hljs-comment"># 1. GitHub → Settings → Developer settings → Personal access tokens</span>
<span class="hljs-comment"># 2. 生成新 token，勾选 repo 权限</span>
<span class="hljs-comment"># 3. 推送时使用 token 作为密码</span>
</code></pre>
<h3 data-id="heading-14">问题 3：配置 SSH Key（免密码推送）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成 SSH Key</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"your_email@example.com"</span>

<span class="hljs-comment"># 查看公钥并复制</span>
<span class="hljs-built_in">cat</span> ~/.ssh/id_ed25519.pub

<span class="hljs-comment"># 添加到 GitHub</span>
<span class="hljs-comment"># Settings → SSH and GPG keys → New SSH key</span>
</code></pre>
<h2 data-id="heading-15"><strong>步骤 5：后续日常操作</strong></h2>
<h3 data-id="heading-16">日常推送流程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看修改状态</span>
git status

<span class="hljs-comment"># 2. 添加修改文件</span>
git add .

<span class="hljs-comment"># 3. 提交到本地</span>
git commit -m <span class="hljs-string">"提交描述"</span>

<span class="hljs-comment"># 4. 拉取远程最新代码（避免冲突）</span>
git pull origin main

<span class="hljs-comment"># 5. 推送到远程</span>
git push origin main
</code></pre>
<h3 data-id="heading-17">分支管理（推荐）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建新分支</span>
git branch feature/new-feature
git checkout feature/new-feature

<span class="hljs-comment"># 或者一步创建并切换</span>
git checkout -b feature/new-feature

<span class="hljs-comment"># 合并分支</span>
git checkout main
git merge feature/new-feature
</code></pre>
<h2 data-id="heading-18"><strong>快速命令总结</strong></h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 完整流程（已有项目首次推送）</span>
<span class="hljs-built_in">cd</span> your-project
git init
git add .
git commit -m <span class="hljs-string">"first commit"</span>
git branch -M main
git remote add origin https://github.com/username/repo.git
git push -u origin main
</code></pre>
<h2 data-id="heading-19"><strong>额外建议</strong></h2>
<ol>
<li><strong>提交规范</strong>：使用清晰的提交信息</li>
<li><strong>分支策略</strong>：建议使用 Git Flow 或 GitHub Flow</li>
<li><strong>.gitignore</strong>：确保包含所有敏感文件和临时文件</li>
<li><strong>README.md</strong>：添加项目说明文档</li>
</ol>
<p>按照这个流程，你的项目应该能成功推送到 GitHub。如果遇到具体问题，可以告诉我错误信息，我会帮你解决！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[冲冲冲，Flutter拖拉拽实战，高仿飞书会议室详情页]]></title>    <link>https://juejin.cn/post/7600955777315749926</link>    <guid>https://juejin.cn/post/7600955777315749926</guid>    <pubDate>2026-01-30T10:39:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777315749926" data-draft-id="7377026952786329637" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="冲冲冲，Flutter拖拉拽实战，高仿飞书会议室详情页"/> <meta itemprop="keywords" content="Flutter,前端,GitHub"/> <meta itemprop="datePublished" content="2026-01-30T10:39:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="rainboy"/> <meta itemprop="url" content="https://juejin.cn/user/3808364011199591"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            冲冲冲，Flutter拖拉拽实战，高仿飞书会议室详情页
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364011199591/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    rainboy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T10:39:35.000Z" title="Fri Jan 30 2026 10:39:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">实现效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c79637f47d3a4d48af526a4343d94a63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770374812&amp;x-signature=4hUTxRXPLZsU2aH%2F%2BX8sUqLacSQ%3D" alt="schedule.gif" loading="lazy"/></p>
<h2 data-id="heading-1">主要功能</h2>
<ul>
<li>📉可视化事件列表，会议室状态一览无余，清晰直观</li>
<li>💥支持拖拽选择预订时间，交互自然，纵享丝滑</li>
<li>🌈提供丰富的样式配置选项，满足不同场景的视觉需求</li>
</ul>
<h2 data-id="heading-2">技术实现</h2>
<h3 data-id="heading-3">实现主界面</h3>
<p>采用模块化设计思想，核心控件为<code>DayView</code>，用于展示单日会议室预订事件。整体架构采用<code>SingleChildScrollView</code>作为外层容器实现垂直滚动，内部使用<code>Stack</code>布局管理多个视觉元素。</p>
<ul>
<li><strong>左侧时间轴组件</strong>：负责绘制00:00-24:00的时间文本，为用户提供时间参考</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">widgets/day<span class="hljs-emphasis">_view.dart</span></span></span>
<span class="hljs-keyword">if</span> (widget.hoursColumnStyle.width &gt; <span class="hljs-number">0</span>) {
  children.add(Positioned(
    top: <span class="hljs-number">0</span>,
    left: widget.isRTL ? <span class="hljs-keyword">null</span> : <span class="hljs-number">0</span>,
    child: HoursColumn.fromHeadersWidgetState(parent: <span class="hljs-keyword">this</span>),
  ));
}
</code></pre>
<ul>
<li><strong>右侧背景时间线网格</strong>：自定义<code>CustomPaint</code>实现每小时的时间分割线</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">widgets/day<span class="hljs-emphasis">_view.dart</span></span></span>
Widget createBackground() =&gt; Positioned.fill(
      child: CustomPaint(
        painter: widget.style.createBackgroundPainter(
          dayView: widget,
          topOffsetCalculator: calculateTopOffset,
        ),
      ),
    );

</code></pre>
<ul>
<li><strong>当前时间指示器</strong>：通过<code>RepaintBoundary</code>和<code>CustomPaint</code>实现实时更新的当前时间线</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">widgets/day<span class="hljs-emphasis">_view.dart</span></span></span>
<span class="hljs-keyword">if</span> (_showCurrentTimeIndicator()) {
  Widget? currentTimeIndicator =
      (widget.currentTimeIndicatorBuilder ?? DefaultBuilders.defaultCurrentTimeIndicatorBuilder)(widget.style, calculateTopOffset, widget.hoursColumnStyle, widget.isRTL,_currentTimeNotifier);
  <span class="hljs-keyword">if</span> (currentTimeIndicator != <span class="hljs-keyword">null</span>) {
    children.add(currentTimeIndicator);
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f32e72570e34d86b2e1d3443c0c2399~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770374812&amp;x-signature=mTjCDf2MitnJcl%2BDL5QiAXc%2BR28%3D" alt="ui.png" loading="lazy"/></p>
<ul>
<li><strong>事件列表渲染</strong>：基于<code>FlutterWeekViewEvent</code>数据模型，动态生成会议室预订事件卡片</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">widgets/day<span class="hljs-emphasis">_view.dart</span></span></span>
children.addAll(eventsDrawProperties.entries.map((entry) =&gt; entry.value.createWidget(
      context,
      widget,
      buildResizeUpGestureDetector(entry.key),
      buildResizeDownGestureDetector(entry.key),
      entry.key,
    )));
</code></pre>
<p><strong>事件数据结构</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">event.dart</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlutterWeekViewEvent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">FlutterWeekViewEvent</span>&gt; </span>{
   <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;         <span class="hljs-comment">// 事件标题</span>
   <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> description;   <span class="hljs-comment">// 事件描述</span>
   <span class="hljs-built_in">DateTime</span> start;             <span class="hljs-comment">// 开始时间</span>
   <span class="hljs-built_in">DateTime</span> end;               <span class="hljs-comment">// 结束时间</span>
   <span class="hljs-comment">// 其他属性...</span>
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15fdf64ec7594e6f8ebda93006d365b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770374812&amp;x-signature=xHMXuYpk%2BfVUs%2ByIwr0Fuqgqh4w%3D" alt="events.png" loading="lazy"/></p>
<h3 data-id="heading-4">实现拖拽调整功能</h3>
<p>通过<code>GestureDetector</code>组件实现事件的垂直拖拽调整，支持修改事件的开始和结束时间：</p>
<ol>
<li><strong>拖拽手势监听</strong>：为<strong>新创建事件</strong>添加两个<code>GestureDetector</code>，分别处理上下拖拽操作</li>
<li><strong>位置计算</strong>：根据拖拽偏移量计算新的时间位置</li>
<li><strong>边界处理</strong>：实现最小事件时长限制，确保用户体验</li>
<li><strong>状态更新</strong>：拖拽结束后更新事件数据并刷新UI</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">widgets/day<span class="hljs-emphasis">_view.dart</span></span></span>
<span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">向上拖拽调整开始时间</span></span></span>
Widget? buildResizeUpGestureDetector(FlutterWeekViewEvent event,) {
  <span class="hljs-keyword">if</span> (widget.resizeEventOptions == <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
  }
  <span class="hljs-keyword">return</span> GestureDetector(
    onVerticalDragStart: (_) {
      accumulatedResizeOffset = <span class="hljs-number">0</span>;
      originalResizeEventStart = event.start;
    },
    onVerticalDragEnd: (_) {
      <span class="hljs-built_in">DateTime</span> newEventStart = event.start;
      event.start = originalResizeEventStart;
      widget.resizeEventOptions!.onEventResizedUp(event, newEventStart);
      setState(() {
        reset();
        createEventsDrawProperties();
      });
    },
    onVerticalDragUpdate: (details) =&gt; onEventResizeUpUpdate(event, details.primaryDelta ?? <span class="hljs-number">0</span>),
    child: MouseRegion(
      cursor: SystemMouseCursors.resizeUpDown,
      child: Container(color: Colors.transparent),
    ),
  );
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc5437a4d93949928b323329862915bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770374812&amp;x-signature=L0C0sjHxDk%2Bt%2BK69VVWlFVFHnGs%3D" alt="gestureDetector.png" loading="lazy"/></p>
<h3 data-id="heading-5">实现拖放功能</h3>
<p>利用Flutter中的<code>Draggable</code>和<code>DragTarget</code>组件实现事件的自由拖放：</p>
<blockquote>
<p><code>Draggable</code>可以让组件在界面上任意拖动，同时携带一个泛型T的数据，<code>DragTarget</code>用于定义一个拖动的目标区域，可以接收<code>Draggable</code>组件的信息。</p>
</blockquote>
<ol>
<li><strong>事件包装</strong>：将事件卡片包装在<code>Draggable</code>组件中，支持长按或点击触发拖拽</li>
<li><strong>目标区域</strong>：使用<code>DragTarget</code>包裹整个日视图，接收拖放事件</li>
<li><strong>位置计算</strong>：在拖拽过程中实时计算新位置对应的时间，刷新UI</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">utils/event<span class="hljs-emphasis">_grid.dart</span></span></span>
<span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">事件拖拽包装</span></span></span>
child = _getDraggableOrLongPressDraggable(
  isLongPress: options.startingGesture == DragStartingGesture.longPress,
  data: event,
  axis: options.allowOnlyVerticalDrag ? Axis.vertical : <span class="hljs-keyword">null</span>,
  feedback: SizedBox(
    height: height!,
    width: width!,
    child: child,
  ),
  childWhenDragging: Opacity(opacity: <span class="hljs-number">0.5</span>, child: child),
  child: child,
);
  
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">widgets/day<span class="hljs-emphasis">_view.dart</span></span></span>
<span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">拖放目标区域</span></span></span>
mainWidget = DragTarget&lt;FlutterWeekViewEvent&gt;(
  builder: (_, __, ___) =&gt; createMainWidget(),
  onMove: (details){
    <span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">计算新位置对应的时间</span></span></span>
    RenderBox renderBox = context.findRenderObject() <span class="hljs-keyword">as</span> RenderBox;
    Offset localOffset = renderBox.globalToLocal(details.offset);
    Offset correctedOffset = Offset(localOffset.dx, localOffset.dy + (verticalScrollController?.offset ?? <span class="hljs-number">0</span>) - widget.padding.top);
    <span class="hljs-built_in">DateTime</span> newStartTime = widget.date.add(calculateOffsetHourMinute(correctedOffset).asDuration);
     <span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">网格对齐处理</span></span></span>
    <span class="hljs-keyword">if</span>(widget.resizeEventOptions!=<span class="hljs-keyword">null</span>) {
      newStartTime= roundTimeToFitGrid(newStartTime,
          gridGranularity: widget.resizeEventOptions!.snapToGridGranularity);
    }
    <span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">更新预览位置</span></span></span>
    widget.timeRangeStartNotifier?.value = newStartTime;
    widget.timeRangeEndNotifier?.value = details.data.end.add(newStartTime.difference(details.data.start));
  },
  onAcceptWithDetails: (details) {
    <span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">处理拖放完成逻辑</span></span></span>
    RenderBox renderBox = context.findRenderObject() <span class="hljs-keyword">as</span> RenderBox;
    Offset localOffset = renderBox.globalToLocal(details.offset);
    Offset correctedOffset = Offset(localOffset.dx, localOffset.dy + (verticalScrollController?.offset ?? <span class="hljs-number">0</span>) - widget.padding.top);
    <span class="hljs-built_in">DateTime</span> newStartTime = widget.date.add(calculateOffsetHourMinute(correctedOffset).asDuration);
    widget.dragAndDropOptions!.onEventDragged(details.data, newStartTime);
    widget.timeRangeStartNotifier?.value = details.data.start;
    widget.timeRangeEndNotifier?.value = details.data.end;
    <span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">更新UI</span></span></span>
    setState(() {
      reset();
      createEventsDrawProperties();
    });
  },
  onLeave: (event){
    <span class="hljs-comment">/// <span class="markdown"><span class="hljs-emphasis">处理拖放离开逻辑</span></span></span>
    <span class="hljs-keyword">if</span>(event!=<span class="hljs-keyword">null</span>) {
      widget.timeRangeStartNotifier?.value = event.start;
      widget.timeRangeEndNotifier?.value = event.end;
    }
  },
);
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e831b256df3649919490fb1d25d6286e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770374812&amp;x-signature=jeN6xqQo4lttthKUwSccvu3shmo%3D" alt="drag_drop.png" loading="lazy"/></p>
<h2 data-id="heading-6">应用场景与价值</h2>
<p>该技术方案适用于多种需要时间可视化的场景：</p>
<ul>
<li><strong>会议室预订系统</strong>：直观展示会议室使用情况</li>
<li><strong>个人日程管理</strong>：清晰管理每日任务和活动</li>
<li><strong>项目时间线</strong>：可视化项目进度和里程碑</li>
</ul>
<h2 data-id="heading-7">Github</h2>
<p>本文相关的代码基于<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSkyost" target="_blank" title="https://github.com/Skyost" ref="nofollow noopener noreferrer">Skyost</a>的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSkyost%2FFlutterWeekView" target="_blank" title="https://github.com/Skyost/FlutterWeekView" ref="nofollow noopener noreferrer">FlutterWeekView</a>修改而来，地址如下：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkongpf8848%2Fflutter_schedule_view" target="_blank" title="https://github.com/kongpf8848/flutter_schedule_view" ref="nofollow noopener noreferrer">github.com/kongpf8848/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[📦 AI Git CLI：让 AI 帮你写 Commit 和 MR]]></title>    <link>https://juejin.cn/post/7600837236620312628</link>    <guid>https://juejin.cn/post/7600837236620312628</guid>    <pubDate>2026-01-30T08:29:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600837236620312628" data-draft-id="7600728866757754932" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="📦 AI Git CLI：让 AI 帮你写 Commit 和 MR"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T08:29:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cecyci"/> <meta itemprop="url" content="https://juejin.cn/user/2356969294276701"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            📦 AI Git CLI：让 AI 帮你写 Commit 和 MR
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2356969294276701/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cecyci
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:29:28.000Z" title="Fri Jan 30 2026 08:29:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、痛点：重复而机械的 Git 工作流</h3>
<p>每次开发新需求，你是否也要重复这一套流程？</p>
<ol>
<li>拉取最新主分支</li>
<li>创建新分支 <code>feat/xxx</code></li>
<li>写代码</li>
<li>提交：</li>
</ol>
<pre><code class="hljs language-git" lang="git">git commit -m "feat: xxxxx"  # 还得想怎么写
git push origin feat/xxx
</code></pre>
<ol start="5">
<li>去 GitLab 手动新建 Merge Request</li>
<li>还可能需 rebase 主分支：</li>
</ol>
<pre><code class="hljs language-css" lang="css">git checkout <span class="hljs-selector-tag">main</span>
git pull origin <span class="hljs-selector-tag">main</span>
git checkout feat/xxx
git rebase <span class="hljs-selector-tag">main</span>
</code></pre>
<p>这些操作重复、琐碎，且 <strong>Commit 消息写起来费神</strong>，<strong>MR 描述更难写全面</strong>。</p>
<h3 data-id="heading-1">二、解决方案：AI CLI —— 一条龙自动化</h3>
<p>因此我开发了一个 <strong>Git + AI 命令行工具</strong>，帮你自动化以上流程，并让 AI 生成规范的 Commit 和 MR 描述。</p>

























<table><thead><tr><th>命令</th><th>功能</th><th>适用场景</th></tr></thead><tbody><tr><td><code>ai git commit</code></td><td>rebase + commit + push + 创建 MR</td><td>完整流程，确保代码与主分支同步</td></tr><tr><td><code>ai git mr</code></td><td>commit + push + 创建 MR</td><td>已有本地更改，直接提交并提 MR</td></tr><tr><td><code>ai git add</code></td><td>add + commit（可选 push）</td><td>仅提交到本地，暂不提 MR</td></tr></tbody></table>
<h3 data-id="heading-2">三、技术实现亮点</h3>
<h4 data-id="heading-3"> 1. <strong>智能生成 Commit 消息</strong></h4>
<p>通过 <code>git diff --cached</code> 获取暂存区改动，发送给 AI（使用token调用AI接口），生成符合 <strong>Conventional Commits</strong> 格式的消息。</p>
<p>prompt</p>
<pre><code class="hljs language-bash" lang="bash">请分析以下代码改动，生成一个简洁的 commit message（格式：<span class="hljs-built_in">type</span>: description）。

要求：
1. 使用常见的 commit <span class="hljs-built_in">type</span>（feat, fix, docs, style, refactor, <span class="hljs-built_in">test</span>, chore）
2. 描述要简洁明了，不超过 50 个字
3. 只输出 commit message，不要其他说明

代码改动：<span class="hljs-variable">${diff}</span>
</code></pre>
<h4 data-id="heading-4">2. <strong>自动创建 MR（使用 GitLab CLI <code>glab</code>）</strong></h4>
<ul>
<li>检查是否已有 MR</li>
<li>获取与主分支的 diff 和 log</li>
<li>调用 AI 生成 <strong>标题 + 详细描述</strong>（含改动点、影响范围、风险）</li>
</ul>
<h4 data-id="heading-5">3. <strong>防止 AI Token 超限</strong></h4>
<ul>
<li>Commit 时：对 diff 长度截断</li>
<li>MR 时：仅提取<strong>关键文件</strong>（新增文件或修改函数超过50行的文件）</li>
</ul>
<h4 data-id="heading-6">4. <strong>健壮的 Git 操作封装</strong></h4>
<ul>
<li>自动检测主分支（main/master）</li>
<li>支持 stash → rebase → pop 流程，处理冲突中断</li>
<li>使用 <code>git status --porcelain</code> 解析状态，避免人工解析输出</li>
</ul>
<h4 data-id="heading-7">5. <strong>多环境配置支持</strong></h4>
<p>通过 <code>dotenv</code> 按优先级加载 <code>.env</code> 文件，方便在不同目录下使用。</p>
<hr/>
<h3 data-id="heading-8">四、示例流程</h3>
<h4 data-id="heading-9">使用 <code>ai git commit</code>：</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 在 feat/0130 分支开发完毕</span>
<span class="hljs-comment"># 2. 一键完成：</span>
ai git commit --main-branch main

<span class="hljs-comment"># 工具会：</span>
<span class="hljs-comment"># ✅ 拉取最新 main</span>
<span class="hljs-comment"># ✅ stash → rebase → pop（如有冲突会暂停）</span>
<span class="hljs-comment"># ✅ 自动 add</span>
<span class="hljs-comment"># ✅ AI 生成 commit message（可编辑确认）</span>
<span class="hljs-comment"># ✅ 推送分支</span>
<span class="hljs-comment"># ✅ 创建 MR（AI 生成标题和描述）</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">五、遇到的问题与解决方案</h3>

























<table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td>AI token 可能超限</td><td>对 diff 智能截断，只提取关键改动</td></tr><tr><td>冲突处理中断流程</td><td>采用 stash 机制，冲突时中断并提示用户解决</td></tr><tr><td>不同项目主分支名不同</td><td>支持 <code>--main-branch</code> 参数，默认检测 <code>main</code> 或 <code>master</code></td></tr><tr><td>需兼容不同 GitLab 实例</td><td>使用 <code>glab auth login</code> 提前认证，支持自托管 GitLab</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">六、未来改进方向</h3>
<ol>
<li><strong>交互确认</strong>：AI 生成的 Commit 和 MR 信息可编辑后再提交</li>
<li><strong>本地模型支持</strong>：接入 Ollama，保护代码隐私，减少 API 调用成本</li>
<li><strong>多平台支持</strong>：除了 GitLab，也支持 GitHub（通过 <code>gh</code> CLI）</li>
<li><strong>Commit 规范校验</strong>：在 AI 生成后，自动校验是否符合团队规范</li>
<li><strong>可视化冲突解决</strong>：在 rebase 冲突时提供更友好的解决界面</li>
<li><strong>错误处理与回滚</strong>：在 rebase 或 push 失败时，应有更安全的回滚机制</li>
<li><strong>配置化</strong>：允许用户自定义 AI prompt、Commit 类型映射等</li>
<li><strong>进度提示</strong>：长时间操作（如 AI 调用、网络请求）应有 loading 提示</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[复刻 Kimi 官网动画效果：基于 Rive 的交互式 Canvas 实现]]></title>    <link>https://juejin.cn/post/7600692485947490313</link>    <guid>https://juejin.cn/post/7600692485947490313</guid>    <pubDate>2026-01-30T08:27:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600692485947490313" data-draft-id="7600692485947342857" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="复刻 Kimi 官网动画效果：基于 Rive 的交互式 Canvas 实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T08:27:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="远之喵"/> <meta itemprop="url" content="https://juejin.cn/user/888852236483800"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            复刻 Kimi 官网动画效果：基于 Rive 的交互式 Canvas 实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888852236483800/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    远之喵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:27:09.000Z" title="Fri Jan 30 2026 08:27:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>最近Kimi2.5发布，官网的动画效果让人眼前一亮，灵动的交互反馈、细腻的动画过渡，给用户带来了极佳的视觉体验。本文将手把手教你使用Rive结合Canvas复刻这类动画效果，从核心原理到代码实现，让你轻松掌握交互式矢量动画的开发技巧。</p>
<h2 data-id="heading-0">一、技术选型与核心原理</h2>
<h3 data-id="heading-1">1. 为什么选择Rive？</h3>
<p>Rive（原Flare）是一款专注于交互式矢量动画的工具，支持跨平台运行，能将设计师制作的动画导出为<code>.riv</code>格式文件，通过其官方SDK可直接在Web端渲染。相比传统的GIF/视频，Rive动画体积小、可交互、支持矢量缩放不失真，完美契合网页端交互式动画的需求。</p>
<h3 data-id="heading-2">2. 核心实现逻辑</h3>
<ul>
<li>利用Canvas作为Rive动画的渲染容器，保证动画的高性能绘制；</li>
<li>通过Rive SDK解析动画文件，获取状态机中的输入参数（如鼠标坐标、触发事件）；</li>
<li>监听鼠标/触摸事件，实时更新Rive状态机的输入值，实现动画与用户交互的联动；</li>
<li>适配不同设备尺寸，保证动画在移动端/桌面端都能正常展示。</li>
</ul>
<h2 data-id="heading-3">二、实战开发步骤</h2>
<h3 data-id="heading-4">1. 环境准备</h3>
<p>无需复杂的构建工具，直接通过CDN引入Rive的Canvas版SDK即可：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/@rive-app/canvas@2.15.0"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> 
</code></pre>
<h3 data-id="heading-5">2. 页面结构搭建</h3>
<p>首先创建基础的HTML结构，核心是一个Canvas容器，用于承载Rive动画：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Kimi Doodle - 名字绘制效果<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    * { 
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; 
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; 
        <span class="hljs-attribute">box-sizing</span>: 
        border-box; 
    } 
    <span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; 
        <span class="hljs-attribute">overflow</span>: hidden; 
    } 
    <span class="hljs-selector-class">.rive-container</span> { 
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">260px</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">160px</span>; 
        <span class="hljs-attribute">cursor</span>: pointer; 
    } 
    <span class="hljs-selector-tag">canvas</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rive-container"</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> 
<span class="hljs-comment">&lt;!-- 后续JS代码写在这里 --&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span> 
</code></pre>
<p>样式上做了基础的重置，保证容器居中且占满可视区域，同时隐藏滚动条避免干扰。</p>
<h3 data-id="heading-6">3. Rive动画初始化</h3>
<p>初始化Rive实例是核心步骤，需要指定动画文件、渲染画布、状态机等关键参数：</p>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'canvas'</span>); 
    <span class="hljs-keyword">const</span> dpr = <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> || <span class="hljs-number">1</span>; <span class="hljs-comment">// 适配高清屏 </span>
    <span class="hljs-keyword">let</span> riveInstance = <span class="hljs-literal">null</span>; 
    <span class="hljs-keyword">let</span> mouseXInput = <span class="hljs-literal">null</span>; 
    <span class="hljs-keyword">let</span> mouseYInput = <span class="hljs-literal">null</span>; 
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) { <span class="hljs-comment">// 适配高清屏，设置Canvas实际尺寸 </span>
        canvas.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> * dpr; 
        canvas.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> * dpr; <span class="hljs-comment">// 初始化Rive实例 </span>
        riveInstance = <span class="hljs-keyword">new</span> rive.<span class="hljs-title class_">Rive</span>({ 
            <span class="hljs-attr">src</span>: <span class="hljs-string">'./261230-11_16_34_visual_doodle2.riv'</span>, <span class="hljs-comment">// 本地Rive动画文件 </span>
            <span class="hljs-attr">canvas</span>: canvas, <span class="hljs-comment">// 渲染画布 </span>
            <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 自动播放 </span>
            <span class="hljs-attr">stateMachines</span>: <span class="hljs-string">'doodle'</span>, <span class="hljs-comment">// 指定要使用的状态机名称 </span>
            <span class="hljs-attr">fit</span>: rive.<span class="hljs-property">Fit</span>.<span class="hljs-property">cover</span>, <span class="hljs-comment">// 动画适配方式 </span>
            <span class="hljs-attr">alignment</span>: rive.<span class="hljs-property">Alignment</span>.<span class="hljs-property">center</span>, <span class="hljs-comment">// 动画对齐方式 </span>
            <span class="hljs-attr">onLoad</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 调整画布尺寸适配动画   </span>
                riveInstance.<span class="hljs-title function_">resizeDrawingSurfaceToCanvas</span>(); <span class="hljs-comment">// 提取状态机输入参数 </span>
                <span class="hljs-title function_">extractInputs</span>(); 
            } 
}); 
} <span class="hljs-comment">// 页面加载完成后初始化 </span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span> === <span class="hljs-string">'loading'</span> ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, init) : <span class="hljs-title function_">init</span>(); 
</code></pre>
<p>关键参数说明：</p>
<ul>
<li><code>src</code>：Rive动画文件路径（需提前用Rive Editor制作并导出）；</li>
<li><code>stateMachines</code>：设计师在Rive中定义的状态机名称，用于关联交互逻辑；</li>
<li><code>fit/alignment</code>：控制动画在Canvas中的缩放和对齐方式，类似CSS的object-fit。</li>
</ul>
<h3 data-id="heading-7">4. 实现交互联动：</h3>
<p>鼠标/触摸跟随 Rive动画的核心交互性体现在“状态机输入”——设计师可在Rive中定义数值型输入（如x/y坐标）和触发型输入（如点击事件），前端通过修改这些输入值驱动动画变化。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">extractInputs</span>(<span class="hljs-params"/>) { 
    <span class="hljs-keyword">try</span> { <span class="hljs-comment">// 获取状态机的所有输入参数 </span>
        <span class="hljs-keyword">const</span> inputs = riveInstance.<span class="hljs-title function_">stateMachineInputs</span>(<span class="hljs-string">'doodle'</span>); 
        <span class="hljs-keyword">if</span> (!inputs) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 自动匹配坐标输入（兼容多种命名方式） mouseXInput = inputs.find(i =&gt; ['x','X','mouseX','MouseX','posX'].includes(i.name) ); mouseYInput = inputs.find(i =&gt; ['y','Y','mouseY','MouseY','posY'].includes(i.name) ); // 找到坐标输入后，绑定交互事件 </span>
        <span class="hljs-keyword">if</span> (mouseXInput &amp;&amp; mouseYInput) { 
            <span class="hljs-title function_">setupInteraction</span>(); 
        } 
    } <span class="hljs-keyword">catch</span> (e) { 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'提取输入失败:'</span>, e); 
    } 
} 
<span class="hljs-keyword">function</span> <span class="hljs-title function_">setupInteraction</span>(<span class="hljs-params"/>) { <span class="hljs-comment">// 统一的坐标更新逻辑 </span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">updatePosition</span> = (<span class="hljs-params">clientX, clientY</span>) =&gt; { <span class="hljs-comment">// 获取Canvas的可视区域位置 </span>
    <span class="hljs-keyword">const</span> rect = canvas.<span class="hljs-title function_">getBoundingClientRect</span>(); <span class="hljs-comment">// 将鼠标坐标转换为0-1的相对值（适配不同尺寸） </span>
    <span class="hljs-keyword">const</span> x = (clientX - rect.<span class="hljs-property">left</span>) / rect.<span class="hljs-property">width</span>; 
    <span class="hljs-keyword">const</span> y = (clientY - rect.<span class="hljs-property">top</span>) / rect.<span class="hljs-property">height</span>; <span class="hljs-comment">// 更新Rive状态机的坐标输入值 </span>
    <span class="hljs-keyword">if</span> (mouseXInput) mouseXInput.<span class="hljs-property">value</span> = x; 
    <span class="hljs-keyword">if</span> (mouseYInput) mouseYInput.<span class="hljs-property">value</span> = y; 
    }; <span class="hljs-comment">// 监听鼠标移动 </span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> { <span class="hljs-title function_">updatePosition</span>(e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>); 
    }); <span class="hljs-comment">// 监听触摸移动（适配移动端） </span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// 阻止默认滚动行为 </span>
    <span class="hljs-title function_">updatePosition</span>(e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>, e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>); }, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> }); <span class="hljs-comment">// 点击触发额外动画（触发型输入） document.addEventListener('click', () =&gt; { </span>
    <span class="hljs-keyword">const</span> trigger=riveInstance.<span class="hljs-title function_">stateMachineInputs</span>(<span class="hljs-string">'doodle'</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.<span class="hljs-property">type</span> === rive.<span class="hljs-property">StateMachineInputType</span>.<span class="hljs-property">Trigger</span>); 
    <span class="hljs-keyword">if</span> (trigger) trigger.<span class="hljs-title function_">fire</span>(); <span class="hljs-comment">// 触发动画 </span>
}); 
} 
</code></pre>
<p>核心思路：</p>
<ul>
<li>将鼠标/触摸的绝对坐标转换为相对Canvas的0-1区间值，保证不同尺寸下交互逻辑一致；</li>
<li>移动端通过<code>touchmove</code>事件适配，注意设置<code>passive: false</code>以允许阻止默认滚动；</li>
<li>点击事件触发Rive的Trigger类型输入，可实现点击时的动画反馈（如手绘笔触的“落笔”效果）。</li>
</ul>
<h3 data-id="heading-8">5. 响应式适配</h3>
<p>为了让动画在窗口尺寸变化时正常显示，需要监听<code>resize</code>事件并更新Canvas尺寸：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> { 
    canvas.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> * dpr; 
    canvas.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> * dpr; 
    <span class="hljs-keyword">if</span> (riveInstance)riveInstance.<span class="hljs-title function_">resizeDrawingSurfaceToCanvas</span>(); 
}); 
</code></pre>
<h2 data-id="heading-9">三、关键优化点</h2>
<h3 data-id="heading-10">1. 高清屏适配</h3>
<p>通过<code>window.devicePixelRatio</code>设置Canvas的实际尺寸，避免动画在Retina屏上模糊。</p>
<h3 data-id="heading-11">2. 性能优化</h3>
<ul>
<li>避免频繁修改Canvas尺寸，仅在窗口resize时更新；</li>
<li>触摸事件中合理使用<code>passive: false</code>，既阻止默认滚动又不影响性能；</li>
<li>Rive动画本身已做矢量优化，无需额外压缩，只需保证<code>.riv</code>文件体积适中。</li>
</ul>
<h3 data-id="heading-12">3. 兼容性处理</h3>
<ul>
<li>监听<code>DOMContentLoaded</code>确保页面加载完成后初始化Rive；</li>
<li>异常捕获：在提取状态机输入时增加try/catch，避免动画文件加载异常导致页面崩溃。</li>
</ul>
<h2 data-id="heading-13">四、Rive动画制作小贴士</h2>
<ol>
<li>动画文件制作：使用Rive Editor（<a href="https://link.juejin.cn?target=https%3A%2F%2Frive.app%2F%25EF%25BC%2589%25E5%2588%25B6%25E4%25BD%259C%25E6%2589%258B%25E7%25BB%2598%25E9%25A3%258E%25E6%25A0%25BC%25E5%258A%25A8%25E7%2594%25BB%25EF%25BC%258C%25E5%25AE%259A%25E4%25B9%2589%25E7%258A%25B6%25E6%2580%2581%25E6%259C%25BA%25E8%25BE%2593%25E5%2585%25A5%25EF%25BC%2588x%2Fy%25E6%2595%25B0%25E5%2580%25BC%25E8%25BE%2593%25E5%2585%25A5%25E3%2580%2581%25E7%2582%25B9%25E5%2587%25BBTrigger%25EF%25BC%2589%25EF%25BC%259B" target="_blank" title="https://rive.app/%EF%BC%89%E5%88%B6%E4%BD%9C%E6%89%8B%E7%BB%98%E9%A3%8E%E6%A0%BC%E5%8A%A8%E7%94%BB%EF%BC%8C%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BE%93%E5%85%A5%EF%BC%88x/y%E6%95%B0%E5%80%BC%E8%BE%93%E5%85%A5%E3%80%81%E7%82%B9%E5%87%BBTrigger%EF%BC%89%EF%BC%9B" ref="nofollow noopener noreferrer">rive.app/）制作手绘风格动画，定…</a></li>
<li>命名规范：状态机输入名称尽量统一（如mouseX/mouseY），方便前端自动匹配；</li>
<li>导出设置：导出时选择“Minify”压缩文件，减小体积。</li>
</ol>
<h2 data-id="heading-14">五、最终效果与结语</h2>
<p>通过以上步骤，我们实现了和Kimi官网类似的交互式手绘动画效果：</p>
<ul>
<li>鼠标/触摸跟随，动画实时响应位置变化；</li>
<li>点击触发额外动画反馈；</li>
<li>适配不同设备尺寸，高清屏无模糊；</li>
<li>高性能渲染，流畅无卡顿。</li>
</ul>
<p>Rive作为一款强大的交互式动画工具，能极大降低前端实现复杂交互动画的成本。只需设计师提供做好的<code>.riv</code>动画文件，前端即可通过简单的API实现丰富的交互效果。这种“设计与开发分离”的模式，既能保证动画效果的还原度，又能提升开发效率。</p>
<p>如果你想进一步扩展功能，还可以尝试：</p>
<ul>
<li>增加动画播放/暂停控制；</li>
<li>自定义不同交互场景的动画状态；</li>
<li>结合CSS过渡实现更丰富的视觉效果。 完整代码已在文中给出，只需替换自己的<code>.riv</code>动画文件，即可快速复刻出属于自己的交互式动画效果！</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[langchain-提示词模板的用法]]></title>    <link>https://juejin.cn/post/7600752623068463114</link>    <guid>https://juejin.cn/post/7600752623068463114</guid>    <pubDate>2026-01-30T08:23:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600752623068463114" data-draft-id="7600791597169115179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="langchain-提示词模板的用法"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2026-01-30T08:23:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浅碎时光195"/> <meta itemprop="url" content="https://juejin.cn/user/2983420676552378"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            langchain-提示词模板的用法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2983420676552378/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浅碎时光195
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:23:17.000Z" title="Fri Jan 30 2026 08:23:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 基本提示词模板：PromptTemplate</h2>
<h3 data-id="heading-1">模板依赖包及导入方式</h3>
<pre><code class="hljs language-javascript" lang="javascript">langchain0<span class="hljs-number">.1</span>版本，组件langchain.<span class="hljs-property">prompts</span>;
    <span class="hljs-keyword">from</span> langchain.<span class="hljs-property">prompts</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">PromptTemplate</span>
langchain0<span class="hljs-number">.2</span>及以上版本，调整架构，组件langchain_core.<span class="hljs-property">prompts</span>
    <span class="hljs-keyword">from</span> langchain_core.<span class="hljs-property">prompts</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">PromptTemplate</span>
    
</code></pre>
<h3 data-id="heading-2">PromptTemplate 构造方法的参数及其使用</h3>









































<table><thead><tr><th align="left">参数名</th><th align="left">类型</th><th align="left">是否必传</th><th align="left">核心作用</th></tr></thead><tbody><tr><td align="left">template</td><td align="left">str</td><td align="left">必传</td><td align="left">提示词模板字符串，包含{变量名}占位符</td></tr><tr><td align="left">input_variables</td><td align="left">list[str]</td><td align="left">可选</td><td align="left">模板中所有占位符的名称列表，用于校验参数完整性</td></tr><tr><td align="left">template_format</td><td align="left">f-string/jinja2</td><td align="left">可选</td><td align="left">模板解析格式，默认f-string</td></tr><tr><td align="left">validate_template</td><td align="left">f-string/jinja2</td><td align="left">可选</td><td align="left">是否校验模板中占位符与input_variables匹配，默认True；具体项目中也无需修改为false,可忽略此参数</td></tr><tr><td align="left">partial_variables</td><td align="left">dict</td><td align="left">可选</td><td align="left">部分固定参数</td></tr></tbody></table>
<h3 data-id="heading-3">template + input_variables + template_format="f-string"(参数默认，可缺省)的使用</h3>
<h4 data-id="heading-4">一个占位符</h4>
<pre><code class="hljs language-ini" lang="ini">from langchain_core.prompts import PromptTemplate

<span class="hljs-comment"># {varliable}是一个占位符，可通过接口修改，改变输入内容</span>
<span class="hljs-attr">tmp</span> = <span class="hljs-string">""" 我是一位{varliable}初学者 """</span> 

<span class="hljs-attr">prompt_template</span> = PromptTemplate(
   <span class="hljs-attr">template</span> = tmp,
   <span class="hljs-attr">input_variables</span> = [<span class="hljs-string">"varliable"</span>] <span class="hljs-comment"># 列表类型</span>
)

""" 给占位符赋值的一种方式，langchain1.0前的用法<span class="hljs-comment">; .format返回值是str类型</span>
<span class="hljs-attr">final_prompt</span> = prompt_template.format(varliable=<span class="hljs-string">"AI应用"</span>)
print(final_prompt)
"""

<span class="hljs-comment"># 给占位符赋值的另一种方式，langchain1.0后的用法，给占位符赋值；PromptTemplate的.invoke()返回值是StringPromptValue封装纯文本提示词，可通过.text获取字符串</span>

<span class="hljs-attr">result</span> = prompt_template.invoke( {<span class="hljs-string">"varliable"</span>:<span class="hljs-string">"AI应用"</span>} ) 
print(result.text)

<span class="hljs-comment"># 输出  我是一位AI应用初学者</span>
</code></pre>
<h4 data-id="heading-5">多个占位符</h4>
<pre><code class="hljs language-ini" lang="ini">from langchain_core.prompts import PromptTemplate

<span class="hljs-attr">tmp</span> = <span class="hljs-string">""" 我是一位{varliable}初学者，练习时长{learnLenth} """</span> 

<span class="hljs-attr">prompt_template</span> = PromptTemplate(
   <span class="hljs-attr">template</span> = tmp,
   <span class="hljs-attr">input_variables</span> = [<span class="hljs-string">"varliable"</span>,<span class="hljs-string">"learnLenth"</span>] <span class="hljs-comment"># 列表类型</span>
)

<span class="hljs-attr">result</span> = prompt_template.invoke( {<span class="hljs-string">"varliable"</span>:<span class="hljs-string">"AI应用"</span>,<span class="hljs-string">"learnLenth"</span>:<span class="hljs-string">"两年半"</span>} ) 

print(result.text)

<span class="hljs-comment"># 输出  我是一位AI应用初学者,练习时长两年半</span>
</code></pre>
<h3 data-id="heading-6">template_format 'jinja2'的使用</h3>

























<table><thead><tr><th align="left">f-string</th><th align="left">jinja2</th><th align="left">功能</th></tr></thead><tbody><tr><td align="left">{varliable}</td><td align="left">{{varliable}}</td><td align="left">占位符</td></tr><tr><td align="left"/><td align="left">{% if 条件 %} {% endif %}</td><td align="left">条件判断</td></tr><tr><td align="left"/><td align="left">{% for 元素 in 列表 %} {% endfor %}</td><td align="left">循环语句</td></tr></tbody></table>
<h4 data-id="heading-7">jinja2</h4>
<pre><code class="hljs language-ini" lang="ini">from langchain_core.prompts import PromptTemplate

<span class="hljs-comment"># {{varliable}}是一个占位符，可通过接口修改，改变输入内容</span>
<span class="hljs-attr">tmp</span> = <span class="hljs-string">""" 我是一位{{varliable}}初学者 """</span>

<span class="hljs-attr">prompt_template</span> = PromptTemplate(
    <span class="hljs-attr">template</span> = tmp,
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"varliable"</span>],
    <span class="hljs-attr">template_format</span>=<span class="hljs-string">"jinja2"</span>
)

<span class="hljs-attr">result</span> = prompt_template.invoke({<span class="hljs-string">"varliable"</span>:<span class="hljs-string">"AI应用"</span>})

print(result.text)
</code></pre>
<h4 data-id="heading-8">{% if 条件 %} {% endif %}</h4>
<pre><code class="hljs language-ini" lang="ini">from langchain_core.prompts import PromptTemplate

<span class="hljs-attr">tmp</span> = <span class="hljs-string">"""
你是一名{{role}}，为{{user_type}}撰写文案
{% if user_type == "学生" %}
要求：语言活泼，突出性价比，不超过80字
{% elif user_type == "职场人" %}
要求：语言专业，突出效率，不超过100字。
{% else %}
要求：通用风格，简洁明了，不超过90字。
{% endif %}
产品：{{product}}，卖点：{{selling_point}}
"""</span>
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
    <span class="hljs-attr">template</span> = tmp,
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"role"</span>,<span class="hljs-string">"user_type"</span>,<span class="hljs-string">"product"</span>,<span class="hljs-string">"selling_point"</span>],
    <span class="hljs-attr">template_format</span>=<span class="hljs-string">"jinja2"</span>
)

<span class="hljs-attr">result</span> = prompt_template.invoke({<span class="hljs-string">"role"</span>:<span class="hljs-string">"专家"</span>,<span class="hljs-string">"user_type"</span>:<span class="hljs-string">"学生"</span>,<span class="hljs-string">"product"</span>:<span class="hljs-string">"蓝牙耳机"</span>,<span class="hljs-string">"selling_point"</span>:<span class="hljs-string">"省电"</span>})

print(result.text)

<span class="hljs-comment"># 输出：你是一名专家，为学生撰写文案 要求：语言活泼，突出性价比，不超过80字 产品：蓝牙耳机，卖点：省电</span>


<span class="hljs-attr">result</span> = prompt_template.invoke({<span class="hljs-string">"role"</span>:<span class="hljs-string">"专家"</span>,<span class="hljs-string">"user_type"</span>:<span class="hljs-string">"职场人"</span>,<span class="hljs-string">"product"</span>:<span class="hljs-string">"蓝牙耳机"</span>,<span class="hljs-string">"selling_point"</span>:<span class="hljs-string">"省电"</span>})

print(result.text)

<span class="hljs-comment"># 输出：你是一名专家，为职场人撰写文案  要求：语言专业，突出效率，不超过100字。 产品：蓝牙耳机，卖点：省电</span>

<span class="hljs-attr">result</span> = prompt_template.invoke({<span class="hljs-string">"role"</span>:<span class="hljs-string">"专家"</span>,<span class="hljs-string">"user_type"</span>:<span class="hljs-string">"学者"</span>,<span class="hljs-string">"product"</span>:<span class="hljs-string">"蓝牙耳机"</span>,<span class="hljs-string">"selling_point"</span>:<span class="hljs-string">"省电"</span>})

<span class="hljs-comment"># 输出：你是一名专家，为学者撰写文案  要求：通用风格，简洁明了，不超过90字。 产品：蓝牙耳机，卖点：省电</span>
</code></pre>
<h4 data-id="heading-9">{% for 元素 in 列表 %}</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate

template = <span class="hljs-string">"""
    {% for trunk in trunks %}
    -   {{trunk}}
    {% endfor %}
"""</span>

prompt_template = PromptTemplate(
    template=template,
    input_variables=[<span class="hljs-string">"trunks"</span>],
    template_format=<span class="hljs-string">"jinja2"</span>
)

result = prompt_template.invoke({<span class="hljs-string">"trunks"</span>:[<span class="hljs-string">"北京今天多云"</span>, <span class="hljs-string">"气温10-20℃"</span>, <span class="hljs-string">"微风"</span>]})

<span class="hljs-built_in">print</span>(result.text)

<span class="hljs-string">""" 输出
-   北京今天多云

-   气温10-20℃

-   微风
"""</span>
</code></pre>
<h3 data-id="heading-10">partial_variables 的使用</h3>
<pre><code class="hljs language-ini" lang="ini">from langchain_core.prompts import PromptTemplate

<span class="hljs-attr">tmp</span> = <span class="hljs-string">""" 我是一位{varliable}初学者，练习时长{learnLenth} """</span> 

<span class="hljs-attr">prompt_template</span> = PromptTemplate(
   <span class="hljs-attr">template</span> = tmp,
   <span class="hljs-attr">input_variables</span> = [<span class="hljs-string">"varliable"</span>,<span class="hljs-string">"learnLenth"</span>], <span class="hljs-comment"># 列表类型</span>
   <span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"learnLenth"</span>:<span class="hljs-string">"两年半"</span>}   <span class="hljs-comment"># 固定 learnLenth 参数值</span>
)

<span class="hljs-attr">result</span> = prompt_template.invoke( {<span class="hljs-string">"varliable"</span>:<span class="hljs-string">"AI应用"</span>} ) 

print(result.text)

<span class="hljs-comment"># 输出  我是一位AI应用初学者,练习时长两年半</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git 使用规范]]></title>    <link>https://juejin.cn/post/7600837236620427316</link>    <guid>https://juejin.cn/post/7600837236620427316</guid>    <pubDate>2026-01-30T08:44:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600837236620427316" data-draft-id="7600799940970577960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git 使用规范"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2026-01-30T08:44:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="完山"/> <meta itemprop="url" content="https://juejin.cn/user/1848713794559706"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git 使用规范
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1848713794559706/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    完山
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:44:55.000Z" title="Fri Jan 30 2026 08:44:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>自用的）在 GitHub 上进行开源项目的开发时，确保代码管理的清晰和协作的顺利进行，有一些常见的最佳实践和规范。以下是一般的规范建议：</p>
<h3 data-id="heading-0">1. Git Flow</h3>
<p>一种经典的分支管理模型，包含 master、develop、feature、release 和 hotfix 分支等。</p>
<p><strong>主分支 (Main/Master Branch)</strong> ： 通常是 main 或 master，这是代码的稳定版本，确保在发布前所有测试通过。</p>
<p><strong>功能分支 (Feature Branches)</strong> ： 每个新的功能或特性应该有一个单独的分支，通常命名为 feature/feature-name。 feature被review通过了就可以合并到develop分支，如果小规模团队和项目的话直接合并到main分支就可以了。git commit -m "feat: 干啥了"</p>
<p><strong>错误修复分支 (Hotfix Branches)</strong> ： 紧急错误修复通常从主分支拉出，命名为 hotfix/fix-name。</p>
<p><strong>开发分支 (Develop Branch)</strong> ： 可选的分支，用于集成所有功能分支，使用在准备发布到主分支前。</p>
<h3 data-id="heading-1">2. Commit Messages</h3>
<p><strong>格式清晰</strong>： 通常结构为：类型: 简短描述。 示例：fix: 修复登录崩溃问题 或 feat: 添加用户注册功能。</p>
<p><strong>使用命令式语气</strong>： 描述“这次提交做了什么”而不是“正在做什么”。</p>
<p><strong>保持简洁</strong>： 通常简短描述不超过50个字符。 如果需要详细描述，可以在下面添加更详细的说明。</p>
<p><strong>Commit Message Conventions</strong>：提交信息通常使用某种规范。使用现在时，简洁不超过50个字符。以下是常见的提交类型：</p>
<pre><code class="hljs language-bash" lang="bash">commit格式：&lt;<span class="hljs-built_in">type</span>&gt;(&lt;scope&gt;): &lt;subject&gt;
  
feat(auth): add login functionality <span class="hljs-comment"># 新增特性</span>
fix(user): correct typo <span class="hljs-keyword">in</span> username validation <span class="hljs-comment"># 修复bug</span>
docs(readme): update installation instructions <span class="hljs-comment"># 更新文档</span>
refactor(api): simplify request handling <span class="hljs-comment"># 代码重构</span>
perf(search): improve search algorithm performance <span class="hljs-comment"># 性能优化</span>
<span class="hljs-built_in">test</span>(button): add unit tests <span class="hljs-keyword">for</span> button component <span class="hljs-comment">#测试</span>
</code></pre>
<h3 data-id="heading-2">3. Pull Requests</h3>
<p><strong>描述明确</strong>： 清晰描述所解决的问题或实现的功能。</p>
<p><strong>引用相关问题</strong>： 使用 closes #issue-number 注解自动关闭相关的 GitHub Issues。</p>
<p><strong>请求代码审查</strong>： 寻求团队成员的审查和反馈。</p>
<h3 data-id="heading-3">4. Git 常用命令</h3>
<h4 data-id="heading-4">拉取代码</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取远程代码（不合并）</span>
git fetch

<span class="hljs-comment"># 拉取远程代码后合并（等同于 git fetch + git merge）</span>
git pull

<span class="hljs-comment"># 拉取远程代码后合并（等同于 git fetch + git rebase）</span>
git pull --rebase
</code></pre>
<h4 data-id="heading-5">提交代码</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 添加所有文件到暂存区</span>
git add .

<span class="hljs-comment"># 提交到本地仓库</span>
git commit -m <span class="hljs-string">"Commit Messages"</span>

<span class="hljs-comment"># 提交到远程仓库</span>
git push
</code></pre>
<h4 data-id="heading-6">撤销更改</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 将工作区恢复到上一次提交的状态（如果误修改了文件想还原）</span>
git restore [file]

<span class="hljs-comment"># 撤销暂存操作（撤销 git add）</span>
git restore --staged [file]

<span class="hljs-comment"># 撤销最近一次 commit（保留本地更改）</span>
git reset --soft HEAD~1

<span class="hljs-comment"># 撤销最近一次 commit 并不保留本地修改（慎用！）</span>
git reset --hard HEAD~1

<span class="hljs-comment"># 撤销已经提交到远端的 commit（保留记录）</span>
git revert [<span class="hljs-built_in">hash</span>]
git push

<span class="hljs-comment"># 查看历史操作</span>
git reflog
git <span class="hljs-built_in">log</span>

<span class="hljs-comment"># 取消已经被 git 追踪的文件（因为 .gitignore 无法取消已经被追踪的文件，此时需要手动取消）</span>
git <span class="hljs-built_in">rm</span> --cached [file]
</code></pre>
<h4 data-id="heading-7">操作分支</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看本地分支，-a 查看所有分支，</span>
git branch

<span class="hljs-comment"># 创建并切换分支</span>
git checkout -b [branch]

<span class="hljs-comment"># 切换到已有分支</span>
git checkout [branch]
git switch [branch]

<span class="hljs-comment"># 修改分支名</span>
git branch -m [branch]

<span class="hljs-comment"># 删除本地分支</span>
git branch -d [branch]

<span class="hljs-comment"># 删除远程仓库分支</span>
git push origin --delete [branch]

<span class="hljs-comment"># 变基分支</span>
git rebase [branch]

<span class="hljs-comment"># 合并分支</span>
git merge [branch]

<span class="hljs-comment"># 合并指定commit</span>
git cherry-pick [<span class="hljs-built_in">hash</span>]
</code></pre>
<h4 data-id="heading-8">新建仓库</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化</span>
git init

<span class="hljs-comment"># 查看远程仓库信息</span>
git remote -v

<span class="hljs-comment"># 添加远程仓库</span>
git remote add origin &lt;repository_url&gt;
git remote set-url origin &lt;repository_ssh&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建你的第一个AIGC应用：从原理到实践]]></title>    <link>https://juejin.cn/post/7600957412128948239</link>    <guid>https://juejin.cn/post/7600957412128948239</guid>    <pubDate>2026-01-30T09:53:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600957412128948239" data-draft-id="7600986252448596008" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建你的第一个AIGC应用：从原理到实践"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T09:53:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lee川"/> <meta itemprop="url" content="https://juejin.cn/user/2402874087453658"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建你的第一个AIGC应用：从原理到实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2402874087453658/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lee川
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:53:31.000Z" title="Fri Jan 30 2026 09:53:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">构建你的第一个AIGC应用：从原理到实践</h2>
<h3 data-id="heading-1">一、项目全景：我们要做什么？</h3>
<p>想象一下，你有一个永不疲倦、技艺高超的AI画师。这个项目就是你与这位画师之间的<strong>自动化沟通桥梁</strong>。你通过代码下达指令，AI画师作画，然后将作品（图片网址）送回给你。</p>
<p><strong>核心价值</strong>：将重复性的AI绘图任务自动化，为后续集成到网站、App或工作流中奠定基础。</p>
<h3 data-id="heading-2">二、技术栈深度剖析</h3>
<h4 data-id="heading-3">1. 包管理的进化：为什么是pnpm？</h4>
<p>传统的npm管理依赖时，每个项目都独立存储依赖包。如果你的电脑有10个Vue项目，就会有10份Vue的代码，这显然不高效。</p>
<p><strong>pnpm的聪明之处</strong>：</p>
<ul>
<li>它在本机建立一个<strong>中央仓库</strong>存储所有包</li>
<li>新项目需要包时，pnpm创建一个“快捷方式”指向中央仓库</li>
<li>就像图书馆：书只有一套，但所有读者都能借阅</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统方式 - 每个项目独立存储</span>
npm install openai  <span class="hljs-comment"># 下载并存储到当前项目的node_modules</span>

<span class="hljs-comment"># pnpm方式 - 全局链接</span>
pnpm install openai  <span class="hljs-comment"># 创建链接指向全局存储</span>
</code></pre>
<p><strong>实际影响</strong>：安装速度提升2倍，磁盘占用减少50%以上。</p>
<h4 data-id="heading-4">2. 模块化：现代JavaScript的工程化思维</h4>
<p><strong>问题</strong>：早期JavaScript所有代码写在一起，几千行代码难以维护。</p>
<p><strong>解决方案</strong>：像乐高积木一样拆分功能。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统写法 - 整个工具箱都拿来</span>
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
dotenv.<span class="hljs-title function_">config</span>();  <span class="hljs-comment">// 还要通过.来调用</span>

<span class="hljs-comment">// 现代写法 - 只拿需要的工具</span>
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
<span class="hljs-title function_">config</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'.env'</span> });  <span class="hljs-comment">// 直接使用</span>
</code></pre>
<p><strong>解构导入的精妙之处</strong>：</p>
<ul>
<li>明确声明：我只需要<code>config</code>这个功能</li>
<li>打包优化：构建工具可以剔除未使用的代码</li>
<li>代码清晰：一眼就知道依赖什么功能</li>
</ul>
<h4 data-id="heading-5">3. 环境变量：安全与配置的艺术</h4>
<p><strong>为什么不用硬编码？</strong></p>
<pre><code class="hljs language-ini" lang="ini">// ❌ 危险做法 - 密码暴露在代码中
const <span class="hljs-attr">apiKey</span> = <span class="hljs-string">"sk-123456789abc"</span><span class="hljs-comment">;</span>

// ✅ 安全做法 - 从环境变量读取
const <span class="hljs-attr">apiKey</span> = process.env.OpenAI_API_KEY<span class="hljs-comment">;</span>
</code></pre>
<p><strong>环境变量的多重价值</strong>：</p>
<ol>
<li><strong>安全性</strong>：代码可以公开，密码保持私有</li>
<li><strong>灵活性</strong>：开发、测试、生产环境使用不同配置</li>
<li><strong>便捷性</strong>：修改配置无需重新部署代码</li>
</ol>
<p><strong>process.env的底层原理</strong>：</p>
<ul>
<li>当Node.js进程启动时，操作系统会注入环境变量</li>
<li><code>process.env</code>是一个特殊的对象，包含所有环境变量</li>
<li>dotenv库的作用：读取.env文件内容，将其添加到<code>process.env</code>中</li>
</ul>
<h4 data-id="heading-6">4. 进程概念：理解程序运行的环境</h4>
<p><strong>前端 vs 后端环境差异</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 前端环境 - 操作浏览器文档</span>
document.<span class="hljs-built_in">getElementById</span>(<span class="hljs-string">'app'</span>);  <span class="hljs-comment">// 操作网页元素</span>
window.location.href;           <span class="hljs-comment">// 获取浏览器地址</span>

<span class="hljs-comment">// 后端环境 - 操作服务器进程  </span>
process.env.API_KEY;           <span class="hljs-comment">// 读取系统环境变量</span>
process.<span class="hljs-built_in">cwd</span>();                 <span class="hljs-comment">// 获取当前工作目录</span>
</code></pre>
<p><strong>进程的深层理解</strong>：</p>
<ul>
<li>每个运行的程序都是操作系统的一个<strong>进程</strong></li>
<li>进程拥有独立的内存空间和系统资源</li>
<li>我们的Node.js脚本运行时，就是一个独立的进程</li>
</ul>
<h3 data-id="heading-7">三、AIGC核心：提示工程的艺术</h3>
<h4 data-id="heading-8">1. API客户端配置：连接AI服务的桥梁</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-built_in">OpenAI</span>({
    apiKey: process.env.OpenAI_API_KEY,  <span class="hljs-comment">// 身份认证</span>
    baseURL: <span class="hljs-string">'https://api.agicto.cn/v1'</span>   <span class="hljs-comment">// 服务端点</span>
});
</code></pre>
<p><strong>baseURL的妙用</strong>：</p>
<ul>
<li>默认指向OpenAI官方服务器</li>
<li>可以替换为其他兼容OpenAI API的服务商</li>
<li>在国内访问时，常用代理服务解决网络问题</li>
</ul>
<h4 data-id="heading-9">2. 提示词设计：如何与AI有效沟通？</h4>
<p><strong>提示词演进示例</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 初级提示词 - 结果随机性强</span>
<span class="hljs-string">"画一只猫"</span>

<span class="hljs-comment">// 中级提示词 - 增加细节约束  </span>
<span class="hljs-string">"画一只橘猫在沙发上晒太阳，温暖的光影"</span>

<span class="hljs-comment">// 高级提示词 - 专业级描述</span>
<span class="hljs-string">"A cute ginger cat lounging on a vintage velvet sofa, bathed in warm sunlight streaming through a window, photorealistic style, 4K resolution"</span>
</code></pre>
<p><strong>提示工程的核心原则</strong>：</p>
<ol>
<li><strong>具体性</strong>：明确主题、风格、细节要求</li>
<li><strong>上下文</strong>：提供足够的背景信息引导AI</li>
<li><strong>约束条件</strong>：指定尺寸、数量、格式等限制</li>
<li><strong>迭代优化</strong>：基于结果不断调整提示词</li>
</ol>
<h3 data-id="heading-10">四、异步编程：现代JavaScript的智慧</h3>
<h4 data-id="heading-11">1. 从回调地狱到async/await</h4>
<p><strong>演进历程</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 回调地狱 - 难以阅读和维护</span>
client.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>(options, <span class="hljs-function">(<span class="hljs-params">error, response</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 处理响应</span>
        client.<span class="hljs-title function_">anotherCall</span>(response, <span class="hljs-function">(<span class="hljs-params">error2, response2</span>) =&gt;</span> {
            <span class="hljs-comment">// 更多嵌套...</span>
        });
    }
});

<span class="hljs-comment">// 2. Promise链 - 稍好但仍复杂  </span>
client.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>(options)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> client.<span class="hljs-title function_">anotherCall</span>(response);
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response2</span> =&gt;</span> {
        <span class="hljs-comment">// 处理结果</span>
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    });

<span class="hljs-comment">// 3. async/await - 同步写法，异步效果</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>(options);
    <span class="hljs-keyword">const</span> response2 = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">anotherCall</span>(response);
    <span class="hljs-comment">// 代码清晰如同步</span>
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
}
</code></pre>
<h4 data-id="heading-12">2. 箭头函数的优势</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统函数 - this指向调用者</span>
<span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"test"</span>,
    <span class="hljs-attr">traditional</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 输出"test"</span>
    }
};

<span class="hljs-comment">// 箭头函数 - this继承自外层</span>
<span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"test"</span>, 
    <span class="hljs-attr">arrow</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 输出undefined（继承全局）</span>
    }
};
</code></pre>
<h3 data-id="heading-13">五、完整工作流程解析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 准备阶段：导入工具和配置</span>
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"openai"</span>;

<span class="hljs-comment">// 2. 初始化阶段：读取配置并建立连接</span>
<span class="hljs-title function_">config</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'.env'</span> });
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
    <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OpenAI_API_KEY</span>,
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.agicto.cn/v1'</span>
});

<span class="hljs-comment">// 3. 执行阶段：定义主逻辑</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 3.1 构造请求：告诉AI要画什么</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">images</span>.<span class="hljs-title function_">generate</span>({
            <span class="hljs-attr">model</span>: <span class="hljs-string">"dall-e-3"</span>,           <span class="hljs-comment">// 选择模型引擎</span>
            <span class="hljs-attr">prompt</span>: <span class="hljs-string">"A spaceship flying through the universe"</span>,  <span class="hljs-comment">// 核心指令</span>
            <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,                        <span class="hljs-comment">// 生成数量</span>
            <span class="hljs-attr">size</span>: <span class="hljs-string">"1024x1024"</span>            <span class="hljs-comment">// 图片规格</span>
        });
        
        <span class="hljs-comment">// 3.2 处理响应：获取结果</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"AI作品网址:"</span>, response.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>].<span class="hljs-property">url</span>);
        
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// 4. 错误处理：优雅应对异常</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"生成图片失败:"</span>, error.<span class="hljs-property">message</span>);
    }
};

<span class="hljs-comment">// 5. 启动应用</span>
<span class="hljs-title function_">main</span>();
</code></pre>
<h3 data-id="heading-14">六、项目扩展思路</h3>
<h4 data-id="heading-15">1. 功能增强方向</h4>
<ul>
<li><strong>批量生成</strong>：读取文本文件，自动生成多张图片</li>
<li><strong>风格转换</strong>：集成不同艺术风格的提示词模板</li>
<li><strong>结果处理</strong>：自动下载图片到本地目录</li>
</ul>
<h4 data-id="heading-16">2. 工程化改进</h4>
<ul>
<li><strong>配置文件</strong>：将模型参数、图片尺寸等提取到配置文件中</li>
<li><strong>日志系统</strong>：添加详细的运行日志记录</li>
<li><strong>错误重试</strong>：网络异常时自动重试机制</li>
</ul>
<h4 data-id="heading-17">3. 业务集成</h4>
<ul>
<li><strong>Web接口</strong>：封装成HTTP API供前端调用</li>
<li><strong>定时任务</strong>：定期自动生成特定主题的图片</li>
<li><strong>内容管理</strong>：将生成的图片信息保存到数据库</li>
</ul>
<p>这个项目虽然代码量不大，但包含了现代JavaScript开发的核心理念和技术栈。理解这些原理，你就能快速扩展到其他AIGC领域，如文本生成、语音合成等，真正掌握AI时代的开发技能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[godot-rust（gdext）你的第一个2D游戏 - 5]]></title>    <link>https://juejin.cn/post/7600837236619870260</link>    <guid>https://juejin.cn/post/7600837236619870260</guid>    <pubDate>2026-01-30T07:21:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600837236619870260" data-draft-id="7600606150732693547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="godot-rust（gdext）你的第一个2D游戏 - 5"/> <meta itemprop="keywords" content="游戏"/> <meta itemprop="datePublished" content="2026-01-30T07:21:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="柚要做甚码"/> <meta itemprop="url" content="https://juejin.cn/user/2200546203156138"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            godot-rust（gdext）你的第一个2D游戏 - 5
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2200546203156138/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    柚要做甚码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:21:04.000Z" title="Fri Jan 30 2026 07:21:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简介</h2>
<p>本文以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Fgetting_started%2Ffirst_2d_game%2Findex.html" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/getting_started/first_2d_game/index.html" ref="nofollow noopener noreferrer">你的第一个 2D 游戏 — Godot Engine (4.5) 简体中文文档</a>为蓝本撰写，godot-rust提供了该教程的一个rust的实现<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodot-rust%2Fdemo-projects%2Ftree%2Fmaster%2Fdodge-the-creeps" target="_blank" title="https://github.com/godot-rust/demo-projects/tree/master/dodge-the-creeps" ref="nofollow noopener noreferrer">dodge-the-creeps</a>，与本文方法会稍有不同。如果你对rust、godot等内容比较生疏或感到疑惑，可以先阅读<a href="https://link.juejin.cn/?target=https%3A%2F%2Fcolinwttt.github.io%2Fgodot-rust-book-chinese%2Fintro%2Findex.html" title="https://link.juejin.cn/?target=https%3A%2F%2Fcolinwttt.github.io%2Fgodot-rust-book-chinese%2Fintro%2Findex.html" target="_blank">godot-rust入门文档</a>。</p>
<p>本文搭建在<a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目</a>的基础之上，如果你对该部分内容感到生疏，可以先阅读这部分内容，为接下来的操作做好准备。</p>
<p><strong>注意，本文使用的godot版本为4.5.1，godot版本的变化可能会导致一些内容失效</strong>。</p>
<p>本文操作均在Windows上执行。</p>
<h2 data-id="heading-1">正文</h2>
<h3 data-id="heading-2">创建主场景</h3>
<p>在rust中创建<strong>主场景</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> godot::prelude::*;

<span class="hljs-meta">#[derive(GodotClass)]</span>
<span class="hljs-meta">#[class(base=Node)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Main</span> {
    base: Base&lt;Node&gt;,
}
<span class="hljs-meta">#[godot_api]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">INode</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">init</span>(base: Base&lt;Node&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { base }
    }
}
</code></pre>
<blockquote>
<p>我们之所以使用 Node 而不是 Node2D，是因为这个节点会作为处理游戏逻辑的容器使用。本身是不需要 2D 功能的。</p>
</blockquote>
<p>编译rust</p>
<pre><code class="hljs">cargo build
</code></pre>
<p>回到godot编辑器，如同之前一样创建新场景：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4ee8281d80749ffb3160235f0870e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=dSlvFeSkTkjmmhyo9qMNyB34JRA%3D" alt="创建Main" loading="lazy"/></p>
<p>保存main场景，这时你的<strong>文件系统</strong>看上去应该像这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cd9554e70494b209f732aa1ce28a553~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=DY0T1QlV%2FfOy5hW87vUlaLU6BSM%3D" alt="保存main场景" loading="lazy"/></p>
<p>在<code>Main</code>场景下实例化你的<code>Player</code>使其成为一个子节点：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d386421535564ca29ffae349417487d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=8ooJsij2gTNZYPnOJbcP%2BHljVKo%3D" alt="实例化场景" loading="lazy"/></p>
<p>为<code>Main</code>添加子节点:</p>
<ul>
<li><code>Timer</code>更名为<code>MobTimer</code> —— 控制怪物产生的频率</li>
<li><code>Timer</code>更名为<code>ScoreTimer</code> —— 计算游玩秒数，即分数</li>
<li><code>Timer</code>更名为<code>StartTimer</code> —— 在游戏开始之前给出延迟</li>
<li><code>Marker2D</code>更名为<code>StartPosition</code> —— 表示玩家的起始位置</li>
</ul>
<p>在每个<code>Timer</code>节点的<strong>检查器</strong>面板中设置<code>Wait Time</code>属性：</p>
<ul>
<li><code>MobTimer</code>：<code>0.5s</code></li>
<li><code>ScoreTimer</code>：<code>1s</code></li>
<li><code>StartTimer</code>：<code>2s</code></li>
</ul>
<p>注意，我们并没有为<code>Main</code><strong>编组</strong>。</p>
<p>在<code>StartTimer</code>的<strong>检查器</strong>面板中，启用<code>One Shot</code>属性，<code>StartPosition</code>的<code>Position</code>属性设置为<code>x = 240, y = 450</code>。</p>
<h3 data-id="heading-3">生成怪物</h3>
<p>在主场景中我们需要实现生成怪物的逻辑，它是从游戏屏幕边缘随机位置生成，为<code>Main</code>添加子节点<code>Path2D</code>并命名为<code>MobPath</code>，选中<code>MobPath</code>，在工具栏你应该会发现一些新的按钮。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88fa44670eb5495283d63513bedeca59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=SoBImVOYXZZ9pth%2BBK2Ig8T7mvI%3D" alt="工具栏变化" loading="lazy"/></p>
<p>推荐将<strong>使用智能吸附</strong>和<strong>使用栅格吸附</strong>这两个功能打开</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae4a6d1fef854cbf9a3bc69a42914ada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=cJ%2FImZdkfmHEiESclCQ1zdgly0Y%3D" alt="使用吸附" loading="lazy"/></p>
<p>使用按住<code>ctrl + 鼠标左键</code>方式，如下图所示，顺时针方式为你的游戏边框生成一条路径：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc7a2f9cc77e4a65af8044b662c852a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=NL3NniYmz%2FSJJMhLA96sIm1kXl8%3D" alt="draw_path2d.gif" loading="lazy"/></p>
<p>完成后你应该能在你的编辑器中看到如下所示带箭头的一个闭合矩形，大小和你的游戏屏幕一致：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0911f06e695a40afaa03c89974376407~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=WIaMJqE0njdJvC76IbGBZADAtOQ%3D" alt="微信图片_20260130085358_66_27.jpg" loading="lazy"/></p>
<p><em>原文提到“以顺时针的顺序绘制路径，否则小怪会向外而非向内生成！”，并非指顺时针这个方向是什么特别约定或者对godot引擎来说有何特别之处，是由于其生成怪物算法依赖了上图中路径的箭头方向</em></p>
<p>再为<code>Path2D</code>子节点添加子节点<code>PathFollow2D</code>并命名为<code>MobSpawnLocation</code>，此时你的节点结构看上去应该像这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/847fd161374b4db7aacb4396e7f83689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=siPiV2yG51J2AATQjJW%2FZxEzNJo%3D" alt="main的节点结构" loading="lazy"/></p>
<h3 data-id="heading-4">编写主场景代码</h3>
<p>在rust中向<code>Main</code>添加两个字段，并更新<code>init()</code>函数：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[derive(GodotClass)]</span>
<span class="hljs-meta">#[class(base=Node)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-meta">#[export]</span>
    mob_scene: OnEditor&lt;Gd&lt;PackedScene&gt;&gt;,
    score: <span class="hljs-type">i64</span>,
    base: Base&lt;Node&gt;,
}
<span class="hljs-meta">#[godot_api]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">INode</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">init</span>(base: Base&lt;Node&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            mob_scene: OnEditor::<span class="hljs-title function_ invoke__">default</span>(),
            score: <span class="hljs-number">0</span>,
            base,
        }
    }
}
</code></pre>
<p>编译rust</p>
<pre><code class="hljs">cargo build
</code></pre>
<p>回到godot编辑器，在编辑器里给<code>mob_scene</code>赋值：</p>
<ul>
<li>将<code>mob.tscn</code>从<strong>文件系统</strong>面板拖放到<code>Mob Scene</code>属性里。</li>
<li>单击<code>[空]</code>旁边的下拉箭头按钮，选择“加载”。选择 <code>mob.tscn</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/388faf34c8c1430ab1fde1630e98ae00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=8BMZ%2FdVhTO2RbFHwsXb40pjQrYE%3D" alt="初始化Mob" loading="lazy"/></p>
<p>我们先在<code>Main</code>中添加一个<code>game_over</code>方法：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[godot_api]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">game_over</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>().get_node_as::&lt;Timer&gt;(<span class="hljs-string">"ScoreTimer"</span>).<span class="hljs-title function_ invoke__">stop</span>();
        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>().get_node_as::&lt;Timer&gt;(<span class="hljs-string">"MobTimer"</span>).<span class="hljs-title function_ invoke__">stop</span>();
    }
}
</code></pre>
<p>将<code>Player</code>的<code>hit()</code>信号连接到<code>game_over()</code>，注意，在这之前请将<code>Player</code>和<code>Player</code>的<code>hit()</code>信号添加<code>pub</code>标识，让其在rust中外部可见：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Player</span>
......
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Player</span> {
    <span class="hljs-meta">#[signal]</span>
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">hit</span>();
    ......
}
</code></pre>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[godot_api]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">INode</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Main</span> {
    ......
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ready</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>()
            .get_node_as::&lt;Player&gt;(<span class="hljs-string">"Player"</span>)
            .<span class="hljs-title function_ invoke__">signals</span>()
            .<span class="hljs-title function_ invoke__">hit</span>()
            .<span class="hljs-title function_ invoke__">connect_other</span>(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">Self</span>::game_over);
    }
}
</code></pre>
<p>开始下一步之前我们在<code>impl Main</code>模块中准备一个<code>new_game()</code>方法以供备用，在这之前请将<code>player</code>的<code>start()</code>方法标记为<code>pub</code>，就像前面一步一样。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Main</span> {
    ......
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new_game</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.score = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// 获得我们定义的初始位置，即(240.0, 450.0)</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">position</span> = <span class="hljs-keyword">self</span>
            .<span class="hljs-title function_ invoke__">base</span>()
            .get_node_as::&lt;Marker2D&gt;(<span class="hljs-string">"StartPosition"</span>)
            .<span class="hljs-title function_ invoke__">get_position</span>();

        <span class="hljs-comment">// 展现godot-rust通过bind机制从GD对象调用Player定义的方法</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">mob</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>().get_node_as::&lt;Player&gt;(<span class="hljs-string">"Player"</span>);
        {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">player</span> = mob.<span class="hljs-title function_ invoke__">bind_mut</span>(); <span class="hljs-comment">// 在区域内绑定，并在区域内释放</span>
            player.<span class="hljs-title function_ invoke__">start</span>(position);
        }

        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>().get_node_as::&lt;Timer&gt;(<span class="hljs-string">"StartTimer"</span>).<span class="hljs-title function_ invoke__">start</span>();
    }
}
</code></pre>
<p>现在处理三个计时器<code>Timer</code>，在<code>impl Main</code>模块中添加三个<code>handle()</code>，在此之前你需要将你的<code>Mob</code>标记为<code>pub</code>让其在rust内外部可见：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_score_timer_timeout</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    <span class="hljs-keyword">self</span>.score += <span class="hljs-number">1</span>; <span class="hljs-comment">// 每次ScoreTimer按照设置的等待时间跳一次，加一分</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_start_timer_timeout</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>().get_node_as::&lt;Timer&gt;(<span class="hljs-string">"MobTimer"</span>).<span class="hljs-title function_ invoke__">start</span>(); <span class="hljs-comment">// MobTimer开始计时</span>
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>().get_node_as::&lt;Timer&gt;(<span class="hljs-string">"ScoreTimer"</span>).<span class="hljs-title function_ invoke__">start</span>(); <span class="hljs-comment">// ScoreTimer开始计时</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_mob_timer_timeout</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">rng</span> = rand::<span class="hljs-title function_ invoke__">rng</span>();

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">mob</span> = <span class="hljs-keyword">self</span>.mob_scene.instantiate_as::&lt;Mob&gt;(); <span class="hljs-comment">// 生成一个Mob实例</span>

    <span class="hljs-comment">// 在边框路径上随机获得一个点</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">mob_spawn_location</span> = <span class="hljs-keyword">self</span>
        .<span class="hljs-title function_ invoke__">base</span>()
        .get_node_as::&lt;PathFollow2D&gt;(<span class="hljs-string">"MobPath/MobSpawnLocation"</span>);
    mob_spawn_location.<span class="hljs-title function_ invoke__">set_progress_ratio</span>(rng.<span class="hljs-title function_ invoke__">random_range</span>(<span class="hljs-number">0.0</span>..=<span class="hljs-number">1.0</span>));

    <span class="hljs-comment">// 将Mob实例放到随机点上</span>
    mob.<span class="hljs-title function_ invoke__">set_position</span>(mob_spawn_location.<span class="hljs-title function_ invoke__">get_position</span>());

    <span class="hljs-comment">// 根据随机点的方向顺时针正交出向游戏屏幕内的方向，并使这个方向在正负PI/4范围随机化</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">direction</span> = mob_spawn_location.<span class="hljs-title function_ invoke__">get_rotation</span>() + PI <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span> / <span class="hljs-number">2.0</span>;
    direction += rng.<span class="hljs-title function_ invoke__">random_range</span>((-PI / <span class="hljs-number">4.0</span>)..=(PI / <span class="hljs-number">4.0</span>)) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span>;

    <span class="hljs-comment">// 将随机化的方向放置入mob实例</span>
    mob.<span class="hljs-title function_ invoke__">set_rotation</span>(direction);

    <span class="hljs-comment">// 随机一个速度，使速度和mob的朝向一致，并将这个速度设置为mob的线性速度</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">velocity</span> = Vector2::<span class="hljs-title function_ invoke__">new</span>(rng.<span class="hljs-title function_ invoke__">random_range</span>(<span class="hljs-number">150.0</span>..=<span class="hljs-number">250.0</span>), <span class="hljs-number">0.0</span>);
    mob.<span class="hljs-title function_ invoke__">set_linear_velocity</span>(velocity.<span class="hljs-title function_ invoke__">rotated</span>(direction));

    <span class="hljs-comment">// 向场景加入这个mob实例</span>
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base_mut</span>().<span class="hljs-title function_ invoke__">add_child</span>(&amp;mob);
}

</code></pre>
<p><em>原文中的<code>randf()</code>、<code>randf_range()</code>辅助函数其实在<code>godot-rust 4.5</code>已经有了，你也可以使用这两个函数来辅助你生成随机数</em></p>
<p>在<code>ready()</code>中将<code>Timer</code>的<strong>信号</strong>连接到上述<code>handle</code>:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">ready</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    ......
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>()
        .get_node_as::&lt;Timer&gt;(<span class="hljs-string">"MobTimer"</span>)
        .<span class="hljs-title function_ invoke__">signals</span>()
        .<span class="hljs-title function_ invoke__">timeout</span>()
        .<span class="hljs-title function_ invoke__">connect_other</span>(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">Self</span>::on_mob_timer_timeout);

    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>()
        .get_node_as::&lt;Timer&gt;(<span class="hljs-string">"ScoreTimer"</span>)
        .<span class="hljs-title function_ invoke__">signals</span>()
        .<span class="hljs-title function_ invoke__">timeout</span>()
        .<span class="hljs-title function_ invoke__">connect_other</span>(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">Self</span>::on_score_timer_timeout);

    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">base</span>()
        .get_node_as::&lt;Timer&gt;(<span class="hljs-string">"StartTimer"</span>)
        .<span class="hljs-title function_ invoke__">signals</span>()
        .<span class="hljs-title function_ invoke__">timeout</span>()
        .<span class="hljs-title function_ invoke__">connect_other</span>(<span class="hljs-keyword">self</span>, <span class="hljs-keyword">Self</span>::on_start_timer_timeout);
}
</code></pre>
<h3 data-id="heading-5">测试主场景</h3>
<p>在<code>ready()</code>最后添加代码：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">ready</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">new_game</span>();
}
</code></pre>
<p>将<code>main.tscn</code>设置为<strong>主场景</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bda9738abaa04002be250e98553d6f24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364413&amp;x-signature=KAr3jpO2PGQPIpNYyp15AYSRezw%3D" alt="main为主场景" loading="lazy"/></p>
<p>如果没有这个选项，说明<code>main</code>已经为主场景。</p>
<p>回忆一下，我们在<code>StartTimer</code>计时结束，也就是<code>2s</code>后才启动的<code>MobTimer</code>，以<code>0.5s</code>速率生成一个<code>Mob</code>，因此测试刚开始时需要耐心稍等第一个的敌人才会出现。</p>
<p>当确认场景没有问题，将<code>self.new_game()</code>从<code>ready()</code>中<strong>删除</strong>，因为我们要在其他地方开始新游戏。</p>
<h2 data-id="heading-6">参考</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Fgetting_started%2Ffirst_2d_game%2Findex.html" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/getting_started/first_2d_game/index.html" ref="nofollow noopener noreferrer">你的第一个 2D 游戏 — Godot Engine (4.5) 简体中文文档</a></li>
<li><a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目 - 掘金</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rs%2Fgodot%2F0.4.5%2Fgodot%2F" target="_blank" title="https://docs.rs/godot/0.4.5/godot/" ref="nofollow noopener noreferrer">godot - Rust</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodot-rust%2Fdemo-projects%2Ftree%2Fmaster%2Fdodge-the-creeps" target="_blank" title="https://github.com/godot-rust/demo-projects/tree/master/dodge-the-creeps" ref="nofollow noopener noreferrer">demo-projects/dodge-the-creeps at master · godot-rust/demo-projects · GitHub</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot + JPackage：构建独立安装包]]></title>    <link>https://juejin.cn/post/7600284420633952297</link>    <guid>https://juejin.cn/post/7600284420633952297</guid>    <pubDate>2026-01-28T23:58:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600284420633952297" data-draft-id="7600296037542428672" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Spring Boot + JPackage：构建独立安装包"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-28T23:58:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Spring Boot + JPackage：构建独立安装包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T23:58:11.000Z" title="Wed Jan 28 2026 23:58:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    46
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>从 JDK 14 开始，Java 官方引入了 <strong>JPackage</strong> 工具（在 JDK 16 正式成为标准功能），它能够将 Java 应用打包成特定平台的原生安装包，<strong>自带定制化的 JRE 运行环境</strong>。这意味着用户无需提前安装 Java 环境，双击安装包即可完成应用部署，极大地简化了交付流程。</p>
<p>本文将介绍如何使用 JPackage 工具将 Spring Boot 项目打包成 Windows、macOS 或 Linux 平台的原生安装包。</p>
<h2 data-id="heading-1">一、JPackage 简介</h2>
<h4 data-id="heading-2">1.1 什么是 JPackage</h4>
<p>JPackage 是 JDK 自带的打包工具，位于 <code>$JAVA_HOME/bin</code> 目录下。它的核心功能是：</p>
<p><strong>生成平台原生安装包</strong>：Windows 的 <code>.exe</code>/<code>.msi</code>、macOS 的 <code>.dmg</code>/<code>.pkg</code>、Linux 的 <code>.deb</code>/<code>.rpm</code></p>
<p><strong>自定义 JRE</strong>：使用 <code>jlink</code> 工具裁剪 JDK，仅打包应用所需的模块，大幅减小安装包体积</p>
<p><strong>简化部署</strong>：用户无需预装 Java 环境，安装包自带运行时</p>
<h4 data-id="heading-3">1.2 JPackage 的优势</h4>

























<table><thead><tr><th>传统部署方式</th><th>JPackage 方式</th></tr></thead><tbody><tr><td>需要预装 JRE/JDK</td><td>自带 JRE，无需额外安装</td></tr><tr><td>环境版本可能不匹配</td><td>绑定特定 JRE 版本，环境一致</td></tr><tr><td>手动编写启动脚本</td><td>自动生成启动器</td></tr><tr><td>跨平台需要多套脚本</td><td>一键生成各平台安装包</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">二、环境准备</h2>
<h4 data-id="heading-5">2.1 JDK 版本要求</h4>
<p><strong>推荐使用 JDK 17 或更高版本</strong>（JPackage 在 JDK 16 才成为标准功能，JDK 17 是 LTS 版本）</p>
<p>确认 JPackage 可用：</p>
<pre><code class="hljs language-bash" lang="bash">jpackage --version
</code></pre>
<h4 data-id="heading-6">2.2 平台特定工具</h4>
<p>根据目标操作系统，需要安装对应的打包工具：</p>
<h5 data-id="heading-7">Windows</h5>
<p><strong>WiX Toolset 3.11+</strong>（用于生成 <code>.msi</code> 安装包）<br/>
下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwixtoolset.org%2F" target="_blank" title="https://wixtoolset.org/" ref="nofollow noopener noreferrer">wixtoolset.org/</a><br/>
安装后将 <code>bin</code> 目录添加到系统环境变量 <code>PATH</code></p>
<h5 data-id="heading-8">macOS</h5>
<p>Xcode 命令行工具（用于生成 <code>.dmg</code>/<code>.pkg</code>）</p>
<pre><code class="hljs language-bash" lang="bash">xcode-select --install
</code></pre>
<h5 data-id="heading-9">Linux</h5>
<p><strong>Debian/Ubuntu</strong>：安装 <code>fakeroot</code></p>
<pre><code class="hljs language-bash" lang="bash">sudo apt-get install fakeroot
</code></pre>
<p><strong>RedHat/CentOS</strong>：安装 <code>rpm-build</code></p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install rpm-build
</code></pre>
<h2 data-id="heading-10">三、Spring Boot 项目准备</h2>
<h4 data-id="heading-11">3.1 示例项目结构</h4>
<p>假设我们有一个标准的 Spring Boot 项目：</p>
<pre><code class="hljs language-css" lang="css">my-springboot-app/
├── <span class="hljs-attribute">src</span>/
│   └── <span class="hljs-selector-tag">main</span>/
│       ├── java/
│       └── resources/
├── pom<span class="hljs-selector-class">.xml</span>
└── target/
    └── my-app-<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span><span class="hljs-selector-class">.jar</span>
</code></pre>
<h4 data-id="heading-12">3.2 构建可执行 JAR</h4>
<p>首先使用 Maven 或 Gradle 构建项目：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Maven</span>
mvn clean package

<span class="hljs-comment"># Gradle</span>
gradle clean build
</code></pre>
<p>确保生成的 JAR 包是可执行的（Spring Boot 默认打包方式）。</p>
<h2 data-id="heading-13">四、使用 JPackage 打包</h2>
<h4 data-id="heading-14">4.1 基础打包命令</h4>
<p>以下是一个基础的 JPackage 命令示例（以 Windows 为例）：</p>
<pre><code class="hljs language-bash" lang="bash">jpackage \
  --input target \
  --name MySpringBootApp \
  --main-jar my-app-1.0.0.jar \
  --main-class org.springframework.boot.loader.JarLauncher \
  --<span class="hljs-built_in">type</span> msi \
  --app-version 1.0.0 \
  --vendor <span class="hljs-string">"我的公司"</span> \
  --description <span class="hljs-string">"基于 Spring Boot 的企业级应用"</span> \
  --icon src/main/resources/app-icon.ico \
  --win-dir-chooser \
  --win-menu \
  --win-shortcut
</code></pre>
<h5 data-id="heading-15">参数说明</h5>

















































<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>--input</code></td><td>输入目录，包含 JAR 包和依赖</td></tr><tr><td><code>--name</code></td><td>应用名称</td></tr><tr><td><code>--main-jar</code></td><td>主 JAR 包文件名</td></tr><tr><td><code>--main-class</code></td><td>主类（Spring Boot 使用 <code>JarLauncher</code>）</td></tr><tr><td><code>--type</code></td><td>安装包类型（<code>msi</code>/<code>exe</code>/<code>dmg</code>/<code>pkg</code>/<code>deb</code>/<code>rpm</code>）</td></tr><tr><td><code>--app-version</code></td><td>应用版本号</td></tr><tr><td><code>--icon</code></td><td>应用图标（Windows 用 <code>.ico</code>，macOS 用 <code>.icns</code>）</td></tr><tr><td><code>--win-dir-chooser</code></td><td>允许用户选择安装目录</td></tr><tr><td><code>--win-menu</code></td><td>创建开始菜单项</td></tr><tr><td><code>--win-shortcut</code></td><td>创建桌面快捷方式</td></tr></tbody></table>
<h4 data-id="heading-16">4.2 自定义 JRE（使用 jlink）</h4>
<p>为了减小安装包体积，可以使用 <code>jlink</code> 裁剪 JRE，仅包含必要的模块。</p>
<h5 data-id="heading-17">步骤 1：查找应用依赖的模块</h5>
<pre><code class="hljs language-bash" lang="bash">jdeps --list-deps target/my-app-1.0.0.jar
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-csharp" lang="csharp">java.<span class="hljs-keyword">base</span>
java.logging
java.sql
java.naming
java.desktop
...
</code></pre>
<h5 data-id="heading-18">步骤 2：使用 jlink 创建自定义 JRE</h5>
<pre><code class="hljs language-bash" lang="bash">jlink \
  --add-modules java.base,java.logging,java.sql,java.naming,java.desktop,java.xml,java.management \
  --output custom-jre \
  --strip-debug \
  --no-header-files \
  --no-man-pages \
  --compress=2
</code></pre>
<h5 data-id="heading-19">步骤 3：使用自定义 JRE 打包</h5>
<pre><code class="hljs language-bash" lang="bash">jpackage \
  --input target \
  --name MySpringBootApp \
  --main-jar my-app-1.0.0.jar \
  --main-class org.springframework.boot.loader.JarLauncher \
  --<span class="hljs-built_in">type</span> msi \
  --runtime-image custom-jre \
  --app-version 1.0.0 \
  --vendor <span class="hljs-string">"我的公司"</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>：Spring Boot 应用通常依赖较多模块，建议先不裁剪 JRE，确保功能正常后再优化。</p>
</blockquote>
<hr/>
<h2 data-id="heading-20">五、不同平台的打包示例</h2>
<h4 data-id="heading-21">5.1 Windows 平台（MSI）</h4>
<pre><code class="hljs language-bash" lang="bash">jpackage \
  --input target \
  --name MyApp \
  --main-jar my-app-1.0.0.jar \
  --main-class org.springframework.boot.loader.JarLauncher \
  --<span class="hljs-built_in">type</span> msi \
  --app-version 1.0.0 \
  --icon src/main/resources/app.ico \
  --win-dir-chooser \
  --win-menu \
  --win-shortcut \
  --win-menu-group <span class="hljs-string">"我的应用"</span>
</code></pre>
<h4 data-id="heading-22">5.2 macOS 平台（DMG）</h4>
<pre><code class="hljs language-bash" lang="bash">jpackage \
  --input target \
  --name MyApp \
  --main-jar my-app-1.0.0.jar \
  --main-class org.springframework.boot.loader.JarLauncher \
  --<span class="hljs-built_in">type</span> dmg \
  --app-version 1.0.0 \
  --icon src/main/resources/app.icns \
  --mac-package-name <span class="hljs-string">"com.mycompany.myapp"</span> \
  --mac-package-identifier <span class="hljs-string">"com.mycompany.myapp"</span>
</code></pre>
<h4 data-id="heading-23">5.3 Linux 平台（DEB）</h4>
<pre><code class="hljs language-bash" lang="bash">jpackage \
  --input target \
  --name myapp \
  --main-jar my-app-1.0.0.jar \
  --main-class org.springframework.boot.loader.JarLauncher \
  --<span class="hljs-built_in">type</span> deb \
  --app-version 1.0.0 \
  --icon src/main/resources/app.png \
  --linux-shortcut \
  --linux-menu-group <span class="hljs-string">"Development"</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">六、集成到 Maven 构建流程</h2>
<p>为了自动化打包流程，可以将 JPackage 命令集成到 Maven 的 <code>pom.xml</code> 中。</p>
<h4 data-id="heading-25">6.1 使用 exec-maven-plugin</h4>
<p>在 <code>pom.xml</code> 中添加以下插件配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Boot Maven 插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- JPackage 打包插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>exec-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>jpackage<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>jpackage<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">arguments</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--input<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>target<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--name<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>MySpringBootApp<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--main-jar<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>${project.build.finalName}.jar<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--main-class<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>org.springframework.boot.loader.JarLauncher<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--type<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>msi<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--app-version<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--vendor<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>我的公司<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--win-dir-chooser<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--win-menu<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>--win-shortcut<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">arguments</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h4 data-id="heading-26">6.2 执行构建</h4>
<pre><code class="hljs language-bash" lang="bash">mvn clean package
</code></pre>
<p>构建完成后，安装包将生成在项目根目录下。</p>
<h2 data-id="heading-27">七、总结</h2>
<p>JPackage 工具为 Java 应用的分发提供了强大的支持，从简单的命令行操作到集成到自动化构建流程，JPackage 都能很好地满足需求。</p>
<p>在实际项目中，建议根据应用特点选择合适的打包策略，平衡安装包体积、部署便利性和运行性能，为用户提供最佳的使用体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java SPI机制：从原理到实战]]></title>    <link>https://juejin.cn/post/7600316828485009423</link>    <guid>https://juejin.cn/post/7600316828485009423</guid>    <pubDate>2026-01-29T01:15:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600316828485009423" data-draft-id="7600265780349321256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java SPI机制：从原理到实战"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-29T01:15:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java SPI机制：从原理到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T01:15:53.000Z" title="Thu Jan 29 2026 01:15:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java SPI机制：从原理到实战</h2>
<h2 data-id="heading-1">一、什么是SPI机制</h2>
<p>SPI（Service Provider Interface），服务提供者接口，是Java提供的一种服务发现机制。它允许第三方服务提供商为核心库或接口提供实现，而不需要修改核心代码。</p>
<h3 data-id="heading-2">1.1 为什么需要SPI？</h3>
<p>在实际开发中，我们经常遇到这样的场景：定义了一个接口，但具体实现由不同厂商或不同场景提供。例如：</p>
<ul>
<li><strong>JDBC驱动</strong>：不同数据库（MySQL、Oracle、PostgreSQL）提供不同的驱动实现</li>
<li><strong>日志框架</strong>：SLF4J定义接口，Logback、Log4j2提供实现</li>
</ul>
<p>传统做法是通过硬编码或配置文件指定实现类，这样存在以下问题：</p>
<ul>
<li>代码耦合度高，切换实现需要修改代码</li>
<li>无法动态扩展</li>
<li>不符合"开闭原则"</li>
</ul>
<p>SPI机制通过约定配置文件的方式，实现了服务的动态发现和加载。</p>
<h3 data-id="heading-3">1.2 SPI vs API</h3>






























<table><thead><tr><th>特性</th><th>API（Application Programming Interface）</th><th>SPI（Service Provider Interface）</th></tr></thead><tbody><tr><td>调用方向</td><td>应用 → 框架/库</td><td>框架/库 → 服务提供者</td></tr><tr><td>定义者</td><td>框架/库定义</td><td>框架/库定义</td></tr><tr><td>实现者</td><td>应用实现</td><td>第三方提供者实现</td></tr><tr><td>使用场景</td><td>应用使用框架功能</td><td>框架调用扩展实现</td></tr></tbody></table>
<p>简单理解：<strong>API是给应用用的，SPI是给框架扩展用的。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/000af4c89a2549ab8b83413a24d2aed9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254152&amp;x-signature=nqnUqV981Eyrc%2FDxAqLEm93fqdI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">二、Java SPI核心原理</h2>
<h3 data-id="heading-5">2.1 核心类</h3>
<p>Java SPI主要依赖<code>java.util.ServiceLoader</code>类，位于JDK核心库中。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceLoader</span>&lt;<span class="hljs-title class_">S</span>&gt; <span class="hljs-title class_">implements</span> <span class="hljs-title class_">Iterable</span>&lt;<span class="hljs-title class_">S</span>&gt; {
    <span class="hljs-comment">// 服务接口的Class对象</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Class</span>&lt;<span class="hljs-type">S</span>&gt; service;

    <span class="hljs-comment">// 类加载器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ClassLoader</span> loader;

    <span class="hljs-comment">// 已加载的服务提供者缓存</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">LinkedHashMap</span>&lt;<span class="hljs-type">String</span>,<span class="hljs-type">S</span>&gt; providers <span class="hljs-operator">=</span> new <span class="hljs-type">LinkedHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 懒加载查找迭代器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">LazyIterator</span> lookupIterator;

    <span class="hljs-comment">// 通过类加载器和接口类型加载服务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">S</span><span class="hljs-operator">&gt;</span> <span class="hljs-type">ServiceLoader</span>&lt;<span class="hljs-type">S</span>&gt; load(<span class="hljs-type">Class</span>&lt;<span class="hljs-type">S</span>&gt; service) {
        <span class="hljs-type">ClassLoader</span> cl <span class="hljs-operator">=</span> <span class="hljs-type">Thread</span>.currentThread().getContextClassLoader();
        <span class="hljs-keyword">return</span> <span class="hljs-type">ServiceLoader</span>.load(service, cl);
    }

    <span class="hljs-comment">// 通过指定类加载器加载服务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">S</span><span class="hljs-operator">&gt;</span> <span class="hljs-type">ServiceLoader</span>&lt;<span class="hljs-type">S</span>&gt; load(<span class="hljs-type">Class</span>&lt;<span class="hljs-type">S</span>&gt; service, <span class="hljs-type">ClassLoader</span> loader) {
        <span class="hljs-keyword">return</span> new <span class="hljs-type">ServiceLoader</span>&lt;&gt;(service, loader);
    }
}
</code></pre>
<h3 data-id="heading-6">2.2 约定配置文件</h3>
<p>SPI机制通过约定配置文件来发现服务实现。配置文件位置必须为：</p>
<pre><code class="hljs language-bash" lang="bash">META-INF/services/
└── com.example.spi.SomeService  <span class="hljs-comment"># 文件名为接口的全限定名</span>
</code></pre>
<p>文件内容为实现类的全限定名，每行一个：</p>
<pre><code class="hljs language-rust" lang="rust">com.example.spi.<span class="hljs-keyword">impl</span>.SomeServiceImpl
com.example.spi.<span class="hljs-keyword">impl</span>.AnotherServiceImpl
</code></pre>
<h3 data-id="heading-7">2.3 服务加载流程</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c29e3110cda049fa93ef8d6f73b14d3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254152&amp;x-signature=aq7j06Y1xtYG00%2F8HbS4V8sKI8A%3D" alt="" loading="lazy"/></p>
<p>服务加载流程如下：</p>
<ol>
<li><strong>查找配置文件</strong>：ServiceLoader在classpath下查找<code>META-INF/services/接口全限定名</code>文件</li>
<li><strong>解析配置文件</strong>：读取文件内容，获取所有实现类的全限定名</li>
<li><strong>类加载</strong>：使用类加载器加载实现类</li>
<li><strong>实例化</strong>：通过反射创建实现类实例</li>
<li><strong>类型转换</strong>：将实例转换为接口类型</li>
<li><strong>缓存结果</strong>：将实例缓存到providers Map中</li>
</ol>
<h2 data-id="heading-8">三、Java SPI使用示例</h2>
<p>让我们通过一个完整的示例来演示Java SPI的使用。</p>
<h3 data-id="heading-9">3.1 定义接口</h3>
<p>首先定义一个数据库操作接口：</p>
<pre><code class="hljs language-arduino" lang="arduino">package com.example.spi;

<span class="hljs-comment">/**
 * 数据库操作接口
 */</span>
<span class="hljs-keyword">public</span> interface DatabaseOperation {

    <span class="hljs-comment">/**
     * 执行查询
     * @param sql SQL语句
     * @return 查询结果
     */</span>
    <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">String</span> sql)</span></span>;

    <span class="hljs-comment">/**
     * 获取数据库类型
     * @return 数据库类型名称
     */</span>
    <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">getDatabaseType</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * 获取版本信息
     * @return 版本号
     */</span>
    <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">getVersion</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<h3 data-id="heading-10">3.2 实现MySQL操作</h3>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">spi</span>.<span class="hljs-property">impl</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">spi</span>.<span class="hljs-property">DatabaseOperation</span>;

<span class="hljs-comment">/**
 * MySQL数据库操作实现
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySQLDatabaseOperation</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseOperation</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">query</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> sql</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[MySQL] 执行SQL: "</span> + sql);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"MySQL查询结果集"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDatabaseType</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"MySQL"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getVersion</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"8.0.32"</span>;
    }
}
</code></pre>
<h3 data-id="heading-11">3.3 实现Oracle操作</h3>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">spi</span>.<span class="hljs-property">impl</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">spi</span>.<span class="hljs-property">DatabaseOperation</span>;

<span class="hljs-comment">/**
 * Oracle数据库操作实现
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleDatabaseOperation</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DatabaseOperation</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">query</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> sql</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[Oracle] 执行SQL: "</span> + sql);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Oracle查询结果集"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDatabaseType</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Oracle"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getVersion</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"19c"</span>;
    }
}
</code></pre>
<h3 data-id="heading-12">3.4 配置SPI文件</h3>
<p>在<code>src/main/resources/META-INF/services/</code>目录下创建配置文件：</p>
<p><strong>文件名</strong>：<code>com.example.spi.DatabaseOperation</code></p>
<p><strong>文件内容</strong>：</p>
<pre><code class="hljs language-rust" lang="rust">com.example.spi.<span class="hljs-keyword">impl</span>.MySQLDatabaseOperation
com.example.spi.<span class="hljs-keyword">impl</span>.OracleDatabaseOperation
</code></pre>
<h3 data-id="heading-13">3.5 使用ServiceLoader加载服务</h3>
<pre><code class="hljs language-csharp" lang="csharp">package com.example.spi;

import java.util.ServiceLoader;

<span class="hljs-comment">/**
 * SPI服务加载器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SPIDemo</span> {

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"=== Java SPI 机制演示 ===\n"</span>);

        <span class="hljs-comment">// 加载所有DatabaseOperation实现</span>
        ServiceLoader&lt;DatabaseOperation&gt; loader = ServiceLoader.load(DatabaseOperation.<span class="hljs-keyword">class</span>);

        <span class="hljs-comment">// 遍历所有实现</span>
        <span class="hljs-keyword">for</span> (DatabaseOperation operation : loader) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"发现数据库实现: "</span> + operation.getClass().getSimpleName());
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"数据库类型: "</span> + operation.getDatabaseType());
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"版本信息: "</span> + operation.getVersion());
            String result = operation.query(<span class="hljs-string">"SELECT * FROM users"</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"查询结果: "</span> + result);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"----------------------"</span>);
        }

        <span class="hljs-comment">// 再次遍历，验证缓存机制</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"\n=== 第二次遍历（从缓存读取）==="</span>);
        <span class="hljs-keyword">for</span> (DatabaseOperation operation : loader) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"缓存中的实现: "</span> + operation.getClass().getSimpleName());
        }
    }
}
</code></pre>
<h2 data-id="heading-14">四、SPI在JDBC驱动中的应用</h2>
<p>JDBC是Java SPI机制的典型应用场景。让我们深入分析JDBC如何通过SPI加载驱动。</p>
<h3 data-id="heading-15">4.1 传统驱动加载方式</h3>
<p>在JDBC 4.0之前，需要显式加载驱动：</p>
<pre><code class="hljs language-ini" lang="ini">// 显式加载驱动
Class.forName("com.mysql.cj.jdbc.Driver")<span class="hljs-comment">;</span>
Connection <span class="hljs-attr">conn</span> = DriverManager.getConnection(url, user, password)<span class="hljs-comment">;</span>
</code></pre>
<p>这种方式存在以下问题：</p>
<ul>
<li>需要硬编码驱动类名</li>
<li>代码与具体驱动耦合</li>
<li>切换数据库需要修改代码</li>
</ul>
<h3 data-id="heading-16">4.2 SPI自动加载机制</h3>
<p>从JDBC 4.0开始，通过SPI机制自动发现并加载驱动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac4a68a5d22e4dccba12d2fff32792a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254152&amp;x-signature=ntb3SvjBTPDto32qZJ7Ut4TuqZU%3D" alt="" loading="lazy"/></p>
<p><strong>驱动注册流程</strong>：</p>
<ol>
<li>MySQL驱动jar包中的SPI配置文件</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">文件路径：META-INF/services/java.sql.Driver
com.mysql.cj.jdbc.Driver

 
</code></pre>
<ol>
<li>当DriverManager类被加载时，会触发静态初始化块：</li>
</ol>
<pre><code class="hljs language-scss" lang="scss"> public class DriverManager {
 static {
        <span class="hljs-built_in">loadInitialDrivers</span>();
        <span class="hljs-built_in">println</span>("JDBC DriverManager initialized");
    }

 private static void <span class="hljs-built_in">loadInitialDrivers</span>() {
        ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader<span class="hljs-selector-class">.load</span>(Driver.class);
        Iterator&lt;Driver&gt; driversIterator = loadedDrivers<span class="hljs-selector-class">.iterator</span>();

 try {
 <span class="hljs-built_in">while</span>(driversIterator.hasNext()) {
                driversIterator<span class="hljs-selector-class">.next</span>();
            }
        } <span class="hljs-built_in">catch</span>(Throwable t) {
 <span class="hljs-comment">// 处理异常</span>
        }
    }
}

 
</code></pre>
<ol>
<li>MySQL驱动实现类的静态初始化块会注册驱动：</li>
</ol>

<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.mysql.cj.jdbc;

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Driver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">NonRegisteringDriver</span> <span class="hljs-title">implements</span> <span class="hljs-title">java</span>.<span class="hljs-title">sql</span>.<span class="hljs-title">Driver</span> </span>{
 static {
 <span class="hljs-keyword">try</span> {
            java.sql.<span class="hljs-type">DriverManager</span>.registerDriver(<span class="hljs-keyword">new</span> <span class="hljs-type">Driver</span>());
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">SQLException</span> <span class="hljs-type">E</span>) {
 <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">RuntimeException</span>(<span class="hljs-string">"Can't register driver!"</span>);
        }
    }

}
</code></pre>
<h3 data-id="heading-17">4.3 使用示例</h3>
<p>使用SPI机制后，获取数据库连接变得非常简单：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.jdbc;

<span class="hljs-keyword">import</span> java.sql.Connection;
<span class="hljs-keyword">import</span> java.sql.DriverManager;
<span class="hljs-keyword">import</span> java.sql.PreparedStatement;
<span class="hljs-keyword">import</span> java.sql.ResultSet;

<span class="hljs-comment">/**
 * JDBC SPI使用示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcSPIDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 无需显式加载驱动，SPI自动发现</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/test"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">"root"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"password"</span>;

        <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(url, user, password)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT id, username, email FROM users WHERE status = ?"</span>;

            <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">pstmt</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql)) {
                pstmt.setInt(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

                <span class="hljs-keyword">try</span> (<span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> pstmt.executeQuery()) {
                    <span class="hljs-keyword">while</span> (rs.next()) {
                        System.out.println(<span class="hljs-string">"ID: "</span> + rs.getInt(<span class="hljs-string">"id"</span>));
                        System.out.println(<span class="hljs-string">"用户名: "</span> + rs.getString(<span class="hljs-string">"username"</span>));
                        System.out.println(<span class="hljs-string">"邮箱: "</span> + rs.getString(<span class="hljs-string">"email"</span>));
                    }
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-18">4.4 实际生产案例</h3>
<p><strong>场景</strong>：支持多数据源动态切换</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.jdbc;

<span class="hljs-keyword">import</span> javax.sql.DataSource;
<span class="hljs-keyword">import</span> java.sql.Connection;
<span class="hljs-keyword">import</span> java.sql.SQLException;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.ServiceLoader;

<span class="hljs-comment">/**
 * 多数据源管理器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiDataSourceManager</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, DataSource&gt; dataSourceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MultiDataSourceManager</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 通过SPI加载所有DataSource实现</span>
        ServiceLoader&lt;DataSourceProvider&gt; providers =
            ServiceLoader.load(DataSourceProvider.class);

        <span class="hljs-keyword">for</span> (DataSourceProvider provider : providers) {
            <span class="hljs-type">DataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> provider.createDataSource();
            dataSourceMap.put(provider.getDataSourceName(), ds);
            System.out.println(<span class="hljs-string">"注册数据源: "</span> + provider.getDataSourceName());
        }
    }

    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String dataSourceName)</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-type">DataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> dataSourceMap.get(dataSourceName);
        <span class="hljs-keyword">if</span> (ds == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"未找到数据源: "</span> + dataSourceName);
        }
        <span class="hljs-keyword">return</span> ds.getConnection();
    }

    <span class="hljs-comment">/**
     * 动态切换数据源执行查询
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeQuery</span><span class="hljs-params">(String dataSourceName, String sql)</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> getConnection(dataSourceName)) {
            <span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();
                 <span class="hljs-type">var</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stmt.executeQuery(sql)) {

                System.out.println(<span class="hljs-string">"["</span> + dataSourceName + <span class="hljs-string">"] 查询结果:"</span>);
                <span class="hljs-keyword">while</span> (rs.next()) {
                    <span class="hljs-comment">// 处理结果集</span>
                }
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-19">五、Dubbo对SPI的改进</h2>
<p>虽然Java SPI提供了服务发现机制，但存在一些不足：</p>
<ol>
<li><strong>无法按需加载</strong>：一次性加载所有实现，浪费资源</li>
<li><strong>缺少配置化</strong>：无法通过配置选择具体实现</li>
<li><strong>缺少依赖注入</strong>：实现类之间无法相互依赖</li>
<li><strong>缺少扩展点隔离</strong>：不同扩展点的实现可能冲突</li>
</ol>
<p>Dubbo实现了自己的SPI机制，解决了这些问题。</p>
<h3 data-id="heading-20">5.1 Dubbo SPI改进</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de6a6c1833794f19bd8c7157c02b2367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254152&amp;x-signature=vwyUBEHQrdpnT8u%2FpFcen6coxRA%3D" alt="" loading="lazy"/></p>
<p><strong>主要改进</strong>：</p>
<ol>
<li><strong>支持按需加载</strong>：只加载需要的实现</li>
<li><strong>支持依赖注入</strong>：实现类可以注入其他扩展点</li>
<li><strong>支持自适应扩展</strong>：根据运行时参数自动选择实现</li>
<li><strong>支持AOP</strong>：可以为扩展点添加包装类</li>
</ol>
<h3 data-id="heading-21">5.2 Dubbo SPI示例</h3>
<pre><code class="hljs language-ini" lang="ini">package com.example.dubbo.spi<span class="hljs-comment">;</span>

import org.apache.dubbo.common.extension.ExtensionLoader<span class="hljs-comment">;</span>

/**
 * Dubbo SPI使用示例
 */
public class DubboSPIDemo {

    public static void main(String<span class="hljs-section">[]</span> args) {
        // 获取扩展加载器
        ExtensionLoader&lt;Robot&gt; <span class="hljs-attr">loader</span> = ExtensionLoader.getExtensionLoader(Robot.class)<span class="hljs-comment">;</span>

        // 按需获取指定实现
        Robot <span class="hljs-attr">optimusPrime</span> = loader.getExtension(<span class="hljs-string">"optimusPrime"</span>)<span class="hljs-comment">;</span>
        optimusPrime.sayHello()<span class="hljs-comment">;</span>

        Robot <span class="hljs-attr">bumblebee</span> = loader.getExtension(<span class="hljs-string">"bumblebee"</span>)<span class="hljs-comment">;</span>
        bumblebee.sayHello()<span class="hljs-comment">;</span>

        // 获取自适应扩展（根据URL参数自动选择）
        Robot <span class="hljs-attr">adaptiveRobot</span> = loader.getAdaptiveExtension()<span class="hljs-comment">;</span>
        adaptiveRobot.sayHello()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h2 data-id="heading-22">六、实际生产案例：日志框架SPI</h2>
<h3 data-id="heading-23">6.1 SLF4J + Logback实现</h3>
<p>SLF4J定义日志门面接口，Logback提供实现。</p>
<p><strong>SLF4J接口</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">package org.slf4j;

<span class="hljs-keyword">public</span> interface Logger {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">debug</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">info</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">warn</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">error</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span></span>;
}
</code></pre>
<p><strong>Logback实现</strong>：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">META-INF/services/org.slf4j.spi.SLF4JServiceProvider</span>
ch.qos.logback.classic.spi.LogbackServiceProvider
</code></pre>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(LoggingService.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Order order)</span> {
        logger.info(<span class="hljs-string">"开始处理订单: {}"</span>, order.getId());

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 业务逻辑</span>
            logger.debug(<span class="hljs-string">"订单金额: {}"</span>, order.getAmount());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"处理订单失败"</span>, e);
            <span class="hljs-keyword">throw</span> e;
        }

        logger.info(<span class="hljs-string">"订单处理完成"</span>);
    }
}
</code></pre>
<h3 data-id="heading-24">6.2 实际生产案例：支付系统</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/419187ab020d4594b1d153357d3c1e39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254152&amp;x-signature=DekGrbnEliD41lrHxuIZ%2Fhu%2FNWE%3D" alt="" loading="lazy"/></p>
<p><strong>场景</strong>：支持多种支付方式（支付宝、微信、银联）</p>
<p><strong>支付接口定义</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.payment.spi;

<span class="hljs-comment">/**
 * 支付服务接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentService</span> {

    <span class="hljs-comment">/**
     * 创建支付订单
     * <span class="hljs-doctag">@param</span> request 支付请求
     * <span class="hljs-doctag">@return</span> 支付结果
     */</span>
    PaymentResult <span class="hljs-title function_">createPayment</span><span class="hljs-params">(PaymentRequest request)</span>;

    <span class="hljs-comment">/**
     * 查询支付状态
     * <span class="hljs-doctag">@param</span> paymentId 支付订单号
     * <span class="hljs-doctag">@return</span> 支付状态
     */</span>
    PaymentStatus <span class="hljs-title function_">queryStatus</span><span class="hljs-params">(String paymentId)</span>;

    <span class="hljs-comment">/**
     * 申请退款
     * <span class="hljs-doctag">@param</span> refundRequest 退款请求
     * <span class="hljs-doctag">@return</span> 退款结果
     */</span>
    RefundResult <span class="hljs-title function_">refund</span><span class="hljs-params">(RefundRequest refundRequest)</span>;

    <span class="hljs-comment">/**
     * 获取支付方式
     * <span class="hljs-doctag">@return</span> 支付方式名称
     */</span>
    String <span class="hljs-title function_">getPaymentType</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>支付宝实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">payment</span>.<span class="hljs-property">impl</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">payment</span>.<span class="hljs-property">spi</span>.*;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alipay</span>.<span class="hljs-property">api</span>.<span class="hljs-property">AlipayClient</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alipay</span>.<span class="hljs-property">api</span>.<span class="hljs-property">DefaultAlipayClient</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alipay</span>.<span class="hljs-property">api</span>.<span class="hljs-property">request</span>.<span class="hljs-property">AlipayTradeCreateRequest</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alipay</span>.<span class="hljs-property">api</span>.<span class="hljs-property">response</span>.<span class="hljs-property">AlipayTradeCreateResponse</span>;

<span class="hljs-comment">/**
 * 支付宝支付实现
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayPaymentService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">AlipayClient</span> alipayClient;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">AlipayPaymentService</span>() {
        <span class="hljs-comment">// 初始化支付宝客户端</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">alipayClient</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAlipayClient</span>(
            <span class="hljs-string">"https://openapi.alipay.com/gateway.do"</span>,
            <span class="hljs-string">"APP_ID"</span>, <span class="hljs-string">"PRIVATE_KEY"</span>, <span class="hljs-string">"json"</span>, <span class="hljs-string">"UTF-8"</span>, <span class="hljs-string">"ALIPAY_PUBLIC_KEY"</span>
        );
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentResult</span> <span class="hljs-title function_">createPayment</span>(<span class="hljs-params">PaymentRequest request</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">AlipayTradeCreateRequest</span> alipayRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayTradeCreateRequest</span>();
            alipayRequest.<span class="hljs-title function_">setBizContent</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(
                <span class="hljs-string">"{"</span>out_trade_no<span class="hljs-string">":"</span>%s<span class="hljs-string">","</span>total_amount<span class="hljs-string">":"</span>%s<span class="hljs-string">","</span>subject<span class="hljs-string">":"</span>%s<span class="hljs-string">"}"</span>,
                request.<span class="hljs-title function_">getOrderNo</span>(), request.<span class="hljs-title function_">getAmount</span>(), request.<span class="hljs-title function_">getSubject</span>()
            ));

            <span class="hljs-title class_">AlipayTradeCreateResponse</span> response = alipayClient.<span class="hljs-title function_">execute</span>(alipayRequest);

            <span class="hljs-keyword">if</span> (response.<span class="hljs-title function_">isSuccess</span>()) {
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">PaymentResult</span>.<span class="hljs-title function_">success</span>(response.<span class="hljs-title function_">getTradeNo</span>());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">PaymentResult</span>.<span class="hljs-title function_">fail</span>(response.<span class="hljs-title function_">getSubMsg</span>());
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">PaymentResult</span>.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"支付异常: "</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentStatus</span> <span class="hljs-title function_">queryStatus</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> paymentId</span>) {
        <span class="hljs-comment">// 查询支付状态实现</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">PaymentStatus</span>.<span class="hljs-property">PAID</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">RefundResult</span> <span class="hljs-title function_">refund</span>(<span class="hljs-params">RefundRequest refundRequest</span>) {
        <span class="hljs-comment">// 退款实现</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">RefundResult</span>.<span class="hljs-title function_">success</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPaymentType</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ALIPAY"</span>;
    }
}
</code></pre>
<p><strong>微信支付实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">payment</span>.<span class="hljs-property">impl</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">payment</span>.<span class="hljs-property">spi</span>.*;

<span class="hljs-comment">/**
 * 微信支付实现
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPaymentService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentService</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentResult</span> <span class="hljs-title function_">createPayment</span>(<span class="hljs-params">PaymentRequest request</span>) {
        <span class="hljs-comment">// 微信支付统一下单实现</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">PaymentResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"WX"</span> + request.<span class="hljs-title function_">getOrderNo</span>());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentStatus</span> <span class="hljs-title function_">queryStatus</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> paymentId</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">PaymentStatus</span>.<span class="hljs-property">PAID</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">RefundResult</span> <span class="hljs-title function_">refund</span>(<span class="hljs-params">RefundRequest refundRequest</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">RefundResult</span>.<span class="hljs-title function_">success</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPaymentType</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"WECHAT"</span>;
    }
}
</code></pre>
<p><strong>支付服务工厂</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.payment;

<span class="hljs-keyword">import</span> com.example.payment.spi.PaymentService;
<span class="hljs-keyword">import</span> com.example.payment.spi.PaymentRequest;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.ServiceLoader;

<span class="hljs-comment">/**
 * 支付服务工厂
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentServiceFactory</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, PaymentService&gt; SERVICE_MAP = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 通过SPI加载所有支付实现</span>
        ServiceLoader&lt;PaymentService&gt; loader = ServiceLoader.load(PaymentService.class);
        <span class="hljs-keyword">for</span> (PaymentService service : loader) {
            SERVICE_MAP.put(service.getPaymentType(), service);
            System.out.println(<span class="hljs-string">"注册支付服务: "</span> + service.getPaymentType());
        }
    }

    <span class="hljs-comment">/**
     * 根据支付类型获取支付服务
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> PaymentService <span class="hljs-title function_">getPaymentService</span><span class="hljs-params">(String paymentType)</span> {
        <span class="hljs-type">PaymentService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> SERVICE_MAP.get(paymentType);
        <span class="hljs-keyword">if</span> (service == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的支付方式: "</span> + paymentType);
        }
        <span class="hljs-keyword">return</span> service;
    }

    <span class="hljs-comment">/**
     * 创建支付订单
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createPayment</span><span class="hljs-params">(String paymentType, PaymentRequest request)</span> {
        <span class="hljs-type">PaymentService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getPaymentService(paymentType);
        System.out.println(<span class="hljs-string">"使用 "</span> + paymentType + <span class="hljs-string">" 支付..."</span>);
        <span class="hljs-type">var</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> service.createPayment(request);

        <span class="hljs-keyword">if</span> (result.isSuccess()) {
            System.out.println(<span class="hljs-string">"支付创建成功: "</span> + result.getTransactionId());
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"支付失败: "</span> + result.getErrorMessage());
        }
    }
}
</code></pre>
<p><strong>配置文件</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"># META-INF/services/com.example.payment.spi.PaymentService
com.example.payment.<span class="hljs-keyword">impl</span>.AlipayPaymentService
com.example.payment.<span class="hljs-keyword">impl</span>.WechatPaymentService
</code></pre>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.payment;

<span class="hljs-keyword">import</span> com.example.payment.spi.PaymentRequest;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-comment">/**
 * 支付系统使用示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentSystemDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 创建支付请求</span>
        <span class="hljs-type">PaymentRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentRequest</span>();
        request.setOrderNo(<span class="hljs-string">"ORDER20240101001"</span>);
        request.setAmount(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"99.99"</span>));
        request.setSubject(<span class="hljs-string">"测试商品"</span>);

        <span class="hljs-comment">// 使用支付宝支付</span>
        PaymentServiceFactory.createPayment(<span class="hljs-string">"ALIPAY"</span>, request);

        <span class="hljs-comment">// 使用微信支付</span>
        PaymentServiceFactory.createPayment(<span class="hljs-string">"WECHAT"</span>, request);
    }
}
</code></pre>
<h2 data-id="heading-25">七、总结</h2>
<p>Java SPI机制是一种优雅的服务发现和扩展机制，它通过约定配置文件的方式，实现了：</p>
<ol>
<li><strong>解耦</strong>：核心框架与具体实现分离</li>
<li><strong>扩展</strong>：第三方可以轻松提供实现</li>
<li><strong>灵活</strong>：支持动态切换实现</li>
</ol>
<blockquote>
<p>掌握SPI机制，不仅能更好地理解开源框架的设计思想，还能在实际项目中实现更优雅的架构设计。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 从入门到精通（二）：核心基石 - 深入理解 Modifier 与布局系统]]></title>    <link>https://juejin.cn/post/7600342663319388201</link>    <guid>https://juejin.cn/post/7600342663319388201</guid>    <pubDate>2026-01-29T03:31:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600342663319388201" data-draft-id="7600430748780445739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 从入门到精通（二）：核心基石 - 深入理解 Modifier 与布局系统"/> <meta itemprop="keywords" content="Android,Kotlin,JetBrains"/> <meta itemprop="datePublished" content="2026-01-29T03:31:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="邹阿涛涛涛涛涛涛涛涛"/> <meta itemprop="url" content="https://juejin.cn/user/3808364009106839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 从入门到精通（二）：核心基石 - 深入理解 Modifier 与布局系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364009106839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    邹阿涛涛涛涛涛涛涛涛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T03:31:20.000Z" title="Thu Jan 29 2026 03:31:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本篇文章将从源码层面深入解析 Compose 的核心机制，帮助你真正理解 Modifier 的设计哲学、布局系统的测量流程，以及 LazyColumn 的惰性加载原理。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">前言</h2>
<p>在上一篇中，我们完成了 Compose 的入门。但如果你只停留在"会用"的层面，遇到复杂场景时就会束手无策。比如：</p>
<ul>
<li>为什么 Modifier 的调用顺序会影响最终效果？</li>
<li>LazyColumn 为什么能流畅处理上万条数据？</li>
<li>自定义 Layout 时，Constraints 到底该怎么用？</li>
<li>什么时候应该用 ConstraintLayout，什么时候用嵌套 Column/Row？</li>
</ul>
<p>本篇文章将带你<strong>深入原理层</strong>，不仅告诉你"怎么做"，更要让你理解"为什么这样做"。准备好了吗？让我们开始深度探索！</p>
<hr/>
<h2 data-id="heading-1">一、Modifier 深度解析：从设计哲学到源码实现</h2>
<h3 data-id="heading-2">1.1 为什么需要 Modifier？</h3>
<p>在传统 View 系统中，每个 View 都有一大堆属性方法：<code>setPadding()</code>、<code>setBackground()</code>、<code>setOnClickListener()</code>... 这不仅让 View 类变得臃肿，也限制了扩展性。</p>
<p>Compose 采用了完全不同的设计：<strong>将修饰能力从组件中分离出来</strong>，形成独立的 Modifier 系统。</p>
<p><strong>设计哲学</strong>：</p>
<ul>
<li><strong>单一职责</strong>：Text 只负责显示文字，修饰交给 Modifier</li>
<li><strong>可组合</strong>：通过链式调用组合各种修饰效果</li>
<li><strong>可扩展</strong>：随时可以增加新的 Modifier，无需修改组件</li>
</ul>
<h3 data-id="heading-3">1.2 Modifier 的本质：接口与链表</h3>
<p>Modifier 是一个<strong>接口</strong>，它的核心设计非常精巧：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 简化版源码</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Modifier</span> {
    <span class="hljs-comment">// 从左到右遍历所有 Element</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">foldIn</span><span class="hljs-params">(initial: <span class="hljs-type">R</span>, operation: (<span class="hljs-type">R</span>, <span class="hljs-type">Element</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R
    
    <span class="hljs-comment">// 从右到左遍历所有 Element</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">foldOut</span><span class="hljs-params">(initial: <span class="hljs-type">R</span>, operation: (<span class="hljs-type">Element</span>, <span class="hljs-type">R</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R
    
    <span class="hljs-comment">// 检查是否有满足条件的 Element</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">any</span><span class="hljs-params">(predicate: (<span class="hljs-type">Element</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span>
    
    <span class="hljs-comment">// 检查是否所有 Element 都满足条件</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">all</span><span class="hljs-params">(predicate: (<span class="hljs-type">Element</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span>
    
    <span class="hljs-comment">// 组合两个 Modifier</span>
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">then</span><span class="hljs-params">(other: <span class="hljs-type">Modifier</span>)</span></span>: Modifier
    
    <span class="hljs-comment">// 空的 Modifier 实例</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> : Modifier {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">foldIn</span><span class="hljs-params">(initial: <span class="hljs-type">R</span>, operation: (<span class="hljs-type">R</span>, <span class="hljs-type">Element</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R = initial
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">foldOut</span><span class="hljs-params">(initial: <span class="hljs-type">R</span>, operation: (<span class="hljs-type">Element</span>, <span class="hljs-type">R</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R = initial
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">then</span><span class="hljs-params">(other: <span class="hljs-type">Modifier</span>)</span></span>: Modifier = other
    }
}
</code></pre>
<p><strong>关键设计</strong>：Modifier 内部使用<strong>链表结构</strong>存储所有的修饰元素。</p>
<h3 data-id="heading-4">1.3 链式调用的秘密</h3>
<p>当我们写下这样的代码时，发生了什么？</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Modifier
    .padding(<span class="hljs-number">16.</span>dp)
    .background(Color.Blue)
    .size(<span class="hljs-number">100.</span>dp)
</code></pre>
<p><strong>执行过程</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">步骤</span> <span class="hljs-attr">1:</span> <span class="hljs-string">Modifier</span> <span class="hljs-string">(空)</span> 
        <span class="hljs-string">↓</span> <span class="hljs-string">then()</span>
<span class="hljs-string">步骤</span> <span class="hljs-attr">2:</span> <span class="hljs-string">Modifier</span> <span class="hljs-string">+</span> <span class="hljs-string">PaddingModifier</span>
        <span class="hljs-string">↓</span> <span class="hljs-string">then()</span>
<span class="hljs-string">步骤</span> <span class="hljs-attr">3:</span> <span class="hljs-string">Modifier</span> <span class="hljs-string">+</span> <span class="hljs-string">PaddingModifier</span> <span class="hljs-string">+</span> <span class="hljs-string">BackgroundModifier</span>
        <span class="hljs-string">↓</span> <span class="hljs-string">then()</span>
<span class="hljs-string">步骤</span> <span class="hljs-attr">4:</span> <span class="hljs-string">Modifier</span> <span class="hljs-string">+</span> <span class="hljs-string">PaddingModifier</span> <span class="hljs-string">+</span> <span class="hljs-string">BackgroundModifier</span> <span class="hljs-string">+</span> <span class="hljs-string">SizeModifier</span>
</code></pre>
<p><strong>源码实现</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Modifier.kt</span>
<span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">then</span><span class="hljs-params">(other: <span class="hljs-type">Modifier</span>)</span></span>: Modifier = 
    <span class="hljs-keyword">if</span> (other === Modifier) <span class="hljs-keyword">this</span> <span class="hljs-keyword">else</span> CombinedModifier(<span class="hljs-keyword">this</span>, other)

<span class="hljs-comment">// CombinedModifier 将两个 Modifier 组合在一起</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CombinedModifier</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> outer: Modifier,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> <span class="hljs-keyword">inner</span>: Modifier
) : Modifier {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">foldIn</span><span class="hljs-params">(initial: <span class="hljs-type">R</span>, operation: (<span class="hljs-type">R</span>, <span class="hljs-type">Modifier</span>.<span class="hljs-type">Element</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R =
        <span class="hljs-keyword">inner</span>.foldIn(outer.foldIn(initial, operation), operation)
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">foldOut</span><span class="hljs-params">(initial: <span class="hljs-type">R</span>, operation: (<span class="hljs-type">Modifier</span>.<span class="hljs-type">Element</span>, <span class="hljs-type">R</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R =
        outer.foldOut(<span class="hljs-keyword">inner</span>.foldOut(initial, operation), operation)
}
</code></pre>
<p><strong>核心洞察</strong>：<code>CombinedModifier</code> 是一个<strong>二叉树结构</strong>，<code>outer</code> 指向链表头部，<code>inner</code> 指向链表尾部。</p>
<h3 data-id="heading-5">1.4 执行顺序：为什么顺序很重要？</h3>
<p>这是 Modifier 最容易让人困惑的地方。让我们通过一个例子理解：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 情况 A</span>
Modifier
    .padding(<span class="hljs-number">16.</span>dp)        <span class="hljs-comment">// 外层</span>
    .background(Color.Blue) <span class="hljs-comment">// 中间</span>
    .padding(<span class="hljs-number">8.</span>dp)         <span class="hljs-comment">// 内层</span>
    .size(<span class="hljs-number">100.</span>dp)
</code></pre>
<p><strong>视觉效果</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────┐  ← 外层 <span class="hljs-attribute">padding</span> (<span class="hljs-number">16</span>dp) - 透明区域
│                             │
│  ┌───────────────────────┐  │
│  │  蓝色背景             │  │
│  │  ┌─────────────────┐  │  │
│  │  │                 │  │  │  ← 内层 <span class="hljs-attribute">padding</span> (<span class="hljs-number">8</span>dp) - 蓝色区域内
│  │  │    <span class="hljs-number">100</span>x100      │  │  │
│  │  │     内容        │  │  │
│  │  │                 │  │  │
│  │  └─────────────────┘  │  │
│  │                       │  │
│  └───────────────────────┘  │
│                             │
└─────────────────────────────┘
</code></pre>
<p><strong>设计原则</strong>：Modifier 的执行遵循**"从外到内"**的顺序。先应用的 Modifier 在外层，后应用的在内层。</p>
<h3 data-id="heading-6">1.5 Modifier 的遍历机制</h3>
<p>Compose 需要遍历 Modifier 链表来应用各种效果。遍历有两种方式：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// foldIn: 从左到右（outer → inner）</span>
modifier.foldIn(initialValue) { acc, element -&gt;
    <span class="hljs-comment">// 处理每个 Element</span>
    acc + element
}

<span class="hljs-comment">// foldOut: 从右到左（inner → outer）</span>
modifier.foldOut(initialValue) { element, acc -&gt;
    <span class="hljs-comment">// 处理每个 Element</span>
    element + acc
}
</code></pre>
<p><strong>应用场景</strong>：</p>
<ul>
<li><strong>foldIn</strong>：测量、布局时，需要从外到内传递约束</li>
<li><strong>foldOut</strong>：绘制时，需要从内到外绘制内容</li>
</ul>
<h3 data-id="heading-7">1.6 Modifier 的分类与内部实现</h3>
<h4 data-id="heading-8">1.6.1 布局类 Modifier</h4>
<p><strong>size() 的实现原理</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// SizeModifier 简化版</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SizeModifier</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> minWidth: Dp = Dp.Unspecified,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> minHeight: Dp = Dp.Unspecified,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> maxWidth: Dp = Dp.Unspecified,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> maxHeight: Dp = Dp.Unspecified,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> enforceIncoming: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">true</span>
) : LayoutModifier {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> MeasureScope.<span class="hljs-title">measure</span><span class="hljs-params">(
        measurable: <span class="hljs-type">Measurable</span>,
        constraints: <span class="hljs-type">Constraints</span>
    )</span></span>: MeasureResult {
        <span class="hljs-comment">// 解析尺寸值</span>
        <span class="hljs-keyword">val</span> resolvedMinWidth = <span class="hljs-keyword">if</span> (minWidth != Dp.Unspecified) {
            minWidth.roundToPx()
        } <span class="hljs-keyword">else</span> {
            constraints.minWidth
        }
        
        <span class="hljs-keyword">val</span> resolvedMaxWidth = <span class="hljs-keyword">if</span> (maxWidth != Dp.Unspecified) {
            maxWidth.roundToPx()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (enforceIncoming) constraints.maxWidth <span class="hljs-keyword">else</span> Constraints.Infinity
        }
        
        <span class="hljs-comment">// ... 高度同理</span>
        
        <span class="hljs-comment">// 创建新的约束</span>
        <span class="hljs-keyword">val</span> wrappedConstraints = Constraints(
            minWidth = resolvedMinWidth,
            maxWidth = resolvedMaxWidth,
            minHeight = resolvedMinHeight,
            maxHeight = resolvedMaxHeight
        )
        
        <span class="hljs-comment">// 测量子元素</span>
        <span class="hljs-keyword">val</span> placeable = measurable.measure(wrappedConstraints)
        
        <span class="hljs-comment">// 返回测量结果</span>
        <span class="hljs-keyword">return</span> layout(placeable.width, placeable.height) {
            placeable.placeRelative(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
        }
    }
}
</code></pre>
<p><strong>关键洞察</strong>：SizeModifier 是一个 <code>LayoutModifier</code>，它拦截了测量过程，修改了传递给子元素的 Constraints。</p>
<h4 data-id="heading-9">1.6.2 绘制类 Modifier</h4>
<p><strong>background() 的实现原理</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// BackgroundModifier 简化版</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BackgroundModifier</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> color: Color? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> brush: Brush? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> shape: Shape = RectangleShape,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> alpha: <span class="hljs-built_in">Float</span> = <span class="hljs-number">1.0f</span>
) : DrawModifier {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> ContentDrawScope.<span class="hljs-title">draw</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 绘制背景</span>
        <span class="hljs-keyword">if</span> (shape == RectangleShape) {
            <span class="hljs-comment">// 矩形背景</span>
            <span class="hljs-keyword">if</span> (color != <span class="hljs-literal">null</span>) {
                drawRect(color = color, alpha = alpha)
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (brush != <span class="hljs-literal">null</span>) {
                drawRect(brush = brush, alpha = alpha)
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 圆角/自定义形状背景</span>
            <span class="hljs-keyword">val</span> outline = shape.createOutline(size, layoutDirection, <span class="hljs-keyword">this</span>)
            <span class="hljs-keyword">if</span> (color != <span class="hljs-literal">null</span>) {
                drawOutline(outline, color = color, alpha = alpha)
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (brush != <span class="hljs-literal">null</span>) {
                drawOutline(outline, brush = brush, alpha = alpha)
            }
        }
        
        <span class="hljs-comment">// 绘制内容（调用 drawContent 继续链式绘制）</span>
        drawContent()
    }
}
</code></pre>
<p><strong>关键洞察</strong>：<code>DrawModifier</code> 拦截了绘制流程，先绘制背景，再通过 <code>drawContent()</code> 继续绘制后续内容和子元素。</p>
<h4 data-id="heading-10">1.6.3 交互类 Modifier</h4>
<p><strong>clickable() 的实现原理</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// clickable 的 Modifier 链</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> Modifier.<span class="hljs-title">clickable</span><span class="hljs-params">(
    enabled: <span class="hljs-type">Boolean</span> = <span class="hljs-literal">true</span>,
    onClickLabel: <span class="hljs-type">String</span>? = <span class="hljs-literal">null</span>,
    role: <span class="hljs-type">Role</span>? = <span class="hljs-literal">null</span>,
    onClick: () -&gt; <span class="hljs-type">Unit</span>
)</span></span>: Modifier = composed(
    inspectorInfo = debugInspectorInfo { ... }
) {
    <span class="hljs-keyword">val</span> interactionSource = remember { MutableInteractionSource() }
    <span class="hljs-keyword">val</span> indication = LocalIndication.current
    
    Modifier
        .clickable(
            interactionSource = interactionSource,
            indication = indication,
            enabled = enabled,
            onClickLabel = onClickLabel,
            role = role,
            onClick = onClick
        )
}
</code></pre>
<p><strong>clickable 内部 Modifier 链</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">clickable
├── focusableInNonTouchMode  (焦点管理)
├── pointerInput             (手势检测)
├── semantics                (无障碍支持)
├── indication               (涟漪效果)
└── isComposeRootInScrollableContainer (滚动容器检测)
</code></pre>
<h3 data-id="heading-11">1.7 自定义 Modifier 的完整指南</h3>
<h4 data-id="heading-12">1.7.1 简单自定义：使用 composed</h4>
<p>适用于需要访问 CompositionLocal 或 remember 状态的场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 自定义带阴影的圆角背景</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> Modifier.<span class="hljs-title">shadowBackground</span><span class="hljs-params">(
    color: <span class="hljs-type">Color</span>,
    cornerRadius: <span class="hljs-type">Dp</span> = <span class="hljs-number">8.</span>dp,
    shadowElevation: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp
)</span></span>: Modifier = composed {
    <span class="hljs-comment">// 可以在这里使用 remember 和 CompositionLocal</span>
    <span class="hljs-keyword">val</span> density = LocalDensity.current
    <span class="hljs-keyword">val</span> shadowPx = with(density) { shadowElevation.toPx() }
    
    remember(color, cornerRadius, shadowElevation) {
        Modifier
            .shadow(shadowElevation, RoundedCornerShape(cornerRadius))
            .background(color, RoundedCornerShape(cornerRadius))
            .padding(cornerRadius)
    }
}
</code></pre>
<h4 data-id="heading-13">1.7.2 中级自定义：实现 Modifier.NodeElement</h4>
<p>适用于需要自定义测量、布局或绘制的场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 自定义绘制对角线的 Modifier</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiagonalLineElement</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> color: Color,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> strokeWidth: <span class="hljs-built_in">Float</span>
) : ModifierNodeElement&lt;DiagonalLineNode&gt;() {
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>: DiagonalLineNode = 
        DiagonalLineNode(color, strokeWidth)
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">update</span><span class="hljs-params">(node: <span class="hljs-type">DiagonalLineNode</span>)</span></span> {
        node.color = color
        node.strokeWidth = strokeWidth
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> =
        color.hashCode() * <span class="hljs-number">31</span> + strokeWidth.hashCode()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">equals</span><span class="hljs-params">(other: <span class="hljs-type">Any</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> =
        other <span class="hljs-keyword">is</span> DiagonalLineElement &amp;&amp;
        other.color == color &amp;&amp;
        other.strokeWidth == strokeWidth
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiagonalLineNode</span>(
    <span class="hljs-keyword">var</span> color: Color,
    <span class="hljs-keyword">var</span> strokeWidth: <span class="hljs-built_in">Float</span>
) : Modifier.Node(), DrawModifierNode {
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> ContentDrawScope.<span class="hljs-title">draw</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 先绘制内容</span>
        drawContent()
        
        <span class="hljs-comment">// 再绘制对角线</span>
        drawLine(
            color = color,
            start = Offset(<span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>),
            end = Offset(size.width, size.height),
            strokeWidth = strokeWidth
        )
    }
}

<span class="hljs-comment">// 使用扩展函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> Modifier.<span class="hljs-title">diagonalLine</span><span class="hljs-params">(
    color: <span class="hljs-type">Color</span>,
    strokeWidth: <span class="hljs-type">Float</span> = <span class="hljs-number">2</span>f
)</span></span>: Modifier = <span class="hljs-keyword">this</span>.then(DiagonalLineElement(color, strokeWidth))
</code></pre>
<h4 data-id="heading-14">1.7.3 高级自定义：LayoutModifier</h4>
<p>适用于需要自定义测量和布局逻辑的场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 自定义 AspectRatio Modifier（保持宽高比）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AspectRatioElement</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> ratio: <span class="hljs-built_in">Float</span>
) : ModifierNodeElement&lt;AspectRatioNode&gt;() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span> = AspectRatioNode(ratio)
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">update</span><span class="hljs-params">(node: <span class="hljs-type">AspectRatioNode</span>)</span></span> {
        node.ratio = ratio
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AspectRatioNode</span>(<span class="hljs-keyword">var</span> ratio: <span class="hljs-built_in">Float</span>) : 
    Modifier.Node(), 
    LayoutModifierNode {
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> MeasureScope.<span class="hljs-title">measure</span><span class="hljs-params">(
        measurable: <span class="hljs-type">Measurable</span>,
        constraints: <span class="hljs-type">Constraints</span>
    )</span></span>: MeasureResult {
        <span class="hljs-comment">// 根据约束计算合适的尺寸</span>
        <span class="hljs-keyword">val</span> width = constraints.maxWidth
        <span class="hljs-keyword">val</span> height = (width / ratio).toInt()
        
        <span class="hljs-comment">// 确保不超过最大高度</span>
        <span class="hljs-keyword">val</span> finalHeight = <span class="hljs-keyword">if</span> (height &gt; constraints.maxHeight) {
            constraints.maxHeight
        } <span class="hljs-keyword">else</span> {
            height
        }
        
        <span class="hljs-comment">// 重新计算宽度以保持比例</span>
        <span class="hljs-keyword">val</span> finalWidth = (finalHeight * ratio).toInt()
        
        <span class="hljs-comment">// 测量子元素</span>
        <span class="hljs-keyword">val</span> placeable = measurable.measure(
            Constraints.fixed(finalWidth, finalHeight)
        )
        
        <span class="hljs-keyword">return</span> layout(finalWidth, finalHeight) {
            placeable.placeRelative(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-15">1.8 Intrinsic 测量：解决"先有鸡还是先有蛋"</h3>
<h4 data-id="heading-16">1.8.1 问题场景</h4>
<p>考虑这样一个需求：两个 Text 垂直排列，要求 Divider 的宽度等于两个 Text 中最宽的那个。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Column {
    Text(<span class="hljs-string">"Short"</span>)
    Text(<span class="hljs-string">"Longer text"</span>)
    Divider() <span class="hljs-comment">// 宽度应该等于 "Longer text" 的宽度</span>
}
</code></pre>
<p><strong>问题</strong>：在测量 Divider 时，Column 还不知道两个 Text 的宽度，因为 Text 还没被测量。</p>
<h4 data-id="heading-17">1.8.2 Intrinsic 测量的原理</h4>
<p>Intrinsic 测量允许父组件在正式测量前，<strong>预先询问子元素的期望尺寸</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IntrinsicMeasurable</span> {
    <span class="hljs-comment">// 给定高度，返回最小/最大宽度</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">minIntrinsicWidth</span><span class="hljs-params">(height: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxIntrinsicWidth</span><span class="hljs-params">(height: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>
    
    <span class="hljs-comment">// 给定宽度，返回最小/最大高度  </span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">minIntrinsicHeight</span><span class="hljs-params">(width: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxIntrinsicHeight</span><span class="hljs-params">(width: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>
}
</code></pre>
<p><strong>使用 Intrinsic 测量解决 Divider 问题</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">IntrinsicWidthDemo</span><span class="hljs-params">()</span></span> {
    Column(
        modifier = Modifier.width(IntrinsicSize.Max)  <span class="hljs-comment">// 使用最大固有宽度</span>
    ) {
        Text(<span class="hljs-string">"Short text"</span>)
        Text(<span class="hljs-string">"This is a longer text"</span>)
        Divider(
            modifier = Modifier.fillMaxWidth(),
            color = Color.Black
        )
    }
}
</code></pre>
<p><strong>执行流程</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> Column 收到 IntrinsicSize.Max 约束
<span class="hljs-bullet">2.</span> Column 询问所有子元素的 maxIntrinsicWidth
<span class="hljs-bullet">3.</span> Text 返回自己的文本宽度
<span class="hljs-bullet">4.</span> Column 取最大值作为自身宽度
<span class="hljs-bullet">5.</span> Column 正式测量，将宽度约束传递给子元素
<span class="hljs-bullet">6.</span> Divider 收到与最宽 Text 相同的宽度
</code></pre>
<h4 data-id="heading-18">1.8.3 IntrinsicSize.Min 与 IntrinsicSize.Max</h4>




















<table><thead><tr><th>类型</th><th>说明</th><th>应用场景</th></tr></thead><tbody><tr><td><code>IntrinsicSize.Min</code></td><td>使用子元素的最小固有尺寸</td><td>按钮等需要紧凑尺寸的场景</td></tr><tr><td><code>IntrinsicSize.Max</code></td><td>使用子元素的最大固有尺寸</td><td>表单等需要对齐的场景</td></tr></tbody></table>
<h3 data-id="heading-19">1.9 Modifier 性能优化</h3>
<h4 data-id="heading-20">1.9.1 避免不必要的重组</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 错误：每次重组都创建新的 Modifier</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BadExample</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Text(
        text = <span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>,
        modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)  <span class="hljs-comment">// 每次重组都创建新实例</span>
    )
}

<span class="hljs-comment">// ✅ 正确：使用 remember 缓存 Modifier</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">GoodExample</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    <span class="hljs-keyword">val</span> modifier = remember { Modifier.padding(<span class="hljs-number">16.</span>dp) }
    
    Text(
        text = <span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>,
        modifier = modifier  <span class="hljs-comment">// 复用同一个实例</span>
    )
}

<span class="hljs-comment">// ✅ 更好：将 Modifier 作为参数，由父组件提供</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BestExample</span><span class="hljs-params">(
    text: <span class="hljs-type">String</span>,
    modifier: <span class="hljs-type">Modifier</span> = Modifier  <span class="hljs-comment">// 由调用方提供</span>
)</span></span> {
    Text(
        text = text,
        modifier = modifier
    )
}
</code></pre>
<h4 data-id="heading-21">1.9.2 Modifier 的相等性优化</h4>
<p>Compose 使用 <code>equals()</code> 判断 Modifier 是否变化，从而决定是否跳过重组：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 自定义 Modifier 时，务必实现 equals 和 hashCode</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModifier</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> color: Color,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> size: Dp
) : Modifier.Element {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">equals</span><span class="hljs-params">(other: <span class="hljs-type">Any</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> === other) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        <span class="hljs-keyword">if</span> (other !<span class="hljs-keyword">is</span> MyModifier) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">return</span> color == other.color &amp;&amp; size == other.size
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> color.hashCode() * <span class="hljs-number">31</span> + size.hashCode()
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-22">二、布局系统深度解析：从测量到绘制</h2>
<h3 data-id="heading-23">2.1 Compose 布局的三阶段</h3>
<p>Compose 的渲染流程分为三个阶段：</p>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────────────────────────────────┐
│                      Composition                            │
│  执行 Composable 函数，构建 UI 树（LayoutNode 树）            │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        Layout                               │
│  测量每个节点的尺寸（Measure），确定位置（Place）              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        Drawing                              │
│  将 UI 绘制到 <span class="hljs-selector-tag">Canvas</span> 上                                      │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-24">2.2 Layout 节点的数据结构</h3>
<p>每个 Composable 在布局阶段都会对应一个 <code>LayoutNode</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 简化版 LayoutNode 结构</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LayoutNode</span> {
    <span class="hljs-comment">// 父节点</span>
    <span class="hljs-keyword">var</span> parent: LayoutNode? = <span class="hljs-literal">null</span>
    
    <span class="hljs-comment">// 子节点列表</span>
    <span class="hljs-keyword">val</span> children: MutableList&lt;LayoutNode&gt; = mutableListOf()
    
    <span class="hljs-comment">// Modifier 链表</span>
    <span class="hljs-keyword">var</span> modifier: Modifier = Modifier
    
    <span class="hljs-comment">// 测量结果</span>
    <span class="hljs-keyword">var</span> width: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> height: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 位置</span>
    <span class="hljs-keyword">var</span> x: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> y: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 测量函数（由 Layout Composable 提供）</span>
    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> measurePolicy: MeasurePolicy
}
</code></pre>
<h3 data-id="heading-25">2.3 Constraints：布局的约束条件</h3>
<p>Constraints 是 Compose 布局系统的核心，它定义了尺寸的限制范围：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Constraints</span> {
    <span class="hljs-keyword">val</span> minWidth: <span class="hljs-built_in">Int</span>
    <span class="hljs-keyword">val</span> maxWidth: <span class="hljs-built_in">Int</span>
    <span class="hljs-keyword">val</span> minHeight: <span class="hljs-built_in">Int</span>
    <span class="hljs-keyword">val</span> maxHeight: <span class="hljs-built_in">Int</span>
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 创建固定尺寸约束</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fixed</span><span class="hljs-params">(width: <span class="hljs-type">Int</span>, height: <span class="hljs-type">Int</span>)</span></span>: Constraints
        
        <span class="hljs-comment">// 创建最大尺寸约束</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxWidth</span><span class="hljs-params">(width: <span class="hljs-type">Int</span>)</span></span>: Constraints
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxHeight</span><span class="hljs-params">(height: <span class="hljs-type">Int</span>)</span></span>: Constraints
        
        <span class="hljs-comment">// 无限约束</span>
        <span class="hljs-keyword">val</span> Infinity = <span class="hljs-built_in">Int</span>.MAX_VALUE
    }
}
</code></pre>
<p><strong>约束类型</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">┌─────────────────────────────────────────────────────────────┐
│                    约束类型图解                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  精确约束                    范围约束                       │
│  ┌─────────┐               ┌───────────────────────────┐   │
│  │         │               │  minWidth          maxWidth│   │
│  │ 100x100 │               │  ├─────────────────────┤   │   │
│  │         │               │       可以是任意值          │   │
│  └─────────┘               └───────────────────────────┘   │
│  <span class="hljs-attr">minWidth</span> = maxWidth = <span class="hljs-number">100</span>                                  │
│                                                             │
│  无约束                                                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Infinity                          │   │
│  │  可以是任意大的尺寸                                   │   │
│  └─────────────────────────────────────────────────────┘   │
│  <span class="hljs-attr">maxWidth</span> = Int.MAX_VALUE                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-26">2.4 测量流程详解</h3>
<p>测量是一个<strong>自顶向下</strong>的过程：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 父节点测量子节点的流程</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">measureChild</span><span class="hljs-params">(child: <span class="hljs-type">Measurable</span>, constraints: <span class="hljs-type">Constraints</span>)</span></span>: Placeable {
    <span class="hljs-comment">// 1. 根据父节点的约束，计算给子节点的约束</span>
    <span class="hljs-keyword">val</span> childConstraints = calculateChildConstraints(constraints)
    
    <span class="hljs-comment">// 2. 让子节点测量自己</span>
    <span class="hljs-keyword">val</span> placeable = child.measure(childConstraints)
    
    <span class="hljs-comment">// 3. 返回测量结果（Placeable）</span>
    <span class="hljs-keyword">return</span> placeable
}
</code></pre>
<p><strong>完整测量流程示例</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MeasureDemo</span><span class="hljs-params">()</span></span> {
    Layout(
        content = {
            Text(<span class="hljs-string">"Child 1"</span>)
            Text(<span class="hljs-string">"Child 2"</span>)
        }
    ) { measurables, constraints -&gt;
        <span class="hljs-comment">// constraints: 父节点给当前节点的约束</span>
        println(<span class="hljs-string">"父约束: minW=<span class="hljs-subst">${constraints.minWidth}</span>, maxW=<span class="hljs-subst">${constraints.maxWidth}</span>"</span>)
        
        <span class="hljs-comment">// 测量子节点</span>
        <span class="hljs-keyword">val</span> placeables = measurables.map { measurable -&gt;
            <span class="hljs-comment">// 可以给子节点不同的约束</span>
            <span class="hljs-keyword">val</span> childConstraints = Constraints(
                minWidth = <span class="hljs-number">0</span>,
                maxWidth = constraints.maxWidth / <span class="hljs-number">2</span>,  <span class="hljs-comment">// 每个子节点最多一半宽度</span>
                minHeight = <span class="hljs-number">0</span>,
                maxHeight = constraints.maxHeight
            )
            measurable.measure(childConstraints)
        }
        
        <span class="hljs-comment">// 计算自己的尺寸</span>
        <span class="hljs-keyword">val</span> width = placeables.sumOf { it.width }
        <span class="hljs-keyword">val</span> height = placeables.maxOf { it.height }
        
        <span class="hljs-comment">// 布局</span>
        layout(width, height) {
            <span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>
            placeables.forEach { placeable -&gt;
                placeable.placeRelative(x, <span class="hljs-number">0</span>)
                x += placeable.width
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-27">2.5 Column 的测量与布局原理</h3>
<p>让我们深入分析 Column 的实现：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Column 的简化实现</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Column</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    verticalArrangement: <span class="hljs-type">Arrangement</span>.<span class="hljs-type">Vertical</span> = Arrangement.Top,
    horizontalAlignment: <span class="hljs-type">Alignment</span>.<span class="hljs-type">Horizontal</span> = Alignment.Start,
    content: @<span class="hljs-type">Composable</span> <span class="hljs-type">ColumnScope</span>.() -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">val</span> measurePolicy = columnMeasurePolicy(
        verticalArrangement = verticalArrangement,
        horizontalAlignment = horizontalAlignment
    )
    
    Layout(
        content = { ColumnScopeInstance.content() },
        measurePolicy = measurePolicy,
        modifier = modifier
    )
}

<span class="hljs-comment">// Column 的测量策略</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">columnMeasurePolicy</span><span class="hljs-params">(
    verticalArrangement: <span class="hljs-type">Arrangement</span>.<span class="hljs-type">Vertical</span>,
    horizontalAlignment: <span class="hljs-type">Alignment</span>.<span class="hljs-type">Horizontal</span>
)</span></span>: MeasurePolicy = MeasurePolicy { measurables, constraints -&gt;
    <span class="hljs-comment">// 1. 测量所有子元素</span>
    <span class="hljs-keyword">val</span> placeables = measurables.map { measurable -&gt;
        measurable.measure(constraints)
    }
    
    <span class="hljs-comment">// 2. 计算 Column 的尺寸</span>
    <span class="hljs-keyword">val</span> width = placeables.maxOf { it.width }
        .coerceIn(constraints.minWidth, constraints.maxWidth)
    
    <span class="hljs-keyword">val</span> height = placeables.sumOf { it.height }
        .coerceIn(constraints.minHeight, constraints.maxHeight)
    
    <span class="hljs-comment">// 3. 计算垂直位置（根据 Arrangement）</span>
    <span class="hljs-keyword">val</span> positions = verticalArrangement.arrange(
        totalSize = height,
        sizes = placeables.map { it.height },
        layoutDirection = layoutDirection
    )
    
    <span class="hljs-comment">// 4. 布局</span>
    layout(width, height) {
        placeables.forEachIndexed { index, placeable -&gt;
            <span class="hljs-comment">// 计算水平位置（根据 Alignment）</span>
            <span class="hljs-keyword">val</span> x = horizontalAlignment.align(
                size = placeable.width,
                space = width,
                layoutDirection = layoutDirection
            )
            placeable.placeRelative(x, positions[index])
        }
    }
}
</code></pre>
<p><strong>关键设计</strong>：</p>
<ul>
<li>Column 给子元素的约束是<strong>完整的父约束</strong>，子元素可以决定自己的高度</li>
<li>Column 的总高度是子元素高度之和</li>
<li>Arrangement 决定子元素的垂直分布</li>
<li>Alignment 决定子元素的水平对齐</li>
</ul>
<h3 data-id="heading-28">2.6 Row 的测量与布局原理</h3>
<p>Row 与 Column 类似，只是方向不同：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Row 的测量策略</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">rowMeasurePolicy</span><span class="hljs-params">(
    horizontalArrangement: <span class="hljs-type">Arrangement</span>.<span class="hljs-type">Horizontal</span>,
    verticalAlignment: <span class="hljs-type">Alignment</span>.<span class="hljs-type">Vertical</span>
)</span></span>: MeasurePolicy = MeasurePolicy { measurables, constraints -&gt;
    <span class="hljs-comment">// 1. 测量所有子元素</span>
    <span class="hljs-keyword">val</span> placeables = measurables.map { measurable -&gt;
        measurable.measure(constraints)
    }
    
    <span class="hljs-comment">// 2. 计算 Row 的尺寸</span>
    <span class="hljs-keyword">val</span> width = placeables.sumOf { it.width }
        .coerceIn(constraints.minWidth, constraints.maxWidth)
    
    <span class="hljs-keyword">val</span> height = placeables.maxOf { it.height }
        .coerceIn(constraints.minHeight, constraints.maxHeight)
    
    <span class="hljs-comment">// 3. 计算水平位置（根据 Arrangement）</span>
    <span class="hljs-keyword">val</span> positions = horizontalArrangement.arrange(
        totalSize = width,
        sizes = placeables.map { it.width },
        layoutDirection = layoutDirection
    )
    
    <span class="hljs-comment">// 4. 布局</span>
    layout(width, height) {
        placeables.forEachIndexed { index, placeable -&gt;
            <span class="hljs-comment">// 计算垂直位置（根据 Alignment）</span>
            <span class="hljs-keyword">val</span> y = verticalAlignment.align(
                size = placeable.height,
                space = height
            )
            placeable.placeRelative(positions[index], y)
        }
    }
}
</code></pre>
<h3 data-id="heading-29">2.7 Box 的测量与布局原理</h3>
<p>Box 是层叠布局，子元素可以重叠：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Box 的测量策略</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">boxMeasurePolicy</span><span class="hljs-params">(alignment: <span class="hljs-type">Alignment</span>)</span></span>: MeasurePolicy = 
    MeasurePolicy { measurables, constraints -&gt;
        <span class="hljs-comment">// 1. 测量所有子元素</span>
        <span class="hljs-keyword">val</span> placeables = measurables.map { measurable -&gt;
            measurable.measure(constraints)
        }
        
        <span class="hljs-comment">// 2. 计算 Box 的尺寸</span>
        <span class="hljs-keyword">val</span> width = placeables.maxOf { it.width }
            .coerceIn(constraints.minWidth, constraints.maxWidth)
        
        <span class="hljs-keyword">val</span> height = placeables.maxOf { it.height }
            .coerceIn(constraints.minHeight, constraints.maxHeight)
        
        <span class="hljs-comment">// 3. 布局（所有子元素都使用相同的对齐方式）</span>
        layout(width, height) {
            placeables.forEach { placeable -&gt;
                <span class="hljs-keyword">val</span> x = alignment.align(
                    size = placeable.width,
                    space = width,
                    layoutDirection = layoutDirection
                )
                <span class="hljs-keyword">val</span> y = alignment.align(
                    size = placeable.height,
                    space = height
                )
                placeable.placeRelative(x, y)
            }
        }
    }
</code></pre>
<p><strong>Box 的特殊之处</strong>：</p>
<ul>
<li>所有子元素都测量为最大尺寸</li>
<li>子元素默认使用 contentAlignment 对齐</li>
<li>可以单独指定子元素的对齐方式（使用 Modifier.align）</li>
</ul>
<h3 data-id="heading-30">2.8 自定义 Layout 的设计思路</h3>
<h4 data-id="heading-31">2.8.1 设计自定义布局的步骤</h4>
<ol>
<li><strong>明确需求</strong>：要实现什么样的布局效果？</li>
<li><strong>确定约束</strong>：子元素的尺寸如何确定？</li>
<li><strong>设计测量策略</strong>：如何测量子元素？</li>
<li><strong>设计布局策略</strong>：子元素如何排列？</li>
</ol>
<h4 data-id="heading-32">2.8.2 实战：自定义瀑布流布局</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 瀑布流布局（StaggeredGrid）
 * 
 * 设计思路：
 * 1. 将子元素分配到多列中
 * 2. 每列独立计算高度
 * 3. 新元素添加到最短的列
 */</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">StaggeredGrid</span><span class="hljs-params">(
    columns: <span class="hljs-type">Int</span> = <span class="hljs-number">2</span>,
    horizontalGap: <span class="hljs-type">Dp</span> = <span class="hljs-number">8.</span>dp,
    verticalGap: <span class="hljs-type">Dp</span> = <span class="hljs-number">8.</span>dp,
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    content: @<span class="hljs-type">Composable</span> () -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    Layout(
        content = content,
        modifier = modifier
    ) { measurables, constraints -&gt;
        <span class="hljs-keyword">val</span> hGapPx = horizontalGap.roundToPx()
        <span class="hljs-keyword">val</span> vGapPx = verticalGap.roundToPx()
        
        <span class="hljs-comment">// 计算每列的宽度</span>
        <span class="hljs-keyword">val</span> columnWidth = (constraints.maxWidth - (columns - <span class="hljs-number">1</span>) * hGapPx) / columns
        
        <span class="hljs-comment">// 创建列高度追踪器</span>
        <span class="hljs-keyword">val</span> columnHeights = IntArray(columns) { <span class="hljs-number">0</span> }
        
        <span class="hljs-comment">// 存储每个子元素的位置信息</span>
        <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ItemInfo</span>(
            <span class="hljs-keyword">val</span> placeable: Placeable,
            <span class="hljs-keyword">val</span> column: <span class="hljs-built_in">Int</span>,
            <span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Int</span>,
            <span class="hljs-keyword">val</span> y: <span class="hljs-built_in">Int</span>
        )
        
        <span class="hljs-keyword">val</span> itemInfos = mutableListOf&lt;ItemInfo&gt;()
        
        <span class="hljs-comment">// 测量并放置每个子元素</span>
        measurables.forEach { measurable -&gt;
            <span class="hljs-comment">// 测量子元素（宽度固定为列宽，高度不限）</span>
            <span class="hljs-keyword">val</span> placeable = measurable.measure(
                Constraints.fixedWidth(columnWidth)
            )
            
            <span class="hljs-comment">// 找到最短的列</span>
            <span class="hljs-keyword">val</span> shortestColumn = columnHeights.indices.minByOrNull { columnHeights[it] } ?: <span class="hljs-number">0</span>
            
            <span class="hljs-comment">// 计算位置</span>
            <span class="hljs-keyword">val</span> x = shortestColumn * (columnWidth + hGapPx)
            <span class="hljs-keyword">val</span> y = columnHeights[shortestColumn]
            
            <span class="hljs-comment">// 更新列高度</span>
            columnHeights[shortestColumn] += placeable.height + vGapPx
            
            itemInfos.add(ItemInfo(placeable, shortestColumn, x, y))
        }
        
        <span class="hljs-comment">// 计算总高度（最高列的高度）</span>
        <span class="hljs-keyword">val</span> totalHeight = columnHeights.maxOrNull()?.let { 
            it - vGapPx  <span class="hljs-comment">// 减去最后一个间隙</span>
        } ?: <span class="hljs-number">0</span>
        
        <span class="hljs-comment">// 布局</span>
        layout(constraints.maxWidth, totalHeight.coerceIn(constraints.minHeight, constraints.maxHeight)) {
            itemInfos.forEach { info -&gt;
                info.placeable.placeRelative(info.x, info.y)
            }
        }
    }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">StaggeredGridDemo</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> items = listOf(
        <span class="hljs-string">"短文本"</span> to <span class="hljs-number">80</span>,
        <span class="hljs-string">"这是一个比较长的文本内容"</span> to <span class="hljs-number">120</span>,
        <span class="hljs-string">"中等"</span> to <span class="hljs-number">100</span>,
        <span class="hljs-string">"很长很长很长的文本内容在这里"</span> to <span class="hljs-number">150</span>,
        <span class="hljs-string">"短"</span> to <span class="hljs-number">60</span>,
    )
    
    StaggeredGrid(
        columns = <span class="hljs-number">2</span>,
        horizontalGap = <span class="hljs-number">8.</span>dp,
        verticalGap = <span class="hljs-number">8.</span>dp,
        modifier = Modifier.fillMaxWidth()
    ) {
        items.forEach { (text, height) -&gt;
            Card(
                modifier = Modifier.height(height.dp)
            ) {
                Text(
                    text = text,
                    modifier = Modifier.padding(<span class="hljs-number">8.</span>dp)
                )
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-33">2.9 SubcomposeLayout：延迟组合</h3>
<p>SubcomposeLayout 允许在测量阶段动态创建子元素，这在某些场景下非常有用。</p>
<h4 data-id="heading-34">2.9.1 使用场景</h4>
<ol>
<li><strong>根据测量结果决定子元素内容</strong></li>
<li><strong>实现复杂的自适应布局</strong></li>
<li><strong>动态加载内容</strong></li>
</ol>
<h4 data-id="heading-35">2.9.2 实战：响应式文本</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 响应式文本：根据可用宽度自动调整字体大小
 */</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ResponsiveText</span><span class="hljs-params">(
    text: <span class="hljs-type">String</span>,
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    minFontSize: <span class="hljs-type">TextUnit</span> = <span class="hljs-number">12.</span>sp,
    maxFontSize: <span class="hljs-type">TextUnit</span> = <span class="hljs-number">48.</span>sp
)</span></span> {
    SubcomposeLayout(modifier = modifier) { constraints -&gt;
        <span class="hljs-keyword">var</span> fontSize = maxFontSize
        <span class="hljs-keyword">var</span> placeable: Placeable? = <span class="hljs-literal">null</span>
        
        <span class="hljs-comment">// 二分查找合适的字体大小</span>
        <span class="hljs-keyword">while</span> (fontSize &gt;= minFontSize) {
            <span class="hljs-keyword">val</span> measurable = subcompose(<span class="hljs-string">"text_<span class="hljs-variable">$fontSize</span>"</span>) {
                Text(
                    text = text,
                    fontSize = fontSize,
                    maxLines = <span class="hljs-number">1</span>
                )
            }[<span class="hljs-number">0</span>]
            
            <span class="hljs-keyword">val</span> testPlaceable = measurable.measure(constraints)
            
            <span class="hljs-keyword">if</span> (testPlaceable.width &lt;= constraints.maxWidth) {
                placeable = testPlaceable
                <span class="hljs-keyword">break</span>
            }
            
            fontSize *= <span class="hljs-number">0.9f</span>
        }
        
        placeable = placeable ?: subcompose(<span class="hljs-string">"text_min"</span>) {
            Text(text = text, fontSize = minFontSize, maxLines = <span class="hljs-number">1</span>)
        }[<span class="hljs-number">0</span>].measure(constraints)
        
        layout(placeable.width, placeable.height) {
            placeable.placeRelative(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-36">三、LazyColumn 深度解析：惰性加载的艺术</h2>
<h3 data-id="heading-37">3.1 为什么需要惰性加载？</h3>
<p>假设我们要显示 10000 条数据的列表：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用普通 Column - 会创建 10000 个 Text 组件！</span>
Column {
    repeat(<span class="hljs-number">10000</span>) { index -&gt;
        Text(<span class="hljs-string">"Item <span class="hljs-variable">$index</span>"</span>)
    }
}
</code></pre>
<p><strong>问题</strong>：</p>
<ul>
<li>内存占用：10000 个 Text 组件同时存在</li>
<li>首次加载：需要测量和布局所有 item</li>
<li>滑动性能：大量视图参与绘制</li>
</ul>
<h3 data-id="heading-38">3.2 LazyColumn 的解决方案</h3>
<p>LazyColumn 采用<strong>视口渲染 + 对象池复用</strong>策略：</p>
<pre><code class="hljs language-scss" lang="scss">┌────────────────────────────────────────────────────────────────┐
│                     LazyColumn 视口                            │
│                                                                │
│  ┌──────────────────────────────────────────────────────┐     │
│  │                    可见区域 (Viewport)                  │     │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │     │
│  │  │ Item <span class="hljs-number">5</span>  │  │ Item <span class="hljs-number">6</span>  │  │ Item <span class="hljs-number">7</span>  │  │ Item <span class="hljs-number">8</span>  │  │     │
│  │  │ (可见)  │  │ (可见)  │  │ (可见)  │  │ (可见)  │  │     │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  │     │
│  └──────────────────────────────────────────────────────┘     │
│                                                                │
│  Item <span class="hljs-number">1</span>-<span class="hljs-number">4</span>: 已滑出视口，组件被回收，状态保存                      │
│  Item <span class="hljs-number">9</span>+:  未进入视口，组件未创建                                │
│                                                                │
└────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-39">3.3 LazyColumn 的架构设计</h3>
<pre><code class="hljs language-scss" lang="scss">LazyColumn
├── LazyListState          (状态管理)
│   ├── firstVisibleItemIndex
│   ├── firstVisibleItemScrollOffset
│   └── layoutInfo
├── LazyListLayoutInfo     (布局信息)
│   ├── visibleItemsInfo   (可见 item 信息)
│   ├── totalItemsCount
│   └── viewportSize
└── LazyListItemProvider   (Item 提供器)
    └── itemProvider       (根据索引创建 item)
</code></pre>
<h3 data-id="heading-40">3.4 测量与布局流程</h3>
<p>LazyColumn 的测量流程与普通 Layout 不同：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// LazyColumn 的测量策略（简化版）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">measureLazyList</span><span class="hljs-params">(constraints: <span class="hljs-type">Constraints</span>)</span></span>: MeasureResult {
    <span class="hljs-comment">// 1. 计算视口大小</span>
    <span class="hljs-keyword">val</span> viewportWidth = constraints.maxWidth
    <span class="hljs-keyword">val</span> viewportHeight = constraints.maxHeight
    
    <span class="hljs-comment">// 2. 确定可见 item 范围</span>
    <span class="hljs-keyword">val</span> firstVisibleIndex = calculateFirstVisibleItem()
    <span class="hljs-keyword">val</span> lastVisibleIndex = calculateLastVisibleItem(viewportHeight)
    
    <span class="hljs-comment">// 3. 测量可见 item</span>
    <span class="hljs-keyword">val</span> visiblePlaceables = mutableListOf&lt;Placeable&gt;()
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> firstVisibleIndex..lastVisibleIndex) {
        <span class="hljs-keyword">val</span> placeable = measureItem(index, constraints)
        visiblePlaceables.add(placeable)
    }
    
    <span class="hljs-comment">// 4. 计算总高度（预估）</span>
    <span class="hljs-keyword">val</span> totalHeight = <span class="hljs-keyword">if</span> (hasMoreItems) {
        estimateTotalHeight()
    } <span class="hljs-keyword">else</span> {
        visiblePlaceables.sumOf { it.height }
    }
    
    <span class="hljs-comment">// 5. 布局</span>
    <span class="hljs-keyword">return</span> layout(viewportWidth, totalHeight) {
        <span class="hljs-keyword">var</span> y = -scrollOffset
        visiblePlaceables.forEach { placeable -&gt;
            placeable.placeRelative(<span class="hljs-number">0</span>, y)
            y += placeable.height
        }
    }
}
</code></pre>
<h3 data-id="heading-41">3.5 key 的作用与 diff 算法</h3>
<h4 data-id="heading-42">3.5.1 为什么需要 key？</h4>
<p>当列表数据变化时，Compose 需要知道：</p>
<ul>
<li>哪些 item 是新增的？</li>
<li>哪些 item 被删除了？</li>
<li>哪些 item 移动了位置？</li>
</ul>
<p><strong>没有 key 的问题</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 假设列表初始状态</span>
items = [A, B, C]

<span class="hljs-comment">// 删除 A 后</span>
items = [B, C]

<span class="hljs-comment">// 没有 key 时，Compose 会认为：</span>
<span class="hljs-comment">// - 位置 0 的内容从 A 变成了 B</span>
<span class="hljs-comment">// - 位置 1 的内容从 B 变成了 C</span>
<span class="hljs-comment">// - 位置 2 被删除</span>
<span class="hljs-comment">// 结果是：B 和 C 都会重组，状态丢失！</span>
</code></pre>
<p><strong>有 key 时</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">items(items, key = { it.id }) { item -&gt;
    ItemCard(item)
}

<span class="hljs-comment">// 删除 A 后</span>
<span class="hljs-comment">// Compose 知道：</span>
<span class="hljs-comment">// - A 被删除了</span>
<span class="hljs-comment">// - B 和 C 只是位置变了</span>
<span class="hljs-comment">// 结果是：只有 A 的组件被销毁，B 和 C 只是移动位置</span>
</code></pre>
<h4 data-id="heading-43">3.5.2 key 的 diff 算法</h4>
<p>Compose 使用类似 React 的 diff 算法：</p>
<pre><code class="hljs language-ini" lang="ini">旧列表: <span class="hljs-section">[A(key=1), B(key=2), C(key=3)]</span>
新列表: <span class="hljs-section">[B(key=2), C(key=3), D(key=4)]</span>

Diff 结果:
<span class="hljs-attr">1. key</span>=<span class="hljs-number">1</span> 的 A 不在新列表中 → 删除 A
<span class="hljs-attr">2. key</span>=<span class="hljs-number">2</span> 的 B 在位置 <span class="hljs-number">0</span> → 移动到位置 <span class="hljs-number">0</span>
<span class="hljs-attr">3. key</span>=<span class="hljs-number">3</span> 的 C 在位置 <span class="hljs-number">1</span> → 移动到位置 <span class="hljs-number">1</span>  
<span class="hljs-attr">4. key</span>=<span class="hljs-number">4</span> 的 D 是新元素 → 创建 D
</code></pre>
<h3 data-id="heading-44">3.6 列表状态管理</h3>
<h4 data-id="heading-45">3.6.1 记住滚动位置</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LazyColumnWithState</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// rememberLazyListState 会自动保存和恢复滚动位置</span>
    <span class="hljs-keyword">val</span> listState = rememberLazyListState()
    
    LazyColumn(state = listState) {
        items(<span class="hljs-number">1000</span>) { index -&gt;
            Text(<span class="hljs-string">"Item <span class="hljs-variable">$index</span>"</span>)
        }
    }
    
    <span class="hljs-comment">// 滚动到指定位置</span>
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        listState.scrollToItem(<span class="hljs-number">100</span>)
    }
    
    <span class="hljs-comment">// 平滑滚动</span>
    scope.launch {
        listState.animateScrollToItem(<span class="hljs-number">100</span>)
    }
}
</code></pre>
<h4 data-id="heading-46">3.6.2 监听滚动状态</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LazyColumnWithScrollListener</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> listState = rememberLazyListState()
    
    <span class="hljs-comment">// 使用 derivedStateOf 优化频繁变化的状态</span>
    <span class="hljs-keyword">val</span> firstVisibleItem <span class="hljs-keyword">by</span> remember {
        derivedStateOf { listState.firstVisibleItemIndex }
    }
    
    <span class="hljs-keyword">val</span> isScrolling <span class="hljs-keyword">by</span> remember {
        derivedStateOf { listState.isScrollInProgress }
    }
    
    <span class="hljs-comment">// 判断是否滑到底部</span>
    <span class="hljs-keyword">val</span> isAtBottom <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            <span class="hljs-keyword">val</span> layoutInfo = listState.layoutInfo
            <span class="hljs-keyword">val</span> visibleItems = layoutInfo.visibleItemsInfo
            <span class="hljs-keyword">val</span> lastVisibleItem = visibleItems.lastOrNull()
            
            lastVisibleItem != <span class="hljs-literal">null</span> &amp;&amp; 
            lastVisibleItem.index &gt;= layoutInfo.totalItemsCount - <span class="hljs-number">1</span>
        }
    }
    
    LazyColumn(state = listState) {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h3 data-id="heading-47">3.7 分页加载实现</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">PaginatedList</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> listState = rememberLazyListState()
    <span class="hljs-keyword">var</span> items <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;List&lt;Item&gt;&gt;(emptyList()) }
    <span class="hljs-keyword">var</span> isLoading <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">var</span> hasMore <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">true</span>) }
    
    <span class="hljs-comment">// 监听是否需要加载更多</span>
    <span class="hljs-keyword">val</span> shouldLoadMore <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            <span class="hljs-keyword">val</span> layoutInfo = listState.layoutInfo
            <span class="hljs-keyword">val</span> visibleItems = layoutInfo.visibleItemsInfo
            <span class="hljs-keyword">val</span> lastVisibleItem = visibleItems.lastOrNull()
            
            <span class="hljs-comment">// 当最后一个可见 item 是倒数第 5 个时，开始加载</span>
            lastVisibleItem != <span class="hljs-literal">null</span> &amp;&amp;
            lastVisibleItem.index &gt;= layoutInfo.totalItemsCount - <span class="hljs-number">5</span> &amp;&amp;
            !isLoading &amp;&amp; hasMore
        }
    }
    
    <span class="hljs-comment">// 加载数据</span>
    LaunchedEffect(shouldLoadMore) {
        <span class="hljs-keyword">if</span> (shouldLoadMore) {
            isLoading = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">val</span> newItems = repository.loadMore(items.size, pageSize = <span class="hljs-number">20</span>)
            items = items + newItems
            hasMore = newItems.size &gt;= <span class="hljs-number">20</span>
            isLoading = <span class="hljs-literal">false</span>
        }
    }
    
    LazyColumn(state = listState) {
        items(items, key = { it.id }) { item -&gt;
            ItemCard(item)
        }
        
        <span class="hljs-keyword">if</span> (isLoading) {
            item {
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(<span class="hljs-number">16.</span>dp),
                    contentAlignment = Alignment.Center
                ) {
                    CircularProgressIndicator()
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-48">3.8 性能优化最佳实践</h3>
<h4 data-id="heading-49">3.8.1 使用 key</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 正确：使用 key</span>
items(dataList, key = { it.id }) { item -&gt;
    ItemCard(item)
}

<span class="hljs-comment">// ❌ 错误：不使用 key</span>
items(dataList) { item -&gt;
    ItemCard(item)
}
</code></pre>
<h4 data-id="heading-50">3.8.2 避免在 item 中创建新的对象</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 错误：每次重组都创建新的 lambda</span>
items(dataList, key = { it.id }) { item -&gt;
    ItemCard(
        item = item,
        onClick = { viewModel.onItemClick(item) }  <span class="hljs-comment">// 每次重组都创建</span>
    )
}

<span class="hljs-comment">// ✅ 正确：使用 remember 缓存 lambda</span>
items(dataList, key = { it.id }) { item -&gt;
    <span class="hljs-keyword">val</span> onClick = remember(item.id) {
        { viewModel.onItemClick(item) }
    }
    ItemCard(item = item, onClick = onClick)
}
</code></pre>
<h4 data-id="heading-51">3.8.3 使用 contentType 优化不同类型 item</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">LazyColumn {
    items(
        items = mixedList,
        key = { it.id },
        contentType = { it.type }  <span class="hljs-comment">// 帮助 Compose 复用 item</span>
    ) { item -&gt;
        <span class="hljs-keyword">when</span> (item.type) {
            Type.HEADER -&gt; HeaderItem(item)
            Type.CONTENT -&gt; ContentItem(item)
            Type.FOOTER -&gt; FooterItem(item)
        }
    }
}
</code></pre>
<h4 data-id="heading-52">3.8.4 合理使用 remember 缓存计算</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ItemCard</span><span class="hljs-params">(item: <span class="hljs-type">Item</span>)</span></span> {
    <span class="hljs-comment">// ✅ 缓存格式化后的价格</span>
    <span class="hljs-keyword">val</span> formattedPrice = remember(item.price) {
        NumberFormat.getCurrencyInstance().format(item.price)
    }
    
    <span class="hljs-comment">// ✅ 缓存渐变 Brush</span>
    <span class="hljs-keyword">val</span> gradient = remember(item.color) {
        Brush.linearGradient(
            colors = listOf(item.color, item.color.copy(alpha = <span class="hljs-number">0.5f</span>))
        )
    }
    
    Text(text = formattedPrice)
}
</code></pre>
<hr/>
<h2 data-id="heading-53">四、ConstraintLayout 深度解析</h2>
<h3 data-id="heading-54">4.1 ConstraintLayout 的设计哲学</h3>
<p>ConstraintLayout 的核心思想是<strong>通过约束条件描述布局</strong>，而不是通过嵌套层次。</p>
<p><strong>优势</strong>：</p>
<ul>
<li>扁平的视图层级（通常只有一层）</li>
<li>灵活的相对定位</li>
<li>更好的性能（减少测量次数）</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>复杂的表单页面</li>
<li>需要相对定位的布局</li>
<li>需要动态调整位置的元素</li>
</ul>
<h3 data-id="heading-55">4.2 约束求解原理</h3>
<p>ConstraintLayout 的布局过程可以看作是一个<strong>约束求解问题</strong>：</p>
<pre><code class="hljs language-css" lang="css">变量：每个 View 的 x, y, <span class="hljs-attribute">width</span>, <span class="hljs-attribute">height</span>
约束条件：
  - View <span class="hljs-selector-tag">A</span> 的左边与父布局左边对齐
  - View <span class="hljs-selector-tag">B</span> 的左边与 View <span class="hljs-selector-tag">A</span> 的右边对齐
  - View C 在父布局中水平居中
  - ...

求解目标：找到满足所有约束的 x, y, <span class="hljs-attribute">width</span>, <span class="hljs-attribute">height</span>
</code></pre>
<h3 data-id="heading-56">4.3 与嵌套布局的选择策略</h3>



































<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td>简单线性排列</td><td>Column/Row</td><td>代码更简洁，语义更清晰</td></tr><tr><td>需要相对定位</td><td>ConstraintLayout</td><td>减少嵌套层级</td></tr><tr><td>复杂表单</td><td>ConstraintLayout</td><td>标签和输入框对齐更方便</td></tr><tr><td>列表项</td><td>Column/Row</td><td>性能更好，代码更易读</td></tr><tr><td>需要动态位置</td><td>ConstraintLayout</td><td>约束可以动态修改</td></tr></tbody></table>
<h3 data-id="heading-57">4.4 性能对比</h3>
<pre><code class="hljs language-diff" lang="diff">场景：一个包含 10 个子元素的复杂布局

嵌套 Column + Row:
<span class="hljs-deletion">- 测量次数：O(n²) 级别</span>
<span class="hljs-deletion">- 视图层级：3-4 层</span>

ConstraintLayout:
<span class="hljs-deletion">- 测量次数：O(n) 级别</span>
<span class="hljs-deletion">- 视图层级：1 层</span>
</code></pre>
<p><strong>建议</strong>：</p>
<ul>
<li>简单布局优先使用 Column/Row</li>
<li>复杂布局考虑 ConstraintLayout</li>
<li>不要过度优化，先保证代码可读性</li>
</ul>
<hr/>
<h2 data-id="heading-58">五、常见问题与解决方案</h2>
<h3 data-id="heading-59">5.1 Modifier 相关问题</h3>
<p><strong>Q: 为什么 Modifier.padding() 和 Modifier.background() 的顺序会影响效果？</strong></p>
<p>A: 因为 Modifier 是从外到内执行的。先应用的 Modifier 在外层，后应用的在内层。</p>
<p><strong>Q: 如何实现点击区域比实际 View 大？</strong></p>
<p>A: 使用 <code>Modifier.clickable</code> 配合 <code>Modifier.padding</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Box(
    modifier = Modifier
        .clickable { <span class="hljs-comment">/* 点击处理 */</span> }
        .padding(<span class="hljs-number">16.</span>dp)  <span class="hljs-comment">// 点击区域包含 padding</span>
        .background(Color.Blue)
) {
    Text(<span class="hljs-string">"Click me"</span>)
}
</code></pre>
<h3 data-id="heading-60">5.2 布局相关问题</h3>
<p><strong>Q: 如何实现宽高比固定的组件？</strong></p>
<p>A: 使用 <code>AspectRatio</code> Modifier：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Image(
    painter = painterResource(R.drawable.image),
    contentDescription = <span class="hljs-literal">null</span>,
    modifier = Modifier.aspectRatio(<span class="hljs-number">16f</span> / <span class="hljs-number">9f</span>)
)
</code></pre>
<p><strong>Q: 如何让子元素填满剩余空间？</strong></p>
<p>A: 使用 <code>Modifier.weight</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Column {
    Text(<span class="hljs-string">"Header"</span>)
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .weight(<span class="hljs-number">1f</span>)  <span class="hljs-comment">// 填满剩余空间</span>
    )
    Text(<span class="hljs-string">"Footer"</span>)
}
</code></pre>
<h3 data-id="heading-61">5.3 LazyColumn 相关问题</h3>
<p><strong>Q: 列表滑动卡顿怎么办？</strong></p>
<p>A: 检查以下几点：</p>
<ol>
<li>是否使用了 key</li>
<li>item 中是否避免了创建新对象</li>
<li>是否使用了 derivedStateOf 优化频繁变化的状态</li>
<li>item 的布局是否过于复杂</li>
</ol>
<p><strong>Q: 如何实现粘性 Header？</strong></p>
<p>A: 使用 <code>stickyHeader</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">LazyColumn {
    stickyHeader {
        Text(<span class="hljs-string">"Section A"</span>, modifier = Modifier.background(Color.Gray))
    }
    items(itemsA) { Item(it) }
    
    stickyHeader {
        Text(<span class="hljs-string">"Section B"</span>, modifier = Modifier.background(Color.Gray))
    }
    items(itemsB) { Item(it) }
}
</code></pre>
<hr/>
<h2 data-id="heading-62">六、本篇小结</h2>
<p>今天我们深入探讨了 Compose 的核心基石：</p>
<h3 data-id="heading-63">Modifier</h3>
<ul>
<li>理解了 Modifier 的接口设计和链表结构</li>
<li>掌握了链式调用的执行顺序</li>
<li>学会了自定义 Modifier 的三种方式</li>
<li>了解了 Intrinsic 测量的原理</li>
</ul>
<h3 data-id="heading-64">布局系统</h3>
<ul>
<li>理解了 Composition → Layout → Drawing 的三阶段</li>
<li>掌握了 Constraints 的使用方法</li>
<li>深入了解了 Column、Row、Box 的测量与布局原理</li>
<li>学会了自定义 Layout 的设计思路</li>
</ul>
<h3 data-id="heading-65">LazyColumn</h3>
<ul>
<li>理解了惰性加载的视口渲染机制</li>
<li>掌握了 key 的作用和 diff 算法</li>
<li>学会了列表状态管理和分页加载</li>
<li>了解了性能优化的最佳实践</li>
</ul>
<h3 data-id="heading-66">ConstraintLayout</h3>
<ul>
<li>理解了约束求解的原理</li>
<li>掌握了与嵌套布局的选择策略</li>
</ul>
<hr/>
<h2 data-id="heading-67">下篇预告</h2>
<p><strong>第三篇：状态管理</strong> 将深入讲解：</p>
<ul>
<li>状态与重组机制深度解析（Slot Table 原理）</li>
<li>remember、mutableStateOf 源码分析</li>
<li>状态提升（State Hoisting）设计模式</li>
<li>ViewModel 与 Compose 的最佳实践</li>
<li>CompositionLocal 原理与应用</li>
</ul>
<p>敬请期待！</p>
<hr/>
<h2 data-id="heading-68">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fcompose%2Flayouts" target="_blank" title="https://developer.android.com/jetpack/compose/layouts" ref="nofollow noopener noreferrer">Compose 布局官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fcompose%2Flists" target="_blank" title="https://developer.android.com/jetpack/compose/lists" ref="nofollow noopener noreferrer">Lazy 列表官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%2Fcompose%2F" target="_blank" title="https://android.googlesource.com/platform/frameworks/support/+/androidx-main/compose/" ref="nofollow noopener noreferrer">Compose 源码</a></li>
</ul>
<hr/>
<blockquote>
<p>📌 <strong>系列文章导航</strong></p>
<ul>
<li>第一篇：初识 Compose ✅</li>
<li>第二篇：核心基石（当前）✅</li>
<li>第三篇：状态管理</li>
<li>第四篇：Material 组件与主题</li>
<li>第五篇：动画与交互</li>
<li>第六篇：架构与工程化</li>
<li>第七篇：高级特性与实战</li>
</ul>
</blockquote>
<hr/>
<p>如果这篇文章对你有帮助，欢迎 <strong>点赞</strong>、<strong>收藏</strong>、<strong>关注</strong>！有任何问题可以在评论区留言。</p>
<p><del>Generated by Kimi K2.5 Agent</del></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[什么？Mybaits扩展 JPA功能，有趣！]]></title>    <link>https://juejin.cn/post/7600314093294207014</link>    <guid>https://juejin.cn/post/7600314093294207014</guid>    <pubDate>2026-01-29T01:22:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600314093294207014" data-draft-id="7600314093294190630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="什么？Mybaits扩展 JPA功能，有趣！"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2026-01-29T01:22:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SimonKing"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056904584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            什么？Mybaits扩展 JPA功能，有趣！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056904584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SimonKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T01:22:24.000Z" title="Thu Jan 29 2026 01:22:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关注我的公众号：【编程朝花夕拾】，可获取首发内容。</p>
</blockquote>
<h2 data-id="heading-0">01 引言</h2>
<p>一直很关注<code>dromara</code>社区的项目，最近浏览器项目时，发现一个<code>mybatis-jpa-extra</code>项目，里面针对<code>JPA</code>扩展，可以使用<code>Lambda</code>表达式，于是好奇的点进去了解了一下，分享给大家。</p>
<h2 data-id="heading-1">02 简介</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c408060fe3a14e7cb84368a74351d103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254543&amp;x-signature=0EGN0a7DrQYjMgOMHuYNR7GjygA%3D" alt="" loading="lazy"/></p>
<p><code>MyBatis JPA Extra</code>对<code>MyBatis</code>扩展<code>JPA</code>功能，<code>Jakarta JPA</code> 注释简化<code>CRUD</code>操作，增强了SELECT分页查询，增加链式Query查询条件构造器；支持<code>Lambda</code> 形式调用，方便编写各类查询条件，使用<code>@Encrypted</code>注解轻松实现字段数据加密和解密以及字段数据自动填充功能等。</p>
<p><code>GitHub</code>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdromara%2Fmybatis-jpa-extra" target="_blank" title="https://github.com/dromara/mybatis-jpa-extra" ref="nofollow noopener noreferrer">github.com/dromara/myb…</a></p>
<p><code>Gitee</code>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdromara%2Fmybatis-jpa-extra" target="_blank" title="https://gitee.com/dromara/mybatis-jpa-extra" ref="nofollow noopener noreferrer">gitee.com/dromara/myb…</a></p>
<h2 data-id="heading-2">03 简单使用</h2>
<h3 data-id="heading-3">3.1 依赖</h3>
<p><strong>Maven</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.dromara.mybatis-jpa-extra<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-jpa-extra-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/test
spring.datasource.username=root
spring.datasource.password=123456

mybatis.type-aliases-package=com.simonking.boot.jpa.pojo
</code></pre>
<h3 data-id="heading-4">3.2 实体定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Entity(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Users</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaEntity</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@Column</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-meta">@Column</span>
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-meta">@Column</span>
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-meta">@Column(name = "password_salt")</span>
    <span class="hljs-keyword">private</span> String passwordSalt;
    <span class="hljs-meta">@Column(name = "del_flag")</span>
    <span class="hljs-keyword">private</span> Boolean delFlag;
}
</code></pre>
<p>需要注意的是这里的<code>@Column</code>一定要加，否则使用<code>Lambda</code>调用的时候会出现<code>sql</code>异常。</p>
<h3 data-id="heading-5">3.3 接口以及实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsersService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IJpaService</span>&lt;Users, Integer&gt; {

}

<span class="hljs-comment">/**
 * 实现
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaServiceImpl</span>&lt;UsersMapper, Users, Integer&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UsersService</span>  {

}
</code></pre>
<p>官方说明里面继承的是<code>AbstractJpaRepository</code>，使用起来有点小问题，会导致<code>getMapper</code>为空的异常。使用时需要继承<code>JpaServiceImpl</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34af6f35a058457aa4cf37911839fc53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254543&amp;x-signature=zosIKJRs%2FTtbfDKUNNLkag6TzG8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.4 Mapper</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsersMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IJpaMapper</span>&lt;Users, Integer&gt; {
}
</code></pre>
<p>这里的Mapper可以使用<code>@Mapper</code>注解，也可以使用<code>@MapperScan("com.simonking.boot.jpa.mapper")</code>放在启动类上。</p>
<h3 data-id="heading-7">3.5 测试</h3>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UsersService usersService;

<span class="hljs-comment">/**
 * JPA 测试
 */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test03</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Users</span> <span class="hljs-variable">byId</span> <span class="hljs-operator">=</span> usersService.findById(<span class="hljs-number">1</span>);
    System.out.println(byId);
}

<span class="hljs-comment">/**
 * Lambda 测试
 */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test02</span><span class="hljs-params">()</span> {
    usersService.query(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQuery</span>&lt;Users&gt;()
                    .eq(Users::getUsername, <span class="hljs-string">"test"</span>)
            ).forEach(System.out::println);
}

<span class="hljs-comment">/**
 * Mybatis 注解测试
 */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test03</span><span class="hljs-params">()</span> {
     <span class="hljs-type">Users</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> usersService.getByUsername(<span class="hljs-string">"lisi"</span>);
     System.out.println(users);
}
</code></pre>
<p>结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18e64b6f904d44aeb9ccf17d3f430fc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254543&amp;x-signature=y8J8ROY0MefQOiNP4IhTlugdtGM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fdcb0b2aac54462a27b143df8e631fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254543&amp;x-signature=lLL4p8WqhEJR7HNZ6kdjQH1tNJA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab0245df69574ae5a9ec2eac79dd9e5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770254543&amp;x-signature=5HP%2F8HNzYSpqOmT5oMD2QPhe0gE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">04 小结</h2>
<p>作者是基于<code>Mybaits</code>扩展的<code>JPA</code>。类似框架<code>Mybaits-Plus</code>、<code>Mybaits-Flex</code>，本身是对<code>Mybatis</code>的增强，没有引入其他的框架。<code>mybatis-jpa-extra</code>何尝不是一种新的选择。</p>
<p>框架可能还不成熟，测试下来总会碰到一些小问题。</p>
<ul>
<li><code>xxxServiceImpl</code>需要继承<code>JpaServiceImpl</code>，而不是<code>AbstractJpaRepository</code>，否则<code>getMapper</code> is null</li>
<li>使用<code>SpringBoot 3.x</code>启动异常，使用<code>SpringBoot4.0.1</code>正常启动测试</li>
<li><code>insert</code>方法没有返回主键</li>
</ul>
<p>使用下来感觉没有<code>MP</code>、<code>MF</code>丝滑，就没有深入去了解了。有懂的朋友一起唠唠！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 开发效率翻倍的5个隐藏技巧，你知道几个？]]></title>    <link>https://juejin.cn/post/7600265780349861928</link>    <guid>https://juejin.cn/post/7600265780349861928</guid>    <pubDate>2026-01-29T00:17:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600265780349861928" data-draft-id="7600296037542674432" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 开发效率翻倍的5个隐藏技巧，你知道几个？"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-29T00:17:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 开发效率翻倍的5个隐藏技巧，你知道几个？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T00:17:20.000Z" title="Thu Jan 29 2026 00:17:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 开发效率翻倍的5个隐藏技巧，你知道几个？</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>SpringBoot 作为 Java 生态中最流行的微服务框架之一，以其“约定优于配置”的理念和丰富的 Starter 依赖极大地简化了开发流程。然而，很多开发者仅停留在基础用法上，忽略了 SpringBoot 提供的一些隐藏技巧。这些技巧不仅能减少样板代码，还能显著提升开发效率。本文将深入剖析 <strong>5 个鲜为人知但极其实用的 SpringBoot 技巧</strong>，帮助你从“会用”进阶到“精通”。</p>
<hr/>
<h3 data-id="heading-2">1. Lombok + @Builder.Default：优雅处理默认值</h3>
<h4 data-id="heading-3">问题场景</h4>
<p>在实体类或 DTO 中，我们经常需要为字段设置默认值。传统做法是在构造函数或 <code>@Data</code> 注解生成的 <code>setter</code> 方法中硬编码，但这会导致代码冗余且难以维护。</p>
<h4 data-id="heading-4">解决方案</h4>
<p>结合 Lombok 的 <code>@Builder</code> 和 <code>@Builder.Default</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Builder</span>.Default
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ACTIVE"</span>;
    
    <span class="hljs-meta">@Builder</span>.Default
    <span class="hljs-keyword">private</span> <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">createdAt</span> <span class="hljs-operator">=</span> LocalDateTime.now();
}
</code></pre>
<ul>
<li><strong>优势</strong>：
<ol>
<li><strong>清晰直观</strong>：通过注解显式声明默认值。</li>
<li><strong>线程安全</strong>：每次构建对象时会重新计算默认值（如 <code>LocalDateTime.now()</code>）。</li>
<li><strong>与 Jackson 无缝集成</strong>：反序列化时自动应用默认值。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-5">注意事项</h4>
<ul>
<li>Lombok v1.18.4+ 版本支持此特性。</li>
<li>避免在 <code>@Builder.Default</code> 中使用可变对象（如 <code>List</code>），建议用不可变集合（如 <code>Collections.unmodifiableList</code>）。</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. @ConfigurationProperties + Validation：强类型的配置管理</h3>
<h4 data-id="heading-7">问题场景</h4>
<p>SpringBoot 的 <code>application.properties</code>/<code>.yml</code> 通常通过 <code>@Value</code>注入，但这种方式缺乏类型安全和结构化验证。</p>
<h4 data-id="heading-8">解决方案</h4>
<p>使用 <code>@ConfigurationProperties</code> + JSR-303 Validation：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">app:</span>
   <span class="hljs-attr">max-retry:</span> <span class="hljs-number">3</span>
   <span class="hljs-attr">endpoints:</span>
     <span class="hljs-bullet">-</span> <span class="hljs-string">"/api/v1/users"</span>
     <span class="hljs-bullet">-</span> <span class="hljs-string">"/api/v1/products"</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ConfigurationProperties(prefix = "app")</span>
<span class="hljs-meta">@Validated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-meta">@Min(1)</span> <span class="hljs-meta">@Max(10)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxRetry;
    
    <span class="hljs-meta">@NotEmpty</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; endpoints;
    
    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<ul>
<li><strong>优势</strong>：
<ol>
<li><strong>类型安全</strong>：避免拼写错误和类型转换问题。</li>
<li><strong>自动补全支持</strong>：IDE（如 IntelliJ）能识别配置项。</li>
<li><strong>启动时验证</strong>：配置错误会直接抛出异常。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-9">进阶技巧</h4>
<p>通过 <code>spring-boot-configuration-processor</code>生成元数据文件，实现配置提示：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">3. Spring DevTools + LiveReload：极速热部署</h3>
<h4 data-id="heading-11">Why DevTools?</h4>
<p>传统的重启式热部署（如 JRebel）需要付费或复杂配置。Spring DevTools是官方提供的免费方案：</p>
<ol>
<li><strong>快速重启</strong>：仅重载变更的类（比冷启动快5-10倍）。</li>
<li><strong>LiveReload集成</strong>：自动刷新浏览器（需安装LiveReload插件）。</li>
</ol>
<h4 data-id="heading-12">Hidden Features:</h4>
<ul>
<li><strong>排除静态资源重启</strong>：</li>
</ul>
<pre><code class="hljs language-properties" lang="properties">spring.devtools.restart.exclude=static/**
</code></pre>
<ul>
<li><strong>远程调试支持</strong>：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:run -Dspring.devtools.restart.enabled=<span class="hljs-literal">true</span> 
</code></pre>
<h4 data-id="heading-13">Profiling结果对比：</h4>

















<table><thead><tr><th>Method</th><th>Avg Restart Time</th></tr></thead><tbody><tr><td>Cold Start</td><td>~8s</td></tr><tr><td>With DevTools</td><td>~1s</td></tr></tbody></table>
<hr/>
<p>###4 .自定义FailureAnalyzer ：让启动错误一目了然</p>
<p>当SpringBoot应用启动失败时,默认的错误日志可能晦涩难懂 。通过实现FailureAnalyzer接口,可以将底层异常转换为友好的错误提示 :</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanFailureAnalyzer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FailureAnalyzer</span> {
<span class="hljs-meta">@Override</span> 
<span class="hljs-keyword">public</span> FailureAnalysis <span class="hljs-title function_">analyze</span><span class="hljs-params">(Throwable failure)</span> { 
<span class="hljs-keyword">if</span> (failure <span class="hljs-keyword">instanceof</span> UnsatisfiedDependencyException ex) { 
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FailureAnalysis</span>(
<span class="hljs-string">"Bean依赖注入失败: "</span>+ex.getInjectionPoint(),
<span class="hljs-string">"检查是否存在对应的Bean定义"</span>, 
failure); } <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; } }
</code></pre>
<p>注册到META-INF/spring.factories :</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.diagnostics.FailureAnalyzer</span>=\ com.example.MyBeanFailureAnalyzer 
</code></pre>
<p>效果对比 :</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Before : NoSuchBeanDefinitionException ... 
After : [ACTION REQUIRED] Bean依赖注入失败: UserService.userDao → Check <span class="hljs-keyword">if</span> <span class="hljs-meta">@Repository</span> <span class="hljs-keyword">is</span> missing!
</code></pre>
<hr/>
<p>###5 .Smart Initialization ：优化启动性能</p>
<p>SpringBoot默认按顺序初始化所有Bean,导致启动慢 。通过以下方式优化 :</p>
<p>1 .懒加载特定Bean :</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Lazy</span> <span class="hljs-meta">@Service</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeavyService</span> { ... } 
</code></pre>
<p>2 .分批初始化 (Spring Boot2.4+) :</p>
<pre><code class="hljs language-properties" lang="properties">spring.main.lazy-initialization=true #全局懒加载 spring.main.eager-init-beans[0]=criticalService #强制提前加载关键Bean 
</code></pre>
<p>3 .使用ApplicationRunner控制顺序 :</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Order(1)</span> <span class="hljs-meta">@Bean</span> <span class="hljs-keyword">public</span> ApplicationRunner <span class="hljs-title function_">initDB</span><span class="hljs-params">()</span> { .. } 

实测效果 (基于<span class="hljs-number">100</span>个Bean的项目 ):
| Configuration       | Startup Time |
|----------------------|--------------|
| Default              | ~12s         |
| Smart Initialization | ~6s          |
</code></pre>
<hr/>
<p>###总结</p>
<p>本文揭示的五个技巧覆盖了从编码 、配置到调试 、优化的完整链路 :</p>
<p>• Lombok的 Builder.Default →减少样板代码 • ConfigurationProperties →强化配置管理 • DevTools深度使用 →加速开发循环 • Custom FailureAnalyzer →提升可维护性 • Smart Initialization →优化运行时性能</p>
<p>掌握这些鲜为人知却至关重要的技术 ,你的SpringBoot开发效率将产生质的飞跃 。建议收藏本文并实践每一个案例 ,它们都来自真实项目的最佳实践 。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 从入门到精通（三）：状态管理 - 从原理到实践]]></title>    <link>https://juejin.cn/post/7600663744192069668</link>    <guid>https://juejin.cn/post/7600663744192069668</guid>    <pubDate>2026-01-29T11:34:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600663744192069668" data-draft-id="7600562816458653738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 从入门到精通（三）：状态管理 - 从原理到实践"/> <meta itemprop="keywords" content="Kotlin,JetBrains,Android"/> <meta itemprop="datePublished" content="2026-01-29T11:34:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="邹阿涛涛涛涛涛涛涛涛"/> <meta itemprop="url" content="https://juejin.cn/user/3808364009106839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 从入门到精通（三）：状态管理 - 从原理到实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364009106839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    邹阿涛涛涛涛涛涛涛涛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:34:11.000Z" title="Thu Jan 29 2026 11:34:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>深入理解 Compose 的状态系统：Slot Table 机制、重组原理、状态提升设计模式，以及企业级状态管理最佳实践。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">前言</h2>
<p>在前两篇中，我们掌握了 Compose 的布局系统。但一个完整的应用离不开状态管理：用户的点击、网络请求的结果、页面的切换...这些都需要状态来驱动 UI 更新。</p>
<p>Compose 的状态系统与传统 View 系统完全不同，它采用了<strong>响应式编程</strong>的思想：状态变化自动触发 UI 更新。这听起来很神奇，但背后有着精妙的设计。</p>
<p>本篇文章将带你深入理解：</p>
<ul>
<li>Compose 如何追踪状态变化？</li>
<li>重组（Recomposition）到底是什么？</li>
<li>为什么有时候状态更新了 UI 却没刷新？</li>
<li>如何设计优雅的状态管理架构？</li>
</ul>
<p>让我们开始这场深入源码的探索之旅！</p>
<hr/>
<h2 data-id="heading-1">一、状态与重组机制深度解析</h2>
<h3 data-id="heading-2">1.1 响应式编程的本质</h3>
<p>Compose 的核心理念是<strong>状态驱动 UI</strong>。当状态变化时，UI 会自动更新。这背后的关键机制就是<strong>重组（Recomposition）</strong>。</p>
<p><strong>传统 View 系统（命令式）</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 手动更新 UI</span>
button.setOnClickListener {
    count++
    textView.text = <span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>  <span class="hljs-comment">// 手动设置新值</span>
}
</code></pre>
<p><strong>Compose（声明式）</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)  <span class="hljs-comment">// 自动更新</span>
    }
}
</code></pre>
<p><strong>关键区别</strong>：Compose 会自动追踪 <code>count</code> 的变化，当 <code>count</code> 改变时，自动重新执行 <code>Counter</code> 函数，更新 UI。</p>
<h3 data-id="heading-3">1.2 Slot Table：Compose 的"记忆"系统</h3>
<p>Compose 如何知道哪些 Composable 需要重组？答案就是 <strong>Slot Table</strong>。</p>
<h4 data-id="heading-4">1.2.1 为什么需要 Slot Table？</h4>
<p>想象这样一个场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p>当用户点击按钮，<code>count</code> 从 0 变成 1。此时 Compose 需要：</p>
<ol>
<li>知道 <code>count</code> 的新值是 1</li>
<li>知道哪些 Composable 读取了 <code>count</code></li>
<li>只更新那些 Composable</li>
</ol>
<p><strong>Slot Table 就是解决这个问题的核心机制</strong>。</p>
<h4 data-id="heading-5">1.2.2 Slot Table 是什么？</h4>
<p>Slot Table 是 Compose 运行时维护的一个<strong>线性数组</strong>，用于存储 Composable 函数的执行结果。你可以把它理解为 Compose 的"记忆系统"。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">┌─────────────────────────────────────────────────────────────────┐
│                      Slot Table 结构                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  索引    类型          内容                                      │
│  ─────────────────────────────────────────────────────────────  │
│   <span class="hljs-number">0</span>      <span class="hljs-keyword">Group</span>        Counter (Composable 组)                   │
│   <span class="hljs-number">1</span>      Int          <span class="hljs-number">0</span> (remember 的 <span class="hljs-keyword">key</span>)                       │
│   <span class="hljs-number">2</span>      State        MutableState(value=<span class="hljs-number">0</span>)                     │
│   <span class="hljs-number">3</span>      <span class="hljs-keyword">Group</span>        Button                                    │
│   <span class="hljs-number">4</span>      Lambda       onClick = { count++ }                     │
│   <span class="hljs-number">5</span>      <span class="hljs-keyword">Group</span>        <span class="hljs-keyword">Text</span>                                      │
│   <span class="hljs-number">6</span>      <span class="hljs-type">String</span>       <span class="hljs-string">"Count: 0"</span>                                │
│   <span class="hljs-number">7</span>      EndGroup     <span class="hljs-keyword">Text</span> 结束                                 │
│   <span class="hljs-number">8</span>      EndGroup     Button 结束                               │
│   <span class="hljs-number">9</span>      EndGroup     Counter 结束                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>Slot Table 的三大作用</strong>：</p>
<ol>
<li><strong>记忆状态</strong>：保存 <code>remember</code>、<code>mutableStateOf</code> 等的状态，重组时不丢失</li>
<li><strong>追踪结构</strong>：记录 Composable 树的结构，知道哪个组件在哪里</li>
<li><strong>支持重组</strong>：通过对比新旧 Slot Table，确定哪些部分需要更新</li>
</ol>
<h4 data-id="heading-6">1.2.3 Slot Table 的源码实现</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// SlotTable 简化版源码（位于 androidx.compose.runtime 包）</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlotTable</span> {
    <span class="hljs-comment">// 存储数据的数组，所有状态和对象都存在这里</span>
    <span class="hljs-keyword">val</span> slots = Array&lt;Any?&gt;(<span class="hljs-number">64</span>) { <span class="hljs-literal">null</span> }
    
    <span class="hljs-comment">// 当前写入位置</span>
    <span class="hljs-keyword">var</span> currentSlot = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 组（Group）的栈，用于追踪嵌套的 Composable</span>
    <span class="hljs-keyword">val</span> groups = IntArray(<span class="hljs-number">64</span>)
    <span class="hljs-keyword">var</span> currentGroup = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 写入数据到当前位置，然后移动到下一个</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">write</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>?)</span></span> {
        slots[currentSlot++] = value
    }
    
    <span class="hljs-comment">// 读取当前位置的数据，然后移动到下一个</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span>: Any? = slots[currentSlot++]
    
    <span class="hljs-comment">// 开始一个组（Composable）</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startGroup</span><span class="hljs-params">(key: <span class="hljs-type">Int</span>)</span></span> {
        groups[currentGroup++] = currentSlot
        write(key)
    }
    
    <span class="hljs-comment">// 结束一个组</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">endGroup</span><span class="hljs-params">()</span></span> {
        currentGroup--
    }
}
</code></pre>
<h4 data-id="heading-7">1.2.4 Slot Table 如何工作？</h4>
<p>让我们通过一个完整例子理解：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p><strong>首次组合时</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. 开始 Counter 组
   SlotTable<span class="hljs-selector-class">.startGroup</span>("Counter".hashCode())
   
<span class="hljs-number">2</span>. 执行 remember { <span class="hljs-built_in">mutableStateOf</span>(<span class="hljs-number">0</span>) }
   - 创建 MutableState 对象
   - 写入 SlotTable: <span class="hljs-built_in">write</span>(<span class="hljs-built_in">MutableState</span>(<span class="hljs-number">0</span>))
   
<span class="hljs-number">3</span>. 开始 Button 组
   SlotTable.<span class="hljs-built_in">startGroup</span>(<span class="hljs-string">"Button"</span>.<span class="hljs-built_in">hashCode</span>())
   
<span class="hljs-number">4</span>. 执行 <span class="hljs-built_in">Text</span>(<span class="hljs-string">"Count: $count"</span>)
   - 读取 count 的值: <span class="hljs-number">0</span>
   - 写入 SlotTable: <span class="hljs-built_in">write</span>(<span class="hljs-string">"Count: 0"</span>)
   
<span class="hljs-number">5</span>. 结束所有组
</code></pre>
<p><strong>重组时</strong>（用户点击后，count 变成 1）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 开始 Counter 组
<span class="hljs-bullet">   -</span> 发现这个组已经存在
<span class="hljs-bullet">   -</span> 跳过已存在的内容，只对比变化
   
<span class="hljs-bullet">2.</span> 执行 remember
<span class="hljs-bullet">   -</span> 发现 remember 已经存在
<span class="hljs-bullet">   -</span> 直接返回缓存的 MutableState
   
<span class="hljs-bullet">3.</span> 执行 Text("Count: $count")
<span class="hljs-bullet">   -</span> 发现之前的值是 "Count: 0"
<span class="hljs-bullet">   -</span> 新的值是 "Count: 1"
<span class="hljs-bullet">   -</span> 值不同！需要更新
   
<span class="hljs-bullet">4.</span> 只更新 Text 组件
</code></pre>
<h3 data-id="heading-8">1.3 Composition 的生命周期</h3>
<p>Compose 的渲染过程分为三个阶段：</p>
<pre><code class="hljs language-sql" lang="sql">┌─────────────────────────────────────────────────────────────────┐
│                   Composition 生命周期                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   初始组合 (<span class="hljs-keyword">Initial</span> Composition)                                │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1.</span> 执行 Composable 函数                                  │  │
│   │ <span class="hljs-number">2.</span> 填充 Slot <span class="hljs-keyword">Table</span>                                       │  │
│   │ <span class="hljs-number">3.</span> 创建 LayoutNode 树                                    │  │
│   │ <span class="hljs-number">4.</span> 测量、布局、绘制                                       │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   状态变化                                                      │
│                              ↓                                  │
│   重组 (Recomposition)                                          │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1.</span> 检测到 State 变化                                     │  │
│   │ <span class="hljs-number">2.</span> 标记受影响的 Composable 为"过期"                      │  │
│   │ <span class="hljs-number">3.</span> 重新执行过期的 Composable                             │  │
│   │ <span class="hljs-number">4.</span> 对比新旧 Slot <span class="hljs-keyword">Table</span>                                   │  │
│   │ <span class="hljs-number">5.</span> 只更新变化的部分                                      │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   布局与绘制 (Layout <span class="hljs-operator">&amp;</span> Draw)                                    │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1.</span> 测量受影响的节点                                       │  │
│   │ <span class="hljs-number">2.</span> 布局受影响的节点                                       │  │
│   │ <span class="hljs-number">3.</span> 绘制受影响的区域                                       │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-9">1.4 重组的触发机制</h3>
<h4 data-id="heading-10">1.4.1 State 变化如何触发重组？</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// mutableStateOf 的简化实现</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">mutableStateOf</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span>: MutableState&lt;T&gt; =
    SnapshotMutableStateImpl(value)

<span class="hljs-comment">// SnapshotMutableStateImpl 简化版</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnapshotMutableStateImpl</span>&lt;<span class="hljs-type">T</span>&gt;(initial: T) : MutableState&lt;T&gt; {
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
        <span class="hljs-keyword">get</span>() = next.readable(<span class="hljs-keyword">this</span>).value
        <span class="hljs-keyword">set</span>(value) = next.withCurrent {
            <span class="hljs-keyword">if</span> (it.value != value) {
                <span class="hljs-comment">// 1. 创建新的 State 记录</span>
                next = it.newStateRecord(value)
                <span class="hljs-comment">// 2. 通知观察者</span>
                notifyObservers()
            }
        }
}
</code></pre>
<p><strong>触发流程</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">1. 用户点击按钮
        ↓
2. count++ 执行
        ↓
<span class="hljs-attr">3. MutableState.value</span> = newValue
        ↓
4. 创建新的 Snapshot 记录
        ↓
5. 通知所有读取过该 State 的 Composable
        ↓
6. 将这些 Composable 标记为"需要重组"
        ↓
7. 在下一帧，执行重组
</code></pre>
<h4 data-id="heading-11">1.4.2 重组的范围控制</h4>
<p>Compose 会尽量缩小重组的范围：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Parent</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Column {
        <span class="hljs-comment">// 这个 Text 会重组，因为它读取了 count</span>
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
        
        <span class="hljs-comment">// 这个 Button 不会重组，因为它没有读取 count</span>
        Button(onClick = { count++ }) {
            Text(<span class="hljs-string">"Increment"</span>)
        }
        
        <span class="hljs-comment">// Child 会重组吗？取决于它是否读取了 count</span>
        Child(count)
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Child</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-comment">// 如果这里使用了 count，就会重组</span>
    Text(<span class="hljs-string">"Child: <span class="hljs-variable">$count</span>"</span>)
}
</code></pre>
<p><strong>重组范围规则</strong>：</p>
<ul>
<li>只有<strong>读取了变化 State</strong> 的 Composable 才会重组</li>
<li>重组会<strong>向下传播</strong>到所有子 Composable</li>
<li>可以通过<strong>参数传递</strong>控制重组范围</li>
</ul>
<h3 data-id="heading-12">1.5 重组的优化策略</h3>
<h4 data-id="heading-13">1.5.1 @Stable 与 @Immutable</h4>
<p>Compose 使用 <strong>稳定性（Stability）</strong> 来判断对象变化时是否需要重组：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 不稳定类 - 任何变化都会触发重组</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UnstableUser</span> {
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
}

<span class="hljs-comment">// 稳定类 - 只有属性变化时触发重组</span>
<span class="hljs-meta">@Stable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StableUser</span> {
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
}

<span class="hljs-comment">// 不可变类 - 实例替换时触发重组</span>
<span class="hljs-meta">@Immutable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmutableUser</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>
)
</code></pre>
<p><strong>稳定性对比</strong>：</p>

























<table><thead><tr><th>注解</th><th>说明</th><th>触发重组条件</th></tr></thead><tbody><tr><td>无</td><td>不稳定</td><td>任何情况都可能重组</td></tr><tr><td>@Stable</td><td>稳定</td><td>属性变化时重组</td></tr><tr><td>@Immutable</td><td>不可变</td><td>实例替换时重组</td></tr></tbody></table>
<h4 data-id="heading-14">1.5.2 remember 的妙用</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ExpensiveCalculation</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    <span class="hljs-comment">// ❌ 错误：每次重组都重新计算</span>
    <span class="hljs-keyword">val</span> sum = <span class="hljs-keyword">data</span>.sum()
    
    <span class="hljs-comment">// ✅ 正确：只在 data 变化时计算</span>
    <span class="hljs-keyword">val</span> sum = remember(<span class="hljs-keyword">data</span>) { <span class="hljs-keyword">data</span>.sum() }
    
    Text(<span class="hljs-string">"Sum: <span class="hljs-variable">$sum</span>"</span>)
}
</code></pre>
<h4 data-id="heading-15">1.5.3 derivedStateOf：派生状态</h4>
<p>当状态变化频繁，但 UI 不需要每次都更新时，使用 <code>derivedStateOf</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchList</span><span class="hljs-params">(query: <span class="hljs-type">String</span>, items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    <span class="hljs-comment">// ❌ 错误：每次 query 变化都过滤整个列表</span>
    <span class="hljs-keyword">val</span> filtered = items.filter { it.name.contains(query) }
    
    <span class="hljs-comment">// ✅ 正确：只在必要时更新</span>
    <span class="hljs-keyword">val</span> filtered <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            items.filter { it.name.contains(query) }
        }
    }
    
    LazyColumn {
        items(filtered) { item -&gt;
            ItemRow(item)
        }
    }
}
</code></pre>
<p><strong>derivedStateOf 的原理</strong>：</p>
<ul>
<li>内部维护一个缓存值</li>
<li>只有读取时才会重新计算</li>
<li>计算结果变化时才通知观察者</li>
</ul>
<hr/>
<h2 data-id="heading-16">二、remember 与 mutableStateOf 源码解析</h2>
<h3 data-id="heading-17">2.1 remember 的原理</h3>
<p><code>remember</code> 是 Compose 中用于<strong>缓存计算结果</strong>的函数。它的核心作用是：在重组时保持状态不变。</p>
<h4 data-id="heading-18">2.1.1 为什么需要 remember？</h4>
<p>看一个例子：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>  <span class="hljs-comment">// ❌ 错误：每次重组都会重置为 0</span>
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p>每次用户点击按钮，触发重组，<code>count</code> 都会被重新初始化为 0。这是因为我们没有"记住"这个值。</p>
<p><strong>remember 的作用</strong>：在首次组合时计算值，并在后续重组时返回缓存的值。</p>
<h4 data-id="heading-19">2.1.2 remember 的源码实现</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// remember 的简化实现</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">remember</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> keys: <span class="hljs-type">Any</span>?,  <span class="hljs-comment">// 缓存的 key</span>
    calculation: () -&gt; <span class="hljs-type">T</span>  <span class="hljs-comment">// 计算函数</span>
)</span></span>: T {
    <span class="hljs-comment">// 获取当前 Composer</span>
    <span class="hljs-keyword">val</span> composer = currentComposer
    
    <span class="hljs-comment">// 在 Slot Table 中查找缓存</span>
    <span class="hljs-keyword">val</span> slot = composer.nextSlot()
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (slot === Composer.Empty || 
               keys.any { it != composer.rememberedValue() }) {
        <span class="hljs-comment">// 缓存不存在或 key 变化，重新计算</span>
        <span class="hljs-keyword">val</span> value = calculation()
        composer.updateRememberedValue(value)
        value
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 使用缓存</span>
        <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
        slot <span class="hljs-keyword">as</span> T
    }
}
</code></pre>
<p><strong>执行流程</strong>：</p>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────────────────────────────────────┐
│                      remember 执行流程                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  第一次组合                                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ <span class="hljs-number">1</span>. 读取 Slot <span class="hljs-selector-tag">Table</span> → 得到 Composer<span class="hljs-selector-class">.Empty</span>               │   │
│  │ <span class="hljs-number">2</span>. 执行 calculation()                                   │   │
│  │ <span class="hljs-number">3</span>. 将结果写入 Slot <span class="hljs-selector-tag">Table</span>                                │   │
│  │ <span class="hljs-number">4</span>. 返回结果                                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  重组（key 未变化）                                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ <span class="hljs-number">1</span>. 读取 Slot <span class="hljs-selector-tag">Table</span> → 得到缓存值                         │   │
│  │ <span class="hljs-number">2</span>. 对比 keys → 没有变化                                 │   │
│  │ <span class="hljs-number">3</span>. 直接返回缓存值（跳过了 calculation）                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  重组（key 变化）                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ <span class="hljs-number">1</span>. 读取 Slot <span class="hljs-selector-tag">Table</span> → 得到缓存值                         │   │
│  │ <span class="hljs-number">2</span>. 对比 keys → 有变化                                   │   │
│  │ <span class="hljs-number">3</span>. 执行 calculation()                                   │   │
│  │ <span class="hljs-number">4</span>. 更新 Slot <span class="hljs-selector-tag">Table</span>                                      │   │
│  │ <span class="hljs-number">5</span>. 返回新结果                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-20">2.1.3 remember 的多种用法</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 无 key - 永远使用缓存</span>
<span class="hljs-keyword">val</span> value = remember { expensiveCalculation() }

<span class="hljs-comment">// 2. 有 key - key 变化时重新计算</span>
<span class="hljs-keyword">val</span> value = remember(userId) { loadUser(userId) }

<span class="hljs-comment">// 3. 多个 key - 任一 key 变化都重新计算</span>
<span class="hljs-keyword">val</span> value = remember(userId, refreshFlag) { loadUser(userId) }

<span class="hljs-comment">// 4. rememberSaveable - 配置变更后恢复</span>
<span class="hljs-keyword">val</span> value = rememberSaveable { mutableStateOf(<span class="hljs-number">0</span>) }
</code></pre>
<h3 data-id="heading-21">2.2 mutableStateOf 的原理</h3>
<p><code>mutableStateOf</code> 创建了一个<strong>可观察的状态对象</strong>，当值变化时会自动触发重组。</p>
<h4 data-id="heading-22">2.2.1 mutableStateOf 的源码实现</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// mutableStateOf 实现</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">mutableStateOf</span><span class="hljs-params">(
    value: <span class="hljs-type">T</span>,
    policy: <span class="hljs-type">SnapshotMutationPolicy</span>&lt;<span class="hljs-type">T</span>&gt; = structuralEqualityPolicy()</span></span>
): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy)

<span class="hljs-comment">// SnapshotMutableStateImpl 简化版</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnapshotMutableStateImpl</span>&lt;<span class="hljs-type">T</span>&gt;(
    initial: T,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> policy: SnapshotMutationPolicy&lt;T&gt;
) : MutableState&lt;T&gt; {
    
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
        <span class="hljs-keyword">get</span>() = next.readable(<span class="hljs-keyword">this</span>).value
        <span class="hljs-keyword">set</span>(value) = next.withCurrent {
            <span class="hljs-comment">// 使用 policy 判断是否相等</span>
            <span class="hljs-keyword">if</span> (!policy.equivalent(it.value, value)) {
                <span class="hljs-comment">// 创建新的 State 记录</span>
                next = it.newStateRecord(value)
            }
        }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">component1</span><span class="hljs-params">()</span></span>: T = value
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">component2</span><span class="hljs-params">()</span></span>: (T) -&gt; <span class="hljs-built_in">Unit</span> = { value = it }
}
</code></pre>
<h4 data-id="heading-23">2.2.2 Snapshot 机制</h4>
<p>Compose 的 State 基于 <strong>Snapshot（快照）</strong> 机制实现：</p>
<pre><code class="hljs language-ini" lang="ini">┌─────────────────────────────────────────────────────────────────┐
│                      Snapshot 机制                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Snapshot 1 (当前)                                             │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  StateRecord 1: <span class="hljs-attr">value</span> = <span class="hljs-string">"A"</span>                             │  │
│   │  StateRecord 2: <span class="hljs-attr">value</span> = <span class="hljs-string">"B"</span>  ← 当前值                   │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   <span class="hljs-attr">value</span> = <span class="hljs-string">"C"</span> (修改)                                            │
│                              ↓                                  │
│   Snapshot 2 (新快照)                                           │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │  StateRecord 1: <span class="hljs-attr">value</span> = <span class="hljs-string">"A"</span>                             │  │
│   │  StateRecord 2: <span class="hljs-attr">value</span> = <span class="hljs-string">"B"</span>                             │  │
│   │  StateRecord 3: <span class="hljs-attr">value</span> = <span class="hljs-string">"C"</span>  ← 新记录                   │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   通知观察者：值从 "B" 变为 "C"                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>Snapshot 的优势</strong>：</p>
<ul>
<li><strong>原子性</strong>：多个 State 的修改要么全部生效，要么全部不生效</li>
<li><strong>一致性</strong>：读取时看到的是一致的快照</li>
<li><strong>可回滚</strong>：可以丢弃未提交的修改</li>
</ul>
<h4 data-id="heading-24">2.2.3 状态比较策略</h4>
<p><code>mutableStateOf</code> 支持三种比较策略：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 结构相等（默认）- 使用 == 比较</span>
<span class="hljs-keyword">val</span> state = mutableStateOf(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))
state.value = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment">// 不会触发重组，因为内容相等</span>

<span class="hljs-comment">// 2. 引用相等 - 使用 === 比较</span>
<span class="hljs-keyword">val</span> state = mutableStateOf(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), policy = referentialEqualityPolicy())
state.value = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment">// 会触发重组，因为是新对象</span>

<span class="hljs-comment">// 3. 永不比较 - 总是认为不同</span>
<span class="hljs-keyword">val</span> state = mutableStateOf(<span class="hljs-number">0</span>, policy = neverEqualPolicy())
state.value = <span class="hljs-number">0</span>  <span class="hljs-comment">// 会触发重组</span>
</code></pre>
<h3 data-id="heading-25">2.3 rememberSaveable 的原理</h3>
<p><code>rememberSaveable</code> 可以在<strong>配置变更</strong>（如屏幕旋转）后恢复状态。</p>
<h4 data-id="heading-26">2.3.1 为什么需要 rememberSaveable？</h4>
<p>看一个场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FormScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    <span class="hljs-keyword">var</span> email <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    
    <span class="hljs-comment">// 用户填写了表单...</span>
    
    <span class="hljs-comment">// 旋转屏幕后，name 和 email 都变成空字符串了！</span>
    <span class="hljs-comment">// 因为 Activity 重建，remember 的缓存丢失了</span>
}
</code></pre>
<p><strong>rememberSaveable 的作用</strong>：将状态保存到 Bundle，配置变更后自动恢复。</p>
<h4 data-id="heading-27">2.3.2 实现原理</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">rememberSaveable</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> inputs: <span class="hljs-type">Any</span>?,
    saver: <span class="hljs-type">Saver</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-keyword">out</span> Any&gt; = autoSaver()</span></span>,
    key: String? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">init</span>: () -&gt; T
): T {
    <span class="hljs-comment">// 组合本地提供的 SaveableStateRegistry</span>
    <span class="hljs-keyword">val</span> registry = LocalSaveableStateRegistry.current
    
    <span class="hljs-comment">// 生成唯一 key</span>
    <span class="hljs-keyword">val</span> finalKey = key ?: rememberSaveableKey()
    
    <span class="hljs-comment">// 尝试从 Bundle 恢复</span>
    <span class="hljs-keyword">val</span> restored = registry?.consumeRestored(finalKey)
    
    <span class="hljs-comment">// 创建或恢复状态</span>
    <span class="hljs-keyword">val</span> value = remember(*inputs) {
        restored?.let { saver.restore(it) } ?: <span class="hljs-keyword">init</span>()
    }
    
    <span class="hljs-comment">// 注册保存回调</span>
    <span class="hljs-keyword">if</span> (registry != <span class="hljs-literal">null</span>) {
        DisposableEffect(registry, finalKey, saver) {
            <span class="hljs-keyword">val</span> entry = registry.registerProvider(finalKey) {
                saver.save(value)
            }
            onDispose { entry.unregister() }
        }
    }
    
    <span class="hljs-keyword">return</span> value
}
</code></pre>
<p><strong>保存与恢复流程</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                  rememberSaveable 流程                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   首次创建                                                       │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. 检查 Bundle 中没有该 key 的保存值                     │  │
│   │ <span class="hljs-number">2</span>. 执行 <span class="hljs-built_in">init</span>() 创建初始值                               │  │
│   │ <span class="hljs-number">3</span>. 注册保存回调到 SaveableStateRegistry                 │  │
│   │ <span class="hljs-number">4</span>. 返回初始值                                           │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   配置变更（如旋转屏幕）                                         │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. Activity 被销毁，触发 onSaveInstanceState            │  │
│   │ <span class="hljs-number">2</span>. SaveableStateRegistry 调用所有注册的保存回调          │  │
│   │ <span class="hljs-number">3</span>. 将值序列化保存到 Bundle                               │  │
│   │ <span class="hljs-number">4</span>. Activity 重建                                         │  │
│   │ <span class="hljs-number">5</span>. 从 Bundle 恢复值                                      │  │
│   │ <span class="hljs-number">6</span>. rememberSaveable 读取恢复的值                         │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-28">2.3.3 自定义 Saver</h4>
<p><strong>什么是 Saver？</strong></p>
<p>Saver 是 rememberSaveable 用来<strong>序列化和反序列化状态</strong>的工具。因为 Bundle 只能存储特定类型的数据，我们需要告诉 Compose 如何将自定义对象转换为 Bundle 可存储的格式。</p>
<p><strong>为什么需要自定义 Saver？</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 假设我们有一个自定义类</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> email: String
)

<span class="hljs-comment">// ❌ 错误：直接 rememberSaveable 会崩溃</span>
<span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> rememberSaveable { mutableStateOf(User(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-string">"zhangsan@example.com"</span>)) }
<span class="hljs-comment">// 崩溃原因：User 类不知道如何保存到 Bundle</span>
</code></pre>
<p><strong>自定义 Saver 示例</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 为自定义类创建 Saver</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> email: String)

<span class="hljs-keyword">val</span> UserSaver = Saver&lt;User, Bundle&gt;(
    <span class="hljs-comment">// save: 将 User 转换为 Bundle</span>
    save = { user -&gt;
        Bundle().apply {
            putInt(<span class="hljs-string">"id"</span>, user.id)
            putString(<span class="hljs-string">"name"</span>, user.name)
            putString(<span class="hljs-string">"email"</span>, user.email)
        }
    },
    <span class="hljs-comment">// restore: 从 Bundle 恢复 User</span>
    restore = { bundle -&gt;
        User(
            id = bundle.getInt(<span class="hljs-string">"id"</span>),
            name = bundle.getString(<span class="hljs-string">"name"</span>) ?: <span class="hljs-string">""</span>,
            email = bundle.getString(<span class="hljs-string">"email"</span>) ?: <span class="hljs-string">""</span>
        )
    }
)

<span class="hljs-comment">// 使用自定义 Saver</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> rememberSaveable(saver = UserSaver) {
        mutableStateOf(User(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-string">"zhangsan@example.com"</span>))
    }
    
    <span class="hljs-comment">// 现在旋转屏幕后，user 的值会被正确恢复</span>
    Text(<span class="hljs-string">"Name: <span class="hljs-subst">${user.name}</span>"</span>)
}
</code></pre>
<p><strong>Saver 生效机制</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                    Saver 生效流程                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  保存时                                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ <span class="hljs-number">1</span>. rememberSaveable 检测到配置变更                       │   │
│  │ <span class="hljs-number">2</span>. 调用 Saver<span class="hljs-selector-class">.save</span>(value)                                │   │
│  │ <span class="hljs-number">3</span>. 返回 Bundle/Parcelable/List 等可序列化类型            │   │
│  │ <span class="hljs-number">4</span>. 系统自动保存到 Activity 的 Bundle                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  恢复时                                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ <span class="hljs-number">1</span>. Activity 重建，从 Bundle 读取保存的数据               │   │
│  │ <span class="hljs-number">2</span>. rememberSaveable 调用 Saver<span class="hljs-selector-class">.restore</span>(savedData)        │   │
│  │ <span class="hljs-number">3</span>. 返回恢复后的对象                                        │   │
│  │ <span class="hljs-number">4</span>. 赋值给状态变量                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>适合使用自定义 Saver 的场景</strong>：</p>
<ol>
<li><strong>表单数据</strong>：用户填写的表单，旋转屏幕后需要保留</li>
<li><strong>滚动位置</strong>：列表的滚动位置</li>
<li><strong>用户偏好</strong>：当前选中的选项、开关状态</li>
<li><strong>临时数据</strong>：未提交的编辑内容</li>
</ol>
<p><strong>不适合使用 Saver 的场景</strong>：</p>
<ol>
<li><strong>大量数据</strong>：Bundle 有大小限制（约 1MB）</li>
<li><strong>敏感数据</strong>：Bundle 数据可以被读取</li>
<li><strong>不需要持久化的数据</strong>：如网络请求结果</li>
</ol>
<hr/>
<h2 data-id="heading-29">三、状态提升（State Hoisting）设计模式</h2>
<h3 data-id="heading-30">3.1 什么是状态提升？</h3>
<p><strong>状态提升</strong>是 Compose 推荐的状态管理模式：将状态从子组件"提升"到父组件，子组件通过参数接收状态，通过回调通知状态变化。</p>
<p><strong>为什么叫"提升"？</strong></p>
<p>想象一个组件树：</p>
<pre><code class="hljs">Parent
├── ChildA
│   └── GrandChild
└── ChildB
</code></pre>
<p>如果 <code>GrandChild</code> 需要修改状态，而这个状态需要影响 <code>ChildB</code>，那么状态就需要"提升"到它们的共同祖先 <code>Parent</code>。</p>
<h3 data-id="heading-31">3.2 状态提升的设计原则</h3>
<p><strong>单一数据源</strong>：状态只在一个地方定义
<strong>状态向下流动</strong>：通过参数传递给子组件
<strong>事件向上传递</strong>：通过回调通知父组件修改状态</p>
<h3 data-id="heading-32">3.3 状态提升的示例</h3>
<h4 data-id="heading-33">3.3.1 无状态提升（问题代码）</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 错误：状态分散在各个组件中</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CounterScreen</span><span class="hljs-params">()</span></span> {
    Column {
        Counter()  <span class="hljs-comment">// 每个 Counter 有自己的状态</span>
        Counter()
        Counter()
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }  <span class="hljs-comment">// 状态在子组件中</span>
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p><strong>问题</strong>：</p>
<ul>
<li>无法同步多个 Counter 的状态</li>
<li>父组件无法获取/修改子组件的状态</li>
<li>状态分散，难以管理</li>
</ul>
<h4 data-id="heading-34">3.3.2 有状态提升（正确代码）</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 正确：状态提升到父组件</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CounterScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> counts <span class="hljs-keyword">by</span> remember { mutableStateOf(List(<span class="hljs-number">3</span>) { <span class="hljs-number">0</span> }) }
    
    Column {
        counts.forEachIndexed { index, count -&gt;
            Counter(
                count = count,
                onIncrement = {
                    counts = counts.toMutableList().apply {
                        <span class="hljs-keyword">this</span>[index]++
                    }
                }
            )
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">(
    count: <span class="hljs-type">Int</span>,                    <span class="hljs-comment">// 状态通过参数传入</span>
    onIncrement: () -&gt; <span class="hljs-type">Unit</span>        <span class="hljs-comment">// 事件通过回调传出</span>
)</span></span> {
    Button(onClick = onIncrement) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>状态集中管理</li>
<li>子组件可复用</li>
<li>易于测试</li>
</ul>
<h3 data-id="heading-35">3.4 状态提升的设计模式</h3>
<h4 data-id="heading-36">3.4.1 状态容器模式</h4>
<p>对于复杂的状态，可以创建专门的状态容器类：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 状态容器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterState</span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> mutableStateOf(<span class="hljs-number">0</span>)
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span></span> {
        count--
    }
}

<span class="hljs-comment">// 使用 remember 创建状态容器</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">rememberCounterState</span><span class="hljs-params">()</span></span> = remember { CounterState() }

<span class="hljs-comment">// 使用</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CounterScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> state = rememberCounterState()
    
    Counter(
        count = state.count,
        onIncrement = { state.increment() }
    )
}
</code></pre>
<h4 data-id="heading-37">3.4.2 屏幕级状态管理</h4>
<p>对于整个屏幕的状态，可以在屏幕级 Composable 中统一管理：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfileScreen</span><span class="hljs-params">(
    userId: <span class="hljs-type">String</span>,
    viewModel: <span class="hljs-type">UserProfileViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-comment">// 收集 ViewModel 的状态</span>
    <span class="hljs-keyword">val</span> uiState <span class="hljs-keyword">by</span> viewModel.uiState.collectAsState()
    
    <span class="hljs-comment">// 屏幕级状态管理</span>
    <span class="hljs-keyword">var</span> isEditing <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">var</span> editedName <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    
    <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> state = uiState) {
        <span class="hljs-keyword">is</span> UiState.Loading -&gt; LoadingScreen()
        <span class="hljs-keyword">is</span> UiState.Error -&gt; ErrorScreen(state.message)
        <span class="hljs-keyword">is</span> UiState.Success -&gt; {
            UserProfileContent(
                user = state.<span class="hljs-keyword">data</span>,
                isEditing = isEditing,
                editedName = editedName,
                onEditClick = { 
                    isEditing = <span class="hljs-literal">true</span>
                    editedName = state.<span class="hljs-keyword">data</span>.name
                },
                onNameChange = { editedName = it },
                onSaveClick = {
                    viewModel.updateName(editedName)
                    isEditing = <span class="hljs-literal">false</span>
                }
            )
        }
    }
}
</code></pre>
<h3 data-id="heading-38">3.5 状态提升的边界</h3>
<p>不是所有状态都需要提升，需要根据场景判断：</p>





















<table><thead><tr><th>状态位置</th><th>适用场景</th></tr></thead><tbody><tr><td>子组件内部</td><td>纯 UI 状态（如动画状态、滚动位置）</td></tr><tr><td>父组件</td><td>需要共享的状态、需要持久化的状态</td></tr><tr><td>ViewModel</td><td>业务逻辑状态、需要跨屏幕共享的状态</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-39">四、ViewModel 与 Compose 最佳实践</h2>
<h3 data-id="heading-40">4.1 ViewModel 的作用</h3>
<p>ViewModel 是 Android 架构组件，用于：</p>
<ul>
<li><strong>保存配置变更后的状态</strong></li>
<li><strong>管理业务逻辑</strong></li>
<li><strong>作为 UI 层和数据层的桥梁</strong></li>
</ul>
<h3 data-id="heading-41">4.2 ViewModel 与 Compose 的集成</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewModel 定义</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {
    
    <span class="hljs-comment">// 使用 StateFlow 管理状态</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow&lt;UiState&lt;User&gt;&gt;(UiState.Loading)
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;UiState&lt;User&gt;&gt; = _uiState.asStateFlow()
    
    <span class="hljs-keyword">init</span> {
        loadUser()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _uiState.value = UiState.Loading
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser()
                _uiState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.value = UiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span> {
        loadUser()
    }
}

<span class="hljs-comment">// Composable 中使用</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserScreen</span><span class="hljs-params">(
    viewModel: <span class="hljs-type">UserViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-keyword">val</span> uiState <span class="hljs-keyword">by</span> viewModel.uiState.collectAsState()
    
    <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> state = uiState) {
        <span class="hljs-keyword">is</span> UiState.Loading -&gt; LoadingScreen()
        <span class="hljs-keyword">is</span> UiState.Error -&gt; ErrorScreen(
            message = state.message,
            onRetry = { viewModel.refresh() }
        )
        <span class="hljs-keyword">is</span> UiState.Success -&gt; UserContent(user = state.<span class="hljs-keyword">data</span>)
    }
}
</code></pre>
<h3 data-id="heading-42">4.3 StateFlow vs LiveData</h3>
<p>在 Compose 中，推荐使用 <strong>StateFlow</strong>：</p>






























<table><thead><tr><th>特性</th><th>StateFlow</th><th>LiveData</th></tr></thead><tbody><tr><td>生命周期感知</td><td>需要配合 <code>collectAsState</code></td><td>自动感知</td></tr><tr><td>初始值</td><td>必须有</td><td>可以没有</td></tr><tr><td>线程安全</td><td>是</td><td>是</td></tr><tr><td>与 Compose 集成</td><td>更自然</td><td>需要额外转换</td></tr></tbody></table>
<h3 data-id="heading-43">4.4 UI 状态设计最佳实践</h3>
<h4 data-id="heading-44">4.4.1 单一状态类</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 推荐：使用单一状态类</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserUiState</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Loading : UserUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-keyword">val</span> user: User) : UserUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UserUiState
}

<span class="hljs-comment">// ❌ 不推荐：分散的状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">val</span> isLoading = MutableStateFlow(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">val</span> user = MutableStateFlow&lt;User?&gt;(<span class="hljs-literal">null</span>)
    <span class="hljs-keyword">val</span> error = MutableStateFlow&lt;String?&gt;(<span class="hljs-literal">null</span>)
}
</code></pre>
<h4 data-id="heading-45">4.4.2 不可变状态</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 推荐：状态不可变，通过 copy 更新</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserUiState</span>(
    <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">val</span> user: User? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">val</span> error: String? = <span class="hljs-literal">null</span>
)

<span class="hljs-comment">// ViewModel 中</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow(UserUiState())
<span class="hljs-keyword">val</span> uiState = _uiState.asStateFlow()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    _uiState.update { it.copy(user = user, isLoading = <span class="hljs-literal">false</span>) }
}
</code></pre>
<h3 data-id="heading-46">4.5 ViewModel 的生命周期</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                    ViewModel 生命周期                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Activity/Fragment 创建                                        │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. ViewModel 创建                                       │  │
│   │ <span class="hljs-number">2</span>. 执行 init 块                                         │  │
│   │ <span class="hljs-number">3</span>. 开始收集数据                                          │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   配置变更（旋转屏幕）                                           │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. Activity 销毁                                        │  │
│   │ <span class="hljs-number">2</span>. ViewModel 保留（不销毁）                              │  │
│   │ <span class="hljs-number">3</span>. 新的 Activity 创建                                    │  │
│   │ <span class="hljs-number">4</span>. 获取相同的 ViewModel 实例                             │  │
│   │ <span class="hljs-number">5</span>. 状态保持不变                                          │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   Activity/Fragment 真正销毁                                     │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. <span class="hljs-built_in">onCleared</span>() 被调用                                    │  │
│   │ <span class="hljs-number">2</span>. ViewModel 销毁                                        │  │
│   │ <span class="hljs-number">3</span>. 协程作用域取消                                        │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-47">五、CompositionLocal 深度解析</h2>
<h3 data-id="heading-48">5.1 什么是 CompositionLocal？</h3>
<p><strong>CompositionLocal</strong> 是一种<strong>隐式传参</strong>机制，允许在 Composable 树中向下传递数据，而不需要通过每一层的参数。</p>
<p><strong>为什么需要 CompositionLocal？</strong></p>
<p>想象这样一个场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 不使用 CompositionLocal - 需要层层传递</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">App</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = User(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"admin"</span>)
    ScreenA(user = user)
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ScreenA</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    Header(user = user)
    Content(user = user)
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Header</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    Avatar(user = user)
    UserName(user = user)
}

<span class="hljs-comment">// 每一层都需要传递 user 参数，即使中间层不使用它</span>
</code></pre>
<p>使用 CompositionLocal：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用 CompositionLocal - 隐式传递</span>
<span class="hljs-keyword">val</span> LocalUser = compositionLocalOf&lt;User&gt; { error(<span class="hljs-string">"No user provided"</span>) }

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">App</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = User(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"admin"</span>)
    CompositionLocalProvider(LocalUser provides user) {
        ScreenA()  <span class="hljs-comment">// 不需要传递 user</span>
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ScreenA</span><span class="hljs-params">()</span></span> {
    Header()   <span class="hljs-comment">// 不需要传递 user</span>
    Content()  <span class="hljs-comment">// 不需要传递 user</span>
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Header</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = LocalUser.current  <span class="hljs-comment">// 在需要的地方获取</span>
    Avatar(user = user)
    UserName(user = user)
}
</code></pre>
<h3 data-id="heading-49">5.2 CompositionLocal 的原理</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                  CompositionLocal 原理                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Composable 树                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-built_in">CompositionLocalProvider</span>(LocalColor provides Color.Red) │  │
│   │ ┌─────────────────────────────────────────────────────┐ │  │
│   │ │  <span class="hljs-built_in">Child1</span>()                                          │ │  │
│   │ │   ┌─────────────────────────────────────────────┐  │ │  │
│   │ │   │  <span class="hljs-built_in">Child2</span>()                                  │  │ │  │
│   │ │   │   ┌─────────────────────────────────────┐  │  │ │  │
│   │ │   │   │  LocalColor<span class="hljs-selector-class">.current</span>  <span class="hljs-comment">// 返回 Red   │  │  │ │  │</span>
│   │ │   │   └─────────────────────────────────────┘  │  │ │  │
│   │ │   └─────────────────────────────────────────────┘  │ │  │
│   │ └─────────────────────────────────────────────────────┘ │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   查找规则：                                                      │
│   <span class="hljs-number">1</span>. 从当前节点向上查找                                           │
│   <span class="hljs-number">2</span>. 找到最近的 CompositionLocalProvider                          │
│   <span class="hljs-number">3</span>. 返回对应的值                                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-50">5.3 创建与使用 CompositionLocal</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 创建 CompositionLocal</span>
<span class="hljs-keyword">val</span> LocalUser = compositionLocalOf&lt;User&gt; { error(<span class="hljs-string">"No user provided"</span>) }

<span class="hljs-comment">// 2. 提供值</span>
CompositionLocalProvider(LocalUser provides currentUser) {
    UserProfile()  <span class="hljs-comment">// 及其子组件都可以通过 LocalUser.current 获取</span>
}

<span class="hljs-comment">// 3. 使用值</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfile</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = LocalUser.current
    Text(<span class="hljs-string">"Hello, <span class="hljs-subst">${user.name}</span>"</span>)
}
</code></pre>
<h3 data-id="heading-51">5.4 compositionLocalOf vs staticCompositionLocalOf</h3>




















<table><thead><tr><th>函数</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td><code>compositionLocalOf</code></td><td>值变化时，只重组读取该值的组件</td><td>频繁变化的值</td></tr><tr><td><code>staticCompositionLocalOf</code></td><td>值变化时，重组整个子树</td><td>很少变化的值</td></tr></tbody></table>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 主题颜色 - 很少变化</span>
<span class="hljs-keyword">val</span> LocalColors = staticCompositionLocalOf { LightColorScheme }

<span class="hljs-comment">// 滚动状态 - 频繁变化</span>
<span class="hljs-keyword">val</span> LocalScrollState = compositionLocalOf { ScrollState(<span class="hljs-number">0</span>) }
</code></pre>
<h3 data-id="heading-52">5.5 MaterialTheme 的实现</h3>
<p>MaterialTheme 就是基于 CompositionLocal 实现的：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MaterialTheme</span><span class="hljs-params">(
    colorScheme: <span class="hljs-type">ColorScheme</span> = MaterialTheme.colorScheme,
    typography: <span class="hljs-type">Typography</span> = MaterialTheme.typography,
    shapes: <span class="hljs-type">Shapes</span> = MaterialTheme.shapes,
    content: @<span class="hljs-type">Composable</span> () -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">val</span> rememberedColorScheme = remember { colorScheme }
    <span class="hljs-keyword">val</span> rememberedTypography = remember { typography }
    <span class="hljs-keyword">val</span> rememberedShapes = remember { shapes }
    
    CompositionLocalProvider(
        LocalColorScheme provides rememberedColorScheme,
        LocalTypography provides rememberedTypography,
        LocalShapes provides rememberedShapes
    ) {
        content()
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MyComponent</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> colorScheme = MaterialTheme.colorScheme
    <span class="hljs-keyword">val</span> typography = MaterialTheme.typography
    
    Text(
        text = <span class="hljs-string">"Hello"</span>,
        color = colorScheme.primary,
        style = typography.bodyLarge
    )
}
</code></pre>
<h3 data-id="heading-53">5.6 CompositionLocal 的最佳实践</h3>
<h4 data-id="heading-54">✅ 推荐使用</h4>
<ul>
<li>主题配置（颜色、字体、形状）</li>
<li>上下文信息（屏幕类型、权限状态）</li>
<li>全局服务（Navigator、Analytics）</li>
</ul>
<h4 data-id="heading-55">❌ 避免使用</h4>
<ul>
<li>频繁变化的数据（使用参数传递）</li>
<li>业务逻辑状态（使用 ViewModel）</li>
<li>可能导致隐式依赖，降低代码可读性</li>
</ul>
<hr/>
<h2 data-id="heading-56">六、副作用 API 详解</h2>
<h3 data-id="heading-57">6.1 什么是副作用？</h3>
<p><strong>副作用</strong>是指 Composable 函数对外部世界的影响，如：</p>
<ul>
<li>网络请求</li>
<li>数据库操作</li>
<li>订阅事件</li>
<li>修改共享状态</li>
</ul>
<p>Compose 是纯函数式的，Composable 不应该有副作用。但应用开发离不开副作用，因此 Compose 提供了专门的 API 来处理副作用。</p>
<h3 data-id="heading-58">6.2 LaunchedEffect：在组合中启动协程</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfile</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;User?&gt;(<span class="hljs-literal">null</span>) }
    
    <span class="hljs-comment">// 在组合时启动协程</span>
    LaunchedEffect(userId) {
        <span class="hljs-comment">// 这里的代码在协程中执行</span>
        user = api.getUser(userId)
    }
    
    user?.let {
        Text(<span class="hljs-string">"Name: <span class="hljs-subst">${it.name}</span>"</span>)
    }
}
</code></pre>
<p><strong>LaunchedEffect 的特点</strong>：</p>
<ul>
<li>在组合时启动协程</li>
<li>key 变化时，取消旧协程，启动新协程</li>
<li>重组时不会重新启动</li>
</ul>
<pre><code class="hljs language-vbnet" lang="vbnet">┌─────────────────────────────────────────────────────────────────┐
│                   LaunchedEffect 生命周期                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   首次组合                                                       │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. LaunchedEffect 进入组合                              │  │
│   │ <span class="hljs-number">2</span>. 启动协程，执行副作用代码                              │  │
│   │ <span class="hljs-number">3</span>. 协程持续运行...                                       │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   重组（<span class="hljs-keyword">key</span> 未变化）                                             │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. LaunchedEffect 重组                                  │  │
│   │ <span class="hljs-number">2</span>. <span class="hljs-keyword">key</span> 相同，协程继续运行                                │  │
│   │ <span class="hljs-number">3</span>. 不执行副作用代码                                      │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   重组（<span class="hljs-keyword">key</span> 变化）                                               │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. 取消旧协程                                           │  │
│   │ <span class="hljs-number">2</span>. 启动新协程                                           │  │
│   │ <span class="hljs-number">3</span>. 执行新的副作用代码                                    │  │
│   └─────────────────────────────────────────────────────────┘  │
│                              ↓                                  │
│   退出组合                                                       │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │ <span class="hljs-number">1</span>. LaunchedEffect 退出组合                              │  │
│   │ <span class="hljs-number">2</span>. 取消协程                                             │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-59">6.3 SideEffect：每次重组都执行</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">AnalyticsScreen</span><span class="hljs-params">(screenName: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-comment">// 每次重组都执行</span>
    SideEffect {
        analytics.logScreenView(screenName)
    }
    
    <span class="hljs-comment">// UI 内容</span>
    Text(<span class="hljs-string">"Screen: <span class="hljs-variable">$screenName</span>"</span>)
}
</code></pre>
<p><strong>使用场景</strong>：需要确保副作用在每次成功重组后都执行。</p>
<h3 data-id="heading-60">6.4 DisposableEffect：需要清理的副作用</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BackHandler</span><span class="hljs-params">(onBack: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-keyword">val</span> dispatcher = LocalOnBackPressedDispatcherOwner.current?.onBackPressedDispatcher
    
    DisposableEffect(dispatcher) {
        <span class="hljs-comment">// 设置回调</span>
        <span class="hljs-keyword">val</span> callback = <span class="hljs-keyword">object</span> : OnBackPressedCallback(<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleOnBackPressed</span><span class="hljs-params">()</span></span> {
                onBack()
            }
        }
        dispatcher?.addCallback(callback)
        
        <span class="hljs-comment">// 返回清理函数</span>
        onDispose {
            callback.remove()
        }
    }
}
</code></pre>
<p><strong>DisposableEffect 的特点</strong>：</p>
<ul>
<li>key 变化时，先执行 onDispose，再执行新的副作用</li>
<li>退出组合时，执行 onDispose</li>
</ul>
<h3 data-id="heading-61">6.5 rememberCoroutineScope：在回调中启动协程</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserList</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()
    <span class="hljs-keyword">var</span> users <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;List&lt;User&gt;&gt;(emptyList()) }
    
    Button(onClick = {
        <span class="hljs-comment">// 在回调中启动协程</span>
        scope.launch {
            users = api.getUsers()
        }
    }) {
        Text(<span class="hljs-string">"Load Users"</span>)
    }
    
    <span class="hljs-comment">// 显示用户列表</span>
    LazyColumn {
        items(users) { user -&gt;
            Text(user.name)
        }
    }
}
</code></pre>
<p><strong>与 LaunchedEffect 的区别</strong>：</p>
<ul>
<li><code>LaunchedEffect</code>：在组合时自动启动</li>
<li><code>rememberCoroutineScope</code>：提供 CoroutineScope，在回调中手动启动</li>
</ul>
<h3 data-id="heading-62">6.6 rememberUpdatedState：获取最新值</h3>
<p>当需要在长时间运行的副作用中获取最新状态时，使用 <code>rememberUpdatedState</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Timer</span><span class="hljs-params">(
    onTick: () -&gt; <span class="hljs-type">Unit</span>,
    interval: <span class="hljs-type">Long</span> = <span class="hljs-number">1000</span>L
)</span></span> {
    <span class="hljs-comment">// 使用 rememberUpdatedState 获取最新的 onTick</span>
    <span class="hljs-keyword">val</span> currentOnTick <span class="hljs-keyword">by</span> rememberUpdatedState(onTick)
    
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            delay(interval)
            currentOnTick()  <span class="hljs-comment">// 总是调用最新的 onTick</span>
        }
    }
}
</code></pre>
<p><strong>为什么需要 rememberUpdatedState？</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 错误：LaunchedEffect 捕获的是旧的 onTick</span>
LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        delay(<span class="hljs-number">1000</span>)
        onTick()  <span class="hljs-comment">// 总是调用第一次传入的 onTick</span>
    }
}

<span class="hljs-comment">// ✅ 正确：使用 rememberUpdatedState</span>
<span class="hljs-keyword">val</span> currentOnTick <span class="hljs-keyword">by</span> rememberUpdatedState(onTick)
LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        delay(<span class="hljs-number">1000</span>)
        currentOnTick()  <span class="hljs-comment">// 总是调用最新的 onTick</span>
    }
}
</code></pre>
<h3 data-id="heading-63">6.7 DerivedState：派生状态</h3>
<p>当需要基于其他状态计算派生状态时，使用 <code>derivedStateOf</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchResults</span><span class="hljs-params">(query: <span class="hljs-type">String</span>, items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    <span class="hljs-comment">// 只在必要时重新计算</span>
    <span class="hljs-keyword">val</span> filteredItems <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            items.filter { it.name.contains(query, ignoreCase = <span class="hljs-literal">true</span>) }
        }
    }
    
    LazyColumn {
        items(filteredItems) { item -&gt;
            ItemRow(item)
        }
    }
}
</code></pre>
<p><strong>derivedStateOf vs remember</strong>：</p>




















<table><thead><tr><th>特性</th><th>derivedStateOf</th><th>remember</th></tr></thead><tbody><tr><td>触发条件</td><td>读取时</td><td>依赖变化时</td></tr><tr><td>适用场景</td><td>频繁读取、计算成本高</td><td>一次性计算</td></tr></tbody></table>
<h3 data-id="heading-64">6.8 produceState：将非 Compose 状态转换为 State</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: State&lt;User?&gt; {
    <span class="hljs-keyword">return</span> produceState&lt;User?&gt;(initialValue = <span class="hljs-literal">null</span>, userId) {
        value = api.getUser(userId)
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfile</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> user <span class="hljs-keyword">by</span> loadUser(userId)
    
    user?.let {
        Text(<span class="hljs-string">"Name: <span class="hljs-subst">${it.name}</span>"</span>)
    }
}
</code></pre>
<h3 data-id="heading-65">6.9 snapshotFlow：将 State 转换为 Flow</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> query <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    
    <span class="hljs-comment">// 将 State 转换为 Flow</span>
    <span class="hljs-keyword">val</span> searchResults <span class="hljs-keyword">by</span> remember {
        snapshotFlow { query }
            .debounce(<span class="hljs-number">300</span>)  <span class="hljs-comment">// 防抖</span>
            .flatMapLatest { api.search(it) }
            .collectAsState(initial = emptyList())
    }
    
    Column {
        TextField(
            value = query,
            onValueChange = { query = it }
        )
        
        LazyColumn {
            items(searchResults) { result -&gt;
                Text(result.name)
            }
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-66">七、状态管理架构设计</h2>
<h3 data-id="heading-67">7.1 分层架构</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                      UI Layer (Composable)                      │
│  - 显示数据                                                      │
│  - 处理用户交互                                                  │
│  - 调用 ViewModel 方法                                           │
├─────────────────────────────────────────────────────────────────┤
│                   ViewModel Layer                               │
│  - 管理 UI 状态                                                  │
│  - 处理业务逻辑                                                  │
│  - 调用 Repository 方法                                          │
├─────────────────────────────────────────────────────────────────┤
│                  Repository Layer                               │
│  - 数据聚合                                                      │
│  - 业务规则                                                      │
│  - 选择数据源                                                    │
├─────────────────────────────────────────────────────────────────┤
│                   Data Source Layer                             │
│  - 网络 API (Retrofit)                                          │
│  - 本地数据库 (Room)                                            │
│  - 本地缓存 (DataStore)                                         │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-68">7.2 完整实战：用户列表页面</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ============ Data Layer ============</span>

<span class="hljs-comment">// 数据模型</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> id: String,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> email: String,
    <span class="hljs-keyword">val</span> avatar: String
)

<span class="hljs-comment">// Repository</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt;
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchUsers</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span>: List&lt;User&gt;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepositoryImpl</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: UserApi
) : UserRepository {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt; = api.getUsers()
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchUsers</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span>: List&lt;User&gt; = api.searchUsers(query)
}

<span class="hljs-comment">// ============ ViewModel Layer ============</span>

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsersUiState</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Loading : UsersUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-keyword">val</span> users: List&lt;User&gt;) : UsersUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UsersUiState
}

<span class="hljs-meta">@HiltViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersViewModel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) : ViewModel() {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow&lt;UsersUiState&gt;(UsersUiState.Loading)
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;UsersUiState&gt; = _uiState.asStateFlow()
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _searchQuery = MutableStateFlow(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">val</span> searchQuery: StateFlow&lt;String&gt; = _searchQuery.asStateFlow()
    
    <span class="hljs-comment">// 搜索结果的派生状态</span>
    <span class="hljs-keyword">val</span> searchResults: StateFlow&lt;UsersUiState&gt; = _searchQuery
        .debounce(<span class="hljs-number">300</span>)
        .flatMapLatest { query -&gt;
            <span class="hljs-keyword">if</span> (query.isEmpty()) {
                flowOf(UsersUiState.Success(emptyList()))
            } <span class="hljs-keyword">else</span> {
                flow {
                    emit(UsersUiState.Loading)
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">val</span> users = repository.searchUsers(query)
                        emit(UsersUiState.Success(users))
                    } <span class="hljs-keyword">catch</span> (e: Exception) {
                        emit(UsersUiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>))
                    }
                }
            }
        }
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>),
            initialValue = UsersUiState.Success(emptyList())
        )
    
    <span class="hljs-keyword">init</span> {
        loadUsers()
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUsers</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _uiState.value = UsersUiState.Loading
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> users = repository.getUsers()
                _uiState.value = UsersUiState.Success(users)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.value = UsersUiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSearchQueryChange</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span> {
        _searchQuery.value = query
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span> {
        loadUsers()
    }
}

<span class="hljs-comment">// ============ UI Layer ============</span>

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UsersScreen</span><span class="hljs-params">(
    viewModel: <span class="hljs-type">UsersViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-keyword">val</span> uiState <span class="hljs-keyword">by</span> viewModel.uiState.collectAsState()
    <span class="hljs-keyword">val</span> searchQuery <span class="hljs-keyword">by</span> viewModel.searchQuery.collectAsState()
    <span class="hljs-keyword">val</span> searchResults <span class="hljs-keyword">by</span> viewModel.searchResults.collectAsState()
    
    <span class="hljs-keyword">val</span> isSearching = searchQuery.isNotEmpty()
    <span class="hljs-keyword">val</span> currentState = <span class="hljs-keyword">if</span> (isSearching) searchResults <span class="hljs-keyword">else</span> uiState
    
    UsersContent(
        uiState = currentState,
        searchQuery = searchQuery,
        onSearchQueryChange = viewModel::onSearchQueryChange,
        onRefresh = viewModel::refresh
    )
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UsersContent</span><span class="hljs-params">(
    uiState: <span class="hljs-type">UsersUiState</span>,
    searchQuery: <span class="hljs-type">String</span>,
    onSearchQueryChange: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>,
    onRefresh: () -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    Column(modifier = Modifier.fillMaxSize()) {
        <span class="hljs-comment">// 搜索框</span>
        SearchBar(
            query = searchQuery,
            onQueryChange = onSearchQueryChange
        )
        
        <span class="hljs-comment">// 内容区域</span>
        <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> state = uiState) {
            <span class="hljs-keyword">is</span> UsersUiState.Loading -&gt; LoadingScreen()
            <span class="hljs-keyword">is</span> UsersUiState.Error -&gt; ErrorScreen(
                message = state.message,
                onRetry = onRefresh
            )
            <span class="hljs-keyword">is</span> UsersUiState.Success -&gt; {
                <span class="hljs-keyword">if</span> (state.users.isEmpty()) {
                    EmptyScreen()
                } <span class="hljs-keyword">else</span> {
                    UserList(users = state.users)
                }
            }
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserList</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span> {
    LazyColumn {
        items(users, key = { it.id }) { user -&gt;
            UserItem(user = user)
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserItem</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .padding(horizontal = <span class="hljs-number">16.</span>dp, vertical = <span class="hljs-number">8.</span>dp)
    ) {
        Row(
            modifier = Modifier.padding(<span class="hljs-number">16.</span>dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            AsyncImage(
                model = user.avatar,
                contentDescription = <span class="hljs-literal">null</span>,
                modifier = Modifier
                    .size(<span class="hljs-number">48.</span>dp)
                    .clip(CircleShape)
            )
            
            Spacer(modifier = Modifier.width(<span class="hljs-number">16.</span>dp))
            
            Column {
                Text(
                    text = user.name,
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = user.email,
                    style = MaterialTheme.typography.bodyMedium,
                    color = Color.Gray
                )
            }
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-69">八、本篇小结</h2>
<p>今天我们深入探讨了 Compose 的状态管理系统：</p>
<h3 data-id="heading-70">状态与重组机制</h3>
<ul>
<li>理解了 Slot Table 的数据结构和作用</li>
<li>掌握了重组的触发机制和优化策略</li>
<li>学会了使用 @Stable 和 @Immutable 控制重组</li>
</ul>
<h3 data-id="heading-71">remember 与 mutableStateOf</h3>
<ul>
<li>深入理解了 remember 的缓存原理</li>
<li>掌握了 mutableStateOf 的 Snapshot 机制</li>
<li>学会了 rememberSaveable 的保存与恢复</li>
</ul>
<h3 data-id="heading-72">状态提升</h3>
<ul>
<li>理解了状态提升的设计哲学</li>
<li>掌握了状态容器模式和屏幕级状态管理</li>
</ul>
<h3 data-id="heading-73">ViewModel 与 Compose</h3>
<ul>
<li>学会了 StateFlow 与 Compose 的集成</li>
<li>掌握了 UI 状态设计的最佳实践</li>
</ul>
<h3 data-id="heading-74">CompositionLocal</h3>
<ul>
<li>理解了隐式传参的原理</li>
<li>学会了创建和使用 CompositionLocal</li>
</ul>
<h3 data-id="heading-75">副作用 API</h3>
<ul>
<li>掌握了 LaunchedEffect、DisposableEffect 等副作用 API</li>
<li>理解了不同场景下的选择策略</li>
</ul>
<hr/>
<h2 data-id="heading-76">下篇预告</h2>
<p><strong>第四篇：Material 组件与主题</strong> 将深入讲解：</p>
<ul>
<li>Material Design 3 组件大全</li>
<li>自定义主题与颜色系统</li>
<li>深色模式与动态主题适配</li>
<li>自定义组件的设计思路</li>
</ul>
<p>敬请期待！</p>
<hr/>
<h2 data-id="heading-77">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fcompose%2Fstate" target="_blank" title="https://developer.android.com/jetpack/compose/state" ref="nofollow noopener noreferrer">Compose 状态官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fcompose%2Fside-effects" target="_blank" title="https://developer.android.com/jetpack/compose/side-effects" ref="nofollow noopener noreferrer">Compose 副作用官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%2Fcompose%2F" target="_blank" title="https://android.googlesource.com/platform/frameworks/support/+/androidx-main/compose/" ref="nofollow noopener noreferrer">Compose 源码</a></li>
</ul>
<hr/>
<blockquote>
<p>📌 <strong>系列文章导航</strong></p>
<ul>
<li>第一篇：初识 Compose ✅</li>
<li>第二篇：核心基石 ✅</li>
<li>第三篇：状态管理（当前）✅</li>
<li>第四篇：Material 组件与主题</li>
<li>第五篇：动画与交互</li>
<li>第六篇：架构与工程化</li>
<li>第七篇：高级特性与实战</li>
</ul>
</blockquote>
<hr/>
<p>如果这篇文章对你有帮助，欢迎 <strong>点赞</strong>、<strong>收藏</strong>、<strong>关注</strong>！有任何问题可以在评论区留言。</p>
<p><del>Generated by Kimi K2.5 Agent</del></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建专业命令行工具：解析 Commander 与 Inquirer 的协作之道]]></title>    <link>https://juejin.cn/post/7600344784945381422</link>    <guid>https://juejin.cn/post/7600344784945381422</guid>    <pubDate>2026-01-29T06:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600344784945381422" data-draft-id="7600344784945348654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建专业命令行工具：解析 Commander 与 Inquirer 的协作之道"/> <meta itemprop="keywords" content="后端,前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-29T06:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火车叼位"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建专业命令行工具：解析 Commander 与 Inquirer 的协作之道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火车叼位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T06:23:57.000Z" title="Thu Jan 29 2026 06:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Node.js 生态中，开发一个命令行界面（CLI）工具几乎是每个高级开发者的必经之路。然而，面对 <strong>Commander.js</strong> 和 <strong>Inquirer.js</strong> 这两个顶级库时，很多开发者会产生困惑：“我到底该选哪一个？”</p>
<p>实际上，这种困惑源于对两者定位的重叠性误解。Commander 负责的是**“命令的结构”<strong>，而 Inquirer 负责的是</strong>“互动的体验”**。本文将带你深入底层，看清它们的相同点与本质区别，助你做出最理性的技术选型。</p>
<hr/>
<h2 data-id="heading-0">1. Commander.js：CLI 的骨架与规则</h2>
<h3 data-id="heading-1">1.1 核心定位</h3>
<p>Commander 是一个完整的 Node.js 命令行解决方案。它效仿了 Ruby 的 <code>commander</code>，其核心目标是<strong>解析（Parsing）</strong>。它负责告诉程序：用户在启动时输入了什么指令、带了什么参数、设置了哪些选项。</p>
<h3 data-id="heading-2">1.2 核心功能特性</h3>
<ul>
<li><strong>参数解析</strong>：自动处理 <code>process.argv</code>，支持必填参数 <code>&lt;arg&gt;</code> 和可选参数 <code>[arg]</code>。</li>
<li><strong>选项定义</strong>：支持短选项（<code>-f</code>）和长选项（<code>--force</code>），并自动生成布尔值或参数值。</li>
<li><strong>子命令系统</strong>：通过 <code>.command()</code> 构建类似 <code>git push</code>、<code>git pull</code> 的嵌套结构。</li>
<li><strong>自动文档</strong>：基于定义自动生成 <code>-h, --help</code> 帮助信息。</li>
</ul>
<h3 data-id="heading-3">1.3 代码示例（基于文档）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { program } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);

program
  .<span class="hljs-title function_">name</span>(<span class="hljs-string">'pizza-cli'</span>)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">'订购皮萨的工具'</span>)
  .<span class="hljs-title function_">version</span>(<span class="hljs-string">'1.0.0'</span>);

program
  .<span class="hljs-title function_">option</span>(<span class="hljs-string">'-s, --size &lt;type&gt;'</span>, <span class="hljs-string">'皮萨尺寸'</span>, <span class="hljs-string">'medium'</span>)
  .<span class="hljs-title function_">option</span>(<span class="hljs-string">'-d, --debug'</span>, <span class="hljs-string">'开启调试模式'</span>)
  .<span class="hljs-title function_">action</span>(<span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`您订购了一个 <span class="hljs-subst">${options.size}</span> 尺寸的皮萨。`</span>);
  });

program.<span class="hljs-title function_">parse</span>();
</code></pre>
<hr/>
<h2 data-id="heading-4">2. Inquirer.js：CLI 的血肉与交互</h2>
<h3 data-id="heading-5">2.1 核心定位</h3>
<p>Inquirer 是一个交互式命令行用户界面的集合。它的目标是<strong>引导（Guiding）</strong>。当你的程序需要从用户那里获取非预设的、复杂的信息时，Inquirer 提供了丰富的 UI 组件。</p>
<h3 data-id="heading-6">2.2 核心功能特性</h3>
<ul>
<li><strong>多样化输入</strong>：支持 <code>input</code>（文本）、<code>password</code>（遮罩）、<code>confirm</code>（确认）、<code>select</code>（单选）、<code>checkbox</code>（多选）等。</li>
<li><strong>流式对话</strong>：可以根据上一步的回答动态决定下一步提问的内容。</li>
<li><strong>输入校验</strong>：内置 <code>validate</code> 钩子，实时反馈输入错误。</li>
<li><strong>新版优化</strong>：最新版（<code>@inquirer/prompts</code>）采用了更轻量、性能更高的架构，并支持更灵活的异步操作。</li>
</ul>
<h3 data-id="heading-7">2.3 代码示例（基于文档）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { input, select } <span class="hljs-keyword">from</span> <span class="hljs-string">'@inquirer/prompts'</span>;

<span class="hljs-keyword">const</span> name = <span class="hljs-keyword">await</span> <span class="hljs-title function_">input</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入您的名字'</span> });
<span class="hljs-keyword">const</span> color = <span class="hljs-keyword">await</span> <span class="hljs-title function_">select</span>({
  <span class="hljs-attr">message</span>: <span class="hljs-string">'选择你喜欢的颜色'</span>,
  <span class="hljs-attr">choices</span>: [
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'红色'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'red'</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'蓝色'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'blue'</span> },
  ],
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好 <span class="hljs-subst">${name}</span>，你选择了 <span class="hljs-subst">${color}</span>。`</span>);
</code></pre>
<hr/>
<h2 data-id="heading-8">3. 深度对比：相同点与不同点</h2>
<p>为了辅助选型，我们将两者进行多维度的横向对比：</p>



































<table><thead><tr><th align="left">维度</th><th align="left">Commander.js</th><th align="left">Inquirer.js</th></tr></thead><tbody><tr><td align="left"><strong>交互模式</strong></td><td align="left"><strong>静态/声明式</strong>：用户启动前决定一切</td><td align="left"><strong>动态/交互式</strong>：程序运行中实时问答</td></tr><tr><td align="left"><strong>主要职责</strong></td><td align="left">命令解析、版本管理、帮助信息、子命令调度</td><td align="left">收集用户输入、数据校验、流程引导、UI 呈现</td></tr><tr><td align="left"><strong>自动化支持</strong></td><td align="left"><strong>极佳</strong>：完美支持 CI/CD、脚本自动化调用</td><td align="left"><strong>较差</strong>：通常需要人工干预（除非 Mock 标准输入）</td></tr><tr><td align="left"><strong>学习曲线</strong></td><td align="left">低：主要是声明 API 及其回调</td><td align="left">中：需处理异步流程、逻辑分支和校验</td></tr><tr><td align="left"><strong>用户群体</strong></td><td align="left">高级用户（偏向脚本化、快速指令）</td><td align="left">普通用户（偏向配置向导、初始化工具）</td></tr></tbody></table>
<h3 data-id="heading-9">相同点</h3>
<ol>
<li><strong>基础环境</strong>：两者都运行在 Node.js 环境，均对原生 <code>process.stdin</code> 和 <code>process.stdout</code> 进行了高级封装。</li>
<li><strong>社区标准</strong>：它们都是各自领域的“事实标准”，npm 下载量均为千万级。</li>
<li><strong>扩展性</strong>：都支持自定义扩展，Commander 可以自定义配置 Help 类，Inquirer 可以开发自定义 Prompt 插件。</li>
</ol>
<h3 data-id="heading-10">核心区别</h3>
<ul>
<li><strong>触发时机不同</strong>：Commander 关注的是命令启动那一刻的状态；Inquirer 关注的是启动后与用户的持续对话。</li>
<li><strong>CI/CD 友好度不同</strong>：如果你的工具要在服务器脚本（如 Jenkins）中运行，Commander 是必须的，因为它可以通过 Flag（如 <code>--yes</code>）避开人工干预；而 Inquirer 在这种场景下会阻塞进程。</li>
</ul>
<hr/>
<h2 data-id="heading-11">4. 混合选型策略：1 + 1 &gt; 2</h2>
<p>在现代 CLI 开发中，**“Commander 构建骨架 + Inquirer 填充交互”**是最成熟的方案。</p>
<h3 data-id="heading-12">实践案例：脚手架初始化</h3>
<p>想象你要开发一个类似 <code>vue-cli</code> 的工具：</p>
<ol>
<li><strong>使用 Commander 解析指令</strong>：用户输入 <code>my-cli create my-project</code>。</li>
<li><strong>缺省检测</strong>：如果用户没传参数，或者需要进一步配置，则唤起 <strong>Inquirer</strong>。</li>
<li><strong>交互式问答</strong>：询问“是否使用 TypeScript？”、“是否集成 ESLint？”。</li>
<li><strong>结果合并</strong>：将 Commander 解析的初始参数与 Inquirer 收集的配置合并，最后执行文件创建任务。</li>
</ol>
<hr/>
<h2 data-id="heading-13">5. 结论与行动建议</h2>
<p>针对你的技术选型，我给出以下结论：</p>
<ol>
<li><strong>如果你的工具主要用于自动化脚本、数据处理或拥有大量复杂参数</strong>：请优先确保 <strong>Commander</strong> 的稳健实现。它能让你的工具像 <code>ls</code> 或 <code>git</code> 一样专业且易于集成。</li>
<li><strong>如果你的工具主要面向初级用户，或者涉及复杂的初始化配置（如脚手架、安装向导）</strong>：<strong>Inquirer</strong>（推荐使用新版 <code>@inquirer/prompts</code>）将极大提升用户体验。</li>
<li><strong>行动建议</strong>：
<ul>
<li><strong>立即可做</strong>：定义你的 CLI 核心命令结构，使用 Commander 建立第一个 <code>--help</code>。</li>
<li><strong>中期计划</strong>：识别用户容易输错或难以记忆的复杂参数，将其转化为 Inquirer 的交互式问答流程。</li>
</ul>
</li>
</ol>
<hr/>
<p><strong>参考来源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js" target="_blank" title="https://github.com/SBoudrias/Inquirer.js" ref="nofollow noopener noreferrer">Inquirer.js GitHub Repository</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftj%2Fcommander.js" target="_blank" title="https://github.com/tj/commander.js" ref="nofollow noopener noreferrer">Commander.js GitHub Repository</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1 精通 Redux：从“绕晕”到“真香”的保姆级实战]]></title>    <link>https://juejin.cn/post/7600489282822832178</link>    <guid>https://juejin.cn/post/7600489282822832178</guid>    <pubDate>2026-01-29T05:06:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600489282822832178" data-draft-id="7600508556102811698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1 精通 Redux：从“绕晕”到“真香”的保姆级实战"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-01-29T05:06:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="豆苗学前端"/> <meta itemprop="url" content="https://juejin.cn/user/1935598759719400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1 精通 Redux：从“绕晕”到“真香”的保姆级实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1935598759719400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    豆苗学前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T05:06:18.000Z" title="Thu Jan 29 2026 05:06:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    33
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：为什么你觉得 Redux 绕？</h2>
<p>很多同学在学习 Redux 时，会被 <strong>Action、Reducer、Dispatch、Store</strong> 这一堆名词绕晕。其实，Redux 的本质就是一个**“全店共享的中央账本”**。</p>
<p>在没有 Redux 的时候，组件传值像“传声筒”，父传子、子传孙，层级一深，代码就成了乱麻。而 Redux 让数据脱离了组件树，独立存在。</p>
<p>今天，我们以**“古茗奶茶下单系统”**为例，用最现代的 <strong>Redux Toolkit (RTK)</strong>  方案，完成从零到一的进化。</p>
<hr/>
<h2 data-id="heading-1">第一步：建立心智模型——“古茗店长笔记”</h2>
<p>在动手写代码前，先记住这个映射关系：</p>
<ol>
<li><strong>Store（大账本）</strong> ：古茗店里唯一的中央账本，记录了所有库存和订单。</li>
<li><strong>Slice（部门）</strong> ：账本里的分区。比如“购物车部”、“用户部”。</li>
<li><strong>Action（申请单）</strong> ：你想改账本？必须填申请单。比如“加一杯杨梅冰”。</li>
<li><strong>Reducer（财务主管）</strong> ：唯一有权改账本的人。他看到申请单，亲自划掉旧数字，写上新数字。</li>
<li><strong>Selector（监控器）</strong> ：收银台的屏幕。账本一变，屏幕自动刷新显示。</li>
</ol>
<hr/>
<h2 data-id="heading-2">第二步：环境搭建（起步）</h2>
<p>现在我们不再写老旧的 Redux 模板，直接上 <strong>Redux Toolkit</strong>。</p>
<p>codeBash</p>
<pre><code class="hljs language-bash" lang="bash">npm install @reduxjs/toolkit react-redux
</code></pre>
<hr/>
<h2 data-id="heading-3">第三步：编写业务逻辑切片 (Slice)</h2>
<p>我们要处理购物车业务。新建 src/features/cartSlice.js：</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">'@reduxjs/toolkit'</span>;

<span class="hljs-keyword">const</span> cartSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'cart'</span>, <span class="hljs-comment">// 部门名称</span>
  <span class="hljs-attr">initialState</span>: {
    <span class="hljs-attr">items</span>: [],    <span class="hljs-comment">// 购物车奶茶列表</span>
    <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>      <span class="hljs-comment">// 总金额</span>
  },
  <span class="hljs-attr">reducers</span>: {
    <span class="hljs-comment">// 申请单1：加入购物车</span>
    <span class="hljs-attr">addToCart</span>: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
      <span class="hljs-comment">// action.payload 就是传进来的奶茶：{ name: '杨梅冰', price: 15 }</span>
      state.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(action.<span class="hljs-property">payload</span>);
      state.<span class="hljs-property">total</span> += action.<span class="hljs-property">payload</span>.<span class="hljs-property">price</span>;
    },
    <span class="hljs-comment">// 申请单2：清空购物车</span>
    <span class="hljs-attr">clearCart</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      state.<span class="hljs-property">items</span> = [];
      state.<span class="hljs-property">total</span> = <span class="hljs-number">0</span>;
    }
  }
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> { addToCart, clearCart } = cartSlice.<span class="hljs-property">actions</span>; <span class="hljs-comment">// 导出申请单</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> cartSlice.<span class="hljs-property">reducer</span>; <span class="hljs-comment">// 导出财务主管</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">第四步：配置中央仓库 (Store)</h2>
<p>新建 src/app/store.js，把各部门主管集合起来：</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { configureStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@reduxjs/toolkit'</span>;
<span class="hljs-keyword">import</span> cartReducer <span class="hljs-keyword">from</span> <span class="hljs-string">'../features/cartSlice'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">configureStore</span>({
  <span class="hljs-attr">reducer</span>: {
    <span class="hljs-attr">cart</span>: cartReducer, <span class="hljs-comment">// 注册购物车部门</span>
    <span class="hljs-comment">// user: userReducer, 以后有用户部门再往这加</span>
  }
});
</code></pre>
<hr/>
<h2 data-id="heading-5">第五步：全局注入</h2>
<p>在入口文件 main.jsx 中，用  把账本发给全店：</p>
<p>codeJsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Provider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;
<span class="hljs-keyword">import</span> { store } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app/store'</span>;

<span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)).<span class="hljs-title function_">render</span>(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>
);
</code></pre>
<hr/>
<h2 data-id="heading-6">第六步：在组件中使用（实战演练）</h2>
<h3 data-id="heading-7">1. 提交申请单（Dispatching Actions）</h3>
<p>在 Menu.jsx（菜单页），点击按钮加奶茶：</p>
<p>codeJsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useDispatch } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;
<span class="hljs-keyword">import</span> { addToCart } <span class="hljs-keyword">from</span> <span class="hljs-string">'./features/cartSlice'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Menu</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>(); <span class="hljs-comment">// 拿到那个“发单机”</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch(addToCart({ name: '杨梅冰', price: 15 }))}&gt;
      点一杯杨梅冰
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-8">2. 查看屏幕显示（Selecting State）</h3>
<p>在 Header.jsx（页眉），实时显示金额：</p>
<p>codeJsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 盯着账本里的 cart 部分看</span>
  <span class="hljs-keyword">const</span> { total, items } = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">cart</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>购物车数量：{items.length}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>总金额：￥{total}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h2 data-id="heading-9">第七步：进阶——处理异步业务 (Async Thunk)</h2>
<p>现实中，我们要领优惠券，需要等接口返回。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在 cartSlice.js 中添加</span>
<span class="hljs-keyword">import</span> { createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">'@reduxjs/toolkit'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchCoupon = <span class="hljs-title function_">createAsyncThunk</span>(<span class="hljs-string">'cart/fetchCoupon'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/get-coupon'</span>);
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">// 返回 { discount: 5 }</span>
});

<span class="hljs-comment">// 在 createSlice 的 extraReducers 中监听</span>
<span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
  builder.<span class="hljs-title function_">addCase</span>(fetchCoupon.<span class="hljs-property">fulfilled</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
    state.<span class="hljs-property">total</span> -= action.<span class="hljs-property">payload</span>.<span class="hljs-property">discount</span>; <span class="hljs-comment">// 领券成功，减钱！</span>
  });
}
</code></pre>
<hr/>
<h2 data-id="heading-10">总结：精通 Redux 的三字经</h2>
<ol>
<li><strong>分 (Slice)</strong> ：按业务拆分模块，别把所有东西塞一起。</li>
<li><strong>选 (Selector)</strong> ：组件只拿自己需要的那一小块数据，避免无效渲染。</li>
<li><strong>单 (Dispatch)</strong> ：改数据必须发 Action，不要在组件里直接改 State。</li>
</ol>
<h3 data-id="heading-11">什么时候用 Redux？</h3>
<ul>
<li><strong>跨页面共享</strong>：用户信息、购物车、全局主题。</li>
<li><strong>频繁变动</strong>：多处组件依赖同一个数据源。</li>
<li><strong>本地缓存</strong>：比如电视机播放白屏优化中的“离线资源列表”。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openspec工作流解析：proposal、spec、tasks的明确分工与协作]]></title>    <link>https://juejin.cn/post/7600298554871726086</link>    <guid>https://juejin.cn/post/7600298554871726086</guid>    <pubDate>2026-01-29T01:18:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600298554871726086" data-draft-id="7600326291552403462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openspec工作流解析：proposal、spec、tasks的明确分工与协作"/> <meta itemprop="keywords" content="前端,后端,架构"/> <meta itemprop="datePublished" content="2026-01-29T01:18:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火车叼位"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openspec工作流解析：proposal、spec、tasks的明确分工与协作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火车叼位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T01:18:46.000Z" title="Thu Jan 29 2026 01:18:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>OpenSpec</strong> 是一个专为 AI 编码助手设计的规范驱动开发系统，旨在编写代码之前建立人与 AI 之间的对齐。通过在实现之前锁定意图，OpenSpec 提供了确定性、可审查的输出，而无需 API 密钥。</p>
<p>OpenSpec 引入了一个轻量级的规范工作流，改变了你与 AI 编码助手的协作方式。它不再依赖聊天历史记录来获取需求，而是创建了一个明确的结构化契约，供人类和 AI 工具持续参考。这种方法确保提案、任务和规范更新在整个开发生命周期中保持可见、可审计和明确。</p>
<p>该系统通过原生斜杠命令或 AGENTS.md 约定支持 20 多种 AI 工具，使其既灵活地集成到你现有的工作流中，又能提供足够的结构以在复杂的多文件更改中保持一致性。</p>
<hr/>
<h2 data-id="heading-0">三者定位：OpenSpec工具中的角色</h2>
<p><strong>在OpenSpec工具中，这三份文档具有明确的定位：</strong></p>
<ul>
<li><strong><code>proposal.md</code></strong> = 变更提案文档（为什么改、改什么、影响范围）</li>
<li><strong><code>spec.md</code></strong> = 规格定义文档（系统最终应该怎么工作）</li>
<li><strong><code>tasks.md</code></strong> = 任务执行清单（具体怎么完成、进度跟踪）</li>
</ul>
<p><strong>它们在OpenSpec工作流中的主次关系：</strong></p>
<ol>
<li>
<p><strong><code>proposal.md</code> 是决策起点</strong>：在使用OpenSpec管理变更时，任何改动都从创建proposal.md开始。它阐述变更的理由（Why）、概述内容（What）、明确影响范围（Impact）。这份文档是团队讨论是否接受该变更的决策依据，通常篇幅较短。</p>
</li>
<li>
<p><strong><code>spec.md</code> 定义验收标准</strong>：当proposal被接受后，需要编写spec.md来详细定义系统行为的规格说明。在OpenSpec中，spec通常采用BDD风格（WHEN/THEN）来定义需求和场景，它是验收的黄金标准，也是篇幅最长的文档。</p>
</li>
<li>
<p><strong><code>tasks.md</code> 指导具体执行</strong>：基于proposal的目标和spec的规格，tasks.md将变更拆解为可执行、可跟踪的任务列表，每个任务都带有checkbox。在OpenSpec工作流中，开发者按照tasks.md一步步完成，并打钩标记进度。</p>
</li>
</ol>
<p><strong>核心区别可以概括为：</strong></p>
<ul>
<li><strong>Proposal</strong> 回答"<strong>为什么要做这个变更</strong>"</li>
<li><strong>Spec</strong> 回答"<strong>变更后系统应该是什么样</strong>"</li>
<li><strong>Tasks</strong> 回答"<strong>如何一步步完成这个变更</strong>"</li>
</ul>
<h2 data-id="heading-1">OpenSpec工作流中的可视化关系</h2>
<p>为了更直观地理解它们在OpenSpec工具中的协作关系，我们可以用图表来描述。</p>
<p><strong>结构关系图</strong>展示了文档间的产出与参照关系：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[proposal.md&lt;br/&gt;变更提案] --&gt;|产出| B[spec.md&lt;br/&gt;规格定义]
    A --&gt;|分解为| C[tasks.md&lt;br/&gt;任务清单]
    B -.参照.-&gt; C
    
    classDef proposal fill:#e1f5ff,stroke:#0366d6,stroke-width:2px
    classDef spec fill:#fff5e1,stroke:#d73a49,stroke-width:2px
    classDef tasks fill:#e1ffe1,stroke:#22863a,stroke-width:2px
</code></pre>
<p><em>图表说明：在OpenSpec中，proposal.md是变更的起点，产出spec.md（定义验收标准）并分解为tasks.md（执行清单）。tasks在执行过程中会参照spec的验收标准。</em></p>
<p><strong>时序图</strong>展示了OpenSpec工作流中的时间顺序：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Dev as 开发者
    participant P as proposal.md
    participant S as spec.md
    participant T as tasks.md
    participant Code as 代码实现

    Dev-&gt;&gt;P: 1. 创建变更提案&lt;br/&gt;(Why/What/Impact)
    Note over P: 团队决策：是否接受变更？
    
    Dev-&gt;&gt;S: 2. 编写规格说明&lt;br/&gt;(WHEN/THEN 场景)
    Note over S: 定义验收标准
    
    Dev-&gt;&gt;T: 3. 分解任务清单&lt;br/&gt;(可执行步骤)
    Note over T: 规划实施路径
    
    loop 迭代开发
        Dev-&gt;&gt;Code: 4. 实现代码
        Code--&gt;&gt;T: 完成任务打钩 [x]
        Code--&gt;&gt;S: 满足规格场景
    end
    
    Note over Dev,Code: 所有 tasks 完成 + spec 通过验证&lt;br/&gt;→ 准备归档
</code></pre>
<p><em>图表说明：OpenSpec工作流始于变更提案决策，经过规格定义和任务规划，进入迭代开发，最终以完成所有任务并满足规格为结束标志，准备归档。</em></p>
<h2 data-id="heading-2">OpenSpec工作流的关键阶段</h2>
<p>在使用OpenSpec工具管理变更时，整个流程可以分为五个清晰的阶段：</p>
<ol>
<li><strong>提案阶段</strong>：在OpenSpec的changes目录下创建proposal.md，阐述变更理由，团队讨论并决定是否接受该变更。</li>
<li><strong>设计阶段</strong>：编写spec.md，明确变更后系统行为的详细契约和验收标准。这是OpenSpec强调的"设计先行"原则。</li>
<li><strong>规划阶段</strong>：编写tasks.md，将变更拆解为具体、可执行的任务项，每个任务都带有checkbox。</li>
<li><strong>开发阶段</strong>：按照tasks.md进行编码，并持续对照spec.md进行验证，完成一项打钩一项。OpenSpec鼓励"小步快跑"的迭代方式。</li>
<li><strong>归档阶段</strong>：当所有tasks完成且spec通过验证后，将整个变更文档从changes目录移至archive/目录，标志变更完结。</li>
</ol>
<h2 data-id="heading-3">实际案例：add-feedback-command</h2>
<p>以OpenSpec项目本身的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenspec%2Fopenspec%2Ftree%2Fmain%2Fchanges%2Fadd-feedback-command%25E5%258F%2598%25E6%259B%25B4%25E4%25B8%25BA%25E4%25BE%258B%25EF%25BC%258C%25E5%258F%25AF%25E4%25BB%25A5%25E6%25B8%2585%25E6%2599%25B0%25E5%259C%25B0%25E7%259C%258B%25E5%2588%25B0%25E4%25B8%2589%25E8%2580%2585%25E5%259C%25A8OpenSpec%25E5%25B7%25A5%25E5%2585%25B7%25E4%25B8%25AD%25E7%259A%2584%25E5%25AE%259E%25E9%2599%2585%25E5%25BA%2594%25E7%2594%25A8%25EF%25BC%259A" target="_blank" title="https://github.com/openspec/openspec/tree/main/changes/add-feedback-command%E5%8F%98%E6%9B%B4%E4%B8%BA%E4%BE%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%B8%85%E6%99%B0%E5%9C%B0%E7%9C%8B%E5%88%B0%E4%B8%89%E8%80%85%E5%9C%A8OpenSpec%E5%B7%A5%E5%85%B7%E4%B8%AD%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%EF%BC%9A" ref="nofollow noopener noreferrer">github.com/openspec/op…</a></p>





























<table><thead><tr><th align="left">文件</th><th align="left">核心内容</th><th align="left">行数（约）</th><th align="left">在OpenSpec中的作用</th></tr></thead><tbody><tr><td align="left"><code>proposal.md</code></td><td align="left"><strong>Why</strong>: 需要收集用户反馈<br/><strong>What</strong>: 添加 <code>openspec feedback</code> 命令<br/><strong>Impact</strong>: 新增CLI命令、依赖 <code>gh</code> CLI</td><td align="left">21 行</td><td align="left"><strong>变更决策依据</strong>，说明变更必要性和范围</td></tr><tr><td align="left"><code>spec.md</code></td><td align="left">6个主要需求、20+个具体场景<br/>详细定义命令行为、错误处理、跨平台兼容性</td><td align="left">189 行</td><td align="left"><strong>验收标准定义</strong>，详细定义"正确"行为</td></tr><tr><td align="left"><code>tasks.md</code></td><td align="left">4大模块、30+个子任务<br/>从命令实现、参数解析到测试覆盖，全部带checkbox</td><td align="left">31 行</td><td align="left"><strong>执行路线图</strong>，指导开发一步步完成变更</td></tr></tbody></table>
<p>从这个案例可以看出，在OpenSpec工具中，<code>spec.md</code>是篇幅最大、最详细的文档，因为它承载了最终的质量标准；而<code>proposal.md</code>和<code>tasks.md</code>则更偏向于变更管理和执行规划。</p>
<h2 data-id="heading-4">小结与延伸</h2>
<p>在OpenSpec工具中，将<code>proposal.md</code>、<code>spec.md</code>和<code>tasks.md</code>清晰分离，是工具设计哲学的核心体现。这种分离确保了：</p>
<ul>
<li><strong>关注点分离</strong>：决策者、设计者和执行者都能获得最相关、最清晰的信息</li>
<li><strong>强制设计先行</strong>：在动手编码前必须思考清楚"为什么改"、"改什么"和"怎么改"</li>
<li><strong>可追溯性</strong>：从提案到实现，每个环节都有明确文档记录</li>
<li><strong>质量可控</strong>：通过spec.md的详细定义，确保最终交付符合预期</li>
</ul>
<p><strong>如果你想进一步了解OpenSpec工具的设计哲学：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenspec%2Fopenspec%2Fblob%2Fmain%2Fdocs%2F11-spec-vs-change-separation-model.md" target="_blank" title="https://github.com/openspec/openspec/blob/main/docs/11-spec-vs-change-separation-model.md" ref="nofollow noopener noreferrer">github.com/openspec/op…</a> - 理解OpenSpec中specs/和changes/目录的核心设计思想</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenspec%2Fopenspec%2Fblob%2Fmain%2Fdocs%2F15-archive-and-merge-process.md" target="_blank" title="https://github.com/openspec/openspec/blob/main/docs/15-archive-and-merge-process.md" ref="nofollow noopener noreferrer">github.com/openspec/op…</a> - 了解OpenSpec中变更完成后如何规范归档</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenspec%2Fopenspec%2Fblob%2Fmain%2Fdocs%2F10-directory-structure-conventions.md" target="_blank" title="https://github.com/openspec/openspec/blob/main/docs/10-directory-structure-conventions.md" ref="nofollow noopener noreferrer">github.com/openspec/op…</a> - 掌握OpenSpec项目的标准文件组织方式</li>
</ul>
<p>清晰定义每个文档的职责，是使用OpenSpec工具进行高效变更管理的重要基础。希望这篇解析能帮助你更好地理解和应用OpenSpec的文档工作流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tip: 如何使用AI提升学习效率]]></title>    <link>https://juejin.cn/post/7600967006893293577</link>    <guid>https://juejin.cn/post/7600967006893293577</guid>    <pubDate>2026-01-30T09:49:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600967006893293577" data-draft-id="7600953198746992646" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tip: 如何使用AI提升学习效率"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T09:49:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桦说编程"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tip: 如何使用AI提升学习效率
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桦说编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:49:04.000Z" title="Fri Jan 30 2026 09:49:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">如何使用AI提升学习效率</h2>
<p>这一节可能是我最近最关注和思考的，然而可能复杂的问题常常可以用简单的形式得到很好的解答。因为人们学习的底层原理并没有因为AI的出现而改变，曾经有一篇很有名的学习方法的论文，总结了所有人类已经研究过的学习方法，发现间隔学习、问题优先（使用测试）、不同任务混搭的学习效果最好。实际上，学习的效果取决于人的思考参与程度，比如一道数学题你自己推导一遍会记得更深，学游泳要下水，学编程要写代码。</p>
<p>没有灵丹妙药，学习需要付出脑力。</p>
<p>AI辅助学习有很多有用的形式，我使用最多的是 Notebooklm：</p>
<ol>
<li>根据知识库生成问题卡片，主动回忆并回答</li>
<li>一些原本优秀的书籍、教程依然优秀，他们会帮你保持思维的连贯性和心流状态</li>
<li>使用AI辅助复习，逐渐回忆起忘记的内容</li>
<li>生成音频对话，我推荐使用辩论形式，会获得不同角度的理解</li>
<li>生成教程式演示文稿，有时可以帮助你把复杂的问题简化，让简单的内容更容易记住</li>
</ol>
<p>下一篇文章准备举例说明如何使用AI成倍提升学习效率，欢迎关注。</p>
<p>作者：桦说编程<br/>
链接：<a href="https://juejin.cn/spost/7597634458697531398" target="_blank" title="https://juejin.cn/spost/7597634458697531398">juejin.cn/spost/75976…</a><br/>
来源：稀土掘金<br/>
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI与物联网结合：智能体的真正落地场景]]></title>    <link>https://juejin.cn/post/7600303087874703398</link>    <guid>https://juejin.cn/post/7600303087874703398</guid>    <pubDate>2026-01-29T01:43:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600303087874703398" data-draft-id="7600260767687442458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI与物联网结合：智能体的真正落地场景"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-29T01:43:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI与物联网结合：智能体的真正落地场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T01:43:12.000Z" title="Thu Jan 29 2026 01:43:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0"><strong>引言</strong></h2>
<p>随着人工智能（AI）和物联网（IoT）的不断发展，二者的结合正在成为推动“万物智联”的关键力量。AI赋予物联网设备“学习、决策与优化”的能力，使其从“信息收集者”转变为“智能体”（Intelligent Agent）——不仅能感知环境，还能自主执行任务与协同决策。<br/>
本文将深入探讨AI与IoT的融合机制、技术实现方式及实际应用场景，帮助读者理解智能体如何在现实世界中真正落地。</p>
<hr/>
<h2 data-id="heading-1"><strong>一、背景与问题定义</strong></h2>
<p>传统物联网主要实现“互连互通”，即通过各种传感器收集数据，并将其上传至云端。但这种架构存在以下问题：</p>
<ol>
<li><strong>数据延迟与带宽浪费</strong>：大量原始数据上传云端，延迟高且成本大。</li>
<li><strong>缺乏自治能力</strong>：设备仅能执行预设规则，无法根据环境自适应。</li>
<li><strong>安全与隐私隐患</strong>：数据集中处理易造成隐私泄露与单点故障。</li>
</ol>
<p>这促使AI与IoT的融合成为趋势——让设备具备本地智能与自治能力，即 <strong>AIoT（Artificial Intelligence of Things）</strong> 。</p>
<hr/>
<h2 data-id="heading-2"><strong>二、技术实现与解决方案</strong></h2>
<h3 data-id="heading-3"><strong>1. 架构层次</strong></h3>
<p>AIoT系统可分为三层架构：</p>
<ul>
<li><strong>感知层（Perception Layer）</strong> ：传感器收集环境数据（温度、光强、位移等）。</li>
<li><strong>边缘智能层（Edge Intelligence Layer）</strong> ：设备或边缘节点进行AI推理与本地决策。</li>
<li><strong>云端协同层（Cloud Orchestration Layer）</strong> ：云端负责模型训练、数据分析与全局调优。</li>
</ul>
<p>这形成“云-边-端协同”的架构，使AI在物联网场景中具备实时性与可扩展性。</p>
<hr/>
<h3 data-id="heading-4"><strong>2. 技术实现示例</strong></h3>
<p>以下是一个基于Python与TensorFlow Lite的<strong>边缘AI温湿度监测系统</strong>示例：</p>
<h4 data-id="heading-5"><strong>(1) 硬件配置</strong></h4>
<ul>
<li>Raspberry Pi + DHT11 温湿度传感器</li>
<li>TensorFlow Lite 运行环境</li>
<li>本地模型文件 <code>temp_predict.tflite</code></li>
</ul>
<h4 data-id="heading-6"><strong>(2) 数据采集与推理代码</strong></h4>
<pre><code class="hljs language-ini" lang="ini">import tensorflow as tf
import Adafruit_DHT
import time

<span class="hljs-comment"># 加载边缘模型</span>
<span class="hljs-attr">interpreter</span> = tf.lite.Interpreter(model_path=<span class="hljs-string">"temp_predict.tflite"</span>)
interpreter.allocate_tensors()

<span class="hljs-attr">input_details</span> = interpreter.get_input_details()
<span class="hljs-attr">output_details</span> = interpreter.get_output_details()

<span class="hljs-attr">SENSOR</span> = Adafruit_DHT.DHT11
<span class="hljs-attr">PIN</span> = <span class="hljs-number">4</span>  <span class="hljs-comment"># GPIO 引脚编号</span>

def read_sensor():
    humidity, <span class="hljs-attr">temperature</span> = Adafruit_DHT.read_retry(SENSOR, PIN)
    return humidity, temperature

while True:
    humidity, <span class="hljs-attr">temp</span> = read_sensor()
    <span class="hljs-attr">input_data</span> = [[humidity, temp]]
    interpreter.set_tensor(input_details<span class="hljs-section">[0]</span><span class="hljs-section">['index']</span>, input_data)
    interpreter.invoke()
    <span class="hljs-attr">prediction</span> = interpreter.get_tensor(output_details[<span class="hljs-number">0</span>][<span class="hljs-string">'index'</span>])
    print(f"Current: {temp:.1f}°C, Predicted Trend: {prediction<span class="hljs-section">[0]</span>:.2f}")
    time.sleep(5)
</code></pre>
<h4 data-id="heading-7"><strong>(3) 机制说明</strong></h4>
<ul>
<li>通过本地模型预测环境变化趋势；</li>
<li>若检测到异常变化（如快速升温），系统可自动触发报警或调节空调；</li>
<li>云端周期性收集摘要数据，用于模型再训练与全局优化。</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>3. 智能体的体现</strong></h3>
<p>在AIoT架构中，单一设备（例如智能空调）通过AI算法具备“自治智能”：</p>
<ul>
<li>根据环境数据自我调整参数；</li>
<li>与其他设备协作（例如窗帘、温控器）；</li>
<li>可在断网环境中独立运行。</li>
</ul>
<p>如下是其决策逻辑示例（伪代码）：</p>
<pre><code class="hljs language-css" lang="css">if temp &gt; <span class="hljs-number">30</span> and humidity &lt; <span class="hljs-number">40</span>:
    <span class="hljs-built_in">turn_on_air_conditioner</span>()
    <span class="hljs-built_in">send_log</span>(<span class="hljs-string">"Cooling started"</span>)
elif temp &lt; <span class="hljs-number">22</span>:
    <span class="hljs-built_in">turn_off_air_conditioner</span>()
else:
    <span class="hljs-built_in">maintain_state</span>()
</code></pre>
<p>这种自主逻辑让“设备”转变为真正的“智能体”。</p>
<hr/>
<h2 data-id="heading-9"><strong>三、优缺点分析与实践建议</strong></h2>






























<table><thead><tr><th>方面</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>实时性</strong></td><td>边缘处理减少延迟</td><td>模型计算资源受限</td></tr><tr><td><strong>安全性</strong></td><td>数据本地化保护隐私</td><td>边缘安全仍面临攻击风险</td></tr><tr><td><strong>可扩展性</strong></td><td>云端统一调优，支持设备协同</td><td>模型更新与同步需机制保障</td></tr><tr><td><strong>能耗与成本</strong></td><td>降低云端负载</td><td>硬件算力成本较高</td></tr></tbody></table>
<h3 data-id="heading-10"><strong>实践建议</strong></h3>
<ol>
<li><strong>采用轻量化模型</strong>（如TensorFlow Lite、ONNX Runtime、TinyML）以适配边缘算力。</li>
<li><strong>通过联邦学习（Federated Learning）</strong> 实现分布式智能体训练，保护隐私。</li>
<li><strong>建立统一的设备管理平台</strong>，实现智能体协作与升级管理。</li>
<li><strong>强化安全机制</strong>，如设备身份认证、加密通信、防篡改机制。</li>
</ol>
<hr/>
<h2 data-id="heading-11"><strong>四、结论</strong></h2>
<p>AI与物联网的深度融合，使得“智能体”不再停留在概念层面，而是真正进入家庭、工业、交通、能源等场景。<br/>
未来，随着<strong>低功耗AI芯片、5G/6G网络、边缘计算与大模型压缩技术</strong>的不断进步，AIoT将成为智能化社会的核心基础设施。</p>
<p>简而言之，<strong>AI赋予物联以灵魂，IoT赋予AI以载体</strong>——智能体的落地，将成为人机协作与智能社会的核心标志。</p>
<hr/>
<h2 data-id="heading-12"><strong>参考资料</strong></h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tensorflow.org%2Flite" target="_blank" title="https://www.tensorflow.org/lite" ref="nofollow noopener noreferrer">Google TensorFlow Lite 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fieeexplore.ieee.org%2Fdocument%2F9390318" target="_blank" title="https://ieeexplore.ieee.org/document/9390318" ref="nofollow noopener noreferrer">Edge AI and IoT Integration – IEEE Xplore</a></li>
<li>李飞飞等，《人工智能导论》，清华大学出版社，2022年。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.nvidia.com%2Fembedded-computing" target="_blank" title="https://developer.nvidia.com/embedded-computing" ref="nofollow noopener noreferrer">NVIDIA Jetson Edge AI 平台</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git Commit 规范化实践 - 告别手动输入表情符号]]></title>    <link>https://juejin.cn/post/7600597995768021001</link>    <guid>https://juejin.cn/post/7600597995768021001</guid>    <pubDate>2026-01-29T09:32:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600597995768021001" data-draft-id="7600581247020384265" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git Commit 规范化实践 - 告别手动输入表情符号"/> <meta itemprop="keywords" content="Git,GitHub"/> <meta itemprop="datePublished" content="2026-01-29T09:32:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没多少逻辑"/> <meta itemprop="url" content="https://juejin.cn/user/2717648475395325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git Commit 规范化实践 - 告别手动输入表情符号
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648475395325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没多少逻辑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:32:53.000Z" title="Thu Jan 29 2026 09:32:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    44
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">写在前面</h2>
<p>之前我一直手动在 commit 信息前加表情符号，比如 <code>✨ feat: xxx</code>、<code>🐛 fix: xxx</code>，每次都要去找对应的 emoji，有时候还会遗漏，挺麻烦的。最近发现了 commitizen + cz-git 这套方案，可以通过交互式界面自动生成规范的提交信息，分享给大家。</p>
<p>顺便推荐一下我在维护的开源项目 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">gocron</a> - 一个 Go 写的分布式定时任务管理系统，用来替代 Linux crontab 的，支持 Web 界面、秒级精度、任务依赖等功能。欢迎 Star ⭐️</p>
<h2 data-id="heading-1">对比效果</h2>
<p><strong>之前手动输入：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">✨</span> <span class="hljs-attr">feat:</span> <span class="hljs-string">add</span> <span class="hljs-string">task</span> <span class="hljs-string">dependency</span> <span class="hljs-string">feature</span>  <span class="hljs-comment"># 每次都要复制粘贴 emoji</span>
<span class="hljs-string">🐛</span> <span class="hljs-attr">fix:</span> <span class="hljs-string">fix</span> <span class="hljs-string">status</span> <span class="hljs-string">update</span> <span class="hljs-string">issue</span>
</code></pre>
<p><strong>现在交互式选择：</strong></p>
<pre><code class="hljs language-bash" lang="bash">pnpm run commit
<span class="hljs-comment"># 选择类型、范围、填写描述，自动生成带 emoji 的规范提交</span>
</code></pre>
<h2 data-id="heading-2">在gocron项目中使用案例</h2>
<p>gocron 项目已经配置好了，直接使用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> gocron
pnpm install
pnpm run prepare

<span class="hljs-comment"># 提交代码</span>
git add .
pnpm run commit
</code></pre>
<h2 data-id="heading-3">在自己项目中配置</h2>
<h3 data-id="heading-4">1. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D @commitlint/cli @commitlint/config-conventional commitizen cz-git husky
</code></pre>
<h3 data-id="heading-5">2. 创建配置文件</h3>
<p>创建 <code>commitlint.config.cjs</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">'@commitlint/config-conventional'</span>],
  <span class="hljs-attr">prompt</span>: {
    <span class="hljs-attr">types</span>: [
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"✨ feat"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"feat:     ✨ 新增功能"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"🐛 fix"</span>,      <span class="hljs-attr">name</span>: <span class="hljs-string">"fix:      🐛 修复缺陷"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"📝 docs"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"docs:     📝 文档变更"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"💄 style"</span>,    <span class="hljs-attr">name</span>: <span class="hljs-string">"style:    💄 代码格式"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"♻️ refactor"</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"refactor: ♻️ 代码重构"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"⚡️ perf"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"perf:     ⚡️ 性能优化"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"✅ test"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"test:     ✅ 添加测试"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"📦️ build"</span>,    <span class="hljs-attr">name</span>: <span class="hljs-string">"build:    📦️ 构建变更"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"🎡 ci"</span>,       <span class="hljs-attr">name</span>: <span class="hljs-string">"ci:       🎡 CI 配置"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"⏪️ revert"</span>,   <span class="hljs-attr">name</span>: <span class="hljs-string">"revert:   ⏪️ 回滚"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"🔨 chore"</span>,    <span class="hljs-attr">name</span>: <span class="hljs-string">"chore:    🔨 其他修改"</span> }
    ],
    <span class="hljs-attr">skipQuestions</span>: [<span class="hljs-string">'breaking'</span>, <span class="hljs-string">'footerPrefix'</span>, <span class="hljs-string">'footer'</span>]
  }
}
</code></pre>
<h3 data-id="heading-6">3. 修改 package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/cz-git"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-7">4. 初始化 husky</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm run prepare
<span class="hljs-built_in">echo</span> <span class="hljs-string">"npx --no -- commitlint --edit \$1"</span> &gt; .husky/commit-msg
</code></pre>
<h2 data-id="heading-8">使用</h2>
<pre><code class="hljs language-bash" lang="bash">git add .
pnpm run commit
</code></pre>
<p>按提示操作：</p>
<ol>
<li>选择提交类型（自动带 emoji）</li>
<li>选择影响范围（可选）</li>
<li>填写简短描述</li>
<li>确认提交</li>
</ol>
<h2 data-id="heading-9">提交类型说明</h2>

































































<table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>feat</td><td>新功能</td><td><code>✨ feat(task): 添加任务依赖配置</code></td></tr><tr><td>fix</td><td>Bug 修复</td><td><code>🐛 fix(api): 修复状态更新异常</code></td></tr><tr><td>docs</td><td>文档</td><td><code>📝 docs: 更新 API 文档</code></td></tr><tr><td>style</td><td>代码格式</td><td><code>💄 style: 统一代码缩进</code></td></tr><tr><td>refactor</td><td>重构</td><td><code>♻️ refactor: 重构任务调度逻辑</code></td></tr><tr><td>perf</td><td>性能优化</td><td><code>⚡️ perf: 优化查询性能</code></td></tr><tr><td>test</td><td>测试</td><td><code>✅ test: 添加单元测试</code></td></tr><tr><td>build</td><td>构建</td><td><code>📦️ build: 升级依赖</code></td></tr><tr><td>ci</td><td>CI 配置</td><td><code>🎡 ci: 添加 GitHub Actions</code></td></tr><tr><td>revert</td><td>回滚</td><td><code>⏪️ revert: 回滚某功能</code></td></tr><tr><td>chore</td><td>其他</td><td><code>🔨 chore: 更新 .gitignore</code></td></tr></tbody></table>
<h2 data-id="heading-10">相关链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">GoCron 项目</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev" target="_blank" title="https://gocron-docs.pages.dev" ref="nofollow noopener noreferrer">GoCron 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcz-git.qbb.sh%2Fzh%2F" target="_blank" title="https://cz-git.qbb.sh/zh/" ref="nofollow noopener noreferrer">cz-git 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcommitlint.js.org%2F" target="_blank" title="https://commitlint.js.org/" ref="nofollow noopener noreferrer">Commitlint 文档</a></li>
</ul>
<hr/>
<p>如果觉得有用，欢迎给 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">gocron</a> 点个 Star ⭐️</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我不允许谁还不清楚function call在AI-Agent领域中流砥柱的地位]]></title>    <link>https://juejin.cn/post/7600296037543854080</link>    <guid>https://juejin.cn/post/7600296037543854080</guid>    <pubDate>2026-01-29T03:26:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600296037543854080" data-draft-id="7600293373476765696" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我不允许谁还不清楚function call在AI-Agent领域中流砥柱的地位"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T03:26:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有态度的下等马"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我不允许谁还不清楚function call在AI-Agent领域中流砥柱的地位
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有态度的下等马
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T03:26:45.000Z" title="Thu Jan 29 2026 03:26:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前文提要：还有比ollama更傻瓜式的大模型本地部署方式吗 ？</p>
<h2 data-id="heading-0">1.<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2F%40jamestang%2Fllm-function-calling-explained-a-deep-dive-into-the-request-and-response-payloads-894800fcad75" title="https://medium.com/@jamestang/llm-function-calling-explained-a-deep-dive-into-the-request-and-response-payloads-894800fcad75" target="_blank" ref="nofollow noopener noreferrer">function calling</a> 底层工作原理</h2>
<p>大模型重塑了我们与软件应用的交互方式， 其中最重要的特性就是 function calling 。</p>
<p>一种<strong>利用结构化输入/输出在LLM和编程应用之间建立桥梁</strong>的方式。</p>
<p>不管是当前火热的AI-agent还是MCP，了解function calling底层工作原理都至关重要，特别是request和response payload。</p>
<p>回顾上文我们与qwen大模型的对话：</p>
<p><code>what is the temperature in the capital of china today？</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93c158ad999046ebab870e1aabadd442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770262882&amp;x-signature=DbQP0xBsQB3dWsK1v%2FffgV3QqmA%3D" alt="" loading="lazy"/></p>
<p>一个由LLM驱动的应用， 回答这个问题，应用与LLM经历了三次对话。</p>
<p>① 第一次请求payload：</p>
<ul>
<li>message：标准的历史对话， 提供上下文context</li>
<li>tools：一系列的工具函数定义， 提供给LLM来选择</li>
</ul>
<p>LLM的响应payload：</p>
<ul>
<li><code>tool_calls.function.name</code>： LLM选中的工具函数<code>get_currentDate</code></li>
<li><code>tool_calls.id</code>： 由LLM为这个函数指定的id，后面会用到</li>
</ul>
<p>② 第二次request：</p>
<ul>
<li><code>messages.role.assistant</code>: 告诉LLM我们这次请求包含了上次function calling的结果</li>
<li><code>messages.role.tool</code>： 上次function calling执行的结果<code>2026-01-24</code></li>
</ul>
<p>LLM的响应payload：</p>
<p>如第一次类似：
本例也有<code>tool_calls</code>:包含LLM选中的函数<code>get_temperature()</code> 和所有的参数<code>beijing</code> <code>2026-01-24</code>。</p>
<p>③ 应用最后一次请求，包含所有信息</p>
<p>LLM推理认为不再需要外部工具，不再返回<code>tool_calls</code>,给出结合外部工具的对话结果。</p>
<hr/>
<p>从三次请求对话来看， LLM在三次对话的响应中体现了它的思考和逻辑步骤，应用持续被LLM引导做出行动，同时LLM也持续对应用的行为做出进一步思考和反馈。</p>
<h2 data-id="heading-1">2. agent的实现原理</h2>
<p>大模型是 AI 的大脑，其核心是理解自然语言，并做出回应，(文本)大模型本身只能接收一段文本，然后输出一段文本。</p>
<p>而当你希望大模型能使用一些工具自行获取所需的信息、执行一些动作，就需要使用 Tool 来实现了，拥有了 Tool 的大模型就像是拥有了手脚，可以和当下已有的 IT 基础设施进行交互。</p>
<blockquote>
<p>RAG给LLM装上实时知识外挂， 通过将信息检索与文本生成结合，让模型能引用外部权威信息生成回答，既保证了时效性，又提升了准确性。</p>
</blockquote>
<p>字节开源的<code>Eino</code>标榜的优势在于：</p>
<ol>
<li>
<p>LangChain，LlamaIndex等主流框架虽然起源自python强大的AI生态，但是也继承了python“弱类型检查”和“长期维护成本高”的诟病。 Eino作为golang下的开源agent开发框架，规避了这一问题。</p>
</li>
<li>
<p>另一方面， 借助字节系在agent领域的工程化实践，Eino既封装了领域内不变的通用核心和最佳实践，也能敏捷的反映业内技术动向。</p>
</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudwego.io%2Fzh%2Fdocs%2Feino%2Fquick_start%2F" title="https://www.cloudwego.io/zh/docs/eino/quick_start/" target="_blank" ref="nofollow noopener noreferrer">Eino</a>框架结构图：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f8174a2cdb14bb2a570e232d69f5e1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770262882&amp;x-signature=ahn0eXegCeZFRHfrCgU1BcH5JdM%3D" alt="" loading="lazy"/></p>
<p>Eino 有三大稳定内核： compose编排、components组件，common公共库。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudwego.io%2Fzh%2Fdocs%2Feino%2Foverview%2Fbytedance_eino_practice%2F" target="_blank" title="https://www.cloudwego.io/zh/docs/eino/overview/bytedance_eino_practice/" ref="nofollow noopener noreferrer">组件</a>一抹多,是原子能力的最小单位， <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudwego.io%2Fzh%2Fdocs%2Feino%2Fcore_modules%2Fchain_and_graph_orchestration%2F" target="_blank" title="https://www.cloudwego.io/zh/docs/eino/core_modules/chain_and_graph_orchestration/" ref="nofollow noopener noreferrer">编排</a>对这些组件进行组合、串连。</p>
<h2 data-id="heading-2">3.  中国首都今天的天气怎么样? 我母鸡啊</h2>
<p>我们使用Eino框架来实现本文的题目：
<code>what is  the temperature in the capital of china today</code>。</p>
<p>按照我们的分析，
从LLM的视角，要回答这个问题，经历了“思考-行动-观察-思考” 循环， 这是一个<code>ReAct</code>模式的agent。</p>
<p>下面基于阿里百炼 千问大模型，实现了天气对话，请自行从阿里百炼平台申请的apiKey替换到54行。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"time"</span>

	<span class="hljs-string">"github.com/cloudwego/eino-ext/components/model/qwen"</span>
	<span class="hljs-string">"github.com/cloudwego/eino/components/tool"</span>
	<span class="hljs-string">"github.com/cloudwego/eino/components/tool/utils"</span>
	<span class="hljs-string">"github.com/cloudwego/eino/compose"</span>
	<span class="hljs-string">"github.com/cloudwego/eino/schema"</span>
)

<span class="hljs-comment">// what is  the temperature in the capital of china today</span>

<span class="hljs-keyword">type</span> weatherReqParam <span class="hljs-keyword">struct</span> {
	City <span class="hljs-type">string</span> <span class="hljs-string">`json:"city"  jsonschema:"description=the name of the city"`</span>
	Date <span class="hljs-type">string</span> <span class="hljs-string">`json:"date"  jsonschema:"description=the date in the format of YYYY-MM-DD"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetTemperatureFunc</span><span class="hljs-params">(_ context.Context, p weatherReqParam)</span></span> (<span class="hljs-type">float64</span>, <span class="hljs-type">error</span>) {
	<span class="hljs-comment">// 这里直接mock一个温度值，实际应用中应该替换为真实的API调用</span>
	<span class="hljs-keyword">return</span> <span class="hljs-number">32</span>, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetCurrentDateFunc</span><span class="hljs-params">(_ context.Context, _ <span class="hljs-keyword">struct</span>{})</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">return</span> time.Now().Format(<span class="hljs-string">"2006-01-02"</span>), <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">of</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(t T)</span></span> *T {
	<span class="hljs-keyword">return</span> &amp;t
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	getDateTool, err := utils.InferTool(<span class="hljs-string">"get_currentDate"</span>, <span class="hljs-string">"Get the current date"</span>, GetCurrentDateFunc)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(err)
	}
	getTemperatureTool, err := utils.InferTool(<span class="hljs-string">"get_temperature"</span>, <span class="hljs-string">"Get the temperature in the capital of the city"</span>, GetTemperatureFunc)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(err)
	}

	<span class="hljs-comment">// 初始化 tools</span>
	weatherTools := []tool.BaseTool{
		getDateTool,
		getTemperatureTool,
	}

	apiKey := os.Getenv(<span class="hljs-string">"DASHSCOPE_API_KEY"</span>)
	apiKey = <span class="hljs-string">"{}"</span>  <span class="hljs-comment">// 在阿里百炼平台申请签名</span>
	modelName := os.Getenv(<span class="hljs-string">"MODEL_NAME"</span>)
	modelName = <span class="hljs-string">"qwen3-max"</span>
	chatModel, err := qwen.NewChatModel(context.Background(), &amp;qwen.ChatModelConfig{
		BaseURL:     <span class="hljs-string">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>,
		APIKey:      apiKey,
		Timeout:     <span class="hljs-number">0</span>,
		Model:       modelName,
		MaxTokens:   of(<span class="hljs-number">2048</span>),
		Temperature: of(<span class="hljs-type">float32</span>(<span class="hljs-number">0.7</span>)),
		TopP:        of(<span class="hljs-type">float32</span>(<span class="hljs-number">0.7</span>)),
	})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatalf(<span class="hljs-string">"NewChatModel of qwen failed, err=%v"</span>, err)
	}

	<span class="hljs-keyword">var</span> ctx = context.Background()
	<span class="hljs-comment">// 获取工具信息并绑定到 ChatModel</span>
	toolInfos := <span class="hljs-built_in">make</span>([]*schema.ToolInfo, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(weatherTools))
	<span class="hljs-keyword">for</span> _, tool := <span class="hljs-keyword">range</span> weatherTools {
		info, err := tool.Info(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			log.Fatal(err)
		}
		toolInfos = <span class="hljs-built_in">append</span>(toolInfos, info)
	}
	err = chatModel.BindTools(toolInfos)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 创建 tools 节点</span>
	weatherToolsNode, err := compose.NewToolNode(context.Background(), &amp;compose.ToolsNodeConfig{
		Tools: weatherTools,
	})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 构建基于 Graph 的 Agent，实现 ReAct 模式（自动执行工具并生成自然语言回复）</span>

	<span class="hljs-comment">// 定义状态，用于保存对话历史</span>
	<span class="hljs-keyword">type</span> appState <span class="hljs-keyword">struct</span> {
		messages []*schema.Message
	}

	graph := compose.NewGraph[[]*schema.Message, *schema.Message](
		compose.WithGenLocalState(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> *appState {
			<span class="hljs-keyword">return</span> &amp;appState{}
		}),
	)

	<span class="hljs-comment">// 添加 ChatModel 节点</span>
	err = graph.AddChatModelNode(<span class="hljs-string">"qwen_chat_model"</span>, chatModel,
		compose.WithStatePreHandler(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, input []*schema.Message, state *appState)</span></span> ([]*schema.Message, <span class="hljs-type">error</span>) {
			<span class="hljs-comment">// 如果是第一次进入（从 Start），将输入（用户问题）添加到历史</span>
			<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(state.messages) == <span class="hljs-number">0</span> {
				state.messages = <span class="hljs-built_in">append</span>(state.messages, input...)
			}
			<span class="hljs-comment">// 始终将完整的历史记录作为 ChatModel 的输入</span>
			<span class="hljs-keyword">return</span> state.messages, <span class="hljs-literal">nil</span>
		}),
		compose.WithStatePostHandler(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, output *schema.Message, state *appState)</span></span> (*schema.Message, <span class="hljs-type">error</span>) {
			<span class="hljs-comment">// 将 ChatModel 的输出（可能是工具调用或最终回复）添加到历史</span>
			state.messages = <span class="hljs-built_in">append</span>(state.messages, output)
			<span class="hljs-keyword">return</span> output, <span class="hljs-literal">nil</span>
		}),
	)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 添加 Tools 节点</span>
	err = graph.AddToolsNode(<span class="hljs-string">"agent_tools"</span>, weatherToolsNode,
		compose.WithStatePostHandler(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, output []*schema.Message, state *appState)</span></span> ([]*schema.Message, <span class="hljs-type">error</span>) {
			<span class="hljs-comment">// 将工具执行结果添加到历史</span>
			state.messages = <span class="hljs-built_in">append</span>(state.messages, output...)
			<span class="hljs-keyword">return</span> output, <span class="hljs-literal">nil</span>
		}),
	)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 添加边和分支</span>
	_ = graph.AddEdge(compose.START, <span class="hljs-string">"qwen_chat_model"</span>)

	<span class="hljs-comment">// 如果有工具调用，流转到 tools；否则结束</span>
	_ = graph.AddBranch(<span class="hljs-string">"qwen_chat_model"</span>, compose.NewGraphBranch(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, msg *schema.Message)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
		<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(msg.ToolCalls) &gt; <span class="hljs-number">0</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-string">"agent_tools"</span>, <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> compose.END, <span class="hljs-literal">nil</span>
	}, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">bool</span>{<span class="hljs-string">"agent_tools"</span>: <span class="hljs-literal">true</span>, compose.END: <span class="hljs-literal">true</span>}))

	<span class="hljs-comment">// 工具执行完后，回流到 chat_model 生成回复</span>
	_ = graph.AddEdge(<span class="hljs-string">"agent_tools"</span>, <span class="hljs-string">"qwen_chat_model"</span>)

	<span class="hljs-comment">// 编译运行</span>
	agent, err := graph.Compile(ctx)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 运行示例</span>
	resp, err := agent.Invoke(ctx, []*schema.Message{
		{
			Role:    schema.User,
			Content: <span class="hljs-string">"what is the temperature in the capital of china today? please answer in a humam like way."</span>,
		},
	})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	<span class="hljs-comment">// 输出结果</span>
	fmt.Println(resp.Content)
}

</code></pre>
<p>一开始我参照的官网的<code>chain</code>编排Eino组件，但是得到的结果是数字“32”， 并不是LLM对话的类人语言。</p>
<p>使用Trae的编码agent，20s就帮我改成了Graph形式的正确编码， 输出：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">The temperature <span class="hljs-keyword">in</span> Beijing, the capital of China, today (January <span class="hljs-number">28</span>, <span class="hljs-number">2026</span>) <span class="hljs-keyword">is</span> a warm <span class="hljs-number">32</span>°C! That’s quite hot <span class="hljs-keyword">for</span> <span class="hljs-keyword">this</span> time of year—make sure to stay hydrated and cool <span class="hljs-keyword">if</span> you’re <span class="hljs-keyword">out</span> and about!
</code></pre>
<blockquote>
<p>本例实际也可以使用<code>Chain</code>来完成，chain是一种特殊的、简化的graph，chain不能回头，本例需要手动串起来，Chain更适合确定性的编排。</p>
</blockquote>
<p>Graph就像一个自动化的流水线（loop），工人是 chat_model 和 tools ：</p>
<p>本例的Graph图如下，读者可以结合源代码理解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afe66b9b3e89498f8802096181aa56dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770262882&amp;x-signature=%2BJulP4zHryucNgMwa07hjemOEPE%3D" alt="" loading="lazy"/></p>
<ol>
<li>START -&gt; chat_model
<ul>
<li>ChatModel 拿到用户问题，思考后说：“我需要查日期。”（输出包含 ToolCall）</li>
</ul>
</li>
<li>chat_model -&gt; tools (由 Branch 判断)
<ul>
<li>Tools 听到指令，去查日期，得到 "2026-01-24"。</li>
</ul>
</li>
<li>tools -&gt; chat_model (由 AddEdge 强制流转)
<ul>
<li>ChatModel 再次被唤醒。这次它的输入包含了之前的历史（用户问题 + 刚才的 ToolCall + 刚才的结果）。</li>
<li>它再次思考：“我知道日期了，现在我要查北京的温度。”（输出包含 ToolCall）</li>
</ul>
</li>
<li>chat_model -&gt; tools (再次循环)
<ul>
<li>Tools 去查温度，得到 "32度"。</li>
</ul>
</li>
<li>tools -&gt; chat_model (再次循环)
<ul>
<li>ChatModel 再次被唤醒。现在的输入更丰富了（所有历史）。</li>
<li>它再次思考：“日期有了，温度也有了，我可以直接回答用户了。”（输出 不包含 ToolCall）</li>
</ul>
</li>
<li>chat_model -&gt; END (由 Branch 判断)
<ul>
<li>循环结束。</li>
</ul>
</li>
</ol>
<p>最后我们重温全文，function calling（function tools）在agent中的作用：
在由LLM驱动的agent应用中，function calling（function tools）作为LLM的手脚，让LLM具备使用工具从外部获取最新信息并指导应用行为的能力，这一过程由结构化的输入输出参数来传递。</p>
<p>最近股市长虹，祝大家发大财。😄😄😄</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC 权限系统实战（一）：页面级访问控制全解析]]></title>    <link>https://juejin.cn/post/7600600904094842914</link>    <guid>https://juejin.cn/post/7600600904094842914</guid>    <pubDate>2026-01-29T10:56:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600600904094842914" data-draft-id="7600600904094826530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC 权限系统实战（一）：页面级访问控制全解析"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-29T10:56:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="十五丶"/> <meta itemprop="url" content="https://juejin.cn/user/343495027727229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC 权限系统实战（一）：页面级访问控制全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/343495027727229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    十五丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:56:23.000Z" title="Thu Jan 29 2026 10:56:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本篇文章主要讲解 RBAC 权限方案在中后台管理系统的实现</p>
<p>在公司内部写过好几个后台系统，都需要实现权限控制，在职时工作繁多，没有系统性的来总结一下相关经验，现在人已离职，就把自己的经验总结一下，希望能帮助到你</p>
<blockquote>
<p>本文是<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">《通俗易懂的中后台系统建设指南》</a>系列的第九篇文章，该系列旨在告诉你如何来构建一个优秀的中后台管理系统</p>
</blockquote>
<h2 data-id="heading-1">权限模型有哪些？</h2>
<p>主流的权限模型主要分为以下五种：</p>
<ul>
<li>ACL模型：访问控制列表</li>
<li>DAC模型：自主访问控制</li>
<li>MAC模型：强制访问控制</li>
<li>ABAC模型：基于属性的访问控制</li>
<li>RBAC模型：基于角色的权限访问控制</li>
</ul>
<p>这里不介绍全部的权限模型，有兴趣你可以看看这篇文章：<a href="https://juejin.cn/post/7121977695197970463" target="_blank" title="https://juejin.cn/post/7121977695197970463">权限系统就该这么设计，yyds</a></p>
<p>如果你看过、用过市面上一些开源后台系统及权限设计，你会发现它们主要都是基于 RBAC 模型来实现的</p>
<h2 data-id="heading-2">为什么是 RBAC 权限模型？</h2>
<p>好问题！我帮你问了下 AI</p>



































<table><thead><tr><th align="left">对比维度</th><th align="left">ACL (访问控制列表)</th><th align="left">RBAC (基于角色)</th><th align="left">ABAC (基于属性)</th></tr></thead><tbody><tr><td align="left"><strong>核心逻辑</strong></td><td align="left"><strong>用户 ↔ 权限</strong><br/>直接点对点绑定，无中间层</td><td align="left"><strong>用户 ↔ 角色 ↔ 权限</strong><br/>引入“角色”解耦，权限归于角色</td><td align="left"><strong>属性 + 规则 = 权限</strong><br/>动态计算 (Who, When, Where)</td></tr><tr><td align="left"><strong>优点</strong></td><td align="left">模型极简，开发速度快，适合初期 MVP</td><td align="left">结构清晰，<strong>复用性高</strong>，符合企业组织架构，维护成本低</td><td align="left">极度灵活，支持细粒度控制<br/>(如：只能在工作日访问)</td></tr><tr><td align="left"><strong>缺点</strong></td><td align="left">用户量大时维护工作呈指数级增长，极易出错</td><td align="left"><strong>角色爆炸</strong>：若特例过多，可能导致定义成百上千个角色</td><td align="left">开发复杂度极高，规则引擎难设计，有一定的性能消耗</td></tr><tr><td align="left"><strong>适用场景</strong></td><td align="left">个人博客、小型内部工具</td><td align="left"><strong>中大型后台系统、SaaS 平台 (行业标准)</strong></td><td align="left">银行风控、AWS IAM、国家安全级系统</td></tr></tbody></table>
<p>总结来说，在后台系统的场景下，RBAC 模型在灵活性（对比ACL）和复杂性（对比ABAC）上取得了一个很好的平衡</p>
<h2 data-id="heading-3">RBAC 概念理解</h2>
<p>RBAC 权限模型，全称 Role-Based Access Control，基于角色的权限访问控制</p>
<p>模型有三要素：</p>
<ul>
<li>用户（User）：系统主体，即操作系统的具体人员或账号</li>
<li>角色（Role）：角色是一组权限的集合，代表了用户在组织中的职能或身份</li>
<li>权限（Permission）：用户可以对系统资源进行的访问或操作能力</li>
</ul>
<p>RBAC 的设计是将角色绑定权限，用户绑定角色，从而实现权限控制</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/477cc8185d0244aaa6a073d8313920c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=6fTTIUFMJOrZGOxj7nfS%2BhqLnJg%3D" alt="image.png" loading="lazy"/></p>
<p>并且，它们之间的逻辑关系通常是多对多的：</p>
<p><strong>用户 - 角色 (User-Role)：</strong> 一个用户可以拥有多个角色（例如：某人既是“项目经理”又是“技术委员会成员”）</p>
<p><strong>角色 - 权限(Role-Permission)：</strong> 一个角色包含多个权限（例如：“人事经理”角色拥有“查看员工”、“编辑薪资”等权限）</p>
<h2 data-id="heading-4">主导权限控制的前端、后端方案</h2>
<p>市面上这些开源 Admin 的权限控制中，存在两种主要的权限主导方案：前端主导的权限方案和后端主导的权限方案</p>
<h3 data-id="heading-5">前端主导的权限方案</h3>
<p>前端主导的权限方案，一个主要的特征是菜单数据由前端维护，而不是存在数据库中</p>
<p>后端只需要在登录后给到用户信息，这个信息中会包含用户的角色，根据这个角色信息，前端可以筛选出具有权限的菜单、按钮</p>
<p>这种方案的主要逻辑放在前端，而不是后端数据库，所以安全性没保障，灵活性也较差，要更新权限，就需要改动前端代码并重新打包上线，无法支持“动态配置权限”</p>
<p>适合一些小型、简单系统</p>
<h3 data-id="heading-6">后端主导的权限方案</h3>
<p>后端控制方案，即登录后在返回用户信息时，还会给到此用户对应的菜单数据和按钮权限码等</p>
<p>菜单数据、按钮权限码等都存在数据库，这样一来，安全性、灵活性更高，要更新权限数据或用户权限控制，提供相应接口即可修改</p>
<blockquote>
<p>倒也不是说前端完全不用管菜单数据，而是前端只需要维护一些静态菜单数据，比如登录页、异常页(404、403...)</p>
</blockquote>
<p>在企业级后台系统中，后端主导的权限方案是比较常用的，本文只介绍后端主导的权限方案</p>
<h2 data-id="heading-7">权限方案整体流程</h2>
<p>在开始写代码之前，要清晰知道整体实现流程，我画了一张图来直观展示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24d25fc5a24b446eb3b46d1109e688ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=X8GZE0WmhkV99y%2BwVUpesaS5Fmc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">后台系统中的 RBAC 权限实战</h2>
<h3 data-id="heading-9">权限菜单类型定义</h3>
<p>首先，在前后端人员配合中，我们最好约定一套菜单数据的结构，比如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteMeta</span>, <span class="hljs-title class_">RouteRecordRaw</span>, <span class="hljs-title class_">RouteRecordRedirectOption</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DefineComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/type'</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CustomRouteRecordRaw</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>, 'meta'&gt; {
    <span class="hljs-comment">/**
     * 路由地址
     */</span>
    path?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 路由名称
     */</span>
    name?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 重定向路径
     */</span>
    redirect?: <span class="hljs-title class_">RouteRecordRedirectOption</span>;
    <span class="hljs-comment">/**
     * 组件
     */</span>
    component?: <span class="hljs-title class_">Component</span> | <span class="hljs-title class_">DefineComponent</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">unknown</span>&gt;);
    <span class="hljs-comment">/**
     * 子路由信息
     */</span>
    children?: <span class="hljs-title class_">CustomRouteRecordRaw</span>[];
    <span class="hljs-comment">/**
     * 路由类型
     */</span>
    <span class="hljs-keyword">type</span>?: <span class="hljs-title class_">RouteType</span>;
    <span class="hljs-comment">/**
     * 元信息
     */</span>
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-comment">/**
       * 菜单标题
       */</span>
      <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-comment">/**
       * 菜单图标
       */</span>
      menuIcon?: <span class="hljs-built_in">string</span>;
      <span class="hljs-comment">/**
       * 排序
       */</span>
      sort?: <span class="hljs-built_in">number</span>;
      <span class="hljs-comment">/**
       * 是否在侧边栏菜单中隐藏
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      hideMenu?: <span class="hljs-built_in">boolean</span>;
      <span class="hljs-comment">/**
       * 是否在面包屑中隐藏
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      hideBreadcrumb?: <span class="hljs-built_in">boolean</span>;
      <span class="hljs-comment">/**
       * 当只有一个子菜单时，是否隐藏父级菜单直接显示子菜单内容
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      hideParentIfSingleChild?: <span class="hljs-built_in">boolean</span>;
    };
  }

  <span class="hljs-comment">/**
   * 后端返回的权限路由类型定义
   */</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">PermissionRoute</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">CustomRouteRecordRaw</span>, <span class="hljs-string">'component'</span> | <span class="hljs-string">'children'</span> | <span class="hljs-string">'type'</span>&gt; &amp; {
    <span class="hljs-comment">/**
     * 路由ID
     */</span>
    id?: <span class="hljs-built_in">number</span>;
    <span class="hljs-comment">/**
     * 路由父ID
     */</span>
    parentId?: <span class="hljs-built_in">number</span>;
    <span class="hljs-comment">/**
     * 组件路径（后端返回时为字符串，前端处理后为组件）
     */</span>
    <span class="hljs-attr">component</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * 子路由信息
     */</span>
    children?: <span class="hljs-title class_">PermissionRoute</span>[];
    <span class="hljs-comment">/**
     * 路由类型
     */</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">RouteType</span>;
  };
}

</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Frouter.d.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/router.d.ts" ref="nofollow noopener noreferrer">router.d.ts</a> 找到类型文件</p>
</blockquote>
<p>以上面的类型定义为例，我们约定 <code>PermissionRoute</code> 类型是后端返回的权限路由类型：</p>
<p>我这里使用 ApiFox 来 Mock 权限路由数据，数据是这样的：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F" target="_blank" title="https://clean-admin.apifox.cn/" ref="nofollow noopener noreferrer">clean-admin ApiFox 文档在线地址</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d472ebe0289417aab9114ab52c82a2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=533qsuaKRIxS%2Bvb0FxFeUHlz7Mo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">从登录页到路由守卫</h3>
<p>权限方案的第一步，是登录并拿到用户信息</p>
<p>假设我们现在用 Element Plus 搭建起了一个登录页面，当用户点击登录时，我们需要做这几件事：</p>
<ol>
<li>调用登录接口，将账号、密码发送给后端进行验证，验证通过则返回 JWT 信息</li>
<li>将返回的 JWT 信息保存到本地，后续每次请求都携带 Token 来识别用户身份并决定你能拿到的权限路由数据</li>
<li>触发路由守卫拦截</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d1195e632f74c2aa508c623555734ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=f%2FsehCMd98KQLSHYFgN9fuwg2Qg%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Fviews%2Fauth%2Fpage%2Faccount-login.vue" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/views/auth/page/account-login.vue" ref="nofollow noopener noreferrer">account-login.vue</a> 找到全部代码</p>
</blockquote>
<h3 data-id="heading-11">基本 Vue Router 配置</h3>
<p>登录完成后，我们就可以触发路由守卫了，但在写路由守卫之前，我们先来配置一下基本的 Vue Router</p>
<p>在整个权限系统中，我们将路由数据分为两种：</p>
<ol>
<li>静态路由：系统固定的路由，比如登录页、异常页(404、403...)</li>
<li>动态路由：由后端接口返回的用户角色对应的菜单路由数据</li>
</ol>
<p>静态路由是直接由前端定义，不会从后端接口返回、不会根据用户角色动态变化，所以这部分路由我们直接写好然后注册到 Vue Router 中即可</p>
<p>Vue Router 配置：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createRouter, createWebHashHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteRecordRaw</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">App</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ImportGlobRoutes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./typing'</span>;
<span class="hljs-keyword">import</span> { extractRoutes } <span class="hljs-keyword">from</span> <span class="hljs-string">'./helpers'</span>;
<span class="hljs-keyword">import</span> { afterEachGuard, beforeEachGuard } <span class="hljs-keyword">from</span> <span class="hljs-string">'./guards'</span>;

<span class="hljs-comment">/** 静态路由 */</span>
<span class="hljs-keyword">const</span> staticRoutes = <span class="hljs-title function_">extractRoutes</span>(
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">glob</span>&lt;<span class="hljs-title class_">ImportGlobRoutes</span>&gt;([<span class="hljs-string">'./modules/constant-routes/**/*.ts'</span>], {
    <span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span>,
  }),
);

<span class="hljs-comment">/** 系统路由 */</span>
<span class="hljs-keyword">const</span> systemRoutes = <span class="hljs-title function_">extractRoutes</span>(
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">glob</span>&lt;<span class="hljs-title class_">ImportGlobRoutes</span>&gt;([<span class="hljs-string">'./modules/system-routes/**/*.ts'</span>], {
    <span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span>,
  }),
);

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHashHistory</span>(),
  <span class="hljs-attr">routes</span>: [...staticRoutes, ...systemRoutes] <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouteRecordRaw</span>[],
  <span class="hljs-attr">strict</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">scrollBehavior</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }),
});

<span class="hljs-title function_">beforeEachGuard</span>(router);
<span class="hljs-title function_">afterEachGuard</span>(router);

<span class="hljs-comment">/** 初始化路由 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initRouter</span>(<span class="hljs-params">app: App&lt;Element&gt;</span>) {
  app.<span class="hljs-title function_">use</span>(router);
}

<span class="hljs-keyword">export</span> { router, initRouter, staticRoutes };

</code></pre>
<blockquote>
<p>图中的静态路由和系统路由是同一类路由数据，即静态路由</p>
</blockquote>
<p>这个配置文件可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Frouter%2Findex.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/router/index.ts" ref="nofollow noopener noreferrer">router/index.ts</a> 找到</p>
<p>这个基本的 Vue Router 配置，做了这么几件事：</p>
<ol>
<li>导入 <code>modules</code> 文件夹下的静态路由进行注册</li>
<li>路由初始化配置 <code>initRouter</code> ，在 <code>main.ts</code> 中调用</li>
<li>注册全局前置守卫 <code>beforeEach</code>、全局后置守卫 <code>afterEach</code></li>
</ol>
<p>我们实现动态路由注册的逻辑就写在 <code>beforeEach</code> 中</p>
<p>值得一提的是，使用了 <code>import.meta.glob</code> 来动态导入指定路径下的文件模块，这是 <code>Vite</code> 提供的一种导入方式，参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vite.dev%2Fguide%2Ffeatures%23glob-import" target="_blank" title="https://cn.vite.dev/guide/features#glob-import" ref="nofollow noopener noreferrer">Vite Glob 导入</a></p>
<h3 data-id="heading-12">路由守卫与动态注册</h3>
<p>路由守卫是 Vue Router 提供的一种机制，主要用来通过跳转或取消的方式守卫导航：<a href="https://link.juejin.cn?target=https%3A%2F%2Frouter.vuejs.org%2Fzh%2Fguide%2Fadvanced%2Fnavigation-guards.html" target="_blank" title="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html" ref="nofollow noopener noreferrer">Vue Router 路由守卫</a></p>
<p>重头戏在全局前置守卫 <code>router.beforeEach</code> 中实现，来看看我们做哪些事：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">ROUTE_NAMES</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteRecordNameGeneric</span>, <span class="hljs-title class_">RouteRecordRaw</span>, <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> { getLocalAccessToken } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/permission'</span>;
<span class="hljs-keyword">import</span> { userService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/api'</span>;
<span class="hljs-keyword">import</span> { nprogress } <span class="hljs-keyword">from</span> <span class="hljs-string">'./helpers'</span>;
<span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;

<span class="hljs-comment">/** 登录认证页面：账号登录页、短信登录页、二维码登录页、忘记密码页、注册页... */</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">authPages</span>: <span class="hljs-title class_">RouteRecordNameGeneric</span>[] = [
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">AUTH</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ACCOUNT_LOGIN</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">SMS_LOGIN</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">QR_LOGIN</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">FORGOT_PASSWORD</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">REGISTER</span>,
];

<span class="hljs-comment">/** 页面白名单：不需要登录也能访问的页面 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">pageWhiteList</span>: <span class="hljs-title class_">RouteRecordNameGeneric</span>[] = [...authPages];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">beforeEachGuard</span>(<span class="hljs-params">router: Router</span>) {
  router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to) =&gt; {
    <span class="hljs-comment">/** 进度条：开始 */</span>
    nprogress.<span class="hljs-title function_">start</span>();

    <span class="hljs-keyword">const</span> { <span class="hljs-attr">name</span>: <span class="hljs-title class_">RouteName</span> } = to;

    <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();
    <span class="hljs-keyword">const</span> { getAccessToken, getRoutesAddStatus, registerRoutes } = <span class="hljs-title function_">storeToRefs</span>(userStore);
    <span class="hljs-keyword">const</span> { setRoutesAddStatus, setUserInfo, logout } = userStore;

    <span class="hljs-comment">/** 访问令牌 */</span>
    <span class="hljs-keyword">const</span> accessToken = getAccessToken.<span class="hljs-property">value</span> || <span class="hljs-title function_">getLocalAccessToken</span>();

    <span class="hljs-comment">// 1.用户未登录（无 Token）</span>
    <span class="hljs-keyword">if</span> (!accessToken) {
      <span class="hljs-keyword">const</span> isWhitePage = pageWhiteList.<span class="hljs-title function_">includes</span>(<span class="hljs-title class_">RouteName</span>);
      <span class="hljs-comment">// 1.1 未登录，如果访问的是白名单中的页面，直接放行</span>
      <span class="hljs-keyword">if</span> (isWhitePage) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

      nprogress.<span class="hljs-title function_">done</span>();

      <span class="hljs-comment">// 1.2 未登录又不在白名单，则拦截并重定向到登录页</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ACCOUNT_LOGIN</span> };
    }

    <span class="hljs-comment">// 如果已登录用户试图访问登录页，避免重复登录，要强制重定向到首页</span>
    <span class="hljs-keyword">if</span> (authPages.<span class="hljs-title function_">includes</span>(<span class="hljs-title class_">RouteName</span>)) {
      nprogress.<span class="hljs-title function_">done</span>();
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ROOT</span> };
    }

    <span class="hljs-comment">// 判断是否需要动态加载路由的操作</span>
    <span class="hljs-keyword">if</span> (!getRoutesAddStatus.<span class="hljs-property">value</span>) {
      <span class="hljs-comment">// isRoutesAdded 默认为 false（未持久化），在已经动态注册过时会设置为true，在页面刷新时会重置为 false</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1.拉取用户信息</span>
        <span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">await</span> userService.<span class="hljs-title function_">getUserInfo</span>();

        <span class="hljs-comment">// 2.将用户信息存入 Store</span>
        <span class="hljs-title function_">setUserInfo</span>(userInfo);

        <span class="hljs-comment">// 3.动态注册路由，registerRoutes 是处理后的路由表</span>
        registerRoutes.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> {
          router.<span class="hljs-title function_">addRoute</span>(route <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouteRecordRaw</span>);
        });

        <span class="hljs-comment">// 4.标记路由已添加</span>
        <span class="hljs-title function_">setRoutesAddStatus</span>(<span class="hljs-literal">true</span>);

        <span class="hljs-comment">// 5.中断当前导航，重新进入守卫</span>
        <span class="hljs-keyword">return</span> { ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> };
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// 获取用户信息失败（如 Token 过期失效、网络异常）</span>
        <span class="hljs-title function_">logout</span>();
        nprogress.<span class="hljs-title function_">done</span>();
        <span class="hljs-comment">// 重定向回登录页，让用户重新登录</span>
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ACCOUNT_LOGIN</span> };
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  });
}

</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Frouter%2Fguards%2Fbefore-each-guard.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/router/guards/before-each-guard.ts" ref="nofollow noopener noreferrer">before-each-guard.ts</a> 找到全部代码</p>
</blockquote>
<p>上面的代码已经给出了很详细的注释，从整体角度来讲，我们做了两件事：</p>
<ol>
<li>处理一些情况，比如用户未登录、登录后访问登录页、白名单等情况</li>
<li>拉取用户信息，动态注册路由</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52a61b13fbbd43698183f2e65dee3b47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=bEbJ33PHj4SjT%2BBG4X%2BVC942%2BOA%3D" alt="image.png" loading="lazy"/></p>
<p>在路由守卫中“拉取用户信息”，一般来说，除了返回用户本身的信息外，还会给到权限路由信息、权限码信息，这里的数据结构可以跟后端进行约定</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e69f7c3abe341d4b51f2033820b757e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=ciXyPsIRKCJK%2BwXwvHogFOQlqBg%3D" alt="image.png" loading="lazy"/></p>
<p>比如在 vue-clean-admin 中，返回的数据结构是这样的：</p>
<blockquote>
<p>在 ApiFox 文档可以找到用户接口说明：<a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F336121333e0" target="_blank" title="https://clean-admin.apifox.cn/336121333e0" ref="nofollow noopener noreferrer">ApiFox 文档 - 用户信息</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a1983f04833498ca8738fd8e027677c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=TEQWMgkv5Yb42BKazc%2BroN1epGE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">后端路由结构的转化</h3>
<p>在通过“拉取用户信息”拿到路由数据后，并不是直接注册到 Vue Router，而是需要进行处理转化，才能符合 Vue Router 定义的路由表结构，<code>registerRoutes</code> 就是处理后的路由表，处理后的类型定义可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Frouter.d.ts%23L7-L64" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/router.d.ts#L7-L64" ref="nofollow noopener noreferrer"><code>CustomRouteRecordRaw</code></a></p>
<p>处理什么内容呢？</p>
<p>比如，接口拿到的路由数据字段 <code>component</code> 是一个字符串路径，这是一个映射路径，映射到前端项目下的真实组件路径</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e45648c28a1842d989038a603c9d8fdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=3pupbwBxPl8RwEVJMSVXNGpW8Ws%3D" alt="image.png" loading="lazy"/></p>
<p>实现路由结构转换的代码，我写在了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Frouter%2Fhelpers.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/router/helpers.ts" ref="nofollow noopener noreferrer">router/helpers.ts</a>，最主要逻辑是 <code>generateRoutes</code> 函数：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 生成符合 Vue Router 定义的路由表
 * <span class="hljs-doctag">@param</span> routes 未转化的路由数据
 * <span class="hljs-doctag">@returns</span> 符合结构的路由表
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateRoutes</span>(<span class="hljs-params">routes: PermissionRoute[]</span>): <span class="hljs-title class_">CustomRouteRecordRaw</span>[] {
  <span class="hljs-keyword">if</span> (!routes.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> [];
  <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { path, name, redirect, <span class="hljs-keyword">type</span>, meta } = route;
    <span class="hljs-keyword">const</span> <span class="hljs-attr">baseRoute</span>: <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">CustomRouteRecordRaw</span>, <span class="hljs-string">'children'</span>&gt; = {
      path,
      name,
      redirect,
      <span class="hljs-keyword">type</span>,
      <span class="hljs-attr">component</span>: <span class="hljs-title function_">loadComponent</span>(route),
      <span class="hljs-attr">meta</span>: {
        ...meta,
        <span class="hljs-comment">// 是否在侧边栏菜单中隐藏</span>
        <span class="hljs-attr">hideMenu</span>: route.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideMenu</span> || <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// 是否在面包屑中隐藏</span>
        <span class="hljs-attr">hideBreadcrumb</span>: route.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideBreadcrumb</span> || <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// 当只有一个子菜单时，是否隐藏父级菜单直接显示子菜单内容</span>
        <span class="hljs-attr">hideParentIfSingleChild</span>: route.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideParentIfSingleChild</span> || <span class="hljs-literal">false</span>,
      },
    };

    <span class="hljs-comment">// 是目录数据，设置重定向路径</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-title class_">PermissionRouteTypeEnum</span>.<span class="hljs-property">DIR</span>) {
      baseRoute.<span class="hljs-property">redirect</span> = redirect || <span class="hljs-title function_">getRedirectPath</span>(route);
    }
    <span class="hljs-comment">// 递归处理子路由</span>
    <span class="hljs-keyword">const</span> processedChildren =
      route.<span class="hljs-property">children</span> &amp;&amp; route.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> ? <span class="hljs-title function_">generateRoutes</span>(route.<span class="hljs-property">children</span>) : <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">return</span> {
      ...baseRoute,
      ...(processedChildren ? { <span class="hljs-attr">children</span>: processedChildren } : {}),
    };
  });
}
</code></pre>
<p>经过 <code>generateRoutes</code> 处理的路由表，再 <code>addRoute</code> 到 Vue Router 中</p>
<h3 data-id="heading-14">侧边栏菜单的渲染</h3>
<p>当路由守卫的逻辑走完后，就进入到首页，在首页中，我们会根据路由表（转换过的）来渲染侧边栏菜单</p>
<p>侧边栏菜单是拿 Element Plus 的 <code>el-menu</code> 组件来做的，我们封装了一个菜单组件，除了渲染路由数据外，也更方便自定义配置菜单属性（<code>meta</code>）来实现一些功能</p>
<p>封装不难，就是拿处理后的路由表循环渲染 <code>menu-item</code>，根据 <code>meta</code> 配置项来实现"是否隐藏菜单"，"当只有一个子菜单时，是否隐藏父级菜单直接显示子菜单内容"等</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc22c2cff5504c7da9f622501542575d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=N30nuLBJhKAnO0gn1RD1N8kky4E%3D" alt="image.png" loading="lazy"/></p>
<p>菜单组件的封装代码在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Ftree%2Fmain%2Fsrc%2Flayout%2Fcomponents%2Fbasic-menu" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/tree/main/src/layout/components/basic-menu" ref="nofollow noopener noreferrer">basic-menu</a> 文件夹中</p>
<p>到这一步，已经实现了动态权限路由及侧边栏菜单的渲染，但还不算完</p>
<p>因为我们还不能自由定义菜单信息、角色信息、用户信息来实现权限控制，在下一篇文章来聊聊管理模块</p>
<h2 data-id="heading-15">了解更多</h2>
<p>系列专栏地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog" target="_blank" title="https://github.com/bryqiu/Blog" ref="nofollow noopener noreferrer">GitHub 博客</a> | <a href="https://juejin.cn/column/7437267529330901026" target="_blank" title="https://juejin.cn/column/7437267529330901026">掘金专栏</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fblog%2Fadmin_guide" target="_blank" title="https://segmentfault.com/blog/admin_guide" ref="nofollow noopener noreferrer">思否专栏</a></p>
<p>实战项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin" target="_blank" title="https://github.com/bryqiu/vue-clean-admin" ref="nofollow noopener noreferrer">vue-clean-admin</a></p>
<h2 data-id="heading-16">交流讨论</h2>
<p>文章如有错误或需要改进之处，欢迎指正</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[飞书AI机器人流式输出实践：从消息编辑踩坑到卡片更新最佳方案]]></title>    <link>https://juejin.cn/post/7600990891206819867</link>    <guid>https://juejin.cn/post/7600990891206819867</guid>    <pubDate>2026-01-30T09:50:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600990891206819867" data-draft-id="7600953879500521523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="飞书AI机器人流式输出实践：从消息编辑踩坑到卡片更新最佳方案"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-30T09:50:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="moshuying"/> <meta itemprop="url" content="https://juejin.cn/user/2700056289356936"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            飞书AI机器人流式输出实践：从消息编辑踩坑到卡片更新最佳方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2700056289356936/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    moshuying
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:50:01.000Z" title="Fri Jan 30 2026 09:50:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文总结了在开发 AI Agent + 飞书机器人场景下，实现流式输出时踩过的坑和最终的工程方案。适合有飞书开放平台开发经验、正在构建 AI 应用的工程师阅读。</p>
</blockquote>
<h2 data-id="heading-0">一、背景与问题</h2>
<h3 data-id="heading-1">1.1 场景描述</h3>
<p>在 AI Agent 场景下，大模型的输出往往是<strong>流式</strong>的（Streaming），即内容逐步生成、逐步返回。为了提升用户体验，我们希望在飞书机器人中实现类似 ChatGPT 的「打字机效果」——用户发送消息后，机器人先回复一条「正在处理...」，然后随着 Agent 的输出不断更新这条消息，最终显示完整回复。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Bot as 飞书机器人
    participant Agent as AI Agent
    
    User-&gt;&gt;Bot: 发送消息
    Bot-&gt;&gt;User: 回复「正在处理...」
    Bot-&gt;&gt;Agent: 调用 Agent
    loop 流式输出
        Agent--&gt;&gt;Bot: chunk_1
        Bot-&gt;&gt;User: 更新消息为 chunk_1
        Agent--&gt;&gt;Bot: chunk_1 + chunk_2
        Bot-&gt;&gt;User: 更新消息为 chunk_1 + chunk_2
    end
    Agent--&gt;&gt;Bot: 完整内容
    Bot-&gt;&gt;User: 最终更新
</code></pre>
<h3 data-id="heading-2">1.2 踩坑：消息编辑次数上限</h3>
<p>最初的实现方案是使用飞书的<strong>编辑消息 API</strong>（<code>PATCH /open-apis/im/v1/messages/:message_id</code>）来更新已发送的文本消息。</p>
<p><strong>问题暴露</strong>：当 Agent 输出较长、chunk 较多时，编辑请求会<strong>静默失败</strong>——API 返回成功，但消息内容不再更新。</p>
<p><strong>根因分析</strong>：飞书对单条消息的编辑次数有<strong>隐性上限</strong>（官方文档未明确说明具体数值），超过上限后编辑操作会被忽略。</p>




















<table><thead><tr><th>方案</th><th>编辑次数限制</th><th>适用场景</th></tr></thead><tbody><tr><td>消息编辑 API</td><td>有上限（约 20-30 次）</td><td>少量更新、非流式场景</td></tr><tr><td>卡片实体更新</td><td>无明确上限</td><td>高频更新、流式输出场景</td></tr></tbody></table>
<h2 data-id="heading-3">二、解决方案：卡片实体（CardKit）</h2>
<h3 data-id="heading-4">2.1 方案对比</h3>
<p>飞书提供了两种消息更新机制：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 方案A["方案 A: 消息编辑"]
        A1[发送文本消息] --&gt; A2[获取 message_id]
        A2 --&gt; A3[调用编辑 API]
        A3 --&gt; A4{超过上限?}
        A4 --&gt;|是| A5[静默失败]
        A4 --&gt;|否| A3
    end
    
    subgraph 方案B["方案 B: 卡片实体"]
        B1[创建卡片实体] --&gt; B2[获取 card_id]
        B2 --&gt; B3[发送卡片消息]
        B3 --&gt; B4[调用卡片更新 API]
        B4 --&gt; B4
    end
</code></pre>
<p><strong>卡片实体的优势</strong>：</p>
<ol>
<li><strong>无编辑次数限制</strong>：适合高频更新场景</li>
<li><strong>支持 JSON 2.0</strong>：富文本、Markdown、交互组件等</li>
<li><strong>流式更新专用配置</strong>：<code>streaming_mode</code> 可优化客户端渲染</li>
</ol>
<h3 data-id="heading-5">2.2 核心流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Bot as 飞书机器人
    participant CardKit as CardKit API
    participant Agent as AI Agent
    
    User-&gt;&gt;Bot: 发送消息
    Bot-&gt;&gt;CardKit: 创建卡片实体
    CardKit--&gt;&gt;Bot: 返回 card_id
    Bot-&gt;&gt;User: 发送卡片消息（关联 card_id）
    Bot-&gt;&gt;Agent: 调用 Agent
    loop 流式输出（带节流）
        Agent--&gt;&gt;Bot: accumulated_content
        Bot-&gt;&gt;CardKit: 更新卡片内容（card_id, seq++）
        CardKit--&gt;&gt;User: 推送更新
    end
    Bot-&gt;&gt;CardKit: 兜底更新（最终内容）
</code></pre>
<h2 data-id="heading-6">三、工程实现</h2>
<h3 data-id="heading-7">3.1 模块架构</h3>
<p>为了可维护性和可复用性，将飞书插件拆分为以下模块：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph feishu["飞书插件模块"]
        client["client.py&lt;br/&gt;主客户端 &amp; 事件路由"]
        card["card.py&lt;br/&gt;卡片创建/更新/发送"]
        message["message.py&lt;br/&gt;文本消息操作"]
        agent["agent.py&lt;br/&gt;Agent 流式调用"]
    end
    
    client --&gt; card
    client --&gt; message
    client --&gt; agent
    agent --&gt; card
    agent --&gt; message
</code></pre>

























<table><thead><tr><th>模块</th><th>职责</th></tr></thead><tbody><tr><td><code>client.py</code></td><td>主类，WebSocket 事件处理，消息路由</td></tr><tr><td><code>card.py</code></td><td>CardMixin：卡片模板、创建、更新、发送</td></tr><tr><td><code>message.py</code></td><td>MessageMixin：文本消息发送、回复、编辑</td></tr><tr><td><code>agent.py</code></td><td>Agent 流式调用，节流回调，兜底更新</td></tr></tbody></table>
<h3 data-id="heading-8">3.2 核心代码示例</h3>
<h4 data-id="heading-9">3.2.1 卡片创建与更新</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># card.py - 卡片相关功能</span>

<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> lark_oapi.api.cardkit.v1 <span class="hljs-keyword">import</span> (
    Card, CreateCardRequest, CreateCardRequestBody,
    UpdateCardRequest, UpdateCardRequestBody,
)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CardMixin</span>:
    <span class="hljs-string">"""卡片相关方法的 Mixin 类"""</span>
    
    http_client: <span class="hljs-string">"lark.Client"</span>
    _card_sequence: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]  <span class="hljs-comment"># 卡片序号管理</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_next_sequence</span>(<span class="hljs-params">self, card_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""获取并递增卡片操作序号（必须严格递增）"""</span>
        seq = self._card_sequence.get(card_id, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
        self._card_sequence[card_id] = seq
        <span class="hljs-keyword">return</span> seq
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_card_entity</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span>, title: <span class="hljs-built_in">str</span> = <span class="hljs-string">"AI 助手"</span></span>) -&gt; <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""创建卡片实体，返回 card_id"""</span>
        card_data = {
            <span class="hljs-string">"schema"</span>: <span class="hljs-string">"2.0"</span>,
            <span class="hljs-string">"config"</span>: {<span class="hljs-string">"update_multi"</span>: <span class="hljs-literal">True</span>},  <span class="hljs-comment"># 共享卡片，所有人可见更新</span>
            <span class="hljs-string">"header"</span>: {<span class="hljs-string">"title"</span>: {<span class="hljs-string">"tag"</span>: <span class="hljs-string">"plain_text"</span>, <span class="hljs-string">"content"</span>: title}},
            <span class="hljs-string">"body"</span>: {
                <span class="hljs-string">"elements"</span>: [{<span class="hljs-string">"tag"</span>: <span class="hljs-string">"markdown"</span>, <span class="hljs-string">"content"</span>: content}]
            }
        }
        request = CreateCardRequest.builder() \
            .request_body(
                CreateCardRequestBody.builder()
                .<span class="hljs-built_in">type</span>(<span class="hljs-string">"card_json"</span>)
                .data(json.dumps(card_data))
                .build()
            ).build()
        
        response = self.http_client.cardkit.v1.card.create(request)
        <span class="hljs-keyword">if</span> response.success():
            <span class="hljs-keyword">return</span> response.data.card_id
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_card_content</span>(<span class="hljs-params">self, card_id: <span class="hljs-built_in">str</span>, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""更新卡片内容"""</span>
        card_data = {
            <span class="hljs-string">"schema"</span>: <span class="hljs-string">"2.0"</span>,
            <span class="hljs-string">"config"</span>: {<span class="hljs-string">"update_multi"</span>: <span class="hljs-literal">True</span>},
            <span class="hljs-string">"body"</span>: {<span class="hljs-string">"elements"</span>: [{<span class="hljs-string">"tag"</span>: <span class="hljs-string">"markdown"</span>, <span class="hljs-string">"content"</span>: content}]}
        }
        seq = self._get_next_sequence(card_id)
        
        <span class="hljs-comment"># 注意：card 参数需要 Card 对象，不是字符串</span>
        card_obj = Card.builder() \
            .<span class="hljs-built_in">type</span>(<span class="hljs-string">"card_json"</span>) \
            .data(json.dumps(card_data)) \
            .build()
        
        request = UpdateCardRequest.builder() \
            .card_id(card_id) \
            .request_body(
                UpdateCardRequestBody.builder()
                .card(card_obj)
                .sequence(seq)  <span class="hljs-comment"># 必须严格递增</span>
                .build()
            ).build()
        
        <span class="hljs-keyword">return</span> self.http_client.cardkit.v1.card.update(request).success()
</code></pre>
<h4 data-id="heading-10">3.2.2 流式更新节流</h4>
<p>Agent 输出非常快，但飞书 API 有频率限制，需要<strong>节流</strong>处理：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># agent.py - Agent 流式调用</span>

<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Callable</span>

<span class="hljs-comment"># 节流间隔（秒）- 控制更新频率</span>
UPDATE_THROTTLE_INTERVAL = <span class="hljs-number">0.5</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">make_throttled_callback</span>(<span class="hljs-params">
    do_update: <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">str</span>], <span class="hljs-literal">None</span>],
    interval: <span class="hljs-built_in">float</span> = UPDATE_THROTTLE_INTERVAL,
</span>) -&gt; <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">bool</span>], <span class="hljs-literal">None</span>]:
    <span class="hljs-string">"""
    创建带节流的回调函数
    - 每隔 interval 秒最多执行一次 do_update
    - is_last=True 时强制执行（保证最终内容同步）
    """</span>
    state = {<span class="hljs-string">"last_update_time"</span>: <span class="hljs-number">0.0</span>, <span class="hljs-string">"last_content"</span>: <span class="hljs-string">""</span>}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_chunk</span>(<span class="hljs-params">accumulated: <span class="hljs-built_in">str</span>, is_last: <span class="hljs-built_in">bool</span></span>) -&gt; <span class="hljs-literal">None</span>:
        state[<span class="hljs-string">"last_content"</span>] = accumulated <span class="hljs-keyword">or</span> <span class="hljs-string">"正在处理..."</span>
        now = time.time()
        
        <span class="hljs-comment"># 节流逻辑：间隔足够 或 最后一次</span>
        <span class="hljs-keyword">if</span> is_last <span class="hljs-keyword">or</span> (now - state[<span class="hljs-string">"last_update_time"</span>]) &gt;= interval:
            do_update(state[<span class="hljs-string">"last_content"</span>])
            state[<span class="hljs-string">"last_update_time"</span>] = now
    
    <span class="hljs-keyword">return</span> on_chunk


<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_agent_with_card</span>(<span class="hljs-params">
    plugin: <span class="hljs-string">"FeishuPlugin"</span>,
    card_id: <span class="hljs-built_in">str</span>,
    user_text: <span class="hljs-built_in">str</span>,
</span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""使用卡片进行流式更新"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_update</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        plugin.update_card_content(card_id, content)
    
    on_chunk = make_throttled_callback(do_update)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>():
        <span class="hljs-comment"># 假设 run_agent_streaming 是 Agent 的流式调用函数</span>
        final = <span class="hljs-keyword">await</span> run_agent_streaming(user_text, on_chunk)
        <span class="hljs-comment"># 兜底更新：确保最终内容已同步</span>
        do_update(final <span class="hljs-keyword">or</span> <span class="hljs-string">"处理完成"</span>)
    
    <span class="hljs-comment"># 适配事件循环</span>
    <span class="hljs-keyword">try</span>:
        loop = asyncio.get_running_loop()
        loop.create_task(_run())
    <span class="hljs-keyword">except</span> RuntimeError:
        asyncio.run(_run())
</code></pre>
<h4 data-id="heading-11">3.2.3 消息处理主逻辑</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># client.py - 主客户端</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FeishuPlugin</span>(CardMixin, MessageMixin):
    <span class="hljs-string">"""飞书机器人主类"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, app_id: <span class="hljs-built_in">str</span>, app_secret: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-comment"># ... 初始化 http_client, ws_client 等</span>
        self._card_sequence: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>] = {}  <span class="hljs-comment"># 卡片序号</span>
        self._processed_ids: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()     <span class="hljs-comment"># 消息去重</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_message</span>(<span class="hljs-params">self, message_id: <span class="hljs-built_in">str</span>, user_text: <span class="hljs-built_in">str</span>, open_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""处理用户消息"""</span>
        <span class="hljs-comment"># 1. 创建卡片实体</span>
        card_id = self.create_card_entity(<span class="hljs-string">"正在处理..."</span>, title=<span class="hljs-string">"🤖 AI 助手"</span>)
        
        <span class="hljs-keyword">if</span> card_id:
            <span class="hljs-comment"># 2. 发送卡片消息</span>
            self.send_card_message(open_id, card_id)
            <span class="hljs-comment"># 3. 启动 Agent 流式更新</span>
            run_agent_with_card(self, card_id, user_text)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># fallback: 普通消息（有编辑次数限制）</span>
            reply_id = self.send_text_message(open_id, <span class="hljs-string">"正在处理..."</span>)
            run_agent_with_message(self, reply_id, user_text)
</code></pre>
<h3 data-id="heading-12">3.3 SDK 踩坑记录</h3>
<h4 data-id="heading-13">坑 1：UpdateCardRequestBody.card 参数类型</h4>
<p><strong>错误写法</strong>：</p>
<pre><code class="hljs language-python" lang="python">UpdateCardRequestBody.builder().card(card_json_str)  <span class="hljs-comment"># ❌ 字符串</span>
</code></pre>
<p><strong>正确写法</strong>：</p>
<pre><code class="hljs language-python" lang="python">card_obj = Card.builder().<span class="hljs-built_in">type</span>(<span class="hljs-string">"card_json"</span>).data(card_json_str).build()
UpdateCardRequestBody.builder().card(card_obj)  <span class="hljs-comment"># ✅ Card 对象</span>
</code></pre>
<h4 data-id="heading-14">坑 2：sequence 必须严格递增</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误：每次都传 1</span>
.sequence(<span class="hljs-number">1</span>)  <span class="hljs-comment"># ❌ 第二次更新会失败</span>

<span class="hljs-comment"># 正确：维护递增序号</span>
seq = self._card_sequence.get(card_id, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
self._card_sequence[card_id] = seq
.sequence(seq)  <span class="hljs-comment"># ✅</span>
</code></pre>
<h4 data-id="heading-15">坑 3：asyncio.run() 不能在已有事件循环中调用</h4>
<p>WebSocket 回调已在事件循环中，再调 <code>asyncio.run()</code> 会报错：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误</span>
asyncio.run(async_func())  <span class="hljs-comment"># ❌ RuntimeError</span>

<span class="hljs-comment"># 正确</span>
<span class="hljs-keyword">try</span>:
    loop = asyncio.get_running_loop()
    loop.create_task(async_func())  <span class="hljs-comment"># 挂到现有循环</span>
<span class="hljs-keyword">except</span> RuntimeError:
    asyncio.run(async_func())  <span class="hljs-comment"># 无循环时新建</span>
</code></pre>
<h2 data-id="heading-16">四、最佳实践总结</h2>
<h3 data-id="heading-17">4.1 架构设计</h3>





















<table><thead><tr><th>原则</th><th>说明</th></tr></thead><tbody><tr><td><strong>职责分离</strong></td><td>卡片、消息、Agent 调用拆分为独立模块</td></tr><tr><td><strong>Mixin 模式</strong></td><td>功能模块通过 Mixin 组合到主类</td></tr><tr><td><strong>优雅降级</strong></td><td>卡片创建失败时 fallback 到普通消息</td></tr></tbody></table>
<h3 data-id="heading-18">4.2 流式更新</h3>





















<table><thead><tr><th>策略</th><th>实现</th></tr></thead><tbody><tr><td><strong>节流</strong></td><td>每 0.5s 最多更新一次，避免打爆 API</td></tr><tr><td><strong>兜底</strong></td><td>流式结束后强制同步最终内容</td></tr><tr><td><strong>序号管理</strong></td><td>维护 <code>card_id → sequence</code> 映射，严格递增</td></tr></tbody></table>
<h3 data-id="heading-19">4.3 异常处理</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[收到用户消息] --&gt; B{创建卡片成功?}
    B --&gt;|是| C[发送卡片消息]
    B --&gt;|否| D[发送文本消息]
    C --&gt; E[启动 Agent]
    D --&gt; F[启动 Agent - fallback 模式]
    E --&gt; G{更新失败?}
    G --&gt;|是| H[记录日志, 继续]
    G --&gt;|否| I[继续更新]
    F --&gt; J[可能触发编辑上限]
</code></pre>
<h2 data-id="heading-20">五、总结</h2>





























<table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td>消息编辑次数上限</td><td>改用卡片实体 + CardKit API</td></tr><tr><td>Agent 输出过快</td><td>节流回调，0.5s 更新一次</td></tr><tr><td>最终内容可能丢失</td><td>流式结束后兜底更新</td></tr><tr><td>SDK 参数类型坑</td><td>Card 对象而非字符串</td></tr><tr><td>异步上下文冲突</td><td>判断是否已有事件循环</td></tr></tbody></table>
<p>这套方案已在生产环境稳定运行，支持 Agent 输出上万字的长文本，更新次数不受限制。</p>
<hr/>
<h2 data-id="heading-21">附录：相关 API 文档</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fdocument%2FuAjLw4CM%2FukTMukTMukTM%2Fcardkit-v1%2Fcard%2Fcreate" target="_blank" title="https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/cardkit-v1/card/create" ref="nofollow noopener noreferrer">创建卡片实体</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fdocument%2FuAjLw4CM%2FukTMukTMukTM%2Fcardkit-v1%2Fcard%2Fupdate" target="_blank" title="https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/cardkit-v1/card/update" ref="nofollow noopener noreferrer">更新卡片实体</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fdocument%2FuAjLw4CM%2FukzMukzMukzM%2Ffeishu-cards%2Fcard-json-v2-structure" target="_blank" title="https://open.feishu.cn/document/uAjLw4CM/ukzMukzMukzM/feishu-cards/card-json-v2-structure" ref="nofollow noopener noreferrer">卡片 JSON 2.0 结构</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fdocument%2FuAjLw4CM%2FukzMukzMukzM%2Ffeishu-cards%2Fstreaming-updates-openapi-overview" target="_blank" title="https://open.feishu.cn/document/uAjLw4CM/ukzMukzMukzM/feishu-cards/streaming-updates-openapi-overview" ref="nofollow noopener noreferrer">流式更新卡片</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[结构化并发：告别线程泄露的优雅方案]]></title>    <link>https://juejin.cn/post/7600863478929621011</link>    <guid>https://juejin.cn/post/7600863478929621011</guid>    <pubDate>2026-01-30T09:52:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600863478929621011" data-draft-id="7600990891206836251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="结构化并发：告别线程泄露的优雅方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T09:52:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桦说编程"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            结构化并发：告别线程泄露的优雅方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桦说编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:52:51.000Z" title="Fri Jan 30 2026 09:52:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是桦说编程。</p>
<blockquote>
<p>本文深入分析传统并发模型中 <code>Future.get()</code> 超时导致的线程泄露问题，并介绍结构化并发（Structured Concurrency）如何从根本上解决这一痛点。</p>
</blockquote>
<h2 data-id="heading-0">问题背景</h2>
<p>在高并发系统中，我们经常使用 <code>ExecutorService</code> 提交异步任务，然后通过 <code>Future.get(timeout)</code> 获取结果。看似合理的代码，却隐藏着一个致命问题——<strong>线程泄露</strong>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
Future&lt;String&gt; future = executor.submit(() -&gt; {
    <span class="hljs-comment">// 模拟慢速操作，如调用外部服务</span>
    Thread.sleep(<span class="hljs-number">5000</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"result"</span>;
});

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 超时 100ms 后放弃等待</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> future.get(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
} <span class="hljs-keyword">catch</span> (TimeoutException e) {
    <span class="hljs-comment">// 超时了，但任务还在后台运行！</span>
    log.warn(<span class="hljs-string">"Request timeout"</span>);
}
</code></pre>
<p><strong>问题核心</strong>：<code>Future.get()</code> 超时只是放弃了等待，<strong>底层任务仍在线程池中继续执行</strong>。</p>
<h2 data-id="heading-1">线程泄露的三种典型场景</h2>
<h3 data-id="heading-2">场景一：Future.get() 超时不取消</h3>
<p>这是最常见的情况。调用方设置了超时，但超时后只是 catch 异常继续执行，任务本身仍占用线程资源。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：超时后任务继续运行</span>
<span class="hljs-keyword">try</span> {
    result = future.get(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
} <span class="hljs-keyword">catch</span> (TimeoutException e) {# 结构化并发：告别线程泄露的优雅方案

大家好，我是桦说编程。

&gt; 本文深入分析传统并发模型中 `Future.get()` 超时导致的线程泄露问题，并介绍结构化并发（Structured Concurrency）如何从根本上解决这一痛点。

## 问题背景

在高并发系统中，我们经常使用 `ExecutorService` 提交异步任务，然后通过 `Future.get(timeout)` 获取结果。看似合理的代码，却隐藏着一个致命问题——**线程泄露**。

```java
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
Future&lt;String&gt; future = executor.submit(() -&gt; {
    <span class="hljs-comment">// 模拟慢速操作，如调用外部服务</span>
    Thread.sleep(<span class="hljs-number">5000</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"result"</span>;
});

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 超时 100ms 后放弃等待</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> future.get(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
} <span class="hljs-keyword">catch</span> (TimeoutException e) {
    <span class="hljs-comment">// 超时了，但任务还在后台运行！</span>
    log.warn(<span class="hljs-string">"Request timeout"</span>);
}
</code></pre>
<p><strong>问题核心</strong>：<code>Future.get()</code> 超时只是放弃了等待，<strong>底层任务仍在线程池中继续执行</strong>。</p>
<h2 data-id="heading-3">线程泄露的三种典型场景</h2>
<h3 data-id="heading-4">场景一：Future.get() 超时不取消</h3>
<p>这是最常见的情况。调用方设置了超时，但超时后只是 catch 异常继续执行，任务本身仍占用线程资源。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：超时后任务继续运行</span>
<span class="hljs-keyword">try</span> {
    result = future.get(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);
} <span class="hljs-keyword">catch</span> (TimeoutException e) {
    <span class="hljs-comment">// 任务仍在后台运行，线程被占用</span>
    <span class="hljs-keyword">return</span> defaultValue;
}
</code></pre>
<h3 data-id="heading-5">场景二：cancel() 无法中断阻塞操作</h3>
<p>即使调用 <code>future.cancel(true)</code>，如果任务内部在执行不可中断的阻塞操作（如 Socket I/O），线程依然无法释放。</p>
<pre><code class="hljs language-java" lang="java">Future&lt;String&gt; future = executor.submit(() -&gt; {
    <span class="hljs-comment">// Socket 读取是不可中断的！</span>
    <span class="hljs-keyword">return</span> httpClient.execute(request);  <span class="hljs-comment">// 阻塞在网络 I/O</span>
});

future.cancel(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 无效！线程仍被阻塞</span>
</code></pre>
<h3 data-id="heading-6">场景三：异常传播断裂</h3>
<p>父任务超时退出，但子任务不知道父任务已经不需要结果，继续执行完整逻辑。</p>
<pre><code class="hljs language-java" lang="java">Future&lt;Result&gt; parentTask = executor.submit(() -&gt; {
    Future&lt;Data&gt; childTask = executor.submit(() -&gt; {
        <span class="hljs-keyword">return</span> slowDatabaseQuery();  <span class="hljs-comment">// 耗时操作</span>
    });
    <span class="hljs-keyword">return</span> process(childTask.get());
});

parentTask.get(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);  <span class="hljs-comment">// 超时</span>
<span class="hljs-comment">// parentTask 超时了，但 childTask 仍在执行数据库查询！</span>
</code></pre>
<h2 data-id="heading-7">线程泄露的危害</h2>
<p>在生产环境中，线程泄露会导致：</p>
<ol>
<li><strong>线程池耗尽</strong>：所有线程被"僵尸任务"占用，新请求无法执行</li>
<li><strong>系统响应变慢</strong>：线程切换开销增大，CPU 利用率飙升</li>
<li><strong>内存泄露</strong>：任务持有的对象无法被 GC 回收</li>
<li><strong>级联故障</strong>：下游服务超时 → 线程积压 → 上游超时 → 全链路雪崩</li>
</ol>
<h2 data-id="heading-8">传统解决方案的局限</h2>
<h3 data-id="heading-9">方案一：手动 cancel</h3>
<pre><code class="hljs language-java" lang="java">Future&lt;String&gt; future = executor.submit(task);
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> future.get(timeout, TimeUnit.MILLISECONDS);
} <span class="hljs-keyword">catch</span> (TimeoutException e) {
    future.cancel(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 尝试取消</span>
    <span class="hljs-keyword">throw</span> e;
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 问题：cancel 可能无效</span>
}
</code></pre>
<p><strong>局限</strong>：<code>cancel(true)</code> 依赖任务内部正确响应中断，很多三方库并不支持。</p>
<h3 data-id="heading-10">方案二：ExecutorService.invokeAll</h3>
<pre><code class="hljs language-java" lang="java">List&lt;Callable&lt;String&gt;&gt; tasks = Arrays.asList(task1, task2, task3);
List&lt;Future&lt;String&gt;&gt; futures = executor.invokeAll(tasks, timeout, TimeUnit.MILLISECONDS);
</code></pre>
<p><strong>局限</strong>：只适用于批量任务，无法处理动态创建的子任务。</p>
<h3 data-id="heading-11">方案三：CompletableFuture.orTimeout (Java 9+)</h3>
<pre><code class="hljs language-java" lang="java">CompletableFuture.supplyAsync(() -&gt; slowOperation())
    .orTimeout(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS)
    .exceptionally(ex -&gt; defaultValue);
</code></pre>
<p><strong>局限</strong>：超时后底层任务仍在执行，只是不再等待结果。</p>
<h2 data-id="heading-12">结构化并发：根本性解决方案</h2>
<p><strong>结构化并发（Structured Concurrency）</strong> 的核心思想是：<strong>让并发任务的生命周期与代码块的作用域绑定</strong>。就像结构化编程让控制流有明确的入口和出口，结构化并发让并发任务也有明确的开始和结束边界。</p>
<h3 data-id="heading-13">核心原则</h3>
<ol>
<li><strong>任务作用域</strong>：所有子任务必须在父任务的作用域内完成</li>
<li><strong>自动取消传播</strong>：父任务取消时，所有子任务自动取消</li>
<li><strong>异常聚合</strong>：子任务的异常能正确传播到父任务</li>
<li><strong>资源自动清理</strong>：作用域结束时，确保所有资源被释放</li>
</ol>
<h3 data-id="heading-14">Java 21 StructuredTaskScope</h3>
<p>Java 21 正式引入了 <code>StructuredTaskScope</code>（JEP 453），提供了结构化并发的原生支持：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
    Subtask&lt;String&gt; user = scope.fork(() -&gt; fetchUser(userId));
    Subtask&lt;List&lt;Order&gt;&gt; orders = scope.fork(() -&gt; fetchOrders(userId));

    scope.joinUntil(Instant.now().plusMillis(<span class="hljs-number">100</span>));  <span class="hljs-comment">// 超时控制</span>
    scope.throwIfFailed();  <span class="hljs-comment">// 任一失败则抛异常</span>

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserProfile</span>(user.get(), orders.get());
}
<span class="hljs-comment">// 离开 try 块时，所有未完成的子任务自动取消！</span>
</code></pre>
<p><strong>关键优势</strong>：</p>
<ul>
<li><code>fork()</code> 创建的任务绑定到 scope 的生命周期</li>
<li><code>joinUntil()</code> 超时后，scope 关闭会自动取消所有子任务</li>
<li>try-with-resources 确保资源释放</li>
</ul>
<h3 data-id="heading-15">对比传统方式</h3>



































<table><thead><tr><th>特性</th><th>传统 Future</th><th>结构化并发</th></tr></thead><tbody><tr><td>超时取消</td><td>需手动 cancel</td><td>自动取消</td></tr><tr><td>子任务管理</td><td>无关联</td><td>生命周期绑定</td></tr><tr><td>异常处理</td><td>容易丢失</td><td>自动聚合</td></tr><tr><td>资源清理</td><td>需手动处理</td><td>自动清理</td></tr><tr><td>线程泄露</td><td>容易发生</td><td>从根本杜绝</td></tr></tbody></table>
<h2 data-id="heading-16">Java 8 环境下的结构化并发实现</h2>
<p>由于很多项目仍在使用 Java 8，我们可以借鉴结构化并发的思想，实现一个简化版本：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StructuredScope</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoCloseable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ExecutorService executor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Future&lt;?&gt;&gt; tasks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">shutdown</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StructuredScope</span><span class="hljs-params">(ExecutorService executor)</span> {
        <span class="hljs-built_in">this</span>.executor = executor;
    }

    <span class="hljs-keyword">public</span> &lt;R&gt; Future&lt;R&gt; <span class="hljs-title function_">fork</span><span class="hljs-params">(Callable&lt;R&gt; task)</span> {
        <span class="hljs-keyword">if</span> (shutdown.get()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Scope already shutdown"</span>);
        }
        Future&lt;R&gt; future = executor.submit(() -&gt; {
            <span class="hljs-keyword">if</span> (shutdown.get()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CancellationException</span>(<span class="hljs-string">"Scope shutdown"</span>);
            }
            <span class="hljs-keyword">return</span> task.call();
        });
        tasks.add(future);
        <span class="hljs-keyword">return</span> future;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">joinAll</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> TimeoutException {
        <span class="hljs-type">long</span> <span class="hljs-variable">deadline</span> <span class="hljs-operator">=</span> System.nanoTime() + unit.toNanos(timeout);
        <span class="hljs-keyword">for</span> (Future&lt;?&gt; task : tasks) {
            <span class="hljs-type">long</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> deadline - System.nanoTime();
            <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
                shutdown();
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimeoutException</span>(<span class="hljs-string">"Scope timeout"</span>);
            }
            <span class="hljs-keyword">try</span> {
                task.get(remaining, TimeUnit.NANOSECONDS);
            } <span class="hljs-keyword">catch</span> (TimeoutException e) {
                shutdown();
                <span class="hljs-keyword">throw</span> e;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-comment">// 记录但继续等待其他任务</span>
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (shutdown.compareAndSet(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) {
            <span class="hljs-keyword">for</span> (Future&lt;?&gt; task : tasks) {
                task.cancel(<span class="hljs-literal">true</span>);
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        shutdown();
    }
}
</code></pre>
<p>使用方式：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (StructuredScope&lt;String&gt; scope = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredScope</span>&lt;&gt;(executor)) {
    Future&lt;String&gt; user = scope.fork(() -&gt; fetchUser(userId));
    Future&lt;List&lt;Order&gt;&gt; orders = scope.fork(() -&gt; fetchOrders(userId));

    scope.joinAll(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserProfile</span>(user.get(), orders.get());
}
<span class="hljs-comment">// 超时或异常时，所有任务自动取消</span>
</code></pre>
<h2 data-id="heading-17">最佳实践</h2>
<h3 data-id="heading-18">1. 任务内部正确响应中断</h3>
<pre><code class="hljs language-java" lang="java">executor.submit(() -&gt; {
    <span class="hljs-keyword">while</span> (!Thread.currentThread().isInterrupted()) {
        <span class="hljs-comment">// 处理逻辑</span>
        <span class="hljs-keyword">if</span> (Thread.interrupted()) {
            cleanup();
            <span class="hljs-keyword">return</span>;
        }
    }
});
</code></pre>
<h3 data-id="heading-19">2. 设置合理的超时层级</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 外层超时 &gt; 内层超时，留出取消的时间窗口</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredScope</span>(executor)) {
    Future&lt;A&gt; a = scope.fork(() -&gt; callServiceA(innerTimeout));
    Future&lt;B&gt; b = scope.fork(() -&gt; callServiceB(innerTimeout));
    scope.joinAll(outerTimeout, TimeUnit.MILLISECONDS);
}
</code></pre>
<h2 data-id="heading-20">总结</h2>
<ul>
<li><strong>线程泄露根因</strong>：<code>Future.get()</code> 超时只放弃等待，不取消任务；<code>cancel()</code> 依赖任务响应中断</li>
<li><strong>结构化并发核心</strong>：让任务生命周期与代码作用域绑定，作用域结束时自动取消所有任务。可以视为黑盒。</li>
<li><del><strong>Java 21+ 推荐</strong>：使用 <code>StructuredTaskScope</code> 原生支持</del></li>
<li><strong>关键实践</strong>：任务内部必须正确响应中断，使用可中断的 I/O 操作</li>
</ul>
<hr/>
<p>如果这篇文章对你有帮助，欢迎关注我，持续分享高质量技术干货，助你更快提升编程能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码签名证书：数字化时代软件安全的必然趋势]]></title>    <link>https://juejin.cn/post/7600622206269554698</link>    <guid>https://juejin.cn/post/7600622206269554698</guid>    <pubDate>2026-01-30T01:24:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206269554698" data-draft-id="7600674821307842596" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码签名证书：数字化时代软件安全的必然趋势"/> <meta itemprop="keywords" content="算法,架构"/> <meta itemprop="datePublished" content="2026-01-30T01:24:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JoySSL数字加密证书"/> <meta itemprop="url" content="https://juejin.cn/user/4162089392540587"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码签名证书：数字化时代软件安全的必然趋势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4162089392540587/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JoySSL数字加密证书
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:24:10.000Z" title="Fri Jan 30 2026 01:24:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>从日常使用的手机应用，到企业依赖的业务系统，软件的广泛应用极大地提升了效率与便利性。然而，软件安全问题却如影随形，恶意软件、代码篡改等威胁层出不穷，给用户和企业带来了巨大的损失。</p>
<p>2025年全年，全球因软件安全漏洞导致的经济损失超过1.8万亿美元，同比增长15%，其中恶意软件攻击事件占比高达42%。在这样的背景下，代码签名证书作为保障软件安全的核心工具，已逐渐成为数字化时代的标配，而国内知名数字证书品牌     [JoySSL] 凭借其专业能力和本地化服务，正引领着代码签名证书行业的发展。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d67f26a7f3104d8b91131a320d24552f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm95U1NM5pWw5a2X5Yqg5a-G6K-B5Lmm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770370181&amp;x-signature=u9iF9DcjXb%2FIkDPim2m7bflPqSs%3D" alt="代码签名.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">一、代码签名证书：软件安全的“数字身份证”</h2>
<h3 data-id="heading-1">1.1 核心原理与功能</h3>
<p>代码签名证书是一种由受信任的证书颁发机构（CA）签发的数字证书，它允许开发者对应用程序代码进行签名，以验证软件的完整性和来源。当用户下载或安装应用程序时，操作系统能够通过代码签名来确认该应用程序是由合法的开发者创建的，并且在传输过程中没有被篡改。</p>
<p>其工作原理基于公钥密码学体系：开发者使用私钥对软件的哈希值进行加密，生成数字签名。用户在下载软件时，操作系统会使用公钥对数字签名进行解密，并重新计算软件的哈希值，与签名中的哈希值进行比对。如果两者一致，则证明软件未被篡改，来源可信；反之则会触发安全警告。</p>
<h3 data-id="heading-2">1.2 类型与适用场景</h3>
<p>代码签名证书主要分为标准OV代码签名证书和EV扩展验证代码签名证书。OV证书通过验证企业身份，为软件提供基础的可信标识，适用于大多数通用软件；EV证书则采用更严格的身份审核流程，且私钥存储在硬件加密设备中，安全性更高，适合金融、政务等对安全要求极高的行业场景。</p>
<p>例如，微软等平台要求驱动程序提交前必须使用代码签名证书进行签名，并指定使用SHA256算法，自2016年起逐步淘汰SHA1算法。国内智能家居企业小米在其IoT设备固件发布中，全面采用EV代码签名证书，有效防止了固件被篡改和恶意植入，保障了5000万以上设备的安全运行。</p>
<h2 data-id="heading-3">二、代码签名证书成为软件安全刚需的三大原因</h2>
<h3 data-id="heading-4">2.1 遏制恶意软件传播，守护用户安全</h3>
<p>在软件市场中，存在着大量伪装成合法软件的恶意程序，它们可能窃取用户的个人信息、破坏系统数据甚至控制用户的设备。通过代码签名，用户可以轻松识别出这些恶意软件，避免下载和安装，从而大大降低感染风险。</p>
<p>2025年，国内某办公软件开发商曾因未使用代码签名证书，导致软件被黑客篡改并植入窃密模块，超10万用户账号信息泄露，企业不仅赔偿用户损失超500万元，还流失了30%的客户。启用代码签名证书后，软件篡改尝试均被系统拦截，未再发生安全事故，成功守住代码安全防线。</p>
<h3 data-id="heading-5">2.2 构建信任体系，提升软件分发效率</h3>
<p>许多操作系统和浏览器在打开未签名的应用程序时，都会展示“未知发布者”的警告信息，这会导致70%以上的用户放弃安装。而拥有签名的软件则可以绕过这些警告，提供更流畅的安装体验。某SaaS企业使用EV代码签名证书后，企业客户的安装转化率提升了45%，用户咨询量减少了30%。</p>
<p>此外，时间戳功能可确保证书过期后已签名代码仍有效，避免了因证书到期导致已发布软件无法正常运行的问题。</p>
<h3 data-id="heading-6">2.3 满足合规要求，规避法律风险</h3>
<p>随着《网络安全法》《数据安全法》等法律法规的不断完善，软件安全合规已成为企业运营的底线要求。例如，金融行业的软件必须通过等保三级以上认证，而代码签名证书是等保认证的必要条件之一。</p>
<p>2025年，国内某P2P平台因未对其客户端软件进行代码签名，被监管部门处以200万元罚款，并要求限期整改。而使用JoySSL代码签名证书的企业，在合规审核中通过率高达98%。</p>
<h2 data-id="heading-7">三、JoySSL：国内代码签名证书行业标杆</h2>
<h3 data-id="heading-8">3.1 本土化服务优势</h3>
<p>作为国内领先的数字证书服务商，JoySSL深知国内企业的需求与痛点。与国际品牌相比，JoySSL提供7*24小时中文技术支持，响应速度提升60%，证书申请周期缩短至1-3个工作日，远快于国际品牌的5-7个工作日。</p>
<p>针对国内企业对国密算法的需求，JoySSL率先推出支持SM2/SM3/SM4国密算法的代码签名证书，满足了金融、政务等领域的合规要求。目前，已有超过300家政府机构和央企选择JoySSL的国密代码签名证书服务。</p>
<h3 data-id="heading-9">3.2 全场景安全解决方案</h3>
<p>JoySSL为企业提供从证书申请、部署到管理的全生命周期服务。其自主研发的证书管理平台，支持一键批量签名、证书到期自动提醒等功能，帮助企业提升管理效率。同时，JoySSL与国内主流应用商店（如华为应用市场、小米应用商店）达成合作，为开发者提供签名快速审核通道，缩短应用上线时间。</p>
<h3 data-id="heading-10">3.3 行业案例与客户口碑</h3>
<p>安徽本地制造业巨头江淮汽车，在其车联网系统开发中采用JoySSL的EV代码签名证书，实现了对车载软件全生命周期的安全管控，有效防止了固件篡改和远程攻击，保障了百万级车辆的数据安全。</p>
<p>截至2026年1月，JoySSL已为国内超过2万家企业提供代码签名证书服务，客户满意度高达96.8%。在Gartner 2025年国内数字证书服务商排名中，JoySSL凭借其创新能力和客户服务，跻身前三。</p>
<h2 data-id="heading-11">四、代码签名证书未来发展趋势</h2>
<h3 data-id="heading-12">4.1 自动化与智能化</h3>
<p>随着DevOps模式的普及，代码签名将融入软件开发流水线，实现自动化签名。JoySSL已推出与GitLab、Jenkins等CI/CD工具的集成方案，支持代码提交后自动完成签名，提升开发效率。</p>
<h3 data-id="heading-13">4.2 多场景融合</h3>
<p>代码签名将与区块链技术结合，实现签名信息的不可篡改和可追溯。未来，用户通过区块链浏览器即可查询软件的签名历史和开发者信息，进一步提升信任度。</p>
<h3 data-id="heading-14">4.3 零信任架构适配</h3>
<p>在零信任架构下，代码签名将作为身份验证的重要环节，实现对软件的动态信任评估。JoySSL正与国内零信任解决方案厂商合作，打造基于代码签名的零信任安全体系。</p>
<h2 data-id="heading-15"/>
<p>在数字化时代，软件安全已不再是可选选项，而是企业生存和发展的必要条件。代码签名证书作为软件安全的“数字身份证”，不仅能有效防止恶意软件传播、提升用户信任，还能帮助企业满足合规要求。</p>
<p>JoySSL凭借其本土化服务优势和全场景解决方案，正在成为国内企业保障软件安全的首选合作伙伴。未来，随着技术的不断演进，代码签名证书将在构建可信软件生态中发挥更加重要的作用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的2025：TRAE帮我圆梦开发的VibeCoding时光]]></title>    <link>https://juejin.cn/post/7598587406708064297</link>    <guid>https://juejin.cn/post/7598587406708064297</guid>    <pubDate>2026-01-25T12:45:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406708064297" data-draft-id="7598744870995427371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的2025：TRAE帮我圆梦开发的VibeCoding时光"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-25T12:45:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鼓掌MVP"/> <meta itemprop="url" content="https://juejin.cn/user/3009786736020724"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的2025：TRAE帮我圆梦开发的VibeCoding时光
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3009786736020724/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鼓掌MVP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:45:30.000Z" title="Sun Jan 25 2026 12:45:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e3d64677984768b6983c87bc2fc3a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=GC3RCvLXe%2F5GZj9Uc4qSBubitag%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/112c25d09b494a1d9a2a002a37c676ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=1hO7T8fIXtwmC3vl455adaGRYJc%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>2025年，对我而言是充满技术探索与创意实践的一年。这一年，我与TRAE相遇，它像一把钥匙，为我打开了创意与技术融合的大门。</p>
<p>从旅游札记到游戏开发，从生活助手到社交管理，TRAE与MCP的组合以其强大的AI辅助编程和服务整合能力，让我这个前端开发者能够轻松将创意变为现实。现在，就让我回顾这段与TRAE和MCP相伴的精彩时光。</p>
<h2 data-id="heading-1">一、TRAE赋能的创意项目</h2>
<h3 data-id="heading-2">1. AI驱动的旅游札记生成器：MCP能力的完美展示</h3>
<p>作为一个热爱旅行的人，我一直困扰于旅行后整理照片和撰写游记的繁琐。2025年，我利用TRAE Builder+MCP服务开发了一个AI驱动的旅游札记生成器，彻底解决了这个问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7bd65cfb6d46248a8e96d2dab1caf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=uXGl4adc%2FGswzx9UYHQ3c06PIVY%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa3f24946744cf6b2c7dc349c08300e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=c3i4BMKwg%2B9rN%2BQuVKWXiwkZYps%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这个应用的神奇之处在于：只需输入旅行的基本信息和照片，它就能自动分析照片内容，结合地理位置信息，生成风格多样、内容丰富的旅行札记。更令人惊喜的是，它还支持Markdown、HTML、PDF等多种格式导出，让我的旅行记忆能够以各种形式保存和分享。</p>
<p>MCP服务在这里发挥了核心作用：</p>
<ul>
<li><strong>图像分析MCP</strong>：像一位专业的视觉解读师，智能识别照片中的场景、物体、人物和氛围，甚至能捕捉到照片中的情感色彩，为游记增添生动的描述。</li>
<li><strong>高德地图MCP</strong>：将普通地址精准转换为经纬度坐标，不仅能在地图上标记旅行足迹，还能智能搜索周边的隐藏景点和特色美食，为旅行故事增添惊喜元素。</li>
<li><strong>文本生成MCP</strong>：结合所有分析结果，生成风格各异的旅行故事，从文艺小清新到深度旅行感悟，满足不同场景的表达需求。</li>
</ul>
<p>通过这些MCP服务的无缝整合，最终生成的旅行故事个性化十足，细节丰富，情感真挚，比我自己写的还要精彩。这让我深刻体会到，MCP不仅是技术工具，更是创意的放大器。</p>
<h3 data-id="heading-3">2. 基于MCP与Trae框架的"人情账本"系统：智能社交管理的新范式</h3>
<p>中国人的社交往来中，"人情"是一个重要的组成部分。但随着时间推移，事务繁杂，很难记得清这些往来账。为此，我利用TRAE的Vibe Coding开发能力，结合MCP技术，开发了一个"人情账本"系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61cbd800f1584a55911082a739261a68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=5ZsNzU5%2FsgybGF5cXrLsx7qZSEs%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7790eafa19114ae2b2e384dc3211e9f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=%2BNA%2FQrET7GDw5WxhyYcgTFbzQ8I%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这个系统的核心特点是支持自然语言管理人际往来，让用户能够轻松记录和查询社交账目。无论是收到的红包，还是需要随份子的庆典，都能通过简单的语言描述快速记录，从此人际往来不再头疼。</p>
<p>MCP技术在这里的应用让系统更加智能：</p>
<ul>
<li><strong>自然语言处理MCP</strong>：理解用户的自然语言输入，自动提取关键信息（如人物、金额、事件类型、日期等），将非结构化的语言描述转化为结构化的数据记录。</li>
<li><strong>数据存储与分析MCP</strong>：安全存储用户的社交往来数据，并提供智能分析功能，如往来频次统计、金额分析、关系网络图等，帮助用户更好地理解自己的社交网络。</li>
<li><strong>提醒服务MCP</strong>：根据历史数据和时间节点，智能提醒用户重要的社交事件，如朋友的生日、纪念日等，避免因疏忽而错过重要的社交场合。</li>
</ul>
<p>通过这些MCP服务的整合，"人情账本"系统不仅解决了实际问题，还为用户提供了全新的社交管理体验。这让我意识到，MCP的价值在于它能够将复杂的技术能力封装为简单易用的服务，让开发者能够专注于解决用户问题。</p>
<h3 data-id="heading-4">3. 智能睡眠助手Agent：MCP驱动的健康管理</h3>
<p>由于工作压力，我曾经常遭受失眠的困扰，早上醒来总是头疼不已。意识到这个问题后，我想到了用TRAE的AI智能体功能结合MCP服务开发一个睡眠助手。</p>
<p>虽然最初只是抱着尝试的心态，但TRAE与MCP的组合让我惊喜不已。通过与睡眠助手的交流，它能够分析我的睡眠习惯，提供个性化的睡眠建议，甚至通过放松音乐和冥想指导帮助我改善睡眠质量。这个小小的工具，成为了我2025年最贴心的健康伙伴。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7d168f4391f4266b4cc454c16055dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=IkpsJynwo89yBJnmb3E7B9kPkc8%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>MCP服务在这里的应用让睡眠助手更加智能和实用：</p>
<ul>
<li><strong>语音交互MCP</strong>：提供自然流畅的语音对话能力，让我能够在睡前放松状态下与助手交流，无需动手操作。</li>
<li><strong>数据分析MCP</strong>：记录和分析我的睡眠数据，包括入睡时间、睡眠时长、睡眠质量等，生成详细的睡眠报告，帮助我了解自己的睡眠状况。</li>
<li><strong>内容生成MCP</strong>：根据我的偏好和当前状态，生成个性化的放松音乐和冥想指导，帮助我更快进入睡眠状态。</li>
<li><strong>健康建议MCP</strong>：结合睡眠数据和个人情况，提供科学的睡眠建议，如调整作息时间、改善睡眠环境等，帮助我建立健康的睡眠习惯。</li>
</ul>
<p>通过这些MCP服务的整合，智能睡眠助手不仅是一个简单的应用，更是一个个性化的健康管理专家。这让我认识到，MCP技术在健康领域有着巨大的应用潜力，能够为人们的生活带来实质性的改善。</p>
<h3 data-id="heading-5">4. 碰碰车吃豆大战游戏：MCP增强的游戏体验</h3>
<p>游戏开发一直是我的兴趣所在，但传统的游戏开发流程复杂且耗时。2025年，我利用Trae对话式编程，结合HTML5 Canvas技术和MCP服务，开发了一款碰碰车吃豆大战游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8b9e7aa4bd848b68f8b69fbe9d738df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=PkG1BOkh3jbQDftpcDL4w8gnjg4%3D" alt="pp.gif" loading="lazy"/></p>
<p>这是一款休闲竞技游戏，玩家控制一辆碰碰车与其他AI对手在地图上争夺资源。游戏实现了爽快的物理碰撞体验、智能的AI对手行为、随机生成的奖励系统和实时计分排行榜。整个开发过程中，TRAE的代码生成和优化能力让我能够在短时间内实现复杂的游戏逻辑和AI行为，而MCP服务则为游戏增添了更多精彩特性。</p>
<p>MCP服务在这里的应用让游戏更加丰富和智能：</p>
<ul>
<li><strong>AI行为MCP</strong>：为游戏中的AI对手提供智能决策能力，使它们能够评估地图上的资源价值，选择最优目标，甚至能够学习玩家的游戏风格并调整策略。</li>
<li><strong>音效MCP</strong>：根据游戏场景和玩家操作，生成动态的音效和背景音乐，增强游戏的沉浸感和趣味性。</li>
<li><strong>数据分析MCP</strong>：记录玩家的游戏数据，如游戏时长、得分、常用策略等，生成个人游戏报告，帮助玩家了解自己的游戏风格和改进方向。</li>
<li><strong>社交分享MCP</strong>：提供便捷的游戏成绩分享功能，让玩家能够轻松将自己的精彩表现分享到社交平台，增加游戏的社交属性。</li>
</ul>
<p>通过这些MCP服务的整合，碰碰车吃豆大战游戏不仅具有出色的游戏体验，还具备了智能和社交特性。这让我意识到，MCP技术能够为游戏开发带来全新的可能性，让游戏更加智能、个性化和社交化。</p>
<h3 data-id="heading-6">5. "猫鼠大作战"小游戏：MCP助力的快速开发</h3>
<p>作为一名前端开发者，我一直希望能够快速实现自己的游戏创意。2025年，我尝试了豆包AI+Trae IDE+MCP的组合，仅用一句话就开发了"猫鼠大作战"网页小游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7501824bf044355a77d8a047a5ea960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=fofUbk7PLiAk6rXrwsC61xcTEf4%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>整个开发过程始于一个简单的需求描述："帮我开发一个猫捉老鼠的网页小游戏"。豆包AI通过智能分析和代码生成，快速实现了游戏的基本框架，而MCP服务则为游戏增添了更多智能特性。最终的游戏包含了键盘和触摸控制、动态难度系统、智能的老鼠AI和响应式设计，能够在不同设备上提供良好的游戏体验。</p>
<p>MCP服务在这里的应用让游戏开发更加高效和智能：</p>
<ul>
<li><strong>游戏逻辑MCP</strong>：提供预设的游戏逻辑模块，如碰撞检测、AI行为、计分系统等，大大减少了手动编写代码的工作量。</li>
<li><strong>多设备适配MCP</strong>：自动生成适配不同设备的代码，确保游戏在PC、平板和手机上都能提供良好的体验，无需手动编写复杂的响应式代码。</li>
<li><strong>性能优化MCP</strong>：根据游戏的具体情况，自动优化代码结构和资源加载策略，确保游戏在各种设备上都能流畅运行。</li>
<li><strong>用户体验MCP</strong>：提供游戏教程、难度调整、成就系统等通用游戏功能模块，让游戏更加完整和专业。</li>
</ul>
<p>通过这些MCP服务的整合，"猫鼠大作战"小游戏的开发时间大大缩短，而游戏质量却得到了保证。这让我深刻体会到，MCP技术是快速原型开发和创意验证的强大工具，能够让开发者在短时间内将创意变为现实。</p>
<h2 data-id="heading-7">二、TRAE的2025年更新变迁</h2>
<p>2025年是TRAE快速发展的一年，在这一年里，TRAE推出了多项重要更新，不断提升开发者体验和能力。这些更新不仅丰富了TRAE的功能，也为VibeCoding的实践提供了更加强大的支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401244d4976848f693805c2cd1d1aada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=G6zrm7MC6eaS8fS6vXYrxZsPhyg%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>作为一个受益匪浅的开发者，感谢TRAE的陪伴，也感谢无数工作人员背后默默的付出！</p>
<h3 data-id="heading-8">2.1 TRAE插件系统的推出</h3>
<p>年初，TRAE正式推出了插件系统，为开发者提供了扩展TRAE功能的全新方式。插件系统的核心价值在于：</p>
<ul>
<li><strong>功能扩展</strong>：开发者可以通过安装和开发插件，为TRAE添加新的功能和能力，如特定领域的代码生成、自定义MCP服务集成等。</li>
<li><strong>个性化定制</strong>：每个开发者都可以根据自己的工作流程和偏好，定制TRAE的界面和功能，打造专属的开发环境。</li>
<li><strong>社区生态</strong>：插件系统催生了活跃的开发者社区，开发者可以分享自己开发的插件，也可以从社区获取他人开发的优质插件，共同丰富TRAE的功能生态。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adbb33f0b0064e9e8b4005cb9264d3a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=qgtn45wYpqLzXkTFdMMq6JXU%2FLQ%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>作为前端开发者，我还特别喜欢前端相关的插件，如React组件生成插件、Tailwind CSS智能提示插件等，这些插件大大提高了我的开发效率。</p>
<h3 data-id="heading-9">2.2 TRAE Builder的全面升级</h3>
<p>年中，TRAE Builder迎来了重大升级，从一个简单的项目生成工具进化为功能强大的可视化开发平台：</p>
<ul>
<li><strong>可视化界面设计</strong>：新增了拖拽式界面设计器，开发者可以通过可视化操作创建和编辑UI界面，无需手动编写HTML和CSS代码。</li>
<li><strong>流程编排能力</strong>：提供了直观的流程编排工具，开发者可以通过拖拽和连接不同的节点，构建复杂的业务逻辑和工作流程。</li>
<li><strong>MCP服务可视化配置</strong>：支持通过可视化界面配置和管理MCP服务，大大降低了MCP服务的使用门槛。</li>
<li><strong>多平台发布</strong>：内置了多平台发布功能，开发者可以一键将应用发布到Web、移动端、桌面端等多个平台，无需为不同平台单独开发。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32607827bc984b00a36daad4a8161028~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=jJu9%2FKOHU60gVXruo44crp%2Bbeic%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>TRAE Builder的升级，让我能够更加高效地构建完整的应用，从界面设计到功能实现，都可以在一个统一的平台上完成，大大简化了开发流程。</p>
<h3 data-id="heading-10">2.3 SOLO模式的创新</h3>
<p>下半年，TRAE推出了全新的SOLO模式，为个人开发者提供了更加专注和高效的开发环境：</p>
<ul>
<li><strong>沉浸式开发体验</strong>：SOLO模式提供了极简的界面设计，移除了所有不必要的干扰元素，让开发者能够完全专注于代码和创意。</li>
<li><strong>智能上下文感知</strong>：系统能够智能感知开发者的工作上下文，自动提供相关的代码建议、文档和工具，减少了开发者的认知负担。</li>
<li><strong>离线工作能力</strong>：SOLO模式支持完全离线工作，开发者可以在没有网络连接的情况下继续开发，确保了开发工作的连续性。</li>
<li><strong>个人知识管理</strong>：内置了个人知识管理系统，自动记录和组织开发者的代码片段、解决方案和开发经验，形成个人的开发知识库。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f43a0b8fe61846eb8768fd05b0d263b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=uapHWN2PV%2FL81ydmDD1W0QG5Dlg%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这时我苦苦排队等了很久，心心念念的SOLO模式，终于用上了！还是免费的！</p>
<p>SOLO模式的推出，让我在开发过程中能够更加专注和高效，特别是在处理复杂的问题时，沉浸式的开发环境帮助我更好地集中注意力，找到最佳的解决方案。</p>
<h3 data-id="heading-11">2.4 其他重要更新</h3>
<p>除了上述重大更新外，TRAE在2025年还推出了多项其他重要更新：</p>
<ul>
<li><strong>AI能力增强</strong>：不断提升TRAE的AI理解和生成能力，支持更加复杂和抽象的需求描述，生成更加准确和高质量的代码。</li>
<li><strong>性能优化</strong>：持续优化TRAE的运行性能，减少响应时间，提高代码生成速度，确保流畅的开发体验。</li>
<li><strong>多语言支持</strong>：增加了对更多编程语言和框架的支持，扩大了TRAE的适用范围。</li>
<li><strong>安全性提升</strong>：加强了代码和数据的安全性，确保开发者的知识产权和敏感信息得到充分保护。</li>
</ul>
<p>这些更新，让TRAE在2025年实现了从工具到平台的跨越，成为了一个功能完整、生态丰富的AI辅助开发平台。作为一名前端开发者，我深刻感受到了这些更新带来的便利和效率提升，它们不仅改变了我的开发方式，也让我对编程的未来充满了期待。</p>
<h2 data-id="heading-12">三、TRAE带来的技术体验与收获</h2>
<h3 data-id="heading-13">1. 降低编程门槛，提高开发效率</h3>
<p>在与TRAE相伴的2025年，我深刻体会到了AI辅助编程如何彻底改变传统的软件开发流程。无论是复杂的旅游札记生成器，还是简单的网页小游戏，TRAE都能通过对话式编程和智能代码生成，帮助我快速实现创意。</p>
<p>这种开发方式不仅大大降低了编程门槛，让编程经验有限的我也能开发出专业级别的应用，也极大提高了开发效率，让我能够将更多精力放在创意设计和用户体验上。</p>
<h3 data-id="heading-14">2. 模块化设计与技术整合：MCP的核心价值</h3>
<p>TRAE的开发环境鼓励模块化设计，让我能够将复杂的项目分解为多个独立但相互协作的组件。这种设计方式不仅使代码结构清晰，也便于后续维护和扩展。</p>
<p>而MCP（Module Connect Platform）则是技术整合的最佳实践，它像一个智能的连接器，让不同的技术服务能够无缝协作：</p>
<ul>
<li><strong>服务封装</strong>：MCP将复杂的技术能力封装为简单易用的服务接口，开发者无需了解底层实现细节，只需关注如何使用这些服务来解决问题。</li>
<li><strong>标准化接口</strong>：MCP提供标准化的服务接口，使不同的服务能够按照统一的方式进行调用和集成，大大降低了技术整合的复杂度。</li>
<li><strong>服务编排</strong>：MCP支持服务之间的智能编排，使多个服务能够协同工作，形成更强大的复合功能。例如，在旅游札记生成器中，图像分析MCP、地图MCP和文本生成MCP的协同工作，产生了1+1+1&gt;3的效果。</li>
<li><strong>可扩展性</strong>：MCP的模块化架构使得系统具有高度的可扩展性，开发者可以根据需要轻松添加新的服务或替换现有的服务，而不会影响整个系统的稳定性。</li>
</ul>
<p>通过TRAE与MCP的结合，我能够轻松整合各种第三方服务，如图像分析、地图服务、语音识别等，为应用添加丰富的功能。这种技术整合能力，让我的项目能够站在巨人的肩膀上，实现更多可能性。</p>
<p>作为前端开发者，我尤其欣赏MCP在前端技术整合方面的能力。它不仅能够整合后端服务，还能够整合各种前端库和框架，如React、Vue、Three.js等，让前端开发更加高效和灵活。</p>
<h3 data-id="heading-15">3. 从创意到现实的快速转化：MCP的加速作用</h3>
<p>2025年，我最深的感受是：有了TRAE和MCP，创意到现实的距离变得前所未有的近。无论是突发奇想的小游戏，还是解决实际问题的工具应用，我都能通过TRAE和MCP快速将其变为现实。</p>
<p>MCP在创意转化过程中发挥了关键的加速作用：</p>
<ul>
<li><strong>快速原型</strong>：通过调用现有的MCP服务，我可以在短时间内搭建出功能完整的原型，验证创意的可行性，而不需要从零开始编写所有代码。</li>
<li><strong>功能丰富</strong>：MCP提供了丰富的服务库，涵盖了从图像处理、自然语言处理到数据分析、社交分享等各种功能，让我能够为应用添加更多高级特性，提升用户体验。</li>
<li><strong>技术兜底</strong>：MCP服务由专业团队维护和更新，确保了服务的稳定性和安全性，让我能够专注于创意设计，而不需要担心技术实现的细节和风险。</li>
<li><strong>迭代迅速</strong>：当创意需要调整时，我可以通过修改MCP服务的配置或替换不同的MCP服务，快速实现功能的变更和优化，大大缩短了迭代周期。</li>
</ul>
<p>这种快速转化的能力，让我更加勇于尝试新的创意，也让我的2025年充满了惊喜和成就感。正如那句"人人都是VibeMaker"所说，TRAE和MCP让每个人都有机会成为创意的实现者。</p>
<p>作为前端开发者，我发现MCP在前端创意转化方面尤其有价值。它不仅能够加速前端界面的开发，还能够轻松整合后端服务，让我能够独立完成从前端到后端的完整应用开发，真正实现"一个人就是一个团队"的开发效率。</p>
<h3 data-id="heading-16">4. VibeCoding：重新定义编程体验</h3>
<p>在使用TRAE和MCP的过程中，我逐渐领悟到VibeCoding的真正含义。它不仅仅是一种编程方式，更是一种全新的创意表达形式，而MCP则是VibeCoding的重要技术支撑。</p>
<p>VibeCoding的核心在于"对话式编程"，它打破了传统编程中人与机器之间的壁垒。通过自然语言交流，我可以直接向TRAE表达我的创意和需求，而不需要担心语法错误或复杂的代码结构。这种交流方式更加符合人类的思维习惯，让编程变得更加直观和愉悦。</p>
<p>而MCP则为VibeCoding提供了强大的技术后盾：</p>
<ul>
<li><strong>能力扩展</strong>：MCP为VibeCoding提供了丰富的技术能力，让开发者能够通过对话式编程调用各种高级服务，如图像处理、自然语言处理、数据分析等，大大扩展了VibeCoding的应用范围。</li>
<li><strong>复杂度管理</strong>：MCP将复杂的技术实现封装为简单的服务接口，让开发者能够通过自然语言命令轻松使用这些服务，而不需要了解底层实现的复杂度，进一步降低了编程的门槛。</li>
<li><strong>创意聚焦</strong>：MCP让开发者能够专注于问题的本质和解决方案的创意，而不是陷入繁琐的代码细节中。当我开发旅游札记生成器时，我可以专注于如何让AI更好地理解照片内容和旅行故事，而不是纠结于图像处理的具体算法；当我开发游戏时，我可以专注于游戏机制和用户体验，而不是担心碰撞检测的实现细节。</li>
</ul>
<p>这种思维方式的转变，让我对编程有了全新的认识。编程不再是一种技术门槛，而是一种创意表达的工具。每个人都可以通过VibeCoding和MCP，将自己的创意变为现实，成为数字世界的建设者。</p>
<p>作为前端开发者，我发现VibeCoding和MCP的结合在前端开发中尤其有价值。它不仅能够加速前端界面的开发，还能够轻松整合各种后端服务，让前端开发者能够独立完成更加复杂和功能丰富的应用，真正实现"创意驱动开发"的理念。</p>
<h3 data-id="heading-17">5. TRAE与MCP对前端开发者的特别帮助</h3>
<p>作为一名前端开发者，我发现TRAE与MCP的组合在前端开发领域尤其具有革命性的意义。它们不仅解决了前端开发中的许多痛点，也为前端开发者打开了新的可能性。</p>
<h4 data-id="heading-18">5.1 前端框架与库的智能应用</h4>
<p>TRAE对主流前端框架（如React、Vue、Angular等）和库（如Tailwind CSS、Three.js等）有深入的理解。通过简单的对话，我可以快速生成符合最佳实践的组件代码，而不需要手动编写繁琐的模板和配置。</p>
<p>而MCP则为前端框架提供了强大的扩展能力：</p>
<ul>
<li><strong>组件库MCP</strong>：提供丰富的预设组件库，涵盖了从基础UI组件到复杂交互组件的各种类型，让前端开发更加高效。</li>
<li><strong>框架适配MCP</strong>：自动生成适配不同前端框架的代码，让我能够根据项目需求灵活选择合适的框架，而不需要学习多种框架的语法。</li>
</ul>
<p>例如，当我需要创建一个响应式导航栏时，只需告诉TRAE我的需求，它就能生成包含适当的HTML结构、CSS样式和JavaScript交互的完整代码，甚至会自动处理移动端适配和动画效果。</p>
<h4 data-id="heading-19">5.2 响应式设计与移动适配</h4>
<p>响应式设计是现代前端开发的核心要求之一，但手动编写媒体查询和处理各种设备尺寸的适配往往耗时且容易出错。TRAE能够智能分析设计需求，自动生成适配各种屏幕尺寸的响应式代码，确保应用在不同设备上都能提供良好的用户体验。</p>
<p>MCP在响应式设计中发挥了重要作用：</p>
<ul>
<li><strong>设备检测MCP</strong>：智能检测用户设备的类型和尺寸，提供针对性的界面适配方案。</li>
<li><strong>布局优化MCP</strong>：根据不同设备的屏幕尺寸，自动调整布局结构和元素大小，确保最佳的视觉效果。</li>
<li><strong>交互适配MCP</strong>：根据设备类型（如触摸设备 vs 鼠标设备），自动调整交互方式，提供符合设备特性的用户体验。</li>
</ul>
<h4 data-id="heading-20">5.3 UI组件开发与样式管理</h4>
<p>TRAE可以帮助前端开发者快速创建和管理UI组件库。通过对话式编程，我可以描述组件的外观和行为，TRAE会生成符合设计规范的组件代码，并自动处理样式隔离和主题管理。</p>
<p>MCP在UI组件开发中提供了强大的支持：</p>
<ul>
<li><strong>设计系统MCP</strong>：提供完整的设计系统支持，包括颜色、字体、间距等设计规范，确保整个应用的视觉风格统一。</li>
<li><strong>样式管理MCP</strong>：提供现代化的样式管理方案，如CSS-in-JS、CSS Modules等，解决样式冲突和命名空间问题。</li>
<li><strong>主题切换MCP</strong>：支持动态主题切换，让应用能够根据用户偏好或系统设置自动调整主题，提升用户体验。</li>
</ul>
<h4 data-id="heading-21">5.4 性能优化</h4>
<p>前端性能优化是一个复杂且持续的过程，涉及代码分割、懒加载、缓存策略等多个方面。TRAE能够分析项目结构，识别性能瓶颈，并提供针对性的优化建议和代码实现，帮助前端开发者构建更加高效的应用。</p>
<p>MCP在前端性能优化中发挥了关键作用：</p>
<ul>
<li><strong>代码分析MCP</strong>：智能分析前端代码，识别性能瓶颈和优化机会。</li>
<li><strong>资源优化MCP</strong>：自动优化图片、字体、脚本等资源的加载策略，减少页面加载时间。</li>
<li><strong>渲染优化MCP</strong>：提供虚拟列表、无限滚动等高级渲染技术，提升复杂页面的渲染性能。</li>
<li><strong>缓存策略MCP</strong>：根据应用的具体情况，自动生成最佳的缓存策略，减少重复请求和数据传输。</li>
</ul>
<h4 data-id="heading-22">5.5 API集成与数据处理</h4>
<p>前端开发中经常需要与后端API进行交互，处理数据获取、状态管理和错误处理等问题。TRAE可以帮助开发者快速生成API调用代码，实现数据的高效处理和状态管理，减少了手动编写重复代码的工作量。</p>
<p>MCP在API集成中提供了强大的能力：</p>
<ul>
<li><strong>API客户端MCP</strong>：自动生成符合RESTful或GraphQL规范的API客户端代码，简化API调用过程。</li>
<li><strong>状态管理MCP</strong>：提供现代化的状态管理方案，如Redux、Vuex、MobX等，帮助前端开发者高效管理应用状态。</li>
<li><strong>数据转换MCP</strong>：自动处理前后端数据格式的转换，解决数据结构不匹配的问题。</li>
<li><strong>错误处理MCP</strong>：提供统一的错误处理机制，确保API调用失败时能够优雅地处理错误，提升用户体验。</li>
</ul>
<h4 data-id="heading-23">5.6 前端测试</h4>
<p>测试是确保前端应用质量的重要环节，但编写测试代码往往繁琐且耗时。TRAE能够根据组件和功能自动生成测试代码，覆盖常见的测试场景，帮助前端开发者提高代码质量和可靠性。</p>
<p>MCP在前端测试中提供了全面的支持：</p>
<ul>
<li><strong>测试框架MCP</strong>：支持多种前端测试框架，如Jest、Mocha、Cypress等，满足不同类型的测试需求。</li>
<li><strong>测试用例MCP</strong>：根据组件和功能的特性，自动生成针对性的测试用例，确保测试覆盖全面。</li>
<li><strong>测试报告MCP</strong>：生成详细的测试报告，帮助开发者了解测试结果和代码质量状况。</li>
<li><strong>CI/CD集成MCP</strong>：提供与持续集成/持续部署系统的集成，实现自动化测试和部署，确保代码质量和开发效率。</li>
</ul>
<h2 data-id="heading-24">四、对未来的展望</h2>
<p>回顾2025年与TRAE和MCP相伴的时光，我充满感激。TRAE和MCP不仅是开发工具，更是我实现创意的伙伴。通过它们，我不仅开发了多个有趣实用的项目，也提升了自己的编程能力和创意表达能力。</p>
<h3 data-id="heading-25">VibeCoding与MCP的未来发展</h3>
<p>展望未来，我相信VibeCoding将会成为主流的编程方式，而MCP则会成为技术整合的标准实践，两者的结合将彻底改变软件开发的格局。</p>
<p>我期待TRAE和MCP能够在以下几个方面继续进化：</p>
<ol>
<li><strong>更深入的行业解决方案</strong>：针对不同行业的特定需求，提供更加专业的MCP服务和开发模板，如教育、医疗、金融等领域的专用解决方案。这些解决方案将整合行业特定的技术能力，为开发者提供一站式的行业应用开发工具。</li>
<li><strong>更强的协作能力</strong>：支持多人实时协作开发，让团队成员能够通过对话式编程共同完成项目，提高团队协作效率。MCP将作为团队协作的技术基础，确保不同开发者的代码和服务能够无缝集成。</li>
<li><strong>更丰富的创意表达形式</strong>：除了文字和代码，还能支持语音、图像、视频等多种形式的创意输入，让开发者能够更加自由地表达自己的想法。MCP将提供相应的服务，处理这些不同形式的创意输入，并转化为可执行的代码。</li>
<li><strong>更智能的代码优化</strong>：能够根据项目的具体情况，自动优化代码结构和性能，提供更加专业和高效的解决方案。MCP将整合先进的代码分析和优化技术，为不同类型的应用提供定制化的优化方案。</li>
<li><strong>更广泛的生态系统</strong>：MCP将构建更加开放和丰富的服务生态系统，吸引更多的服务提供商加入，为开发者提供更加多样化的技术选择。同时，MCP将提供标准化的服务接口和开发工具，降低服务集成的门槛，促进生态系统的健康发展。</li>
<li><strong>更强大的前端能力</strong>：针对前端开发的特点，提供更加专业和强大的MCP服务，如WebAssembly优化、PWA增强、WebXR支持等，帮助前端开发者构建更加先进和丰富的Web应用。</li>
</ol>
<h3 data-id="heading-26">个人的未来规划</h3>
<p>作为一名前端开发者和VibeCoder，我计划在未来继续深入探索TRAE和MCP的潜力，开发更多有意义的前端项目：</p>
<ol>
<li><strong>扩展旅游札记生成器</strong>：增加更多的风格选项和导出格式，支持视频游记的生成，让旅行记忆的保存和分享更加丰富多样。作为前端开发者，我将重点优化用户界面和交互体验，采用现代前端框架构建响应式布局，确保在各种设备上都能提供出色的用户体验。同时，我将探索整合更多MCP服务，如视频处理MCP、社交媒体分享MCP等，为应用添加更多高级特性。</li>
<li><strong>开发教育辅助工具</strong>：利用AI技术和MCP服务，开发能够根据学生特点和学习进度，自动生成个性化学习计划和辅导内容的教育工具。在前端实现上，我将采用组件化开发方式，构建可复用的教育组件库，支持多种学习场景和交互模式。同时，我将整合教育内容MCP、学习分析MCP等专业服务，提升工具的教育价值。</li>
<li><strong>探索虚拟现实应用</strong>：结合VR技术和MCP服务，开发沉浸式的游戏和应用，为用户带来更加真实和震撼的体验。作为前端开发者，我将利用Three.js等3D库，实现WebVR/AR应用，探索前端技术在虚拟现实领域的应用潜力。同时，我将整合空间计算MCP、虚拟场景MCP等专业服务，提升VR/AR应用的质量和体验。</li>
<li><strong>构建前端组件库</strong>：基于TRAE的VibeCoding能力和MCP服务，开发一套完整的前端组件库，包含常用的UI组件和交互模式，支持主题定制和响应式设计，为前端开发提供更加高效的工具。我将特别关注组件库与MCP服务的集成，让开发者能够通过简单的配置，为组件添加智能特性，如表单验证、数据可视化等。</li>
<li><strong>参与开源项目</strong>：将自己的VibeCoding和MCP使用经验分享给社区，与其他开发者共同推动VibeCoding和MCP的发展。特别是在前端领域，我希望能够贡献更多基于TRAE和MCP的前端开发工具和最佳实践，帮助其他前端开发者提高开发效率。我计划创建一个开源的MCP前端集成库，简化前端开发者使用MCP服务的流程。</li>
<li><strong>探索前端与AI的结合</strong>：利用TRAE的AI能力和MCP服务，探索前端开发与人工智能的深度结合，开发能够根据用户行为和偏好自动调整界面和功能的智能前端应用，为用户提供更加个性化的体验。我将整合用户行为分析MCP、个性化推荐MCP等服务，构建智能前端应用的技术框架。</li>
<li><strong>MCP服务开发</strong>：尝试开发自己的MCP服务，专注于解决前端开发中的特定问题，如高性能动画、智能表单、实时协作等。通过开发MCP服务，我希望能够更深入地理解MCP的技术架构和工作原理，为前端开发社区贡献更多有价值的工具和服务。</li>
</ol>
<p>同时，我也期待看到更多开发者加入VibeCoding的行列，通过TRAE释放创意，共同创造一个更加丰富多彩的数字世界。</p>
<h2 data-id="heading-27">五、结语</h2>
<p>2025年，是我与TRAE和MCP结缘的一年，也是我创意迸发的一年。从旅游札记生成器到游戏开发，从生活助手到社交管理工具，TRAE与MCP的组合陪伴我走过了一段充满惊喜和成就的技术探索之旅。</p>
<h3 data-id="heading-28">我的VibeCoding与MCP之旅</h3>
<p>对我个人而言，2025年的VibeCoding与MCP之旅是一次自我突破和成长的过程。作为一名前端开发者，我不仅开发了多个有趣实用的项目，也发现了自己在创意设计和问题解决方面的潜力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ed48e5322846d7a023e8481f8ce421~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=spTtsqVWbQfekWyVGvFgAHNEj0Y%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>技术的魅力在于它能够让生活变得更加美好，而TRAE和MCP正是这样一对能够赋能创意、简化开发的神奇组合。TRAE提供了智能的对话式编程环境，让创意表达更加自然和直观；MCP提供了丰富的技术服务，让创意实现更加高效和强大。</p>
<p>我回顾我这一年TRAE的总结报告，获得了“执剑人”评价。倒也十分贴切！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061e5c889f0d48b186057300cec12ddd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=ZsyYX%2BDqLBuPZUUEDHG3g%2BQ%2BZao%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>2025年，与TRAE和MCP的故事已经成为我人生中一段美好的回忆；而未来，更多与TRAE和MCP的精彩故事正在等待着我去书写。</p>
<h3 data-id="heading-29">未来的展望</h3>
<p>我相信，在未来的日子里，TRAE和MCP将继续进化，为开发者带来更加强大和智能的开发体验。VibeCoding将成为主流的编程方式，而MCP将成为技术整合的标准实践，两者的结合将彻底改变软件开发的格局。</p>
<p>作为一名前端开发者，我期待着在VibeCoding和MCP的道路上继续探索，开发更多有意义的项目，为前端开发社区贡献自己的力量。我也期待着与更多志同道合的伙伴相遇，共同探索技术的无限可能，创造一个更加美好的数字未来。</p>
<p>技术的进步永无止境，创意的表达也永无止境。有了TRAE和MCP，我们每个人都可以成为数字世界的建设者，用创意和技术共同创造一个更加丰富多彩的未来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌开放世界模型一夜刷屏，AI游戏门槛归零时刻来了？]]></title>    <link>https://juejin.cn/post/7600957412128964623</link>    <guid>https://juejin.cn/post/7600957412128964623</guid>    <pubDate>2026-01-30T09:56:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600957412128964623" data-draft-id="7600799940971216936" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌开放世界模型一夜刷屏，AI游戏门槛归零时刻来了？"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-30T09:56:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌开放世界模型一夜刷屏，AI游戏门槛归零时刻来了？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:56:18.000Z" title="Fri Jan 30 2026 09:56:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>谷歌世界模型，再一次惊艳了所有人！</p>
<p>今天一早，谷歌 DeepMind 开放了世界模型 Genie 3 的实验性研究原型「Project Genie」，允许用户创建、编辑并探索虚拟世界。</p>
<p>在世界模型 Genie 3 之外，Project Genie 同样由图像生成与编辑模型 Nano Banana Pro 和语言模型 Gemini 提供技术支撑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2efa739c59bc4bfc9b562e4aa0e3d12b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=G8qvqkHX%2BI3wIvRK%2BJg31%2BW8D9E%3D" alt="图片" loading="lazy"/></p>
<p>去年 8 月，谷歌预发布了通用世界模型 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650983908%26idx%3D1%26sn%3Df33650540bdffd2558dea77ba3ab7377%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650983908&amp;idx=1&amp;sn=f33650540bdffd2558dea77ba3ab7377&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Genie 3</a>，它能够生成多样化的交互式环境。在这一早期阶段，受邀测试者们已经创造出了令人印象深刻且极具吸引力的虚拟世界与沉浸式体验，并挖掘出了全新的使用方式。</p>
<p>接下来的目标是构建一个专注于「沉浸式世界创建」的交互式原型，进一步扩大受众范围。</p>
<p>因此自即日起，谷歌面向美国 18 岁及以上的 Google AI Ultra 用户开放了 Project Genie 的访问权限。</p>
<p>Project Genie 的多样性玩法</p>
<p>世界模型能够模拟环境的动态变化，并预测环境的演变方式以及动作对环境的影响。</p>
<p>与静态 3D 快照中的可探索体验不同，谷歌通用世界模型 Genie 3 会在用户移动并与世界交互时，实时生成前方的路径。</p>
<p>它能够为动态世界模拟出物理效果和交互，并且其突破性的一致性使得模拟任何现实场景成为可能，从机器人技术、动画建模和小说创作，到地点探索和历史场景还原。</p>
<p>如今，在 Genie 3、Nano Banana Pro 和 Gemini 等三大模型的支持下，Project Genie 具备了以下三大核心能力：</p>
<p>首先是，世界草绘（World sketching）。</p>
<p>通过文本提示词以及生成或上传的图片，用户即可创建一个生动且不断扩张的环境。用户可以创建自己的角色和世界，并定义自己想要的探索方式，比如行走、骑行、飞行或者驾驶，等等。</p>
<p>为了实现更精准的控制，谷歌将「世界草绘」与 Nano Banana Pro 进行了整合。这样一来，用户在正式进入世界之前，可以预览世界的样貌并修改图像以进行微调。</p>
<p>用户还可以定义角色的视角（第一人称或第三人称），在进入场景前掌控自己的视觉体验。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cbc03879a1845f29182ddafdab23d98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=lM51I9rtNOZGZ8HrpPJ%2FU7P501M%3D" alt="图片" loading="lazy"/></p>
<p>其次是，世界探索（World exploration）。</p>
<p>用户创建的世界是一个等待探索的可导航环境。在移动时，Project Genie 会根据用户采取的行动实时生成前方路径。在穿行过程中，用户还可以调整相机视角。</p>
<p>最后是，世界重混（World remixing）。</p>
<p>通过在原有提示词的基础上进行创作，将现有世界重混成新的演绎版本。用户也可以在画廊或「随机生成」图标中探索精选世界以获取灵感，并在此基础上继续构建。</p>
<p>完成后，用户可以下载关于自己的世界和探索过程的视频。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd304c9585c04af5ae5be320fa9bb2e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=zWp8syh4JQbO6eyzMlEGYj0eFaU%3D" alt="图片" loading="lazy"/></p>
<p>不过目前，谷歌也承认，Genie 3 仍处于早期研究阶段， 以下几个方面需要进一步改进：</p>
<ul>
<li>
<p>生成的世界可能看起来并不完全逼真，或者并不总是能严格遵循提示词、图像或现实世界的物理规律；</p>
</li>
<li>
<p>角色有时可能不太受控，或者在控制上存在较高的延迟；</p>
</li>
<li>
<p>生成内容的时长限制在 60 秒以内；</p>
</li>
<li>
<p>此前宣布的部分 Genie 3 功能（例如在探索时改变世界的提示事件「promptable events」）尚未包含在此原型中。</p>
</li>
</ul>
<p>第一手体验出炉</p>
<p>谷歌开放 Project Genie，终于让更多用户亲身体验到了世界模型 Genie 3 的「AI 生万物」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/458d644bc71b4075a820a5dafbb91ec2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=3pB2r1WlOU%2Fcved031Sr6%2BNTPaI%3D" alt="图片" loading="lazy"/></p>
<p>已经上手的 Ultra 用户纷纷晒出了自己的作品，给予了不错的评价。</p>
<p>「刚刚用 Genie 3 做出了我的第一款 AI 游戏。提示词：一位法国女子必须攀越一个违背逻辑的世界，到处都是飞行物体。这会是游戏行业的终结吗？」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27c967830c72480191ef6bd2ca4aa0ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=t4TJ8HYKhLThOJUVqFmRk0dEdA8%3D" alt="图片" loading="lazy"/></p>
<p>「Genie 3 能运行《毁灭战士》（Doom）吗？看它生成的《毁灭战士》，墙壁全是由同样在运行《毁灭战士》的屏幕组成；主角是《毁灭战士》里的陆战队员，但他的头也是一个正在运行《毁灭战士》的屏幕。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d1f4b7c237a44f18e75dcb164583739~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=C9ICZq0k%2BDDYKTI0Xj%2FtPlb0Mms%3D" alt="图片" loading="lazy"/></p>
<p>「Genie 3 在建模和物理模拟方面是一个巨大的飞跃，但仍存在一些待解决的问题，比如一只头顶着鸭子的水獭飞行员正走在一家罗斯科（Rothko）风格的机场里；以及一只穿着翼装的水獭正飞越一座充满哥特式塔楼的城市。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8692a66e2bb4bbe80824f93f5204873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=YfoecsrN%2BElDzpA4jg%2FoCwlY0IE%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f14ac253acb748d9877fe02704316e6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=HusCQ%2FhKZvWO38%2Fiv96IHLerXyM%3D" alt="图片" loading="lazy"/></p>
<p>「看 Genie 3 生成的人物是怎么打开车门的，这简直太令人震撼了。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acaf788fdf7c40a9874957f9148c6123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=WVd6e4Y7ssgLRnww2EUo1V4P6HY%3D" alt="图片" loading="lazy"/></p>
<p>「画面提示词为：一个男人正沿着好莱坞大道漫步。不仅能控制这个男人的动作，还能实时操控相机的视角。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06e83b9956284ec6aa4b86488cfc54cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371778&amp;x-signature=d4B93EF0HDSiiGMiXJQ0gbKGZUo%3D" alt="图片" loading="lazy"/></p>
<p>参考链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.google%2Finnovation-and-ai%2Fmodels-and-research%2Fgoogle-deepmind%2Fproject-genie%2F" target="_blank" title="https://blog.google/innovation-and-ai/models-and-research/google-deepmind/project-genie/" ref="nofollow noopener noreferrer">blog.google/innovation-…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FTrueSlazac%2Fstatus%2F2016959063699906740%3Fs%3D20" target="_blank" title="https://x.com/TrueSlazac/status/2016959063699906740?s=20" ref="nofollow noopener noreferrer">x.com/TrueSlazac/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Femollick%2Fstatus%2F2016982218506199531" target="_blank" title="https://x.com/emollick/status/2016982218506199531" ref="nofollow noopener noreferrer">x.com/emollick/st…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Femollick%2Fstatus%2F2016919989865840906%3Fs%3D20" target="_blank" title="https://x.com/emollick/status/2016919989865840906?s=20" ref="nofollow noopener noreferrer">x.com/emollick/st…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FEHuanglu%2Fstatus%2F2016926887151354255%3Fs%3D20" target="_blank" title="https://x.com/EHuanglu/status/2016926887151354255?s=20" ref="nofollow noopener noreferrer">x.com/EHuanglu/st…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型的第一性原理：（二）信号处理篇]]></title>    <link>https://juejin.cn/post/7600837236620738612</link>    <guid>https://juejin.cn/post/7600837236620738612</guid>    <pubDate>2026-01-30T09:57:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600837236620738612" data-draft-id="7600728866758098996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型的第一性原理：（二）信号处理篇"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-30T09:57:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型的第一性原理：（二）信号处理篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T09:57:04.000Z" title="Fri Jan 30 2026 09:57:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>白铂 博士，华为 2012 实验室理论研究部主任 信息论首席科学家</p>
<p>引言</p>
<p>本篇是《大模型的第一性原理》系列解读文章的第二篇（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2651006633%26idx%3D1%26sn%3D822f0d7b22e8054ea897d55c7a7b3028%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2651006633&amp;idx=1&amp;sn=822f0d7b22e8054ea897d55c7a7b3028&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">点击回顾第一篇</a>），我们将从信号处理的角度解读原论文[1]。重点探讨语义向量化背后的信号处理和信息论原理，并从时间序列的角度分析 Transformer 及其与 Granger 因果的关系。</p>
<p>我们首先提出一个观点：大模型的输入是 Token 的语义嵌入（也称为语义向量），其本质是把自然语言处理问题转换为信号处理问题。因此对于大模型而言，向量化非常关键，它和信号处理、信息论有非常深刻的联系。</p>
<p>尽管从语言学的角度看，语法和逻辑是人类语言现象的关键，然而本系列的《统计物理篇》已经指出：大模型并不考虑这些因素，而是从纯概率的角度出发建模自然语言。</p>
<p>从 Token 的维度看，这种纯粹的概率模型在计算上是非常困难的，因此人们发展出了概率图模型、消息传递算法等工具[2]。对于当前海量数据而言，这些方法的复杂度仍然过高，很难用于大规模训练，也难以建模语义非对称性和长程依赖性。但是，当 Token 被向量化之后，情况就发生了本质的变化，因为我们可以定义内积，并用内积来表示语义相关性，从而大幅度降低计算量。</p>
<p>基于内积，我们可以进一步定义距离、微分、低维流形等一系列相对容易数值计算的量。这样就可以通过反向传播算法来训练神经网络，将 Token 的向量化变成神经网络的输入、输出和参数化记忆[3][4]。实际上，许多研究也表明神经网络之所以能完成分类，正是因为同一类事物（如照片中的猫、狗等）在高维参数空间中会内聚成低维流形[5][6]。</p>
<p>顺便提及，我们在向量检索方面的研究取得了一定进展，所提出的近似最近邻向量检索算法，过去两年一直蝉联 ANNBenchemarks 榜单的第一名 。</p>
<p>语义嵌入 / 向量化</p>
<p>人们用向量来建模语义的想法最早出现于 Luhn 在 1953 年发表的论文中[8]。但直到 2013 年，Mikolov 等人才真正取得突破[9][10]。基于大量语料，他们成功地训练出了将 Token 转化成语义向量的神经网络模型。下面这个例子经常被用来表达最理想的语义向量化：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38734473a84e4c97a20d39a5441430d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=aamwhItyFEdZKupvG5O7OJY%2FW9k%3D" alt="图片" loading="lazy"/></p>
<p>其中 s (⋅) 为一个词的向量化表示。然而遗憾的是，上述理想的语义向量化当前并未完全实现，但是语义向量之间的内积（或者归一化为余弦相似性）却可以表示 Token 层面的语义相关性。</p>
<p>假设 Ω 是一种自然语言所包含的 M 个 Token 的集合，那么从大模型的角度看，一个 Token 的语义就由定义在 Ω 上的概率分布所描述[11]。该分布可以从大量语料中学到，因此语义空间就可以用这个学到的概率空间建模。进一步地，将语义向量空间定义为一个 M 维空间中的单位球面<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cae4e32acfed43cc9dbfcb75d502df30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=VdQ4C60g%2FB496h18zJxSYqHK9Sc%3D" alt="图片" loading="lazy"/>，其中每个 Token 都和球面上的一个点一一对应。</p>
<p>对于大模型而言，语义向量空间就可以建模为一个概率-内积空间。许多研究认为语义向量空间应该是结构更复杂的低维流形，但余弦相似性和欧式距离的实际效果就已经足够好了。因此，我们认为用单位球面 S^(M-1) 来定义语义向量空间是在效果和复杂度之间的良好平衡。需要特别强调的是，语义向量空间中的每一个向量本身并没有语义，而这个向量与其它所有向量的内积（即相对关系）才代表了语义。这一点和信息论中的信源编码有本质的区别。经典的信源编码是对每一个信源符号的压缩，而语义向量的压缩则是在相对关系近似不变的前提下，对整个语义向量空间的降维。</p>
<p>那么，如何衡量两个语义空间的距离，以控制语义向量空间降维带来的精度损失或者衡量两个不同自然语言的语义差异性就变得至关重要。当代著名的几何学家，2009 年阿贝尔奖获得者，Mikhael Gromov 为我们提供了数学工具，即 Gromov-Wasserstein 距离[12]。它衡量了两个度量 - 概率空间之间的任意两点间度量的平均差异。该定义极大地拓展了最优传输理论中的 Wasserstein 距离的应用范围[13]。据此，我们定义语义向量空间距离如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c21d5551bbc4ed6b819a47f2b215513~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=P14ZueS%2FAJkH3WOvMn038E5Gf9Q%3D" alt="图片" loading="lazy"/></p>
<p>其中，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b244ce4d36e64707bdeb2620be95717c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=DDOycgQtCJK74CsA40CipRhlVKg%3D" alt="图片" loading="lazy"/> 和 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60059d9514be473fa306b20f0aad7659~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=ePQYPNODcF91eF30yDdy%2FjA03FA%3D" alt="图片" loading="lazy"/> 是两个语义向量空间，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49ea09c702ba4237b9409f241c187c34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=bDHWwatwqFu6HTsMBBpUO6PdgCA%3D" alt="图片" loading="lazy"/> 是 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c10dd855a8994096a2d939ab3b442fd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=3HHtWQMt0diGXF75BVYE30z1Opc%3D" alt="图片" loading="lazy"/> 上的语义向量，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb0bcf92cb0b4e998bce0dd76ee957a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=fGVfDS3uCG0E4llTifE%2FqbgKlsg%3D" alt="图片" loading="lazy"/> 是 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17bb6b80180d432284d19322d8cb55a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=TphwcpaF5JnhuioZK01jluyoEvI%3D" alt="图片" loading="lazy"/> 上的语义向量，μ 和 ν 分别是定义在 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/945f9b3b5e304bda901af0b52c86cb15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=jj7WyqRdQhpdocXmNVYN1nOBJFY%3D" alt="图片" loading="lazy"/> 和 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1932121e5d541d2a288f3c5e68ee9ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=Q1X4e9lhk9pnb0%2B81wYtogYj1bs%3D" alt="图片" loading="lazy"/>上的概率测度，π 是联合概率测度，Π(μ,ν) 是边缘分布为 μ 和 ν 的所有联合概率测度的集合。在最优传输理论中，Π(μ,ν) 中的任何一个联合概率测度都被称为传输方案。</p>
<p>可以看到，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a374a8f19814bc985c19e50a0cd6b3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=gjmQUi7QQM2%2FhPqwv%2FPasp4JrI0%3D" alt="图片" loading="lazy"/> 衡量了概率加权意义下两个空间内积的平均最小差异，即两个空间的平均结构差异。如果 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ea226e5464a4280a259f9c98f6b53b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=qKFnQd1ZC3dwE2aFb4HZd8eoaxY%3D" alt="图片" loading="lazy"/>，在数学上称这两个空间是等距同构的。这意味着这两个语义向量空间完全等价，即两种语言在 Token 语义层面实际上是同一种语言。从这个角度看，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc83b50ebe7c46579ea79d0591b71f63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=q0Wk0ZwjqI%2FcUhDQFKBDbHr99Pg%3D" alt="图片" loading="lazy"/> 衡量了两个语义向量空间偏离等距同构的程度。偏离程度越大，翻译起来的难度就越高。</p>
<p>因此，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66beb30d226f434fa68fcba611efbb8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=8UWC4A8XY9%2FWBTlNMGH3fD8HYzc%3D" alt="图片" loading="lazy"/> 不仅可以用于衡量语义向量空间降维带来的语义失真，同时还可以用来度量语义对齐的效果[14]。我们近期正在将这个方法从自然语言的语义对齐推广到多模态语义对齐问题上。</p>
<p>基于语义向量空间的概念，下面讨论语义压缩问题。原始 M 维语义向量空间的维数过高，难以计算且容易导致维数灾难。Landauer 等人指出语义向量化存在一个最优维数区间，即所谓甜点维数[14]。那么，如何将 M 维语义向量空间压缩到一个合适维数？这背后的数学原理就是著名的 Johnson-Lindenstrauss（JL）引理[16]。考虑 ϵ∈(0,1) 和 K 个 M 维向量 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e19a610ca17547749adf5187a2f35884~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=qAAhcDjLaoiw4bQ4Xc3dsO1FoO0%3D" alt="图片" loading="lazy"/>，如果 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aadf7a7831ff4c868d3bf827ceadddbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=2cOhuDXThI6DoHuGTP89X1QnLb8%3D" alt="图片" loading="lazy"/>，那么一定存在一个矩阵 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edb09d32d57c482bba39fd8d23fea07c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=1FnPYMmLxpmSAoNLtJ5HOLg8%2BqE%3D" alt="图片" loading="lazy"/> 使得</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7637731de87c41c5bd5c3094915f1cc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=zFdgLUlpayJFXMf%2Fr6AxsCkruUQ%3D" alt="图片" loading="lazy"/></p>
<p>JL 引理表明，可以通过线性变换来降低语义向量的维数，同时使得内积的误差小于 ϵ。因此，压缩之后的语义失真可用下面的语义向量空间距离来衡量</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00baa1483b70477ca60e0921ce2b7f7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=377szuiHvJ77L3cahckEt3YtoUs%3D" alt="图片" loading="lazy"/></p>
<p>其中，S 为原 M 维语义向量空间，S' 为降维后的 m 维语义向量空间。更进一步，如果考虑语义向量本身的稀疏性，我们还可以用压缩感知理论来强化 JL 引理。这种强化可以导出基于采样 FFT、采样 DCT 和采样 Hadamard 矩阵的快速压缩算法。详情可参见原论文中的相应章节，这里不再赘述。需要注意的是，这里并未考虑语义向量空间上的概率测度，而是对每个语义向量都成立。因此，如果结合从语料中学到的概率测度，很有可能会提出更高效的语义降维算法或得到更高的压缩比 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05b1d173212c452984b5297b615d6042~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=tS3m5InFxOGKyV9c4vUWt6zxzEo%3D" alt="图片" loading="lazy"/>。</p>
<p>最优语义向量化</p>
<p>我们知道，一个 Token 到底呈现出什么语义是和下游任务密切相关的。在本系列的《统计物理篇》中已经指出，大模型的目标是预测下一个 Token。因此，Token 的向量化也应围绕该目标展开。令 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/616db03b6ac74bcc9d2c866ae66627c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=1reQ2E3SBP33iqU9XXfkcHHADjY%3D" alt="图片" loading="lazy"/> 为 Token 序列，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5e251be58934eb9bca08b54c06ff8c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=GlQEn36e51wi1vP9Iic4T9irzR0%3D" alt="图片" loading="lazy"/> 为对应的语义向量。对于下一个 Token 预测任务，语义编码器 f 是 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cb41a78520c4b829bc1f7c74df4a079~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=vqAIg7tJ%2BKccUNmHcC9dGMqietU%3D" alt="图片" loading="lazy"/> 的函数，其输出 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28f1d0f640f3413da330723306c95f29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=mr6NCWBc41%2BTVpKuXeQgjdr9Tso%3D" alt="图片" loading="lazy"/> 是 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4a74cf470a94eb5bb1cf7442552649a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=pCAdZqxI%2FTegV388ySV9hLlVhpc%3D" alt="图片" loading="lazy"/>中对于预测 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb81db0718634f848d4067369e6e3952~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=TnrpP30Ib%2FHuaL9QlhI%2B3GF9tG0%3D" alt="图片" loading="lazy"/> 有用但不在 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f930787309c8423891238a9858ec842e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=BKyXFmfXHdf7vN6HuqOnPLUXO10%3D" alt="图片" loading="lazy"/> 里的信息。那么，从信息论的角度看，最优语义编码器是下述优化问题的解：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ddde1675bd142dca545ba03b069cce5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=s0Vxpfq7OjIBnpG4vinx1P3Fj6U%3D" alt="图片" loading="lazy"/></p>
<p>上述定义的核心是条件互信息，它保证了语义向量 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/957ea839ea894a5c962762688b444b3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=3ENyo9GzzWLtii7okAfSooguOms%3D" alt="图片" loading="lazy"/> 并不是 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0111d1887a5458a8577fd29ecb87beb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=8HwNHoNTOvGv5Cdk6TVh3Epcxr0%3D" alt="图片" loading="lazy"/> 的向量表示，而是表示 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32c3fec738344855883031af262fae87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=H26nALAQBcIDCLleppdMUMr95rE%3D" alt="图片" loading="lazy"/> 中对预测 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b39e0e96f9db4f48ac0511765a611648~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=Yj17ejIAof2z%2FB6LGiXcvGx6sII%3D" alt="图片" loading="lazy"/> 有用但不在 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88886be860c046ff90af49c7a575f18f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=2bQxWTTOoMg1IUsOVgYfVOnAKmc%3D" alt="图片" loading="lazy"/> 里的信息。应用互信息不等式，我们有</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3105c483b3140458a27a94390436f3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=0S2SXrTbwnUyxfnU28ht8%2FnU7%2BE%3D" alt="图片" loading="lazy"/></p>
<p>该不等式的最右端项就是 Google DeepMind 团队提出并广泛应用的（包括 OpenAI）Contrastive Predictive Coding（CPC）算法[17]。这篇论文明确指出，他们的工作得到了信息论中 Predictive Coding 的启发。这正是发表在 IEEE 的前身 IRE 主办的信息论汇刊 IRE Transactions on Information Theory 的第 1 卷第 1 期的第 1 篇和第 2 篇论文[18][19]。作者则是大名鼎鼎的 Peter Elias，他是卷积码的发明人，1977 年香农奖得主，3G 时代编码领域的绝对王者。Google 的研究人员撰写论文系统综述了互信息的变分下界，并最终选择 InfoNCE 作为损失函数，从而通过神经网络最小化 InfoNCE 来最大化 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90dfbf31577d40888d1904cfe5ba26d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=zpti31u%2ByRmFNHOBGhonDR9uTkE%3D" alt="图片" loading="lazy"/> 的下界[20]。</p>
<p>以上的讨论启发我们：对于任何一个语义嵌入问题，都可以先基于下游任务要求写出信息论优化问题，再设计神经网络或数值算法来搜寻逼近信息论最优解或其上 / 下界的语义编码器。</p>
<p>从上述推导可以看出，CPC 实际上优化的是最优语义编码器的上界的 InfoNCE 逼近，所得到的语义编码器并不是最优的。如果我们有更好的工具来直接优化上述不等式最左端的条件互信息的和，那么将能得到性能更优的语义编码器。因此，这里要引入一个非常关键的信息论概念，即定向信息。这一概念的提出者是著名的信息论专家，1988 年香农奖得主，James Massey[21]。根据 Massey 的研究，从信道的输入序列 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/297c1fcd0a5a4dbfb41a17e5fc45e8e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=18d6cgwpakmfxYFkNPvVfckLm%2Bc%3D" alt="图片" loading="lazy"/> 到输出序列 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c40f1a129245e5b66036681ac0cc40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=F1WhJ1SRZRtFO%2BeHOwZraKhylDM%3D" alt="图片" loading="lazy"/> 的定向信息可定义为</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e565e84e5e1488aacf23eb1f39e9db1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=mB%2Bknm1OXAJ6z4eaY%2F%2FWqqY%2BgT8%3D" alt="图片" loading="lazy"/></p>
<p>它衡量了从序列 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f2d7cfaa239469b820ee64ce9330d63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=xE8pzn7IbBvxcfsZSMjiNNHPh9I%3D" alt="图片" loading="lazy"/> 传递给序列 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2524af3e86564ef98b51019cfda0196d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=v7TiQ6arOTWACirhK99gxS%2BeavI%3D" alt="图片" loading="lazy"/> 的信息量。进一步地，我们定义从 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff5d33ad96064f03a12327a2df34e87b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=jFO9WTscUsyEQGAXukBEIfSOUTQ%3D" alt="图片" loading="lazy"/> 到 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e40729eebe3d4f1aa58d43225f408f12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=xhtVFdCftv2wpC%2B2CwvSW2Eh7sU%3D" alt="图片" loading="lazy"/> 的倒向定向信息：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11d1a81df0834b83be929ce37d948c56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=kb6PeW0ZVEI%2FKzPdEFeMvttwPwc%3D" alt="图片" loading="lazy"/></p>
<p>选择倒向这个词是受到彭实戈院士所研究的倒向随机微分方程的启发[22]。彭院士的研究成果最终促使他提出了一套与 Kolmogorov 概率公理化体系平行的非线性期望理论。我们从中可以看出，前面讨论的信息论最优的语义编码器，就是在最优化倒向定向信息，即：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe41c0a0ae64448e89f83582fd474fdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=kRJZCnmG004wVGpEfIeioj932c0%3D" alt="图片" loading="lazy"/></p>
<p>然而，定向信息的计算和估计是非常困难的。该问题将在本系列的第三篇《信息论篇》中展开讨论。可见，CPC 选择 InfoNCE 作为损失函数平衡了复杂度和效果。</p>
<p>Transformer 是非线性时变向量自回归时间序列</p>
<p>在本系列的第一篇《统计物理篇》中，我们详细探讨了 Transformer 的能量模型（Energy-based Model，EBM）形式。本篇我们从信号处理角度进一步讨论 Transformer 的本质。业界已经达成共识，Transformer 是一个自回归大语言模型。这是因为它基于输入 Token 序列和已经生成的 Token 序列来预测下一个 Token。事实上，从经典随机过程和时间序列分析的角度看，自回归模型有严格的数学定义，即用过去的随机变量的值的线性加权和来预测未来的随机变量[23]。</p>
<p>考虑提示词的长度为 n，用向量序列 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/779fbbb8ee3c4988a74628847e588dba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=ElPPWKxKjQHiA4xTrMhOhXKAGG8%3D" alt="图片" loading="lazy"/> 来表示。当前要预测第 i 个 Token，表示为向量 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8631345cc23e4ded83d62616ed1a3d66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=tFKXtEeYKwHc7E5Y%2BSSUHy2YBgw%3D" alt="图片" loading="lazy"/>，其中 i=n+1,…,N。为表示方便，令 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5680ffd53ed34f8da29f441523d2ee81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=QwQy%2F%2BqtzkHN4NexEUtzYCqAct0%3D" alt="图片" loading="lazy"/>，其中 i=1,…,n。结合自回归模型的思想，Attention 模块的数学形式可以写为：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96fb838a9d7a49dfb2fc1668aa10ff62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=BmiIFGP8SkG5d%2BIkpYI6tJBsHrw%3D" alt="图片" loading="lazy"/></p>
<p>其中，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d51a4ede061a48c2afa022b916ea6466~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=hu7MxpF0ECmELxzhdixJfAZac8s%3D" alt="图片" loading="lazy"/> 是 Attention 权重，定义为：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2cfea2c1e35463186676ca108181e02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=NQug4cn7IiGh%2BhoFqhtUpI%2FPJqE%3D" alt="图片" loading="lazy"/></p>
<p>从数学形式上看，Attention 是一个非线性时变向量自回归时间序列：</p>
<ul>
<li>
<p>时变性体现在 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a8c23ce254e4936bdbdb946f7318656~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=ClIAt6FZc%2BN9d6k%2FqK44qAsStd8%3D" alt="图片" loading="lazy"/> 与当前输出的 Token 编号 i 相关；</p>
</li>
<li>
<p>非线性体现在 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d03ec7696ebe45ee8f958f15a4329d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=6K6eKHl1VmiA65ADudNztan5KvU%3D" alt="图片" loading="lazy"/> 的定义中包含了 softmax 函数和建模语义非对称关系的双线性型 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e891b42fd5424b689d1bf3e620b9c8b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=InMhU%2BnkazNccapf0cnf2o0MdKU%3D" alt="图片" loading="lazy"/>，其中 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f6909e4482454d8b4e8687ef31a5fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=oqZ%2BxlKbKue3%2BkufL9rtm6DcmM0%3D" alt="图片" loading="lazy"/>。</p>
</li>
</ul>
<p>令 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63da2c51dc7f4ce1990943b4c974fbc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=HVy4k2KhoD0YJCBIeTBWNUiFVrY%3D" alt="图片" loading="lazy"/> 表示 Tranformer 的 FFN 层，那么 Transformer 本质上是通过</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb9615933a4f41bb895f06a19ab5531a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=qAgFIB7BId9hbf1rgw5eH5s%2Btq4%3D" alt="图片" loading="lazy"/></p>
<p>来预测下一个 Token 的向量表示。在《统计物理》篇中，我们已经指出 FFN 层对于预测下一个 Token 是很重要的，它被认为是大模型储存知识的位置。基于记忆容量的思路，Attention 模块输出的向量应该会激活 FFN 层中与之最匹配的记忆模式，从而作为下一个 Token 的向量表示。后续的操作需要在离散的词表中选择最有可能的那个 Token。在实际中可以设计多种采样策略来满足输出的要求，但背后的原理与通信接收机中的最大似然译码很类似。</p>
<p>简单起见，这里将采样操作表示成 argsoftmax (⋅) 函数。令 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52957747012d4d34952f35cd09cb623f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=vkflKGixelPkyNNqetgoxEXdu6w%3D" alt="图片" loading="lazy"/> 为词表 Ω 中的第 m 个 Token 的向量表示，那么 Transformer 的数学形式可以写为：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4dd553579a34c4ba70ae74f6071e72f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=fxHRM1BBFePNBoSiAzgwqvbKJiU%3D" alt="图片" loading="lazy"/></p>
<p>其中 T 是温度。</p>
<p>实际上，上述模型可作以下推广</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a60d8351405348609fbbe3d6a4609a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=j0MuOcMUZkCK2pf%2BBDuIhy5OlX0%3D" alt="图片" loading="lazy"/></p>
<p>其中 Ψ 为非线性函数，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc3d321c205b41d59c922e621e965f8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=AQZaHM9TJEO0n%2B%2BS0Z7D11jOK2E%3D" alt="图片" loading="lazy"/> 为时变参数矩阵。可见，Transformer 是更普遍的非线性时变向量自回归时间序列的一个特例。对 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac9b4166d2f74ce7b14ba82144ed4d8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=rsfXqteCX2Pmro1%2FjcfAyJgeO40%3D" alt="图片" loading="lazy"/> 进行其他分解或简化就能构造出新的 Attention 机制。例如，Mamba/Mamba2 是一种线性化的简化方式。由于线性 Attention 机制难以捕捉非对称语义相关性，其模型能力很自然地会受到很大影响。对 Ψ 也同样可以进行优化和修改，一种思路是用现代连续 Hopfield 网络来直接替换 FFN 模块[24]。另外，当前通过向量数据库和知识图谱等方式实现 RAG 也是通过改变 Ψ 来增强知识记忆的准确性和及时性[25]。</p>
<p>本系列的《统计物理篇》已经指出：大模型的能力极限是在预测下一个 Token 的任务上逼近人类水平的 Granger 因果推断。从时间序列的角度看，Granger 因果检测的主要作用就是分析两个序列之间与时间相关的统计关系。相关方法已经广泛应用于物理学、神经科学、社交网络、经济学和金融学等领域。回忆 Granger 因果的定义，令 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc92e8ab39941d08488085bb89591df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=X8nLss5BbehISKN9Vmr7tI%2Bpq60%3D" alt="图片" loading="lazy"/>，<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e6cb4cb66b34618b6245780cb657b76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=fy2b1jm31vyB%2F5dhY7g3OV%2B8Jeg%3D" alt="图片" loading="lazy"/>，那么下面的不等式自然成立：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/793bdc344fbe4d41b2f1e8d41b4f21e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=tjTO%2BtSP7F6dQbDxHNCe1ZPCo%2Bg%3D" alt="图片" loading="lazy"/></p>
<p>因此，从时间序列的角度看，大模型输入的 Token 序列和输出的 Token 序列符合 Granger 因果推断的定义。这进一步印证了第一篇的结论：大模型推理的本质，是通过预测下一个 Token 这一看似简单的训练目标，进而实现逼近人类水平的 Granger 因果推断。</p>
<p>信号处理与信息论</p>
<p>在引言中我们已经指出：大模型处理的是向量化后的 Token 序列，其本质是把传统基于概率的自然语言处理问题转换成了基于数值计算的信号处理问题。从本文的讨论中可以看到，这种从 Token 到其向量表示的转化，与信息论和信号处理之间的关系非常类似。</p>
<p>具体来说，Shannon 信息论是一个基于概率论的理论框架，旨在理解信息压缩、传输和存储的基本原理及其性能极限，但它并不关注工程中的具体实现方法和复杂度。信号处理将信息论中的抽象符号表示为 n 维实 / 复空间中的向量。这种表示使得数值计算方法能有效应用于感知、通信和存储系统的高效算法设计中。可以说，信号处理是信息论原理在特定计算架构下的具体实现。</p>
<p>更广泛地看，我们经常用下图来表达计算理论和信息论之间的关系。图的左边是 Turing 和他的计算理论，他关心用多少个步骤能完成特定的计算，因此时延（通常用时间复杂度来度量）是最关键的指标。图的右边是 Shannon 和他的信息论，他关心的是通信速率的上限或者数据压缩的下限，即存在性和可达性。此时，通常假设码长趋于无穷大，因而时延是被忽略的。那么在实践中就会发现，开发通信算法的瓶颈永远是算力不够，算法复杂度太高；而研究计算算法的瓶颈永远都是（访存 / 卡间 / 服务器间）通信带宽不够，或者缓存 / 内存空间太小。</p>
<p>我们注意到，尽管计算理论和信息论有本质的不同，但他们最基本的操作单位都是 BIT，因此我们可以肯定地说：BIT 是连接计算和通信这两大领域的桥梁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d2129e16f344dbd83969eac25cd6b5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770371824&amp;x-signature=VhxsF%2BQ0BUMnhstrHbiYhKOMmFo%3D" alt="图片" loading="lazy"/></p>
<p>图：BIT 是连接计算理论和信息论的桥梁，是信息时代最伟大的发明。</p>
<p>正如 5G Polar 码发明人，2019 年香农奖得主，Erdal Arikan 教授参加我们的圆桌论坛中所指出的：BIT 是信息时代最伟大的发明。Shannon 在与 Weaver 合著的论文中也明确指出：信息论只解决了信息的可靠传输问题，即技术问题，而不考虑语义和语效[26]。但是人类已经进入了 AI 时代，信息论是否还能继续发挥其基础性作用？</p>
<p>我们将在本系列的第三篇《信息论篇》中看到，只要将核心概念从信息时代的 BIT 转换成 AI 时代的 TOKEN，Shannon 信息论就可以用来解释大模型背后的数学原理。</p>
<p>参考文献</p>
<ol>
<li>
<p>B. Bai, "Forget BIT, it is all about TOKEN: Towards semantic information theory for LLMs," arXiv:2511.01202, Nov. 2025.</p>
</li>
<li>
<p>D. Koller and N. Friedman, Probabilistic Graphical Models: Principles and Techniques. Cambridge, MA, USA: The MIT Press, 2009.</p>
</li>
<li>
<p>G. Hinton, "Learning distributed representations of concepts," in Proc. 8th Annual Conference on Cognitive Science Society ’86, Amherst, MA, USA, Aug. 1986.</p>
</li>
<li>
<p>Y. Bengio, R. Ducharme, P. Vincent, and C. Jauvin, "A neural probabilistic language model," Journal of Machine Learning Research, vol. 3, no. 2, pp. 1137-1155, Feb. 2003.</p>
</li>
<li>
<p>S. Chung, D. Lee, and H. Sompolinsky, "Classification and geometry of general perceptual manifolds," Physical Review X, vol. 8, no. 3, p. 031003, Jul. 2018.</p>
</li>
<li>
<p>Y. Bahri, J. Kadmon, J. Pennington, S. Schoenholz, J. Sohl-Dickstein, and S. Ganguli, "Statistical mechanics of deep learning," Annual Review of Condensed Matter Physics, vol. 11, no. 3, pp. 501-528, Mar. 2020.</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fann-benchmarks.com" target="_blank" title="https://ann-benchmarks.com" ref="nofollow noopener noreferrer">ann-benchmarks.com</a></p>
</li>
<li>
<p>H. Luhn, "A new method of recording and searching information," American Documentation, vol. 4, no. 1, pp. 14–16, Jan. 1953.</p>
</li>
<li>
<p>T. Mikolov, K. Chen, G. Corrado, and J. Dean, "Efficient estimation of word representations in vector space," arXiv: 1301.3781, 7 Sep. 2013.</p>
</li>
<li>
<p>T. Mikolov, I. Sutskever, K. Chen, G. Corrado, and J. Dean, "Distributed representations of words and phrases and their compositionality," Proc. 27th Annual Conference on Neural Information Processing Systems '13, Lake Tahoe, NV, USA, Dec. 2013.</p>
</li>
<li>
<p>D. Jurafsky and J. Martin, Speech and Language Processing: An Introduction to Natural Language Processing, Computational Linguistics, and Speech Recognition with Language Models, 3rd ed. Draft, 2025.</p>
</li>
<li>
<p>M. Gromov, Metric Structures for Riemannian and Non-Riemannian Spaces. Boston, MA, USA: Birkhäuser, 2007.</p>
</li>
<li>
<p>C. Villani, Optimal Transport: Old and New. New York, NY, USA: Springer, 2009.</p>
</li>
<li>
<p>D. Alvarez-Melis and T. Jaakkola, "Gromov-Wasserstein alignment of word embedding spaces," in Proc. ACL Conference on Empirical Methods in Natural Language Processing ’18, Brussels, Belgium, Oct. 2018, pp. 1881–1890.</p>
</li>
<li>
<p>T. Landauer, P. Foltz, and D. Laham, "An introduction to latent semantic analysis," Discourse Processes, vol. 25, no. 2-3, pp. 259-284, Jan. 1998.</p>
</li>
<li>
<p>W. Johnson, J. Lindenstrauss, and G. Schechtman, "Extensions of Lipschitz maps into Banach spaces," Israel Journal of Mathematics, vol. 54, no. 2, pp. 129-138, Jun. 1986.</p>
</li>
<li>
<p>A. Oord, Y. Li, and O. Vinyals, "Representation learning with contrastive predictive coding," arXiv: 1807.03748, Jan. 2019.</p>
</li>
<li>
<p>P. Elias, "Predictive coding - Part 1," IRE Transactions on Information Theory, vol. 1, no. 1, pp. 16-24, Mar. 1955.</p>
</li>
<li>
<p>P. Elias, "Predictive coding - Part 2," IRE Transactions on Information Theory, vol. 1, no. 1, pp. 24-33, Mar. 1955.</p>
</li>
<li>
<p>B. Poole, S. Ozair, A. Oord, A. Alemi, and G. Tucker, "On variational bounds of mutual information," in Proc. 36th International Conference on Machine Learning ’19, Long Beach, CA, USA, Jun. 2019, pp. 5171-5180.</p>
</li>
<li>
<p>J. Massey, "Causality, feedback and directed information," in Proc. IEEE International Symposium on Information Theory ’90, Waikiki, HI, USA, Nov. 1990.</p>
</li>
<li>
<p>S. Peng, Nonlinear Expectations and Stochastic Calculus under Uncertainty: with Robust CLT and G-Brownian Motion. Berlin, Germany: Springer, 2019.</p>
</li>
<li>
<p>H. Lütkepohl, New Introduction to Multiple Time Series Analysis. Berlin, Germany: Springer, 2007.</p>
</li>
<li>
<p>H. Ramsauer et al., "Hopfield networks is all you need," arXiv: 2008.02217, Apr. 2021.</p>
</li>
<li>
<p>Y. Xia et al., "ER-RAG: Enhance RAG with ER-based unified modeling of heterogeneous data sources," arXiv: 2504.06271, Mar. 2025.</p>
</li>
<li>
<p>W. Weaver and C. Shannon, "Recent contributions to the mathematical theory of communications," The Rockefeller Foundation, Sep. 1949.</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redux vs Zustand vs MobX 对比文档]]></title>    <link>https://juejin.cn/post/7600764857769852978</link>    <guid>https://juejin.cn/post/7600764857769852978</guid>    <pubDate>2026-01-30T07:03:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857769852978" data-draft-id="7600990891205984283" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redux vs Zustand vs MobX 对比文档"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T07:03:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="王柄真"/> <meta itemprop="url" content="https://juejin.cn/user/1966406809955719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redux vs Zustand vs MobX 对比文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1966406809955719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    王柄真
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:03:40.000Z" title="Fri Jan 30 2026 07:03:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>Redux、Zustand 和 MobX 是三个流行的 React 状态管理库，它们各有特点和适用场景。本文档从多个维度对比这三个库，帮助你选择最适合的状态管理方案。</p>
<h2 data-id="heading-1">概念对比</h2>
<h3 data-id="heading-2">Redux</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ced62adaaf6f43c3bf858e888d1a820f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5p-E55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361422&amp;x-signature=kQzXGKwNaRZ59wWcO21HXZU0GFY%3D" alt="redux.png" loading="lazy"/></p>
<ul>
<li><strong>单向数据流</strong>：View → Action → Reducer → Store → View</li>
<li><strong>不可变更新</strong>：必须返回新状态</li>
<li><strong>纯函数</strong>：Reducer 必须是纯函数</li>
<li><strong>单一数据源</strong>：整个应用只有一个 store</li>
</ul>
<h3 data-id="heading-3">Zustand</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a6e64738fc47e4ba7ab8711b48fe83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5p-E55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361422&amp;x-signature=LIWoSb93NUzKcQFf8GgDl2U6Vuw%3D" alt="z.png" loading="lazy"/></p>
<ul>
<li><strong>简单直接</strong>：直接调用 store 的方法</li>
<li><strong>选择器订阅</strong>：只订阅需要的状态部分</li>
<li><strong>灵活更新</strong>：支持函数式和直接更新</li>
<li><strong>无 Provider</strong>：不需要包裹 Provider</li>
</ul>
<h3 data-id="heading-4">MobX</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64afff5066144ce3832c43565ebe539d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5p-E55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361422&amp;x-signature=7jIqChm8gAMxEnQ3EULTr5%2Fk7Es%3D" alt="m.png" loading="lazy"/></p>
<ul>
<li><strong>响应式编程</strong>：自动追踪状态变化</li>
<li><strong>直接修改</strong>：可以直接修改状态</li>
<li><strong>自动更新</strong>：自动更新依赖的组件</li>
<li><strong>细粒度更新</strong>：只更新真正变化的部分</li>
</ul>
<h2 data-id="heading-5">详细对比</h2>
<h3 data-id="heading-6">1. 体积和依赖</h3>



































<table><thead><tr><th>特性</th><th>Redux</th><th>Zustand</th><th>MobX</th></tr></thead><tbody><tr><td><strong>体积</strong></td><td>~10KB</td><td>~1KB</td><td>~15KB</td></tr><tr><td><strong>依赖</strong></td><td>无</td><td>无</td><td>无</td></tr><tr><td><strong>React 绑定</strong></td><td>react-redux (~5KB)</td><td>内置</td><td>mobx-react-lite (~2KB)</td></tr><tr><td><strong>总体积</strong></td><td>~15KB</td><td>~1KB</td><td>~17KB</td></tr></tbody></table>
<p><strong>结论</strong>：Zustand 体积最小，Redux 和 MobX 体积相近。</p>
<h3 data-id="heading-7">2. 代码示例对比</h3>
<h4 data-id="heading-8">创建 Store</h4>
<p><strong>Redux</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// actions/counterActions.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"/>) =&gt; ({ <span class="hljs-attr">type</span>: <span class="hljs-string">'INCREMENT'</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"/>) =&gt; ({ <span class="hljs-attr">type</span>: <span class="hljs-string">'DECREMENT'</span> })
​
<span class="hljs-comment">// reducers/counterReducer.js</span>
<span class="hljs-keyword">const</span> initialState = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">counterReducer</span>(<span class="hljs-params">state = initialState, action</span>) {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'INCREMENT'</span>:
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DECREMENT'</span>:
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> }
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state
  }
}
​
<span class="hljs-comment">// store/index.js</span>
<span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>
<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(counterReducer)
</code></pre>
<p><strong>Zustand</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>
​
<span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
  <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> })),
}))
</code></pre>
<p><strong>MobX</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { makeAutoObservable } <span class="hljs-keyword">from</span> <span class="hljs-string">'mobx'</span>
​
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterStore</span> {
  count = <span class="hljs-number">0</span>
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">makeAutoObservable</span>(<span class="hljs-variable language_">this</span>)
  }
  
  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
  }
  
  <span class="hljs-title function_">decrement</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--
  }
}
​
<span class="hljs-keyword">const</span> counterStore = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CounterStore</span>()
</code></pre>
<h4 data-id="heading-9">在组件中使用</h4>
<p><strong>Redux</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useSelector, useDispatch } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>
<span class="hljs-keyword">import</span> { increment, decrement } <span class="hljs-keyword">from</span> <span class="hljs-string">'./actions/counterActions'</span>
​
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">count</span>)
  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>()
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch(decrement())}&gt;-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch(increment())}&gt;+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>Zustand</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> useStore <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>
​
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>)
  <span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">increment</span>)
  <span class="hljs-keyword">const</span> decrement = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">decrement</span>)
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{decrement}</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>MobX</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { observer } <span class="hljs-keyword">from</span> <span class="hljs-string">'mobx-react-lite'</span>
<span class="hljs-keyword">import</span> counterStore <span class="hljs-keyword">from</span> <span class="hljs-string">'./stores/counterStore'</span>
​
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Counter</span> = <span class="hljs-title function_">observer</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> counterStore.decrement()}&gt;-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{counterStore.count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> counterStore.increment()}&gt;+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
})
</code></pre>
<p><strong>对比</strong>：</p>
<ul>
<li>Redux：（actions + reducer + store + component）</li>
<li>Zustand：（store + component）</li>
<li>MobX：（store + component）</li>
</ul>
<h3 data-id="heading-10">3. 性能对比</h3>



































<table><thead><tr><th>特性</th><th>Redux</th><th>Zustand</th><th>MobX</th></tr></thead><tbody><tr><td><strong>更新粒度</strong></td><td>组件级（通过 useSelector）</td><td>选择器级（细粒度）</td><td>属性级（最细粒度）</td></tr><tr><td><strong>重新渲染</strong></td><td>订阅的组件重新渲染</td><td>订阅的组件重新渲染</td><td>只有使用变化属性的组件重新渲染</td></tr><tr><td><strong>性能优化</strong></td><td>需要手动优化（useMemo、useCallback）</td><td>自动优化（选择器）</td><td>自动优化（细粒度追踪）</td></tr><tr><td><strong>大列表性能</strong></td><td>良好</td><td>良好</td><td>优秀</td></tr></tbody></table>
<p><strong>结论</strong>：MobX 性能最好（细粒度更新），Zustand 和 Redux 性能相近。</p>
<h3 data-id="heading-11">5. TypeScript 支持</h3>





























<table><thead><tr><th>特性</th><th>Redux</th><th>Zustand</th><th>MobX</th></tr></thead><tbody><tr><td><strong>原生支持</strong></td><td>需要额外配置</td><td>原生支持</td><td>原生支持</td></tr><tr><td><strong>类型推断</strong></td><td>需要手动定义类型</td><td>自动推断</td><td>自动推断</td></tr><tr><td><strong>类型安全</strong></td><td>良好（需要配置）</td><td>优秀</td><td>优秀</td></tr></tbody></table>
<p><strong>结论</strong>：Zustand 和 MobX 的 TypeScript 支持更好。</p>
<h3 data-id="heading-12">6. 中间件和扩展</h3>



































<table><thead><tr><th>特性</th><th>Redux</th><th>Zustand</th><th>MobX</th></tr></thead><tbody><tr><td><strong>中间件系统</strong></td><td>强大（redux-thunk、redux-saga 等）</td><td>内置中间件（persist、devtools）</td><td>无中间件概念</td></tr><tr><td><strong>DevTools</strong></td><td>优秀（Redux DevTools）</td><td>支持（可选）</td><td>支持（MobX DevTools）</td></tr><tr><td><strong>持久化</strong></td><td>需要 redux-persist</td><td>内置 persist 中间件</td><td>需要 mobx-persist</td></tr><tr><td><strong>异步处理</strong></td><td>redux-thunk、redux-saga</td><td>原生支持</td><td>原生支持（runInAction）</td></tr></tbody></table>
<p><strong>结论</strong>：Redux 的中间件生态系统最丰富，Zustand 内置常用功能，MobX 通过其他方式实现。</p>
<h3 data-id="heading-13">7. 适用场景</h3>
<h4 data-id="heading-14">Redux 适合：</h4>
<ul>
<li>✅ 大型复杂应用</li>
<li>✅ 需要时间旅行调试</li>
<li>✅ 需要强大的中间件系统</li>
<li>✅ 团队熟悉函数式编程</li>
<li>✅ 需要严格的状态管理规范</li>
</ul>
<h4 data-id="heading-15">Zustand 适合：</h4>
<ul>
<li>✅ 中小型应用</li>
<li>✅ 需要简单快速的状态管理</li>
<li>✅ 不想写太多样板代码</li>
<li>✅ 需要轻量级解决方案</li>
<li>✅ 快速原型开发</li>
</ul>
<h4 data-id="heading-16">MobX 适合：</h4>
<ul>
<li>✅ 需要细粒度更新</li>
<li>✅ 喜欢响应式编程</li>
<li>✅ 面向对象思维</li>
<li>✅ 需要高性能的大列表</li>
<li>✅ 复杂的状态依赖关系</li>
</ul>
<h3 data-id="heading-17">8. 生态</h3>



































<table><thead><tr><th>特性</th><th>Redux</th><th>Zustand</th><th>MobX</th></tr></thead><tbody><tr><td><strong>社区规模</strong></td><td>最大</td><td>中等</td><td>较大</td></tr><tr><td><strong>第三方库</strong></td><td>丰富（redux-thunk、redux-saga 等）</td><td>较少</td><td>中等</td></tr><tr><td><strong>学习资源</strong></td><td>最多</td><td>中等</td><td>较多</td></tr><tr><td><strong>维护活跃度</strong></td><td>活跃</td><td>活跃</td><td>活跃</td></tr></tbody></table>
<p><strong>结论</strong>：Redux 生态系统最丰富，Zustand 和 MobX 生态系统相对较小但足够使用。</p>

























<table><thead><tr><th>方案</th><th>核心定位</th><th>最佳适用场景</th></tr></thead><tbody><tr><td>Redux</td><td>规范优先的全量状态管理</td><td>超大型应用、多人协作团队、需要严格状态追溯 / 审计的场景（如企业级系统、大型电商、政务系统）；需依赖丰富中间件（saga/thunk）处理复杂异步逻辑的场景。</td></tr><tr><td>Zustand</td><td>轻量优先的极简状态管理</td><td>中小型应用、追求低样板代码的场景；替代 Context + useReducer 解决性能问题的场景（如工具类应用、中小型业务系统）；需要「无 Provider 嵌套」+「细粒度订阅」的场景。</td></tr><tr><td>MobX</td><td>效率优先的响应式管理</td><td>复杂状态交互、快速开发的场景；交互密集型应用（如可视化编辑器、表单密集型应用、数据看板）；追求「零样板代码」+「极致细粒度更新」的场景。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS BEM命名-档案管理和物联网]]></title>    <link>https://juejin.cn/post/7600764857769918514</link>    <guid>https://juejin.cn/post/7600764857769918514</guid>    <pubDate>2026-01-30T07:06:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857769918514" data-draft-id="7600678255042412553" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS BEM命名-档案管理和物联网"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-30T07:06:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hypnos_xy"/> <meta itemprop="url" content="https://juejin.cn/user/1259383317872089"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS BEM命名-档案管理和物联网
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1259383317872089/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hypnos_xy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:06:34.000Z" title="Fri Jan 30 2026 07:06:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"⇲"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"•";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">档案管理</h2>
<h3 data-id="heading-1">block</h3>
<h4 data-id="heading-2">文件管理</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.file</span>            <span class="hljs-comment">/* 文件 */</span>
<span class="hljs-selector-class">.folder</span>          <span class="hljs-comment">/* 文件夹 */</span>
<span class="hljs-selector-class">.document</span>        <span class="hljs-comment">/* 文档 */</span>
<span class="hljs-selector-class">.archive</span>         <span class="hljs-comment">/* 档案 */</span>
<span class="hljs-selector-class">.record</span>          <span class="hljs-comment">/* 记录 */</span>
<span class="hljs-selector-class">.file-list</span>       <span class="hljs-comment">/* 文件列表 */</span>
<span class="hljs-selector-class">.folder-tree</span>     <span class="hljs-comment">/* 文件夹树 */</span>
<span class="hljs-selector-class">.file-grid</span>       <span class="hljs-comment">/* 文件网格 */</span>
<span class="hljs-selector-class">.file-item</span>       <span class="hljs-comment">/* 文件项 */</span>
<span class="hljs-selector-class">.folder-item</span>     <span class="hljs-comment">/* 文件夹项 */</span>
</code></pre>
<h4 data-id="heading-3">文件操作</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.file-upload</span>     <span class="hljs-comment">/* 文件上传 */</span>
<span class="hljs-selector-class">.file-download</span>   <span class="hljs-comment">/* 文件下载 */</span>
<span class="hljs-selector-class">.file-preview</span>    <span class="hljs-comment">/* 文件预览 */</span>
<span class="hljs-selector-class">.file-edit</span>       <span class="hljs-comment">/* 文件编辑 */</span>
<span class="hljs-selector-class">.file-delete</span>     <span class="hljs-comment">/* 文件删除 */</span>
<span class="hljs-selector-class">.file-move</span>       <span class="hljs-comment">/* 文件移动 */</span>
<span class="hljs-selector-class">.file-copy</span>       <span class="hljs-comment">/* 文件复制 */</span>
<span class="hljs-selector-class">.file-share</span>      <span class="hljs-comment">/* 文件分享 */</span>
<span class="hljs-selector-class">.file-print</span>      <span class="hljs-comment">/* 文件打印 */</span>
<span class="hljs-selector-class">.file-export</span>     <span class="hljs-comment">/* 文件导出 */</span>
<span class="hljs-selector-class">.file-import</span>     <span class="hljs-comment">/* 文件导入 */</span>
</code></pre>
<h4 data-id="heading-4">预览与查看</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.preview</span>         <span class="hljs-comment">/* 预览 */</span>
<span class="hljs-selector-class">.viewer</span>          <span class="hljs-comment">/* 查看器 */</span>
<span class="hljs-selector-class">.thumbnail</span>       <span class="hljs-comment">/* 缩略图 */</span>
<span class="hljs-selector-class">.fullscreen</span>      <span class="hljs-comment">/* 全屏查看 */</span>
<span class="hljs-selector-class">.document-view</span>   <span class="hljs-comment">/* 文档视图 */</span>
<span class="hljs-selector-class">.image-viewer</span>    <span class="hljs-comment">/* 图片查看器 */</span>
<span class="hljs-selector-class">.pdf-viewer</span>      <span class="hljs-comment">/* PDF查看器 */</span>
<span class="hljs-selector-class">.video-viewer</span>    <span class="hljs-comment">/* 视频查看器 */</span>
</code></pre>
<h4 data-id="heading-5">分类与标签</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.category</span>        <span class="hljs-comment">/* 分类 */</span>
<span class="hljs-selector-class">.tag</span>             <span class="hljs-comment">/* 标签 */</span>
<span class="hljs-selector-class">.label</span>           <span class="hljs-comment">/* 标签（用于标记） */</span>
<span class="hljs-selector-class">.classification</span>  <span class="hljs-comment">/* 分类（分级） */</span>
<span class="hljs-selector-class">.taxonomy</span>        <span class="hljs-comment">/* 分类法 */</span>
<span class="hljs-selector-class">.metadata</span>        <span class="hljs-comment">/* 元数据 */</span>
<span class="hljs-selector-class">.keyword</span>         <span class="hljs-comment">/* 关键词 */</span>
</code></pre>
<h4 data-id="heading-6">搜索与筛选</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.search-box</span>      <span class="hljs-comment">/* 搜索框 */</span>
<span class="hljs-selector-class">.advanced-search</span> <span class="hljs-comment">/* 高级搜索 */</span>
<span class="hljs-selector-class">.filter</span>          <span class="hljs-comment">/* 筛选器 */</span>
<span class="hljs-selector-class">.sort</span>            <span class="hljs-comment">/* 排序器 */</span>
<span class="hljs-selector-class">.search-result</span>   <span class="hljs-comment">/* 搜索结果 */</span>
<span class="hljs-selector-class">.filter-panel</span>    <span class="hljs-comment">/* 筛选面板 */</span>
<span class="hljs-selector-class">.search-history</span>  <span class="hljs-comment">/* 搜索历史 */</span>
</code></pre>
<h4 data-id="heading-7">版本控制</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.version</span>         <span class="hljs-comment">/* 版本 */</span>
<span class="hljs-selector-class">.version-history</span> <span class="hljs-comment">/* 版本历史 */</span>
<span class="hljs-selector-class">.version-list</span>    <span class="hljs-comment">/* 版本列表 */</span>
<span class="hljs-selector-class">.revision</span>        <span class="hljs-comment">/* 修订版 */</span>
<span class="hljs-selector-class">.diff</span>            <span class="hljs-comment">/* 差异对比 */</span>
<span class="hljs-selector-class">.change-log</span>      <span class="hljs-comment">/* 变更日志 */</span>
</code></pre>
<h4 data-id="heading-8">权限与分享</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.permission</span>      <span class="hljs-comment">/* 权限 */</span>
<span class="hljs-selector-class">.permission-list</span> <span class="hljs-comment">/* 权限列表 */</span>
<span class="hljs-selector-class">.share</span>           <span class="hljs-comment">/* 分享 */</span>
<span class="hljs-selector-class">.share-dialog</span>    <span class="hljs-comment">/* 分享对话框 */</span>
<span class="hljs-selector-class">.access-control</span>  <span class="hljs-comment">/* 访问控制 */</span>
<span class="hljs-selector-class">.role</span>            <span class="hljs-comment">/* 角色 */</span>
<span class="hljs-selector-class">.user-permission</span> <span class="hljs-comment">/* 用户权限 */</span>
</code></pre>
<h4 data-id="heading-9">工作流</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.workflow</span>        <span class="hljs-comment">/* 工作流 */</span>
<span class="hljs-selector-class">.approval</span>        <span class="hljs-comment">/* 审批 */</span>
<span class="hljs-selector-class">.approval-flow</span>   <span class="hljs-comment">/* 审批流程 */</span>
<span class="hljs-selector-class">.task</span>            <span class="hljs-comment">/* 任务 */</span>
<span class="hljs-selector-class">.task-list</span>       <span class="hljs-comment">/* 任务列表 */</span>
<span class="hljs-selector-class">.process</span>         <span class="hljs-comment">/* 流程 */</span>
<span class="hljs-selector-class">.step</span>            <span class="hljs-comment">/* 步骤 */</span>
</code></pre>
<h4 data-id="heading-10">档案属性</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.metadata-panel</span>  <span class="hljs-comment">/* 元数据面板 */</span>
<span class="hljs-selector-class">.properties</span>      <span class="hljs-comment">/* 属性 */</span>
<span class="hljs-selector-class">.details</span>         <span class="hljs-comment">/* 详情 */</span>
<span class="hljs-selector-class">.info-panel</span>      <span class="hljs-comment">/* 信息面板 */</span>
<span class="hljs-selector-class">.stats</span>           <span class="hljs-comment">/* 统计信息 */</span>
<span class="hljs-selector-class">.usage-stats</span>     <span class="hljs-comment">/* 使用统计 */</span>
</code></pre>
<h4 data-id="heading-11">其他</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.barcode-scanner</span> <span class="hljs-comment">/* 条形码扫描器 */</span>
<span class="hljs-selector-class">.qr-code</span>         <span class="hljs-comment">/* 二维码 */</span>
<span class="hljs-selector-class">.document-scanner</span> <span class="hljs-comment">/* 文档扫描仪 */</span>
<span class="hljs-selector-class">.ocr</span>             <span class="hljs-comment">/* 光学字符识别 */</span>
<span class="hljs-selector-class">.digital-signature</span> <span class="hljs-comment">/* 数字签名 */</span>
<span class="hljs-selector-class">.watermark</span>       <span class="hljs-comment">/* 水印 */</span>
<span class="hljs-selector-class">.archive-search</span>  <span class="hljs-comment">/* 档案搜索 */</span>
<span class="hljs-selector-class">.retention-policy</span> <span class="hljs-comment">/* 保留策略 */</span>
</code></pre>
<h3 data-id="heading-12">element</h3>
<h4 data-id="heading-13">文件管理</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* .file 的 Element */</span>
__icon       <span class="hljs-comment">/* 文件图标 */</span>
__name       <span class="hljs-comment">/* 文件名 */</span>
__size       <span class="hljs-comment">/* 文件大小 */</span>
__type       <span class="hljs-comment">/* 文件类型 */</span>
__modified   <span class="hljs-comment">/* 修改时间 */</span>
__preview    <span class="hljs-comment">/* 文件预览 */</span>
__actions    <span class="hljs-comment">/* 文件操作 */</span>
__status     <span class="hljs-comment">/* 文件状态 */</span>
__version    <span class="hljs-comment">/* 文件版本 */</span>
__metadata   <span class="hljs-comment">/* 元数据 */</span>
</code></pre>
<h4 data-id="heading-14">文件夹管理</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* .folder 的 Element */</span>
__icon       <span class="hljs-comment">/* 文件夹图标 */</span>
__name       <span class="hljs-comment">/* 文件夹名 */</span>
__count      <span class="hljs-comment">/* 文件数量 */</span>
__size       <span class="hljs-comment">/* 文件夹大小 */</span>
__tree       <span class="hljs-comment">/* 树形结构 */</span>
__node       <span class="hljs-comment">/* 树节点 */</span>
__children   <span class="hljs-comment">/* 子文件夹 */</span>
__expand     <span class="hljs-comment">/* 展开按钮 */</span>
__collapse   <span class="hljs-comment">/* 折叠按钮 */</span>
</code></pre>
<h4 data-id="heading-15">文档查看器</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* .document-viewer 的 Element */</span>
__page       <span class="hljs-comment">/* 页面 */</span>
__content    <span class="hljs-comment">/* 文档内容 */</span>
__toolbar    <span class="hljs-comment">/* 工具栏 */</span>
__zoom       <span class="hljs-comment">/* 缩放控制 */</span>
__page-<span class="hljs-selector-tag">nav</span>   <span class="hljs-comment">/* 页面导航 */</span>
__thumbnails <span class="hljs-comment">/* 缩略图 */</span>
__search     <span class="hljs-comment">/* 搜索区域 */</span>
__highlight  <span class="hljs-comment">/* 高亮标记 */</span>
__annotation <span class="hljs-comment">/* 批注 */</span>
</code></pre>
<h2 data-id="heading-16">物联网项目</h2>
<h3 data-id="heading-17">block</h3>
<h4 data-id="heading-18">设备管理</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.device</span>          <span class="hljs-comment">/* 设备 */</span>
<span class="hljs-selector-class">.device-list</span>     <span class="hljs-comment">/* 设备列表 */</span>
<span class="hljs-selector-class">.device-item</span>     <span class="hljs-comment">/* 设备项 */</span>
<span class="hljs-selector-class">.device-detail</span>   <span class="hljs-comment">/* 设备详情 */</span>
<span class="hljs-selector-class">.device-status</span>   <span class="hljs-comment">/* 设备状态 */</span>
<span class="hljs-selector-class">.device-control</span>  <span class="hljs-comment">/* 设备控制 */</span>
<span class="hljs-selector-class">.device-config</span>   <span class="hljs-comment">/* 设备配置 */</span>
<span class="hljs-selector-class">.device-group</span>    <span class="hljs-comment">/* 设备组 */</span>
</code></pre>
<h4 data-id="heading-19">传感器与数据</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.sensor</span>          <span class="hljs-comment">/* 传感器 */</span>
<span class="hljs-selector-class">.sensor-list</span>     <span class="hljs-comment">/* 传感器列表 */</span>
<span class="hljs-selector-class">.data-stream</span>     <span class="hljs-comment">/* 数据流 */</span>
<span class="hljs-selector-class">.metric</span>          <span class="hljs-comment">/* 指标 */</span>
<span class="hljs-selector-class">.reading</span>         <span class="hljs-comment">/* 读数 */</span>
<span class="hljs-selector-class">.sensor-data</span>     <span class="hljs-comment">/* 传感器数据 */</span>
<span class="hljs-selector-class">.data-point</span>      <span class="hljs-comment">/* 数据点 */</span>
<span class="hljs-selector-class">.telemetry</span>       <span class="hljs-comment">/* 遥测数据 */</span>
</code></pre>
<h4 data-id="heading-20">监控与告警</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.monitor</span>         <span class="hljs-comment">/* 监控 */</span>
<span class="hljs-selector-class">.monitor-panel</span>   <span class="hljs-comment">/* 监控面板 */</span>
<span class="hljs-selector-class">.alert</span>           <span class="hljs-comment">/* 告警 */</span>
<span class="hljs-selector-class">.alert-list</span>      <span class="hljs-comment">/* 告警列表 */</span>
<span class="hljs-selector-class">.notification</span>    <span class="hljs-comment">/* 通知 */</span>
<span class="hljs-selector-class">.threshold</span>       <span class="hljs-comment">/* 阈值 */</span>
<span class="hljs-selector-class">.alert-history</span>   <span class="hljs-comment">/* 告警历史 */</span>
<span class="hljs-selector-class">.warning</span>         <span class="hljs-comment">/* 警告 */</span>
</code></pre>
<h4 data-id="heading-21">地图与位置</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.map</span>             <span class="hljs-comment">/* 地图 */</span>
<span class="hljs-selector-class">.map-view</span>        <span class="hljs-comment">/* 地图视图 */</span>
<span class="hljs-selector-class">.location</span>        <span class="hljs-comment">/* 位置 */</span>
<span class="hljs-selector-class">.geo-map</span>         <span class="hljs-comment">/* 地理地图 */</span>
<span class="hljs-selector-class">.location-marker</span> <span class="hljs-comment">/* 位置标记 */</span>
<span class="hljs-selector-class">.geofence</span>        <span class="hljs-comment">/* 地理围栏 */</span>
<span class="hljs-selector-class">.coordinate</span>      <span class="hljs-comment">/* 坐标 */</span>
</code></pre>
<h4 data-id="heading-22">控制面板</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.dashboard</span>       <span class="hljs-comment">/* 仪表板 */</span>
<span class="hljs-selector-class">.control-panel</span>   <span class="hljs-comment">/* 控制面板 */</span>
<span class="hljs-selector-class">.control-button</span>  <span class="hljs-comment">/* 控制按钮 */</span>
<span class="hljs-selector-class">.switch</span>          <span class="hljs-comment">/* 开关 */</span>
<span class="hljs-selector-class">.slider-control</span>  <span class="hljs-comment">/* 滑块控制 */</span>
<span class="hljs-selector-class">.toggle-control</span>  <span class="hljs-comment">/* 切换控制 */</span>
<span class="hljs-selector-class">.remote-control</span>  <span class="hljs-comment">/* 远程控制 */</span>
</code></pre>
<h4 data-id="heading-23">图表与可视化</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.chart</span>           <span class="hljs-comment">/* 图表 */</span>
<span class="hljs-selector-class">.realtime-chart</span>  <span class="hljs-comment">/* 实时图表 */</span>
<span class="hljs-selector-class">.historical-data</span> <span class="hljs-comment">/* 历史数据 */</span>
<span class="hljs-selector-class">.trend</span>           <span class="hljs-comment">/* 趋势 */</span>
<span class="hljs-selector-class">.graph</span>           <span class="hljs-comment">/* 图形 */</span>
<span class="hljs-selector-class">.gauge</span>           <span class="hljs-comment">/* 仪表盘 */</span>
<span class="hljs-selector-class">.indicator</span>       <span class="hljs-comment">/* 指示器 */</span>
</code></pre>
<h4 data-id="heading-24">网络与连接</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.network</span>         <span class="hljs-comment">/* 网络 */</span>
<span class="hljs-selector-class">.connection</span>      <span class="hljs-comment">/* 连接 */</span>
<span class="hljs-selector-class">.signal</span>          <span class="hljs-comment">/* 信号 */</span>
<span class="hljs-selector-class">.signal-strength</span> <span class="hljs-comment">/* 信号强度 */</span>
<span class="hljs-selector-class">.network-status</span>  <span class="hljs-comment">/* 网络状态 */</span>
<span class="hljs-selector-class">.connectivity</span>    <span class="hljs-comment">/* 连接性 */</span>
<span class="hljs-selector-class">.connection-log</span>  <span class="hljs-comment">/* 连接日志 */</span>
</code></pre>
<h4 data-id="heading-25">日志与事件</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.log</span>             <span class="hljs-comment">/* 日志 */</span>
<span class="hljs-selector-class">.log-viewer</span>      <span class="hljs-comment">/* 日志查看器 */</span>
<span class="hljs-selector-class">.event</span>           <span class="hljs-comment">/* 事件 */</span>
<span class="hljs-selector-class">.event-list</span>      <span class="hljs-comment">/* 事件列表 */</span>
<span class="hljs-selector-class">.activity-log</span>    <span class="hljs-comment">/* 活动日志 */</span>
<span class="hljs-selector-class">.audit-trail</span>     <span class="hljs-comment">/* 审计追踪 */</span>
<span class="hljs-selector-class">.timestamp</span>       <span class="hljs-comment">/* 时间戳 */</span>
</code></pre>
<h4 data-id="heading-26">设备类型特定</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.thermostat</span>      <span class="hljs-comment">/* 温控器 */</span>
<span class="hljs-selector-class">.camera</span>          <span class="hljs-comment">/* 摄像头 */</span>
<span class="hljs-selector-class">.lock</span>            <span class="hljs-comment">/* 锁 */</span>
<span class="hljs-selector-class">.light</span>           <span class="hljs-comment">/* 灯 */</span>
<span class="hljs-selector-class">.motor</span>           <span class="hljs-comment">/* 电机 */</span>
<span class="hljs-selector-class">.valve</span>           <span class="hljs-comment">/* 阀门 */</span>
<span class="hljs-selector-class">.relay</span>           <span class="hljs-comment">/* 继电器 */</span>
<span class="hljs-selector-class">.gateway</span>         <span class="hljs-comment">/* 网关 */</span>
</code></pre>
<h4 data-id="heading-27">其他</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.firmware-update</span> <span class="hljs-comment">/* 固件更新 */</span>
<span class="hljs-selector-class">.ota</span>             <span class="hljs-comment">/* 空中下载技术 */</span>
<span class="hljs-selector-class">.command</span>         <span class="hljs-comment">/* 命令 */</span>
<span class="hljs-selector-class">.command-history</span> <span class="hljs-comment">/* 命令历史 */</span>
<span class="hljs-selector-class">.device-log</span>      <span class="hljs-comment">/* 设备日志 */</span>
<span class="hljs-selector-class">.battery-status</span>  <span class="hljs-comment">/* 电池状态 */</span>
<span class="hljs-selector-class">.signal-quality</span>  <span class="hljs-comment">/* 信号质量 */</span>
<span class="hljs-selector-class">.provisioning</span>    <span class="hljs-comment">/* 设备配网 */</span>
</code></pre>
<h3 data-id="heading-28">element</h3>
<h4 data-id="heading-29">设备管理</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* .device 的 Element */</span>
__icon       <span class="hljs-comment">/* 设备图标 */</span>
__name       <span class="hljs-comment">/* 设备名称 */</span>
__status     <span class="hljs-comment">/* 设备状态 */</span>
__online     <span class="hljs-comment">/* 在线状态 */</span>
__offline    <span class="hljs-comment">/* 离线状态 */</span>
__signal     <span class="hljs-comment">/* 信号强度 */</span>
__battery    <span class="hljs-comment">/* 电池状态 */</span>
__location   <span class="hljs-comment">/* 位置信息 */</span>
__data       <span class="hljs-comment">/* 设备数据 */</span>
__controls   <span class="hljs-comment">/* 控制按钮 */</span>
</code></pre>
<h4 data-id="heading-30">传感器数据</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* .sensor 的 Element */</span>
__value      <span class="hljs-comment">/* 传感器数值 */</span>
__unit       <span class="hljs-comment">/* 单位 */</span>
__reading    <span class="hljs-comment">/* 读数 */</span>
__timestamp  <span class="hljs-comment">/* 时间戳 */</span>
__trend      <span class="hljs-comment">/* 趋势指示 */</span>
__chart      <span class="hljs-comment">/* 数据图表 */</span>
__threshold  <span class="hljs-comment">/* 阈值显示 */</span>
__alert      <span class="hljs-comment">/* 告警状态 */</span>
</code></pre>
<h4 data-id="heading-31">地图展示</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* .map 的 Element */</span>
__marker     <span class="hljs-comment">/* 标记点 */</span>
__cluster    <span class="hljs-comment">/* 标记簇 */</span>
__popup      <span class="hljs-comment">/* 弹出信息 */</span>
__tooltip    <span class="hljs-comment">/* 工具提示 */</span>
__controls   <span class="hljs-comment">/* 地图控制 */</span>
__zoom       <span class="hljs-comment">/* 缩放控制 */</span>
__pan        <span class="hljs-comment">/* 平移控制 */</span>
__layer      <span class="hljs-comment">/* 地图图层 */</span>
__legend     <span class="hljs-comment">/* 图例 */</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[text-decoration 属性]]></title>    <link>https://juejin.cn/post/7600728866757443636</link>    <guid>https://juejin.cn/post/7600728866757443636</guid>    <pubDate>2026-01-30T07:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600728866757443636" data-draft-id="7600728866757427252" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="text-decoration 属性"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T07:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户9388783127708"/> <meta itemprop="url" content="https://juejin.cn/user/1865202043469607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            text-decoration 属性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1865202043469607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户9388783127708
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:17:50.000Z" title="Fri Jan 30 2026 07:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>text-decoration是CSS中用于为文本添加装饰效果的核心属性，主要作用是给文本添加下划线、删除线、上划线等视觉装饰，常用于标记可点击链接、已完成内容、编辑状态文本等场景，通过视觉提示帮助用户理解文本的功能或状态。它是一个简写属性，可以同时设置文本装饰的样式、颜色和线条类型，也可以通过单独的子属性进行更精细的控制。</p>
<h3 data-id="heading-1">语法</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. 简写语法：<span class="hljs-attribute">text-decoration</span>: &lt;text-decoration-line&gt; || &lt;text-decoration-style&gt; || &lt;text-decoration-color&gt; || &lt;text-decoration-thickness&gt;;
<span class="hljs-number">2</span>. 单独子属性：
   - <span class="hljs-attribute">text-decoration-line</span>：控制装饰线的位置，可选值有<span class="hljs-attribute">none</span>（默认，无装饰）、underline（下划线）、overline（上划线）、line-through（删除线）、blink（已废弃，闪烁效果），可多个值空格分隔同时设置
   - <span class="hljs-attribute">text-decoration-style</span>：控制装饰线的样式，可选值有solid（实线，默认）、double（双实线）、dotted（点线）、dashed（虚线）、wavy（波浪线）
   - <span class="hljs-attribute">text-decoration-color</span>：控制装饰线的颜色，可使用任意CSS颜色值（十六进制、RGB、颜色名等）
   - <span class="hljs-attribute">text-decoration</span>-thickness：控制装饰线的粗细，可选值有auto（默认，浏览器自动计算）、from-<span class="hljs-attribute">font</span>（使用字体文件中定义的粗细）、长度值（如<span class="hljs-number">2px</span>）、百分比（如<span class="hljs-number">10%</span>）
</code></pre>
<h3 data-id="heading-2">示例</h3>
<h4 data-id="heading-3">HTML</h4>
<p>复制</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>text-decoration 示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"style.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>text-decoration 基础示例<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"default"</span>&gt;</span>默认文本（无装饰）<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"underline"</span>&gt;</span>这是带下划线的文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"line-through"</span>&gt;</span>这是带删除线的文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overline"</span>&gt;</span>这是带上划线的文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"multi-line"</span>&gt;</span>同时带上划线和下划线<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-style"</span>&gt;</span>带波浪下划线的文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-color"</span>&gt;</span>蓝色粗下划线的文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"remove-link"</span>&gt;</span>去除默认下划线的链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">CSS</h4>
<p>复制</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础装饰效果 */</span>
<span class="hljs-selector-class">.default</span> {
    <span class="hljs-attribute">text-decoration</span>: none;
}
<span class="hljs-selector-class">.underline</span> {
    <span class="hljs-attribute">text-decoration</span>: underline;
}
<span class="hljs-selector-class">.line-through</span> {
    <span class="hljs-attribute">text-decoration</span>: line-through;
}
<span class="hljs-selector-class">.overline</span> {
    <span class="hljs-attribute">text-decoration</span>: overline;
}
<span class="hljs-comment">/* 多装饰线同时设置 */</span>
<span class="hljs-selector-class">.multi-line</span> {
    <span class="hljs-attribute">text-decoration</span>: underline overline;
}
<span class="hljs-comment">/* 自定义装饰线样式 */</span>
<span class="hljs-selector-class">.custom-style</span> {
    <span class="hljs-attribute">text-decoration</span>: underline wavy;
}
<span class="hljs-comment">/* 自定义颜色和粗细 */</span>
<span class="hljs-selector-class">.custom-color</span> {
    <span class="hljs-attribute">text-decoration</span>: underline solid blue <span class="hljs-number">2px</span>;
}
<span class="hljs-comment">/* 去除链接默认下划线 */</span>
<span class="hljs-selector-class">.remove-link</span> {
    <span class="hljs-attribute">text-decoration</span>: none;
}
<span class="hljs-selector-class">.remove-link</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">text-decoration</span>: underline dashed <span class="hljs-number">#ff4444</span>;
}
</code></pre>
<h3 data-id="heading-5">详细解释</h3>
<ol>
<li>.default类：设置text-decoration为none，展示无装饰的默认文本状态 2. .underline/.line-through/.overline类：分别设置单一的下划线、删除线、上划线效果，是最基础的使用方式 3. .multi-line类：同时设置underline和overline，实现文本上下同时有装饰线的效果 4. .custom-style类：指定了装饰线类型为underline，样式为wavy（波浪线），展示自定义装饰线样式的效果 5. .custom-color类：完整设置了装饰线的所有属性，分别是下划线、实线样式、蓝色、2px粗细，展示多属性组合的写法 6. .remove-link类：先去除a标签默认的下划线，然后在hover（鼠标悬停）时添加红色虚线下划线，既优化了默认样式，又保留了链接的交互提示</li>
</ol>
<h3 data-id="heading-6">进阶用法</h3>
<ol>
<li>编辑状态标记：在富文本编辑器中，使用line-through标记已删除的内容，使用underline标记新增的内容，配合不同颜色区分编辑状态 2. 电商价格展示：给原价添加line-through #999的样式，同时展示红色的现价，突出价格优惠信息 3. 自定义链接样式：给链接设置text-decoration: underline wavy #2196F3，实现区别于默认下划线的特色链接样式，增强品牌视觉识别 4. 表单验证提示：给输入错误的表单提示文本添加wavy red的下划线，直观提示用户输入错误 5. 结合伪元素使用：可以通过::after伪元素配合text-decoration实现更复杂的装饰效果，比如在标题下方添加带颜色的装饰线</li>
</ol>
<h3 data-id="heading-7">常见错误</h3>
<ol>
<li>错误：给块级元素设置text-decoration后，误以为子元素可以单独取消装饰。实际上text-decoration会继承给子元素，若要取消子元素的装饰，需要单独给子元素设置text-decoration:none 2. 错误：使用blink值实现闪烁效果，该值已被标准废弃，大部分浏览器不再支持，应避免使用 3. 错误：过度使用装饰线，比如同时给文本添加underline、overline、line-through，导致文本可读性极差 4. 错误：设置装饰线颜色时使用与文本完全相同的颜色，导致装饰线不明显，失去提示作用 5. 错误：去除链接下划线后未添加其他交互反馈，导致用户无法识别可点击元素，应在hover/focus状态下添加装饰或颜色变化</li>
</ol>
<h3 data-id="heading-8">使用技巧</h3>
<ol>
<li>链接样式优化：默认a标签带有下划线，可设置text-decoration:none去除，在hover/focus状态下再添加装饰，提升页面美观度同时保证可访问性 2. 删除线使用场景：常用于电商网站的原价标记、已完成的待办事项，建议搭配较浅的颜色，避免干扰主要内容 3. 装饰线颜色：建议与文本颜色区分开但保持协调，比如使用文本色的70%透明度，既保留提示性又不突兀 4. 避免过度使用：不要同时给文本添加多种装饰线，会导致文本可读性下降，仅在有明确语义需求时使用 5. 可访问性注意：如果使用下划线模拟链接，务必确保有对应的交互反馈，避免混淆普通文本和可点击元素</li>
</ol>
<h3 data-id="heading-9">浏览器兼容性</h3>
<ol>
<li>基础属性（text-decoration-line的none/underline/overline/line-through）：支持所有现代浏览器，包括IE6及以上 2. text-decoration-style的wavy/double/dotted/dashed：支持Chrome 57+、Firefox 36+、Safari 12.1+、Edge 79+，IE不支持 3. text-decoration-thickness：支持Chrome 87+、Firefox 70+、Safari 14.1+、Edge 87+，IE不支持 4. 简写属性的多值组合：所有支持CSS3的浏览器都能正常解析</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[字体大小切割]]></title>    <link>https://juejin.cn/post/7600692485947146249</link>    <guid>https://juejin.cn/post/7600692485947146249</guid>    <pubDate>2026-01-30T07:24:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600692485947146249" data-draft-id="7600692485947064329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="字体大小切割"/> <meta itemprop="keywords" content="前端,JavaScript,Node.js"/> <meta itemprop="datePublished" content="2026-01-30T07:24:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="葉_"/> <meta itemprop="url" content="https://juejin.cn/user/3369350189299688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            字体大小切割
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3369350189299688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    葉_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:24:16.000Z" title="Fri Jan 30 2026 07:24:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">在开发中可能涉及到使用其他字体 但是大多数都太大了 需要优化加载的速度 这时候就可以用到字体大小切割了</h4>
<h3 data-id="heading-1">这里向大家介绍一下 <code>fontmin</code>库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fecomfe%2Ffontmin" target="_blank" title="https://github.com/ecomfe/fontmin" ref="nofollow noopener noreferrer">地址</a></h3>
<h6 data-id="heading-2">Fontmin是一个用于优化网页字体文件的JavaScript工具库，核心功能是“字体子集化”。它能从完整的字体文件中提取出网页上实际用到的字符，从而将几兆甚至十几兆的字体文件（尤其是中文字体）压缩到几百KB，显著提升网页加载速度。</h6>
<h3 data-id="heading-3">核心功能一览</h3>

























<table><thead><tr><th>功能/插件</th><th>说明</th></tr></thead><tbody><tr><td><strong>字体子集化 (<code>glyph</code>)</strong></td><td>核心功能。通过分析指定文本，仅保留所需字符字形，生成极小字体文件<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40akylas%2Ffontmin%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@akylas/fontmin?activeTab=readme" ref="nofollow noopener noreferrer"/>。</td></tr><tr><td><strong>格式转换</strong></td><td>支持 <code>ttf2eot</code>, <code>ttf2woff</code>, <code>ttf2svg</code>, <code>otf2ttf</code> 等多种格式互转<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40akylas%2Ffontmin%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@akylas/fontmin?activeTab=readme" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fgitblog_00038%2Farticle%2Fdetails%2F154730055" target="_blank" title="https://blog.csdn.net/gitblog_00038/article/details/154730055" ref="nofollow noopener noreferrer"/>。</td></tr><tr><td><strong>CSS生成 (<code>css</code>)</strong></td><td>自动生成 <code>@font-face</code> 等CSS代码，便于网页使用图标字体或自定义字体<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40akylas%2Ffontmin%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@akylas/fontmin?activeTab=readme" ref="nofollow noopener noreferrer"/>。</td></tr><tr><td><strong>SVG图标合并 (<code>svgs2ttf</code>)</strong></td><td>将多个SVG图标文件合并成一个字体文件，方便制作图标字体<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40akylas%2Ffontmin%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@akylas/fontmin?activeTab=readme" ref="nofollow noopener noreferrer"/>。</td></tr></tbody></table>
<h3 data-id="heading-4">使用方法（以下是用koa框架进行的开发）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1.编辑Server</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Fontmin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fontmin'</span>);
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppletService</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateFontSubset</span>(<span class="hljs-params">text, ttfpath, outputPath</span>) {
        <span class="hljs-keyword">const</span> fontmin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fontmin</span>().<span class="hljs-title function_">src</span>(ttfpath).<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Fontmin</span>.<span class="hljs-title function_">glyph</span>({
            text <span class="hljs-comment">//仅保留文本中出现的字符  </span>
        })).<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Fontmin</span>.<span class="hljs-title function_">ttf2woff</span>({
            <span class="hljs-attr">deflate</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 启用WOFF2压缩</span>
        })).<span class="hljs-title function_">dest</span>(outputPath);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            fontmin.<span class="hljs-title function_">run</span>(<span class="hljs-function">(<span class="hljs-params">err, files</span>) =&gt;</span> {
                <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">reject</span>(err);
                <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>(files);
            });
        });
    }
}
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppletService</span>;
<span class="hljs-comment">// 2.编辑Controller</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-property">promises</span>;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppletController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseController</span> {
    <span class="hljs-comment">/** *font
     * 字体分割
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} ctx 
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getFont</span>(<span class="hljs-params">ctx</span>) {
        <span class="hljs-keyword">const</span> { text, fontFamily } = ctx.<span class="hljs-property">query</span>;
        <span class="hljs-keyword">if</span> (!text || !fontFamily) {
            <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">body</span> = <span class="hljs-title class_">BaseController</span>.<span class="hljs-title function_">renderJsonFail</span>(<span class="hljs-number">303</span>, <span class="hljs-string">'参数错误'</span>);
        }
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//const fontPath = `./fonts/${fontFamily}.ttf`</span>

            <span class="hljs-keyword">const</span> fontPath = <span class="hljs-string">`xxxx\\font\\今年也要加油鸭.ttf`</span>;
            <span class="hljs-comment">// 检查文件是否存在</span>
            <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">access</span>(fontPath);

            <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AppletService</span>.<span class="hljs-title function_">generateFontSubset</span>(text, fontPath, <span class="hljs-string">'xxxx\\subset.ttf'</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Subset files generated:'</span>, files)
            
            <span class="hljs-comment">// 找到生成的 woff 文件</span>
            <span class="hljs-keyword">const</span> woffFile = files.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-property">path</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.woff'</span>));
            <span class="hljs-keyword">if</span> (!woffFile) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'生成字体文件失败'</span>);
            }
            

            ctx.<span class="hljs-property">type</span> = <span class="hljs-string">'font/woff2'</span>;
            ctx.<span class="hljs-property">body</span> = woffFile.<span class="hljs-property">contents</span>;
        } <span class="hljs-keyword">catch</span> (e) {
          
            <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">body</span> = <span class="hljs-title class_">BaseController</span>.<span class="hljs-title function_">renderJsonFail</span>(<span class="hljs-number">303</span>, e);
        }

    }
}
<span class="hljs-comment">// 3.编辑router</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AppletController</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../controller/AppletController'</span>);
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/font'</span>,<span class="hljs-title class_">AppletController</span>.<span class="hljs-property">getFont</span>)

<span class="hljs-comment">// 4.使用方法</span>
&lt;style&gt;
	@font-face {
		font-<span class="hljs-attr">family</span>: <span class="hljs-string">'CustomFont'</span>;
		<span class="hljs-attr">src</span>: <span class="hljs-title function_">url</span>(<span class="hljs-string">'http://localhost:3000/api/font?text=示例文本&amp;fontFamily=wwww'</span>) <span class="hljs-title function_">format</span>(<span class="hljs-string">'woff2'</span>);
	}

	.<span class="hljs-property">custom</span>-text {
		font-<span class="hljs-attr">family</span>: <span class="hljs-string">'CustomFont'</span>, sans-serif;
	}
&lt;/style&gt;
....
&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"custom-text"</span>&gt;示例文本哦哦哦本&lt;/div&gt;
....
</code></pre>
<h4 data-id="heading-5">效果</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f975ef0b43394cb994649212ef6255e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGJXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770362655&amp;x-signature=wiZCrLvIpLdTmY8N8ggH9%2Ba88cQ%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于JavaScript和CSS的交互式图片面板设计与实现]]></title>    <link>https://juejin.cn/post/7600799940970414120</link>    <guid>https://juejin.cn/post/7600799940970414120</guid>    <pubDate>2026-01-30T07:49:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600799940970414120" data-draft-id="7600692485947310089" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于JavaScript和CSS的交互式图片面板设计与实现"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T07:49:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lee川"/> <meta itemprop="url" content="https://juejin.cn/user/2402874087453658"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于JavaScript和CSS的交互式图片面板设计与实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2402874087453658/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lee川
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:49:28.000Z" title="Fri Jan 30 2026 07:49:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于JavaScript和CSS的交互式图片面板设计与实现</h2>
<h3 data-id="heading-1">概述</h3>
<p>本文详细分析一个交互式图片面板展示效果的完整实现，涵盖HTML结构、CSS样式（包括Stylus预处理器）、JavaScript DOM操作和事件处理等前端核心技术。该效果允许用户点击不同面板，被点击的面板会展开并显示标题，其他面板则收缩，创造出流畅的视觉体验。</p>
<h3 data-id="heading-2">1. HTML结构设计</h3>
<p>HTML文档构建了基本的页面结构，包含一个容器和多个面板元素：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel active"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-image: url('...')"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Explore The World<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-image: url('...')"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Wild Forest<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 更多面板 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>关键设计要点：</p>
<ul>
<li>使用<code>container</code>作为弹性布局容器，统一管理所有面板</li>
<li>每个<code>panel</code>代表一个可交互的图片面板</li>
<li>通过内联样式设置背景图片，实现动态内容加载</li>
<li>初始状态通过<code>active</code>类标记默认展开的面板</li>
<li>每个面板包含标题元素<code>&lt;h3&gt;</code>，初始状态下隐藏</li>
</ul>
<h3 data-id="heading-3">2. CSS样式与Stylus预处理器</h3>
<h4 data-id="heading-4">2.1 基础样式重置与布局</h4>
<pre><code class="hljs language-css" lang="css">* {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
}
</code></pre>
<p>此规则重置了所有元素的默认边距，确保跨浏览器的一致性。</p>
<h4 data-id="heading-5">2.2 弹性布局实现</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">90vw</span>;
}
</code></pre>
<p>布局关键技术：</p>
<ul>
<li><code>body</code>使用flex布局并设置<code>height: 100vh</code>，实现整体垂直水平居中</li>
<li><code>container</code>作为flex容器，默认沿主轴（水平方向）排列子元素</li>
<li><code>width: 90vw</code>确保容器占据视口宽度的90%，留出边距</li>
</ul>
<h4 data-id="heading-6">2.3 面板样式与动画效果</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">80vh</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">0.5</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">background-size</span>: cover;
  <span class="hljs-attribute">background-position</span>: center;
  <span class="hljs-attribute">background-repeat</span>: no-repeat;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">700ms</span> ease-in;
}

<span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span><span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">5</span>;
}
</code></pre>
<p>面板设计特点：</p>
<ul>
<li><code>flex: 0.5</code>设置面板的初始伸缩比例，实现均匀分布</li>
<li><code>flex: 5</code>在激活状态下显著增加面板宽度</li>
<li><code>transition: all 700ms ease-in</code>创建700毫秒的过渡动画，ease-in函数使动画开始缓慢然后加速</li>
<li>背景图片使用<code>cover</code>模式，确保完全覆盖面板区域</li>
</ul>
<h4 data-id="heading-7">2.4 标题动画效果</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span> <span class="hljs-selector-tag">h3</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">300ms</span> ease-in <span class="hljs-number">400ms</span>;
}

<span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span><span class="hljs-selector-class">.active</span> <span class="hljs-selector-tag">h3</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}
</code></pre>
<p>标题动画设计：</p>
<ul>
<li>初始状态<code>opacity: 0</code>完全透明隐藏标题</li>
<li>激活状态下<code>opacity: 1</code>显示标题</li>
<li>过渡效果延迟400毫秒执行，确保面板展开动画完成后才开始标题显示</li>
</ul>
<h3 data-id="heading-8">3. Stylus预处理器优势</h3>
<p>虽然最终使用的是标准CSS，但开发过程中可以使用Stylus预处理器提高效率：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> 
  <span class="hljs-attribute">display</span> <span class="hljs-attribute">flex</span>
  <span class="hljs-attribute">width</span> <span class="hljs-number">90vw</span>
  
  <span class="hljs-selector-class">.panel</span>
    <span class="hljs-attribute">height</span> <span class="hljs-number">80vh</span>
    <span class="hljs-attribute">border-radius</span> <span class="hljs-number">50px</span>
    <span class="hljs-attribute">flex</span> <span class="hljs-number">0.5</span>
    <span class="hljs-attribute">transition</span> <span class="hljs-attribute">all</span> <span class="hljs-number">700ms</span> ease-in
    
    &amp;<span class="hljs-selector-class">.active</span>
      <span class="hljs-attribute">flex</span> <span class="hljs-number">5</span>
      
    <span class="hljs-selector-tag">h3</span>
      <span class="hljs-attribute">opacity</span> <span class="hljs-number">0</span>
      <span class="hljs-attribute">transition</span> <span class="hljs-attribute">opacity</span> <span class="hljs-number">300ms</span> ease-in <span class="hljs-number">400ms</span>
      
      <span class="hljs-selector-class">.active</span> &amp;
        <span class="hljs-attribute">opacity</span> <span class="hljs-number">1</span>
</code></pre>
<p>Stylus的核心优势：</p>
<ul>
<li><strong>简洁语法</strong>：省略花括号、分号和冒号，使用缩进表示层级</li>
<li><strong>嵌套规则</strong>：直观反映HTML结构，提高代码可读性</li>
<li><strong>变量与混合</strong>：支持定义可重用样式片段</li>
<li><strong>自动前缀</strong>：自动添加浏览器厂商前缀，确保兼容性</li>
</ul>
<p>开发工作流：<code>stylus style.styl -o style.css -w</code>命令实现实时编译监听。</p>
<h3 data-id="heading-9">4. JavaScript交互逻辑</h3>
<h4 data-id="heading-10">4.1 DOM元素选择与类型检测</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">panels</span> = document.querySelectorAll(<span class="hljs-string">'.panel'</span>)<span class="hljs-comment">;</span>

console.log(panels,
    panels<span class="hljs-section">[0]</span>,
    typeof panels<span class="hljs-section">[0]</span>, // "object"
    Object.prototype.toString.call(panels<span class="hljs-section">[0]</span>) // <span class="hljs-section">[object HTMLDivElement]</span>
)<span class="hljs-comment">;</span>
</code></pre>
<p>关键技术点：</p>
<ul>
<li><code>querySelectorAll</code>返回NodeList集合，类似数组但不是真正的数组</li>
<li>JavaScript数据类型检测：<code>typeof</code>对于DOM元素返回"object"</li>
<li>精确类型检测使用<code>Object.prototype.toString.call()</code>方法</li>
</ul>
<h4 data-id="heading-11">4.2 事件监听与类名切换</h4>
<pre><code class="hljs language-javascript" lang="javascript">panels.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">panel</span>) {
    panel.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> cur = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.active'</span>); 
        <span class="hljs-keyword">if</span>(cur) {
            cur.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
        }
        panel.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
    });
});
</code></pre>
<p>事件处理逻辑：</p>
<ul>
<li>使用<code>forEach</code>遍历所有面板元素</li>
<li>为每个面板添加点击事件监听器</li>
<li>点击时先查找当前活跃元素并移除其<code>active</code>类</li>
<li>为当前点击的面板添加<code>active</code>类，触发CSS过渡动画</li>
</ul>
<h3 data-id="heading-12">5. 技术亮点与最佳实践</h3>
<h4 data-id="heading-13">5.1 分离关注点</h4>
<ul>
<li>HTML负责结构</li>
<li>CSS负责表现与动画</li>
<li>JavaScript负责行为与交互</li>
<li>三者清晰分离，提高代码可维护性</li>
</ul>
<h4 data-id="heading-14">5.2 性能优化</h4>
<ul>
<li>使用CSS过渡而非JavaScript动画，利用浏览器硬件加速</li>
<li>事件委托可考虑但当前实现已足够高效</li>
<li>背景图片使用合适的尺寸和压缩，减少加载时间</li>
</ul>
<h4 data-id="heading-15">5.3 用户体验设计</h4>
<ul>
<li>明显的鼠标指针变化(<code>cursor: pointer</code>)提示可交互性</li>
<li>平滑的过渡动画提供视觉反馈</li>
<li>响应式设计适应不同屏幕尺寸</li>
</ul>
<h3 data-id="heading-16">6. 扩展可能性</h3>
<p>此基础实现可以进一步扩展：</p>
<ul>
<li>添加键盘导航支持</li>
<li>实现自动轮播功能</li>
<li>添加触摸滑动支持移动设备</li>
<li>集成更复杂的动画效果</li>
<li>添加懒加载优化性能</li>
</ul>
<h3 data-id="heading-17">结论</h3>
<p>这个交互式图片面板展示了现代前端开发的核心技术融合：语义化HTML结构、CSS3过渡动画与弹性布局、JavaScript DOM操作与事件处理。通过合理的架构设计和关注点分离，创建了既美观又功能完善的用户界面。Stylus预处理器的使用进一步提高了开发效率，体现了现代前端工作流的优势。</p>
<p>此项目是学习前端基础技术的优秀范例，涵盖了从静态布局到动态交互的完整开发流程，为更复杂的前端应用开发奠定了坚实基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“SQL 工人”到“架构师”：我是如何用语义层干掉冗余宽表的]]></title>    <link>https://juejin.cn/post/7600755567486615604</link>    <guid>https://juejin.cn/post/7600755567486615604</guid>    <pubDate>2026-01-30T08:08:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600755567486615604" data-draft-id="7600728866757591092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“SQL 工人”到“架构师”：我是如何用语义层干掉冗余宽表的"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2026-01-30T08:08:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="工程师9527"/> <meta itemprop="url" content="https://juejin.cn/user/4475441251110203"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“SQL 工人”到“架构师”：我是如何用语义层干掉冗余宽表的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4475441251110203/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    工程师9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:08:46.000Z" title="Fri Jan 30 2026 08:08:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这活儿干得越久，就越像西西弗斯推石头——业务需求（石头）源源不断，我们吭哧吭哧建宽表（推上山），然后需求一变，宽表作废（石头滚下来），周而复始。直到最近在一个指标平台项目里，接触到一种叫 “NoETL 语义编织” 的架构，才感觉这石头，好像终于能卸下来了。今天不吹牛，就聊聊这套东西背后的逻辑，以及它是不是真的能让我们摆脱“写不完的宽表 SQL”的宿命。</p>
<h2 data-id="heading-0">一、宽表困境：一个经典的数据工程“不可能三角”</h2>
<p>先别急着说“我们不一样”。扪心自问，下面这几个场景熟不熟悉：</p>
<ol>
<li>排期地狱：运营想加个“用户最近一次登录渠道”的维度来分析 GMV。你心里一算：得，上游用户表没这个字段，得找业务系统加；加了之后，DWD 层要改，然后 DWS 宽表要重建，测试、上线… 一个需求排期两周起步。</li>
<li>口径修罗场：“日活用户”这个指标，在A报表里是<code>UV</code>，在 B 报表里是<code>DAU</code>，在 C 看板里可能还排除了内部账号。业务方拿着三个数来对账，你查了一晚上 SQL，发现是三个不同的 ETL 任务算出来的，逻辑藏在各自的脚本注释里。</li>
<li>存储黑洞：某张核心交易宽表，为了应对各种维度组合，字段膨胀到 200+，其中<code>user_region</code>, <code>user_province</code>, <code>user_city</code>这种地理信息就存了七八套。每天全量更新一次，存储成本高得吓人，查询性能却越来越慢。</li>
</ol>
<p>这就是传统“数仓+宽表”模式的 “效率、质量、成本”不可能三角。你想快（效率），就得牺牲模型规范性（质量），或者堆机器（成本）。你想准（质量），开发周期就长（效率），冗余就多（成本）。最终结果就是：数据工程师成了“SQL 工人”，业务成了“数据乞丐”，整个数据价值链陷入低效内耗。</p>
<h2 data-id="heading-1">二、破局思路：从“物理堆砌”到“语义编织”</h2>
<p>问题的根子在于 “逻辑”和“物理”的强耦合。每个业务需求，都直接对应一张物理宽表。解耦的关键，就是在物理表之上，构建一个统一的逻辑语义层。这个层不存数据，只定义规则。</p>
<p>“语义编织”的核心四步法，下面我们拆开揉碎了看。</p>
<h3 data-id="heading-2">第一步：构建“虚拟业务事实网络”——告别烟囱式宽表</h3>
<p>这步是根基。传统做法是：<code>订单表</code> JOIN <code>用户表</code> JOIN <code>商品表</code> -&gt; 生成 <code>订单_用户_商品_宽表</code>。</p>
<p>语义层的做法是：在界面里声明，<code>订单表</code> 通过 <code>user_id</code> 关联 <code>用户表</code>，通过 <code>sku_id</code> 关联 <code>商品表</code>。系统在逻辑层面记住这些关联关系，但并不立即物理执行 JOIN。</p>
<p>你可以把它理解成一个 “虚拟的、无限宽的明细表” 。所有上层应用，无论是 BI、报表还是 API，都统一向这个虚拟层“要数据”，而不是各自去找不同的物理宽表。这就从源头上解决了“数据孤岛”和“口径不一”的问题。</p>
<p>技术细节：这背后是一个语义引擎（Semantic Engine）。它维护了一套元数据，包括表、字段、关联关系、业务含义注解。当收到查询请求时，引擎根据这些元数据，动态地“编织”出查询所需的逻辑数据模型。</p>
<h3 data-id="heading-3">第二步：声明式指标定义——SQL 工人下岗</h3>
<p>有了虚拟表，怎么算指标？传统是手写 SQL：<code>SELECT sum(amount) FROM 订单宽表 WHERE status='paid' AND dt='2025-01-01'</code>。</p>
<p>语义层把它抽象成四个可配置的要素：</p>
<ol>
<li>基础度量：<code>订单金额 (sum(amount))</code>。这里支持高级聚合，比如“月日均最大值”（先按天聚合，再取月内最大值），传统 SQL 写起来就挺啰嗦。</li>
<li>业务限定：<code>状态='已支付'</code>。更骚的是，它支持“指标结果筛选”，比如“上月交易金额 &gt;1000 的用户”，这本质是一个子查询，但在这里可以像搭积木一样配置。</li>
<li>统计周期：<code>2025-01-01</code>。支持自定义日历，比如“近 5 个交易日”，不用再写复杂的日期偏移函数。</li>
<li>衍生计算：比如用上面定义的“当日支付金额”和“昨日支付金额”，直接配置一个“日环比”计算。</li>
</ol>
<p>“定义即治理”：当你创建一个叫“GMV”的指标时，系统会全局检索同名指标，提示你是否复用或冲突。这就把口径管控从“人治”（靠文档和记忆）变成了“法治”（靠系统规则）。</p>
<h3 data-id="heading-4">第三步：智能物化加速——性能与成本的平衡术</h3>
<p>看到这里，有经验的兄弟肯定要拍桌子了：“你搞个虚拟层，每次查询都现场<code>JOIN</code>，<code>PB</code>级数据还不查崩了？”</p>
<p>问得好！这就是第三步的核心：按需、声明式的物化加速。它不是不物化，而是更聪明地物化。</p>
<ul>
<li>明细加速（预打宽）：对于<code>订单+用户</code>这种高频关联组合，可以声明物化一张实际的宽表。但这是平台根据你的配置自动完成的，你不用写<code>CREATE TABLE AS</code>的 SQL。</li>
<li>汇总加速（预聚合）：对于<code>按天、按省份的GMV</code>这种固定维度聚合，预计算好结果。</li>
<li>结果加速：完全固定的报表结果，直接缓存。</li>
</ul>
<p>最骚的操作是 “智能路由” 。当业务在 BI 里点选“GMV by 省份”时，语义引擎会解析这个请求，发现命中“汇总加速表”，就会自动将查询改写并路由到物化表上，而不是去<code>JOIN</code>明细。整个过程对查询者完全透明。</p>
<p>性能承诺：据他们材料说，能做到百亿数据下 P99&lt;5s。原理就是通过查询模式分析，把资源精准投入到最需要加速的地方，避免了我们以前“无脑建宽表”带来的存储浪费。</p>
<h3 data-id="heading-5">第四步：平滑落地——三步走替换，而非革命</h3>
<p>这套东西再好，也不可能让企业把现有数仓推倒重来。他们的策略很务实，叫 “资产演进三步走”：</p>
<ol>
<li>存量挂载：把现在正在用的、稳定的核心宽表，直接“挂载”到语义层，映射成一个逻辑实体。先让业务方在同一个平台看到统一的数据，建立信任。零开发成本。</li>
<li>增量原生：所有新需求，一律不走新建物理宽表的老路，直接基于 DWD 明细层，在语义层上配置实现。从源头遏制宽表膨胀。</li>
<li>存量替旧：随着时间推移，逐步把那些老旧、难维护的物理宽表下线，将其逻辑迁移到语义层。完成架构的平稳升级。</li>
</ol>
<h2 data-id="heading-6">三、思维转变：从“实现需求”到“定义资产”</h2>
<p>这套技术栈背后，其实是对数据工程师角色的重新定位。</p>
<p>以前我们是“SQL 实现者”：业务提需求，我们翻译成 SQL，跑出数据。我们的价值体现在“会不会写高效的 SQL”、“能不能按时交付”。</p>
<p>未来我们应该成为 “语义定义者”和“资产架构师”：</p>
<ul>
<li>核心工作不再是写<code>JOIN</code>和<code>GROUP BY</code>，而是和业务一起梳理：什么是“订单”？“支付成功”的状态枚举有哪些？“GMV”应该由哪些“基础度量”在什么“限定”下组成？</li>
<li>把这些业务语义通过声明式的方式，固化到语义层中，成为全公司公认的数据资产。</li>
<li>然后设计物化策略，在性能和成本间取得平衡。</li>
</ul>
<p>协作模式也会变成 “136 模式”：数据团队只定义 10% 最核心的原子指标；分析师可以基于这些原子指标，配置出 30% 的常用派生指标；剩下 60% 的临时性、探索性分析需求，业务可以直接在 BI 里，像搭积木一样，用已有的指标和维度自助完成。</p>
<h2 data-id="heading-7">四、一些冷静的思考</h2>
<p>这东西（以Aloudata CAN 为例）当然不是银弹。</p>
<ol>
<li>学习曲线：从写 SQL 到做配置，需要适应。尤其是梳理全公司统一语义，是件非常考验技术和沟通能力的事，比写 SQL 难多了。</li>
<li>性能上限：智能路由和物化策略再牛，终究要落库。面对千亿、PB 级实时扫描查询，它的加速引擎到底有多能打，需要实际业务压测才知道。“按需物化” 听起来美好，但如果业务查询模式极其分散且随机（即席查询），可能会退化成大量现场计算。</li>
<li>厂商绑定：深度使用后，你的业务语义模型就长在它平台里了。迁移成本会比较高。</li>
</ol>
<p>但无论如何，它指出了一个明确的方向：通过语义层解耦逻辑与物理，通过声明式配置替代重复编码，通过智能自动化降低运维负担。这绝对是数据工程领域一次有价值的范式演进。</p>
<p>目前看这套逻辑是自洽的，特别是“虚拟事实网络”和“智能物化”的设计，直击了宽表冗余和性能的痛点。但它到底是不是“真香”，还得看极端场景下的表现。有条件的团队，完全可以拿一个业务边界清晰、但宽表已经有点臃肿的模块去试点一下，压一压它的上限。毕竟，把我们从写宽表 SQL 的苦海里捞出来的任何尝试，都值得一个认真的技术评估。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[独立工作室Empty Vessel如何使用Xsens创建高质量角色动画]]></title>    <link>https://juejin.cn/post/7600967006892441609</link>    <guid>https://juejin.cn/post/7600967006892441609</guid>    <pubDate>2026-01-30T08:12:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600967006892441609" data-draft-id="7600990891206344731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="独立工作室Empty Vessel如何使用Xsens创建高质量角色动画"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T08:12:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱迪斯通"/> <meta itemprop="url" content="https://juejin.cn/user/2672256188156042"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            独立工作室Empty Vessel如何使用Xsens创建高质量角色动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2672256188156042/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱迪斯通
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:12:06.000Z" title="Fri Jan 30 2026 08:12:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于许多独立工作室来说，角色动画在质量、时间和预算之间始终要做出妥协。Empty Vessel正在试图避免这种妥协。</p>
<p>Empty Vessel由经验丰富的AAA开发者创立并以小而敏捷的团队运营，该团队正在开发 DEFECT，这是一款赛博朋克风格的基于小队协作的沉浸式目标射击游戏，其中紧张感、现实主义和电影画面呈现起着核心作用。从开发的早期阶段，团队就知道，可信的人类动作对于实现这一体验至关重要。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7375d5605f354f489494502a6c0202b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770365526&amp;x-signature=SEwyJO6V7PSJMBKsVOseJpa620M%3D" alt="ScreenShot_2026-01-30_122211_472.png" loading="lazy"/></p>
<p>为了在不使用传统动作捕捉流程的额外开销的情况下达到该质量水平， Empty Vessel在其动画工作流程中使用了Xsens惯性动作捕捉技术。</p>
<p><strong><strong>Empty Vessel********工作室</strong></strong></p>
<p>Empty Vessel工作室由来自Naughty Dog、id Software和BioWare等工作室的开发者组成。团队成员之前曾参与过包括神秘海域、最后生还者、毁灭战士和使命召唤等大型系列游戏的开发。</p>
<p>今天，工作室以约17人的精简团队运营。目标不是复制AAA级制作的规模，而是提供同样精致的体验，同时保持灵活性和效率。</p>
<p>DEFECT的背景设定在一个反乌托邦的赛博朋克未来，是一款基于小队的沉浸式目标射击游戏，四个队伍在同场比赛中竞争，每个队伍追求不同的目标。玩家可以扮演专制执行单位或强大的帮派派系，在充满人工智能控制的敌人和其他玩家的复杂环境中生存对抗。</p>
<p>游戏玩法强调战术紧张感。移动需要谨慎，沟通很重要，每一个角落都充满了不确定性。这使得多人竞技模式中也充满了PvE元素，迫使玩家不断评估风险并适应。</p>
<p>沉浸感是游戏的核心设计支柱。无需依赖传统的抬头显示器（HUD），DEFECT的菜单直接存在于世界中，以游戏中的PDA形式出现，角色与之进行物理互动。目标通过配音和环境线索展开，支持从游戏玩法中自然产生的电影体验，而不通过过场动画呈现。</p>
<p><strong>独立动画挑战</strong></p>
<p>对于像Empty Vessel这样的小型工作室来说，动画质量是该项目的压力点。逼真的真人动作需要花费大量时间来制作，而传统的动作捕捉管道通常会在捕捉和可用数据之间导致长时间的延迟。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cc2c10222404fb189f9e477f87c06c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770365526&amp;x-signature=vPwX4Ink6UG5Ce81cbbXzL2Vi6k%3D" alt="ScreenShot_2026-01-30_122211_472.png" loading="lazy"/></p>
<p>Rico Flores是Empty Vessel工作室的动画总监，他职业生涯中一直在处理高端光学动作捕捉和更符合预算的设置。虽然光学捕捉能带来出色的结果，但其通常伴随着无法适应精简制作和拖长制作时间等问题。</p>
<p>“从拍摄日到实际获得可用数据，可能需要几周甚至几个月，”Flores解释道。“这使得迭代变得非常缓慢。”</p>
<p>由于游戏的即时性、节奏和紧张感在不断变化，速度成为了一个关键问题。团队需要一种快速原型设计、立即测试想法和优化表演的方法，同时该方法不会耗尽时间和预算。</p>
<p><strong><strong>为什么</strong></strong>Empty Vessel<strong><strong>选择了</strong></strong>Xsens****</p>
<p>Flores已经在之前的工作室项目中使用过Xsens，并亲眼目睹了它如何改变动画团队的工作方式。当Empty Vessel成立时，Xsens惯性动捕系统立即成为了项目角色动画制作的首选工具。</p>
<p>“在我体验了Xsens的强大功能并了解我能用它生产多少产品后，我就知道，对于我的下一家公司，我们将会从Xsens开始。”Flores说。</p>
<p>Xsens系统的投入使Empty Vessel 能够将动作捕捉完全内部化。与其安排外部拍摄并等待结果不同，团队可以在需要时随时捕捉动作，并立即看到结果。</p>
<p>“例如我今天可以拍摄一些东西，几小时后就能看到它，并且当天就能在我的角色上使用它，”Flores说。“如果某件事是优先事项，我可以去我的车库，捕获它，并将其加入游戏中。”</p>
<p>这种速度从根本上改变了人们对动画制作的期望。</p>
<p><strong>构建动画管道</strong></p>
<p>Xsens是DEFECT动画工作流程的核心。该系统用于捕捉各种角色动作，从移动和战斗动作再到环境互动和日常动作。</p>
<p>其中大部分工作是由Flores自己完成的，这让团队能够快速迭代，无需依赖于外部资源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14ae171280d347359dc01e8e72adc345~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770365526&amp;x-signature=vKeivD7GZAiGBzdzA8bAWpSVDhM%3D" alt="ScreenShot_2026-01-30_122102_084.png" loading="lazy"/></p>
<p>“如果我们想测试什么，我会迅速捕捉它，把它放进游戏中，不需要复杂的清理工作，然后看看感觉如何，”他解释道。“如果行得通，我就把它打磨好。如果不行，我们就继续下一个。这可能只花费几小时的工作时间。”</p>
<p>这种方法让Empty Vessel可以自由实验。动画不再成为阻碍设计决策的瓶颈。相反，它们成为创意过程的一部分，支持快速原型制作和改进。</p>
<p>对于更专业的表演，例如复杂的特技或高度训练的战斗动作，团队偶尔会通过光学动作捕捉来补充其流程。</p>
<p>“走路、与物体互动、拔出武器、使用杠杆。所有这些都可以通过Xsens快速完成，而不需要完整的工作室拍摄。”</p>
<p><strong><strong>干净的<strong><strong><strong><strong>数据和更快的</strong></strong></strong></strong>后期制作</strong></strong></p>
<p>除了速度，数据质量是团队采用Xsens的关键因素。动画清理中最耗时的步骤之一是去除运动数据的抖动和噪音。</p>
<p>“这一直是最具挑战性的部分之一，”Flores说。“使用Xsens捕获到的数据很干净。我们很少需要处理抖动，因此我可以专注于优化性能，而不是修正曲线。”</p>
<p>在该工作流程中捕获的动作几乎可以立即使用，这大大减少了在进一步优化和最终确定制作计划之前所需的清理工作。</p>
<p><strong><strong>展望未来</strong></strong></p>
<p>随着DEFECT的持续开发，Xsens仍然是Empty Vessel生产流程中的核心部分。这种快速捕捉运动、自由迭代并保持高质量的能力，使团队能够不断优化体验并快速发展。</p>
<p>对于那些希望在没有AAA级预算的情况下也提供逼真角色动作和电影效果的独立工作室来说， Empty Vessel的案例展示了Xsens在独立工作室工作流程中的应用方向。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>